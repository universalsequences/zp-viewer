(window.webpackJsonp=window.webpackJsonp||[]).push([[3],Array(109).concat([function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(379),a=Object(r.a)()},,,function(e,t,n){"use strict";n.r(t);var r=n(11);function a(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=n(1879),s=n(205).EventEmitter,c={accum:0,getUID:function(){return this.accum++},debug:!1,samplerate:44100,shouldLocalize:!1,graph:null,alwaysReturnArrays:!1,globals:{windows:{}},mode:"worklet",closures:new Set,params:new Set,inputs:new Set,parameters:new Set,endBlock:new Set,histories:new Map,memo:{},export:function(e){},addToEndBlock:function(e){this.endBlock.add("  "+e)},requestMemory:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var n in e){var r=e[n];void 0!==r.length?r.idx=c.memory.alloc(r.length,t):console.log("undefined length for:",n)}},createMemory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4096,t=arguments.length>1?arguments[1]:void 0;return o.create(e,t)},createCallback:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Float64Array,c=Array.isArray(e)?e.length:1,u=Array.isArray(e)&&e.length>1;this.memory="number"===typeof t||void 0===t?this.createMemory(t,s):t,this.outputIdx=this.memory.alloc(c,!0),this.emit("memory init"),this.graph=e,this.memo={},this.endBlock.clear(),this.closures.clear(),this.inputs.clear(),this.params.clear(),this.globals={windows:{}},this.parameters.clear(),this.functionBody="  'use strict'\n",!1===o&&(this.functionBody+="worklet"===this.mode?"  var memory = this.memory\n\n":"  var memory = gen.memory\n\n");for(var l=0;l<c;l++)if("number"!==typeof e[l]){var f=c>1?this.getInput(e[l]):this.getInput(e),h="";if(Array.isArray(f))for(var d=0;d<f.length;d++)h+=f[d]+"\n";else h+=f;(h=h.split("\n"))[h.length-1].trim().indexOf("let")>-1&&h.push("\n");var p=h.length-1;h[p]="  memory["+(this.outputIdx+l)+"]  = "+h[p]+"\n",this.functionBody+=h.join("\n")}this.histories.forEach(function(e){null!==e&&e.gen()});var v="  return ";if(1===c&&!0!==this.alwaysReturnArray||(v+="[ "),v+="memory[ ".concat(this.outputIdx," ]"),c>1||!0===this.alwaysReturnArray){for(var m=1;m<c;m++)v+=", memory[ ".concat(this.outputIdx+m," ]");v+=" ] "}this.functionBody=this.functionBody.split("\n"),this.endBlock.size?(this.functionBody=this.functionBody.concat(Array.from(this.endBlock)),this.functionBody.push(v)):this.functionBody.push(v),this.functionBody=this.functionBody.join("\n"),!0===o&&this.parameters.add("memory");var y="";if("worklet"===this.mode){var b,g=a(this.parameters.values());try{for(g.s();!(b=g.n()).done;){y+=b.value+","}}catch(N){g.e(N)}finally{g.f()}y=y.slice(0,-1)}var O=0!==this.parameters.size&&this.inputs.size>0?", ":"",j="";if("worklet"===this.mode){var k,w=a(this.inputs.values());try{for(w.s();!(k=w.n()).done;){j+=k.value.name+","}}catch(N){w.e(N)}finally{w.f()}j=j.slice(0,-1)}var x="worklet"===this.mode?"return function( ".concat(j," ").concat(O," ").concat(y," ){ \n").concat(this.functionBody,"\n}"):"return function gen( ".concat(Object(r.a)(this.parameters).join(",")," ){ \n").concat(this.functionBody,"\n}");(this.debug||i)&&console.log(x),n=new Function(x)();var S,P=a(this.closures.values());try{for(P.s();!(S=P.n()).done;){var E=S.value,T=Object.keys(E)[0],A=E[T];n[T]=A}}catch(N){P.e(N)}finally{P.f()}var M,R=a(this.params.values());try{var C=function(){var e=M.value,t=Object.keys(e)[0],r=e[t];Object.defineProperty(n,t,{configurable:!0,get:function(){return r.value},set:function(e){r.value=e}})};for(R.s();!(M=R.n()).done;)C()}catch(N){R.e(N)}finally{R.f()}return n.members=this.closures,n.data=this.data,n.params=this.params,n.inputs=this.inputs,n.parameters=this.parameters,n.out=this.memory.heap.subarray(this.outputIdx,this.outputIdx+c),n.isStereo=u,n.memory=this.memory.heap,this.histories.clear(),n},getInputs:function(e){return e.inputs.map(c.getInput)},getInput:function(e){var t;if("object"===typeof e)if(c.memo[e.name])t=c.memo[e.name];else if(Array.isArray(e))c.getInput(e[0]),c.getInput(e[1]);else{"function"!==typeof e.gen&&(console.log("no gen found:",e,e.gen),e=e.graph);var n=e.gen();Array.isArray(n)?(c.shouldLocalize?(c.codeName=n[0],c.localizedCode.push(n[1])):c.functionBody+=n[1],t=n[0]):t=n}else t=e;return t},startLocalize:function(){this.localizedCode=[],this.shouldLocalize=!0},endLocalize:function(){return this.shouldLocalize=!1,[this.codeName,this.localizedCode.slice(0)]},free:function(e){if(Array.isArray(e)){var t,n=a(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.free(r)}}catch(u){n.e(u)}finally{n.f()}}else if("object"===typeof e){if(void 0!==e.memory)for(var i in e.memory)this.memory.free(e.memory[i].idx);if(Array.isArray(e.inputs)){var o,s=a(e.inputs);try{for(s.s();!(o=s.n()).done;){var c=o.value;this.free(c)}}catch(u){s.e(u)}finally{s.f()}}}}};c.__proto__=new s,t.default=c},function(e,t,n){"use strict";n.d(t,"a",function(){return b}),n.d(t,"b",function(){return O}),n.d(t,"c",function(){return g});var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2),u=n(14),l=n(77),f=n(30),h=n(22),d=n(6),p=n.n(d),v=n(25),m=n(27);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}window.depthsInitialized=0,window.depths=[];var b=function(e){Object(o.a)(n,e);var t=y(n);function n(e,a,i){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(r.a)(this,n),(o=t.call(this,e,a,i,s)).hasAudioParamSetter=!0,o.setAudioParam(a),o}return Object(a.a)(n,[{key:"_fromJson",value:function(e,t){var n=this,r=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],{});return window.debugStopLoad?r:(void 0!==e.value&&e.value!==this._lastValue&&(r=this.set(e.value,!0,!0)),e.lfos&&e.lfos.forEach(function(e){var t=n.availableLFOs[e];n.connectToLFO(t)}),e.envelopes&&e.envelopes.forEach(function(e){var t=n.availableEnvelopes[e];n.connectToLFO(t)}),r)}},{key:"fromJson",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.depth&&(this._depth=e.depth.unlockedValue);var a=this.id,i=this.context&&this.context.subSequence?this.context.subSequence:void 0!==t?t.currentSubSequence||t.subSequences[0]:void 0;void 0===e.id||r||(this.id=e.id,window.sequencerEngine&&(window.sequencerEngine.idToParameter[this.id]=this));var o={id:this.id,value:this._lastValue};if(void 0!==e.lfos&&e.lfos.length>0&&void 0!==i&&e.lfos.forEach(function(e){var t=n.availableLFOs[e]||i.lfos[e].lfo;n.lfos.includes(t)&&t.replaceParameterIds(a,n.id,n),n.connectToLFO(t)}),void 0!==e.envelopes&&e.envelopes.length>0&&void 0!==i&&e.envelopes.forEach(function(e){if(n.availableEnvelopes&&(n.availableEnvelopes[e]||i.envelopes)){var t=n.availableEnvelopes[e]||i.envelopes[e];n.envelopes.includes(t)?t.replaceParameterIds(a,n.id,n):n.connectToEnvelope(t)}}),void 0!==e.value&&e.value!==this._lastValue&&(o=this.set(e.value,!0,!0)),e.keyScaling&&(this.keyScaling=new f.a(this,e.keyScaling.min,e.keyScaling.max)),this.unlockedValue=void 0!==e.unlockedValue?Object(v.b)(e.unlockedValue):this.value,void 0!==e.patternToValue&&(this.patternToValue=Object(v.a)(e.patternToValue)),this.isPatternLocked()&&void 0!==this.patternToValue[0]?this.patternToValue[0]!==this._lastValue&&(o=this.set(this.patternToValue[0],!0,!0)):void 0!==this.unlockedValue&&this.unlockedValue!==this._lastValue&&(o=this.set(this.unlockedValue,!0,!0)),void 0!==e.paletteToValue&&(this.paletteToValue=Object(v.a)(e.paletteToValue)),e.patternToAutomation)for(var s in e.patternToAutomation)this.patternToAutomation[s]=new m.a(this),this.patternToAutomation[s].fromJson(e.patternToAutomation[s]);e.unlockedAutomation&&this.unlockedAutomation.fromJson(e.unlockedAutomation),this.loadModsFromJson(e);var c={};return c[o.id]=o.value,void 0!==e.depth?(this.depthParameter||this.initDepth(),this.depthParameter.fromJson(e.depth,t,r)):void 0!==e._depth&&(this._depth=e._depth),e.mixAutomation&&this.mixAutomation.fromJson(e.mixAutomation,!1),void 0!==e.min&&(this.min=e.min),void 0!==e.max&&(this.max=e.max),e.stepToValue&&(this.stepToValue=e.stepToValue),c}},{key:"initDepth",value:function(){if(!this.depthParameter){window.depthsInitialized++,window.depths.push(this);var e=void 0!==this._depth?this._depth:1;this.depthSignal=l.a.useDepth(),this.depthParameter=new g("depth",this.depthSignal,{min:0,max:1,defaultValue:e,automationRate:h.a},.2),this.context&&this.depthParameter.setContext(this.context),this.depthParameter.setStore(this.store)}}},{key:"connectToLFO",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(i.a)(Object(c.a)(n.prototype),"connectToLFO",this).call(this,e),t&&this.set(this.value,!0,!0)}},{key:"disconnectFromLFO",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;Object(i.a)(Object(c.a)(n.prototype),"disconnectFromLFO",this).call(this,e,!1,r),t&&this.set(this.value,!0,!0)}},{key:"connectToEnvelope",value:function(e){Object(i.a)(Object(c.a)(n.prototype),"connectToEnvelope",this).call(this,e),this.set(this.value,!0,!0)}},{key:"disconnectFromEnvelope",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;Object(i.a)(Object(c.a)(n.prototype),"disconnectFromEnvelope",this).call(this,e,!1,r),t&&this.set(this.value,!0,!0)}}]),n}(u.a),g=function(e){Object(o.a)(n,e);var t=y(n);function n(e,a){var i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;return Object(r.a)(this,n),(i=t.call(this,e,a,function(t,n,r){if(t&&!isNaN(n)&&(t.input||o.noInput)){var a=p.a.Master.context.isOffline?p.a.Master.context._currentTime:p.a.Master.context.currentTime;s>0&&"macro"!==e&&window.sequencerEngine&&window.sequencerEngine.playing?isNaN(n)||t.linearRampToValueAtTime(n,a+s):window.isNFT||"harmonicity"!==e&&"octave"!==e?t.value=n:t.setValueAtTime(n,a)}},o)).hasAudioParamSetter=!1,i.automationRate=h.a,i}return n}(b),O=function(e){Object(o.a)(n,e);var t=y(n);function n(e,a){var i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Object(r.a)(this,n),o.unit="%",(i=t.call(this,e,a,o)).hasAudioParamSetter=!1,i}return n}(g)},function(e,t,n){"use strict";n.d(t,"c",function(){return o}),n.d(t,"b",function(){return s}),n.d(t,"m",function(){return c}),n.d(t,"n",function(){return u}),n.d(t,"j",function(){return l}),n.d(t,"d",function(){return f}),n.d(t,"a",function(){return h}),n.d(t,"e",function(){return d}),n.d(t,"i",function(){return p}),n.d(t,"g",function(){return v}),n.d(t,"l",function(){return m}),n.d(t,"k",function(){return y}),n.d(t,"h",function(){return b}),n.d(t,"f",function(){return g}),n.d(t,"K",function(){return O}),n.d(t,"w",function(){return j}),n.d(t,"R",function(){return k}),n.d(t,"C",function(){return w}),n.d(t,"F",function(){return x}),n.d(t,"P",function(){return S}),n.d(t,"L",function(){return P}),n.d(t,"x",function(){return E}),n.d(t,"M",function(){return A}),n.d(t,"A",function(){return M}),n.d(t,"y",function(){return R}),n.d(t,"z",function(){return C}),n.d(t,"o",function(){return N}),n.d(t,"q",function(){return I}),n.d(t,"O",function(){return q}),n.d(t,"J",function(){return _}),n.d(t,"B",function(){return D}),n.d(t,"G",function(){return F}),n.d(t,"I",function(){return L}),n.d(t,"Q",function(){return B}),n.d(t,"N",function(){return z}),n.d(t,"r",function(){return J}),n.d(t,"S",function(){return V}),n.d(t,"p",function(){return H}),n.d(t,"s",function(){return U}),n.d(t,"t",function(){return G}),n.d(t,"u",function(){return W}),n.d(t,"v",function(){return K}),n.d(t,"H",function(){return Q}),n.d(t,"D",function(){return Z}),n.d(t,"E",function(){return Y});var r=n(17),a=n(213),i=n(151),o="FILTER",s="COND",c="SWITCH_OUTPUT",u="TRIGGER",l="SET",f="GRAB",h="CHOKE",d="GRAB_TIME",p="SEQUENTIALLY",v="PARALLEL",m="SET_MODULATOR",y="SET_MACRO",b="PATTERN_SWITCH",g="ON";Object(i.a)("s",{"...args":"Arguments"},"Evaluates arguments sequentially");var O=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{axiom:p,sequence:t}};Object(i.a)("filter",{boolean:"True or false"},"Allows a trigger to pass, based on the argument passed");var j=function(e){return{axiom:o,value:e}},k=function(e){return{axiom:u,value:e}},w=function(e,t){return{axiom:g,value:{type:e,fn:t}}};Object(i.a)("patternSwitch",{patternNumber:"The pattern number to go to (zero indexed)"},"Switches the pattern of the track`'s sub-sequence");var x=function(e){return{axiom:b,value:e}};Object(i.a)("switchOutput",{outputNumber:"The output-number to send the trigger to (zero-indexed)"},"Midi Effects can have several outputs. This function lets you choose which one to send a trigger through.");var S=function(e){return{axiom:c,value:e}};Object(i.a)("set",{param:"The parameter name of a trigger to alter","...values":"The remaining arguments are values that are alternated. This param gets set with these values"},"Sets a trigger's parameter");var P=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return{axiom:l,param:e,value:1!==n.length||Array.isArray(n[0])||"function"===typeof n[0]?a.a.apply(void 0,n):n[0]}},E=function(e){return function(t){return t[e]}},T=function(e,t,n,r){return{axiom:m,modType:e,number:t,param:n,value:r}},A=function(e,t){return{axiom:y,name:e,value:t}},M=function(e){if(!e)return e;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a="function"===typeof e?e.apply(void 0,n):e;return"object"===typeof a&&"SEQUENTIALLY"===a.axiom?a.sequence[0]:a};Object(i.a)("grab",{trackNumber:"The track number we wish to grab parameter values from (zero-indexed)",fromParam:"The parameter in the target track we wish to grab",toParam:"The parameter in the current track we wish to set with the grabbed value",add:"True/false whether we add the grabbed value to the current value"},"Grab trigger-parameter values from other tracks");var R=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"transpose",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"transpose",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{axiom:f,trackNumber:M(e),toParam:M(n),fromParam:M(t),add:M(r)}};Object(i.a)("grabTime",{trackNumber:"The track number we wish to grab time values from (zero-indexed)"},"Grabs timing information from other tracks, if that track has any triggers occuring on this step.");var C=function(e){return{axiom:d,trackNumber:M(e)}};Object(i.a)("choke",{trackNumber:"The track-number we wish to choke"},"Prevents triggers from another track from occuring when this track triggers");var N=function(e){return{axiom:h,trackNumber:M(e)}};Object(i.a)("cond",{condition:"True/false whether we execute statement1 or statement2",statement1:"Triggered when the condition evalulates to true",statement2:"Triggered when the condition evalulates to false"},"Conditional control allows you to execute different functions depending on the condition");var I=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j(!0);return{axiom:s,condition:e,statement1:t,statement2:n}},q=function(e,t){return function(n,r,a){return j(n&&r>=M(e)&&r<=M(t))}};Object(i.a)("rolling",{},"Filter only passing when the sequence is in roll-mode");var _=function(){return function(e,t,n,r){return j(r.isRolling())}},D=function(e,t){return function(n,r,a){return j(n&&n.transpose>=e()&&n.transpose<=t())}};Object(i.a)("prob",{probability:"Percentage value of how often a trigger is passed through"},"Generates a random value from 0-100 and lets triggers pass when they are below the probability argument");var F=function(e){return function(t,n,r){return j(Math.random()<=M(e)/100)}};Object(i.a)("reverse",{"...values":"Values to be alternated (true/false)"},"Sets the reverse parameter of the trigger. If a sample is played, it will play reversed");var L=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return P.apply(void 0,["reverse"].concat(t))};Object(i.a)("transpose",{"...values":"Values to be alternated"},"Sets the transpose of the trigger to the value passed (which are alternated every trigger)");var B=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return void 0===t||0===t.length?E("transpose"):P.apply(void 0,["transpose"].concat(t))};Object(i.a)("start",{"...values":"Values to be alternated"},"Sets the start percentage (of sample) of the trigger to the value passed (which are alternated every trigger)");var z=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return void 0===t||0===t.length?E("start"):P.apply(void 0,["start"].concat(t))};Object(i.a)("dur",{"...values":"Values to be alternated"},"Sets the duration of the trigger to the value passed (which are alternated every trigger)");var J=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return void 0===t||0===t.length?E("duration"):P.apply(void 0,["duration"].concat(t))};Object(i.a)("vel",{"...values":"Values to be alternated"},"Sets the velocity of the trigger to the value passed (which are alternated every trigger)");var V=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return void 0===t||0===t.length?E("velocity"):P.apply(void 0,["velocity"].concat(t))};Object(i.a)("chop",{"...values":"Values to be alternated"},"Sets the chop of the trigger to the value passed (which are alternated every trigger)");var H=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return void 0===t||0===t.length?E("chop"):P.apply(void 0,["chop"].concat(t))},U=function(e,t){return T(r.a,0,e,t)},G=function(e,t){return T(r.a,1,e,t)},W=function(e,t){return T(r.a,2,e,t)},K=function(e,t){return T(r.a,3,e,t)};Object(i.a)("randomSelect",{options:"Options to be randomly chosen from"},"Randomly selects an option from the arguemnts. randomSelect(0,1,2,3) will randomly return 0,1,2, or 3 with uniform probability");var Q=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){return M(t[Math.floor(Math.random()*t.length)])}};Object(i.a)("knob",{name:"Name of the variable you wish to create"},"Create a variable that is controlled via a slider."),Object(i.a)("p",{"...args":"Arguments"},"Evaluates arguments in parallel");var Z=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{axiom:v,sequence:t}};Object(i.a)("parallelList",{"...args":"Arguments"},"Evaluates arguments in parallel");var Y=function(e){return{axiom:v,sequence:e}}},function(e,t,n){"use strict";var r=n(10),a=n(1),i=n(108),o=n(4),s=n(5),c=n(31),u=n(7),l=n(8),f=n(2),h=(n(3),n(6)),d=n.n(h),p=(n(313),n(14)),v=new(function(){function e(){Object(o.a)(this,e),this.nameToEffects={}}return Object(s.a)(e,[{key:"useEffect",value:function(e,t,n){return n.isOffline?t():e in this.nameToEffects&&this.nameToEffects[e].length>0?this.nameToEffects[e].pop():t()}},{key:"totalEffects",get:function(){var e=0;for(var t in this.nameToEffects)e+=this.nameToEffects[t].length;return e}},{key:"releaseEffect",value:function(e,t,n){if(n.isOffline)t.dispose();else{if(this.totalEffects>=12)for(var r in this.nameToEffects){var a=this.nameToEffects[r][0];if(a){this.nameToEffects[r]=this.nameToEffects[r].slice(1),a.dispose(!1);break}}this.nameToEffects[e]||(this.nameToEffects[e]=[]),t.disconnect(),this.nameToEffects[e].push(t)}}}]),e}()),m=n(113),y=(n(23),n(447)),b=n(130),g=n(168),O=n(134),j=n(116),k=(n(122),n(59)),w=n(20);function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var S=function(e){Object(u.a)(n,e);var t=x(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this)).sequencerEngine=a,s.initialBulkValues={},s.store=a.store,s.name=e,s.id=Object(w.uuid)(),s.sequencerEngine.idToObject[s.id]=Object(c.a)(s),s.parameters=[],s.effectFn=r,s.enabledParameter=new p.a("Enabled",Object(c.a)(s),function(e,t){s.toggle(t)},{min:0,max:1,unit:"boolean",defaultValue:!0}),s.effectNode=v.useEffect(s.name,r,a),s.initializeParameters(),s.numberOfOutputs=1,s.enabled=!1,s.toggledValue=0,s.value=0,s.connected=0,s.newInlet(b.m,function(){return s.swapMinMax()}),s.newInlet("set parameter",function(e){return s.paramSet(e)}),s.newInlet("enable",function(e){return s.onEnableMsg(e)}),s}return Object(s.a)(n,[{key:"onEnableMessage",value:function(e){Object(i.a)(e,1)[0]?this.enableParameter.set(!0):this.enableParameter.set(!1)}},{key:"initializeParameters",value:function(){this.wetParameter=void 0!==this.effectNode.wet?new m.b("Wet",this.effectNode.wet,{documentation:"Controls the amount of (wet) effected signal, vs. dry (un-effected) signal.",defaultValue:0}):void 0,this.registerParameter(this.wetParameter),this.track=void 0,this.group=void 0,this.setWet(0)}},{key:"getObjectType",value:function(){return g.a}},{key:"paramSet",value:function(e){var t=Object(i.a)(e,1)[0];if(t.split){var n=t.split(" ");if(2===n.length){var r=n[0].toLowerCase(),a=this.getParameters().filter(function(e){return e.name.toLowerCase().includes(r)}),o=parseFloat(n[1]);isNaN(o)&&(o=n[1]),a.forEach(function(e){return e.set(o)})}}}},{key:"swapMinMax",value:function(){this.getParameters().forEach(function(e){e.parameterMods.forEach(function(e){var t=e.min;e.min=e.max,e.max=t})})}},{key:"getEffectType",value:function(){return k.a}},{key:"updateInitialValues",value:function(){this.sequencerEngine.parametersToUpdate=Object(a.a)({},this.sequencerEngine.parametersToUpdate,this.initialBulkValues)}},{key:"makePublicIfNeeded",value:function(){}},{key:"getParameters",value:function(){return this.parameters||[]}},{key:"isMidiEffect",value:function(){return!1}},{key:"wet",set:function(e){this.wetParameter&&this.wetParameter.set(e)}},{key:"registerContext",value:function(e,t){var n=this;this.context?this.context.combineWith(e):this.context=e.getCopy(),t?(this.context.forSubDevice(this),this.context.forEffect(t)):this.context.forEffect(this),this._context=this.context,this.parameters.forEach(function(e){return e.setContext(n.context)})}},{key:"registerMixSession",value:function(e){this.parameters.forEach(function(t){return t.setMixSession(e)})}},{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,this.initialBulkValues=Object(a.a)({},this.initialBulkValues,e.setStore(this.store)),this.parameters.push(e))}},{key:"finishRegistering",value:function(){}},{key:"connect",value:function(e){this.effectNode.connect(e)}},{key:"syncable",value:function(){return!1}},{key:"disconnect",value:function(e){this.effectNode.disconnect(e)}},{key:"isEnabled",value:function(){return this.enabledParameter.get()}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enabledParameter.set(e)}},{key:"toggleEnabled",value:function(){this.enabledParameter.set(!this.enabledParameter.get())}},{key:"toggle",value:function(e){}},{key:"setValue",value:function(e){this.value=e,this.effectNode.wet&&this.wetParameter.set(e)}},{key:"setWet",value:function(e){this.effectNode.wet&&this.wetParameter.set(e)}},{key:"getWet",value:function(){return this.wetParameter.value}},{key:"getName",value:function(){return this.name}},{key:"getEffect",value:function(){return this.effectNode}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=(!(arguments.length>1&&void 0!==arguments[1])||arguments[1],new n(this.name,this.effectFn,e));return this.wetParameter&&t.setWet(this.wetParameter.get()),t.enable(this.enabledParameter.get()),t}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];void 0===e.id||t&&"boolean"===typeof t||(this.id=e.id,this.sequencerEngine.idToObject[this.id]=this),this.x=e.x,this.y=e.y,void 0!==e.enabled&&this.enable(e.enabled);var n={};return void 0!==this.wetParameter&&(void 0!==e.wet&&(Object(j.a)(this.wetParameter,e.wet,n),this.effectNode&&this.effectNode.wet&&(this.effectNode.wet.value=e.wet)),n=Object(a.a)({},n,this.loadParameterFromJson(e,"wetParameter",this.wetParameter,t))),n}},{key:"saveParameterToJson",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(n.isConnectedToAnyModulator()||Object.keys(n.patternToValue).length>0||Object.keys(n.stepToValue).length>0||Object.keys(n.paletteToValue).length>0||n.mixAutomation.automations.length>0||n.automations.length>=0||n.isMapped||n.higherOrdered||n.depthParameter||n.hasMacro){var i=Object(a.a)({},e);return i[t]=n.getJson(r),i}return e}},{key:"loadParameterFromJson",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return r="boolean"===typeof r&&r,t in e?(this.handleModulators(e[t],n),n.fromJson(e[t],this.sequencerEngine,r)):(n.disconnectFromAllModulators(),{})}},{key:"handleModulators",value:function(e,t){e.lfos&&t.lfos.filter(function(t){return!e.lfos.includes(t.number-1)}).forEach(function(e){return t.disconnectFromLFO(e)});e.envelopes&&t.envelopes.filter(function(t){return!e.envelopes.includes(t.number-1)}).forEach(function(e){return t.disconnectFromEnvelope(e)});t.disableKeyScaling()}},{key:"getJson",value:function(){var e={name:this.name,enabled:this.enabledParameter.get(),id:this.id,x:this.x,y:this.y};return void 0!==this.wetParameter&&(e.wet=this.wetParameter.get(!0),e.value=this.wetParameter.get(!0),e=this.saveParameterToJson(e,"wetParameter",this.wetParameter)),e}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.sequencerEngine.isOffline||!e?(this.effectNode&&this.effectNode.dispose(),this.parameters.forEach(function(e){return e.dispose()})):(this.parameters.forEach(function(e){return e.dispose(!1)}),v.releaseEffect(this.name,this.effectNode,this.sequencerEngine)),this.effectNode=void 0,this.parameters=void 0,this.context=void 0,this.name=void 0}}]),n}(Object(O.a)(Object(y.a)(function(){return function e(){Object(o.a)(this,e)}}()))),P=function(e){Object(u.a)(n,e);var t=x(n);function n(e,r){var a;Object(o.a)(this,n),a=t.call(this,"Filter",function(){return new d.a.Filter(80,"lowpass",-24)},e);var i={min:0,max:1e4,unit:"HZ",defaultValue:80,documentation:["Controls the frequency at which filtering works at. ","Ex: For Lowpass filters, frequencies above this value will be cut."]};return r&&(i.automationRate=r),a.cutoffParameter=new m.c("Cutoff",a.effectNode.frequency,i),a.qParameter=new m.c("Q",a.effectNode.Q,{min:0,max:20,unit:"",defaultValue:1}),a.typeParameter=new p.a("type",Object(c.a)(a),function(e,t){return a.effectNode.type=t},{min:"lowpass",max:"highpass",unit:"",defaultValue:"lowpass"}),a.registerParameter(a.cutoffParameter),a.registerParameter(a.typeParameter),a.registerParameter(a.qParameter),a.updateInitialValues(),a}return Object(s.a)(n,[{key:"dispose",value:function(){Object(r.a)(Object(f.a)(n.prototype),"dispose",this).call(this,!1)}},{key:"connect",value:function(e){Object(r.a)(Object(f.a)(n.prototype),"connect",this).call(this,e)}},{key:"syncable",value:function(){return!1}},{key:"toggle",value:function(e){}},{key:"setValue",value:function(e){this.value=e,e=5e3*e+50,this.effectNode.frequency.value=e}},{key:"setFrequency",value:function(e){try{this.cutoffParameter.set(e)}catch(t){}}},{key:"cutoffFrequency",get:function(){return this.cutoffParameter.get()},set:function(e){this.cutoffParameter.set(e)}},{key:"Q",set:function(e){this.qParameter.set(e)}},{key:"setQ",value:function(e){this.qParameter.set(e)}},{key:"lowpass",value:function(){this.type="lowpass"}},{key:"hipass",value:function(){this.type="highpass"}},{key:"type",get:function(){return this.typeParameter.get()},set:function(e){this.typeParameter.set(e)}},{key:"getFrequency",value:function(){return this.effectNode.frequency.value}},{key:"getQ",value:function(){return this.effectNode.Q.value}},{key:"getJson",value:function(){var e=Object(a.a)({},Object(r.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),frequency:this.effectNode.frequency.value,q:this.effectNode.Q.value,type:this.effectNode.type});return e=this.saveParameterToJson(e,"cutoffParameter",this.cutoffParameter),e=this.saveParameterToJson(e,"qParameter",this.qParameter),e=this.saveParameterToJson(e,"typeParameter",this.typeParameter)}},{key:"fromJson",value:function(e,t){var i=Object(r.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t);return this.enable(e.enabled),Object(j.a)(this.qParameter,e.q,i),Object(j.a)(this.cutoffParameter,e.frequency,i),Object(j.a)(this.typeParameter,e.type,i),Object(a.a)({},i,this.loadParameterFromJson(e,"qParameter",this.qParameter,t),this.loadParameterFromJson(e,"cutoffParameter",this.cutoffParameter,t),this.loadParameterFromJson(e,"typeParameter",this.typeParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(S),E=function(e){Object(u.a)(n,e);var t=x(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Auto Filter",function(){return new d.a.AutoFilter(4*new d.a.Time("1m"))},e)).qParameter=new m.c("Q",r.effectNode.filter.Q,{min:0,max:20,unit:"",defaultValue:1}),r.registerParameter(r.qParameter),r.effectNode.start(),r.effectNode.wet.value=1,r.storedLFOTime=4*new d.a.Time("1m"),r.updateInitialValues(),r}return Object(s.a)(n,[{key:"syncable",value:function(){return!0}},{key:"start",value:function(){this.effectNode.start()}},{key:"stop",value:function(){this.effectNode.stop()}},{key:"toggle",value:function(e){}},{key:"getLFOTime",value:function(){return new d.a.Time(this.effectNode.frequency.value).toNotation()}},{key:"getStoredLFOTime",value:function(){return this.storedLFOTime}},{key:"setLFOTime",value:function(e){this.storedLFOTime=e,this.effectNode.frequency.value=e}},{key:"lowpass",value:function(){this.effectNode.filter.type="lowpass"}},{key:"hipass",value:function(){this.effectNode.filter.type="highpass"}},{key:"getFilterType",value:function(){return this.effectNode.filter.type}},{key:"getJson",value:function(){return Object(a.a)({},Object(r.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),frequency:this.effectNode.frequency.value,storedLFOTime:this.storedLFOTime,baseFrequency:this.effectNode.baseFrequency,octaves:this.effectNode.octaves,q:this.effectNode.filter.Q.value,filterType:this.effectNode.filter.type})}},{key:"fromJson",value:function(e,t){Object(r.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.enable(e.enabled),this.effectNode.filter.Q.value=e.q,this.effectNode.frequency.value=e.frequency,this.effectNode.baseFrequency=e.baseFrequency,this.effectNode.octaves=e.octaves,this.storedLFOTime="storedLFOTime"in e?e.storedLFOTime:e.frequency,this.effectNode.filter.type=e.filterType}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(S),T=function(e){Object(u.a)(n,e);var t=x(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Pan",function(){return new d.a.Panner},e)).panParameter=new p.a("Panning",r.effectNode.pan,function(e,t){return e.value=t},{min:-1,max:1,unit:"",defaultValue:0}),r.registerParameter(r.panParameter),r.updateInitialValues(),r}return Object(s.a)(n,[{key:"toggle",value:function(e){}},{key:"setValue",value:function(e){this.value=e,this.panParameter.normalizedSet(e)}},{key:"getJson",value:function(){return Object(a.a)({},Object(r.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),value:this.value})}},{key:"fromJson",value:function(e,t){Object(r.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t);var a=new n;return a.setValue(this.value),a}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEnginei,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(S),A={ReverbEffect:function(e){Object(u.a)(n,e);var t=x(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Reverb",function(){return new d.a.Freeverb},e)).roomSizeParameter=new m.b("Room Size",r.effectNode.roomSize),r.registerParameter(r.roomSizeParameter),r.dampeningParameter=new m.a("Dampening",r.effectNode.dampening,function(e,t){return e.value=t},{min:0,max:1e4}),r.registerParameter(r.dampeningParameter),r.updateInitialValues(),r}return Object(s.a)(n,[{key:"setRoomSize",value:function(e){this.roomSizeParameter.set(e)}},{key:"setDampening",value:function(e){this.dampening.set(e)}},{key:"getDampening",value:function(){return this.effectNode.dampening.value}},{key:"getRoomSize",value:function(){return this.effectNode.roomSize.value}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEnginei,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(){var e=Object(a.a)({},Object(r.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),roomSize:this.roomSizeParameter.get(),wet:this.wetParameter.get(),dampening:this.dampeningParameter.get()});return(this.roomSizeParameter.isConnectedToAnyModulator()||Object.keys(this.roomSizeParameter.patternToValue).length>0)&&(e.roomSizeParameter=this.roomSizeParameter.getJson()),(this.dampeningParameter.isConnectedToAnyModulator()||Object.keys(this.dampeningParameter.patternToValue).length>0)&&(e.dampeningParameter=this.dampeningParameter.getJson()),e}},{key:"fromJson",value:function(e,t){Object(r.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.name=e.name,this.enable(e.enabled),"roomSize"in e&&this.roomSizeParameter.set(e.roomSize),"wet"in e&&this.wetParameter.set(e.wet),"dampening"in e&&this.dampeningParameter.set(e.dampening),this.loadParameterFromJson(e,"roomSizeParameter",this.roomSizeParameter,t),this.loadParameterFromJson(e,"dampeningParameter",this.dampeningParameter,t)}}]),n}(S),FilterEffect:P,TremoloEffect:function(e){Object(u.a)(n,e);var t=x(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Tremolo",function(){return new d.a.Tremolo},e)).effectNode.start(),r.rateParameter=new m.a("Rate",r.effectNode.frequency,function(e,t){return e.value=t},{min:0,max:32,defaultValue:0}),r.spreadParameter=new m.a("Spread",r.effectNode,function(e,t){return e.spread=t},{min:0,max:360,defaultValue:180}),r.depthParameter=new m.b("Depth",r.effectNode.depth),r.registerParameter(r.depthParameter),r.registerParameter(r.rateParameter),r.registerParameter(r.spreadParameter),r.updateInitialValues(),r}return Object(s.a)(n,[{key:"setRate",value:function(e){this.effectNode.frequency.value=e}},{key:"setDepth",value:function(e){this.effectNode.depth.value=e}},{key:"getRate",value:function(){return this.effectNode.frequency.value}},{key:"getDepth",value:function(){return this.effectNode.depth.value}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEnginei,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(){var e=Object(a.a)({},Object(r.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),depth:this.depthParameter.get(),spread:this.spreadParameter.get(),rate:this.rateParameter.get()});return(this.depthParameter.isConnectedToAnyModulator()||Object.keys(this.depthParameter.patternToValue).length>0)&&(e.depthParameter=this.depthParameter.getJson()),(this.spreadParameter.isConnectedToAnyModulator()||Object.keys(this.spreadParameter.patternToValue).length>0)&&(e.spreadParameter=this.spreadParameter.getJson()),(this.rateParameter.isConnectedToAnyModulator()||Object.keys(this.rateParameter.patternToValue).length>0)&&(e.rateParameter=this.rateParameter.getJson()),e}},{key:"fromJson",value:function(e,t){Object(r.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.name=e.name,this.enable(e.enabled),this.depthParameter.set(void 0!==e.depth?e.depth:1),this.spreadParameter.set(void 0!==e.spread?e.spread:180),this.wetParameter.set(void 0!==e.wet?e.wet:1),this.rateParameter.set(void 0!==e.rate?e.rate:1),this.loadParameterFromJson(e,"depthParameter",this.depthParameter,t),this.loadParameterFromJson(e,"spreadParameter",this.spreadParameter,t),this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t)}}]),n}(S),AutoFilterEffect:E,ChorusEffect:function(e){Object(u.a)(n,e);var t=x(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Chorus",function(){return new d.a.Chorus},e)).rateParameter=new m.a("Rate",r.effectNode.frequency,function(e,t){e&&(e.value=t)},{min:0,max:32,defaultValue:.8}),r.registerParameter(r.rateParameter),r.depthParameter=new m.a("Depth",r.effectNode,function(e,t){return e.depth=t},{min:0,max:100,unit:"%",automatable:!1,defaultValue:.5}),r.registerParameter(r.depthParameter),r.updateInitialValues(),r}return Object(s.a)(n,[{key:"setRate",value:function(e){this.effectNode.frequency.value=e}},{key:"setDepth",value:function(e){this.effectNode.depth=e}},{key:"getRate",value:function(){return this.effectNode.frequency.value}},{key:"getDepth",value:function(){return this.effectNode.depth}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"dispose",value:function(){Object(r.a)(Object(f.a)(n.prototype),"dispose",this).call(this,!0)}},{key:"getJson",value:function(){var e=Object(a.a)({},Object(r.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(!0),depth:this.depthParameter.get(!0),rate:this.rateParameter.get(!0)});return e=this.saveParameterToJson(e,"depthParameter",this.depthParameter),e=this.saveParameterToJson(e,"rateParameter",this.rateParameter)}},{key:"fromJson",value:function(e,t){var i=Object(r.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t);return this.name=e.name,this.enable(e.enabled),Object(j.a)(this.wetParameter,e.wet,i),Object(j.a)(this.depthParameter,e.depth,i),Object(j.a)(this.rateParameter,e.rate,i),Object(a.a)({},i,this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t),this.loadParameterFromJson(e,"depthParameter",this.depthParameter,t))}}]),n}(S),PanEffect:T,Effect:S};t.a=A},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e,t,n,r,a){if(0===r||r/100<=Math.random())return n;if(!e)return n;var i=e.set(t,!0,!0);if(i){var o=i.id,s=i.value;n[o]=s}else n[e.id]=t;return n}},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(4),a=n(5),i=n(31),o=n(7),s=n(8),c=n(2),u=n(134),l=n(20),f=n(362),h=n(569);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var p=function(e){Object(o.a)(n,e);var t=d(n);function n(e){var a,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(r.a)(this,n),(a=t.call(this)).id=Object(l.uuid)(),a.zObject=e,o&&(a.zObject.effect=Object(i.a)(a)),a.subSequence=e.subSequence,a.sequencerEngine=a.subSequence.sequencerEngine,a.sequencerEngine.idToObject[a.id]=Object(i.a)(a),a.zObject.newAttribute("fill subpatch",!1),a}return Object(a.a)(n,[{key:"getParameters",value:function(){return[]}},{key:"fromJson",value:function(e,t){t||(this.id=e.id,this.sequencerEngine.idToObject[this.id]=this)}},{key:"getJson",value:function(){return{id:this.id}}}]),n}(Object(h.a)(Object(f.a)(Object(u.a)(function(){return function e(){Object(r.a)(this,e)}}()))))},,function(e,t,n){"use strict";var r=n(180),a=n(4),i=function e(t,n){Object(a.a)(this,e),this.event=t,this.topics=n;for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];this.data=i},o=n(5),s=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Object(a.a)(this,e),this.name=t,this.type=n,this.size=64*r}return Object(o.a)(e,[{key:"convertTo",value:function(e){if(void 0!==e&&null!==e)return this.type.convertTo(e)}},{key:"convertFrom",value:function(e){if(void 0!==e&&null!==e)return this.type.convertFrom(e)}}]),e}();n.d(t,"Z",function(){return c}),n.d(t,"Y",function(){return u}),n.d(t,"cb",function(){return l}),n.d(t,"U",function(){return f}),n.d(t,"db",function(){return h}),n.d(t,"eb",function(){return d}),n.d(t,"V",function(){return p}),n.d(t,"y",function(){return v}),n.d(t,"l",function(){return m}),n.d(t,"z",function(){return y}),n.d(t,"W",function(){return b}),n.d(t,"bb",function(){return g}),n.d(t,"fb",function(){return O}),n.d(t,"ib",function(){return j}),n.d(t,"M",function(){return k}),n.d(t,"o",function(){return w}),n.d(t,"q",function(){return x}),n.d(t,"r",function(){return S}),n.d(t,"s",function(){return P}),n.d(t,"e",function(){return E}),n.d(t,"n",function(){return T}),n.d(t,"c",function(){return A}),n.d(t,"C",function(){return M}),n.d(t,"B",function(){return R}),n.d(t,"L",function(){return C}),n.d(t,"K",function(){return N}),n.d(t,"x",function(){return I}),n.d(t,"f",function(){return q}),n.d(t,"Q",function(){return _}),n.d(t,"T",function(){return D}),n.d(t,"ab",function(){return F}),n.d(t,"d",function(){return L}),n.d(t,"u",function(){return B}),n.d(t,"t",function(){return z}),n.d(t,"p",function(){return J}),n.d(t,"jb",function(){return V}),n.d(t,"j",function(){return H}),n.d(t,"w",function(){return U}),n.d(t,"h",function(){return G}),n.d(t,"g",function(){return W}),n.d(t,"v",function(){return K}),n.d(t,"m",function(){return Q}),n.d(t,"R",function(){return Z}),n.d(t,"S",function(){return Y}),n.d(t,"b",function(){return $}),n.d(t,"X",function(){return X}),n.d(t,"A",function(){return ee}),n.d(t,"J",function(){return te}),n.d(t,"kb",function(){return ne}),n.d(t,"D",function(){return re}),n.d(t,"i",function(){return ae}),n.d(t,"I",function(){return ie}),n.d(t,"a",function(){return oe}),n.d(t,"N",function(){return se}),n.d(t,"P",function(){return ce}),n.d(t,"O",function(){return ue}),n.d(t,"E",function(){return le}),n.d(t,"F",function(){return fe}),n.d(t,"G",function(){return he}),n.d(t,"k",function(){return de}),n.d(t,"hb",function(){return pe}),n.d(t,"H",function(){return ve}),n.d(t,"gb",function(){return me});var c=new i("SampleTagged(bytes32,bytes32,uint32)",[new s("ipfsHash",r.j),new s("tag",r.c),new s("guildId",r.h)]),u=new i("SampleStyle(bytes32,bytes32,uint32)",[new s("ipfsHash",r.j),new s("style",r.c),new s("guildId",r.h)]),l=new i("SampleYear(bytes32,int16,uint32)",[new s("ipfsHash",r.j),new s("year",r.g),new s("guildId",r.h)]),f=new i("SampleCountry(bytes32,bytes32,uint32)",[new s("ipfsHash",r.j),new s("country",r.c),new s("guildId",r.h)]),h=new i("SampledYoutube(bytes32,bytes32,uint32)",[new s("ipfsHash",r.j),new s("videoId",r.m),new s("guildId",r.h)]),d=new i("SequenceCreated(address,bytes32,string)",[new s("user",r.a),new s("ipfsHash",r.j)],new s("title",r.n)),p=new i("SampleCreated(address,bytes32,string,uint32)",[new s("user",r.a),new s("ipfsHash",r.j),new s("guildId",r.h)],new s("title",r.n)),v=new i("NewNoteSequence(bytes32,bytes32)",[new s("sampleHash",r.j),new s("noteSequenceHash",r.j)]),m=new i("NewDiscogsSample(bytes32,uint256,bytes32,uint32)",[new s("sampleHash",r.j),new s("coverArtHash",r.j),new s("guildId",r.h)],new s("discogsId",r.o)),y=new i("NewNotesAggregation(bytes32,bytes32,bytes32,uint32,uint32,bytes32)",[new s("sampleHash",r.j),new s("noteA",r.l),new s("noteB",r.l)],new s("startTime",r.h),new s("endTime",r.h),new s("remainingNotes",r.k)),b=new i("SampleFavorited(address,bytes32)",[new s("user",r.a),new s("sampleHash",r.j)]),g=new i("SampleUnfavorited(address,bytes32)",[new s("user",r.a),new s("sampleHash",r.j)]),O=new i("SequenceEdited(address,bytes32,bytes32,bytes32,string)",[new s("user",r.a),new s("previousSequence",r.j),new s("newSequence",r.j)],new s("diff",r.j),new s("title",r.n)),j=new i("SequenceEdited(address,bytes32,bytes32,string,uint32)",[new s("user",r.a),new s("previousSequence",r.j),new s("newSequence",r.j)],new s("title",r.n),new s("bpm",r.h)),k=new i("PresetTagged(address,bytes32,bytes32,uint32)",[new s("contentHash",r.j),new s("tag",r.c),new s("guildId",r.h)],new s("user",r.a)),w=new i("NewGuild(address,uint32,string)",[new s("user",r.a),new s("guildId",r.h)],new s("name",r.n)),x=new i("NewGuildMemberRequest(address,address,uint32)",[new s("requester",r.a),new s("newMember",r.a),new s("guildId",r.h)]),S=new i("NewGuildMemberRequestAccepted(address,uint32)",[new s("newMember",r.a),new s("guildId",r.h)]),P=new i("NewGuildMemberRequestRejected(address,uint32)",[new s("newMember",r.a),new s("guildId",r.h)]),E=new i("GuildKeyEncrypted(address,uint32,bytes32)",[new s("user",r.a),new s("guildId",r.h),new s("ipfsHash",r.j)]),T=new i("NewEncryptedContent(address,bytes32,bytes32,int8,bytes32,bytes32[9],bytes32[6])",[new s("user",r.a),new s("newContent",r.j),new s("contentType",r.i)],new s("previousContent",r.j),new s("encryptedName",r.e),new s("encryptedContentKey",Object(r.d)(9),9),new s("publicKey",Object(r.d)(6),6)),A=new i("EncryptedContentShared(address,address,bytes32,bytes32[9],bytes32[6])",[new s("sharedWith",r.a),new s("creator",r.a),new s("contentHash",r.j)],new s("encryptedContentKey",Object(r.d)(9),9),new s("publicKey",Object(r.d)(6),6)),M=new i("NewPublicKey(address,bytes32[6])",[new s("user",r.a)],new s("publicKey",Object(r.d)(6),6)),R=new i("NewPreset(address,bytes32,uint32,bytes32,bytes32[9],bytes32[6])",[new s("user",r.a),new s("contentHash",r.j),new s("guildId",r.h)],new s("encryptedName",r.e),new s("encryptedContentKey",Object(r.d)(9),9),new s("publicKey",Object(r.d)(6),6)),C=new i("PresetSample(bytes32,bytes32,uint32)",[new s("contentHash",r.j),new s("sampleHash",r.j),new s("guildId",r.h)]),N=new i("PresetInstrumentType(bytes32,bytes32,uint32)",[new s("contentHash",r.j),new s("instrumentType",r.f),new s("guildId",r.h)]),I=new i("NewMonthlyIndex(bytes32,uint32,uint64)",[new s("month",r.o),new s("year",r.o)],new s("hash",r.j)),q=new i("New2DMapping(bytes32)",[new s("ipfsHash",r.j)]),_=new i("PublicMessageSent(address,address,bytes32,bytes32)",[new s("fromUser",r.a),new s("toUser",r.a),new s("referenceHash",r.j)],new s("messageHash",r.j)),D=new i("SampleCopyStrike(address,bytes32,bytes32)",[new s("user",r.a),new s("sampleHash",r.j),new s("referenceHash",r.j)]),F=new i("SampleTakenDown(bytes32)",[new s("sampleHash",r.j)]),L=new i("FoldersUpdated(address,bytes32)",[new s("user",r.a),new s("foldersHash",r.j)]),B=new i("NewIndex(uint32,bytes32)",[new s("guildId",r.h)],new s("indexHash",r.j)),z=new i("NewGuildSequence(address,bytes32,uint32,bytes32,bytes32,bytes32[9],bytes32[6])",[new s("user",r.a),new s("contentHash",r.j),new s("guildId",r.h)],new s("previousHash",r.j),new s("encryptedName",r.e),new s("encryptedContentKey",Object(r.d)(9),9),new s("publicKey",Object(r.d)(6),6)),J=new i("NewGuildClassification(uint32,bytes32)",[new s("guildId",r.h),new s("contentHash",r.j)]),V=new i("Transfer(address,address,uint256)",[new s("fromUser",r.a),new s("toUser",r.a)],new s("amount",r.h)),H=(new i("SequenceTagged(bytes32,bytes32,uint32)",[new s("ipfsHash",r.j),new s("tag",r.c),new s("guildId",r.h)]),new i("SequenceFavorited(bytes32,address,uint32)",[new s("ipfsHash",r.j),new s("user",r.a),new s("guildId",r.h)]),new i("SequenceStarred(bytes32,address,uint32)",[new s("ipfsHash",r.j),new s("user",r.a),new s("guildId",r.h)]),new i("SequenceUnfavorited(bytes32,address,uint32)",[new s("ipfsHash",r.j),new s("user",r.a),new s("guildId",r.h)]),new i("SequenceUnstarred(bytes32,address,uint32)",[new s("ipfsHash",r.j),new s("user",r.a),new s("guildId",r.h)]),new i("NewDataType(bytes32,string)",[new s("dataType",r.c)],new s("description",r.n))),U=new i("NewLinkType(bytes32,string)",[new s("linkType",r.c)],new s("description",r.n)),G=new i("NewAnnotationType(bytes32,string)",[new s("annotationType",r.c)],new s("description",r.n)),W=new i("NewAnnotation(bytes32,bytes32,bytes32,address)",[new s("annotationType",r.c),new s("data",r.j),new s("address",r.a)],new s("annotationData",r.c)),K=new i("NewLink(bytes32,bytes32,bytes32,address)",[new s("linkType",r.c),new s("fromData",r.j),new s("toData",r.j)],new s("address",r.a)),Q=(new i("NewMix(address,bytes32,bytes32,string,uint32)",[new s("user",r.a),new s("mixHash",r.j),new s("previousHash",r.j)],new s("title",r.n),new s("guildId",r.h)),new i("NewEffect(address,bytes32,bytes32,string,uint32)",[new s("user",r.a),new s("effectHash",r.j),new s("effectType",r.c)],new s("title",r.n),new s("guildId",r.h))),Z=new i("ReleaseInfo(bytes32,uint32,string,bytes32,bytes32)",[new s("artistName",r.c),new s("releaseId",r.h)],new s("releaseName",r.n),new s("coverArtHash",r.j),new s("releaseType",r.c)),Y=new i("SampleByArtist(bytes32,bytes32)",[new s("artistName",r.c),new s("ipfsHash",r.j)]),$=new i("ArtistInfo(bytes32,bytes32,string)",[new s("artistName",r.c),new s("linkType",r.c)],new s("link",r.n)),X=(new i("MidiCCParameter(bytes32,uint32,bytes32,address)",[new s("deviceName",r.c),new s("ccNumber",r.h),new s("parameterName",r.c)],new s("user",r.a)),new i("SampleInSequence(bytes32,bytes32)",[new s("sequenceHash",r.j),new s("sampleHash",r.j)])),ee=(new i("ListEdited(bytes32,bytes32,address,bytes32,uint32)",[new s("newContent",r.j),new s("previousContent",r.j),new s("user",r.a)],new s("title",r.c),new s("guildId",r.h)),new i("ListHighlighted(bytes32,address)",[new s("contentHash",r.j)],new s("user",r.a)),new i("ListUnhighlighted(bytes32,address)",[new s("contentHash",r.j)],new s("user",r.a)),new i("ListFavorited(bytes32,address)",[new s("contentHash",r.j)],new s("user",r.a)),new i("ListUnfavorited(bytes32,address)",[new s("contentHash",r.j)],new s("user",r.a)),new i("ListDeleted(bytes32,address)",[new s("contentHash",r.j),new s("user",r.a)]),new i("NewWallpaper(address,bytes32,bytes32)",[new s("user",r.a),new s("wallpaperHash",r.j),new s("thumbnailHash",r.j)]),new i("DefaultWallpaper(address,bytes32)",[new s("user",r.a),new s("wallpaperHash",r.j)]),new i("NewPack(address,bytes32,bytes32,bytes32)",[new s("user",r.a),new s("packHash",r.j),new s("previousHash",r.j)],new s("title",r.c))),te=new i("PackHasContent(bytes32,bytes32)",[new s("packHash",r.j),new s("contentHash",r.j)]),ne=new i("UserLeftGuild(uint256,address)",[new s("guildId",r.h)],new s("user",r.a)),re=new i("NewScript(address,bytes32,bytes32,bytes32)",[new s("user",r.a),new s("scriptHash",r.j),new s("scriptType",r.c)],new s("title",r.c)),ae=new i("NewCreatorProject(address,uint256,bytes32,uint256,string)",[new s("creator",r.a),new s("projectId",r.o),new s("contentHash",r.j)],new s("maxInvocations",r.o),new s("title",r.n)),ie=new i("NewTokenSeed(uint256,uint256,bytes32)",[new s("projectId",r.o),new s("tokenId",r.o)],new s("seedHash",r.c)),oe=(new i("ZoraProject(bytes32,uint256)",[new s("projectHash",r.j),new s("zoraId",r.o)]),new i("AccountAuthorized(address,address,string,uint8,bytes32,bytes32)",[new s("zequencerAddress",r.a),new s("walletAddress",r.a)],new s("message",r.n),new s("v",r.i),new s("r",r.e),new s("s",r.e))),se=(new i("PluginCreated(uint256,address,string)",[new s("tokenId",r.o),new s("creator",r.a)],new s("name",r.n)),new i("NewPluginVersion(uint256,uint256,bytes32,string)",[new s("tokenId",r.o),new s("versionNumber",r.o)],new s("pluginContentHash",r.j),new s("pluginMetadataURI",r.n)),new i("ProjectHasArrangement(bytes32)",[],new s("projectHash",r.j))),ce=(new i("ProjectBPM(bytes32,int16)",[],new s("projectHash",r.j),new s("bpm",r.o)),new i("ProjectVisuals(bytes32,bytes32)",[],new s("projectHash",r.j),new s("thumbnailhash",r.j))),ue=new i("ProjectUsesPreset(bytes32,bytes32)",[],new s("projectHash",r.j),new s("presetHash",r.j)),le=(new i("ProjectPatternsCount(bytes32,int8)",[],new s("projectHash",r.j),new s("patterns",r.o)),new i("NewSporeCreated(uint256,uint256,address,address,bytes32,bytes32)",[],new s("sporeId",r.o),new s("tokenId",r.o),new s("proxy",r.a),new s("creator",r.a),new s("sporeHash",r.j),new s("dataHash",r.j)),new i("NewChainCreated(uint256,bytes32,address,address,bytes32)",[],new s("chainId",r.o),new s("name",r.c),new s("proxy",r.a),new s("creator",r.a),new s("chainHash",r.j)),new i("NewSkin(uint256,bytes32)",[],new s("skinId",r.o),new s("imageHash",r.j))),fe=new i("NewSong(uint256,string,string,int16,int16,string)",[],new s("songId",r.o),new s("title",r.n),new s("artist",r.n),new s("bpm",r.g),new s("bpmDecimal",r.g),new s("key",r.n)),he=new i("NewStem(uint256,uint256,string,uint16,bool)",[],new s("songId",r.o),new s("stemId",r.o),new s("uri",r.n),new s("duration",r.o),new s("isLoop",r.b)),de=new i("NewDefaultSongConfiguration(uint256,uint256)",[],new s("songId",r.o),new s("configId",r.o)),pe=new i("SongConfigurationStem(uint256,uint256)",[],new s("configId",r.o),new s("stemId",r.o)),ve=new i("NewStemType(uint256,uint8)",[],new s("stemId",r.o),new s("stemType",r.o)),me=(new i("ZequencerDropCreated(address,address,uint64,uint104,string,string)",[new s("creator",r.a),new s("contractAddress",r.a),new s("editionSize",r.o)],new s("publicSalePrice",r.o),new s("name",r.n),new s("collectionImage",r.n)),new i("Sale(address,uint256,uint256,uint256)",[new s("to",r.a),new s("quantity",r.o),new s("pricePerToken",r.o)],new s("firstPurchasedTokenId",r.o)),new i("StemDeleted(uint256)",[new s("stemId",r.o)]),new i("SongDeleted(uint256)",[new s("songId",r.o)]),new i("StemAttribute(uint256,bytes32,bytes32)",[new s("stemId",r.o),new s("attributeType",r.c),new s("attributeValue",r.c)]),new i("SongAttribute(uint256,bytes32,bytes32)",[new s("songId",r.o),new s("attributeType",r.c),new s("attributeValue",r.c)]));new i("NewDropCreated(uint256,address)",[],new s("songId",r.o),new s("dropAddress",r.a))},,,function(e,t,n){"use strict";(function(e){var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(1025),u=n.n(c),l=n(301),f=n(359),h=(n(141),n(309)),d=(new XMLHttpRequest,"/ip4/3.17.26.249/tcp/4001/ipfs/QmeQRpfSrYcAaqkhNoArDyTUwyYiru2gJp4WY1WegQGjtR"),p=[85,110,105,118,101,114,115,97,108,32,83,101,113,101,117,110,99,101,115];window.httpV="http://www.zequencer.io:5001",window.httpsV="https://www.zequencer.io:5002";var v=new(function(){function t(){if(Object(o.a)(this,t),this.soundCache={},this.controllers=new Set,!window.isNFT){"http:"===window.location.protocol?(this.backupIpfs=new u.a("ipfs.infura.io","5001",{protocol:"https"}),window.isNFT?(this.centralIpfs=this.backupIpfs,this._centralIpfs=u()("www.zequencer.io","5001",{protocol:"http"})):(this.centralIpfs=u()("www.zequencer.io","5001",{protocol:"http"}),this._centralIpfs=this.centralIpfs)):window.isNFT?(this.centralIpfs=this.backupIpfs,this._centralIpfs=u()("www.zequencer.io","5002",{protocol:"https"})):(this.centralIpfs=u()("www.zequencer.io","5002",{protocol:"https"}),this._centralIpfs=this.centralIpfs),this.ipfs=this.centralIpfs;this.connectedLocally=!1,this.finishedTestingLocalConnection=!0}}return Object(s.a)(t,[{key:"restart",value:function(){}},{key:"getIPFSPrefix",value:function(){return this.connectedLocally?"http://localhost:5001":"http:"===window.location.protocol?window.httpV:"https:"===window.location.protocol?window.httpsV:void 0}},{key:"getHashUrl",value:function(e){return this.connectedLocally?"http://localhost:8080/ipfs/"+e:(window.location.protocol,"/ipfs/"+e)}},{key:"getPinnedHashes",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ipfs.refs.local();case 2:return t=e.sent,e.abrupt("return",t.map(function(e){return e.ref}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"findProvs",value:function(e){var t=this;return new Promise(function(n,r){t.ipfs.dht.findprovs(e,{maxNumProviders:1},function(e,t){n(t)})})}},{key:"connectToCentral",value:function(){try{this.ipfs.swarm.connect(d,function(e,t){}).catch(function(e){return console.log("error")})}catch(e){console.log("error connecting to ipfs")}}},{key:"keepSwarmConnectionAlive",value:function(){var e=this;try{this.ipfs.swarm.connect(d,function(e,t){}).catch(function(e){return console.log("error")})}catch(t){console.log("error connecting to ipfs")}setInterval(function(){if(window.sequencerEngine&&window.sequencerEngine.getSequenceId){var n=window.sequencerEngine.getSequenceId();if(window.sequencerEngine.store.getState().sequencer.isPlaying[n])return}try{e.ipfs.swarm.connect(d,function(e,t){}).catch(function(e){return console.log("error")})}catch(t){console.log("error connecting to ipfs")}},6e4)}},{key:"isConnectedLocally",value:function(){return this.connectedLocally}},{key:"addArrayBuffer",value:function(e,t){return this.addHelper(e,t)}},{key:"addArrayBufferAndSaveToDB",value:function(e,t){return this.addBlobAndSaveToDB(new Blob([new Uint8Array(e)]),t)}},{key:"addHelper",value:function(t){var n=this,r=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2?arguments[2]:void 0);void 0===r&&(r="hello");return new Promise(function(a,i){var o=n._centralIpfs||n.ipfs;o||(o="http:"===window.location.protocol?u()("www.zequencer.io","5001",{protocol:"http"}):u()("www.zequencer.io","5002",{protocol:"https"})),o.add({name:r,path:"hello",content:new e(t)},function(e,t){var n=t[0].hash;e?i(e):a(n)})})}},{key:"addBuffer",value:function(e){var t=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&arguments[2];return new Promise(function(n,r){var a=t.centralIpfs;a.add(e,function(e,t){if(e)r(e);else{var i=t[0].hash;a.pin.add(i),n(i)}})})}},{key:"addJson",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"LOCAL",a=arguments.length>2?arguments[2]:void 0;return new Promise(function(i,o){var s=n._centralIpfs||n.ipfs;s||(s="http:"===window.location.protocol?u()("www.zequencer.io","5001",{protocol:"http"}):u()("www.zequencer.io","5002",{protocol:"https"})),s.add(e.from(JSON.stringify(t)),function(e,t){if(e)o(e);else{var n=t[0].hash;s.pin.add(n),i(n)}}),"LOCAL"===r&&(s!==n.centralIpfs&&n.addJson(t,"UNIVERSAL",a).then(function(e){return i(e)}),n.addJson(t,"INFURA",a).then(function(e){return i(e)}))})}},{key:"getJson",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.restart(),new Promise(function(c,u){if(o)t.ipfs.cat(e,function(e,t){c(JSON.parse(t.toString("utf8")))});else if(e){n?t.centralIpfs:t.ipfs;var l=new AbortController;t.controllers.add(l);var f=l.signal;setTimeout(function(){l.abort(),t.controllers.delete(l),u()},r);var h="GET",d="https://zequencer.io/ipfs/"+e;if(window.isNFT&&!s)return h="GET",d=e,void fetch(d+".mp3",{signal:f,method:h}).then(function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:n=e.sent,c(n);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());if(window.isNFT&&!s)return c({});(new Date).getTime();fetch(d,{signal:f,method:h}).then(function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:return n=e.sent,c(n),e.abrupt("return");case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}else c({})})}},{key:"addBytesArray",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Uint8Array(t.length+p.length)).set(t,0),n.set(p,t.length),e.next=5,this.addHelper(n.buffer);case 5:return r=e.sent,this.ipfs.pin.add(r),e.abrupt("return",r);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"pin",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ipfs.pin.add(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addBlob",value:function(e,t){var n=this;return this.restart(),new Promise(function(r,a){var i,o=new FileReader,s=n;o.onload=function(){var e=this;i=this.result,s.addHelper(i,void 0,t).then(function(t){e.connectedLocally&&s.ipfs.pin.add(t),s.centralIpfs.pin.add(t),r(t)}).catch(function(e){return a(e)})},o.readAsArrayBuffer(e)})}},{key:"addBlobAndSaveToDB",value:function(e,t){}},{key:"converttoarraybuffer",value:function(e){return new Promise(function(t,n){var r=new r;r.onload=function(){t(this.result)},r.readasarraybuffer(e)})}},{key:"readAllChunks",value:function(e){var t=e.getReader(),n=[];return function e(){return t.read().then(function(t){var r=t.value;return t.done?n:(n.push(r),e())})}()}},{key:"clearCache",value:function(){this.soundCache={}}},{key:"preloadSound",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4e4,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise(function(){var o=Object(i.a)(a.a.mark(function i(o,s){var c;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t.soundCache[e]){a.next=6;break}return a.next=3,t.getSound(e,n,r);case 3:c=a.sent,Object(l.b)(c,e).then(function(t){t.error?o(t):Object(f.a)(t,e).then(function(e){o(e)})}).catch(function(e){o({error:"fuck"})}),t.soundCache[e]=c;case 6:case"end":return a.stop()}},i)}));return function(e,t){return o.apply(this,arguments)}}())}},{key:"getSound",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4e4,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n||(n=4e4),new Promise(function(o,s){if(t.soundCache&&t.soundCache[e])o(t.soundCache[e]);else{var c=new AbortController;t.controllers.add(c);var u=c.signal;setTimeout(function(){c.abort(),t.controllers.delete(c),s()},n);var l="GET",f="https://zequencer.io/ipfs/"+e;if(window.isNFT&&(f=e.includes("spores-stems.s3")?e:e+".mp3"),window.spores&&(f="https://zequencer.mypinata.cloud/ipfs/"+e),e.includes("http")&&(f=e),window.isNFT&&!r)return l="GET",f="https://zequencer.io/ipfs/"+e.slice("ipfs://".length),f=e.includes("spores-stems.s3")?e:e+".mp3",fetch(f,{signal:u,method:l}).then(function(){var n=Object(i.a)(a.a.mark(function n(r){var i,s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.arrayBuffer();case 2:i=n.sent,s=new Uint8Array(i),t.soundCache[e]=s,o(s);case 6:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}());if(window.isNFT&&!r)return o([]);(new Date).getTime();fetch(f,{signal:u,method:l}).then(function(){var e=Object(i.a)(a.a.mark(function e(n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(new Date).getTime(),e.next=3,n.arrayBuffer();case 3:return r=e.sent,(new Date).getTime(),i=t.processArray(new Uint8Array(r)),o(i),e.abrupt("return");case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.log("aborted")})}})}},{key:"arrayToBuffer",value:function(e){var t=new ArrayBuffer(e.length);return e.map(function(e,n){t[n]=e}),t}},{key:"cancel",value:function(){Array.from(this.controllers).forEach(function(e){return e.abort()})}},{key:"processArray",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]))return e;var t=e,n=this.findEnd(t,p);return-1!==n?t.slice(0,n):e.slice(0,e.length-1024)}},{key:"mergeArrays",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=0;for(var a in e)r+=e[a].length;var i=new Uint8Array(r-t),o=0;for(var s in e)0===o?(i.set(e[s].subarray(t),o),o+=e[s].length-t):(i.set(e[s],o),o+=e[s].length);if(!n)return i;var c=i,u=this.findEnd(c,p);return-1!==u?c.slice(0,u):i.slice(0,i.length-1024)}},{key:"findEnd",value:function(e,t){for(var n=e.length-1600,r=e.slice(n).values(),a=0,i=n;i<e.length;i++){if(r.next().value===t[a]){if(0==a&&(n=i),++a===t.length-1)return n}else a=0,n=i}return-1}},{key:"getAudioBuffer",value:function(e,t){var n=this;return this.restart(),new Promise(function(r,a){n.getSound(e).then(function(e){return t.decodeAudioData(h(e),function(e){r(e)},function(e,t,n){n&&a(n)})}).catch(function(e){a(e)})})}}]),t}());t.a=v}).call(this,n(110).Buffer)},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(143),s=function(){function e(){Object(a.a)(this,e)}return Object(i.a)(e,[{key:"getCopy",value:function(){var t=new e;return t.sequencerEngine=this.sequencerEngine,t.envelopesTrack=this.envelopesTrack,t.envelopeTrack=this.envelopeTrack,t.lfosTrack=this.lfosTrack,t.lfoTrack=this.lfoTrack,t.liveEffect=this.liveEffect,t.track=this.track,t.group=this.group,t.instrument=this.instrument,t.send=this.effect,t.effect=this.effect,t.midiEffect=this.midiEffect,t.subDevice=this.subDevice,t.macro=this.macro,t.formant=this.formant,t.oscillator=this.oscillator,t._subSequence=this._subSequence,t.zObject=this.zObject,t}},{key:"forZObject",value:function(e){return this.zObject=e,this}},{key:"forSequencerEngine",value:function(e){return this.sequencerEngine=e,this}},{key:"subSequence",get:function(){return this._subSequence?this._subSequence:void 0!==this.envelopesTrack?this.envelopesTrack.subSequence:void 0!==this.lfosTrack?this.lfosTrack.subSequence:void 0!==this.track?this.track.subSequence:void 0}},{key:"forEnvelopeTrack",value:function(e,t){return this.envelopeTrack=e,this.envelopesTrack=t,this}},{key:"forLFOTrack",value:function(e,t){return this.lfoTrack=e,this.lfosTrack=t,this}},{key:"forMacro",value:function(e){return this.macro=e,this}},{key:"forTrack",value:function(e){return this.track=e,this}},{key:"forGroup",value:function(e){return this.group=e,this}},{key:"forSend",value:function(e){return this.send=e,this}},{key:"forEffect",value:function(e){return this.effect=e,this}},{key:"forMidiEffect",value:function(e){return this.midiEffect=e,this}},{key:"forLiveEffect",value:function(e){return this.liveEffect=e,this}},{key:"forInstrument",value:function(e){return this.instrument=e,this}},{key:"forSubSequence",value:function(e){return this._subSequence=e,this}},{key:"forOscillator",value:function(e){return this.oscillator=e,this}},{key:"forSubDevice",value:function(e){return this.subDevice=e,this}},{key:"forFormant",value:function(e){return this.formant=e,this}},{key:"getEffectContext",value:function(){return void 0!==this.track?this.track:void 0!==this.group?this.group:void 0!==this.send?this.send:void 0}},{key:"getJson",value:function(){var e={},t=[];if(void 0!==this.track&&this.track.getTrackType&&this.track.getTrackType()===o.b&&(e=Object(r.a)({},e,{track:this.track.trackNumber,isInstrument:!0})),void 0!==this.track?(t=this.track.effects,e.track=this.track.trackNumber):void 0!==this.group?(t=this.group.effects,e.group=this.group.groupNumber):void 0!==this.send&&(t=this.send.effects,e.send=this.send.sendNumber),e.effect=-1,this.effect&&(t&&(e.effect=t.indexOf(this.effect),e.effectName=this.effect.name),this.subDevice&&this.effect.getSubDeviceIndex&&(e.subDevice=this.effect.getSubDeviceIndex(this.subDevice))),this.midiEffect&&this.track&&this.track.midiEffects&&(e.midiEffect=this.track.midiEffects.effects.indexOf(this.midiEffect),e.midiEffectName=this.midiEffect.name),this.liveEffect&&(e.liveEffect=this.track.liveEffects.effects.indexOf(this.liveEffect),e.liveEffectName=e.liveEffect.name),this.macro&&(e.macro=this.macro.id),this.instrument){e.isInstrument=!0;var n=void 0;this.subDevice&&(n=this.track.instrument.getSubDeviceIndex(this.subDevice)),e.subDevice=n,e.instrumentType=this.instrument.getInstrumentType&&this.instrument.getInstrumentType()}return e}},{key:"combineWith",value:function(e){return e.track&&(this.track=e.track),e.effect&&(this.effect=e.effect),e.subDevice&&(this.subDevice=e.subDevice),e.send&&(this.send=e.send),e._subSequence&&(this._subSequence=e._subSequence),this}}]),e}();t.a=s},function(e,t,n){"use strict";var r=n(108),a=n(4),i=n(5),o=n(143),s=n(1013),c=["#29FFFF","#5429FF","#FF29D0","#0AFF6C","#FFBA7B","#FFE600","#8FFF00","#9EF3FF","#A48DFF","#FF9AE9","#FF8D8D","#FF7A00","#C8FF82"],u={},l={},f=function(){function e(){Object(a.a)(this,e)}return Object(i.a)(e,[{key:"getColorForTrack",value:function(e){if(void 0===e)return this.getColorForHash(void 0);if(e.envelopesTrack)return this.getColorForHash(e.presetName||e.id);e.getTrackType()===o.c&&(e=e.tracks[0]&&e.tracks[0].track||e);var t=void 0!==e.sample&&void 0!==e.sample.getId()?e.sample.getId():e.presetName||e.instrument&&e.instrument.defaultSampler&&e.instrument.defaultSampler.sample.getId()||e.getName();if(e.isAudioTrack&&(t=e.id),e.getTrackType()===o.e&&(t=e.presetName||"MULTI FREEZE"),t in l)return l[t];var n=this.getColorForHash(t),r=this.saturate(n,4,void 0,50);return l[t]=r,r}},{key:"transparent",value:function(e,t){return e.slice(0,e.length-1)+", "+t+")"}},{key:"getColor",value:function(e){return c[e%c.length]}},{key:"getColorForHash",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:170;if("Empty Patch"===e)return"#fb1515";if("Synth"===e)return"#ff0471";if("External Instrument"===e)return"#7effb3";if("Resampled"===e)return"#ff1e00";if("breaks"===e||"drums"===e)return"#11ff64";for(var n=s(e),r=0;this.getBrightness(n)<t&&r<4;)n=this.brighten(n,1.4),r++;return n}},{key:"hashCode",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return t}},{key:"intToRGB",value:function(e){var t=(16777215&e).toString(16).toUpperCase();return"#"+"00000".substring(0,6-t.length)+t}},{key:"hueShift",value:function(e,t){var n=d(e);return h({h:n.h+t,s:n.s,l:n.l})}},{key:"warm",value:function(e){return h({h:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:141)-e,s:arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,l:50})}},{key:"compliment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=d(e),r=n.h;return 0===r&&r++,h({h:r+=10*t%255,s:n.s,l:n.l})}},{key:"saturate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0;if(e){if(e.startsWith("hsl")){var a=d(e),i=a.h,o=a.s,s=a.l;return s*=n,r&&(s=r),e=h({h:i,s:o=Math.min(o*t,100),l:s})}var c=function(e){var t=e.r,n=e.g,r=e.b;t/=255,n/=255,r/=255;var a=Math.min(t,n,r),i=Math.max(t,n,r),o=i-a,s=0,c=0,u=0;s=0==o?0:i==t?(n-r)/o%6:i==n?(r-t)/o+2:(t-n)/o+4;(s=Math.round(60*s))<0&&(s+=360);return u=(i+a)/2,c=+(100*(c=0==o?0:o/(1-Math.abs(2*u-1)))).toFixed(1),u=+(100*u).toFixed(1),{h:s,s:c,l:u}}(this.getRGB(e)),u=c.h,l=c.s,f=c.l;return f*=n,r&&(f=r),e=h({h:u,s:l=Math.min(l*t,100),l:f})}}},{key:"brighten",value:function(e,t){if(e.startsWith("hsl")){var n=d(e);return h(n=function(e,t){var n=e.h,r=e.s,a=e.l;return{h:n,s:r,l:a*t}}(n,t))}var r=u[e+"."+t];if(r)return r;var a=Math.min(255,Math.floor(parseInt(e.slice(1,3),16)*t)),i=Math.min(255,Math.floor(parseInt(e.slice(3,5),16)*t)),o=Math.min(255,Math.floor(parseInt(e.slice(5),16)*t));a=a.toString(16),i=i.toString(16),o=o.toString(16),1===a.length&&(a="0"+a),1===i.length&&(i="0"+i),1===o.length&&(o="0"+o);var s="#"+a+i+o;return u[e+"."+t]=s,s}},{key:"getBrightness",value:function(e){var t=this.getRGB(e);return.299*t.r+.587*t.g+.114*t.b}},{key:"rawHSLToHex",value:function(e){return p(e.h,e.s,e.l)}},{key:"hslToHex",value:function(e){var t=d(e);return p(t.h,t.s,t.l)}},{key:"getRGB",value:function(e){return{r:Math.floor(parseInt(e.slice(1,3),16)),g:Math.floor(parseInt(e.slice(3,5),16)),b:Math.floor(parseInt(e.slice(5),16))}}}]),e}();function h(e){return"hsl("+e.h+","+e.s+"%,"+e.l+"%)"}function d(e){var t=(e=e.substring(4)).split(","),n=Object(r.a)(t,3),a=n[0],i=n[1],o=n[2],s=i.indexOf("%");return i=i.substring(0,s),s=o.indexOf("%"),o=o.substring(0,s),{h:parseFloat(a),s:parseFloat(i),l:parseFloat(o)}}function p(e,t,n){n/=100;var r=t*Math.min(n,1-n)/100,a=function(t){var a=(t+e/30)%12,i=n-r*Math.max(Math.min(a-3,9-a,1),-1);return Math.round(255*i).toString(16).padStart(2,"0")};return"#".concat(a(0)).concat(a(8)).concat(a(4))}t.a=f},,,function(e,t,n){"use strict";(function(e){var r=n(1),a=n(11),i=n(42),o=n.n(i),s=n(56),c=n(4),u=n(5),l=n(162),f=n(1972),h=n(159),d=n(1656),p=n(1970),v=(n(1658),n(157)),m=n(149),y=n(1659),b=n(307),g=n(1660),O=n(1661),j=n(981),k=n(1662),w=n(1974),x=n(813),S=n(1663),P=n(1664),E=n(836),T=n(1665),A=n(1666),M=n(1667),R=n(142),C=(n(221),n(119)),N=n(982),I=n(1975),q=n(1668);function _(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var F=new b.a,L=new O.a,B=new x.a,z=new S.a,J=new P.a,V=new y.a,H=n(189);function U(e){for(var t=e.map(function(e){return W(e.ipfsHash)}),n=l.a.utils.padLeft("0x0",64),r=t.length;r<16;r++)t.push(n);for(var a=[],i=[],o=[],s=0;s<16;s++)if(void 0!==e[s]){var c=e[s].videoId;void 0===c||"0x00"===c||""===c?o.push(n):o.push(l.a.utils.padRight(l.a.utils.fromAscii(c),64));var u=e[s].coverArt;void 0===u?a.push(n):a.push(W(u)),void 0===e[s].discogsId?i.push(0):i.push(e[s].discogsId)}else a.push(n),i.push(0),o.push(n);for(var f=e.map(function(e){return l.a.utils.padRight(l.a.utils.fromAscii(e.title).slice(0,66),64)}),h=f.length;h<16;h++)f.push(n);for(var d=e.map(function(e){var t=e.tags.map(function(e){return l.a.utils.padRight(l.a.utils.fromAscii(e),64)});return Z(t)}),p=d.length;p<16;p++)d.push([n,n,n,n]);for(var v=e.map(function(e){var t=e.styles.map(function(e){return e?l.a.utils.padRight(l.a.utils.fromAscii(e),64):n});return Z(t)}),m=v.length;m<16;m++)v.push([n,n,n,n]);for(var y=e.map(function(e){return null===e.country||""===e.country?n:l.a.utils.padRight(l.a.utils.fromAscii(e.country),64)}),b=y.length;b<16;b++)y.push(n);for(var g=e.map(function(e){return null===e.year||void 0===e.year?0:e.year}),O=g.length;O<16;O++)g.push(0);return{sampleHashes:t,tags:d,titles:f,styles:v,years:g,countries:y,discogsIds:i,coverArts:a,videoIds:o}}function G(e){for(var t=l.a.utils.fromAscii(e),n=t.length;n<=65;n++)t+="0";return t}function W(e){var t=H.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}var K=new(function(){function e(){Object(c.a)(this,e),void 0!==l.a&&(this.web3=l.a,l.a.eth.net.isListening()&&(this.contract=new l.a.eth.Contract(F.abi,F.contractAddress),this.slicesContract=new l.a.eth.Contract(L.abi,L.contractAddress),this.favoritesContract=new l.a.eth.Contract(B.abi,B.contractAddress),this.slicesContractAddress=this.slicesContract.options.address,this.ethAddress=this.contract.options.address,this.favoritesContractAddress=this.favoritesContract.options.address,this.sequencesContract=new l.a.eth.Contract(J.abi,J.contractAddress),this.sequencesContractAddress=this.sequencesContract.options.address,this.indexContract=new l.a.eth.Contract(z.abi,z.contractAddress),this.indexContractAddress=this.indexContract.options.address,this.multiSamplesContract=V.getContract(l.a)),this.cachedTags=void 0,this.users=new E.a(l.a),this.crypto=new j.a(this),this.encryption=new k.a(l.a,this.crypto),this.guilds=new T.a(l.a,this.crypto,this.encryption),this.tokenizedSequences=new g.a(l.a),this.guildSequences=new M.a(l.a,this.guilds,this.encryption,this.crypto),this.samples2D=new f.a(l.a),this.messaging=new w.a(l.a),this.dmca=new I.a(l.a),this.folders=new d.a(l.a),this.resample=new q.a(l.a),this.presets=new N.a(l.a,this.crypto,this.guilds),this.xanadu=new p.a(l.a),this.guildSamples=new A.a(l.a))}return Object(u.a)(e,[{key:"postUserId",value:function(){var e=Object(s.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"guildId",get:function(){if(void 0===this.store)return 0;var e=this.store.getState().guilds.selectedGuild;return e?e.guildId:0}},{key:"isMetamaskInstalled",value:function(){return!1}},{key:"getUser",value:function(){var e=Object(s.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.getAccount();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getSoundsWithUserBlockNumber",value:function(){var e=Object(s.a)(o.a.mark(function e(t,n){var r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new R.a(this.ethAddress).from(C.V).select("ipfsHash").where("user",t).fromBlock(n).toBlock(n).where("guildId",this.guildId),e.next=3,r.executeQuery(!0);case 3:return a=e.sent,e.abrupt("return",Array.from(new Set(a.map(function(e){return e.ipfsHash}))));case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSoundsWithDiscogs",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new R.a(this.ethAddress).from(C.l).select("sampleHash").where("discogsId",t).where("guildId",this.guildId),e.next=3,n.executeQuery(!0);case 3:return r=e.sent,e.abrupt("return",Array.from(new Set(r.map(function(e){return e.sampleHash}))));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCoverArtForDiscogs",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new R.a(this.ethAddress).from(C.l).select("coverArtHash").where("discogsId",t),e.next=3,n.executeQuery(!0);case 3:return r=e.sent,e.abrupt("return",r[0]);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCachedTags",value:function(e,t){return e>this.cachedTags.length?[]:e+t>this.cachedTags.length?this.cachedTags.slice(e):this.cachedTags.slice(e,e+t)}},{key:"searchTags",value:function(e){var t=this;return new Promise(function(n,r){void 0!==t.cachedTags?(e=e.toLowerCase(),n(t.cachedTags.filter(function(t){return t.toLowerCase().includes(e)}))):n([])})}},{key:"getTagsForSound",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(C.Z).select("tag").where("ipfsHash",t).executeQuery(!0);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.tag}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getYearsForSound",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(C.cb).select("year").where("ipfsHash",t).executeQuery(!0);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.year}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getVideoIdForSound",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(C.db).select("videoId").where("ipfsHash",t).executeQuery(!0);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.videoId})[0]);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTitleForSound",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(C.V).select("title").where("ipfsHash",t).executeQuery(!0);case 2:return n=(n=e.sent).filter(function(e){return""!==e.title})[0],e.abrupt("return",void 0!==n?n.title:void 0);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUserNameForSound",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(C.V).select("user").where("ipfsHash",t).executeQuery(!0);case 2:if(void 0===(n=(n=e.sent).map(function(e){return e.user})[0])){e.next=9;break}return console.log("user = "+n),e.next=8,this.users.getUserName(n);case 8:return e.abrupt("return",e.sent);case 9:return e.abrupt("return",void 0);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCoverArtForSound",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(C.l).select("coverArtHash").where("sampleHash",t).executeQuery(!0);case 2:return n=(n=e.sent).filter(function(e){return""!==e.coverArtHash})[0],e.abrupt("return",void 0!==n?n.coverArtHash:void 0);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getFavoritesForSound",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(o.a.mark(function n(r,a){var i,s,c,u,l,f,d,p;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,h.a.getAccount();case 2:if(void 0!==(i=n.sent)){n.next=6;break}return r({userFavorited:[],othersFavorited:[]}),n.abrupt("return");case 6:return n.next=8,new R.a(t.favoritesContractAddress).from(C.W).select("user").where("sampleHash",e).executeQuery();case 8:return s=n.sent,n.next=11,new R.a(t.favoritesContractAddress).from(C.bb).select("user").where("sampleHash",e).executeQuery();case 11:c=n.sent,u=i.toLowerCase(),l=s.filter(function(e){return e.user===u}),f=s.filter(function(e){return e.user!==u}),d=c.filter(function(e){return e.user===u}),p=c.filter(function(e){return e.user!==u}),r({userFavorited:l.length-d.length,othersFavorited:f.length-p.length});case 18:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getOverallVotedRankings",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(o.a.mark(function t(n,r){var a,i,s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new R.a(e.favoritesContractAddress).from(C.W).select("sampleHash").executeQuery();case 2:return a=t.sent,t.next=5,new R.a(e.favoritesContractAddress).from(C.bb).select("sampleHash").executeQuery();case 5:i=t.sent,s={},a.forEach(function(e){var t=e.sampleHash;t in s?s[t]++:s[t]=1}),i.forEach(function(e){var t=e.sampleHash;t in s?s[t]--:s[t]=-1}),n(s);case 10:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getFavoritesForUser",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(o.a.mark(function t(n,r){var a,i,s,c,u,l,f,d,p,v,m,y,b;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.getAccount();case 2:if(void 0!==(a=t.sent)){t.next=6;break}return n([]),t.abrupt("return");case 6:return i=a.toLowerCase(),t.next=9,new R.a(e.favoritesContractAddress).from(C.W).select("sampleHash").where("user",i).executeQuery();case 9:return s=t.sent,t.next=12,new R.a(e.favoritesContractAddress).from(C.bb).select("sampleHash").where("user",i).executeQuery();case 12:for(p in c=t.sent,u=s.map(function(e){return e.sampleHash}),l=c.map(function(e){return e.sampleHash}),f={},d={},u)u[p]in f?f[u[p]]++:f[u[p]]=1;for(v in l)l[v]in d?d[l[v]]++:d[l[v]]=1;for(y in m=[],f)b=f[y],y in d&&(b-=d[y]),b>0&&m.push(y);n(m);case 22:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getSoundsWithVideo",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(C.db).select("ipfsHash").where("videoId",t).where("guildId",this.guildId).executeQuery();case 2:return n=e.sent,e.abrupt("return",Array.from(new Set(n.map(function(e){return e.ipfsHash}))));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithOrTags",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=new R.a(this.ethAddress).from(C.Z).select("ipfsHash").whereIn("tag",t),e.next=3,this.getGuildsWithAccess();case 3:return e.t1=e.sent,n=e.t0.whereIn.call(e.t0,"guildId",e.t1),e.next=7,n.executeQuery();case 7:return r=e.sent,e.abrupt("return",r.map(function(e){return e.ipfsHash}));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithTag",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,r=void 0,this.cache.useMonth&&(n=this.cache.toBlock,r=this.cache.fromBlock),e.t0=Array,e.t1=Set,e.next=7,this.getSoundsWithField("tag",t,C.Z,!1,r,n);case 7:return e.t2=e.sent,e.t3=new e.t1(e.t2),e.abrupt("return",e.t0.from.call(e.t0,e.t3));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithStyle",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,r=void 0,this.cache.useMonth&&(n=this.cache.toBlock,r=this.cache.fromBlock),e.abrupt("return",this.getSoundsWithField("style",t,C.Y,!1,r,n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithCountry",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,r=void 0,this.cache.useMonth&&(n=this.cache.toBlock,r=this.cache.fromBlock),e.abrupt("return",this.getSoundsWithField("country",t,C.U,!1,r,n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithYear",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,r=void 0,this.cache.useMonth&&(n=this.cache.toBlock,r=this.cache.fromBlock),e.abrupt("return",this.getSoundsWithField("year",t,C.cb,!1,r,n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithFieldParallel",value:function(){var e=Object(s.a)(o.a.mark(function e(t,n,r){var a,i,s,c,u,l,f,h,d,p,v,m=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=m.length>3&&void 0!==m[3]&&m[3],i=m.length>4?m[4]:void 0,s=m.length>5?m[5]:void 0,!(i+1>=s)){e.next=5;break}return e.abrupt("return",[]);case 5:for(8,c=s-i,u=[],l=1;l<=8;l++)f=i+Math.floor((l-1)*c/8),h=i+Math.floor(l*c/8),u.push(this.getSoundsWithField(t,n,r,a,f,h));return e.next=11,Promise.all(u);case 11:for(v in d=e.sent,p=[],d)p=p.concat(d[v]);return e.abrupt("return",Array.from(new Set(p)));case 15:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSoundsWithField",value:function(){var e=Object(s.a)(o.a.mark(function e(t,n,r){var a,i,s,c=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.length>3&&void 0!==c[3]&&c[3],i=c.length>4&&void 0!==c[4]?c[4]:37e5,s=c.length>5?c[5]:void 0,e.prev=3,e.next=6,this.getSoundsWithFieldHelper(t,n,r,a,i,s);case 6:return e.abrupt("return",e.sent);case 9:return e.prev=9,e.t0=e.catch(3),e.next=13,this.getSoundsWithFieldParallel(t,n,r,a,i,s);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}},e,this,[[3,9]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getGuildsWithAccess",value:function(){var e=Object(s.a)(o.a.mark(function e(){var t,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((new Date).getTime(),0===this.guildId){e.next=3;break}return e.abrupt("return",[this.guildId]);case 3:return e.t0=a.a,e.next=6,this.guilds.getGuildsWithAccess();case 6:e.t1=e.sent,(t=(0,e.t0)(e.t1)).sort(),e.t2=o.a.keys(t);case 10:if((e.t3=e.t2()).done){e.next=18;break}if(!((n=e.t3.value)>=1)){e.next=14;break}return e.abrupt("break",18);case 14:return e.next=16,this.guilds.getGuildKey(t[n]);case 16:e.next=10;break;case 18:return t.length>0&&(t=[t[0]]),(new Date).getTime(),e.abrupt("return",[].concat(Object(a.a)(t),[0]));case 21:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSoundsWithFieldHelper",value:function(e,t,n){var r=this,a=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:37e5),i=arguments.length>5?arguments[5]:void 0;a&&l.a.utils.toHex(a);return i&&l.a.utils.toHex(i),new Promise(function(){var c=Object(s.a)(o.a.mark(function s(c,u){var l,f,h;return o.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,r.getGuildsWithAccess();case 2:return l=o.sent,f=new R.a(r.ethAddress).from(n).select("ipfsHash").where(e,t).whereIn("guildId",l),i&&f.toBlock(i),a&&f.fromBlock(a),o.next=8,f.executeQuery(!0);case 8:h=o.sent,c(h.map(function(e){return e.ipfsHash}));case 10:case"end":return o.stop()}},s)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"getSoundsFromBlock",value:function(e,t){var n=this;return new Promise(function(){var r=Object(s.a)(o.a.mark(function r(a,i){var s,c,u,l,f,h;return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("getting guilds with access"),s=(new Date).getTime(),r.next=4,n.getGuildsWithAccess();case 4:return c=r.sent,u=(new Date).getTime(),l=u-s,console.log("getting guilds with access took %s ms",l),f=new R.a(n.ethAddress).from(C.V).select("ipfsHash").select("guildId").fromBlock(e).toBlock(t).limit(1e3).whereIn("guildId",window.installation?[0]:c),r.next=11,f.executeQuery(!0);case 11:h=r.sent,a(h.map(function(e){return e.ipfsHash}));case 13:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getBlockDate",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getting blockdate = ",t),e.next=3,l.a.eth.getBlock(t);case 3:if(null!==(n=e.sent)){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",new Date(1e3*n.timestamp));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getBlockNumberAtDate",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n,r,a,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.eth.getBlockNumber();case 2:return n=e.sent,r=500,e.next=6,l.a.eth.getBlock(n);case 6:a=e.sent,i=new Date(1e3*a.timestamp);case 8:if(!(t.getTime()<i.getTime())){e.next=16;break}return n-=r,e.next=12,l.a.eth.getBlock(n);case 12:a=e.sent,i=new Date(1e3*a.timestamp),e.next=8;break;case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllSounds",value:function(){var e=Object(s.a)(o.a.mark(function e(t,n){var r,a,i,s,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return 5e4,r=void 0,a=void 0,this.cache.useMonthly&&(r=this.cache.toBlock,a=this.cache.fromBlock),i=[],s=new Date,e.next=8,this.getSoundsFromBlock(a,r);case 8:return i=e.sent,c=new Date,c.getTime()-s.getTime(),e.abrupt("return",i);case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getOldSequence",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(o.a.mark(function e(r,a){var i,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new R.a(n.ethAddress).select("user").select("ipfsHash").select("title").where("ipfsHash",t).from(C.eb),e.next=3,i.executeQuery();case 3:s=e.sent,r(s.map(function(e){return{user:e.user,previousSequence:"0x0",newSequence:e.ipfsHash,diff:"0x0",title:e.title,blockNumber:e.blockNumber,edits:0}}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPrivateSequences",value:function(){var e=Object(s.a)(o.a.mark(function e(t,n){var r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.getAccount();case 2:if(void 0!==(r=e.sent)){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,this.encryption.getEncryptedSequenceIfAny(void 0,r,t,n);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNewSequence",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(o.a.mark(function e(a,i){var s,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=new R.a(n.sequencesContractAddress).select("user").select("previousSequence").select("newSequence").select("diff").select("title").where("newSequence",t).from(C.fb),e.next=3,s.executeQuery();case 3:c=e.sent,a(c.map(function(e){return Object(r.a)({},e,{edits:0})}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTokenizedSequence",value:function(){var e=Object(s.a)(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tokenizedSequences.getSequence(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSequence",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(o.a.mark(function e(r,a){var i,s,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getTokenizedSequence(t);case 2:if(!((i=e.sent).length>0)){e.next=6;break}return r(i[0]),e.abrupt("return");case 6:return e.next=8,n.getOldSequence(t);case 8:if(!((s=e.sent).length>0)){e.next=12;break}return r(s[0]),e.abrupt("return");case 12:return e.next=14,n.getNewSequence(t);case 14:if(!((c=e.sent).length>0)){e.next=18;break}return r(c[0]),e.abrupt("return");case 18:r("");case 19:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"favoriteSound",value:function(e){return new Promise(function(){var t=Object(s.a)(o.a.mark(function t(n,r){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.a.isLoggedIn()){t.next=3;break}return n(),t.abrupt("return");case 3:e=W(e),new v.a(m.e,"favoriteSample",[e]).execute().then(function(e){return n(e)});case 5:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"unfavoriteSound",value:function(e){return new Promise(function(){var t=Object(s.a)(o.a.mark(function t(n,r){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.a.isLoggedIn()){t.next=3;break}return n(),t.abrupt("return");case 3:e=W(e),new v.a(m.e,"unfavoriteSample",[e]).execute().then(function(e){return n(e)});case 5:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"saveNewSequence",value:function(e,t,n,r,a){var i=this;return new Promise(function(){var c=Object(s.a)(o.a.mark(function s(c,u){return o.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:i.tokenizedSequences.saveNewSequence(e,t,n,r,a);case 1:case"end":return o.stop()}},s)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"getNewSequences",value:function(e,t,n){var a=this;!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Promise(function(){var i=Object(s.a)(o.a.mark(function i(s,c){var u,l;return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return u=new R.a(a.sequencesContractAddress).select("user").select("previousSequence").select("newSequence").select("diff").select("title").fromBlock(t).toBlock(n).from(C.fb),void 0!==e&&u.where("user",e),i.prev=2,i.next=5,u.executeQuery();case 5:(l=i.sent).reverse(),l.sort(function(e,t){return t.blockNumber-e.blockNumber}),s(l.map(function(e){return Object(r.a)({},e,{edits:0})})),i.next=14;break;case 11:i.prev=11,i.t0=i.catch(2),s([]);case 14:case"end":return i.stop()}},i,null,[[2,11]])}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"getOldSequences",value:function(e,t,n){var r=this;return new Promise(function(){var a=Object(s.a)(o.a.mark(function a(i,s){var c,u;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=new R.a(r.ethAddress).select("user").select("ipfsHash").fromBlock(t).toBlock(n).select("title").from(C.eb),void 0!==e&&c.where("user",e),a.prev=2,a.next=5,c.executeQuery();case 5:(u=a.sent).reverse(),u=u.map(function(e){return{user:e.user,previousSequence:"0x0",newSequence:e.ipfsHash,diff:"0x0",title:e.title,blockNumber:e.blockNumber,edits:0}}),i(u),a.next=14;break;case 11:a.prev=11,a.t0=a.catch(2),i([]);case 14:case"end":return a.stop()}},a,null,[[2,11]])}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"getSequences",value:function(e,t,n){var r=this;return new Promise(function(){var t=Object(s.a)(o.a.mark(function t(n,a){var i,s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.tokenizedSequences.getSequences(e);case 2:return t.sent,t.next=5,r.getNewSequences(e);case 5:return i=t.sent,t.next=8,r.getOldSequences(e);case 8:s=t.sent,n(i.concat(s));case 10:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getHeadSequence",value:function(e,t){return t in e?this.getHeadSequence(e,e[t]):t}},{key:"collapseAllSequences",value:function(e){var t=this,n=new Set,a=[],i={};return e.forEach(function(o){if("0x0"!==o.previousSequence&&o.previousSequence!==o.newSequence&&(n.add(o.previousSequence),i[o.previousSequence]=o.newSequence),!n.has(o.newSequence)){var s=t.getEditsForSequence(o.newSequence,e);a.push(Object(r.a)({},o,{edits:s.length-1}))}}),a}},{key:"getEditsForSequence",value:function(e,t){for(var n=[],r=this.getPreviousSequence(e,t);void 0!==r;){n.push(r);var a=this.getPreviousSequence(r.previousSequence,t);if(void 0===a||a.newSequence===r.newSequence)break;r=a}return n}},{key:"getPreviousSequence",value:function(e,t){var n=void 0;for(var r in t)t[r].newSequence===e&&(n=t[r]);return n}},{key:"tagSample",value:function(){var e=Object(s.a)(o.a.mark(function e(t,n){var r,a=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:0,e.abrupt("return",new Promise(function(){var e=Object(s.a)(o.a.mark(function e(a,i){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=W(t),n=G(n),new v.a(m.i,"setSampleTag",[t,n,r]).execute().then(function(){return a()});case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newSampleWithMetadata",value:function(){var e=Object(s.a)(o.a.mark(function e(t,n,r,a,i,c,u){var f,h=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f=h.length>7&&void 0!==h[7]?h[7]:this.guildId,e.abrupt("return",new Promise(function(){var e=Object(s.a)(o.a.mark(function e(s,h){var d,p;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d=l.a.utils.padLeft("0x0",64),void 0===a&&(a=[]),a.length<4)for(p=a.length;p<4;p++)a.push(null);a=a.map(function(e){return null===e?d:l.a.utils.fromAscii(e)}),i=i.map(function(e){return null===e?d:l.a.utils.fromAscii(e)}),c=null===c?d:l.a.utils.fromAscii(c),r=null===r?d:l.a.utils.fromAscii(r),t=W(t),new v.a(m.i,"newSampleWithMetadata",[t,n,r,a,i,c,null===u?0:u,0,d,f]).execute().then(function(){return s()});case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,o,s){return e.apply(this,arguments)}}()},{key:"splitArray",value:function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}},{key:"newEncryptedSamples",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n,r,a=this,i=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:this.guildId,r=i.length>2?i[2]:void 0,e.abrupt("return",new Promise(function(){var e=Object(s.a)(o.a.mark(function e(i,s){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("new encrypted samples"),a.splitArray(t,16).forEach(function(e){return a.newEncryptedSamples16(e,n,r)});case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newEncryptedSamples16",value:function(e,t,n){return new Promise(function(){var r=Object(s.a)(o.a.mark(function r(a,i){var s;return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:s=U(e),console.log("arguments=",s),new v.a(m.i,"newEncryptedSamples",[s.sampleHashes,s.titles,s.videoIds,s.coverArts,s.discogsIds,s.tags,s.styles,s.countries,s.years,t,n.convertForEthereum(),n.getPublicKeyAsBytes32()]).execute().then(function(){return a()});case 3:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"newSamplesWithMetadata",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n,r=this,a=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:this.guildId,e.abrupt("return",new Promise(function(){var e=Object(s.a)(o.a.mark(function e(a,i){var s,c,u,l,f;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s=r.splitArray(t,16),c=0,u=_(s),e.prev=3,u.s();case 5:if((l=u.n()).done){e.next=12;break}return f=l.value,console.log("uploading samples chunk %s out of %s",c++,s.length),e.next=10,r.newSamplesWithMetadata16(f,n);case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),u.e(e.t0);case 17:return e.prev=17,u.f(),e.finish(17);case 20:case"end":return e.stop()}},e,null,[[3,14,17,20]])}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newSamplesWithMetadata16",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n,r=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:this.guildId,e.abrupt("return",new Promise(function(){var e=Object(s.a)(o.a.mark(function e(r,a){var i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=U(t),console.log("new samples with metadata",t,i),console.log("args =",i),new v.a(m.i,"newSamplesWithMetadata",[i.sampleHashes,i.titles,i.videoIds,i.coverArts,i.discogsIds,i.tags,i.styles,i.countries,i.years,n]).execute().then(function(){return r()});case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}());t.a=K;var Q=l.a.utils.padLeft("0x0",64),Z=function(e){for(;e.length<4;)e.push(Q);return e.slice(0,4)}}).call(this,n(110).Buffer)},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return s});var r=n(1),a=(n(20),n(23));function i(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n.depthParameter;if(o(n)){var i=Object(r.a)({},e);return i[t]=n.getJson(a),i}return e}var o=function(e,t){return e.isConnectedToAnyModulator()||Object.keys(e.patternToValue).length>0||Object.keys(e.paletteToValue).length>0||Object.keys(e.stepToValue).length>0||e.mixAutomation.automations.length>0||e.automations&&e.automations.length>0||e.hasMacro||e.depthParameter||e.isMapped||e.higherOrdered||t};function s(e,t,n,r,i){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6?arguments[6]:void 0;if(0===s||s/100<=Math.random())return e;if(t in e){c(e[t],n);var u=n.fromJson(e[t],r,i);if(o)return u;(r=r||n.sequencerEngine)&&r.store.dispatch(Object(a.xb)(u))}else n.disconnectFromAllModulators(),n.resetMinMax();return{}}var c=function(e,t){var n=t.lfos.filter(function(t){return!e.lfos||!e.lfos.includes(t.number-1)});e.lfos||(n=t.lfos),n.length>0&&console.log("LFOS to kill for parameter",t.name,n),n.forEach(function(e){return t.disconnectFromLFO(e)});var r=t.envelopes.filter(function(t){return!e.envelopes||!e.envelopes.includes(t.number-1)});e.envelopes||(r=t.envelopes),r.forEach(function(e){return t.disconnectFromEnvelope(e)}),t.keyScaling&&!e.keyScaling&&t.disableKeyScaling()}},function(e,t,n){"use strict";n.d(t,"c",function(){return d}),n.d(t,"a",function(){return p}),n.d(t,"b",function(){return v});var r=n(1),a=n(108),i=n(109),o=n(138),s=n(239),c=n(281),u=n(163),l=n(156),f=n(147),h=(n(314),n(43),[o.b,o.d,o.e,o.f]);Object(i.a)("gl.abs",{x:""},"Creates GLSL expression calculating absolute value of inlet",function(){return 1},{inletTypes:[Object(o.k)("float","vec2","vec3","vec4")],type:"float",tags:"GLSL",inlets:1});Object(i.a)("gl.mix",{a:"",b:"","mix amt":""},"Creates GLSL expression calculating mix interpolation between inlets",function(){return 1},{inletTypes:[Object(o.k)("float","vec4"),Object(o.k)("float","vec4"),"float"],type:function(){return arguments.length<=0?void 0:arguments[0]},isHot:!0,tags:"GLSL",inlets:3});Object(i.a)("gl.rainbow",{x:""},"Creates GLSL expression calculating rainbow value of inlet",function(){return 1},{tags:"GLSL",inlets:1});Object(i.a)("gl.exp",{x:""},"Creates GLSL expression calculating absolute value of inlet",function(){return 1},{inletTypes:["float"],type:"float",tags:"GLSL",inlets:1});Object(i.a)("gl.min",{},"Creates GLSL expression calculating min of inlets",function(){return 1},{inletTypes:["float","float"],type:"float",tags:"GLSL",isHot:!0,inlets:2});Object(i.a)("gl.max",{},"Creates GLSL expression calculating max of inlets",function(){return 1},{inletTypes:Object(o.l)(o.k.apply(void 0,h)),type:s.d,isHot:!0,inlets:2});Object(i.a)("gl.mod",{},"Creates a GLSL expression calculating the modulo of inlets",function(){return 1},{inletTypes:[o.k.apply(void 0,h),"float"],type:s.d,tags:"GLSL",isHot:!0,inlets:2});Object(i.a)("gl.clamp",{a:"",b:""},"Creates GLSL expression clamping left-inlet number between 2nd and 3rd inlet",function(){return 1},{inletTypes:["float","float","float"],type:"float",isHot:!0,inlets:3,tags:"GLSL"});Object(i.a)("gl.scale",{value:"",min1:"",max1:"",min2:"",max2:""},"",function(){return 1},{inlets:5,inletTypes:["float","float","float","float","float"],type:"float",isHot:!0});var d={"gl.scale":function(e,t,n,r,i){return e.needsHotReload=!0,e.typed(Object(l.a)(function(e){var o=Object(u.a)(e,t,n,r,i).map(v),s=Object(a.a)(o,5),c=s[0],l=s[1],f=s[2],h=s[3],d=s[4];return"".concat(h," + (").concat(d," - ").concat(h,")*(").concat(c," - ").concat(l,")/(").concat(f," - ").concat(l,")")},t,n,r,i))},"gl.abs":function(e){return e.needsHotReload=!0,e.typed(Object(c.b)(Object(l.a)(function(t){var n=Object(u.a)(t);return e.flash(),"abs("+v(n[0])+")"}),function(e){return Math.abs(e)}))},"gl.min":function(e,t){return e.needsHotReload=!0,e.typed(Object(c.b)(Object(l.a)(function(n){var r=Object(u.a)(n,t);return e.flash(),"min(".concat(r[0],", ").concat(r[1],")")},t),function(e,t){return Math.min(e,t)}))},"gl.max":function(e,t){return e.needsHotReload=!0,e.typed(Object(c.b)(Object(l.a)(function(n){var r=Object(u.a)(n,t);return e.flash(),"max(".concat(v(r[0]),", ").concat(v(r[1]),")")},t),function(e,t){return Math.max(e,t)}))},"gl.mod":function(e,t){return e.needsHotReload=!0,e.typed(Object(c.b)(Object(l.a)(function(n){var r=Object(u.a)(n,t);return e.flash(),"mod(".concat(v(r[0]),", ").concat(v(r[1]),")")},t),function(e,t){return Object(f.a)(e,t)}))},"gl.clamp":function(e,t,n){return e.needsHotReload=!0,e.typed(Object(l.a)(function(r){var a=Object(u.a)(r,t,n);return e.flash(),"clamp(".concat(v(a[0]),", ").concat(v(a[1]),", ").concat(v(a[2]),")")},t,n))},"gl.exp":function(e){return e.needsHotReload=!0,e.typed(Object(l.a)(function(t){var n=Object(u.a)(t);return e.flash(),"exp("+v(n[0])+")"}))},"gl.rainbow":function(e){return e.needsHotReload=!0,Object(l.a)(function(t){var n=Object(u.a)(t);return e.flash(),"rainbow("+v(n[0])+")"})},"gl.mix":function(e,t,n){return e.needsHotReload=!0,e.typed(Object(c.b)(Object(l.a)(function(r){var i=Object(u.a)(r,t,n).map(v),o=Object(a.a)(i,3),s=o[0],c=o[1],l=o[2];return e.flash(),"mix(".concat(s,", ").concat(c,", ").concat(l,")")},t,n),function(e,t,n){return n*e+(1-n)*t}))}},p=function(){for(var e={},t={},n={},a={},i=[],o=void 0,s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];for(var l=0,f=c;l<f.length;l++){var h=f[l];"function"===typeof h&&(h=h());var d=(h=void 0===h?{}:h).uniforms||{};e=Object(r.a)({},e,d);var p=h.functions||{};n=Object(r.a)({},n,p);var v=h.closure||{};t=Object(r.a)({},t,v),h.frames&&(o=h.frames),h.variables&&(a=Object(r.a)({},a,h.variables)),i.push(h.code||h||"0.0")}return{codes:i,uniforms:e,variables:a,functions:n,closure:t,frames:o}},v=function(e){return"object"===typeof e?"1.0":"bang"===e||void 0===e?"1.0":e.toFixed?e.toFixed(3):e}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"i",function(){return a}),n.d(t,"q",function(){return i}),n.d(t,"g",function(){return o}),n.d(t,"b",function(){return s}),n.d(t,"j",function(){return c}),n.d(t,"r",function(){return u}),n.d(t,"n",function(){return l}),n.d(t,"l",function(){return f}),n.d(t,"k",function(){return h}),n.d(t,"p",function(){return d}),n.d(t,"h",function(){return p}),n.d(t,"c",function(){return v}),n.d(t,"f",function(){return m}),n.d(t,"o",function(){return y}),n.d(t,"d",function(){return b}),n.d(t,"m",function(){return g}),n.d(t,"e",function(){return O});var r="bang",a="scale",i="trigger-routing",o="reset",s="cycle-restart",c="snapshot-changed",u="use-snapshot",l="tick",f="stop",h="start",d="trigger",p="rules",v="figures",m="params",y="tidals",b="grid-operation",g="swap-min-max",O="nft"},,,function(e,t,n){"use strict";n.d(t,"A",function(){return r}),n.d(t,"m",function(){return a}),n.d(t,"J",function(){return i}),n.d(t,"G",function(){return o}),n.d(t,"K",function(){return s}),n.d(t,"I",function(){return c}),n.d(t,"l",function(){return u}),n.d(t,"j",function(){return l}),n.d(t,"f",function(){return f}),n.d(t,"y",function(){return h}),n.d(t,"i",function(){return d}),n.d(t,"g",function(){return p}),n.d(t,"h",function(){return v}),n.d(t,"d",function(){return m}),n.d(t,"e",function(){return y}),n.d(t,"b",function(){return b}),n.d(t,"z",function(){return g}),n.d(t,"n",function(){return O}),n.d(t,"c",function(){return j}),n.d(t,"E",function(){return k}),n.d(t,"a",function(){return w}),n.d(t,"w",function(){return x}),n.d(t,"x",function(){return S}),n.d(t,"C",function(){return P}),n.d(t,"v",function(){return E}),n.d(t,"B",function(){return T}),n.d(t,"D",function(){return A}),n.d(t,"H",function(){return M}),n.d(t,"F",function(){return R}),n.d(t,"o",function(){return C}),n.d(t,"s",function(){return N}),n.d(t,"r",function(){return I}),n.d(t,"q",function(){return q}),n.d(t,"t",function(){return _}),n.d(t,"p",function(){return D}),n.d(t,"k",function(){return F}),n.d(t,"u",function(){return L});var r="PLAYHEAD_DIRECTION_BUTTON",a="MODULATOR_CONTROL",i="TRACK_PIANO_ROLL_BUTTON",o="TRACK_ADD_STEPS_BUTTON",s="TRACK_REMOVE_STEPS_BUTTON",c="TRACK_MIDI_DROPDOWN",u="LFO_TOGGLE_BUTTON",l="ENVELOPE_TOGGLE_BUTTON",f="EFFECT_PARAMETER",h="PARAMETER_VALUE",d="EFFECT_TOGGLE_BUTTON",p="EFFECT_PRESETS_BUTTON",v="EFFECT_RETURN_PRESETS_BUTTON",m="EFFECT_COLLAPSE_BUTTON",y="EFFECT_DELETE_BUTTON",b="CURRENT_PATTERN_BUTTON",g="PATTERN_BUTTON",O="NEW_PATTERN_BUTTON",j="DELETE_PATTERN_BUTTON",k="RESOLUTION_DROPDOWN",w="ARRANGEMENT_LOOP_BUTTON",x="PARAMETERIZER_FACTOR",S="PARAMETERIZER_OFFSET",P="PROBABILITY",E="PARAMETERIZER_DROPDOWN",T="PLAY_MIX_BUTTON",A="RECORD_MIX_BUTTON",M="TRACK_LENGTH_BUTTON",R="SYNTH_ENVELOPE",C="PADS_DELETE_BUTTON",N="PADS_SLOT_EMPTY",I="PADS_SLOT",q="PADS_MUTES_BUTTON",_="PADS_WAVEFORM_BUTTON",D="PADS_LENGTH_BUTTON",F="GO_TO_PAD_SEQUENCER",L="PAD_FX"},function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(4),o=n(5),s=n(7),c=n(8),u=n(2),l=n(136),f=n(238),h=n(109),d=n(211),p=n(445);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=n(259),y=n(20);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var g=function(e){Object(s.a)(n,e);var t=b(n);function n(e,r,a,o,s){var c;return Object(i.a)(this,n),(c=t.call(this)).id=Object(y.uuid)(),c.sourceNode=r,c.destNode=o,c.sourceType=e,c.sourceId=r.id,c.destType=a,c.destId=o.id,c.action=s,c._sourceType=c.getFullType(e,c.sourceId),c.reader=Object(m.a)(c._sourceType),s&&Object(l.e)(c._sourceType,s),c.segmentation=void 0,c}return Object(o.a)(n,[{key:"id",get:function(){return this._id},set:function(e){this._id=e,window.sequencerEngine.idToEdge[e]=this}},{key:"segment",value:function(){this.segmentation=!0,this.destNode.updateMessagingRedux()}},{key:"getJson",value:function(){return{id:this.id,sourceEl:this.getFullType(this.sourceType,this.sourceId),segmentation:this.segmentation,destEl:this.getFullType(this.destType,this.destId),sourceType:this.sourceType,sourceId:this.sourceId,destType:this.destType,destId:this.destId,sourceWindowId:this.sourceNode.zObject?this.sourceNode.zObject.id:this.sourceNode.id,destWindowId:this.destNode.zObject?this.destNode.zObject.id:this.destNode.id}}},{key:"dispose",value:function(){Object(l.g)(this._sourceType,this.action),this.reader(!0)}}]),n}(function(e){Object(s.a)(n,e);var t=v(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getFullType",value:function(e){return e+"."+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.id)}}]),n}(function(){return function e(){Object(i.a)(this,e)}}())),O=n(23);function j(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var x=[];window.bulkCalled=0,window.notBulkCalled=0;t.a=function(e){return function(e){Object(s.a)(n,e);var t=w(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).inlets={},e.outlets={},e.numInlets=0,e.numOutlets=0,e.messageSubscribers={},e}return Object(o.a)(n,[{key:"newInlet",value:function(e,t,n){this.inlets[e]={action:Object(f.b)(t,e,n,this),type:n,connections:[]},this.numInlets++,this.subSequence&&this.subSequence.hasInstances&&this.subSequence.onChange()}},{key:"newOutlet",value:function(e,t){this.outlets[e]={connections:[],type:t,actions:[]},this.numOutlets++,this.subSequence&&this.subSequence.hasInstances&&this.subSequence.onChange()}},{key:"bang",value:function(){}},{key:"isInletConnected",value:function(e){return!!this.inlets[e]&&this.inlets[e].connections.length>0}},{key:"isOutletConnected",value:function(e){for(var t in this.getConnectedOutlets(e))return!0;return!1}},{key:"getConnectedInlets",value:function(e){return this.inlets[e]?this.inlets[e].connections:x}},{key:"getConnectedOutlets",value:function(e){return this.outlets[e]?this.outlets[e].connections:x}},{key:"connectInlet",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5?arguments[5]:void 0;if(!t.outlets[n]&&(n=Object.keys(t.outlets)[0],!t.outlets[n]))return{};if(!this.inlets[e])return{};var o=new g(n,t,e,this,this.inlets[e].action);if(o.segmentation=i,r&&(o.id=r),this.inlets[e].connections.some(function(r){return r.sourceNode===t&&r.sourceType===n&&r.destType===e}))return{};this.inlets[e].connections.push(o),t.outlets[n].connections.push(o),t.needsStart;var s="gl.uniform"===t.name||t.attributes&&t.attributes["glsl uniform"];return this.needsHotReload&&(s||this.sequencerEngine&&!this.sequencerEngine.isLoading)&&(this.args&&(this.previousArgs=void 0),t.args,Object(p.a)(this),t.args),this.subSequence.propagate(Object(d.l)(t,this,n,e)),this.updateMessagingRedux(a)}},{key:"deleteConnection",value:function(e){var t=e.destType,n=e.sourceType,r=e.sourceNode;if(this.inlets&&this.inlets[t]&&(this.inlets[t].connections=this.inlets[t].connections.filter(function(t){return t!==e})),r.outlets&&r.outlets[n]&&(r.outlets[n].connections=r.outlets[n].connections.filter(function(t){return t!==e}),r.outlets[n].connections=r.outlets[n].connections),e.dispose(),this.updateMessagingRedux(),this.needsHotReload&&(this.args&&this.previousArgs&&(this.args=this.previousArgs),Object(p.a)(this)),r.needsHotReload&&Object(p.a)(r),this.dispatch&&this.dispatch(Object(O.wd)(void 0)),this.needsDisconnect&&r.function){var a=parseFloat(t);isNaN(a)?this.onInputMessage(["disconnect",r.function(["node"])]):this.onArg(a,[["disconnect",r.function(["node"])]])}}},{key:"disconnectInlet",value:function(e,t,n){var r=this.inlets[e].connections.find(function(r){return r.sourceNode===t&&r.destType===e&&r.sourceType===n});this.deleteConnection(r),this.subSequence.propagate(Object(d.m)(r.sourceNode,r.destNode,r.sourceType,r.destType))}},{key:"updateMessagingRedux",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(window.isNFT)return{};var e={};for(var t in this.inlets){this.inlets[t].readers;e[this.getFullType(t)]=this.inlets[t].connections.map(function(e){return e.getJson()})}window.notBulkCalled++;var n=this.subSequence;if(this.track&&this.track.subSequence&&(n=this.track.subSequence),this.sequencerEngine&&this.sequencerEngine.isLoading)this.sequencerEngine.bulkConnections[n.id]=Object(a.a)({},this.sequencerEngine.bulkConnections[n.id],e);else if(n){var r=n.state.windows.inletConnections[n.id]||{};n.dispatch(Object(O.Mb)(n.id,Object(a.a)({},r,e)))}}},{key:"clearMessagingRedux",value:function(){var e=[];for(var t in this.inlets){var n=this.getFullType(t);e.push(n)}var r=this.subSequence;if(this.track&&this.track.subSequence&&(r=this.track.subSequence),r){var i=r.state.windows.inletConnections[r.id]||{};i=Object(a.a)({},i);var o,s=j(e);try{for(s.s();!(o=s.n()).done;){delete i[o.value]}}catch(c){s.e(c)}finally{s.f()}r.dispatch(Object(O.Mb)(r.id,i))}}},{key:"getFullType",value:function(e){return e+"."+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.id)}},{key:"sendMessage",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=this.outlets[e];if(a){a.actions&&a.actions.forEach(function(e){return e.apply(void 0,n)});var i,o=j(a.connections);try{for(o.s();!(i=o.n()).done;){var s=i.value,c=(s.destNode,s.action);c&&c(n)}}catch(u){o.e(u)}finally{o.f()}}}},{key:"receiveMessage",value:function(e){if(!this.inlets[e])return x;var t,n=this.inlets[e].connections,a=x,i=j(n);try{for(i.s();!(t=i.n()).done;){var o=t.value.reader();o.length>0&&(a=a===x?o:[].concat(Object(r.a)(a),Object(r.a)(o)))}}catch(s){i.e(s)}finally{i.f()}return a}},{key:"disposeMessaging",value:function(){for(var e in this.inlets)this.deleteInlet(e,!1);for(var t in this.outlets)this.deleteOutlet(t,!1);this.updateMessagingRedux(),this.inlets=void 0,this.outlets=void 0}},{key:"deleteInlet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.inlets[e]&&(this.disconnectFromInlet(e),delete this.inlets[e],this.numInlets--,t&&this.updateMessagingRedux())}},{key:"disconnectFromInlet",value:function(e){var t=this;this.inlets[e]&&(this.inlets[e].connections.forEach(function(e){return t.deleteConnection(e)}),this.subSequence&&this.subSequence.hasInstances&&this.subSequence.onChange())}},{key:"disconnectFromOutlet",value:function(e){this.outlets[e]&&(this.outlets[e].connections.forEach(function(e){e.sourceNode.deleteConnection(e)}),this.outlets[e].connections=[],this.subSequence&&this.subSequence.hasInstances&&this.subSequence.onChange())}},{key:"deleteOutlet",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=j(this.outlets[e].connections);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.destNode.deleteConnection(a)}}catch(i){r.e(i)}finally{r.f()}delete this.outlets[e],this.numOutlets--,n&&this.updateMessagingRedux(),this.subSequence&&this.subSequence.hasInstances&&this.subSequence.onChange()}},{key:"getOutboundNodes",value:function(){return this.getAdjacentNodes(this.outlets,"destNode","destType")}},{key:"getAdjacentNodes",value:function(e,t,n){var r={};for(var a in e){var i=e[a].connections.map(function(e){return{node:e[t],type:e[n]}});i.length>0&&(r[a]=i)}return r}},{key:"getInboundNodes",value:function(){return this.getAdjacentNodes(this.inlets,"sourceNode","sourceType")}},{key:"searchForNode",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.outlets;if(n){var r=Object.keys(n),a=t?n[t]:n[r[0]];if(this.linkedOutlet&&(a=this.linkedOutlet),a){var i,o=j(a.connections);try{for(o.s();!(i=o.n()).done;){var s=i.value.destNode;if(s.name===e)return s;if(s.effect&&s.effect.name===e)return s;var c=s.searchForNode(e,void 0);if(c)return c}}catch(u){o.e(u)}finally{o.f()}}}}},{key:"nameInlets",value:function(){var e,t=[this],n=0,a=Object.keys(this.inlets),i=j(a=["Input"].concat(Object(r.a)(a.filter(function(e){return"Input"!==e}))));try{for(i.s();!(e=i.n()).done;){var o,s=e.value,c=this.inlets[s].connections,u=Object(h.a)(this.name),l=j(c);try{for(l.s();!(o=l.n()).done;){var f=o.value,d=f.sourceNode,p=f.destNode,v=(f.sourceType,f.destType,Object.keys(u.params)[n]);d.attributes["scripting name"]=p.attributes["scripting name"]+"."+v,t.includes(d)||t.push(d)}}catch(m){l.e(m)}finally{l.f()}n++}}catch(m){i.e(m)}finally{i.f()}return t}},{key:"disconnectFromGraph",value:function(){for(var e in this.inlets){var t,n=j(this.inlets[e].connections);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=r.sourceNode,i=r.destNode,o=r.sourceType,s=r.destType;i.disconnectInlet(s,a,o)}}catch(m){n.e(m)}finally{n.f()}}for(var c in this.outlets){var u,l=j(this.outlets[c].connections);try{for(l.s();!(u=l.n()).done;){var f=u.value,h=f.sourceNode,d=f.destNode,p=f.sourceType,v=f.destType;d.disconnectInlet(v,h,p)}}catch(m){l.e(m)}finally{l.f()}}}},{key:"windowPosition",get:function(){return this.sequencerEngine.state.windows.windowPositions[this.id]},set:function(e){var t=e.x,n=e.y;this.dispatch(Object(O.Ze)(this.id,{x:t,y:n}))}},{key:"presentationMode",get:function(){return this.subSequence.presentationMode}}]),n}(e)}},,function(e,t,n){"use strict";n.d(t,"b",function(){return u}),n.d(t,"f",function(){return l}),n.d(t,"g",function(){return f}),n.d(t,"e",function(){return h}),n.d(t,"c",function(){return d}),n.d(t,"d",function(){return p}),n.d(t,"a",function(){return v});var r=n(11),a=n(616);function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=[],c=function(){var e={},t=[],n={},o=function(e,t){n[e]&&n[e].forEach(function(e){return e(t)})},c=function(e,t){n[e]&&(n[e]=n[e].filter(function(e){return e!==t}))},u=function(t){return e[t]||s};return{messages:e,subscribers:n,notify:o,subscribe:function(e,a,i){return n[e]||(n[e]=[]),n[e]=[a].concat(Object(r.a)(n[e])),i&&t.push(a),function(){return c(e,a)}},publish:function(t,n){e[t]||(e[t]=[]),e[t].unshift(n),e[t].length>2&&e[t].pop(),o(t,n)},read:u,drain:function(t){var n=u(t);return e[t]&&(e[t].length=0),n},clearQueue:function(){Object(a.a)(e);var r,o=i(t);try{var s=function(){var e=r.value;for(var t in n)n[t]=n[t].filter(function(t){return t!==e})};for(o.s();!(r=o.n()).done;)s()}catch(c){o.e(c)}finally{o.f()}t.length=0},unsubscribe:c}}(),u=c.messages,l=c.subscribers,f=(c.notify,c.unsubscribe),h=c.subscribe,d=c.publish,p=c.read,v=(c.drain,c.clearQueue);window.subs=h,window.MZGs=u},,function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"d",function(){return a}),n.d(t,"e",function(){return i}),n.d(t,"f",function(){return o}),n.d(t,"c",function(){return s}),n.d(t,"h",function(){return c}),n.d(t,"g",function(){return u}),n.d(t,"i",function(){return l}),n.d(t,"a",function(){return f}),n.d(t,"j",function(){return h}),n.d(t,"k",function(){return d}),n.d(t,"l",function(){return p});var r="float",a="vec2",i="vec3",o="vec4",s="sampler2D",c="number",u="list",l="SDF Manager",f="function",h=[r,a,a,i,o,s,c,"string",u,l,f],d=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{or:t}},p=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{repeat:t}}},function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(108),o=n(4),s=n(5),c=n(31),u=n(7),l=n(8),f=n(2),h=(n(14),n(134)),d=(n(73),n(168)),p=n(23),v=n(59),m=n(623),y=n(446),b=n(33),g=n(145),O=n(447);function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var k=function(e){Object(u.a)(n,e);var t=j(n);function n(e,r,a){var s;return Object(o.a)(this,n),(s=t.call(this,e,r)).track.sequencerEngine&&(s.track.sequencerEngine.idToObject[s.id]=Object(c.a)(s)),s.triggers=[],s.initCache(a),s.numberOfOutputs=1,s.newInlet("enable",function(e){var t=Object(i.a)(e,1)[0];return s.onEnableMessage(t)}),s.newInlet("bypass",function(e){var t=Object(i.a)(e,1)[0];return s.onBypass(t)}),s}return Object(s.a)(n,[{key:"onBypass",value:function(e){this.bypass=e}},{key:"onEnableMessage",value:function(e){this.enabledParameter&&this.enabledParameter.set(e)}},{key:"getObjectType",value:function(){return d.a}},{key:"getChordEffectType",value:function(){return null}},{key:"registerContext",value:function(e,t){var n=this;this.context?this.context.combineWith(e):this.context=e.getCopy(),t?(this.context.forSubDevice(this),this.context.forMidiEffect(t)):this.context.forMidiEffect(this),this.parameters.forEach(function(e){return e.setContext(n.context)})}},{key:"getText",value:function(){return this.getVisualizedParameters().map(function(e){return e.get(!0)}).map(function(e){return"number"===typeof e?Math.round(100*e)/100:e}).map(function(e){return e>0?"+"+e:e}).join(", ")}},{key:"getVisualizedParameters",value:function(){return this.parameters.filter(function(e){return e.isMapped})}},{key:"isRealTime",value:function(){return!0}},{key:"getEffectType",value:function(){return v.c}},{key:"isMidiEffect",value:function(){return!0}},{key:"needsStableLookAhead",value:function(){return!1}},{key:"onNewStep",value:function(){this.clear()}},{key:"stop",value:function(){}},{key:"clear",value:function(){this.triggers.length>0&&(this.triggers.length=0)}},{key:"input",value:function(e){e.outputNumber=0,this.triggers.push(e)}},{key:"output",value:function(){return this.triggers}},{key:"removeNote",value:function(){}},{key:"getCopy",value:function(e){return this}},{key:"addNote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.getStep(this.track.trackData,e,null,!1);r.velocity=this.track.trackData.velocity,r.duration=null,r.transpose=e,r.slice=t,this.input(new g.a(r,0,n),!0)}},{key:"copyTrigger",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(e.stepData.duration,e.stepData||new b.a);this.track&&!this._subSequence&&(n.track=this.track);var i=this.getStep(n,void 0,void 0,t),o=new g.a(i,e.time,e.stepNumber,e.outputNumber);return e.grabs&&(o.grabs=Object(a.a)(e.grabs)),e.chokes&&(o.chokes=Object(a.a)(e.chokes)),e.message&&(o.message=Object(r.a)({},e.message)),e.delays&&(o.message=Object(r.a)({},e.delays)),o}},{key:"dispose",value:function(){var e=this;this.name=void 0;var t=this.track.sequencerEngine.state.effects.pulledEffects;this.track.sequencerEngine.dispatch(Object(p.dd)(t.filter(function(t){return t!==e})))}},{key:"getParameters",value:function(){return this.parameters}},{key:"isRolling",value:function(){return this.track.sequencerEngine.isSequenceRolling}}]),n}(Object(h.a)(Object(m.a)(Object(O.a)(y.a))));t.a=k},,function(e,t,n){"use strict";var r=n(11),a=n(42),i=n.n(a),o=n(56),s=n(4),c=n(5),u=n(7),l=n(8),f=n(2),h=(n(271),n(301)),d=(n(373),n(159)),p=n(80),v=n(521),m=n(157),y=(n(119),n(825)),b=(n(142),n(162)),g=n(153),O=n(149);(new y.a).contractAddress;var j=function(){var e=Object(o.a)(i.a.mark(function e(t,n){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new m.a(O.a,"newSampleByArtist",[b.a.utils.fromAscii(t),Object(g.b)(n)]).execute();case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),k=function(){var e=Object(o.a)(i.a.mark(function e(t,n,r,a){var o,s=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.length>4&&void 0!==s[4]?s[4]:"RECORD",console.log("newRelease(%s,%s,%s,%s,%s)",t,n,r,a,o),e.next=4,new m.a(O.a,"newRelease",[b.a.utils.fromAscii(t),n,r,Object(g.b)(a),b.a.utils.fromAscii(o)]).execute();case 4:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),w=n(358),x=n(608),S=n(832),P=n(302),E=n(538),T=(n(6),n(543)),A=n(127),M=n(122),R=(n(983),n(610)),C=n(43),N=(n(544),n(124));function I(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}n(309);var q=new N.a;window.SAMPLES=[];var _=function(e){Object(u.a)(n,e);var t=I(n);function n(e,r,a){var i;return Object(s.a)(this,n),i=t.call(this),"number"==typeof e||Object(C.a)(e)?i.soundId=e:i.ipfsHash=e,i.guildId=a,i._id=e,i.stemTypes=[],i.isLoop=!1,i.downloadUrl=void 0,i.videoId=void 0,i.name=void 0,i.tags=void 0,i.slices=void 0,i.noteSequence=void 0,i.packs=[],i.isStems=!1,i.styles=[],i.guildId=void 0,r?i.encryptedIpfs=r:window.sequencerEngine&&(i.encryptedIpfs=new R.a(window.sequencerEngine.store,window.sequencerEngine.ethereum.guilds,window.sequencerEngine.ethereum.encryption,window.sequencerEngine.ethereum.crypto)),i.audioBuffer=void 0,i.addedToProject=!1,i.highlightedTags={},i.samplesUsed=[],i}return Object(c.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getTagsToSave",value:function(){var e=this;return Object.keys(this.highlightedTags).length>0?Object.keys(this.highlightedTags).filter(function(t){return e.highlightedTags[t]}):this.tags}},{key:"getId",value:function(){return void 0!==this.ipfsHash?this.ipfsHash:this.soundId}},{key:"fromJson",value:function(e){this.ipfsHash=e.id,this.name=e.name,this.videoId=e.videoId,this.tags=e.tags||[],this.slices=e.slices,this.coverArtHash=e.coverArtHash,this.discogsId=e.discogsId}},{key:"dispose",value:function(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.addedToProject||(this.audioBuffer=void 0,this.discogsId=void 0,this.videoId=void 0,this.coverArtHash=void 0,this.slices=void 0,this.packs=void 0)}},{key:"isLoaded",value:function(){return void 0!==this.audioBuffer}},{key:"getJson",value:function(){return{id:this.getId(),slices:this.slices,name:this.name,videoId:this.videoId,tags:this.tags,thumbnail:this.getThumbnail(),discogsId:this.discogsId,coverArtHash:this.coverArtHash}}},{key:"fetchMetadata",value:function(){var e=this;if(void 0!==this.ipfsHash)return new Promise(function(){var t=Object(o.a)(i.a.mark(function t(n,r){var a,o,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,A.a.getTitleForSound(e.ipfsHash);case 2:return a=t.sent,t.next=5,A.a.getVideoIdForSound(e.ipfsHash);case 5:return o=t.sent,t.next=8,A.a.getCoverArtForSound(e.ipfsHash);case 8:s=t.sent,void 0!==a&&(e.name=a),void 0!==o&&(e.videoId=o),void 0!==s&&(e.coverArtHash=s),n(e);case 13:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"fetchTags",value:function(){var e=this;return new Promise(function(){var t=Object(o.a)(i.a.mark(function t(n,r){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e.soundId||void 0===e.ipfsHash){t.next=11;break}return t.t0=Set,t.next=4,A.a.getTagsForSound(e.ipfsHash);case 4:return t.t1=t.sent,a=new t.t0(t.t1),e.tags=Array.from(a)||[],n(e.tags||[]),t.abrupt("return");case 11:n([]);case 12:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"fetchSlices",value:function(){var e=this;return new Promise(function(){var t=Object(o.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:A.a.getSlicesForSound(e.ipfsHash).then(function(t){e.slices=t,n(t)});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"fetchAudio",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(n,r){void 0!==e.ipfsHash&&e.fetchAudioFromIPFS(t).then(function(e){return n(e)}).catch(function(e){r("timed out")})})}},{key:"fetchAudioFromIPFS",value:function(e){var t=this;return new Promise(function(n,r){(new Date).getTime();window.SAMPLES.push(t),t.encryptedIpfs.getSound(t.ipfsHash,void 0,e).then(function(){var e=Object(o.a)(i.a.mark(function e(a){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Object(h.b)(a,t.ipfsHash).then(function(e){t.audioBuffer=e,n(t)}).catch(function(e){r(e)});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){r(e)})})}},{key:"fetchGuild",value:function(){var e=Object(o.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.a.guildSamples.getGuildIdForSound(this.getId());case 2:this.guildId=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"analyze",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if(void 0===this.tempo){var n=Object(T.a)(this.audioBuffer,e,t),r=n.tempo,a=n.onsets;this.tempo=r,this.onsets=a}}},{key:"fetchNoteSequence",value:function(){var e=this;return new Promise(function(){var t=Object(o.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n(e.noteSequence);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getThumbnail",value:function(){return this.coverArtHash&&""!==this.coverArtHash?M.a.getHashUrl(this.coverArtHash):this.videoId&&""!==this.videoId?"https://img.youtube.com/vi/"+this.videoId+"/1.jpg":void 0}},{key:"load",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise(function(){var n=Object(o.a)(i.a.mark(function n(a,o){var s;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e.getId()&&e.getId()!==P.a){n.next=3;break}return a(),n.abrupt("return");case 3:if(!e.audioBuffer){n.next=5;break}return n.abrupt("return",a());case 5:if(n.prev=5,!t){n.next=9;break}return n.next=9,e.fetchAudio();case 9:if(!window.isNFT){n.next=20;break}if(window.samplesMetadata){n.next=12;break}return n.abrupt("return",a());case 12:if(s=window.samplesMetadata[e.getId()]){n.next=16;break}return e.name="",n.abrupt("return",a());case 16:return e.tags?e.tags=[].concat(Object(r.a)(e.tags),Object(r.a)(s.tags)):e.tags=s.tags,e.name=s.name,e.videoId=s.videoId,n.abrupt("return",a());case 20:return n.t0=fetch,n.t1=JSON,n.next=24,d.a.getAccount();case 24:n.t2=n.sent,n.t3=e.getId(),n.t4={user:n.t2,id:n.t3},n.t5=n.t1.stringify.call(n.t1,n.t4),n.t6={Accept:"application/json","Content-Type":"application/json"},n.t7={method:"POST",body:n.t5,headers:n.t6},(0,n.t0)("/querySample/",n.t7).then(function(e){return e.json()}).then(function(t){e.tags=Array.from(new Set(t.tags||[])),e.videoId=t.videoId,""===e.videoId&&(e.videoId=void 0),e.name=t.title,e.packs=t.packs,e.favorited=5===t.rating,e.artistName=t.artistName,e.releaseName=t.releaseName,e.sampledByUser=t.user,e.blockNumber=t.blockNumber,e.year=t.year,e.discogsId=t.discogsId,e.coverArtHash=""===t.coverArtHash?void 0:t.coverArtHash,e.guildId=t.guildId,a()}).catch(function(e){console.log(e)}),n.next=36;break;case 33:n.prev=33,n.t8=n.catch(5),o();case 36:case"end":return n.stop()}},n,null,[[5,33]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"color",get:function(){return q.getColorForHash(this.getId())}},{key:"getCopyWith",value:function(e,t){var a=new n(e);return a.videoId=this.videoId,a.discogsId=this.discogsId,a.coverArtHash=this.coverArtHash,a.name=this.name+"("+t+")",a.year=this.year,a.country=this.country,a.styles=this.styles,a.tags=[].concat(Object(r.a)(this.tags),[t]),a.packs=Object(r.a)(this.packs),a.isStems=!0,a}},{key:"getCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new n(this.getId());if(t.videoId=this.videoId,t.discogsId=this.discogsId,t.coverArtHash=this.coverArtHash,t.name=this.name,t.year=this.year,t.country=this.country,t.styles=this.styles,t.tags=this.tags?Object(r.a)(this.tags):[],e)t.audioBuffer=this.audioBuffer;else if(void 0!==this.audioBuffer){var a=new AudioBuffer({length:this.audioBuffer.length,numberOfChannels:this.audioBuffer.numberOfChannels,sampleRate:this.audioBuffer.sampleRate}),i=this.audioBuffer.getChannelData(0);a.copyToChannel(i,0),this.audioBuffer.numberOfChannels>1&&(i=this.audioBuffer.getChannelData(1),a.copyToChannel(i,1)),t.audioBuffer=a}return t}},{key:"newTag",value:function(e){this.tags.push(e),this.needsSave||A.a.tagSample(this.ipfsHash,e,this.guildId)}},{key:"getContentType",value:function(){return S.b}},{key:"uploadAudioToIPFS",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n,r,a,o,s=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:0,this.getId()!==P.a){e.next=20;break}return n=[this.audioBuffer.getChannelData(0)],this.audioBuffer.numberOfChannels>1&&n.push(this.audioBuffer.getChannelData(1)),e.next=6,Object(w.a)(n);case 6:if(r=e.sent,0!==t){e.next=14;break}return e.next=10,M.a.addArrayBuffer(r);case 10:a=e.sent,this.ipfsHash=a,e.next=20;break;case 14:return this.contentKey=new x.a,e.next=17,this.encryptedIpfs.addSound(r,v.a,t,this.contentKey);case 17:o=e.sent,this.ipfsHash=o,this.guildId=t;case 20:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"saveBuffer",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.mp3Data){e.next=7;break}return n=[this.audioBuffer.getChannelData(0)],this.audioBuffer.numberOfChannels>1&&n.push(this.audioBuffer.getChannelData(0)),e.next=6,Object(w.a)(n);case 6:t=e.sent;case 7:return e.next=9,M.a.addArrayBuffer(t);case 9:r=e.sent,this.ipfsHash=r;case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"uploadAudioBuffer",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n,r,a,o,s,c=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]?c[0]:0,n=void 0,this.getId()!==P.a){e.next=25;break}if(r=this.mp3Data){e.next=12;break}return a=[this.audioBuffer.getChannelData(0)],this.audioBuffer.numberOfChannels>1&&a.push(this.audioBuffer.getChannelData(0)),e.next=9,Object(w.a)(a);case 9:r=e.sent,e.next=12;break;case 12:if(0!==t){e.next=19;break}return e.next=15,M.a.addArrayBuffer(r);case 15:o=e.sent,this.ipfsHash=o,e.next=25;break;case 19:return n=new x.a,e.next=22,this.encryptedIpfs.addSound(r,v.a,t,n);case 22:s=e.sent,this.ipfsHash=s,this.guildId=t;case 25:return e.abrupt("return",n);case 26:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"saveSample",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n,a,o,s,c,u,l=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:0,e.next=3,this.uploadAudioBuffer(t);case 3:for(n=e.sent,a=Object(r.a)(this.tags),o=a.length;o<4;o++)a.push("");for(s=this.styles?Object(r.a)(this.styles):[],c=s.length;c<4;c++)s.push("");return u={ipfsHash:this.ipfsHash,title:this.name,videoId:this.videoId,tags:a.slice(0,4),styles:s.slice(0,4),country:this.country||null,year:this.year||0,coverArt:this.coverArtHash,discogsId:this.discogsId},this.needsSave=!1,0===t?A.a.newSamplesWithMetadata([u],0):A.a.newEncryptedSamples([u],t,n),e.next=13,Object(p.a)(1e3);case 13:this.saveArtistInfo();case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"saveArtistInfo",value:function(){var e=Object(o.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.artistName){e.next=5;break}return k(this.artistName.slice(0,32),this.discogsId,this.releaseName,this.coverArtHash,this.releaseType),e.next=4,Object(p.a)(1e3);case 4:j(this.artistName.slice(0,32),this.ipfsHash);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(E.a);t.a=_},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(221),u=(n(119),n(42)),l=n.n(u),f=n(56);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var d=new(function(){function e(){Object(r.a)(this,e),this.runningQueries=new Set}return Object(a.a)(e,[{key:"submit",value:function(e){var t=this;return new Promise(function(){var n=Object(f.a)(l.a.mark(function n(r,a){var i;return l.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t.runningQueries.size>=4)){n.next=5;break}return n.next=3,t.sleep(20);case 3:n.next=0;break;case 5:t.runningQueries.add(e),i="/search",(window.spores||window.isNFT)&&(i="https://zequencer.io"+i),fetch(i,{method:"POST",body:JSON.stringify(e),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(n){t.removeQuery(e),r(n||[])}).catch(function(n){console.log(n),t.removeQuery(e)});case 9:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"removeQuery",value:function(e){this.runningQueries.delete(e)}},{key:"sleep",value:function(e){return new Promise(function(t,n){setTimeout(t,e)})}}]),e}()),p=function(e){Object(i.a)(n,e);var t=h(n);function n(e){return Object(r.a)(this,n),t.call(this,e)}return Object(a.a)(n,[{key:"executeQuery",value:function(){var e=this,t=(!(arguments.length>0&&void 0!==arguments[0])||arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]);return new Promise(function(n,r){if(window.isNFT&&!t)return n([]);d.submit(e.getJson()).then(n)})}}]),n}(c.a);t.a=p},function(e,t,n){"use strict";n.d(t,"f",function(){return r}),n.d(t,"d",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"g",function(){return o}),n.d(t,"b",function(){return s}),n.d(t,"c",function(){return c}),n.d(t,"e",function(){return u});var r="SAMPLER",a="MIDI",i="AUDIO",o="Z4",s="INSTRUMENT",c="INSTRUMENT_RACK",u="MULTI_FREEZE"},,function(e,t,n){"use strict";var r=n(4);t.a=function e(t,n,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0;Object(r.a)(this,e),this.stepData=t,this.time=n,this.stepNumber=a,this.grabs=[],this.chokes=[],this.outputNumber=i,this.warpedSteps=o}},,function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e,t){return(e%t+t)%t}},,function(e,t,n){"use strict";n(272);var r=n(813),a=n(814),i=n(815),o=n(535),s=n(816),c=n(817),u=n(307),l=n(536),f=n(818),h=n(537),d=n(819),p=n(820),v=n(821),m=n(822),y=n(4),b=n(5),g=function(){function e(){Object(y.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceFavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceStarred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"tag",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceTagged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceUnfavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceUnstarred",type:"event"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"favoriteSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"starSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"bytes32",name:"tag",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"tagSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"unfavoriteSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"unstarSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x03172e863dbF7EEb3994AF5a6608c470eB6E79fC"}return Object(b.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),O=n(823),j=n(308),k=function(){function e(){Object(y.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"mixHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"sequenceHash",type:"bytes32"}],name:"MixUsedSequence",type:"event"},{inputs:[{internalType:"bytes32",name:"mixHash",type:"bytes32"},{internalType:"bytes32",name:"previousHash",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"bytes32[]",name:"sequencesUsed",type:"bytes32[]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newMix",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"mixHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"previousHash",type:"bytes32"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!1,internalType:"uint32",name:"guildId",type:"uint32"}],name:"NewMix",type:"event"}],this.contractAddress="0xCAD33f311E1223095FC94E89453888Df04f7BbBF"}return Object(b.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),w=n(824),x=n(825),S=n(826),P=function(){function e(){Object(y.a)(this,e),this.abi=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"deviceName",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"ccNumber",type:"uint32"},{indexed:!0,internalType:"bytes32",name:"parameterName",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"MidiCCParameter",type:"event"},{inputs:[{internalType:"bytes32",name:"deviceName",type:"bytes32"},{internalType:"uint32",name:"ccNumber",type:"uint32"},{internalType:"bytes32",name:"parameterName",type:"bytes32"}],name:"newMidiCCParameter",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x9c2607b1f1444AC1349aE79Bffa4000965d6936E"}return Object(b.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),E=function(){function e(){Object(y.a)(this,e),this.abi=[{inputs:[{internalType:"bytes32[]",name:"newContents",type:"bytes32[]"},{internalType:"bytes32[]",name:"previousContents",type:"bytes32[]"},{internalType:"bytes32[]",name:"titles",type:"bytes32[]"},{internalType:"uint32[]",name:"guildIds",type:"uint32[]"}],name:"bulkEdit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"deleteList",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"newContent",type:"bytes32"},{internalType:"bytes32",name:"previousContent",type:"bytes32"},{internalType:"bytes32",name:"title",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"editList",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"favoriteList",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"highlightList",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"}],name:"ListDeleted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"newContent",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"previousContent",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!1,internalType:"bytes32",name:"title",type:"bytes32"},{indexed:!1,internalType:"uint32",name:"guildId",type:"uint32"}],name:"ListEdited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"ListFavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"ListHighlighted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"ListUnfavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"ListUnhighlighted",type:"event"},{inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"unfavoritedList",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"unhighlightList",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0xCD76d04Ab1CeCb1F72dDc7b8dd798dD162db7684"}return Object(b.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),T=function(){function e(){Object(y.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"wallpaperHash",type:"bytes32"}],name:"DefaultWallpaper",type:"event"},{inputs:[{internalType:"bytes32",name:"wallpaperHash",type:"bytes32"},{internalType:"bytes32",name:"thumbnailHash",type:"bytes32"}],name:"newWallpaper",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"wallpaperHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"thumbnailHash",type:"bytes32"}],name:"NewWallpaper",type:"event"},{inputs:[{internalType:"bytes32",name:"wallpaperHash",type:"bytes32"}],name:"setDefaultWallpaper",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x21e424dB64f6597B60E179AAA7C819E616F801A0"}return Object(b.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),A=n(827),M=n(828),R=n(829),C=function(){function e(){Object(y.a)(this,e),this.abi=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"},{indexed:!0,internalType:"uint256",name:"versionNumber",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!1,internalType:"string",name:"metadataURI",type:"string"}],name:"NewPluginVersion",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"},{indexed:!0,internalType:"address",name:"creator",type:"address"},{indexed:!1,internalType:"string",name:"name",type:"string"}],name:"PluginCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"activeTokens",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"pluginURI",type:"string"},{internalType:"string",name:"pluginMetadata",type:"string"},{internalType:"bytes32",name:"pluginContentHash",type:"bytes32"},{internalType:"uint8[3]",name:"profitSplit",type:"uint8[3]"}],name:"createPlugin",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getProfitSplit",outputs:[{components:[{internalType:"uint8",name:"creatorShare",type:"uint8"},{internalType:"uint8",name:"ownerShare",type:"uint8"},{internalType:"uint8",name:"minterShare",type:"uint8"}],internalType:"struct ISplit.ProfitSplit",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"pluginTokens",outputs:[{internalType:"string",name:"name",type:"string"},{components:[{internalType:"uint8",name:"creatorShare",type:"uint8"},{internalType:"uint8",name:"ownerShare",type:"uint8"},{internalType:"uint8",name:"minterShare",type:"uint8"}],internalType:"struct ISplit.ProfitSplit",name:"profitSplit",type:"tuple"},{components:[{internalType:"uint256",name:"_value",type:"uint256"}],internalType:"struct Counters.Counter",name:"versionsCounter",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes",name:"_data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"tokenCreators",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenMetadataURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"string",name:"pluginURI",type:"string"},{internalType:"string",name:"pluginMetadataURI",type:"string"},{internalType:"bytes32",name:"pluginContentHash",type:"bytes32"}],name:"updatePlugin",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x922005bb5715BD7a584b53b9B377Bf5d426723c9"}return Object(b.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),N=n(830),I=n(162);n.d(t,"b",function(){return q}),n.d(t,"i",function(){return _}),n.d(t,"e",function(){return D}),n.d(t,"j",function(){return F}),n.d(t,"h",function(){return L}),n.d(t,"g",function(){return B}),n.d(t,"d",function(){return z}),n.d(t,"f",function(){return J}),n.d(t,"l",function(){return V}),n.d(t,"o",function(){return H}),n.d(t,"q",function(){return U}),n.d(t,"c",function(){return G}),n.d(t,"a",function(){return W}),n.d(t,"k",function(){return K}),n.d(t,"m",function(){return Q}),n.d(t,"p",function(){return Z}),n.d(t,"r",function(){return Y}),n.d(t,"n",function(){return $}),n.d(t,"s",function(){return X});var q="AUTHORIZER",_="GUILD_SAMPLES",D="FAVORITES",F="GUILD_SEQUENCES",L="GUILD_PRESETS",B="GUILDS",z="ENCRYPTION",J="FOLDERS",V="MESSAGING",H="RESAMPLE",U="XANADU",G="EFFECTS",W="ARTISTS",K="GUILD_SETTINGS",Q="PACKS",Z="SCRIPTS",Y="ZPROJECTS",$="PROJECT_METADATA",X={USERS:(new c.a).getContract(I.a),FAVORITES:(new r.a).getContract(I.a),GUILDS:(new d.a).getContract(I.a),PLUGINS:(new C).getContract(I.a),GUILD_SAMPLES:(new u.a).getContract(I.a),TOKENIZED_SEQUENCES:(new l.a).getContract(I.a),GUILD_SEQUENCES:(new f.a).getContract(I.a),GUILD_PRESETS:(new h.a).getContract(I.a),ENCRYPTION:(new p.a).getContract(I.a),FOLDERS:(new v.a).getContract(I.a),MESSAGING:(new m.a).getContract(I.a),SEQUENCE_METADATA:(new g).getContract(I.a),RESAMPLE:(new O.a).getContract(I.a),XANADU:(new j.a).getContract(I.a),MIX:(new k).getContract(I.a),EFFECTS:(new w.a).getContract(I.a),ARTISTS:(new x.a).getContract(I.a),GUILD_SETTINGS:(new S.a).getContract(I.a),MIDI_CC:(new P).getContract(I.a),EXPLORE_LISTS:(new E).getContract(I.a),WALLPAPER:(new T).getContract(I.a),PACKS:(new A.a).getContract(I.a),SCRIPTS:(new M.a).getContract(I.a),NFT:(new s.a).getContract(I.a),ZPROJECTS:(new R.a).getContract(I.a),AUTHORIZER:(new a.a).getContract(I.a),PROJECT_METADATA:(new i.a).getContract(I.a),SKINS:(new N.a).getContract(I.a),STEMS:(new o.a).getContract(I.a)}},function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"g",function(){return h}),n.d(t,"d",function(){return p}),n.d(t,"e",function(){return v}),n.d(t,"f",function(){return m}),n.d(t,"c",function(){return b}),n.d(t,"b",function(){return g});var r=n(11),a=n(20),i=(n(3),n(61));function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c="%",u=function(e){return{type:i.d,name:e}},l=function(){return{cycle:void 0,transpose:"",operand:"",operator:void 0,id:Object(a.uuid)()}},f=function(e){return""===e.transpose},h=function(e){e=" "+e+" ";for(var t=[],n=[t],r=l(),a=0;a<e.length;a++){var o=e.charAt(a);switch(o){case"*":""===r.transpose&&(r.cycle=t.pop()),r.operator="*";break;case c:""===r.transpose&&(r.cycle=t.pop()),r.operator=c;break;case"^":""===r.transpose&&(r.cycle=t.pop()),r.operator="^";break;case"/":""===r.transpose&&(r.cycle=t.pop()),r.operator="/";break;case"~":r.transpose=null;break;case"'":r.accent=!0;break;case",":r.legato=!0;break;case" ":case"\n":d(r,t),r=l();break;case"[":d(r,t),t=[],n.push(t),r=l();break;case"]":d(r,t);var s=n.pop();(t=n[n.length-1]||[]).push(s),r=l();break;default:"."!==o||f(r)?o===i.b&&f(r)?(r.type=b(),r.transpose="0"):o===i.a&&f(r)?(r.type=g(0),r.transpose="0",d(r,t),(r=l()).type=g(1),r.transpose="0"):r.operator?r.operand+=o:r.transpose+=o:r.staccato=!0}}return n[0]};function d(e,t){if(e.cycle)isNaN(parseInt(e.operand))?e.operand=u(e.operand):e.operand=parseInt(e.operand),t.push(e);else if(void 0!==e.transpose&&""!==e.transpose){var n=null;null!=e.transpose&&(n=parseFloat(e.transpose),isNaN(n)?e.transpose=u(e.transpose):e.transpose=n),isNaN(parseInt(e.operand))?e.operand&&""!==e.operand&&(e.operand=u(e.operand)):e.operand=parseInt(e.operand),t.push(e)}}var p=function e(t,n,a){for(var i=[],s="",c=void 0,u=function(a){if(Array.isArray(t[a])){s+="[";var o=e(t[a],n,!0),u=o.spans;if(void 0!==o.index&&(c=i.length+o.index),s+=u[0],u.length>=1){if(i.push("["!==s[s.length-1]&&"["!==s.trim()?s.trim()+" ":s.trim()),(i=[].concat(Object(r.a)(i),Object(r.a)(u.slice(1))))[i.length-1]=i[i.length-1].trim(),i[i.length-2]){var l=i[i.length-2].trim();"]"===l[l.length-1]&&(i[i.length-2]=l)}i[i.length-1]+="] ",s=""}else s=s.trim(),i[i.length-1]=i[i.length-1].trim(),s+="] "}else{var f=!1;n&&n.some(function(e){return e.id===t[a].id})&&(f=!0,0===i.length?i.push(s):i[i.length-1]+=s,s=""),s+=m(t[a]),a<t.length-1&&" "!==s[s.length-1]&&(s+=" "),f&&(c=i.length,i.push(s),s=" ")}},l=0;l<t.length;l++)u(l);var f,h=[].concat(Object(r.a)(i),[s]);""===h[1]&&(h.splice(1,1),c--);var d,p=[],v=o(h);try{for(v.s();!(d=v.n()).done;){var y=d.value;f&&"]"===f[f.length-1]&&(" "!==y[0]&&"]"!==y&&"["!==y&&(y=" "+y),"]"===y.trim()[0]&&(y=y.trim())),p.push(y),f=y}}catch(b){v.e(b)}finally{v.f()}return a?{spans:p,index:c}:p},v=function e(t){for(var n="",r=0;r<t.length;r++){if(Array.isArray(t[r]))n+="["+e(t[r]).trim()+"] ";else n+=m(t[r]),r<t.length-1&&" "!==n[n.length-1]&&(n+=" ")}return n},m=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.cycle)return"["+v(e.cycle).trim()+"]"+e.operator+y(e.operand);var n="";if(e.operator){var r=e.transpose;r=null==r?"~":"object"===typeof e.transpose?e.transpose.name:e.transpose,n=t?r:r+e.operator+y(e.operand)}else if("object"===typeof e.transpose)n=null===e.transpose?"~":e.transpose.name;else if(e.type){var a=e.type,o=a.type,s=a.value;n=o===i.b?".":o===i.a&&0===s?"-":""}else n=e.transpose;return e.accent?n+="'":e.staccato?n+=".":e.legato&&(n+=","),e.nudgeForward?n+=">":e.nudgeBackward&&(n+="<"),e.piano?n+="p":e.pianissimo&&(n+="pp"),n},y=function(e){if(""!==e)return"object"===typeof e?e.name:e},b=function(){return{type:i.b}},g=function(e){return{type:i.a,value:e}}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(379),a=Object(r.a)()},,function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return a}),n.d(t,"a",function(){return i});n(162);var r=n(189);function a(e){var t=r.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}function i(t){var n=new e(t.replace(/^0x/,"1220"),"hex");return r.encode(n)}}).call(this,n(110).Buffer)},,,function(e,t,n){"use strict";n.d(t,"a",function(){return s});n(11);var r=n(1),a=n(108),i=(n(129),n(571),n(138),n(208)),o=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var s=void 0,y=void 0,b=void 0,g=u(),O=void 0,j=void 0,k=void 0;return function(t){var o=Object(a.a)(t,1)[0],u=g.apply(void 0,[o].concat(n)),w=l.apply(void 0,[o].concat(n)),x=h.apply(void 0,[o].concat(n)),S=f.apply(void 0,[o].concat(n)),P="object"===typeof o?o.frames:void 0,E="object"===typeof o?o.texture:void 0;!P&&k&&(P=k),P&&(k=P);var T=n.map(function(e){return e()});if(c(P,k)&&d(b,o)&&p(y,T)&&v(u,O)&&m(w,j))return s.uniforms=u,s.variables=w,s.functions=x,s.feedback=o&&o.feedback,s.closure=S,s.args=T,s.frames=P,s.texture=E,s.input=o,y=T,b=o,s;O=Object.keys(u),j=Object(r.a)({},w),k=P;var A=e(o);return y=T,b=o,s={code:A,hashCode:Object(i.a)(A),uniforms:u,texture:E,feedback:o&&o.feedback,variables:w,functions:x,closure:S,args:T,frames:P,input:o}}},s=o,c=function(e,t){return!0},u=function(){var e={};return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];if("function"===typeof o&&(o=o()),o&&o.uniforms)for(var s in o.uniforms)e[s]=o.uniforms[s]}return e}},l=function(){for(var e={},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];if("function"===typeof o&&(o=o()),o&&o.variables)for(var s in o.variables)e[s]=o.variables[s]}return e},f=function(){for(var e={},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];if("function"===typeof o&&(o=o()),o&&o.closure)for(var s in o.closure)e[s]=o.closure[s]}return e},h=function(){for(var e={},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];if("function"===typeof o&&(o=o()),o&&o.functions)for(var s in o.functions)e[s]=o.functions[s]}return e},d=function(e,t){return Array.isArray(e)?p(e,t):e&&t?e.hashCode&&t.hashCode?e.hashCode===t.hashCode:e===t:!e&&!t},p=function(e,t){if(!e)return!e&&!t;for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(void 0===r||void 0===a){if(void 0===r&&void 0===a)continue;return!1}if(!(r.hashCode&&a.hashCode===r.hashCode||r.code&&a.code&&r.code===a.code||r===a))return!1;if(e.frames&&!t.frames)return!1;if(!e.frames&&t.frames)return!1;if(e.frames&&t.frames&&e.frames.length!==t.frames.length)return!1}return!0},v=function(e,t){var n=0;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e){if(!e[r].update||t[r]&&!t[r].update)return!1;if(t[n]!==r)return!1;n++}return!0},m=function(e,t){if(!t)return!1;for(var n in e)if(e[n]!==t[n])return!1;return!0}},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(11),o=n(56),s=n(4),c=n(5),u=n(159);function l(e,t){return f.apply(this,arguments)}function f(){return(f=Object(o.a)(a.a.mark(function e(t,n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.eth.getTransaction(t);case 3:return r=e.sent,e.next=6,n.eth.getBlockNumber();case 6:return i=e.sent,e.abrupt("return",r&&null!==r.blockNumber?i-r.blockNumber:0);case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}},e,null,[[0,10]])}))).apply(this,arguments)}var h=n(23),d=n(149),p={AUTHORIZER:{authorize:d.s.AUTHORIZER.methods.authorize,revoke:d.s.AUTHORIZER.methods.revoke},USERS:{setName:d.s.USERS.methods.setName,setProfileHash:d.s.USERS.methods.setProfileHash},TOKENIZED_SEQUENCES:{editSequence:d.s.TOKENIZED_SEQUENCES.methods.editSequence,buyTokens:d.s.TOKENIZED_SEQUENCES.methods.buyTokens},GUILD_SEQUENCES:{editSequence:d.s.GUILD_SEQUENCES.methods.editSequence},GUILD_PRESETS:{newPreset:d.s.GUILD_PRESETS.methods.newPreset,tagPreset:d.s.GUILD_PRESETS.methods.tagPreset},GUILDS:{newGuild:d.s.GUILDS.methods.newGuild,requestToAddMember:d.s.GUILDS.methods.requestToAddMember,leaveGuild:d.s.GUILDS.methods.leaveGuild,acceptRequestToAddToGuild:d.s.GUILDS.methods.acceptRequestToAddToGuild,rejectRequestToAddToGuild:d.s.GUILDS.methods.requestRequestToAddToGuild},GUILD_SAMPLES:{newSamplesWithMetadata:d.s.GUILD_SAMPLES.methods.newSamplesWithMetadata,newSampleWithMetadata:d.s.GUILD_SAMPLES.methods.newSampleWithMetadata,newEncryptedSamples:d.s.GUILD_SAMPLES.methods.newEncryptedSamples},ENCRYPTION:{setPublicKey:d.s.ENCRYPTION.methods.setPublicKey,newEncryptedContent:d.s.ENCRYPTION.methods.newEncryptedContent,shareEncryptedContentWith:d.s.ENCRYPTION.methods.newEncryptedContent},FOLDERS:{foldersUpdated:d.s.FOLDERS.methods.foldersUpdated},MESSAGING:{sendPublicMessage:d.s.MESSAGING.methods.sendPublicMessage},SEQUENCE_METADATA:{tagSequence:d.s.SEQUENCE_METADATA.methods.tagSequence,starSequence:d.s.SEQUENCE_METADATA.methods.starSequence,favoriteSequence:d.s.SEQUENCE_METADATA.methods.favoriteSequence,unfavoriteSequence:d.s.SEQUENCE_METADATA.methods.unfavoriteSequence,unstarSequence:d.s.SEQUENCE_METADATA.methods.unstarSequence},RESAMPLE:{newResample:d.s.RESAMPLE.methods.newResample},XANADU:{newDataType:d.s.XANADU.methods.newDataType,newLinkType:d.s.XANADU.methods.newLinkType,newAnnotationType:d.s.XANADU.methods.newAnnotationType,newLink:d.s.XANADU.methods.newLink,newLinks:d.s.XANADU.methods.newLinks,newAnnotation:d.s.XANADU.methods.newAnnotation},MIX:{newMix:d.s.MIX.methods.newMix},EFFECTS:{newEffect:d.s.EFFECTS.methods.newEffect},FAVORITES:{favoriteSample:d.s.FAVORITES.methods.favoriteSample,unfavoriteSample:d.s.FAVORITES.methods.unfavoriteSample},ARTISTS:{newRelease:d.s.ARTISTS.methods.newRelease,newArtistInfo:d.s.ARTISTS.methods.newArtistInfo,newSampleByArtist:d.s.ARTISTS.methods.newSampleByArtist},GUILD_SETTINGS:{leaveGuild:d.s.GUILD_SETTINGS.methods.guildSettings,userChoseDefaultGuild:d.s.GUILD_SETTINGS.methods.userChoseDefaultGuild,createGuildWithPeople:d.s.GUILD_SETTINGS.methods.createGuildWithPeople},MIDI_CC:{newMidiCCParameter:d.s.MIDI_CC.methods.newMidiCCParameter},EXPLORE_LISTS:{editList:d.s.EXPLORE_LISTS.methods.editList,bulkEdit:d.s.EXPLORE_LISTS.methods.bulkEdit,deleteList:d.s.EXPLORE_LISTS.methods.deleteList,highlightList:d.s.EXPLORE_LISTS.methods.highlightList,unhighlightList:d.s.EXPLORE_LISTS.methods.unhighlightList,favoriteList:d.s.EXPLORE_LISTS.methods.favoriteList,unfavoriteList:d.s.EXPLORE_LISTS.methods.unfavoriteList},WALLPAPER:{newWallpaper:d.s.WALLPAPER.methods.newWallpaper,setDefaultWallpaper:d.s.WALLPAPER.methods.setDefaultWallpaper},PACKS:{newPack:d.s.PACKS.methods.newPack},SCRIPTS:{newScript:d.s.SCRIPTS.methods.newScript},NFT:{newProject:d.s.NFT.methods.newProject,mint:d.s.NFT.methods.mint},ZPROJECTS:{editSequence:d.s.ZPROJECTS.methods.editSequence,zoraProject:d.s.ZPROJECTS.methods.zoraProject},PLUGINS:{createPlugin:d.s.PLUGINS.methods.createPlugin,updatePlugin:d.s.PLUGINS.methods.updatePlugin},PROJECT_METADATA:{newProjectMetadata:d.s.PROJECT_METADATA.methods.newProjectMetadata},SKINS:{newSkins:d.s.SKINS.methods.newSkins},STEMS:{newSong:d.s.STEMS.methods.newSongs,newStems:d.s.STEMS.methods.newStems,updateSongConfiguration:d.s.STEMS.methods.updateSongConfiguration}},v=n(127),m=function(){function e(t,n,r,a){Object(s.a)(this,e),this.contract=t,this.method=n,this.arguments=r,this.value=a}return Object(c.a)(e,[{key:"execute",value:function(){var e=this;return new Promise(function(){var t=Object(o.a)(a.a.mark(function t(n,r){var s,c,l;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.getAccount();case 2:if(void 0!==(s=t.sent)){t.next=6;break}return r(),t.abrupt("return");case 6:v.a.isMetamaskInstalled()?(l={from:s},e.value&&(l.value=e.value),(c=p[e.contract])[e.method].apply(c,Object(i.a)(e.arguments)).send(l,function(e,t){e?r(e):n()})):(console.log("runnign transaction"),fetch("/transaction/",{method:"POST",body:JSON.stringify(e.getJson()),headers:{Accept:"application/json","Content-Type":"application/json"},withCredentials:!0}).then(function(){var t=Object(o.a)(a.a.mark(function t(r){var i,o;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("returned ="),t.next=3,r.json();case 3:i=t.sent,o=i.transactionHash,console.log("transaction hash = "+o),e.newPendingTransaction(o),e.waitForConfirmation(o),n();case 9:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()));case 7:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"transactions",get:function(){return v.a.store.getState().transactions.pendingTransactions},set:function(e){v.a.store.dispatch(Object(h.Mc)(e))}},{key:"newPendingTransaction",value:function(e){this.transactions=[].concat(Object(i.a)(this.transactions),[e])}},{key:"waitForConfirmation",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;setTimeout(Object(o.a)(a.a.mark(function r(){return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,l(e,v.a.web3);case 2:if(!(r.sent>=n)){r.next=6;break}return t.onConfirm(e),r.abrupt("return");case 6:return r.abrupt("return",t.waitForConfirmation(e,n));case 7:case"end":return r.stop()}},r)})),3e4)}},{key:"onConfirm",value:function(e){var t=Object(i.a)(this.transactions),n=t.indexOf(e);n>-1&&(t.splice(n,1),this.transactions=t)}},{key:"getJson",value:function(){return{contract:this.contract,method:this.method,arguments:this.arguments,token:u.a.getToken(),value:this.value}}}]),e}();t.a=m},function(e,t,n){"use strict";n.d(t,"h",function(){return r}),n.d(t,"g",function(){return a}),n.d(t,"i",function(){return i}),n.d(t,"f",function(){return o}),n.d(t,"c",function(){return s}),n.d(t,"e",function(){return c}),n.d(t,"b",function(){return u}),n.d(t,"a",function(){return l}),n.d(t,"d",function(){return f});var r="SAMPLED_INSTRUMENT",a="RNBO_INSTRUMENT",i="SYNTH",o="MULTI_SYNTH",s="FM_SYNTH",c="METAL_SYNTH",u="EXTERNAL_INSTRUMENT",l="EFFECTS",f={SAMPLER:"Sampler",SYNTH:"Synth",MULTI_SYNTH:"Synth",FM_SYNTH:"FM Synth",EXTERNAL_INSTRUMENT:"External Instrument",SAMPLED_INSTRUMENT:"Sampled Instrument",RNBO_INSTRUMENT:"RNBO Instrument",INSTRUMENT_RACK:"Instrument Rack",METAL_SYNTH:"Metal Synth",EFFECTS:"FX"}},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(1446),u=n.n(c),l=n(23),f=new(function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,[{key:"setEthereum",value:function(e){this.ethereum=e}},{key:"setStore",value:function(e){this.store=e}},{key:"isMetamaskInstalled",value:function(){return!1}},{key:"appear",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAccount();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:fetch("/appear/"+t,{method:"POST",headers:{Accept:"text/html","Content-Type":"text/html"}});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isLoggedIn",value:function(){return this.store&&void 0!==this.store.getState().sequencer.userToken}},{key:"getToken",value:function(){var e=this.store.getState().sequencer.userToken;return e?e.token:void 0}},{key:"checkLogin",value:function(){var e=this;return new Promise(function(t){if(window.isNFT)t();else{var n=u.a.load("token");""!==n&&void 0!==n?fetch("/checkToken/"+n,{method:"POST",headers:{Accept:"text/html","Content-Type":"text/html"}}).then(function(){var n=Object(i.a)(a.a.mark(function n(r){var i,o;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(401!==r.status){n.next=4;break}t(!1),n.next=10;break;case 4:return n.next=6,r.text();case 6:i=n.sent,o=u.a.load("token"),e.store.dispatch(Object(l.Ue)(i,o)),t(!0);case 10:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()):t(!1)}})}},{key:"logout",value:function(){this.store.dispatch(Object(l.Ue)(void 0)),this.account=void 0,u.a.remove("token",{path:"/"})}},{key:"signUp",value:function(e,t){var n=this;fetch("/signUp/"+e+"/"+t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(r){var a=u.a.load("token");n.store.dispatch(Object(l.Ue)(e,a)),n.ethereum.crypto.password=t})}},{key:"relogin",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.login(this._userName,this._password);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"login",value:function(e,t){var n=this;return new Promise(function(r,a){fetch("/login/"+e+"/"+t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(a){if(401===a.status)r(!1);else{n._userName=e,n._password=t;var i=u.a.load("token");n.store.dispatch(Object(l.Ue)(e,i)),n.ethereum.crypto.password=t,n.ethereum.guilds.onUserChanged(),n.account=void 0,n.appear(),r(!0)}})})}},{key:"getAccount",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){var o;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.account){t.next=4;break}return o=e.account,n(o),t.abrupt("return");case 4:if(e.isLoggedIn()){t.next=7;break}return n(void 0),t.abrupt("return");case 7:fetch("/getAccount/",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include"}).then(function(){var t=Object(i.a)(a.a.mark(function t(r){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(401!==r.status&&404!==r.status){t.next=4;break}n(void 0),t.next=8;break;case 4:return t.next=6,r.text();case 6:e.account=t.sent,n(e.account);case 8:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 8:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getUserName",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMetamaskInstalled()){e.next=10;break}return e.next=3,this.ethereum.getUser();case 3:return t=e.sent,e.next=6,this.ethereum.users.getUserName(t);case 6:return n=e.sent,e.abrupt("return",n);case 10:if(!this.isLoggedIn()){e.next=14;break}return e.abrupt("return",this.store.getState().sequencer.userToken.userName);case 14:return e.abrupt("return","Not Logged In");case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}());window._accounts=f,t.a=f},,function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"function"===typeof e?e.apply(void 0,n):e}},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var r=n(272),a=n.n(r),i=new a.a(new a.a.providers.HttpProvider("https://goerli.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),o=new a.a(new a.a.providers.WebsocketProvider("wss://goerli.infura.io/ws/v3/2f3dce2af1044e88b4851c3d73c3d00c"))},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){for(var e=[],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];"function"===typeof o&&(o=o()),o=void 0===o?{}:o,e.push(o.code||o||"0.0")}return e}},,function(e,t,n){"use strict";var r=n(11),a=n(17),i=n(33),o=n(114);n(136);function s(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=new i.a,l=function e(t,n,a){var i=t;void 0===t.axiom&&(i=t(n.stepData,n.stepNumber,n.time,a,n.graphics,n.delays));var c,l,p,v;switch(i.axiom){case o.c:return Object(o.A)(i.value,n.stepData,n.stepNumber,n.time,a)?[n]:[];case o.j:(c=a.copyTrigger(n,!0)).stepData.slide=n.stepData.slide;var m=Object(o.A)(i.value,n.stepData,n.stepNumber,n.time,a);Array.isArray(m)&&(m=m[0]);var y=void 0!==m[i.param]?m[i.param]:"function"===typeof m?Object(o.A)(m,n.stepData,n.stepNumber,n.time,a):m;"object"===typeof y&&y.sequence&&(y=y.sequence[0]);var b=c.stepData[i.param+"Parameter"];return b&&b.set(y),[c];case o.m:return(c=a.copyTrigger(n,!0)).outputNumber=Object(o.A)(i.value,n.stepData,n.stepNumber,n.time,a),c.stepData.lastLeaf&&(c.stepData.lastLeaf.outputNumber=c.outputNumber),[c];case o.d:return(c=a.copyTrigger(n,!0)).grabs=[].concat(Object(r.a)(c.grabs),[{trackNumber:i.trackNumber,fromParam:i.fromParam,toParam:i.toParam,add:i.add}]),[c];case o.a:return(c=a.copyTrigger(n,!0)).chokes=[].concat(Object(r.a)(c.chokes),[{trackNumber:i.trackNumber}]),[c];case o.e:return(c=a.copyTrigger(n,!0)).grabs=[].concat(Object(r.a)(c.grabs),[{trackNumber:i.trackNumber,isTime:!0}]),[c];case o.i:var g,O=s(i.sequence);try{for(O.s();!(g=O.n()).done;){var j=g.value,k=n,w=k.time,x=k.stepNumber;Array.isArray(n)&&(w=n[0].time,x=n[0].stepNumber);var S=f(j,Array.isArray(n)?n:[n],x,w,a);if(0===S.length)return[];n=S}}catch(N){O.e(N)}finally{O.f()}return Array.isArray(n)?n:[n];case o.g:var P,E=[],T=s(i.sequence);try{for(T.s();!(P=T.n()).done;){var A=e(P.value,n,a);0!==A.length&&(E=[].concat(Object(r.a)(E),Object(r.a)(A)))}}catch(N){T.e(N)}finally{T.f()}return E;case o.l:return h(i,a.track.sequencerEngine),[n];case o.k:return d(i,a.track),[n];case o.h:return l=i.value,p=a.sequencerEngine||a.track.sequencerEngine,v=a.track,p.switchToPattern(Math.round(Object(o.A)(l)),!0,v.subSequence,void 0,void 0,!0),[n];case o.n:var M=[];if(Array.isArray(i.value))return i.value;if(0===(M=[i.value]).length){var R=a.getStep(u);R.track=a.track,M=[{stepData:R,time:n.time,stepNumber:n.stepNumber}]}return M;case o.b:var C=Object(o.A)(i.condition,n.stepData,n.stepNumber,n.time,a);return e(("object"===typeof C?C.value:C)?i.statement1:i.statement2,n,a);case o.f:return n.message&&n.message.type===i.value.type?e(i.value.fn(n.message.value),n,a):Array.isArray(n)?n:[n]}return[]},f=function e(t,n,a,i,c){var f=[];if(n.length>0){var h,d=s(n);try{for(d.s();!(h=d.n()).done;){var p=h.value;f=[].concat(Object(r.a)(f),Object(r.a)(l(t,p,c)))}}catch(g){d.e(g)}finally{d.f()}}else{if("function"!==typeof t){var v=t;t=function(){return v}}var m=t(void 0,a,i,c),y=m.axiom,b=m.value;if(y===o.n||y===o.g||y==o.i)if(m.sequence&&(f=y===o.g?[].concat(Object(r.a)(f),Object(r.a)(m.sequence.map(function(t){return e(t,n,a,i,c)}).reduce(function(e,t){return[].concat(Object(r.a)(e),Object(r.a)(t))},[]))):[].concat(Object(r.a)(f),Object(r.a)(m.sequence.reduce(function(t,n){return e(n,t,a,i,c)},n)))),Array.isArray(b)?f=[].concat(Object(r.a)(f),Object(r.a)(b)):void 0!==b&&f.push(b),y===o.n&&0===f.length)c.getStep(u).track=c.track,f.push({stepData:c.getStep(u),time:i,stepNumber:a})}return f},h=function(e,t){var n=e.number,r=e.modType,i=e.param,s=e.value;if(r===a.a){var c=t.envelopes[n][i+"Parameter"];c&&c.set(Object(o.A)(s))}else{var u=t.lfos[n].lfo[i+"Parameter"];u&&u.set(Object(o.A)(s))}},d=function(e,t){var n=e.name,r=e.value,a=t.liveEffects.effects.find(function(e){return"Macros"===e.name});if(a){var i=a.macros.find(function(e){return e.name===n});if(i){var s=Math.max(0,Math.min(1,Object(o.A)(r)));i.macroParameter.set(s)}}};n.d(t,"a",function(){return p});var p=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n,r,a){return t.reduce(function(e,t){return f(t,e,n,r,a)},e)}}},,function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=(n(6),n(139)),u=(n(123),n(14),n(456)),l=n(11),f=n(320);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var p=function(e){Object(i.a)(n,e);var t=d(n);function n(e,a){var i;return Object(r.a)(this,n),(i=t.call(this,e,a)).myScript=function(){return[]},i.isScript=!0,i}return Object(a.a)(n,[{key:"onNewStep",value:function(){this.triggers.length>0&&(this.triggers.length=0)}},{key:"currentStep",get:function(){return this.track.sequencerEngine.trackStep%this.track.length}},{key:"output",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentStep,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.currentStep;try{if(this.currentTime=e,this.actualStepNumber=r,e||this.triggers.forEach(function(e){return e.stepNumber=r}),void 0===this.myScript)return this.triggers;var a=this.restartFromSeed?[this._seedTrigger]:this.triggers;this.restartFromSeed=!1;var i=this.script(a,n,e,this);return this.graphics=[],i.forEach(function(e){var n=e.stepData,r=e.graphics;n&&(t._subSequence||(n.track=t.track)),r&&t.graphics.push(r)}),i}catch(o){return console.log("error w script=",o),[]}}},{key:"script",get:function(){return this.myScript}},{key:"isRealTime",value:function(){return!1}}]),n}(function(e){Object(i.a)(n,e);var t=h(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).tidals=[],e}return Object(a.a)(n,[{key:"useTidal",value:function(e){var t=this.tidals.find(function(e){return!e.inUse});return t&&!e?(t.inUse=!0,t):((t=new f.a(this.track,this)).inUse=!0,this.tidals=[].concat(Object(l.a)(this.tidals),[t]),t)}},{key:"freeTidals",value:function(){this.tidals.forEach(function(e){e.inUse?e.lastUsed=0:e.lastUsed=(e.lastUsed||0)+1,e.inUse=!1})}},{key:"getTidalsInUse",value:function(){return this.tidals.filter(function(e){return e.inUse})}}]),n}(Object(u.a)(c.a)));t.a=p},function(e,t,n){"use strict";n.d(t,"e",function(){return r}),n.d(t,"d",function(){return a}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return s});var r="zobject",a="zmessage",i="pad",o="track",s="effect"},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(9),o=n(621),s=n(376),c=function(){function e(t,n){Object(r.a)(this,e),this.mix=t,this.type=n}return Object(a.a)(e,[{key:"mixByType",get:function(){var e=Object(i.s)(this.type)?this.mix.deterministicMixesByType:this.mix.mixesByType;return this.type in e||(Object(i.s)(this.type)?e[this.type]=new o.a(this.type):e[this.type]=new s.a(this.type)),e[this.type]}},{key:"events",get:function(){return this.mixByType.events},set:function(e){this.mixByType.events=e}},{key:"execute",value:function(){}},{key:"getDuration",value:function(e){for(var t=0;t<this.events.length;t++){var n=this.events[t];if(void 0===e)return n.step-e.step}return 0}},{key:"calculateDurations",value:function(){for(var e=[],t=void 0,n=0;n<this.events.length;n++){var r=this.events[n];void 0!==t&&r.isEquivalent(t)||e.push(r),t=r}this.events=e,t=void 0;for(var a=0;a<this.events.length;a++){var i=this.events[a];void 0!==t&&(t.duration=i.step-t.step),t=i}}}]),e}();t.a=c},function(e,t,n){"use strict";n.d(t,"t",function(){return c}),n.d(t,"s",function(){return l}),n.d(t,"u",function(){return f}),n.d(t,"r",function(){return h}),n.d(t,"o",function(){return d}),n.d(t,"p",function(){return p}),n.d(t,"b",function(){return v}),n.d(t,"a",function(){return m}),n.d(t,"d",function(){return y}),n.d(t,"j",function(){return b}),n.d(t,"e",function(){return g}),n.d(t,"m",function(){return O}),n.d(t,"h",function(){return j}),n.d(t,"i",function(){return k}),n.d(t,"k",function(){return w}),n.d(t,"c",function(){return x}),n.d(t,"n",function(){return S}),n.d(t,"g",function(){return P}),n.d(t,"f",function(){return E}),n.d(t,"l",function(){return T}),n.d(t,"q",function(){return M});var r=n(11),a=n(1),i=n(114);n(653);function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=void 0;return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];var s,c=[],u=!1,l=0,f=o(t=t.map(function(e){return i.A.apply(void 0,[e].concat(n))}).flat(4));try{for(f.s();!(s=f.n()).done;){var h=s.value,d={};for(var p in h)d[p]=i.A.apply(void 0,[h[p]].concat(n)),"counter"!==p&&r&&r[l]&&r[l][p]&&"object"!==typeof d[p]&&r[l][p]!==d[p]&&(u=!0);c.push(d),l++}}catch(v){f.e(v)}finally{f.f()}return!u&&r?r:(r=c,c)}},u=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r={decide:function(e){return Object(a.a)({},t,{decide:e})},always:function(e){return Object(a.a)({},t,{always:e})},alt:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Object(a.a)({},t,{alt:n})},series:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Object(a.a)({},t,{series:n})},never:function(e){return Object(a.a)({},t,{never:e})}};return n<=3&&(r.later=function(r){return e(Object(a.a)({},t,{delay:r}),n++)},r.first=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e(Object(a.a)({},t,{firstOffset:r}),n++)},r.last=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e(Object(a.a)({},t,{lastOffset:r}),n++)},r.figure=function(r,i){return e(Object(a.a)({},t,{figureFrom:r,figureTo:i}),n++)},r.every=function(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e(Object(a.a)({},t,{every:r,offset:i}),n++)},r.max=function(r){return e(Object(a.a)({},t,{max:r}),n++)},r.skip=function(r){return e(Object(a.a)({},t,{skip:r}),n++)}),r},l=function(){var e={otherwise:!0,every:1,offset:0,counter:0};return Object(a.a)({},e,u(e))},f=function(e){var t={when:e,every:1,offset:0,counter:0};return Object(a.a)({},t,u(t))},h=function(e){var t={before:e,every:1,offset:0,counter:0};return Object(a.a)({},t,u(t))},d=function(e){var t={after:e,every:1,offset:0,counter:0};return Object(a.a)({},t,u(t))},p=function(e,t,n,r,i,s){var c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];arguments.length>7&&arguments[7];if(!t)return[];var u,l=[],f=[],h=[],d=o(t);try{for(d.s();!(u=d.n()).done;){var p=u.value;if(A(e,p)){var v=p.firstOffset,m=p.lastOffset,y=p.delay,b=p.every,g=p.offset,O=(p.max,p.skip,p.figureFrom),j=p.figureTo;if(void 0!==O){if(void 0===j&&O!==r)continue;if(void 0!==j&&(O>r||r>j))continue}if(void 0!==v&&i!==v&&v>=0)continue;if(void 0!==m&&s-i-1!==m&&m>=0)continue;if(c||p.counter++,p.max&&p.counter>p.max)continue;if(void 0!==p.skip&&p.counter<=p.skip)continue;if((p.counter-1)%b!==g)continue;if(h.push(p),p.decide)n()&&(y?f.push(Object(a.a)({delay:y},p.decide)):l.push(p.decide));else if(p.always)y?f.push(Object(a.a)({delay:y},p.always)):Array.isArray(p.always)?p.always.forEach(function(e){return l.push(e)}):l.push(p.always);else if(p.alt){var k=p.alt;y?f.push(Object(a.a)({delay:y},k[(p.counter-1)%k.length])):l.push(k[(p.counter-1)%k.length])}else p.series?p.series.forEach(function(e,t){(Array.isArray(e)?e:[e]).forEach(function(e){0===t?l.push(e):f.push(Object(a.a)({delay:t},e))})}):p.never}}}catch(w){d.e(w)}finally{d.f()}return{actions:l,delayedActions:f,matchedRules:h}},v={type:"any",value:""},m={type:"accent",value:""},y={type:"flam",value:""},b={type:"regular",value:""},g={type:"legato",value:""},O={type:"staccato",value:""},j={type:"pianissimo",value:""},k={type:"piano",value:""},w={type:"rest",value:""},x={type:"double",value:""},S={type:"times",value:""},P={type:"nudge-forward",value:""},E={type:"nudge-backward",value:""},T=[x,w,O,g,m,b,k,j,P,E,y],A=function(e,t){return e.when&&t.when?e.when.type===t.when.type&&e.when.value===t.when.value:e.before&&t.before?e.before.type===t.before.type&&e.before.value===t.before.value:e.after&&t.after?e.after.type===t.after.type&&e.after.value===t.after.value:!(!e.otherwise||!t.otherwise)},M=function e(t,n,i){if(Array.isArray(t)){if("regular"===n.type)return t[0];var o=Object(r.a)(t);if("accent"===n.type||"double"===n.type){var s=e(t[0],n,i);o[0]=s}else o=t.map(function(t){return e(t,n,i)});return o.cycleLength=t.cycleLength,o}switch(t=Object(a.a)({},t),n.type){case"flam":t.flam=!0;break;case"regular":t.staccato=!1,t.transpose=0,t.flam=!1,t.piano=!1,t.pianissimo=!1;break;case"nudge-forward":t.nudgeForward=!0,t.nudgeBackward=!1,t.transpose=0;break;case"nudge-backward":t.nudgeBackward=!0,t.nudgeForward=!1,t.transpose=0;break;case"staccato":t.staccato=!0,t.transpose=0;break;case"legato":t.legato=!0,t.staccato=!1,t.transpose=0;break;case"accent":t.accent=!0,t.pianissimo=!1,t.piano=!1,t.transpose=0;break;case"rest":t.transpose=null,t.accent=!1;break;case"pianissimo":t.pianissimo=!0,t.accent=!1,t.transpose=0;break;case"piano":t.piano=!0,t.accent=!1,t.transpose=0;break;case"double":if(t.transpose=0,i)return t;t=R(t);break;case"times":t=new Array(n.value).fill(t)}return t},R=function(e){if("."===e.type.type){var t=Object(a.a)({},e),n=Object(a.a)({},e);t.type={type:"-",value:0},n.type={type:"-",value:1};var r=[t,n];return n.accent=!1,r.cycleLength=1,r}var i=Object(a.a)({},e),o=Object(a.a)({},e),s=Object(a.a)({},e),c=Object(a.a)({},e);o.accent=!1,s.accent=!1,c.accent=!1,i.type={type:"."},o.type={type:"."},s.type={type:"-",value:0},c.type={type:"-",value:1};var u=[i,o,s,c];return u.doubled=!0,u.cycleLength=2,u}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],o={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11},s={"C#":!0,"D#":!0,"F#":!0,"G#":!0,"A#":!0},c={},u=function(){function e(t,n){Object(r.a)(this,e),void 0===t&&(t="C"),this.note=t.toUpperCase(),this.octave=n}return Object(a.a)(e,[{key:"isBlackNote",value:function(){return s[this.note]}},{key:"transpose",value:function(t){this.note;var n=Math.floor(f(t,12)),r=Math.floor(t/12);return new e(i[n],this.octave+r)}},{key:"addTranspose",value:function(t){var n=o[this.note],r=Math.floor(f(t+n,12)),a=Math.floor((t+n)/12);return new e(i[r],this.octave+a)}},{key:"toString",value:function(){return this.note+this.octave}},{key:"getTranspose",value:function(){this.noteIndex();return 12*(this.octave-l.octave)+(this.noteIndex()-l.noteIndex())}},{key:"noteIndex",value:function(){return o[this.note]}},{key:"getCopy",value:function(){return new e(this.note,this.octave)}},{key:"equal",value:function(e){return this.note===e.note&&this.octave===e.octave}}]),e}(),l=new u("C",3);function f(e,t){return(e%t+t)%t}function h(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t&&c[e])return c[e];var n=void 0;return n="#"===e.substring(1,2)?new u(e.substring(0,2),parseInt(e.substring(2))):new u(e.substring(0,1),parseInt(e.substring(1))),t&&(c[e]=n),n}for(var d=i.map(function(e){return new u(e,3)}),p=0;p<16;p++)for(var v in i){h(i[v]+p)}t.a={Note:u,middleC:l,fromString:h,fromTranspose:function(e){return l.getCopy().transpose(e)},NOTES:d,baseNotes:i}},,function(e,t,n){"use strict";var r=n(32),a=n(108),i=n(3),o=n.n(i),s=n(567),c=n(166),u=n(313),l=n.n(u),f=n(55),h=function(e,t){return e<0?-1*Math.pow(Math.abs(e),t):Math.pow(e,t)},d=Object(f.b)(function(e,t){if(t.parameter){var n=e.effects.effectParameters[t.parameter.id];return{value:void 0===n?t.parameter.get(!0):n}}},function(e){return{}})(function(e){var t=e.parameter,n=(e.convertToRoot,e.onMouseUp),r=e.value,a=e.root,i=e.onUpdateParameter,s=e.step,c=e.max,u=e.min,f=h(parseFloat(r),1/a);return o.a.createElement(l.a,{slideStop:n,value:t.convertToRoot?Math.log2(f):f,change:i,step:s,max:c,min:u,orientation:"horizontal",reversed:!1})}),p=n(133),v=n(6),m=n.n(v),y=n(176);var b=Object(f.b)(function(e,t){if(t.parameter){var n=e.effects.effectParameters[t.parameter.id];return{value:void 0===n?t.parameter.get(!0):n}}},function(e){return{}})(function(e){var t=e.displayFunction,n=e.unit,r=e.isParameter,a=e.parameter,s=e.onEdit,u=e.value,l=Object(c.a)(e,["displayFunction","unit","isParameter","parameter","onEdit","value"]),f=Object(i.useCallback)(function(){if(void 0===u||null===u)return 0;if("object"===typeof u){if(u.toSeconds)return u.toSeconds();if(u._val)return new m.a.Time(u._val).toSeconds()}else if("string"===typeof u)return new m.a.Time(u).toSeconds();return u},[u]),h=Object(i.useCallback)(function(){var e=f();return void 0!==e?e:r?a.get():l.getValue()},[a,u]);n=n||"";var d=(void 0===t?function(e){return Math.round(1e3*e)/1e3}(u):t(h()))+" "+n;return o.a.createElement(y.a,{element:p.y,className:"pushable parameter-label-value",onClick:function(e){return s(e)}},l.convertToRoot?Math.round(Math.log2(d)):d)}),g=n(223),O=n(43),j=Object(f.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.setEditing,n=e.onUpdateParameter,r=e.value,s=(e.editedValue,Object(i.useState)(r)),c=Object(a.a)(s,2),u=c[0],l=c[1],f=Object(i.useCallback)(function(e){(Object(O.a)(e)||"."===e||""===e||"-"===e||"-."===e)&&(l(e),n({target:{value:e}},!1))},[l,n]),h=Object(i.useCallback)(function(e){"Enter"===e.key&&t(!1)},[t]);return o.a.createElement(g.c,{className:"tag-sound-input"},o.a.createElement(g.b,{value:u,onKeyUp:h,onChange:function(e){return f(e.target.value)},placeholder:"Parameter",className:"parameter-input-box"}))}),k=n(23),w=n(980),x=n(44),S=n(124),P=n(62),E=(n(26),n(45)),T=function(e,t){return e<0?-1*Math.pow(Math.abs(e),t):Math.pow(e,t)},A=new S.a,M=function(e,t){return e<0?-1*Math.pow(Math.abs(e),t):Math.pow(e,t)};var R=Object(f.b)(function(e,t){return t.parameter?{midiMapMode:e.midi.midiMapMode,hasAutomations:t.parameter.automations&&t.parameter.automations.length>0}:{}},function(e){return{deleteParameterMidiMapping:function(t){return e(Object(k.e)(t))},setParameterSliderDown:function(t){return e(Object(k.Hc)(t))},setEffectParameterValue:function(t,n){return e(Object(k.wb)(t,n))},setShowAutomation:function(t){return e(Object(k.Od)(t))},setBottomMode:function(t){return e(Object(k.y)(t))},setShowPianoRoll:function(t){return e(Object(k.Wd)(t))}}})(function(e){var t=e.step,n=e.root,r=(e.deleteParameterMidiMapping,e.showAutomation),s=e.onClickParameterName,u=(e.setShowModulators,e.midiMapRef),l=e.onMouseDown,f=e.isMouseDown,h=(e.setShowModulator,Object(c.a)(e,["step","root","deleteParameterMidiMapping","showAutomation","onClickParameterName","setShowModulators","midiMapRef","onMouseDown","isMouseDown","setShowModulator"])),p=Object(i.useState)(M(h.max,1/n)),v=Object(a.a)(p,2),m=v[0],g=(v[1],Object(i.useState)(M(h.min,1/n))),k=Object(a.a)(g,2),S=k[0],P=(k[1],function(e,t){var n=e.root,r=e.isMouseDown,o=e.onMouseDown,s=e.midiMapRef,c=(e.convertToRoot,Object(i.useRef)(t.parameter)),u=Object(i.useState)(!1),l=Object(a.a)(u,2),f=l[0],h=l[1],d=Object(i.useState)(t.value||t.parameter&&t.parameter.get(!0)),p=Object(a.a)(d,2),v=p[0],m=p[1],y=Object(i.useCallback)(function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.stopPropagation(),n!==f&&n&&m(t.value),h(n)},[h,m,t.value,f]),b=Object(i.useCallback)(function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=e.target.value;if(r)o(),a=T(a,n);else if("."===a||"-."===a)a=0;else if("-"===a)a=0;else if("-."===a)a=0;else if(""===a)a=0;else{if(!Object(O.a)(a))return;a=parseFloat(a)}var i=c.current;i.convertToRoot&&(a=Math.pow(2,a)),s.current===E.b&&(console.log("setting parameter midi map selected",i),t.setParameterMidiMapSelection(i.id));var u=t.sequencerEngine&&t.sequencerEngine.operationManager;u?u.dispatch(Object(x.s)(i,a,!1,!1)):i.set(a,!1),m(a)},[m,n]);Object(i.useEffect)(function(){f||!r.current&&t.parameter&&m(t.parameter.get(!0))},[f,t.parameter,m]);var g=Object(i.useCallback)(function(e){"Enter"===e.key&&h(!1)},[h]);return Object(i.useEffect)(function(){c.current=t.parameter},[t.parameter]),{onEdit:y,value:v,setValue:m,onUpdateParameter:b,setEditing:h,onKeyPress:g,editing:f}}({root:n,midiMapRef:u,convertToRoot:h.convertToRoot,isMouseDown:f,onMouseDown:l},h)),R=P.onEdit,C=P.editing,N=(P.onKeyPress,P.setEditing),I=P.value,q=P.onUpdateParameter;P.onTypedInputChanged,P.inputValue;Object(i.useEffect)(function(){u.current=h.midiMapMode},[h.midiMapMode]);var _=Object(i.useCallback)(function(){h.setParameterSliderDown(void 0),h.parameter&&(h.parameter.automation.smoothen(),h.parameter.mixAutomation.smoothen()),f.current=!1},[I,h.parameter]),D=Object(i.useCallback)(function(){h.pLockedSteps.forEach(function(e){return h.parameter.deletePLockForStep(e)})},[h.pLockedSteps,h.parameter]);return o.a.createElement("div",{className:"slider-and-labels"},o.a.createElement("div",{className:"parameter-label-container"},o.a.createElement("div",{className:"parameter-label effect-parameter-label"},o.a.createElement(y.a,{element:h.parameter,onClick:function(){return s()},className:"pushable parameter-label-name"},h.name,": "),C&&o.a.createElement(j,{setEditing:N,onUpdateParameter:q,value:I}),!C&&o.a.createElement(b,{convertToRoot:h.convertToRoot,unit:h.unit,displayFunction:h.displayFunction,isParameter:h.isParameter,onEdit:R,getValue:h.getValue,parameter:h.parameter}),!C&&h.pLockedSteps&&o.a.createElement("div",{onClick:D,style:{backgroundColor:A.getColorForTrack(h.pLockedSteps[0].track)},className:"p-lock-indicator"},"P-Locked"),h.hasAutomations&&o.a.createElement("img",{onClick:function(){return r()},src:"/automation-icon-disabled.png",className:"automation-icon"}))),h.children,o.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},className:"slider-and-modulators"},!h.hideSlider&&o.a.createElement(d,{onMouseUp:_,convertToRoot:h.convertToRoot,onUpdateParameter:q,parameter:h.parameter,step:t,max:m,min:S,root:n}),o.a.createElement(w.a,{sequencerEngine:h.sequencerEngine,parameter:h.parameter})))}),C=Object(f.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.parameter,n=Object(i.useState)(t&&void 0!==t.keyScaling),r=Object(a.a)(n,2),s=r[0],c=r[1];Object(i.useEffect)(function(){t&&c(void 0!==t.keyScaling)},[t,c]);var u=Object(i.useCallback)(function(){s?t.disableKeyScaling():t.enableKeyScaling(),t.context.track&&(console.log("clearing cache"),t.context.track.parametersToScale=void 0),c(!s)},[t,c,s]),l="key-scaling-toggle pushable ";return s&&(l="key-scaling-toggled pushable"),o.a.createElement("div",{onClick:u,className:l})}),N=n(894),I=n(4),q=n(5),_=n(7),D=n(8),F=n(2);function L(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(F.a)(e);if(t){var a=Object(F.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(D.a)(this,n)}}var B=function(e){Object(_.a)(n,e);var t=L(n);function n(e){var r;return Object(I.a)(this,n),(r=t.call(this,e)).state={},r}return Object(q.a)(n,[{key:"isToggled",value:function(){return this.props.parameter&&this.props.parameter.isConnectedToEnvelope(this.props.envelope)}},{key:"toggle",value:function(){this.props.parameter.isAudioParamEnabled()||this.props.parameter.enableAudioParam(),this.isToggled()?this.props.parameter.disconnectFromEnvelope(this.props.envelope):(this.props.parameter.connectToEnvelope(this.props.envelope),this.props.setSelectedEnvelope(this.props.envelope.number)),this.setState({toggled:this.isToggled()})}},{key:"onMouseOver",value:function(e){e.stopPropagation(),this.props.setContextualHelp(p.j)}},{key:"showMods",value:function(e){this.props.setShowEnvelopes(!0)}},{key:"render",value:function(){var e=this,t=this.isToggled()?" toggled ":"",n=this.props.envelopes.indexOf(this.props.envelope);return o.a.createElement("div",{onMouseOver:function(t){return e.onMouseOver(t)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.toggle()},className:"pushable parameter-envelope-toggle lfo-"+n+t},n+1)}}]),n}(i.PureComponent),z=Object(f.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(k.bb)(t))},setSelectedEnvelope:function(t){return e(Object(k.sd)(t))},setShowEnvelopes:function(t){return e(Object(k.Qd)(t))},setArrangementBottomMode:function(t){return e(Object(k.y)(t))},setShowPianoRoll:function(t){return e(Object(k.Wd)(t))}}})(B),J=(n(52),n(280)),V=new S.a;t.a=Object(f.b)(function(e,t){if(void 0===t.parameter)return{};t.parameter&&t.parameter.id;var n=e.keyboard.selectedPianoRollSteps,r=n&&n.length>0&&t.parameter&&n.filter(function(e){return e&&e.id in t.parameter.stepToValue});return{context:t.parameter&&t.parameter.context,pLockedSteps:r&&0!==r.length?r:void 0,isMidiSelected:e.midi.parameterSelected&&t.parameter.id===e.midi.parameterSelected,isSelected:t.parameter===e.effects.accumulatorParameterSelected,midiMapMode:e.midi.midiMapMode,isMacroMapping:e.effects.isMacroMapping,isParameterToMap:e.effects.parameterToMap&&t.parameter&&e.effects.parameterToMap===t.parameter,isSelectedParameter:t.parameter&&e.effects.accumulatorParameterSelected==t.parameter,isAccumulated:t.parameter&&t.parameter.isMapped,depthParameter:t.parameter&&t.parameter.depthParameter}},function(e){return{setEffectParameterValue:function(t,n){return e(Object(k.wb)(t,n))},setContextualHelp:function(t){return e(Object(k.bb)(t))},setParameterMidiMapSelection:function(t){return e(Object(k.Dc)(t))},deleteParameterMidiMapping:function(t){return e(Object(k.e)(t))},setParameterToMap:function(t){return e(Object(k.Ic)(t))},setParameterSliderDown:function(t){return e(Object(k.Hc)(t))},setShowAutomation:function(t){return e(Object(k.Od)(t))},setBottomMode:function(t){return e(Object(k.y)(t))},setShowPianoRoll:function(t){return e(Object(k.Wd)(t))},setTrackAutomationParameter:function(t,n){return e(Object(k.pe)(t,n))},setAccumulatorParameterSelected:function(t){return e(Object(k.n)(t))}}})(function(e){var t=Object(i.useRef)(void 0),n=Object(i.useRef)(e.midiMapMode),c=Object(i.useRef)(!1),u=Object(i.useCallback)(function(){e.setParameterSliderDown(e.parameter),c.current=!0},[]),l=Object(i.useState)(!(!e.parameter||!e.parameter.isConnectedToAnyModulator)&&e.parameter.isConnectedToAnyModulator()),f=Object(a.a)(l,2),h=f[0],d=f[1],v=Object(i.useState)(!1),m=Object(a.a)(v,2),y=(m[0],m[1],Object(i.useState)(e.value||e.parameter&&e.parameter.get(!0))),b=Object(a.a)(y,2),g=(b[0],b[1],Object(i.useState)(e.value||e.parameter&&e.parameter.get(!0))),O=Object(a.a)(g,2),j=(O[0],O[1],Object(i.useRef)(0)),w=e.root||1;Object(i.useEffect)(function(){e.parameter&&e.parameter.isConnectedToAnyModulator()&&d(!0)},[e.parameter&&e.parameter.isConnectedToAnyModulator()]),Object(i.useEffect)(function(){e.isSelected&&x()},[]),Object(i.useEffect)(function(){e.isSelected&&x()},[e.isSelected]);var x=function(){if(!e.parameter.isMapped||!e.parameter.context||e.parameter.isMapped.track!==e.parameter.context.track){for(var n=t.current,r=n,a=0;n&&n&&n.className&&!(n.className.includes("effects-view")||a>=20);)n=n.parentNode,a++;if(!n.className&&n.className.includes("effects-view")){var i=r.offsetLeft;i>n.offsetWidth?n.scroll(i,0):n.scroll(0,0)}}},S=(e.sequencerEngine&&e.sequencerEngine.operationManager,Object(i.useCallback)(function(){return e.parameter?e.parameter.availableLFOs:[]},[e.lfos,e.parameter])),T=function(){return e.parameter?e.parameter.availableEnvelopes:[]},A=Object(i.useCallback)(function(){var t=e.isMacroMapping,n=e.parameter,r=e.isParameterToMap;if(t&&n&&!n.isMapped){var a="macro-overlay";r&&(a+=" parameter-to-map"),n.hasMacro&&(a+=" mapped");var i={};e.parameter.hasMacro&&(i={backgroundColor:V.getColorForHash(n.hasMacro.id)});var s=n.hasMacro&&n.hasMacro.name;return o.a.createElement("div",{onClick:function(t){t.stopPropagation(),e.parameter.isMapped||e.setParameterToMap(e.parameter)},className:a},o.a.createElement("div",{className:"overlay-main"}),o.a.createElement("div",{className:"overlay-detail",style:i},s))}return""},[e.parameter,e.parameterToMap,e.isMacroMapping]),M=Object(i.useState)(S()),I=Object(a.a)(M,2),q=I[0],_=I[1],D=Object(i.useState)(T()),F=Object(a.a)(D,2),L=F[0],B=F[1],H=void 0!==e.customClassName?e.customClassName:"",U=e.isSelectedParameter;H+=U?" selected-parameter parameter-box":"parameter-box";var G=e.refined?.01:e.step;Object(i.useEffect)(function(){_(S()),B(T())},[e.parameter&&e.parameter.context,B,_]),e.isMidiSelected&&e.midiMapMode===E.b&&(H+=" midi-selected");e.contextualHelp||p.f;e.isSelected&&(H+=" accumulator-selected");var W=e.parameter&&e.parameter.id;W&&(W="parameter-"+W);var K=Object(i.useCallback)(function(){n.current===E.b?Object(k.e)(e.parameter.id):void 0!==e.sequencerEngine&&d(!0);var t=(new Date).getTime();t-j.current<=250&&Q(),j.current=t},[d,e.parameter]),Q=Object(i.useCallback)(function(){if(e.setShowAutomation(!0),e.setShowPianoRoll(!0),e.setBottomMode(P.b),e.parameter.track){var t=e.parameter.track.instrumentRack?e.parameter.track.instrumentRack:e.parameter.track;e.setTrackAutomationParameter(t.id,e.parameter)}},[e.parameter]);return o.a.createElement("div",{onContextMenu:function(e){e.stopPropagation(),e.preventDefault()},ref:t,id:W,className:H},e.isAccumulated?o.a.createElement("div",{onClick:function(){return e.setAccumulatorParameterSelected(U?void 0:e.parameter)},className:"accumulator-corner"}):"",A(),o.a.createElement(R,{max:e.max,midiMapRef:n,onMouseDown:u,onClickParameterName:K,showAutomation:Q,isMouseDown:c,min:e.min,setShowModulators:d,hideSlider:e.hideSlider,sequencerEngine:e.sequencerEngine,root:w,displayFunction:e.displayFunction,convertToRoot:e.convertToRoot,parameter:e.parameter,pLockedSteps:e.pLockedSteps,setParameterMidiMapSelection:e.setParameterMidiMapSelection,step:G,name:e.name},o.a.createElement(J.a,{condition:e.lfoEnabled&&(void 0===e.sequencerEngine||h)},o.a.createElement("div",{className:"lfo-boxes"},q&&q.map(function(t,n){var a;return o.a.createElement(N.a,(a={connectToLFO:e.connectToLFO,key:n,isToggled:e.parameter&&e.parameter.isConnectedToLFO(t),parameter:e.parameter,lfo:t,lfos:q},Object(r.a)(a,"parameter",e.parameter),Object(r.a)(a,"instrument",e.instrument),a))}),L&&L.map(function(t,n){var a;return o.a.createElement(z,(a={key:n,isToggled:e.parameter&&e.parameter.isConnectedToEnvelope(t),parameter:e.parameter,envelope:t,envelopes:L},Object(r.a)(a,"parameter",e.parameter),Object(r.a)(a,"instrument",e.instrument),a))}),o.a.createElement(C,{parameter:e.parameter}))),o.a.createElement("div",{className:"clear-fix"})),e.parameter&&e.parameter.depthParameter&&e.parameter.isConnectedToAnyModulator()&&o.a.createElement(s.a,{display:function(e){return Math.round(100*e)+"%"},min:0,max:1,width:70,label:"Amount",name:"",parameter:e.parameter.depthParameter}))})},,,function(e,t,n){"use strict";var r=n(166),a=n(3),i=n.n(a),o=n(55),s=n(23);window.mouseDownX=0,document.body.onmousedown=function(){++window.mouseDownX},document.body.onmouseup=function(){--window.mouseDownX};var c=Object(a.memo)(function(e){var t=e.object,n=e.refObj,o=e.element,s=e.setContextualHelp,c=e.arg,u=e.children,l=e.className,f=void 0===l?"":l,h=Object(r.a)(e,["object","refObj","element","setContextualHelp","arg","children","className"]);t&&t.docElement&&(o=t.docElement);var d=Object(a.useCallback)(function(e){s(o,c)},[]),p=Object(a.useCallback)(function(){s(void 0)},[]);return f+=" documented ",i.a.createElement("div",Object.assign({},h,{ref:n,className:f,onMouseLeave:p,onMouseOver:d}),u)});t.a=Object(o.b)(null,function(e){return{setContextualHelp:function(t,n){return e(Object(s.bb)(t,n))}}})(c)},,function(e,t,n){"use strict";var r=n(1),a=n(42),i=n.n(a),o=n(56),s=n(11),c=n(108),u=n(4),l=n(5),f=n(31),h=n(10),d=n(7),p=n(8),v=n(2),m=n(116),y=n(6),b=n.n(y),g=n(141),O=n(23),j=n(315),k=(n(115),new(function(){function e(){Object(u.a)(this,e),this.tracks=[],this.sends=[]}return Object(l.a)(e,[{key:"useSend",value:function(){return 0!==this.sends.length&&window.explore?this.sends.pop():new b.a.Volume(-100)}},{key:"releaseSend",value:function(e){window.explore?(e.disconnect(),e.volume.value=-100,this.sends.push(e)):e.dispose()}},{key:"useTrack",value:function(){return 0!==this.tracks.length&&window.explore?this.tracks.pop():{gainNode:new b.a.PanVol,volumeNode:new b.a.Volume,muteableNode:new b.a.Volume,trackNode:new b.a.Solo,trackMeter:new b.a.Meter(.9),faderNode:new b.a.Gain}}},{key:"releaseTrack",value:function(e){for(var t in e){var n=e[t];window.explore?n.disconnect():n.dispose()}this.tracks.push(e)}}]),e}())),w=n(251),x=n(948),S=n(438),P=n(134),E=n(168),T=n(302),A=n(20),M=n(584),R=n(949),C=(n(427),n(222)),N=n(950),I=(n(282),n(123)),q=n(425),_=n(951),D=(n(66),n(128)),F=n(113),L=n(14),B=function(){function e(t){Object(u.a)(this,e),this.track=t,this.choke=void 0,this.transposeMatch=void 0,this.chokingDuration=0,this.isLiveTriggering=!1}return Object(l.a)(e,[{key:"onStep",value:function(){this.chokingDuration=Math.max(this.chokingDuration-1,0)}},{key:"newChoke",value:function(e,t){this.chokingDuration=e,this.track.releaseAll(t)}},{key:"isChoked",value:function(){return this.isLiveTriggering||this.chokingDuration>0}},{key:"liveTrigger",value:function(){this.choke&&(this.choke.chokes.isLiveTriggering=!0,this.choke.releaseAll())}},{key:"liveRelease",value:function(){this.choke&&(this.choke.chokes.isLiveTriggering=!1)}},{key:"getJson",value:function(){return{choke:void 0===this.choke?void 0:this.choke.trackNumber}}},{key:"fromJson",value:function(e,t){void 0!==e.choke&&(this.choke=t[e.choke])}}]),e}(),z=n(321),J=n(44),V=n(122),H=n(579),U=n(199),G=n(450),W=n(130),K=n(283),Q=n(952),Z=n(581),Y=function(){function e(){Object(u.a)(this,e),this.type=Z.a,this.nameToMidiInput={}}return Object(l.a)(e,[{key:"addMidiInput",value:function(e){this.nameToMidiInput[e.name]=e,this.type=Z.c}},{key:"deleteMidiInput",value:function(e){e.name in this.nameToMidiInput&&(delete this.nameToMidiInput[e.name],0===Object.keys(this.nameToMidiInput).length&&(this.type=Z.a))}},{key:"setType",value:function(e){e!==Z.a&&e!==Z.b||(this.nameToMidiInput={}),this.type=e}},{key:"accepts",value:function(e,t){return this.type===Z.a||(e?t in this.nameToMidiInput:this.type===Z.b)}},{key:"getMidiInputs",value:function(){return Object.values(this.nameToMidiInput)}},{key:"getMidiInputNames",value:function(){return Object.keys(this.nameToMidiInput)}}]),e}(),$=(n(68),n(67)),X=(n(69),n(258)),ee=(n(70),n(43),n(143)),te=n(46),ne=(n(271),n(255)),re=n(992),ae=n(33),ie=n(237),oe=n(21),se=(n(240),n(35)),ce=n(182),ue=function(){function e(t,n){Object(u.a)(this,e),this.envelope=t,this.mode=n}return Object(l.a)(e,[{key:"equals",value:function(e){return this.envelope===e.envelope&&this.mode===e.mode}},{key:"getJson",value:function(){return{envelope:this.envelope.number-1,mode:this.mode}}}]),e}(),le=n(583),fe=n(127),he=n(953);function de(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var a=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(p.a)(this,n)}}var pe=n(954);function ve(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var a=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(p.a)(this,n)}}var me=new(n(124).a),ye=n(588);function be(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ge(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Oe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var a=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(p.a)(this,n)}}var je=fe.a.presets,ke=new oe.a(32,!1),we=new oe.a(16,!1),xe=function(e){Object(d.a)(n,e);var t=Oe(n);function n(e,r,a,i,o,s){var l;Object(u.a)(this,n),(l=t.call(this)).subSequence=s,l.id=Object(A.uuid)(),l.trackNumber=e,l.gated=!0,l.sequencerEngine=r,l.sequencerEngine.idToObject[l.id]=Object(f.a)(l),l.store=r.store,l.parameters=[],l.update=o;var h=k.useTrack(),d=h.gainNode,p=h.volumeNode,v=h.muteableNode,m=h.trackNode,y=h.trackMeter,b=h.faderNode;l.gainNode=d,l.volumeNode=p,l.muteableNode=v,l.trackNode=m,l.trackMeter=y,l.faderNode=b,l.volumeParameter=new F.c("volume",l.volumeNode.volume,{defaultValue:0,prettyName:"Track Volume",min:-60,max:6,isDb:!0,onChange:function(e){l.pad&&l.pad.sendSliderLevels()}},.1),l.registerParameter(l.volumeParameter),l.trackNode.connect(l.volumeNode),l.volumeNode.connect(l.faderNode),l.faderNode.connect(l.muteableNode),l.muteableNode.connect(l.trackMeter),l.muted=!1,l.sendNodes=[],l.sendNodeVolumeParameters=[],l.patternNumberLocked=void 0,l.pattern=new ne.a(l.sequencerEngine,Object(f.a)(l)),l.patterns=[l.pattern];for(var g=1;g<i;g++)l.patterns.push(new ne.a(l.sequencerEngine,Object(f.a)(l)));return l.currentPattern=l.getInitialPattern(),l.soundIds=[],l.auditionedSounds=[],l.toAudition=[],l.trackData=new ae.a(void 0,l.mix,(new I.a).forTrack(Object(f.a)(l))),l.trackData.loadDefaults(),l.on=!1,l.samplers={},l.group=null,l.selectedStep=void 0,l.name=void 0,l.videoId="",l.resampler=void 0,l.masterResampler=new _.a(l.sequencerEngine,l.volumeNode),l.effectsChains=[new w.a(l.gainNode,l.trackNode,(new I.a).forTrack(Object(f.a)(l)),l.sequencerEngine)],l.effectsChains[0].initDefault(),l.midiEffects=new S.a(Object(f.a)(l)),l.liveEffects=new R.a(Object(f.a)(l)),l.midiInputs=new Y,l.samples=[],l.connectedEnvelopes=[],l.frozenSamplesToSave=[],l.chokes=new B(Object(f.a)(l)),l.outputTypeConfigured=H.a,l.outputTypeParameter=new L.a("outputType",Object(f.a)(l),function(e,t){return l.changeOutputType(t)},{defaultValue:H.a,automatable:!1}),l.registerParameter(l.outputTypeParameter),l.skipMidiMasterParameter=new L.a("skipMidiMaster",Object(f.a)(l),function(e,t){return[]},{defaultValue:!1,automatable:!1}),l.registerParameter(l.skipMidiMasterParameter),l.newFrozenColumn(),l.disabled=!1,l.stepGroups=[],l.newInlet("trigger ",function(e){var t=Object(c.a)(e,1)[0];return l.onTrigger(t)}),l.newInlet("transpose",function(e){var t=Object(c.a)(e,1)[0];return l.trackData.transpose=t}),l.newInlet("restart",function(e){var t=Object(c.a)(e,1)[0];return l.onRestart(t)}),l.newOutlet(W.p),l.newOutlet("levels data"),l.newOutlet("pattern progress"),l.preset=new C.a,l.preset.track=Object(f.a)(l),l.newAttribute("stem types",[]),l.newAttribute("isLoop",!0),l.newAttribute("needsLazyLoad",!1),l.newAttribute("cued",!1),l}return Object(l.a)(n,[{key:"onTrigger",value:function(e){var t="bang"===e;"bang"!==e&&void 0!==e.transpose||(e=this.trackData);var n=e.time,r=this.sequencerEngine.stepNumber;(e=this.midiEffects.getStep(e)).transpose+=this.trackData.transpose,e.velocity*=this.trackData.velocity,e.duration*=this.trackData.duration,e.track=this,t?this.liveTrigger(e,0,b.a.Master.context.currentTime+.001):this.midiEffects.receivedTriggers.push({time:n,stepNumber:r,stepData:e})}},{key:"getObjectType",value:function(){return E.c}},{key:"skipMidiMaster",get:function(){return this.skipMidiMasterParameter.get()}},{key:"changeOutputType",value:function(e){this.outputTypeConfigured!==e&&(this.outputTypeConfigured=e,e===H.b?(this.muteableNode.disconnect(),this.reconnectAll()):this.addToGroup(this.group))}},{key:"registerParameter",value:function(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.parameters.push(e),e.setStore(this.store),e.setContext((new I.a).forTrack(this))}},{key:"newEffectsChain",value:function(){var e=new w.a(this.gainNode,this.trackNode,(new I.a).forTrack(this),this.sequencerEngine);e.initDefault(),this.effectsChains.push(e),this.store.dispatch(Object(O.Ab)(this.subSequence.id,this.trackNumber,this.effectsChains.length-1))}},{key:"deleteEffectsChain",value:function(){var e=this.effectsChains[this.chainNumber];void 0!==e&&(e.dispose(),this.effectsChains.splice(this.chainNumber,1),this.store.dispatch(Object(O.Ab)(this.subSequence.id,this.trackNumber,this.effectsChains.length-1)))}},{key:"getEffects",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chainNumber;return this.effectsChains[e].effects}},{key:"connectToEnvelope",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:le.a;for(var n in this.sequencerEngine.tracks){var r=this.sequencerEngine.tracks[n];r.isConnectedToEnvelope(e)&&r.disconnectFromEnvelope(e)}this.connectedEnvelopes.push(new ue(e,t)),this.store.dispatch(Object(O.te)(this.id,Object(s.a)(this.connectedEnvelopes)))}},{key:"disconnectFromEnvelope",value:function(e){for(var t=0;t<this.connectedEnvelopes.length;t++)if(this.connectedEnvelopes[t].envelope===e)return this.connectedEnvelopes.splice(t,1),void this.store.dispatch(Object(O.te)(this.id,Object(s.a)(this.connectedEnvelopes)))}},{key:"getEnvelopeMode",value:function(e){return this.connectedEnvelopes.filter(function(t){return t.envelope===e}).map(function(e){return e.mode})[0]}},{key:"setEnvelopeMode",value:function(e,t){return this.connectedEnvelopes.filter(function(t){return t.envelope===e}).forEach(function(e){return e.mode=t})}},{key:"isConnectedToEnvelope",value:function(e){return this.connectedEnvelopes.some(function(t){return t.envelope===e})}},{key:"rolling",get:function(){var e=this.liveEffects.getEffect(ce.f);if(!e)return this.sequencerEngine.rolling;switch(e.mode){case ce.b:return!0;case ce.a:return!1;default:return this.sequencerEngine.rolling}}},{key:"start",value:function(){if(this.restartedAtStepNumber=void 0,this.lastPatternStep=void 0,this.effectsChains.forEach(function(e){return e.start()}),this.midiEffects.clear(),this.liveEffects.clear(),this.getTrackType()===ee.b){var e=this.getInstrument();e&&e.hasLFO()&&(e.stop(),e.start())}this.notesTriggered={},this.accumulators={},this.patterns.forEach(function(e){return e.isRecording=!1}),this.scheduleTrackPatternChangeIfAny();var t,n=be(this.stepGroups);try{for(n.s();!(t=n.n()).done;){t.value.transformations.forEach(function(e){return e.loopCounter=-1})}}catch(r){n.e(r)}finally{n.f()}}},{key:"getGroupForId",value:function(e){return this.stepGroups.find(function(t){return t.id===e})}},{key:"patternLocked",get:function(){var e=this.store.getState().tracks.trackPatternLocks[this.subSequence.id];return void 0!==e&&((e[this.trackNumber]||{})[this.currentPattern]||!1)}},{key:"linearRampFade",value:function(e,t,n){this.faderNode.gain.linearRampTo(e,.001,b.a.Master.context.currentTime+.001),this.faderNode.gain.linearRampTo(t,n,b.a.Master.context.currentTime+.003)}},{key:"fade",set:function(e){var t=Object(K.a)(e,0,1,1,0);this.faderNode.gain.setValueAtTime(t,1e-4)}},{key:"patternLocks",set:function(e){for(var t in e)this.store.dispatch(Object(O.Ae)(this.subSequence.id,this.trackNumber,t,e[t]));this.getAllPatternLockedParameters().forEach(function(e){return e.updateRedux()})}},{key:"deletePatternLocks",value:function(){this.getAllParameters().forEach(function(e){return e.deleteLocks()}),this.store.dispatch(Object(O.Be)(this.subSequence.id,this.trackNumber,{}))}},{key:"deleteAutomations",value:function(){this.getAllPatternLockedParameters().forEach(function(e){return e.deleteAutomations()})}},{key:"togglePatternLock",value:function(){this.store.dispatch(Object(O.Ae)(this.subSequence.id,this.trackNumber,this.currentPattern,!this.patternLocked)),this.getAllPatternLockedParameters().forEach(function(e){return e.updateRedux()})}},{key:"getName",value:function(e){return void 0!==e?this.samples[e].name:void 0===this.sample?"":this.sample.name}},{key:"isRecordable",value:function(){return!1}},{key:"setSequencerEngine",value:function(e){this.sequencerEngine=e}},{key:"resolution",get:function(){return this.sequencerEngine.resolution}},{key:"getFactoredResolution",value:function(){var e=this.sequencerEngine.rollingResolution,t=this.liveEffects.getEffect(ce.f);return t&&((e=e.getCopy()).resolution*=t.rollFactor),e}},{key:"solo",value:function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.trackNode.solo=e,t&&this.store.dispatch(Object(O.Fe)(this.id,e))}},{key:"getSolo",value:function(){return this.trackNode.solo}},{key:"mix",get:function(){return this.state.sequencer.isRecording&&this.state.sequencer.automationMode===te.b?this.pattern.mix:this.subSequence.mix}},{key:"dispose",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.levelsInterval&&clearInterval(this.levelsInterval),this.sequencerEngine.dispatch(Object(O.cd)(void 0));var n=[];this.midiEffects.dispose(),t&&(n=this.getAllParameters()).forEach(function(e){return e.isMapped&&e.isMapped.unmap(e)});var r=n.filter(function(e){return e.automations&&e.automations.length>0});this.sequencerEngine.store.dispatch(Object(O.c)(r)),k.releaseTrack({gainNode:this.gainNode,volumeNode:this.volumeNode,muteableNode:this.muteableNode,trackNode:this.trackNode,trackMeter:this.trackMeter,faderNode:this.faderNode}),this.sendNodes.forEach(function(e){return k.releaseSend(e)}),this.effectsChains.forEach(function(e){return e.dispose()}),this.isFrozen?this.disposeFreezes():this.getSamplers().filter(function(e){return void 0!==e}).forEach(function(e){return e.dispose()}),this.faderNode=void 0,this.gainNode=void 0,this.muteableNode=void 0,this.trackNode=void 0,this.trackMeter=void 0,this.sendNodes=void 0,this.pattern=void 0,this.patterns.forEach(function(e){return e.dispose()}),this.patterns=void 0,this.soundIds=void 0,this.auditionedSounds=void 0,this.trackData=void 0,this.samplerConnectedToMaster=!1,this.samplers=void 0,this.group=null,this.selectedStep=void 0,this.name=void 0,this.videoId=void 0,this.sample&&this.sample.dispose(!0),this.presetId=void 0,this.samplesStream&&(this.samplesStream.dispose(),this.samplesStream=void 0),t&&n.filter(function(t){return t!==e.volumeParameter}).filter(function(t){return!e.sendNodeVolumeParameters.includes(t)}).forEach(function(e){return e.dispose()}),this.parameters=void 0}},{key:"getTrackType",value:function(){return ee.f}},{key:"addToGroup",value:function(e){this.outputTypeParameter.get()===H.a&&this.muteableNode.connect(e.inputNode),this.group=e}},{key:"disconnectFromGroup",value:function(){this.muteableNode.disconnect(),this.reconnectAll(),this.group=void 0}},{key:"getLoadedSampleIfAny",value:function(e){return this.sequencerEngine.loadedSamples[e]}},{key:"addSound",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n,r){var a,o,s=this,c=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((a=!(c.length>3&&void 0!==c[3])||c[3])&&this.store.dispatch(Object(O.we)(this.subSequence.id,this.trackNumber,!0)),"string"!==typeof t&&"number"!==typeof t){e.next=23;break}if(o=t,this.soundIds.push(o),void 0===this.getLoadedSampleIfAny(o)){e.next=10;break}t=this.getLoadedSampleIfAny(o),void 0===this.sample&&(this.sample=t),e.next=21;break;case 10:if(t=new g.a(o),void 0===this.sample&&(this.sample=t),e.prev=12,t.getId()===T.a){e.next=16;break}return e.next=16,t.load();case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(12),console.log("error sample ",e.t0);case 21:e.next=35;break;case 23:if(void 0===this.sample&&(this.sample=t),this.sample.isLoaded()||t.getId()===T.a){e.next=34;break}return e.prev=25,e.next=28,this.sample.load();case 28:e.next=34;break;case 30:return e.prev=30,e.t1=e.catch(25),console.log("error in track load"),e.abrupt("return");case 34:this.soundIds.push(t.getId());case 35:if(t.isLoaded()){e.next=37;break}return e.abrupt("return");case 37:this.samples.push(t),r=r||!1,this.loadTrackInfo(r,t,n,a),this.samplesStream=new j.a(t,this.sequencerEngine),setTimeout(function(){s.samplesStream.sounds&&0!==s.samplesStream.sounds.length||window.isNFT||s.samplesStream.search()},300),a&&this.store.dispatch(Object(O.we)(this.subSequence.id,this.trackNumber,!1)),this.addSoundToBrowsedSamples(t);case 44:case"end":return e.stop()}},e,this,[[12,18],[25,30]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"trackIsLoading",get:function(){return this.sequencerEngine.state.tracks.trackIsLoading[this.subSequence.id]&&this.sequencerEngine.state.tracks.trackIsLoading[this.subSequence.id][this.trackNumber]},set:function(e){this.sequencerEngine.isOffline||this.store.dispatch(Object(O.we)(this.subSequence.id,this.trackNumber,e))}},{key:"loadTrackInfo",value:function(e,t,n){var r=this,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];void 0===n&&(n={slices:void 0,offset:0,transpose:0,volume:0}),e=e||!0;var i=this;this.store.dispatch(Object(O.hd)(t.getId(),t.getJson())),e?(this.videoId=t.videoId,this.sample=t,void 0===this.videoId&&"MIDI"!==this.getTrackType()&&(this.name=t.name),this.update()):(this.name=t.name,this.update());var o=n.slices;this.samplers[t.getId()]=new ie.a(this,t,function(e){return r.onNewSampler(i,e)},o,n),this.samplers[t.getId()].init(),this.samplers[t.getId()].sliceFirstOnset(!1),t.addedToProject=!0,a&&this.store.dispatch(Object(O.we)(this.subSequence.id,this.trackNumber,!1))}},{key:"chainNumber",get:function(){return(this.store.getState().effects.effectsChainToShow[this.subSequence.id]||{})[this.trackNumber]||0}},{key:"effectsChain",get:function(){return this.effectsChains[this.chainNumber]}},{key:"effects",get:function(){return void 0===this.effectsChains[this.chainNumber]?[]:this.effectsChains[this.chainNumber].effects}},{key:"updateEffects",value:function(e){void 0===e&&(e=this.effects),this.effectsChains[this.chainNumber].updateEffects(e)}},{key:"onNewSampler",value:function(e,t){for(var n in this.samplers)if(t===this.samplers[n]&&this.toAudition.indexOf(n)>-1&&this.isWarped()){var r=this.toAudition.indexOf(n);this.toAudition.splice(r,1),t.sliceFirstOnset();break}t.gainNode.connect(this.gainNode),e.switchToPattern(e.currentPattern),e.setVolume(e.getVolume(),!0,!0),e.setPanning(e.getPanning(),void 0,!0)}},{key:"setSends",value:function(e){var t=this;this.sends=e,this.sends.getSends().map(function(e){return t.newSend(e)})}},{key:"setSendVolume",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.sendNodeVolumeParameters[e].set(t,n),this.store.dispatch(Object(O.Ee)(this.trackNumber,e,t))}},{key:"setupEffects",value:function(){var e=this.effectsChains[this.chainNumber];e&&e.setupEffects()}},{key:"newSend",value:function(e){var t=k.useSend();this.muteableNode.connect(t),e.connectToTrack(t),this.sendNodes.push(t);var n=new F.c("send volume",t.volume,{defaultValue:-90,prettyName:"Send "+e.name,min:-90,max:0,isDb:!0});this.registerParameter(n),this.sendNodeVolumeParameters.push(n)}},{key:"reconnectAll",value:function(){var e=this;this.sendNodes.forEach(function(t){return e.muteableNode.connect(t)}),this.muteableNode.connect(this.trackMeter)}},{key:"toggleEnabled",value:function(){this.setIsEnabled(!this.isEnabled)}},{key:"setIsEnabled",value:function(e){this.isEnabled=e,this.isEnabled&&this.store.dispatch(Object(O.Ve)(!1)),this.store.dispatch(Object(O.ve)(this.subSequence.id,this.id,this.isEnabled))}},{key:"getSendNodes",value:function(){return this.sendNodes}},{key:"getSampler",value:function(e){return this.isFrozen?this.frozenColumns[0].frozenSamplers[0]:(e=e||0,void 0!==this.samplers&&void 0!==this.soundIds?this.samplers[this.soundIds[e]]:void 0)}},{key:"getSamplers",value:function(){var e=this;return this.isFrozen?this.frozenColumns.map(function(e){return e.frozenSamplers[e.playing]}).filter(function(e){return void 0!==e}):this.soundIds.map(function(t){return e.samplers[t]})}},{key:"deleteSound",value:function(e){var t=this.soundIds.indexOf(e);t>-1&&(this.soundIds.splice(t,1),delete this.samplers[e],this.soundId=this.soundIds[0])}},{key:"getVolume",value:function(){return this.pattern?this.pattern.volume:0}},{key:"getMuted",value:function(){return!!this.pattern&&this.pattern.isMuted}},{key:"newPattern",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(new Date).getTime(),(t=void 0!==t&&t)?(n=this.pattern.getCopy(),this.patterns.push(n),(new Date).getTime(),this.patterns.length-1,this.getAllPatternLockedParameters().forEach(function(e){return e.newPattern(r.currentPattern,r.patterns.length-1)}),(new Date).getTime(),this.patternLocked&&this.store.dispatch(Object(O.Ae)(this.subSequence.id,this.trackNumber,this.patterns.length-1,this.patternLocked))):this.patterns.push(new ne.a(this.sequencerEngine,this)),(new Date).getTime();case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"switchToPattern",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.001;this.presetName||this.getName();if(e>=0&&e<this.patterns.length){var n=this.patterns[e],r=n.volume,a=n.muted,i=this.pattern;this.pattern=n,this.currentPattern=e;var o=this.patterns.indexOf(i),s=void 0===this.attributes["volume pattern-locked"]||!this.attributes["volume pattern-locked"]?Object(M.b)(this,o,r,t):{},c=this.mute(a,!0,!0),u=this.getAllPatternLockedParameters(this.patterns.indexOf(i),e),l={},f=new Set;for(var h in u){var d=u[h];if(!f.has(d.id)){f.add(d.id);var p=Object(M.a)(this.sequencerEngine,d,o,t);p&&(l[p.id]=p.value)}}var v=this.setPanning(this.pattern.panning,void 0,!0);return{bulkUpdate:l,panning:{id:this.id,panning:v},volume:{id:this.id,volume:s},mute:{id:this.id,mute:c}}}return{bulkUpdate:{},mute:{},volume:{},panning:{}}}},{key:"getAllParameters",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=[].concat(Object(s.a)(this.parameters),[this.outputTypeParameter]),r=be(this.stepGroups);try{for(r.s();!(e=r.n()).done;){var a,i=be(e.value.transformations);try{for(i.s();!(a=i.n()).done;){var o=a.value;n.push(o.thenValue),n.push(o.whenValue)}}catch(u){i.e(u)}finally{i.f()}}}catch(u){r.e(u)}finally{r.f()}for(var c in this.trackData&&(n=[].concat(Object(s.a)(n),Object(s.a)(this.trackData.parameters))),this.effectsChains)n=[].concat(Object(s.a)(n),Object(s.a)(this.effectsChains[c].getAllParameters()));return this.isFrozen&&(n=[].concat(Object(s.a)(n),Object(s.a)(this.frozenColumns.map(function(e){return e.gainParameter})),Object(s.a)(this.frozenColumns.map(function(e){return e.playingParameter})))),t&&(n=[].concat(Object(s.a)(n),Object(s.a)(this.midiEffects.getAllParameters()),Object(s.a)(this.liveEffects.getAllParameters()))),this.getSamplers()[0]&&(n=[].concat(Object(s.a)(n),Object(s.a)(this.getSamplers()[0].parameters))),n=[].concat(Object(s.a)(n),Object(s.a)(n.filter(function(e){return e.depthParameter}).map(function(e){return e.depthParameter})))}},{key:"getAllPatternLockedParameters",value:function(e,t){return this.getAllParameters().filter(function(n){return n.hasPatternLockedValues(e,t)})}},{key:"deletePattern",value:function(e){if(this.patterns.splice(e,1),this.getAllPatternLockedParameters().forEach(function(t){return t.deletePattern(e)}),void 0!==this.store.getState().tracks.trackPatternLocks[this.subSequence.id]){var t=Object(r.a)({},this.store.getState().tracks.trackPatternLocks[this.subSequence.id][this.trackNumber]);this.store.dispatch(Object(O.Be)(this.subSequence.id,this.trackNumber,Object(se.a)(e,t)))}}},{key:"movePatternTo",value:function(e,t){if(e!=t){var n=[];if(e>t?(n=this.patterns.slice(0,t).concat([this.patterns[e]]).concat(this.patterns.slice(t,e)),this.patterns.length>e+1&&(n=n.concat(this.patterns.slice(e+1)))):(n=this.patterns.slice(0,e).concat(this.patterns.slice(e+1,t)).concat([this.patterns[t],this.patterns[e]]),this.patterns.length>t+1&&(n=n.concat(this.patterns.slice(t+1)))),this.patterns=n,this.getAllPatternLockedParameters().forEach(function(n){return n.movePatternTo(e,t)}),this.store.getState().tracks.trackPatternLocks[this.subSequence.id]){var a=Object(r.a)({},this.store.getState().tracks.trackPatternLocks[this.subSequence.id][this.trackNumber]);this.store.dispatch(Object(O.Be)(this.subSequence.id,this.trackNumber,Object(se.b)(e,t,a)))}}}},{key:"getStepAtResolution",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.resolution,n=this.getStepsAtResolution(t);return n[Math.floor(e)%n.length]}},{key:"getStepsAtResolution",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke,t=this.getEasyPattern().pattern;return t.getStepsAtResolution(e).slice(0,t.length(e))}},{key:"getBucketsAtResolution",value:function(e){return this.pattern.getBucketsAtResolution(e)}},{key:"getFillsAtResolution",value:function(e){return this.pattern.getFillsAtResolution(e)}},{key:"getStepDataForStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.getCopy(!1,!1,!0,!0,t),r=n.getPolyphony();for(var a in r){var i=r[a];i.duration=null==i.durationParameter.value?this.trackData.duration:i.duration,i.transpose=null==i.transposeParameter.value?this.trackData.transpose:i.transpose,i.velocity=null==i.velocityParameter.value?this.trackData.velocity:i.velocity,i.start=null==i.startParameter.value?this.trackData.start:i.start,i.chop=null==i.chopParameter.value?this.trackData.chop:i.chop,i.chopDuration=null==i.chopDurationParameter.value?this.trackData.chopDuration:i.chopDuration,i.attack=null==i.attackParameter.value?this.trackData.attack:i.attack,this.getTrackType()!==ee.b?i.release=null==i.releaseParameter.value?this.trackData.release:i.release:i.release=null==i.releaseParameter.value?null:i.release,i.slice=null==i.sliceParameter.value?this.trackData.slice:i.slice,i.panning=i.panningParameter.value,i.pitchAttack=null==i.pitchAttackParameter.value?this.trackData.pitchAttack:i.pitchAttack,i.pitchDecay=null==i.pitchDecayParameter.value?this.trackData.pitchDecay:i.pitchDecay,i.pitchSustain=null==i.pitchSustainParameter.value?this.trackData.pitchSustain:i.pitchSustain,i.pitchRelease=null==i.pitchReleaseParameter.value?this.trackData.pitchRelease:i.pitchRelease,i.monophonic=null==i.monophonicParameter.value?this.trackData.monophonic:i.monophonic,i.reverse=null==i.reverse?this.trackData.reverse:i.reverse,i.palette=null==i.palette?this.trackData.palette:i.palette,i.mutate=null==i.mutateParameter.value?this.trackData.mutate:i.mutate,i.auxEventA=null==i.auxEventA?this.trackData.auxEventA:i.auxEventA,i.auxEventB=null==i.auxEventA?this.trackData.auxEventB:i.auxEventB,i.auxEventC=null==i.auxEventA?this.trackData.auxEventC:i.auxEventC,i.auxEventD=null==i.auxEventA?this.trackData.auxEventD:i.auxEventD,i.effectAutomations=i.effectAutomations}return n}},{key:"getMainSoundId",value:function(){return this.soundIds[0]}},{key:"calculateFills",value:function(){this.pattern.calculateFills(this.trackData)}},{key:"updateStepDuration",value:function(e,t,n){n=n||ke;var r=this.getBucketsAtResolution(n);for(var a in r[e].steps){var i=r[e].getStep(a);i.on&&(i.duration=t)}this.pattern.calculateFills(this.trackData),this.updateSteps()}},{key:"doubleTrackLength",value:function(){var e=this.getEasyPattern().pattern;e.doubleTrackLength(),e.calculateFills(this.trackData),this.updateSteps(!0)}},{key:"length",get:function(){return void 0===this.pattern?16:this.pattern.length()}},{key:"halfTrackLength",value:function(){var e=this.getEasyPattern().pattern;e.halfTrackLength(),e.calculateFills(this.trackData),this.updateSteps(!0)}},{key:"getJson",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.soundIds)return{};for(var t={},n=0;n<this.soundIds.length;n++){var a=this.samplers[this.soundIds[n]];a&&(t[this.soundIds[n]]=a.getJson())}var i=this.store.getState().tracks.trackPatternLocks[this.trackNumber]||{},o=[];for(var s in this.sendNodeVolumeParameters){var c=this.sendNodeVolumeParameters[s],u={volume:c.get()};u=Object(D.b)(u,"volumeParameter",c,!0),o.push(u)}var l=Object(D.b)({},"outputTypeParameter",this.outputTypeParameter);l=Object(D.b)(l,"skipMidiMasterParameter",this.skipMidiMasterParameter);var f=this.instrumentRack?this.instrumentRack.isFrozen:this.isFrozen;return l=Object(D.b)(l,"volumeParameter",this.volumeParameter,!0),this.lfosTrack&&(l.lfos=this.lfosTrack.lfos.map(function(e){return e.getJson()}),l.envelopes=this.envelopesTrack.envelopes.map(function(e){return e.getJson()})),Object(r.a)({},l,{id:this.id,color:this._color,skipMidiMaster:this.skipMidiMasterParameter.get(),outputType:this.outputTypeParameter.get(),annotations:this.annotations.map(function(e){return e.getJson()}),isMuted:this.pattern.isMuted,sends:o,isNewVolume:!0,volume:this.pattern.volume,samplers:t,gated:this.gated,attributes:this.getAttributesJson(),type:this.getTrackType(),patternLocks:i,envelopeConnections:this.connectedEnvelopes.filter(function(e){return e&&e.envelope}).map(function(e){return e.getJson()}),isFrozen:f,isFrozenPlaying:this.isFrozenPlaying,freeze:e?void 0:this.getFreezeJson(),chokes:this.chokes.getJson(),rawVolume:this.volumeNode.volume.value,presetName:this.presetName,stepGroups:this.stepGroups.map(function(e){return Object(X.d)(e)})},this.getAuxJson())}},{key:"setPanning",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0!==t){var r=b.a.Master.context.isOffline?b.a.Master.context._currentTime:b.a.Master.context.currentTime;this.gainNode.pan.linearRampToValueAtTime(e,r+t-.001)}else this.gainNode.pan.value=e;return this.gainNode.pan.value=e,this.pattern.panning=e,n||this.store.dispatch(Object(O.ze)(this.id,e)),e}},{key:"getPanning",value:function(){return this.pattern.panning}},{key:"setVolume",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return t||this.state.mix.isRecordingMix||(this.pattern.volume=e),t||this.state.mix.isRecordingMix||(t=!0),e>6&&(e=Math.max(4,Object(K.b)(e,0,128))),this.volumeParameter.set(e,t,!0,r,a),n||this.store.dispatch(Object(O.Je)(this.id,e)),e}},{key:"setRawVolume",value:function(e){this.volumeParameter.set(e,!0,!0),this.pattern.volume=e+15}},{key:"mute",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e=void 0===e||e,this.addEvent(new $.a(this,e),t),this.muted=e,this.muteableNode.mute=e,this.pattern.muted=e,n||this.store.dispatch(Object(O.ye)(this.id,e)),e}},{key:"moveEffectTo",value:function(e,t){this.effectsChains[this.chainNumber].moveEffectTo(e,t)}},{key:"moveMidiEffectTo",value:function(e,t){this.midiEffects.moveEffectTo(e,t)}},{key:"onBPMUpdated",value:function(){this.effectsChains.forEach(function(e){return e.onBPMUpdated()})}},{key:"getEffectNumber",value:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.midiEffects.getEffectNumber(e):this.effectsChains[this.chainNumber].getEffectNumber(e)}},{key:"deleteEffect",value:function(e){this.effectsChains[this.chainNumber].deleteEffect(e)}},{key:"numberOfSlices",value:function(){var e=0;for(var t in this.samplers)this.samplers[t].slices.length>e&&(e=this.samplers[t].slices.length);return e}},{key:"isLoaded",value:function(){return this.soundIds.length>0&&void 0!==this.getSampler(0)&&this.getSampler(0).isLoaded()}},{key:"updateStepData",value:function(e,t,n){var r=ke.transformStepAtResolution(t,n),a=Math.floor(r),i=this.pattern.stepBuckets[a];for(var o in i.steps){if(i.getStep(o).on){i.setStep(o,e,!0),this.pattern.syncBuckets();break}}this.updateSteps()}},{key:"stepSelected",value:function(e){this.selectedStep=e}},{key:"stepUnselected",value:function(e){this.selectedStep=void 0}},{key:"isReversed",value:function(){return this.getSamplers().filter(function(e){return void 0!==e}).some(function(e){return e.isReversed()})}},{key:"reverse",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.getSamplers().forEach(function(t){return t.reverse(e)})}},{key:"addEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0!==this.mix){this.store.getState();!t&&this.isRecordingAutomations()&&this.mix.addEvent(e)}}},{key:"isRecordingAutomations",value:function(){return this.state.sequencer.automationMode===te.b&&this.state.sequencer.isRecording||this.state.mix.isRecordingMix}},{key:"setKeyboardEngine",value:function(e){this.keyboardEngine=e}},{key:"updateSteps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.pattern;if(this.state.arrangement.patternSelected&&((r=this.patterns[this.state.arrangement.patternSelected.patternNumber])||(r=this.pattern)),!this.multiSequencerEngine&&!this.sequencerEngine.context.isOffline)if(this.instrumentRack)this.instrumentRack.updateSteps(e,t);else{t||this.store.dispatch(Object(O.ve)(this.subSequence.id,this.id,this.isEnabled));(new Date).getTime();var a=r.getUpdateStepsAction(e,n),i=((new Date).getTime(),void 0);if(this.subSequence.isTrack)for(var o in i={},this.patterns)i[o]=this.patterns[o].getTrackStepsAction();this.store.dispatch(Object(O.v)(a.id,a.steps,a.pianoRollSteps,a.trackFills,a.stepToId,a.pianoRollPositions,a.pianoRollDurations,i,a.groups))}}},{key:"getUpdateStepsAction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine.resolution.isTriplet;return this.pattern.getUpdateStepsAction(e,t)}},{key:"patternSelected",get:function(){return this.state.arrangement.patternSelected}},{key:"getEasyPattern",value:function(){var e=this.patternSelected?this.patterns[this.patternSelected.patternNumber]:this.pattern;return new re.a(e||this.pattern,this.trackData)}},{key:"deleteMidiInput",value:function(e){this.midiInputs.deleteMidiInput(e)}},{key:"addMidiInput",value:function(e){this.midiInputs.addMidiInput(e)}},{key:"getInstrumentType",value:function(){return ee.f}},{key:"state",get:function(){return this.store.getState()}},{key:"dispatch",value:function(e){this.sequencerEngine.dispatch(e)}},{key:"fromJson",value:function(e,t){var n=this;this.cachedPlayhead=void 0,e.id&&(this.sequencerEngine.trackIDExists(e.id,this)||(this.id=e.id,this.sequencerEngine.idToObject[this.id]=this)),this.loadAttributesFromJson(e),void 0!==e.isFrozen&&(this.isFrozen=e.isFrozen),e.freeze&&this.loadFreezeJson(e.freeze),e.outputType&&this.outputTypeParameter.set(e.outputType,void 0,!0),e.color&&(this.color=e.color),e.skipMidiMaster&&this.skipMidiMasterParameter.set(e.skipMidiMaster,void 0,!0),void 0===e.skipMidiMaster&&e.isFrozen&&this.skipMidiMasterParameter.set(!1),e.skipMidiMasterParameter&&Object(D.a)(e,"skipMidiMasterParameter",this.skipMidiMasterParameter),e.stepGroups&&(this.stepGroups=e.stepGroups.map(function(e){return Object(X.c)(e,n)})),Object(D.a)(e,"outputTypeParameter",this.outputTypeParameter),void 0!==e.isFrozenPlaying&&(this.isFrozenPlaying=e.isFrozenPlaying),this.frozenJson=e.frozenJson,this.currentPattern=this.getInitialPattern();var a={};if(t||(a=Object(D.a)(e,"volumeParameter",this.volumeParameter)),e.sends)for(var i in e.sends)this.sendNodeVolumeParameters[i]&&(Object(m.a)(this.sendNodeVolumeParameters[i],e.sends[i].volume,a),a=Object(r.a)({},a,Object(D.a)(e.sends[i],"volumeParameter",this.sendNodeVolumeParameters[i])));this.sequencerEngine.parametersToUpdate=Object(r.a)({},this.sequencerEngine.parametersToUpdate,a),this.presetName=e.presetName,e.auxEventATypeParameter&&this.fromAuxJson(e),e.lfos&&this.lfosTrack&&(this.lfosTrack.lfos.map(function(t,n){return t.lfo.fromJson(e.lfos[n])}),this.envelopesTrack.envelopes.map(function(t,n){return t.envelope.fromJson(e.envelopes[n])}))}},{key:"tempo",get:function(){return void 0===this.getSamplers()[0]?void 0:this.getSamplers()[0].tempo}},{key:"warp",value:function(){var e=this.midiEffects.effects.filter(function(e){return"Warp"===e.name})[0];e?this.operationManager.dispatch(Object(J.q)(e,this)):this.operationManager.dispatch(Object(J.b)(new z.a(this),this)),this.getSamplers()[0]&&this.getSamplers()[0].sliceFirstOnset()}},{key:"isWarped",value:function(){return this.midiEffects.effects.filter(function(e){return"Warp"===e.name}).filter(function(e){return e.enabled}).length>0}},{key:"mateWithPreset",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r,a,o,s,c,u=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:.5,r=u.length>2?u[2]:void 0,e.next=4,je.getPresetData(t.contentHash);case 4:for(o in(a=e.sent).lfos)this.sequencerEngine.lfos[o].lfo.mateJson(a.lfos[o],n);if(this.instrument.mateJson(a.trackParameters.instrument,n),!r){e.next=14;break}return e.next=10,this.sequencerEngine.getEffectsPreset(a,this);case 10:for(s=e.sent,this.effectsChains[0].mate(s.effectsChains[0],n),c=1;c<s.effectsChains.length;c++)s.effectsChains[c].dispose();s.midiEffects&&this.midiEffects.mate(s.midiEffects,n);case 14:return this.sequencerEngine.update(),e.abrupt("return");case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"extractStems",value:function(){var e=this;return new Promise(function(t){var n=e.sample.audioBuffer,r=[n.getChannelData(0),n.getChannelData(1)];e.sequencerEngine.dispatch(Object(O.gc)("Extracting stems (might take a few)")),new U.a(2).exportToWAV(r,function(){var n=Object(o.a)(i.a.mark(function n(r){var a;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,V.a.addBytesArray(r);case 2:a=n.sent,fetch("/splitStems/"+a,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(){var n=Object(o.a)(i.a.mark(function n(r){var a,o,s,c,u;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=r.drums?e.sample.getCopyWith(r.drums,"drums"):void 0,o=r.vocals?e.sample.getCopyWith(r.vocals,"vocals"):void 0,s=r.bass?e.sample.getCopyWith(r.bass,"bass"):void 0,c=r.other?e.sample.getCopyWith(r.other,"other"):void 0,u=[a,o,s,c].filter(function(e){return void 0!==e}).map(function(e){return e.fetchAudio()}),n.next=7,Promise.all(u);case 7:e.sequencerEngine.dispatch(Object(O.gc)(void 0)),a&&(e.sequencerEngine.addSound(a),e.sequencerEngine.addSampleToSync(a)),o&&(e.sequencerEngine.addSound(o),e.sequencerEngine.addSampleToSync(o)),s&&(e.sequencerEngine.addSound(s),e.sequencerEngine.addSampleToSync(s)),c&&(e.sequencerEngine.addSound(c),e.sequencerEngine.addSampleToSync(c)),t();case 13:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}());case 4:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}())})}},{key:"extractGroove",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n,r,a,o,s,c,u,l,f,h,d;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSamplers()[0],n=t.onsets,r=t.tempo,a=t.slices[0].startTime,n=n.filter(function(e){return e/1e3>=a}),o=Object(Q.b)(n,r,this.sequencerEngine.bpm),"QmRHeFU644J9LFZoPzd93M4WqF8tyhydDYL2EZWS6dmbF8",e.next=9,this.sequencerEngine.addSound("QmRHeFU644J9LFZoPzd93M4WqF8tyhydDYL2EZWS6dmbF8");case 9:for(u in s=e.sent,c=s.getEasyPattern(),o.steps.forEach(function(e){return c.addStep(s.getNewStep(),e.stepNumber,ke,e.offset,!1,!0)}),o.timings)l=o.timings[u].resolution,f=o.timings[u].odd,h=o.timings[u].even,(d=new G.a(s)).oddOffset=f,d.evenOffset=h,d.resolution=32/l,s.midiEffects.addEffect(d);c.update(!1),s.updateSteps();case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getNewStep",value:function(){var e=new ae.a(this.sequencerEngine,void 0,void 0,this);return e.on=!0,e}},{key:"showEffects",value:function(e){this.store.dispatch(Object(O.be)(this.trackNumber,e))}},{key:"isEffectsShowing",value:function(){return this.state.spatial.showEditorBottom===q.a}},{key:"isHidden",value:function(){return this.state.tracks.tracksToHide.indexOf(this)>-1}},{key:"restart",value:function(){}},{key:"onStepEnded",value:function(){}},{key:"onNewStep",value:function(e){this.midiEffects.onNewStep()}},{key:"getInitialPattern",value:function(){if(!this.subSequence.isTrack)return 0}},{key:"scheduleTrackPatternChangeIfAny",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine.trackStep;arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.subSequence.isTrack&&!this.patterns.some(function(e){return e.isRecording})){for(var t in this.patterns){t=parseInt(t);var n=this.patterns[t],r=n.startStep;if(void 0!==r&&(e>=r&&e<r+n.length()))return void(t!==this.currentPattern&&this.switchToPattern(t))}this.currentPattern=void 0,this.pattern=this.patterns[0]}}},{key:"getGuildIds",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sample){e.next=2;break}return e.abrupt("return",[0]);case 2:return e.next=4,fe.a.guildSamples.getGuildIdForSound(this.sample.getId());case 4:return t=e.sent,e.abrupt("return",void 0===t?[0]:[t]);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"makePublicIfNeeded",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getGuildIds();case 2:if(0===e.sent[0]||!this.sample){e.next=8;break}return e.next=6,fe.a.guildSamples.saveSample(this.sample);case 6:t=e.sent,this.replaceSoundId(this.sample.getId(),t);case 8:e.t0=i.a.keys(this.effectsChains);case 9:if((e.t1=e.t0()).done){e.next=15;break}return n=e.t1.value,e.next=13,this.effectsChains[n].makePublicIfNeeded();case 13:e.next=9;break;case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"replaceSoundId",value:function(e,t){var n=this.soundIds.indexOf(e);if(-1!==n){this.soundIds[n]=t;var r=this.samplers[this.sample.getId()];this.samplers[t]=r,this.sample.ipfsHash=t,delete this.samplers[e]}}},{key:"operationManager",get:function(){return this.sequencerEngine.operationManager}},{key:"deleteAtStep",value:function(e){this.pattern.deleteStepNumber(e)}},{key:"isMonophonic",value:function(){return!1}},{key:"getIdentifier",value:function(){var e=this;return this&&this.tracks&&this.tracks[0]&&(e=this.tracks[0].track),e.presetName?e.presetName:void 0!==e.sample&&void 0!==e.sample.getId()?e.sample.getId():e.getName()}},{key:"addRackEffect",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(h.a)(Object(v.a)(n.prototype),"addRackEffect",this)).call.apply(e,[this].concat(r)),this.updateMidiEffectsRedux()}},{key:"updateEffectRedux",value:function(e){this.updateMidiEffectsRedux()}},{key:"updateMidiEffectsRedux",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.effectRack&&this.effectRack.effects;this.effectRack&&this.dispatch(Object(O.xe)(this.id,Object(s.a)(e)))}},{key:"effectRack",get:function(){return this.midiEffects.effects.find(function(e){return"Midi Effect Rack"===e.name})}},{key:"getParameters",value:function(){return[]}},{key:"sendLevels",value:function(e){var t=this;this.levelsInterval&&clearInterval(this.levelsInterval),e&&(this.levelsInterval=setInterval(function(){if(!t.sequencerEngine.isLoading)if(t.sequencerEngine.playing){var e=t.trackMeter.getLevel();t.sendMessage("levels data",e<-80?0:Math.pow((e+80)/86,2))}else t.sendMessage("levels data",.01)},20))}},{key:"saveNewSample",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sample.saveBuffer();case 2:t=this.sample.ipfsHash,n=this.samplers.NOT_UPLOADED_YET,this.soundIds=[t],this.samplers[t]=n;case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"scheduleAnyRecording",value:function(e){}}]),n}(Object(N.a)(Object(ye.a)(Object(P.a)(Object(x.a)(Object(pe.a)(function(e){return function(e){Object(d.a)(n,e);var t=de(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"getKeyMapping",value:function(e){var t=this.sequencerEngine.keyboardEngine;if(t){var n=t.keyMappings;for(var r in n){var a=n[r],i=a.trackNumber,o=a.sliceNumber;if(i===this.trackNumber&&(void 0===e||e==o))return r}}}},{key:"mapToKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.sequencerEngine.keyboardEngine.map(e,this.trackNumber,t)}},{key:"getPadMapping",value:function(){}}]),n}(e)}(function(e){Object(d.a)(n,e);var t=ve(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"color",get:function(){return this._color?this._color:me.getColorForTrack(this)},set:function(e){this._color=e}}]),n}(Object(he.a)(function(){return function e(){Object(u.a)(this,e)}}())))))))));t.a={Track:xe,baseResolution:ke,oldDefaultResolution:we}},,function(e,t,n){"use strict";(function(e){n.d(t,"j",function(){return f}),n.d(t,"i",function(){return h}),n.d(t,"g",function(){return d}),n.d(t,"h",function(){return p}),n.d(t,"o",function(){return v}),n.d(t,"c",function(){return m}),n.d(t,"f",function(){return y}),n.d(t,"e",function(){return b}),n.d(t,"m",function(){return g}),n.d(t,"k",function(){return O}),n.d(t,"l",function(){return j}),n.d(t,"a",function(){return k}),n.d(t,"n",function(){return w}),n.d(t,"d",function(){return x}),n.d(t,"b",function(){return S});var r=n(4),a=n(5),i=(n(272),n(357)),o=n(162),s=n(189),c=(window.web3,o.a.utils.padLeft("0x0",64)),u=function(){function e(t,n){Object(r.a)(this,e),this.toConversion=t,this.fromConversion=n}return Object(a.a)(e,[{key:"convertTo",value:function(e){return this.toConversion(e)}},{key:"convertFrom",value:function(e){return e===c?null:this.fromConversion(e)}}]),e}();function l(e){var t="";for(var n in e)0!=e.charCodeAt(n)&&(t+=e.charAt(n));return t}var f=new u(function(e){return function(e){var t=s.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}(e)},function(t){return function(t){var n=new e(t.replace(/^0x/,"1220"),"hex");return s.encode(n)}(t)}),h=new u(function(e){return o.a.utils.padLeft(o.a.utils.numberToHex(e),64)},function(e){return o.a.utils.hexToNumber(e)}),d=new u(function(e){return o.a.utils.padLeft(o.a.utils.numberToHex(e),64)},function(e){return l(o.a.utils.toAscii(e))}),p=new u(function(e){return o.a.utils.padLeft(o.a.utils.numberToHex(e),64)},function(e){return o.a.utils.hexToNumber(e)}),v=new u(function(e){return o.a.utils.padLeft(o.a.utils.numberToHex(parseInt(e)),64)},function(e){return e.length<=64?o.a.utils.hexToNumber(e):e.startsWith("0x0000000000000000000000000000000000000000000000000000000")?o.a.utils.hexToNumber("0x"+e.slice(32)):0}),m=new u(function(e){return o.a.utils.padRight(o.a.utils.fromAscii(e),64)},function(e){return l(o.a.utils.toAscii(e))}),y=new u(function(e){return o.a.utils.padLeft(o.a.utils.fromAscii(e),64)},function(e){return l(o.a.utils.toAscii(e))}),b=new u(function(e){return o.a.utils.padLeft(o.a.utils.toHex(e),64)},function(e){return function(e){for(var t=0;t<e.length;t++)if("0"!==e.slice(t,t+1))return e.slice(t);return e}(e.slice(2))});var g=new u(function(e){return o.a.utils.padRight(o.a.utils.toHex(e),64)},function(e){return l(o.a.utils.toAscii(e))}),O=new u(function(e){return o.a.utils.padRight(e,64)},function(e){return l(o.a.utils.toAscii(e)).split("").map(function(e){return i.a[e]})}),j=new u(function(e){return o.a.utils.padRight(e,64)},function(e){return i.a[l(o.a.utils.toAscii(e))]}),k=new u(function(e){return o.a.utils.padLeft(e,64)},function(e){return function(e){return"0x"+e.slice(e.length-40)}(e)}),w=new u(function(e){return o.a.utils.padLeft(e[0],64)},function(e){return l(o.a.utils.toAscii(e))}),x=function(e){return new u(function(e){return e},function(t){return t.slice(2,2+64*e)})};var S=new u(function(e){return o.a.utils.padLeft(o.a.utils.numberToHex(parseInt(e)),64)},function(e){try{return 1===o.a.utils.hexToNumber(e)}catch(t){return e}},!1)}).call(this,n(110).Buffer)},function(e,t,n){"use strict";n.d(t,"d",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"b",function(){return i}),n.d(t,"a",function(){return o});var r=1,a=2,i=3,o="bang"},function(e,t,n){"use strict";n.d(t,"f",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"d",function(){return i}),n.d(t,"e",function(){return o}),n.d(t,"a",function(){return s}),n.d(t,"g",function(){return c}),n.d(t,"b",function(){return u});var r=1,a=2,i=3,o=4,s=1,c=2,u=3},function(e,t,n){"use strict";n.d(t,"d",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"e",function(){return i}),n.d(t,"a",function(){return o}),n.d(t,"f",function(){return s}),n.d(t,"b",function(){return c});var r="TAG",a="STYLE",i="YEAR",o="COUNTRY",s="YOUTUBE",c="DISCOGS"},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"mul",gen:function(){var e=r.getInputs(this),t="  var ".concat(this.name," = "),n=1,a=0,i=!1,o=!0;return e.forEach(function(r,s){isNaN(r)?(t+=r,s<e.length-1&&(i=!0,t+=" * "),o=!1):(0===s?n=r:n*=parseFloat(r),a++)}),a>0&&(t+=i||o?n:" * "+n),t+="\n",r.memo[this.name]=this.name,[this.name,t]}};t.default=function(){for(var e=Object.create(a),t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Object.assign(e,{id:r.getUID(),inputs:n}),e.name=e.basename+e.id,e}},,,,,,,,function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2),u=n(113),l=n(6),f=n.n(l);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var d=function(e){Object(o.a)(n,e);var t=h(n);function n(e,a){var i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1,c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return Object(r.a)(this,n),(i=t.call(this,e,new f.a.Signal(0),o,s)).useMatchedValues=c,a&&i.setAudioParams(a),i}return Object(a.a)(n,[{key:"set",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.04,s=Object(i.a)(Object(c.a)(n.prototype),"set",this).call(this,e,t,r,a,o);return!this._audioParams||!this.keyScaling&&t||this.useMatchingValues&&(console.log("setting params to 0"),this._audioParams.filter(function(e){return e.input}).forEach(function(e){return e.value=0})),s}},{key:"disableKeyScaling",value:function(){this.set(this.get(!0),!0,!0),this.keyScaling=void 0,this.useMatchingValues&&this._audioParams.filter(function(e){return e.input}).forEach(function(e){return e.value=0})}},{key:"setAudioParams",value:function(e){var t=this;(e=e.filter(function(e){return e})).filter(function(e){return!t._audioParams||!t._audioParams.includes(e)}).forEach(function(e){return t.audioParam.connect(e)}),this._audioParams=e}},{key:"removeAudioParams",value:function(e){var t=this;console.log("poly.removeAudioParams"),e.forEach(function(e){return t.removeAudioParam(e)})}},{key:"removeAudioParam",value:function(e){console.log("poly.removeAudioParam"),e&&this._audioParams.includes(e)?(this._audioParams=this._audioParams.filter(function(t){return t!==e}),e.input&&this.audioParam&&(console.log("setting params to 0"),this.audioParam.disconnect(e),this.useMatchingValues&&(e.value=0))):console.log("Failed to remove audio param for %s",this.name,e,this._audioParams)}}]),n}(u.c);window.findBadPoly=function(){return window.sequencerEngine.tracks[0].getAllParameters().filter(function(e){return!e.name.includes("Formant")}).filter(function(e){return e._audioParams}).filter(function(e){return e._audioParams.some(function(e){return!e.input||0!==e.value})}).map(function(e){return[e.name,e._audioParams.map(function(e){return e.input&&e.value})]})},t.a=d},function(e,t,n){"use strict";n.d(t,"e",function(){return l}),n.d(t,"f",function(){return f}),n.d(t,"d",function(){return h}),n.d(t,"c",function(){return d}),n.d(t,"a",function(){return p}),n.d(t,"b",function(){return v});n(320),n(290);var r=n(242),a=n(151),i=n(652),o=n(214),s=n(114),c=n(145),u=n(150);Object(a.a)("tidal",{pattern:"",cycleLength:"",accentFactor:"",cycleRetrigger:""},"Plays a tidal pattern");var l=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=void 0,l=void 0,f=void 0;return function(){for(var h=arguments.length,d=new Array(h),p=0;p<h;p++)d[p]=arguments[p];var v=d[0],m=d[1],y=d[2],b=d[3];i||(i=b.useTidal());var g=s.A.apply(void 0,[e].concat(d))||[];if(g!==l){if("string"===typeof g){var O=Object(u.g)(e);i.cycleParameter.set(O,!0,!0)}else Array.isArray(g)&&(f&&f===Object(u.e)(g)||i.cycle!==g&&i.cycleParameter.set(g,!0,!0));l=g,f=Object(u.e)(l)}var j=void 0===t()?Object(o.a)(g,s.A.apply(void 0,[a].concat(d))):s.A.apply(void 0,[t].concat(d));void 0===j&&(j=32),j!==i.cycleLength&&i.cycleLengthParameter.set(j,!0,!0);var k=s.A.apply(void 0,[n].concat(d));k!==i.accentFactor&&i.accentFactorParameter.set(k,!0,!0);var w=s.A.apply(void 0,[r].concat(d));if(w!==i.cycleRetrigger&&(i.cycleRetrigger=w),v){var x=new c.a(v,y,m);i.input(x)}var S=i.output(y,m,m);return 0===S.length?Object(s.w)(!1):Object(s.K)(Object(s.R)(S))}},f=function(e){var t=void 0,n=void 0;return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];var o=s.A.apply(void 0,[e].concat(a));return o===t?n:(n=Object(u.g)(o),t=o,n)}},h=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=s.A.apply(void 0,[e].concat(n));return Object(i.a)(Object(u.e)(a)).apply(void 0,n)}},d=function(e,t,n){return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];var o=s.A.apply(void 0,[e].concat(a)),c=s.A.apply(void 0,[t].concat(a)),u=s.A.apply(void 0,[n].concat(a));return"object"===typeof o&&(o=o.value),o?c:u}};Object(a.a)("hand",{handType:""},"Filters triggers generated by tidal by hand (left=false right=true)");var p=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];var i=n[0];n[1];if(n[3]&&n[3].zObject&&n[3].zObject.sequencerEngine.isSequenceRolling)return Object(s.w)(!0);if(!i)return Object(s.w)(!1);var o=i.hand?1:0,c=Math.round(s.A.apply(void 0,[e].concat(n)));return c===r.d?Object(s.w)(!1):i.isDouble&&!i.wasDouble?Object(s.w)(!0):c===r.a?Object(s.w)(!0):Object(s.w)(o===c)}},v=function(e,t,n){var r=l(e,function(){},void 0,void 0,t);return function(){return r.apply(void 0,arguments)}}},,,,,,function(e,t,n){"use strict";(function(e){var r=n(4),a=n(5),i=(n(271),n(6)),o=n.n(i),s=n(122),c=(n(127),function(){function t(e,n){Object(r.a)(this,t),this.onSoundUploaded=n,this.numChannels=e,this.soundIdCounter=0}return Object(a.a)(t,[{key:"exportToWAV",value:function(t,n){new FormData;var r=new Worker(window.isNFT?"recorderWorker.js":"/recorderWorker.js");r.postMessage({command:"init",config:{sampleRate:o.a.context.sampleRate,numChannels:this.numChannels}}),r.onmessage=function(t){var r,a=t.data,i=new FileReader;i.onload=function(){r=this.result,n(new e(r))},i.readAsArrayBuffer(a)},r.postMessage({command:"record",buffer:t}),r.postMessage({command:"exportWAV",type:"audio/wav"})}},{key:"uploadBufferToIpfs",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;return new Promise(function(i,c){new FormData;var u=t,l=new Worker(window.isNFT?"recorderWorker.js":"/recorderWorker.js");l.postMessage({command:"init",config:{sampleRate:o.a.context.sampleRate,numChannels:t.numChannels}});new Date;if(l.onmessage=function(e){var t=this,o=e.data;s.a.addBlob(o,a).then(function(e){n&&u.onSoundUploaded(t.soundIdCounter++,e,r),i(e)})},n)l.postMessage({command:"record",buffer:e});else{for(var f=[],h=0;h<e.numberOfChannels;h++)f.push(e.getChannelData(h));l.postMessage({command:"record",buffer:f})}l.postMessage({command:"exportWAV",type:"audio/wav"})})}},{key:"uploadVideoBlob",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=(new FormData,this),u=new Worker(window.isNFT?"recorderWorker.js":"/recorderWorker.js");u.postMessage({command:"init",config:{sampleRate:o.a.context.sampleRate,numChannels:this.numChannels}});new Date;u.onmessage=function(e){var t=e.data;s.a.addBlob(t).then(function(e){i?c.onSoundUploaded(void 0,e,a):c.onSoundUploaded(a,e,a)})},u.postMessage({command:"record",buffer:e}),u.postMessage({command:"exportWAV",type:"audio/wav"})}}]),t}());t.a=c}).call(this,n(110).Buffer)},function(e,t,n){"use strict";n.d(t,"e",function(){return r}),n.d(t,"f",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o}),n.d(t,"d",function(){return s}),n.d(t,"c",function(){return c});Math.sqrt;var r=function(e){if(0===e.length)return{x:0,y:0,diameter:1};var t=new Uint32Array(e.map(function(e){var t=e.x;e.y;return isNaN(t)?0:t})),n=new Uint32Array(e.map(function(e){e.x;var t=e.y;return isNaN(t)?0:t})),r=window.api.create_geometry_buffer(e.length),a=window.api.create_geometry_buffer(e.length),i=window.api.create_geometry_buffer(3);window.Module.HEAP32.set(t,r/t.BYTES_PER_ELEMENT),window.Module.HEAP32.set(n,a/n.BYTES_PER_ELEMENT),window.api.getGeometry(r,a,e.length,i);var o=new Uint32Array(window.Module.HEAP32.buffer,i,3),s=o[0],c=o[1],u=o[2];return window.api.destroy_buffer(i),window.api.destroy_buffer(r),window.api.destroy_buffer(a),{x:s,y:c,diameter:u}},a=function(e){if(0===e.length)return{x:0,y:0,diameter:1};var t=e;if(e.some(function(e){return isNaN(e)}))return{x:0,y:0,diameter:1};var n=window.api.create_geometry_buffer(e.length),r=window.api.create_geometry_buffer(3);window.Module.HEAPF32.set(t,n/t.BYTES_PER_ELEMENT),window.api.getGeometryFlat(n,e.length,r);var a=new Uint32Array(window.Module.HEAP32.buffer,r,3),i=a[0],o=a[1],s=a[2];return window.api.destroy_buffer(r),window.api.destroy_buffer(n),{x:i,y:o,diameter:s}},i=function(e){return r(e)},o=function(e){return r(e).diameter},s=function(){return function(e){var t=Object.keys(e).map(function(t){return e[t]}).filter(function(e){return e});return 0===t.length?0:o(t)}},c=function(){return function(e){var t=Object.keys(e).map(function(t){return e[t]}).filter(function(e){return e});return 0===t.length?0:i(t)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){var e={};return function(t,n,r){return void 0===t?Object.keys(e):t in e?e[t]:void(e[t]={params:n,description:r})}}()},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a=n(317).default,i=n(224).default,o=n(371).default,s={basename:"data",globals:{},memo:{},gen:function(){var e;if(void 0===r.memo[this.name]){if(r.requestMemory(this.memory,this.immutable),e=this.memory.values.idx,void 0!==this.buffer)try{r.memory.heap.set(this.buffer,e)}catch(t){throw console.log(t),Error("error with request. asking for "+this.buffer.length+". current index: "+r.memoryIndex+" of "+r.memory.heap.length)}-1===this.name.indexOf("data")?s.memo[this.name]=e:r.memo[this.name]=e}else e=r.memo[this.name];return e}};t.default=function(e){var t,n,c,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2?arguments[2]:void 0,f=!1;if(void 0!==l&&void 0!==l.global&&r.globals[l.global])return r.globals[l.global];if("number"===typeof e)if(1!==u){n=[];for(var h=0;h<u;h++)n[h]=new Float32Array(e)}else n=new Float32Array(e);else if(Array.isArray(e)){var d=e.length;n=new Float32Array(d);for(var p=0;p<e.length;p++)n[p]=e[p]}else"string"===typeof e?(n={length:u>1?u:1},f=!0):e instanceof Float32Array?n=e:e instanceof Uint8Array?n=e:e instanceof AudioBuffer&&(n=e.getChannelData(0));if(t=Object.create(s),Object.assign(t,{buffer:n,name:s.basename+r.getUID(),dim:void 0!==n?n.length:1,channels:1,onload:void 0!==l&&l.onload||null,immutable:void 0!==l&&!0===l.immutable,load:function(n,i){a.loadSample(n,t).then(function(a){s.memo[e]=a,t.name=n,t.memory.values.length=t.dim=a.length,r.requestMemory(t.memory,t.immutable),r.memory.heap.set(a,t.memory.values.idx),"function"===typeof t.onload&&t.onload(a),i(t)})},memory:{values:{length:void 0!==n?n.length:1,idx:null}}},l),void 0!==l&&(void 0!==l.global&&(r.globals[l.global]=t),!0===l.meta))for(var v=function(e,n){Object.defineProperty(t,n,{get:function(){return i(t,n,{mode:"simple",interp:"none"})},set:function(e){return o(t,e,n)}})},m=0,y=t.buffer.length;m<y;m++)v(0,m);return!0===f?c=new Promise(function(n,r){a.loadSample(e,t).then(function(r){s.memo[e]=r,t.memory.values.length=t.dim=r.length,t.buffer=r,n(t)})}):void 0!==s.memo[e]?(r.once("memory init",function(){r.requestMemory(t.memory,t.immutable),r.memory.heap.set(t.buffer,t.memory.values.idx),"function"===typeof t.onload&&t.onload(t.buffer)}),c=t):c=t,c}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"sub",gen:function(){var e,t=r.getInputs(this),n=0,a=t[0],i=isNaN(a);return this.inputs.forEach(function(e){isNaN(e)&&!0}),n="  var "+this.name+" = ",t.forEach(function(e,r){if(0!==r){var o=isNaN(e),s=r===t.length-1;i||o?(!0,n+="".concat(a," - ").concat(e),s||(n+=" - ")):n+=a-=e}}),n+="\n",e=[this.name,n],r.memo[this.name]=this.name,e}};t.default=function(){for(var e=Object.create(a),t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Object.assign(e,{id:r.getUID(),inputs:n}),e.name="sub"+e.id,e}},,,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(4),a=n(5),i=new(function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,[{key:"setItem",value:function(e,t){if(!window.isNFT)return window.localStorage.setItem(e,t)}},{key:"removeItem",value:function(e){window.isNFT||window.localStorage.removeItem(e)}},{key:"getItem",value:function(e){return window.isNFT?null:window.localStorage.getItem(e)}}]),e}())},,function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){var t,n=0;if(!e||0===e.length)return n;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n}},,function(e,t,n){"use strict";function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;return Math.random()<e}function a(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;if(void 0!==n&&r(i)){var o=t+"Parameter";o in n?(a.disconnectFromAllModulators(),a.fromJson(n[o],e),a.set(n[t])):t in n&&a.set(n[t])}}n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a})},function(e,t,n){"use strict";n.d(t,"i",function(){return r}),n.d(t,"f",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"e",function(){return o}),n.d(t,"a",function(){return s}),n.d(t,"b",function(){return c}),n.d(t,"k",function(){return u}),n.d(t,"h",function(){return l}),n.d(t,"d",function(){return f}),n.d(t,"j",function(){return h}),n.d(t,"g",function(){return d}),n.d(t,"t",function(){return p}),n.d(t,"q",function(){return v}),n.d(t,"n",function(){return m}),n.d(t,"p",function(){return y}),n.d(t,"l",function(){return b}),n.d(t,"m",function(){return g}),n.d(t,"v",function(){return O}),n.d(t,"s",function(){return j}),n.d(t,"o",function(){return k}),n.d(t,"u",function(){return w}),n.d(t,"r",function(){return x});var r=1,a=2,i=3,o=4,s=7,c=8,u=9,l=10,f=11,h=12,d=13,p=function(e){return{type:r,zobject:e}},v=function(e){return{type:a,zmessage:e}},m=function(e,t){return{type:i,inlet:e,isInstanceInlet:t}},y=function(e){return{type:o,outlet:e}},b=function(e,t,n,r){return{type:s,sourceType:n,destType:r,destNode:t,sourceNode:e}},g=function(e,t,n,r){return{type:c,sourceType:n,destType:r,destNode:t,sourceNode:e}},O=function(e,t){return{type:u,zobject:e,text:t}},j=function(e,t){return{type:l,zmessage:e,text:t}},k=function(e){return{type:f,inletNumber:e}},w=function(e){return{type:h,zobject:e}},x=function(e){return{type:d,zmessage:e}}},function(e,t,n){"use strict";function r(e){for(var t,n,r=e.length;0!==r;)n=Math.floor(Math.random()*r),t=e[r-=1],e[r]=e[n],e[n]=t;return e}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"d",function(){return o}),n.d(t,"b",function(){return s}),n.d(t,"f",function(){return c}),n.d(t,"e",function(){return u}),n.d(t,"c",function(){return l});var r=n(114),a=n(151);Object(a.a)("alt",{arg1:"",arg2:"",argN:""},"Alternates between the arguments with every trigger received by this function");var i=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=0;return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var o=n[0];n[1],n[2];if(void 0===o)return Object(r.w)(!1);var s=t;if(1===t.length){var c=r.A.apply(void 0,[t[0]].concat(n));Array.isArray(c)&&(s=c)}var u=a++%s.length;return r.A.apply(void 0,[Object(r.K)(s[u])].concat(n))}},o=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=0,i=void 0,o=void 0;return function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];var c=n[0],u=n[1];n[2];if(o===u)return i;if(o=u,void 0===c)return void 0===i?t[0]:i;var l=t;if(1===t.length){var f=r.A.apply(void 0,[t[0]].concat(n));Array.isArray(f)&&(l=f)}var h=a++%l.length;return i=r.A.apply(void 0,[Object(r.K)(l[h])].concat(n))}};Object(a.a)("altn",{n:"How many triggers it takes to increment the output conditional",arg1:"Output conditional",arg2:"Output conditional",argN:"Output conditional (will loop back to arg1 after this this)"},"Alternates between the arguments every n-many triggers received by this function");var s=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var i=0,o=0;return function(t,a,s,c){var u="number"===typeof e?e:e();if(++i%u===0&&o++,void 0===t)return Object(r.w)(!1);var l=n[o%n.length];return Object(r.A)(l,t,a,s,c)}},c=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var i=0,o=0;return function(t,a,s,c){var u="number"===typeof e?e:e();++i%u===0&&o++;var l=n[o%n.length];return Object(r.A)(l,t,a,s,c)}},u=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=0;return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n[0],n[1],n[2];if(1===t.length){var o=r.A.apply(void 0,[t[0]].concat(n));Array.isArray(o)&&(t=o)}var s=a++%t.length;return r.A.apply(void 0,[Object(r.K)(t[s])].concat(n))}};Object(a.a)("every",{n:"",action:""},"Trigger a given action every n-many triggers");var l=function(e,t,n){var a=0;return function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];var c=r.A.apply(void 0,[e].concat(o));if(o[0]&&++a%c===0)return r.A.apply(void 0,[t].concat(o));return n?r.A.apply(void 0,[n].concat(o)):Object(r.w)(!0)}}},function(e,t,n){"use strict";n.d(t,"p",function(){return l}),n.d(t,"q",function(){return f}),n.d(t,"l",function(){return h}),n.d(t,"c",function(){return d}),n.d(t,"d",function(){return p}),n.d(t,"b",function(){return v}),n.d(t,"e",function(){return m}),n.d(t,"u",function(){return y}),n.d(t,"r",function(){return b}),n.d(t,"h",function(){return g}),n.d(t,"i",function(){return O}),n.d(t,"j",function(){return j}),n.d(t,"n",function(){return k}),n.d(t,"g",function(){return w}),n.d(t,"s",function(){return x}),n.d(t,"v",function(){return S}),n.d(t,"o",function(){return P}),n.d(t,"w",function(){return E}),n.d(t,"f",function(){return T}),n.d(t,"t",function(){return A}),n.d(t,"k",function(){return M}),n.d(t,"a",function(){return R}),n.d(t,"m",function(){return C}),n.d(t,"x",function(){return N});var r=n(108),a=n(1),i=n(11),o=n(114),s=(n(260),n(331),n(193));function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=function(e,t,n){return function(){for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];var u=o.A.apply(void 0,[t].concat(s)),l=Object(i.a)(o.A.apply(void 0,[e].concat(s))),f=o.A.apply(void 0,[n].concat(s))(l[u]);return f=Array.isArray(f)?Object(i.a)(f):Object(a.a)({},f),l[u]=f,l}},f=function(e,t,n){return function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];var c=o.A.apply(void 0,[t].concat(i)),u=o.A.apply(void 0,[e].concat(i));if(n){var l=Object(a.a)({},o.A.apply(void 0,[n].concat(i)));return l.operator=u,l.operand=c,l}return function(e){return e.operator=u,e.operand=c,e}}},h=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=o.A.apply(void 0,[e].concat(r)),s=o.A.apply(void 0,[t].concat(r)),u=i.flat(16);return function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!Array.isArray(t))return{p:t,count:r};var a,i=c(t);try{for(i.s();!(a=i.n()).done;){var o=a.value,s=e(o,n,r);if(s.count===n&&s.p)return s;Array.isArray(o)?r=s.count:r++}}catch(u){i.e(u)}finally{i.f()}return{count:r}}(i,s%u.length).p}},d=function(e){return!Array.isArray(e)},p=function(e){return null===e.transpose},v=function(e){return e.accent},m=function(e){return e.staccato},y=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var c=void 0;return function(){for(var t=arguments.length,i=new Array(t),u=0;u<t;u++)i[u]=arguments[u];var l=o.A.apply(void 0,[e].concat(i));return void 0===l?c:c=function e(t){var c=n.map(function(e){var t=Object(r.a)(e,2),n=t[0],a=t[1];return[o.A.apply(void 0,[n].concat(i)),o.A.apply(void 0,[a].concat(i))]});if(d(t)){var u=c.find(function(e){var n=Object(r.a)(e,2),a=n[0];return n[1],a===t.transpose});if(u){var l=u[1];return Array.isArray(l)?l:"string"===typeof l?Object(s.f)(l).apply(void 0,i):Object(a.a)({},t,{transpose:l})}return t}return t.map(function(t){return e(t)})}(l)}},b=function(e,t,n){return function(){for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];var l=o.A.apply(void 0,[e].concat(a)),f=Object(i.a)(l[0]),h=o.A.apply(void 0,[t].concat(a)).map(function(e){return o.A.apply(void 0,[e].concat(a))}),d=o.A.apply(void 0,[n].concat(a));Array.isArray(d)||(d=null===d?Object(s.f)("~").apply(void 0,a):Object(s.f)(d).apply(void 0,a));var p,v=c(h);try{for(v.s();!(p=v.n()).done;){f[p.value%f.length]=d}}catch(m){v.e(m)}finally{v.f()}return[f]}},g=function(e,t,n){return function(){for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];var u=o.A.apply(void 0,[e].concat(a));u=Object(i.a)(u[0]);var l=o.A.apply(void 0,[n].concat(a)),f=o.A.apply(void 0,[t].concat(a));return Array.isArray(l)?u.splice(f,0,l):u.splice(f,0,Object(s.f)(new String(l))()),[u]}},O=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var c=o.A.apply(void 0,[e].concat(r));c=Object(i.a)(c[0]);var u=n.map(function(e){return o.A.apply(void 0,[e].concat(r))}),l=u.length;return[c.flatMap(function(e,t){return[e,Array.isArray(u[t%l])?u[t%l]:Object(s.f)(new String(u[t%l]))()]})]}},j=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var c=o.A.apply(void 0,[e].concat(r));c=Object(i.a)(c[0]);var u=n.map(function(e){return o.A.apply(void 0,[e].concat(r))}),l=u.length;return[c.flatMap(function(e,t){return[Array.isArray(u[t%l])?u[t%l]:Object(s.f)(new String(u[t%l]))(),e]})]}},k=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var s=o.A.apply(void 0,[e].concat(r));return[(s=Object(i.a)(s[0])).map(function(e,n){return o.A.apply(void 0,[t(e,n)].concat(r))})]}},w=function(e,t,n){return function(){for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];var u=o.A.apply(void 0,[e].concat(a));u=Object(i.a)(u[0]);var l=o.A.apply(void 0,[n].concat(a)),f=o.A.apply(void 0,[t].concat(a))%u.length,h=u[f];return Array.isArray(h)||(h=[h]),Array.isArray(l)||(l=Object(s.f)(new String(l))()),u[f]=[].concat(Object(i.a)(h),[l]),[u]}},x=function(e,t,n){return function(){for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];var c=o.A.apply(void 0,[e].concat(a));c=Object(i.a)(c[0]);var u=o.A.apply(void 0,[t].concat(a)),l=o.A.apply(void 0,[n].concat(a));return c.splice(u,l),[c]}},S=function(e,t,n){return function(){for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];var c=o.A.apply(void 0,[e].concat(a));c=Object(i.a)(c[0]);var u=o.A.apply(void 0,[t].concat(a)),l=o.A.apply(void 0,[n(c[u])].concat(a));return c[u]=l,[c]}},P=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var s=o.A.apply(void 0,[e].concat(r));Array.isArray(s)||(s=[s]);for(var c=o.A.apply(void 0,[t].concat(r)),u=[],l=0;l<c;l++)u=[].concat(Object(i.a)(u),Object(i.a)(s));return[u]}},E=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0;return function(){for(var s=arguments.length,u=new Array(s),l=0;l<s;l++)u[l]=arguments[l];var f=o.A.apply(void 0,[e].concat(u)),h=f.cycleLength;f=!r&&Array.isArray(f[0])?Object(i.a)(f[0]):Object(i.a)(f);var d=o.A.apply(void 0,[t].concat(u));h&&(f.cycleLength=h);var p=function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;if(!Array.isArray(t))return i===r?{pattern:o.A.apply(void 0,[n(t,s,l)].concat(u)),count:i}:{pattern:t,count:i};var f,h=[],d=0,p=c(t);try{for(p.s();!(f=p.n()).done;){var v=f.value,m=e(v,r,i,t,d++);v.cycleLength&&(m.pattern.cycleLength=v.cycleLength),h.push(m.pattern),Array.isArray(v)?i=m.count:a&&null!==v.transpose&&i++}}catch(y){p.e(y)}finally{p.f()}return{pattern:h,count:i}}(f,d);return r?p.pattern:[p.pattern]}},T=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return Object(a.a)({},o.A.apply(void 0,[e].concat(r)),{accent:o.A.apply(void 0,[t].concat(r))})}},A=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return Object(a.a)({},o.A.apply(void 0,[e].concat(r)),{staccato:o.A.apply(void 0,[t].concat(r))})}},M=function(e,t){var n,r,a;return function(){for(var i=arguments.length,u=new Array(i),l=0;l<i;l++)u[l]=arguments[l];var f=o.A.apply(void 0,[e].concat(u)),h=o.A.apply(void 0,[t].concat(u));if(r===f&&h===a)return n;r=f,a=h;return n=[function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(d(t))return n.includes(r)?{pattern:t,count:r}:{pattern:Object(s.f)("~")(),count:r};var a,i=[],o=c(t);try{for(o.s();!(a=o.n()).done;){var u=a.value,l=e(u,n,r);d(u)?r++:r=l.count,i.push(l.pattern)}}catch(f){o.e(f)}finally{o.f()}return{count:r,pattern:i}}(f,h).pattern]}},R=function(e,t){for(var n=0,r=0;r<e.length;r++){var a=e[r];a.cycleLength?n+=a.cycleLength:n++}return 2*t*n},C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];for(var s=o.A.apply(void 0,[t].concat(a)),c=o.A.apply(void 0,[e].concat(a)),u=0,l=0;l<c.length;l++){var f=c[l];f.cycleLength?u+=f.cycleLength:u++}return o.A.apply(void 0,[n].concat(a)),2*s*u}},N=function(e,t){var n,r,a;return function(){for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];var u=o.A.apply(void 0,[t].concat(s)),l=o.A.apply(void 0,[e].concat(s));if(0===u)return l;if(u===r&&n===l)return a;r=u,n=l;for(var f=void 0,h=0,d=l.length-1;d>=0;d--){var p=l[d];if(Array.isArray(p)&&(p=p[0]),f!==p.figureId&&(f=p.figureId,d!==l.length-1&&h++,h===u))break}var v=0;for(v=0;v<l.length&&l[v].lastFigure===f;v++);var m=l.slice(v,d+1);return a=m}}},,,,,,,function(e,t,n){"use strict";var r=n(11),a=n(42),i=n.n(a),o=n(56),s=n(4),c=n(5),u=(n(119),n(162)),l=n(180),f="undefined"!==typeof window.web3,h=function(){function e(t){Object(s.a)(this,e),this.address=t,this.distinct=!1,this.selectStatements=[],this.whereClauses=[],this.groupBy=[],this.joinClauses=[],this.limitSize=void 0,this.fromBlockNumber="0x2",this.toBlockNumber=void 0}return Object(c.a)(e,[{key:"from",value:function(e){return this.eventLog=e,this}},{key:"select",value:function(e){return this.selectStatements.push(e),this}},{key:"distinct",value:function(){return this.distinct=!0,this}},{key:"groupBy",value:function(e){return this.groupBy.push(e),this}},{key:"where",value:function(e,t){return this.whereClauses.push(new d(e,t)),this}},{key:"whereIn",value:function(e,t){return this.whereClauses.push(new d(e,void 0,t)),this}},{key:"join",value:function(e,t){this.joinClauses.push(new p(e,t))}},{key:"fromBlock",value:function(e){return this.fromBlockNumber=u.a.utils.toHex(e),this}},{key:"toBlock",value:function(e){return this.toBlockNumber=u.a.utils.toHex(e),this}},{key:"limit",value:function(e){return this.limitSize=e,this}},{key:"getTopics",value:function(){var e=[u.a.utils.sha3(this.eventLog.event)];for(var t in this.eventLog.topics){var n=this.eventLog.topics[parseInt(t)],r=null;for(var a in this.whereClauses){var i=this.whereClauses[parseInt(a)];if(i.name===n.name){var o=void 0!==i.value?i.value:i.valueList[0];r=n.convertTo(o)}}e.push(r)}return e}},{key:"executeQuery",value:function(){var e=this;return new Promise(function(t,n){u.a.eth.getPastLogs({address:e.address,topics:e.getTopics(),toBlock:e.toBlockNumber,fromBlock:e.fromBlockNumber},function(r,a){if(console.log("reuslts=",a),r)n(r);else{var i=[];a.reverse();for(var o=Math.min(a.length,e.limitSize||a.length),s=0;s<o;s++)i.push(e.parseResult(a[s]));t(i)}})})}},{key:"watchQuery",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 3:n=e.sent,(f?u.a:u.b).eth.subscribe("logs",{address:this.address,topics:this.getTopics(),fromBlock:u.a.utils.toHex(n)},function(e,n){e&&(console.log("error watching "),console.log(e));var a=r.parseResult(n);console.log("watch query got "),console.log(a),t(a)});case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"parseResult",value:function(e){if(void 0!==e&&null!==e){var t={};for(var n in this.selectStatements){var r=this.selectStatements[parseInt(n)];for(var a in this.eventLog.topics){var i=e.topics[1+parseInt(a)],o=this.eventLog.topics[parseInt(a)];o.name===r&&(t[r]=o.type.convertFrom(i))}var s=0;for(var c in this.eventLog.data){c=parseInt(c);var u=this.eventLog.data[c];if(void 0!==u&&r==u.name){var f=e.data.slice(2+s,2+s+u.size);f="0x"+f,u.type==l.n&&(f="0x"+e.data.slice(130+64*c)),t[r]=u.convertFrom(f)}s+=u.size}}return t.blockNumber=e.blockNumber,t}}},{key:"getCopy",value:function(){var t=new e(this.address);return t.eventLog=this.eventLog,t.selectStatements=Object(r.a)(this.selectStatements),t.joinClauses=Object(r.a)(this.joinClauses),t.groupBy=Object(r.a)(this.groupBy),t.fromBlockNumber=this.fromBlockNumber,t.toBlockNumber=this.toBlockNumber,t.limitSize=this.limitSize,t}},{key:"getJson",value:function(){return{address:this.address,eventLog:this.eventLog.event,selectStatements:Object(r.a)(this.selectStatements),whereClauses:Object(r.a)(this.whereClauses),joinClauses:Object(r.a)(this.joinClauses),groupBy:Object(r.a)(this.groupBy),fromBlockNumber:u.a.utils.hexToNumber(this.fromBlockNumber),toBlockNumber:void 0===this.toBlockNumber?void 0:u.a.utils.hexToNumber(this.toBlockNumber),limitSize:this.limitSize,distinct:this.distinct}}}]),e}(),d=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Object(s.a)(this,e),this.name=t,this.value=n,this.valueList=r},p=function e(t,n){Object(s.a)(this,e),this.event=t,this.field=n};t.a=h},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(7),u=n(8),l=n(2),f=n(127),h=n(159),d=n(162),p=n(832);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var m=function(e){Object(c.a)(n,e);var t=v(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this)).name=e,s.contentHash=r,s.user=a,s.blockNumber=i,s.tags=[],s}return Object(s.a)(n,[{key:"getJson",value:function(){return{name:this.name,contentHash:this.contentHash,user:this.user,blockNumber:this.blockNumber,hasEdits:this.hasEdits}}},{key:"fromJson",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!e.name&&t||(e.contentHash&&(this.contentHash=e.contentHash),this.user=e.user,this.blockNumber=e.blockNumber,this.hasEdits=e.hasEdits,t&&this.load()),this}},{key:"load",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.contentHash){e.next=4;break}return e.next=3,f.a.presets.getTags(this.contentHash);case 3:this.tags=e.sent;case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getContentType",value:function(){return p.a}},{key:"title",get:function(){return this.name}},{key:"ipfsHash",get:function(){return this.contentHash}},{key:"getName",value:function(){return this.name}},{key:"getId",value:function(){return this.contentHash}},{key:"newTag",value:function(e){this.isCreated()&&(this.tags.push(e),f.a.presets.tagPreset(this.contentHash,[e],0))}},{key:"save",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.track.trackNumber,this.name=t,e.next=4,h.a.getAccount();case 4:return this.user=e.sent,this.hasEdits=!1,e.next=8,d.a.eth.getBlockNumber();case 8:return this.blockNumber=e.sent,e.next=11,this.track.sequencerEngine.saveTrackPreset(n,t,!1,0,this.contentHash);case 11:this.contentHash=e.sent;case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),n}(n(538).a);t.a=m},,function(e,t,n){"use strict";n.r(t);var r=n(112).default,a=(n(202).default,{basename:"peek",gen:function(){this.name;var e,t,n,a,i=r.getInputs(this);return a=i[1],n=(0|Math.log2(this.data.buffer.length))===Math.log2(this.data.buffer.length),"simple"===this.mode?e="memory[ ".concat(a," + ").concat(i[0]," ]"):(e="  var ".concat(this.name,"_dataIdx  = ").concat(a,", \n      ").concat(this.name,"_phase = ").concat("samples"===this.mode?i[0]:i[0]+" * "+this.data.buffer.length,", \n      ").concat(this.name,"_index = ").concat(this.name,"_phase | 0,\n"),t="wrap"===this.boundmode?n?"( ".concat(this.name,"_index + 1 ) & (").concat(this.data.buffer.length," - 1)"):"".concat(this.name,"_index + 1 >= ").concat(this.data.buffer.length," ? ").concat(this.name,"_index + 1 - ").concat(this.data.buffer.length," : ").concat(this.name,"_index + 1"):"clamp"===this.boundmode?"".concat(this.name,"_index + 1 >= ").concat(this.data.buffer.length-1," ? ").concat(this.data.buffer.length-1," : ").concat(this.name,"_index + 1"):"fold"===this.boundmode||"mirror"===this.boundmode?"".concat(this.name,"_index + 1 >= ").concat(this.data.buffer.length-1," ? ").concat(this.name,"_index - ").concat(this.data.buffer.length-1," : ").concat(this.name,"_index + 1"):"".concat(this.name,"_index + 1"),"linear"===this.interp?(e+="      ".concat(this.name,"_frac  = ").concat(this.name,"_phase - ").concat(this.name,"_index,\n      ").concat(this.name,"_base  = memory[ ").concat(this.name,"_dataIdx +  ").concat(this.name,"_index ],\n      ").concat(this.name,"_next  = ").concat(t,","),"ignore"===this.boundmode?e+="\n      ".concat(this.name,"_out   = ").concat(this.name,"_index >= ").concat(this.data.buffer.length-1," || ").concat(this.name,"_index < 0 ? 0 : ").concat(this.name,"_base + ").concat(this.name,"_frac * ( memory[ ").concat(this.name,"_dataIdx + ").concat(this.name,"_next ] - ").concat(this.name,"_base )\n\n"):e+="\n      ".concat(this.name,"_out   = ").concat(this.name,"_base + ").concat(this.name,"_frac * ( memory[ ").concat(this.name,"_dataIdx + ").concat(this.name,"_next ] - ").concat(this.name,"_base )\n\n")):e+="      ".concat(this.name,"_out = memory[ ").concat(this.name,"_dataIdx + ").concat(this.name,"_index ]\n\n"),r.memo[this.name]=this.name+"_out",[this.name+"_out",e])},defaults:{channels:1,mode:"phase",interp:"linear",boundmode:"wrap"}});t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=Object.create(a),o="undefined"===typeof e.basename?r.lib.data(e):e;return Object.assign(i,{data:o,dataName:o.name,uid:r.getUID(),inputs:[t,o]},a.defaults,n),i.name=i.basename+i.uid,i}},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(1),s=n(115),c=n(4),u=n(5),l=n(7),f=n(8),h=n(2),d=n(227),p=(n(113),n(146),n(116),n(6),n(14),n(209),n(134)),v=n(250);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}Object(d.a)("Phaser RNBO",function(e){return new y(e)});var y=function(e){Object(l.a)(n,e);var t=m(n);function n(e){return Object(c.a)(this,n),t.call(this,"Phaser RNBO",e,"/phaser-8.export.json",{Feedback:{inputNumber:2,defaultValue:.5,min:-.9,max:.9},Rate:{inputNumber:3,defaultValue:.1,min:0,max:64},Wet:{inputNumber:4,defaultValue:.5,min:0,max:1}})}return Object(u.a)(n,[{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(Object(p.a)(v.a));function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}Object(d.a)("Reverb RNBO",function(e){return new g(e)});var g=function(e){Object(l.a)(n,e);var t=b(n);function n(e){return Object(c.a)(this,n),t.call(this,"Reverb RNBO",e,"/reverb.export.json",{"Delay Tune":{inputNumber:2,defaultValue:1,min:.1,max:6},Wet:{inputNumber:3,defaultValue:1,min:0,max:1},Size:{inputNumber:4,defaultValue:1,min:1,max:16},Dampening:{inputNumber:5,defaultValue:.7,min:.01,max:.98}})}return Object(u.a)(n,[{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(Object(p.a)(v.a));function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}Object(d.a)("WaveFolder RNBO",function(e){return new j(e)});var j=function(e){Object(l.a)(n,e);var t=O(n);function n(e){return Object(c.a)(this,n),t.call(this,"WaveFolder RNBO",e,"/wavefolder-rnbo.export.json",{Drive:{inputNumber:2,defaultValue:1,min:.01,max:32},Wet:{inputNumber:3,defaultValue:.5,min:0,max:1},"Stereo Spread":{inputNumber:4,defaultValue:.9,min:0,max:1}})}return Object(u.a)(n,[{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(Object(p.a)(v.a));function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}Object(d.a)("Frequency Reverb RNBO",function(e){return new w(e)});var w=function(e){Object(l.a)(n,e);var t=k(n);function n(e){return Object(c.a)(this,n),t.call(this,"Frequency Reverb RNBO",e,"/frequencyreverb.export.json",{"Delay Tune":{inputNumber:2,defaultValue:1,min:.1,max:6},Size:{inputNumber:3,defaultValue:1,min:1,max:16},Dampening:{inputNumber:4,defaultValue:.7,min:.01,max:.98},Frequency:{inputNumber:5,defaultValue:1,min:1,max:2e3},"HiPass Filter":{inputNumber:6,defaultValue:1e3,min:1,max:1e4},Wet:{inputNumber:7,defaultValue:.5,min:0,max:1}})}return Object(u.a)(n,[{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(Object(p.a)(v.a));function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}Object(d.a)("Frequency Delay RNBO",function(e){return new S(e)});var S=function(e){Object(l.a)(n,e);var t=x(n);function n(e){return Object(c.a)(this,n),t.call(this,"Frequency Delay RNBO",e,"/frequency-delay.export.json",{Frequency:{inputNumber:2,defaultValue:1,min:1,max:2e3},"Frequency Spread":{inputNumber:3,defaultValue:0,min:0,max:255},"Delay Time":{inputNumber:4,defaultValue:1,min:.1,max:100},"Delay Spread":{inputNumber:5,defaultValue:10,min:.1,max:100},"Num banks":{inputNumber:6,defaultValue:8,min:4,max:15},Resonance:{inputNumber:7,defaultValue:.5,min:0,max:1},Wet:{inputNumber:8,defaultValue:.5,min:0,max:1}})}return Object(u.a)(n,[{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(Object(p.a)(v.a));function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}Object(d.a)("Grain Reverb RNBO",function(e){return new E(e)});var E=function(e){Object(l.a)(n,e);var t=P(n);function n(e){return Object(c.a)(this,n),t.call(this,"Grain Reverb RNBO",e,"/grain-reverb.export.json",{"Delay Tune":{inputNumber:2,defaultValue:1,min:.1,max:6},Wet:{inputNumber:3,defaultValue:1,min:0,max:1},Size:{inputNumber:4,defaultValue:1,min:1,max:16},Dampening:{inputNumber:5,defaultValue:.7,min:.01,max:.98},"Grain Size":{inputNumber:6,defaultValue:1,min:.01,max:4},"Grain Pitch":{inputNumber:7,defaultValue:0,min:-24,max:24}})}return Object(u.a)(n,[{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(Object(p.a)(v.a)),T=n(994);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}Object(d.a)("Granulator 2 RNBO",function(e){return new M(e)},T.a);var M=function(e){Object(l.a)(n,e);var t=A(n);function n(e){return Object(c.a)(this,n),t.call(this,"Granulator 2 RNBO",e,"/granulator-2.export.json",{Pitch:{inputNumber:2,defaultValue:12,min:-32,max:32},"Grain Size":{inputNumber:3,defaultValue:4,min:.01,max:32},Density:{inputNumber:4,defaultValue:10,min:1,max:160},Wet:{inputNumber:5,defaultValue:.5,min:0,max:1},"Buffer Size":{inputNumber:6,defaultValue:1,min:.1,max:1},"Playback Speed":{inputNumber:7,defaultValue:1,min:.125,max:4},"CrossFade Speed":{inputNumber:8,defaultValue:1,min:.1,max:8}})}return Object(u.a)(n,[{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(Object(p.a)(v.a)),R=n(906),C=(n(907),n(908)),N=n(989),I=n(905),q=(n(909),n(910),n(911),n(912)),_=n(913),D=n(915),F=n(990),L=n(573),B=n(282),z=n(366),J=n(917),V=n(918),H=n(919),U=n(920),G=n(921),W=n(922),K=(n(923),n(924),n(925),n(374)),Q=n(123),Z=n(574),Y=n(926),$=n(575),X=n(929),ee=n(930),te=n(931),ne=n(991),re=n(932),ae=n(933),ie=n(934),oe=n(935);n.d(t,"d",function(){return se}),n.d(t,"a",function(){return ce}),n.d(t,"b",function(){return ue}),n.d(t,"c",function(){return le});var se={Filter:function(e){return new s.a.FilterEffect(e)},"Faust WaveFolder":function(e){return new ne.a(e)},"Wave Folder":function(e){return new te.a(e)},Delay:function(e){return new B.a(e)},Reverb:function(e){return new s.a.ReverbEffect(e)},"Convolver Reverb":function(e){return new z.a(e)},Chorus:function(e){return new s.a.ChorusEffect(e)},"Multiband Compressor":function(e){return new F.a(e)},Distortion:function(e){return new U.a(e)},Compressor:function(e){return new H.a(e)},"Bit Crusher":function(e){return new V.a(e)},"Ultra Phaser":function(e){return new L.a(e)},"Pitch Shift":function(e){return new G.a(e)},Panner:function(e){return new W.a(e)},Gain:function(e){return new R.a(e)},EQ8:function(e){return new K.a(e)},Chebyshev:function(e){return new J.a(e)},"Stereo Widener":function(e){return new q.a(e)},"Tape Delay":function(e){return new Y.a(e)},Saturator:function(e){return new Z.a(e)},"Stereo Delay":function(e){return new X.a(e)},Oscilloscope:function(e){return new D.a(e)},"Effect Rack":function(e){return new $.a(e)},"Multi Filter":function(e){return new I.a(e)},"Freak Shifter":function(e){return new N.a(e)},"Guitar Amp":function(e){return new ee.a(e)},"Ring Modulator":function(e){return new _.a(e)},Vocoder:function(e){return new re.a(e)},Follower:function(e){return new ae.a(e)},"Frequency Shifter":function(e){return new ie.a(e)},"Transient Shaper":function(e){return new oe.a(e)},"Soft Clipper":function(e){return new C.a(e)}},ce=function(){var e=Object(o.a)({},se),t=Object(d.a)();for(var n in t)e[n]=t[n].creator;return e};function ue(e,t,n,r,a){if(!e)return{effect:new R.a(n),bulk:{}};var i=e.name,o=(Object(d.a)()[i]?Object(d.a)()[i].creator:se[i])(n);if(void 0!==r){var s=(new Q.a).forTrack(t[r]);o.registerContext(s)}else a&&o.registerContext(a);var c=o.fromJson(e,t,r);return{effect:o,bulk:c}}function le(e,t,n,r,a){return fe.apply(this,arguments)}function fe(){return(fe=Object(i.a)(a.a.mark(function e(t,n,r,i,o){var s,c,u,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",{effect:new R.a(r),bulk:{}});case 2:return s=t.name,c=(Object(d.a)()[s]?Object(d.a)()[s].creator:se[s])(r),void 0!==i?(u=(new Q.a).forTrack(n[i]),c.registerContext(u)):o&&c.registerContext(o),e.next=7,c.fromJson(t,n,i);case 7:return l=e.sent,e.abrupt("return",{effect:c,bulk:l});case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}},function(e,t,n){"use strict";var r=n(115),a=n(905),i=n(991),o=n(4),s=n(5),c=n(7),u=n(8),l=n(2),f=n(227),h=n(113),d=n(146),p=n(116),v=n(6),m=n.n(v),y=n(14),b=(n(209),n(134)),g=n(250),O=n(994);function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}Object(f.a)("Granulator RNBO",function(e){return new k(e)},O.a);var k=function(e){Object(c.a)(n,e);var t=j(n);function n(e){return Object(o.a)(this,n),t.call(this,"Granulator RNBO",e,"/granulator.export.json",{Pitch:{inputNumber:2,defaultValue:10,min:-32,max:32},"Grain Size":{inputNumber:3,defaultValue:.5,min:.01,max:16},Density:{inputNumber:4,defaultValue:10,min:1,max:160},Wet:{inputNumber:5,defaultValue:.5,min:0,max:1}})}return Object(s.a)(n,[{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(Object(b.a)(g.a)),w=n(906),x=n(42),S=n.n(x),P=n(56),E=n(10),T=n(32),A=n(31),M=n(611);function R(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}"undefined"===typeof AudioWorkletNode&&alert("AudioWorklet is not supported in this browser !");var C=function(e){Object(c.a)(n,e);var t=R(n);function n(e,r,a){var i;Object(o.a)(this,n),(i=t.call(this,e,"whetstone",a)).baseURL=r,i.json=a.processorOptions.json,i.json_object=JSON.parse(i.json),i.parse_ui=function(e,t){for(var n=0;n<e.length;n++)this.parse_group(e[n],t)},i.parse_group=function(e,t){e.items&&this.parse_items(e.items,t)},i.parse_items=function(e,t){for(var n=0;n<e.length;n++)this.parse_item(e[n],t)},i.parse_item=function(e,t){if("vgroup"===e.type||"hgroup"===e.type||"tgroup"===e.type)this.parse_items(e.items,t);else if("hbargraph"===e.type||"vbargraph"===e.type)t.outputs_items.push(e.address);else if("vslider"===e.type||"hslider"===e.type||"button"===e.type||"checkbox"===e.type||"nentry"===e.type){if(t.inputs_items.push(e.address),t.descriptor.push(e),void 0!==e.meta)for(var n=0;n<e.meta.length;n++)void 0!==e.meta[n].midi&&("pitchwheel"===e.meta[n].midi.trim()?t.fPitchwheelLabel.push({path:e.address,min:parseFloat(e.min),max:parseFloat(e.max)}):"ctrl"===e.meta[n].midi.trim().split(" ")[0]&&t.fCtrlLabel[parseInt(e.meta[n].midi.trim().split(" ")[1])].push({path:e.address,min:parseFloat(e.min),max:parseFloat(e.max)}));var r="set"+e.address,a="get"+e.address;r=r.replace(/\/./g,function(e){return e.substr(1,1).toUpperCase()}),a=a.replace(/\/./g,function(e){return e.substr(1,1).toUpperCase()}),t[r]=function(n){t.setParamValue(e.address,n)},t[a]=function(){return t.getParamValue(e.address)}}},i.output_handler=null,i.inputs_items=[],i.outputs_items=[],i.descriptor=[],i.fPitchwheelLabel=[],i.fCtrlLabel=new Array(128);for(var s=0;s<i.fCtrlLabel.length;s++)i.fCtrlLabel[s]=[];i.parse_ui(i.json_object.ui,Object(A.a)(i)),i.port.onmessage=i.handleMessage.bind(Object(A.a)(i));try{i.parameters&&i.parameters.forEach(function(e){return e.automationRate="k-rate"})}catch(c){}return i}return Object(s.a)(n,[{key:"handleMessage",value:function(e){var t=e.data;this.output_handler&&this.output_handler(t.path,t.value)}},{key:"destroy",value:function(){this.port.postMessage({type:"destroy"}),this.port.close()}},{key:"getJSON",value:function(){return this.json}},{key:"getMetadata",value:function(){var e=Object(P.a)(S.a.mark(function e(){var t=this;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){var n=""===t.baseURL?"main.json":t.baseURL+"/main.json";fetch(n).then(function(e){return e.json()}).then(function(t){e(t)})}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"setParamValue",value:function(e,t){this.parameters.get(e).setValueAtTime(t,0)}},{key:"setParam",value:function(e,t){this.parameters.get(e).setValueAtTime(t,0)}},{key:"getParamValue",value:function(e){return this.parameters.get(e).value}},{key:"getParam",value:function(e){return this.parameters.get(e).value}},{key:"setOutputParamHandler",value:function(e){this.output_handler=e}},{key:"getOutputParamHandler",value:function(){return this.output_handler}},{key:"getNumInputs",value:function(){return parseInt(this.json_object.inputs)}},{key:"getNumOutputs",value:function(){return parseInt(this.json_object.outputs)}},{key:"inputChannelCount",value:function(){return parseInt(this.json_object.inputs)}},{key:"outputChannelCount",value:function(){return parseInt(this.json_object.outputs)}},{key:"getParams",value:function(){return this.inputs_items}},{key:"getDescriptor",value:function(){var e={};for(var t in this.descriptor)this.descriptor.hasOwnProperty(t)&&"bypass"!=this.descriptor[t].label&&(e=Object.assign(Object(T.a)({},this.descriptor[t].label,{minValue:this.descriptor[t].min,maxValue:this.descriptor[t].max,defaultValue:this.descriptor[t].init}),e));return e}},{key:"ctrlChange",value:function(e,t,r){if(this.fCtrlLabel[t]!==[])for(var a=0;a<this.fCtrlLabel[t].length;a++){var i=this.fCtrlLabel[t][a].path;this.setParamValue(i,n.remap(r,0,127,this.fCtrlLabel[t][a].min,this.fCtrlLabel[t][a].max)),this.output_handler&&this.output_handler(i,this.getParamValue(i))}}},{key:"pitchWheel",value:function(e,t){for(var r=0;r<this.fPitchwheelLabel.length;r++){var a=this.fPitchwheelLabel[r];this.setParamValue(a.path,n.remap(t,0,16383,a.min,a.max)),this.output_handler&&this.output_handler(a.path,this.getParamValue(a.path))}}},{key:"midiMessage",value:function(e){var t=e[0]>>4,n=15&e[0],r=e[1],a=e[2];9!==n&&(11===t?this.ctrlChange(n,r,a):14===t&&this.pitchWheel(n,128*a+r))}},{key:"onMidi",value:function(e){}},{key:"getState",value:function(){var e=Object(P.a)(S.a.mark(function e(){var t,n;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=new Object,n=0;n<this.getParams().length;n++)Object.assign(t,Object(T.a)({},this.getParams()[n],"".concat(this.getParam(this.getParams()[n]))));return e.abrupt("return",new Promise(function(e){e(t)}));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setState",value:function(){var e=Object(P.a)(S.a.mark(function e(t){var n=this;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){for(var r in t)t.hasOwnProperty(r)&&n.setParam(r,t[r]);try{n.gui.setAttribute("state",JSON.stringify(t))}catch(a){console.warn("Plugin without gui or GUI not defined",a)}e(t)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"setPatch",value:function(e){this.setState(this.presets[e])}}],[{key:"remap",value:function(e,t,n,r,a){return 1*(e-t)/(n-t)*(a-r)+r}}]),n}(Object(M.a)(AudioWorkletNode)),N=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Object(o.a)(this,e),console.log("baseLatency "+t.baseLatency),console.log("outputLatency "+t.outputLatency),console.log("sampleRate "+t.sampleRate),this.context=t,this.baseURL=n,this.pathTable=[],this.fWorkletProcessors=this.fWorkletProcessors||[]}return Object(s.a)(e,[{key:"heap2Str",value:function(e){for(var t="",n=0;0!==e[n];)t+=String.fromCharCode(e[n++]);return t}},{key:"load",value:function(){var e=Object(P.a)(S.a.mark(function e(){var t,n,r,a,i,o,s,c,u,l,f,h,d;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={env:{memoryBase:0,tableBase:0,_abs:Math.abs,_acosf:Math.acos,_asinf:Math.asin,_atanf:Math.atan,_atan2f:Math.atan2,_ceilf:Math.ceil,_cosf:Math.cos,_expf:Math.exp,_floorf:Math.floor,_fmodf:function(e,t){return e%t},_logf:Math.log,_log10f:Math.log10,_max_f:Math.max,_min_f:Math.min,_remainderf:function(e,t){return e-Math.round(e/t)*t},_powf:Math.pow,_roundf:Math.fround,_sinf:Math.sin,_sqrtf:Math.sqrt,_tanf:Math.tan,_acoshf:Math.acosh,_asinhf:Math.asinh,_atanhf:Math.atanh,_coshf:Math.cosh,_sinhf:Math.sinh,_tanhf:Math.tanh,_isnanf:Number.isNaN,_isinff:function(e){return!isFinite(e)},_copysignf:function(e,t){return Math.sign(e)===Math.sign(t)?e:-e},_acos:Math.acos,_asin:Math.asin,_atan:Math.atan,_atan2:Math.atan2,_ceil:Math.ceil,_cos:Math.cos,_exp:Math.exp,_floor:Math.floor,_fmod:function(e,t){return e%t},_log:Math.log,_log10:Math.log10,_max_:Math.max,_min_:Math.min,_remainder:function(e,t){return e-Math.round(e/t)*t},_pow:Math.pow,_round:Math.fround,_sin:Math.sin,_sqrt:Math.sqrt,_tan:Math.tan,_acosh:Math.acosh,_asinh:Math.asinh,_atanh:Math.atanh,_cosh:Math.cosh,_sinh:Math.sinh,_tanh:Math.tanh,_isnan:Number.isNaN,_isinf:function(e){return!isFinite(e)},_copysign:function(e,t){return Math.sign(e)===Math.sign(t)?e:-e},table:new WebAssembly.Table({initial:0,element:"anyfunc"})}},n=""===this.baseURL?"whetstone.wasm":this.baseURL+"/whetstone.wasm",e.next=5,fetch(n);case 5:return r=e.sent,e.next=8,r.arrayBuffer();case 8:return a=e.sent,e.next=11,WebAssembly.compile(a);case 11:return i=e.sent,e.next=14,WebAssembly.instantiate(i,t);case 14:if(o=e.sent,s=new Uint8Array(o.exports.memory.buffer),c=this.heap2Str(s),u=JSON.parse(c),l={wasm_module:i,json:c},-1!==this.fWorkletProcessors.indexOf("whetstone")){e.next=35;break}return e.prev=20,f=/JSON_STR/g,h=I.replace(f,c),d=window.URL.createObjectURL(new Blob([h],{type:"text/javascript"})),e.next=26,this.context.audioWorklet.addModule(d);case 26:console.log("Keep the DSP name"),this.fWorkletProcessors.push("whetstone"),e.next=35;break;case 30:return e.prev=30,e.t0=e.catch(20),console.error(e.t0),console.error("Faust "+this.name+" cannot be loaded or compiled"),e.abrupt("return",null);case 35:return this.node=new C(this.context,this.baseURL,{numberOfInputs:parseInt(u.inputs)>0?1:0,numberOfOutputs:parseInt(u.outputs)>0?1:0,channelCount:Math.max(1,parseInt(u.inputs)),outputChannelCount:[parseInt(u.outputs)],channelCountMode:"explicit",channelInterpretation:"speakers",processorOptions:l}),this.node.onprocessorerror=function(){console.log("An error from whetstone-processor was detected.")},e.abrupt("return",this.node);case 40:return e.prev=40,e.t1=e.catch(0),console.error(e.t1),console.error("Faust "+this.name+" cannot be loaded or compiled"),e.abrupt("return",null);case 45:case"end":return e.stop()}},e,this,[[0,40],[20,30]])}));return function(){return e.apply(this,arguments)}}()},{key:"loadGui",value:function(){var e=Object(P.a)(S.a.mark(function e(){var t=this;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){try{var r=""===t.baseURL?"main.html":t.baseURL+"/main.html";if(!t.linkExists(r)){var a=document.createElement("link");a.rel="import",a.href=r,document.head.appendChild(a),a.onload=function(e){}}}catch(i){console.log(i),n(i)}}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"linkExists",value:function(e){return document.querySelectorAll('link[href="'.concat(e,'"]')).length>0}}]),e}(),I='\n\n    \'use strict\';\n\n    // Monophonic Faust DSP\n    class whetstoneProcessor extends AudioWorkletProcessor {\n        \n        // JSON parsing functions\n        static parse_ui(ui, obj, callback)\n        {\n            for (var i = 0; i < ui.length; i++) {\n                whetstoneProcessor.parse_group(ui[i], obj, callback);\n            }\n        }\n        \n        static parse_group(group, obj, callback)\n        {\n            if (group.items) {\n                whetstoneProcessor.parse_items(group.items, obj, callback);\n            }\n        }\n        \n        static parse_items(items, obj, callback)\n        {\n            for (var i = 0; i < items.length; i++) {\n                callback(items[i], obj, callback);\n            }\n        }\n        \n        static parse_item1(item, obj, callback)\n        {\n            if (item.type === "vgroup"\n                || item.type === "hgroup"\n                || item.type === "tgroup") {\n                whetstoneProcessor.parse_items(item.items, obj, callback);\n            } else if (item.type === "hbargraph"\n                       || item.type === "vbargraph") {\n                // Nothing\n            } else if (item.type === "vslider"\n                       || item.type === "hslider"\n                       || item.type === "button"\n                       || item.type === "checkbox"\n                       || item.type === "nentry") {\n                obj.push({ name: item.address,\n                         defaultValue: item.init,\n                         minValue: item.min,\n                         maxValue: item.max });\n            }\n        }\n        \n        static parse_item2(item, obj, callback)\n        {\n            if (item.type === "vgroup"\n                || item.type === "hgroup"\n                || item.type === "tgroup") {\n                whetstoneProcessor.parse_items(item.items, obj, callback);\n            } else if (item.type === "hbargraph"\n                       || item.type === "vbargraph") {\n                // Keep bargraph adresses\n                obj.outputs_items.push(item.address);\n                obj.pathTable[item.address] = parseInt(item.index);\n            } else if (item.type === "vslider"\n                       || item.type === "hslider"\n                       || item.type === "button"\n                       || item.type === "checkbox"\n                       || item.type === "nentry") {\n                // Keep inputs adresses\n                obj.inputs_items.push(item.address);\n                obj.pathTable[item.address] = parseInt(item.index);\n            }\n        }\n     \n        static get parameterDescriptors() \n        {\n            // Analyse JSON to generate AudioParam parameters\n            var params = [];\n            whetstoneProcessor.parse_ui(JSON.parse(`JSON_STR`).ui, params, whetstoneProcessor.parse_item1);\n            return params;\n        }\n       \n        constructor(options)\n        {\n            super(options);\n            this.running = true;\n            \n            const importObject = {\n                    env: {\n                        memoryBase: 0,\n                        tableBase: 0,\n\n                        // Integer version\n                        _abs: Math.abs,\n\n                        // Float version\n                        _acosf: Math.acos,\n                        _asinf: Math.asin,\n                        _atanf: Math.atan,\n                        _atan2f: Math.atan2,\n                        _ceilf: Math.ceil,\n                        _cosf: Math.cos,\n                        _expf: Math.exp,\n                        _floorf: Math.floor,\n                        _fmodf: function(x, y) { return x % y; },\n                        _logf: Math.log,\n                        _log10f: Math.log10,\n                        _max_f: Math.max,\n                        _min_f: Math.min,\n                        _remainderf: function(x, y) { return x - Math.round(x/y) * y; },\n                        _powf: Math.pow,\n                        _roundf: Math.fround,\n                        _sinf: Math.sin,\n                        _sqrtf: Math.sqrt,\n                        _tanf: Math.tan,\n                        _acoshf: Math.acosh,\n                        _asinhf: Math.asinh,\n                        _atanhf: Math.atanh,\n                        _coshf: Math.cosh,\n                        _sinhf: Math.sinh,\n                        _tanhf: Math.tanh,\n\n                        // Double version\n                        _acos: Math.acos,\n                        _asin: Math.asin,\n                        _atan: Math.atan,\n                        _atan2: Math.atan2,\n                        _ceil: Math.ceil,\n                        _cos: Math.cos,\n                        _exp: Math.exp,\n                        _floor: Math.floor,\n                        _fmod: function(x, y) { return x % y; },\n                        _log: Math.log,\n                        _log10: Math.log10,\n                        _max_: Math.max,\n                        _min_: Math.min,\n                        _remainder:function(x, y) { return x - Math.round(x/y) * y; },\n                        _pow: Math.pow,\n                        _round: Math.fround,\n                        _sin: Math.sin,\n                        _sqrt: Math.sqrt,\n                        _tan: Math.tan,\n                        _acosh: Math.acosh,\n                        _asinh: Math.asinh,\n                        _atanh: Math.atanh,\n                        _cosh: Math.cosh,\n                        _sinh: Math.sinh,\n                        _tanh: Math.tanh,\n\n                        table: new WebAssembly.Table({ initial: 0, element: \'anyfunc\' })\n                    }\n            };\n            \n            this.whetstone_instance = new WebAssembly.Instance(options.processorOptions.wasm_module, importObject);\n            this.json_object = JSON.parse(options.processorOptions.json);\n         \n            this.output_handler = function(path, value) { this.port.postMessage({ path: path, value: value }); };\n            \n            this.ins = null;\n            this.outs = null;\n\n            this.dspInChannnels = [];\n            this.dspOutChannnels = [];\n\n            this.numIn = parseInt(this.json_object.inputs);\n            this.numOut = parseInt(this.json_object.outputs);\n\n            // Memory allocator\n            this.ptr_size = 4;\n            this.sample_size = 4;\n            this.integer_size = 4;\n            \n            this.factory = this.whetstone_instance.exports;\n            this.HEAP = this.whetstone_instance.exports.memory.buffer;\n            this.HEAP32 = new Int32Array(this.HEAP);\n            this.HEAPF32 = new Float32Array(this.HEAP);\n\n            // Warning: keeps a ref on HEAP in Chrome and prevent proper GC\n            //console.log(this.HEAP);\n            //console.log(this.HEAP32);\n            //console.log(this.HEAPF32);\n\n            // bargraph\n            this.outputs_timer = 5;\n            this.outputs_items = [];\n\n            // input items\n            this.inputs_items = [];\n        \n            // Start of HEAP index\n\n            // DSP is placed first with index 0. Audio buffer start at the end of DSP.\n            this.audio_heap_ptr = parseInt(this.json_object.size);\n\n            // Setup pointers offset\n            this.audio_heap_ptr_inputs = this.audio_heap_ptr;\n            this.audio_heap_ptr_outputs = this.audio_heap_ptr_inputs + (this.numIn * this.ptr_size);\n\n            // Setup buffer offset\n            this.audio_heap_inputs = this.audio_heap_ptr_outputs + (this.numOut * this.ptr_size);\n            this.audio_heap_outputs = this.audio_heap_inputs + (this.numIn * NUM_FRAMES * this.sample_size);\n            \n            // Start of DSP memory : DSP is placed first with index 0\n            this.dsp = 0;\n\n            this.pathTable = [];\n         \n            // Send output values to the AudioNode\n            this.update_outputs = function ()\n            {\n                if (this.outputs_items.length > 0 && this.output_handler && this.outputs_timer-- === 0) {\n                    this.outputs_timer = 5;\n                    for (var i = 0; i < this.outputs_items.length; i++) {\n                        this.output_handler(this.outputs_items[i], this.HEAPF32[this.pathTable[this.outputs_items[i]] >> 2]);\n                    }\n                }\n            }\n            \n            this.initAux = function ()\n            {\n                var i;\n                \n                if (this.numIn > 0) {\n                    this.ins = this.audio_heap_ptr_inputs;\n                    for (i = 0; i < this.numIn; i++) {\n                        this.HEAP32[(this.ins >> 2) + i] = this.audio_heap_inputs + ((NUM_FRAMES * this.sample_size) * i);\n                    }\n                    \n                    // Prepare Ins buffer tables\n                    var dspInChans = this.HEAP32.subarray(this.ins >> 2, (this.ins + this.numIn * this.ptr_size) >> 2);\n                    for (i = 0; i < this.numIn; i++) {\n                        this.dspInChannnels[i] = this.HEAPF32.subarray(dspInChans[i] >> 2, (dspInChans[i] + NUM_FRAMES * this.sample_size) >> 2);\n                    }\n                }\n                \n                if (this.numOut > 0) {\n                    this.outs = this.audio_heap_ptr_outputs;\n                    for (i = 0; i < this.numOut; i++) {\n                        this.HEAP32[(this.outs >> 2) + i] = this.audio_heap_outputs + ((NUM_FRAMES * this.sample_size) * i);\n                    }\n                    \n                    // Prepare Out buffer tables\n                    var dspOutChans = this.HEAP32.subarray(this.outs >> 2, (this.outs + this.numOut * this.ptr_size) >> 2);\n                    for (i = 0; i < this.numOut; i++) {\n                        this.dspOutChannnels[i] = this.HEAPF32.subarray(dspOutChans[i] >> 2, (dspOutChans[i] + NUM_FRAMES * this.sample_size) >> 2);\n                    }\n                }\n                \n                // Parse UI\n                whetstoneProcessor.parse_ui(this.json_object.ui, this, whetstoneProcessor.parse_item2);\n                \n                // Init DSP\n                this.factory.init(this.dsp, sampleRate); // \'sampleRate\' is defined in AudioWorkletGlobalScope  \n            }\n\n            this.setParamValue = function (path, val)\n            {\n                this.HEAPF32[this.pathTable[path] >> 2] = val;\n            }\n\n            this.getParamValue = function (path)\n            {\n                return this.HEAPF32[this.pathTable[path] >> 2];\n            }\n\n            // Init resulting DSP\n            this.initAux();\n        }\n        \n        process(inputs, outputs, parameters) \n        {\n            var input = inputs[0];\n            var output = outputs[0];\n            \n            // Check inputs\n            if (this.numIn > 0 && (!input || !input[0] || input[0].length === 0)) {\n                //console.log("Process input error");\n                return true;\n            }\n            // Check outputs\n            if (this.numOut > 0 && (!output || !output[0] || output[0].length === 0)) {\n                //console.log("Process output error");\n                return true;\n            }\n            \n            // Copy inputs\n            if (input !== undefined) {\n                for (var chan = 0; chan < Math.min(this.numIn, input.length); ++chan) {\n                    var dspInput = this.dspInChannnels[chan];\n                    dspInput.set(input[chan]);\n                }\n            }\n            \n            /*\n            TODO: sample accurate control change is not yet handled\n            When no automation occurs, params[i][1] has a length of 1,\n            otherwise params[i][1] has a length of NUM_FRAMES with possible control change each sample\n            */\n            \n            // Update controls\n            for (const path in parameters) {\n                const paramArray = parameters[path];\n                this.setParamValue(path, paramArray[0]);\n            }\n        \n          \t// Compute\n            try {\n                this.factory.compute(this.dsp, NUM_FRAMES, this.ins, this.outs);\n            } catch(e) {\n                console.log("ERROR in compute (" + e + ")");\n            }\n            \n            // Update bargraph\n            this.update_outputs();\n            \n            // Copy outputs\n            if (output !== undefined) {\n                for (var chan = 0; chan < Math.min(this.numOut, output.length); ++chan) {\n                    var dspOutput = this.dspOutChannnels[chan];\n                    output[chan].set(dspOutput);\n                }\n            }\n            \n            return this.running;\n    \t}\n        \n        handleMessage(event)\n        {\n            var msg = event.data;\n            switch (msg.type) {\n                case "destroy": this.running = false; break;\n            }\n        }\n    }\n\n    // Globals\n    const NUM_FRAMES = 128;\n    try {\n        registerProcessor(\'whetstone\', whetstoneProcessor);\n    } catch (error) {\n        console.warn(error);\n    }\n',q=N;function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var D=function(e){Object(c.a)(n,e);var t=_(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Faust Reverb",function(){return new m.a.Gain(1)},e,!0)).outputNode=new m.a.Gain(1),r.faustParameters=[],r.loadedValue=1,r.initializeWorklets(),r.updateInitialValues(),r}return Object(s.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"initializeWorklets",value:function(){var e=Object(P.a)(S.a.mark(function e(){var t=this;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.sequencerEngine.isOffline?this.effectNode.connect(this.outputNode):(this.plugin=new q(m.a.Master.context._context,"."),this.plugin.load().then(function(e){console.log("LOADED reverb",e),t.effectNode.connect(e),t.faustNode=e,e.parameters.forEach(function(e){console.log("X PARAMETR=",e);var n=new y.a("fuck",t,function(t,n){return e.value=n},{min:e.minValue,max:e.maxValue,defaultValue:e.minValue});t.faustParameters.push(n),t.registerParameter(n)}),e.connect(t.outputNode)})),this.updateInitialValues();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getJson",value:function(e){var t=Object(E.a)(Object(l.a)(n.prototype),"getJson",this).call(this);return t.fold=this.foldParameter.get(),t}},{key:"fromJson",value:function(e,t){var r=Object(E.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);if(e.amount){this.loadedValue=e.fold;var a=this.foldParameter.set(e.amount,!1,!1),i=a.id,o=a.value;r[i]=o}return r}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(r.a.Effect),F=n(908),L=n(907),B=n(989),z=n(909),J=n(933),V=n(1),H=n(546);n(365);function U(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return G(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function W(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}new Float32Array(65536);var K=function(e){Object(c.a)(n,e);var t=W(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Genetic WaveShaper",function(){return new m.a.Gain(1)},e)).counter=0,r.waveShaperNode=new m.a.WaveShaper([-1,1]),r.effectNode.connect(r.waveShaperNode),r.postGain=new m.a.Gain(1),r.waveShaperNode.connect(r.postGain),r.overSampleParameter=new y.a("oversample",Object(A.a)(r),function(e,t){return r.waveShaperNode.oversample=t?"4x":"none"},{min:.01,max:32,unit:"",defaultValue:!1,constantAutomationRate:!0}),r.driveParameter=new h.a("drive",r.effectNode.gain,function(e,t){r.effectNode.gain.value=t,r.postGain.gain.value=Math.pow(1/t,.6)},{documention:"Controls the level of saturation.",min:.01,max:32,unit:"",defaultValue:1,constantAutomationRate:!0}),r.registerParameter(r.driveParameter),r.recomputeCurve(),r}return Object(s.a)(n,[{key:"stages",get:function(){return 6}},{key:"smoothness",get:function(){return 6}},{key:"recomputeCurve",value:function(){var e=Math.pow(2,this.smoothness+1)*(2*this.stages+1)+1;console.log("points = ",e);for(var t=new Float32Array(e),n=0;n<e;n++){var r=(2*this.stages+1)*Math.PI*(n/(e-1)-.5);t[n]=Math.sin(r)}this.waveShaperNode.curve=t}},{key:"documentation",get:function(){return"Saturates the sound, making it more distorted."}},{key:"dispose",value:function(){Object(E.a)(Object(l.a)(n.prototype),"dispose",this).call(this),this.postGain.dispose(),this.waveShaperNode.dispose()}},{key:"connect",value:function(e){this.postGain.connect(e)}},{key:"disconnect",value:function(e){this.postGain.disconnect(e)}},{key:"getJson",value:function(){var e=Object(V.a)({},Object(E.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{drive:this.driveParameter.get()});return e=this.saveParameterToJson(e,"driveParameter",this.driveParameter)}},{key:"fromJson",value:function(e,t){var r=Object(E.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(p.a)(this.driveParameter,e.drive,r),Object(V.a)({},r,this.loadParameterFromJson(e,"driveParameter",this.driveParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"generateVariation",value:function(e,t){console.log("generate dregree=",t);var n,r=[],a=U(this.waveShaperNode.curve);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=Math.min(1,i+t*Math.random());Math.random()<t&&(o=0),r.push(o)}}catch(s){a.e(s)}finally{a.f()}return Float32Array.from(r)}},{key:"breed",value:function(e,t){for(var n=[],r=0;r<this.waveShaperNode.curve.length;r++){Math.random()<.6?n.push(e[r]):n.push(t[r])}return Float32Array.from(n)}},{key:"selectVariation",value:function(e,t,n){var r=this.variations[e];console.log("selected variation = ",r),this.waveShaperNode.curve=r,this.selectedVariation=e}},{key:"firstReproduction",value:function(){this.variations=this.generateVariations(this.waveShaperNode.curve)}},{key:"getBestCopy",value:function(){return this.bestSolutions}}]),n}(Object(H.a)(r.a.Effect)),Q=n(932),Z=n(573),Y=n(319),$=n(913),X=(n(280),n(366)),ee=n(990),te=n(915),ne=n(282),re=n(912),ae=n(374),ie=n(321),oe=n(629),se=n(844),ce=(n(911),n(919)),ue=n(920),le=n(910),fe=n(918),he=n(923),de=n(935),pe=n(637),ve=n(924),me=n(925),ye=n(921),be=n(922),ge=n(444),Oe=n(917),je=n(574),ke=n(926),we=n(929),xe=n(575),Se=n(930),Pe=n(931);function Ee(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}r.a.Effect;var Te=n(934),Ae=n(641),Me=n(455),Re=n(640),Ce=n(449),Ne=n(624),Ie=n(450),qe=n(633),_e=n(452),De=n(631),Fe=n(453),Le=(n(578),n(936),n(381)),Be=n(986),ze=n(320),Je=n(638),Ve=n(639),He=n(644),Ue=n(649),Ge=n(866),We=n(862),Ke=n(863),Qe=n(642),Ze=n(643),Ye=n(606),$e=n(650),Xe=n(645),et=n(646),tt=n(647),nt=n(648),rt=n(864),at=n(636),it=n(861),ot=n(865),st=n(628),ct=n(867),ut=n(607),lt=n(978),ft=n(988),ht=n(987),dt=n(625),pt=n(627),vt=n(551);n.d(t,"a",function(){return mt}),n.d(t,"b",function(){return bt}),n.d(t,"e",function(){return gt}),n.d(t,"d",function(){return Ot}),n.d(t,"c",function(){return jt});var mt=function(){var e=[].concat(yt),t=Object(f.a)();for(var n in t)e.push({value:n,label:t[n].label});return e.sort(function(e,t){return e.label.localeCompare(t.label)}),e},yt=[{value:"Bit Crusher",label:"Bit Crusher"},{value:"Chorus",label:"Chorus"},{value:"Compressor",label:"Compressor"},{value:"Convolver Reverb",label:"Convolver Reverb"},{value:"Delay",label:"Delay"},{value:"Distortion",label:"Distortion"},{value:"Effect Rack",label:"Effect Rack"},{value:"EQ8",label:"EQ 8"},{value:"Filter",label:"Filter"},{value:"Freak Shifter",label:"Freak Shifter"},{value:"Frequency Shifter",label:"Frequency Shifter"},{value:"Faust WaveFolder",label:"FWaveFolder"},{value:"Faust Reverb",label:"FReverb"},{value:"Gain",label:"Gain"},{value:"Guitar Amp",label:"Guitar Amp"},{value:"Multi Filter",label:"Multi Filter"},{value:"Oscilloscope",label:"Oscilloscope"},{value:"Panner",label:"Panner"},{value:"Pitch Shift",label:"Pitch Shift"},{value:"Phaser",label:"Phaser"},{value:"Saturator",label:"Saturator"},{value:"Soft Clipper",label:"Soft Clipper"},{value:"Tape Delay",label:"Tape Delay"},{value:"Transient Shaper",label:"Transient Shaper"},{value:"Vocoder",label:"Vocoder"},{value:"Wave Folder",label:"Wave Folder"}];function bt(e,t){var n=null;"Filter"===e?n=new r.a.FilterEffect(t):"Reverb"===e?n=new r.a.ReverbEffect(t):"Convolver Reverb"===e?n=new X.a(t):"Delay"===e?n=new ne.a(t):"Faust Reverb"===e?n=new D(t):"Chorus"===e?n=new r.a.ChorusEffect(t):"Faust WaveFolder"===e?n=new i.a(t):"Gain"===e?n=new w.a(t):"Genetic WaveShaper"===e?n=new K(t):"Tremolo"===e?n=new r.a.TremoloEffect(t):"Auto Filter"===e?n=new r.a.AutoFilterEffect(t):"Compressor"===e?n=new ce.a(t):"Multi Filter"===e?n=new a.a(t):"Multiband Compressor"===e?n=new ee.a(t):"Distortion"===e?n=new ue.a(t):"Bit Crusher"===e?n=new fe.a(t):"Guitar Amp"===e?n=new Se.a(t):"Granular"===e?n=new le.a(t):"EQ 3"===e||("EQ 3"===e?n=new he.a(t):"EQ 10"===e?n=new ve.a(t):"Freak Shifter"===e?n=new B.a(t):"Phaser"===e?n=new Z.a(t):"Auto Wah"===e?n=new z.a(t):"Gate"===e?n=new me.a(t):"Pitch Shift"===e?n=new ye.a(t):"Panner"===e?n=new be.a(t):"EQ8"===e?n=new ae.a(t):"Chebyshev"===e?n=new Oe.a(t):"Stereo Widener"===e?n=new re.a(t):"Saturator"===e?n=new je.a(t):"Soft Clipper"===e?n=new F.a(t):"Tape Delay"===e?n=new ke.a(t):"Stereo Delay"===e?n=new we.a(t):"Oscilloscope"===e?n=new te.a(t):"Effect Rack"===e?n=new xe.a(t):"Wave Folder"===e?n=new Pe.a(t):"Granulator"===e?n=new L.a(t):"Ring Modulator"===e?n=new $.a(t):"Follower"===e?n=new J.a(t):"Vocoder"===e?n=new Q.a(t):"Frequency Shifter"===e?n=new Te.a(t):"Transient Shaper"===e&&(n=new de.a(t)));var o=Object(f.a)();return o[e]&&(n=o[e].creator(t)),n.toggle(),n}var gt=[{value:"Accumulator Effect",label:"Accumulator Effect"},{value:"Arpeggiator",label:"Arpeggiator"},{value:"Chord Rhythm",label:"Chord Rhythm"},{value:"Conditional Parameters",label:"Conditional Parameters"},{value:"Control Parameters",label:"Control Parameters"},{value:"Midi Delay",label:"Delay"},{value:"Every",label:"Every"},{value:"Gate",label:"Gate"},{value:"Generative Chords",label:"Generative Chords"},{value:"Grab",label:"Grab"},{value:"Grab Time",label:"Grab Time"},{value:"Harmony",label:"Harmony"},{value:"Jaki",label:"Jaki"},{value:"Linked Tidal",label:"Linked Tidal"},{value:"Max Parameter",label:"Max Parameter"},{value:"Midi CC",label:"Midi CC"},{value:"Midi Effect Rack",label:"Midi Effect Rack"},{value:"Note Display",label:"Note Display"},{value:"Plane Parameters",label:"Plane Parameters"},{value:"Parametizer",label:"Parametizer"},{value:"Scale",label:"Scale"},{value:"User Script",label:"Script"},{value:"Sparse",label:"Sparse"},{value:"Stats",label:"Stats"},{value:"Tidal",label:"Tidal"},{value:"Timing",label:"Timing"},{value:"Warp",label:"Warp"}],Ot=[{value:"Alternate",label:"Alternate"},{value:"Alternate N",label:"Alternate N"},{value:"Limit",label:"Limit"},{value:"Midi Outputter",label:"Midi Outputter"},{value:"Pattern Switch",label:"Pattern Switch"},{value:"Roll",label:"Rolling"}];var jt=function(e,t){var n=null;return"Arpeggiator"===e?n=new ge.a(t):"Parametizer"===e?n=new Ce.a(t):"Harmony"===e?n=new Me.a(t):"Every"===e?n=new Re.a(t):"Timing"===e?n=new Ie.a(t):"Midi Outputter"===e?n=new Be.a(t):"Midi Interface"===e?n=new Fe.a(t):"Alternate Tuning"===e?n=new pe.a(t):"Warp"===e?n=new ie.a(t):"Midi Delay"===e?n=new qe.a(t):"Chord Rhythm"===e?n=new _e.a(t):"Chord Sculptor"===e?n=new De.a(t):"Tidal"===e?n=new ze.a(t):"Flush"===e?n=new dt.a(t):"Message"===e?n=new pt.a(t):"Midi Effect Rack"===e?n=new Le.a(t):"Limit"===e?n=new Ve.a(t):"Beat Repeat"===e?n=new He.a(t):"Steps"===e?n=new Qe.a(t):"Notes"===e?n=new Ze.a(t):"User Script"===e?n=new Ye.a(t):"Grab"===e?n=new Xe.a(t):"Gate"===e?n=new Ge.a(t):"Roll"===e?n=new ot.a(t):"Grab Time"===e?n=new et.a(t):"Alternate"===e?n=new tt.a(t):"Alternate N"===e?n=new nt.a(t):"Density"===e?n=new rt.a(t):"Threshold"===e?n=new $e.a(t):"Midi CC"===e?n=new Ae.a(t):"Accumulator Effect"===e?n=new oe.a(t):"Control Parameters"===e?n=new se.a(t):"Conditional Parameters"===e?n=new ht.a(t):"Plane Parameters"===e?n=new Y.a(t):"Micro Tuning"===e?n=new at.a(t):"Scale"===e?n=new it.a(t):"Beat"===e?n=new Ue.a(t):"Pattern Switch"===e?n=new We.a(t):"Poly"===e?n=new Ke.a(t):"Linked Tidal"===e?n=new Je.a(t):"Note Display"===e?n=new st.a(t):"Sparse"===e?n=new ct.a(t):"Stats"===e?n=new ft.a(t):"Jaki"===e?n=new ut.a(t):"Accent"===e?n=new vt.a(t):"Regular"===e?n=new vt.r(t):"Staccato"===e?n=new vt.u(t):"Rest"===e?n=new vt.s(t):"Piano"===e?n=new vt.p(t):"Pianissimo"===e?n=new vt.o(t):"Dot"===e?n=new vt.e(t):"Dash 1"===e?n=new vt.c(t):"Dash 2"===e?n=new vt.d(t):"Max"===e?n=new vt.m(t):"Figure"===e?n=new vt.g(t):"First"===e?n=new vt.h(t):"Max Parameter"===e?n=new Ne.a(t):"R.Every"===e?n=new vt.q(t):"Last"===e?n=new vt.j(t):"Legato"===e?n=new vt.l(t):"Double"===e?n=new vt.f(t):"Later"===e?n=new vt.k(t):"Skip"===e?n=new vt.t(t):"Generative Chords"===e&&(n=new lt.a(t)),n}},function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(173),o=n(55),s=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.sequencerEngine,n=e.effect.parameters.filter(function(e){return"Enabled"!==e.name});return a.a.createElement("div",{className:"flex w-96 flex-wrap"},n.map(function(e){return a.a.createElement(i.a,{name:e.name,sequencerEngine:t,lfoEnabled:!0,parameter:e,isParameter:!0,step:.001,max:e.max,min:e.min})}))});n.d(t,"a",function(){return c});var c=function(){var e={};return function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t;if(!t)return e;e[t]={creator:n,component:r,name:t,label:a}}}()},,,,,,function(e,t,n){"use strict";n.d(t,"d",function(){return r}),n.d(t,"e",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"a",function(){return o}),n.d(t,"b",function(){return s});var r="SEQUENCE_USED_SOUND",a="SAMPLE_RATED",i="SEQUENCE_BPM",o="PACK_TYPE",s="PRESET_RESAMPLED"},function(e,t,n){"use strict";n.d(t,"e",function(){return a}),n.d(t,"d",function(){return i}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return s}),n.d(t,"a",function(){return c}),n.d(t,"f",function(){return u});var r=n(136),a=function(e,t){var n=e.trackNumber+1+e.subSequence.name.toLowerCase()+".trigger";Object(r.c)(n,t.stepData)},i=function(e,t,n){Object(r.c)("roll",{rolling:e,resolution:t,isTriplet:n})},o=function(e,t){var n="pattern-switch."+e.name;Object(r.c)(n,t+1),n="pattern-switch",Object(r.c)(n,t+1)},s=function(e){Object(r.c)("planar-bounce",e)},c=function(e){Object(r.c)("notes-down",e)},u=function(e){Object(r.c)("trigger-count",e)}},,function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"memo",gen:function(){var e,t=r.getInputs(this);return e="  var ".concat(this.name," = ").concat(t[0],"\n"),r.memo[this.name]=this.name,[this.name,e]}};t.default=function(e,t){var n=Object.create(a);return n.inputs=[e],n.id=r.getUID(),n.name=void 0!==t?t+"_"+r.getUID():"".concat(n.basename).concat(n.id),n}},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(31),u=n(7),l=n(8),f=n(2),h=n(6),d=n.n(h);function p(){if(!(this instanceof p))return arguments.length>1||"number"!==typeof arguments[0]?p.apply(new p(arguments.length),arguments):new p(arguments[0]);if(0===arguments.length)throw new Error("Missing Argument: You must pass a valid buffer length");return this.size=this.start=0,this.overflow=null,arguments.length>1||"number"!==typeof arguments[0]?(this.data=new Array(arguments.length),this.end=(this.length=arguments.length)-1,this.push.apply(this,arguments)):(this.data=new Array(arguments[0]),this.end=(this.length=arguments[0])-1),this}function v(e,t){return e==t?0:e>t?1:-1}p.prototype={constructor:p,pop:function(){var e;if(0!==this.size)return e=this.data[this.end],delete this.data[this.end],this.end=(this.end-1+this.length)%this.length,this.size--,e},push:function(){var e=0;if(this.overflow&&this.size+arguments.length>this.length)for(;e<this.size+arguments.length-this.length;e++)this.overflow(this.data[(this.end+e+1)%this.length],this);for(e=0;e<arguments.length;e++)this.data[(this.end+e+1)%this.length]=arguments[e];return this.size<this.length&&(this.size+e>this.length?this.size=this.length:this.size+=e),this.end=(this.end+e)%this.length,this.start=(this.length+this.end-this.size+1)%this.length,this.size},reverse:function(){for(var e,t=0;t<~~(this.size/2);t++)e=this.data[(this.start+t)%this.length],this.data[(this.start+t)%this.length]=this.data[(this.start+(this.size-t-1))%this.length],this.data[(this.start+(this.size-t-1))%this.length]=e;return this},rotateLeft:function(e){if("undefined"===typeof e&&(e=1),"number"!==typeof e)throw new Error("Argument must be a number");for(;--e>=0;)this.push(this.shift());return this},rotateRight:function(e){if("undefined"===typeof e&&(e=1),"number"!==typeof e)throw new Error("Argument must be a number");for(;--e>=0;)this.unshift(this.pop());return this},shift:function(){var e;if(0!==this.size)return e=this.data[this.start],this.start=(this.start+1)%this.length,this.size--,e},sort:function(e){return this.data.sort(e||v),this.start=0,this.end=this.size-1,this},unshift:function(){var e=0;if(this.overflow&&this.size+arguments.length>this.length)for(;e<this.size+arguments.length-this.length;e++)this.overflow(this.data[this.end-e%this.length],this);for(e=0;e<arguments.length;e++)this.data[(this.length+this.start-e%this.length-1)%this.length]=arguments[e];return this.length-this.size-e<0&&(this.end+=this.length-this.size-e,this.end<0&&(this.end=this.length+this.end%this.length)),this.size<this.length&&(this.size+e>this.length?this.size=this.length:this.size+=e),this.start-=arguments.length,this.start<0&&(this.start=this.length+this.start%this.length),this.size},indexOf:function(e,t){for(t||(t=0);t<this.size;t++)if(this.data[(this.start+t)%this.length]===e)return t;return-1},lastIndexOf:function(e,t){for(t||(t=this.size-1);t>=0;t--)if(this.data[(this.start+t)%this.length]===e)return t;return-1},sortedIndex:function(e,t,n){t=t||v;var r=this.start,a=this.size-1;for(r&&t.call(n,e,this.data[a])>0&&(r=0,a=this.end);r<a;){var i=r+a>>>1;t.call(n,e,this.data[i])>0?r=i+1:a=i}return((r-this.start)%this.size+this.size)%this.size},every:function(e,t){for(var n=0;n<this.size;n++)if(!e.call(t,this.data[(this.start+n)%this.length],n,this))return!1;return!0},forEach:function(e,t){for(var n=0;n<this.size;n++)e.call(t,this.data[(this.start+n)%this.length],n,this)},some:function(e,t){for(var n=0;n<this.size;n++)if(e.call(t,this.data[(this.start+n)%this.length],n,this))return!0;return!1},avg:function(){return 0==this.size?0:this.sum()/this.size},sum:function(){for(var e=this.size,t=0;e--;)t+=this.data[e];return t},median:function(){if(0===this.size)return 0;var e=this.slice().sort(v),t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},empty:function(){return this.size=this.start=0,this.end=this.length-1,this},fill:function(e){var t=0;if("function"===typeof e)for(;this.data[t]=e(),++t<this.length;);else for(;this.data[t]=e,++t<this.length;);return this.start=0,this.end=this.length-1,this.size=this.length,this},first:function(){return this.data[this.start]},last:function(){return this.data[this.end]},get:function(e){return this.data[(this.start+e)%this.length]},isFull:function(e){return this.length===this.size},set:function(e,t){return this.data[(this.start+e)%this.length]=t},toArray:function(){return this.slice()},slice:function(e,t){var n=this.size;if((e=+e||0)<0){if(e>=t)return[];e=-e>n?0:n+e}null==t||t>n?t=n:t<0?t+=n:t=+t||0,n=e<t?t-e:0;for(var r=Array(n),a=0;a<n;a++)r[a]=this.data[(this.start+e+a)%this.length];return r}};var m=p;var y=function(e,t){this.timestretch=function(e){for(var t=e.getChannelData(0),n=e.getChannelData(1),r=[],a=[],i=0;i<100;i++)this.process(t[i],r),this.process(n[i],a);t=new Float32Array(r),n=new Float32Array(a),e.set(d.a.Buffer.fromArray([t,n]))},this.process=function(e,t){var n=function(e){for(var t=new Float32Array(e.length),n=0;n<e.length;n++)t[n]=i[n]*e[n];return t}(e);return function(e,t,n,r,a,i,o){for(var s,c=0,u=0;u<e;u++)s=a.shift()||0,c=r.shift()||0,o.push(c/(s<.01?1:s)),r.push(0),a.push(0);for(var u=0;u<i;u++)c=r.shift(),r.push(t[u]+c),s=a.shift(),a.push(n[u]+s)}(a,n,o,h,p,c,t),y=!1,a},this.beta_fn=function(e){return n<=1?2:n<=1.2?2:n<=1.4?2:n<=1.8?2.5:3},this.overlap_fn=function(e){return e<1.25?e+.15:e>=1.25&&e<1.5?e+.2:e>=1.5&&e<1.8?e+.6:e>=1.8&&e<2?e+.9:e+2.2},this.get_hs=function(){return a},this.get_ha=function(){return r},this.get_alpha=function(){return n},this.get_real_alpha=function(){return a/r},this.get_overlap_factor=function(){return l},this.clear_buffers=function(){h=new m(c),p=new m(c),y=!0},this.set_window_type=function(e){f=s[e]?e:f},this.set_alpha=function(e,t,i){n=e,void 0==i?this.set_beta(this.beta_fn(n)):this.set_beta(i),l=void 0==t?this.overlap_fn(n):t,r=Math.round(c/l),a=Math.round(n*r)},this.set_beta=function(e){i=function(e,t,n){for(var r=new Float32Array(e),a=0;a<e;a++)r[a]=s[n](e,a,t);return r}(c,u=e,f),o=new Float32Array(i.length);for(var t=0;t<o.length;t++)o[t]=Math.pow(i[t],1)};var n,r,a,i,o,s={Lanczos:function(e,t,n){var r=2*t/(e-1)-1;return Math.pow(Math.sin(Math.PI*r)/(Math.PI*r),n)},Triangular:function(e,t,n){return Math.pow(2/e*(e/2-Math.abs(t-(e-1)/2)),n)},Bartlett:function(e,t,n){return Math.pow(2/(e-1)*((e-1)/2-Math.abs(t-(e-1)/2)),n)},BartlettHann:function(e,t,n){return Math.pow(.62-.48*Math.abs(t/(e-1)-.5)-.38*Math.cos(2*Math.PI*t/(e-1)),n)},Blackman:function(e,t,n){var r=n/2;return(1-n)/2-.5*Math.cos(2*Math.PI*t/(e-1))+r*Math.cos(4*Math.PI*t/(e-1))},Cosine:function(e,t,n){return Math.pow(Math.cos(Math.PI*t/(e-1)-Math.PI/2),n)},Gauss:function(e,t,n){return Math.pow(Math.E,-.5*Math.pow((t-(e-1)/2)/(n*(e-1)/2),2))},Hamming:function(e,t,n){return Math.pow(.54-.46*Math.cos(2*Math.PI*t/(e-1)),n)},Hann:function(e,t,n){return Math.pow(.5*(1-Math.cos(2*Math.PI*t/(e-1))),n)},Rectangular:function(e,t,n){return n},SinBeta:function(e,t,n){return Math.pow(Math.sin(Math.PI*t/e),n)},Trapezoidal:function(e,t,n){var r=Math.round(e/4),a=r-1,i=9*r-1;return t<=a?Math.pow(t/a,n):t>=i?Math.pow(i/t,n):1}},c=e,u=1,l=1.1,f="Lanczos";this.set_alpha(1),this.set_beta(u);for(var h=new m(c),p=new m(c),v=0;v<c;v++)h.push(0),p.push(0);var y=!0;this.is_clean=function(){return y}};var b=function(e){var t,n=e||4096,r=new y(n),a=new y(n),i=0,o=1,s=new m(Math.round(1.2*n)),c=new m(Math.round(1.2*n)),u=new Float32Array(e);this.process=function(e){if(t){for(var l=0,f=t.getChannelData(0),h=t.getChannelData(1),d=e.getChannelData(0),p=e.getChannelData(1);c.size>0&&l<e.length;)d[y=l++]=s.shift(),p[y]=c.shift();if(l!=e.length)do{var v=f.subarray(i,i+n),m=h.subarray(i,i+n);void 0!=o&&o!=r.get_alpha()&&(r.set_alpha(o),a.set_alpha(o),o=void 0),v.length<n?(u.set(0,v),r.process(u,s),u.set(0,m),a.process(u,c),u.fill(0)):(r.process(v,s),a.process(m,c));for(var y=l;s.size>0&&y<e.length;y++)d[y]=s.shift(),p[y]=c.shift();l+=r.get_hs(),i+=r.get_ha()}while(l<e.length)}},this.set_audio_buffer=function(e){t=e},Object.defineProperties(this,{position:{get:function(){return i},set:function(e){i=new Number(e)}},alpha:{get:function(){return r.get_alpha()},set:function(e){o=new Number(e)}}})},g=n(873),O=(n(839),n(146)),j=n(23),k=n(543),w=n(26),x=n(586),S=(n(62),n(14)),P=n(22),E=n(123),T=n(113);n(359),n(587),n(433);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var M=8,R=new d.a.Time("16n"),C=new d.a.Time("32n"),N=d.a.Frequency("C3");window.initSamplers=0,window.rollConstant=.15;var I=0,q=function(e){Object(u.a)(n,e);var t=A(n);function n(e,r,a,i,s){var u,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];Object(o.a)(this,n),(u=t.call(this)).id=I++,u.isChosen=!0,window.initSamplers++,u.store=e.store,u.parameters=[],u.counter=0,u.baseTranspose=0,u.sample=r,u.tempo=r.tempo||s.tempo,u.samplerData=s,u.onsets=r.onsets||[],u.sliceData=i,u.track=e,u.note=null,u.slices=[],u.transposeParameter=new S.a("transpose",Object(c.a)(u),function(e,t){return[]},{defaultValue:0,min:-32,max:32}),u.registerParameter(u.transposeParameter),l||(u.gainNode=new d.a.Volume,u.volumeParameter=new T.c("volume",u.gainNode.volume,{min:-100,max:0,unit:"db",defaultValue:0}),u.registerParameter(u.volumeParameter)),u.alpha=1,u.tempoSynced=!1,u.audioBuffer=r.audioBuffer,u.offset=s.offset,u.transpose=s.transpose,u.onNewSampler=a,u.baseBuffer=new d.a.Buffer(r.audioBuffer),i=void 0===i?[{startTime:0,endTime:u.getDuration()}]:i,u.sliceData=i,u.pitchEnvelopes=[];for(var f=l?1:M,h=0;h<f;h++){var p=new d.a.ScaledEnvelope({attack:.01,decay:.01,min:0,max:1,sustain:1,release:.01,curve:"linear"});p._releaseCurve="linear",p._decayCurve="linear",u.pitchEnvelopes.push(p)}return u.pitchEnvelopeIndex=0,u.detuneSignal=new d.a.Signal(0),u.detuneParameter=new T.c("detune",u.detuneSignal,{min:-5e3,max:5e3,automationRate:P.a}),u.registerParameter(u.detuneParameter),s.detuneId&&(u.detuneParameter.id=s.detuneId),u.setupSlide(),u}return Object(s.a)(n,[{key:"replaceBuffer",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.release(),this._buffer=e,this.sample.audioBuffer=e,this.baseBuffer=new d.a.Buffer(e),this.slices.slice(1).map(function(e){return e.dispose()}),this.slices=[this.slices[0]],t&&(this.tempo=this.analyze()),this.slice(0,void 0,void 0,void 0,void 0,!0),t&&this.sliceFirstOnset()}},{key:"disposeBuffers",value:function(){this.sample.audioBuffer=void 0,this.audioBuffer=void 0,this.slices[0].buffer&&(this.slices[0].buffer.originalCopy=void 0,this.slices[0].buffer.reversedCopy=void 0),this._buffer=void 0,this.slices[0].buffer=void 0,this.slices[0].sampler&&this.slices[0]._buffers&&delete this.slices[0].sampler._buffers._buffers[48],this.baseBuffer&&(this.baseBuffer._buffer=void 0),this.baseBuffer=void 0}},{key:"sequencerEngine",get:function(){return this.track.sequencerEngine}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setContext((new E.a).forInstrument(this).forTrack(this.track)),this.parameters.push(e)}},{key:"transpose",get:function(){return this.transposeParameter.get()},set:function(e){this.transposeParameter.set(e,!1,!0)}},{key:"init",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.samplerData;var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sliceData,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return void 0!==this.tempo||t||(this.tempo=this.analyze()),0==this.slices.length&&this.loadSlices(e),this}},{key:"sleep",value:function(e){return new Promise(function(t,n){setTimeout(function(){return t()},e)})}},{key:"isNFT",get:function(){return window.isNFT||void 0!==this.sequencerEngine.songId}},{key:"analyze",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.baseBuffer,t=arguments.length>1?arguments[1]:void 0;if(!this.isNFT||t){(new Date).getTime();var n=this.track.sequencerEngine.aubio,r=this.state.waveform.onsetThreshold,a=Object(k.a)(e,n,r,.33),i=a.tempo,o=a.onsets,s=a.onsetToPitch;this.onsets=o,this.onsetToPitch=s;(new Date).getTime();return i}}},{key:"loadSlices",value:function(e){var t=this;e.map(function(e){return t.newSlice(e.startTime,t.isNFT?t.getDuration():e.endTime,e.transpose)})}},{key:"getVolume",value:function(){return this.volumeParameter.get()}},{key:"volume",get:function(){return this.volumeParameter.get()},set:function(e){this.volumeParameter.set(e,!0,!0)}},{key:"setVolume",value:function(e){void 0!==this.volumeParameter&&this.volumeParameter.set(e,!0,!0)}},{key:"getJson",value:function(){return{slices:this.slices.map(function(e){return e.getJson()}),tempoSynced:this.tempoSynced,detuneId:this.detuneParameter.id,tempo:this.tempo,transpose:this.transpose,alpha:this.alpha,offset:this.offset,reversed:this.isReversed(),sampleId:this.sample.getId()}}},{key:"release",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=this.get(e),r=d.a.Master.context.currentTime,a=void 0!==t?this.getNoteFromTranspose(t):this.lastNote;n.triggerRelease(a,r),this.triggerReleaseWaveformAnimation()}},{key:"getNoteFromTranspose",value:function(e){return e+=this.track.sequencerEngine.transpose,e+=this.baseTranspose,N.transpose(e).transpose(this.transpose)}},{key:"releaseAll",value:function(e){var t=this;this.slices.map(function(n){n.sampler.triggerRelease(t.lastNote,e)}),e||(this.clearSlide(),this.releaseSlide(),this.detuneSignal.value=this.detuneParameter.get(!0),this.lastTranspose=0)}},{key:"trigger",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var r,i,o,s,c,u,l,f,h,p,v,m,y,b,g,j,k;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.getDefaultTriggerConfig(t),this.track.sequencerEngine.isSequenceRolling&&(t.gated=!1),r=t.stepData,i=t.time,void 0===t.transpose&&(t.transpose=t.stepData.transpose||0),o=t.noDuration?null:t.stepData.duration,s=this.getSlice(t.sliceNumber),void 0!==(c=s&&s.sampler)&&null!==c&&c.loaded){e.next=10;break}return e.abrupt("return");case 10:if(u=null,null==o?(this.liveNote=t.transpose+s.transpose,this.release(t.sliceNumber,this.liveNote)):"number"===typeof o?(u=R*o,void 0!==this.liveNote&&this.release(t.sliceNumber,this.liveNote),this.liveNote=void 0):(u=new d.a.Time(o),void 0!==this.liveNote&&this.release(t.sliceNumber,this.liveNote),this.liveNote=void 0),(l=this.getNoteFromTranspose(t.transpose+s.transpose))._val=Math.min(31608,l._val),this.isNFT&&!O.isMobile&&(l*=44100/d.a.Master.context.sampleRate),f=t.velocity||r.velocity,h=r.chop,p=(null==u?R:u)/h,i=i||d.a.Master.context.currentTime,v=this.rawOffset||0,i=C*this.offset+i+v,m=i,this.track.sequencerEngine.isSequenceRolling&&this.track.sequencerEngine.resolution.isTriplet?(c.attack=new d.a.Time(window.rollConstant+r.attack/1e3),c.release=new d.a.Time(.1*window.rollConstant+r.release/1e3)):(c.attack=new d.a.Time(r.attack/1e3),c.release=new d.a.Time(r.release/1e3)),(y=r.reverse||this.sequencerEngine.reverse)!==this.isReversed(t.sliceNumber)&&this.reverse(y,t.sliceNumber),(void 0!==this.lastSlideTranspose||this.hasSlide)&&this.releaseSlide(i),!u||!r.slide){e.next=32;break}return this.triggerSlide(t.transpose,i,u),e.abrupt("return");case 32:void 0!==this.lastSlideTranspose&&(this.triggerSlide(t.transpose,i,o,!1),this.hasSlide=!0);case 33:for(i&&(b=this.detuneParameter.get(!0),this.detuneSignal.setValueAtTime(b,Math.max(0,i-.001))),this.lastSlideTranspose=void 0,this.lastSlideMax=void 0,this.track.isWarped()&&(t.gated=!0),g=m,this.track.lastTriggeredStart=t.start||r.start,j=0;j<h;j++)t.gated||null==this.lastNote||(this.wasUngated=!0,this.releaseAll(m),this.triggerReleaseWaveformAnimation(m)),k=this.getPitchEnvelope(c,l,i,f,r),t.gated&&u?(this.wasUngated&&this.releaseAll(m),this.wasUngated=!1,this.triggerAttackRelease(c,l,u,m,f,[k],this.convertToStartTime(t.sliceNumber,t.start||r.start))):this.triggerAttack(c,l,Math.max(m,d.a.Master.context.currentTime),f,[k],this.convertToStartTime(t.sliceNumber,t.start||r.start)),m+=p;this.lastNote=l,this.lastTranspose=t.transpose,this.triggerWaveformAnimation(t.skipRelease?void 0:g,t.gated&&!t.skipRelease?u:void 0,t.sliceNumber,t.transpose,this.convertToStartTime(t.sliceNumber,r.start));case 43:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"convertToStartTime",value:function(e){var t=0,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)%100/100;this.track&&this.track.isAudioTrack&&(n=n*(this.track.getMaxDuration()/this.getDuration())%1);var r=n*this.getSlice(e).buffer.duration;return D(t+r)}},{key:"getPitchEnvelope",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.a.Master.context.currentTime,r=(arguments.length>3&&arguments[3],arguments.length>4?arguments[4]:void 0),a=(d.a.Frequency(t).toMidi(),this.pitchEnvelopes[this.pitchEnvelopeIndex]);a.cancel(Math.max(0,n-.001)),this.pitchEnvelopeIndex=(this.pitchEnvelopeIndex+1)%this.pitchEnvelopes.length;var i=null===r.pitchSustain?1:r.pitchSustain;return a.attack=null==r.pitchAttack?0:r.pitchAttack/1e3,a.attack+=.001,a.decay=null==r.pitchDecay?0:r.pitchDecay/1e3,a.decay+=.001,a.min=0,a.max=6*i*100,a.sustain=i,a.sustain+=.001,a.release=null==r.pitchRelease?0:r.pitchRelease/1e3,a.release+=.001,a}},{key:"triggerAttack",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.get(0),n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0;return new Promise(function(){var l=Object(i.a)(a.a.mark(function i(l,f){var h,p;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:h=function(t){e.triggerReleaseWaveformAnimation(),setTimeout(function(){void 0===t||void 0===t._source||e.sequencerEngine.context.isOffline||e.isDisposed()||(e.detuneSignal.disconnect(t._source.detune),s.forEach(function(e){return e.disconnect(t._source.detune)}))},4e3),l()};try{void 0!==(p=t.triggerAttack(n,r+1/d.a.Master.context.sampleRate,o,c,h,u))&&void 0!==p._source&&(s.forEach(function(e){return e.connect(p._source.detune)}),e.detuneSignal.connect(p._source.detune),s.forEach(function(t){return t.triggerAttack(e.isSimple?void 0:r)}))}catch(i){console.log(i)}e.lastNote=n;case 3:case"end":return a.stop()}},i)}));return function(e,t){return l.apply(this,arguments)}}())}},{key:"triggerAttackRelease",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.get(0),n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0;return new Promise(function(){var f=Object(i.a)(a.a.mark(function i(f,h){var d,p;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:d=1===c.length?function(){return f()}:function(t){setTimeout(function(){void 0===t||void 0===t._source||e.sequencerEngine.context.isOffline||e.isDisposed()||(e.detuneSignal.disconnect(t._source.detune),c.forEach(function(e){return e.disconnect(t._source.detune)}))},4e3),f()};try{o<0&&(o=0),void 0!==(p=t.triggerAttackRelease(n,r,o,s,u,d,l))&&void 0!==p._source&&(c.forEach(function(e){return e.connect(p._source.detune)}),e.detuneSignal.connect(p._source.detune),c.length>1?c.forEach(function(e){0===e.release?e.triggerAttack(o):e.triggerAttackRelease(r,o)}):c[0]&&c[0].triggerAttackRelease(r,o))}catch(i){console.log(i)}e.lastNote=n;case 3:case"end":return a.stop()}},i)}));return function(e,t){return f.apply(this,arguments)}}())}},{key:"getDuration",value:function(){return this.baseBuffer?this.baseBuffer.duration:1}},{key:"sliceFirstOnset",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!(void 0===this.onsets||0===this.onsets.length||this.slices.length>1)){var e=this.getSlice(0);if(0===e.startTime){var t=this.onsets[0]/1e3;t<e.endTime&&this.slice(0,t,e.endTime,!0)}}}},{key:"autoSlice",value:function(e){for(var t=void 0,n=this.slices[this.slices.length-1],r=1,a=0;a<this.onsets.length;a++)if(this.onsets[a]/1e3>n.endTime){r=a;break}for(var i=Math.max(1,Math.floor(this.onsets.length/8)),o=0;o<Math.min(e,this.onsets.length);o++){var s=this.onsets[r+o*i]/1e3,c=this.onsets[r+(o+1)*i];if(void 0===t||s-t>=.1){var u=this.getDuration();c&&(u=c/1e3),s<u&&this.newSlice(s,u),t=s}}}},{key:"slice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5]),a=this.getSlice(e);n=void 0==n?this.getDuration():n,a.startTime=t,a.endTime=n,this.slices.filter(function(e){return e.buffer}).forEach(function(e){return e.buffer.originalCopy=void 0}),this.slices.filter(function(e){return e.buffer}).forEach(function(e){return e.buffer.reversedCopy=void 0});this.alpha,++this.counter;if(d.a.Master.context.isOffline||r){if(this.baseBuffer){var i=this.isNFT?this.baseBuffer:this.baseBuffer.slice(t,n);a.buffer?a.buffer.set(i):(a.buffer=i,a.sampler&&(a.sampler._buffers._buffers[48]=i)),this.isNFT&&(this.slices[0].sampler._buffers._buffers[48]=this.baseBuffer),a.refreshReverse(),this.onNewSampler(this)}}else if(this.baseBuffer){if(this.isNFT)a.buffer=this.baseBuffer;else{i=this.baseBuffer.slice(t,n);a.buffer.set(i),a.refreshReverse()}this.onNewSampler(this)}this.sliceData[e]={startTime:t,endTime:n},this.updateSlicesState()}},{key:"state",get:function(){return this.store.getState()}},{key:"updateSlicesState",value:function(){this.store.dispatch(Object(j.md)(this.id,this.slices.map(function(e){return e.getJson()})))}},{key:"syncTempo",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null!=this.tempo&&(t?(this.alpha=this.tempo/e,this.timestretch()):this.baseTranspose=12*(e/this.tempo-1)),this.tempoSynced=!0}},{key:"unsyncTempo",value:function(){this.alpha=1,this.tempoSynced=!1,this.baseTranspose=0}},{key:"timestretch",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!=this.alpha){e.next=3;break}return this.unsyncTempo(),e.abrupt("return");case 3:t=this.getDuration(),n=new b(4096),r=this.alpha,n.alpha=r,i=t*r*d.a.context.sampleRate-4096*this.alpha,o=d.a.context.createBuffer(2,i,d.a.context.sampleRate),n.set_audio_buffer(this.baseBuffer.get()),n.process(o);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"reverse",value:function(e,t){void 0===t?(this.baseBuffer.reverse=e,this.slices.forEach(function(t){return t.sampler._buffers.isReversed=e})):this.slices[t%this.slices.length].sampler._buffers.isReversed=e}},{key:"isReversed",value:function(e){return void 0===e?void 0!==this.baseBuffer&&this.baseBuffer.reverse:this.slices[e%this.slices.length].sampler._buffers.isReversed}},{key:"deleteSlice",value:function(e){1!==this.slices.length&&(this.slices.splice(e,1),this.sliceData.splice(e,1),this.updateSlicesState())}},{key:"newSlice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.slices[0]&&this.slices[0].startTime,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.slices[0]&&this.slices[0].endTime,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(void 0!==e||void 0!==t){var r;t=t||this.getDuration(),r=this.isNFT?t===this.getDuration()&&0===e?this.baseBuffer:this.baseBuffer.slice(e,this.getDuration()):this.baseBuffer.slice(e,t);var a=new d.a.Sampler({C3:r},{curve:"linear"}),i=new _(r,a,e,t,n);return i.sampler.connect(this.gainNode),this.slices.push(i),this.sliceData.push({startTime:e,endTime:t}),this.slice(this.slices.length-1,e,t,!0),this.slices[this.slices.length-1]}}},{key:"getStartTime",value:function(e){return this.slices[e].startTime}},{key:"getEndTime",value:function(e){return null==this.slices[e].endTime&&(this.slices[e].endTime=this.slices[0].buffer._buffer.duration),this.slices[e].endTime}},{key:"getNumberOfSlices",value:function(){return this.slices.length}},{key:"dispose",value:function(){this.audioBuffer=void 0,this.isCopied||(this.baseBuffer.dispose(),this.slices.forEach(function(e){return e.dispose()})),this.gainNode.dispose(),this.pitchEnvelopes.forEach(function(e){return e.dispose()}),this.baseBuffer=void 0,this.slices=void 0,this.gainNode=void 0,this.pitchEnvelopes=void 0}},{key:"get",value:function(e){return this.slices[e%this.slices.length].sampler}},{key:"getSlice",value:function(e){return this.slices[e%this.slices.length]}},{key:"isLoaded",value:function(){return this.slices.length>0&&this.slices[0].sampler.loaded}},{key:"triggerWaveformAnimation",value:function(e,t,n,r,a){if(this.showWaveformAnimation()){var i=this.getSlice(n),o=i.startTime+a,s=new Event(g.d);s.trackNumber=this.track.trackNumber,s.subSequenceId=this.track.subSequence.id,s.startTime=o,s.duration=t||0,s.soundId=this.sample.getId(),s.sliceStartTime=a,s.sliceDuration=i.getDuration(),s.sliceNumber=n,s.transpose=r,s.time=Math.max(0,void 0===e?0:this.track.sequencerEngine.getMilliseconds(e)),window.dispatchEvent(s)}}},{key:"triggerReleaseWaveformAnimation",value:function(e){if(this.showWaveformAnimation()){var t=new Event(g.c);t.trackNumber=this.track.trackNumber,t.subSequenceId=this.track.subSequence.id,t.soundId=this.sample.getId(),t.time=Math.max(0,void 0===e?0:this.track.sequencerEngine.getMilliseconds(e)),window.dispatchEvent(t)}}},{key:"showWaveformAnimation",value:function(){return this.track.sequencerEngine.isSampler||this.isMixViewShown()||this.isWaveformShown()}},{key:"isMixViewShown",value:function(){var e=this.track.subSequence.id;return this.track.sequencerEngine.currentSubSequence.id===e&&this.state.sequencer.viewMode===w.b}},{key:"isWaveformShown",value:function(){return!!this.showingPrettyWaveform||this.track.subSequence.id===this.track.sequencerEngine.currentSubSequence.id&&this.state.sequencer.waveformShowing&&this.track.sequencerEngine.cursor.track===this.track.trackNumber}},{key:"getCopy",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.track,a={volume:this.volume,offset:this.offset,transpose:this.transpose,reversed:this.isReversed()},i=new n(r,this.sample,e,this.sliceData,a);return i.tempo=this.tempo,i.onsets=this.onsets,i.init(),this.isCopied=!0,i.slices.forEach(function(e,n){t.slices[n]&&(e.buffer.originalCopy=t.slices[n].buffer.originalCopy,e.buffer.reversedCopy=t.slices[n].buffer.reversedCopy)}),i}},{key:"isDisposed",value:function(){return void 0===this.audioBuffer}}],[{key:"getDefaultTriggerConfig",value:function(e){return void 0===e.gated&&(e.gated=!0),void 0===e.sliceNumber&&(e.sliceNumber=0),void 0===e.skipRelease&&(e.skipRelease=!1),e}}]),n}(Object(x.a)(function(){return function e(){Object(o.a)(this,e)}}())),_=function(){function e(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Object(o.a)(this,e),this.buffer=t,this.transpose=i,this.sampler=n,this.startTime=void 0==r?0:r,this.endTime=a,this.slice=void 0}return Object(s.a)(e,[{key:"getDuration",value:function(){return this.endTime-this.startTime}},{key:"dispose",value:function(){this.buffer.dispose(),this.sampler.dispose(),this.buffer=void 0,this.sampler=void 0,this.startTime=void 0,this.endTime=void 0}},{key:"getJson",value:function(){return{startTime:this.startTime,endTime:this.endTime,transpose:this.transpose}}},{key:"getCopy",value:function(){return new e(this.buffer,this.sampler,this.startTime,this.endTime,this.transpose)}},{key:"refreshReverse",value:function(){if(!this.isNFT){var e=this.sampler._buffers;e.isReversed=!1,e&&e.getReversed&&(e._reversedBuffers[48]=e.getReversed(e._buffers[48]))}}}]),e}();t.a=q;var D=function(e){return!window.isNFT||O.isMobile?e:e*(44100/d.a.Master.context.sampleRate)}},function(e,t,n){"use strict";n.d(t,"a",function(){return u}),n.d(t,"b",function(){return f});var r=n(11),a=n(108),i=n(239),o=n(138);function s(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=function(e,t){for(var n=arguments.length,o=new Array(n>2?n-2:0),c=2;c<n;c++)o[c-2]=arguments[c];return function(n,c){var u=Object(a.a)(n,1)[0];if(void 0===u)return e([u],c);var f,h=o.map(function(e){return e()}).filter(function(e){return void 0!==e}),d=!1;if(Array.isArray(u)){d=!0;var p,v=s(u);try{for(v.s();!(p=v.n()).done;){f=[p.value].concat(Object(r.a)(h)).map(function(e){return e.type||Object(i.c)(e,!1)});var m=l(t,f);if(m){t.compilationError=m;break}}}catch(O){v.e(O)}finally{v.f()}}else{f=[u].concat(Object(r.a)(h)).map(function(e){return e.type||Object(i.c)(e,!1)});var y=l(t,f);t.compilationError=y}var b=e([u],c);if(b){if(t.determineType&&!t.type){var g=t.determineType.apply(t,Object(r.a)(f));Array.isArray(g)&&(g=g[0]),d?b[0].forEach(function(e){return e.type=g}):b.type=g}return b}}},l=function(e,t){var n=e.inletTypes;if(n)if(Array.isArray(n))for(var r=0;r<n.length;r++){var a=n[r];if("object"===typeof a){if(a.or&&!a.or.includes(t[r]))return{text:"Received type ".concat(t[r]," when expecting types [").concat(a.or.join(" | "),"] (for inlet #").concat(r+1,")"),inlet:r}}else if(n[r]!==t[r])return{text:"Received type ".concat(t[r]," when expecting type ").concat(n[r]," (for inlet #").concat(r+1,")"),inlet:r}}else if("object"===typeof n&&n.repeat){var i,o=0,c=s(t);try{for(c.s();!(i=c.n()).done;){var u=i.value,l=n.repeat;if(l.or){if(!l.or.includes(u))return{text:"Received type ".concat(u," when expecting types ").concat(l.or.join(" | ")," (for inlet #").concat(o+1,")"),inlet:o}}else{var f,h=s(l);try{for(h.s();!(f=h.n()).done;){var d=f.value;if(d.or){if(!d.or.includes(u))return{text:"Received type ".concat(u," when expecting types: [").concat(d.or.join(" | "),"] (for inlet #").concat(o+1,")"),inlet:o}}else if(d!==u)return{text:"Received type ".concat(u," when expecting type: ").concat(d," (for inlet #").concat(o+1,")"),inlet:o}}}catch(p){h.e(p)}finally{h.f()}}o++}}catch(p){c.e(p)}finally{c.f()}}},f=function(e,t,n,r){if(!n)return e;var a=function(e){var a=n.or||[n];r.compilationError={text:"Received type ".concat(e," when expecting types [").concat(a.join(" | "),"] (for inlet ").concat(t,")"),inlet:t}};return function(t){var i=t[0],s=i.type?i.type:"number"===typeof i?o.h:"string"===typeof i?"string":Array.isArray(i)?"list":"object";if(n.or){if(!n.or.includes(s))return void a(s)}else if(n!==s)return void a(s);return r.compilationError=void 0,e(t)}}},function(e,t,n){"use strict";n.d(t,"c",function(){return i}),n.d(t,"d",function(){return s}),n.d(t,"a",function(){return c}),n.d(t,"b",function(){return u});var r=n(11),a=n(138),i=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("number"===typeof e)return a.b;if(e&&e.ztype)return e.ztype;if(Array.isArray(e)){if(!t)return a.g;if(2===e.length)return a.d;if(3===e.length)return a.e;if(4===e.length)return a.f}return"number"===typeof e?a.h:"string"===typeof e?"string":Array.isArray(e)||ArrayBuffer.isView(e)?"list":a.c},o=[a.b,a.d,a.e,a.f],s=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=Math.max.apply(Math,Object(r.a)(t.map(function(e){return o.indexOf(e)})));return o[a]},c=function(e,t){var n=e.inletTypes;if(n){if(!Array.isArray(n)&&n.repeat){var r=n.repeat;return Array.isArray(r)&&(r=r[0]),r.or?r.or:r}var a=n[t];return a?a.or?a.or:a:"float"}},u=function(e,t){var n=e.type;if("string"===typeof n)return n;if("function"===typeof n){for(var a=c(e,0),i=Array.isArray(a)?a.length:1,o=[],s=function(a){var i=new Array(3).fill(0).map(function(t,r){var i=c(e,r);return Array.isArray(i)?i[a]:n}),s=n.apply(void 0,Object(r.a)(i));Array.isArray(s)?o.includes(s[t])||o.push(s[t]):o.includes(s)||o.push(s)},u=0;u<i;u++)s(u);return o}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(6),a=n.n(r),i=new(n(21).a)(32,!1),o={};function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=o[e];if(void 0!==r){var s=r[t.toString()];if(void 0!==s)return s}else o[e]={};var c=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.transformStepAtResolution2(e,i),o=t.transformStepAtResolution2(e+1,i),s=new Set;Math.floor(r)==r?s.add(r):o-r>1&&s.add(Math.ceil(r));n?Math.floor(o)>=Math.floor(r)&&Math.floor(o)!=o&&s.add(Math.floor(o)):Math.floor(o)>Math.floor(r)&&Math.floor(o)!=o&&s.add(Math.floor(o));s=Array.from(s);for(var c=[],u=0;u<s.length;u++){var l=s[u],f=i.transformStepAtResolution2(l,t),h=f-e;c.push({step:l,time:new a.a.Time("32n")*h})}return c}(e,t,n);return o[e][t.toString()]=c,c}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2),u=n(14),l=n(25);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(o.a)(n,e);var t=f(n);function n(e,a,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(r.a)(this,n),t.call(this,e,a,i,o)}return Object(a.a)(n,[{key:"options",get:function(){return this.config.options}},{key:"getOptionFromNumber",value:function(e){if((e=parseFloat(e))in this.fromCache)return this.fromCache[e];var t=1e4,n=void 0;for(var r in this.options){var a=Math.abs(e-parseFloat(r));a<t&&(t=a,n=this.options[r])}return this.fromCache[e]=n,n}},{key:"getNumberFromOption",value:function(e){if(void 0!==e){if(e.toString()in this.toCache)return this.toCache[e.toString()];for(var t in this.options)if(e.equals&&e.equals(this.options[t])||this.options[t]===e)return this.toCache[e.toString()]=parseFloat(t),parseFloat(t)}}},{key:"convertValue",value:function(e){Object(l.b)(e);return this.getOptionFromNumber(e)}},{key:"set",value:function(e,t,r,a){if(null===e||void 0===e)return Object(i.a)(Object(c.a)(n.prototype),"set",this).call(this,void 0,t,r);var o=a?e:this.config.isNumber||"number"!==typeof e?this.getNumberFromOption(e):e;return void 0===o&&(o=Object.values(this.options)[0]),Object(i.a)(Object(c.a)(n.prototype),"set",this).call(this,o,t,r)}},{key:"getNumber",value:function(e){return Object(i.a)(Object(c.a)(n.prototype),"get",this).call(this,e)}},{key:"get",value:function(e){var t=Object(i.a)(Object(c.a)(n.prototype),"get",this).call(this,e);return t in this.options?this.options[t]:this.getOptionFromNumber(t)}},{key:"updateRedux",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];arguments.length>1&&arguments[1];for(var t in this.patternToAutomation)this.patternToAutomation[t].clear();if(this.unlockedAutomation.clear(),this.automation.clear(),this.automation.store=this.store,this.mixAutomation.store=this.store,this.automation.updateRedux(),null!==this.value&&void 0!==this.value)return this.set(this.value,!0,e,!0)}}]),n}(u.a);t.a=h},function(e,t,n){"use strict";n.d(t,"e",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"d",function(){return o}),n.d(t,"b",function(){return s}),n.d(t,"f",function(){return c});var r=0,a=1,i=2,o=3,s={2:[". .","-"],3:[". -","- .",". . ."],4:[". . -",". - .","- . .","- -"],5:[". . . -",". . - .","- - .",". - -","- . . .",". - . ."],6:[". . . . -",". . . - .","- - . .",". - - .","- - -"],7:[". . . . . -","- - . . ."]},c=function(e,t){for(var n=(t=t.toString().trim())[t.length-1],r=s[e],a=(r.find(function(e){return e[e.length-1]===n}),0);a<r.length;a++){var i=r[a];if(i[i.length-1]===n)return a}return 0}},,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var r=n(11),a=n(259),i=function(e,t,n){return e(t,n[4],n[5],n[3])},o=function(){0;var e=0,t=Object(a.a)("planarReset");return function(n,a,i,o){t().some(function(e){return e===i.id})&&(e=0),e++;var s=Object.keys(o[0]),c=Math.round(a*s.length),u=e*c%s.length,l=s.slice(u,u+c);l.length<c&&(c-l.length,l=[].concat(Object(r.a)(l),Object(r.a)(s.slice(0,c-l.length))));var f={};return l.forEach(function(e){n[e]&&(f[e]=n[e])}),f}}},function(e,t,n){"use strict";n.d(t,"a",function(){return j});var r=n(1),a=n(42),i=n.n(a),o=n(56),s=n(4),c=n(5),u=n(10),l=n(7),f=n(8),h=n(2),d=n(113),p=(n(146),n(6)),v=n.n(p),m=n(14),y=n(209);function b(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var j=function(e){Object(l.a)(n,e);var t=O(n);function n(e,r,a,i){var o;return Object(s.a)(this,n),(o=t.call(this,e,function(){return new v.a.Gain(1)},r,!0)).outputNode=new v.a.Gain(0),o.rnboParameters=[],o.signals=[],o.signalParameters=[],o.initializeWorklets(a,i),o.updateInitialValues(),o}return Object(c.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect()}},{key:"initializeWorklets",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a,o,s,c=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=4;break;case 4:return window.isNFT&&(t="."+t),e.next=7,fetch(t);case 7:return r=e.sent,e.next=10,r.json();case 10:return a=e.sent,e.next=13,Object(y.createDevice)({context:v.a.Master.context._context,patcher:a});case 13:for(o in this.device=e.sent,0,this.device.parameters.forEach(function(e){var t="parameter0",n=c.device.parametersById.get(e.id);c[t]=new m.a(e.name.startsWith("gentilde_obj")?e.name.slice("gentilde_obj_1/".length):e.name,c,function(e,t){return n.value=t},{min:n.min,max:n.max,defaultValue:n.initialValue}),c.rnboParameters.push(c[t]),c.registerParameter(c[t])}),this.node=this.device.node,this.effectNode.connect(this.device.node),this.device.node.connect(this.outputNode),this.outputNode.gain.rampTo(1,.5),n)s=n[o],this.createSignalParameter(o,s.inputNumber,{defaultValue:s.defaultValue,min:s.min,max:s.max});this.registerContext(this._context),this.updateInitialValues(),this.savedJson&&this.fromSavedJson(),this.device.messageEvent.subscribe(function(e){}),console.log("completed loading rnbo effect=",this.name),this.sequencerEngine.currentSubSequence.loadLostParameters(!0);case 27:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"createSignalParameter",value:function(e,t,n){var r=new v.a.Signal(0),a=new d.c(e,r,n);this.registerParameter(a),this.signalParameters.push(a),this.signals.push(r),r.connect(this.node,0,t)}},{key:"fromSavedJson",value:function(){var e,t=this.savedJson,n=b(this.signalParameters);try{for(n.s();!(e=n.n()).done;){var a=e.value;a.set(t[a.name]),Object(r.a)({},this.loadParameterFromJson(t,a.name+"Parameter",a,!1))}}catch(c){n.e(c)}finally{n.f()}var i,o=b(this.rnboParameters);try{for(o.s();!(i=o.n()).done;){var s=i.value;s.set(t[s.name]),Object(r.a)({},this.loadParameterFromJson(t,s.name+"Parameter",s,!1))}}catch(c){o.e(c)}finally{o.f()}this.savedJson=void 0}},{key:"fromJson",value:function(e,t){var r=Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,e,t);return this.device?(this.fromSavedJson(),r):(this.savedJson=e,r)}},{key:"getJson",value:function(e){var t,a=Object(r.a)({},Object(u.a)(Object(h.a)(n.prototype),"getJson",this).call(this)),i=b(this.signalParameters);try{for(i.s();!(t=i.n()).done;){var o=t.value;a[o.name]=o.get(),a=this.saveParameterToJson(a,o.name+"Parameter",o)}}catch(f){i.e(f)}finally{i.f()}var s,c=b(this.rnboParameters);try{for(c.s();!(s=c.n()).done;){var l=s.value;a[l.name]=l.get(),a=this.saveParameterToJson(a,l.name+"Parameter",l)}}catch(f){c.e(f)}finally{c.f()}return a}}]),n}(n(115).a.Effect)},function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(42),o=n.n(i),s=n(56),c=n(4),u=n(5),l=n(427),f=(n(609),n(575)),h=(n(23),n(225)),d=n(210),p=n(6),v=n.n(p),m=n(123);function y(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var g=function(){function e(t,n,r,a){Object(c.a)(this,e),this.inputNode=t,this.effectsInputNode=new v.a.Gain,this.inputNode.connect(this.effectsInputNode),this.outputNode=n,this.mixSession=a.mixSession,this.parameterContext=r,this.sequencerEngine=a,this.effects=[],this.samplerConnectedToMaster=!1}return Object(u.a)(e,[{key:"initDefault",value:function(){this.effects=Object(l.a)(this.sequencerEngine),this.updateEffects()}},{key:"setupEffects",value:function(){this.connectEffects(this.effectsInputNode,this.effects)}},{key:"updateEffects",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.effects;this.effects=t,this.effects.map(function(t){return t.track=e}),this.connectEffects(this.effectsInputNode,t)}},{key:"disconnectAll",value:function(){this.effects.map(function(e){return e.disconnect()})}},{key:"makePublicIfNeeded",value:function(){var e=Object(s.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=o.a.keys(this.effects);case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,this.effects[t].makePublicIfNeeded();case 5:e.next=1;break;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"connectEffects",value:function(e,t){e.disconnect(),this.effects.map(function(e){return e.disconnect()});for(var n=e,r=0;r<t.length;r++){var a=t[r].getEffect();t[r].isEnabled()&&(n.connect(a),n=t[r])}n.connect(this.outputNode),this.linkEffectParameters()}},{key:"linkEffectParameters",value:function(){var e=this;this.effects.forEach(function(t){t.registerContext(e.parameterContext),t.registerMixSession(e.mixSession)})}},{key:"dispose",value:function(){this.effectsInputNode.disconnect(),this.effectsInputNode.dispose(),this.effects.forEach(function(e){return e.disconnect()}),this.effects.forEach(function(e){return e.dispose()}),this.effects=void 0,this.effectsInputNode=void 0}},{key:"clear",value:function(){this.effects.forEach(function(e){return e.disconnect()}),this.effects.forEach(function(e){return e.dispose()}),this.effects=[]}},{key:"start",value:function(){this.effects.filter(function(e){return e.syncable()}).forEach(function(e){return e.start()}),this.effects.forEach(function(e){return e.parameters.filter(function(e){return e.isConnectedToAnyModulator()}).forEach(function(e){return e.refresh()})})}},{key:"getAllParameters",value:function(){var e=[];return void 0===this.effects?e:(this.effects.forEach(function(t){return t.getParameters().forEach(function(t){return e.push(t)})}),e)}},{key:"getAllPatternLockedParameters",value:function(){return this.getAllParameters().filter(function(e){return e.hasPatternLockedValues()})}},{key:"moveEffectTo",value:function(e,t){if(e!=t){this.effectsInputNode.disconnect(this.effects[0]),this.effects.forEach(function(e){return e.disconnect()});var n=[];e>t?(n=this.effects.slice(0,t).concat([this.effects[e]]).concat(this.effects.slice(t,e)),this.effects.length>e+1&&(n=n.concat(this.effects.slice(e+1)))):(n=this.effects.slice(0,e).concat(this.effects.slice(e+1,t)).concat([this.effects[t],this.effects[e]]),this.effects.length>t+1&&(n=n.concat(this.effects.slice(t+1)))),this.updateEffects(n)}}},{key:"onBPMUpdated",value:function(){for(var e in this.effects)this.effects[e].onBPMUpdated&&this.effects[e].onBPMUpdated()}},{key:"getEffectNumber",value:function(e){var t=e.id;return this.effects.map(function(e){return e.id}).indexOf(t)}},{key:"getEffectById",value:function(e){return this.effects.find(function(t){return t.id===e})}},{key:"addEffect",value:function(e){this.effects=[].concat(Object(a.a)(this.effects),[e]),this.updateEffects()}},{key:"deleteEffect",value:function(e){var t=this.getEffectNumber(e);t<0||(e.disconnect(),t>0&&this.effects[t-1].disconnect(),this.effects.splice(t,1),this.effects=Object(a.a)(this.effects),this.updateEffects(this.effects),e.dispose())}},{key:"getCopy",value:function(t,n,r){var a=new e(t.gainNode,t.trackNode,(new m.a).forTrack(t),this.sequencerEngine);return a.effects=this.effects.map(function(e){return e.getEffectCopy(n,r)}),a.linkEffectParameters(),a}},{key:"getJson",value:function(e){return this.effects.map(function(t){return t.getJson(e)})}},{key:"mate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=Math.max(e.effects.length,this.effects.length),r=[];e.disconnectAll();for(var a=[],i=0;i<n;i++){var o=this.effects[i],s=e.effects[i];Object(d.a)(t)?(s&&r.push(s.getEffectCopy(this.track)),o&&a.push(o)):o&&r.push(o)}this.updateEffects(r),a.forEach(function(e){return e.dispose()}),e.effectsInputNode.disconnect(),e.effectsInputNode.dispose()}},{key:"addEffectJson",value:function(e,t,n){var r=Object(h.b)(e,t,this.sequencerEngine,n);return this.addEffect(r.effect),r}},{key:"fromJson",value:function(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var a={};for(var i in e){var o=e[i],s=Object(h.b)(o,t,this.sequencerEngine,n);this.addEffect(s.effect),a=Object(r.a)({},a,s.bulk)}this.sequencerEngine.parametersToUpdate=Object(r.a)({},this.sequencerEngine.parametersToUpdate,a)}},{key:"convertToRack",value:function(){var e=this.effects.map(function(e){return e.getEffectCopy()}),t=new f.a(this.sequencerEngine);e.forEach(function(e){return t.addEffect(e,!1)});var n,r=50,a=100,i=y(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.x=r,o.y=a,(r+=50)>300&&(r=50,a+=50)}}catch(c){i.e(c)}finally{i.f()}t.connectNodes(void 0,e[0]);for(var s=0;s<e.length;s++)t.connectNodes(e[s],e[s+1]);this.clear(),this.addEffect(t)}}]),e}();t.a=g},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"add",gen:function(){var e=r.getInputs(this),t="",n=0,a=0,i=!1,o=!0;return 0===e.length?0:(t="  var ".concat(this.name," = "),e.forEach(function(r,s){isNaN(r)?(t+=r,s<e.length-1&&(i=!0,t+=" + "),o=!1):(n+=parseFloat(r),a++)}),a>0&&(t+=i||o?n:" + "+n),t+="\n",r.memo[this.name]=this.name,[this.name,t])}};t.default=function(){var e=Object.create(a);e.id=r.getUID(),e.name=e.basename+e.id;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.inputs=n,e}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"accum",gen:function(){var e,t=r.getInputs(this),n="gen."+this.name;return r.requestMemory(this.memory),r.memory.heap[this.memory.value.idx]=this.initialValue,e=this.callback(n,t[0],t[1],"memory[".concat(this.memory.value.idx,"]")),r.memo[this.name]=this.name+"_value",[this.name+"_value",e]},callback:function(e,t,n,r){var a=this.max-this.min,i="",o="";return"number"===typeof this.inputs[1]&&this.inputs[1]<1||(this.resetValue!==this.min?i+="  if( ".concat(n," >=1 ) ").concat(r," = ").concat(this.resetValue,"\n\n"):i+="  if( ".concat(n," >=1 ) ").concat(r," = ").concat(this.min,"\n\n")),i+="  var ".concat(this.name,"_value = ").concat(r,"\n"),!1===this.shouldWrap&&!0===this.shouldClamp?i+="  if( ".concat(r," < ").concat(this.max," ) ").concat(r," += ").concat(t,"\n"):i+="  ".concat(r," += ").concat(t,"\n"),this.max!==1/0&&this.shouldWrapMax&&(o+="  if( ".concat(r," >= ").concat(this.max," ) ").concat(r," -= ").concat(a,"\n")),this.min!==-1/0&&this.shouldWrapMin&&(o+="  if( ".concat(r," < ").concat(this.min," ) ").concat(r," += ").concat(a,"\n")),i=i+o+"\n"},defaults:{min:0,max:1,resetValue:0,initialValue:0,shouldWrap:!0,shouldWrapMax:!0,shouldWrapMin:!0,shouldClamp:!1}};t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=Object.create(a);return Object.assign(i,{uid:r.getUID(),inputs:[e,t],memory:{value:{length:1,idx:null}}},a.defaults,n),void 0!==n&&void 0===n.shouldWrapMax&&void 0===n.shouldWrapMin&&void 0!==n.shouldWrap&&(i.shouldWrapMin=i.shouldWrapMax=n.shouldWrap),void 0!==n&&void 0===n.resetValue&&(i.resetValue=i.min),void 0===i.initialValue&&(i.initialValue=i.min),Object.defineProperty(i,"value",{get:function(){return r.memory.heap[this.memory.value.idx]},set:function(e){r.memory.heap[this.memory.value.idx]=e}}),i.name="".concat(i.basename).concat(i.uid),i}},function(e,t,n){"use strict";n.r(t);var r=n(112).default;t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t={inputs:[e],memory:{value:{length:1,idx:null}},recorder:null,in:function(n){if(r.histories.has(n)){var a=r.histories.get(n);return t.name=a.name,a}var i={gen:function(){var a=r.getInputs(t);null===t.memory.value.idx&&(r.requestMemory(t.memory),r.memory.heap[t.memory.value.idx]=e);var o=t.memory.value.idx;return r.addToEndBlock("memory[ "+o+" ] = "+a[0]),r.histories.set(n,i),a[0]},name:t.name+"_in"+r.getUID(),memory:t.memory};return this.inputs[0]=n,t.recorder=i,i},out:{gen:function(){return null===t.memory.value.idx&&(void 0===r.histories.get(t.inputs[0])&&r.histories.set(t.inputs[0],t.recorder),r.requestMemory(t.memory),r.memory.heap[t.memory.value.idx]=parseFloat(e)),"memory[ "+t.memory.value.idx+" ] "}},uid:r.getUID()};return t.out.memory=t.memory,t.name="history"+t.uid,t.out.name=t.name+"_out",t.in._name=t.name="_in",Object.defineProperty(t,"value",{get:function(){if(null!==this.memory.value.idx)return r.memory.heap[this.memory.value.idx]},set:function(e){null!==this.memory.value.idx&&(r.memory.heap[this.memory.value.idx]=e)}}),t}},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),o=n(7),s=n(8),c=n(2),u=(n(6),n(992)),l=n(436),f=n(21),h=n(33),d=n(60),p=n(552);n(1);var v=function(e,t){for(var n in e){var r=e[n];if(r)for(var a in r.steps){if(r.steps[a].hasStep(t))return{stepNumber:parseInt(n),position:a}}}return{stepNumber:void 0,position:void 0}};function m(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var O=function(e,t,n){var a=Object(r.a)(e.steps),i=function(e,t){var n=e.steps.map(function(e){return v(t,e)});return Math.min.apply(Math,Object(r.a)(n.map(function(e){return e.stepNumber})))}(e,t);a.reverse();var o,s=b(a);try{for(s.s();!(o=s.n()).done;){var c=o.value,u=v(t,c),l=u.stepNumber,f=(u.position,l-i),h=Math.floor(i+f*n);if(t[l]){var p=t[l].steps,m=t[l].track;h!==l&&(t[l]=new d.a(m),t[h]=new d.a(m),t[h].steps=p)}}}catch(y){s.e(y)}finally{s.f()}return t};function j(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var w=n(258);n(49);function x(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var E=function(e,t,n){switch(n.thenType){case p.a:return function(e,t,n){var a=Object(r.a)(e.steps);a.reverse();var i,o=Object(r.a)(t),s=m(a);try{for(s.s();!(i=s.n()).done;){var c=i.value,u=v(o,c),l=u.stepNumber,f=(u.position,Math.round((l+n)%t.length));if(o[l]){var h=o[l].steps,p=t[l].track;t[l]=new d.a(p),t[f]=new d.a(p),t[f].steps=h}}}catch(y){s.e(y)}finally{s.f()}return t}(t,e,n.thenValue.get());case p.d:return O(t,e,n.thenValue.get());case p.l:return function(e,t){var n,a=Object(r.a)(e.steps),i=j(a.slice(0,a.length-1));try{for(i.s();!(n=i.n()).done;)for(var o=n.value,s=v(t,o).stepNumber,c=t[s],u=s+2;u<t.length&&!t[u].anyOn();u+=2)t[u]=c}catch(l){i.e(l)}finally{i.f()}return t}(t,e);case p.f:return function(e,t){for(var n=Object(r.a)(e.steps),a=0;a<n.length-1;a++){var i=n[a],o=n[a+1],s=v(t,i),c=v(t,o),u=t[s.stepNumber],l=new d.a(u.track);for(var f in u.steps){var h=u.steps[f].getCopy(),p=(c.stepNumber-s.stepNumber)/2;h.duration=p,l.steps[f]=h}t[s.stepNumber]=l}return t}(t,e)}return e},T=function(){function e(t){Object(a.a)(this,e),this.children=t}return Object(i.a)(e,[{key:"getAllLeaves",value:function(){if(void 0===this.children)return[this];var e=[];for(var t in this.children)e=e.concat(this.children[t].getAllLeaves());return e}},{key:"getLeftMostLeaf",value:function(){var e=this.getAllLeaves();if(e.length>0)return e[0]}}]),e}();n(20);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var M=function(e){Object(o.a)(n,e);var t=A(n);function n(e,r,i,o){var s;return Object(a.a)(this,n),(s=t.call(this,o)).pattern=e,s.stepNumber=r,s.resolution=i,s}return Object(i.a)(n,[{key:"track",get:function(){return this.pattern.track}},{key:"state",get:function(){return this.track.sequencerEngine.state}},{key:"stepBuckets",get:function(){return this.resolution.isTriplet?this.pattern.tripletStepBuckets:this.pattern.stepBuckets}},{key:"search",value:function(e,t){if(void 0!==this.stepNumber){void 0===this.resolution||this.resolution.toString();if(this.stepNumber===e&&t.equals(this.resolution))return this;if(void 0!==this.children)for(var n in this.children){var r=this.children[n].search(e,t);if(void 0!==r)return r}}else for(var a in this.children){var i=this.children[a].search(e,t);if(void 0!==i)return i}}},{key:"toggle",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this.on){var n=this.getAllLeaves().filter(function(e){return e.on}),r=[];for(var a in n){var i=n[a];r.push({stepBucket:this.stepBuckets[i.stepNumber],stepNumber:i.stepNumber});var o=function(t){var n=e.stepBuckets[i.stepNumber];n.group&&(n.group.steps=n.group.steps.filter(function(e){return e!=n}))};for(var s in this.stepBuckets[i.stepNumber])o();var c=t||this.stepBuckets[i.stepNumber].getAllOnSteps()[0].id;this.stepBuckets[i.stepNumber]=new d.a(this.pattern.track,this.resolution.isTriplet),this.stepBuckets[i.stepNumber].steps[0]=new h.a(void 0,void 0,void 0,this.track),this.stepBuckets[i.stepNumber].steps[0].id=c}return r}var u=this.getLeftMostLeaf();this.on=!0,this.stepBuckets[u.stepNumber].steps[0]||(this.stepBuckets[u.stepNumber].steps[0]=new h.a(void 0,void 0,void 0,this.track)),t=t||this.stepBuckets[u.stepNumber].steps[0].id,this.getLeftMostBucket().steps[0].id=t;var l=new d.a(this.pattern.track,this.resolution.isTriplet);return l.steps[0]=new h.a(void 0,void 0,void 0,this.track),l.steps[0].id=t,[{stepBucket:l,stepNumber:u.stepNumber}]}},{key:"on",get:function(){return void 0===this.children?this.stepBuckets[this.stepNumber].anyOn():this.getAllLeaves().some(function(e){return e.on})},set:function(e){var t=this.getLeftMostBucket();if(!t.steps[0]){var n=new h.a;n.track=this.pattern.track,t.steps[0]=n}t.steps[0].on=e;var r=this.state.effects.selectedPalettes[this.track.id];void 0!==r&&(t.steps[0].palette=r)}},{key:"getLeftMostBucket",value:function(){var e=this.getLeftMostLeaf();return this.stepBuckets[e.stepNumber]}},{key:"getJson",value:function(){return void 0===this.children?{stepNumber:this.stepNumber,resolution:this.resolution}:{stepNumber:this.stepNumber,resolution:this.resolution,children:this.children.map(function(e){return e.getJson()})}}}]),n}(T);function R(e,t){for(var n=new f.a(1,t),r=e.length(n),a=[],i=0;i<r;i++){var o=new M(e,i,n,void 0);a.push(C(o,e,t))}return new M(e,void 0,void 0,a)}function C(e,t,n){var r=e.resolution;if(32===r.resolution)return e;var a=new f.a(2*r.resolution,r.isTriplet);if(n){var i=new M(t,3*e.stepNumber,a,void 0),o=new M(t,3*e.stepNumber+1,a,void 0),s=new M(t,3*e.stepNumber+2,a,void 0);e.children=[C(i,t),C(o,t),C(s,t)]}else{var c=new M(t,2*e.stepNumber,a,void 0),u=new M(t,2*e.stepNumber+1,a,void 0);e.children=[C(c,t),C(u,t)]}return e}var N=n(23);function I(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var D=new f.a(32,!1),F=new f.a(32,!0),L=(new f.a(16,!1),0),B=function(e){Object(o.a)(n,e);var t=_(n);function n(e,r){var i;return Object(a.a)(this,n),(i=t.call(this)).steps=[],i.id=L++,i.sequencerEngine=e,i.store=e.store,i.track=r,i.frozenPatternPlaying=void 0,i.mix=new l.a(e),i.stepBuckets=[],i.tripletStepBuckets=[],i.stepBucketsMatrix={},i.tripletStepBucketsMatrix={},i.transformBucketsIntoStepsCache={},i.stepFills=[],i.tripletStepFills=[],i.volume=0,i.panning=0,i.muted=!1,i.initBlankPattern(),i.color=void 0,i.loopsPlaying={},i.sequencerEngine.multiSequencerEngine||i.updateStepResolutionTree(),i.needsSync=!1,i._startStep=void 0,i.repeats=void 0,i}return Object(i.a)(n,[{key:"startStep",get:function(){return this._startStep},set:function(e){e<0||(this._startStep=e,void 0!==e&&this.sequencerEngine.store.dispatch(Object(N.D)(this.track.subSequence.id,this.id,e)))}},{key:"step",get:function(){return this._startStep}},{key:"duration",get:function(){return this.length()}},{key:"endStep",get:function(){return this._startStep+this.length()}},{key:"updateStepResolutionTree",value:function(){this.stepResolutionTree=R(this,!1),this.tripletStepResolutionTree=R(this,!0)}},{key:"getStepResolutionTree",value:function(e){return e?this.tripletStepResolutionTree:this.stepResolutionTree}},{key:"getBucketsForStepAtResolution",value:function(e,t){for(var n=this.getRangeOfStepsAtResolution(t),r=t.isTriplet?this.tripletStepBuckets:this.stepBuckets,a=t.isTriplet?F.transformStepAtResolution(e,t):D.transformStepAtResolution(e,t),i=[],o=a=Math.floor(a);o<n+a;o++)i.push(r[o%r.length]);return i}},{key:"deleteStepNumber",value:function(e){this.stepBuckets[e]=new d.a(this.track)}},{key:"getRangeOfStepsAtResolution",value:function(e){return e.isTriplet?F.numSteps()/e.numSteps():D.numSteps()/e.numSteps()}},{key:"getAllOnStepAtResolutionBeforePosition",value:function(e,t,n){return this.getBucketsForStepAtResolution(e,t)[0].getAllOnStepsBefore(n)}},{key:"getAllOnStepAtResolutionAtAnyPosition",value:function(e,t,n){this.getRangeOfStepsAtResolution(t);var r=this.getBucketsForStepAtResolution(e,t),a=[];for(var i in r)a=a.concat(r[i].getAllOnSteps(n));return a}},{key:"getStepAtResolution",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=this.getBucketsForStepAtResolution(e,t);for(var i in a)if(void 0!==a[i]){var o=a[i].getStep(r);if(o&&o.getPolyphony().some(function(e){return e.on&&n(e)}))return o}a.length}},{key:"getPolyphonicStepsAtResolution",value:function(e,t){var n=t.isTriplet?F.numSteps()/t.numSteps():D.numSteps()/t.numSteps(),r=[];if(t.isTriplet){var a=F.transformStepAtResolution(e,t);this.tripletStepBuckets[a%this.tripletStepBuckets.length];for(var i=a;i<n+a;i++){var o=this.tripletStepBuckets[i%this.tripletStepBuckets.length].steps,s=function(e){var t=o[e].getPolyphony().filter(function(e){return e.on}).map(function(t){return{position:e,step:t}});r=r.concat(t)};for(var c in o)s(c)}}else{var u=D.transformStepAtResolution(e,t);this.stepBuckets[u%this.stepBuckets.length];for(var l=u;l<n+u;l++){var f=this.stepBuckets[l%this.stepBuckets.length].steps,h=function(e){var t=f[e].getPolyphony().filter(function(e){return e.on}).map(function(t){return{position:parseFloat(e),step:t}});r=r.concat(t)};for(var d in f)h(d)}}return r}},{key:"setStepAtResolution",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(void 0===t||isNaN(t))&&(t=0),(void 0===r||isNaN(r))&&(r=0),t=n.isTriplet?F.transformStepAtResolution2(t,n):D.transformStepAtResolution2(t,n);var a=Math.floor(t);if((r+=t-a)>=1){var i=Math.floor(r);a+=i,r-=i}n.isTriplet?this.tripletStepBuckets[a%this.tripletStepBuckets.length].setStepAtPosition(e,r):this.stepBuckets[a%this.stepBuckets.length].setStepAtPosition(e,r)}},{key:"addNote",value:function(e,t,n){var r=new h.a;r.on=!0,r.duration=t,r.transpose=n,r.stepNumber=e,this.stepBuckets[e].setStep(0,r)}},{key:"clearCache",value:function(){this.transformBucketsIntoStepsCache={}}},{key:"loadStepBuckets",value:function(e){e&&(this.stepBuckets=e),this.tripletStepBuckets=F.transformBucketsAtResolution(this.stepBuckets,D),this.updateStepResolutionTree(),this.transformBucketsIntoStepsCache={},this.syncMatrix()}},{key:"syncBuckets",value:function(e){(e=void 0!==e&&e)?this.stepBuckets=D.transformBucketsAtResolution(this.tripletStepBuckets,F):this.tripletStepBuckets=F.transformBucketsAtResolution(this.stepBuckets,D),this.syncMatrix()}},{key:"syncBucketsAtStep",value:function(e,t){var n=this.getRangeOfStepsAtResolution(t),r=t.isTriplet?F.transformStepAtResolution(e,t):D.transformStepAtResolution(e,t),a=(r=Math.floor(r))+n;t.isTriplet?this.stepBuckets=D.transformBucketsAtResolution(this.tripletStepBuckets,F,r,a,this.stepBuckets):this.tripletStepBuckets=F.transformBucketsAtResolution(this.stepBuckets,D,r,a,this.tripletStepBuckets),this.syncMatrix()}},{key:"syncMatrixBySteps",value:function(e,t){this.needsSync=!1;var n=t.isTriplet?this.tripletStepBuckets:this.stepBuckets,r=t.isTriplet?this.tripletStepBucketsMatrix:this.stepBucketsMatrix;for(var a in e){var i=e[a];a=D.transformStepAtResolution(a,t),i=D.transformStepAtResolution(i,t);var o=n[a],s=n[i];o&&o.anyOn()?r[a]=o:delete r[a],s&&s.anyOn()?r[i]=s:delete r[i]}}},{key:"syncMatrix",value:function(){this.stepBucketsMatrix={},this.tripletStepBucketsMatrix={};for(var e=0;e<this.stepBuckets.length;e++){var t=this.stepBuckets[e];t.anyOn()&&(this.stepBucketsMatrix[e]=t)}for(var n=0;n<this.tripletStepBuckets.length;n++){var r=this.tripletStepBuckets[n];r.anyOn()&&(this.tripletStepBucketsMatrix[n]=r)}this.needsSync=!1}},{key:"getBucket",value:function(e,t){e=(t=t||D).isTriplet?F.transformStepAtResolution2(e,t):D.transformStepAtResolution2(e,t);var n=this.isTransformed?this.transformedStepBuckets:this.stepBuckets;return t.isTriplet?this.tripletStepBuckets[e]:n[e]}},{key:"clear",value:function(){this.stepBuckets.map(function(e){return e.clear()}),this.syncBuckets(),this.clearCache()}},{key:"changeLength",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e=Math.ceil(e),this.stepBuckets=this.stepBuckets.slice(0,e);for(var n=this.stepBuckets.length;n<e;n++)this.stepBuckets.push(new d.a(this.track));this.updateStepResolutionTree(),this.clearCache(),t&&this.syncBuckets()}},{key:"length",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D;if(e===D)return e.isTriplet?this.tripletStepBuckets.length:this.stepBuckets.length;var t=e.isTriplet?this.tripletStepBuckets.length:this.stepBuckets.length;return e.isTriplet?Math.ceil(e.transformStepAtResolution2(t,F)):Math.ceil(e.transformStepAtResolution2(t,D))}},{key:"initBlankPattern",value:function(){for(var e=0;e<D.numSteps();e++)this.stepBuckets.push(new d.a(this.track)),this.stepFills.push(!1);if(!this.sequencerEngine.multiSequencerEngine)for(e=0;e<F.numSteps();e++)this.tripletStepBuckets.push(new d.a(this.track,!0)),this.tripletStepFills.push(!1)}},{key:"getFillsAtResolution",value:function(e){return e.isTriplet?e.transformList(this.tripletStepFills):e.transformList(this.stepFills)}},{key:"getStepsAtResolution",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=e.isTriplet?this.tripletStepBuckets:this.stepBuckets;if(!(e in this.transformBucketsIntoStepsCache)){var n=e.transformBucketsIntoSteps(t);return this.transformBucketsIntoStepsCache[e]=n,n}return this.transformBucketsIntoStepsCache[e]}},{key:"getAnyStep",value:function(e){for(var t in this.stepBuckets[e].steps){var n=this.stepBuckets[e].steps[t];if(n.on)return n}return this.stepBuckets[e].steps[0]}},{key:"getBucketsAtResolution",value:function(e){var t=e.isTriplet?this.tripletStepBuckets:this.stepBuckets;return e.transformList(t)}},{key:"setLength",value:function(e){this.stepBuckets=[];for(var t=0;t<e;t++)this.stepBuckets.push(new d.a(this.track));this.syncBuckets(!1)}},{key:"doubleTrackLength",value:function(){for(var e=this.stepBuckets.length,t=0;t<e;t++)this.stepBuckets.push(new d.a(this.track)),this.stepFills.push(!1);e=this.tripletStepBuckets.length;for(var n=0;n<e;n++)this.tripletStepBuckets.push(new d.a(this.track,!0)),this.tripletStepFills.push(!1);this.clearCache(),this.updateStepResolutionTree()}},{key:"halfTrackLength",value:function(){var e=this.length()/2;e<=1||(this.stepBuckets=this.stepBuckets.slice(0,e),this.stepFills=this.stepFills.slice(0,e),e=this.tripletStepBuckets.length/2,this.tripletStepBuckets=this.tripletStepBuckets.slice(0,e),this.tripletStepFills=this.tripletStepFills.slice(0,e),this.clearCache(),this.updateStepResolutionTree())}},{key:"loadFromJson",value:function(e){if(void 0===e.newVolume){var t=e.volume+40;this.volume=128*t/60}else this.volume=e.volume;this.panning="panning"in e?e.panning:0,this.muted=e.muted,this.loopsPlaying="loopsPlaying"in e?e.loopsPlaying:{},"startStep"in e&&(this.startStep=e.startStep),"repeats"in e&&(this.repeats=e.repeats),this.frozenPatternPlaying=e.frozenPatternPlaying}},{key:"calculateFillsHelper",value:function(e,t,n){n.isTriplet?this.tripletStepFills.fill(!1):this.stepFills.fill(!1);for(var r=t.length,a=0;a<r;a++){var i=-16;for(var o in t[a].steps){var s=t[a].getStep(o);if(s.on){var c=null==s.duration?e.duration:s.duration;i<(c=2*Math.floor(c))&&(i=c)}}if(!(i<1))for(var u=0;u<i;u++){var l=(a+u)%r;n.isTriplet?this.tripletStepFills[l]=!0:this.stepFills[l]=!0}}}},{key:"calculateFills",value:function(e){this.calculateFillsHelper(e,this.stepBuckets,D),this.calculateFillsHelper(e,this.tripletStepBuckets,F)}},{key:"getJson",value:function(){return{newVolume:!0,automations:this.mix.getJson(),volume:this.volume,panning:this.panning,muted:this.muted,loopsPlaying:this.loopsPlaying,startStep:this.startStep,repeats:this.repeats,frozenPatternPlaying:this.frozenPatternPlaying}}},{key:"getCopy",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.stepBuckets.length,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.track,i=new n(this.sequencerEngine,a);i.frozenPatternPlaying=this.frozenPatternPlaying,i.stepBuckets=[],i.mix=this.mix,i.tripletStepBuckets=[],i.volume=this.volume,i.panning=this.panning,i.muted=this.muted,i.steps=[],i.loopsPlaying={},Object.keys(this.loopsPlaying).map(function(t){return i.loopsPlaying[t]=e.loopsPlaying[t]});for(var o=this.getAllGroups(),s=t;s<r;s++){var c=this.stepBuckets[s].getCopy(a);i.stepBuckets.push(c),i.stepFills.push(this.stepFills[s])}var u,l=i.getAllSteps(),f=I(o);try{var h=function(){var t=u.value,n=l.filter(function(e){return e.group===t}),r=Object(w.e)(n,e.track,!0);Object(w.a)(t,r,a)};for(f.s();!(u=f.n()).done;)h()}catch(d){f.e(d)}finally{f.f()}return i.startStep=void 0===this.startStep?void 0:this.startStep+t,i.syncBuckets(),i.updateStepResolutionTree(),i}},{key:"chooseColor",value:function(e){this.color=e}},{key:"getUpdateStepsAction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.store.getState().sequencer.displayResolution,r=this.length(n),a=new Array(r).fill(!1),i={},o={},s={},c={},u={},l=new Array(r),h=this.getEasyPattern();e&&h.update(t);var d=n.isTriplet?this.tripletStepBucketsMatrix:this.stepBucketsMatrix;n.isTriplet?this.tripletStepBuckets:this.stepBuckets;if(this.track.sequencerEngine.state.groups.stepsGroupMode&&this.isTransformed)for(var p in d={},this.transformedStepBuckets){var v=this.transformedStepBuckets[p];if(v.anyOn()){var m=v.getAllOnSteps().find(function(e){return e.group});if(m&&Object(w.g)(m))continue;d[p]=v}}var y=n.isTriplet?new f.a(32,!0):new f.a(32,!1);for(var b in d){var g=Math.floor(n.transformStepAtResolution2(b,y));a[g]=!0;var O=y.resolution/n.resolution,j=(b-g*O)/O,k=[];if(void 0!==d[b]){for(var x in d[b].steps){var S=d[b].steps[x].getPolyphony();for(var P in S){var E=S[P];if(E.on){var T=Math.round(E.transpose),A=parseFloat(x)/O+j,M=new f.a(16,!1),R=n.transformStepAtResolution2(E.duration,M);T in i||(i[T]={},o[T]={},s[T]={}),k.push(E);var C=parseInt(g)+A;i[T][C]=!0,o[T][C]=0,s[T][C]=R}}}var N=d[b].getAllOnSteps()[0];for(var I in l[g]=N,u[g]=N&&N.group?N.group.id:void 0,k){var q=k[I];if(q.on){var _=q.transpose;null==_&&(_=this.trackData.transpose);for(var D=n.transformStepAtResolution2(q.duration,new f.a(16,!1)),F=0;F<D;F++){var L=(parseInt(g)+parseInt(F))%r;c[parseInt(L)]=!0}}}}}return this.sequencerEngine.midi&&this.sequencerEngine.cursor.track===this.trackNumber&&this.sequencerEngine.midi.updateSteps(a),{id:this.subSequence.isTrack?this.subSequence.id:this.track.id,trackNumber:this.subSequence.isTrack?this.subSequence.id:this.trackNumber,steps:a,pianoRollSteps:i,trackFills:c,stepToId:l,pianoRollPositions:o,pianoRollDurations:s,muted:this.track.muted,groups:u}}},{key:"getTrackStepsAction",value:function(){var e=this.store.getState().sequencer.displayResolution,t=this.length(e),n=new Array(t).fill(!1),r=e.isTriplet?this.tripletStepBucketsMatrix:this.stepBucketsMatrix,a=e.isTriplet?new f.a(32,!0):new f.a(32,!1);for(var i in r){n[Math.floor(e.transformStepAtResolution2(i,a))]=!0}return n}},{key:"trackPatternSteps",get:function(){var e=this.subSequence.isTrack?this.subSequence.id:this.trackNumber;return this.sequencerEngine.state.tracks.trackPatternSteps[e]||{}}},{key:"subSequence",get:function(){return this.track.subSequence}},{key:"trackNumber",get:function(){return this.track.trackNumber}},{key:"trackData",get:function(){return this.track.trackData}},{key:"getEasyPattern",value:function(){return new u.a(this,this.trackData)}},{key:"split",value:function(e){var t=e-this.startStep,r=(this.length(),new n(this.sequencerEngine,this.track));return r.stepBuckets=this.stepBuckets.slice(t),this.stepBuckets=this.stepBuckets.slice(0,t),r.startStep=e,this.syncBuckets(),r.syncBuckets(),r}},{key:"overlapsStep",value:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e>=this.startStep&&e<=this.startStep+this.length():e>=this.startStep&&e<this.startStep+this.length()}},{key:"addToStart",value:function(e){for(var t=[],n=0;n<e;n++)t.push(new d.a(this.track));this.stepBuckets=[].concat(t,Object(r.a)(this.stepBuckets)),this.syncBuckets()}},{key:"cutFromStart",value:function(e){this.stepBuckets=this.stepBuckets.slice(e),this.syncBuckets()}},{key:"dispose",value:function(){this.stepBuckets=void 0,this.tripletStepBuckets=void 0,this.stepBucketsMatrix=void 0,this.tripletStepBucketsMatrix=void 0,this.stepFills=void 0,this.tripletStepFills=void 0,this.mix=void 0,this.track=void 0}},{key:"getAllSteps",value:function(){var e=[],t=this.stepBuckets;for(var n in t){var r=t[n];for(var a in r.steps){var i=r.steps[a];e=e.concat(i.getPolyphony().filter(function(e){return e.on}))}}return e}}]),n}(function(e){Object(o.a)(n,e);var t=P(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).transformedStepBuckets=[],e.isTransformed=!1,e}return Object(i.a)(n,[{key:"stepGroups",get:function(){return this.track.stepGroups}},{key:"transform",value:function(){this.isTransformed=!0;var e,t=Object(r.a)(this.stepBuckets),n=x(this.getAllGroups());try{for(n.s();!(e=n.n()).done;){var a,i=e.value,o=x(i.transformations);try{for(o.s();!(a=o.n()).done;){var s=a.value;Object(w.h)(s)&&(t=E(t,i,s))}}catch(c){o.e(c)}finally{o.f()}}}catch(c){n.e(c)}finally{n.f()}this.transformedStepBuckets=t}},{key:"getAllGroups",value:function(){return Array.from(new Set(this.getAllSteps().map(function(e){return e.group}))).filter(function(e){return e})}}]),n}(function(){return function e(){Object(a.a)(this,e)}}()));t.a=B},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){var e;return function(t){return e?e.dispatch(t):(e=t,0)}}()},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(169),u=n(377),l=n(440);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e,a,i){var o;return Object(r.a)(this,n),(o=t.call(this,e,a.getType())).event=a,o.duration=i,o}return Object(a.a)(n,[{key:"addEvent",value:function(e,t,n){e.isDeterministic()?new l.a(this.mix,e,t,n).execute():new u.a(this.mix,e,t,n).execute()}},{key:"execute",value:function(){if(!isNaN(this.event.step)){for(var e in this.events){var t=this.events[e];if(!t.isPrunable()&&void 0!==t.duration&&t.step<this.event.step&&t.step+t.duration>this.duration+this.event.step){var n=t.getCopy(this.mix.sequencerEngine);return n.step=this.event.step,void this.addEvent(n,0,n.step)}}this.addEvent(this.event,0,this.event.step)}}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";n.d(t,"e",function(){return m}),n.d(t,"f",function(){return g}),n.d(t,"h",function(){return O}),n.d(t,"i",function(){return j}),n.d(t,"d",function(){return P}),n.d(t,"c",function(){return E}),n.d(t,"a",function(){return T}),n.d(t,"b",function(){return A}),n.d(t,"g",function(){return M});var r=n(1),a=n(11),i=n(20),o=n(286),s=n(145),c=n(123),u=n(14),l=n(552),f=(n(6),n(23));function h(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p=0,v={},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(arguments.length>2?arguments[2]:void 0);else{if(e.every(function(e){return e.group}))return;if(e.some(function(e){return e.group})){var n,r=e.find(function(e){return e.group}).group,a=h(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;i.group!==r&&(r.steps.push(i),i.group=r)}}catch(s){a.e(s)}finally{a.f()}return t.sequencerEngine.dispatch(Object(f.m)(r)),r}}var o=y(e);return e.forEach(function(e){return e.group=o}),t.stepGroups.push(o),t.sequencerEngine.dispatch(Object(f.m)(o)),o},y=function(e,t){var n={id:Object(i.uuid)(),name:"Group "+ ++p,steps:e,transformations:[]};return b(n,t),n},b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.steps[0].track,n=S("Conditional ",t,0,100),r=S("Action Amount",t,-32,32),a=S("Aux Value",t,0,100,100),o={id:Object(i.uuid)(),whenType:l.j,whenValue:n,thenType:void 0,thenValue:r,probabilityBit:!0,loopCounter:-1,auxValue:a,auxProbabilityBit:!0,midiEffect:void 0};return v[o.id]=o,e.transformations.push(o),o},g=function(e){var t,n=h(e.transformations);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=r.whenType,i=r.whenValue,o=r.auxValue;if(r.loopCounter++,r.previousProbabilityBit=r.probabilityBit,r.previousAuxBit=r.auxBit,a===l.j){var s=Math.random()<i.get()/100;r.probabilityBit=s}else if(a===l.g||a===l.h){var c=Math.random()<Math.abs(o.get())/100;r.auxProbabilityBit=c}}}catch(u){n.e(u)}finally{n.f()}},O=function e(t){if(!t)return!1;var n=t.whenValue.get();if(t.whenType===l.j)return t.probabilityBit;if(t.whenType===l.c)return t.loopCounter%n===n-1;if(t.whenType===l.g){var r=v[n];return t.auxValue.get()>=0?t.auxProbabilityBit&&e(r):t.auxProbabilityBit&&!e(r)}return!1},j=function(e,t,n,r){if(t.transformations.every(function(e){return!O(e)}))return{step:e,time:n};var i=Object(a.a)(t.transformations);i.sort(function(e,t){return l.i.indexOf(e.thenType)-l.i.indexOf(t.thenType)});var o,c=h(i);try{for(c.s();!(o=c.n()).done;){var u=o.value;if(O(u))if(u.thenType===l.k)e=k(e,t);else if(u.thenType===l.n)e=w(e,u.thenValue.get());else if(u.thenType===l.b)e=x(e,u.thenValue.get());else if(u.thenType===l.m){u.midiEffect.onNewStep(),u.midiEffect.input(new s.a(e,n,r));var f=u.midiEffect.output(n,r,r);return 0===f.length?{time:n,step:e}:{time:f[0].time,step:f[0].stepData}}}}catch(d){c.e(d)}finally{c.f()}return{time:n,step:e}},k=function(e,t){var n=t.steps.indexOf(e),r=Object(a.a)(t.steps);return r.reverse(),r[n]},w=function(e,t){return(e=e.getCopy()).transpose+=t,e},x=function(e,t){return(e=e.getCopy()).duration*=t,e},S=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=new u.a(e,t,function(){return 0},{defaultValue:a,min:n,max:r,doNotDispose:!0});return i.setContext((new c.a).forTrack(t)),i},P=function(e){var t,n=Object(r.a)({},e,{transformations:[],steps:void 0}),a=h(e.transformations);try{for(a.s();!(t=a.n()).done;){var i=t.value,o=Object(r.a)({},i,{copiedFrom:void 0,copiedTo:void 0});o.whenValue=i.whenValue.getJson(),o.thenValue=i.thenValue.getJson(),o.auxValue=i.auxValue.getJson(),i.midiEffect&&(o.midiEffect=i.midiEffect.getJson()),n.transformations.push(o)}}catch(s){a.e(s)}finally{a.f()}return n},E=function(e,t){var n=y([],t);n.name=e.name,n.id=e.id;var r,a=0,i=h(e.transformations);try{for(i.s();!(r=i.n()).done;){var s=r.value;n.transformations[a].id=s.id,n.transformations[a].whenType=s.whenType,n.transformations[a].thenType=s.thenType,n.transformations[a].whenValue.fromJson(s.whenValue),n.transformations[a].thenValue.fromJson(s.thenValue),s.auxValue&&n.transformations[a].auxValue.fromJson(s.auxValue),s.midiEffect&&(n.transformations[a].midiEffect=Object(o.a)(s.midiEffect,t),n.transformations[a].midiEffect.fromJson(s.midiEffect)),v[s.id]=n.transformations[a],a<e.transformations.length-1&&b(n,t),a++}}catch(c){i.e(c)}finally{i.f()}return n},T=function(e,t,n){for(var r=0;r<e.transformations.length;r++){var a=e.transformations[r],i=t.transformations[r];i.whenType=a.whenType,i.thenType=a.thenType,i.whenValue.copyFrom(a.whenValue),i.thenValue.copyFrom(a.thenValue),a.midiEffect&&(i.midiEffect=a.midiEffect.getCopy(n,!0)),a.copiedTo=i,i.copiedFrom=a;var o=a.whenValue.get();if(a.whenType===l.g&&o){var s=v[o];s&&s.copiedTo&&i.whenValue.set(s.copiedTo.id)}r<e.transformations.length-1&&b(t,n)}},A=function(e){e.group&&(e.group.steps=e.group.steps.filter(function(t){return t!==e}),e.group=void 0)},M=function(e){if(e.group){var t=e.group.transformations.find(function(e){return e.thenType===l.e});return!!t&&O(t)}return!1}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(11),a=n(136),i=n(20),o=[],s=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(a.d)(e).slice(0,1),s=(Object(i.uuid)(),function(e){n=[e].concat(Object(r.a)(n))});return Object(a.e)(e,s,t),function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])return Object(a.g)(e,s);if(0===n.length)return o;var t=Object(r.a)(n);return n=[],t}}},function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"l",function(){return u}),n.d(t,"o",function(){return l}),n.d(t,"g",function(){return f}),n.d(t,"i",function(){return h}),n.d(t,"j",function(){return d}),n.d(t,"d",function(){return p}),n.d(t,"c",function(){return v}),n.d(t,"f",function(){return m}),n.d(t,"e",function(){return y}),n.d(t,"k",function(){return b}),n.d(t,"m",function(){return g}),n.d(t,"h",function(){return O}),n.d(t,"n",function(){return j}),n.d(t,"a",function(){return k});var r=n(11),a=n(114),i=n(20);function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var o=a.A.apply(void 0,[e].concat(r)),s=a.A.apply(void 0,[t].concat(r));return o.push(s),Object(a.w)(!0)}},u=function(e,t,n){return function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];var s=a.A.apply(void 0,[e].concat(i));if(s){var c=a.A.apply(void 0,[t].concat(i)),u=void 0;return n&&(u=a.A.apply(void 0,[n].concat(i))),s.slice(c,Math.max(1,u%(s.length+1)))}return 0}},l=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=t;return 1===t.length&&(i=Array.isArray(t[0])?t[0]:a.A.apply(void 0,[t[0]].concat(n))),i.reduce(function(e,t){return a.A.apply(void 0,[t].concat(n)).map(function(t,n){return t+e[n%e.length]})},[0])}},f=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=a.A.apply(void 0,[e].concat(n));return i?i.length:0}},h=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var o=a.A.apply(void 0,[e].concat(r)),s=t;return o.map(s)}},d=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];if(!r[0])return t[0];var o=a.A.apply(void 0,[t].concat(r));return o[a.A.apply(void 0,[e].concat(r))%o.length]}},p=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=a.A.apply(void 0,[e].concat(n));return i?i.slice(1):[]}},v=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=a.A.apply(void 0,[e].concat(n));if(i)return i[0]}},m=function(e){var t=void 0,n=void 0;return function(){for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];var l=a.A.apply(void 0,[e].concat(c));if(l===n)return t;var f,h=[],d=o(l);try{for(d.s();!(f=d.n()).done;){var p=f.value;p=a.A.apply(void 0,[p].concat(c)),Array.isArray(p)?h=[].concat(Object(r.a)(h),Object(r.a)(p)):p&&(p.id&&(p.id=Object(i.uuid)()),h=[].concat(Object(r.a)(h),[p]))}}catch(v){d.e(v)}finally{d.f()}return t=h,n=l,h}},y=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var s=void 0,c=void 0;return function(){var e=[];if(s===t)return c;s=t;for(var n=arguments.length,u=new Array(n),l=0;l<n;l++)u[l]=arguments[l];var f,h=o(t);try{for(h.s();!(f=h.n()).done;){var d=f.value;d=a.A.apply(void 0,[d].concat(u)),Array.isArray(d)?e=[].concat(Object(r.a)(e),Object(r.a)(d)):(d.id&&(d.id=Object(i.uuid)()),e=[].concat(Object(r.a)(e),[d]))}}catch(p){h.e(p)}finally{h.f()}return c=e}},b=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var s=void 0,c=void 0;return function(){for(var e=arguments.length,n=new Array(e),u=0;u<e;u++)n[u]=arguments[u];var l=t.map(function(e){return a.A.apply(void 0,[e].concat(n))});if(s&&s.every(function(e,t){return e===l[t]}))return c;s=l;var f,h=[],d=o(l);try{for(d.s();!(f=d.n()).done;){var p=f.value;Array.isArray(p)?h=[].concat(Object(r.a)(h),Object(r.a)(p)):p&&(p.id&&(p.id=Object(i.uuid)()),h=[].concat(Object(r.a)(h),[p]))}}catch(v){d.e(v)}finally{d.f()}return c=h}},g=function(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var o=a.A.apply(void 0,[e].concat(n));return(o=Object(r.a)(o[0])).reverse(),[o]}},O=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=[],n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];var u,l=o(t);try{for(l.s();!(u=l.n()).done;){var f=u.value;(f=a.A.apply(void 0,[f].concat(s))).id&&(f.id=Object(i.uuid)()),e=[].concat(Object(r.a)(e),[f])}}catch(h){l.e(h)}finally{l.f()}return e}},j=function(e,t,n){return function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];var s=a.A.apply(void 0,[e].concat(i));if(s){var c=a.A.apply(void 0,[t].concat(i)),u=void 0;return n&&(u=a.A.apply(void 0,[n].concat(i))),[s[0].slice(c,Math.max(1,u%(s[0].length+1)))]}return 0}},k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];for(var s=a.A.apply(void 0,[e].concat(i)),c=(a.A.apply(void 0,[t].concat(i)),a.A.apply(void 0,[n].concat(i))),u=[s[0]],l=1;l<s.length;l++)l%t===c&&u.push(s[l]);return u}}},,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return f}),n.d(t,"d",function(){return h}),n.d(t,"c",function(){return d}),n.d(t,"e",function(){return v}),n.d(t,"b",function(){return m});var r=n(1),a=n(16),i=n(201),o=n(249),s=n(161),c=n(845);function u(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var f=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return e.apply(void 0,[t].concat(r))};Object(i.a)("random",{amount:"The degree of randomness"},"Randomizes the parameter values by ratio passed as an argument (0-1)");var h=function(e){var t=Object(o.b)();return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),u=1;u<r;u++)i[u-1]=arguments[u];n=Object(o.a)(t,n,i);var l={},f=s.a.apply(void 0,[e].concat(i));for(var h in n)if(n[h]){var d=n[h],p=d.x,v=d.y;l[h]={x:Object(c.a)(p,0,a.c,f),y:Object(c.a)(v,0,a.a,f),density:1}}return l}};Object(i.a)("part",{"...list":"List of functions that will each get a partition"},"Partitions the parameters, and executes different functions (the passed args) on each part");var d=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=p(e,t.length),a={},i=0,o=arguments.length,s=new Array(o>1?o-1:0),c=1;c<o;c++)s[c-1]=arguments[c];var l,f=u(n);try{for(f.s();!(l=f.n()).done;){var h=l.value;a=Object(r.a)({},a,t[i].apply(t,[h].concat(s))),i++}}catch(d){f.e(d)}finally{f.f()}return a}},p=function(e,t){for(var n=Object.keys(e),r=Math.floor(n.length/t),a=[],i=function(t){var i=n.slice(t*r,(t+1)*r),o={};i.forEach(function(t){return o[t]=e[t]}),a.push(o)},o=0;o<t;o++)i(o);return a};Object(i.a)("s",{"...list":"List of functions to execute"},"Executes the arguments sequentially, passing the transformed parameter values to each subsequent call");var v=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var i,o=u(t);try{for(o.s();!(i=o.n()).done;){e=i.value.apply(void 0,[e].concat(r))}}catch(s){o.e(s)}finally{o.f()}return e}};Object(i.a)("p",{"...list":"List of functions to execute in parallel"},"Executes the arguments in parallel, passing the transformed parameter values to each subsequent call");var m=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n={},a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];var s,c=u(t);try{for(c.s();!(s=c.n()).done;){var l=s.value;n=Object(r.a)({},n,l.apply(void 0,[e].concat(i)))}}catch(f){c.e(f)}finally{c.f()}return n}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){return{coords:e[0],speed:e[1],width:e[2],stepNumber:e[3],history:e[4],effect:e[6],group:e[7]}}},,function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(3),u=n.n(c);function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var f=function(e){Object(i.a)(n,e);var t=l(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){return this.props.condition?this.props.children:u.a.createElement("div",null)}}]),n}(c.Component);t.a=f},function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return s});var r=n(108),a=n(11),i=n(109),o=function(e,t){return function(n){var r=e(n);if(Array.isArray(r))return r;var i=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n=n.filter(function(e){return void 0!==e});for(var i=[],o=function(){var e=c[s];if(e&&e.model){var t=e.model;i.push(t)}else i.push(function(){return e})},s=0,c=[e].concat(Object(a.a)(n));s<c.length;s++)o();return i}.apply(void 0,[r.input].concat(Object(a.a)(r.args)));return r.model=function(e){var n=i.map(function(t){return t(e)});return t.apply(void 0,Object(a.a)(n))},r}};Object(i.a)("gl.model",{model:"",a:"",b:""},"",function(){return 1},{});var s=function(e,t,n){return function(e){var a=Object(r.a)(e,1)[0];if(a.model)return[a.model(t(),n())]}}},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(115),f=n(116),h=n(6),d=n.n(h),p=n(113);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(s.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Delay",function(){return new d.a.FeedbackDelay(new d.a.Time("16n"),.5)},e)).delayTime="16n",r.rateParameter=new p.a("Delay Rate",r.effectNode.delayTime,function(e,t){r.rawDelayRate=t,"number"===typeof t&&(t/=1e3),t._val&&(t="object"==typeof t._val?new d.a.Time(t._val._val):new d.a.Time(t._val)),r.effectNode.delayTime.linearRampToValueAtTime(new d.a.Time(t),.001)},{documentation:"The time between each individual echo",min:1e-4,max:1,unit:"",defaultValue:new d.a.Time("8n")}),r.rawDelayRate="8n",r.isSynced=!0,r.registerParameter(r.rateParameter),r.feedbackParameter=new p.b("Feedback",r.effectNode.feedback),r.registerParameter(r.feedbackParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"documentation",get:function(){return"A basic echo effect."}},{key:"rate",get:function(){return this.rateParameter.get(!0)},set:function(e){this.rateParameter.set(e)}},{key:"setFeedback",value:function(e){this.feedbackParameter.set(e)}},{key:"getFeedback",value:function(){return this.effectNode?this.effectNode.feedback.value:0}},{key:"onBPMUpdated",value:function(){this.isSynced&&this.rateParameter.set(this.rawDelayRate,!0)}},{key:"getDelayTime",value:function(){return this.delayTime}},{key:"getJson",value:function(){var e=this.rate;"object"===typeof e&&e.toSeconds&&(e=this.rate.toSeconds());var t=Object(r.a)({},Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),feedback:this.effectNode.feedback.value,isSynced:this.isSynced,rate:e,rawDelayRate:this.rawDelayRate});return t=this.saveParameterToJson(t,"feedbackParameter",this.feedbackParameter),t=this.saveParameterToJson(t,"rateParameter",this.rateParameter)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return"feedback"in e&&Object(f.a)(this.feedbackParameter,e.feedback,a),"delayTime"in e&&Object(f.a)(this.rateParameter,e.delayTime,a),"rate"in e&&Object(f.a)(this.rateParameter,e.rate,a),"rawDelayRate"in e&&(this.rawDelayRate=e.rawDelayRate),"isSynced"in e&&(this.isSynced=e.isSynced),Object(r.a)({},a,this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter,t),this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t))}}]),n}(l.a.Effect);t.a=m},function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return i});var r=12;function a(e){return Math.exp(1-1/Math.pow(e,1.01))}function i(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-200,o=e/n;if(o>=.75){var s=a*(1-Math.log(.75)/Math.log(.6));return s+=(a-s)*(o-.75)/.25}var c=a*(1-Math.log(o)/Math.log(.6));return isNaN(c)?i:c}window.q=.5,window.maxVolume=6},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"div",gen:function(){var e=r.getInputs(this),t="  var ".concat(this.name," = "),n=e[0],a=isNaN(n);return e.forEach(function(r,i){if(0!==i){var o=isNaN(r),s=i===e.length-1;t+=a||o?"".concat(n," / ").concat(r):n/=r,s||(t+=" / ")}}),t+="\n",r.memo[this.name]=this.name,[this.name,t]}};t.default=function(){for(var e=Object.create(a),t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Object.assign(e,{id:r.getUID(),inputs:n}),e.name=e.basename+e.id,e}},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(6),s=n.n(o),c=n(287),u=n(34),l=n(23),f=(n(127),n(358)),h=n(1968),d=(n(589),n(975)),p=n(199);n(141);function v(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"b",function(){return b}),n.d(t,"c",function(){return g}),n.d(t,"a",function(){return O}),n.d(t,"d",function(){return x});var y=["A","B","C","D"],b=function(e,t){return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return 48,n.t0=r,n.next=4,j({sequencerEngine:e,lenInBars:48,track:t,numPatterns:t.patterns.length,bounceType:"BOUNCE_INSTRUMENT",download:!1});case 4:n.t1=n.sent,(0,n.t0)(n.t1),e.subSequences.forEach(function(e){return e.mix.updateAllTypeRedux()});case 7:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())},g=function(e,t){return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var o,s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:for(s in o=0,t.patterns)o+=x(e,parseInt(s),[t])/32;return o*=e.state.freeze.loops,n.t0=r,n.next=6,j({sequencerEngine:e,lenInBars:o,track:t,numPatterns:t.patterns.length,bounceType:"BOUNCE_PATTERNS",download:!1});case 6:n.t1=n.sent,(0,n.t0)(n.t1),e.subSequences.forEach(function(e){return e.mix.updateAllTypeRedux()});case 9:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())},O=function(e,t){return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var o,s,c;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:for(c in o=0,s=t.slots.filter(function(e){return e}),console.log("bouncepad tracks = ",s),s[0].patterns)o+=x(e,parseInt(c),s)/32;return o*=e.state.freeze.loops,n.t0=r,n.next=8,j({sequencerEngine:e,lenInBars:o,pad:t.id,numPatterns:s[0].patterns.length,subSequence:e.currentSubSequence,bounceType:"BOUNCE_PATTERNS",download:!1,includeSends:!0,tracks:s});case 8:n.t1=n.sent,(0,n.t0)(n.t1),e.subSequences.forEach(function(e){return e.mix.updateAllTypeRedux()});case 11:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())},j=function(e){var t=e.title,n=e.sequencerEngine,r=e.lenInBars,o=void 0===r?4:r,c=e.subSequence,u=e.group,m=e.pad,b=e.numPatterns,g=e.send,O=e.download,j=void 0===O||O,x=e.track,T=e.bounceType,A=e.includeSends,M=void 0!==A&&A,R=e.tracks,C=e.uploadToIpfs;return new Promise(function(e){var r,O=o*new s.a.Time("1n").toMilliseconds()/1e3;n.stop(),s.a.Offline(function(e){(r=new h.default(n.store,!0,e,n.aubio,!0,!0)).isOffline=!0,console.log("offline",r),n.store.dispatch(Object(l.uc)(r)),window.sequencerEngine=r,n.store.dispatch(Object(l.Pb)(!0));var t=new d.a(r);for(var a in T||(r.mix=n.mix),r.setScripting(t),r.bpm=n.bpm,r.bpmParameter.id=n.bpmParameter.id,r.bpmParameter.min=n.bpmParameter.min,r.bpmParameter.max=n.bpmParameter.max,r.sends.copyFrom(n.sends),T||r.channelMixer.masterChannel.copyFrom(n.channelMixer.masterChannel),void 0!==g&&r.sends.sends.filter(function(e,t){return t!==g}).forEach(function(e){e.outputVolume.disconnect()}),void 0===u&&void 0===x||M||r.sends.sends.forEach(function(e){return e.outputVolume.disconnect()}),n.switchToSubSequence(n.subSequences[0].id),r.subSequences[0].id=n.subSequences[0].id,n.subSequences)if((!c||c.id===n.subSequences[a].id)&&(!x||n.subSequences[a].tracks.some(function(e){return e.id===x.id}))){if(a>0){var i=r.newSubSequence();i.id=n.subSequences[a].id,r.switchToSubSequence(i.id),n.switchToSubSequence(i.id)}r.currentSubSequence.midiEffects.fromJson(n.currentSubSequence.midiEffects.getJson()),r.lfos.forEach(function(e,t){return e.lfo.fromJson(n.lfos[t].lfo.getJson())}),r.envelopes.forEach(function(e,t){return e.fromJson(n.envelopes[t].getJson())}),"BOUNCE_PATTERNS"===T?S(n,b,r.currentSubSequence.mix,u||m?R:[x]):"BOUNCE_INSTRUMENT"===T?E(n,b,r.currentSubSequence.mix,u?R:[x]):r.currentSubSequence.mix=n.currentSubSequence.mix;var o=n.groups;for(var s in o.groups){var f=o.groups[s];if(void 0!==g&&f.tracks.every(function(e){return e.sendNodeVolumeParameters[g].get()<=-80&&Object.values(e.sendNodeVolumeParameters[g]).every(function(e){return e<=-80})}),void 0===u||s===u||!f.tracks.every(function(e){return 0===e.connectedEnvelopes.length})){var p=r.groups.newGroup();if(p.setVolume(f.volume),p.setPanning(f.panning),void 0===x||f===x.group||!f.tracks.every(function(e){return 0===e.connectedEnvelopes.length})){var y=f.effectsChain.effects.map(function(e){return e.getEffectCopy(r,!1)});for(var O in p.effectsChain.updateEffects(y),f.tracks){var j=f.tracks[O].getCopy(void 0,r,!1);!m||f.tracks[O].pad&&f.tracks[O].pad.id===m?x&&f.tracks[O]!==x&&0==f.tracks[O].connectedEnvelopes.length||(console.log("ADDING TRACK TO BOUNCE ENGINE =",j),r.setupNewTrack(j,void 0,void 0,!1,!0),j.setupEffects(),p.addTrack(j),j.trackNumber=f.tracks[O].trackNumber,x&&f.tracks[O]!==x&&j.gainNode.disconnect(),"BOUNCE_INSTRUMENT"===T&&P(j)):(console.log("BOUNCE PAD NOT MATCH"),console.log("track.pad=",f.tracks[O].pad,m))}void 0!==g&&p.outputNode.disconnect(),void 0!==u&&(r.currentSubSequence.id===c.id&&u===s||p.outputNode.disconnect())}}}r.tracks.sort(function(e,t){return e.trackNumber-t.trackNumber}),r.currentSubSequence.loadPadsJson(n.currentSubSequence.getPadsJson())}r.loadInletConnections(n.state.windows.inletConnections),r.higherOrderSequencer.fromJson(n.higherOrderSequencer.getJson());var k,w=v(r.subSequences);try{for(w.s();!(k=w.n()).done;){k.value.loadLostParameters(!0)}}catch(A){w.e(A)}finally{w.f()}console.log("PLAYING"),r.loadNewSequence(),r.play()},O).then(function(){var o=Object(i.a)(a.a.mark(function i(o){var s,h;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(new p.a(2,function(t,n,a){e(r),window.open("http://zequencer.io:8080/ipfs/"+n,"_blank")}),s="Exported Song.wav",void 0!==g&&(s="Send "+y[g]+".wav"),void 0!==u&&(s="Group "+(parseInt(u)+1)+" ("+c.name+").wav"),t&&(s=t+" "+s),!C){a.next=10;break}return a.next=8,w(o);case 8:a.next=16;break;case 10:if(!j){a.next=16;break}return h=[o.getChannelData(0),o.getChannelData(1)],a.next=14,Object(f.a)(h);case 14:h=a.sent,k(h,s);case 16:n.store.dispatch(Object(l.Pb)(!1)),r.stop(),window.sequencerEngine=n,n.store.dispatch(Object(l.uc)(void 0)),r.dispose(),n.updateSteps(),e(o);case 23:case"end":return a.stop()}},i)}));return function(e){return o.apply(this,arguments)}}())})},k=function(){var e=document.createElement("a");return document.body.appendChild(e),e.style="display: none",function(t,n){var r=new Blob([t],{type:"audio/wav"}),a=window.URL.createObjectURL(r);e.href=a,e.download=n,e.click(),window.URL.revokeObjectURL(a)}}(),w=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new p.a(2,function(e,t,n){return[]}),e.next=3,n.uploadBufferToIpfs(t);case 3:r=e.sent,window.exportIpfsHash=r;case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),x=function(e,t,n){var r,a=-10,i=v(n);try{for(i.s();!(r=i.n()).done;){var o,s=v(r.value.patterns);try{for(s.s();!(o=s.n()).done;){var c=o.value.length();c>a&&(a=c)}}catch(u){s.e(u)}finally{s.f()}}}catch(u){i.e(u)}finally{i.f()}return a},S=function(e,t,n,r){for(var a=e.state.freeze.loops,i=0,o=0;o<t;o++){var s=x(e,o,r)*a,l=new u.a(o);l.step=i,n.dispatch(Object(c.f)(l,s)),i+=s}},P=function(e){var t=e.pattern;t.doubleTrackLength(),e.patterns=[];for(var n=0;n<24;n++){var r=t.getCopy();r.clear(),r.addNote(0,16,3*n-12),e.patterns.push(r)}e.pattern=e.patterns[0]},E=function(e,t,n,r){e.state.freeze.loops;for(var a=0,i=0;i<32;i++){var o=new u.a(i);o.step=a,n.dispatch(Object(c.f)(o,64)),a+=64}}},function(e,t,n){"use strict";var r=n(444),a=n(449),i=n(624),o=n(450),s=n(625),c=n(627),u=n(628),l=n(629),f=n(986),h=n(452),d=n(631),p=n(453),v=n(633),m=n(381),y=n(455),b=n(636),g=n(637),O=n(321),j=n(320),k=n(638),w=n(639),x=n(640),S=n(641),P=n(642),E=n(643),T=n(644),A=n(645),M=n(646),R=n(647),C=n(648),N=n(649),I=n(650),q=n(606),_=n(844),D=n(987),F=n(319),L=n(861),B=n(862),z=n(863),J=n(864),V=n(865),H=n(866),U=n(988),G=n(867),W=n(607),K=n(978),Q=n(322),Z=n(1),Y=n(4),$=n(5),X=n(10),ee=n(7),te=n(8),ne=n(2),re=n(139),ae=n(6);function ie(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return oe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return oe(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function se(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(ne.a)(e);if(t){var a=Object(ne.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(te.a)(this,n)}}var ce=new(n.n(ae).a.Time)("32n"),ue=function(e){Object(ee.a)(n,e);var t=se(n);function n(e){var r;return Object(Y.a)(this,n),(r=t.call(this,"Split",e)).numberOfOutputs=2,r}return Object($.a)(n,[{key:"value",get:function(){return this.numberOfOutputs},set:function(e){e>0&&(this.numberOfOutputs=e)}},{key:"getText",value:function(){return this.numberOfOutputs}},{key:"getJson",value:function(){return Object(Z.a)({},Object(X.a)(Object(ne.a)(n.prototype),"getJson",this).call(this),{numberOfOutputs:this.numberOfOutputs})}},{key:"fromJson",value:function(e){Object(X.a)(Object(ne.a)(n.prototype),"fromJson",this).call(this,e),e.numberOfOutputs&&(this.numberOfOutputs=e.numberOfOutputs)}},{key:"output",value:function(e,t){var n,r=[],a=ie(this.triggers);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=i.stepData,s=i.time,c=o.duration;o.duration=c/this.numberOfOutputs,r.push(i);for(var u=1;u<this.numberOfOutputs;u++){var l=this.copyTrigger(i);s+=ce*(c/(this.numberOfOutputs/2)),l.time=s,l.outputNumber=u,r.push(l)}}}catch(f){a.e(f)}finally{a.f()}return r}}]),n}(re.a),le=function(e){Object(ee.a)(n,e);var t=se(n);function n(e){var r;return Object(Y.a)(this,n),(r=t.call(this,"Flat",e)).value=1,r}return Object($.a)(n,[{key:"output",value:function(){var e=this,t=this.triggers||[];this.active=t.length>0;var n,r=ie(t);try{for(r.s();!(n=r.n()).done;){n.value.stepData.voices.forEach(function(t){return t.flat=e.value})}}catch(a){r.e(a)}finally{r.f()}return t}}]),n}(Q.g),fe=function(e){Object(ee.a)(n,e);var t=se(n);function n(e){var r;return Object(Y.a)(this,n),(r=t.call(this,"Thick",e)).value=1,r}return Object($.a)(n,[{key:"output",value:function(){var e=this,t=this.triggers||[];this.active=t.length>0;var n,r=ie(t);try{for(r.s();!(n=r.n()).done;){n.value.stepData.voices.forEach(function(t){return t.thick=e.value})}}catch(a){r.e(a)}finally{r.f()}return t}}]),n}(Q.g),he=n(551);n.d(t,"b",function(){return de}),n.d(t,"a",function(){return pe});var de={Accumulator:function(e){return new l.a(e)},Arpeggiator:function(e){return new r.a(e)},Beat:function(e){return new N.a(e)},"Control Parameters":function(e){return new _.a(e)},"Conditional Parameters":function(e){return new D.a(e)},"Plane Parameters":function(e){return new F.a(e)},Every:function(e){return new x.a(e)},Limit:function(e){return new w.a(e)},Parameterizer:function(e){return new a.a(e)},"Max Parameter":function(e){return new i.a(e)},Timing:function(e){return new o.a(e)},"Midi Outputter":function(e){return new f.a(e)},"Midi CC":function(e){return new S.a(e)},"Midi Interface":function(e){return new p.a(e)},Harmony:function(e){return new y.a(e)},"Alternate Tuning":function(e){return new g.a(e)},"Micro Tuning":function(e){return new b.a(e)},"Midi Delay":function(e){return new v.a(e)},"Chord Rhythm":function(e){return new h.a(e)},"Chord Sculptor":function(e){return new d.a(e)},Warp:function(e){return new O.a(e)},Tidal:function(e){return new j.a(e)},"Linked Tidal":function(e){return new k.a(e)},"Midi Effect Rack":function(e){return new m.a(e)},"Beat Repeat":function(e){return new T.a(e)},"Pattern Switch":function(e){return new B.a(e)},Steps:function(e){return new P.a(e)},Notes:function(e){return new E.a(e)},Grab:function(e){return new A.a(e)},"Grab Time":function(e){return new M.a(e)},Alternate:function(e){return new R.a(e)},Scale:function(e){return new L.a(e)},Flush:function(e){return new s.a(e)},Message:function(e){return new c.a(e)},"User Script":function(e){return new q.a(e)},Threshold:function(e){return new I.a(e)},Roll:function(e){return new V.a(e)},"Alternate N":function(e){return new C.a(e)},Density:function(e){return new J.a(e)},Poly:function(e){return new z.a(e)},"Note Display":function(e){return new u.a(e)},Sparse:function(e){return new G.a(e)},"Midi Gate":function(e){return new H.a(e)},Stats:function(e){return new U.a(e)},Jaki:function(e){return new W.a(e)},Figure:function(e){return new he.g(e)},Max:function(e){return new he.m(e)},First:function(e){return new he.h(e)},Last:function(e){return new he.j(e)},"Dash 1":function(e){return new he.c(e)},"Dash 2":function(e){return new he.d(e)},Dot:function(e){return new he.e(e)},Accent:function(e){return new he.a(e)},Staccato:function(e){return new he.u(e)},Piano:function(e){return new he.p(e)},Pianissimo:function(e){return new he.o(e)},Rest:function(e){return new he.s(e)},Otherwise:function(e){return new he.n(e)},Legato:function(e){return new he.l(e)},"R.Every":function(e){return new he.q(e)},Double:function(e){return new he.f(e)},Later:function(e){return new he.k(e)},Skip:function(e){return new he.t(e)},Any:function(e){return new he.b(e)},Times:function(e){return new he.v(e)},Flam:function(e){return new he.i(e)},Regular:function(e){return new he.r(e)},"Chord Type":function(e){return new Q.b(e)},"Generative Chords":function(e){return new K.a(e)},Voice:function(e){return new Q.f(e)},Octave:function(e){return new Q.c(e)},Split:function(e){return new ue(e)},Flat:function(e){return new le(e)},Thick:function(e){return new fe(e)}};function pe(e,t){if(e.name in de)return de[e.name](t)}},function(e,t,n){"use strict";n.d(t,"f",function(){return a}),n.d(t,"b",function(){return i}),n.d(t,"a",function(){return o}),n.d(t,"h",function(){return s}),n.d(t,"c",function(){return c}),n.d(t,"e",function(){return u}),n.d(t,"g",function(){return l}),n.d(t,"d",function(){return f});var r=n(620),a=function(e,t){return{type:r.h,payload:{event:e,duration:t}}},i=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:r.b,payload:{event:e,inPlace:t}}},o=function(e,t){return{type:r.a,payload:{event:e,subEvent:t}}},s=function(e,t,n,a){return{type:r.m,payload:{step:e,selection:t,eventType:n,track:a}}},c=function(e){return{type:r.c,payload:{selection:e}}},u=function(e,t){return{type:r.e,payload:{selection:e,eventType:t}}},l=function(e,t,n){return{type:r.l,payload:{track:e,pattern:t,step:n}}},f=function(e,t){return{type:r.d,payload:{track:e,pattern:t}}}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(14);function u(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=f(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"initDisabledParameters",value:function(){var e=this;this.parametersDisabledParameter=new c.a("parametersDisabled",this,function(t,n){return e.parametersDisabledChanged(n)},{defaultValue:[]}),this.registerParameter(this.parametersDisabledParameter)}},{key:"parametersDisabled",get:function(){return this.parametersDisabledParameter.get(!0)}},{key:"parametersDisabledChanged",value:function(e){var t,n={},r=u(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=this.initialParameterValues[a];if(void 0!==i&&this._parameters[a])n[this._parameters[a].set(i,!0,!0,void 0,this.rampTime/1e3).id]=i}}catch(o){r.e(o)}finally{r.f()}this.setEffectParameterValues(n)}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"c",function(){return u}),n.d(t,"a",function(){return l}),n.d(t,"b",function(){return f}),n.d(t,"d",function(){return h});var r=n(11),a=n(1),i=n(114),o=n(151),s=function(e){return e.length},c=function(e){return e[s(e)-1]},u=function(e,t){var n=[];return function(o,u,l){if(function(e,t,n){return c(e)&&t-c(e).stepNumber===Math.floor(n)}(n,u,Object(i.A)(t))){var f=void 0===o?Object(a.a)({},c(n),{stepNumber:u,time:l}):{stepData:o,stepNumber:u,time:l},h=void 0===o?Object(i.R)(f):Object(i.w)(!0);return n=void 0!==o?[f]:[].concat(Object(r.a)(n),[f]),s(n)>Object(i.A)(e)&&(n=[]),h}return void 0!==o?(n=[{stepData:o,stepNumber:u,time:l}],Object(i.w)(!0)):Object(i.w)(!1)}};Object(o.a)("beat",{step:"The step within the beat at which this executes the ifCond condition",beat:"The total number of steps within which we determine if the step has occured",ifCond:"The condition that is executed when the step is reached",elseCond:"The condition that is executed otherwise"},"Conditions on a certain step within a beat. For example, beat(0,32,a,b) executes a on the 1st beat of every bar, and executes b on every other step");var l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return function(a,o,s){var c=[a,o,s];return o%i.A.apply(void 0,[t].concat(c))===i.A.apply(void 0,[e].concat(c))?i.A.apply(void 0,[n].concat(c)):r?i.A.apply(void 0,[r].concat(c)):Object(i.w)(!0)}};Object(o.a)("gate",{stepsLists:"An array where each element is a number from 0-1 determing the probability that we allow a trigger occuring at that step to pass through"},"Control which steps are triggered within a beat, probabilistically. gate([1, 1]) allows every trigger to occur.");var f=function(e){return function(t,n,r){var a=Object(i.A)(e,t,n,r);"number"===typeof a&&(a=d(a));var o=Object(i.A)(a[Math.floor(n/2)%a.length],t,n,r);return Math.random()<o?Object(i.w)(!0):Object(i.w)(!1)}};Object(o.a)("shift",{list:"The list that we wish to shift",shiftNumber:"The number of indices to shift by"},"Shifts a list by a number of indices, on each trigger");var h=function(e){var t,n,a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(){for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];c[0],c[1],c[2];var l=i.A.apply(void 0,[o].concat(c)),f=i.A.apply(void 0,[e].concat(c));if(void 0!==l&&"FILTER"!==l.axiom||(l=0),t===f&&n===l)return a;t=f,n=l,l=Math.round(l);if(0===f.length)return f;f=Object(r.a)(f);for(var h=0;h<l;h++){var d=f.shift();f.push(d)}return a=f}},d=function(e){for(var t=[];e>0;)t.push(e%2),e=Math.floor(e/2);for(;t.length<16;)t.push(0);return t}},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return s});var r=n(114),a=n(151);Object(a.a)("and",{a:"Argument 1",b:"Argument 2"},"Returns true if a && b");Object(a.a)("eq",{a:"Argument 1",b:"Argument 2"},"Returns true if a >= b");var i=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var o=r.A.apply(void 0,[e].concat(a)),s=r.A.apply(void 0,[t].concat(a));return Object(r.w)(o===s)}};Object(a.a)("gte",{a:"Argument 1",b:"Argument 2"},"Returns true if a >= b");var o=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var o=r.A.apply(void 0,[e].concat(a)),s=r.A.apply(void 0,[t].concat(a));return Object(r.w)(o>=s)}};Object(a.a)("lte",{a:"Argument 1",b:"Argument 2"},"Returns true if a <= b");var s=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return Object(r.w)(r.A.apply(void 0,[e].concat(a))<=r.A.apply(void 0,[t].concat(a)))}}},function(e,t,n){"use strict";n.d(t,"d",function(){return p}),n.d(t,"c",function(){return v}),n.d(t,"b",function(){return y}),n.d(t,"a",function(){return b});var r=n(42),a=n.n(r),i=n(56),o=n(122),s=n(162),c=n(153),u=n(149),l=n(157),f=n(119),h=n(828),d=n(142),p=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.addJson(t);case 2:return i=e.sent,e.next=5,new l.a(u.p,"newScript",[Object(c.b)(i),s.a.utils.fromAscii(n),s.a.utils.fromAscii(r)]).execute();case 5:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),v=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new d.a((new h.a).contractAddress).select("scriptHash").select("scriptType").select("title").where("scriptType",t).from(f.D),e.next=3,n.executeQuery();case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),m={},y=function(e){return e in m?m[e]:(b(e),"")},b=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in m)){e.next=2;break}return e.abrupt("return",m[t]);case 2:return n=new d.a((new h.a).contractAddress).select("scriptHash").from(f.D).where("title",t),e.next=5,n.executeQuery();case 5:if(!(r=e.sent)[0]){e.next=12;break}return e.next=9,o.a.getJson(r[0].scriptHash);case 9:return i=e.sent,m[t]=i,e.abrupt("return",i);case 12:return e.abrupt("return",void 0);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();window.getScripts=v,window.getScriptForTitle=b},,,,,,,,,,function(e,t,n){"use strict";n.d(t,"b",function(){return f}),n.d(t,"a",function(){return h});var r=n(42),a=n.n(r),i=n(56),o=n(373),s=n(6),c=n.n(s),u=n(309),l={},f=function(e,t){return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,f;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!l[t]){n.next=2;break}return n.abrupt("return",r(l[t]));case 2:if(void 0!==e){n.next=5;break}return i(),n.abrupt("return");case 5:if(n.prev=5,n.prev=6,"RIFF"!==(new TextDecoder).decode(e.slice(0,4))){n.next=16;break}return n.next=11,c.a.Master.context.decodeAudioData(u(e));case 11:s=n.sent,t&&(l[t]=s),r(s),n.next=21;break;case 16:return n.next=18,Object(o.b)(e,t);case 18:f=n.sent,t&&(l[t]=f),r(f);case 21:n.next=26;break;case 23:n.prev=23,n.t0=n.catch(6),i(n.t0);case 26:n.next=31;break;case 28:n.prev=28,n.t1=n.catch(5),i(n.t1);case 31:case"end":return n.stop()}},n,null,[[5,28],[6,23]])}));return function(e,t){return n.apply(this,arguments)}}())},h=function(){l={}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r="NOT_UPLOADED_YET"},,,,,function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32[16]",name:"sampleHashes",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"titles",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"youtubeVideoIds",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"coverArtHashes",type:"bytes32[16]"},{internalType:"uint256[16]",name:"discogIds",type:"uint256[16]"},{internalType:"bytes32[4][16]",name:"tagsToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[4][16]",name:"stylesToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[16]",name:"countries",type:"bytes32[16]"},{internalType:"int16[16]",name:"sampleYears",type:"int16[16]"},{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"newEncryptedSamples",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32[16]",name:"sampleHashes",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"titles",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"youtubeVideoIds",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"coverArtHashes",type:"bytes32[16]"},{internalType:"uint256[16]",name:"discogIds",type:"uint256[16]"},{internalType:"bytes32[4][16]",name:"tagsToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[4][16]",name:"stylesToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[16]",name:"countries",type:"bytes32[16]"},{internalType:"int16[16]",name:"sampleYears",type:"int16[16]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newSamplesWithMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"bytes32",name:"youtubeVideoId",type:"bytes32"},{internalType:"bytes32[4]",name:"tagsToAdd",type:"bytes32[4]"},{internalType:"bytes32[4]",name:"stylesToAdd",type:"bytes32[4]"},{internalType:"bytes32",name:"country",type:"bytes32"},{internalType:"int16",name:"year",type:"int16"},{internalType:"uint256",name:"discogsId",type:"uint256"},{internalType:"bytes32",name:"coverArtHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newSampleWithMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"country",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleCountry",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32[4]",name:"stylesToAdd",type:"bytes32[4]"},{internalType:"bytes32",name:"country",type:"bytes32"},{internalType:"int16",name:"year",type:"int16"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleDiscogsMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"style",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleStyle",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"tag",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleTag",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32[4]",name:"tagsToAdd",type:"bytes32[4]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleTags",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"int16",name:"year",type:"int16"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleYear",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"youtubeVideoId",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleYoutubeVideoId",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"},{internalType:"address",name:"encryptionAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"youtubeVideoId",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampledYoutube",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"tag",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleTagged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"style",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleStyle",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"int16",name:"year",type:"int16"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleYear",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"country",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleCountry",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"discogsId",type:"uint256"},{indexed:!0,internalType:"bytes32",name:"coverArtHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"NewDiscogsSample",type:"event"}],this.contractAddress="0xc77d4e72dF7D0Bf96488eF543253af537fEb8737"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"bytes32",name:"annotationType",type:"bytes32"},{internalType:"bytes32",name:"data",type:"bytes32"},{internalType:"bytes32",name:"annotationData",type:"bytes32"}],name:"newAnnotation",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"annotationType",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"data",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"annotationData",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"}],name:"NewAnnotation",type:"event"},{inputs:[{internalType:"bytes32",name:"annotationType",type:"bytes32"},{internalType:"bytes32",name:"data",type:"bytes32"},{internalType:"bytes32[]",name:"annotationData",type:"bytes32[]"}],name:"newAnnotations",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"annotationType",type:"bytes32"},{internalType:"string",name:"description",type:"string"}],name:"newAnnotationType",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"annotationType",type:"bytes32"},{indexed:!1,internalType:"string",name:"description",type:"string"}],name:"NewAnnotationType",type:"event"},{inputs:[{internalType:"bytes32",name:"dataType",type:"bytes32"},{internalType:"string",name:"description",type:"string"}],name:"newDataType",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"dataType",type:"bytes32"},{indexed:!1,internalType:"string",name:"description",type:"string"}],name:"NewDataType",type:"event"},{inputs:[{internalType:"bytes32",name:"linkType",type:"bytes32"},{internalType:"bytes32",name:"fromData",type:"bytes32"},{internalType:"bytes32",name:"toData",type:"bytes32"}],name:"newLink",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"linkType",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"fromData",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"toData",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"NewLink",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"linkType",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"fromData",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"NewLinkRoot",type:"event"},{inputs:[{internalType:"bytes32",name:"linkType",type:"bytes32"},{internalType:"bytes32",name:"fromData",type:"bytes32"},{internalType:"bytes32[]",name:"toData",type:"bytes32[]"}],name:"newLinks",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"linkType",type:"bytes32"},{internalType:"string",name:"description",type:"string"}],name:"newLinkType",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"linkType",type:"bytes32"},{indexed:!1,internalType:"string",name:"description",type:"string"}],name:"NewLinkType",type:"event"}],this.contractAddress="0x305306F68D9C230B59d5B6869AEd1723365C9290"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},,function(e,t,n){"use strict";n.d(t,"b",function(){return s}),n.d(t,"a",function(){return u});n(11);var r=Math.pow(2,-32),a=32557,i=new Uint16Array(4),o=new DataView(i.buffer),s=function(){var e=i[0],t=i[1],n=i[2],o=i[3],s=33103+a*e|0,c=63335+a*t+(19605*e+(s>>>16))|0,u=31614+a*n+19605*t+(62509*e+(c>>>16))|0,l=5125+a*o+(19605*n+62509*t)+(22609*e+(u>>>16));i[0]=s,i[1]=c,i[2]=u,i[3]=l;var f=(o<<21)+((o>>2^n)<<5)+((n>>2^t)>>11);return r*((f>>>(o>>11)|f<<(31&-(o>>11)))>>>0)},c=function(e){for(var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=16,a=1540483477,i=e.length,o=n^i,s=0;i>=4;)t=(65535&(t=255&e[s]|(255&e[++s])<<8|(255&e[++s])<<16|(255&e[++s])<<24))*a+(((t>>>r)*a&65535)<<r),o=(65535&o)*a+(((o>>>r)*a&65535)<<r)^(t=(65535&(t^=t>>>24))*a+(((t>>>r)*a&65535)<<r)),i-=4,++s;switch(i){case 3:o^=(255&e[s+2])<<r;case 2:o^=(255&e[s+1])<<8;case 1:o=(65535&(o^=255&e[s]))*a+(((o>>>r)*a&65535)<<r)}return o=(65535&(o^=o>>>13))*a+(((o>>>r)*a&65535)<<r),(o^=o>>>15)>>>0},u=function(e){!1,null;for(var t=~~((e.length-2)/2),n=[],r=0;r<t;r++){var a=2+2*r;n.push(parseInt(e.slice(a,a+2),16))}var i=c(n,1690382925),s=c(n,72970470);o.setUint32(0,i),o.setUint32(4,s)}},function(e,t,n){"use strict";n.d(t,"c",function(){return o}),n.d(t,"a",function(){return s}),n.d(t,"b",function(){return c});var r=n(11),a=n(200),i=function(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))},o=function(e,t){return i(e.x,e.y,t.x,t.y)},s=function(e){var t=Object(a.f)(e);return e.sort(u),function(e,t,n){if(e.length<=3)return e;var a=window.api.create_geometry_buffer(e.length),i=window.api.create_geometry_buffer(e.length);window.Module.HEAPF32.set(e,a/e.BYTES_PER_ELEMENT),window.api.getConvexHullFlat(a,e.length,i,t.x,t.y,n);for(var o=new Uint32Array(window.Module.HEAP32.buffer,i,3*e.length+1),s=o[0],c=[],u=0;u<s;u++){var l=o[2*u+1],f=o[2*u+2];c.push({x:l,y:f})}window.api.destroy_buffer(i),window.api.destroy_buffer(a);var h=c.slice(1,c.length);return h.reverse(),[c[0]].concat(Object(r.a)(h)).flatMap(function(e){return[e.x,e.y]})}(e,t,12)};function c(e,t,n){var a=e.slice();a.sort(u);var i=function(e,t,n){if(e.length<=3)return e;var a=window.api.create_geometry_buffer(e.length),i=window.api.create_geometry_buffer(e.length),o=window.api.create_geometry_buffer(3*e.length+1),s=new Uint32Array(e.map(function(e){var t=e.x;e.y;return t})),c=new Uint32Array(e.map(function(e){e.x;var t=e.y;return t}));window.Module.HEAP32.set(s,a/s.BYTES_PER_ELEMENT),window.Module.HEAP32.set(c,i/c.BYTES_PER_ELEMENT),window.api.getConvexHull(a,i,e.length,o,t.x,t.y,n);for(var u=new Uint32Array(window.Module.HEAP32.buffer,o,3*e.length+1),l=u[0],f=[],h=0;h<l;h++){var d=u[2*h+1],p=u[2*h+2];f.push({x:d,y:p})}window.api.destroy_buffer(o),window.api.destroy_buffer(a),window.api.destroy_buffer(i);var v=f.slice(1,f.length);return v.reverse(),[f[0]].concat(Object(r.a)(v))}(a,t,n);return i}function u(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}},,,function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){return{code:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",uniforms:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},variables:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},functions:arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},closure:arguments.length>4&&void 0!==arguments[4]?arguments[4]:{}}}},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(11),s=n(4),c=n(5),u=n(141),l=n(127),f=(n(212),n(946)),h=n(435),d=n(20),p=function(){function e(t,n){Object(s.a)(this,e),this.id=Object(d.uuid)(),this.sample=t,this.sequencerEngine=n,this.searcher=new h.a(n.ethereumCache,n),this.nextSounds=[],this.previousSounds=[],this.counter=0,this._tagSounds=void 0,this.filterFavorites=!1}return Object(c.a)(e,[{key:"length",get:function(){return this._sounds&&this._sounds.length}},{key:"sounds",get:function(){return this._tagSounds||this._sounds},set:function(e){this._sounds=e}},{key:"tagSounds",set:function(e){this.nextSounds=[],this.previousSounds=[],this._tagSounds=e}},{key:"getCopy",value:function(){var t=new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sample,this.sequencerEngine);return t.searcher=this.searcher,this.sounds&&(t.sounds=Object(o.a)(this.sounds)),t.tags=this.tags,t.initBuffers(),t}},{key:"fetch",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sample&&this.sample.tags){e.next=2;break}return e.abrupt("return");case 2:return t=this.sample.tags,e.next=5,l.a.getGuildsWithAccess();case 5:return n=e.sent,e.next=8,Object(f.a)(t,n);case 8:r=e.sent,this.sounds=r,this.tags=t;case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"hasNext",value:function(){return void 0===this.sounds||this.nextSounds.length>0}},{key:"hasPrevious",value:function(){return void 0===this.sounds||this.previousSounds.length>0}},{key:"dispose",value:function(){this.nextSounds&&this.nextSounds.forEach(function(e){return e.dispose(!0)}),this.previousSounds&&this.previousSounds.forEach(function(e){return e.dispose(!0)}),this.sounds=void 0,this.nextSounds=void 0,this.previousSounds=void 0,this.sample&&(this.sample.dispose(!0),this.sample=void 0),this.searcher=void 0}},{key:"search",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.sample.tags,this.tags=t,this.searcher.selectedTags=t,e.next=5,Object(f.a)(t);case 5:this.sounds=e.sent.slice(1),this.counter=0,this.initBuffers();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"initBuffers",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sounds&&void 0!==this.nextSounds){e.next=2;break}return e.abrupt("return");case 2:this.loading=!0,this.sounds.length,t=0;case 5:if(!(this.nextSounds.length<1)){e.next=25;break}return e.prev=6,e.next=9,this.loadNextForInitialBuffer(t);case 9:n=e.sent,r=n.next,i=n.previous,this.nextSounds.push(r),this.previousSounds.push(i),e.next=20;break;case 16:if(e.prev=16,e.t0=e.catch(6),!(t>=12)){e.next=20;break}return e.abrupt("break",25);case 20:if(t++,void 0!==this.nextSounds){e.next=23;break}return e.abrupt("break",25);case 23:e.next=5;break;case 25:this.loading=!1;case 26:case"end":return e.stop()}},e,this,[[6,16]])}));return function(){return e.apply(this,arguments)}}()},{key:"loadNextForInitialBuffer",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var o,s,c,l,f;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return setTimeout(function(){i()},7e3),n.prev=1,o=t.sounds.length,s=(t.counter+e)%o,c=t.sounds[s],l=new u.a(c),n.next=8,l.load();case 8:return s=((t.counter-e-1)%o+o)%o,c=t.sounds[s],f=new u.a(c),n.next=13,f.load().catch(i);case 13:r({next:l,previous:f}),n.next=19;break;case 16:n.prev=16,n.t0=n.catch(1),i();case 19:case"end":return n.stop()}},n,null,[[1,16]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){return n()},e);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getNext",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sounds){e.next=3;break}return e.next=3,this.search();case 3:if(!this.loading){e.next=8;break}return e.next=6,this.sleep(50);case 6:e.next=3;break;case 8:return t=this.nextSounds.shift(),setTimeout(function(){n.loadNext(t)},100),e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPrevious",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sounds){e.next=3;break}return e.next=3,this.search();case 3:if(!this.loading){e.next=8;break}return e.next=6,this.sleep(50);case 6:e.next=3;break;case 8:return t=this.previousSounds.shift(),this.loadPrevious(t),e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"seek",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.counter=t,e.next=3,this.loadNextAvailableSample();case 3:return n=e.sent,this.nextSounds=[n],e.next=7,this.getNext();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadNext",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,c=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!1,setTimeout(function(){n||(c.loading=!1)},7e3),this.loading=!0,(r=this.previousSounds.pop())&&r.dispose(!0),this.previousSounds=[this.sample].concat(Object(o.a)(this.previousSounds)),this.sample=t,!0,i=void 0,s=0;case 10:if(void 0!==i){e.next=26;break}return e.prev=11,e.next=14,this.loadNextAvailableSample();case 14:i=e.sent,e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(11),!(s>=12)){e.next=23;break}return this.loading=!1,n=!0,e.abrupt("return");case 23:s++,e.next=10;break;case 26:this.nextSounds.push(i),this.loading=!1,n=!0;case 29:case"end":return e.stop()}},e,this,[[11,17]])}));return function(t){return e.apply(this,arguments)}}()},{key:"loadNextAvailableSample",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){var i,o,s;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.counter=(e.counter+1)%e.sounds.length,i=(e.counter+1)%e.sounds.length,o=e.sounds[i],s=new u.a(o),setTimeout(function(){r()},7e3),t.prev=5,t.next=8,s.load();case 8:n(s),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),r();case 14:case"end":return t.stop()}},t,null,[[5,11]])}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"loadPrevious",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,(n=this.nextSounds.pop())&&n.dispose(!0),this.nextSounds=[this.sample].concat(Object(o.a)(this.nextSounds)),this.sample=t,this.counter=this.mod(this.counter-1,this.sounds.length),r=this.mod(this.counter-1,this.sounds.length),i=this.sounds[r],s=new u.a(i),e.next=11,s.load();case 11:this.previousSounds.push(s),this.loading=!1;case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mod",value:function(e,t){return(e%t+t)%t}}]),e}();t.a=p},function(e,t,n){"use strict";function r(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=r.createBuffer(e.numberOfChannels,a+n-t+1,r.sampleRate),o=i.getChannelData(0),s=e.getChannelData(0).subarray(t,n);if(o.set(s,a),e.numberOfChannels>1){var c=i.getChannelData(1),u=e.getChannelData(1).subarray(t,n);c.set(u,a)}return i}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";n.r(t);var r=n(108);function a(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=n(1877).default,s=n(112).default,c=(n(202).default,{ctx:null,buffers:{},isStereo:!1,setContext:function(e,t){this.ctx=e,s.samplerate=this.ctx.sampleRate;var n=c.ctx.createBufferSource();return n.connect(c.ctx.destination),n.start(),this},clear:function(){void 0!==this.workletNode?this.workletNode.disconnect():this.callback=function(){return 0},this.clear.callbacks.forEach(function(e){return e()}),this.clear.callbacks.length=0,this.isStereo=!1,null!==s.graph&&s.free(s.graph)},createContext:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;o(window,t),this.ctx=e,s.samplerate=this.ctx.sampleRate;var n=c.ctx.createBufferSource();return n.connect(c.ctx.destination),n.start(),this},createScriptProcessor:function(){return this.node=this.ctx.createScriptProcessor(1024,0,2),this.clearFunction=function(){return 0},"undefined"===typeof this.callback&&(this.callback=this.clearFunction),this.node.onaudioprocess=function(e){for(var t=e.outputBuffer,n=t.getChannelData(0),r=t.getChannelData(1),a=c.isStereo,i=0;i<n.length;i++){var o=c.callback();!1===a?n[i]=r[i]=o:(n[i]=o[0],r[i]=o[1])}},this.node.connect(this.ctx.destination),this},prettyPrintCallback:function(e){return e.toString().split("\n").slice(3,-2).map(function(e){return"      "+e}).join("\n")},createParameterDescriptors:function(e){var t,n="",r=a(e.params.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n+="{ name:'".concat(i.name,"', automationRate:'k-rate', defaultValue:").concat(i.defaultValue,", minValue:").concat(i.min,", maxValue:").concat(i.max," },\n      ")}}catch(o){r.e(o)}finally{r.f()}return n},createParameterDereferences:function(e){var t,n=e.params.size>0?"\n      ":"",r=a(e.params.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n+="const ".concat(i.name," = parameters.").concat(i.name,"[0]\n      ")}}catch(o){r.e(o)}finally{r.f()}return n},createParameterArguments:function(e){var t,n="",r=a(e.params.values());try{for(r.s();!(t=r.n()).done;){n+=t.value.name+"[i],"}}catch(i){r.e(i)}finally{r.f()}return n=n.slice(0,-1)},createInputDereferences:function(e){var t,n=e.inputs.size>0?"\n":"",r=a(e.inputs.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n+="const ".concat(i.name," = inputs[ ").concat(i.channelNumber," ]\n      ")}}catch(o){r.e(o)}finally{r.f()}return n},createInputArguments:function(e){var t,n="",r=a(e.inputs.values());try{for(r.s();!(t=r.n()).done;){n+=t.value.name+"[i],"}}catch(i){r.e(i)}finally{r.f()}return n=n.slice(0,-1)},createFunctionDereferences:function(e){var t,n=e.members.size>0?"\n":"",r={},i=a(e.members.values());try{for(i.s();!(t=i.n()).done;){var o=t.value,s=Object.keys(o)[0],c=o[s];void 0===r[s]&&(r[s]=!0,n+="      const ".concat(s," = ").concat(c,"\n"))}}catch(u){i.e(u)}finally{i.f()}return n},createWorkletProcessor:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:441e3,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Array.isArray(e)?e.length:1,c=s.createCallback(e,r,n),u=c.inputs,l=this.createParameterDescriptors(c),f=this.createParameterDereferences(c),h=(this.createParameterArguments(c),this.createInputDereferences(c)),d=(this.createInputArguments(c),this.createFunctionDereferences(c)),p="",v="",m=0;m<o;m++)p+="const channel".concat(m," = output[ ").concat(m," ]\n\t\t"),v+="channel".concat(m,"[ i ] = memory[ ").concat(m," ]\n\t\t");var y=this.prettyPrintCallback(c),b=a?" else if( event.data.key === 'eval' ) {\n        eval( event.data.code )\n      }\n":"";console.log("INPUTS STR",p),console.log("INPUTS de",h);var g="this.kernel = function( memory ) {\n      ".concat(y,"\n    }"),O="\nclass ".concat(t,"Processor extends AudioWorkletProcessor {\n\n  static get parameterDescriptors() {\n    const params = [\n      ").concat(l,"      \n    ]\n    return params\n  }\n \n  constructor( options ) {\n    super( options )\n    this.port.onmessage = this.handleMessage.bind( this )\n    this.initialized = false\n    ").concat(i?g:"","\n  }\n\n  handleMessage( event ) {\n    if( event.data.key === 'init' ) {\n      this.memory = event.data.memory\n      this.initialized = true\n    }else if( event.data.key === 'set' ) {\n      this.memory[ event.data.idx ] = event.data.value\n    }else if( event.data.key === 'get' ) {\n      this.port.postMessage({ key:'return', idx:event.data.idx, value:this.memory[event.data.idx] })     \n    }").concat(b,"\n  }\n\n  process( inputs, outputs, parameters ) {\n    if( this.initialized === true ) {\n      const output = outputs[0]\n      ").concat(p,"\n      const len    = channel0.length\n      const memory = this.memory ").concat(f).concat(h).concat(d,"\n      ").concat(i?"const kernel = this.kernel":"","\n\n      for( let i = 0; i < len; ++i ) {\n        ").concat(i?"kernel( memory )\n":y,"\n        ").concat(v,"\n      }\n    }\n    return true\n  }\n}\n    \nregisterProcessor( '").concat(t,"', ").concat(t,"Processor)");return console.log(O),!0===n&&console.log(O),[window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})),O,u,c.params,o]},registeredForNodeAssignment:[],register:function(e){-1===this.registeredForNodeAssignment.indexOf(e)&&this.registeredForNodeAssignment.push(e)},playWorklet:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2646e3,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];c.clear();var l=c.createWorkletProcessor(e,t,n,i,o,u),f=Object(r.a)(l,5),h=f[0],d=f[1],p=f[2],v=f[3],m=f[4];return console.log("numChannels:",m),new Promise(function(e,n){c.ctx.audioWorklet.addModule(h).then(function(){var n=new AudioWorkletNode(c.ctx,t,{channelInterpretation:"discrete",channelCount:m,outputChannelCount:[m]});n.callbacks={},n.onmessage=function(e){"return"===e.data.message&&(n.callbacks[e.data.idx](e.data.value),delete n.callbacks[e.data.idx])},n.getMemoryValue=function(e,t){this.workletCallbacks[e]=t,this.workletNode.port.postMessage({key:"get",idx:e})},n.port.postMessage({key:"init",memory:s.memory.heap}),c.workletNode=n,c.registeredForNodeAssignment.forEach(function(e){return e.node=n}),c.registeredForNodeAssignment.length=0;var r,i=a(p.values());try{var o=function(){var e=r.value,t=Object.keys(e)[0],a=n.parameters.get(t);Object.defineProperty(n,t,{set:function(e){a.value=e},get:function(){return a.value}})};for(i.s();!(r=i.n()).done;)o()}catch(h){i.e(h)}finally{i.f()}var u,l=a(v.values());try{var f=function(){var e=u.value,t=e.name,r=n.parameters.get(t);e.waapi=r,r.value=e.defaultValue,Object.defineProperty(n,t,{set:function(e){r.value=e},get:function(){return r.value}})};for(l.s();!(u=l.n()).done;)f()}catch(h){l.e(h)}finally{l.f()}c.console&&c.console.setValue(d),n.connect(c.ctx.destination),e(n)})})},playGraph:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:441e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Float32Array;return c.clear(),void 0===t&&(t=!1),this.isStereo=Array.isArray(e),c.callback=s.createCallback(e,n,t,!1,r),c.console&&c.console.setValue(c.callback.toString()),c.callback},loadSample:function(e,t){var n=void 0!==c.buffers[e],r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer";var a=new Promise(function(a,i){n?setTimeout(function(){return a(c.buffers[e])},0):r.onload=function(){var n=r.response;c.ctx.decodeAudioData(n,function(n){t.buffer=n.getChannelData(0),c.buffers[e]=t.buffer,a(t.buffer)})}});return n||r.send(),a}});c.clear.callbacks=[],t.default=c},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a=n(253).default,i=n(184).default,o="phasor",s=n(284).default,c={min:-1,max:1};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;console.log("ACCUm =",a);var u=Object.assign({},c,n),l=u.max-u.min,f=a("number"===typeof e?e*l/r.samplerate:s(i(e,l),r.samplerate),t,u);return f.name=o+r.getUID(),f}},function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(108),o=n(4),s=n(5),c=n(31),u=n(10),l=n(7),f=n(8),h=n(2),d=n(139),p=n(160),v={rotateForce:function(e){},forceStart:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n[0],i=n[1],o=n[2],s=Object.keys(e.groups[0].forces)[a],c=e.groups[0].forces[s];c[0].set(i),c[1].set(o)},forceDirection:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n[0],i=n[1],o=n[2],s=Object.keys(e.groups[0].forces)[a],c=e.groups[0].forces[s];c[2].set(i),c[3].set(o)}};function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}function y(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var O=n(546),j=n(16),k=n(200),w=n(134),x=n(277),S=n(413),P=n(414),E=n(547),T=n(439),A=n(128),M=n(23);function R(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var C=n(14),N=n(123),I=n(20),q=n(847),_=n(848),D=n(548),F=n(291),L=n(161),B=n(849),z=n(995),J=n(850),V=n(851),H=n(852),U=n(853),G=n(854),W=n(855),K=n(360),Q=n(856),Z=n(857),Y=n(858),$=n(549),X=function(e){return function(t){for(var n={},r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];var s=L.a.apply(void 0,[e].concat(i));for(var c in t)n[c]=Object(a.a)({},t[c],{density:s*(t[c].density||1)});return n}},ee=function(){return function(e){return{}}},te=n(550),ne=n(201);Object(ne.a)("beat",{step:"The step within the beat at which this executes the ifCond condition",beat:"The total number of steps within which we determine if the step has occured",ifCond:"The condition that is executed when the step is reached",elseCond:"The condition that is executed otherwise"},"Conditions on a certain step within a beat. For example, beat(0,32,a,b) executes a on the 1st beat of every bar, and executes b on every other step");var re=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return function(a,i,o,s,c,u){return s%t===e?Object(L.a)(n,a,i,o,s,c,u):r?Object(L.a)(r,a,i,o,s,c,u):a}};function ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var ie=n(456),oe=n(63),se=n(446);function ce(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ue(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ue(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function le(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var fe=function(e){Object(l.a)(n,e);var t=le(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.e,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;return Object(o.a)(this,n),(e=t.call(this,"Plane Group",s)).initialBulkValues={},e.effect=u,e.id=Object(I.uuid)(),e._parameters=r,e.track=s,e.context=i||(new N.a).forTrack(s),e.parameterIds=[],e.counter=0,e.parameters=[],e.algorithmParameter=new C.a("width",Object(c.a)(e),function(t,n){n===P.d&&(e.navier||(e.navier=Object(E.b)(Object(c.a)(e))))},{defaultValue:a,min:0,max:1}),e.widthParameter=new C.a("width",Object(c.a)(e),function(){return[]},{defaultValue:12,min:4,max:30}),e.speedParameter=new C.a("speed",Object(c.a)(e),function(){return[]},{defaultValue:1,min:.1,max:8}),e.registerParameter(e.algorithmParameter),e.registerParameter(e.widthParameter),e.registerParameter(e.speedParameter),e.bounce=Object(T.a)(45),e.life=Object(P.l)(),e.swap=Object(P.n)(),e.rotate=Object(P.m)(3),e.history=[],e.updateIdToParameter(),e.track.sequencerEngine.dispatch(Object(M.xb)(e.initialBulkValues)),e}return Object(s.a)(n,[{key:"registerParameter",value:function(e){this.context&&e.setContext(this.context),this.initialBulkValues=Object(a.a)({},this.initialBulkValues,e.setStore(this.track.store)),this.parameters.push(e)}},{key:"ungroupParameter",value:function(e){var t=this._parameters.indexOf(e);this._parameters.splice(t,1);e.hasGroup;e.hasGroup=void 0;var n,r=ce(this.variations);try{for(r.s();!(n=r.n()).done;){var a=n.value;Object.keys(a).includes(e.id)&&delete a[e.id]}}catch(i){r.e(i)}finally{r.f()}}},{key:"updateIdToParameter",value:function(){var e=this;this.idToParameter={},this._parameters.forEach(function(t){return e.idToParameter[t.id]=t})}},{key:"width",get:function(){return this.widthParameter.get()},set:function(e){this.widthParameter.set(e)}},{key:"speed",get:function(){return this.speedParameter.get()},set:function(e){this.speedParameter.set(e)}},{key:"algorithm",get:function(){return this.isNoCode?P.g:this.algorithmParameter.get()},set:function(e){this.algorithmParameter.set(e)}},{key:"getAllParameterCoords",value:function(){var e=this,t={};return Object(S.a)(this._parameters).forEach(function(n,r){return t[e._parameters[r].id]=n}),t}},{key:"onTrigger",value:function(e,t,n,r){var a=this.sequenceStep(e,t,n);if(a)return a;this.counter++;var i=this._parameters,o={};i.forEach(function(e){o[e.id]=e.getCoordinates()}),this.history.push(o);var s=[this.speed,this.width,e,this.history,r,this.effect,this],c={};if(0===i.length)return{};if(this.algorithm===P.d)c=this.navier.apply(this,[o].concat(s));else if(this.algorithm===P.c)c=this.life.apply(this,[o].concat(s));else if(this.algorithm===P.i)c=this.swap.apply(this,[o].concat(s));else if(this.algorithm===P.a){var u=this.bounce.apply(this,[o].concat(s));c=this.life(u,this.speed/8,this.width,e,this.history,r,this.effect)}else if(this.algorithm===P.b){var l=this.bounce(o,this.speed,this.width,e,this.history,r,this.effect);c=this.swap.apply(this,[l].concat(s))}else if(this.algorithm===P.f)c=this.rotate.apply(this,[o].concat(s));else if(this.algorithm===P.h){var f=this.life.apply(this,[o].concat(s));c=this.rotate.apply(this,[f].concat(s))}else this.algorithm===P.g&&this.script&&(c=x.a.apply(void 0,[this.script,o].concat(s)));if(0===Object.keys(c).length)return{};var h={};for(var d in c)try{var p=c[d].density||1,v=this.idToParameter[d];if(v){var m=v.setCoordinates(c[d].x,c[d].y,t,p*n/1e3,!0),y=m.id,b=m.value;h[y]=b}}catch(g){console.log("ERROR = ",g)}return h}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.code&&(this.code=e.code),this.restartScript(),e.id&&(this.id=e.id),this.algorithm=e.algorithm,Object(A.a)(e,"algorithmParameter",this.algorithmParameter),Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,e,t),e.id&&(this.id=e.id),this.algorithm=e.algorithm,Object(A.a)(e,"algorithmParameter",this.algorithmParameter),this.speed=e.speed,this.width=e.width,this.parameterIds=e.parameters,e.stepToState&&(this.stepToState=e.stepToState),e.variations&&(this.variations=e.variations,this.generation=e.generation);var r=Object.keys(e).filter(function(e){return e.startsWith("force")||e.startsWith("root")});this.savedVariables={};var a,i=ce(r);try{for(i.s();!(a=i.n()).done;){var o=a.value;this.savedVariables[o]=e[o]}}catch(s){i.e(s)}finally{i.f()}}},{key:"loadParameters",value:function(e,t){var n,r=this.parameterIds.map(function(e){return t[e]?t[e].id:e}),a=ce(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;r.includes(i.id)&&!this._parameters.includes(i)&&(this._parameters.push(i),i.hasGroup=this)}}catch(o){a.e(o)}finally{a.f()}}},{key:"getJson",value:function(){var e=Object(a.a)({},Object(u.a)(Object(h.a)(n.prototype),"getJson",this).call(this),{id:this.id,parameters:this._parameters.map(function(e){return e.id}),algorithm:this.algorithm,width:this.width,code:this.code,speed:this.speed,stepToState:this.stepToState,generation:this.generation});return e=Object(A.b)(e,"algorithmParameter",this.algorithmParameter)}},{key:"updateParameter",value:function(e){if(void 0!==this.selectedVariation){var t=this.variations[this.selectedVariation];t&&(t[e.id]=e.getCoordinates())}var n=e.getCoordinates();if(void 0!==this.stepSelected){var r=this.stepToState[this.stepSelected]||{};r[e.id]=n,this.stepToState[this.stepSelected]=Object(a.a)({},r)}this.history&&this.history[0]&&(this.history[0][e.id]=n)}},{key:"stop",value:function(){this.restartScript(),this.updateIdToParameter(),this.history=[]}},{key:"replaceParameter",value:function(e){for(var t in this._parameters)if(this._parameters[t].id===e.id)return this._parameters[t]=e,this.updateIdToParameter(),void(e.hasGroup=this)}}]),n}(Object(oe.a)(function(e){return function(e){Object(l.a)(n,e);var t=ae(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).code="",e.script=void 0,e.forces={},e.isNoCode=!1,e}return Object(s.a)(n,[{key:"eval",value:function(e){if(!this.isNodeCode){var t=this.clearVariables();for(var n in this.code=e,this.script=this.evalWithContext(e),t)this[n+"Parameter"]&&this[n+"Parameter"].copyFrom(t[n],this.track.sequencerEngine);this.updateVariablesRedux()}}},{key:"hasSyntaxError",value:function(e){return void 0===this.evalWithContext(e)}},{key:"restartScript",value:function(){""!==this.code&&this.eval(this.code)}},{key:"evalWithContext",value:function(e){var t=this;if(!this.isNodeCode)try{var n=e.split(";"),r=n[n.length-1],i=n.slice(0,n.length-1).join(";"),o=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return t.newVar(e,n,r,a,void 0,i),function(){return t[e+"Parameter"].get()}};return new Function("with(this) { "+i+"; return s("+r+")}").call({rotate:P.m,translate:Y.a,s:x.e,random:x.d,fluid:E.a,circle:q.a,every:te.c,none:D.a,altn:te.b,loop:G.a,snapshot:W.c,byDevice:Q.a,spread:B.a,life:P.l,send:Z.b,rewind:K.b,lazy:L.a,proportion:_.a,slice:_.b,preventIntersect:q.b,gte:V.d,lte:V.e,eq:V.c,neq:V.f,diameter:k.d,geometry:k.c,diff:H.a,and:V.a,or:V.g,reset:K.a,alt:te.a,slow:X,clear:ee,navierStokes:z.a,swap:P.n,beat:re,bounce:T.a,vectorField:$.a,expand:P.k,search:Q.c,p:x.b,part:x.c,interpolateSnapshot:W.a,nextSnapshot:W.b,load:function(e){return t.loadScript(e)},receive:Z.a,sin:Math.sin,cos:Math.cos,tan:Math.tan,source:U.a,cond:V.b,mac:J.a,not:Q.b,WIDTH:j.c,HEIGHT:j.a,knob:o,force:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.variables.length,n=[o("force.x ".concat(e),10*e,0,j.c,!0),o("force.y (".concat(e,")"),10*e,0,j.a,!0),o("force.dx (".concat(e,")"),100,-j.c,j.c,!0),o("force.dy (".concat(e,")"),100,-j.a,j.a,!0)];return t.forces=Object(a.a)({},t.forces),t.forces[e]=t.variables.slice(t.variables.length-4),n},diffusion:function(){return o("diffusion",.75,.7,1.2)}})}catch(s){return void console.log("error = ",s)}}},{key:"knob",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.savedVariables&&this.savedVariables[e]&&(t=this.savedVariables[e],delete this.savedVariables[e]),this.newVar(e,t,r,a,void 0,i),function(){return n[e+"Parameter"].get()}}},{key:"force",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.variables.length,n=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return e.savedVariables&&e.savedVariables[t]&&(n=e.savedVariables[t],delete e.savedVariables[t]),e.newVar(t,n,r,a,void 0,i),function(){return e[t+"Parameter"].get()}},r=[n("force.x ".concat(t),10*t,0,j.c,!0),n("force.y (".concat(t,")"),10*t,0,j.a,!0),n("force.dx (".concat(t,")"),100,-j.c,j.c,!0),n("force.dy (".concat(t,")"),100,-j.a,j.a,!0)];return this.forces=Object(a.a)({},this.forces),this.forces[t]=this.variables.slice(this.variables.length-4),r}},{key:"loadScript",value:function(e){var t=Object(F.b)(e),n=this.evalWithContext(t,!1);return function(){return n}}}]),n}(e)},ie.a,O.a,function(e){return function(e){Object(l.a)(n,e);var t=R(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).stepToState={},e.sequencerEnabled=!0,e.stepSelected=void 0,e}return Object(s.a)(n,[{key:"deleteStateAtStep",value:function(e){delete this.stepToState[e],this.effect.resetValues()}},{key:"selectStep",value:function(e){var t=this.applySequencedState(this.stepToState[e],void 0,.001);this.stepSelected=e,t&&this.track.sequencerEngine.dispatch(Object(M.xb)(t))}},{key:"unselectStep",value:function(){this.stepSelected=void 0}},{key:"recordStateAtStep",value:function(e){var t={};this._parameters.forEach(function(e){return t[e.id]=e.getCoordinates()}),this.stepToState[e]=t,this.stepSelected=void 0}},{key:"sequenceStep",value:function(e,t,n){if(!this.sequencerEnabled)return!1;e=Math.floor(e/2);var r=this.stepToState[e];return this.applySequencedState(r,t,n)}},{key:"applySequencedState",value:function(e,t,n){var r=this;if(e){var a={},i=function(i){var o=r._parameters.find(function(e){return e.id===i});if(!o)return"continue";var s=o.setCoordinates(e[i].x,e[i].y,t,n/1e3,!0),c=(s.id,s.value);a[i]=c};for(var o in e)i(o);return a}}}]),n}(e)})(se.a)),he=n(6),de=n.n(he),pe=n(76);function ve(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}Math.abs,Math.pow,Math.sqrt;function me(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ye(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ye(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function be(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var ge=Math.sqrt,Oe=function(e){return Math.pow(e,2)},je=function(e,t,n,r){return ge(Oe(n-e)+Oe(r-t))},ke=(n(380),n(326)),we=n(288),xe=n(42),Se=n.n(xe),Pe=n(56),Ee=n(130),Te=(n(80),n(122));n(234);function Ae(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Me(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Me(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Re(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Ce=n(1679),Ne=n(859),Ie=n(860);window.tanDiff=20;var qe=function(e,t,n){var r=De((_e(n/e)-1)/(1-_e(t/e))+_e(t)),a=t+r,i=t-r;return{x1:2*e-a*e/t,y1:a,x2:2*e-i*e/t,y2:i}},_e=function(e){return Math.pow(e,2)},De=Math.sqrt,Fe=n(311),Le=n(634),Be=n(113);function ze(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Je(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Je(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Je(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ve(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var He=function(e){Object(l.a)(n,e);var t=Ve(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this)).id=Object(I.uuid)(),s.name=e,s.number=a,s.parameters=r,s.effect=i,s.signal=new de.a.Signal(0),s.signalParameter=new Be.a("macro",s.signal,function(){},{min:0,defaultValue:0,max:1,useInstrumentModulators:!0}),s.signalParameter.setContext((new N.a).forTrack(s.effect.track)),s.subMacros={},s.initColor(),s}return Object(s.a)(n,[{key:"dispose",value:function(){var e=this;this.lastHull=void 0,this.lastCentroid=void 0;var t=this.effect.track.sequencerEngine.lfos.map(function(e){return e.lfo}),n=function(n){var r=t.find(function(e){return e.number===parseInt(n)});e.disconnectFromLFO(r)};for(var r in this.subMacros)n(r);this.parameters.forEach(function(e){return e.planeMacro=void 0}),this.signalParameter.dispose(),this.signal.dispose(),this.signalParameter=void 0,this.subMacros=void 0,this._disposed=!0}},{key:"disposeSubMacro",value:function(e){var t=e.parameter;this.signal.disconnect(e.scaler),e.dispose(),t.set(t.get(!0),!0,!0)}},{key:"disconnectFromLFO",value:function(e){var t=this,n=this.subMacros[e.number];n.forEach(function(e){t.disposeSubMacro(e)}),delete n[e.number],this.signalParameter.disconnectFromLFO(e)}},{key:"connectToLFO",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this.parameters.filter(function(n){return!t.subMacros[e.number]||!t.subMacros[e.number].some(function(e){return e.parameter===n})}).filter(function(t){return t.context&&(!t.context.lfoTrack||t.context.lfoTrack.lfo!==e)}).filter(function(e){return"LFO Max"!==e.name&&"LFO Phase"!==e.name}).filter(function(e){return e.audioParam||e.audioParams}),i=(this.subMacros[e.number],this.subMacros[e.number]||[]);this.subMacros[e.number]=[].concat(Object(r.a)(i),Object(r.a)(a.map(function(e){var n=new Le.a(e,e.min,e.max);return n.withSignal(t.signal),e.set(e.get(!0),!0,!0),n}))),n&&!this.lfos.includes(e)&&this.signalParameter.connectToLFO(e)}},{key:"fromJson",value:function(e,t){this.name=e.name,this.id=e.id,this.number=e.number,this.parameterIds=e.parameters,this.signalParameterJson=e.signalParameter,this.isCopy=t,e.color?this.color=e.color:this.initColor()}},{key:"loadParameters",value:function(e,t){var n,r=this.parameterIds.map(function(e){return t[e]?t[e].id:e}),a=ze(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;r.includes(i.id)&&!this.parameters.includes(i)&&(this.parameters.push(i),i.planeMacro=this)}}catch(u){a.e(u)}finally{a.f()}if(this.signalParameterJson){this._loadedSignalParameter||(this.signalParameter.fromJson(this.signalParameterJson,this.effect.track.sequencerEngine,this.isCopy),this._loadedSignalParameter=!0);var o,s=ze(this.signalParameter.lfos);try{for(s.s();!(o=s.n()).done;){var c=o.value;this.connectToLFO(c,!1)}}catch(u){s.e(u)}finally{s.f()}}}},{key:"lfos",get:function(){return this.signalParameter.lfos}},{key:"free",value:function(){var e=this;this.parameters.forEach(function(t){return e.removeParameter(t)})}},{key:"getJson",value:function(){return{name:this.name,color:this.color,id:this.id,number:this.number,parameters:this.parameters.map(function(e){return e.id}),signalParameter:this.signalParameter.getJson()}}},{key:"removeParameter",value:function(e){var t=this;if(this.lastHull=void 0,this.lastCentroid=void 0,!this._disposed){this.parameters=this.parameters.filter(function(t){return t!==e}),e.planeMacro=void 0;var n=Object.values(this.subMacros).flat().filter(function(t){return t&&t.parameter===e});for(var r in n.forEach(function(e){return t.disposeSubMacro(e)}),this.subMacros)this.subMacros[r]=this.subMacros[r].filter(function(e){return!n.includes(e)})}}},{key:"isPlaneMacro",get:function(){return!0}},{key:"isEmpty",value:function(){return 0===this.parameters.length}},{key:"getCoordinates",value:function(){return this.coordinates}},{key:"coordinates",get:function(){if(0===this.parameters.length)return 0;var e=this.parameters.map(function(e){return e.getCoordinates()});return this._coordinates=Object(k.a)(e),this._coordinates}},{key:"diameter",get:function(){return Object(k.b)(this.parameters.map(function(e){return e.getCoordinates()}))}},{key:"getAllCoordinates",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(S.a)(this.parameters,e)}},{key:"getGeometry",value:function(){if(0===this.parameters.length)return{x:0,y:0,diameter:0};var e=this.getAllCoordinates();return e?Object(a.a)({},Object(k.e)(e),{coordinates:e}):{x:0,y:0,coordinates:void 0}}},{key:"setCoordinates",value:function(e,t){var n=this._coordinates,r=e-n.x,a=t-n.y;this.moveCoordinates(r,a)}},{key:"moveCoordinates",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=this.parameters.map(function(e){return e.moveCoordinates.apply(e,t)});this.effect.setEffectParameterValues(r.reduce(function(e,t,n){var r=t.id,a=t.value;return Object(Ce.a)(n),e[r]=a,e}))}},{key:"getBlob",value:function(e,t,n,r){var a=this.getAllCoordinates(),i=Object(Fe.b)(a,{x:e,y:t},8);return r&&i.push(i[0]),this.lastHull=i,Object(Ie.a)(i,window.spline||1.1,void 0,r)}},{key:"getEasyBlob",value:function(){var e,t=this.getGeometry(),n=t.x,r=t.y,a=t.diameter,i=t.coordinates;return this.lastHull&&Ue(n,r,this.lastCentroid.x,this.lastCentroid.y)<5?e=this.lastHull.map(function(e){return i[e]}):i&&(e=Object(Fe.b)(i,{x:n,y:r},8),this.lastHull=e.map(function(e){var t=e.x,n=e.y,r=i.find(function(e){return e.x===t&&e.y===n});return i.indexOf(r)}),this.lastCentroid={x:n,y:r}),{x:n,y:r,diameter:a,coordinates:i,hull:e,d:e&&Object(Ie.a)(e,this.effect.splineTension)}}},{key:"getConvexHull",value:function(e,t,n){var r=this.getAllCoordinates();return Object(Fe.b)(r,Object(k.a)(r),n)}},{key:"getTans",value:function(e,t){var n,r=[],a=ze(this.parameters);try{for(a.s();!(n=a.n()).done;){var i=n.value.getCoordinates();r.push(i)}}catch(s){a.e(s)}finally{a.f()}var o=Object(Fe.b)(r);return o[0]?function(e,t,n){for(var r=[],a=0;a<e.length;a++){var i=e[a],o=e[(a+1)%e.length],s=i.x-t,c=i.y-n,u=o.x-t,l=o.y-n,f=qe(s,c,window.tanDiff);f={x:f.x1+t,y:f.y1+n};var h=qe(u,l,window.tanDiff);h={x:h.x1+t,y:h.y1+n},0===a?r.push([f,h,o]):r.push([i,h,o])}return r}(o,e,t):""}}]),n}(Object(Ne.a)(function(){return function e(){Object(o.a)(this,e)}}())),Ue=function(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))};function Ge(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}function We(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ke(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ke(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Ze=function(e){Object(l.a)(n,e);var t=Qe(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Plane Parameters",e)).track.sequencerEngine&&(r.track.sequencerEngine.idToObject[r.id]=Object(c.a)(r)),r.newInlet("operation",function(e){return r.onOperation(e)}),r.newInlet("speed",function(e){return r.onSpeed(e)}),r.setupRampParameters(),r.setupPlanarParameters(),r.setupSnapshots(),r.setupDrawable(),r.setupPlayable(),r.groups=[],r.counter=-1,r.effect=Object(c.a)(r),r.smokeResolution=64,r.dispatch(Object(M.Oc)(r.track.id,Object(c.a)(r))),r.newOutlet("macros"),r.newOutlet("smoke"),r}return Object(s.a)(n,[{key:"onSpeed",value:function(e){var t=Object(i.a)(e,1)[0];this.groups.filter(function(e){return e.speedParameter.set(t)})}},{key:"setupPlanarParameters",value:function(){this.maxParametersParameter=new C.a("maxParameters",this,function(e,t){return[]},{defaultValue:24,min:16,max:64}),this.registerParameter(this.maxParametersParameter),this.blurParameter=new C.a("blur",this,function(e,t){return[]},{defaultValue:0,min:0,max:40}),this.registerParameter(this.blurParameter),this.splineTensionParameter=new C.a("splineTension",this,function(e,t){return[]},{defaultValue:1.8,min:.5,max:400}),this.registerParameter(this.splineTensionParameter),this.updateRateParameter=new C.a("updateRate",this,function(e,t){return[]},{defaultValue:0,min:0,max:40}),this.registerParameter(this.updateRateParameter),this.setupNodeMessaging()}},{key:"splineTension",get:function(){return this.splineTensionParameter.get()}},{key:"maxParametersPerIter",get:function(){return this.maxParametersParameter.get()}},{key:"updateRate",get:function(){return this.updateRateParameter.get()}},{key:"randomlyMapParameters",value:function(e,t,r){var a,i=We(r=Object(u.a)(Object(h.a)(n.prototype),"randomlyMapParameters",this).call(this,e,t,r));try{for(i.s();!(a=i.n()).done;)a.value}catch(o){i.e(o)}finally{i.f()}}},{key:"getForces",value:function(){var e=this.groups.flatMap(function(e){return e.variables.filter(function(e){return e.name.startsWith("force.x")})}),t=this.groups.flatMap(function(e){return e.variables.filter(function(e){return e.name.startsWith("force.y")})}),n=this.groups.flatMap(function(e){return e.variables.filter(function(e){return e.name.startsWith("force.dx")})}),r=this.groups.flatMap(function(e){return e.variables.filter(function(e){return e.name.startsWith("force.dy")})}),a=[];for(var i in e)a.push([e[i],t[i],n[i],r[i]]);return a}},{key:"checkForces",value:function(){var e,t=We(this.getForces());try{for(t.s();!(e=t.n()).done;){var n=e.value,r=Object(i.a)(n,4),a=r[0],o=r[1],s=r[2],c=r[3];(a.get()>=j.c||a.get()+.25*s.get()>=j.c)&&(a.set(15),s.set(15)),(o.get()>=j.a||o.get()+.25*c.get()>=j.a)&&(o.set(15),c.set(15))}}catch(u){t.e(u)}finally{t.f()}}},{key:"stop",value:function(){this.checkForces(),Object(u.a)(Object(h.a)(n.prototype),"stop",this).call(this),this.counter=-1,this.stopDrawing(),this.groups.forEach(function(e){return e.stop()}),console.log("FINISHED STOP")}},{key:"clear",value:function(){Object(u.a)(Object(h.a)(n.prototype),"clear",this).call(this),this.counter=-1}},{key:"output",value:function(e,t,n,r,i){if(this.currentSnapshotParameter.refresh(!1),!this.track.sequencerEngine.playing&&!r)return this.triggers;var o=this.groups.length>0?this.groups.map(function(e){return e._parameters.length}).reduce(function(e,t){return e+t}):1,s=Math.min(1,this.maxParametersPerIter/o);if(this.applyPencilAutomations(t),this.currentPath){var c=this.applyPath(s,t);return this.track.sequencerEngine.parametersToUpdate=Object(a.a)({},this.track.sequencerEngine.parametersToUpdate,c),this.triggers}var u=t%this.updateRate===0;if(0===this.triggers.length&&!u&&!r)return this.triggers;if(!this.playing&&!r)return this.triggers;var l,f={},h=We(this.groups);try{for(h.s();!(l=h.n()).done;){var d=l.value;f=Object(a.a)({},f,d.onTrigger(n,e,i||this.rampTime,s))}}catch(p){h.e(p)}finally{h.f()}return this.track.sequencerEngine.parametersToUpdate=Object(a.a)({},this.track.sequencerEngine.parametersToUpdate,f),this.sendMacroMessages(),this.sendMessage("smoke",this.D),this.triggers}},{key:"getParameters",value:function(){var e,t=Object(u.a)(Object(h.a)(n.prototype),"getParameters",this).call(this),a=We(this.groups);try{for(a.s();!(e=a.n()).done;){var i=e.value;t=[].concat(Object(r.a)(t),Object(r.a)(i.parameters))}}catch(o){a.e(o)}finally{a.f()}return t}},{key:"getParameterValueToSet",value:function(e){}},{key:"groupParameters",value:function(e){var t=new fe(e,void 0,this.context,this.track,this);this.groups=[].concat(Object(r.a)(this.groups),[t]),e.forEach(function(e){return e.hasGroup=t})}},{key:"ungroup",value:function(e){var t=this.groups.indexOf(e);e._parameters.forEach(function(e){return e.hasGroup=void 0}),this.groups.splice(t,1)}},{key:"ungroupParameters",value:function(e){var t=e.map(function(e){return e.hasGroup});e.filter(function(e){return e.hasGroup}).forEach(function(e){return e.hasGroup.ungroupParameter(e)});var n,r=We(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;a&&0===a._parameters.length&&this.ungroup(a)}}catch(i){r.e(i)}finally{r.f()}}},{key:"getGroupForParameter",value:function(e){return this.groups.find(function(t){return t._parameters.includes(e)})}},{key:"mergeIntoGroup",value:function(e,t){this.ungroupParameters(t),t.forEach(function(t){e._parameters.push(t),t.hasGroup=e});var n=this.groups.filter(function(e){return 0===e._parameters.length});this.groups=this.groups.filter(function(e){return!n.includes(e)}),this.groups.push(e)}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"gradientColor",get:function(){return this.track.sequencerEngine.state.plane.gradientColors[this.id]},set:function(e){this.track.sequencerEngine.dispatch(Object(M.Pc)(this.id,e))}},{key:"getJson",value:function(e){var t=Object(a.a)({},Object(u.a)(Object(h.a)(n.prototype),"getJson",this).call(this,e),{gradientColor:this.gradientColor,densities:this.getDensityJson(),splineTension:this.splineTension,width:j.c,height:j.a,hideUI:this.hideUI,scriptExpanded:this.scriptExpanded&&this.scriptExpanded.id,macros:this.getMacrosJson(),snapshots:this.snapshots.map(function(e){return e.map(function(e){var t=e.parameter,n=e.coordinates;return{parameter:t.id,coordinates:n}})}),snapshotComponent:this.snapshotComponent,groups:this.groups.map(function(e){return e.getJson()})});return console.log("getting plane json=",t),t}},{key:"getMappableJson",value:function(e){return{parameters:this._parameters.map(function(t){return{id:t.id,context:e?t.context&&t.context.getJson():void 0,name:e?t.name:void 0,coordinates:t.getCoordinates()}}),depthParameters:[]}}},{key:"unmapParameter",value:function(e){var t=Object(u.a)(Object(h.a)(n.prototype),"unmapParameter",this).call(this,e);if(t&&t.hasGroup&&t.hasGroup.ungroupParameter(t),t&&t.planeMacro){var r=t.planeMacro;r.removeParameter(t),r.isEmpty()&&this.deleteMacro(r)}}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(console.log("PLANE JSON groups"),console.log(e,e.groups),t||(this.id=e.id,this.track.sequencerEngine&&(this.track.sequencerEngine.idToObject[this.id]=this)),this.jsonSnapshots=e.snapshots,e.gradientColor&&(this.gradientColor=e.gradientColor),e.splineTension&&this.splineTensionParameter.set(e.splineTension),this.hideUI=e.hideUI,e.width&&Object(j.d)(e.width,e.height),e.snapshotComponent&&(this.snapshotComponent=e.snapshotComponent),e.groups){var r,a=We(e.groups);try{for(a.s();!(r=a.n()).done;){var i=r.value,o=new fe(void 0,void 0,this.context,this.track,this);console.log("going thru groups to from Json it",i),o.fromJson(i),this.groups.push(o)}}catch(s){a.e(s)}finally{a.f()}}return this.fromMacrosJson(e.macros),e.scriptExpanded&&(this.scriptExpanded=this.groups.find(function(t){return t.id===e.scriptExpanded})),e.densities&&this.fromDensityJson(e.densities),Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,e,t)}},{key:"loadParameters",value:function(e,t){var r=this,a=Object(u.a)(Object(h.a)(n.prototype),"loadParameters",this).call(this,e,t),i=a.lostParameters,o=a.newMappings;if(this.groups.forEach(function(e){return e.loadParameters(r._parameters,o)}),this.macros.forEach(function(e){return e.loadParameters(r._parameters,o)}),this.snapshots=[],this.jsonSnapshots){var s,c=We(this.jsonSnapshots);try{for(c.s();!(s=c.n()).done;){var l,f=s.value,d=[],p=We(f);try{var v=function(){var e=l.value,t=e.parameter,n=e.coordinates,a=r._parameters.find(function(e){return e.id===t});a&&d.push({parameter:a,coordinates:n})};for(p.s();!(l=p.n()).done;)v()}catch(m){p.e(m)}finally{p.f()}this.snapshots.push(d)}}catch(m){c.e(m)}finally{c.f()}}return this.clear(),this.stop(),{lostParameters:i,newMappings:o}}},{key:"clearParameter",value:function(e,t,r){if(Object(u.a)(Object(h.a)(n.prototype),"clearParameter",this).call(this,e,t),this.macros.forEach(function(e){e.lastHull=void 0,e.lastCentroid=void 0}),r||this.groups.forEach(function(t){return t.updateParameter(e)}),void 0!==this.selectedVariation&&!r){var a=this.variations[this.selectedVariation],i=e.id;a&&(a[i]=e.getCoordinates())}this.setting||this.currentSnapshotParameter.set(null,!0)}},{key:"replaceParameter",value:function(e){Object(u.a)(Object(h.a)(n.prototype),"replaceParameter",this).call(this,e),this.groups.forEach(function(t){return t.replaceParameter(e)})}},{key:"dispose",value:function(){this.macros.forEach(function(e){return e.dispose()}),this.dispatch(Object(M.Oc)(this.track.id,void 0)),Object(u.a)(Object(h.a)(n.prototype),"dispose",this).call(this)}},{key:"onParameterUnmapped",value:function(e){this.macros.filter(function(t){return t.parameters.includes(e)}).forEach(function(t){return t.removeParameter(e)})}},{key:"sortParameters",value:function(){}},{key:"shouldOutputSkip",value:function(e,t){return 0===this.triggers.length}}]),n}(Object(oe.a)(w.a,function(e){return function(e){Object(l.a)(n,e);var t=be(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).regions=[],e.densityCache={},e}return Object(s.a)(n,[{key:"newRegion",value:function(e,t){var n={x:e,y:t,radius:arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,viscosity:10};return this.regions=[].concat(Object(r.a)(this.regions),[n]),n}},{key:"deleteDensity",value:function(e){var t=this.regions.indexOf(e);t>-1&&(this.regions.splice(t,1),this.regions=Object(r.a)(this.regions))}},{key:"getViscosity",value:function(e,t){var n=0,r=e+","+t;if(this.densityCache[r])return this.densityCache[r];var a,i=me(this.regions);try{for(i.s();!(a=i.n()).done;){var o=a.value;je(e,t,o.x,o.y)<=o.radius&&(n+=o.viscosity)}}catch(c){i.e(c)}finally{i.f()}var s=0===n?1:n;return this.densityCache[r]=s,s}},{key:"expandRegion",value:function(e,t){this.cache={};var n=this.regions.indexOf(e);this.regions[n]=Object(a.a)({},e,{radius:e.radius*t}),this.regions=Object(r.a)(this.regions)}},{key:"expandViscosity",value:function(e,t){this.cache={};var n=this.regions.indexOf(e);this.regions[n]=Object(a.a)({},e,{viscosity:e.viscosity*t}),this.regions=Object(r.a)(this.regions)}},{key:"expandDensitySize",value:function(e,t){return this.cache={},e.radius=e.radius*t,this.regions=Object(r.a)(this.regions),e}},{key:"getDensityJson",value:function(){return this.regions}},{key:"fromDensityJson",value:function(e){this.regions=e}}]),n}(e)},function(e){return function(e){Object(l.a)(n,e);var t=m(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"onOperation",value:function(e){var t=Object(p.a)(e),n=t[0],a=(t.slice(1),n.split(" ").filter(function(e){return""!=e&&" "!==e})),i=a[0],o=a.slice(1).map(function(e){return parseFloat(e)}),s=v[i];s&&s.apply(void 0,[this].concat(Object(r.a)(o)))}}]),n}(e)},we.a,function(e){return function(e){Object(l.a)(n,e);var t=g(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getModulatedParameters",value:function(){var e,t=[],n=y(this._parameters);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.lfos.length+r.envelopes.length>0&&t.push(r)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"getStats",value:function(){var e,t=0,n=y(this._parameters);try{for(n.s();!(e=n.n()).done;){var r=e.value;t+=r.lfos.length+r.envelopes.length}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"simplifyPatch",value:function(e){for(var t=this.getModulatedParameters(),n=Math.floor(t.length*e/100),r=0;r<n;r++)t[r].disconnectFromAllModulators()}}]),n}(e)},ke.a,function(e){return function(e){Object(l.a)(n,e);var t=Re(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).snapshots=[],e.currentSnapshot=void 0,e.snapshotComponent={id:Object(I.uuid)()},e}return Object(s.a)(n,[{key:"setupSnapshots",value:function(){var e=this;this.newInlet(Ee.r,function(t){return e.onSnapshotMessage(t)}),this.newOutlet(Ee.j),this.currentSnapshotParameter=new C.b("currentSnapshot",this,function(t,n,r,a){return n<0||null===n?e.currentSnapshot=void 0:e.setting=!0,n>=0?e._useSnapshot(e.snapshots[n],a,r,n):-1},{min:0,max:100,defaultValue:null,stepAutomation:!0}),this.registerParameter(this.currentSnapshotParameter)}},{key:"takeSnapshot",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=[],a=Ae(this._parameters);try{for(a.s();!(e=a.n()).done;){var i=e.value;n.push({parameter:i,coordinates:i.getCoordinates(),min:i.min,max:i.max})}}catch(o){a.e(o)}finally{a.f()}this.snapshots=[].concat(Object(r.a)(this.snapshots),[n]),t&&this.currentSnapshotParameter.set(this.snapshots.length-1)}},{key:"deleteAllSnapshots",value:function(){this.snapshots=[],this.currentSnapshot=void 0}},{key:"deleteSnapshot",value:function(e){this.snapshots=this.snapshots.filter(function(t){return t!==e}),this.currentSnapshot=void 0}},{key:"_useSnapshot",value:function(e,t,n,r){var a=this;if(e&&e!==this.currentSnapshot){var i,o={},s={},c=new Set(this._parameters),u=Ae(e);try{var l=function(){var e=i.value,t=e.parameter,n=e.coordinates,r=e.min,u=e.max;if(!c.has(t))return"continue";void 0!==r&&void 0!==u&&(t.min=r,t.max=u),o[t.id]={min:r,max:u};var l=a.groups.map(function(e){return e.history[e.history.length-1]&&e.history[e.history.length-1][t.id]}).find(function(e){return e});if(l&&l.x===n.x&&l.y===n.y)return"continue";var f=de.a.Master.context.isOffline?de.a.Master.context._currentTime:de.a.Master.context.currentTime+.1,h=t.setCoordinates(n.x,n.y,f+.001,a.rampTime/1e3,!0),d=h.id,p=h.value;s[d]=p};for(u.s();!(i=u.n()).done;)l()}catch(m){u.e(m)}finally{u.f()}this.setEffectParameterValues(s),this.setParameterMinMax(o),this._clear(),this.currentSnapshot=e;var f,h=Ae(this.groups);try{for(h.s();!(f=h.n()).done;){var d=f.value;if(d.history&&d.history[0]){var p=function(t){var n=e.find(function(e){return e.parameter.id===t});n&&(d.history[0][t]=n.coordinates)};for(var v in d.history[0])p(v)}}}catch(m){h.e(m)}finally{h.f()}this.isOutletConnected(Ee.j)&&this.sendMessage(Ee.j,r+1),this.setting=!1}}},{key:"setParameterMinMax",value:function(e){this.track.sequencerEngine.dispatch(Object(M.Fc)(e))}},{key:"dropPreset",value:function(){var e=Object(Pe.a)(Se.a.mark(function e(t){var n,r,a,i,o;return Se.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te.a.getJson(t.contentHash);case 2:return n=e.sent,r=n.trackParameters.instrument,e.next=6,this.track.instrument.fromJson(r,!0);case 6:this.takeSnapshot(),a=Ae(this._parameters);try{for(a.s();!(i=a.n()).done;)(o=i.value).name&&!o._wasDisposed||this.unmap(o)}catch(s){a.e(s)}finally{a.f()}case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onSnapshotMessage",value:function(e){var t=Object(i.a)(e,1)[0];try{t=parseFloat(t),this.currentSnapshotParameter.set(t-1,!0)}catch(n){}}}]),n}(e)},function(e){return function(e){Object(l.a)(n,e);var t=Ge(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"setupPlayable",value:function(){this.playingParameter=new C.a("playing",this,function(){return[]},{defaultValue:1,min:0,max:1}),this.registerParameter(this.playingParameter)}},{key:"playing",get:function(){return this.playingParameter.get()}}]),n}(e)},function(e){return function(e){Object(l.a)(n,e);var t=Ve(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).macros=[],e}return Object(s.a)(n,[{key:"deleteMacro",value:function(e){this.macros=this.macros.filter(function(t){return t!==e}),this.updateMacroRedux(),e.dispose()}},{key:"createMacro",value:function(e){var t="Macro "+(this.macros.length+1),n=new He(t,e,this.macros.length+1,this);e.forEach(function(e){return e.planeMacro=n}),this.addMacro(n)}},{key:"freeMacro",value:function(e){e.free(),this.deleteMacro(e)}},{key:"updateMacroRedux",value:function(){this.track.sequencerEngine.dispatch(Object(M.Sc)(this.id,this.macros))}},{key:"addMacro",value:function(e){this.macros=[].concat(Object(r.a)(this.macros),[e]),e.number=this.macros.length,this.updateMacroRedux()}},{key:"sendMacroMessages",value:function(){(new Date).getTime();for(var e=[],t=1;t<=this.macros.length;t++)if(this.isOutletConnected("macros")){var n=this.macros[t-1].getAllCoordinates(!0);e.push(n)}(new Date).getTime(),this.sendMessage("macros",e)}},{key:"getMacrosJson",value:function(){return this.macros.map(function(e){return e.getJson()})}},{key:"fromMacrosJson",value:function(e){if(e){var t,n=ze(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=new He("macro",[],0,this);a.fromJson(r),this.addMacro(a)}}catch(i){n.e(i)}finally{n.f()}}}}]),n}(e)},O.a,function(e){return function(e){Object(l.a)(n,e);var t=ve(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).currentPath=void 0,e.currentPosition=1,e}return Object(s.a)(n,[{key:"stopDrawing",value:function(){this.currentPath=void 0,this.currentPosition=1,this.pencilDown=!1}},{key:"setupDrawable",value:function(){this.pencilXParameter=new C.a("pencilX",this,function(e,t){return[]},{defaultValue:null,min:0,max:j.c,exactAutomation:!0}),this.registerParameter(this.pencilXParameter),this.pencilYParameter=new C.a("pencilY",this,function(e,t){return[]},{defaultValue:null,min:0,max:j.a,exactAutomation:!0}),this.registerParameter(this.pencilYParameter)}},{key:"applyPencilAutomations",value:function(){if(!this.pencilXParameter.isRecordingMix&&!this.pencilXParameter.isRecording&&this.pencilXParameter.isPlayingMix&&null===this.pencilXParameter.get(!0)&&null===this.pencilYParameter.get(!0)){var e=this.pencilXParameter.currentStep,t=Object(pe.a)(e,this.pencilXParameter.mixAutomation),n=Object(pe.a)(e,this.pencilYParameter.mixAutomation),r=this.pencilDown;for(var a in t)void 0!==t[a]&&(r=null!==t[a],this.calculatePath(t[a],n[a],e));this.pencilDown=r}}},{key:"setPencil",value:function(e,t){this.pencilDown=void 0!==e&&null!==e,this.pencilXParameter.set(e,!1),this.pencilYParameter.set(t,!1),this.calculatePath(e,t),this.lastX=void 0,this.lastY=void 0}},{key:"pencilX",get:function(){return this.pencilXParameter&&this.pencilXParameter.get()}},{key:"pencilY",get:function(){return this.pencilYParameter&&this.pencilYParameter.get()}},{key:"calculatePath",value:function(e,t,n){e&&t&&(this.currentPath||(this.currentPath=[]),this.currentPath=[].concat(Object(r.a)(this.currentPath),[{x:e,y:t,stepNumber:n}]))}},{key:"isRecordingMix",get:function(){return this.pencilXParameter.isRecordingMix}},{key:"applyPath",value:function(e,t){var n=this.currentPath[this.currentPosition],r=this.currentPath[this.currentPosition-1];return void 0===n||void 0===r?(this.pencilDown||(this.currentPath=void 0,this.currentPosition=1),{}):(n.x,r.x,n.y,r.y,this.currentPosition++,{})}}]),n}(e)})(d.a));t.a=Ze},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=(n(139),n(11)),h=n(329),d=n(20),p=n(61);function v(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var b=function(e,t,n,a){var i=n[0],o=e.map(function(e){return e.id}).indexOf(i.id),s=[];if(2===n.length)s.push(Object(r.a)({},i,{cycle:void 0,type:{type:"."}}));else if(4===n.length||8===n.length){var c=n[n.length/2-1];s.push(Object(r.a)({},i,{accent:i.accent||c.accent,cycle:void 0,type:{type:"-",value:0}})),s.push(Object(r.a)({},i,{id:Object(d.uuid)(),accent:!1,cycle:void 0,type:{type:"-",value:1}}))}s.cycleLength=n.length;var u=[];if(1===a){var l=0,h=0;o%=e.length-n.length;var p,m=v(e);try{for(m.s();!(p=m.n()).done;){var y=p.value;l>=o&&h<n.length?(0===h&&u.push(s),h++):u.push(y),l++}}catch(j){m.e(j)}finally{m.f()}}else{e.length;if(u=Object(f.a)(e),console.log("first leaf=",i),o+n.length>=e.length){var b=e.length-o;if(console.log("remainder=%s halved.cycleLength=%s cycle.length=%s",b,s.cycleLength,e.length),s.cycleLength=b,b<=3)return}u.splice(o,n.length,s),console.log("index=%s heaves.length=%s",o,s.length,n,u.length)}for(var g=0;g<u.length;g++){var O=u[g];Array.isArray(O)||(u[g]=Object(r.a)({},O,{transpose:null}))}return u.cycleLength=e.length,u},g=n(147),O=n(6),j=n.n(O);function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var w=n(130),x=n(456),S=n(21),P=n(134),E=n(150),T=n(14),A=n(145),M=n(321);function R(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}window.tidalTimes=[],window.lazyTidals=0,window.nolazyTidals=0;new j.a.Time("16n");var I=new j.a.Time("32n"),q=function(e){Object(c.a)(n,e);var t=N(n);function n(e,r,i){var s;return Object(a.a)(this,n),(s=t.call(this,e,!1,5)).zObject=i,s.tidalCache={},s.scriptEffect=r,s.name="Tidal",s.cycleParameter=new T.a("cycle",Object(o.a)(s),function(e,t){if(t){var n=e.clearVariables();e.handleVariables(t,n),s.tidalCache={},s.needsUpdate=!0}},{defaultValue:void 0,min:!1,max:!0,unit:"",automatable:!1}),s.registerParameter(s.cycleParameter),s.warpLengthParameter.automatable=!1,s.warpFactorParameter.automatable=!1,s.loopLengthParameter.automatable=!1,s.resolutionParameter.automatable=!1,s.resolutionParameter.hide=!0,s.warpLengthParameter.hide=!0,s.warpFactorParameter.hide=!0,s.loopLengthParameter.hide=!0,s.durationFactorParameter.hide=!0,s.smoothnessParameter.hide=!0,s.cycleLengthParameter=new T.a("cycleLength",Object(o.a)(s),function(e,t){s.tidalCache={}},{documentation:"The number of 1/32th steps per cycle",prettyName:"Cycle Length",defaultValue:32,min:4,max:64,unit:""}),s.registerParameter(s.cycleLengthParameter),s.lengthFactorParameter=new T.a("lengthFactor",Object(o.a)(s),function(e,t){return[]},{documentation:"Multiplies the speed of the cycle",defaultValue:1,prettyName:"Speed Factor",min:.25,max:8,unit:""}),s.registerParameter(s.lengthFactorParameter),s.accentParameter="velocity",s.accentFactorParameter=new T.a("accentFactor",Object(o.a)(s),function(e,t){return[]},{documentation:"Multiplies the speed of the cycle",defaultValue:2,prettyName:"Accent Factor",min:0,max:2,unit:""}),s.registerParameter(s.accentFactorParameter),s.staccatoFactorParameter=new T.a("staccatoFactor",Object(o.a)(s),function(e,t){return[]},{documentation:"Multiplies the speed of the cycle",defaultValue:.2,prettyName:"Staccato Factor",min:0,max:2,unit:""}),s.registerParameter(s.staccatoFactorParameter),s.cycleRetrigger=!0,s.resolution=new S.a(32,!1),s.cycle=Object(E.g)("[0 12 ~ 12]"),s.numberOfOutputs=2,s.lastLeaf=void 0,s.newInlet("cycle length",function(e){return s.onCycleLength(e[0])}),s.newInlet("set variable",function(e){return s.onVariableSet(e[0])}),s.newOutlet(w.b),s}return Object(i.a)(n,[{key:"lockGroove",value:function(e){this.cycleParameter.immutable=e,this.cycleLengthParameter.immutable=e}},{key:"onCycleLength",value:function(e){isNaN(e)||this.cycleLengthParameter.set(e)}},{key:"onVariableSet",value:function(e){e=e.split(" ").map(function(e){return e.trim()});var t=parseFloat(e[1]);if(!isNaN(t)){var n=e[0];this[n+"Parameter"]&&(n=this[n+"Parameter"]).set(t)}}},{key:"clear",value:function(){Object(s.a)(Object(l.a)(n.prototype),"clear",this).call(this),this.lastLeaf=void 0,this.firstAccent=void 0,this.lastLeafStep=void 0,this.stepNumberTriggered=void 0,this.clearAnalyzer(),this.hijackBlock=void 0,this.isHijacking=!1}},{key:"output",value:function(e,t,r){return this.scriptEffect&&(r=this.scriptEffect.actualStepNumber),Object(s.a)(Object(l.a)(n.prototype),"output",this).call(this,e,t,r)}},{key:"accentFactor",get:function(){return this.accentFactorParameter.get()},set:function(e){this.accentFactorParameter.set(e)}},{key:"staccatoFactor",get:function(){return this.staccatoFactorParameter.get()},set:function(e){this.staccatoFactorParameter.set(e)}},{key:"documentation",get:function(){return["A tidal-cycles inspired scripting effect. Write expressions for cyclic beats using tidal notation.","Type or press enter to execute"]}},{key:"isRealTime",value:function(){return!1}},{key:"cycleLength",get:function(){return this.cycleLengthParameter.get()},set:function(e){return this.cycleLengthParameter.set(e)}},{key:"lengthFactor",get:function(){return this.lengthFactorParameter.get()},set:function(e){return this.lengthFactorParameter.set(e)}},{key:"cycle",get:function(){return this.cycleParameter.get()},set:function(e){return this.cycleParameter.set(e,!0,!0)}},{key:"removeNote",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.gated;Object(s.a)(Object(l.a)(n.prototype),"removeNote",this).call(this,e,t,r)}},{key:"handleVariables",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=R(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;Array.isArray(a)?this.handleVariables(a):(a.cycle&&this.handleVariables(a.cycle),a.transpose&&"object"===typeof a.transpose&&this.newVar(a.transpose.name,0,-32,32),a.operand&&"object"===typeof a.operand&&this.newVar(a.operand.name,2,1,16))}}catch(c){r.e(c)}finally{r.f()}var i=this.scriptEffect||this;for(var o in n){var s=i[o+"Parameter"];s&&(s.copyFrom(n[o],this.track.sequencerEngine),s.isMapped&&s.isMapped.replaceParameter(s))}i.updateVariablesRedux()}},{key:"cycleString",get:function(){return Object(E.e)(this.cycle)}},{key:"getText",value:function(){return this.cycleString}},{key:"replaceOperandVariables",value:function(e){var t=[];if(t.cycleLength=e.cycleLength,!e)return t;for(var n=0;n<e.length;n++){var a=e[n];if(Array.isArray(a))t.push(this.replaceOperandVariables(a));else{var i=Object(r.a)({},a);i.cycle&&(i.cycle=this.replaceOperandVariables(a.cycle)),a.operand&&"object"===typeof a.operand&&(this.newVar(a.operand.name,2,1,16),i.operand=this.var(a.operand.name)()),t.push(i)}}return t}},{key:"getTrigger",value:function(e,t,n,r,a,i){var o=(new Date).getTime();if(this.cycleRetrigger||(r=this.sequencerEngine.isSequenceRolling?r:this.track.sequencerEngine.trackStep),void 0===this.stepNumberTriggered&&(this.gated||this.sliceRetrigger||this.isNothingPlaying())&&(this.stepNumberTriggered=r),void 0!==this.cycle){var s=this.stepNumberTriggered;if(this.track&&this.track.length){var c=this.track.sequencerEngine.stepNumberOffset||0;c%=this.track.length,s=Object(g.a)(s-c,this.track.length)}var u=r-s;u<0&&(u+=this.track.length);var l=u%this.cycleLength;if(this.scriptEffect)this.scriptEffect.tidals.indexOf(this);if(0===l)if(this.scriptEffect&&this.scriptEffect.isOutletConnected&&this.scriptEffect.isOutletConnected(w.b)){var f=this.scriptEffect.tidals.indexOf(this);this.scriptEffect.sendMessage(w.b,f),this.needsHijackClear&&this.clearHijacks()}else this.sendMessage(w.b,w.a),this.needsHijackClear&&this.clearHijacks();var d,v=this.replaceOperandVariables(this.cycle),m=Math.floor(this.cycleLength/this.lengthFactor);0===this.variables.length&&this.tidalCache[l]&&!this.isHijacking?d=this.tidalCache[l]:(d=Object(h.c)({cycle:v,stepNumber:u,length:m}),this.isHijacking||(this.tidalCache[l]=d)),d.length>0&&(this.currentLeaves=d.filter(function(e){return e.cycle}),this.currentCycles=d.filter(function(e){return e.cycle}).reduce(function(e,t){return e[t.cycle]=!0,e},{}));var y=[],b=this.scriptEffect;for(var O in 0===d.length&&b&&this.analyzePulse(n,void 0,r,this.tidalNumber),d){var j=d[O],k=j.accent,x=j.pianissimo,S=j.staccato,P=j.legato,E=j.factor,T=j.outputNumber,M=j.transpose,R=j.offset,C=j.duration,N=j.flam,q=j.piano,_=j.nudgeForward,D=j.nudgeBackward,F=!1;if(j.rules&&j.rules.some(function(e){return e.always&&(Array.isArray(e.always)?e.always.some(function(e){return"double"===e.type}):"double"===e.always.type)||e.series&&e.series.some(function(e){return"double"===e.type})})&&(F=!0),null!==M&&"object"===typeof M&&(M=this.var(M.name)()),(e=this.getStep(e,t,1,!0)).slice=i,e.transpose=parseFloat(e.transpose)+parseFloat(M),e.duration=C*this.durationFactor,u%this.cycleLength===this.cycleLength-2&&(e.isNewCycle=!0,this.lastCycleRestart=r+2),null!==M){e.wasRest=!1,e.wasDouble=this.lastLeafStep&&this.lastLeafStep.isDouble,e.isDouble=F;if(this.lastLeaf){if(j.figureId!==this.lastLeaf.figureId){var L=this.scriptEffect.tidals.indexOf(this);this.scriptEffect.sendMessage("figure-change",L)}if(j.type){var B=j.type,z=B.type,J=B.value;if(z===p.b){if(this.lastLeaf.type&&this.lastLeaf.type.type===p.b){var V=this.lastLeafStep?this.lastLeafStep.velocity:.5;this.isSequenceRolling&&(V=Math.min(2,V)),e.velocity=.7*V}e.hand=!this.lastLeafStep.hand}else z===p.a&&(0===J?e.hand=!this.lastLeafStep.hand:1===J&&(this.lastLeafStep&&(!0,e.velocity=.3*this.lastLeafStep.velocity),e.hand=this.lastLeafStep.hand))}}e.accent=!1,e.pianissomo=!1,e.piano=!1,e.staccato=!1,e.legato=!1,e.nudgeForward=!1,e.nudegeBackward=!1,k&&(e.velocity*=this.accentFactor,e.accent=!0),E&&(e.velocity*=Math.pow(E,2)),x?(e.velocity*=.05,e.pianissomo=!0):q&&(e.velocity*=.45,e.piano=!0),S&&(e.duration*=this.staccatoFactor/Math.max(.5,e.velocity),e.release=5,e.attack=3,e.staccato=!0),P&&(e.duration=Object(h.b)(v,j.leaf,m),e.legato=!0),_&&(e.nudgeForward=!0),D&&(e.nudgeBackward=!0),e.on=!0,e.leafNumber=Object(h.a)(v,j.leaf,m),this.lastLeafNumber=e.leafNumber,e.leafType=j.type;var H=this.processLeaf(j,e.velocity,e.leafNumber,r,n);b&&this.analyzePulse(n,j,r,this.tidalNumber),e.velocity=H;var U=new A.a(e,I*R+n,a,T);if(U.offsetTime=I*R,y.push(U),j.hand=e.hand,j.velocity=e.velocity,e.lastLeaf=j,this.lastLeaf=j,this.lastLeafStep=e,e.velocity=Math.min(2,e.velocity),j.pulse?e.pulse=!0:e.pulse=!1,e.isGeneratedFromPulse=j.isGeneratedFromPulse,N){var G=this.getStep(e);G.velocity*=.8,G.duration*=.6;var W=new A.a(G,U.time+-.4*I,a,T);y.push(W)}}else{if(this.lastLeafStep&&this.lastLeaf&&this.lastLeaf.type){var K=this.lastLeaf.type;K.type===p.b||K.type===p.a&&1===K.value?e.hand=!this.lastLeafStep.hand:e.hand=this.lastLeafStep.hand}this.lastLeaf=j,this.lastLeaf.velocity=0,j.pulse?e.pulse=!0:e.pulse=!1,e.isGeneratedFromPulse=j.isGeneratedFromPulse,this.lastLeafStep=e,this.lastLeafStep.velocity=.5,this.lastLeafStep.wasRest=!0;var Q=Object(h.a)(v,j.leaf,m);this.lastLeafNumber=Q,b&&(this.processLeaf(j,1,Q,r,n),this.analyzePulse(n,j,r,this.tidalNumber))}}var Z=(new Date).getTime();return window.tidalTimes.push(Z-o),y}}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(e){return Object(r.a)({},Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this,e),{cycleRetrigger:this.cycleRetrigger})}},{key:"fromJson",value:function(e,t){this.cycleParameter.set(e.cycle);var r=Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return void 0!==e.cycleRetrigger&&(this.cycleRetrigger=e.cycleRetrigger),r}},{key:"hasAccent",value:function(){var e,t=R(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cycle);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(Array.isArray(n)){if(this.hasAccent(n))return!0}else{if(n.cycle&&this.hasAccent(n.cycle))return!0;if(n.accent)return!0}}}catch(r){t.e(r)}finally{t.f()}return!1}}]),n}(function(e){return function(e){Object(c.a)(n,e);var t=y(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).storedCycle=void 0,e.hijackedCycle=void 0,e.hijackDuration=void 0,e.isHijacking=!1,e.hijackableCounter=0,e.lastHalveningRate=void 0,e.lastHalveningDepth=void 0,e}return Object(i.a)(n,[{key:"clearHijacks",value:function(){console.log("clear hijacks"),this.storedCycle=void 0,this.needsHijackClear=void 0,this.hijackedCycle=void 0,this.hijackedDuration=void 0,this.isHijacking=!1,this.hijackableCounter=0,this.hijackBlock=void 0}},{key:"getLeavesAtStepNumber",value:function(e,t,n){return Object(h.c)({cycle:e,stepNumber:n%t,length:t})}},{key:"isHijackableHere",value:function(e,t,n,r){for(var a=[],i=0;i<8*r;i++)this.getLeavesAtStepNumber(e,t,n+i).forEach(function(e){return a.push(e)});if(0===a.length)return{leaves:[],cycle:e,cycleLength:t};if(1===a[0].type.value)return{leaves:[],cycle:e,cycleLength:t};for(var o=[],s=0,c=0,u=a;c<u.length;c++){var l=u[c],f=l.type,h=f.type,d=f.value;if("."===h)o.push(l);else if("-"===h&&0===d&&l!==a[a.length-1]){var p=a[s+1];o.push(l),o.push(p)}s++}return o.length>=4*r?{leaves:o.slice(0,4*r),cycle:e,cycleLength:t}:o>=2*r?{leaves:o.slice(0,2*r),cycle:e,cycleLength:t}:{leaves:[],cycle:e,cycleLength:t}}},{key:"streamCounters",value:function(e,t,n){var r=this.getLeavesAtStepNumber(e,t,n);if(0===r.length)return!1;var a=r[0],i=e.map(function(e){return e.id}).indexOf(a.id);this._previousLeafNumber>i&&(this._dashCounter=0)}},{key:"streamTidal",value:function(e,t,n){if(this.streamCounters(e,t,n)&&!(this.hijackBlock&&n<this.hijackBlock)){var r=this.isHijackableHere(e,t,n,this.halveningDepth);this.halveningDepth===this.lastHalveningDepth&&this.halveningRate===this.lastHalveningRate||(this.needsHijackClear=!0),this.lastHalveningRate=this.halveningRate,this.lastHalveningDepth=this.halveningDepth;var a=r.leaves;if(t=r.cycleLength,e=r.cycle,0!==a.length)if(this.hijackBlock=n+2*a.length,0!==this.halveningRate){this.hijackableCounter++;var i=b(e,t,a,this.halveningDepth);void 0!==i?(console.log("%s. hijacked=",n,i,e),this.isHijacking=!0,this.hijackedCycle=i):this.isHijacking=!1}else this.isHijacking=!1;else this.isHijacking=!1}}},{key:"halveningDepth",get:function(){return this.jaki.pName("halveningDepth",this.tidalNumber).get()}},{key:"halveningRate",get:function(){return this.jaki.pName("halveningRate",this.tidalNumber).get()}}]),n}(e)}(function(e){Object(c.a)(n,e);var t=k(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).dashCounter=0,e.dotCounter=0,e.dotGroupCounter=0,e.previousLeafNumber=void 0,e.firstAccent=void 0,e}return Object(i.a)(n,[{key:"clearAnalyzer",value:function(){this.dashCounter=0,this.dotCounter=0,this.dotGroupCounter=0,this.previousLeafNumber=0,this.firstAccent=void 0}},{key:"isPulseSource",value:function(){return this.scriptEffect.getPulseSource(),this.scriptEffect&&this.scriptEffect.getPulseSource()===this}},{key:"jaki",get:function(){return this.scriptEffect}},{key:"tidalNumber",get:function(){return this.jaki.tidals.indexOf(this)+1}},{key:"jakiParams",get:function(){return this.jaki.jakiParams}},{key:"dampeningRate",get:function(){return this.jakiParams["dampRate"+this.tidalNumber+"Parameter"].get()}},{key:"processLeaf",value:function(e,t,n,r,a){var i=this.scriptEffect;if(!i)return 1;if(!e.type)return t;this.previousLeafNumber>n&&(this.dashCounter=0),this.previousLeafNumber=n;var o=i.tidals.indexOf(this)+1,s=i.jakiParams,c=s["dampAmount"+o+"Parameter"].get()/100,u=s["dampRate"+o+"Parameter"].get(),l=e.type,f=l.type,h=l.value;return"."===f&&(this.lastLeaf&&"-"==this.lastLeaf.type.type&&(this.dotCounter=0,this.dotGroupCounter++),this.dotGroupCounter%u>0&&(t*=c),this.dotCounter++),"-"===f&&(0===h&&this.dashCounter++,1===h&&(t*=c),this.dashCounter%u>0&&(t*=c)),this.analyzePulse(a,e,r,o),t}},{key:"analyzePulse",value:function(e,t,n,r){if(t){if(t.accent&&void 0===this.firstAccent&&(this.firstAccent=n),void 0===this.firstAccent)return;0===Object(g.a)(n-this.firstAccent,8)&&(this.scriptEffect.pulses[r-1]=n-this.firstAccent)}if(void 0!==this.firstAccent&&this.isPulseSource()){var a=n-this.firstAccent,i=a%8/2;if(i-Math.floor(i)>0)return;var o=Math.floor(n%this.cycleLength/2),s=Object(g.a)(o-i,this.cycleLength),c=Object(g.a)(s+4,this.cycleLength),u=a%8/8,l=e+4*new j.a.Time("16n").toSeconds()-j.a.Master.context.currentTime;this.scriptEffect.sendMessage("pulses",[s,c,u,1e3*l])}}}]),n}(Object(P.a)(Object(x.a)(M.a)))));t.a=q},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=n(139),h=n(116),d=n(240),p=n(23),v=n(6),m=n.n(v);function y(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}var b=n(21),g=n(145),O=n(14),j=n(241);function k(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var S=function(e){Object(c.a)(n,e);var t=x(n);function n(e){var r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2?arguments[2]:void 0;return Object(a.a)(this,n),(r=t.call(this,"Warp",e,s)).stepsWhileInReverse=0,window.warp=Object(o.a)(r),r.lastForwardPercentage=0,i&&(r.enabledParameter=new O.a("enabled",Object(o.a)(r),function(e,t){return r.onEnable(t)},{min:!1,max:!0,unit:"",defaultValue:!0,automatable:!1}),r.registerParameter(r.enabledParameter)),r.warpLengthParameter=new O.a("warpLength",Object(o.a)(r),function(e,t){return[]},{documentation:"Controls the tempo of the sample in proportion to the project tempo. A higher number makes the sample slower, and more time-stretched.",defaultValue:1,min:.05,max:16,unit:"bars",prettyName:"Warp Length"}),r.registerParameter(r.warpLengthParameter),r.warpFactorParameter=new O.a("warpFactor",Object(o.a)(r),function(e,t){return[]},{documentation:"Multiples the Warp Speed by this whole number. A quick way to double or half the sample tempo",defaultValue:2,min:1,max:8,unit:"",prettyName:"Warp Factor"}),r.registerParameter(r.warpFactorParameter),r.glideParameter=new O.a("glide",Object(o.a)(r),function(e,t){return[]},{defaultValue:1,min:0,max:4,unit:"",automatable:!1}),r.registerParameter(r.glideParameter),r.resolutionParameter=new j.a("resolution",Object(o.a)(r),function(e,t){return t},{documentation:"The rate at which we trigger each warped grain.",min:0,max:1,unit:"",prettyName:"Rate",options:{0:new b.a(4,!1),.1:new b.a(4,!0),.2:new b.a(8,!1),.3:new b.a(8,!0),.4:new b.a(16,!1),.5:new b.a(16,!0),.6:new b.a(32,!1),.7:new b.a(32,!0)},defaultValue:new b.a(16,!1)}),r.registerParameter(r.resolutionParameter),r.loopLengthParameter=new O.a("loopLength",Object(o.a)(r),function(e,t){return[]},{documentation:"The % of the sample-loop we will go through before looping back.",defaultValue:100,min:0,max:100,unit:"%",prettyName:"Loop Length"}),r.registerParameter(r.loopLengthParameter),r.durationFactorParameter=new O.a("durationFactor",Object(o.a)(r),function(e,t){return[]},{documentation:"The duration of each grain to be triggered (according to the warp-rate).",defaultValue:1,min:0,max:2,unit:"",prettyName:"Grain Size"}),r.registerParameter(r.durationFactorParameter),r.smoothnessParameter=new O.a("smoothness",Object(o.a)(r),function(e,t){return[]},{documentation:"Controls the attack/release of each grain, smoothing them out. Higher numbers mean smoother transitions (higher attack/release)",defaultValue:1,min:.1,max:20,unit:"",prettyName:"Smoothness"}),r.registerParameter(r.smoothnessParameter),r.sliceRetriggerParameter=new O.a("sliceRetrigger",Object(o.a)(r),function(e,t){return[]},{defaultValue:!0,min:!1,max:!0,unit:"",automatable:!1}),r.registerParameter(r.sliceRetriggerParameter),r.noteToDuration={},r.noteToOriginalDuration={},r.noteToTrigger={},r.stepNumberTriggered=0,r.notes={},r.times=[],r}return Object(i.a)(n,[{key:"documentation",get:function(){return["Syncs a sample to the project tempo, dividing the \nsample into many pieces (according to the warp-rate), and triggering them at this rate.","Track needs to be playing to work."]}},{key:"getVisualizedParameters",value:function(){return[this.resolutionParameter].concat(Object(r.a)(Object(s.a)(Object(l.a)(n.prototype),"getVisualizedParameters",this).call(this)))}},{key:"getText",value:function(){return this.resolutionParameter.get().toString()}},{key:"onEnable",value:function(e){(this.track.sequencerEngine.store.getState().tracks.trackWarps[this.track.subSequence.id]||{})[this.track.trackNumber]!==e&&this.track.sequencerEngine.store.dispatch(Object(p.Ke)(this.track.subSequence.id,this.track.trackNumber,e))}},{key:"releaseAll",value:function(e){this.notes={},this.noteToTrigger={},this.noteToDuration={}}},{key:"isNothingPlaying",value:function(){return y(this.noteToTrigger)&&y(this.notes)}},{key:"input",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(s.a)(Object(l.a)(n.prototype),"input",this).call(this,e,t);var r=e.stepNumber,a=r;e.warpedSteps&&(r=e.warpedSteps.stepNumber,this.warpedFirst=r);var i=e.stepData.transpose,o=e.stepData.slice,c=e.time;if(this.isNothingPlaying()&&this.sliceRetrigger&&(this.stepNumberTriggered=void 0,this.lastLeaf=void 0,this.lastLeafStep=void 0),t)if(this.gated){var u=this.notes[i]||[];u.push({slice:o,time:c}),this.notes[i]=u}else(this.isNothingPlaying()||0==r||this.sliceRetrigger)&&(this.stepNumberTriggered=a,this.stepsWhileInReverse=0),this.releaseAll(),this.notes[i]=[{slice:o,time:c}];else{var f=2*e.stepData.duration;(!this.gated||this.track.rolling&&this.sequencerEngine.isSequenceRolling)&&(this.clear(!1),(this.sliceRetrigger||0===r)&&(this.track.rolling&&this.sequencerEngine.isSequenceRolling||(this.stepNumberTriggered=a,this.stepsWhileInReverse=0))),void 0===this.noteToDuration[i]&&(this.noteToDuration[i]=0),this.noteToDuration[i]=f,this.noteToOriginalDuration[i]=f,this.noteToTrigger[i]=e}}},{key:"getLastTime",value:function(e){for(var t=this.times.length-1;t>=0;t--){var n=this.times[t];if(n<e)return n}return this.times[this.times.length-1]}},{key:"getDurationElapsed",value:function(e){var t=e-(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.stepNumberTriggered);return t<0&&(t+=this.track.length),t}},{key:"output",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.a.Master.context.currentTime,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,o=[];a||this.times.push(t),void 0!==this.warpedFirst&&(n=this.warpedFirst,this.warpedFirst=void 0),this.currentStep=n;var s=this.getDurationElapsed(n);s=isNaN(s)?0:s;var c=Object(d.a)(s,this.resolution);for(var u in this.noteToTrigger){var l=this.noteToTrigger[u];for(var f in void 0===l.offset&&(l.offset=l.time-t),c)this.getTrigger(l.stepData,u,t+c[f].time+l.offset,n,r,l.stepData.slice).forEach(function(e){o.push(e)})}var h=function(s){var u=e.notes[s],l=function(l){var f=u[l],h=f.slice,p=f.offset;if(void 0===p){var v=e.getLastTime(t);p=t-v,u[l].offset=p}if(a){var y,b=k(i);try{var g=function(){var r=y.value,a=r-n,i=Object(d.a)(a,e.resolution),c=a*(new m.a.Time("32n").toMilliseconds()/1e3);i.forEach(function(n){return e.getTrigger(e.track.trackData,s,0===a?void 0:t+c+n.time,r,r,h).forEach(function(t){e.sampler&&0===a&&!e.gated&&e.sampler.releaseAll(m.a.Master.context.currentTime),e.lastTriggerTime=t.time,o.push(t)})})};for(b.s();!(y=b.n()).done;)g()}catch(j){b.e(j)}finally{b.f()}}else for(var O in c)e.getTrigger(e.track.trackData,s,t+c[O].time+p,n,r,h).forEach(function(t){t.time,e.lastTriggerTime;e.lastTriggerTime=t.time,t.stepData.track=e.track,o.push(t)})};for(var f in u)l(f)};for(var p in this.notes)h(p);for(var v in this.noteToDuration)this.gated&&(this.noteToDuration[v]=Math.max(0,this.noteToDuration[v]-1),this.noteToDuration[v]<=0&&(this.track.rolling&&this.sequencerEngine.isSequenceRolling||delete this.noteToTrigger[v]));return o.filter(function(e){return e.stepData.start<=100})}},{key:"addNote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,a=this.getStep(this.track.trackData,e,null,!1);a.velocity=this.track.trackData.velocity,a.duration=null,a.transpose=e,a.slice=t,this.input(new g.a(a,r,n+1),!0)}},{key:"removeNote",value:function(e,t){if(!(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.gated)&&void 0!==this.notes[e]){var n=this.notes[e];this.notes[e].map(function(e){return e.slice}).indexOf(t);n=n.filter(function(e){return e.slice!==t}),this.notes[e]=n,0===this.notes[e].length&&delete this.notes[e]}}},{key:"getStepPercentage",value:function(e,t,n){return 100*this.getDurationElapsed(e,n)/(32*this.getSliceWarpLength(t))/(this.warpLength*this.warpFactor)}},{key:"getSliceWarpLength",value:function(){var e=this.track.tempo,t=this.track.sequencerEngine.bpm;return void 0===e||null===e||0===e?1:e/t}},{key:"getStartTimeLoop",value:function(e,t){var n=this.getStepPercentage(e,0,t),r=this.getSliceLoopLength(0,0);this.getSliceWarpLength();return(0+n/100*r)%this.loopLength}},{key:"getSliceLoopLength",value:function(e,t){var n=void 0;if(this.track.isFrozen||this.track.isAudioTrack){var r,a=k(this.track.frozenColumns);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.frozenSamplers[i.playing]&&(n=i.frozenSamplers[i.playing])}}catch(u){a.e(u)}finally{a.f()}}else if(this.track.instrument&&this.track.instrument.getSampler){var o=this.track.instrument.getSampler(e);o.samplers&&(n=o.samplers[0])}else n=this.track.getSamplers()[0];if(void 0===n)return 8;var s=n.getSlice(t),c=s.endTime-s.startTime;return 100*this.getBarInSeconds()/c}},{key:"getBarInSeconds",value:function(){return 64*new m.a.Time("32n").toMilliseconds()/1e3}},{key:"isLoop",value:function(){return this.track&&this.track.pattern.length()<=128}},{key:"getTrigger",value:function(e,t,n,r,a,i){if(this.track){var o=this.track.sequencerEngine.stepNumberOffset||0;if(r+=o,a+=o,this.isLoop()){var s=this.track.pattern.length();r%=s,a%=s}}var c;void 0===this.stepNumberTriggered&&(this.gated||this.sliceRetrigger||this.isNothingPlaying())&&(this.stepNumberTriggered=r,this.stepsWhileInReverse=0),t=parseFloat(t);var u=this.gated&&e.duration<1?e.duration:1,l=this.getStep(e,t,u,!0);if(this.track.sequencerEngine.reverse){var f=this.getSliceLoopLength(t,i);c=this.getStepPercentage(r,i,this.lastForwardStepNumber);var h=100-this.lastForwardStart,d=(this.getSliceWarpLength(),h+c/100*f);l.start=d%this.loopLength,this.lastReverseStart=l.start,this.stepsWhileInReverse+=2}else{if(c=this.getStepPercentage(r,i),this.stepsWhileInReverse>0)c-=2*this.getStepPercentage(this.stepsWhileInReverse,i);this.getSliceLoopLength(t,i);this.lastForwardStepNumber=r,l.start=c*this.getSliceLoopLength(t,i)/100%this.loopLength,this.lastForwardStart=l.start}return l.slice=i,l.duration*=this.durationFactor,l.attack+=8*this.smoothness,0===c?l.attack/=2:l.attack*=2,void 0===this.track.instrument&&(l.release+=2*this.smoothness),[new g.a(l,n,a)]}},{key:"sampler",get:function(){return this.track.getSamplers()[0]}},{key:"gated",get:function(){return!this.track.isFrozen&&!this.track.isAudioTrack&&this.track.gated}},{key:"isRealTime",value:function(){return!0}},{key:"onNewStep",value:function(){}},{key:"clear",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.noteToDuration={},this.noteToTrigger={},e&&(this.stepNumberTriggered=void 0,this.stepsWhileInReverse=0),this.notes={},this.times=[]}},{key:"durationFactor",get:function(){return this.durationFactorParameter.get()},set:function(e){return this.durationFactorParameter.set(e)}},{key:"glide",get:function(){return this.glideParameter.get()},set:function(e){return this.glideParameter.set(e)}},{key:"warpFactor",get:function(){return this.warpFactorParameter.get()},set:function(e){return this.warpFactorParameter.set(e)}},{key:"warpLength",get:function(){return this.warpLengthParameter.get()},set:function(e){return this.warpLengthParameter.set(e)}},{key:"loopLength",get:function(){return this.loopLengthParameter.get()},set:function(e){return this.loopLengthParameter.set(e)}},{key:"smoothness",get:function(){return this.smoothnessParameter.get()},set:function(e){return this.smoothnessParameter.set(e)}},{key:"resolution",get:function(){return(new b.a).fromJson(this.resolutionParameter.get())},set:function(e){return this.resolutionParameter.set(e)}},{key:"sliceRetrigger",get:function(){return this.sliceRetriggerParameter.get()},set:function(e){return this.sliceRetriggerParameter.set(e)}},{key:"getNextTriggerStep",value:function(e){var t=32/this.resolution.resolution;return e+(t-e%t)}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"fromJson",value:function(e,t){var r=Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(h.a)(this.resolutionParameter,new b.a(16,!1).fromJson(e.resolution),r),r}}]),n}(f.a);t.a=S},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(139),f=n(14),h=n(128),d=n(116);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var v=function(e){return function(e){Object(s.a)(n,e);var t=p(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"initValueParameter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:13,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.valueParameter=new f.b("value",this,function(){return 0},{min:e,max:t,defaultValue:n}),this.registerParameter(this.valueParameter)}},{key:"value",get:function(){return this.valueParameter.get()},set:function(e){this.valueParameter.set(e,!1,!1)}},{key:"fromValueJson",value:function(e){var t={};return Object(d.a)(this.valueParameter,e.value,t),Object(r.a)({},t,Object(h.a)(e,"valueParameter",this.valueParameter))}},{key:"getValueJson",value:function(){var e={value:this.value};return e=Object(h.b)(e,"valueParameter",this.valueParameter)}}]),n}(e)};function m(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}n.d(t,"a",function(){return g}),n.d(t,"d",function(){return O}),n.d(t,"e",function(){return j}),n.d(t,"b",function(){return k}),n.d(t,"f",function(){return w}),n.d(t,"g",function(){return x}),n.d(t,"c",function(){return S});var g=1,O=2,j=3,k=function(e){Object(s.a)(n,e);var t=b(n);function n(e,r){var i;return Object(a.a)(this,n),(i=t.call(this,"Chord Type",e,1)).numeral=r,i.nextChords={},i}return Object(i.a)(n,[{key:"onNewStep",value:function(){this.active=!1,Object(o.a)(Object(u.a)(n.prototype),"onNewStep",this).call(this)}},{key:"output",value:function(){return this.active=this.triggers.length>0,this.triggers||[]}},{key:"getChordEffectType",value:function(){return g}},{key:"getJson",value:function(){return Object(r.a)({},Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{numeral:this.numeral})}},{key:"fromJson",value:function(e){Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e),this.numeral=e.numeral}},{key:"prettyName",get:function(){switch(this.numeral){case 1:return"I";case 2:return"II";case 3:return"III";case 4:return"IV";case 5:return"V";case 6:return"VI";case 7:return"VII";default:return"All Chords"}}}]),n}(l.a),w=function(e){Object(s.a)(n,e);var t=b(n);function n(e,r){var i;return Object(a.a)(this,n),(i=t.call(this,"Voice",e,2)).initValueParameter(0,13,r),i}return Object(i.a)(n,[{key:"degree",get:function(){return this.value},set:function(e){return this.value=e}},{key:"getText",value:function(){return""}},{key:"onNewStep",value:function(){this.active=!1,Object(o.a)(Object(u.a)(n.prototype),"onNewStep",this).call(this)}},{key:"output",value:function(){var e=this.triggers||[];this.active=e.length>0;var t,n=m(e);try{for(n.s();!(t=n.n()).done;){var r,a=t.value,i=m(a.stepData.voices);try{for(i.s();!(r=i.n()).done;){var o=r.value;void 0===o.voice&&(o.voice=this.degree)}}catch(s){i.e(s)}finally{i.f()}a.stepData.voices.push({voice:this.degree})}}catch(s){n.e(s)}finally{n.f()}return e}},{key:"getJson",value:function(){return Object(r.a)({},Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this),Object(o.a)(Object(u.a)(n.prototype),"getValueJson",this).call(this))}},{key:"fromJson",value:function(e){Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e),e.value=e.degree,this.fromValueJson(e)}},{key:"getChordEffectType",value:function(){return O}},{key:"prettyName",get:function(){switch(this.degree){case 1:return"1st";case 2:return"2nd";case 3:return"3rd";default:return this.degree+"th"}}}]),n}(v(l.a)),x=function(e){Object(s.a)(n,e);var t=b(n);function n(e,r,i,o,s){var c;return Object(a.a)(this,n),(c=t.call(this,e,r,1)).initValueParameter(i,o,s),c}return Object(i.a)(n,[{key:"onNewStep",value:function(){this.active=!1,Object(o.a)(Object(u.a)(n.prototype),"onNewStep",this).call(this)}},{key:"getText",value:function(){return void 0!==this.value?this.value:""}},{key:"transform",value:function(e){return e}},{key:"getChordEffectType",value:function(){return j}},{key:"fromJson",value:function(e){Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e),this.fromValueJson(e)}},{key:"getJson",value:function(){return Object(r.a)({},Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this),Object(o.a)(Object(u.a)(n.prototype),"getValueJson",this).call(this))}}]),n}(v(l.a)),S=function(e){Object(s.a)(n,e);var t=b(n);function n(e){return Object(a.a)(this,n),t.call(this,"Octave",e,-4,4,-1)}return Object(i.a)(n,[{key:"output",value:function(){var e=this,t=this.triggers||[];this.active=t.length>0;var n,r=m(t);try{for(r.s();!(n=r.n()).done;){var a=n.value,i=a.stepData.voices.filter(function(e){return void 0===e.octave});if(i.length>0)i.forEach(function(t){return t.octave=e.value});else{var o=a.stepData.voices[0]||{voice:1};o.octave=this.value,a.stepData.voices.push(o)}}}catch(s){r.e(s)}finally{r.f()}return t}},{key:"transform",value:function(e){return e+12*this.value}}]),n}(x)},,,,function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(4),o=n(5),s=n(10),c=n(7),u=n(8),l=n(2),f=n(14),h=n(130),d=n(630),p=n(212),v=n(380),m=n(23);function y(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}t.a=function(e){return function(e){Object(c.a)(n,e);var t=g(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a)))._parameters=[],e.initialParameterValues=[],e.initialParameterDepths=[],e.depthParameters=[],e}return Object(o.a)(n,[{key:"setupNodeMessaging",value:function(){var e=this;this.newInlet(h.g,function(){e.stop(),e.clear()})}},{key:"newDepthParameter",value:function(e){var t=new f.a("depth",this,function(e,t){return t},{units:"%",min:0,max:100,defaultValue:100});return this.context&&t.setContext(this.context),this.registerParameter(t),t}},{key:"getDepth",value:function(e){return this.depthParameters[e]?this.depthParameters[e].get():0}},{key:"setupRampParameters",value:function(){this.rampTimeParameter=new f.a("rampTime",this,function(e,t){return t},{documentation:"Time it takes (in ms) to reach the value its adding",min:0,max:1e4,defaultValue:80}),this.registerParameter(this.rampTimeParameter),this.resetAtZeroParameter=new f.a("resetAtZero",this,function(e,t){return t},{documentation:"Should the accumulator reset to 0 upon reaching step 1 in the pattern",min:0,max:1,defaultValue:!1}),this.registerParameter(this.resetAtZeroParameter),this.initDisabledParameters()}},{key:"getInitialValueForParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._parameters.indexOf(e);return this.initialParameterValues[t]}},{key:"setInitialValueForParameter",value:function(e,t){var n=this._parameters.indexOf(e);this.initialParameterValues[n]=t}},{key:"shouldSkipParameter",value:function(e){return!1}},{key:"resetValues",value:function(){var e={};for(var t in this._parameters)if(!this.shouldSkipParameter(t)){var n=this._parameters[t];if(void 0!==this.initialParameterValues[t]){var r=this.initialParameterValues[t];if((r<n.min||r>n.max)&&(r=(n.min+n.max)/2),n._wasDisposed)continue;var a=n.set(r,!0,!0);if(e[a.id]=a.value,n.depthParameter){var i=n.depthParameter,o=this.initialParameterDepths[t];if(void 0===o)continue;(o<i.min||o>i.max)&&(o=(i.min+i.max)/2),isNaN(o)||(e[(a=i.set(o,!0,!0)).id]=a.value)}else isNaN(this.initialParameterDepths[t])?n.depth=1:n.depth=this.initialParameterDepths[t]}}this.setEffectParameterValues(e)}},{key:"setEffectParameterValues",value:function(e){this.track.sequencerEngine.dispatch(Object(m.xb)(e))}},{key:"stop",value:function(){this.resetValues(),this.D=void 0}},{key:"unmap",value:function(e){var t=this._parameters.indexOf(e);this.unmapParameter(t)}},{key:"unmapParameter",value:function(e){var t=this._parameters[e];if(t){t.locked=void 0,this._parameters.splice(e,1),this._parameters=Object(a.a)(this._parameters);var n=this.depthParameters[e];this.depthParameters.splice(e,1);var r=this.parameters.indexOf(n);this.parameters.splice(r,1),this.onParameterUnmapped(t);var i=this.initialParameterValues[e];return this.initialParameterValues.splice(e,1),void 0!==i&&t.set(i,!0,!1),t[this.key]=void 0,t}}},{key:"onParameterUnmapped",value:function(){}},{key:"key",get:function(){return"isMapped"}},{key:"setParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._parameters.length;this._parameters[t]=e,this.initialParameterValues[t]=e.get(!0),this.depthParameters[t]||(this.depthParameters[t]=this.newDepthParameter(e)),e[this.key]=this,this.onParameterMapped&&this.onParameterMapped(e)}},{key:"_clear",value:function(){for(var e in this.initialParameterValues=[],this._parameters)if(!this.shouldSkipParameter(e)){var t=this._parameters[e];this.clearParameter(t)}}},{key:"clearParameter",value:function(e,t){this._clearParameter(e,t)}},{key:"_clearParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._parameters.indexOf(e);if(e){var n=e.get(!0);if(n>=e.max?e.max=n:n<=e.min&&(e.min=n),this.initialParameterValues[t]=n,e.depthParameter){var r=e.depthParameter.get(!0);isNaN(r)?this.initialParameterDepths[t]=1:this.initialParameterDepths[t]=r}else this.initialParameterDepths[t]=e.depth}}},{key:"resetAtZero",get:function(){return this.resetAtZeroParameter.get()}},{key:"rampTime",get:function(){return this.rampTimeParameter.get()}},{key:"onNewStep",value:function(){this.triggers.length>0&&(this.triggers.length=0)}},{key:"clear",value:function(){Object(s.a)(Object(l.a)(n.prototype),"clear",this).call(this),this._clear()}},{key:"getParameterValueToSet",value:function(e){return 0}},{key:"setParameterValues",value:function(e){var t={};for(var n in this._parameters)if(n=parseInt(n),!this.parametersDisabled.includes(n)){var a=this.getParameterValueToSet(n),i=this._parameters[n];if(!isNaN(a)&&i.get(!0)!==a){var o=i.max,s=i.min,c=i.set(Math.min(o,Math.max(s,a)),!0,!0,e,this.rampTime/1e3),u=c.id,l=c.value;t[u]=l}}this.track.sequencerEngine.parametersToUpdate=Object(r.a)({},this.track.sequencerEngine.parametersToUpdate,t)}},{key:"loadParameters",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=((new Date).getTime(),{}),i=this.track&&this.track.subSequence;if(!e||this.subSequence&&!this.subSequence.tracks){if(!this.subSequence.getRootSubSequence)return{lostParameters:[],newMappings:r};i=this.subSequence.getRootSubSequence()}var o,s=this.track.sequencerEngine,c=[],u=y(e);try{var l=function(){var e=o.value,u="object"===typeof e?e.id:e,l=void 0;"BPM"===e.name&&(l=s.bpmParameter);var f=s.idToParameter[u];if(!(l=f||s.parameters.find(function(e){return e.id===u}))){var h,p=y(t.track.getAllParameters?[t.track].concat(Object(a.a)(i.tracks.filter(function(e){return e!==t.track}))):i.tracks);try{var v=function(){var e=h.value.getAllParameters(),t=[];e.forEach(function(e){t.push(e),e.depthParameter&&t.push(e.depthParameter)});var n=t.find(function(e){return u===e.id});if(n)return l=n,"break"};for(p.s();!(h=p.n()).done;){if("break"===v())break}}catch(Z){p.e(Z)}finally{p.f()}var m=i.pattr.getNestedParameters().find(function(e){return e.id===u});m&&(l=m);for(var b=0,g=[].concat(Object(a.a)(i.zObjects),Object(a.a)(i.zMessages));b<g.length;b++){var O=g[b].getAllParameters().find(function(e){return u===e.id});if(O){l=O;break}}if(!l){var j,k=y(i.lfos);try{for(k.s();!(j=k.n()).done;){var w=j.value,x=(w=w.lfo).parameters.find(function(e){return u===e.id});if(x){l=x;break}}}catch(Z){k.e(Z)}finally{k.f()}if(!l){var S,P=y(i.tracks);try{for(P.s();!(S=P.n()).done;){var E=S.value;if(E.lfosTrack){var T,A=y(E.lfosTrack.lfos);try{for(A.s();!(T=A.n()).done;){var M=T.value,R=(M=M.lfo).parameters.find(function(e){return u===e.id});if(R){l=R;break}}}catch(Z){A.e(Z)}finally{A.f()}}}}catch(Z){P.e(Z)}finally{P.f()}}}if(!l){var C,N=y(t.track.sequencerEngine.subSequences);try{for(N.s();!(C=N.n()).done;){var I=C.value,q=[].concat(Object(a.a)(I.midiEffects.shadowEffects),Object(a.a)(I.midiEffects.effects),[I.playhead]),_=[].concat(Object(a.a)(I.pads.flatMap(function(e){return e.getParameters().flatMap(function(e){return e.depthParameter?[e,e.depthParameter]:e})})),Object(a.a)(q.flatMap(function(e){return e.getParameters()})),[I.midiEffects.transposeParameter],Object(a.a)(I.pads.filter(function(e){return e.fxMacro}).map(function(e){return e.fxMacro.macroParameter})));if(l=_.find(function(e){return u===e.id}))break}}catch(Z){N.e(Z)}finally{N.f()}}if(!l){var D=s.sends.sends.flatMap(function(e){return e.effects}).flatMap(function(e){return e.getParameters()});l=D.find(function(e){return u===e.id})}if(!l){var F,L=y(i.envelopes);try{for(L.s();!(F=L.n()).done;){var B=F.value.parameters.find(function(e){return u===e.id});if(B){l=B;break}}}catch(Z){L.e(Z)}finally{L.f()}var z,J=y(i.tracks);try{for(J.s();!(z=J.n()).done;){var V=z.value;if(V.envelopesTrack){var H,U=y(V.envelopesTrack.envelopes);try{for(U.s();!(H=U.n()).done;){var G=H.value,W=(G=G.envelope).parameters.find(function(e){return u===e.id});if(W){l=W;break}}}catch(Z){U.e(Z)}finally{U.f()}}}}catch(Z){J.e(Z)}finally{J.f()}}if(!l){var K=s.channelMixer.masterChannel.effectsChain.effects.flatMap(function(e){return e.getParameters().flatMap(function(e){return e.depthParameter?[e,e.depthParameter]:e})}).find(function(e){return u===e.id});K&&(l=K)}if(!l&&!n&&"object"===typeof e&&(l=Object(d.a)(e,t.track,t.track.sequencerEngine))){r[u]=l;var Q=e.coordinates;Q.x,Q.y}}if(l&&l.name.includes("Phase"))return"continue";l?t.setParameter(l):c.push(e)};for(u.s();!(o=u.n()).done;)l()}catch(f){u.e(f)}finally{u.f()}this.sortParameters(),this.zObject&&this.zObject.attributes["scripting name"];(new Date).getTime();return{lostParameters:c,newMappings:r}}},{key:"sortParameters",value:function(){var e=this;if(this.parametersJson){var t=this.parametersJson.map(function(t,n){var r=t.id;return e._parameters.find(function(e){return e&&e.id===r})}).filter(function(e){return e});this._parameters=t}}},{key:"loadDepthJson",value:function(e,t){if(e.depthParameters){var n,r=0,a=y(e.depthParameters);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=this.newDepthParameter();o.fromJson(i,this.track.sequencerEngine,t),this.depthParameters[r++]=o}}catch(s){a.e(s)}finally{a.f()}}}},{key:"getMappableJson",value:function(e){return{parameters:this._parameters.map(function(t){return{id:t.id,context:e?t.context&&t.context.getJson():void 0,name:e?t.name:void 0,coordinates:t.getCoordinates()}}),depthParameters:this.depthParameters.map(function(e){return e.getJson()})}}},{key:"getJson",value:function(e){return Object(r.a)({},Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this,e),this.getMappableJson(e))}},{key:"fromJson",value:function(e,t){if(!e.parameters)return{};delete e.depth,this.parametersJson=e.parameters;var r=Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return this.lostParameters=this.loadParameters(e.parameters,!0).lostParameters,this.loadDepthJson(e,t),r}},{key:"randomlyMapParameters",value:function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,a=[],i=y(arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(v.c)(e,this));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(o.context&&o.context.formant)if(!o.context.formant.enabledParameter.get())continue;a.push(o)}}catch(s){i.e(s)}finally{i.f()}return Object(p.a)(a),(a=(a=Array.from(new Set(a))).slice(0,r)).forEach(function(e){return n.setParameter(e)}),a}},{key:"dispose",value:function(){for(;this._parameters.length>0;)this.unmapParameter(0);Object(s.a)(Object(l.a)(n.prototype),"dispose",this)&&Object(s.a)(Object(l.a)(n.prototype),"dispose",this).call(this)}},{key:"replaceParameter",value:function(e){for(var t in this._parameters)if(this._parameters[t].id===e.id)return void(this._parameters[t]=e)}},{key:"shouldOutputSkip",value:function(e,t){return 0===t&&this.resetAtZero?(this.stop(),this.clear(),!0):0===this.triggers.length}}]),n}(e)}},function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(4),o=n(5),s=n(10),c=n(7),u=n(8),l=n(2),f=n(17),h=n(609),d=n(128),p=n(123),v=n(382);function m(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}t.a=function(e){return function(e){Object(c.a)(n,e);var t=b(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).effects=[],e.adjacencyLists={},e.inputNode={id:-1,x:0,y:200},e.outputNode={id:-2,x:600,y:200},e}return Object(o.a)(n,[{key:"nodes",get:function(){return this.effects}},{key:"getSubDevices",value:function(){return this.effects.map(function(e){return{value:e,label:e.name}})}},{key:"getSubDeviceIndex",value:function(e){return this.effects.indexOf(e)}},{key:"getSubDevice",value:function(e){return this.effects[e]}},{key:"getParameters",value:function(){if(!this.parameters)return[];var e=Object(a.a)(this.parameters);for(var t in this.effects)e=[].concat(Object(a.a)(e),Object(a.a)(this.effects[t].getParameters()));return e}},{key:"lfoAdjacencyLists",get:function(){return this.getModAdjacencyLists(f.b)}},{key:"envelopeAdjacencyLists",get:function(){return this.getModAdjacencyLists(f.a)}},{key:"getModAdjacencyLists",value:function(e){var t=this,n=[].concat(Object(a.a)(this.sequencerEngine.lfos.map(function(e){return e.lfo})),Object(a.a)(this.sequencerEngine.envelopes)).filter(function(t){return t.getType()===e}),r={},i=function(a){var i=n[a],o=t.getParameters().filter(function(e){return e.lfos&&e.envelopes}).filter(function(t){return e===f.b?t.lfos.indexOf(i)>-1:t.envelopes.indexOf(i)>-1});if(0===o.length)return"continue";r[i.number]=o};for(var o in n)i(o);return r}},{key:"registerContext",value:function(e){var t=this;Object(s.a)(Object(l.a)(n.prototype),"registerContext",this).call(this,e),this.effects.forEach(function(n){return n.registerContext(e,t)})}},{key:"modulators",get:function(){return[].concat(Object(a.a)(this.sequencerEngine.lfos.map(function(e){return e.lfo})),Object(a.a)(this.sequencerEngine.envelopes))}},{key:"setSize",value:function(e,t,n,r){this.inputNode.x=0,this.inputNode.y=t/2-r/2,this.outputNode.x=e-n,this.outputNode.y=t/2-r/2}},{key:"addEffect",value:function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.x||(e.x=200,e.y=200);var t=(this.context||new p.a).getCopy();t.forEffect(this),e.registerContext(t,this),this.effects=[].concat(Object(a.a)(this.effects),[e]),e.rack=this}},{key:"deleteEffect",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.adjacencyLists[e.id]||[];for(var i in Object(a.a)(r).forEach(function(e){return t.deleteEdge(e)}),delete this.adjacencyLists[e.id],this.adjacencyLists)(r=this.adjacencyLists[i].filter(function(t){return t.effect===e})).forEach(function(e){return t.deleteEdge(e)});for(var o in this.lfoAdjacencyLists)void 0!==this.lfoAdjacencyLists[o]&&(r=this.lfoAdjacencyLists[o].filter(function(t){return e.parameters.indexOf(t)>-1})).forEach(function(e){return t.deleteEdge(e)});for(var s in this.envelopeAdjacencyLists)void 0!==this.envelopeAdjacencyLists[s]&&(r=this.envelopeAdjacencyLists[s].filter(function(t){return e.parameters.indexOf(t)>-1})).forEach(function(e){return t.deleteEdge(e)});n&&e.dispose(),this.effects.splice(this.effects.indexOf(e),1)}},{key:"deleteEdge",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.macro){var n=e.parameter;e.macro.unmapParameter(n,!1)}else if(e.modulator){var r=e.edge,a=e.modulator;a.getType()===f.b?r.disconnectFromLFO(a):r.disconnectFromEnvelope(a)}else for(var i in this.adjacencyLists){var o=this.adjacencyLists[i],s=o.indexOf(e);s>-1&&o.splice(s,1)}e.dispose&&t&&e.dispose()}},{key:"getLFO",value:function(e){return this.modulators.filter(function(e){return e.getType()===f.b}).find(function(t){return t.number===e})}},{key:"getEnvelope",value:function(e){return this.modulators.filter(function(e){return e.getType()===f.a}).find(function(t){return t.number===e})}},{key:"connectEdge",value:function(e,t){var n=void 0;return t.fromNode=e,n=e.effectNode||e.track?e.id:-1,void 0===this.adjacencyLists[n]&&(this.adjacencyLists[n]=[]),this.adjacencyLists[n].push(t),t}},{key:"connectNodes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inputNode,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.outputNode,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.isMacro(e))this.connectNodeToMacro(t,e);else if(e.getType)t.isAudioParamEnabled&&!t.isAudioParamEnabled()&&t.enableAudioParam(),e.getType()===f.b&&t.connectToLFO?t.connectToLFO(e):t.connectToEnvelope&&t.connectToEnvelope(e);else if(!t.isAudioParamEnabled){if(this.adjacencyLists[e.id]&&this.adjacencyLists[e.id].some(function(e){return e.effect===t}))return;var r=this.newEdge(t,n);return this.connectEdge(e,r),r}}},{key:"newEdge",value:function(e,t){return new v.a(e,this.sequencerEngine,t)}},{key:"getRackJson",value:function(){var e=this,t={},a=function(n){var r=e.adjacencyLists[n].map(function(t){return t.getJson(e)});if(-1===parseInt(n))t[n]=r;else{var a=e.effects.find(function(e){return e.id===n});t[e.effects.indexOf(a)]=r}};for(var i in this.adjacencyLists)a(i);this.saveCurrentConfiguration();var o=Object(r.a)({},Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this),o,{configurations:this.getConfigurationJson(),outputPosition:{x:this.outputNode.x,y:this.outputNode.y},currentConfiguration:this.currentConfiguration,macros:this.macros.map(function(e){return e.getJson()}),adjacencyLists:t,effects:this.effects.map(function(e){return Object(r.a)({},e.getJson(),{_x:e.x,_y:e.y})})});return o=Object(d.b)(o,"configurationParameter",this.configurationParameter)}},{key:"fromRackJson",value:function(e,t){this.loaded=!1,e.outputPosition&&(this.outputNode.x=e.outputPosition.x,this.outputNode.y=e.outputPosition.y),e.configurations&&this.loadConfigurationJson(e.configurations);var n=e.adjacencyLists;for(var r in n){var a=this.effects[r];for(var i in a||(a=this.inputNode),n[r]){var o=this.newEdge(void 0);o.fromJson(n[r][i],this),this.connectEdge(a,o)}}if(void 0!==e.currentConfiguration&&(this.currentConfiguration=e.currentConfiguration),this.loadParameterFromJson(e,"configurationParameter",this.configurationParameter,t),e.macros){var s=this.getParameters();for(var c in e.macros){var u=this.context||new p.a;this.newMacro(u.getCopy().forEffect(this)).fromJson(e.macros[c],s)}}this.loaded=!0}},{key:"pasteNodes",value:function(e){var t,n=e.map(function(e){return e.getEffectCopy()}),r=m(n);try{for(r.s();!(t=r.n()).done;){var a=t.value;this.addEffect(a);var i=Object(h.a)(e[0].x,e[0].y,this),o=i.x,s=i.y;a.x=o,a.y=s}}catch(y){r.e(y)}finally{r.f()}for(var c in e){var u=this.adjacencyLists[e[c].id];if(u){var l,f=n[c],d=m(u);try{for(d.s();!(l=d.n()).done;){var p=l.value,v=e.indexOf(p.effect);v>-1?this.connectNodes(f,n[v]):this.connectNodes(f,p.effect)}}catch(y){d.e(y)}finally{d.f()}}}}},{key:"connectNodesInSeries",value:function(e){e.sort(function(e,t){return e.x-t.x});var t,n=void 0,r=m(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n&&this.connectNodes(n,a),n=a}}catch(i){r.e(i)}finally{r.f()}}},{key:"clearRack",value:function(){var e=this;this.effects.forEach(function(t){return e.deleteEffect(t,!1)})}}]),n}(e)}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(383);function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=u(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).macros=[],e}return Object(a.a)(n,[{key:"connectNodeToMacro",value:function(e,t){e&&e.isParameter&&t.addParameter(e)}},{key:"isMacro",value:function(e){return this.macros.indexOf(e)>-1}},{key:"deleteMacro",value:function(e){var t=this.macros.indexOf(e);this.macros.splice(t,1),e.dispose()}},{key:"newMacro",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.context,t="Macro "+(this.macros.length+1),n=new c.a(t,this.sequencerEngine,e);return this.macros.push(n),n}},{key:"macroAdjacencyLists",get:function(){var e={};for(var t in this.macros){var n=this.macros[t],r=n.subMacros;e[n.id]=r}return e}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"c",function(){return u}),n.d(t,"a",function(){return h}),n.d(t,"b",function(){return d});var r=n(11),a=n(1),i=n(150),o=function e(t,n,r){for(var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=r/function(e){e.cycleLength;for(var t=0,n=0;n<e.length;n++){var r=e[n];Array.isArray(r)&&void 0!==r.cycleLength?t+=r.cycleLength:t++}return t}(t),l=0,f=[];l<t.length;l++){var h=u*(t[l].cycleLength||1);if(null!==t[l]&&Array.isArray(t[l]))n>=Math.floor(o)&&n<o+h&&e(t[l],n,h,o,s).forEach(function(e){return f.push(e)});else if(t[l]&&t[l].cycle){if(n>=o&&n<o+h){var d=!0;if("/"===t[l].operator&&(d=s%t[l].operand===0),d){var p="^"===t[l].operator?t[l].operand:0;e(t[l].cycle,n,h,o,s,p).forEach(function(e){return f.push(e)})}}}else if(n==Math.floor(o)){var v=!0;"/"===t[l].operator&&(v=s%t[l].operand===0),v&&f.push(Object(a.a)({},t[l],{outputNumber:t[l].operator===i.a?t[l].operand:c,offset:o-Math.floor(o),duration:h/2,cycle:t[l].id,leaf:t[l]}))}t[l].cycleLength;o+=h}return f},s=function(e){return e.stepNumber},c=function(e){return e.length},u=function(e){return o(l(e.cycle),s(e)%c(e),c(e),0,Math.floor(s(e)/c(e)))},l=function e(t){for(var n=[],a=t.cycleLength,i=0;i<t.length;i++)Array.isArray(t[i])?n.push(e(t[i])):n=[].concat(Object(r.a)(n),Object(r.a)(f(t[i])));return n.cycleLength=a,n},f=function(e){var t=void 0,n=e.operator,r=e.operand,i=(e.transpose,e.cycle);if(t=i?l(i):e,"*"===n){for(var o=[],s=0;s<r;s++)o.push(t);return o}if("^"===n){for(var c=[],u=0;u<r;u++)c.push(Object(a.a)({},t,{factor:(u+1)/(r+1)}));return c}return[e]},h=function(e,t,n){for(var r=e.flat(16),a=0;a<r.length;a++){if(r[a].id===t.id)return a}return-1},d=function(e,t,n){for(var r=e.flat(16),a=-1,i=-1,o=-1,s=0;s<r.length;s++){var c=r[s];if(-1===o&&null!==t.transpose&&(o=s),c.id!==t.id){if(null!==c.transpose&&-1!==a){i=s;break}}else a=s}return-1===i?o+r.length-a:(i-a)*(n/e.length/2)}},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return o});var r=n(108),a=n(114),i=function(e){var t=Object(r.a)(e,3),n=t[0],i=t[1],o=t[2];return Object(a.R)({stepData:n,stepNumber:i,time:o})},o=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.duration,r=arguments.length>3?arguments[3]:void 0;return function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];o[0];var c=o[1],u=o[2],l=o[3];r&&(u=r);var f=l.getStep(e);return f.transpose=a.A.apply(void 0,[t].concat(o)),f.duration=a.A.apply(void 0,[n].concat(o)),Object(a.R)({stepData:f,time:u,stepNumber:c})}}},function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"b",function(){return o});var r=n(114),a=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t.reduce(function(e,t){return r.A.apply(void 0,[t].concat(n))+e},0)}},i=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t.reduce(function(e,t){return r.A.apply(void 0,[t].concat(n))*e},1)}},o=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var o=r.A.apply(void 0,[e].concat(a)),s=r.A.apply(void 0,[t].concat(a));return(o%s+s)%s}}},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return u});n(272);var r=n(162),a={A:"a","A#":"A",B:"b",C:"c","C#":"C",D:"d","D#":"D",E:"e",F:"f","F#":"F",G:"g","G#":"G"},i={A:r.a.utils.asciiToHex("a"),"A#":r.a.utils.asciiToHex("A"),B:r.a.utils.asciiToHex("b"),C:r.a.utils.asciiToHex("c"),"C#":r.a.utils.asciiToHex("C"),D:r.a.utils.asciiToHex("d"),"D#":r.a.utils.asciiToHex("D"),E:r.a.utils.asciiToHex("e"),F:r.a.utils.asciiToHex("f"),"F#":r.a.utils.asciiToHex("F"),G:r.a.utils.asciiToHex("g"),"G#":r.a.utils.asciiToHex("G")},o={};for(var s in i)o[i[s]]=s;for(var c in o={},a)o[a[c]]=c;var u=o},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return i});var r=n(6),a=n.n(r),i=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.a.Master.context.sampleRate,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise(function(a,i){new FormData;var o=new Worker(window.isNFT?"recorderWorker.js":"/recorderWorker.js");o.postMessage({command:"init",config:{sampleRate:n,numChannels:t.length}}),o.onmessage=function(t){var n,i=t.data,o=new FileReader;o.onload=function(){n=this.result,a(r?n:new e(n))},o.readAsArrayBuffer(i)},o.postMessage({command:"record",buffer:t}),o.postMessage({command:"exportWAV",type:"audio/wav"})})}}).call(this,n(110).Buffer)},function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"b",function(){return u});var r=n(42),a=n.n(r),i=n(56),o=n(433),s={},c=function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!s[n]){e.next=2;break}return e.abrupt("return",s[n]);case 2:return r=void 0,e.prev=3,console.log("guessing"),e.next=7,Object(o.a)(t);case 7:r=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),r={onset:0,tempo:120,bpm:120,error:e.t0};case 13:return s[n]=r,e.abrupt("return",r);case 15:case"end":return e.stop()}},e,null,[[3,10]])}));return function(t,n){return e.apply(this,arguments)}}(),u=function(){}},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return o});var r=n(201),a=n(136);Object(r.a)("rewind",{distance:"how many triggers to rewind by"},"Rewinds the parameter values to distance-many triggers ago");var i=function(e){return function(t,n,r,a,i){var o=i[i.length-e];return o||t}};Object(r.a)("reset",{},"Resets the parameter state to the initial values");var o=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function(t,n,r,i,o,s,c){if(o[0]){if(e){var u={};return Object.keys(t).forEach(function(e){return u[e]=o[0][e]}),u}return c&&Object(a.c)("planarReset",c.id),o[0]}return t}}},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(7),s=n(8),c=n(2),u=n(116),l=n(128);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(o.a)(n,e);var t=f(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).parameters=[],e}return Object(i.a)(n,[{key:"registerParameter",value:function(e){this.store&&e.setStore(this.store),this.parameters.push(e)}},{key:"getParameters",value:function(){return this.parameters.filter(function(e){return e})}},{key:"getJson",value:function(){var e={name:this.name,id:this.id,x:this.x,y:this.y};for(var t in this.parameters){var n=this.parameters[t];if(n){e[n.name]=n.get();var r=n.name+"Parameter";e=Object(l.b)(e,r,n,this.sequencerEngine)}}return e}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];void 0===e.id||t||(this.id=e.id),void 0!==e.x&&(this.x=e.x,this.y=e.y);var n={};for(var a in this.parameters){var i=this.parameters[a];if(i){var o=e[i.name];void 0!==o&&null!==o&&Object(u.a)(i,o,n),n=Object(r.a)({},n,Object(l.a)(e,i.name+"Parameter",i,this.sequencerEngine,t))}}return n}}]),n}(e)}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=c(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"registerPresetManager",value:function(e){this.presetManager=e}},{key:"onValueChange",value:function(e){this.presetManager&&this.attributes["scripting name"]&&this.presetManager.onValueChange(this,e)}},{key:"presetManager",get:function(){return this.subSequence.presetManager?this.subSequence.presetManager:this.sequencerEngine.presetManager}},{key:"getValueJson",value:function(){var e;return this.effect?{effect:(e=this.effect).getValueJson.apply(e,arguments)}:this.getJson.apply(this,arguments)}},{key:"fromValueJson",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.effect?this.effect.fromValueJson?this.effect.fromValueJson(t[0].effect):this.effect.fromJson(t[0].effect,!1,!0):this.fromJson.apply(this,t)}},{key:"interpolate",value:function(e,t,n){}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"d",function(){return l}),n.d(t,"a",function(){return f}),n.d(t,"b",function(){return d}),n.d(t,"e",function(){return p}),n.d(t,"c",function(){return v});var r=n(42),a=n.n(r),i=n(56),o=n(11);n(553);function s(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=function e(t){var n=[];if(t.tracks&&Array.isArray(t.tracks)&&(n=[].concat(Object(o.a)(n),Object(o.a)(t.tracks.map(function(t){return e(t.track)})))),t.samplers&&(n=[].concat(Object(o.a)(n),Object(o.a)(Object.keys(t.samplers)))),t.instrument&&t.instrument.getSamples){var r=t.instrument.getSamples().map(function(e){return e.getId()});n=[].concat(Object(o.a)(n),Object(o.a)(r))}if(t.frozenColumns){var a,i=s(t.frozenColumns);try{for(i.s();!(a=i.n()).done;){var c=a.value;n=[].concat(Object(o.a)(n),Object(o.a)(c.frozenSamples.map(function(e){return e.getId()})))}}catch(h){i.e(h)}finally{i.f()}}var u,l=s(t.effects);try{for(l.s();!(u=l.n()).done;){var f=u.value;"Convolver Reverb"===f.name&&n.push(f.convolverSample)}}catch(h){l.e(h)}finally{l.f()}return console.log("FOR TRACK=",n,t),n},l=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,c,l,f,h,d,p,v,m,y,b,g,O,j,k,w,x,S,P,E,T,A,M,R,C,N,I,q,_,D,F;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("GETTING SAMPLES"),n=[],r=s(t.subSequences);try{for(r.s();!(i=r.n()).done;){c=i.value,l=s(c.tracks);try{for(l.s();!(f=l.n()).done;)h=f.value,n=[].concat(Object(o.a)(n),Object(o.a)(u(h)))}catch(a){l.e(a)}finally{l.f()}}}catch(a){r.e(a)}finally{r.f()}n=[].concat(Object(o.a)(n),Object(o.a)(u(t.metronome))),d=s(t.sends.sends);try{for(d.s();!(p=d.n()).done;){v=p.value,m=s(v.effects);try{for(m.s();!(y=m.n()).done;)"Convolver Reverb"===(b=y.value).name&&n.push(b.convolverSample)}catch(a){m.e(a)}finally{m.f()}}}catch(a){d.e(a)}finally{d.f()}g=s(t.channelMixer.masterChannel.effectsChain.effects);try{for(g.s();!(O=g.n()).done;)"Convolver Reverb"===(j=O.value).name&&n.push(j.convolverSample)}catch(a){g.e(a)}finally{g.f()}k=t.currentSubSequence.findNodeByName("export.samples"),w=s(k);try{for(w.s();!(x=w.n()).done;)(S=x.value).samples&&(n=[].concat(Object(o.a)(n),Object(o.a)(S.samples)))}catch(a){w.e(a)}finally{w.f()}P=t.currentSubSequence.findNodeByName("spore.stems"),E=s(P);try{for(E.s();!(T=E.n()).done;)A=T.value,n=[].concat(Object(o.a)(n),Object(o.a)(A.effect.playlist.flatMap(function(e){return e.samples.map(function(e){return e.ipfsHash})})))}catch(a){E.e(a)}finally{E.f()}M=t.currentSubSequence.findNodeByName("ipfs.drop"),R=s(M);try{for(R.s();!(C=R.n()).done;)N=C.value,I=Object.values(N.effect.hashMap),console.log("IPFS.DROP SAMPLES TO SAVE=",I),n=[].concat(Object(o.a)(n),Object(o.a)(I))}catch(a){R.e(a)}finally{R.f()}q=t.currentSubSequence.findNodeByName("samples.tag"),_=s(q);try{for(_.s();!(D=_.n()).done;)F=D.value,n=[].concat(Object(o.a)(n),Object(o.a)(F.effect.samples))}catch(a){_.e(a)}finally{_.f()}return console.log("123 samples=",n),e.abrupt("return",n);case 23:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,c,u,l,f,h,d,p;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=s(t.sends.sends),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=27;break}i=r.value,o=s(i.effects),e.prev=6,o.s();case 8:if((c=o.n()).done){e.next=17;break}if("Convolver Reverb"!==(u=c.value).name){e.next=15;break}return e.next=13,u.getBouncedSample();case 13:l=e.sent,u.convolverSample=l;case 15:e.next=8;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(6),o.e(e.t0);case 22:return e.prev=22,o.f(),e.finish(22);case 25:e.next=3;break;case 27:e.next=32;break;case 29:e.prev=29,e.t1=e.catch(1),n.e(e.t1);case 32:return e.prev=32,n.f(),e.finish(32);case 35:f=s(t.channelMixer.masterChannel.effectsChain.effects),e.prev=36,f.s();case 38:if((h=f.n()).done){e.next=47;break}if("Convolver Reverb"!==(d=h.value).name){e.next=45;break}return e.next=43,d.getBouncedSample();case 43:p=e.sent,d.convolverSample=p;case 45:e.next=38;break;case 47:e.next=52;break;case 49:e.prev=49,e.t2=e.catch(36),f.e(e.t2);case 52:return e.prev=52,f.f(),e.finish(52);case 55:case"end":return e.stop()}},e,null,[[1,29,32,35],[6,19,22,25],[36,49,52,55]])}));return function(t){return e.apply(this,arguments)}}(),h=function e(t){var n=[];if(t.tracks)return t.tracks.flatMap(function(t){return e(t)});if(t.samplers)for(var r in t.samplers)n.push(t.samplers[r].sample);if(t.instrument&&t.instrument.getSamples){var a=t.instrument.getSamples();n=[].concat(Object(o.a)(n),Object(o.a)(a))}return n},d=function(e){var t,n=[],r=s(e.subSequences);try{for(r.s();!(t=r.n()).done;){var a,i=s(t.value.tracks);try{for(i.s();!(a=i.n()).done;){var c=a.value;n=[].concat(Object(o.a)(n),Object(o.a)(h(c)))}}catch(l){i.e(l)}finally{i.f()}}}catch(l){r.e(l)}finally{r.f()}var u={};return n.forEach(function(e){return u[e.getId()]=e.getJson()}),u},p=function(e){var t,n={},r=s(e.subSequences);try{for(r.s();!(t=r.n()).done;){var a,i=s(t.value.tracks);try{for(i.s();!(a=i.n()).done;){var o=a.value;n[o.id]=h(o)}}catch(c){i.e(c)}finally{i.f()}}}catch(c){r.e(c)}finally{r.f()}return n},v=function(e){return e.subSequences.flatMap(function(e){return m(e)})},m=function e(t){var n,r=t.zObjects.filter(function(e){return"three.textureLoader"===e.name}).map(function(e){return e.effect.imageHash}).filter(function(e){return e}),a=s(t.zObjects);try{for(a.s();!(n=a.n()).done;){var i=n.value;"preset"===i.name&&(r=[].concat(Object(o.a)(r),Object(o.a)(i.effect.getImageHashes()))),"subpatch"===i.name&&(r=[].concat(Object(o.a)(r),Object(o.a)(e(i.effect))))}}catch(c){a.e(c)}finally{a.f()}return r}},function(e,t,n){"use strict";n.d(t,"h",function(){return a}),n.d(t,"g",function(){return i}),n.d(t,"a",function(){return o}),n.d(t,"c",function(){return s}),n.d(t,"e",function(){return c}),n.d(t,"f",function(){return u}),n.d(t,"d",function(){return l}),n.d(t,"b",function(){return f});var r=n(160),a=function(e){return"hexagon"!==e&&"circle"!==e},i=function(e){return"circle"!==e&&"rect"!==e&&"hexagon"!==e&&"triangle"!==e&&"lineSegment"!==e},o=function(e){var t=Object(r.a)(e),n=t[0],a=t.slice(1);return i(n)?a[6]:a[4]},s=function(e){var t=Object(r.a)(e);t[0];return t.slice(1)[6]},c=function(e){var t=Object(r.a)(e),n=t[0],a=t.slice(1);return i(n)?a[8]||0:a[6]||0},u=function(e){var t=Object(r.a)(e),n=t[0],a=t.slice(1);return i(n)?a[7]||0:a[5]||0},l=function(e){var t=Object(r.a)(e),n=t[0],a=t.slice(1);return i(n)?[a[0],a[1],a[2]]:[a[0],a[1]]},f=function(e){var t=Object(r.a)(e),n=t[0],a=t.slice(1);return i(n)?[a[3],a[4],a[5]]:[a[2],a[3]]}},function(e,t,n){"use strict";function r(e){return Math.pow(10,.05*e)}function a(e){return 20*Math.log(e)/Math.LN10}n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a})},function(e,t,n){"use strict";var r=n(1),a=n(42),i=n.n(a),o=n(56),s=n(4),c=n(5),u=n(31),l=n(10),f=n(7),h=n(8),d=n(2),p=n(115),v=n(358),m=n(116),y=n(141),b=n(127),g=n(916),O=(n(312),n(6)),j=n.n(O),k=n(610),w=n(14),x=n(122);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(d.a)(e);if(t){var a=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}j.a.Frequency("C3");var P={Hangar:"/convolverHangar.wav","Giant Cave":"/convolver/GiantCave.wav","Airport Terminal":"/convolver/AirportTerminal.wav","Outdoor Blastoff":"/convolver/OutdoorBlastOff.wav","Outdoor Stadium":"/convolver/OutdoorStadium.wav","Plate Large":"/convolver/PlateLarge.wav","Plate Medium":"/convolver/PlateMedium.wav","Plate Small":"/convolver/PlateSmall.wav","Plate Super Dry":"/convolver/PlateSuperDry.wav","Prime Long":"/convolver/PrimeLong.wav","Prime Medium":"/convolver/PrimeMed.wav","Prime Short":"/convolver/PrimeShort.wav","Prime Extra Long":"/convolver/PrimeXtraLong.wav","Room Concert Hall":"/convolver/RoomConcertHall.wav","Room Huge":"/convolver/RoomHuge.wav","Room Large":"/convolver/RoomLarge.wav","Room Medium":"/convolver/RoomMedium.wav","Room Pool":"/convolver/RoomPool.wav"},E=function(e){Object(f.a)(n,e);var t=S(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.a.DEFAULT_BUFFER;return Object(s.a)(this,n),(r=t.call(this,"Convolver Reverb",function(){return new j.a.Convolver(a)},e)).rawBuffer=new j.a.Buffer(a),r.convolverSample="QmcdpaZe62u6p47s2Nmi7jYLpgTbmz6MxVnwvndNFi53Sf",r.startParameter=new w.a("start",Object(u.a)(r),function(e,t){return r.start=t},{defaultValue:0,documentation:"Change the start point of the impulse",automatable:!1}),r.pitchParameter=new w.a("Pitch",Object(u.a)(r),function(e,t){return r.pitch=t},{documentation:"Change the pitch of the impulse",automatable:!1}),r.durationParameter=new w.a("duration",Object(u.a)(r),function(e,t){return r.release=t},{defaultValue:100,documentation:"Change the length of the impulse",automatable:!1}),r.attackParameter=new w.a("attack",Object(u.a)(r),function(e,t){return r.attack=t},{defaultValue:0,documentation:"Change the attack, or fade-in, of the impulse",automatable:!1}),r.registerParameter(r.attackParameter),r.registerParameter(r.startParameter),r.registerParameter(r.pitchParameter),r.registerParameter(r.durationParameter),r.updateInitialValues(),r}return Object(c.a)(n,[{key:"documentation",get:function(){return["Uses an impulse sample to create a realistic reverb.","Drag any sample into this effect to change the impulse sample."]}},{key:"start",get:function(){return this.startParameter.get(!0)},set:function(e){100!==e&&this.renderBuffer()}},{key:"release",set:function(e){100!==e&&e>.01&&this.renderBuffer()}},{key:"attack",get:function(){return this.attackParameter.get(!0)},set:function(e){0!==e&&this.renderBuffer()}},{key:"pitch",get:function(){return this.pitchParameter.get(!0)},set:function(e){0!==e?this.renderBuffer():this.effectNode&&(this.effectNode.buffer=this.rawBuffer)}},{key:"getBouncedSample",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n,r,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.renderedBuffer,n=[t.getChannelData(0)],t.numberOfChannels>1&&n.push(t.getChannelData(1)),e.next=5,Object(v.a)(n);case 5:return r=e.sent,e.next=8,x.a.addArrayBuffer(r);case 8:return a=e.sent,e.abrupt("return",a);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"duration",get:function(){return this.durationParameter.get(!0)}},{key:"renderBuffer",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n,r,a,o,s,c,u,l,f,h,d;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.rawBuffer&&null!==this.rawBuffer){e.next=2;break}return e.abrupt("return");case 2:if(void 0!==this.startParameter&&void 0!==this.durationParameter&&void 0!==this.pitchParameter){e.next=4;break}return e.abrupt("return");case 4:if(0!==this.startParameter.get()||100!==this.durationParameter.get()||0!==this.pitchParameter.get()){e.next=8;break}return this.effectNode.buffer=this.rawBuffer,this.renderedBuffer=this.rawBuffer,e.abrupt("return");case 8:if(this.effectNode){e.next=10;break}return e.abrupt("return");case 10:if(t=new j.a.Buffer(this.rawBuffer),this.effectNode){e.next=13;break}return e.abrupt("return");case 13:if(!window.isNFT){e.next=17;break}return this.renderedBuffer=t,this.effectNode.buffer=t,e.abrupt("return");case 17:if(n=t.duration*this.start/100,r=t.duration-n,this.effectNode){e.next=21;break}return e.abrupt("return");case 21:if(a=r*this.duration/100,o=a*this.attack/100,this.effectNode){e.next=25;break}return e.abrupt("return");case 25:if(this.sequencerEngine.hasConvolver=!0,this.effectNode){e.next=28;break}return e.abrupt("return");case 28:return s=j.a.Master.context.sampleRate,c=new OfflineAudioContext(2,s*a*2,s),u=c.createBufferSource(),(l=c.createGain(1)).connect(c.destination),o>0&&(l.gain.value=0,l.gain.linearRampToValueAtTime(1,o)),l.gain.linearRampToValueAtTime(0,a),u.connect(l),f=j.a.intervalToFrequencyRatio(this.pitch),u.playbackRate.value=f,u.buffer=t._buffer,u.start(0,n),e.next=42,c.startRendering();case 42:h=e.sent,d=0;case 44:if(void 0!==this.effectNode){e.next=52;break}return e.next=47,this.sleep(100);case 47:if(!(++d>10)){e.next=50;break}return e.abrupt("return");case 50:e.next=44;break;case 52:this.renderedBuffer=new j.a.Buffer(h),this.effectNode.buffer=new j.a.Buffer(h);case 54:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sleep",value:function(e){return new Promise(function(t,n){setTimeout(function(){return t()},e)})}},{key:"setConvolverSample",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===this.encryptedIpfs&&(this.encryptedIpfs=new k.a(this.sequencerEngine.store,this.sequencerEngine.ethereum.guilds,this.sequencerEngine.ethereum.encryption,this.sequencerEngine.ethereum.crypto)),e.next=3,this.encryptedIpfs.getSound(t);case 3:if(void 0!==(n=e.sent)){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,j.a.Master.context.decodeAudioData(n.buffer);case 8:if(r=e.sent,this.effectNode){e.next=11;break}return e.abrupt("return");case 11:return this.convolverType=void 0,this.convolverSample=t,this.rawBuffer=r,e.next=16,this.renderBuffer();case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setConvolverType",value:function(e){var t=this;return new Promise(function(n,r){if(e in P){var a=window.installation?"/public"+P[e]:P[e];t.effectNode.load(a,Object(o.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.rawBuffer=new j.a.Buffer(t.effectNode.buffer),e.next=3,t.renderBuffer();case 3:n();case 4:case"end":return e.stop()}},e)}))),t.samplePitch=0,t.convolverType=e,t.convolverSample=void 0}})}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t){var r=new n(e);return r.fromJson(this.getJson()),r}var a=new n(e,new j.a.Buffer(this.effectNode.buffer));return a.wetParameter.fromJson(this.wetParameter.getJson(),e),t||(a.id=this.id,a.wetParameter.id=this.wetParameter.id),a}},{key:"makePublicIfNeeded",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.convolverSample){e.next=12;break}return e.next=3,b.a.guildSamples.getGuildIdForSound(this.convolverSample);case 3:if(void 0===(t=e.sent)||0===t){e.next=12;break}return n=new y.a(this.convolverSample),e.next=8,n.load();case 8:return e.next=10,b.a.guildSamples.saveSample(n);case 10:r=e.sent,this.convolverSample=r;case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getJson",value:function(e){var t=Object(r.a)({},Object(l.a)(Object(d.a)(n.prototype),"getJson",this).call(this,e),{name:this.name,enabled:this.enabledParameter.get(!0),convolverType:this.convolverType,convolverSample:this.convolverSample,start:this.start,pitch:this.pitch,attack:this.attack,duration:this.duration});return t=this.saveParameterToJson(t,"wetParameter",this.wetParameter)}},{key:"fromJson",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var a,o,s=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>1&&void 0!==s[1]&&s[1],e.next=3,this.sleep(50);case 3:if(o=Object(l.a)(Object(d.a)(n.prototype),"fromJson",this).call(this,t,a),void 0===t.convolverType){e.next=10;break}if("Prime Extra Long"===t.convolverType){e.next=8;break}return e.next=8,this.setConvolverType(t.convolverType);case 8:e.next=15;break;case 10:if(void 0===t.convolverSample){e.next=15;break}return e.next=13,this.sleep(150);case 13:return e.next=15,this.setConvolverSample(t.convolverSample,t);case 15:if(!("pitch"in t)){e.next=20;break}if(Object(m.a)(this.pitchParameter,t.pitch,o),0===t.pitch){e.next=20;break}return e.next=20,this.sleep(50);case 20:if(!("duration"in t)){e.next=25;break}if(Object(m.a)(this.durationParameter,t.duration,o),100===t.duration){e.next=25;break}return e.next=25,this.sleep(50);case 25:return"attack"in t&&Object(m.a)(this.attackParameter,t.attack,o),"start"in t&&Object(m.a)(this.startParameter,t.start,o),e.abrupt("return",Object(r.a)({},o));case 28:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){Object(l.a)(Object(d.a)(n.prototype),"dispose",this).call(this,!1),this.rawBuffer&&this.rawBuffer.dispose&&this.rawBuffer.dispose(),this.rawBuffer=void 0,this.attackParameter=void 0,this.pitchParameter=void 0,this.durationParameter=void 0}}]),n}(p.a.Effect);t.a=E},function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"d",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"a",function(){return o});var r=1,a=2,i=3,o=4},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(11);function a(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.state,o=Object(r.a)(t.zMessages);if(t.tracks){o=[].concat(Object(r.a)(o),Object(r.a)(t.midiEffects.effects));var s,c=a(t.tracks);try{for(c.s();!(s=c.n()).done;){var u=s.value;o=[].concat(Object(r.a)(o),Object(r.a)(u.midiEffects.effects)),o=[].concat(Object(r.a)(o),Object(r.a)(u.effects))}}catch(p){c.e(p)}finally{c.f()}}var l,f=a(t.zObjects);try{for(f.s();!(l=f.n()).done;){var h=l.value;if(!n||!i.spatial.hiddenObjects[h.id]){o.push(h);var d=h.effect;d&&(o.push(d),d.zObjects&&(o=[].concat(Object(r.a)(o),Object(r.a)(e(d)))))}}}catch(p){f.e(p)}finally{f.f()}return o}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(6),a=n.n(r);function i(e){return new a.a.Time(e).toMilliseconds()-new a.a.Time(a.a.Master.context.currentTime).toMilliseconds()}},,function(e,t,n){"use strict";n.r(t);var r=n(112).default,a=(n(184).default,n(431).default,{basename:"poke",gen:function(){var e,t=r.getInputs(this);e=this.data.gen();var n=0===this.inputs[1]?"  ".concat("memory","[ ").concat(e," ] = ").concat(t[0],"\n"):"  ".concat("memory","[ ").concat(e," + ").concat(t[1]," ] = ").concat(t[0],"\n");if(void 0!==this.inline)return[this.inline,n];r.functionBody+=n}});t.default=function(e,t,n,i){var o=Object.create(a),s={channels:1};return void 0!==i&&Object.assign(s,i),Object.assign(o,{data:e,dataName:e.name,dataLength:e.buffer.length,uid:r.getUID(),inputs:[t,n]},s),o.name=o.basename+o.uid,r.histories.set(o.name,o),o}},function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(4),o=n(5),s=n(10),c=n(7),u=n(8),l=n(2),f=n(6),h=n.n(f),d=n(20),p=new(function(){function e(){Object(i.a)(this,e),this.lfos=[]}return Object(o.a)(e,[{key:"useLFO",value:function(){return 0!==this.lfos.length&&window.explore?this.lfos.pop():new h.a.LFO(0,-100,100)}},{key:"releaseLFO",value:function(e){window.explore?(e.disconnect(),this.lfos.push(e)):e.dispose()}}]),e}()),v=new(function(){function e(){Object(i.a)(this,e),this.chains=[],this.totalCreated=0,window.lfoChainFactory=this}return Object(o.a)(e,[{key:"useChain",value:function(e,t){var n=void 0;this.chains.length>0&&!t.isOffline?n=this.chains.pop():(this.totalCreated++,n=[new h.a.Normalize(-100,100),new h.a.Scale(e.min,e.max),new h.a.Gain(1)]);return n[1].min=e.min,n[1].max=e.max,n}},{key:"disposeChain",value:function(e){e.forEach(function(e){return e.dispose()})}},{key:"releaseChain",value:function(e,t){if(t.isOffline)this.disposeChain(e);else{if(this.chains.length>=50){var n=this.chains[0];this.disposeChain(n),this.chains=this.chains.slice(1)}this.chains.push(e)}}}]),e}()),m=n(128),y=n(116),b=n(22),g=n(210),O=n(113);function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var k=[{value:"1n",label:"1"},{value:"2n",label:"1/2"},{value:"4n",label:"1/4"},{value:"4t",label:"1/4t"},{value:"8n",label:"1/8"},{value:"8n.",label:"1/8."},{value:"8t",label:"1/8t"},{value:"16n",label:"1/16"},{value:"16t",label:"1/16t"},{value:"32n",label:"1/32"}],w=function(e){Object(c.a)(n,e);var t=j(n);function n(e,r,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(i.a)(this,n),t.call(this,e,r,a,o)}return Object(o.a)(n,[{key:"toSeconds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new h.a.Time(this.get(t,e)).toSeconds()}},{key:"toFrequency",value:function(){return new h.a.Time(this.get()).toFrequency()}},{key:"toString",value:function(){return new h.a.Time(this.get()).toString()}},{key:"quantize",value:function(e){e=new h.a.Frequency(e);var t=1e5,n=void 0;for(var r in k){var a=new h.a.Time(k[r].value),i=Math.abs(a.toFrequency()-e.toFrequency());i<t&&(t=i,n=a)}return n}}]),n}(O.a),x=n(927),S=n(14);function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var E=n(43),T=n(928),A=n(23);function M(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var N=function(e){Object(c.a)(n,e);var t=C(n);function n(e,r,a,o){var s;return Object(i.a)(this,n),(s=t.call(this,e,r,a,o)).id=Object(d.uuid)(),s.lastValue=void 0,s.lastStep=void 0,s.number=o,s.rawLFORate=void 0,s.mixSession=r,s.lfo=p.useLFO(),s.setupLFOParameters(),s.isSynced=!0,s.state="stopped",e.dispatch(Object(A.xb)(s.initialBulkValues)),s}return Object(o.a)(n,[{key:"getType",value:function(){return"LFO"}},{key:"dispose",value:function(){if(this.lfo){for(var e in p.releaseLFO(this.lfo),this.parameterIdToVoiceToNode){var t=this.parameterIdToVoiceToNode[e];for(var n in t){var r=t[n];r.slice(0,r.length-1).filter(function(e){return e.dispose&&e.input}).forEach(function(e){e.dispose()})}}this.parameterIdToVoiceToNode=void 0,this.lfo=void 0,this.lfoRateParameter=void 0,this.lfoMinParameter=void 0,this.lfoMaxParameter=void 0,this.lfoPhaseParameter=void 0,this.lfoAmpParameter=void 0}}},{key:"getDepthFromChain",value:function(e){return e[2]}},{key:"getScaleFromChain",value:function(e){return e[1]}},{key:"startTime",get:function(){return this._startTime},set:function(e){this._startTime=e}},{key:"start",value:function(e){this.stop(void 0===e?0:Math.max(0,e-.1)),h.a.Master.context.isOffline?void 0!==e?this.lfo.start(h.a.Master.context._currentTime+e+1e-5):this.lfo.start(h.a.Master.context._currentTime+1e-5):this.lfo.start(h.a.Master.context.isOffline?h.a.Master.context._currentTime+e:e),this.state="started",this.lfo.lfoType=this.lfoType,this.startTime=e||h.a.Master.context.currentTime,this.stoppedTime=void 0}},{key:"stop",value:function(e){this.lfo.stop(e),this.state="stopped",this.stoppedTime=h.a.Master.context.isOffline?h.a.Master.context._currentTime:h.a.Master.context.currentTime}},{key:"getModulator",value:function(){return this.lfo}},{key:"getChain",value:function(e,t){return[].concat(Object(a.a)(v.useChain(e,this.sequencerEngine)),[t])}},{key:"releaseChain",value:function(e){(e=e.slice(0,e.length-1)).used=!1,v.releaseChain(e,this.sequencerEngine)}},{key:"connect",value:function(e,t,r){if(void 0!==e){var a=e;e.input&&!Array.isArray(e.input)&&(a=e.input),Object(s.a)(Object(l.a)(n.prototype),"connect",this).call(this,a,t,r).used=!0,"stopped"===this.state&&this.start()}else{var i=new x.a(t.min,t.max);this.parameterToScaler[t.id]=i}}},{key:"setupLFOParameters",value:function(){var e=this;this.lfoTypeParameter=new S.a("LFO Type",this,function(t,n){e.stop(),e.lfo.type=n||"sine"},{min:0,max:1,defaultValue:"sine",automatable:!1}),this.registerParameter(this.lfoTypeParameter);this.number;this.lfoRateParameter=new w("LFO Rate",this.lfo.frequency,function(t,n){e.lfo.frequency.input&&(e.lfo.frequency.value=new h.a.Frequency(n))},{min:0,max:800,unit:"",defaultValue:Math.pow(2,5-this.number)+"n"}),this.registerParameter(this.lfoRateParameter),this.lfoMinParameter=new O.a("LFO Min",this.lfo._scaler._add,function(t,n){e.lfo._scaler._add.input&&(e.lfo.min=n)},{min:-100,max:100,unit:"",defaultValue:-100}),this.registerParameter(this.lfoMinParameter),this.lfoMaxParameter=new O.a("LFO Max",this.lfo._scaler._scale,function(t,n){e.lfo._scaler._scale.input&&(e.lfo.max=n)},{min:-100,max:100,unit:"",defaultValue:100}),this.registerParameter(this.lfoMaxParameter),this.lfoAmpParameter=new O.a("LFO Amplitude",this.lfo.amplitude,function(t,n){e.lfo.amplitude.input&&(e.lfo.amplitude.value=n)},{min:0,max:1,unit:"",defaultValue:1,automationRate:b.a}),this.registerParameter(this.lfoAmpParameter),this.lfoPhaseParameter=new S.a("LFO Phase",this,function(t,n){e.lfo.frequency.input&&(e.lfo.phase=n)},{min:0,max:360,unit:"",defaultValue:0}),this.registerParameter(this.lfoPhaseParameter)}},{key:"registerParameter",value:function(e){this.initialBulkValues=Object(r.a)({},this.initialBulkValues,e.setStore(this.store)),e.setMixSession(this.mixSession),e.setContext(this.context),this.parameters.push(e)}},{key:"name",get:function(){return"LFO "+this.number}},{key:"lfoType",get:function(){return void 0===this.lfoTypeParameter?"sine":this.lfoTypeParameter.get()},set:function(e){this.lfoTypeParameter.set(e,!1)}},{key:"lfoRate",get:function(){return this.lfoRateParameter.get(!0)},set:function(e){this.lfoRateParameter.set(e,!1),this.rawLFORate=e}},{key:"lfoMin",get:function(){return this.lfoMinParameter.get()},set:function(e){this.lfoMinParameter.set(e)}},{key:"parameterHasCycle",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(a>6)return!0;if(t){if(e.lfos.includes(this)||e.lfos.includes(n))return!0}else t=e;var i,o=M(e.lfos);try{var s=function(){var e=i.value;if(e.parameters.some(function(n){return r.parameterHasCycle(n,t,e,a++)}))return{v:!0}};for(o.s();!(i=o.n()).done;){var c=s();if("object"===typeof c)return c.v}}catch(u){o.e(u)}finally{o.f()}return!1}},{key:"lfoMax",get:function(){return this.lfoMaxParameter.get()},set:function(e){this.lfoMaxParameter.set(e)}},{key:"lfoPhase",get:function(){return this.lfoPhaseParameter.get()},set:function(e){this.lfoPhaseParameter.set(e)}},{key:"onBPMUpdated",value:function(){var e=this.lfoRateParameter.get(!0);this.lfoRateParameter.set(e,!0,!0)}},{key:"getJson",value:function(e){var t=this.lfoRate;return"number"!==typeof t&&void 0!==this.rawLFORate&&(t=this.rawLFORate),{id:this.id,lfoRateParameter:this.lfoRateParameter.getJson(e),lfoRate:t,lfoMinParameter:this.lfoMinParameter.getJson(e),lfoMaxParameter:this.lfoMaxParameter.getJson(e),lfoTypeParameter:this.lfoTypeParameter.getJson(e),lfoAmpParameter:this.lfoAmpParameter.getJson(e),lfoPhaseParameter:this.lfoPhaseParameter.getJson(e),isSynced:this.isSynced}}},{key:"fromJson",value:function(e,t){this.lfo.state;!t&&e.id&&(this.id=e.id);var n=Object(r.a)({},Object(m.a)(e,"lfoRateParameter",this.lfoRateParameter,this.sequencerEngine,t));return"isSynced"in e&&(this.isSynced=e.isSynced),"lfoRate"in e&&(Object(E.a)(e.lfoRate)&&this.isSynced?Object(y.a)(this.lfoRateParameter,new h.a.Time(1/e.lfoRate).toNotation(),n):Object(y.a)(this.lfoRateParameter,e.lfoRate,n)),"lfoMinParameter"in e&&(n=Object(r.a)({},n,Object(m.a)(e,"lfoMinParameter",this.lfoMinParameter,this.sequencerEngine,t))),"lfoMin"in e&&Object(y.a)(this.lfoMinParameter,e.lfoMin,n),"lfoMaxParameter"in e&&(n=Object(r.a)({},n,Object(m.a)(e,"lfoMaxParameter",this.lfoMaxParameter,this.sequencerEngine,t))),"lfoMax"in e&&Object(y.a)(this.lfoMaxParameter,e.lfoMax,n),n=Object(r.a)({},n,Object(m.a)(e,"lfoTypeParameter",this.lfoTypeParameter,this.sequencerEngine,t),Object(m.a)(e,"lfoAmpParameter",this.lfoAmpParameter,this.sequencerEngine,t)),"lfoType"in e&&Object(y.a)(this.lfoTypeParameter,e.lfoType,n),"lfoPhaseParameter"in e&&(n=Object(r.a)({},n,Object(m.a)(e,"lfoPhaseParameter",this.lfoPhaseParameter,this.sequencerEngine,t))),n}},{key:"copyFrom",value:function(e){this.lfoType=e.lfoType,this.lfoRate=e.lfoRate,this.lfoMin=e.lfoMin,this.lfoMax=e.lfoMax,this.lfoPhase=e.lfoPhase,this.isSynced=e.isSynced}},{key:"mateJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;Object(g.a)(t)&&(this.lfoTypeParameter.disconnectFromAllModulators(),this.lfoTypeParameter.fromJson(e.lfoTypeParameter,this.sequencerEngine)),Object(g.a)(t)&&(this.lfoRateParameter.disconnectFromAllModulators(),this.lfoRate=e.lfoRate,this.lfoRateParameter.fromJson(e.lfoRateParameter,this.sequencerEngine)),Object(g.a)(t)&&(this.lfoMinParameter.disconnectFromAllModulators(),this.lfoMinParameter.fromJson(e.lfoMinParameter,this.sequencerEngine)),Object(g.a)(t)&&(this.lfoMaxParameter.disconnectFromAllModulators(),this.lfoMaxParameter.fromJson(e.lfoMaxParameter,this.sequencerEngine)),Object(g.a)(t)&&(this.lfoPhaseParameter.disconnectFromAllModulators(),this.lfoPhaseParameter.fromJson(e.lfoPhaseParameter,this.sequencerEngine))}},{key:"getCopy",value:function(){var e=new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,this.mixSession,this.context,this.number);return e.fromJson(this.getJson()),e}}]),n}(function(e){Object(c.a)(n,e);var t=P(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getValue",value:function(e){var t=this.lfoRateParameter.toSeconds(e+1),n=this.sequencerEngine.nextTimeScheduled;if(this.stoppedTime)return 0;var r=t*(this.lfoPhaseParameter.get(!1,e+1)/360),a=((n-=this.startTime)-r)/t,i=this.lfoMaxParameter.get(!1,e+1),o=this.lfoMinParameter.get(!1,e+1),s=(i-o)/2,c=(i+o)/2,u=0;switch(this.lfoType){case"sine":u=this.getSineValue(a,s,c);break;case"square":u=this.getSquareValue(a);break;case"triangle":u=this.getTriangleValue(a,s,c);break;case"sawtooth":u=this.getSawtoothValue(a,s,c)}return isNaN(u)?0:u}},{key:"getSineValue",value:function(e,t,n){return t*Math.sin(e*(2*Math.PI))+n}},{key:"getTriangleValue",value:function(e,t,n){return n+t*Math.asin(Math.sin(e*(Math.PI/2)*Math.PI))}},{key:"getSawtoothValue",value:function(e,t,n){return this.lfoMin+t*(.5*function(e){return Math.PI/2-Math.atan(e)}((r=e*Math.PI,1/Math.tan(r))));var r}},{key:"getSquareValue",value:function(e){return Math.sin(e*(2*Math.PI))<=0?this.lfoMin:this.lfoMax}}]),n}(T.a));t.a=N},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5);var c=function(){function e(t,n){Object(o.a)(this,e),this.wasm=t,this.wasm.decoder_init(),this.wasm.decoder_set_mp3_data_size(n.byteLength),new Uint8Array(this.wasm.memory.buffer,this.wasm.decoder_mp3_data_offset(),this.wasm.decoder_mp3_data_size()).set(n),this.duration=this.seek(-1),this.seek(0)}return Object(s.a)(e,[{key:"setData",value:function(e){this.wasm.decoder_set_mp3_data_size(e.byteLength),new Uint8Array(this.wasm.memory.buffer,this.wasm.decoder_mp3_data_offset(),this.wasm.decoder_mp3_data_size()).set(e),this.duration=this.seek(-1),this.seek(0)}},{key:"seek",value:function(e){return this.wasm.decoder_seek(e),this.currentTime()}},{key:"decode",value:function(e){var t=this.currentTime();this.wasm.decoder_decode(e);var n=new Int16Array(this.wasm.memory.buffer,this.wasm.decoder_pcm_data_offset(),this.wasm.decoder_pcm_data_size()/2),r=this.wasm.decode_results_sampling_rate(),a=this.wasm.decode_results_num_channels(),i=this.wasm.decode_results_num_samples();return{pcm:n,startTime:t,duration:i/a/r,samplingRate:r,numChannels:a,numSamples:i}}},{key:"currentTime",value:function(){return this.wasm.decoder_current_time()}}]),e}();function u(e,t){return l.apply(this,arguments)}function l(){return(l=Object(i.a)(a.a.mark(function e(t,n){var r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||"decoder.opt.wasm",e.next=3,fetch(n);case 3:return r=e.sent,e.next=6,r.arrayBuffer();case 6:return i=e.sent,e.next=9,WebAssembly.instantiate(i,{});case 9:return o=e.sent,e.abrupt("return",new c(o.instance.exports,t));case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}var f=null,h=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=window.isNFT?"decoder.opt.wasm":"/decoder.opt.wasm",f){e.next=7;break}return e.next=4,u(t,n);case 4:f=e.sent,e.next=8;break;case 7:f.setData(t);case 8:return r=new Uint16Array(6*t.length),i=0,f.seek(0),0,s=f.decode(300),o=s.samplingRate,r.set(s.pcm,i),i+=s.pcm.length,e.abrupt("return",{decoded:r,sampleRate:o,position:i});case 17:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),d=function(e){return new Promise(function(t){var n=e.id,r=e.mp3Data,a=e.isNFT;h(r,a).then(function(e){var r=e.decoded,a=e.sampleRate,i=e.position;t({decoded:r,sampleRate:a,position:i,id:n})})})},p=n(80),v=n(146),m=(n(302),n(141),n(6)),y=n.n(m);n.d(t,"a",function(){return k}),n.d(t,"b",function(){return x});var b,g=0,O={},j={},k=function(){j={},O={},g=0,j={}},w=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=window.isNFT)||window.urlSearchParams.get("gallery")){e.next=6;break}return e.next=4,d({mp3Data:t,isNFT:i,id:n});case 4:return o=e.sent,e.abrupt("return",o);case 6:b||((b=new Worker(i?"mp3Worker.js":"/mp3Worker.js")).onmessage=function(e){j[e.data.id]=e.data}),b.postMessage({mp3Data:t,isNFT:i,id:n});case 8:if(j[n]){e.next=13;break}return e.next=11,Object(p.a)(100);case 11:e.next=8;break;case 13:return e.abrupt("return",j[n]);case 14:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),x=function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o,s,c,u,l,f,h,d,p,m;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!O[n]){e.next=2;break}return e.abrupt("return",O[n]);case 2:return e.next=4,w(t,g++,n);case 4:for(r=e.sent,i=r.decoded,o=r.sampleRate,s=r.position,c=y.a.Master.context,v.isMobile,u=2,l=c.createBuffer(u,s/2,o),f=l.getChannelData(0),h=2===u?l.getChannelData(1):null,d=0;d<i.length;d+=2)p=i[d],m=i[d+1],f[d/2]=p>=32768?-(65536-p)/32768:p/32767,2===u&&(h[d/2]=m>=32768?-(65536-m)/32768:m/32767);return O[n]=l,e.abrupt("return",l);case 17:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=n(6),h=n.n(f),d=n(115),p=n(14),v=n(113),m=n(128),y=180;function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var g="peaking",O=function(e){Object(c.a)(n,e);var t=b(n);function n(e){var r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var s in Object(a.a)(this,n),(r=t.call(this,"EQ8",function(){return new h.a.Gain(1)},e)).store=e.store,r.equalizerPoints=[new j(e,Object(o.a)(r),80,0,1,1,!0,"lowshelf"),new j(e,Object(o.a)(r),300,0,1,2,!1),new j(e,Object(o.a)(r),500,0,1,3,!1),new j(e,Object(o.a)(r),800,0,1,4,!1),new j(e,Object(o.a)(r),1e3,0,1,5),new j(e,Object(o.a)(r),2e3,0,1,6,!1),new j(e,Object(o.a)(r),4e3,0,1,7),new j(e,Object(o.a)(r),8e3,0,1,8,!0,"highshelf")],r.updateRate=y,i&&(r.analyser=new h.a.Analyser("fft",256)),r.outputNode=new h.a.Gain(1),r.setupEqualizer(),r.equalizerPoints)r.parameters=r.parameters.concat(r.equalizerPoints[s].parameters);return r.updateInitialValues(),r}return Object(i.a)(n,[{key:"dispose",value:function(){Object(s.a)(Object(l.a)(n.prototype),"dispose",this).call(this),this.analyser&&(this.analyser.dispose(),this.analyser=void 0),this.equalizerPoints.forEach(function(e){return e.dispose()}),this.equalizerPoints=void 0,this.outputNode.dispose(),this.outputNode=void 0}},{key:"disconnectAllFilters",value:function(){this.effectNode.disconnect(),this.equalizerPoints.filter(function(e){return e.enabled}).forEach(function(e){return e.filter.disconnect()})}},{key:"setupEqualizer",value:function(){var e,t=this.equalizerPoints.filter(function(e){return e.enabled}).map(function(e){return e.filter});t.push(this.outputNode),(e=this.effectNode).chain.apply(e,Object(r.a)(t))}},{key:"getSpectrum",value:function(){return this.analyser.getValue()}},{key:"connect",value:function(e){this.outputNode.connect(e),this.analyser&&this.outputNode.connect(this.analyser)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e),this.analyser&&this.analyser.disconnect()}},{key:"getJson",value:function(){var e=Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this);return e.updateRate=this.updateRate,e.equalizerPoints=this.equalizerPoints.map(function(e){return e.getJson()}),e}},{key:"fromJson",value:function(e,t){for(var r in Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t),"updateRate"in e&&(this.updateRate=e.updateRate),this.equalizerPoints)this.equalizerPoints[r].fromJson(e.equalizerPoints[r]);return this}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(d.a.Effect),j=function(){function e(t,n,r,i,o,s){var c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:g;Object(a.a)(this,e),this.eq=n,this.name="EQ Frequency "+s,this.number=s,this.type=u,this.sequencerEngine=t,this.store=t.store,this.filter=new h.a.Filter(r,u),this.filter.Q.value=o,this.filter.gain.value=i,this.frequencyParameter=new v.c(this.name+" frequency",this.filter.frequency,{min:0,max:1e4,unit:"hz",defaultValue:r}),this.gainParameter=new v.c(this.name+" gain",this.filter.gain,{min:-16,max:16,unit:"db",defaultValue:i}),this.qParameter=new v.c(this.name+" q",this.filter.Q,{min:0,max:16,unit:"Q",defaultValue:o}),this.enabledParameter=new p.a(this.name+" enabled",this,function(e,t){},{min:0,max:1,unit:"boolean",defaultValue:c}),this.parameters=[],this.registerParameter(this.enabledParameter),this.registerParameter(this.frequencyParameter),this.registerParameter(this.gainParameter),this.registerParameter(this.qParameter)}return Object(i.a)(e,[{key:"dispose",value:function(){this.filter._param&&this.filter.dispose(),this.filter=void 0,this.parameters.forEach(function(e){return e.dispose()}),this.gainParameter=void 0,this.frequencyParameter=void 0,this.qParameter=void 0,this.sequencerEngine=void 0,this.eq=void 0,this.name=void 0,this.store=void 0,this.parameters=void 0,this.type=void 0}},{key:"getJson",value:function(){var e={number:this.number,frequency:this.frequency,gain:this.gain,q:this.q,enabled:this.enabled};return e=Object(m.b)(e,"frequencyParameter",this.frequencyParameter),e=Object(m.b)(e,"qParameter",this.qParameter),e=Object(m.b)(e,"gainParameter",this.gainParameter),e=Object(m.b)(e,"enabledParameter",this.enabledParameter)}},{key:"fromJson",value:function(e){this.enabled=e.enabled,this.frequency=e.frequency,this.frequencyParameter.unlockedValue=e.frequency,this.q=e.q,this.qParameter.unlockedValue=e.q,this.gain=e.gain,this.gainParameter.unlockedValue=e.gain,Object(m.a)(e,"frequencyParameter",this.frequencyParameter,this.sequencerEngine),Object(m.a)(e,"qParameter",this.qParameter,this.sequencerEngine),Object(m.a)(e,"gainParameter",this.gainParameter,this.sequencerEngine),Object(m.a)(e,"enabledParameter",this.enabledParameter)}},{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"enabled",get:function(){return this.enabledParameter.get()},set:function(e){return this.enabledParameter.set(e)}},{key:"frequency",get:function(){return this.frequencyParameter.get(!0)},set:function(e){this.frequencyParameter.set(e)}},{key:"gain",get:function(){return this.gainParameter.get(!0)},set:function(e){this.gainParameter.set(e)}},{key:"q",get:function(){return this.qParameter.get(!0)},set:function(e){this.qParameter.set(e)}},{key:"frequencyToGain",value:function(e){return"peaking"===this.type?this.frequencyToGainPeaking(e):"highshelf"===this.type?this.frequencyToGainHighShelf(e):this.frequencyToGainLowShelf(e)}},{key:"frequencyToGainPeaking",value:function(e){var t=200/this.q,n=e-t/2,r=e+t/2;return e<=n||e>=r?0:e<this.frequency?this.gain*((e-n)/(this.frequency-n)):this.gain*((r-e)/(r-this.frequency))}},{key:"frequencyToGainHighShelf",value:function(e){var t=e-100;return(e+=100)<=t?0:e>=this.frequency?this.gain:this.gain*((e-t)/(this.frequency-t))}},{key:"frequencyToGainLowShelf",value:function(e){var t=e+100;return e>=t?0:e<=this.frequency?this.gain:this.gain*((e-t)/(this.frequency-t))}}]),e}();t.a=O},function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(4),o=n(5),s=n(7),c=n(8),u=n(2),l=n(382),f=n(14);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}t.a=function(e){return function(e){Object(s.a)(n,e);var t=h(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).configurations=[],e}return Object(o.a)(n,[{key:"currentConfiguration",get:function(){return this.configurationParameter.get()},set:function(e){this.configurationParameter.set(e)}},{key:"initializeConfigurations",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.loaded=!0,this.oldConfiguration=0,this.configurations=[],this.configurations[0]=e,n&&(this.configurationParameter=new f.a("Configuration",this,function(e,n){t.switchToConfiguration(n)},{documentation:"",defaultValue:0,uxAutomatable:!1}),this.registerParameter(this.configurationParameter))}},{key:"saveCurrentConfiguration",value:function(){var e=void 0===this.currentConfiguration?1:this.currentConfiguration;return this.configurations[e]=Object(a.a)({},this.adjacencyLists),e}},{key:"newConfiguration",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.currentConfiguration,r=e?this.copyAdjacencyLists(this.adjacencyLists):{};return this.configurations.push(r),this.currentConfiguration=this.configurations.length-1,t&&(this.adjacencyLists=r),n}},{key:"switchToConfiguration",value:function(e){if(void 0!==this.configurationParameter&&this.oldConfiguration!==e){this.clearConfiguration(this.oldConfiguration);var t=this.configurations[e];this.loadConfig(t),this.oldConfiguration=this.currentConfiguration}}},{key:"configNames",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.adjacencyLists,n={},r=0,a=function(a){var i=e.effects.find(function(e){return e.id===a});n[i.name+"-"+r]=t[a],r++};for(var i in t)a(i);return n}},{key:"loadConfig",value:function(e){var t=this;this.adjacencyLists={};var n=function(n){for(var r in e[n]){var a=-1===parseInt(n)?t.inputNode:t.effects.find(function(e){return e.id===n}),i=e[n][r];void 0!==a&&t.connectEdge(a,i)}};for(var r in e)n(r)}},{key:"clearConfiguration",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.oldConfiguration,n=this.copyAdjacencyLists(this.adjacencyLists,!0),a=function(t){e.effects.find(function(e){return e.id===t});Object(r.a)(e.adjacencyLists[t]).forEach(function(t){e.deleteEdge(t)})};for(var i in this.adjacencyLists)a(i);this.loaded&&(this.configurations[t]=n)}},{key:"copyAdjacencyLists",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.adjacencyLists,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};for(var a in e)n[a]=t?Object(r.a)(e[a]):e[a].map(function(e){return e.getCopy()});return n}},{key:"getConfigurationJson",value:function(){var e=this,t=[];for(var n in this.configurations){var r=this.configurations[n],a={};for(var i in r)a[i]=r[i].map(function(t){return t.getJson(e)});t.push(a)}return t}},{key:"loadConfigurationJson",value:function(e){var t=[];for(var n in e){var r=e[n],a={};for(var i in r){var o=[];for(var s in r[i]){var c=new l.a(void 0,this.sequencerEngine);c.fromJson(r[i][s],this),o.push(c)}a[i]=o}t.push(a)}this.configurations=t}}]),n}(e)}},function(e,t,n){"use strict";var r=n(11),a=n(42),i=n.n(a),o=n(56),s=n(4),c=n(5),u=(n(6),n(9)),l=n(23),f=(n(21),n(34),n(66),n(64),n(67),n(65),n(47),n(68),n(69),n(70),n(36),n(38),n(51)),h=function(){function e(t,n){Object(s.a)(this,e),this.type=t,this.events=[],this.counter=0,this.subSequence=n}return Object(c.a)(e,[{key:"getMixType",value:function(){return u.b}},{key:"seekToTrackStep",value:function(e){this.events.length>0&&this.events[this.events.length-1].step<e||this.restart()}},{key:"restart",value:function(){this.counter=0,this.events.forEach(function(e){return e.restart()})}},{key:"scheduleNext",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n,r){var a,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:0==t&&this.restart(),a=this.counter,o=this.events;case 3:if(!(a<o.length)){e.next=19;break}if(t!==o[a].step){e.next=8;break}o[a].scheduleEvent(n,r,o[a+1]),e.next=16;break;case 8:if(!(t>o[a].step)||o[a].isSkippable()){e.next=12;break}o[a].scheduleEvent(0-o[a].time,r,o[a+1]),e.next=16;break;case 12:if(!(t<o[a].step)){e.next=16;break}return e.abrupt("break",19);case 16:a++,e.next=3;break;case 19:this.counter=a;case 20:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"eraseEventsAtStep",value:function(e){this.events=this.events.filter(function(t){return t.step!=e})}},{key:"schedule",value:function(){this.events.forEach(function(e){return e.scheduleEvent()})}},{key:"getJson",value:function(){return{type:this.type,events:this.events.map(function(e){return e.getJson()}).filter(function(e){return void 0!==e})}}},{key:"getCopy",value:function(){var t=new e(this.type);return t.events=this.events,t}},{key:"loadFromJson",value:function(e,t,n){for(var r in e.events){var a=e.events[r],i=Object(f.a)(a,this.type,t,n);void 0!==i&&(this.events.length>0&&i.step<this.events[this.events.length-1].step&&e.length-r>=500&&(this.events=[]),this.events.push(i))}}},{key:"calculateDurations",value:function(){var e=void 0,t=[];for(var n in this.events){var r=this.events[n];void 0===r||r.isEmpty()||(void 0===e||e.rolling||r.rolling)&&(t.push(r),void 0!==e&&(e.duration=this.events[n].step-e.step),e=this.events[n])}this.events=t}},{key:"clear",value:function(){this.events=[],this.counter=0}},{key:"getNextEvent",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.counter:0;t<this.events.length;t++)if(e.step<this.events[t].step)return this.events[t]}},{key:"getPreviousEvent",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=void 0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?Math.max(0,this.counter-1):0;r<this.events.length;r++){if(t&&e.step<=this.events[r].step)return n;if(!t&&e.step<this.events[r].step)return n;n=this.events[r]}return n}},{key:"updateRedux",value:function(e,t){t.store.dispatch(Object(l.nc)(e.id,this.type,Object(r.a)(this.events)))}},{key:"prune",value:function(){this.events.every(function(e){return e.isPrunable()})&&(this.events=[]);var e=void 0,t=[];for(var n in this.events){var r=this.events[n];void 0!==e&&r.isPrunable()&&e.isPrunable()||(void 0===e&&r.isPrunable()||(t.push(r),e=r))}this.events=t}},{key:"getEventsBetween",value:function(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this.events.filter(function(n){return n.step>=e&&n.step<=t}):this.events.filter(function(n){return n.step>=e&&n.step<t})}}]),e}();t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var u=function(e){Object(i.a)(n,e);var t=c(n);function n(e,a,i,o){var s;return Object(r.a)(this,n),(s=t.call(this,e,a.getType())).event=a,s.time=i,s.trackStep=o,s}return Object(a.a)(n,[{key:"events",get:function(){return this.mixByType.events},set:function(e){this.mixByType.events=e}},{key:"counter",get:function(){return this.mixByType.counter},set:function(e){this.mixByType.counter=e}},{key:"execute",value:function(){if(this.event.setTime(this.time,this.trackStep),0==this.events.length||this.events[this.events.length-1].step<=this.trackStep)this.events.push(this.event);else{for(var e=0,t=this.events.length-1,n=void 0;e<=t;){if(n=Math.floor((e+t)/2),this.events[n].step<this.trackStep)e=n+1;else{if(!(this.events[n].step>this.trackStep))break;t=n-1}if(n>=1&&this.events[n-1].step<=this.trackStep&&this.events[n].step>=this.trackStep)break}this.events[n].step===this.trackStep?this.events[n]=this.event:this.events=this.events.slice(0,n).concat([this.event]).concat(this.events.slice(n)),this.counter=n,this.event.subSequence=this.mix.subSequence}}}]),n}(n(169).a);t.a=u},function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"b",function(){return o});var r=n(21),a=140,i="RIGHT",o="LEFT";new r.a(16,!1)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(1),a=function(){var e={},t={};return function(n,a,i,o){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(void 0===n)return Object.keys(e);if(1===n)return t;var c=[n];s.altName&&c.push(s.altName);for(var u=function(){var n=f[l];if(n in e)return{v:e[n]};s.tags&&(Array.isArray(s.tags)?s.tags.forEach(function(e){t[e]||(t[e]=[]),t[e].push(n)}):(t[s.tags]||(t[s.tags]=[]),t[s.tags].push(n))),e[n]=Object(r.a)({params:a,description:i,outlets:o},s)},l=0,f=c;l<f.length;l++){var h=u();if("object"===typeof h)return h.v}}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i});var r=["EQ Frequency 1 gain","type","EQ Frequency 5 gain","EQ Frequency 8 gain","Pulse Width","algorithm","Chop","Velocity","Slice","Chop Duration","Duration","Transpose","width","speed","Configuration","Feedback","list","Drive","enabled","parametersDisabled","Enabled","blur","pitchBend","Polyphony","phase","stages","smoothness","Custom Oscillator Type","lengthFactor","Curve","Release Curve","Decay Curve","Attack Curve","triplet1","triplet2","triplet3","triplet4","triplet5","triplet6","scale1","Algorithm","scale2","scale3","scale4","scale5","scale6","rule1","rule2","rule3","rule4","rule5","rule6","Oscillator Type","resolution","rolloff","Level","curve","Filter Cutoff (hi-pass)","Filter Q (hi-pass)","Partial Count","LFO Type"],a=["Sustain","Partials","Harmonics","steps","Resolution","Probability","Rate","lengthFactor","resolution","probability","Decay","Attack","Release"],i=function(e,t){return(e.getAllParameters?e.getAllParameters(!1):e.getParameters?e.getParameters():e.parameters).filter(function(e){return e.automatable&&!e.config.isDb}).filter(function(e){return!e.hasMacro}).filter(function(e){return!e.isMapped}).filter(function(e){return!r.includes(e.name)})}},function(e,t,n){"use strict";var r=n(1),a=(n(11),n(4)),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(139),f=n(327),h=n(375),d=n(328),p=n(286),v=n(635);function m(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var g=function(e){Object(s.a)(n,e);var t=b(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Midi Effect Rack",e)).initializeConfigurations(r.adjacencyLists),r.initCache(128),r}return Object(i.a)(n,[{key:"stop",value:function(){this.effects.forEach(function(e){return e.stop()})}},{key:"output",value:function(e,t,n){return this.runFlow(e,t,n,this.inputNode,this.triggers,this.adjacencyLists)}},{key:"documentation",get:function(){return["Patch Midi Effects together in non-linear ways. ","The edges control the probability that a trigger is passed through to the next effect."]}},{key:"onNewStep",value:function(){this.triggers.length>0&&(this.triggers.length=0),this.effects.forEach(function(e){return e.onNewStep()})}},{key:"clear",value:function(){this.counter=0,this.effects.forEach(function(e){return e.clear()}),this.triggers=[]}},{key:"isRack",get:function(){return!0}},{key:"isRealTime",value:function(){return void 0===this.adjacencyLists[-1]||!this.adjacencyLists[-1].some(function(e){return e.effect&&e.effect.isRealTime&&!e.effect.isRealTime()})}},{key:"addNote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.adjacencyLists[-1].filter(function(e){return e.effect&&e.effect.isRealTime&&!e.effect.isRealTime()}).forEach(function(r){return r.effect.addNote(e,t,n)})}},{key:"removeNote",value:function(e,t){this.effects.filter(function(e){return e.isRealTime&&!e.isRealTime()}).forEach(function(n){return n.removeNote(e,t)})}},{key:"getJson",value:function(){return this.getRackJson()}},{key:"fromJson",value:function(e,t,a,i){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t;this.adjacencyLists={},this.initializeConfigurations(this.adjacencyLists,!1),this.effects=[],this.loaded=!1;var c=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t),l=e.effects;for(var f in l){var h=l[f],d=Object(p.a)(h,this.track);if(c=Object(r.a)({},c,d.fromJson(h,s)),d.id!==h.id){var v,y=m(e.configurations);try{for(y.s();!(v=y.n()).done;){var b=v.value,g=b[h.id];b[d.id]=g,delete b[h.id]}}catch(O){y.e(O)}finally{y.f()}}this.addEffect(d,!1),d.x=h._x||h.x,d.y=h._y||h.y}return this.fromRackJson(e,t),this.loaded=!0,c}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"deleteEdge",value:function(e){Object(o.a)(Object(u.a)(n.prototype),"deleteEdge",this).call(this,e,!1)}}]),n}(Object(v.a)(Object(f.a)(Object(h.a)(Object(d.a)(l.a)))));t.a=g},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),o=n.n(i),s=n(124),c=n(59),u=n(113),l=n(14),f=n(128),h=(new s.a,function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(r.a)(this,e),this.parameters=[],this.effect=t,this.sequencerEngine=n,this.store=n.store,this.gain=new o.a.Gain(1),this.gainParameter=new u.c("Gain",this.gain.gain,{min:0,max:1,unit:"db",defaultValue:1}),this.registerParameter(this.gainParameter),this.probabilityParameter=new l.a("Probability",this,function(){return[]},{min:0,max:100,unit:"%",defaultValue:100}),this.registerParameter(this.probabilityParameter),t&&t.connect&&(t.effectNode?this.gain.connect(t.effectNode):this.gain.connect(t)),this.outputNumber=a}return Object(a.a)(e,[{key:"getWeight",value:function(e,t){return e.getEffectType()===c.c?this.probability/100:this.gainParameter.get()}},{key:"probability",get:function(){return this.probabilityParameter.get()}},{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"getCopy",value:function(){var t=new e(this.effect,this.sequencerEngine);return t.gainParameter.set(t.gainParameter.get()),t.outputNumber=this.outputNumber,t}},{key:"getJson",value:function(e){var t={effect:e.effects.indexOf(this.effect),gain:this.gainParameter?this.gainParameter.get():1,probability:this.probability,outputNumber:this.outputNumber};return this.gainParameter&&(t=Object(f.b)(t,"gainParameter",this.gainParameter)),t=Object(f.b)(t,"probabilityParameter",this.probabilityParameter)}},{key:"fromJson",value:function(e,t){this.gainParameter.set(e.gain),void 0!==e.probability&&this.probabilityParameter.set(e.probability),Object(f.a)(e,"gainParameter",this.gainParameter),Object(f.a)(e,"probabilityParameter",this.probabilityParameter),this.effect=t.effects[e.effect],this.outputNumber=void 0===e.outputNumber?0:e.outputNumber,this.effect||(this.effect=t.outputNode),void 0!==this.effect.connect&&(this.effect.effectNode?this.gain.connect(this.effect.effectNode):this.gain&&this.gain.connect(this.effect))}},{key:"dispose",value:function(){this.gainParameter&&(this.gainParameter.dispose(),this.gainParameter=void 0),this._disposed=!0}}]),e}());t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=(n(14),n(634)),o=n(23),s=n(123),c=n(128),u=n(113),l=n(22),f=n(6),h=n.n(f),d=n(20),p=function(){function e(t,n,a){var i=this,c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Object(r.a)(this,e),this.id=Object(d.uuid)(),this.context=a?a.getCopy().forMacro(this):(new s.a).forMacro(this),this.sequencerEngine=n,this.name=t,this.subMacros=[],this.x=100,this.y=110,this.signal=new h.a.Signal(0),this.macroParameter=new u.a("macro",this.signal,function(e,t){i.signal.value=t;var n={};for(var r in i.subMacros){var a=i.subMacros[r],s=a.updateRedux(t,c);n[a.parameter.id]=s.value}i.sequencerEngine.store.dispatch(Object(o.xb)(n))},{min:0,max:1,defaultValue:f,automationRate:l.a}),this.macroParameter.enableAudioParam(),this.parameters=[],this.registerParameter(this.macroParameter)}return Object(a.a)(e,[{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.setStore(this.sequencerEngine.store),e.setContext(this.context),this.parameters.push(e))}},{key:"addParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.min,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.max,r=new i.a(e,t,n,this);(e.audioParam||e.audioParams)&&this.signal.connect(r.scaler),this.subMacros.push(r),this.macroParameter.set(this.macroParameter.get(!0)),e.hasMacro=this}},{key:"unmapAllParameters",value:function(){var e=this;this.subMacros.map(function(e){return e.parameter}).forEach(function(t){return e.unmapParameter(t)})}},{key:"ripMods",value:function(){this.macroParameter.disconnectFromAllModulators()}},{key:"isParameterMapped",value:function(e){return this.subMacros.some(function(t){return t.parameter===e})}},{key:"normalizeParameterValue",value:function(e,t){return this.subMacros.find(function(t){return t.parameter===e}).normalizeValue(t)}},{key:"unmapParameter",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.subMacros.find(function(t){return t.parameter===e});if(void 0!==n){e.hasMacro=void 0,(n.parameter.audioParam||n.parameter.audioParams)&&this.signal.disconnect(n.scaler);var r=this.subMacros.indexOf(n);t&&n.dispose(),this.subMacros.splice(r,1),e.set(e.get(),!0,!0)}}},{key:"dispose",value:function(){this.unmapAllParameters(),this.subMacros=void 0,this.macroParameter.dispose(),this.signal=void 0,this.macroParameter=void 0}},{key:"getJson",value:function(){var e={id:this.id,x:this.x,y:this.y,name:this.name,subMacros:this.subMacros.map(function(e){return e.getJson()}),macroValue:this.macroParameter.get(!0)};return e=Object(c.b)(e,"macroParameter",this.macroParameter,!0)}},{key:"getParameters",value:function(){return this.parameters}},{key:"fromJson",value:function(e,t){var n=this;e.id&&(this.id=e.id),this.name=e.name,this.x=e.x,this.y=e.y;var r=function(r){var a=e.subMacros[r],i=a.parameter,o=a.min,s=a.max;if(void 0===(i=t.find(function(e){return e.id===i})))return"continue";n.addParameter(i,o,s)};for(var a in e.subMacros)r(a);this.macroParameter.set(e.macroValue),Object(c.a)(e,"macroParameter",this.macroParameter,this.sequencerEngine)}}]),e}();t.a=p},function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return f});var r=n(1),a=n(11),i=n(114),o=n(214),s=n(20);function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=function(e){return function(){for(var t=arguments.length,n=new Array(t),c=0;c<t;c++)n[c]=arguments[c];for(var u=Object(o.m)(e,.5).apply(void 0,n),l=Object(a.a)(i.A.apply(void 0,[e].concat(n))),f=Object(s.uuid)(),h=0;h<l.length;h++)l[h]=Object(r.a)({},l[h],{figure:u,nth:h,figureId:f});return l}},f=function(e,t,n){return function(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];var u,l=i.A.apply(void 0,[e].concat(o)),f=i.A.apply(void 0,[t].concat(o)),h=void 0,d=[],p=[],v=0,m=c(l);try{for(m.s();!(u=m.n()).done;){var y=u.value;if(v===f?p.push(y):d.push(y),h&&y.figureId!==h.figureId){if(v===f){var b=n(p);"function"===typeof b&&(b=b.apply(void 0,o)),d=[].concat(Object(a.a)(d),Object(a.a)(b)),p=[]}v++}h=y}}catch(O){m.e(O)}finally{m.f()}if(p.length>0){var g=n(p);"function"===typeof g&&(g=g.apply(void 0,o)),d=[].concat(Object(a.a)(d),Object(a.a)(g))}return d}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return h}),n.d(t,"b",function(){return d});var r=n(42),a=n.n(r),i=n(56),o=n(141),s=n(835),c=n.n(s),u=(n(146),n(23));function l(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e){var t=[];if("subSequences"in e)for(var n in e.subSequences){var r=e.subSequences[n];for(var a in r.tracksData){var i=r.tracksData[a];t=t.concat(Object.keys(i.samplers))}}else for(var o in e.tracksData){var s=e.tracksData[o];t=t.concat(Object.keys(s.samplers))}return Array.from(new Set(t))}function d(e,t,n,r){return p.apply(this,arguments)}function p(){return(p=Object(i.a)(a.a.mark(function e(t,n,r,o){var s,f,h,d,p,m,y,b,g,O,j,k,w,x,S,P;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s={},(new Date).getTime(),o.dispatch(Object(u.jd)(0,t.length)),e.next=24;break;case 7:if((h=f.n()).done){e.next=14;break}return d=h.value,e.next=11,v(n,d,o);case 11:s[d]=e.sent;case 12:e.next=7;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),f.e(e.t0);case 19:return e.prev=19,f.f(),e.finish(19);case 22:e.next=39;break;case 24:p=(new Date).getTime(),m=window.concurrency||3,y=new c.a({concurrency:m}),1,b=[],g=l(t);try{for(j=function(){var e=O.value;b.push(y.addTask(1,Object(i.a)(a.a.mark(function t(){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v(n,e,o);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}))))},g.s();!(O=g.n()).done;)j()}catch(r){g.e(r)}finally{g.f()}return y.resume(),e.next=34,Promise.all(b);case 34:k=e.sent,w=(new Date).getTime(),console.log("decoding mp3s took %s ms",w-p),x=l(k);try{for(x.s();!(S=x.n()).done;)P=S.value,s[P.ipfsHash]=P}catch(r){x.e(r)}finally{x.f()}case 39:return e.abrupt("return",s);case 40:case"end":return e.stop()}},e,null,[[5,16,19,22]])}))).apply(this,arguments)}function v(e,t,n){return new Promise(function(){var r=Object(i.a)(a.a.mark(function r(i,s){var c,l,f,h,d,p;return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return c=new o.a(t,e),r.prev=1,n.state.sequencer.sampleDownloadProgress.downloaded,r.next=5,c.load();case 5:l=n.state.sequencer.sampleDownloadProgress,f=l.downloaded,h=l.total,window.parent&&document.referrer&&(d=document.referrer,p="stem loaded "+(f+1),window.parent.postMessage(p,d)),n.dispatch(Object(u.jd)(f+1,h)),i(c),r.next=15;break;case 11:r.prev=11,r.t0=r.catch(1),console.log("error loading sample",r.t0),s();case 15:case"end":return r.stop()}},r,null,[[1,11]])}));return function(e,t){return r.apply(this,arguments)}}())}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(16),a=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.length,a=new Float32Array(e.map(function(e){return e.toSeconds?e.toSeconds(!0):e.getNumber(!0)})),i=new Float32Array(e.map(function(e){return e.depth})),o=new Float32Array(e.map(function(e){return e.min})),s=new Float32Array(e.map(function(e){return e.max})),c=new Float32Array(e.map(function(e){return e.depthParameter?e.depthParameter.min:0})),u=new Float32Array(e.map(function(e){return e.depthParameter?e.depthParameter.max:1})),l=window.api.create_buffer(n),f=window.api.create_buffer(n),h=window.api.create_buffer(n),d=window.api.create_buffer(n),p=window.api.create_buffer(n),v=window.api.create_buffer(n);window.Module.HEAPF32.set(a,l>>2),window.Module.HEAPF32.set(i,f>>2),window.Module.HEAPF32.set(c,h>>2),window.Module.HEAPF32.set(u,d>>2),window.Module.HEAPF32.set(o,p>>2),window.Module.HEAPF32.set(s,v>>2);var m=window.api.create_geometry_buffer(n),y=window.api.create_geometry_buffer(n);window.api.getCoordinates(l,f,p,v,h,d,r.c,r.a,r.b,1,n,m,y);var b,g=new Uint32Array(window.Module.HEAP32.buffer,m,n),O=new Uint32Array(window.Module.HEAP32.buffer,y,n);if(t){b=new Float32Array(2*n);for(var j=0;j<n;j++)b[2*j]=g[j],b[2*j+1]=O[j]}else{b=[];for(var k=0;k<n;k++)b.push({x:g[k],y:O[k]})}return window.api.destroy_buffer(l),window.api.destroy_buffer(f),window.api.destroy_buffer(h),window.api.destroy_buffer(d),window.api.destroy_buffer(p),window.api.destroy_buffer(v),window.api.destroy_buffer(y),window.api.destroy_buffer(m),b}},function(e,t,n){"use strict";n.d(t,"d",function(){return d}),n.d(t,"e",function(){return p}),n.d(t,"i",function(){return v}),n.d(t,"c",function(){return m}),n.d(t,"a",function(){return y}),n.d(t,"b",function(){return b}),n.d(t,"f",function(){return g}),n.d(t,"h",function(){return O}),n.d(t,"g",function(){return j}),n.d(t,"j",function(){return x}),n.d(t,"n",function(){return S}),n.d(t,"k",function(){return E}),n.d(t,"l",function(){return T}),n.d(t,"m",function(){return A});var r=n(1),a=n(16),i=n(259),o=(n(234),n(201)),s=n(200),c=n(249),u=n(846),l=n(161);function f(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d="NAVIER",p="NONE",v="ROTATE",m="LIFE",y="BOUNCE",b="BOUNCE_2",g="ROTATE_ANGLE",O="SPIRAL",j="SCRIPT",k=(Math.sqrt,Math.pow,Object.keys),w=Object.values,x=function(e){return function(t,n,r){return(r.density||1)*e[5].getViscosity(t,n)}};Object(o.a)("swap",{},"Swaps the parameter values cyclicly");var S=function(){var e=Object(c.b)();return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];t=Object(c.a)(e,t,r);var i,o={},s=k(t),u=t[s[0]],l=0,h=f(s);try{for(h.s();!(i=h.n()).done;){var d=i.value,p=void 0;p=l===s.length-1?u:t[s[l+1]],o[d]={x:p.x,y:p.y,density:p.density},l++}}catch(v){h.e(v)}finally{h.f()}return o}},P=function(e,t,n){var r=Object(s.a)(w(e)),a={};for(var i in e){var o=e[i],c=o.x,u=o.y,l=n?n(c,u,e[i]):10,f=c+(c-r.x)*t*10/l,h=u+(u-r.y)*t*10/l;a[i]={x:f,y:h,density:l}}return a};Object(o.a)("expand",{minWidth:"Minimum width of the expansion",maxWidth:"Maximum width of the expansion"},"Expands the values to maxWidth (ratio of initial width 0-1) and then contracts to minWidth (ratio of initial width)");var E=function(e,t){var n=Object(c.b)(),r=!0,i=void 0;return function(o){var u=Object(s.b)(o);i||(i=u);for(var f=arguments.length,h=new Array(f>1?f-1:0),d=1;d<f;d++)h[d-1]=arguments[d];var p=Object(c.a)(n,o,h),v=l.a.apply(void 0,[e].concat(h))*i,m=l.a.apply(void 0,[t].concat(h))*i,y=h[0];return r&&(u>=m||u>=a.c)?r=!1:!r&&u<=v&&(r=!0),P(p,r?y/5:-y/5,x(h))}};Object(o.a)("life",{},"Expands/contracts and randomizes");var T=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Object(c.b)(),n=!1,a=0,o=Object(i.a)("planarReset");return function(i){for(var s=arguments.length,u=new Array(s>1?s-1:0),l=1;l<s;l++)u[l-1]=arguments[l];i=Object(c.a)(t,i,u);var f=u[0],h=u[1],d=u[5];o().some(function(e){return e===d.id})&&(n=!1,a=0),++a%h===0&&(n=!n);var p={};if(e)for(var v in i){var m=Math.random(),y=i[v],b=y.x,g=y.y;m<.2||(m<.4?b--:m<.6?b++:m<.8?g++:g--,p[v]={x:b,y:g})}else p=Object(r.a)({},i);var O=n?Math.random()*f/5:-Math.random()*f/5;return e||(O=n?f/10:-f/10),P(p,O,x(u))}};Object(o.a)("rotate",{degrees:"The degrees of rotation"},"Rotates the parameter values by the center, according to the degrees (0-90)");var A=function(e){var t=Object(c.b)();return function(n){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length,i=new Array(a>2?a-2:0),o=2;o<a;o++)i[o-2]=arguments[o];n=Object(c.a)(t,n,[r].concat(i));var f=l.a.apply(void 0,[e,r].concat(i)),h=Object(s.a)(w(n)),d=h.x,p=h.y,v=M(n,-d,-p),m=Object(u.a)(f)*r,y={};return k(v).forEach(function(e){var t=v[e],n=t.x,a=t.y,o=x([r].concat(i))(n,a,v[e]),s=10*m/o;y[e]={x:n*Math.cos(s)-a*Math.sin(s),y:a*Math.cos(s)+n*Math.sin(s),density:o}}),M(y,d,p)}},M=function(e,t,n){var a={};return k(e).forEach(function(i){return a[i]=Object(r.a)({},e[i],{x:e[i].x+t,y:e[i].y+n})}),a}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var r=1,a={0:"Vocals",1:"Instruments",2:"Drums",3:"Bass",4:"Guitars"}},,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return f}),n.d(t,"b",function(){return d}),n.d(t,"c",function(){return m});var r=n(11),a=n(108),i=n(572),o=n(136),s=n(146),c=n(164),u=n(109),l=0;Object(u.a)("gl.material",{fragColor:"",size:""},"Outputs a material from the shader expression given in the inlet",void 0,{tags:"GLSL",isHot:!0,inlets:2,connects:{object:"three.planeRenderer"}});var f=function(e,t){var n=new i.a(e);e.needsHotReload=!0,e.shader=n,e._effect=void 0,n.onVertexShader("\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(\n    position, \n    1.0 );\n  \n}\n"),Object(o.e)("canvas.size",function(n){t=function(){return n},e.refresh()}),Object(o.e)("shader.render",function(){window.hardStopRender||e.sendMessage(e.outputByNumber(0),n.material)}),Object(o.e)("shader.iframe",function(e){n.createUniform("iframe",e)});var r=h(e),s=0;return function(i){var c=Object(a.a)(i,1)[0];if("bang"!==c){if(c.code){var u=t()||Object(o.d)("canvas.size");Array.isArray(u)||(u=[300,300]),Array.isArray(u[0])&&(u=u[0]);var f=u,h=Object(a.a)(f,2),d=h[0],v=h[1];c.uniforms.iframe={value:0},c.uniforms.width={value:d},c.uniforms.height={value:v},c.uniforms.offset_v={value:window.offset_v||0};var m=r(c,n);if(m!==n.fragmentShader&&!e.sequencerEngine.isLoading&&!window.stopGLCompile){var y=++s;setTimeout(function(){if(y===s){var t=p(n.fragmentShader,m);console.log("COMPILING uni=%s iteration=%s",Object.keys(c.uniforms).length,l++),window.compiledCode=m,window.compiledUniforms=c.uniforms,n.onFragmentShader(m),t,e.lastOutput=n.material,e.sendMessage(e.outputByNumber(0),n.material)}},50)}}}else e.sendMessage(e.outputByNumber(0),n.material)}};window.fallBackUpdate={};var h=function(e){return function(t,n){var a=t.code,i=t.uniforms,o=t.variables,u=t.functions,l="\n";for(var f in i)if(!f.includes("$")){var h=i[f].value;void 0!==h&&null!==h||(h=0);var d=Array.isArray(h)&&Array.isArray(h[0])?"mat3":4===h.length?"vec4":3==h.length?"vec3":2==h.length?"vec2":isNaN(h)?"sampler2D":"float";f.includes("tex")&&(d="sampler2D"),l+="uniform "+d+" "+f+"; \n"}!function(e,t,n){var a=function(a){if(t[a].update)return"continue";t[a].canvases||(t[a].canvases={}),t[a].update=function(){for(var e in t[a].canvases){var n;(n=t[a].canvases)[e].apply(n,arguments)}},t[a].canvases[n.id]=function(t,i){if(Array.isArray(t))if(Array.isArray(t[0])){if(3===t.length){var o=new c.y;o.set.apply(o,Object(r.a)(t.flat(6))),t=o}}else 2===t.length?t=new c.bb(t[0],t[1]):3===t.length?t=new c.cb(t[0],t[1],t[2]):4===t.length&&(t=new c.db(t[0],t[1],t[2],t[3]));if(e.createUniform(a,t),!window.stopRender&&!i){if(window.hardStopRender)return;n.sendMessage(n.outputByNumber(0),e.material)}};var i=t[a].value;if(Array.isArray(i))if(Array.isArray(i[0])){if(3===i.length){var o=new c.y;o.set.apply(o,Object(r.a)(i.flat(6))),i=o}}else 2===i.length?i=new c.bb(i[0],i[1]):3===i.length?i=new c.cb(i[0],i[1],i[2]):4===i.length&&(i=new c.db(i[0],i[1],i[2],i[3]));window.fallBackUpdate[a]=t[a].update,e.createUniform(a,i)};for(var i in t)a(i)}(n,i,e),l+="\n\nconst float EPSILON = 0.0001;\n#define PI 3.141592653589793\n\n#define cx_mul(a, b) vec2(a.x*b.x - a.y*b.y, a.x*b.y + a.y*b.x)\n#define cx_div(a, b) vec2(((a.x*b.x + a.y*b.y)/(b.x*b.x + b.y*b.y)),((a.y*b.x - a.x*b.y)/(b.x*b.x + b.y*b.y)))\n#define cx_sin(a) vec2(sin(a.x) * cosh(a.y), cos(a.x) * sinh(a.y))\n#define cx_cos(a) vec2(cos(a.x) * cosh(a.y), -sin(a.x) * sinh(a.y))\n\n// Identity matrix.\nconst mat3 identity =  mat3(\n        vec3(1, 0, 0),\n        vec3(0, 1, 0),\n        vec3(0, 0, 1)\n    );\n\nmat2 rotate2D(float angle) {\n    return mat2(\ncos(angle), -sin(angle),sin(angle),cos(angle));\n}\n\nmat4 lookAt(vec3 eye, vec3 target, vec3 up) {\n    vec3 z = normalize(eye - target);\n    vec3 x = normalize(cross(up, z));\n    vec3 y = normalize(cross(z, x));\n    mat4 translation = mat4(\n        vec4(1.0, 0.0, 0.0, eye.x),\n    \tvec4(0.0, 1.0, 0.0, eye.y),\n        vec4(0.0, 0.0, 1.0, eye.z),\n        vec4(0.0, 0.0, 0.0, 1.0)\n    );\n    mat4 rotation = ".concat(s.isMobile?"translation":"transpose(mat4(vec4(x, 0.0),vec4(y, 0.0),vec4(z, 0.0),vec4(0.0, 0.0, 0.0, 1.0)))",";\n    return translation * rotation;\n}\n\nvec3 getRayDir(mat4 camera, float fov) {\n    fov = radians(fov);\n    vec2 p = 1.0*((gl_FragCoord.xy-vec2(width, height)))/vec2(width, height);\n    vec2 h = vec2(\n        tan(fov / 2.0) * (width / height), \n        tan(fov / 2.0)\n    );\n    vec3 pCam = vec3(p * h, -1.0);\n    return normalize((").concat(s.isMobile?"camera":"inverse(camera)"," * vec4(pCam, 0.0)).xyz);\n}\n\nfloat sdRoundBoxCoord( vec2 p, vec2 off, vec2 b, float r, mat3 transform, float angle ) \n{\n  off -= vec2(0.0, offset_v);\n  vec3 p3 = vec3(p, 0.0);\n  vec3 off3 = vec3(off, 0.0);\n  p3 = (p3 - off3); //*transform;\n  p.x = p3.x;\n  p.y = p3.y;\n  if (angle != 0.0) {\n  p *= rotate2D(angle);\n  }\n  vec2 q = abs(p)-b+r;\n  return min(max(q.x,q.y),0.0) + length(max(q,0.)) - r;\n}\n\nfloat sdRoundBox3DCoord( vec3 p, vec3 off, vec3 b, float r, mat3 transform, float pivot) \n{\n  vec3 q = abs(p) - b;\n  return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0) - r;\n}\n\nfloat sdRoundBox( vec2 off, vec2 b, float r ) \n{\n  off -= vec2(0.0, offset_v);\n  vec2 p = (1.0*gl_FragCoord.xy-vec2(width, height))/height;\n  return sdRoundBoxCoord(p, off, b, r, identity, 0.0);\n}\n\nfloat ATan2(float x, float y)\n{\n    float angle = asin(x) > 0.0 ? acos(y) : -acos(y);\n    return angle;\n}\n\nvec3 hsl2rgb(vec3 c) {\n    vec3 rgb = clamp(abs(mod(c.x * 6.0 + vec3(0.0,4.0,2.0), 6.0) - 3.0) - 1.0, 0.0, 1.0);\n        return c.z + c.y * (rgb - 0.5) * (1.0 - abs(2.0 * c.z - 1.0));\n}\nvec3 rgb2hsl(vec3 c) {\n    float h = 0.0;\n    float s = 0.0;\n    float l = 0.0;\n    float r = c.r;\n    float g = c.g;\n    float b = c.b;\n    float cMin = min( r, min( g, b ) );\n    float cMax = max( r, max( g, b ) );\n    l = ( cMax + cMin ) / 2.0;\n    if ( cMax > cMin ) {\n        float cDelta = cMax - cMin;\n        s = l < .0 ? cDelta / ( cMax + cMin ) : cDelta / ( 2.0 - ( cMax + cMin ) );\n        if ( r == cMax ) {\n            h = ( g - b ) / cDelta;\n        } else if ( g == cMax ) {\n            h = 2.0 + ( b - r ) / cDelta;\n        } else {\n            h = 4.0 + ( r - g ) / cDelta;\n        }\n        if ( h < 0.0) {\n            h += 6.0;\n        }\n        h = h / 6.0;\n     }\n     return vec3( h, s, l );\n}\n\nvec4 rainbow(float level)\n{\n\t/*\n\t\tTarget colors\n\t\t=============\n\t\t\n\t\tL  x   color\n\t\t0  0.0 vec4(1.0, 0.0, 0.0, 1.0);\n\t\t1  0.2 vec4(1.0, 0.5, 0.0, 1.0);\n\t\t2  0.4 vec4(1.0, 1.0, 0.0, 1.0);\n\t\t3  0.6 vec4(0.0, 0.5, 0.0, 1.0);\n\t\t4  0.8 vec4(0.0, 0.0, 1.0, 1.0);\n\t\t5  1.0 vec4(0.5, 0.0, 0.5, 1.0);\n\t*/\n\t\n\tfloat r = float(level <= 2.0) + float(level > 4.0) * 0.5;\n\tfloat g = max(1.0 - abs(level - 2.0) * 0.5, 0.0);\n\tfloat b = (1.0 - (level - 4.0) * 0.5) * float(level >= 4.0);\n\treturn vec4(r, g, b, 1.0);\n}\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\n");var p=Object.keys(u).filter(function(e){return e.startsWith("lightShift")||e.startsWith("hueShift")}),m=Object.keys(u).filter(function(e){return e.startsWith("turbulence")||e.startsWith("fade")||e.startsWith("perlin")||e.startsWith("mod289")||e.startsWith("permute")||e.startsWith("taylorInvSqrt")}),y=Object.keys(u).filter(function(e){return e.startsWith("position")}),b=Object.keys(u).filter(function(e){return e.startsWith("sdf")}),g=Object.keys(u).filter(function(e){return e.includes("generated")}),O=Object.keys(u).filter(function(e){return e.startsWith("scene")}),j=Object.keys(u).filter(function(e){return!e.startsWith("position")&&!e.startsWith("sdf")&&!e.startsWith("scene")&&!e.includes("generated")&&!(e.startsWith("perlin")||e.startsWith("mod289")||e.startsWith("permute")||e.startsWith("taylor")||e.startsWith("fade")||e.startsWith("turbulence")||e.startsWith("lightShift")||e.startsWith("hueShift"))}),k={};for(var w in p.forEach(function(e){return k[e]=u[e]}),y.forEach(function(e){return k[e]=u[e]}),m.forEach(function(e){return k[e]=u[e]}),g.forEach(function(e){return k[e]=u[e]}),b.forEach(function(e){return k[e]=u[e]}),O.forEach(function(e){return k[e]=u[e]}),j.forEach(function(e){return k[e]=u[e]}),u=k)l+=v(w,u[w])+"\n";if(l+="\nvoid main() {\n/*\n    vec2 uv_bound = (1.0*gl_FragCoord.xy-vec2(width, height))/height;\n    if (abs(uv_bound.x) > 0.62 || abs(uv_bound.y + ".concat(window.offset_v||"0.0",") > 0.8) {\n       gl_FragColor = vec4(0.0);\n       return;\n    }\n*/\n"),o)for(var x in o){var S=o[x],P=S.type,E=S.code;"object"===typeof P?(l+=P.type+" "+x+" = "+P.defaultValue+";\n",l+="\nif (".concat(P.condition,") {\n   ").concat(x," = ").concat(E,";\n}\n")):l+=P+" "+x+" = "+E+";\n\n"}return l+="\n".concat(a,"\n}\n"),a,l,l}};Object(u.a)("mouseSDF",{coord:"",position:"",size:"",cornerRadius:"",resolution:""},"Calculates SDF for a given mouse coord",function(){return 1},{inlets:5});var d=function(e,t,n,r,i){return function(e){var o=Object(a.a)(e,1)[0],s=t(),c=n(),u=r()||0,l=i();if(c&&l&&s&&o){var f=[(2*o[0]-l[0])/l[1],(2*o[1]-l[1])/l[1]];f=[f[0]-s[0],f[1]-s[1]];var h=[Math.abs(f[0])-c[0]+u,Math.abs(f[1])-c[1]+u];return Math.min(Math.max(h[0],h[1]),0)+Math.sqrt(Math.pow(Math.max(0,h[0]),2)+Math.pow(Math.max(0,h[1]),2))-u}}},p=function(e,t){if(!e||!t)return"full";for(var n="",r=0,a=0;a<e.length;a++)e[a]!==t[a]&&r++<10&&(n+=e[a]);return n},v=function(e,t){var n=t.body,r=t.args,a=t.returnType+" "+e+"("+Object.keys(r).map(function(e){return r[e]+" "+e}).join(",")+") {\n";return a+=n+"\n}"},m=function(e){var t="";for(var n in e){var r=e[n],a=r.type,i=r.code;"object"===typeof a?(t+=a.type+" "+n+" = "+a.defaultValue+";\n",t+="\nif (".concat(a.condition,") {\n   ").concat(n," = ").concat(i,";\n}\n")):t+=a+" "+n+" = "+i+";\n\n"}return t}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2),u=n(446),l=n(59),f=n(447);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var d=function(e){Object(o.a)(n,e);var t=h(n);function n(e,a,i){var o;return Object(r.a)(this,n),(o=t.call(this,e,i)).effect=a,o}return Object(a.a)(n,[{key:"subSequence",get:function(){return this.track.tracks?this.track:this.track.subSequence}},{key:"isMidiEffect",value:function(){return!1}},{key:"dispose",value:function(){}},{key:"getParameters",value:function(){return[]}},{key:"getEffectType",value:function(){return l.b}},{key:"getJson",value:function(){var e=Object(i.a)(Object(c.a)(n.prototype),"getJson",this).call(this);return e.effect=this.effect,e}}]),n}(Object(f.a)(u.a));t.a=d},function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return a});var r="PIANO_ROLL",a="EFFECTS"},function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"a",function(){return a}),n.d(t,"b",function(){return i});var r="RANDOMIZE",a="ACCUMULATE",i="NONE"},function(e,t,n){"use strict";n.d(t,"a",function(){return r});n(282),n(115);function r(e){return[]}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),o=n(10),s=n(7),c=n(8),u=n(2),l=n(424),f=n(367),h=n(182),d=n(241),p=n(14);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(s.a)(n,e);var t=v(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Playhead",h.e,e)).system5Objects=[],a.directionParameter=new d.a("direction",Object(i.a)(a),function(e,t){return t},{min:0,max:1,isNumber:!0,unit:"",options:{.1:f.b,.25:f.d,.5:f.c,.75:f.a},defaultValue:f.b}),a.registerParameter(a.directionParameter),a.speedFactorParameter=new p.a("speedFactor",Object(i.a)(a),function(e,t){return t},{min:0,max:16,unit:"x",defaultValue:1,onChange:function(e){return a.system5Objects.forEach(function(e){return e.sendSpeeds()})}}),a.registerParameter(a.speedFactorParameter),a.offsetParameter=new p.a("offset",Object(i.a)(a),function(e,t){return t},{min:0,max:32,unit:"x",defaultValue:0}),a.registerParameter(a.offsetParameter),a.walkParameter=new p.a("walk",Object(i.a)(a),function(e,t){return t},{min:1,max:16,defaultValue:8}),a.registerParameter(a.walkParameter),a}return Object(a.a)(n,[{key:"getParameters",value:function(){return this.parameters}},{key:"offset",get:function(){return this.offsetParameter.get()}},{key:"direction",get:function(){return this.directionParameter.get()}},{key:"speedFactor",get:function(){return this.speedFactorParameter.get()}},{key:"walk",get:function(){return Math.round(this.walkParameter.get())}},{key:"fromJson",value:function(e,t){return Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t)}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson()),t}}]),n}(l.a);t.a=m},,,function(e,t,n){"use strict";n.r(t);var r=n(112).default,a=(n(597).default,n(203).default,n(236).default,{basename:"wrap",gen:function(){var e,t,n=r.getInputs(this),a=(n[0],n[1]),i=n[2];return t=0===this.min?i:isNaN(i)||isNaN(a)?"".concat(i," - ").concat(a):i-a,e=" var ".concat(this.name," = ").concat(n[0],"\n  if( ").concat(this.name," < ").concat(this.min," ) ").concat(this.name," += ").concat(t,"\n  else if( ").concat(this.name," > ").concat(this.max," ) ").concat(this.name," -= ").concat(t,"\n\n"),[this.name," "+e]}});t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=Object.create(a);return Object.assign(i,{min:t,max:n,uid:r.getUID(),inputs:[e,t,n]}),i.name="".concat(i.basename).concat(i.uid),i}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"lt",gen:function(){var e,t=r.getInputs(this);return e="  var ".concat(this.name," = "),isNaN(this.inputs[0])||isNaN(this.inputs[1])?e+="(( ".concat(t[0]," < ").concat(t[1],") | 0  )"):e+=t[0]<t[1]?1:0,e+="\n",r.memo[this.name]=this.name,[this.name,e]}};t.default=function(e,t){var n=Object.create(a);return n.inputs=[e,t],n.name=n.basename+r.getUID(),n}},,,function(e,t,n){"use strict";var r=n(11),a=n(42),i=n.n(a),o=n(56),s=n(4),c=n(5),u=n(7),l=n(8),f=n(2),h=n(127),d=n(271),p=n.n(d),v=function(){function e(){Object(s.a)(this,e),this.selectedTags=[],this.selectedOrTags=[],this.selectedStyles=[],this.selectedCountries=[],this.selectedVideos=[],this.selectedDiscogs=[],this.filterFavorites=!1,this.year=void 0,this.chord=void 0}return Object(c.a)(e,[{key:"toString",value:function(){console.log("selectedTags = "+this.selectedTags.join(",")),console.log("selectedOrTags = "+this.selectedOrTags.join(",")),console.log("selectedStyles= "+this.selectedStyles.join(",")),console.log("selectedCountries = = "+this.selectedCountries.join(","))}},{key:"empty",value:function(){return 0==this.selectedTags.length&&0==this.selectedStyles.length&&0==this.selectedOrTags.length&&0==this.selectedCountries.length&&void 0===this.chord&&void 0==this.year}},{key:"getSearchQueryParameters",value:function(){var e="?tags="+this.selectedTags.join(",")+"&styles="+this.selectedStyles.join(",")+"&countries="+this.selectedCountries.join(",");return void 0!==this.year&&(e+="&year="+this.year),e}},{key:"getTopTags",value:function(){return this.getTopFields("/getTags")}},{key:"getTopStyles",value:function(){return this.getTopFields("/getStyles")}},{key:"getTopCountries",value:function(){return this.getTopFields("/getCountries")}},{key:"getTopFields",value:function(e){var t=this;return new Promise(function(n,r){var a=t.getSearchQueryParameters();e+=a,p.a.get(e).then(function(e){var t=e.data.data,r=[];for(var a in t)r.push(a);n(r)}).catch(function(e){r(e)})})}},{key:"getSounds",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="/filterSearch/"+t+"/"+n+this.getSearchQueryParameters(),e.next=3,p.a.get(r);case 3:return a=e.sent,e.abrupt("return",this.searchCallback(a));case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"searchCallback",value:function(e){for(var t=e.data.data,n=[],r=0;r<t.length;r++)n.push(t[r].id);return{sounds:n,total:e.data.total}}}]),e}(),m=n(159),y=n(162),b=function(){function e(){Object(s.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32",name:"hash",type:"bytes32"}],name:"newGuildClassification",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!0,internalType:"bytes32",name:"hash",type:"bytes32"}],name:"NewGuildClassification",type:"event"}],this.contractAddress="0x3831959eF022C226F3bdfF6481f4666901428f90"}return Object(c.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),g=n(119),O=n(142),j=n(122),k=n(947),w=new b,x={},S=function(){function e(){Object(s.a)(this,e),void 0!==y.a&&y.a.eth.net.isListening()&&(this.contract=new y.a.eth.Contract(w.abi,w.contractAddress),this.ethAddress=this.contract.options.address)}return Object(c.a)(e,[{key:"saveClassifications",value:function(e,t){var n=this;return new Promise(function(){var r=Object(o.a)(i.a.mark(function r(a,o){var s;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,j.a.addJson(t);case 2:return s=r.sent,r.t0=n.contract.methods.newGuildClassification(e,Object(k.a)(s)),r.next=6,m.a.getAccount();case 6:r.t1=r.sent,r.t2={from:r.t1},r.t3=function(e,t){e?o(e):a(s)},r.t0.send.call(r.t0,r.t2,r.t3);case 10:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getClassificationsHash",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n,r,a=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:0,n=new O.a(w.contractAddress).from(g.p).select("contentHash").where("guildId",t),e.next=4,n.executeQuery();case 4:if(0!==(r=e.sent).length){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.abrupt("return",r[0].contentHash);case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getClassifications",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(){var n=Object(o.a)(i.a.mark(function n(r,a){var o,s;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return");case 3:return n.next=5,e.getClassificationsHash(t);case 5:if(void 0!==(o=n.sent)){n.next=10;break}r({}),n.next=15;break;case 10:return n.next=12,j.a.getJson(o);case 12:s=n.sent,x[t]=s,r(s);case 15:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}}]),e}(),P=n(212),E=new S,T=function(){function e(){Object(s.a)(this,e),this.tagToLevel={},this.tagToParent={},this.tagToChildren={},this.loadHierarchy()}return Object(c.a)(e,[{key:"loadHierarchy",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n,r,a,o,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.getClassifications();case 2:for(r in t=e.sent,console.log("LOADED HIERARCHY",t),n={},t)for(a in n[r]=this.getParentOfTag(r,t),t[r])o=t[r][a],n[o]=r;for(s in this.tagToChildren=t,this.tagToParent=n,this.tagToLevel={},n)this.tagToLevel[s]=this.getLevel(s,n);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getAllChildren",value:function(e){var t=this.tagToChildren[e],n=[];for(var r in t)n=n.concat(this.getAllChildren(t[r]));return n.concat(t)}},{key:"reduce",value:function(e,t){if(e.length<=20)return e;var n=1,r=0===t.length,a=!0,i=[];for(var o in t){var s=t[o];i=i.concat(this.getAllChildren(s)),void 0===this.tagToLevel[s]?r=!0:a=!1,this.tagToLevel[s]>=n&&(n=this.tagToLevel[s])}return r&&(n+=2),a?this.filterReduction(e,2,i,r):this.filterReduction(e,n,i,r)}},{key:"filterReduction",value:function(e,t,n,r){var a=this;return e.filter(function(e){return n.indexOf(e.value)>-1||a.tagToLevel[e.value]<=t||r&&void 0===a.tagToLevel[e.value]})}},{key:"getLevel",value:function(e,t){return void 0===t[e]?0:t[e]===e?0:1+this.getLevel(t[e],t)}},{key:"getParentOfTag",value:function(e,t){for(var n in t){if(t[n].indexOf(e)>-1)return n}return null}}]),e}(),A="OR",M="AND",R=n(183);function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function N(e){e=e.map(function(t){return{value:t.value,rank:Math.pow(.9,8*t.rank/e.length)}});var t=Math.max.apply(Math,e.map(function(e){return e.rank}));return e.map(function(e){return{value:e.value,rank:e.rank/t}})}function I(e,t){var n={};for(var r in e)r in t&&(n[r]=e[r].rank+t[r].rank);return n}var q=function(e){Object(u.a)(n,e);var t=C(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this)).cache=e,r.varietyReducer=new T,r}return Object(c.a)(n,[{key:"freeTextSearch",value:function(e){var t=this;return new Promise(function(n,r){n({TAG:N(t.cache.freeTextSearch(R.d,e)),STYLE:N(t.cache.freeTextSearch(R.c,e)),COUNTRY:N(t.cache.freeTextSearch(R.a,e)),YEAR:N(t.cache.freeTextSearch(R.e,e))})})}},{key:"getTopVideos",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.empty()){e.next=4;break}return e.abrupt("return",this.cache.getAllForField(R.f,0,1e7));case 4:return r=this.selectedOrTags.length>0?A:M,e.abrupt("return",this.getTopFields(0,1e7,R.f,r));case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTopDiscogs",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.empty()){e.next=4;break}return e.abrupt("return",this.cache.getAllForField(R.b,0,1e7));case 4:return r=this.selectedOrTags.length>0?A:M,e.abrupt("return",this.getTopFields(0,1e7,R.b,r));case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTopTags",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n,r){var a,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0===r?this.selectedTags:r,!this.filterFavorites){e.next=6;break}return e.next=4,h.a.getFavoritesForUser();case 4:return a=e.sent,e.abrupt("return",this.getTagsForSounds(a));case 6:return e.next=8,this.getTopFields(t,n,R.d);case 8:return o=e.sent,e.abrupt("return",this.varietyReducer.reduce(o,r));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getTopStyles",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.selectedOrTags.length>0?A:M,e.abrupt("return",this.getTopFields(void 0,void 0,R.c,t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTopCountries",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.selectedOrTags.length>0?A:M,e.abrupt("return",this.getTopFields(void 0,void 0,R.a,t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getVideoInfo",value:function(e){var t=Array.from(this.cache.getFieldsForField(R.d,R.f,e)),n=Array.from(this.cache.getFieldsForField(R.c,R.f,e)),r=Array.from(this.cache.getFieldsForField(R.e,R.f,e));return{tags:t.map(function(e){return e.value}),styles:n.map(function(e){return e.value}),year:r.map(function(e){return e.value})[0]}}},{key:"getTopFields",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n,r){var a,o,s,c,u,l,f=this,h=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=h.length>3&&void 0!==h[3]?h[3]:M,o=this.getSelectedFields(a),!this.empty()){e.next=4;break}return e.abrupt("return",N(this.cache.getAllForField(r,t,n)));case 4:for(u in s=[],c=function(e){o[e].forEach(function(t){s.push(f.cache.getFieldsForField(r,e,t))})},o)c(u);return l=[],l=a==A?Array.from(this.unionAll(s)):Array.from(this.intersectAll(s)),e.abrupt("return",N(l));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSelectedFields",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=void 0===this.year?[]:[this.year];return{TAG:e==A?this.selectedOrTags:this.selectedTags,STYLE:this.selectedStyles,COUNTRY:this.selectedCountries,YEAR:t}}},{key:"getTagsForSounds",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r,a,o,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a in n={},r=[],t)r.push(h.a.getTagsForSound(t[a]));return e.next=5,Promise.all(r);case 5:for(s in o=e.sent)o[s].forEach(function(e){return n[e]=!0});return e.abrupt("return",Object.keys(n));case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"unionAll",value:function(e){if(void 0===e||0==e.length)return[];var t={};return e.forEach(function(e){return e.forEach(function(e){e.value in t||(t[e.value]=0),t[e.value]+=e.rank})}),t}},{key:"intersectAll",value:function(e){if(void 0===e||0==e.length)return[];var t=[],n=function(n){a=e[n];var r={};a.forEach(function(e){return r[e.value]=e.rank}),t.push(r)};for(var r in e){var a;n(r)}for(var i=t[0],o=1;o<t.length;o++)i=I(i,t[o]);var s=new Set;for(var c in i)s.add({value:c,rank:i[c]/t.length});return s}}]),n}(v),_=n(74);function D(e,t){var n=new Set(e),r=new Set(t);return Array.from(n).every(function(e){return r.has(e)})&&Array.from(r).every(function(e){return n.has(e)})}var F=function(){function e(t){Object(s.a)(this,e),this.store=t,this.selectedTags=[],this.selectedOrTags=[],this.selectedStyles=[],this.selectedCountries=[],this.selectedVideos=[],this.filterFavorites=!1,this.chord=!1,this.year=void 0,this.unsortedResults=[],this.canceled=!1,this.mostRecentResults=void 0,this.mostPopularResults=void 0,this.shuffledResults=void 0}return Object(c.a)(e,[{key:"sortBy",get:function(){return this.store.getState().selector.sortBy}},{key:"addLazyResults",value:function(){var e=Object(o.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.linkedPromiseList=t;case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getNext",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.linkedPromiseList&&!this.canceled){e.next=3;break}return this.canceled||this.setFinalResults(this.unsortedResults),e.abrupt("return",void 0);case 3:return e.next=5,this.linkedPromiseList.getCurrent();case 5:if(t=e.sent,(t=Array.from(new Set(t))).forEach(function(e){n.unsortedResults.push(e)}),this.setFinalResults(this.unsortedResults),void 0!==this.linkedPromiseList){e.next=11;break}return e.abrupt("return",void 0);case 11:return e.next=13,this.linkedPromiseList.getNext();case 13:return this.linkedPromiseList=e.sent,e.abrupt("return",this.linkedPromiseList);case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addUnsortedResults",value:function(e){this.unsortedResults=e}},{key:"sort",value:function(){this.setFinalResults(this.unsortedResults)}},{key:"setFinalResults",value:function(e){this.unsortedResults=e,this.sortBy===_.a?this.mostPopularResults?this.results=this.mostPopularResults:(this.results=this.sortByRanking(Object(r.a)(this.unsortedResults)),this.mostPopularResults=this.results):this.sortBy===_.c?void 0===this.shuffledResults?(this.results=Object(P.a)(Object(r.a)(this.unsortedResults)),this.shuffledResults=this.results):this.results=this.shuffledResults:this.mostRecentResults?this.results=this.mostRecentResults:(this.results=this.unsortedResults,this.mostRecentResults=this.results)}},{key:"sortByRanking",value:function(e){var t=this;return void 0===this.sampleToRanking?e:(e.sort(function(e,n){var r=e in t.sampleToRanking?t.sampleToRanking[e]:0;return(n in t.sampleToRanking?t.sampleToRanking[n]:0)-r}),e)}},{key:"getAllSounds",value:function(){var e=this,t=void 0===this.favorites||void 0===this.results?this.results:this.results.filter(function(t){return e.favorites.indexOf(t)>-1});return Array.from(new Set(t))}},{key:"getResults",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,r=this.getAllSounds();return void 0!==r&&(void 0!==this.stylesSounds&&(r=r.filter(function(t){return e.stylesSounds.has(t)})),void 0!==this.yearSounds&&(r=r.filter(function(t){return e.yearSounds.has(t)})),void 0!==this.chordSounds&&(r=r.filter(function(t){return e.chordSounds.has(t)})),void 0!==this.videosSounds&&(r=r.filter(function(t){return e.videosSounds.has(t)}))),void 0===r?{sounds:[],total:0}:void 0!==t&&void 0!==n?t>=r.length?{sounds:[],total:0}:t+n>=r.length?{sounds:r.slice(t),total:r.length}:{sounds:r.slice(t,t+n),total:r.length}:{sounds:r,total:r.length}}},{key:"cancel",value:function(){this.canceled=!0}},{key:"empty",value:function(){return 0===this.selectedTags.length&&0===this.selectedStyles.length&&0===this.selectedOrTags.length&&-0==this.selectedCountries.length&&0===this.selectedVideos.length&&void 0===this.chord&&void 0===this.year}},{key:"equals",value:function(e){var t=!1;return this.chord===e.chord?t=!0:void 0===this.chord||void 0===e.chord?t=!1:this.chord.join(",")===e.chord.join(",")&&(t=!0),D(this.selectedTags,e.selectedTags)&&D(this.selectedOrTags,e.selectedOrTags)&&D(this.selectedStyles,e.selectedStyles)&&D(this.selectedVideos,e.selectedVideos)&&D(this.selectedDiscogs,e.selectedDiscogs)&&D(this.selectedCountries,e.selectedCountries)&&function(e,t){if(void 0!==e&&void 0===t)return!1;if(void 0!==t&&void 0===e)return!1;if(void 0===e&&void 0===t)return!0;e=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),t=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());var n=Math.abs(e-t);if(0===Math.floor(n/1e3/60/60/24))return!0;return!1}(this.fromDate,e.fromDate)&&this.filterFavorites===e.filterFavorites&&t&&this.year===e.year}}]),e}(),L=n(833),B=n(983);function z(e,t){return new Set(Object(r.a)(e).filter(function(e){return t.has(e)}))}function J(e,t){return V.apply(this,arguments)}function V(){return(V=Object(o.a)(i.a.mark(function e(t,n){var r,a,o,s,c,u,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a in r=[],t)o=t[a],r.push(n(o));return e.next=4,Promise.all(r);case 4:s=e.sent,c=new Set(s[0]),e.t0=i.a.keys(s);case 7:if((e.t1=e.t0()).done){e.next=15;break}if(0!=(u=e.t1.value)){e.next=11;break}return e.abrupt("continue",7);case 11:l=new Set(s[u]),c=z(c,l),e.next=7;break;case 15:return e.abrupt("return",Array.from(c));case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function H(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var U=new(function(){function e(){Object(s.a)(this,e),this.recentQueries=[],this.guildId=0}return Object(c.a)(e,[{key:"setStore",value:function(e){var t=this;void 0===this.store&&e&&(this.store=e,this.store.subscribe(function(){return t.onChange()}))}},{key:"onChange",value:function(){var e=this.store.getState().guilds.selectedGuild,t=e?e.guildId:0;t!==this.guildId&&(console.log("guild changed to guildId = "+t),this.guildId=t,this.clear())}},{key:"clear",value:function(){this.recentQueries=[]}},{key:"createSearchQuery",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new F(this.store);return n.selectedTags=e.selectedTags,n.selectedOrTags=e.selectedOrTags,n.selectedStyles=e.selectedStyles,n.selectedVideos=e.selectedVideos,n.selectedDiscogs=e.selectedDiscogs,n.selectedCountries=e.selectedCountries,n.filterFavorites=e.filterFavorites,n.fromDate=e.fromDate,n.chord=void 0===e.chord?void 0:Object(r.a)(e.chord),n.year=e.year,t||(n.sampleToRanking=e.sampleToRanking),n}},{key:"getSearchQueryIfExists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.createSearchQuery(e),r=this.recentQueries.filter(function(e){return n.equals(e)&&!n.canceled});return void 0===(r=0==r.length?void 0:r[0])||t||(r.sampleToRanking=e.sampleToRanking,r.canceled=!1),void 0!==r&&r.sort(),r}},{key:"addNewQuery",value:function(e){this.recentQueries.push(e),this.recentQueries.length>25&&this.recentQueries.splice(0,1)}}]),e}()),G={},W=function(e){Object(u.a)(n,e);var t=H(n);function n(e,r){var a;return Object(s.a)(this,n),(a=t.call(this,e)).store=r?r.store:void 0,a.cache=e,a.updateSoundRankings(),U.setStore(a.store),a}return Object(c.a)(n,[{key:"getNewIndex",value:function(){var e=Object(o.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.loadNewIndex(t);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"clearCache",value:function(){U.clear(),G={}}},{key:"filterByMonth",value:function(){var e=Object(o.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.filterByMonth(t.getMonth(),t.getFullYear());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"clearFilterByMonth",value:function(){this.cache.clearFilter()}},{key:"sortBy",get:function(){return U.sortBy},set:function(e){U.sortBy=e}},{key:"getAllSounds",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a,o,s,c,u,l,f;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(r=U.getSearchQueryIfExists(this,!0))){e.next=3;break}return e.abrupt("return",r);case 3:return r=U.createSearchQuery(this,!0),e.next=6,this.getSoundsWithVideos(this.selectedVideos);case 6:return a=e.sent,e.next=9,this.getSoundsWithDiscogs(this.selectedDiscogs);case 9:if(o=e.sent,r.videosSounds=K(a,o),s=[],!this.filterFavorites){e.next=18;break}return e.next=15,h.a.getFavoritesForUser();case 15:s=e.sent,e.next=32;break;case 18:if(c=void 0,void 0===a&&void 0===o){e.next=23;break}c=r.videosSounds,e.next=31;break;case 23:return(u=new Date(this.fromDate)).setDate(this.fromDate.getDate()+31),l=(new Date).getTime(),e.next=28,h.a.getAllSounds(this.fromDate,u);case 28:c=e.sent,f=(new Date).getTime(),f-l;case 31:c.forEach(function(e){-1==s.indexOf(e)&&s.push(e)});case 32:return r.setFinalResults(s),U.addNewQuery(r),e.abrupt("return",r);case 35:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSounds",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var a,o,s,c,u,l,f,d,p,v,m,y;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(a=U.getSearchQueryIfExists(this))){e.next=3;break}return e.abrupt("return",a);case 3:return a=U.createSearchQuery(this),(new Date).getTime(),e.next=7,this.getSoundsWithTags(this.selectedTags);case 7:return o=e.sent,e.next=10,this.getSoundsWithVideos(this.selectedVideos);case 10:return s=e.sent,e.next=13,this.getSoundsWithDiscogs(this.selectedDiscogs);case 13:return c=e.sent,e.next=16,this.getSoundsWithOrTags(this.sortTagsByPopularity(this.selectedOrTags));case 16:return u=e.sent,e.next=19,this.getSoundsWithStyles(this.selectedStyles);case 19:return l=e.sent,e.next=22,this.getSoundsWithCountries(this.selectedCountries);case 22:return f=e.sent,e.next=25,this.getSoundsWithYear(this.year);case 25:return d=e.sent,e.next=28,this.getSoundsWithChord(this.chord);case 28:if(p=e.sent,(new Date).getTime(),v=[p,o,l,f,d],m=this.intersectResultsForFilters(v),!this.filterFavorites){e.next=38;break}return e.next=35,h.a.getFavoritesForUser();case 35:e.t0=e.sent,e.next=39;break;case 38:e.t0=void 0;case 39:return y=e.t0,m=[].concat(Object(r.a)(m),Object(r.a)(u)),a.videosSounds=K(s,c),a.favorites=y,a.countriesSounds=f,a.stylesSounds=l,a.yearSounds=d,a.chordSounds=p,a.addUnsortedResults(m),U.addNewQuery(a),e.abrupt("return",a);case 50:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSoundsWithTags",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.t0=Set,e.next=5,J(t,function(e){return n.getSoundsWithTag(e)});case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithTag",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in G)){e.next=2;break}return e.abrupt("return",G[t]);case 2:return e.next=4,h.a.getSoundsWithTag(t);case 4:return n=e.sent,G[t]=n,e.abrupt("return",n);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithVideos",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r,a,o,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:for(r in n=[],t)n.push(h.a.getSoundsWithVideo(t[r]));return e.next=6,Promise.all(n);case 6:for(s in a=e.sent,o=[],a)o=o.concat(a[s]);return e.abrupt("return",new Set(o));case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithDiscogs",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r,a,o,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:for(r in n=[],t)n.push(h.a.getSoundsWithDiscogs(t[r]));return e.next=6,Promise.all(n);case 6:for(s in a=e.sent,o=[],a)o=o.concat(a[s]);return e.abrupt("return",new Set(o));case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithOrTags",value:function(){var e=Object(o.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,h.a.getSoundsWithOrTags(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"recursivelySearchOrTags",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=t.length){e.next=2;break}return e.abrupt("return",new Promise(function(e,t){return e(void 0)}));case 2:return n=t[0],e.abrupt("return",new L.a(function(){return h.a.getSoundsWithTag(n)},this.recursivelySearchOrTags(t.slice(1))));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithStyles",value:function(){var e=Object(o.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.next=5,J(t,function(e){return h.a.getSoundsWithStyle(e)});case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithCountries",value:function(){var e=Object(o.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.next=5,J(t,function(e){return h.a.getSoundsWithCountry(e)});case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithYear",value:function(){var e=Object(o.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.next=5,h.a.getSoundsWithYear(this.year);case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithChord",value:function(){var e=Object(o.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.t1=Object,e.next=6,(new B.a).searchRankedNotes(this.chord);case 6:return e.t2=e.sent,e.t3=e.t1.keys.call(e.t1,e.t2),e.abrupt("return",new e.t0(e.t3));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"intersectResultsForFilters",value:function(e){if(this.selectedOrTags.length>0)return[];var t=!1,n=new Set([]);for(var r in e){var a=e[r];if(void 0!==a)if(n.size>0){if(!(a.size>0))continue;n=z(n,a),t=!0}else!t&&a.size>0&&(n=a)}return Array.from(n)}},{key:"sortTagsByPopularity",value:function(e){var t=this.cache.getAllForField(R.d,0,2e3);return e.sort(function(e,n){return t.indexOf(e)-t.indexOf(n)}),e}},{key:"updateSoundRankings",value:function(){var e=Object(o.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.getOverallVotedRankings();case 2:this.sampleToRanking=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(q);function K(e,t){if(void 0!==e||void 0!==t){var n=new Set;return e&&e.forEach(function(e){return n.add(e)}),t&&t.forEach(function(e){return n.add(e)}),n}}t.a=W},function(e,t,n){"use strict";var r=n(11),a=n(42),i=n.n(a),o=n(56),s=n(4),c=n(5),u=n(7),l=n(8),f=n(2),h=n(6),d=n.n(h),p=n(9),v=n(34),m=(n(66),n(64),n(67),n(65),n(47),n(68),n(69),n(70),n(376)),y=n(10);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var g=function(e){Object(u.a)(n,e);var t=b(n);function n(e,r,a){var i;return Object(s.a)(this,n),(i=t.call(this,e)).sequencerEngine=r,i.subSequence=a,i}return Object(c.a)(n,[{key:"getMixType",value:function(){return p.f}},{key:"getValueAtStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=this.getNextEvent({step:e},!0),r=this.getPreviousEvent({step:e},!1,!0);if(void 0===r){if(void 0===n)return t;var a=e/n.step;return t*(1-a)+n.value*a}if(void 0===n)return r.volume;var i=(e-r.step)/(n.step-r.step);return r.volume*(1-i)+n.volume*i}},{key:"deleteEvent",value:function(e){var t=this.events.indexOf(e);t>-1&&this.events.splice(t,1),this.updateRedux(this.subSequence,this.sequencerEngine)}},{key:"loadFromJson",value:function(e,t,r){Object(y.a)(Object(f.a)(n.prototype),"loadFromJson",this).call(this,e,t,r),this.updateRedux(r,t)}}]),n}(m.a),O=n(621),j=n(38),k=n(36),w=n(21),x=n(974),S=n(377),P=n(441),E=n(442),T=n(440),A=n(257),M=n(169);function R(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var C=function(e){Object(u.a)(n,e);var t=R(n);function n(e,r,a,i){var o;return Object(s.a)(this,n),(o=t.call(this,e,r.getType())).event=r,o.difference=a,o.inPlace=i,o}return Object(c.a)(n,[{key:"execute",value:function(){this.event.duration=this.getDuration(this.event);this.events.map(function(e){return e.step});if(0!==this.differeence){for(var e=void 0,t=0;t<this.events.length;t++){var n=this.events[t];if(n.step>this.event.step){n.step+=this.difference;var r=this.events[t+1];if(r&&r.step<=n.step&&(e=t),this.inPlace)break}}void 0!==e&&this.events.splice(e,1),this.events.map(function(e){return e.step}),this.calculateDurations()}}}]),n}(M.a);function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var I=function(e){Object(u.a)(n,e);var t=N(n);function n(e,r,a){var i;return Object(s.a)(this,n),(i=t.call(this,e,r[0].getType())).eventsToPaste=r,i.stepNumber=a,i}return Object(c.a)(n,[{key:"insertEvent",value:function(e,t){new A.a(this.mix,e,t).execute()}},{key:"execute",value:function(){var e=this.eventsToPaste[0].step;for(var t in this.eventsToPaste){var n=this.eventsToPaste[t];n.step=n.step-e+this.stepNumber,this.insertEvent(n,n.duration)}}}]),n}(M.a);function q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var _=function(e){Object(u.a)(n,e);var t=q(n);function n(e,r,a){var i;return Object(s.a)(this,n),(i=t.call(this,void 0,p.j)).sequenceRollEvent=e,i.event=r,i.difference=a,i}return Object(c.a)(n,[{key:"events",get:function(){return this.sequenceRollEvent.events},set:function(e){this.sequenceRollEvent.events=e}},{key:"execute",value:function(){for(var e=void 0,t=0;t<this.events.length;t++){var n=this.events[t];if(n.step>this.event.step){n.step+=this.difference;var r=this.events[t+1];r&&r.step<=n.step&&(e=t),n.duration+this.difference<0&&(e=t);break}}void 0!==e&&this.sequenceRollEvent.subEvents.splice(e-1,1),this.sequenceRollEvent.calculateDurations()}}]),n}(M.a);function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var F="LEFT",L=function(e){Object(u.a)(n,e);var t=D(n);function n(e,r,a,i,o){var c;return Object(s.a)(this,n),(c=t.call(this,e,r.getType())).sequenceRollEvent=r,c.resolutionChangeEvent=a,i===F?c.newStart=o:c.difference=o,c.direction=i,c}return Object(c.a)(n,[{key:"execute",value:function(){this.direction===F?this.resizeLeftSide():this.resizeRightSide()}},{key:"resizeLeftSide",value:function(){0===this.sequenceRollEvent.getSubEvents().indexOf(this.resolutionChangeEvent)&&(this.sequenceRollEvent.step=this.newStart),this.resolutionChangeEvent.step=this.newStart,this.sequenceRollEvent.calculateDurations()}},{key:"resizeRightSide",value:function(){this.sequenceRollEvent.step,this.sequenceRollEvent.duration;var e=this.sequenceRollEvent.getSubEvents(),t=-1;for(var n in e)e[n].step===this.resolutionChangeEvent.step&&(t=parseInt(n));t===e.length-1?new C(this.mix,this.sequenceRollEvent,this.difference,!0).execute():new _(this.sequenceRollEvent,this.resolutionChangeEvent,this.difference).execute()}},{key:"getResolutionDuration",value:function(e){var t=e.step+e.duration,n=this.mix.getValuesBetweenSteps(p.k,e.step,t);for(var r in n)if(!n[r].value)return n[r].step-e.step;return e.duration}}]),n}(M.a),B=function(){function e(t,n){Object(s.a)(this,e),this.sequencerEngine=t,this.subSequence=void 0===n?p.g:n}return Object(c.a)(e,[{key:"getTimeForEventToAdd",value:function(e){if(this.sequencerEngine.playing){var t=new d.a.Time(d.a.Master.currentTime).toMilliseconds()-new d.a.Time(this.sequencerEngine.automationTime).toMilliseconds(),n=this.sequencerEngine.automationStep||0;return e.isDeterministic()||n--,{time:t,step:n}}}},{key:"seekToTrackStep",value:function(e){}},{key:"resizeEvent",value:function(e,t,n){}},{key:"deleteEvent",value:function(e,t){}},{key:"deleteCompoundEvent",value:function(e,t){}},{key:"insertEvent",value:function(e,t){}},{key:"pasteEvents",value:function(e,t){}},{key:"restart",value:function(){}},{key:"addEvent",value:function(e){}},{key:"holdEvent",value:function(e){}},{key:"scheduleNext",value:function(e,t){}},{key:"schedule",value:function(){}},{key:"getValue",value:function(e,t){}},{key:"getEvent",value:function(e,t){}}]),e}();var z=n(23);n(40);function J(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var V=function(e){Object(u.a)(n,e);var t=J(n);function n(e,r){var a;return Object(s.a)(this,n),(a=t.call(this,e,r)).mixesByType={},a.mixesByType[p.l]=new g(p.l,e,r),a.deterministicMixesByType={},a.deterministicMixesByType[p.j]=new O.a(p.j,new j.a(new w.a),a.subSequence),a.deterministicMixesByType[p.k]=new O.a(p.k,new k.a(!1,new w.a),a.subSequence),a.deterministicMixesByType[p.i]=new O.a(p.i,new v.a(0),a.subSequence),r&&a.updateAllTypeRedux(),a}return Object(c.a)(n,[{key:"getValue",value:function(e,t){var n=this.deterministicMixesByType[e];if(void 0!==n)return n.getValue(t,!0)}},{key:"getEvent",value:function(e,t){var n=this.deterministicMixesByType[e];if(void 0!==n)return n.getEvent(t)}},{key:"getValuesBetweenSteps",value:function(e,t,n){var r=this.deterministicMixesByType[e];if(void 0!==r)return r.getValuesBetweenSteps(t,n)}},{key:"holdEvent",value:function(e){if(e.isDeterministic()){var t=e.getType();!t in this.deterministicMixesByType&&(this.deterministicMixesByType[t]=new O.a),this.deterministicMixesByType[t].holdEvent(e)}}},{key:"dispatch",value:function(e){Object(x.a)(this,e)}},{key:"addEvent",value:function(e){var t=this.getTimeForEventToAdd(e);if(void 0!==t){e.subSequence=this.subSequence;e.cancel(),e.isDeterministic()?new T.a(this,e,t.time,t.step).execute():new S.a(this,e,t.time,t.step).execute(),setTimeout(function(){e.canceled=!1},5e3),e.isDeterministic()&&this.updateAllTypeRedux()}}},{key:"getNextEvent",value:function(e){var t=e.getType();return this.deterministicMixesByType[t].getNextEvent(e)}},{key:"getPreviousEvent",value:function(e){var t=e.getType();return this.deterministicMixesByType[t].getPreviousEvent(e)}},{key:"resizeEvent",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];new C(this,e,t,n).execute(),this.updateAllTypeRedux()}},{key:"resizeSequenceRoll",value:function(e,t,n,r){new L(this,e,t,n,r).execute(),this.updateAllTypeRedux()}},{key:"insertEvent",value:function(e,t){new A.a(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"pasteEvents",value:function(e,t){new I(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"deleteEvent",value:function(e,t){new P.a(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"deleteCompoundEvent",value:function(e,t){new E.a(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"seekToTrackStep",value:function(e){for(var t in this.mixesByType)this.mixesByType[t].seekToTrackStep(e);for(var n in this.deterministicMixesByType)this.deterministicMixesByType[n].seekToTrackStep(e)}},{key:"restart",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t in this.mixesByType)this.mixesByType[t].restart(e);for(var n in this.deterministicMixesByType)this.deterministicMixesByType[n].restart(e)}},{key:"scheduleNext",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(o in r=new d.a.Time(d.a.Master.context.currentTime).toMilliseconds(),a=new d.a.Time(n).toMilliseconds()-r,this.mixesByType)this.mixesByType[o].scheduleNext(t,a,this.sequencerEngine);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"eraseEventsAtStep",value:function(e){for(var t in this.mixesByType)this.mixesByType[t].eraseEventsAtStep(e)}},{key:"schedule",value:function(){for(var e in this.mixesByType)this.mixesByType[e].schedule()}},{key:"getJson",value:function(){var e={};for(var t in this.mixesByType)e[t]=this.mixesByType[t].getJson();var n={};for(var r in this.deterministicMixesByType)n[r]=this.deterministicMixesByType[r].getJson();return{name:this.name,mixesByType:e,deterministicMixesByType:n}}},{key:"getCopy",value:function(){var e=new n(this.name);return e.mixesByType=this.mixesByType,e.deterministicMixesByType=this.deterministicMixesByType,e}},{key:"getFirstEvent",value:function(e){return this.deterministicMixesByType[e].defaultValue}},{key:"loadFromJson",value:function(e,t){if(void 0!==e){for(var n in t=this.sequencerEngine,e.mixesByType)this.mixesByType[n]=new g(parseInt(n),t,this.subSequence),this.mixesByType[n].loadFromJson(e.mixesByType[n],t,this.subSequence);for(var r in e.deterministicMixesByType){var a=void 0;(r=parseInt(r))===p.i?a=new v.a(0):r===p.k?a=new k.a(!1,new w.a):r===p.j&&(a=new j.a(new w.a)),this.deterministicMixesByType[r]=new O.a(parseInt(r),a),this.deterministicMixesByType[r].loadFromJson(e.deterministicMixesByType[r],t)}this.updateAllTypeRedux()}}},{key:"updateTypeRedux",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.nc,n=this.deterministicMixesByType[e],r=[],a=this.getFirstEvent(e);a.subSequence=this.subSequence,a.step=0;for(var i=0;i<n.events.length;i++)a.subSequence=this.subSequence,a.duration=n.events[i].step-a.step,r.push(a),a=n.events[i];var o=n.events[n.events.length-1]||a;o&&(o.duration=void 0,o.subSequence=this.subSequence,r.push(o)),this.sequencerEngine.store.dispatch(t(this.subSequence.id,e,r))}},{key:"updateAllTypeRedux",value:function(){for(var e in this.mixesByType)this.mixesByType[e].updateRedux(this.subSequence,this.sequencerEngine);this.updateTypeRedux(p.i,z.nc),this.updateTypeRedux(p.k,z.nc),this.sequencerEngine.dispatch(Object(z.oe)(function(e){var t=Math.max(30,Math.max.apply(Math,Object(r.a)(e.mixes.map(function(e){return e.length/32+16}))));return Math.floor(2*t)}(this.sequencerEngine)))}},{key:"clear",value:function(){for(var e in this.deterministicMixesByType)this.deterministicMixesByType[e].clear();for(var t in this.mixesByType)this.mixesByType[t].clear();this.updateAllTypeRedux()}},{key:"length",get:function(){var e=[];for(var t in this.deterministicMixesByType){var n=this.deterministicMixesByType[t];e=[].concat(Object(r.a)(e),Object(r.a)(n.events.map(function(e){return e.step})))}for(var a in this.mixesByType){var i=this.mixesByType[a];e=[].concat(Object(r.a)(e),Object(r.a)(i.events.map(function(e){return e.step})))}var o=Math.max.apply(Math,Object(r.a)(e.filter(function(e){return void 0!==e&&!isNaN(e)})));return o===-1/0?0:o}},{key:"prune",value:function(e){e in this.deterministicMixesByType&&this.deterministicMixesByType[e].prune(),e in this.mixesByType&&this.deterministicMixesByType[e].prune()}}]),n}(B);t.a=V},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(142),s=n(159),c=n(127),u=n(1),l=n(838),f=n(162),h=function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new l.a(c.a.crypto),0===n){e.next=19;break}return e.next=4,c.a.guilds.getGuildKey(n);case 4:i=e.sent,o=[],e.t0=a.a.keys(t);case 7:if((e.t1=e.t0()).done){e.next=16;break}return s=e.t1.value,e.t2=o,e.next=12,r.decryptQueryResult(t[s],i.privateKey);case 12:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=7;break;case 16:t=o,e.next=20;break;case 19:t=t.map(function(e){return Object(u.a)({},e,{title:f.a.utils.toAscii("0x"+e.encryptedName)})});case 20:return e.abrupt("return",t);case 21:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),d=n(537),p=n(119);function v(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"b",function(){return g}),n.d(t,"a",function(){return k});var y=new d.a,b={},g=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var c,u,l,f,d,m,g,k,w,x,S,P,E,T,A,M,R,C=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=C.length>3&&void 0!==C[3]?C[3]:0,u=C.length>4?C[4]:void 0,l=C.length>5?C[5]:void 0,f=C.length>6?C[6]:void 0,d=C.length>7?C[7]:void 0,m=n+"."+c+"."+l+f,e.abrupt("return",new Promise(function(){var e=Object(i.a)(a.a.mark(function e(t){var r,o,p;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.getAccount();case 2:r=e.sent,o={instrumentType:n,guildId:c,contentHashes:f,user:r,filterFavorites:l,fromBlockNumber:u},d&&(o.searchTerm=d),p=window.spores?"https://zequencer.io/presetSearch":"/presetSearch",console.log("BODY=",o),fetch(p,{method:"POST",body:JSON.stringify(o),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(){var e=Object(i.a)(a.a.mark(function e(n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0==c){e.next=4;break}return e.next=3,h(n,c);case 3:n=e.sent;case 4:t(n);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 12:if(g=e.sent,console.log("preset raw ins results=",g),k=g.map(function(e){return e.contentHash}),f&&(k=k.filter(function(e){return f.includes(e)})),!l){e.next=20;break}return e.next=19,j(k);case 19:k=e.sent;case 20:return w=new o.a(y.contractAddress).from(p.B).select("user").select("encryptedName").select("contentHash").select("encryptedContentKey").select("publicKey").select("guildId").whereIn("contentHash",k).where("guildId",c),u&&w.fromBlock(u),e.next=24,w.executeQuery();case 24:return x=e.sent,e.next=27,h(x,c);case 27:return S=(S=e.sent).filter(function(e){return e.title}),e.next=31,O(S.map(function(e){return e.contentHash}));case 31:P=e.sent,[],E={},T=v(S);try{for(M=function(){var e=A.value;e.tags=Array.from(new Set(P.filter(function(t){return t.contentHash===e.contentHash}).map(function(e){return e.tag}))),E[e.contentHash]=e},T.s();!(A=T.n()).done;)M()}catch(t){T.e(t)}finally{T.f()}return R=Object.values(E),b[m]=R,e.abrupt("return",R);case 39:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),O=function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new o.a(y.contractAddress).from(p.M).select("contentHash").select("tag").whereIn("contentHash",t),e.next=3,n.executeQuery();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.getAccount();case 2:return n=e.sent,e.next=5,c.a.xanadu.getSoundsWithRating(t,5,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),k=function(){return b={}}},function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(4),o=n(5),s=n(7),c=n(8),u=n(2),l=n(145),f=n(319),h=n(210),d=n(23),p=n(123),v=(n(444),n(455),n(6)),m=n.n(v),y=n(425),b=n(286),g=n(583),O=(n(321),n(136)),j=n(33);function k(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var S=n(380),P=n(381),E=n(623);function T(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function M(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var R=function(e){Object(s.a)(n,e);var t=M(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this)).track=e,r.initCache(),r.receivedTriggers=[],r.effects=[],r.inputedTriggers=[],r.noteToTriggers={},r.stepNumber=0,r.times=[],r.setupMessageReader(),r}return Object(o.a)(n,[{key:"addEffect",value:function(e){e&&(this.effects=[].concat(Object(a.a)(this.effects),[e]),this.linkEffectParameters(),e.track=this.track||this._subSequence,e._subSequence=this._subSequence)}},{key:"getEffectById",value:function(e){return this.effects.find(function(t){return t.id===e})}},{key:"getCopy",value:function(e,t){var r=new n(e);return r.effects=this.effects.map(function(n){return n.getCopy(e,t)}),r.linkEffectParameters(),r}},{key:"linkEffectParameters",value:function(){var e=this;this.effects.forEach(function(t){t.registerContext((new p.a).forTrack(e.track)),t.registerMixSession(e.track.mixSession),t.registerTrack(e.track)});var t,n={},a=T(this.effects);try{for(a.s();!(t=a.n()).done;){var i,o=T(t.value.getParameters());try{for(o.s();!(i=o.n()).done;){var s=i.value;n=Object(r.a)({},n,s.setStore(this.track.store))}}catch(c){o.e(c)}finally{o.f()}}}catch(c){a.e(c)}finally{a.f()}this.track.sequencerEngine.parametersToUpdate=Object(r.a)({},this.track.sequencerEngine.parametersToUpdate,n)}},{key:"deleteEffect",value:function(e){var t=this.effects.map(function(e){return e.id}).indexOf(e.id);this.effects.splice(t,1),this.effects=Object(a.a)(this.effects),e.dispose()}},{key:"moveEffectTo",value:function(e,t){if(e!=t){var n=[];e>t?(n=this.effects.slice(0,t).concat([this.effects[e]]).concat(this.effects.slice(t,e)),this.effects.length>e+1&&(n=n.concat(this.effects.slice(e+1)))):(n=this.effects.slice(0,e).concat(this.effects.slice(e+1,t)).concat([this.effects[t],this.effects[e]]),this.effects.length>t+1&&(n=n.concat(this.effects.slice(t+1)))),this.effects=n}}},{key:"needsStableLookAhead",value:function(){return this.effects.some(function(e){return e.needsStableLookAhead()})}},{key:"input",value:function(e,t,n,r){this.inputedTriggers.push(new l.a(e,t,n,0,r))}},{key:"output",value:function(e,t,n){var r=this;this.times.push(e),this.stepNumber=t;var i=[].concat(Object(a.a)(this.inputedTriggers),Object(a.a)(this.receivedTriggers));for(var o in this.receivedTriggers.length=0,i.forEach(function(t){return r.triggerAttackReleasePreFXEnvelopes(e,t)}),this.setNotesDown(i),this.effects){var s=this.effects[o];if(s.isEnabled()){for(var c in i){var u=i[c];s.input(u)}i=s.output(e,t,n)}}return this.triggerAttackReleasePostFXEnvelopes(i),i}},{key:"getDuration",value:function(e){return new m.a.Time("16n")*e}},{key:"subSequence",get:function(){return this.track.subSequence}},{key:"state",get:function(){return this.track.sequencerEngine.state}},{key:"dispatch",value:function(e){this.track.sequencerEngine.dispatch(e)}},{key:"onNewStep",value:function(){this.inputedTriggers=[],this.effects.forEach(function(e){return e.onNewStep()})}},{key:"clear",value:function(){this.effects.forEach(function(e){return e.clear()}),this.receivedTriggers.length=0}},{key:"addEffectJson",value:function(e){var t={},n=Object(b.a)(e,this.track||{sequencerEngine:this.sequencerEngine});if(n)return this.addEffect(n),t=Object(r.a)({},t,n.fromJson(e)),{effect:n,bulk:t}}},{key:"fromJson",value:function(e){var t={};for(var n in e){var a=Object(b.a)(e[n],this.track||{sequencerEngine:this.sequencerEngine});a&&(this.addEffect(a),t=Object(r.a)({},t,a.fromJson(e[n])))}return t}},{key:"getEffectNumber",value:function(e){return this.effects.indexOf(e)}},{key:"getJson",value:function(){return this.effects.map(function(e){return e.getJson()})}},{key:"getAllParameters",value:function(){var e=[];return this.effects.forEach(function(t){return t.getParameters().forEach(function(t){return e.push(t)})}),e}},{key:"getAllPatternLockedParameters",value:function(){return this.getAllParameters().filter(function(e){return e.hasPatternLockedValues()})}},{key:"mate",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=Math.max(e.effects.length,this.effects.length),r=[],a=0;a<n;a++){var i=this.effects[a],o=e.effects[a];Object(h.a)(t)?o&&r.push(o.getCopy(this.track)):i&&r.push(i)}this.effects=r,this.linkEffectParameters()}},{key:"addNoteDown",value:function(e){var t=this.state.keyboard.notesDown||[];this.dispatch(Object(d.rc)([].concat(Object(a.a)(t),[e])))}},{key:"notesDown",get:function(){return this.state.keyboard.notesDown||[]}},{key:"removeNoteDown",value:function(e){var t=this.state.keyboard.notesDown||[],n=(t=Object(a.a)(t)).indexOf(e);t.splice(n,1),this.dispatch(Object(d.rc)(t))}},{key:"setNotesDown",value:function(e){var t=this;if(0!==e.length&&!m.a.Master.context.isOffline&&this.track.sequencerEngine.getSelectedTrack()===this.track&&(this.state.sequencer.showPianoRoll||this.state.spatial.showEditorBottom===y.b)){var n=e.map(function(e){return e.stepData.transpose}),r=this.state.keyboard.notesDown||[];this.dispatch(Object(d.rc)([].concat(Object(a.a)(r),Object(a.a)(n)))),e.forEach(function(e){return setTimeout(function(){e.stepData.trackData&&t.removeNoteDown(e.stepData.transpose)},e.stepData.duration*m.a.Time("16n").toSeconds()*1e3)})}}},{key:"stop",value:function(){this.times=[],this.effects.forEach(function(e){return e.stop()})}},{key:"dispose",value:function(){this._disposed||(this.effects.forEach(function(e){return e.dispose()}),this._disposed=!0)}},{key:"convertToRack",value:function(){var e=this.effects.map(function(e){return e.getEffectCopy()}),t=new P.a(this.track);e.forEach(function(e){return t.addEffect(e,!1)});var n,r=50,a=100,i=T(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.x=r,o.y=a,(r+=50)>300&&(r=50,a+=50)}}catch(c){i.e(c)}finally{i.f()}t.connectNodes(void 0,e[0]);for(var s=0;s<e.length;s++)t.connectNodes(e[s],e[s+1]);this.effects=[],this.addEffect(t)}},{key:"makePlanar",value:function(){var e=new f.a(this.track),t=this.track.effects.flatMap(function(e){return e.getParameters()});this.track.instrument&&(t=[].concat(Object(a.a)(t),Object(a.a)(this.track.instrument.getParameters()))),this.addEffect(e),t.filter(function(e){return!S.a.some(function(t){return e.name.toLowerCase().includes(t.toLowerCase())})}).filter(function(e){return!e.isMapped}).forEach(function(t){return e.setParameter(t)})}}]),n}(Object(E.a)(function(e){Object(s.a)(n,e);var t=x(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"liveInputTrigger",value:function(e,t,n){this.triggerAttackPreFXEnvelopes(void 0,e),this.addNoteDown(e.transpose),this.effects[0]&&this.effects[0].isRack?(this.liveInputTriggerRealTime(e,t,n),this.addNote(e,void 0,n)):this.isRealTime()?this.liveInputTriggerRealTime(e,t,n):this.addNote(e,void 0,n)}},{key:"liveInputTriggerRealTime",value:function(e,t,n){for(var r=this,i=e.transpose,o=this.stepNumber,s=new Set,c=n||m.a.Master.context.currentTime,u=this.times.length-1;u>=0&&c<this.times[u];u--)s.add(Math.max(0,o)),o--;o=Math.max(0,o),s.add(o),(s=Array.from(s)).reverse();var f=[new l.a(e,n,o)];for(var h in this.effects)if(this.effects[h].onNewStep(),this.effects[h].isEnabled()){for(var d in f)this.effects[h].input(f[d],!0);f=this.effects[h].output(n,o,void 0,!0,s)}this.triggerAttackPostFXEnvelopes(f),f.forEach(function(e){e.stepData&&(e.stepData.track=r.track,t?t.liveTrigger(e.stepData,e.stepData.slice,e.time):r.track.skipMidiMaster?r.track.liveTrigger(e.stepData,e.stepData.slice,e.time):r.subSequence.midiEffects.liveInputTrigger(e.stepData,r.track,e.time))});var p=this.noteToTriggers;f.forEach(function(e){e.stepData&&(e.transpose=e.stepData.transpose,e.slice=e.stepData.slice)}),t&&(p=this.noteToTriggers[t.trackNumber]||{},this.noteToTriggers[t.trackNumber]=p),void 0!==p[i]?p[i]=[].concat(Object(a.a)(p[i]),Object(a.a)(f)):p[i]=Object(a.a)(f)}},{key:"liveInputRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this.removeNoteDown(e),this.effects[0]&&this.effects[0].isRack?(this.liveInputReleaseRealTime(e,t,n),this.removeNote(e,t)):this.isRealTime()?(this.liveInputReleaseRealTime(e,t,n),this.removeNote(e,t)):this.removeNote(e,t),0===this.notesDown.length&&(this.triggerReleasePreFXEnvelopes(),this.triggerReleasePostFXEnvelopes())}},{key:"liveInputReleaseRealTime",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=this.noteToTriggers;n&&(r=this.noteToTriggers[n.trackNumber]||{},this.noteToTriggers[n.trackNumber]=r);var i=r[e];if(void 0===i){var o=Object.keys(r);i=r[o[0]]||[],e=o[0]}for(var s=0,c=Object(a.a)(i);s<c.length;s++){var u=c[s];if(u.stepData&&u.stepData.delays){var l,f=k(u.stepData.delays);try{for(f.s();!(l=f.n()).done;){var h=l.value;this.track&&this.track.liveTriggerRelease(h.reference.transpose,0)}}catch(v){f.e(v)}finally{f.f()}}}var d=[];for(var p in i)i[p].slice===t?n?n.liveTriggerRelease(i[p].transpose,i[p].slice):this.track.skipMidiMaster?this.track.liveTriggerRelease(i[p].transpose,i[p].slice):this.subSequence.midiEffects.liveInputRelease(i[p].transpose,i[p].slice,this.track):d.push(i[p]);void 0!==e&&(r[e]=d,0===r[e].length&&delete r[e])}},{key:"addNote",value:function(e,t){var n=[new l.a(e,t)],r=void 0;for(var a in this.effects){if(!(r=this.effects[a]).isRealTime())break;for(var i in this.effects[a].onNewStep(),n)r.input(n[i]);n=this.effects[a].output()}r.addNote(n[0].stepData.transpose,n[0].stepData.slice,this.stepNumber,t)}},{key:"removeNote",value:function(e,t){this.effects.forEach(function(n){return n.removeNote(e,t)})}},{key:"isRealTime",value:function(){return this.effects.filter(function(e){return e.isEnabled()}).every(function(e){return e.isRealTime()})}},{key:"isLiveRealTime",value:function(){return!!this.track.isEnabled&&this.effects.some(function(e){return"Arpeggiator"===e.name})}},{key:"setupMessageReader",value:function(){var e=this;if(this.track&&this.track.subSequence.name){var t=this.track.trackNumber+1+this.track.subSequence.name.toLowerCase(),n=t+".triggerAttack",r=t+".triggerAttackRelease",a=t+".triggerRelease",i=new j.a;i.slice=0,i.duration=null,this.triggerAttackReader&&this.triggerAttackReader(),this.triggerAttackReader=Object(O.e)(n,function(t){var n=void 0;if("object"===typeof t){var r=t.transpose,a=t.time,o=t.velocity;i.velocity=o,i.transpose=r,n=a}else i.transpose=t;e.liveInputTrigger(i,void 0,n)}),this.triggerReleaseReader&&this.triggerReleaseReader(),this.triggerReleaseReader=Object(O.e)(a,function(t){var n="object"===t?t.transpose:t;e.liveInputRelease(n)}),this.triggerAttackReleaseReader&&this.triggerAttackReleaseReader(),this.triggerAttackReleaseReader=Object(O.e)(r,function(t){var n=t.stepData,r=t.time,a=t.stepNumber;(n=e.getStep(n)).track=e.track,e.input(n,r,a),e.receivedTriggers=e.inputedTriggers})}}},{key:"getConnectedEnvelopes",value:function(e){return this.track.envelopesTrack?e===g.b?[]:this.track.envelopesTrack.envelopes.map(function(e){return e.envelope}):this.track.connectedEnvelopes.filter(function(t){return t.mode===e}).map(function(e){return e.envelope})}},{key:"triggerReleasePreFXEnvelopes",value:function(e){this.getConnectedEnvelopes(g.b).forEach(function(t){return t.triggerRelease(e)})}},{key:"triggerReleasePostFXEnvelopes",value:function(e){this.getConnectedEnvelopes(g.a).forEach(function(t){return t.triggerRelease(e)})}},{key:"triggerAttackPreFXEnvelopes",value:function(e,t){this.getConnectedEnvelopes(g.b).forEach(function(n){return n.triggerAttack(e,t.velocity)})}},{key:"triggerAttackReleasePreFXEnvelopes",value:function(e,t){var n=this,r=t.stepData;this.getConnectedEnvelopes(g.b).forEach(function(t){return t.triggerAttackRelease(n.getDuration(r.duration),e,r.velocity)})}},{key:"triggerAttackPostFXEnvelopes",value:function(e){var t=this;e.forEach(function(e){t.getConnectedEnvelopes(g.a).forEach(function(t){return t.triggerAttack(isNaN(e.time)?void 0:e.time,e.stepData?e.stepData.velocity:1)})})}},{key:"triggerAttackReleasePostFXEnvelopes",value:function(e){var t=this;e.filter(function(e){return e&&e.stepData}).forEach(function(e){t.getConnectedEnvelopes(g.a).forEach(function(n){return n.triggerAttackRelease(t.getDuration(e.stepData.duration),e.time,e.stepData.velocity)})})}}]),n}(function(){return function e(){Object(i.a)(this,e)}}())));t.a=R},function(e,t,n){"use strict";var r=n(1),a=n(16),i=n(259),o=n(166),s=n(11),c=n(414),u=n(234),l=n(201),f=(n(200),n(249)),h=n(161),d=n(846);n.d(t,"a",function(){return m});var p=Object.keys,v=Object.values;Object(l.a)("bounce",{degrees:"The direction that the bounce goes by"},"Moves the parameters by direction of the degrees, and bounces off any walls");var m=function(e){var t=Object(f.b)(),n=1,l=1,m=Object(i.a)("planarReset");return function(i){for(var y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length,g=new Array(b>2?b-2:0),O=2;O<b;O++)g[O-2]=arguments[O];var j=g[4];m().some(function(e){return e===j.id})&&(n=1,l=1);var k=-1*(h.a.apply(void 0,[e,y].concat(g))-90),w=Object(d.a)(360-k),x=Math.tan(w),S=-1*l,P=n*x*S;90===k?(P=n,S=0):-90===k?(P=-1*n,S=0):0==k&&(S=-1*l,P=0);var E=Object(c.j)([y].concat(g)),T=!1,A=!1;if(function(e,t,n,r){var i=Math.min.apply(Math,Object(s.a)(e.map(function(e){var a=e.x,i=e.y,o=e.density;return a+t*n*10/r(a,i,{density:o})}))),o=Math.max.apply(Math,Object(s.a)(e.map(function(e){var a=e.x,i=e.y,o=e.density;return a+t*n*10/r(a,i,{density:o})})));return t>0?Math.ceil(o)>=a.c-a.b:Math.floor(i)<=a.b}(v(i),P,y,E)&&(n*=-1,P*=-1,T=!0),function(e,t,n,r){var i=Math.min.apply(Math,Object(s.a)(e.map(function(e){var a=e.x,i=e.y,s=Object(o.a)(e,["x","y"]);return i+t*n*10/r(a,i,s)}))),c=Math.max.apply(Math,Object(s.a)(e.map(function(e){var a=e.x,i=e.y,s=Object(o.a)(e,["x","y"]);return i+t*n*10/r(a,i,s)})));return t>0?Math.ceil(c)>=a.a-a.b:Math.floor(i)<=a.b}(v(i),S,y,E)&&(l*=-1,S*=-1,T||(n*=-1),A=!0),T||A)Object(u.c)(T);else{var M=Object(f.a)(t,i,[y].concat(g));i=M}return p(i).map(function(e){var t=i[e],n=E(t.x,t.y,t),r=t.x+P*y*10/n,a=t.y+S*y*10/n,o={};return o[e]={x:r,y:a,density:n},o}).reduce(function(e,t){return Object(r.a)({},e,t)},{})}}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2);n(169);function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var l=function(e){Object(o.a)(n,e);var t=u(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"currentEvent",set:function(e){this.mixByType.currentEvent=e}},{key:"execute",value:function(){Object(i.a)(Object(c.a)(n.prototype),"execute",this).call(this),this.currentEvent=this.event}}]),n}(n(377).a);t.a=l},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var u=function(e){Object(i.a)(n,e);var t=c(n);function n(e,a){var i,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(r.a)(this,n),(i=t.call(this,e,a.getType())).event=a,i.inPlace=o,i}return Object(a.a)(n,[{key:"execute",value:function(){var e=this.events.indexOf(this.event);if(e>-1&&this.events.splice(e,1),!this.inPlace){var t=this.event.duration;for(var n in this.events)if(this.events[n].step>this.event.step&&(this.events[n].step-=t,this.inPlace))return}this.mix.restart()}}]),n}(n(169).a);t.a=u},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var u=function(e){Object(i.a)(n,e);var t=c(n);function n(e,a,i){var o;return Object(r.a)(this,n),(o=t.call(this,e,a.getType())).event=a,o.subEvent=i,o}return Object(a.a)(n,[{key:"execute",value:function(){var e=this.subEvent.step,t=this.subEvent.duration,n=this.event.deleteSubEvent(this.subEvent);if(!(n<0)){if(this.event.isEmpty())return n=this.mixByType.events.indexOf(this.event),this.mixByType.events.splice(n,1),this.mixByType.calculateDurations(),void this.mix.updateAllTypeRedux();var r=this.event.subEvents;for(var a in r)if(r[a].step>e){r[a].step-=t;break}this.mix.restart(),this.event.calculateDurations(),this.mixByType.calculateDurations(),this.mix.updateAllTypeRedux()}}}]),n}(n(169).a);t.a=u},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=100;function a(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1)*(t.resolution/8)*e/32*r}},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=n(139),h=n(116),d=(n(33),n(145)),p=n(240),v=n(14),m=n(21),y=n(241),b=n(448);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var O=function(e){Object(c.a)(n,e);var t=g(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Arpeggiator",e)).notesToRemove=[],r.arpRateParameter=new y.a("arpRate",Object(o.a)(r),function(e,t){return t},{documentation:"The rate or speed of the arpeggiation, synced to the project tempo.",min:0,prettyName:"Rate",max:1,unit:"",options:{0:new m.a(4,!1),.1:new m.a(4,!0),.2:new m.a(8,!1),.3:new m.a(8,!0),.4:new m.a(16,!1),.5:new m.a(16,!0),.6:new m.a(32,!1),.7:new m.a(32,!0)},defaultValue:new m.a(16,!1)}),r.registerParameter(r.arpRateParameter),r.arpOctavesParameter=new v.a("arpOctaves",Object(o.a)(r),function(e,t){return t},{documentation:"The number of octaves to cycle through.",prettyName:"Octaves",min:0,max:8,unit:"",defaultValue:1}),r.registerParameter(r.arpOctavesParameter),r.arpDirectionParameter=new v.a("arpDirection",Object(o.a)(r),function(e,t){return t},{min:b.a,documentation:"The direction we play notes in.",prettyName:"Direction",max:b.b,unit:"",defaultValue:b.a}),r.registerParameter(r.arpDirectionParameter),r.arpDurationFactorParameter=new v.a("arpDurationFactor",Object(o.a)(r),function(e,t){return t},{documentation:"Multiples the duration of each trigger by this number.",min:1e-4,prettyName:"Duration Factor",max:8,unit:"x",defaultValue:1}),r.registerParameter(r.arpDurationFactorParameter),r.arpRepeatParameter=new v.a("arpRepeatFactor",Object(o.a)(r),function(e,t){return t},{documentation:"The number of triggers per note in the cycle.",min:1,max:8,unit:"x",prettyName:"Repeats",defaultValue:1}),r.registerParameter(r.arpRepeatParameter),r.noteToDuration={},r.notes=[],r.index=0,r.repeatIndex=0,r.currentOctave=0,r}return Object(i.a)(n,[{key:"getVisualizedParameters",value:function(){return[this.arpRateParameter]}},{key:"getText",value:function(){return this.arpRateParameter.get().toString()}},{key:"documentation",get:function(){return"Cycle through notes in a chord at a rate set by the rate parameter."}},{key:"isRealTime",value:function(){return!1}},{key:"arpRate",get:function(){return this.arpRateParameter.get()},set:function(e){this.arpRateParameter.set(e)}},{key:"arpOctaves",get:function(){return this.arpOctavesParameter.get()}},{key:"arpDirection",get:function(){return this.arpDirectionParameter.get()}},{key:"arpDurationFactor",get:function(){return this.arpDurationFactorParameter.get()}},{key:"arpRepeat",get:function(){return this.arpRepeatParameter.get()}},{key:"onNewStep",value:function(){}},{key:"clear",value:function(){this.noteToDuration={},this.notesToRemove=[],this.notes=[],this.repeatIndex=0,this.index=0,this.arpDirection,b.a}},{key:"input",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.stepData.duration,r=e.stepData.transpose;t||(r in this.noteToDuration?this.noteToDuration[r]=this.noteToDuration[r]+2*n:this.noteToDuration[r]=2*n),this.getIndexOfTrigger(e)<0&&(e.stepData=this.getStep(e.stepData,r,n,!1),this.notes.push(e),this.notes=this.notes.sort(function(e,t){return e.stepData.transpose-t.stepData.transpose}),this.arpDirection===b.a&&this.notes.reverse())}},{key:"output",value:function(e,t,n){var r=this,a=this.getNextTriggers(t).map(function(t){return t.time+=e,t.stepNumber=n,t});return this.notesToRemove.forEach(function(e){return r.actuallyRemoveNote(e)}),this.notesToRemove=[],a}},{key:"getIndexOfTrigger",value:function(e){for(var t in this.notes)if(this.notes[t].stepData.transpose===e.stepData.transpose)return t;return-1}},{key:"actuallyRemoveNote",value:function(e){var t=-1;for(var n in this.notes)if(e===this.notes[n].stepData.transpose){t=n;break}t>-1&&this.notes.splice(t,1),this.index>=this.notes.length&&(this.index=0),0===this.notes.length&&this.clear()}},{key:"removeNote",value:function(e){this.notesToRemove.push(e)}},{key:"nextNote",value:function(e){if(0!=this.notes.length){var t=this.notes[this.index],n=t.stepData.transpose;n+=12*this.currentOctave,this.repeatIndex++,this.repeatIndex>=this.arpRepeat&&(this.repeatIndex=0,this.index++),this.index>=this.notes.length&&(this.index=0,this.arpDirection===b.b?this.currentOctave=(this.currentOctave+1)%(e+1):this.arpDirection===b.a&&(this.currentOctave=(this.currentOctave-1)%(e+1),this.currentOctave<0&&(this.currentOctave=e)));var r=this.getStep(t.stepData,n,this.track.trackData.duration*this.arpDurationFactor);return new d.a(r,t.time,t.stepNumber)}}},{key:"getNextTriggers",value:function(e){var t=this,n=Object(p.a)(e,this.arpRate).map(function(e){var n=t.nextNote(t.arpOctaves);return void 0!==n&&(n.time=e.time),n}).filter(function(e){return void 0!==e});for(var r in void 0===window.timeB&&(window.timeB=0,window.timeBCount=0),this.noteToDuration)this.noteToDuration[r]-=1,this.noteToDuration[r]<=0&&(delete this.noteToDuration[r],this.removeNote(parseInt(r)));return 0===Object.keys(this.noteToDuration).length&&0===this.notes.length&&this.clear(),n}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}},{key:"getJson",value:function(){return Object(r.a)({},Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{arpRate:this.arpRate.getJson()})}},{key:"fromJson",value:function(e,t){var r=Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(h.a)(this.arpRateParameter,new m.a(16,!1).fromJson(e.arpRate),r),r}}]),n}(f.a);t.a=O},function(e,t,n){"use strict";n.d(t,"b",function(){return s}),n.d(t,"a",function(){return c});var r=n(11),a=n(168);function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;if(!window.noReload)return e.previousArgs&&void 0!==e.lastMessageReceived?(e.args=e.previousArgs,void e.refresh()):void 0},c=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;if(!window.noReload)if(t.skipHotReload)t.hotReload&&t.hotReload();else{var o=t.zObject&&"subpatch"===t.zObject.name;if(!n.has(t)){var s=[];if(o){n.add(t);var c,u=i(t.outletObjects);try{for(u.s();!(c=u.n()).done;){var l=c.value;e(l,n)}}catch(b){u.e(b)}finally{u.f()}}else{if(t.isInlet){var f=t.subSequence,h="Input "+t.inletNumber;if(f.inlets[h]){var d=f.inlets[h].connections;s=[].concat(Object(r.a)(s),Object(r.a)(d.map(function(e){return e.sourceNode}))),d.length}}else for(var p in t.inlets){var v=t.inlets[p].connections,m=Object(r.a)(v.map(function(e){return e.sourceNode}));s=[].concat(Object(r.a)(s),Object(r.a)(m)),v.length}var y=t.getObjectType&&t.getObjectType();(n.size>0||0===Object.keys(t.inlets).length)&&(y===a.d?!t.lastSentMessage||t.isOutlet||t.isInlet||t.refresh():y===a.e?(t.lastMessageReceived||0===Object.keys(t.inlets).length)&&t.refresh():t.refresh&&t.refresh(),n.size>1)||(n.add(t),s.forEach(function(t){return e(t,n)}))}}}}},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(14),s=n(168),c=n(116),u=n(128),l=n(20),f=function(){function e(t,n){Object(a.a)(this,e),this.id=Object(l.uuid)(),this.track=n,this.sequencerEngine=n.sequencerEngine,this.store=this.sequencerEngine.store,this.name=t,this.parameters=[],this.enabledParameter=new o.a("enabled",this,function(e,t){return[]},{min:!1,max:!0,unit:"",defaultValue:!0}),this.registerParameter(this.enabledParameter),this.numberOfOutputs=1}return Object(i.a)(e,[{key:"getObjectType",value:function(){return s.a}},{key:"enabled",get:function(){return this.enabledParameter.get()},set:function(e){this.enabledParameter.set(e)}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"isEnabled",value:function(){return this.enabled}},{key:"getJson",value:function(){var e={name:this.name,enabled:this.enabled,id:this.id,x:this.x,y:this.y};for(var t in e=this.saveParameterToJson(e,"enabledParameter",this.enabledParameter),this.parameters){var n=this.parameters[t];e[n.name]=n.get();var r=n.name+"Parameter";e=this.saveParameterToJson(e,r,n)}return e}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];void 0===e.id||t||(this.id=e.id,this.track.sequencerEngine&&(this.track.sequencerEngine.idToObject[this.id]=this)),void 0!==e.x&&(this.x=e.x,this.y=e.y);var n={};for(var a in Object(c.a)(this.enabledParameter,e.enabled,n),n=Object(r.a)({},n,this.loadParameterFromJson(e,"enabledParameter",this.enabledParameter)),this.parameters){var i=this.parameters[a],o=e[i.name];void 0!==o&&null!==o&&Object(c.a)(i,o,n),n=Object(r.a)({},n,this.loadParameterFromJson(e,i.name+"Parameter",i,t))}return n}},{key:"registerContext",value:function(e){this._context=e.forEffect(this),this.parameters.forEach(function(t){return t.setContext(e)})}},{key:"registerMixSession",value:function(e){this.parameters.forEach(function(t){return t.setMixSession(e)})}},{key:"registerTrack",value:function(e){this.parameters.forEach(function(t){return t.setTrack(e)})}},{key:"registerParameter",value:function(e){void 0!==e&&(e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"saveParameterToJson",value:function(e,t,n){return Object(u.b)(e,t,n)}},{key:"loadParameterFromJson",value:function(e,t,n,r){return Object(u.a)(e,t,n,this.track.sequencerEngine,r)}},{key:"getEffectCopy",value:function(){return this.getCopy(this.track)}}]),e}();t.a=f},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(7),s=n(8),c=n(2),u=n(23);function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(o.a)(n,e);var t=l(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"subSequence",get:function(){if(this._subSequence)return this._subSequence;if(this.context){if(this.context.subSequence)return this.context.subSequence;var e=this.track||this.context.track||this.context.group;return e&&e.subSequence}},set:function(e){this._subSequence=e}},{key:"dispatch",value:function(e){(this.sequencerEngine||this.track.sequencerEngine).dispatch(e)}},{key:"state",get:function(){var e=this.sequencerEngine||this.track;return e&&e.state}},{key:"currentPattern",get:function(){return this.state&&this.subSequence&&this.subSequence.tracks&&this.subSequence.tracks[0]?this.subSequence.tracks[0].currentPattern:0}},{key:"patternLocks",get:function(){return this.state&&this.state.effects.effectPatternLocks[this.id]||{}}},{key:"locked",get:function(){return this.patternLocks[this.currentPattern]}},{key:"lock",set:function(e){console.log("setting lock for current pattern = ",this.currentPattern),console.log(this),this.lockPattern(this.currentPattern,e)}},{key:"lockPattern",value:function(e,t){var n=Object(r.a)({},this.patternLocks);n[e]=t,this.dispatch(Object(u.yb)(this.id,n))}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var r="DOWN",a="UP"},function(e,t,n){"use strict";var r=n(1),a=n(108),i=n(4),o=n(5),s=n(31),c=n(10),u=n(7),l=n(8),f=n(2),h=n(139),d=n(14),p=n(145),v=n(134);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var y=function(e){Object(u.a)(n,e);var t=m(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,"Parameterizer",e)).parameter=void 0,r.factorParameter=new d.a("factor",Object(s.a)(r),function(e,t){return t},{documentation:"Multiplies the current value of the parameter by this number",min:0,max:1,unit:"",defaultValue:1}),r.registerParameter(r.factorParameter),r.offsetParameter=new d.a("offset",Object(s.a)(r),function(e,t){return t},{documentation:"Adds the current value of the parameter with this number",min:-100,max:100,unit:"",defaultValue:0}),r.registerParameter(r.offsetParameter),r.probabilityParameter=new d.a("probability",Object(s.a)(r),function(e,t){return t},{documentation:"The probability that a parameter change will occur on a given trigger.",min:0,max:100,unit:"",defaultValue:100}),r.registerParameter(r.probabilityParameter),r.newInlet("offset",function(e){var t=Object(a.a)(e,1)[0];isNaN(t)||r.offsetParameter.set(t)}),r}return Object(o.a)(n,[{key:"documentation",get:function(){return["Alters the step parameters for triggers that pass through this effect. "]}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getVisualizedParameters",value:function(){return[this.offsetParameter]}},{key:"getText",value:function(){var e=Math.round(100*this.offsetParameter.get(!0))/100;return e>0&&(e="+"+e),this.parameter?this.parameter.name+" "+e:e}},{key:"getAvailableParameters",value:function(){return[this.track.trackData.durationParameter,this.track.trackData.chopParameter,this.track.trackData.velocityParameter,this.track.trackData.transposeParameter,this.track.trackData.paletteParameter,this.track.trackData.startParameter,this.track.trackData.attackParameter,this.track.trackData.releaseParameter,this.track.trackData.pitchAttackParameter,this.track.trackData.pitchDecayParameter,this.track.trackData.pitchSustainParameter,this.track.trackData.pitchReleaseParameter]}},{key:"factor",get:function(){return this.factorParameter.get()},set:function(e){this.factorParameter.set(e)}},{key:"offset",get:function(){return this.offsetParameter.get()},set:function(e){this.offsetParameter.set(e)}},{key:"probability",get:function(){return this.probabilityParameter.get()},set:function(e){this.probabilityParameter.set(e)}},{key:"output",value:function(){var e=this;if(void 0===this.parameter)return this.triggers;var t=[],n=function(n){var r=e.triggers[n],a=e.getStep(r.stepData,void 0,void 0,!0),i=a.parameters.filter(function(t){return t.name===e.parameter.name});if(i.length>0){var o=i[0].get();if(null===o)o=e.track.trackData.parameters.find(function(e){return e.name===i[0].name}).get();Math.random()<e.probability/100&&i[0].set(o*e.factor+e.offset)}r=new p.a(a,r.time,r.stepNumber),t.push(r)};for(var r in this.triggers)n(r);return t}},{key:"getJson",value:function(){return Object(r.a)({},Object(c.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{parameter:void 0===this.parameter?void 0:this.parameter.name})}},{key:"fromJson",value:function(e,t){var r=Object(c.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),a=this.getAvailableParameters();if(void 0!==e.parameter)return this.parameter=a.filter(function(t){return t.name===e.parameter})[0],r}}]),n}(Object(v.a)(h.a));t.a=y},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),o=n(7),s=n(8),c=n(2),u=n(139),l=n(14),f=n(6),h=n.n(f);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var p=function(e){Object(o.a)(n,e);var t=d(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Timing",e)).oddOffsetParameter=new l.a("oddTiming",Object(i.a)(a),function(e,t){return t},{documentation:"The delay amount (in 1/32th notes) for even-triggers (according to the resolution)",min:0,max:4,unit:"1/32th",defaultValue:0}),a.registerParameter(a.oddOffsetParameter),a.evenOffsetParameter=new l.a("evenTiming",Object(i.a)(a),function(e,t){return t},{documentation:"The delay amount (in 1/32th notes) for odd-triggers (according to the resolution)",min:0,max:4,unit:"1/32th",defaultValue:0}),a.registerParameter(a.evenOffsetParameter),a.probabilityParameter=new l.a("probability",Object(i.a)(a),function(e,t){return t},{documentation:"The probability that this effect will occur on a given trigger.",min:0,max:100,unit:"",defaultValue:100}),a.registerParameter(a.probabilityParameter),a.resolutionParameter=new l.a("resolution",Object(i.a)(a),function(e,t){return t},{min:1,max:32,unit:"",defaultValue:2}),a.registerParameter(a.resolutionParameter),a}return Object(a.a)(n,[{key:"getVisualizedParameters",value:function(){return[this.oddOffsetParameter,this.evenOffsetParameter]}},{key:"getText",value:function(){return this.resolution.toString()+" "+this.evenOffset+", "+this.oddOffset}},{key:"documentation",get:function(){return"Controls the swing of a track by dividing triggers by a resolution and delaying them seperately"}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"needsStableLookAhead",value:function(){return!0}},{key:"oddOffset",get:function(){return this.oddOffsetParameter.get()},set:function(e){this.oddOffsetParameter.set(e)}},{key:"evenOffset",get:function(){return this.evenOffsetParameter.get()},set:function(e){this.evenOffsetParameter.set(e)}},{key:"probability",get:function(){return this.probabilityParameter.get()},set:function(e){this.probabilityParameter.set(e)}},{key:"resolution",get:function(){return this.resolutionParameter.get()},set:function(e){return this.resolutionParameter.set(e)}},{key:"output",value:function(){for(var e in this.triggers){var t=this.triggers[e],n=t.time;if(Math.random()<=this.probability/100){var r=Math.floor(t.stepNumber/this.resolution)%2==0?this.evenOffset:this.oddOffset;t.time=n+r*new h.a.Time("32n").toMilliseconds()/1e3}}return this.triggers}}]),n}(u.a);t.a=p},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i});var r=1,a=2,i=3},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=n(139),h=(n(33),n(145)),d=(n(240),n(14)),p=(n(21),n(448),n(6));function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var m=new(n.n(p).a.Time)("32n"),y=function(e){Object(c.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Chord Rhythm",e)).durationFactorParameter=new d.a("durationFactor",Object(o.a)(r),function(e,t){return[]},{defaultValue:1,min:0,max:2,unit:""}),r.registerParameter(r.durationFactorParameter),r.oddDelayTimeParameter=new d.a("oddDelayTime",Object(o.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:16,unit:""}),r.registerParameter(r.oddDelayTimeParameter),r.evenDelayTimeParameter=new d.a("evenDelayTime",Object(o.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:16,unit:""}),r.registerParameter(r.evenDelayTimeParameter),r.delayTimeFactorParameter=new d.a("delayTimeFactor",Object(o.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:4,unit:""}),r.registerParameter(r.delayTimeFactorParameter),r.evenVelocityParameter=new d.a("evenVelocity",Object(o.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:1,unit:""}),r.registerParameter(r.evenVelocityParameter),r.oddVelocityParameter=new d.a("oddVelocity",Object(o.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:1,unit:""}),r.registerParameter(r.oddVelocityParameter),r.repeatsParameter=new d.a("repeats",Object(o.a)(r),function(e,t){return[]},{defaultValue:1,min:1,max:8,unit:""}),r.registerParameter(r.repeatsParameter),r.syncedParameter=new d.a("synced",Object(o.a)(r),function(e,t){return[]},{defaultValue:!0,min:!1,max:!0,unit:""}),r.registerParameter(r.syncedParameter),r.velocitySpreadParameter=new d.a("velocitySpread",Object(o.a)(r),function(e,t){return[]},{defaultValue:50,min:0,max:100,unit:""}),r.registerParameter(r.velocitySpreadParameter),r.velocityParameter=new d.a("velocity",Object(o.a)(r),function(e,t){return[]},{defaultValue:1,min:0,max:1,unit:""}),r.registerParameter(r.velocityParameter),r.delays=[],r.liveTriggers=[],r}return Object(i.a)(n,[{key:"onNewStep",value:function(){this.triggers=[]}},{key:"removeNote",value:function(e,t){arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.gated;this.delays=this.delays.filter(function(t){return t.trigger.stepData.transpose!==e})}},{key:"input",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.liveTriggers.push(e):Object(s.a)(Object(l.a)(n.prototype),"input",this).call(this,e)}},{key:"clear",value:function(){this.triggers=[],this.delays=[]}},{key:"oddDelayTime",get:function(){return this.oddDelayTimeParameter.get()}},{key:"synced",get:function(){return this.syncedParameter.get()}},{key:"repeats",get:function(){return this.repeatsParameter.get()}},{key:"evenDelayTime",get:function(){return this.evenDelayTimeParameter.get()}},{key:"durationFactor",get:function(){return this.durationFactorParameter.get()}},{key:"delayTimeFactor",get:function(){return this.delayTimeFactorParameter.get()}},{key:"velocitySpread",get:function(){return this.velocitySpreadParameter.get()/100}},{key:"oddVelocity",get:function(){return Math.max(0,Math.sqrt(this.velocitySpread)-.2)}},{key:"velocity",get:function(){return this.velocityParameter.get()}},{key:"evenVelocity",get:function(){var e=1-this.velocitySpread;return Math.max(0,Math.sqrt(e)-.2)}},{key:"getDelayTrigger",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=(e.time-t)/m;return r=n?0:r,{stepNumber:e.stepNumber,stepOffset:r,trigger:this.copyTrigger(e),duration:n?void 0:e.stepData.duration,repeats:1,elapsed:0,even:!0}}},{key:"copyTrigger",value:function(e){var t=this.getStep(e.stepData,void 0,void 0,!1);return new h.a(t,e.time,e.stepNumber,e.outputNumber)}},{key:"output",value:function(e,t,n){var a=this;for(var i in this.triggers){var o=this.triggers[i];this.delays.push(this.getDelayTrigger(o,e))}for(var s in this.liveTriggers){var c=this.liveTriggers[s];c.stepNumber=t,this.delays.push(this.getDelayTrigger(c,e,!0))}var u=[],l=void 0,f=void 0,h=function(n){var i=a.delays[n],o=i.repeats/a.repeats%2==0,s=o?a.evenDelayTime:a.oddDelayTime;s*=a.delayTimeFactor;var c=o?a.evenVelocity:a.oddVelocity;if(c*=a.velocity,0===i.elapsed||a.shouldPlayDelay(i,t,i.isEven?a.evenDelayTime:a.oddDelayTime)){var h=a.getTimesToPlay(i,e,s),d=h.map(function(e){return a.getTriggerToPlay(i.trigger,e.timeToPlay,t,c,s)});u=[].concat(Object(r.a)(u),Object(r.a)(d)),l=t,f=h[h.length-1].offset,i.isEven=o,i.stepNumber=t,i.stepOffset=f,i.repeats++}i.elapsed++};for(var d in this.delays)h(d);return this.synced&&void 0!==l&&this.delays.forEach(function(e){e.stepNumber=l,e.stepOffset=f}),this.delays=this.delays.filter(function(e){return void 0===e.duration||e.elapsed<2*e.duration}),this.liveTriggers=[],u}},{key:"getTriggerToPlay",value:function(e,t,n,r,a){var i=this.copyTrigger(e);return i.time=t,i.stepData.duration=this.durationFactor*(a/2),i.stepNumber=n,i.stepData.velocity*=r,i}},{key:"shouldPlayDelay",value:function(e,t,n){var r=t,a=t+1,i=((e.stepNumber+e.stepOffset)%this.patternLength+n)%this.patternLength;return r<=i&&i<a}},{key:"getTimesToPlay",value:function(e,t,n){for(var r=((e.stepNumber+e.stepOffset)%this.patternLength+n)%this.patternLength,a=r-Math.floor(r),i=[];a<1;a+=n)i.push({timeToPlay:t+a*m,offset:a});return i}},{key:"patternLength",get:function(){return this.track.length}},{key:"isRealTime",value:function(){return!1}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(f.a);t.a=y},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2),u=n(139),l=n(632);n(454);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(o.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Midi Interface",e)).ccParameters=[],a.midiOutput=void 0,a}return Object(a.a)(n,[{key:"setConfig",value:function(e,t){if(this.midiOutput=e,this.midiCC=this.track.sequencerEngine.midi.deviceToMidiCC[e.name],this.midiDeviceName=e.name,void 0!==this.midiCC)for(var n in t){var r=t[n],a={};for(var i in r){var o=r[i];for(var s in a[i]={},o){var c=o[s],u=new l.a(s,c,this.midiCC);this.registerParameter(u),a[i][s]=u}}this.ccParameters.push(a)}}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"output",value:function(e,t,n){return this.triggers}},{key:"getJson",value:function(){var e=Object(i.a)(Object(c.a)(n.prototype),"getJson",this).call(this);e.midiOutput=this.midiOutput.name;var t=[];for(var r in this.ccParameters){var a=this.ccParameters[r],o={};for(var s in a){var u=a[s],l={};for(var f in u){var h=u[f];l[h.name]=h.getJson()}o[s]=l}t.push(o)}return e.config=t,e}},{key:"fromJson",value:function(e,t){Object(i.a)(Object(c.a)(n.prototype),"fromJson",this).call(this,e,t);var r=this.track.sequencerEngine.midi;if(void 0!==r){var a=r.controllerOutputs.filter(function(t){return t.name===e.midiOutput})[0];if(void 0!==a){for(var o in this.midiOutput=a,this.track.addMidiOutput(a,!0),this.midiCC=this.track.sequencerEngine.midi.deviceToMidiCC[a.name],e.config){var s=e.config[o];for(var u in s){var f=s[u];for(var h in f){var d=f[h],p=new l.a(h,d.ccNumber,this.midiCC);p.fromJson(d,this.track.sequencerEngine),this.registerParameter(p),f[h]=p}}}this.ccParameters=e.config}}}}]),n}(u.a);t.a=h},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r={"MIDI Mix":{note:{0:{PATTERN_SWITCH:1,SEQUENCE_ROLL:3,PREVIOUS_PATTERN:25,NEXT_PATTERN:26},1:{PATTERN_SWITCH:4,SEQUENCE_ROLL:6},2:{PATTERN_SWITCH:7,SEQUENCE_ROLL:9},3:{PATTERN_SWITCH:10,SEQUENCE_ROLL:12},4:{PATTERN_SWITCH:13,SEQUENCE_ROLL:15},5:{PATTERN_SWITCH:16,SEQUENCE_ROLL:18},6:{PATTERN_SWITCH:19,SEQUENCE_ROLL:21},7:{PATTERN_SWITCH:22,SEQUENCE_ROLL:24}},cc:{0:{KNOB_1:16,KNOB_2:17,KNOB_3:18,VOLUME:19},1:{KNOB_1:20,KNOB_2:21,KNOB_3:22,VOLUME:23},2:{KNOB_1:24,KNOB_2:25,KNOB_3:26,VOLUME:27},3:{KNOB_1:28,KNOB_2:29,KNOB_3:30,VOLUME:31},4:{KNOB_1:46,KNOB_2:47,KNOB_3:48,VOLUME:49},5:{KNOB_1:50,KNOB_2:51,KNOB_3:52,VOLUME:53},6:{KNOB_1:54,KNOB_2:55,KNOB_3:56,VOLUME:57},7:{KNOB_1:58,KNOB_2:59,KNOB_3:60,VOLUME:61},MASTER:62}},"Komplete Kontrol M DAW":{actions:{PLAY:94,RECORD:95,CLEAR:93},ccActions:{CHANGE_SELECTED_TRACK:15,BROWSE_SOUNDS:19,CHANGE_START_SLICE:19,CHANGE_END_SLICE:20,CHANGE_TRANSPOSE:18,CHANGE_VOLUME:14}},"KOMPLETE KONTROL M32":{ccActions:{CHANGE_SELECTED_TRACK:19,BROWSE_SOUNDS:15,CHANGE_START_SLICE:17,CHANGE_END_SLICE:18,CHANGE_TRANSPOSE:16,CHANGE_VOLUME:14}},"MPD218 Port A":{ccActions:{CHANGE_SELECTED_TRACK:3,BROWSE_SOUNDS:9,CHANGE_START_SLICE:12,CHANGE_END_SLICE:13,CHANGE_TRANSPOSE:15,CHANGE_VOLUME:14}}}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),o=n(7),s=n(8),c=n(2),u=n(139),l=n(145),f=n(14),h=n(6),d=n.n(h);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var v=function(e){Object(o.a)(n,e);var t=p(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Harmony",e)).pitchParameter=new f.a("pitch",Object(i.a)(a),function(e,t){return t},{min:-32,documentation:"Gets added to the transpose of the trigger to be harmonized with",max:32,unit:"",defaultValue:5}),a.registerParameter(a.pitchParameter),a.timingOffsetParameter=new f.a("timingOffset",Object(i.a)(a),function(e,t){return t},{min:0,documentation:"The harmonizing trigger gets delayed by this amount of time (measured in 1/32th notes)",max:4,unit:"",defaultValue:0}),a.registerParameter(a.timingOffsetParameter),a.velocityParameter=new f.a("velocity",Object(i.a)(a),function(e,t){return t},{min:0,documentation:"The velocity of the harmonizing trigger",max:1,unit:"",defaultValue:1}),a.registerParameter(a.velocityParameter),a.probabilityParameter=new f.a("probability",Object(i.a)(a),function(e,t){return t},{min:0,documentation:"The probability that a harmonizing trigger will be created. This gets calculated for every trigger.",max:100,unit:"",defaultValue:100}),a.registerParameter(a.probabilityParameter),a}return Object(a.a)(n,[{key:"getVisualizedParameters",value:function(){return[this.pitchParameter]}},{key:"getText",value:function(){var e=Math.round(100*this.pitch)/100;return e>=0?"+"+e:e}},{key:"documentation",get:function(){return"Harmonizes by adding an additional trigger offsetted by pitch, for every trigger."}},{key:"pitch",get:function(){return this.pitchParameter.get()}},{key:"velocity",get:function(){return this.velocityParameter.get()}},{key:"timingOffset",get:function(){return this.timingOffsetParameter.get()}},{key:"probability",get:function(){return this.probabilityParameter.get()}},{key:"output",value:function(){var e=[];for(var t in this.triggers){var n=this.triggers[t];if(e.push(n),this.probability/100>=Math.random()){var r=n.stepData.getCopy(!0,!1,!0,!0,!1);r.transpose+=this.pitch,r.velocity=this.velocity;var a=n.time+this.timingOffset*new d.a.Time("32n").toMilliseconds()/1e3;e.push(new l.a(r,a,n.stepNumber))}}return e}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(u.a);t.a=v},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),o=n(7),s=n(8),c=n(2),u=n(123),l=n(23),f=n(14);function h(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(o.a)(n,e);var t=p(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).parameterVariables=[],e.checkboxVariables=[],e.trackVariables=[],e.variables=[],e}return Object(i.a)(n,[{key:"var",value:function(e){var t=this;return this.scriptEffect?this.scriptEffect.var(e):function(){var n=t[e+"Parameter"];return n?n.get():0}}},{key:"newParamVar",value:function(e){var t=new f.a(e,this,function(e,t){return t},{min:0,max:16,unit:"",defaultValue:""});this[e+"Parameter"]=t,this.registerParameter(t),this.parameterVariables.push(t)}},{key:"newTrackVar",value:function(e){var t=new f.a(e,this,function(e,t){return t},{min:0,max:16,unit:"",defaultValue:0});this[e+"Parameter"]=t,this.registerParameter(t),this.trackVariables.push(t)}},{key:"newCheckboxVar",value:function(e,t){var n=new f.a(e,this,function(e,t){return t},{min:0,max:1,unit:"",defaultValue:t});this[e+"Parameter"]=n,this.registerParameter(n),this.checkboxVariables.push(n)}},{key:"newVar",value:function(e,t,n,r,a,i,o){if(this.scriptEffect)return this.scriptEffect.newVar(e,t,n,r,a,i);if(this[e+"Parameter"])return this.variables=this.variables.filter(function(t){return t.name!==e}),this.variables.push(this[e+"Parameter"]),this[e+"Parameter"];if(this.oldVariables){var s=this.oldVariables.find(function(t){return t.name===e});if(s)return this.variables=this.variables.filter(function(t){return t.name!==e}),this.variables.push(s),this[e+"Parameter"]=s,this.registerParameter(s),s}var c=new f.a(e,this,function(e,t){return t},{min:n,max:r,unit:"",defaultValue:t,documentation:a,hide:i,onChange:o});return this[e+"Parameter"]=c,this.registerParameter(c),void 0===this.context&&(this.context=(new u.a).forMidiEffect(this).forTrack(this.track)),c.setContext(this.context),this.variables.push(c),this.track.sequencerEngine.dispatch(Object(l.wb)(c.i,t)),c}},{key:"updateVariablesRedux",value:function(){var e=this.track&&this.track.sequencerEngine||this.sequencerEngine;e&&e.dispatch(Object(l.pd)(this.id,Object(r.a)(this.variables)))}},{key:"clearVariables",value:function(){var e=this,t={};if(this.scriptEffect)return t;var n,a=h(this.variables);try{var i=function(){var r=n.value;t[r.name]=r,delete e[r.name+"Parameter"],e.parameters=e.parameters.filter(function(e){return e.name!==r.name})};for(a.s();!(n=a.n()).done;)i()}catch(o){a.e(o)}finally{a.f()}return this.oldVariables=[].concat(Object(r.a)(this.oldVariables||[]),Object(r.a)(this.variables)),this.variables=[],t}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(114),a=n(331),i=n(213),o=function(e){var t=Object(i.a)(e);return function(){if(!(arguments.length<=0?void 0:arguments[0]))return Object(r.w)(!1);var e=t.apply(void 0,arguments);return Object(r.Q)(Object(a.a)(e,Object(r.Q)()))}}},function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"b",function(){return u}),n.d(t,"c",function(){return l}),n.d(t,"d",function(){return f});var r=n(1),a=n(114),i=(n(170),n(150),n(193)),o=n(260),s=n(214),c=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=a.A.apply(void 0,[e].concat(n)),o=(Math.round(i)>>>0).toString(2).split("").map(function(e){return parseInt(e)}),s=0,c=function(){return o[s++%o.length]};return{decide:c,decideNum:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e;n>t;n--)if(c())return n;return t},decideUnique:function(e,t){t=Math.min(e,t);for(var n=new Array(t).fill(0).map(function(e,t){return t}),r=[];r.length<e;)for(var a=0;a<n.length;a++)if(c()){r.push(n[a]),n.splice(a,1);break}return r}}}},u=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,u=arguments.length,l=new Array(u>4?u-4:0),f=4;f<u;f++)l[f-4]=arguments[f];var h=void 0,d=void 0,p=void 0;return function(){for(var u=arguments.length,f=new Array(u),v=0;v<u;v++)f[v]=arguments[v];var m=a.A.apply(void 0,[e].concat(f)),y=a.A.apply(void 0,[t].concat(f)),b=a.A.apply(void 0,[r].concat(f)),g=a.A.apply(void 0,[n].concat(f)),O=l.map(function(e){return a.A.apply(void 0,[e||2].concat(f))});if(m===h&&d===y)return p;h=m,d=y;var j=c(y).apply(void 0,f),k=j.decideNum,w=j.decide,x=12;return p=Object(s.n)(e,function(e,t){return function(e,t){var n=[e];w()?n=[Object(i.f)("~")()[0]]:w()&&(e.accent=!0);for(var r=b*k(O[t%O.length]||2,1),a=1;a<r;a++)n.push(Object(i.f)("~")()[0]);var s=k(r-1,1);x=w()?g:0;var c=w()?new String(x):new String(x)+"'";return n[s]=Object(i.f)(c)()[0],Object(o.e)(n)()}(e,t)}).apply(void 0,f)}},l=function(e,t){var n=void 0,r=void 0,o=void 0;return function(){for(var c=arguments.length,u=new Array(c),l=0;l<c;l++)u[l]=arguments[l];var f=a.A.apply(void 0,[e].concat(u)),d=a.A.apply(void 0,[t].concat(u));if(f===n&&r===d)return o||[];if(n=f,r=d,100===d)return f||[];d=100-d;for(var p=f.flat(10).filter(function(e){return null!==e.transpose}).length,v=p*d/100,m=0,y=0;m<=v&&y<=p;)f=Object(s.w)(f,h(p-m,y),function(e,t,n){return m++,Object(i.f)("~")()[0]},void 0,!0).apply(void 0,u),y++;return o=f[0]}},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=void 0,o=void 0,u=void 0;return function(){for(var l=arguments.length,f=new Array(l),h=0;h<l;h++)f[h]=arguments[h];var d=a.A.apply(void 0,[e].concat(f)),p=a.A.apply(void 0,[t].concat(f));if(o===p&&d===n)return u;o=p,n=d;var v=c(t).apply(void 0,f),m=v.decide,y=v.decideNum,b=v.decideUnique,g=function(e,t){if(m()&&m())return function(e){var t=y(4),n=b(t,4),a=0,o=0;return n.forEach(function(t){t%=e.length;var n=e[t];if(!Array.isArray(n)){var s=Object(r.a)({},n);!m()&&a++<1?null===s.transpose&&m()&&o++<1?s=Object(i.f)("0'")():s.accent=!0:null===s.transpose&&m()&&o++<1?s=Object(i.f)("0.")():s.staccato=!0,e[t]=s}}),e}(Object(s.u)(e,[null,Object(i.f)("0.")]));Array.isArray(e)||(e=Object(r.a)({},e));var n=e;n=Array.isArray(e)?[e[y(e.length-1)]]:[e];var a=Object(i.f)("~").apply(void 0,f)[0];null===e.transpose&&(e.transpose=0);var o=Array.isArray(e)?e[0]:e;if(m())n=[a,o];else{n=[a,o,o,o];var c=[m(),m()&&m(),m(),m()&&m()],u=c[0],l=c[1],h=c[2],d=c[3];u&&(n[0]=o),l&&(n[1]=a),l&&(n[2]=a),h&&(n[3]=a),u||l||h||d||(n[y(3)]=o);var p=y(4),v=b(p,4),g=0,O=0;v.forEach(function(e){var t=n[e];if(!Array.isArray(t)){var a=Object(r.a)({},t);!m()&&g++<1?null===a.transpose&&m()&&O++<1?a=Object(i.f)("0'")():a.accent=!0:null===a.transpose&&m()&&O++<1?a=Object(i.f)("0.")():a.staccato=!0,n[e]=a}})}return n};return u=Object(s.n)(e,function(e,t){return g(e)}).apply(void 0,f)}},h=function(e,t){var n=Math.ceil(e/2);e%2===0&&n++;var r=(t+1)%n;return t%2===0?r:(n+r)%e}},function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"c",function(){return u}),n.d(t,"d",function(){return l}),n.d(t,"b",function(){return f});var r=n(11),a=n(114),i=(n(214),n(193));function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=function(){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Object(a.w)(!t[0]||t[0].isNewCycle)}},u=function(e,t,n){var r=0;return function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];var s=a.A.apply(void 0,[e].concat(i));return i[0]&&i[0].isNewCycle&&++r%s===0?a.A.apply(void 0,[t].concat(i)):Object(a.w)(!0)}},l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return function(){for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];var u,l=a.A.apply(void 0,[e].concat(s)),f=(a.A.apply(void 0,[t].concat(s)),a.A.apply(void 0,[n].concat(s)),[]),h=[],d=void 0,p=o(l);try{for(p.s();!(u=p.n()).done;){var v=u.value;d&&v.figureId!==d.figureId&&(f.push(h),h=[]),h.push(v),d=v}}catch(b){p.e(b)}finally{p.f()}f.push(h);var m=f.length,y=f[m-n];return f[m-n]=f[m-t],f[m-t]=y,f.reduce(function(e,t){return[].concat(Object(r.a)(e),Object(r.a)(t))},[])}},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||function(e){return function(){return e}};return{pattern:function(){return n(e())()},player:Object(a.K)(Object(i.b)(function(){return n(e())()},r),u(t,function(){return e=l(e),Object(a.w)(!0)}))}}},function(e,t,n){"use strict";n.d(t,"e",function(){return h}),n.d(t,"f",function(){return d}),n.d(t,"a",function(){return p}),n.d(t,"c",function(){return v}),n.d(t,"d",function(){return m}),n.d(t,"b",function(){return y});var r=n(11),a=n(1),i=n(114),o=(n(171),n(330)),s=(n(260),n(461),n(147)),c=n(214),u=n(655);function l(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}window.scaleLazies=0,window.scaleNoLazies=0;var h=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return function(){for(var o=Object(i.A)(r),s=Object(i.A)(a),c=arguments.length,u=new Array(c),f=0;f<c;f++)u[f]=arguments[f];var h=i.A.apply(void 0,[e].concat(u));if(h===n)return t;n=h;var d,p=0,v=[p],m=l(h.flat(16));try{for(m.s();!(d=m.n()).done;){var y=d.value;if(v.length>=7)break;if(y.type){var b=y.type,g=b.type,O=b.value;if("-"===g&&0===O)p+=s;else{if("."!==g)continue;p+=o}v.push(p)}}}catch(j){m.e(j)}finally{m.f()}return t=v}},d=function(e,t,n){var r,o,l,f;return function(){for(var h=arguments.length,d=new Array(h),p=0;p<h;p++)d[p]=arguments[p];var v=i.A.apply(void 0,[e].concat(d)),m=i.A.apply(void 0,[t].concat(d)),y=i.A.apply(void 0,[n].concat(d));if(v===f&&m===o&&l===y)return window.scaleLazies++,r;window.scaleNoLazies++,l=y,o=m,f=v;for(var b=v.flat(16).length,g=0,O=function(e){v=Object(c.w)(v,e,function(t){if(null!==(t=Object(a.a)({},t)).transpose){if(y&&y[e]){var n=y[e],r=n.type,i=n.value;switch(r){case u.d:g=Object(s.a)(g-i,m.length);break;case u.a:g=Object(s.a)(g+i,m.length);break;case u.c:g=0}}t.transpose=m[g%m.length],y&&y[e]&&y[e].type===u.b||g++}return t},!0).apply(void 0,d)},j=0;j<b;j++)O(j);return r=v}},p=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];var s,c=i.A.apply(void 0,[e].concat(a)),u=i.A.apply(void 0,[t].concat(a)),f=i.A.apply(void 0,[n].concat(a)),h=[],d=0,p=void 0,v=l(u);try{for(v.s();!(s=v.n()).done;){var m=s.value;m=i.A.apply(void 0,[m].concat(a)),m--;var y=f[d%f.length];void 0!==y?y*=12:y=0,(m>c.length||void 0!==p&&p>c[m])&&(y+=12,m%=c.length);var b=c[m]+y;p=b,h.push(b),d++}}catch(g){v.e(g)}finally{v.f()}return h}},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];for(var c=Object(r.a)(i.A.apply(void 0,[e].concat(o))),u=[],l=0;l<t;l++)u.push(c.shift()+12);return[].concat(Object(r.a)(c.map(function(e){return e+12*n})),u)}},m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var o=i.A.apply(void 0,[e].concat(r)),s=i.A.apply(void 0,[t].concat(r)),c=0;return s>=o.length&&(c=12,s%=o.length),o[s]+c}},y=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(){for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];var u,f=s[0],h=i.A.apply(void 0,[e].concat(s)),d=i.A.apply(void 0,[n].concat(s)),p=[],v=l(i.A.apply(void 0,[t].concat(s)));try{for(v.s();!(u=v.n()).done;){var m=u.value,y=i.A.apply(void 0,[m].concat(s)),b=y.thick,g=y.flat,O=y.time,j=y.voice,k=y.octave,w=j-1,x=k;void 0!==x?x*=12:x=0,w>=h.length&&(x+=12);var S=h[w%h.length]+x+d;if(g&&(S-=g),S,p.push({note:S,time:O}),void 0!==b)for(var P=1;P<=b;P++)p.push({note:S-12*P,time:O});0}}catch(E){v.e(E)}finally{v.f()}return i.D.apply(void 0,Object(r.a)(p.map(function(e){var t=e.note,n=e.time;return Object(o.a)(f,t,f.duration,n)})))}}},function(e,t,n){"use strict";n.d(t,"b",function(){return l}),n.d(t,"a",function(){return f}),n.d(t,"c",function(){return h});var r=n(114),a=n(151),i=n(6),o=n.n(i),s=n(145);n(330);function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(a.a)("harmonize",{"...harmonies":"Transposes to harmonize"},"Harmonizes with the given transposees");var l=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];var i=t.flat().map(function(e){return r.A.apply(void 0,[e].concat(n))}).flat(),o=n[0],u=n[1],l=n[2],f=n[3];if(!o)return Object(r.w)(!1);var h,d=[],p=new s.a(o,l,u),v=c(i);try{for(v.s();!(h=v.n()).done;){var m=h.value,y=f.copyTrigger(p,!0).stepData;y.transpose+=m,d.push({stepData:y,stepNumber:u,time:l})}}catch(b){v.e(b)}finally{v.f()}return Object(r.R)([{stepData:o,time:l,stepNumber:u}].concat(d))}},f=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];var i=t.flat().map(function(e){return r.A.apply(void 0,[e].concat(n))}).flat(),o=n[0],u=n[1],l=n[2],f=n[3];if(!o)return Object(r.w)(!1);var h,d=[],p=new s.a(o,l,u),v=c(i);try{for(v.s();!(h=v.n()).done;){var m=h.value,y=f.copyTrigger(p,!0).stepData;y.transpose=m,d.push({stepData:y,stepNumber:u,time:l})}}catch(b){v.e(b)}finally{v.f()}return Object(r.R)(d)}};Object(a.a)("strum",{spread:"Number from 1-10"},"Spreads out triggers on same step, so they strum");var h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=void 0,n=0,a=void 0;return function(){for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];var u=s[0],l=s[1],f=s[2];if(!f&&!a)return a=o.a.Master.context.currentTime+.05,n=1,t=l,Object(r.w)(!0);if(!u||t!==l)return n=1,t=l,a=void 0,Object(r.w)(!0);!f&&a&&(f=a),t=l;var h=r.A.apply(void 0,[e].concat(s)),d={stepData:u,stepNumber:l,time:f+n*h*.01};return n++,Object(r.R)(d)}}},function(e,t,n){"use strict";n.d(t,"b",function(){return l}),n.d(t,"d",function(){return f}),n.d(t,"c",function(){return h}),n.d(t,"a",function(){return d});var r=n(136),a=(n(290),n(151)),i=n(114),o=n(193),s=n(214);function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(a.a)("triggerAttack",{trackNumber:"",transpose:"",velocity:""},"Triggers an attack (note on) for a given tracks instrument");var l=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];var c=o[0],u=(o[1],o[2]),l=o[3].track.subSequence.name.toLowerCase(),f=i.A.apply(void 0,[e].concat(o)),h=i.A.apply(void 0,[n].concat(o)),d=f+l+".triggerAttack";if(c){var p=void 0;p=void 0===t?c.transpose:i.A.apply(void 0,[t].concat(o)),Object(r.c)(d,{trackNumber:e,time:u,transpose:p,velocity:h})}return Object(i.w)(!0)}};Object(a.a)("triggerRelease",{trackNumber:"",transpose:""},"Triggers a release (note off) for a given tracks instrument");var f=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];var s=a[0],c=(a[1],a[2]),u=a[3].track.subSequence.name.toLowerCase(),l=e+u+".triggerRelease";if(s){var f=0;void 0===t&&(f=s.transpose),Object(r.c)(l,{trackNumber:e,time:c,transpose:f})}return Object(i.w)(!0)}};Object(a.a)("triggerAttackRelease",{trackNumber:""},"Triggers an attack release for a differennt track");var h=function(e){return function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];var o=n[0],s=n[1],u=n[2],l=n[3],f=l.track.subSequence.name.toLowerCase(),h=i.A.apply(void 0,[e].concat(n));if(Array.isArray(h)){var d,p=c(h);try{for(p.s();!(d=p.n()).done;){var v=d.value,m=v+f+".triggerAttackRelease";o&&l.track.trackNumber+1!==v&&Object(r.c)(m,{trackNumber:e,time:u,stepData:o,stepNumber:s})}}catch(b){p.e(b)}finally{p.f()}}else{var y=h+f+".triggerAttackRelease";o&&h!==l.track.trackNumber+1&&Object(r.c)(y,{trackNumber:e,time:u,stepData:o,stepNumber:s})}return Object(i.w)(!0)}},d=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return Object(o.e)(e,Object(s.m)(e),6,!1)};arguments.length>3&&arguments[3];return Object(i.K)(n(e),Object(i.P)(t))}},,,,,,,,,,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"a",function(){return i});var r="PUBLIC",a="PRIVATE",i="GUILD"},,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"address",name:"_zporeDropCreator",type:"address"},{internalType:"address",name:"_zporeMetadataRenderer",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"songId",type:"uint256"},{indexed:!1,internalType:"uint256",name:"configId",type:"uint256"}],name:"NewDefaultSongConfiguration",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"songId",type:"uint256"},{indexed:!1,internalType:"address",name:"dropAddress",type:"address"}],name:"NewDropCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"songId",type:"uint256"},{indexed:!1,internalType:"string",name:"name",type:"string"},{indexed:!1,internalType:"string",name:"artist",type:"string"},{indexed:!1,internalType:"int16",name:"bpm",type:"int16"},{indexed:!1,internalType:"int16",name:"bpmDecimal",type:"int16"},{indexed:!1,internalType:"string",name:"key",type:"string"}],name:"NewSong",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"songId",type:"uint256"},{indexed:!1,internalType:"uint256",name:"stemId",type:"uint256"},{indexed:!1,internalType:"string",name:"uri",type:"string"},{indexed:!1,internalType:"uint16",name:"duration",type:"uint16"},{indexed:!1,internalType:"bool",name:"isLoop",type:"bool"}],name:"NewStem",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"stemId",type:"uint256"},{indexed:!1,internalType:"enum IStems.StemType",name:"stemType",type:"uint8"}],name:"NewStemType",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"songId",type:"uint256"},{indexed:!0,internalType:"bytes32",name:"attributeType",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"attributeValue",type:"bytes32"}],name:"SongAttribute",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"configId",type:"uint256"},{indexed:!1,internalType:"uint256",name:"stemId",type:"uint256"}],name:"SongConfigurationStem",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"songId",type:"uint256"},{indexed:!0,internalType:"address",name:"creator",type:"address"}],name:"SongCreator",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"songId",type:"uint256"}],name:"SongDeleted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"stemId",type:"uint256"},{indexed:!0,internalType:"bytes32",name:"attributeType",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"attributeValue",type:"bytes32"}],name:"StemAttribute",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"stemId",type:"uint256"}],name:"StemDeleted",type:"event"},{inputs:[{internalType:"uint256",name:"songId",type:"uint256"}],name:"deleteSong",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256[]",name:"stemIds",type:"uint256[]"}],name:"deleteStems",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"songId",type:"uint256"}],name:"getDefaultSongConfiguration",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"songId",type:"uint256"}],name:"getSong",outputs:[{components:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"artist",type:"string"},{internalType:"int16",name:"bpm",type:"int16"},{internalType:"int16",name:"bpmDecimal",type:"int16"},{internalType:"string",name:"key",type:"string"}],internalType:"struct IStems.Song",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"configId",type:"uint256"}],name:"getSongConfiguration",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"stemId",type:"uint256"}],name:"getStem",outputs:[{components:[{internalType:"string",name:"uri",type:"string"},{internalType:"uint16",name:"duration",type:"uint16"},{internalType:"bool",name:"isLoop",type:"bool"}],internalType:"struct IStems.Stem",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"stemId",type:"uint256"}],name:"getStemTypes",outputs:[{internalType:"enum IStems.StemType[]",name:"",type:"uint8[]"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"string",name:"title",type:"string"},{internalType:"string",name:"artist",type:"string"},{internalType:"int16",name:"bpm",type:"int16"},{internalType:"int16",name:"bpmDecimal",type:"int16"},{internalType:"string",name:"key",type:"string"},{internalType:"bytes32[]",name:"attributeTypes",type:"bytes32[]"},{internalType:"bytes32[]",name:"attributeValues",type:"bytes32[]"}],internalType:"struct IStems.SongData",name:"songData",type:"tuple"},{components:[{internalType:"string",name:"uri",type:"string"},{internalType:"enum IStems.StemType[]",name:"stemTypes",type:"uint8[]"},{internalType:"bool",name:"isLoop",type:"bool"},{internalType:"uint16",name:"duration",type:"uint16"},{internalType:"bytes32[]",name:"attributeTypes",type:"bytes32[]"},{internalType:"bytes32[]",name:"attributeValues",type:"bytes32[]"}],internalType:"struct IStems.StemData[]",name:"stemsData",type:"tuple[]"},{components:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"symbol",type:"string"},{internalType:"string",name:"title",type:"string"},{internalType:"string",name:"artist",type:"string"},{internalType:"string",name:"description",type:"string"},{internalType:"address",name:"fundsRecipient",type:"address"},{internalType:"uint256",name:"mintPricePerToken",type:"uint256"}],internalType:"struct IZporeDrop.Drop",name:"drop",type:"tuple"},{internalType:"address",name:"defaultAdmin",type:"address"}],name:"newSong",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"songId",type:"uint256"},{components:[{internalType:"string",name:"uri",type:"string"},{internalType:"enum IStems.StemType[]",name:"stemTypes",type:"uint8[]"},{internalType:"bool",name:"isLoop",type:"bool"},{internalType:"uint16",name:"duration",type:"uint16"},{internalType:"bytes32[]",name:"attributeTypes",type:"bytes32[]"},{internalType:"bytes32[]",name:"attributeValues",type:"bytes32[]"}],internalType:"struct IStems.StemData[]",name:"stemsData",type:"tuple[]"}],name:"newStems",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_zporeDropCreator",type:"address"}],name:"setDropCreator",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_zporeMetadataRenderer",type:"address"}],name:"setMetadataRenderer",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"stemId",type:"uint256"},{internalType:"bytes32[]",name:"attributeTypes",type:"bytes32[]"},{internalType:"bytes32[]",name:"attributeValues",type:"bytes32[]"}],name:"updateAttributesForStems",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"songId",type:"uint256"},{components:[{internalType:"string",name:"title",type:"string"},{internalType:"string",name:"artist",type:"string"},{internalType:"int16",name:"bpm",type:"int16"},{internalType:"int16",name:"bpmDecimal",type:"int16"},{internalType:"string",name:"key",type:"string"},{internalType:"bytes32[]",name:"attributeTypes",type:"bytes32[]"},{internalType:"bytes32[]",name:"attributeValues",type:"bytes32[]"}],internalType:"struct IStems.SongData",name:"songData",type:"tuple"}],name:"updateSong",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"songId",type:"uint256"},{internalType:"uint256[]",name:"stemIds",type:"uint256[]"}],name:"updateSongConfiguration",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"stemId",type:"uint256"},{components:[{internalType:"string",name:"uri",type:"string"},{internalType:"enum IStems.StemType[]",name:"stemTypes",type:"uint8[]"},{internalType:"bool",name:"isLoop",type:"bool"},{internalType:"uint16",name:"duration",type:"uint16"},{internalType:"bytes32[]",name:"attributeTypes",type:"bytes32[]"},{internalType:"bytes32[]",name:"attributeValues",type:"bytes32[]"}],internalType:"struct IStems.StemData",name:"stemData",type:"tuple"}],name:"updateStem",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"zporeDropCreator",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"zporeMetadataRenderer",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"}],this.contractAddress="0xBEEF8B1A18B376A82D87d1797359A7aDF09f3dCc"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"delegate",type:"address"},{name:"numTokens",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"contentHash",type:"bytes32"},{name:"user",type:"address"}],name:"approveContentOwner",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"numTokens",type:"uint256"}],name:"buyTokens",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"contentHash",type:"bytes32"}],name:"claimContentBalance",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"previousSequence",type:"bytes32"},{name:"newSequence",type:"bytes32"},{name:"title",type:"string"},{name:"samples",type:"bytes32[]"}],name:"editSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"newPrice",type:"uint256"}],name:"setPrice",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"receiver",type:"address"},{name:"numTokens",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"user",type:"address"},{name:"buyer",type:"address"},{name:"numTokens",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"total",type:"uint256"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"tokenOwner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"tokens",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"tokens",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"previousSequence",type:"bytes32"},{indexed:!0,name:"newSequence",type:"bytes32"},{indexed:!1,name:"title",type:"string"}],name:"SequenceEdited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sequenceHash",type:"bytes32"},{indexed:!0,name:"sampleHash",type:"bytes32"}],name:"SampleInSequence",type:"event"},{constant:!0,inputs:[{name:"user",type:"address"},{name:"delegate",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"tokenOwner",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"contentHash",type:"bytes32"}],name:"getContentBalance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getPrice",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"}],this.contractAddress="0x606f760c228cd5f11c6f79de64d3b299b11f1ed1"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"favoritePreset",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"},{internalType:"bytes32",name:"title",type:"bytes32"},{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"instrumentType",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"newPreset",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"},{internalType:"bytes32[4]",name:"tags",type:"bytes32[4]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"tagPreset",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsContractAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!1,internalType:"bytes32",name:"title",type:"bytes32"},{indexed:!1,internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{indexed:!1,internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"NewPreset",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"PresetSample",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"tag",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"PresetTagged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"PresetFavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"instrumentType",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"PresetInstrumentType",type:"event"}],this.contractAddress="0x9b2D4390C72e62638Ec894F3c246cF03D190c67B"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,[{key:"isCreated",value:function(){return void 0!==this.ipfsHash||void 0!==this.name}},{key:"getName",value:function(){}},{key:"getId",value:function(){}}]),e}();t.a=i},,function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(127);function a(e){e=function(e){return 0===e.indexOf("0x")?e.slice(2):e}(e);for(var t=[],n=0;n<e.length;n+=64)e.length<n+64?t.push(i("0x"+e.slice(n))):t.push(i("0x"+e.slice(n,n+64)));return t}function i(e){return r.a.web3.utils.padRight(e,64)}},,function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var r=1,a=4},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(6),a=n.n(r),i=n(839),o=.75;function s(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(window.isNFT)return{tempo:100,onsets:[],onsetToPitch:{}};var s=(new Date).getTime(),u=e.getChannelData(0),l=u.length,f=1e3*l/a.a.context.sampleRate;if(l/a.a.context.sampleRate<o)return{onsets:[],tempo:0};var h=t.asm._initTempo(1024,256,a.a.context.sampleRate,n,-45),d=t._newBuffer(256),p=[],v=new Set,m=u.length/256-1,y=l/256-1;m=Math.floor(r*m);for(var b=0;b<m;b++){var g=u.subarray(256*b,256*(b+1));t.HEAPF32.set(g,d>>2);var O=t.asm._processTempo(h,d),j=t.asm._getOnset(h);0===b&&(O=c(g)?1:0);var k=t.asm._getTempo(h);p.push(k),0!=O&&b<y&&j<.8*f&&v.add(j)}v=Array.from(v),t._destroyBuffer(d),t.asm._dispose(h);var w=Object(i.a)(p.filter(function(e){return 0!=e}))||0;w>180&&(w/=2);(new Date).getTime();return{tempo:w,onsets:v,onsetToPitch:{}}}function c(e){return Math.sqrt(e.reduce(function(e,t){return e+Math.pow(t,2)})/e.length)>.1}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});n(42),n(56),n(189);function r(e){}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(114),a=n(151);Object(a.a)("density",{windowSize:"The number of steps that we look back from to calculate the density"},"Calculates the number of triggers received in the last windowSize-many steps");var i=function(e){var t=[],n=void 0;return function(a,i,o){for(var s=n+2;s<i;s+=2)t.shift();var c=Object(r.A)(e,a,i,o);if(i!==n)for(;t.length>c;)t.shift();var u=t.filter(function(e){return e}).map(function(e){return e.chop}).reduce(function(e,t){return e+t},0);return t.push(a),n=i,u}}},function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(4),o=n(5),s=n(7),c=n(8),u=n(2),l=n(16),f=n(845),h=n(23),d=n(310);n(212);function p(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}t.a=function(e){return function(e){Object(s.a)(n,e);var t=m(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).variations=[],e.generation=0,e._bestSolutions=[],e}return Object(o.a)(n,[{key:"firstReproduction",value:function(e){var t=[];this._parameters.forEach(function(e){return t[e.id]=e.getCoordinates()}),this.variations=this.generateVariations(t,e)}},{key:"clearGenetic",value:function(){this.generation=0,this.variations=[],this.categories=void 0,this._bestSolutions=[],this.selectedVariation=void 0}},{key:"getBestCopy",value:function(){return this.bestSolutions.map(function(e){return Object(a.a)({},e)})}},{key:"reproduceSnapshots",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=Object(r.a)(this.effect.snapshots).slice(0,16),a=[],i=p(n);try{var o=function(){var t=e.value,n={};t.forEach(function(e){var t=e.parameter,r=e.coordinates;return n[t.id]=r}),a.push(n)};for(i.s();!(e=i.n()).done;)o()}catch(u){i.e(u)}finally{i.f()}var s=[];this._parameters.forEach(function(e){return s[e.id]=e.getCoordinates()});var c=this.generateVariations(s,t-a.length);this.variations=[].concat(a,Object(r.a)(c)),this.generation++,this._bestSolutions=[]}},{key:"unsupervised",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,n=this.effect.snapshots.length||8,a=0;a<t;a++){if(0==a){if(this.effect.snapshots.length>0){this.reproduceSnapshots();for(var i=0;i<n;i++)this.selectBest(i);continue}this.reproduce(void 0,64,8)}else this.reproduce(void 0,64,8);Math.floor(n*Object(d.b)());for(var o=0;o<n;o++)this.selectBest(o);var s=n+Math.floor(53*Object(d.b)());this.selectBest(s),this.selectedVariation=s;var c=[],u=function(t){var n=e.variations[s][t],r=e._parameters.find(function(e){return e.id===t});c.push({parameter:r,coordinates:n,min:r.min,max:r.max})};for(var l in this.variations[s])u(l);this.effect.snapshots.push(c)}this.effect.snapshots=Object(r.a)(this.effect.snapshots),this.currentSnapshotParameter.set(this.snapshots.length-1),this.clearGenetic()}},{key:"reproduce",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.8125,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;if(0===this.generation)this.firstReproduction(t);else{var a=this.getBestCopy();if(0===a.length)return;for(var i=Object(r.a)(a),o=Object(r.a)(this.nonBestSolutions),s=[],c=i.length;c<o.length-n;c++){var u=y(a),l=y(o),f=this.breed(u,l);s.push(f),i.push(f)}for(var h=[],d=0;d<n;d++){var p=y(a),v=this.generateVariation(p,e);h.push(v),i.push(v)}this.categories={elite:a,children:s,mutations:h},this.variations=i}this.generation++,this._bestSolutions=[],1==this.generation&&(this.selectBest(0),this.reproduce())}},{key:"selectBest",value:function(e){this._bestSolutions.includes(e)?this._bestSolutions=this._bestSolutions.filter(function(t){return t!==e}):this._bestSolutions.push(e)}},{key:"selectVariation",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=this.variations[e],i={},o=function(e){var o=n._parameters.find(function(t){return t.id===e});if(!o)return"continue";var s=a[e],c=s.x,u=s.y,l=o.setCoordinates(c,u,t,r,!0),f=l.id,h=l.value;n.effect.clearParameter(o,void 0,!0),i[f]=h};for(var s in a)o(s);this.track.sequencerEngine.dispatch(Object(h.xb)(i)),this.selectedVariation=e}},{key:"breed",value:function(e,t){var n,r={},i=p(this._parameters);try{for(i.s();!(n=i.n()).done;){var o=n.value.id,s=Object(d.b)();r[o]=s<.6?Object(a.a)({},e[o]):Object(a.a)({},t[o])}}catch(c){i.e(c)}finally{i.f()}return r}},{key:"bestSolutions",get:function(){var e=this;return this._bestSolutions.map(function(t){return e.variations[t]})}},{key:"nonBestSolutions",get:function(){var e=[];for(var t in this.variations)this.bestSolutions.includes(t)||e.push(this.variations[t]);return e}},{key:"generateVariations",value:function(e,t){for(var n=1/8,r=[e],a=1;a<t;a++){var i=this.generateVariation(e,n);r.push(i),n+=1/32}return r}},{key:"generateVariation",value:function(e,t){var n,r={},a=p(this._parameters);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(e[i.id]){var o=e[i.id],s=o.x,c=o.y;r[i.id]={x:Object(f.a)(s,0,l.c,t),y:Object(f.a)(c,0,l.a,t)}}}}catch(u){a.e(u)}finally{a.f()}return r}}]),n}(e)};var y=function(e){return e[Math.floor(Object(d.b)()*e.length)]}},function(e,t,n){"use strict";n.d(t,"a",function(){return m}),n.d(t,"b",function(){return y});var r=n(277),a=n(278),i=(n(847),n(848)),o=n(548),s=(n(291),n(200)),c=(n(161),n(16),n(849)),u=n(995),l=(n(850),n(851)),f=(n(852),n(853),n(854),n(855),n(360)),h=(n(856),n(857),n(858),n(439),n(549)),d=n(550),p=n(249),v=Math.sin,m=function(e){var t=Object(p.b)();return function(){for(var n=arguments.length,m=new Array(n),y=0;y<n;y++)m[y]=arguments[y];m[0]=Object(p.a)(t,m[0],m.slice(1));var b=Object(a.a)(m).group;return Object(r.e)(Object(r.b)(Object(r.e)(e?function(){var t=e.getCoordinates();({})[e.id]=t}:Object(i.b)(0,1),Object(h.a)(function(e,t){return e*t-v(e)},function(e,t){return t/e},Object(f.a)(!0))),Object(u.a)(Object(d.b)(8,Object(i.b)(0),Object(o.a)(),Object(i.b)(1,2),Object(i.b)(25,26),Object(o.a)()),[b.force(1),b.force(2),b.force(3)],.92,.6)),Object(d.c)(8,Object(l.b)(Object(l.e)(Object(r.e)(Object(i.b)(0,1),Object(s.d)()),10),Object(r.e)(Object(i.b)(0,1),Object(c.a)(10))))).apply(void 0,m)}},y=function(e){return Object(r.e)(Object(r.b)(Object(r.e)(Object(i.b)(function(e){return e},0),Object(h.a)(function(e,t){return e*t-v(e)},function(e,t){return t/e},Object(f.a)(!0))),Object(u.a)(Object(d.b)(8,Object(i.b)(function(e){return e},0),Object(o.a)(),Object(i.b)(function(e){return e},1),Object(i.b)(function(e){return e},25),Object(o.a)()),function(){var e=void 0;return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=Object(a.a)(n).group;return e||(e=[i.force(1),i.force(2),i.force(3)]),e.map(function(e){return e.map(function(e){return e()})})}}(),function(){var e=void 0;return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=Object(a.a)(n).group;return e||(e=i.knob("diffyx",.92,.9,1)),e()}}(),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Object(a.a)(t).group.knob("rootxy",.6,.01,.8)})),Object(d.c)(8,Object(l.b)(Object(l.e)(Object(r.e)(Object(i.b)(0,1),Object(s.d)()),10),Object(r.e)(Object(i.b)(0,1),Object(c.a)(10)))))}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){return function(){return{}}}},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(108),a=n(11),i=n(1),o=n(278),s=n(234),c=n(414),u=n(201),l=n(360),f=n(249),h=(n(161),n(16));Object(u.a)("vectorField",{"x-function":"(x,y) => x*y","y-function":"(x,y) => y*y-x*x","boundary-function":""},"Runs the x and y component functions on every parameter, to generate the new position. Ex: vectorField((x,y) => x*y, (x,y) => y*y-x*x, reset())");var d=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(l.a)(!0),r=Object(f.b)();return function(){for(var u=arguments.length,l=new Array(u),d=0;d<u;d++)l[d]=arguments[d];var b=Object(o.a)(l),j=b.coords,k=(b.history,b.speed);j=Object(f.a)(r,j,l.slice(1));var w=k/80,x=Object(c.j)(l.slice(1)),S={},P={};for(var E in j){var T=j[E],A=T.x,M=T.y,R=x(A,M,j[E]),C=v(p([A,M],-h.c/2,-h.a/2),.1),N=O(e,t,C),I=y(N,C),q=p(v(I,10),h.c/2,h.a/2),_=y([A,M],v(g(q,[A,M]),w/R));m(q=_)?P[E]={x:q[0],y:q[1]}:S[E]={x:q[0],y:q[1],density:R}}return Object.keys(P).length>0&&Object(s.c)(!0),Object(i.a)({},S,n.apply(void 0,[P].concat(Object(a.a)(l.slice(1)))))}},p=function(e,t,n){return y(e,[t,n])},v=function(e,t){return b(t,e)},m=function(e){var t=Object(r.a)(e,2),n=t[0],a=t[1];return n<=h.b||n>=h.c-h.b||a<=h.b||a>=h.a-h.b},y=function(e,t){return e.map(function(e,n){return e+t[n]})},b=function(e,t){return t.map(function(t){return t*e})},g=function(e,t){return e.map(function(e,n){return e-t[n]})},O=function(e,t,n){var a=Object(r.a)(n,2),i=a[0],o=a[1];return[e(i,o),t(i,o)]}},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"b",function(){return s});var r=n(161),a=n(201);Object(a.a)("alt",{arg1:"",arg2:"",argN:""},"Alternates between the arguments with every trigger received by this function");var i=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=0;return function(){for(var e=a++%t.length,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return r.a.apply(void 0,[t[e]].concat(i))}};Object(a.a)("every",{n:"",fn:"",elseFn:""},"Every n-many triggers do something, otherwise do something else. The else is optional.");var o=function(e,t,n){var a=0;return function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];var c=r.a.apply(void 0,[e].concat(o));return 0===++a%c?t.apply(void 0,o):n?n.apply(void 0,o):o[0]}};Object(a.a)("altn",{n:"How many triggers it takes to increment the output conditional",arg1:"Output conditional",arg2:"Output conditional",argN:"Output conditional (will loop back to arg1 after this this)"},"Alternates between the arguments every n-many triggers received by this function");var s=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var i=0,o=0;return function(){for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];var c=r.a.apply(void 0,[e].concat(a));++i%c===0&&o++;var u=n[o%n.length];return r.a.apply(void 0,[u].concat(a))}}},function(e,t,n){"use strict";n.d(t,"a",function(){return O}),n.d(t,"i",function(){return j}),n.d(t,"r",function(){return k}),n.d(t,"f",function(){return w}),n.d(t,"v",function(){return x}),n.d(t,"l",function(){return S}),n.d(t,"u",function(){return P}),n.d(t,"b",function(){return E}),n.d(t,"s",function(){return T}),n.d(t,"p",function(){return A}),n.d(t,"o",function(){return M}),n.d(t,"e",function(){return R}),n.d(t,"c",function(){return C}),n.d(t,"d",function(){return N}),n.d(t,"n",function(){return I}),n.d(t,"m",function(){return q}),n.d(t,"g",function(){return _}),n.d(t,"k",function(){return D}),n.d(t,"t",function(){return F}),n.d(t,"q",function(){return L}),n.d(t,"h",function(){return B}),n.d(t,"j",function(){return z});var r=n(1),a=n(31),i=n(10),o=n(4),s=n(5),c=n(7),u=n(8),l=n(2),f=n(139),h=n(14),d=n(116),p=n(128),v=n(150),m=n(170);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var b=function(e){Object(c.a)(n,e);var t=y(n);function n(e,r,a,i,s){var c;return Object(o.a)(this,n),(c=t.call(this,e,r,0)).numberOfOutputs=3,c.predicate=a,c.action=i,c.aux=s,c}return Object(s.a)(n,[{key:"getText",value:function(){return void 0!==this.value?this.value:""}}]),n}(f.a),g=function(e){Object(c.a)(n,e);var t=y(n);function n(e,r,i){var s;return Object(o.a)(this,n),(s=t.call(this,e,r,void 0,void 0,i)).numberOfOutputs=1,s.valueParameter=new h.b("value",Object(a.a)(s),function(e,t){e.rack&&e.rack.updateRules()},{defaultValue:void 0,min:-1,max:16,exactAutomation:!0}),s.registerParameter(s.valueParameter),s}return Object(s.a)(n,[{key:"getJson",value:function(){var e=Object(r.a)({},Object(i.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{value:this.value});return e=Object(p.b)(e,"valueParameter",this.valueParameter)}},{key:"fromJson",value:function(e){var t=Object(i.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e);return Object(d.a)(this.valueParameter,e.value,t),Object(r.a)({},t,Object(p.a)(e,"valueParameter",this.valueParameter))}},{key:"value",get:function(){return Math.round(this.valueParameter.get())},set:function(e){this.valueParameter.set(e,!1,!1)}}]),n}(b),O=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(o.a)(this,n),t.call(this,"Accent",e,void 0,m.a)}return n}(b),j=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(o.a)(this,n),t.call(this,"Flam",e,void 0,m.d)}return n}(b),k=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(o.a)(this,n),t.call(this,"Regular",e,void 0,m.j)}return n}(b),w=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(o.a)(this,n),t.call(this,"Double",e,void 0,m.c)}return n}(b),x=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,"Times",e,void 0,m.n)).valueParameter=new h.b("value",Object(a.a)(i),function(e,t){i.action=Object(r.a)({},m.n,{value:t}),e.rack&&e.rack.updateRules()},{defaultValue:3,min:1,max:16,exactAutomation:!0}),i.registerParameter(i.valueParameter),i}return Object(s.a)(n,[{key:"value",get:function(){return Math.round(this.valueParameter.get())},set:function(e){this.valueParameter.set(e,!1,!1)}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(i.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{value:this.value});return e=Object(p.b)(e,"valueParameter",this.valueParameter)}},{key:"fromJson",value:function(e){var t=Object(i.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e);return Object(d.a)(this.valueParameter,e.value,t),Object(r.a)({},t,Object(p.a)(e,"valueParameter",this.valueParameter))}}]),n}(b),S=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(o.a)(this,n),t.call(this,"Legato",e,void 0,m.e)}return n}(b),P=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(o.a)(this,n),t.call(this,"Staccato",e,void 0,m.m)}return n}(b),E=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(o.a)(this,n),t.call(this,"Any",e,m.b)}return n}(b),T=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(o.a)(this,n),t.call(this,"Rest",e,void 0,m.k)}return n}(b),A=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(o.a)(this,n),t.call(this,"Piano",e,void 0,m.i)}return n}(b),M=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(o.a)(this,n),t.call(this,"Pianissimo",e,void 0,m.h)}return n}(b),R=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(o.a)(this,n),t.call(this,"Dot",e,Object(v.c)())}return n}(b),C=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(o.a)(this,n),t.call(this,"Dash 1",e,Object(v.b)(0))}return n}(b),N=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(o.a)(this,n),t.call(this,"Dash 2",e,Object(v.b)(1))}return n}(b),I=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Otherwise",e,Object(m.s)())).numberOfOutputs=1,r}return n}(b),q=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Max",e,function(e,t){return e.max(t)})).value=1,r}return n}(g),_=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Figure",e,function(e,t){return e.figure(t)})).value=0,r}return n}(g),D=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Later",e,function(e,t){return e.later(t)})).value=2,r}return n}(g),F=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Skip",e,function(e,t){return e.skip(t)})).value=2,r}return n}(g),L=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"R.Every",e,function(e,t){return e.every(t)})).value=2,r}return n}(g),B=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"First",e,function(e,t){return e.first(t)})).value=0,r}return n}(g),z=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Last",e,function(e,t){return e.last(t)})).value=0,r}return n}(g)},function(e,t,n){"use strict";n.d(t,"j",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"g",function(){return i}),n.d(t,"h",function(){return o}),n.d(t,"e",function(){return s}),n.d(t,"k",function(){return c}),n.d(t,"f",function(){return u}),n.d(t,"a",function(){return l}),n.d(t,"n",function(){return f}),n.d(t,"b",function(){return h}),n.d(t,"d",function(){return d}),n.d(t,"l",function(){return p}),n.d(t,"m",function(){return v}),n.d(t,"i",function(){return m});var r="PROBABILITY",a="EVERY",i="MARKOV",o="MARKOV_PREVIOUS",s="GATE_MASK",c="REVERSE",u="LEGATO",l="DELAY",f="TRANSPOSE",h="DURATION",d="EXPAND",p="ROLL",v="SCRIPT",m=[c,f,h,s,l,d,p,u]},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r=n(42),a=n.n(r),i=n(56),o=n(142),s=n(415),c=n(119);function u(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var f=(new(n(535).a)).contractAddress,h=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,l,h,m,y,b,g,O,j;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new o.a(f).from(c.F),t&&n.whereIn("songId",t),e.next=4,n.executeQuery(!0,!0);case 4:r=e.sent,i=[],s=[],l=u(r),e.prev=8,l.s();case 10:if((h=l.n()).done){e.next=18;break}if(m=h.value,!s.includes(m.songId)){e.next=14;break}return e.abrupt("continue",16);case 14:s.push(m.songId),i.push(m);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),l.e(e.t0);case 23:return e.prev=23,l.f(),e.finish(23);case 26:return r=i,e.next=29,d(r.map(function(e){return e.songId}));case 29:return y=e.sent,e.next=32,p(r);case 32:return b=e.sent,e.next=35,v(r);case 35:for(j in g=e.sent,console.log("song to attributes=",g),O=function(e){e=parseInt(e);var t,n=r.find(function(t){return t.songId===e}),a=y[e],i=b[e],o=u(i);try{for(o.s();!(t=o.n()).done;){var s=t.value;s.isDefaultStem=!!a&&a.includes(s.stemId)}}catch(c){o.e(c)}finally{o.f()}n.stems=i,n.attributes=g[e],j=e},b)O(j);return r.sort(function(e,t){return t.songId-e.songId}),e.abrupt("return",r);case 41:case"end":return e.stop()}},e,null,[[8,20,23,26]])}));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s,l,h,d,p,v,m,y,b,g,O;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new o.a(f).from(c.k),e.next=3,t.executeQuery(!0,!0);case 3:n=e.sent,r=new Set,i={},s=u(n);try{for(s.s();!(l=s.n()).done;)h=l.value,r.has(h.songId)||(i[h.configId]=h.songId),r.add(h.songId)}catch(a){s.e(a)}finally{s.f()}return d=(d=Object.keys(i)).map(function(e){return parseInt(e)}),p=new o.a(f).from(c.hb).whereIn("configId",d),e.next=13,p.executeQuery(!0,!0);case 13:v=e.sent,m={},y=u(v);try{for(y.s();!(b=y.n()).done;)g=b.value,O=i[g.configId],m[O]||(m[O]=[]),m[O].push(g.stemId)}catch(a){y.e(a)}finally{y.f()}return e.abrupt("return",m);case 18:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),p=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,l,h,d,p,v,m;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new o.a(f).from(c.G).whereIn("songId",t.map(function(e){return e.songId})),e.next=3,n.executeQuery(!0,!0);case 3:return r=e.sent,i=r.map(function(e){return e.stemId}),l=new o.a(f).from(c.H).whereIn("stemId",i),e.next=8,l.executeQuery(!0,!0);case 8:h=e.sent,d={},p=u(r);try{for(m=function(){var e=v.value,t=e.stemId,n=e.songId,r=h.filter(function(e){return e.stemId===t});e.stemTypes=r.map(function(e){return e.stemType}),e.prettyStemTypes=r.map(function(e){return s.b[e.stemType]}),d[n]||(d[n]=[]),d[n].push(e)},p.s();!(v=p.n()).done;)m()}catch(a){p.e(a)}finally{p.f()}return e.abrupt("return",d);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,l,h,d,p,v,m;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map(function(e){return e.songId}),r=new o.a(f).from(c.gb).whereIn("songId",n),e.next=4,r.executeQuery(!0,!0);case 4:i=e.sent,console.log("RESULTS=",i),s={},l=u(i),e.prev=8,l.s();case 10:if((h=l.n()).done){e.next=20;break}if(d=h.value,p=d.songId,v=d.attributeType,"\x01"===(m=d.attributeValue)?m=!0:"\0"===m?m=!1:null===m&&(m=!1),s[p]||(s[p]={}),!s[p][v]){e.next=17;break}return e.abrupt("continue",18);case 17:s[p][v]=m;case 18:e.next=10;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(8),l.e(e.t0);case 25:return e.prev=25,l.f(),e.finish(25);case 28:return e.abrupt("return",s);case 29:case"end":return e.stop()}},e,null,[[8,22,25,28]])}));return function(t){return e.apply(this,arguments)}}()},,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(32),a=n(108),i=n(3),o=n.n(i),s=n(23),c=n(55),u=40,l=250;function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;return(e-t)/(n-t)}(e,t,n,r);return r*Math.pow(i,1/a)+4}t.a=Object(c.b)(function(e,t){return{value:t.parameter.get(),isMacroMapping:e.effects.isMacroMapping}},function(e){return{setParameterToMap:function(t){return e(Object(s.Ic)(t))}}})(function(e){var t,n=e.needsRound,s=e.setParameterToMap,c=e.isMacroMapping,h=e.isDraggable,d=void 0===h||h,p=(e.track,e.color),v=e.name,m=e.label,y=(e.rackTrack,e.value),b=e.parameter,g=(e.id,e.min),O=void 0===g?b.min:g,j=e.max,k=void 0===j?b.max:j,w=e.width,x=void 0===w?u:w,S=e.units,P=void 0===S?"":S,E=e.display,T=e.root,A=void 0===T?2:T,M=e.stopPropagation,R=void 0===M||M,C=Object(i.useState)(!1),N=Object(a.a)(C,2),I=N[0],q=N[1],_=Object(i.useState)(!1),D=Object(a.a)(_,2),F=D[0],L=D[1],B=Object(i.useRef)(void 0),z=Object(i.useState)(""),J=Object(a.a)(z,2),V=J[0],H=J[1],U=Object(i.useRef)(0),G=Object(i.useRef)(void 0),W={width:f(y,O,k,x,A,n),backgroundColor:p},K=Object(i.useCallback)(function(e){if("Enter"===e.key){var t=parseFloat(V);if(isNaN(t))return;b.set(t,!0),L(!1)}},[L,V,b]);Object(i.useEffect)(function(){F&&(H(Math.round(100*b.get(!0))/100),G.current&&(G.current.focus(),G.current.select()))},[F,H,b]);var Q=function(){return b.id},Z=Object(i.useCallback)(function(e){e.stopPropagation();var t=(new Date).getTime();t-U.current<l?L(!0):(U.current=t,!R&&d||e.stopPropagation(),q(!0))},[c,d,b,q]);Object(i.useEffect)(function(){return window.addEventListener("mousemove",X),window.addEventListener("mouseup",$),function(){window.removeEventListener("mousemove",X),window.removeEventListener("mouseup",$)}},[b,q,I]);var Y,$=Object(i.useCallback)(function(){q(!1)},[q]),X=Object(i.useCallback)(function(e){if(R&&e.stopPropagation(),I){var t=function(e,t,n,r,a,i,o){var s=o.current.getBoundingClientRect(),c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=(e=Math.min(Math.max(0,e),r))/r,o=Math.pow(i,a);return t+(n-t)*o}(e.clientX-s.left,n,r,a,i);return isNaN(c)?-100:c}(e,Q(),O,k,x,A,B);console.log("new vol=",t),n&&(console.log("rounding"),t=Math.round(t)),b.get()!==t&&(console.log("setting vol=",t),b.set(t,!1))}},[b,I]),ee=Object(i.useCallback)(function(e){e.stopPropagation(),c&&(b.isMapped||s(b))},[c]);return F?o.a.createElement("div",{className:"p-box"},o.a.createElement("div",{className:"p-name"},v),o.a.createElement("input",{ref:G,className:"volume-box",onChange:function(e){return H(e.target.value)},onKeyDown:K,value:V})):o.a.createElement("div",{className:"p-box "},c&&o.a.createElement("div",{onClick:ee,className:"macro-overlay"}),o.a.createElement("div",{className:"p-name"},v),o.a.createElement("div",(t={draggable:!0,onClick:ee,onDragStart:function(e){return e.preventDefault()},style:{width:x+6},id:Q()},Object(r.a)(t,"onClick",function(e){return e.stopPropagation()}),Object(r.a)(t,"onMouseUp",function(e){e.stopPropagation(),q(!1)}),Object(r.a)(t,"onMouseLeave",function(e){e.stopPropagation()}),Object(r.a)(t,"onMouseDown",Z),Object(r.a)(t,"className","volume-box"),t),o.a.createElement("div",{style:W,ref:B,className:"volume-indicator"}),o.a.createElement("span",{className:"volume-value"},m?m+": ":""," ",E?E(y):(Y=y,Math.round(100*Y)/100)," ",P)))})},function(e,t,n){"use strict";function r(e,t,n,r){var a=e.x,i=e.y,o=t.x,s=t.y,c=n.x,u=n.y,l=r.x,f=r.y;if(a===o&&i===s||c===l&&u===f)return!1;var h=(f-u)*(o-a)-(l-c)*(s-i);if(0===h)return!1;var d=((l-c)*(i-u)-(f-u)*(a-c))/h,p=((o-a)*(i-u)-(s-i)*(a-c))/h;return!(d<0||d>1||p<0||p>1)&&{x:a+d*(o-a),y:i+d*(s-i)}}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),o=n(7),s=n(8),c=n(2),u=n(109),l=n(238);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(o.a)(n,e);var t=f(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"typed",value:function(e){var t=this;if(!this.args)return e;var n=new Array(16).fill(0).map(function(e,n){return function(){return t.resolveArg(t.args[n],n)}});return l.a.apply(void 0,[e,this].concat(Object(r.a)(n)))}},{key:"registerTypes",value:function(e){var t=Object(u.a)(e),n=t.type,r=t.inletTypes;t.outlets,t.isHot,t.inlets;this.determineType="function"===typeof n?n:function(){return n},this.inletTypes=r}},{key:"storeOutputType",value:function(e){e&&(Array.isArray(e)||(e=[e]),this.outputtedTypes=e.map(function(e){return e&&e.type}))}}]),n}(e)}},function(e,t,n){"use strict";var r=n(108),a=n(3),i=n.n(a),o=n(55),s=(n(324),n(901));t.a=Object(o.b)(function(e,t){return{}},null)(function(e){e.text;var t=e.className,n=void 0===t?"":t,o=e.width,c=void 0===o?390:o,u=e.intervalTime,l=void 0===u?100:u,f=e.intervalPiece,h=void 0===f?10:f,d=Object(a.useState)(0),p=Object(r.a)(d,2),v=p[0],m=p[1];return Object(a.useEffect)(function(){var e=setInterval(function(){m(function(e){return(e+h)%100})},l);return function(){return clearInterval(e)}},[]),Object(a.useEffect)(function(){if(window.parent&&document.referrer){var e={type:"loading-progress",body:v},t=document.referrer;window.parent.postMessage(e,t)}},[v]),i.a.createElement("div",{style:{width:c,height:c},className:"circular-container progress-bar "+n},i.a.createElement(s.a,{percentage:v,radius:c/2}))})},function(e,t,n){"use strict";n.d(t,"a",function(){return h}),n.d(t,"b",function(){return p}),n.d(t,"c",function(){return v});var r=n(1),a=n(108),i=n(109),o=n(138),s=n(423),c=n(20),u=n(129);n(156);function l(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(i.a)("gl.genArgs",{name:"Name of the function argument",type:"Type of the function argument"},"Generates a vec3 arguement that can be used in a function definition",function(e){return e},{});var h=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e.needsLoad=!0,e.needsHotReload=!0;var i=e.id.replaceAll("-","");return function(e){Object(a.a)(e,1)[0];var t,r={},o=[],s=0,c=l(n);try{for(c.s();!(t=c.n()).done;){var u=(0,t.value)();if(u){var f="arg_"+s+"_"+i;r[f]=u,o.push({code:"(".concat(f,")"),type:u,model:function(e){return e},uniforms:{},variables:{},closure:r}),s++}}}catch(h){c.e(h)}finally{c.f()}return o}};Object(i.a)("gl.genArg",{name:"Name of the function argument",type:"Type of the function argument"},"Generates a vec3 arguement that can be used in a function definition",function(){return 1},{inlets:2});Object(i.a)("gl.genFunction",{network:"function network",name:"Name of the function that is generated",returnType:"Name of the function that is generated","argument name list":"exact name of arguments (in list)","tack to end":""},"Generates a function",function(){return 1},{isHot:!0,type:o.a,inlets:5});var d=function(e,t,n,i,f){var h=Object(c.uuid)().replaceAll("-","");return function(e){var c=Object(a.a)(e,1)[0],d=void 0===f(),p=(t()||"")+(d?"generated":"")+h,v=Object(u.a)(c,t),m=v.codes,y=v.uniforms,b=v.functions,g=v.closure,O=c.variables;i()&&(g=function(e,t){var n,r={},a=l(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;r[i]=e[i]}}catch(o){a.e(o)}finally{a.f()}return r}(g,i()));var j={};return j[p]={args:g,returnType:n(),body:"\n".concat(Object(s.c)(O),"\nreturn ").concat(m[0],";\n").split("\n").map(function(e){return"  "+e}).join("\n")},{func:(b=Object(r.a)({},b,j))[p],functionName:p,codeEvaluator:function(e){return"(".concat(p,"(").concat(e,"))")},eval:function(e){return"(".concat(p,"(").concat(e,"))")},model:c.model,frames:c.frames,uniforms:y,variables:{},functions:b,type:o.a}}};Object(i.a)("gl.genCall",{function:"",args:""},"",function(){return 1},{inletTypes:"function",inlets:function(e){return e+1},isHot:!0});var p=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return function(e){var t=Object(a.a)(e,1)[0];t.type!==o.a&&(t=d(0,function(){return"autom"},function(){return t.type},function(){},function(){return!1})([t]));var i=t,s=i.frames,c=i.codeEvaluator,f=i.functions,h=i.uniforms,p=i.variables,v=i.func;if(c){var m,y=n.map(function(e){return e()}).filter(function(e){return e}),b=u.a.apply(void 0,n).closure,g=c(y.map(function(e){return e.code||e}).join(",")),O={},j=l(y);try{for(j.s();!(m=j.n()).done;){var k=m.value;k.variables&&(p=Object(r.a)({},p,k.variables)),k.uniforms&&(h=Object(r.a)({},h,k.uniforms)),k.functions&&(O=Object(r.a)({},O,k.functions))}}catch(w){j.e(w)}finally{j.f()}return f=Object(r.a)({},O,f),{type:v.returnType,closure:b,frames:s,uniforms:h,code:g,functions:f,variables:p}}}},v={"gl.genArg":function(e,t){return e.needsLoad=!0,e.needsHotReload=!0,function(e){var n=Object(a.a)(e,1)[0],r=void 0===n?"p":n,i={};return i[r]=t(),{code:"(".concat(r,")"),model:function(e){return e},uniforms:{},variables:{},closure:i}}},"gl.genArgs":h,"gl.genFunction":d,"gl.genCall":p}},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(1),a=n(108),i=n(4),o=n(5),s=n(10),c=n(7),u=n(8),l=n(2),f=n(117),h=n(164);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}console.error;window.errors=[],console.error=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];window.errors.push(t)};var p=function(e){Object(c.a)(n,e);var t=d(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).newInlet("vertex shader",function(e){var t=Object(a.a)(e,1)[0];return r.onVertexShader(t)}),r.newInlet("fragment shader",function(e){var t=Object(a.a)(e,1)[0];return r.onFragmentShader(t)}),r.newOutlet("material"),r.uniforms={},r}return Object(o.a)(n,[{key:"getJson",value:function(e){return Object(r.a)({},Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this,e),{uniforms:Object.keys(this.uniforms)})}},{key:"fromJson",value:function(e,t){var r=this;Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t),e.uniforms&&e.uniforms.forEach(function(e){return r.createUniform(e,0)})}},{key:"onVertexShader",value:function(e){this.vertexShader=e,this.updateMaterial()}},{key:"onFragmentShader",value:function(e){this.fragmentShader=e,this.updateMaterial()}},{key:"createUniform",value:function(e,t){var n=this;if(e in this.uniforms)return this.uniforms[e].value=t,isNaN(t)&&(this.uniforms[e].type="t"),void(this.material&&(this.material.uniformsNeedUpdate=!0));this.uniforms[e]={value:t},this.material&&(this.material.uniformsNeedUpdate=!0),isNaN(t)&&(this.uniforms[e].type="t"),this.newInlet(e,function(t){var r=Object(a.a)(t,1)[0];n.uniforms[e].value=r,isNaN(r)&&(n.uniforms[e].type="t"),n.material&&(n.material.uniformsNeedUpdate=!0,n.sendMessage("material",n.material))})}},{key:"updateMaterial",value:function(){var e=(new Date).getTime();if(this.fragmentShader&&this.vertexShader){window.errors.length;this.material?(this.material.fragmentShader=this.fragmentShader,this.material.vertexShader=this.vertexShader,this.material.needsUpdate=!0):this.material=new h.T({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,transparent:!0,depthWrite:!1,blending:h.H});var t=(new Date).getTime();console.log("compilation took %s ms",t-e);window.errors.length;this.sendMessage("material",this.material)}}}]),n}(f.a)},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(115),f=n(116),h=n(6),d=n.n(h),p=n(113);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(s.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Ultra Phaser",function(){return new d.a.Gain(1)},e)).poles=8,r.generateAllPassFilters(),r.rateParameter=new p.c("Rate",r.lfo.frequency,{documentation:"The speed of the sweeping.",defaultValue:.25,min:0,max:16}),r.registerParameter(r.rateParameter),r.feedbackParameter=new p.c("Feedback",r.feedbackNode.gain,{documentation:"The amount of signal that is fed back into the effect.",defaultValue:.1,min:0,max:1}),r.registerParameter(r.feedbackParameter),r.wetParameter=new p.c("Wet",r.crossFade.fade,{documentation:"Controls the amount of (wet) effected signal, vs. dry (un-effected) signal.",defaultValue:.5,min:0,max:1}),r.registerParameter(r.wetParameter),r.depthParameter=new p.a("Depth",r.lfo._scaler._scale,function(e,t){r.lfo.max=t},{documentation:"The depth of the modulation, controlling how much it sweeps on each cycle.",min:0,max:1,unit:"",defaultValue:.5,automatable:!1}),r.registerParameter(r.depthParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"dispose",value:function(){Object(o.a)(Object(u.a)(n.prototype),"dispose",this).call(this),this.filters.forEach(function(e){return e.dispose()}),this.scalers.forEach(function(e){return e.dispose()}),this.crossFade.dispose(),this.lfo.dispose(),this.feedbackNode.dispose(),this.outputNode.dispose(),this.filters=void 0,this.scalers=void 0,this.crossFade=void 0,this.lfo=void 0,this.feedbackNode=void 0,this.outputNode=void 0,this.feedbackParameter=void 0,this.depthParameter=void 0,this.wetParameter=void 0,this.rateParameter=void 0}},{key:"generateAllPassFilters",value:function(){var e=this;this.filters=[],this.scalers=[];for(var t=100,n=0;n<this.poles;n++){var r=new d.a.Filter(t,"allpass");this.filters.push(r);var a=new d.a.Scale(t,t+4e3);a.connect(r.frequency),this.scalers.push(a),t+=1e3}this.outputNode=new d.a.Gain(1),this.lfo=new d.a.LFO("1n",0,1),this.filters.forEach(function(t,n){return e.lfo.connect(e.scalers[n])});var i=this.effectNode;for(var o in this.filters)i.connect(this.filters[o]),i=this.filters[o];this.lfo.start(),this.crossFade=new d.a.CrossFade(0),this.crossFade.connect(this.outputNode),this.effectNode.connect(this.crossFade,0,0),i.connect(this.crossFade,0,1),this.feedbackNode=new d.a.Gain(.2),i.connect(this.feedbackNode),this.feedbackNode.connect(this.filters[0])}},{key:"documentation",value:function(){return"Sweeping effect where signal is filtered, and the position of peaks and troughs are modulated and varying."}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{rate:this.rateParameter.get(),feedback:this.feedbackParameter.get(),wet:this.wetParameter.get(),depth:this.depthParameter.get()});return e=this.saveParameterToJson(e,"rateParameter",this.rateParameter),e=this.saveParameterToJson(e,"feedbackParameter",this.feedbackParameter),e=this.saveParameterToJson(e,"wetParameter",this.wetParameter),e=this.saveParameterToJson(e,"depthParameter",this.depthParameter)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return!isNaN(e.rate)&&e.rate&&Object(f.a)(this.rateParameter,e.rate,a),Object(f.a)(this.feedbackParameter,e.feedback,a),Object(f.a)(this.wetParameter,e.wet,a),Object(f.a)(this.depthParameter,e.depth,a),Object(r.a)({},a,this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t),this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter,t),this.loadParameterFromJson(e,"wetParameter",this.wetParameter,t),this.loadParameterFromJson(e,"depthParameter",this.depthParameter,t))}}]),n}(l.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(115),f=n(116),h=n(6),d=n.n(h),p=(n(14),n(113)),v=n(365);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var y=new Float32Array(65536),b=function(e){Object(s.a)(n,e);var t=m(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Saturator",function(){return new d.a.Gain(1)},e)).waveShaperNode=new d.a.WaveShaper([-1,1]),r.effectNode.connect(r.waveShaperNode),r.postGain=new d.a.Gain(1),r.waveShaperNode.connect(r.postGain),r.params=r.getParams(-10,20,30,6),r.driveParameter=new p.a("Drive",r.effectNode.gain,function(e,t){r.effectNode.gain.value=t,r.postGain.gain.value=Math.pow(1/t,.6)},{documention:"Controls the level of saturation.",min:.01,max:32,unit:"",defaultValue:1,constantAutomationRate:!0}),r.registerParameter(r.driveParameter),r.waveShaperNode.curve=r.generateCurve(),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"documentation",get:function(){return"Saturates the sound, making it more distorted."}},{key:"dispose",value:function(){this.driveParameter.dispose(!1),Object(o.a)(Object(u.a)(n.prototype),"dispose",this).call(this),this.postGain.dispose(),this.waveShaperNode.dispose(),this.postGain=void 0,this.waveShaperNode=void 0,this.driveParameter=void 0}},{key:"connect",value:function(e){this.postGain.connect(e)}},{key:"disconnect",value:function(e){this.postGain.disconnect(e)}},{key:"getParams",value:function(e,t,n,r){var a=Object(v.a)(e),i=(Object(v.a)(t),1/n),o=this.kAtSlope(1/n,e,t,a),s=e+t,c=Object(v.a)(s);return{linearThreshold:a,thresholdDb:e,kneeDb:t,ykneeThresholdDb:Object(v.b)(this.saturateBasic(c,o,a)),kneeThreshold:c,kneeThresholdDb:s,k:o,ratio:n,slope:i}}},{key:"slopeAt",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.params.linearThreshold;if(e<n)return 1;var r=1.001*e,a=Object(v.b)(e),i=Object(v.b)(r),o=Object(v.b)(this.saturateBasic(e,t,n));return(Object(v.b)(this.saturateBasic(r,t,n))-o)/(i-a)}},{key:"kAtSlope",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.params.thresholdDb,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.params.kneeDb,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.params.linearThreshold,a=t+n,i=Object(v.a)(a),o=.1,s=1e4,c=5,u=0;u<15;++u){this.slopeAt(i,c,r)<e?(s=c,c=Math.sqrt(o*s)):(o=c,c=Math.sqrt(o*s))}return c}},{key:"saturateBasic",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.params.linearThreshold;return e<n?e:n+(1-Math.exp(-t*(e-n)))/t}},{key:"saturate",value:function(e){var t;if(e<this.params.kneeThreshold)t=this.saturateBasic(e,this.params.k);else{var n=Object(v.b)(e),r=this.params.ykneeThresholdDb+this.params.slope*(n-this.params.kneeThresholdDb);t=Object(v.a)(r)}return t}},{key:"generateCurve",value:function(){for(var e=32768,t=0,n=0;n<e;++n)t=n/e,t=this.saturate(t),y[e+n]=t,y[e-n-1]=-t;return y}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{drive:this.driveParameter.get()});return e=this.saveParameterToJson(e,"driveParameter",this.driveParameter)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(f.a)(this.driveParameter,e.drive,a),Object(r.a)({},a,this.loadParameterFromJson(e,"driveParameter",this.driveParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(l.a.Effect);t.a=b},function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(4),o=n(5),s=n(10),c=n(7),u=n(8),l=n(2),f=n(115),h=(n(123),n(80),n(17),n(20),n(6)),d=n.n(h),p=(n(382),n(113),n(128),n(225)),v=(n(372),n(328)),m=n(375),y=n(327);function b(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var j=function(e){Object(c.a)(n,e);var t=O(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,"Effect Rack",function(){return new d.a.Gain(1)},e)).inputNode=r.effectNode,r.inputNode.x=0,r.inputNode.y=200,r.outputNode=new d.a.Gain(1),r.outputNode.id="speakers-"+r.id,r.outputNode.x=400,r.outputNode.y=200,r.initializeConfigurations(r.adjacencyLists),r}return Object(o.a)(n,[{key:"onBPMUpdated",value:function(){for(var e in this.effects)this.effects[e].onBPMUpdated&&this.effects[e].onBPMUpdated()}},{key:"getParameters",value:function(){var e=Object(s.a)(Object(l.a)(n.prototype),"getParameters",this).call(this);for(var t in this.macros)e=[].concat(Object(a.a)(e),Object(a.a)(this.macros[t].parameters));return e}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(){this.outputNode.disconnect()}},{key:"addEffect",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(s.a)(Object(l.a)(n.prototype),"addEffect",this).call(this,e,t),t&&e.enable(!0),t&&e.wetParameter&&e.wetParameter.set(1)}},{key:"dispose",value:function(){for(var e in this.macros.forEach(function(e){return e.dispose()}),this.macros=[],this.effects.forEach(function(e){return e.dispose()}),this.adjacencyLists)this.adjacencyLists[e]&&this.adjacencyLists[e].forEach(function(e){return e.dispose()});this.adjacencyLists=void 0,Object(s.a)(Object(l.a)(n.prototype),"dispose",this).call(this),this.outputNode.dispose(),this.outputNode=void 0,this.effects=void 0,this.macros=void 0}},{key:"deleteEdge",value:function(e){var t=this;if(!e.modulator){var r=function(n){if(t.adjacencyLists[n].indexOf(e)>-1)if(-1===parseInt(n))t.inputNode.disconnect(e.gain);else{var r=t.effects.find(function(e){return e.id===n});r&&r.disconnect(e.gain)}};for(var a in this.adjacencyLists)r(a)}Object(s.a)(Object(l.a)(n.prototype),"deleteEdge",this).call(this,e)}},{key:"connectEdge",value:function(e,t){return Object(s.a)(Object(l.a)(n.prototype),"connectEdge",this).call(this,e,t),e.connect(t.gain),t}},{key:"getJson",value:function(){return Object(r.a)({},this.getRackJson(),{isCollapsed:this.isCollapsed})}},{key:"muteRack",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.inputNode.gain.value=e?0:1,this.outputNode.gain.value=e?0:1}},{key:"fromJson",value:function(e,t,a,i){this.muteRack(!0),Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,i),this.isCollapsed=e.isCollapsed,this.adjacencyLists={},this.configurations=[],this.effects.forEach(function(e){return e.dispose()}),this.effects=[];var o=e.effects,c={};for(var u in o){var f=o[u],h=Object(p.b)(f,t,this.sequencerEngine,a),d=h.effect;this.addEffect(d,!1),d.id=f.id,d.x=f._x||f.x,d.y=f._y||f.y,c=Object(r.a)({},c,h.bulk)}return this.fromRackJson(e,i),this.muteRack(!1),this.outputNode.id="speakers-"+this.id,c}},{key:"fromJsonSync",value:function(e,t,r,a,i,o){Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,!0),this.adjacencyLists={},this.configurations=[],this.effects.forEach(function(e){return e.dispose()}),this.effects=[];for(var c in a){var u=a[c].getEffectCopy(i,o);this.addEffect(u,!1),u.x=e.effects[c].x,u.y=e.effects[c].y;var f=a[c];if(u.id!==f.id){var h,d=b(e.configurations);try{for(d.s();!(h=d.n()).done;){var p=h.value,v=p[f.id];p[u.id]=v,delete p[f.id]}}catch(m){d.e(m)}finally{d.f()}}}return this.fromRackJson(e,!0),{}}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e),a=this.context.track;return r.fromJsonSync(this.getJson(),this.sequencerEngine.tracks,void 0!==a?a.trackNumber:0,this.effects,e,t),r}}]),n}(Object(y.a)(Object(m.a)(Object(v.a)(f.a.Effect))));t.a=j},,function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(14);function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=u(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"setupTrackParameter",value:function(){var e=this;this.trackParameter=new c.b("track",this,function(t,n){e.onChangeTrack(n)},{defaultValue:-1,min:0,max:10,isAutomatable:!1}),this._track=void 0}},{key:"onChangeTrack",value:function(e){this._track=-1!==e?this.sequencerEngine.tracks[e]:void 0}},{key:"getTrack",value:function(){var e=this.trackParameter.get();if(-1!==e)return this.sequencerEngine.tracks[e]}}]),n}(e)}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),o=n(10),s=n(7),c=n(8),u=n(2),l=n(424),f=n(14),h=n(182);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var p=function(e){Object(s.a)(n,e);var t=d(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Roll Effect",h.f,e)).rollFactorParameter=new f.a("Roll Factor",Object(i.a)(a),function(e,t){return t},{min:.125,max:8,unit:"x",defaultValue:1}),a.registerParameter(a.rollFactorParameter),a.modeParameter=new f.b("Mode",Object(i.a)(a),function(e,t){return t},{min:h.a,max:h.b,unit:"",defaultValue:h.g}),a.registerParameter(a.modeParameter),a}return Object(a.a)(n,[{key:"mode",get:function(){return this.modeParameter.get()},set:function(e){this.modeParameter.set(e)}},{key:"rollFactor",get:function(){return this.rollFactorParameter.get()},set:function(e){this.rollFactorParameter.set(e)}},{key:"getJson",value:function(){var e=Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return e.rollFactor=this.rollFactor,e.mode=this.mode,e=this.saveParameterToJson(e,"rollFactorParameter",this.rollFactorParameter),e=this.saveParameterToJson(e,"modeParameter",this.modeParameter)}},{key:"fromJson",value:function(e){Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e),this.mode=e.mode,this.rollFactor=e.rollFactor,this.loadParameterFromJson(e,"rollFactorParameter",this.rollFactorParameter),this.loadParameterFromJson(e,"modeParameter",this.modeParameter)}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson()),t}}]),n}(l.a);t.a=p},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var r="MASTER",a="SENDS_ONLY"},function(e,t,n){"use strict";n.d(t,"d",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"a",function(){return o});var r=1,a=2,i=3,o=5},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i});var r="ALL",a="COMPUTER_KEYBOARD",i="CUSTOM"},function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"d",function(){return o});var r="LFO",a="PLANAR_SHAPSHOTS",i="JAKI_PARAMS",o={JAKI_PARAMS:"jakiParamsComponent",PLANAR_SNAPSHOTS:"snapshotComponent",JAKI_FIGURES:"figuresComponent"}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var r="POST_FX",a="PRE_FX"},function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return a});n(42),n(56),n(20),n(44);var r=function(e,t,n,r){var a=e.sequencerEngine,o=a.state,s=e.volumeParameter;if(!e.patterns[t])return e.setVolume(n,!0,!0);var c;e.patterns[t].volume;return o.mix.isRecordingMix?i(o,s)||(c=e.setVolume(n,!0,!0,r)):o.mix.isPlayingMix&&(i(o,s)||s.mixAutomation.hasEventsAfterStep(a.trackStep))||(c=e.setVolume(n,!0,!0,r)),c},a=function(e,t,n,r){var a,o=e.state;if(t.isMapped){var s=t.isMapped.getInitialValueForParameter(t);void 0!==t.patternToValue[n]?t.patternToValue[n]=s:t.unlockedValue=s}(t.automatable&&(o.mix.isRecordingMix?i(o,t)||(a=t.updateRedux(!0,r)):o.mix.isPlayingMix&&t.mixAutomation.hasEventsAfterStep(e.trackStep)||(a=t.updateRedux(!0,r))),t.isMapped)&&t.isMapped.clearParameter(t);return a},i=function(e,t){return e.automation.parameterSliderDown.includes(t)}},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56);!function(e){var t=e.isNFT?"recorderWorker.js":"../recorderWorker.js",n=function(e,n){var r=n||{},o=r.bufferLen||256,s=r.numChannels||2;this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,o,s,s);var c=new Worker(r.workerPath||t);c.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:s}});var u,l,f=!1,h=!0,d=null,p=0;this.node.onaudioprocess=function(e){if(f){var t=0;if(null!=l){if(h){var n=l-p;if(p=this.context.currentTime,(t=Math.floor(n*this.context.sampleRate)-120)<0||t>o)return}l=null}if(null!==d)this.context.currentTime-d>=0&&(d=null,f=!1);for(var r=[],a=0;a<s;a++){var i=e.inputBuffer.getChannelData(a);t>0&&(i=i.subarray(t)),r.push(i)}c.postMessage({command:"record",buffer:r})}},this.terminate=function(){c.terminate()},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])},this.record=function(e){void 0!==e?(l=e,h=!0):(l=this.context.currentTime,h=!1),f=!0,d=void 0},this.stop=function(e){d=void 0!==e?e:(new Date).getTime()},this.clear=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(new Date).getTime();l=e,c.postMessage({command:"clear"})},this.getBuffer=function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,u=function(e){n=e},e.abrupt("return",new Promise(function(e){c.postMessage({command:"getBuffer"});var t=setInterval(function(){n&&(e(n),clearInterval(t))},100)}));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),this.exportWAV=function(e,t){if(u=e||r.callback,t=t||r.type||"audio/wav",!u)throw new Error("Callback not set");c.postMessage({command:"exportWAV",type:t})},c.onmessage=function(e){var t=e.data;u(t)},e.connect(this.node);var v=this.context.createGain();v.gain.value=0,this.node.connect(v),v.connect(this.context.destination)};n.forceDownload=function(t,n){var r=(e.URL||e.webkitURL).createObjectURL(t),a=e.document.createElement("a");a.href=r,a.download=n||"output.wav";var i=document.createEvent("Event");i.initEvent("click",!0,!0),a.dispatchEvent(i)},e.Recorder=n}(window)},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(6),u=n.n(c);function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}new u.a.Time("16n");t.a=function(e){return function(e){Object(i.a)(n,e);var t=l(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"setupSlide",value:function(){this.slideEnvelope=new u.a.ScaledEnvelope({attack:.1,decay:1e-4,sustain:1,release:1e-5,curve:"linear"}),this.slideEnvelope._releaseCurve="linear",this.slideEnvelope.connect(this.detuneSignal)}},{key:"triggerSlide",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=0,i=0,o=void 0!==this.lastTranspose?this.lastTranspose:e;r&&(void 0!==this.lastSlideTranspose?(a=this.lastSlideMax,i=100*(e-o)):i=100*(e-o)),this.slideEnvelope.min=a,this.slideEnvelope.max=i;var s=n;this.slideEnvelope.attack=s,t&&!isNaN(t)&&this.slideEnvelope.triggerAttack(t),r&&(this.lastSlideMax=i,this.lastSlideTranspose=e)}},{key:"releaseSlide",value:function(e){this.slideEnvelope.min=0,this.slideEnvelope.triggerRelease(e?Math.max(0,e-1e-4):void 0)}},{key:"clearSlide",value:function(){this.lastSlideTranspose=void 0,this.lastSlideMax=void 0,this.releaseSlide(u.a.Master.context.currentTime+.01)}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(1842),a=n.n(r),i=(new(window.AudioContext||window.webkitAudioContext),function(e){try{return a()(e)}catch(t){return console.log("error detecting bpm"),128}})},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=c(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).attributes={},e.attributeCallbacks={},e.defaultAttributes={},e}return Object(a.a)(n,[{key:"newAttribute",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;this.attributes[e]=t,this.attributeCallbacks[e]=n,this.defaultAttributes[e]=t,n&&t&&n(t)}},{key:"setAttribute",value:function(e,t){this.attributes[e]=t,this.attributeCallbacks[e]&&this.attributeCallbacks[e](t)}},{key:"getAttributesJson",value:function(){var e={};for(var t in this.attributes)this.attributes[t]!==this.defaultAttributes[t]&&(e[t]=this.attributes[t]);if(0!==Object.keys(e).length)return e}},{key:"loadAttributesFromJson",value:function(e){if(e.attributes)for(var t in e.attributes)this.setAttribute(t,e.attributes[t])}}]),n}(e)}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(372),o=(n(6),n(123)),s=function(){function e(t,n,a,s,c){Object(r.a)(this,e),this.store=t.store,this.sequencerEngine=t,this.context=(c||new o.a).forLFOTrack(this,n).forSubSequence(n.subSequence),this.number=s,this.lfo=new i.a(t,a,(new o.a).forLFOTrack(this,n),s),this.lfo.lfoMin=-100,this.lfo.lfoMax=100}return Object(a.a)(e,[{key:"id",get:function(){return this.lfo.id}},{key:"start",value:function(e){this.lfo.start(e)}},{key:"stop",value:function(){this.lfo.stop()}},{key:"getName",value:function(){return"LFO "+this.number}},{key:"getJson",value:function(){return this.lfo.getJson()}}]),e}();t.a=s},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),o=n.n(i),s=n(178),c=n(182),u=new o.a.Time("16n"),l=function(){function e(t,n,a,i,s){var c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;Object(r.a)(this,e),this.sequencerEngine=i,this.track=t,this._velocity=c,this.startTime=o.a.Master.context.currentTime,this.currentStep=i.getCurrentStep(a,t),this.currentGlobalStep=i.lastTrackStep,this.currentStepUnquantized=i.trackStepReal,this.ogCurrentStepUnquantized=this.currentStepUnquantized,this.currentStepTime=i.currentStepTime||o.a.Master.context.currentTime,t.subSequence.isTrack||(this.currentStepUnquantized=this.track.getPatternStep(this.currentStepUnquantized)),this.currentStep=this.track.getPatternStep(this.currentStep),this.currentGlobalStep=this.track.getPatternStep(this.currentGlobalStep),this.quantized=s,this.trackNumber=t?t.trackNumber:0,this.sliceNumber=n,this.resolution=a,this.rolling=!!t&&t.rolling}return Object(a.a)(e,[{key:"velocity",get:function(){return null===this._velocity?this.track.trackData.velocity:this._velocity}},{key:"getDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.quantized,t=o.a.Master.context.currentTime,n=void 0,r=void 0,a=u.toMilliseconds()/1e3;if((void 0===this.currentStepTime||Math.abs(this.currentStepTime-this.startTime)>a)&&e){var i=Math.max(this.currentGlobalStep,0);n=(r=(this.sequencerEngine.lastTrackStep-i)/2)*u.toMilliseconds()}else r=(n=new o.a.Time(t).toMilliseconds()-new o.a.Time(e?this.currentStepTime:this.startTime).toMilliseconds())/u.toMilliseconds();return{duration:n,durationSixteenths:r}}},{key:"record",value:function(e,t,n){t=t||this.track,n=n||t.trackData.transpose,e=e||t.sequencerEngine;var r=this.getDuration(),a=r.duration,i=r.durationSixteenths,c=(new o.a.Time(this.startTime).toMilliseconds()-new o.a.Time(this.currentStepTime).toMilliseconds())/new o.a.Time("32n").toMilliseconds();if(this.quantized){c=Math.max(0,c);var u=this.currentStepUnquantized+c;u=this.resolution.transformStepAtResolution2(u,s.a.baseResolution),u=Math.round(u),t.subSequence.isTrack||(u%=this.track.pattern.length(this.resolution)),isNaN(u)&&(u=0),t.recordHit(u,this.resolution,this.sliceNumber,i,n,this.velocity,this.release)}else{new o.a.Time(this.startTime).toMilliseconds(),new o.a.Time(this.currentStepTime).toMilliseconds(),new o.a.Time("32n").toMilliseconds();if(this.rolling)for(var l=this.getNumberOfRollsForDuration(a,t),f=32/this.resolution.numSteps(),h=this.getDurationOfRollTime(t),d=this.currentStepUnquantized+c;d<=this.currentStepUnquantized+f*l;d+=f){var p=Math.floor(d),v=d-p;t.recordUnquantizedHit(p,this.sliceNumber,h,v,n,this.velocity)}else t.recordUnquantizedHit(this.ogCurrentStepUnquantized,this.sliceNumber,i,c,n,this.velocity,this.release)}}},{key:"getDurationOfRollTime",value:function(e){return this.resolution.getTimeInStep().toMilliseconds()/u.toMilliseconds()}},{key:"getStepsInRollTime",value:function(e){var t=this.resolution,n=t.numSteps()/t.baseResolution,r=t.numSteps();return 32===r?n:48===r?n:16===r?2*n:24==r?2*n:8===r?4*n:12===r?4*n:4===r?8*n:6==r?8*n:null}},{key:"getRollResolution",value:function(e){var t=e.liveEffects.getEffect(c.f),n=this.resolution;return t&&((n=n.getCopy()).resolution*=t.rollFactor),n}},{key:"getNumberOfRollsForDuration",value:function(e,t){return e/this.resolution.getTimeInStep().toMilliseconds()}}]),e}();t.a=l},function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"b",function(){return u}),n.d(t,"c",function(){return l}),n.d(t,"e",function(){return f}),n.d(t,"f",function(){return h}),n.d(t,"d",function(){return d});var r=n(181),a=n(59),i=n(168);function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c="CONNECT_EXISTING",u="CREATE_NEW",l="REPLACE_EXISINTG",f=function(e){var t={},n=[],r=[];for(var s in e){var c,u=[],l=o(e[s]);try{for(l.s();!(c=l.n()).done;){var f=c.value,h=f.node,d=f.type,p=void 0,v=void 0,m=void 0,y=void 0,b=void 0;if(h.zObject&&(h=h.zObject),h.getObjectType){"zmessage"===h.getObjectType()&&(p=h.type,v=h.min,m=h.max,y=h.round,b=h.message),h.getObjectType()===i.a&&(h.getEffectType()===a.c&&n.push(h),h.getEffectType()===a.a&&r.push(h));var g=void 0;h.getObjectType()===i.e&&"subpatch"!==h.name&&(g=h.getJson(!0,!1)),u.push({node:h.getObjectType(),type:d,subType:p,min:v,max:m,round:y,value:b,name:h.name,json:g})}}}catch(O){l.e(O)}finally{l.f()}t[s]=u}return{json:t,midiEffects:n,effects:r}},h=function(e,t,n){if(n){var r=e.findNodeByName(n,!0)[0];if(console.log("OBJ WE FOUND=",r),r&&r.subSequence===e)return"pad"!==n&&r.effect?r:{node:"pad"===n?r.effect.pad:r.effect?r.effect:r,zobject:r}}},d=function(e,t,n,a,i,s){var c={},f=s.subSequence.getRootSubSequence?s.subSequence.getRootSubSequence():s.subSequence,d=[];if(a){var v=a.midiEffects,m=a.effects,y=e.sequencerEngine.getSelectedTrack();if(y){var b,g=o(v);try{for(g.s();!(b=g.n()).done;){var O=b.value,j=y.midiEffects.addEffectJson(O),k=j.effect;j.bulk;d.push(k)}}catch(L){g.e(L)}finally{g.f()}var w,x=o(m);try{for(x.s();!(w=x.n()).done;){var S=w.value,P=y.effectsChain.addEffectJson(S,e.sequencerEngine.tracks,y.trackNumber),E=P.effect;P.bulk;d.push(E)}}catch(L){x.e(L)}finally{x.f()}}}var T=0,A=[],M=[];for(var R in t){var C,N=o(t[R]);try{var I=function(){var n=C.value,a=n.node,o=n.action,v=n.json,m=n.name,y=n.type,b=n.value,g=n.subType,O=n.min,j=n.max,k=n.round;if(o||(o=u),console.log("inbound[key=%s]",R,t[R]),!m||"subpatch"===m)return"continue";var w=void 0;if("zmessage"===a&&g===r.c){var x=e.sequencerEngine.state.windows.windowPositions[e.zObject.id];T+=60;var S=x&&x.x+T,P=x&&Math.max(0,x.y-60);w={node:f.createZMessage(S,P,g)},c[w.node.id]={x:S,y:P}}else{var E=d.find(function(e){return e.name===m});if(E)w=E;else if(o==u){if("pad"===m)return"continue";w=f.createZObject(1,1,m),i&&w.hide(),v&&w.fromJson(v,!0,void 0,!1),c[w.id]=p(s,w,M),M.push(c[w.id]),w.effect&&(c[w.effect.id]=c[w.id]),d.push(w)}else w=h(f,a,m),console.log("finding actualNode=",w,a,m),w&&o===l&&v&&w.fromJson(v,!0,void 0,!1,void 0,{})}if(!w)return"continue";if(w.effect){var N=e.inlets[R]?e:e.zObject,I=w.outlets[y]?w:w.effect;N.connectInlet(R,I,y)}else e.connectInlet(R,w.node||w,y);void 0!==b&&w&&w.node&&(w.node.min=O,w.node.max=j,w.node.round=k,w.node.text=parseFloat(b),w.node.storedMessage=parseFloat(b),A.push(w.node))};for(N.s();!(C=N.n()).done;)I()}catch(L){N.e(L)}finally{N.f()}}for(var q in console.log("OUTBOUND=",n),n){console.log("ob key=",q,n[q],n);var _,D=o(n[q]);try{var F=function(){var t=_.value,a=t.name,o=t.action,s=t.node,p=t.type,v=t.subType,m=t.json;if(console.log("outbound[%s]=",q,n[q]),o||(o=u),!a||"subpatch"===a)return"continue";var y=void 0;if("zmessage"===s&&v===r.c)y={node:f.createZMessage(void 0,void 0,v)};else{var b=d.find(function(e){return e.name===a});if(b)y=b;else if(console.log("OUTBOUND action=",o,a),o===u){if("pad"===a)return"continue";(y=h(f,s,a))||(y=f.createZObject(1,1,a)),m&&y.fromJson(m,!0),i&&y.hide(),c[y.id]={x:1,y:1},d.push(y)}else y=h(f,s,a),o===l&&m&&y.fromJson(m,!0,void 0,!1)}var g=e.outlets[q]?e:e.effect&&e.effect.outlets[q]?e.effect:e.zObject;y&&y.effect?(y.inlets[p]?y:y.effect).connectInlet(p,g,q):y.node?y.node.connectInlet(p,g,q):y.connectInlet(p,g,q)};for(D.s();!(_=D.n()).done;)F()}catch(L){D.e(L)}finally{D.f()}}return A.forEach(function(e){e.execute()}),setTimeout(function(){A.forEach(function(e){e.execute()})},1e3),c},p=function(e,t,n){var r=e.windowPosition,a=t.width,i=void 0===a?100:a,o=t.height,s=void 0===o?400:o,c=n[n.length-1],u={x:c?c.x+c.width+100:r.x-300,y:r.y-s-20,width:i,height:s};return console.log("position generated=",u),u}},,,,,function(e,t,n){"use strict";n.d(t,"i",function(){return r}),n.d(t,"h",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"e",function(){return o}),n.d(t,"f",function(){return s}),n.d(t,"b",function(){return c}),n.d(t,"d",function(){return u}),n.d(t,"g",function(){return l}),n.d(t,"a",function(){return f});var r="PADS",a="KEYBOARD",i=118,o=119,s=117,c=116,u=115,l=64,f=1},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={name:"floor",gen:function(){var e=r.getInputs(this);return isNaN(e[0])?"( ".concat(e[0]," | 0 )"):0|e[0]}};t.default=function(e){var t=Object.create(a);return t.inputs=[e],t}},function(e,t,n){"use strict";n.r(t);var r=n(112),a=n(970),i=n(202),o=(n(224),n(318),{type:"triangular",length:1024,alpha:.15,shift:0,reverse:!1});t.default=function(e){var t=Object.assign({},o,e),n=new Float32Array(t.length),s=t.type+"_"+t.length+"_"+t.shift+"_"+t.reverse+"_"+t.alpha;if("undefined"===typeof r.globals.windows[s]){for(var c=0;c<t.length;c++)n[c]=a[t.type](t.length,c,t.alpha,t.shift);!0===t.reverse&&n.reverse(),r.globals.windows[s]=i(n)}var u=r.globals.windows[s];return u.name="env"+r.getUID(),u}},function(e,t,n){"use strict";n.r(t);var r=n(112),a={basename:"ifelse",gen:function(){for(var e=this.inputs[0],t=r.getInput(e[e.length-1]),n="  var ".concat(this.name,"_out = ").concat(t,"\n"),a=0;a<e.length-2;a+=2){var i,o=a===e.length-3,s=r.getInput(e[a]),c=e[a+1],u=void 0,l=void 0;"number"===typeof c?(u=c,l=null):void 0===r.memo[c.name]?(r.startLocalize(),r.getInput(c),l=(u=r.endLocalize())[0],u="  "+(u=u[1].join("")).replace(/\n/gi,"\n  ")):(u="",l=r.memo[c.name]),i=null===l?"  ".concat(this.name,"_out = ").concat(u):"".concat(u,"  ").concat(this.name,"_out = ").concat(l),0===a&&(n+=" "),n+=" if( ".concat(s," === 1 ) {\n").concat(i,"\n  }"),n+=o?"\n":" else"}return r.memo[this.name]="".concat(this.name,"_out"),["".concat(this.name,"_out"),n]}};t.default=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=Object.create(a),o=Array.isArray(t[0])?t[0]:t;return Object.assign(i,{uid:r.getUID(),inputs:[o]}),i.name="".concat(i.basename).concat(i.uid),i}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a=n(317).default,i={gen:function(){r.requestMemory(this.memory);var e="  var ".concat(this.name," = memory[").concat(this.memory.value.idx,"]\n  if( ").concat(this.name," === 1 ) memory[").concat(this.memory.value.idx,"] = 0      \n      \n");return r.memo[this.name]=this.name,[this.name,e]}};t.default=function(e){var t=Object.create(i),n=Object.assign({},{min:0,max:1},e);t.name="bang"+r.getUID(),t.min=n.min,t.max=n.max;var o="worklet"===r.mode;return!0===o&&(t.node=null,a.register(t)),t.trigger=function(){!0===o&&null!==t.node?t.node.port.postMessage({key:"set",idx:t.memory.value.idx,value:t.max}):r.memory.heap[t.memory.value.idx]=t.max},t.memory={value:{length:1,idx:null}},t}},function(e,t,n){"use strict";n.r(t);var r=n(112),a={basename:"neq",gen:function(){var e,t=r.getInputs(this);return e="  var ".concat(this.name," = (").concat(t[0]," !== ").concat(t[1],") | 0\n\n"),r.memo[this.name]=this.name,[this.name,e]}};t.default=function(e,t){var n=Object.create(a);return Object.assign(n,{uid:r.getUID(),inputs:[e,t]}),n.name="".concat(n.basename).concat(n.uid),n}},function(e,t,n){"use strict";n.r(t);var r=n(112),a={basename:"and",gen:function(){var e,t=r.getInputs(this);return e="  var ".concat(this.name," = (").concat(t[0]," !== 0 && ").concat(t[1]," !== 0) | 0\n\n"),r.memo[this.name]="".concat(this.name),["".concat(this.name),e]}};t.default=function(e,t){var n=Object.create(a);return Object.assign(n,{uid:r.getUID(),inputs:[e,t]}),n.name="".concat(n.basename).concat(n.uid),n}},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return o});var r=n(11),a=n(1),i=function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.state.spatial.presentationMode;var t=e.state.windows.selectedElements,n=e.state.windows,r=n.windowPositions,i=n.presentationWindowPositions,o={};for(var s in t){var c=e.idToObject[s].presentationMode&&i[s]||r[s];o[s]=Object(a.a)({},c)}return o},o=function(e){var t=Math.min.apply(Math,Object(r.a)(Object.values(e).map(function(e){return e.y})));Math.max.apply(Math,Object(r.a)(Object.values(e).map(function(e){return e.y})));return{x:{min:Math.min.apply(Math,Object(r.a)(Object.values(e).map(function(e){return e.x}))),max:Math.max.apply(Math,Object(r.a)(Object.values(e).map(function(e){return e.x})))},y:{min:t,max:t}}}},function(e,t,n){},,function(e,t,n){"use strict";var r=n(1),a=n(32),i=n(4),o=n(5),s=n(10),c=n(7),u=n(8),l=n(2),f=n(167),h=n(330),d=n(384),p=n(653),v=n(457),m=n(114),y=function(e,t){return(e%t+t)%t},b=function(){var e=[],t=void 0;return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=r[0],o=r[1],s=r[2],c=r[3];if(!i)return Object(m.w)(!0);t!==o&&(e=[]),t=o;var u=i.transpose,l=u;if(e.includes(y(u-1))&&(l=u-1),e.includes(y(u+1,12))&&(l=u+1),e.push(y(l,12)),u===l)return Object(m.w)(!0);var f=c.getStep(i);return f.transpose=l,Object(m.R)({stepData:f,time:s,stepNumber:o})}},g=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=r[0],o=r[1],s=r[2],c=r[3];if(!i)return Object(m.w)(!1);var u=c.getStep(i);return u.slide=!0,u.transpose=i.transpose+m.A.apply(void 0,[e].concat(r)),void 0!==t&&(u.duration=m.A.apply(void 0,[t].concat(r))),Object(m.R)([{stepData:i,stepNumber:o,time:s},{stepData:u,stepNumber:o,time:s}])}},O=n(150),j=n(11),k=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=m.A.apply(void 0,[e].concat(n));if(!n[3])return[0];var i=n[3].track.subSequence,o=i.tracks[a%i.tracks.length].pattern,s=[];for(var c in o.stepBucketsMatrix){var u=o.stepBucketsMatrix[c];for(var l in u.steps)s=[].concat(Object(j.a)(s),Object(j.a)(u.steps[l].getPolyphony().map(function(e){return e.transpose})))}return s}},w=n(654),x=n(458),S=n(170),P=n(459),E=n(214),T=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return m.A.apply(void 0,[e].concat(r))||m.A.apply(void 0,[t].concat(r))}},A=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return m.A.apply(void 0,[e].concat(r))&&m.A.apply(void 0,[t].concat(r))}},M=n(151);Object(M.a)("invert",{octaves:""},"inverts notes by an octave (high notes go down/low notes up)");var R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=0,n=0;return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];var o=a[0];if(!o)return Object(m.w)(!1);t+=o.transpose,n++;var s=m.A.apply(void 0,[e].concat(a));return o.transpose<=t/n?Object(v.a)(12*s).apply(void 0,a):Object(v.a)(-12*s).apply(void 0,a)}},C=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var i=r[0],o=r[1],s=r[2];if(!i)return Object(m.w)(!1);var c=m.A.apply(void 0,[e].concat(r)),u=n.map(function(e){return m.A.apply(void 0,[e].concat(r))});return Object(m.R)({stepData:i,stepNumber:o,time:s,graphics:{type:c,arg:u}})}},N=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return C.apply(void 0,["DRAW"].concat(t))},I=function(e){return C("ERASE",e)};function q(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(M.a)("augment",{delayTime:"",transpose:"",everyTime:"",scriptFunction:"optional",hold:""},"augmentation to theme");var D=function(e,t,n,r,a){var i=[],o=0,s=void 0;return function(){for(var c=arguments.length,u=new Array(c),l=0;l<c;l++)u[l]=arguments[l];var f=u[0],h=u[1],d=u[2],p=u[3];0!==s&&0===h&&(s=void 0);var v=[];if(f&&(s!==h&&void 0!==s&&o++,s=h,void 0===n||o%m.A.apply(void 0,[n].concat(u))===0)){var y=m.A.apply(void 0,[e].concat(u))+1,b={stepData:f,time:d-p.currentTime,delay:y,reference:{}};v.push(b),i.push(b)}var g,O=[],k=[],w=q(i);try{for(w.s();!(g=w.n()).done;){var x=g.value;if(x.delay--,x.delay<=0){var S=p.getStep(x.stepData);if(m.A.apply(void 0,[a].concat(u))?S.duration=1/0:S.duration*=2,void 0!==t){var P=m.A.apply(void 0,[t,S].concat(Object(j.a)(u.slice(1))));S.transpose+=P}var E={stepData:S,time:x.time+p.currentTime,stepNumber:h,reference:x.reference};x.reference.transpose=S.transpose,r?O.push(Object(m.K)(Object(m.R)(E),r)):O.push(Object(m.R)(E))}else k.push(x)}}catch(T){w.e(T)}finally{w.f()}return i=k,f&&(f.delays=v),O.push(Object(m.R)({stepData:f,time:d,stepNumber:h})),m.D.apply(void 0,O)}},F=n(460),L=n(260);Object(M.a)("search",{name:"tag or name to search for"},'Filters out triggers to only tracks of given tag or name (ex: search("kick") returns only kick triggers');var B=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=m.A.apply(void 0,[e].concat(n)),i=n[0];n[1],n[2],n[3];if(i&&i.track){var o=i.track;if(o.instrument){if(o.getName().toLowerCase().includes(a.toLowerCase()))return Object(m.w)(!0)}else if(o.sample.tags.some(function(e){return e.toLowerCase().includes(a.toLowerCase())}))return Object(m.w)(!0)}return Object(m.w)(!1)}};Object(M.a)("loop",{length:"how long to loop",mode:"mode from 0-1"},"Loops triggers at a loop-size. Modes are 0=off 0.5=record 1=play");var z=function(e,t){var n=[],a=0;return function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];var c=o[2],u=o[1],l=o[3].currentTime,f=Math.round(m.A.apply(void 0,[e].concat(o)));switch(function(e){return e<.33?0:e<.66?.5:1}(m.A.apply(void 0,[t].concat(o)))){case.5:return function(e,t,r){n.push({stepData:e,time:t})}(o[0],c-l),Object(m.w)(!0);case 1:var h=n.length-f,d=a++%f,p=n[h+d];return p.stepData?Object(m.R)(Object(r.a)({},p,{stepNumber:u,time:c+p.time})):Object(m.w)(!1);default:return Object(m.w)(!0)}}},J=n(656),V=n(6),H=n.n(V),U=n(213),G=new H.a.Time("32n"),W=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r in t)Array.isArray(t[r])&&(t[r]=U.a.apply(void 0,Object(j.a)(t[r])));var a=U.a.apply(void 0,t);return t[0]&&Array.isArray(t[0])&&(a=U.a.apply(void 0,Object(j.a)(t[0]))),function(e,t,n,r){var i=r.currentTime;return i+=G*Object(m.A)(a,e,t,n,r),Object(m.R)({stepData:e,stepNumber:t,time:i})}},K=function(e){return function(t,n,r,a){return n%(32/e)===0?Object(m.w)(!0):Object(m.w)(!1)}},Q=n(462),Z=n(291),Y=n(331),$=n(652);Object(M.a)("once",{fn:"Function to run once",when:"When to run"},"Runs the function once, after a certain number of triggers (default of 0)");var X=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return a[0]&&n++===m.A.apply(void 0,[t].concat(a))?m.A.apply(void 0,[e].concat(a)):Object(h.b)(a)}},ee=function(){var e=0;return function(){return e++}},te=n(461),ne=new H.a.Time("32n").toSeconds();Object(M.a)("stretch",{amount:"Amount we wish to stretch notes"},"Streches patterns so they take longer to complete");var re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t={};return function(n,a,i,o){o.track.length;var s=Object(m.A)(e,n,a,i,o);if(1===s)return Object(m.R)({stepData:n,stepNumber:a,time:i});var c=a*s,u=i-o.currentTime;if(n){var l=(c-Math.floor(c))*ne;t[Math.floor(c)]={stepData:n,time:u+l}}if(t[a]){var f=Object(m.R)(Object(r.a)({},t[a],{stepNumber:a,time:i+t[a].time}));return delete t[a],f}return Object(m.R)({stepNumber:a,time:i})}},ae=(n(23),n(165)),ie=n(259),oe=n(193),se=n(136),ce=new(n(33).a),ue=function(e,t){var n=void 0;return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];a[0],a[1],a[2];var o=m.A.apply(void 0,[t].concat(a));if(!n||o!==n){var s=m.A.apply(void 0,[e].concat(a)),c=m.A.apply(void 0,[t].concat(a));Object(se.c)(s,c),n=c}return Object(m.w)(!0)}},le=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];var o=a[0];a[1],a[2];if(o||!n){var s=m.A.apply(void 0,[e].concat(a)),c=m.A.apply(void 0,[t].concat(a));Object(se.c)(s,c)}return Object(m.w)(!0)}};Object(M.a)("receive",{type:"",fn:"",skipEmpty:""},"Reads messages of given type returning the values");var fe=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=Object(ie.a)(e,!0),i=void 0;return function(){for(var e=arguments.length,o=new Array(e),s=0;s<e;s++)o[s]=arguments[s];var c=o[0]&&o[0].track?o[0]:void 0;if(c||!n){var u=a();if(t){if(u.length>0&&void 0===c&&r){var l=o[3],f=l.getStep(ce);f.track=l.track,o=[f].concat(Object(j.a)(o.slice(1)))}return u.map(function(e){return"function"===typeof t?m.A.apply(void 0,[t(e)].concat(Object(j.a)(o))):t})[0]||Object(h.b)(o)}var d=0===u.length?i:u;return u.length>0&&(i=u),d[0]}}},he=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(oe.f)("[0]"),n=Object(ie.a)(e,!0),r=void 0;return function(){for(var e=n(),a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];var s=(0===e.length?r:e[0])||m.A.apply(void 0,[t].concat(i));return e.length>0&&(r=e[0]),s}},de=n(651),pe=n(841),ve=new H.a.Time("16n");Object(M.a)("expChop",{numChops:"number of chopped notes to create",exponent:"exponent to use to place notes"},"Chops note into several triggers with exponential placement");var me=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=m.A.apply(void 0,[e].concat(r)),o=m.A.apply(void 0,[t].concat(r)),s=r[0],c=r[1],u=r[2];if(!s)return Object(m.w)(!1);for(var l=s.duration,f=[],h=ve.toSeconds()*l,d=0;d<i;d++){var p=u+Math.pow(d,o)/Math.pow(i,o)*h;f.push({stepData:s,time:p,stepNumber:c})}return Object(m.R)(f)}};Object(M.a)("range",{len:"The length of the list to be generated",min:"The min value to be used as the first element in the list",max:"The max value to be used as the last element in the list"},"Returns a list of a certain length rising from min to max");var ye=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];var o=m.A.apply(void 0,[t].concat(a)),s=m.A.apply(void 0,[n].concat(a)),c=m.A.apply(void 0,[e].concat(a));return Array(e).fill(0).map(function(e,n){return o+n*(s-t)/c})}},be=n(842),ge=n(290),Oe=n(545),je=n(843),ke=n(145),we=function(e){return function(t,n,r,a){if(!t)return Object(m.w)(!0);var i=a.copyTrigger(new ke.a(t,r,n),!0),o=Object(m.A)(e,t,n,r,a),s=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:262,r=arguments.length>3?arguments[3]:void 0;n=new H.a.Frequency(n);var a=Math.floor(e/12),i=e<0?(12-Math.abs(e)%12)%12:e%12,o=r(t[Math.floor(t.length*i/12)]),s=n.transpose(12*a)._val;return Object(je.a)(s*o)}(t.transpose,o,void 0,function(e){return Object(m.A)(e,t,n,r,a)});return i.stepData.transpose=s,Object(m.R)({stepData:i.stepData,stepNumber:n,time:r})}},xe=n(289);Object(M.a)("acc",{parameterName:"The parameter to accumulate",value:"The value added to the accumulator on each trigger",limit:"The value at which the accumulator will reset to 0"},"Adds an accumulated value to a parameter every trigger, adding the passed-value to the accumulated value. When it reaches the limit, the accumulator resets to 0.");var Se=function(e,t,n){var r=0;return function(a,i,o){if(void 0===a)return Object(m.w)(!1);var s=Object(m.A)(e,a,i,o),c=a[s];return(r+=Object(m.A)(t,a,i,o))>Object(m.A)(n,a,i,o)&&(r=0),Object(m.L)(s,c+r)}};function Pe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var Ee=n(1678).Parser,Te=function(e){Object(c.a)(n,e);var t=Pe(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,"User Script",e)).logs=[],r.code="",r.clear(),r.numberOfOutputs=2,r}return Object(o.a)(n,[{key:"isRealTime",value:function(){return!0}},{key:"documentation",get:function(){return["Write scripts for transforming triggers, and create your own custom midi-effects."]}},{key:"getContext",value:function(){var e,t=this;return e={setMacro:m.M,env1:m.s,expChop:me,search:B,sparse:J.a,once:X,time:W,and:A,or:T,resolution:K,env2:m.t,engine:this.track.sequencerEngine,env3:m.u,hand:oe.a,rules:S.t,env4:m.v,doc:M.a,choke:m.o,noDissonance:b,alt:U.a,r_alt:U.d,invert_chord:F.c,degree_chord:F.a,scale_degree:F.d,t_operator:E.q,dot:O.c,dash:O.b,when:S.u,before:S.r,otherwise:S.s,t_syncopate:x.d,t_leaf:E.l,t_transform_leaf:E.w,t_nth:E.p,t_swap:E.u,t_replace:E.r,t_accent:E.f,t_staccato:E.t,t_every:P.c,scl:F.e,t_put_scale:F.f,isLeaf:E.c,t_map:E.n,t_generate:x.b,t_append:E.g,t_cond:oe.c,t_splice:E.s,t_transform:E.v,t_multiply:E.o,t_keep_leaves:E.k,isRest:E.d,isStaccato:E.e,isAccent:E.b,jaki_accent:w.b,altn:U.b,t_reverse:L.m,t_variation:P.d,play_and_vary:P.b,tidal:oe.e,j_tidal:oe.b,tparse:oe.f,density:Oe.a,decisions:x.a,augment:D,atranspose:v.a,gte:ge.b,lte:ge.c,every:U.c,lazy:m.A,nth:L.j,scale:we,t_insert:E.h,t_interleave:E.i,t_interleave_before:E.j,car:L.c,t_send:ue,t_receive:he,cdr:L.d,loop:z,len:L.g,t_len:E.m},Object(a.a)(e,"t_every",P.c),Object(a.a)(e,"t_double",p.a),Object(a.a)(e,"isNewCycle",P.a),Object(a.a)(e,"sublist",L.l),Object(a.a)(e,"t_sublist",L.n),Object(a.a)(e,"t_print",oe.d),Object(a.a)(e,"slide",g),Object(a.a)(e,"concat",L.e),Object(a.a)(e,"apply_rules",w.a),Object(a.a)(e,"cat",L.e),Object(a.a)(e,"t_altn",U.f),Object(a.a)(e,"t_alt",U.e),Object(a.a)(e,"list",L.h),Object(a.a)(e,"l",L.h),Object(a.a)(e,"vectorAdd",L.o),Object(a.a)(e,"append",L.b),Object(a.a)(e,"map",L.i),Object(a.a)(e,"stretch",re),Object(a.a)(e,"floor",Math.floor),Object(a.a)(e,"round",Math.round),Object(a.a)(e,"draw",N),Object(a.a)(e,"erase",I),Object(a.a)(e,"random",Math.random),Object(a.a)(e,"print",$.a),Object(a.a)(e,"acc",Se),Object(a.a)(e,"reverse",m.I),Object(a.a)(e,"s",m.K),Object(a.a)(e,"pipe",ae.a),Object(a.a)(e,"set",m.L),Object(a.a)(e,"filter",m.w),Object(a.a)(e,"trigger",m.R),Object(a.a)(e,"r_trig",h.a),Object(a.a)(e,"harmonize",te.b),Object(a.a)(e,"chord",te.a),Object(a.a)(e,"rconcat",L.k),Object(a.a)(e,"multiply",Y.c),Object(a.a)(e,"add",Y.a),Object(a.a)(e,"mod",Y.b),Object(a.a)(e,"t_simplify",x.c),Object(a.a)(e,"counter",ee),Object(a.a)(e,"start",m.N),Object(a.a)(e,"fetchMelody",k),Object(a.a)(e,"poly",be.a),Object(a.a)(e,"receive",fe),Object(a.a)(e,"grab",m.y),Object(a.a)(e,"on",m.C),Object(a.a)(e,"patternSwitch",m.F),Object(a.a)(e,"send",le),Object(a.a)(e,"grabTime",m.z),Object(a.a)(e,"steps",m.O),Object(a.a)(e,"gate",xe.b),Object(a.a)(e,"range",ye),Object(a.a)(e,"shift",xe.d),Object(a.a)(e,"beat",xe.a),Object(a.a)(e,"notes",m.B),Object(a.a)(e,"rolling",m.J),Object(a.a)(e,"invert",R),Object(a.a)(e,"cond",m.q),Object(a.a)(e,"get",m.x),Object(a.a)(e,"repeat",xe.c),Object(a.a)(e,"prob",m.G),Object(a.a)(e,"randomSelect",m.H),Object(a.a)(e,"threshold",de.a),Object(a.a)(e,"transpose",m.Q),Object(a.a)(e,"strum",te.c),Object(a.a)(e,"t_trigger",Q.a),Object(a.a)(e,"triggerAttack",Q.b),Object(a.a)(e,"triggerRelease",Q.d),Object(a.a)(e,"triggerAttackRelease",Q.c),Object(a.a)(e,"load",function(e){return t.loadScript(e)}),Object(a.a)(e,"library",function(e){return t.loadScript(e,"")}),Object(a.a)(e,"p",m.D),Object(a.a)(e,"switchOutput",m.P),Object(a.a)(e,"vel",m.S),Object(a.a)(e,"delay",pe.a),Object(a.a)(e,"dur",m.r),Object(a.a)(e,"chop",m.p),Object(a.a)(e,"altList",L.a),Object(a.a)(e,"f3",Object(oe.f)(". -")),Object(a.a)(e,"f4",Object(oe.f)(". . -")),Object(a.a)(e,"f5a",Object(oe.f)(". . . -")),Object(a.a)(e,"f5b",Object(oe.f)("- . -")),Object(a.a)(e,"f5c",Object(oe.f)(". - -")),Object(a.a)(e,"fig",d.a),Object(a.a)(e,"t_transform_fig",d.b),Object(a.a)(e,"before",S.r),Object(a.a)(e,"when",S.u),Object(a.a)(e,"after",S.o),Object(a.a)(e,"FLAM",S.d),Object(a.a)(e,"LEGATO",S.e),Object(a.a)(e,"ACCENT",S.a),Object(a.a)(e,"STACCATO",S.m),Object(a.a)(e,"PIANISSIMO",S.h),Object(a.a)(e,"REST",S.k),Object(a.a)(e,"PIANO",S.i),Object(a.a)(e,"DOUBLE",S.c),Object(a.a)(e,"knob",function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16;t.newVar(e,n,r,a);return function(){return t[e+"Parameter"].get()}}),e}},{key:"evalWithContext",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pipe",n="";try{var r=e.split(";"),a=r[r.length-1],i=r.slice(0,r.length-1).join(";");return n=i+";\n\n\n "+t+"("+a+")",new Function("with(this) { "+i+"; return "+t+"("+a+")}").call(this.getContext())}catch(u){var o=u.stack.indexOf("<anonymous>:"),s=u.stack.slice(o+"<anonymous>:".length).split(":")[0],c=parseInt(s);if(isNaN(c))try{Ee.parse(n)}catch(l){this.syntaxErrorLine=l.loc.line}else this.syntaxErrorLine=c-2;return}}},{key:"loadScript",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"s",n=Object(Z.b)(e),r=this.evalWithContext(n,t);return""===t?r:function(){return r}}},{key:"hasSyntaxError",value:function(e){return void 0===this.evalWithContext(e)}},{key:"eval",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t&&this.freeTidals();var r=this.clearVariables(),a=this.evalWithContext(e);for(var i in void 0===a?this.hasError=!0:(this.myScript=a,this.output(),this.myScript=this.evalWithContext(e),this.hasError=!1,this.code=e),r)this[i+"Parameter"]&&this[i+"Parameter"].copyFrom(r[i],this.track.sequencerEngine);n&&this.freeTidals(),this.updateVariablesRedux()}},{key:"clear",value:function(){this.tidals&&this.tidals.forEach(function(e){return e.clear()}),this.freeTidals()}},{key:"stop",value:function(){Object(s.a)(Object(l.a)(n.prototype),"stop",this).call(this),""!==this.code&&(this.eval(this.code),this.freeTidals())}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(){return Object(r.a)({},Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{expanded:this.expanded,code:this.code})}},{key:"fromJson",value:function(e,t){this.code=e.code,this.expanded=e.expanded,""!==this.code&&(this.eval(this.code),this.freeTidals(),Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t))}}]),n}(f.a);t.a=Te},function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(4),o=n(5),s=n(31),c=n(10),u=n(7),l=n(8),f=n(2),h=n(123),d=n(6),p=n.n(d),v=n(114),m=n(61),y=n(170),b=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=r[0],o=(r[1],v.A.apply(void 0,[e].concat(r))),s=t();if(!s||0===s.filter(function(e){return e}).length)return e(),o;var c=O(i).map(function(e){return g(s,e)}).filter(function(e){return e>-1});if(c.length>0){var u=c[0]+1;return e(),u}return e(),-1}},g=function(e,t){for(var n=0;n<e.length;n++)if(e[n]&&t.type===e[n].type)return n;return-1},O=function(e){var t=[];return e.accent?t.push(y.a):e.piano?t.push(y.i):e.pianissimo?t.push(y.h):t.push(y.j),e.staccato?t.push(y.m):e.legato&&t.push(y.e),e.isGeneratedFromPulse&&t.push(m.c),e.nudgeForward&&t.push(y.g),e.nudgeBackward&&t.push(y.f),t},j=(n(145),n(33),n(167)),k=(n(868),n(134)),w=n(130),x=n(147);function S(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var E=n(20),T=(n(329),function(e,t,n,i){var o,s,c=0;return function(){for(var u=arguments.length,l=new Array(u),f=0;f<u;f++)l[f]=arguments[f];var h=v.A.apply(void 0,[i].concat(l)),d=v.A.apply(void 0,[t].concat(l)),p=v.A.apply(void 0,[n].concat(l)),m=v.A.apply(void 0,[e].concat(l)),y=m.length,b=(l[0],l[1]);if(0===p)return m;if(!(b%y===0)&&o&&m===s)return o;s=m;for(var g=0;g<Math.floor(p);g++)m=[].concat(Object(r.a)(m),Object(r.a)(m.map(function(e){return Object(a.a)({},e,{id:Object(E.uuid)()})})));for(var O=[],j=0;j<m.length;j++){var k=m[j],w=k.type,x=(w.type,w.value,A(m,j,Math.floor(p)));if(0===x.length){Math.floor(p);O.push(Object(a.a)({},k,{transpose:h?k.transpose:null}))}else if(c++%d===0){var S=M(x[0],x[x.length/2-1],x);S.cycleLength=x.length,O.push(S),j+=x.length-1}else O.push(k)}return o=O,O}}),A=function(e,t,n){for(var r=[],a=0;a<8*n&&t+a<e.length;a++)r.push(e[t+a]);if(0===r.length)return[];if(1===r[0].type.value)return[];for(var i=[],o=0,s=0,c=r;s<c.length;s++){var u=c[s],l=u.type,f=l.type,h=l.value;if("."===f)i.push(u);else if("-"===f&&0===h&&u!==r[r.length-1]){var d=r[o+1];i.push(u),i.push(d)}o++}var p=i[4*n-1],v=i[2*n-1];return i.length>=4*n&&("."===p.type.type||1===p.type.value)?i.slice(0,4*n):i>=2*n&&("."===v.type.type||1===v.type.value)?i.slice(0,2*n):[]},M=function(e,t,n){var r=[];if(2===n.length)r.push(Object(a.a)({},e,{cycle:void 0,type:{type:"."}}));else if(4===n.length||8===n.length){var i=n[n.length/2-1];r.push(Object(a.a)({},e,{accent:e.accent||i.accent,cycle:void 0,type:{type:"-",value:0}})),r.push(Object(a.a)({},i,{accent:!1,cycle:void 0,type:{type:"-",value:1}}))}return r},R=n(214),C=(n(459),n(458),n(331),n(460)),N=n(290),I=n(654),q=n(260),_=n(289),D=n(462),F=(n(242),n(869)),L=n(871),B=n(165),z=n(193),J=new p.a.Time("32n"),V=(n(150),n(384),n(993));function H(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var U=function(e){Object(u.a)(n,e);var t=H(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,"Jaki",e)).zObject=r,a.rules=[new L.a(e,Object(s.a)(a)),new L.a(e,Object(s.a)(a)),new L.a(e,Object(s.a)(a)),new L.a(e,Object(s.a)(a))],a.scaleRules=[[]],a.useTidal(),a.freeTidals(),a.jakiParams=new F.a(a.track.subSequence),a.figures=new V.a(a.track.subSequence,a.zObject),a.clear(),a.numberOfOutputs=1,a.newOutlet(w.i),a.newOutlet(w.b),a.newOutlet(w.o),a.newOutlet("figure-change"),a.newOutlet("pulses"),a.pulses=[],a}return Object(o.a)(n,[{key:"addSlot",value:function(){var e=this.tidals.map(function(e){return e.firstAccent});this.useTidal(!0),this.scaleRules.push(this.scaleRules[this.scaleRules.length-1]),this.jakiParams.newSlotParameter(),this.registerContext(),this._restart(e)}},{key:"_restart",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.tidals.map(function(e){return e.firstAccent});this._seedTrigger&&(this.restartFromSeed=!0),this.clear(),this.tidals.forEach(function(t,n){return t.firstAccent=e[n]})}},{key:"clear",value:function(){var e=this;this.tidals&&this.tidals.forEach(function(e){return e.clear()}),this.freeTidals();var t=Object(q.f)(function(){return e.figures._figures});t=Object(_.d)(t,function(){return e.jakiParams.shift1Parameter.get()});var n,i,o=Object(I.b)(t,0,function(){return e.rules[0].rules},void 0,void 0,function(){return e.getRuleTypes(1)}),s=Object(C.e)(t),c=[0],u=function(e,t,n,r){return Object(z.c)(Object(N.a)(t,!0),Object(C.f)(e,s,n,r),Object(C.f)(e,c,void 0,r))},l=function(t,n){return Object(v.K)(Object(D.a)(T(function(e,t,n,i,o){var s=void 0,c=0,u=void 0;0;return function(){for(var l=arguments.length,f=new Array(l),h=0;h<l;h++)f[h]=arguments[h];var d=f[1],p=v.A.apply(void 0,[n].concat(f)),m=d-p,b=v.A.apply(void 0,[o].concat(f)),g=v.A.apply(void 0,[e].concat(f)),O=v.A.apply(void 0,[t].concat(f));if(!b||void 0===p)return g;var j=d-v.A.apply(void 0,[i].concat(f)),k=O.filter(function(e){return"!"===e.when});if(!k)return g;if(0===j||u!==O){var w=(8-m%8)%8/2;w+=d/2%g.length;var P=Object(r.a)(g),E=[];if(u!==O)for(var T=Object(x.a)(w)%4;T<j/2;T++)c++;for(var A=w;A<g.length;A+=4){P[A].isGeneratedFromPulse=!1;var M,R=S(k);try{for(R.s();!(M=R.n()).done;){var C=M.value,N=C.always,I=C.every,q=C.offset;if(c%I===q){Array.isArray(N)||(N=[N]);var _,D=S(N);try{for(D.s();!(_=D.n()).done;){var F=_.value;P[A]=Object(y.q)(Object(a.a)({},P[A]),F)}}catch(L){D.e(L)}finally{D.f()}P[A].isGeneratedFromPulse=!0,E.push(A)}}}catch(L){R.e(L)}finally{R.f()}P[A].pulse=!0,c++}s=P}return u=O,s||g}}(u(function(t,n,r,a){return Object(z.c)(function(){return!1},Object(_.d)(t,function(){return Math.round(n())}),Object(I.b)(Object(_.d)(t,function(){return Math.round(n())}),function(){return 0},e.getRulesForNumber(r),void 0,void 0,function(){return e.getRuleTypes(e.getParam("rule",a,Math.round))}))}(Object(R.x)(t,e.getParam("truncate",n,Math.round)),e.getParam("shift",n,Math.round),e.getParam("rule",n,Math.round),function(){return n}),e.getParam("scale",n),function(){return e.scaleRules[n-1]}),e.getRulesForNumber(e.getParam("rule",n,Math.round)),function(){return e.getPulse()},function(){return e.getCycleStart(n)},e.getParam("pulseDest",n,Math.round)),e.getParam("halveningRate",n,Math.round),e.getParam("halveningDepth",n,Math.round),e.getParam("halveningFill",n,Math.round)),b(function(){return n},e.getParam("routes",n)),function(t){return Object(v.K)(Object(z.b)(t,e.getParam("tempo",n,function(e){return.25*Math.pow(2,Math.round(e))}),e.getParam("triplet",n)),e.swing(n),e.offset(n),e.handleNudge(n),e.handleHand(n))},e.zObject))};this.myScript=Object(B.a)(Object(v.D)(function(t,n){e.pulse=[];var r=s();return r!==e._scale&&(e._scale=r,e.sendMessage(w.i,r)),e.currentScale=s(),e.sendMessage(w.o,e.tidals),Object(v.w)(!1)},(n=Object(R.x)(u(o,this.scale1Parameter,function(){return e.scaleRules[0]},!0),this.getParam("truncate",1,Math.round)),i=1,Object(D.a)(T(u(n,e.getParam("scale",i),function(){return e.scaleRules[i-1]}),e.getParam("halveningRate",i,Math.round),e.getParam("halveningDepth",i,Math.round),e.getParam("halveningFill",i,Math.round)),b(function(){return i},e.getParam("routes",i)),function(t){return Object(v.K)(Object(z.b)(t,e.getParam("tempo",i,function(e){return.25*Math.pow(2,e)}),e.getParam("triplet",i)),e.swing(i),e.offset(i),e.handleNudge(i),e.handleHand(i))},e.zObject)),Object(v.E)(this.tidals.slice(1).map(function(e,t){return l(o,t+2)}))))}},{key:"getRulesForNumber",value:function(e){var t=this,n=[];return function(){return null===e()?n:t.rules[Math.round(e())%t.rules.length].rules}}},{key:"getTrackToRoute",value:function(e){return e}},{key:"getPulse",value:function(e){for(var t=-1,n=0;n<this.tidals.length;n++){var r=n+1;if(this.jakiParams["pulseSource".concat(r,"Parameter")].get()){t=n;break}}if(t>-1)return this.tidals[t].firstAccent}},{key:"getCycleStart",value:function(e){return this.tidals[e-1].lastCycleRestart}},{key:"getRuleTypes",value:function(e){var t=this.pName("rulesToIgnore",e),n=t?t.get():[];return y.l.filter(function(e){return!n.some(function(t){return t.type===e.type})})}},{key:"getParam",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e};return function(){var a=e+t+"Parameter",i=n.jakiParams[a].get();return r(i)}}},{key:"getPulseSource",value:function(){for(var e=0;e<this.tidals.length;e++){if(this.pName("pulseSource",e+1).get())return this.tidals[e]}}},{key:"pName",value:function(e,t){return this.jakiParams[e+t+"Parameter"]}},{key:"swing",value:function(e){var t,n=this;return t=function(){return n.pName("swing",e).get()},function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=n[0],i=n[1],o=n[2];if(!a)return Object(v.w)(!0);var s=v.A.apply(void 0,[t].concat(n));return Math.floor(i/2)%2!==0?Object(v.R)({stepData:a,time:o+J*(s-50)/50,stepNumber:i}):Object(v.w)(!0)}}},{key:"offset",value:function(e){var t,n=this;return t=function(){return n.pName("offset",e).get()},function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=n[0],i=n[1],o=n[2];if(!a)return Object(v.w)(!0);var s=v.A.apply(void 0,[t].concat(n));return Object(v.R)({stepData:a,time:o+J*s/100,stepNumber:i})}}},{key:"handleNudge",value:function(e){var t,n=this;return t=function(){return n.pName("nudge",e).get()},function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=n[0],i=n[1],o=n[2];if(!a)return Object(v.w)(!0);var s=v.A.apply(void 0,[t].concat(n));return a.nudgeForward||(a.nudgeBackward?s*=-1:s=0),Object(v.R)({stepData:a,time:o+J*s/50,stepNumber:i})}}},{key:"handleHand",value:function(e){var t=this;return Object(z.a)(function(){return t.pName("hand",e).get()})}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"stop",value:function(){Object(c.a)(Object(f.a)(n.prototype),"stop",this).call(this),this.freeTidals()}},{key:"getJson",value:function(){return Object(a.a)({},Object(c.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{jakiParams:this.jakiParams.getJson(),figures:this.figures.getJson(),rules:this.rules.map(function(e){return e.getJson()}),scaleRules:this.scaleRules,numTidals:this.tidals.length})}},{key:"registerContext",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new h.a;t=t.forEffect(this),this.zObject&&(t=t.forZObject(this.zObject));var n=this.jakiParams.parameters;this.getParameters().forEach(function(r){var a=t;n.includes(r)&&(a=t.getCopy()).forZObject(e.jakiParams.zObject),r.setContext(a),r.setStore(e.track.store)})}},{key:"getParameters",value:function(){return[].concat(Object(r.a)(this.parameters),Object(r.a)(this.jakiParams.parameters),Object(r.a)(this.figures.figures.flatMap(function(e){return e.parameters})),Object(r.a)(this.rules.flatMap(function(e){return e.getParameters()}))).filter(function(e){return e})}},{key:"fromJson",value:function(e){var t=Object(c.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e);if(e.jakiParams?this.jakiParams.fromJson(e.jakiParams):this.jakiParams.fromJson(e),e.figures&&(Array.isArray(e.figures)?this.figures.fromJson({id:this.figures.id,figures:e.figures}):this.figures.fromJson(e.figures)),e.numTidals)for(var r=2;r<=e.numTidals;r++)this.addSlot();else for(var a=1;a<=6;a++)this.addSlot();return e.rules&&this.rules.forEach(function(t,n){e.rules[n]&&(t.effects=[],t.fromJson(e.rules[n]))}),e.scaleRules&&(this.scaleRules=e.scaleRules),t}},{key:"getValueJson",value:function(){return{figures:this.figures.getJson()}}},{key:"fromValueJson",value:function(e){this.figures.fromJson(e.figures)}}]),n}(Object(k.a)(j.a));t.a=U},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(11),o=n(56),s=n(4),c=n(5),u=n(539),l=n.n(u),f=n(541),h=n.n(f),d=16384,p=256,v={name:"AES-CTR",counter:new h.a.Counter(5)._counter,length:64};function m(e,t){return y.apply(this,arguments)}function y(){return(y=Object(o.a)(a.a.mark(function e(t,n){var r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length<d)){e.next=4;break}return e.next=3,O(t,n);case 3:return e.abrupt("return",e.sent);case 4:return r=g(t),e.next=7,O(r,n);case 7:return i=e.sent,o=b(t,new Uint8Array(i)),e.abrupt("return",o);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function b(e,t){for(var n=Math.ceil(d/p),r=Math.floor(e.length/p),a=0;a<p;a++){var i=a*r,o=a*n;e.set(t.subarray(o,o+n),i)}return e}function g(e){for(var t=Math.ceil(d/p),n=Math.floor(e.length/p),r=new Uint8Array(d),a=0;a<p;a++){var i=a*n;r.set(e.subarray(i,i+t),a*t)}return r}function O(e,t){return j.apply(this,arguments)}function j(){return(j=Object(o.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("raw",new Uint8Array(n).buffer,{name:"AES-CTR"},!1,["encrypt","decrypt"]);case 2:return r=e.sent,e.next=5,window.crypto.subtle.encrypt(v,r,new Uint8Array(t));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function k(e,t){return w.apply(this,arguments)}function w(){return(w=Object(o.a)(a.a.mark(function e(t,n){var r,i,o,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length<d)){e.next=5;break}return e.next=3,x(t,n);case 3:return r=e.sent,e.abrupt("return",new Uint8Array(r));case 5:return i=g(t),e.t0=Uint8Array,e.next=9,x(i,n);case 9:return e.t1=e.sent,o=new e.t0(e.t1),s=b(t,o),e.abrupt("return",s);case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function x(e,t){return S.apply(this,arguments)}function S(){return(S=Object(o.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("raw",new Uint8Array(n).buffer,{name:"AES-CTR"},!1,["decrypt"]);case 2:return r=e.sent,e.next=5,window.crypto.subtle.decrypt(v,r,t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}var P=n(127);function E(e,t){console.log("sound shuffle content=",e);for(var n=Math.ceil(e.length/256),r=Object(i.a)(t),a=void 0,o=0;o<256;o++){var s=o*n,c=(o+r[o%r.length])%256*n,u=e.subarray(s,s+n);a=Object(i.a)(e.subarray(c,c+n)),c+n>e.length||s+n>e.length||(e.set(u,c),e.set(a,s))}return e}function T(e,t){for(var n=Math.ceil(e.length/256),r=Object(i.a)(t),a=void 0,o=255;o>=0;o--){var s=o*n,c=(o+r[o%r.length])%256*n;if(!(s+n>e.length||c+n>e.length)){var u=e.subarray(s,s+n);a=new Uint8Array(e.subarray(c,c+n)),e.set(u,c),e.set(a,s)}}return e}var A=n(540),M=(new h.a.Counter(5)._counter,function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.a.generateAESKey();Object(s.a)(this,e),this.contentKey="string"===typeof t?h.a.utils.hex.toBytes(t):t,this.publicKey=void 0}return Object(c.a)(e,[{key:"encryptKey",value:function(e){this.publicKey=e;var t=h.a.utils.hex.fromBytes(this.contentKey),n=l.a.encrypt(t,e).cipher,r=P.a.web3.utils.toHex(n);this.encryptedContentKey=r,this.eck=n}},{key:"convertForEthereum",value:function(){return Object(A.a)(this.encryptedContentKey)}},{key:"encryptContent",value:function(){var e=Object(o.a)(a.a.mark(function e(t){var n,r,o,s,c,u,l,f=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f.length>1&&void 0!==f[1]&&f[1],void 0!==t){e.next=3;break}return e.abrupt("return","");case 3:if(r=new Uint8Array(this.contentKey).buffer,console.log("encrypt content= ",t),o=n?t:h.a.utils.utf8.toBytes(t),s=n?E(o,new Uint8Array(this.contentKey)):o,!n){e.next=14;break}return e.next=10,m(s,r);case 10:return c=e.sent,e.abrupt("return",c);case 14:return e.next=16,O(o,this.contentKey);case 16:return u=e.sent,l=h.a.utils.hex.fromBytes(Object(i.a)(new Uint8Array(u))),e.abrupt("return",l);case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"decryptContent",value:function(e){var t=this;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?new Promise(function(){var n=Object(o.a)(a.a.mark(function n(r,i){var o;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,k(e,t.contentKey);case 2:o=T(o=n.sent,new Uint8Array(t.contentKey)),r(o);case 5:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}()):new Promise(function(){var n=Object(o.a)(a.a.mark(function n(r,o){var s,c,u;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,s="string"===typeof e?h.a.utils.hex.toBytes(e):e,n.next=4,x(new Uint8Array(s),t.contentKey);case 4:c=n.sent,u=h.a.utils.utf8.fromBytes(Object(i.a)(new Uint8Array(c))),r(u),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(0),console.log("error=",n.t0),r("");case 13:case"end":return n.stop()}},n,null,[[0,9]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getPublicKeyAsBytes32",value:function(){var e=P.a.web3.utils.toHex(this.publicKey);return Object(A.a)(e)}}]),e}());t.a=M},function(e,t,n){"use strict";var r=20,a=40,i=600,o=400;function s(e,t,n){for(var s=0;c(e,t,n)&&s<40;)(e+=a)>=i-a&&(e=a,(t=t+r+20)>=o-r&&(t=r+40)),s++;return{x:e,y:t}}function c(e,t,n){for(var i in n.effects){var o=n.effects[i],s=o.x,c=o.y;if(e>=s&&t>=c&&e<=s+a&&t<=c+r)return!0}return!1}n.d(t,"a",function(){return s})},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(122),u=n(542),l=(n(6),n(309),function(){function e(t,n,r,a){Object(o.a)(this,e),this.store=t,this.guilds=n,this.encryption=r,this.crypto=a}return Object(s.a)(e,[{key:"addJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,u,l,f,h=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=h.length>1&&void 0!==h[1]?h[1]:110,r=h.length>2?h[2]:void 0,i=h.length>3&&void 0!==h[3]?h[3]:1,o=h.length>4?h[4]:void 0,3!==i){e.next=8;break}return e.next=7,c.a.addJson(t);case 7:return e.abrupt("return",e.sent);case 8:return e.next=10,this.guilds.getGuildKey(o);case 10:return s=e.sent,u=s.rawPublicKey,e.next=14,this.crypto.encryptRawContent(JSON.stringify(t),r,u);case 14:return l=e.sent,e.next=17,c.a.addJson(l.encryptedContent);case 17:return f=e.sent,this.encryption.newEncryptedContent(f,l.encryptedName,l.encryptedContentKey,n,s.publicKey),e.abrupt("return",f);case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,u,l=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:1,r=l.length>2?l[2]:void 0,i=l.length>3?l[3]:void 0,3!==n){e.next=7;break}return e.next=6,c.a.addBlob(t);case 6:return e.abrupt("return",e.sent);case 7:return e.next=9,this.guilds.getGuildKey(r);case 9:return o=e.sent,s=o.rawPublicKey,i.encryptKey(s),e.next=14,this.crypto.encryptRawContent(t,"",s,!0,i);case 14:return u=e.sent,e.next=17,c.a.addBytesArray(u.encryptedContent);case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addBlob",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,l=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:1,l.length>2?l[2]:void 0,3!==n){e.next=6;break}return e.next=5,c.a.addBlob(t);case 5:return e.abrupt("return",e.sent);case 6:return e.next=8,this.guilds.getGuildKey();case 8:return r=e.sent,i=r.rawPublicKey,e.next=12,this.crypto.encryptRawContent(t,"",i,!0);case 12:return o=e.sent,e.next=15,c.a.addJson(o.encryptedContent);case 15:return s=e.sent,this.encryption.newEncryptedContent(s,o.encryptedName,o.encryptedContentKey,u.b,r.publicKey),e.abrupt("return",s);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getEncryptedContentMetadata",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o,s,c,u,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(new Date).getTime(),void 0!==r){e.next=5;break}return e.next=4,this.guilds.getContentGuildId(t,n);case 4:r=e.sent;case 5:if(0!==r){e.next=7;break}return e.abrupt("return",1);case 7:return e.next=9,this.guilds.hasAccessTo(r);case 9:if(e.sent){e.next=12;break}return e.abrupt("return",2);case 12:return o=(new Date).getTime(),o-i,e.next=16,this.guilds.getGuildKey(r);case 16:if(s=e.sent,c=(new Date).getTime(),c-o,u=void 0,!s){e.next=24;break}return e.next=23,this.encryption.getEncryptedContent(t,s.privateKey);case 23:u=e.sent;case 24:if(void 0!==u){e.next=28;break}return e.next=27,this.encryption.getEncryptedContent(t);case 27:u=e.sent;case 28:return l=(new Date).getTime(),l-c,e.abrupt("return",u);case 31:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getJson",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:"QmcfgECwvezrtmVGMywi6epaRMa8NE748V6UiGaBRALeQW",n=s.length>1?s[1]:void 0,r=s.length>2?s[2]:void 0,e.next=5,this.getEncryptedContentMetadata(t,n);case 5:if(1!==(i=e.sent)&&void 0!==i){e.next=12;break}return e.next=9,c.a.getJson(t,r);case 9:return e.abrupt("return",e.sent);case 12:if(2!==i){e.next=14;break}return e.abrupt("return",{});case 14:return e.next=16,this.crypto.fetchAndDecrypt(t,i,void 0,r);case 16:return o=e.sent,e.abrupt("return",JSON.parse(o));case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSound",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o,s,l,f,h=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>0&&void 0!==h[0]?h[0]:"QmYPK9KSRnm5LRvZZkrhLD9HJNVoQpbPBkokF1gt8FwZv8",n=h.length>1?h[1]:void 0,r=h.length>2?h[2]:void 0,i=new Date,e.next=6,this.getEncryptedContentMetadata(t,u.b,n);case 6:if(o=e.sent,s=new Date,s.getTime()-i.getTime(),1!==o&&void 0!==o){e.next=15;break}return e.next=12,c.a.getSound(t,void 0,r);case 12:return e.abrupt("return",e.sent);case 15:if(2!==o){e.next=17;break}return e.abrupt("return",void 0);case 17:return e.next=19,this.crypto.fetchAndDecrypt(t,o,!0);case 19:return l=e.sent,f=new Date,f.getTime()-i.getTime(),e.abrupt("return",l);case 23:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"guildId",get:function(){var e=this.store.getState().guilds.selectedGuild;return e?e.guildId:0}}]),e}());t.a=l},,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){for(var t=Object.getOwnPropertyNames(e),n=0;n<t.length;n++)delete e[t[n]];return e}},,,function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){return"INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName}},function(e,t,n){"use strict";n.d(t,"i",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"g",function(){return o}),n.d(t,"f",function(){return s}),n.d(t,"h",function(){return c}),n.d(t,"k",function(){return u}),n.d(t,"m",function(){return l}),n.d(t,"c",function(){return f}),n.d(t,"e",function(){return h}),n.d(t,"j",function(){return d}),n.d(t,"o",function(){return p}),n.d(t,"l",function(){return v}),n.d(t,"d",function(){return m}),n.d(t,"n",function(){return y});var r=2,a=3,i=4,o=5,s=6,c=7,u=8,l=9,f=10,h=11,d=12,p=13,v=14,m=15,y=16},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2),u=n(376),l=n(9);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(o.a)(n,e);var t=f(n);function n(e,a,i){var o;return Object(r.a)(this,n),(o=t.call(this,e,i)).defaultValue=a,o.heldEvent=void 0,o.currentEvent=a,o.cache={},o}return Object(a.a)(n,[{key:"getMixType",value:function(){return l.c}},{key:"restart",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(i.a)(Object(c.a)(n.prototype),"restart",this).call(this),this.cache={},e||(this.heldEvent=void 0),this.currentEvent=this.defaultValue}},{key:"clear",value:function(){Object(i.a)(Object(c.a)(n.prototype),"clear",this).call(this),this.cache={}}},{key:"holdEvent",value:function(e,t){this.heldEvent=e}},{key:"getPreviousEvent",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(i.a)(Object(c.a)(n.prototype),"getPreviousEvent",this).call(this,e,t,r)||this.defaultValue}},{key:"getValuesBetweenSteps",value:function(e,t){for(var n=[],r=void 0,a=e;a<t;a++){var i=this.getValue(a,!1,!1),o=i.getValue();this.type===l.j?void 0!==r&&o.equals(r)||n.push({step:a,value:o,event:i}):o!==r&&n.push({step:a,value:o,event:i}),r=o}for(var s=0;s<n.length;s++)void 0===n[s+1]?n[s].duration=t-n[s].step:n[s].duration=n[s+1].step-n[s].step,n[s].event.duration=n[s].duration;return n}},{key:"getValue",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getEvent(e,t).getValue()}},{key:"getEvent",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.heldEvent)return this.heldEvent;if(e in this.cache)return this.cache[e];0==e&&t&&this.restart();for(var n=t?this.counter:0,r=void 0;n<this.events.length&&!(this.events[n].step>e);n++)void 0!==this.heldEvent&&this.events[n].step!==e||(r=this.events[n]);return t&&(this.counter=Math.max(0,n-1)),void 0===r?(this.cache[e]=this.currentEvent,this.currentEvent):(this.currentEvent=r,this.heldEvent=void 0,this.cache[e]=r,r)}}]),n}(u.a);t.a=h},function(e,t,n){"use strict";n(443),n(378)},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),o=n(7),s=n(8),c=n(2),u=n(33);n(73);function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(o.a)(n,e);var t=l(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).cacheSize=8,e}return Object(i.a)(n,[{key:"initCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cacheSize;this.cachedSteps=[];for(var t=0;t<e;t++){var n=new u.a(void 0,void 0,void 0,this.track);n.loadDefaults(),this.cachedSteps.push(n)}this.cacheIndex=0}},{key:"getStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transpose,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.durationParameter.get(),a=void 0;return!(arguments.length>3&&void 0!==arguments[3])||arguments[3]?(a=this.cachedSteps[this.cacheIndex],this.cacheIndex=(this.cacheIndex+1)%this.cachedSteps.length):a=new u.a(void 0,void 0,void 0,this.track),a.transpose=t,a.velocity=e.velocity,a.on=e.on,a.leafNumber=e.leafNumber,a.leafType=e.leafType,a.accent=e.accent,a.staccato=e.staccato,a.legato=e.legato,a.piano=e.piano,a.pianissimo=e.pianissimo,a.lastLeaf=e.lastLeaf,a.duration=n,e.voices&&(a.voices=Object(r.a)(e.voices)),a.attack=e.attack,a.delays=e.delays,e.track&&(a.track=e.track),(e.track?e.track.instrument:this.track.instrument)?a.release=null:a.release=e.release,a.start=e.start,a.hand=e.hand,a.isNewCycle=e.isNewCycle,a.chop=e.chop,a.pitchAttack=e.pitchAttack,a.pitchSustain=e.pitchSustain,a.pitchRelease=e.pitchRelease,a.pitchDecay=e.pitchDecay,a.slice=e.slice,a.reverse=e.reverse,a.panning=e.panning,a.selectedRecording=e.selectedRecording,a.palette=e.palette,a.auxEventA=e.auxEventA,a.auxEventB=e.auxEventB,a.auxEventC=e.auxEventC,a.auxEventD=e.auxEventD,a.nudgeForward=e.nudgeForward,a.nudgeBackward=e.nudgeBackward,a}}]),n}(e)}},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=n(139),h=n(14),d=n(145),p=n(134);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var m=function(e){Object(c.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Max Parameter",e)).parameter=void 0,r.maxParameter=new h.a("max",Object(o.a)(r),function(e,t){return t},{documentation:"Max percentage of the parameters range to allow",min:0,max:1,unit:"",defaultValue:1}),r.registerParameter(r.maxParameter),r}return Object(i.a)(n,[{key:"documentation",get:function(){return["Alters the step parameters for triggers that pass through this effect. "]}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getVisualizedParameters",value:function(){return[this.offsetParameter]}},{key:"getAvailableParameters",value:function(){return[this.track.trackData.durationParameter,this.track.trackData.chopParameter,this.track.trackData.velocityParameter,this.track.trackData.transposeParameter,this.track.trackData.paletteParameter,this.track.trackData.startParameter,this.track.trackData.attackParameter,this.track.trackData.releaseParameter,this.track.trackData.pitchAttackParameter,this.track.trackData.pitchDecayParameter,this.track.trackData.pitchSustainParameter,this.track.trackData.pitchReleaseParameter]}},{key:"output",value:function(){var e=this;if(void 0===this.parameter)return this.triggers;var t=[],n=function(n){var r=e.triggers[n],a=e.getStep(r.stepData,void 0,void 0,!0),i=a.parameters.filter(function(t){return t.name===e.parameter.name});if(i.length>0){var o=i[0].get();if(null===o)o=e.track.trackData.parameters.find(function(e){return e.name===i[0].name}).get();var s=i[0].config,c=s.min,u=c+(s.max-c)*e.maxParameter.get();i[0].get()>=u&&i[0].set(u)}r=new d.a(a,r.time,r.stepNumber),t.push(r)};for(var r in this.triggers)n(r);return t}},{key:"getJson",value:function(){return Object(r.a)({},Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{parameter:void 0===this.parameter?void 0:this.parameter.name})}},{key:"fromJson",value:function(e,t){var r=Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t),a=this.getAvailableParameters();if(void 0!==e.parameter)return this.parameter=a.filter(function(t){return t.name===e.parameter})[0],r}}]),n}(Object(p.a)(f.a));t.a=m},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(4),a=n(5),i=n(31),o=n(10),s=n(7),c=n(8),u=n(2),l=n(626),f=n(14);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var d=function(e){Object(s.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Flush",e)).flushParameter=new f.a("flush",Object(i.a)(a),function(){return 0},{defaultValue:4,min:0,max:64}),a.registerParameter(a.flushParameter),a.newInlet("to flush"),a.newInlet("control flush"),a.newOutlet("send messages"),a}return Object(a.a)(n,[{key:"dispose",value:function(){Object(o.a)(Object(u.a)(n.prototype),"dispose",this).call(this),this.disposeMessaging()}},{key:"flush",get:function(){return this.flushParameter.get()}},{key:"processMessages",value:function(){var e=this,t=this.queuedMessages["control flush"];t&&t.length>=this.flush&&(this.queuedMessages["to flush"].forEach(function(t){return e.sendMessage("send messages",t)}),this.clearMessages())}}]),n}(l.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2),u=n(134),l=n(139);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(o.a)(n,e);var t=f(n);function n(e,a){var i;return Object(r.a)(this,n),(i=t.call(this,e,a)).queuedMessages={},i}return Object(a.a)(n,[{key:"newInlet",value:function(e){var t=this;Object(i.a)(Object(c.a)(n.prototype),"newInlet",this).call(this,e,function(n){return t.onMessage(e,n)})}},{key:"onMessage",value:function(e,t){this.queuedMessages[e]||(this.queuedMessages[e]=[]),this.queuedMessages[e].push(t),this.processMessages()}},{key:"processMessages",value:function(){this.clearMessages()}},{key:"getInletByNumber",value:function(e){var t=0;for(var n in this.inlets)if(t++===e)return n}},{key:"clearMessages",value:function(){for(var e in this.queuedMessages)this.queuedMessages[e].length=0}}]),n}(Object(u.a)(l.a))},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r=n(4),a=n(5),i=n(31),o=n(7),s=n(8),c=n(2),u=n(626),l=n(14);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(o.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Message",e)).newInlet(1),a.newOutlet("output"),a.messageTextParameter=new l.a("messageText",Object(i.a)(a),function(){return 0},{defaultValue:""}),a.registerParameter(a.messageTextParameter),a._messageText=void 0,a}return Object(a.a)(n,[{key:"messageText",get:function(){return this.messageTextParameter.get()},set:function(e){this.messageTextParameter.set(e,!1)}},{key:"processMessages",value:function(){for(var e in this.queuedMessages){var t=this.queuedMessages[e][0],n=this.messageText.replaceAll("$"+e,t[0]);this.sendMessage("output",n),this._messageText=n}this.clearMessages()}},{key:"execute",value:function(){this.sendMessage("output",this._messageText||this.messageText)}}]),n}(u.a)},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(139),u=n(147),l=n(134);n(145),n(14),n(6);function f(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var p=function(e){Object(i.a)(n,e);var t=d(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Note Display",e)).notes={},a.timeOn={},a.durations={},a.velocities={},a.newOutlet("notes on"),a.newOutlet("note durations"),a}return Object(a.a)(n,[{key:"removeNote",value:function(e,t){arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.gated;delete this.notes[e]}},{key:"output",value:function(e){for(var t in this.notes)this.notes[t]--,this.notes[t]<=0&&delete this.notes[t];var n,r=f(this.triggers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.stepData){var i=a.stepData,o=i.transpose,s=i.duration,c=i.velocity;this.notes[o]=2*s,this.durations[o]=s,this.velocities[o]=c,this.timeOn[o]=e}}}catch(y){r.e(y)}finally{r.f()}this.sendMessage("notes on",Object.keys(this.notes));var l=new Array(12).fill(0);for(var h in this.notes){var d=Object(u.a)(parseInt(h),12);l[d]=this.notes[h];var p=this.durations[h],v=this.velocities[h];l[d]=3*v*this.notes[h]/p;var m=this.timeOn[h];Math.pow(e-m,3)<l[d]&&(l[d]=Math.pow(e-m,3))}return this.sendMessage("note durations",l),this.triggers}},{key:"stop",value:function(){this.notes={}}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(Object(l.a)(c.a));t.a=p},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=n(139),h=n(326),d=n(14),p=(n(23),n(451)),v=n(288),m=n(134);function y(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var O=function(e){Object(c.a)(n,e);var t=g(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Accumulator",e)).storedAccumulator=0,r.accumulatorValueParameter=new d.a("accumulatorValue",Object(o.a)(r),function(e,t){return t},{documentation:"Adds this value to the accumulator on each trigger",min:-64,max:64,unit:"",defaultValue:1}),r.registerParameter(r.accumulatorValueParameter),r.limitParameter=new d.a("limit",Object(o.a)(r),function(e,t){return t},{documentation:"Accumulates until limit before resettig",min:-64,max:64,unit:"",defaultValue:64}),r.registerParameter(r.limitParameter),r.syncedParameter=new d.a("synced",Object(o.a)(r),function(e,t){return t},{documentation:"Takes the trigger parameter and adds it to the accumulator value",min:0,max:1,defaultValue:null}),r.registerParameter(r.syncedParameter),r.setupRampParameters(),r.modeParameter=new d.a("mode",Object(o.a)(r),function(e,t){return t},{documentation:"How accumulator should act once it reaches the limit",min:0,max:1,defaultValue:p.a}),r.registerParameter(r.modeParameter),r.directionFactor=1,r.setupNodeMessaging(),r}return Object(i.a)(n,[{key:"getVisualizedParameters",value:function(){return[this.accumulatorValueParameter]}},{key:"getText",value:function(){var e=this.accumulatorValue;return e>0?"+"+e:e}},{key:"clear",value:function(){this.directionFactor=1,this.storedAccumulator=0,this._clear()}},{key:"clearParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._parameters.indexOf(e);this.directionFactor=1,this.storedAccumulator=0,this._clearParameter(e,t)}},{key:"accumulatorValue",get:function(){return this.accumulatorValueParameter.get()}},{key:"mode",get:function(){return this.modeParameter.get()}},{key:"limit",get:function(){return this.limitParameter.get()}},{key:"output",value:function(e,t){var n=Object(r.a)(this.triggers);if(!this.track.sequencerEngine.playing||this.shouldOutputSkip(e,t))return n;var a=this.triggers[0],i=this.accumulatorValue;this.syncedParameter.get()&&(i*=a.stepData[this.syncedParameter.get()]);return this.storedAccumulator=this.storedAccumulator+i*this.directionFactor,this.storedAccumulator>=this.limit?this.mode===p.a?this.storedAccumulator=this.storedAccumulator%this.limit:this.mode===p.b?(this.storedAccumulator=this.limit,this.directionFactor*=-1):this.mode===p.c&&(this.storedAccumulator=this.limit):Math.abs(this.storedAccumulator)>=this.limit?this.mode===p.a?this.storedAccumulator=(this.storedAccumulator%this.limit+this.limit)%this.limit:this.mode===p.b?(this.storedAccumulator=-1*this.limit,this.directionFactor*=-1):this.mode===p.c&&(this.storedAccumulator=this.accumulatorValue<0?-1*this.limit:this.limit):Math.abs(this.storedAccumulator)<Math.abs(this.accumulatorValue)&&-1===this.directionFactor&&this.mode===p.b&&(this.storedAccumulator=0,this.directionFactor*=-1),this.setParameterValues(e),this.triggers}},{key:"getParameterValueToSet",value:function(e){return this.initialParameterValues[e]+this.storedAccumulator*(this.getDepth(e)/100)}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"randomlyMapParameters",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15,r=Object(s.a)(Object(l.a)(n.prototype),"randomlyMapParameters",this).call(this,t),a=-4,i=y(r);try{for(i.s();!(e=i.n()).done;){var o=e.value;o.max>=a&&(a=o.max)}}catch(d){i.e(d)}finally{i.f()}this.accumulatorValueParameter.set(Math.random()*a/10),this.limitParameter.set(a);var c,u=0,f=y(r);try{for(f.s();!(c=f.n()).done;){var h=100*c.value.max/a;h*=Math.random(),this.depthParameters[u].set(h),u++}}catch(d){f.e(d)}finally{f.f()}}}]),n}(Object(v.a)(Object(h.a)(Object(m.a)(f.a))));t.a=O},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(11),a=n(158);function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=function(e,t,n){var o=e.context,s=e.name,c=(e.id,n?n.subSequences.flatMap(function(e){return e.tracks}):[]);if(o){if("BPM"===s)return n.bpmParameter;if(o.instrumentType!==a.f){if(void 0!==o.effect){var u,l=i(c);try{for(l.s();!(u=l.n()).done;){var f=u.value,h=[].concat(Object(r.a)(f.effects),Object(r.a)(f.midiEffects.effects),Object(r.a)(f.liveEffects.effects)).find(function(e){return e.name===o.effectName});if(h)return h.getParameters().find(function(e){return e.name===s})}}catch(j){l.e(j)}finally{l.f()}var d,p=i(t.sequencerEngine.subSequences);try{for(p.s();!(d=p.n()).done;){var v=d.value,m=[].concat(Object(r.a)(v.midiEffects.effects),[v.playhead]).find(function(e){return e.name===o.effectName});if(m)return m.getParameters().find(function(e){return e.name===s})}}catch(j){p.e(j)}finally{p.f()}}}else{var y=void 0;if(!(y=t&&t.instrument&&t.instrument.getInstrumentType()===a.f?t:c.find(function(e){return e.instrument&&e.instrument===a.f&&!e.isFrozens})))return;var b=y.instrument.getSubDevice(o.subDevice);if(b){var g=(b.getParameters?b.getParameters():b.parameters).find(function(e){return e.name===s});if(g&&g.context&&g.context.formant){var O=g.context.formant;O.enabledParameter.get()||O.enabledParameter.set(!0,!0,!0)}return g}}}}},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),o=n(31),s=n(7),c=n(8),u=n(2),l=n(139),f=(n(33),n(145),n(240),n(14)),h=(n(21),n(448),n(452)),d=n(6);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}new(n.n(d).a.Time)("32n");var v=function(e){Object(s.a)(n,e);var t=p(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Chord Sculptor",e)).liveTriggers=[],r.linesParameter=new f.a("lines",Object(o.a)(r),function(e,t){return r.lines=t},{defaultValue:[],min:[],max:[],unit:""}),r.registerParameter(r.linesParameter),r.effects=[],r.rawLines=[],r}return Object(i.a)(n,[{key:"clear",value:function(){this.effects.forEach(function(e){return e.clear()})}},{key:"onNewStep",value:function(){this.effects.forEach(function(e){return e.onNewStep()})}},{key:"removeNote",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.gated;this.effects.forEach(function(r){return r.removeNote(e,t,n)})}},{key:"isRealTime",value:function(){return!1}},{key:"lines",set:function(e){this.rawLines=e;var t=[];for(var n in e){var r=e[n],a=r.x1,i=r.y1,o=r.x2,s=r.y2,c=r.brightness,u=Math.abs(Math.ceil(16*(o-a))),l=8*i,f=8*s,d=4*(a+o)/2,p=c||1,v=new h.a(this.track);v.evenDelayTimeParameter.set(l),v.oddDelayTimeParameter.set(f),v.repeatsParameter.set(u),v.durationFactorParameter.set(d),v.velocityParameter.set(p),t.push(v)}this.effects=t}},{key:"input",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.effects.forEach(function(n){return n.input(e,t)})}},{key:"output",value:function(e,t,n){var a=[];for(var i in this.effects)a=[].concat(Object(r.a)(a),Object(r.a)(this.effects[i].output(e,t,n)));return a}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(l.a);t.a=v},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2);function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var l=function(e){Object(o.a)(n,e);var t=u(n);function n(e,a,i){var o;Object(r.a)(this,n);var s=!0;return(o=t.call(this,e,i,function(e,t){s||e.send(a,t),s=!1},{min:0,max:127,defaultValue:1})).ccNumber=a,i.setCallback(a,function(e){o.set(e)}),o}return Object(a.a)(n,[{key:"getJson",value:function(){var e=Object(i.a)(Object(c.a)(n.prototype),"getJson",this).call(this);return e.ccNumber=this.ccNumber,e}}]),n}(n(14).a);t.a=l},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),o=n(7),s=n(8),c=n(2),u=(n(3),n(145)),l=n(139),f=n(14);n(21);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var d=function(e){Object(o.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Midi Delay",e)).delayTimeParameter=new f.a("delayTime",Object(i.a)(a),function(e,t){return t},{documentation:"The size of the delay in 1/32th notes.",min:1,max:64,unit:"",defaultValue:1}),a.registerParameter(a.delayTimeParameter),a.repeatsParameter=new f.a("repeats",Object(i.a)(a),function(e,t){return[]},{documentation:"The number of additional repeats that will be triggered for each trigger.",defaultValue:1,min:1,max:32,unit:"bars"}),a.registerParameter(a.repeatsParameter),a.wetParameter=new f.a("wet",Object(i.a)(a),function(e,t){return t},{documentation:"Controls the velocity of the delayed triggers vs. the original triggers.",min:0,max:1,unit:"",defaultValue:.5}),a.registerParameter(a.wetParameter),a.delays=[],a}return Object(a.a)(n,[{key:"getVisualizedParameters",value:function(){return[this.delayTimeParameter,this.repeatsParameter]}},{key:"getText",value:function(){return this.delayTime+", "+this.repeats}},{key:"documentation",get:function(){return"A delay-style midi effect that triggers the track at the given delayed rate."}},{key:"onNewStep",value:function(){this.triggers=[]}},{key:"clear",value:function(){this.triggers=[],this.delays=[]}},{key:"wet",get:function(){return this.wetParameter.get()}},{key:"repeats",get:function(){return this.repeatsParameter.get()}},{key:"delayTime",get:function(){return this.delayTimeParameter.get()},set:function(e){this.delayTimeParameter.set(e)}},{key:"input",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.delays.length>8&&(this.delays=this.delays.slice(this.delays.length-8)),this.delays.push({stepNumber:e.stepNumber,trigger:this.copyTrigger(e),repeats:0,elapsed:0}),this.triggers.push(this.copyTrigger(e))}},{key:"output",value:function(e,t,n){var r=[],a=[];for(var i in this.delays){var o=this.delays[i];if(o.elapsed++,this.shouldPlayDelay(t,o)){var s=this.getStep(o.trigger.stepData,void 0,void 0,!1);s.velocity=s.velocity*(this.repeats-o.repeats)/this.repeats,s.velocity*=this.wet;var c=new u.a(s,e,t);if(s.velocity>0&&r.push(c),o.repeats++,o.repeats>=this.repeats)continue}a.push(o)}var l=this.triggers;for(var f in l){var h=this.getStep(l[f].stepData,void 0,void 0,!0);h.velocity*=1-this.wet,l[f].stepData=h}return r=r.concat(l),this.delays=a,r}},{key:"shouldPlayDelay",value:function(e,t){var n=t.elapsed-1;return 0!==n&&n%Math.floor(this.delayTime)===0}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(l.a);t.a=d},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(4),a=n(5),i=n(6),o=n.n(i),s=n(22),c=function(){function e(t,n,a,i){Object(r.a)(this,e),this.macro=i,this.parameter=t,this._min=n,this._max=a;var c=Math.abs(Math.min(this._min,this._max));if(this.scaler=new o.a.Scale(this._min+c,this._max+c),this.subtract=new o.a.Subtract(this._min<0||this._max<0?0:c),this.scaler.connect(this.subtract),this.parameter.audioParam)this.subtract.connect(this.parameter.audioParam);else if(this.parameter.audioParams)for(var u in this.parameter.audioParams){var l=this.parameter.audioParams[u].input||this.parameter.audioParams[u];Array.isArray(l)&&(l=l[0]),this.subtract.connect(l)}this.parameter.automationRate=s.a}return Object(a.a)(e,[{key:"withSignal",value:function(e){e.connect(this.scaler)}},{key:"dispose",value:function(){this._disposed||(this.scaler.disconnect(),this.scaler.dispose(),this.subtract.disconnect(),this.subtract.dispose(),this._disposed=!0)}},{key:"normalizeValue",value:function(e){return this.min+(this.max-this.min)*e}},{key:"updateRedux",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e=this.normalizeValue(e),t&&this.parameter.set(e,void 0,!0,void 0,!0),{id:this.parameter.id,value:e}}},{key:"min",get:function(){return this._min},set:function(e){this._min=e;var t=Math.abs(Math.min(this._min,this._max));this.scaler.min=e+t,this.scaler.max=this._max+t,this.subtract.value=this._min<0||this._max<0?0:t}},{key:"max",get:function(){return this._max},set:function(e){this._max=e;var t=Math.abs(Math.min(this._min,this._max));this.scaler.max=e+t,this.scaler.min=this._min+t,this.subtract.value=this._min<0||this._max<0?0:t}},{key:"getJson",value:function(){return{parameter:this.parameter.id,min:this.min,max:this.max}}}]),e}()},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),o=n(7),s=n(8),c=n(2);function u(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}window.outputTimes=[],window.outputCounters=[],window.copyTimes=[],window.triggerInputs={},t.a=function(e){return function(e){Object(o.a)(n,e);var t=f(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"runFlow",value:function(e,t,n){var a=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.inputNode,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.triggers,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.adjacencyLists,c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];window.triggerInputs[e]=0;var l=[],f=[];f.push(i);for(var h=0,d=function(){var i=f.shift();h++;var d=(new Date).getTime(),p=i.output?i.output(e,t,n):Object(r.a)(o),v=(new Date).getTime();if(window.outputTimes.push({time:v-d,name:i.name}),void 0===s[i.id])return"continue";var m,y=u(s[i.id]);try{var b=function(){var t=m.value,n=t.effect,o=t.probability;if(t.triggerCount=0,Math.random()>=o/100)return"continue";if(n.input){var u=(new Date).getTime();p.filter(function(e){return void 0===e.outputNumber&&0===t.outputNumber||e.outputNumber===t.outputNumber}).forEach(function(r){t.triggerCount++,s[i.id].length>1&&(r=a.copyTrigger(r,c)),window.triggerInputs[e]++,n.input(r,void 0===r.time)});var h=(new Date).getTime();window.copyTimes.push(h-u)}else{var d=p.filter(function(e){return void 0===e.outputNumber&&0===t.outputNumber||e.outputNumber===t.outputNumber});t.triggerCountc+=d.length,l=[].concat(Object(r.a)(l),Object(r.a)(d))}n.parent=i,f.includes(n)||f.push(n)};for(y.s();!(m=y.n()).done;)b()}catch(g){y.e(g)}finally{y.f()}};f.length>0;)d();return window.outputCounters.push(h),l}}]),n}(e)}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return MicroTuningEffect});var _Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(31),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_get__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(10),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(7),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(8),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(2),_MidiEffect_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(139),utils_IsNumber_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(43),parameters_AbstractParameter_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(14);function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(e);if(t){var a=Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_6__.a)(this,n)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MicroTuningEffect=function(_MidiEffect){Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_5__.a)(MicroTuningEffect,_MidiEffect);var _super=_createSuper(MicroTuningEffect);function MicroTuningEffect(e){var t;return Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__.a)(this,MicroTuningEffect),(t=_super.call(this,"Micro Tuning",e)).scriptParameter=new parameters_AbstractParameter_js__WEBPACK_IMPORTED_MODULE_10__.a("script",Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_3__.a)(t),function(e,n){return t.executeScript(n)},{defaultValue:"(x) => x"}),t.offsets={},t.algo=function(e){return e},t}return Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_2__.a)(MicroTuningEffect,[{key:"executeScript",value:function executeScript(script){var isTest=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var algo=eval(script);return!!Object(utils_IsNumber_js__WEBPACK_IMPORTED_MODULE_9__.a)(algo(5))&&(isTest||(this.algo=algo),!0)}catch(e){return!1}}},{key:"newNoteOffset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new parameters_AbstractParameter_js__WEBPACK_IMPORTED_MODULE_10__.a("noteOffset",this,function(){return[]},{defaultValue:t,min:-1,max:1});return this.registerParameter(n),this.context&&n.setContext(this.context),this.offsets[e]=n,n}},{key:"output",value:function(){for(var e in this.triggers){var t=this.triggers[e].stepData.duration,n=this.getTranspose(this.triggers[e].stepData.transpose),r=this.getStep(this.triggers[e].stepData,n,this.triggers[e].stepData.duration,!1);r.duration=null===t?void 0:t,this.triggers[e].stepData=r}return this.triggers}},{key:"getTranspose",value:function(e){var t=Math.round(e),n=t in this.offsets?this.offsets[t].get():0,r=this.algo(e)+n;return Math.max(Math.min(42,r),-42)}},{key:"getJson",value:function(e){var t={};for(var n in this.offsets)t[n]=this.offsets[n].get();return Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__.a)({},Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_get__WEBPACK_IMPORTED_MODULE_4__.a)(Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(MicroTuningEffect.prototype),"getJson",this).call(this,e),{script:this.scriptParameter.get(),offsets:t})}},{key:"fromJson",value:function(e,t){for(var n in Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_get__WEBPACK_IMPORTED_MODULE_4__.a)(Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(MicroTuningEffect.prototype),"fromJson",this).call(this,e,t),e.offsets)this.newNoteOffset(parseFloat(n),e.offsets[n]);this.scriptParameter.set(e.script)}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=new MicroTuningEffect(e);return n.fromJson(this.getJson(),t),n}}]),MicroTuningEffect}(_MidiEffect_js__WEBPACK_IMPORTED_MODULE_8__.a)},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(139);n(14);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var h=function(e){Object(s.a)(n,e);var t=f(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Alternate Tuning",e)).tuningMappings={0:.1,1:.5,2:.8,3:.9,4:1.2,5:1.5,6:2.3,7:2.9,8:3.3,9:4.2,10:5.1,11:7},r}return Object(i.a)(n,[{key:"documentation",get:function(){return"Maps each note (i.e. the transpose) to a different note. "}},{key:"output",value:function(){for(var e in this.triggers){var t=this.triggers[e].stepData.duration,n=this.getStep(this.triggers[e].stepData,this.getTranspose(this.triggers[e].stepData.transpose),this.triggers[e].stepData.duration,!1);n.duration=null===t?void 0:t,this.triggers[e].stepData=n}return this.triggers}},{key:"getTranspose",value:function(e){var t=12*Math.floor(e/12);return(e%=12)<0&&(e=12+e),e in this.tuningMappings?t+this.tuningMappings[e]:e}},{key:"getJson",value:function(){return Object(r.a)({},Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{tuningMappings:this.tuningMappings})}},{key:"fromJson",value:function(e,t){Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t),this.tuningMappings=e.tuningMappings}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(l.a);t.a=h},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r=n(1),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=n(320),h=n(14);function d(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var m=function(e){Object(c.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,e)).name="Linked Tidal",r.cycleFactorParameter=new h.a("cycleFactor",Object(o.a)(r),function(e,t){},{defaultValue:1,min:0,max:16,unit:""}),r.registerParameter(r.cycleFactorParameter),r.linkedEffect=void 0,r}return Object(i.a)(n,[{key:"cycle",get:function(){return this.linkedEffect?this.linkedEffect.cycle:this._cycle},set:function(e){this._cycle=e}},{key:"cycleFactor",get:function(){return this.cycleFactorParameter.get()}},{key:"cycleLength",get:function(){return this.linkedEffect?this.linkedEffect.cycleLength*this.cycleFactor:Object(s.a)(Object(l.a)(n.prototype),"cycleLength",this)}},{key:"var",value:function(e){return this.linkedEffect?this.linkedEffect.var(e):Object(s.a)(Object(l.a)(n.prototype),"var",this).call(this,e)}},{key:"durationFactor",get:function(){return this.linkedEffect?this.linkedEffect.durationFactor:Object(s.a)(Object(l.a)(n.prototype),"durationFactor",this)}},{key:"lengthFactor",get:function(){return this.linkedEffect?this.linkedEffect.lengthFactor:Object(s.a)(Object(l.a)(n.prototype),"lengthFactor",this)}},{key:"replaceOperandVariables",value:function(e){return this.linkedEffect?this.linkedEffect.replaceOperandVariables(e):Object(s.a)(Object(l.a)(n.prototype),"replaceOperandVariables",this).call(this,e)}},{key:"getJson",value:function(){return Object(r.a)({},Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{linkedEffect:this.linkedEffect.id})}},{key:"fromJson",value:function(e){var t=Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e),r=e.linkedEffect;return r&&(this.lostParameters=this.loadParameters([r])),t}},{key:"loadParameters",value:function(e){var t,n=e[0],r=d(this.track.sequencerEngine.tracks);try{for(r.s();!(t=r.n()).done;){var a=t.value.midiEffects.effects.find(function(e){return e.id===n});if(a)return void(this.linkedEffect=a)}}catch(i){r.e(i)}finally{r.f()}return[n]}}]),n}(f.a)},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),o=n(7),s=n(8),c=n(2),u=n(139),l=n(14);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(o.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Limit",e)).limitParameter=new l.a("limit",Object(i.a)(a),function(e,t){return t},{documentation:"The maximum number of notes that can be triggered on a given step.",min:0,max:16,unit:"",defaultValue:1}),a.registerParameter(a.limitParameter),a}return Object(a.a)(n,[{key:"getVisualizedParameters",value:function(){return[this.limitParameter]}},{key:"getText",value:function(){return this.limitParameter.get()}},{key:"documentation",get:function(){return"Limits the number of notes that can be triggered on a given step."}},{key:"limit",get:function(){return this.limitParameter.get()}},{key:"output",value:function(){return this.triggers.slice(0,this.limit)}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(u.a);t.a=h},function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(4),o=n(5),s=n(31),c=n(10),u=n(7),l=n(8),f=n(2),h=n(139),d=n(130),p=n(123),v=n(449),m=(n(145),n(14)),y=n(134);function b(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var j=function(e){Object(u.a)(n,e);var t=O(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,"Every",e)).everyParameter=new m.a("every",Object(s.a)(r),function(e,t){return t},{documentation:"The size of the cycle in triggers.",min:1,max:32,unit:"",defaultValue:2}),r.registerParameter(r.everyParameter),r.offsetParameter=new m.a("offset",Object(s.a)(r),function(e,t){return t},{documentation:"The number of triggers within a cycle before applying the parameter change",min:0,max:8,unit:"",defaultValue:0}),r.registerParameter(r.offsetParameter),r.gateParameter=new m.a("gate",Object(s.a)(r),function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),r.registerParameter(r.gateParameter),r.gateProbabilityParameter=new m.a("gateProbability",Object(s.a)(r),function(e,t){return t},{min:0,max:100,unit:"",defaultValue:100}),r.registerParameter(r.gateProbabilityParameter),r.parameterEffects=[],r.counter=0,r.newInlet(d.g,function(){return r.onReset()}),r.newOutlet(d.b),r}return Object(o.a)(n,[{key:"onReset",value:function(){this.counter=0}},{key:"getVisualizedParameters",value:function(){return[this.everyParameter]}},{key:"getText",value:function(){return this.everyParameter.get()}},{key:"documentation",get:function(){return"Alters a parameter every x many triggers."}},{key:"deleteParameterizer",value:function(e){var t=this.parameterEffects.indexOf(e);this.parameterEffects.splice(t,1)}},{key:"newParameter",value:function(){var e=new v.a(this.track);return this.parameterEffects.push(e),e.registerContext((new p.a).forTrack(this.track)),e.registerMixSession(this.track.mixSession),e.registerTrack(this.track),e}},{key:"getParameters",value:function(){var e,t=Object(c.a)(Object(f.a)(n.prototype),"getParameters",this).call(this),r=b(this.parameterEffects);try{for(r.s();!(e=r.n()).done;){var i=e.value;t=[].concat(Object(a.a)(t),Object(a.a)(i.getParameters()))}}catch(o){r.e(o)}finally{r.f()}return t}},{key:"every",get:function(){return Math.round(this.everyParameter.get())},set:function(e){this.everyParameter.set(e)}},{key:"offset",get:function(){return Math.round(this.offsetParameter.get())},set:function(e){this.offsetParameter.set(e)}},{key:"gate",get:function(){return Math.round(this.gateParameter.get())}},{key:"gateProbability",get:function(){return this.gateProbabilityParameter.get()}},{key:"onNewStep",value:function(){this.triggers=[],this.parameterEffects.forEach(function(e){return e.onNewStep()})}},{key:"clear",value:function(){this.counter=0,this.triggers=[],this.parameterEffects.forEach(function(e){return e.clear()})}},{key:"output",value:function(){var e=this;if(0===this.triggers.length)return this.triggers;if(this.counter++%this.every!==this.offset)return this.triggers;if(!(this.gate&&100*Math.random()<=this.gateProbability))return[];this.sendMessage(d.b,0);var t=this.triggers,n=function(n){var r=e.parameterEffects[n];t.forEach(function(e){return r.input(e)}),t=r.output()};for(var r in this.parameterEffects)n(r);return t}},{key:"getJson",value:function(){return Object(r.a)({},Object(c.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{parameterEffects:this.parameterEffects.map(function(e){return e.getJson()})})}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=Object(c.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t);for(var i in e.parameterEffects){var o=new v.a(this.track);a=Object(r.a)({},a,o.fromJson(e.parameterEffects[i],t)),this.parameterEffects.push(o),o.registerContext((new p.a).forTrack(this.track)),o.registerMixSession(this.track.mixSession),o.registerTrack(this.track)}return a}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(Object(y.a)(h.a));t.a=j},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),o=n(7),s=n(8),c=n(2),u=n(139),l=n(14);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(o.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Midi CC",e)).deviceNameParameter=new l.a("deviceName",Object(i.a)(a),function(e,t){return[]},{defaultValue:null,unit:"",automatable:!1}),a.registerParameter(a.deviceNameParameter),a.midiCCNumberParameter=new l.b("midiCCNumber",Object(i.a)(a),function(e,t){return[]},{documentation:"The Midi CC number that will be sent on each trigger.",defaultValue:0,min:0,max:119,unit:""}),a.registerParameter(a.midiCCNumberParameter),a.midiCCValueParameter=new l.b("midiCCValueParameter",Object(i.a)(a),function(e,t){return[]},{documentation:"The value that will be sent to a given Midi CC on a each trigger",defaultValue:0,min:0,max:128,unit:""}),a.registerParameter(a.midiCCValueParameter),a}return Object(a.a)(n,[{key:"documentation",get:function(){return"Sends a MIDI CC message on each trigger, with the CC number and value being configurable."}},{key:"output",value:function(){for(var e in this.triggers){if(void 0==this.midiCC)break;this.midiCC.send(this.midiCCNumber,this.midiCCValue)}return this.triggers}},{key:"midiCCNumber",get:function(){return this.midiCCNumberParameter.get()}},{key:"midiCCValue",get:function(){return this.midiCCValueParameter.get()}},{key:"midiCC",get:function(){return this.midi.deviceToMidiCC[this.deviceName]}},{key:"deviceName",get:function(){return this.deviceNameParameter.get()}},{key:"midi",get:function(){return this.track.sequencerEngine.midi}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(u.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(165),l=n(114);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Steps",e)).newVar("fromStep",0,0,64),a.newVar("toStep",16,0,64),a.clear(),a}return Object(a.a)(n,[{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.O)(this.var("fromStep"),this.var("toStep")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(114),l=n(165);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Notes",e)).newVar("fromNote",0,-32,32),a.newVar("toNote",16,-32,32),a.clear(),a}return Object(a.a)(n,[{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(l.a)(Object(u.B)(this.var("fromNote"),this.var("toNote")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.track,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(165),l=(n(114),n(289));function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Beat Repeat",e)).newVar("repeats",1,0,16),a.newVar("rate",2,0,16),a.clear(),a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Repeats any triggers"]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.c)(this.var("repeats"),this.var("rate")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(165),l=n(114);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Grab",e)).newTrackVar("trackNumber",null,0,64),a.newParamVar("fromParam","",0,64),a.newParamVar("toParam","",0,64),a.newCheckboxVar("add",!1),a.clear(),a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Sets a parameter for this track to a value grabbed from a different track.","If there are no triggers at a given step, then the original value will play."]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.y)(this.var("trackNumber"),this.var("fromParam"),this.var("toParam"),this.var("add")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.track,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(165),l=n(114);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Grab Time",e)).newTrackVar("trackNumber",null,0,64),a.clear(),a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Sets a parameter for this track to a value grabbed from a different track.","If there are no triggers at a given step, then the original value will play."]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.z)(this.var("trackNumber")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.track,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(165),l=n(213),f=n(114);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var d=function(e){Object(i.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Alternate",e)).clear(),a.numberOfOutputs=2,a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Alternates the 2 outputs every other trigger."]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.a)(Object(f.P)(0),Object(f.P)(1)))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=d},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(165),l=n(213),f=n(114);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var d=function(e){Object(i.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Alternate N",e)).newVar("steps",16,1,64),a.newVar("outputs",2,1,8),a.clear(),a}return Object(a.a)(n,[{key:"value",get:function(){return this.outputsParameter.get()},set:function(e){this.outputsParameter.set(e)}},{key:"documentation",get:function(){return["Alternates between the outputs of this effect every few steps."]}},{key:"numberOfOutputs",get:function(){if(this.outputsParameter){var e=Math.floor(this.var("outputs")());return isNaN(e)?2:e}return 2},set:function(e){}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){for(var e=[],t=0;t<this.numberOfOutputs;t++)e.push(Object(f.P)(t));this.myScript=Object(u.a)(l.b.apply(void 0,[this.var("steps")].concat(e)))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=d},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(165),l=n(114),f=n(289);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var d=function(e){Object(i.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Beat",e)).newVar("step",0,0,32),a.newVar("steps",16,0,64),a.numberOfOutputs=2,a.clear(),a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Sends triggers to output 1 on a specific step of the beat.","All other triggers go to output 2."]}},{key:"getVisualizedParameters",value:function(){return[this.stepParameter,this.stepsParameter]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(f.a)(this.var("step"),this.var("steps"),Object(l.P)(0),Object(l.P)(1)))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=d},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(165),l=(n(213),n(114),n(651));function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Threshold",e)).clear(),a.newVar("threshold",4,1,64),a.newVar("time",4,1,64),a.numberOfOutputs=2,a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Switches the output of the effect once a threshold of triggers is reached and remains switched until an amount of time has passed."]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.a)(function(e){return e.velocity},this.var("threshold"),this.var("time")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(114),a=function(e,t,n){var a=0,i=!1,o=0;return function(s,c,u){return void 0===s?Object(r.w)(!1):(i||(a+=e(s,c,u))>=Object(r.A)(t)&&(a=0,i=!0,o=0),i?(++o>=Object(r.A)(n)&&(i=!1),Object(r.P)(1)):Object(r.P)(0))}}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(114);function a(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var o,s=n[3],c="",u=a(t);try{for(u.s();!(o=u.n()).done;){var l=o.value,f=r.A.apply(void 0,[l].concat(n));if(f)try{c+="string"===typeof l?l+" ":JSON.stringify(f)+" "}catch(h){}}}catch(d){u.e(d)}finally{u.f()}return""!==c&&s.logs.push(c),Object(r.w)(!0)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(1),a=n(114),i=n(150),o=function(e,t){return Object(r.a)({},e,{transpose:0,type:t})},s=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var s=a.A.apply(void 0,[e].concat(n)),c=[],u=0;u<s.length;u++){var l=s[u],f=l.type,h=f.type;f.value;if("."===h)c.push([o(l,Object(i.b)(0)),o(l,Object(i.b)(1))]);else{var d=[o(l,Object(i.c)()),o(l,Object(i.c)()),o(l,Object(i.b)(0)),o(l,Object(i.b)(1))];d.cycleLength=2,c.push(d),u++}}return c}}},function(e,t,n){"use strict";n.d(t,"a",function(){return u}),n.d(t,"b",function(){return l});var r=n(11),a=n(114),i=n(458),o=n(170),s=n(150),c=(n(193),n(260),n(214),[]);window.lazies=0,window.nolazies=0;var u=function(e,t,n,r){return l(e,1,t,n,r)},l=function(e){var t,n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0,v=void 0,m=void 0,y=void 0,b=void 0,g=void 0;return function(){for(var O=arguments.length,j=new Array(O),k=0;k<O;k++)j[k]=arguments[k];var w=a.A.apply(void 0,[e].concat(j)),x=a.A.apply(void 0,[l].concat(j)),S=a.A.apply(void 0,[s].concat(j)),P=a.A.apply(void 0,[u].concat(j)),E=a.A.apply(void 0,[d].concat(j)),T=a.A.apply(void 0,[p].concat(j));if(P.forEach(function(e){return e.counter=0}),E&&E.forEach(function(e){return e.counter=0}),w===v&&m===S&&y===P&&t===E&&n===x&&(!g||g.length===T.length))return window.lazies++,b;if(g=T,v=w,m=S,n=x,t=E,y=P,x=x&&x.flat(16),void 0===v)return c;for(var A=Object(i.a)(S).apply(void 0,j).decide,M=void 0,R=[],C=0,N=[],I=function(){return x&&x[(C-1)%x.length]},q=function(){return x&&x[C%x.length]},_=function(e){return R[R.length-1]=e},D=void 0,F=0,L=!1,B=0,z=h(w),J=function(e,t,n){if(Array.isArray(e))return U(e,t);e.figureId!==D&&(F=0,D=e.figureId,0!==C&&B++),e.rules=[],L=!1,e=V(e);var r=f(e,o.u);if(e=r.reduce(function(e,n){return H(n,e,P,F,void 0,void 0,t)},e),M){e=f(M,o.o).reduce(function(e,n){return H(n,e,P,F,void 0,void 0,t)},e),e=(r=f(e,o.u)).reduce(function(e,n){return H(n,e,P,F,!1,!0,t)},e),R.push(e);var a=f(e,o.r);R[R.length-2]=a.reduce(function(e,n){return H(n,e,P,F,o.r,void 0,t)},M),e.accent&&_(H(Object(o.u)(o.a),e,P,F,void 0,void 0,t))}else R.push(e);if(x&&q()){var i=q(),s=f(i,o.u);e=s.reduce(function(e,n){return H(n,e,E,F,void 0,void 0,t)},e),I()&&(e=(s=f(I(),o.o)).reduce(function(e,n){return H(n,e,E,void 0,void 0,void 0,t)},e)),_(e)}L||(e=[Object(o.s)()].reduce(function(e,n){return H(n,e,P,F,void 0,void 0,t)},e),_(e));return M=e,C++,F++,e},V=function(e){N.forEach(function(e){return e.delay--});var t=N.filter(function(e){return 0===e.delay});return t.length>0&&(L=!0,e=t.reduce(function(e,t){return Object(o.q)(e,t)},e)),e},H=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P,a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,u=Object(o.p)(e,n,A,a,B,z,s),l=u.actions,f=u.delayedActions,h=u.matchedRules;N=[].concat(Object(r.a)(N),Object(r.a)(f)),(l.filter(function(e){return e.type&&"NOTHING"!==e.type}).length>0||f.length>0)&&(i||(L=!0));var d=(l=l.filter(function(e){return c.some(function(t){return t.type===e.type})})).reduce(function(e,t){return Object(o.q)(e,t)},t);return d.rules||(d.rules=[]),Array.isArray(d)&&d.filter(function(e){return!e.rules}).forEach(function(e){return e.rules=[]}),h.forEach(function(e){return Array.isArray(d)?d.map(function(t){return t.rules.push(e)}):d.rules.push(e)}),d},U=function(e,t){var n=function(){var e=R;return R=[],e}();t=t.filter(function(e){return"double"!==e.type});for(var r=0;r<e.length;r++){var a=e[r];J(a,t)}J(e[0],t),R.cycleLength=e.cycleLength,n.push(R),function(e){R=e}(n)},G=0;G<w.length;G++)J(w[G],T);J(w[0],T);var W=R.splice(R.length-1,1)[0];R[0]=W;for(var K=[],Q=0;Q<R.length;Q++)R[Q].doubled||R[Q].type&&"-"===R[Q].type.type?R[Q].doubled?(K.push(R[Q]),Q++):R[Q+1]&&R[Q+1].doubled?(K[K.length-1]=R[Q+1],Q++):K.push(R[Q]):K.push(R[Q]);return b=K,window.nolazies++,b}},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.u;if(Array.isArray(e))return[t(o.c)];var n=[t(o.b)];switch(e.type.type){case".":n.push(t(Object(s.c)()));break;case"-":n.push(t(Object(s.b)(e.type.value)))}return e.accent&&n.push(t(o.a)),e.staccato&&n.push(t(o.m)),e.legato&&n.push(t(o.e)),e.pianissimo&&n.push(t(o.h)),e.flam&&n.push(t(o.d)),e.piano&&n.push(t(o.i)),e.nudgeForward&&n.push(t(o.g)),e.nudgeBackward&&n.push(t(o.f)),null===e.transpose&&n.push(t(o.k)),n},h=function(e){for(var t=void 0,n=0,r=0;r<e.length;r++){var a=e[r];a.figureId!==t&&(t=a.figureId,n++)}return n}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"d",function(){return a}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"e",function(){return s}),n.d(t,"i",function(){return c}),n.d(t,"f",function(){return u}),n.d(t,"h",function(){return l}),n.d(t,"g",function(){return f});var r="FORWARD",a="REWIND",i="PAUSE",o="RESTART",s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return{name:"Forward",type:r,value:e}},c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return{name:"Rewind",type:a,value:e}},u=function(){return{name:"Pause",type:i}},l=function(){return{name:"Restart",type:o}},f=function(){return{name:"Play",type:"PLAY"}}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(11),a=n(114),i=n(151);Object(i.a)("sparse",{sparseness:"how dense the output should be (0-1)"},"Controls density of triggers by filtering out triggers. sparseness: 0-1 ");var o=function(e,t){var n=void 0,i={},o=void 0,s=function(e){(function(e){var t=0===e&&o!==e;return o=e,t})(e)&&(n=i,i={},0),i[e]||(i[e]=0),i[e]++};return function(){for(var t=arguments.length,o=new Array(t),c=0;c<t;c++)o[c]=arguments[c];var u=o[0],l=o[1],f=(o[2],o[3]),h=a.A.apply(void 0,[e].concat(o));if(l=function(e,t){if(function(e){return void 0!==e.track.envelopesTrack}(t)){var n=t.track,a=Math.max.apply(Math,Object(r.a)(n.tracks.map(function(e){return e.pattern.length()})));return n.sequencerEngine.trackStep%a}return e}(l,f),f.track.sequencerEngine.isLooping)return Object(a.w)(!0);if(!u)return Object(a.w)(!1);if(s(l),1===h||u.slide)return Object(a.w)(!0);var d=function(e,t){var n={};for(var r in e)n[r]=e[r]*t;var a=0;for(var i in n){var o=a+n[i];n[i]=Math.floor(o),a=o-Math.floor(o)}return n}(n||i,h);return i[l]>d[l]?Object(a.w)(!1):(0,Object(a.w)(!0))}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"}],name:"favoriteSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"}],name:"unfavoriteSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"sampleHash",type:"bytes32"}],name:"SampleFavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"sampleHash",type:"bytes32"}],name:"SampleUnfavorited",type:"event"}],this.contractAddress="0xcddbc9238e5ba4f6f4c0c8e0ef4231e1be4943fc"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"zequencerAddress",type:"address"},{indexed:!0,internalType:"address",name:"walletAddress",type:"address"},{indexed:!1,internalType:"string",name:"message",type:"string"},{indexed:!1,internalType:"uint8",name:"v",type:"uint8"},{indexed:!1,internalType:"bytes32",name:"r",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"s",type:"bytes32"}],name:"AccountAuthorized",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"zequencerAddress",type:"address"},{indexed:!0,internalType:"address",name:"walletAddress",type:"address"},{indexed:!1,internalType:"string",name:"message",type:"string"},{indexed:!1,internalType:"uint8",name:"v",type:"uint8"},{indexed:!1,internalType:"bytes32",name:"r",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"s",type:"bytes32"}],name:"AccountRevoked",type:"event"},{inputs:[{internalType:"address",name:"walletAddress",type:"address"},{internalType:"string",name:"message",type:"string"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"authorize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"walletAddress",type:"address"},{internalType:"string",name:"message",type:"string"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"revoke",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0xCB1a18e5e9cB53453f78fd5A2E378A3B81cBd4Ff"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"bytes32",name:"projectHash",type:"bytes32"},{internalType:"int16",name:"bpm",type:"int16"},{internalType:"bytes32",name:"thumbnail",type:"bytes32"},{internalType:"bytes32[]",name:"presetHash",type:"bytes32[]"},{internalType:"int8",name:"patterns",type:"int8"},{internalType:"bool",name:"hasArrangement",type:"bool"}],name:"newProjectMetadata",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"projectHash",type:"bytes32"},{indexed:!1,internalType:"int16",name:"bpm",type:"int16"}],name:"ProjectBPM",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"projectHash",type:"bytes32"}],name:"ProjectHasArrangement",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"projectHash",type:"bytes32"},{indexed:!1,internalType:"int8",name:"patterns",type:"int8"}],name:"ProjectPatternsCount",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"projectHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"presetHash",type:"bytes32"}],name:"ProjectUsesPreset",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"projectHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"thumbnailHash",type:"bytes32"}],name:"ProjectVisuals",type:"event"}],this.contractAddress="0xD3d9ee5d5467c1C9e4Ae3dA5e225882F46Bd45aA"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"creator",type:"address"},{indexed:!0,internalType:"uint256",name:"projectId",type:"uint256"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"maxInvocations",type:"uint256"},{indexed:!1,internalType:"string",name:"title",type:"string"}],name:"NewCreatorProject",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"projectId",type:"uint256"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"seedHash",type:"bytes32"}],name:"NewTokenSeed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"projectId",type:"uint256"},{internalType:"uint256",name:"n",type:"uint256"}],name:"getProjectTokenId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"idToProject",outputs:[{internalType:"address payable",name:"creator",type:"address"},{internalType:"bytes32",name:"contentHash",type:"bytes32"},{internalType:"uint256",name:"maxInvocations",type:"uint256"},{internalType:"uint256",name:"pricePerTokenInWei",type:"uint256"},{internalType:"uint256",name:"fromTokenId",type:"uint256"},{internalType:"uint256",name:"toTokenId",type:"uint256"},{internalType:"uint256",name:"invocations",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"projectId",type:"uint256"}],name:"mint",outputs:[],stateMutability:"payable",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"uint16",name:"maxInvocations",type:"uint16"},{internalType:"bool",name:"shouldMint",type:"bool"},{internalType:"uint256",name:"pricePerTokenInWei",type:"uint256"}],name:"newProject",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes",name:"_data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"index",type:"uint256"}],name:"tokenByIndex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"tokenIdToHash",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint256",name:"index",type:"uint256"}],name:"tokenOfOwnerByIndex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"_base",type:"string"}],name:"updateBaseTokenURI",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"percentage",type:"uint256"}],name:"updateFoundationPercentage",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"projectId",type:"uint256"},{internalType:"uint256",name:"price",type:"uint256"}],name:"updateProjectPrice",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x12DB0cE2da04E449550194587bC350aB8b3189d9"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!0,inputs:[{name:"user",type:"address"}],name:"getNumberOfFollowers",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"userB",type:"address"}],name:"unfollow",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"name",type:"string"}],name:"isUserNameAvailable",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"}],name:"getUserProfilePicture",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"profile",type:"bytes32"}],name:"setProfileHash",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"userB",type:"address"}],name:"follow",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"},{name:"index",type:"uint256"}],name:"getFollower",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"profilePicture",type:"bytes32"}],name:"setProfilePicture",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"name",type:"string"}],name:"getUserAddressFromName",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"}],name:"getUserProfile",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"name",type:"string"}],name:"setName",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"}],name:"getUserName",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"userAddress",type:"address"},{indexed:!0,name:"ipfsAddress",type:"bytes32"}],name:"ProfileIpfsHashUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"userAddress",type:"address"},{indexed:!0,name:"ipfsAddress",type:"bytes32"}],name:"ProfilePictureIpfsHashUpdated",type:"event"}],this.contractAddress="0xd0fb239ceb867bdcf68ae8331e911a9d4ec80632"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"previousHash",type:"bytes32"},{internalType:"bytes32",name:"newHash",type:"bytes32"},{internalType:"bytes32",name:"encryptedTitle",type:"bytes32"},{internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"editSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"},{internalType:"address",name:"encryptionAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"sequenceHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!1,internalType:"bytes32",name:"previousHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"encryptedTitle",type:"bytes32"},{indexed:!1,internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{indexed:!1,internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"NewGuildSequence",type:"event"}],this.contractAddress="0x15Da2ef01D9F881f694Be962Db28b76110fa195C"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!0,inputs:[{internalType:"uint32",name:"i",type:"uint32"}],name:"getGuildForSelf",outputs:[{internalType:"uint32",name:"",type:"uint32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"user",type:"address"}],name:"getTotalGuildsForUser",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"bytes32[6]",name:"guildPublicKey",type:"bytes32[6]"},{internalType:"string",name:"name",type:"string"},{internalType:"bytes32",name:"encryptedKeyIpfsHash",type:"bytes32"},{internalType:"bytes32[9]",name:"contentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"userPublicKey",type:"bytes32[6]"}],name:"newGuild",outputs:[{internalType:"uint32",name:"",type:"uint32"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"rejectRequestToAddToGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"setPublicKeyForGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"address",name:"member",type:"address"}],name:"isGuildMember",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"address",name:"potentialMember",type:"address"},{internalType:"bytes32",name:"encryptedKeyIpfsHash",type:"bytes32"},{internalType:"bytes32[9]",name:"contentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"requestToAddMember",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"getTotalGuildsForSelf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"acceptRequestToAddToGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"user",type:"address"},{internalType:"uint32",name:"i",type:"uint32"}],name:"getGuildForUser",outputs:[{internalType:"uint32",name:"",type:"uint32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"getTotalGuildUsers",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"getGuildName",outputs:[{internalType:"string",name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"string",name:"name",type:"string"}],name:"setNameForGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guild",type:"uint32"},{internalType:"uint32",name:"i",type:"uint32"}],name:"getUserFromGuild",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"encryptionContractAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"},{indexed:!1,internalType:"string",name:"name",type:"string"}],name:"NewGuild",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMember",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMemberRequest",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMemberRequestAccepted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMemberRequestRejected",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"GuildMemberLeft",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"",type:"uint32"},{indexed:!0,internalType:"bytes32[6]",name:"",type:"bytes32[6]"}],name:"GuildPublicKeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"},{indexed:!0,internalType:"bytes32",name:"",type:"bytes32"}],name:"GuildKeyEncrypted",type:"event"}],this.contractAddress="0x70548646c2A475ebfE46F19637651e76a38324d4"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sharedWith",type:"address"},{name:"contentHash",type:"bytes32"},{name:"encryptedContentKey",type:"bytes32[9]"},{name:"publicKey",type:"bytes32[6]"}],name:"shareEncryptedContentWith",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"publicKey",type:"bytes32[6]"}],name:"setPublicKey",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"previousContentHash",type:"bytes32"},{name:"newContentHash",type:"bytes32"},{name:"encryptedName",type:"bytes32"},{name:"contentType",type:"int8"},{name:"encryptedContentKey",type:"bytes32[9]"},{name:"publicKey",type:"bytes32[6]"}],name:"newEncryptedContent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"hasPublicKey",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!1,name:"publicKey",type:"bytes32[6]"}],name:"NewPublicKey",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!1,name:"previousContent",type:"bytes32"},{indexed:!0,name:"newContent",type:"bytes32"},{indexed:!0,name:"contentType",type:"int8"},{indexed:!1,name:"encryptedName",type:"bytes32"},{indexed:!1,name:"contentKey",type:"bytes32[9]"},{indexed:!1,name:"publicKey",type:"bytes32[6]"}],name:"NewEncryptedContent",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sharedWith",type:"address"},{indexed:!0,name:"creator",type:"address"},{indexed:!0,name:"contentHash",type:"bytes32"},{indexed:!1,name:"contentKey",type:"bytes32[9]"},{indexed:!1,name:"publicKey",type:"bytes32[6]"}],name:"EncryptedContentShared",type:"event"}],this.contractAddress="0xbe559f9f38c5f36186b364972cb8b4ebd7174043"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"foldersHash",type:"bytes32"}],name:"foldersUpdated",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"foldersHash",type:"bytes32"}],name:"FoldersUpdated",type:"event"}],this.contractAddress="0x20039b89449aC0bAB5B4114Bf66aCff1b3043988"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"address",name:"toUser",type:"address"},{internalType:"bytes32",name:"referenceHash",type:"bytes32"},{internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"sendPublicMessage",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"deleteMessage",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"fromUser",type:"address"},{indexed:!0,internalType:"address",name:"toUser",type:"address"},{indexed:!0,internalType:"bytes32",name:"referencedHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"PublicMessageSent",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"PublicMessageDeleted",type:"event"}],this.contractAddress="0xb407EFd2254583C8BF99c578c7b891313AC1933E"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"address",name:"samplesAddress",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"resampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"sampleUsed",type:"bytes32"}],name:"NewResample",type:"event"},{inputs:[{internalType:"bytes32",name:"resampleHash",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"bytes32[4]",name:"tags",type:"bytes32[4]"},{internalType:"bytes32[]",name:"samplesUsedHashes",type:"bytes32[]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newResample",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0xD914528749Fcfc2945148551d0F61AfDFe429962"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"address",name:"guildsAddress",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"effectHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"effectType",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"tag",type:"bytes32"}],name:"EffectTagged",type:"event"},{inputs:[{internalType:"bytes32",name:"effectHash",type:"bytes32"},{internalType:"bytes32",name:"effectType",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newEffect",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"effectHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"effectType",type:"bytes32"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!1,internalType:"uint32",name:"guildId",type:"uint32"}],name:"NewEffect",type:"event"},{inputs:[{internalType:"bytes32",name:"effectHash",type:"bytes32"},{internalType:"bytes32",name:"effectType",type:"bytes32"},{internalType:"bytes32",name:"tag",type:"bytes32"}],name:"tagEffect",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x133F927E9d1b94e6f274eAa4eEE21d29c65782B4"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"name",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"linkType",type:"bytes32"},{indexed:!1,internalType:"string",name:"link",type:"string"}],name:"ArtistInfo",type:"event"},{inputs:[{internalType:"bytes32",name:"artistName",type:"bytes32"},{internalType:"address",name:"user",type:"address"}],name:"claimArtist",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"}],name:"deleteSampleByArtist",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"artistName",type:"bytes32"},{internalType:"bytes32",name:"linkType",type:"bytes32"},{internalType:"string",name:"link",type:"string"}],name:"newArtistInfo",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"artistName",type:"bytes32"},{internalType:"uint32",name:"releaseId",type:"uint32"},{internalType:"string",name:"releaseName",type:"string"},{internalType:"bytes32",name:"coverArtHash",type:"bytes32"},{internalType:"bytes32",name:"releaseType",type:"bytes32"}],name:"newRelease",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"artistName",type:"bytes32"},{internalType:"bytes32",name:"ipfsHash",type:"bytes32"}],name:"newSampleByArtist",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"artistName",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"releaseId",type:"uint32"},{indexed:!1,internalType:"string",name:"releaseName",type:"string"},{indexed:!1,internalType:"bytes32",name:"coverArtHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"releaseType",type:"bytes32"}],name:"ReleaseInfo",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"artistName",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"}],name:"SampleByArtist",type:"event"},{inputs:[{internalType:"bytes32",name:"artistName",type:"bytes32"}],name:"unclaimArtist",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x0C8aB6a2ED347F076ed69f9eBf05967a8A889400"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"address",name:"guildContractAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"guildId",type:"uint256"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"UserChoseDefaultGuild",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"guildId",type:"uint256"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"UserLeftGuild",type:"event"},{constant:!1,inputs:[{internalType:"bytes32[6]",name:"guildPublicKey",type:"bytes32[6]"},{internalType:"string",name:"guildName",type:"string"},{internalType:"bytes32",name:"encryptedKeyIpfsHash",type:"bytes32"},{internalType:"bytes32[9]",name:"contentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"userPublicKey",type:"bytes32[6]"}],name:"createGuildWithPeople",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint256",name:"guildId",type:"uint256"}],name:"leaveGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint256",name:"guildId",type:"uint256"}],name:"userChoseDefaultGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x1775E7d49D41b01c2D5811ED51ee2d22c9706f86"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"bytes32",name:"packHash",type:"bytes32"},{internalType:"bytes32",name:"previousHash",type:"bytes32"},{internalType:"bytes32[]",name:"contentHashes",type:"bytes32[]"},{internalType:"bytes32",name:"title",type:"bytes32"}],name:"newPack",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"packHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"previousHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"title",type:"bytes32"}],name:"NewPack",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"packHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"PackHasContent",type:"event"}],this.contractAddress="0xF7bd2ada59c4ab5AD0f6BFbE94EB4f8eCa18eEDd"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"bytes32",name:"scriptHash",type:"bytes32"},{internalType:"bytes32",name:"scriptType",type:"bytes32"},{internalType:"bytes32",name:"title",type:"bytes32"}],name:"newScript",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"scriptHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"scriptType",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"title",type:"bytes32"}],name:"NewScript",type:"event"}],this.contractAddress="0xA6FF112D42c50FEE6c212B775721185f82285844"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}()},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sequenceHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"}],name:"SampleInSequence",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"previousSequence",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"newSequence",type:"bytes32"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!1,internalType:"uint32",name:"bpm",type:"uint32"}],name:"SequenceEdited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"projectHash",type:"bytes32"},{indexed:!0,internalType:"uint256",name:"zoraTokenId",type:"uint256"}],name:"ZoraProject",type:"event"},{inputs:[{internalType:"bytes32",name:"previousSequence",type:"bytes32"},{internalType:"bytes32",name:"newSequence",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"bytes32[]",name:"samples",type:"bytes32[]"},{internalType:"uint32",name:"bpm",type:"uint32"}],name:"editSequence",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"projectHash",type:"bytes32"},{internalType:"uint256",name:"zoraTokenId",type:"uint256"}],name:"zoraProject",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x27Fd050dF7c0c603A407f1BC4fd0ED634824270E"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"skinId",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"imageHash",type:"bytes32"}],name:"NewSkin",type:"event"},{inputs:[{internalType:"bytes32[]",name:"skinImages",type:"bytes32[]"}],name:"newSkins",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x723B26f588C57b393C8f6793796A82F479010C85"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),o=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(a.a)(this,e),this.name=t,this.parent=n,this.subFolders=[],this.items=[],this.depth=r}return Object(i.a)(e,[{key:"isDynamic",value:function(){return!1}},{key:"isRoot",value:function(){return void 0===this.parent}},{key:"addItem",value:function(e){e.parent=this,this.items.push(e)}},{key:"deleteItem",value:function(e){var t=this.items.indexOf(e);if(t>-1)return e.parent=void 0,this.items.splice(t,1),e}},{key:"deleteFolder",value:function(e){var t=this.subFolders.indexOf(e);if(t>-1)return this.subFolders.splice(t,1),e}},{key:"delete",value:function(){void 0!==this.parent&&this.parent.deleteFolder(this)}},{key:"newFolder",value:function(t){var n=new e(t,this,this.depth+1);return this.subFolders.push(n),n}},{key:"addFolder",value:function(e){e.depth=this.depth+1,this.subFolders.push(e)}},{key:"getJson",value:function(){return{name:this.name,subFolders:this.subFolders.map(function(e){return e.getJson()}),items:this.items.map(function(e){return e.getJson()})}}},{key:"fromJson",value:function(t,n){var r=this;return this.name=t.name,this.items=t.items.map(function(e){return n(e)}),this.items.forEach(function(e){return e.parent=r}),this.subFolders=t.subFolders.map(function(t){return new e(void 0,r,r.depth+1).fromJson(t,n)}),this}},{key:"getAllItems",value:function(){var e=Object(r.a)(this.items);for(var t in this.subFolders)e=e.concat(this.subFolders[t].getAllItems());return e}}]),e}();t.a=o},function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return a});var r=1,a=2},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=function(){function e(t,n){Object(o.a)(this,e),this.currentPromise=t,this.nextPromise=n}return Object(s.a)(e,[{key:"getCurrent",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.currentPromise();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getNext",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.nextPromise;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=c},function(e,t,n){"use strict";var r=n(11),a=n(42),i=n.n(a),o=n(56),s=n(4),c=n(5),u=n(7),l=n(8),f=n(2),h=n(271),d=n.n(h),p=n(206),v=n(162),m=n(122),y=n(127);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var g=function(e){Object(u.a)(n,e);var t=b(n);function n(e,r,a,i,o){var c;return Object(s.a)(this,n),(c=t.call(this)).decentralized=e,c.ipfsHash=a,c.sequenceId=r,c.data=i,c.title=o,c}return Object(c.a)(n,[{key:"getName",value:function(){return this.title}},{key:"getId",value:function(){return this.ipfsHash}},{key:"save",value:function(e,t,n,r,a,s,c){var u=this;return new Promise(function(){var n=Object(o.a)(i.a.mark(function n(r,a){var o,c;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,m.a.addJson(t,void 0,s);case 2:o=n.sent,c=void 0;case 4:if(c){n.next=21;break}return n.prev=5,n.next=8,m.a.getJson();case 8:if(!(c=n.sent)){n.next=11;break}return n.abrupt("break",21);case 11:return n.next=13,m.a.addJson(t,void 0,s);case 13:o=n.sent,n.next=19;break;case 16:n.prev=16,n.t0=n.catch(5),c=void 0;case 19:n.next=4;break;case 21:r({ipfsHash:o}),"export"!==e&&u.saveToLocalStorage(e,o);case 24:case"end":return n.stop()}},n,null,[[5,16]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"saveToLocalStorage",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var a,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&""!==t){e.next=2;break}return e.abrupt("return");case 2:return a=(a=p.a.getItem("sequences"))?JSON.parse(a):[],e.next=6,v.a.eth.getBlockNumber();case 6:o=e.sent,a=[{title:t,hash:n,blockNumber:o}].concat(Object(r.a)(a)),p.a.setItem("sequences",JSON.stringify(a));case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadTitle",value:function(){var e=this;return new Promise(function(t,n){y.a.tokenizedSequences.getSequence(e.ipfsHash).then(function(e){return t(e[0]&&e[0].title)})})}},{key:"load",value:function(){var e=this;return new Promise(function(t,n){e.data?t(JSON.parse(e.data)):e.decentralized&&void 0!==e.ipfsHash?m.a.getJson(e.ipfsHash).then(function(e){return t(e)}):d.a.get("/sequence/"+e.sequenceId).then(function(e){return t(e.data.data)})})}}]),n}(n(538).a);t.a=g},,function(e,t,n){"use strict";(function(e){var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(817),u=(n(206),n(159)),l=n(122),f=new c.a,h=n(189),d=function(){function e(t){Object(o.a)(this,e),this.web3=t,this.cachedUserNames={}}return Object(s.a)(e,[{key:"isUserNameAvailable",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var o,s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.a.getAccount();case 2:return n.sent,o=f.getContract(t.web3),n.prev=4,n.next=7,o.methods.isUserNameAvailable(e).call();case 7:s=n.sent,r(s),n.next=15;break;case 11:n.prev=11,n.t0=n.catch(4),console.log(n.t0),i(n.t0);case 15:case"end":return n.stop()}},n,null,[[4,11]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getUserId",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var o,s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",r(1));case 3:return n.sent,o=f.getContract(t.web3),n.prev=5,n.next=8,o.methods.getUserAddressFromName(e).call();case 8:s=n.sent,r(s),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(5),console.log(n.t0),i(n.t0);case 16:case"end":return n.stop()}},n,null,[[5,12]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"setUserName",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var o;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=f.getContract(t.web3),n.t0=o.methods.setName(e),n.next=4,u.a.getAccount();case 4:n.t1=n.sent,n.t2={from:n.t1},n.t3=function(e,t){e?i(e):r()},n.t0.send.call(n.t0,n.t2,n.t3);case 8:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"setProfile",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var o,s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o.getACCOUNT();case 2:return o=n.sent,n.next=5,l.a.addJson(e);case 5:s=p(s=n.sent),f.getContract(t.web3).methods.setProfileHash(s).send({from:o[0]},function(e,t){e?i(e):r()});case 9:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getUserName",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var o,s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",r("none"));case 5:if(window.isNFT||!(void 0).getItem("username:"+e)){n.next=8;break}return r((void 0).getItem("username:"+e)),n.abrupt("return");case 8:if(void 0!==e&&""!==e){n.next=12;break}return n.next=11,u.a.getAccount();case 11:e=n.sent;case 12:if(void 0!==e){n.next=15;break}return r(void 0),n.abrupt("return");case 15:if(!(e in t.cachedUserNames)){n.next=18;break}return r(t.cachedUserNames[e]),n.abrupt("return");case 18:return o=f.getContract(t.web3),n.prev=19,n.next=22,o.methods.getUserName(e).call();case 22:if(s=n.sent,(void 0).setItem("username:"+e,s),""!==s){n.next=27;break}return r(void 0),n.abrupt("return");case 27:t.cachedUserNames[e]=s,r(s),n.next=34;break;case 31:n.prev=31,n.t0=n.catch(19),i(n.t0);case 34:case"end":return n.stop()}},n,null,[[19,31]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getProfile",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var o,s,c,h;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==e){n.next=8;break}return n.next=3,u.a.getAccount();case 3:if(void 0!==(o=n.sent)){n.next=7;break}return i("no ethereum"),n.abrupt("return");case 7:e=o;case 8:return s=f.getContract(t.web3),n.next=11,s.methods.getUserProfile(e).call();case 11:if(c=n.sent,n.prev=12,0!==t.web3.utils.hexToNumber(c)){n.next=16;break}return r("no profile"),n.abrupt("return");case 16:n.next=21;break;case 18:n.prev=18,n.t0=n.catch(12),console.log("had error while trying to get profile");case 21:return c=v(c),n.next=24,l.a.getJson(c);case 24:h=n.sent,r(h);case 26:case"end":return n.stop()}},n,null,[[12,18]])}));return function(e,t){return n.apply(this,arguments)}}())}}]),e}();function p(e){var t=h.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}function v(t){var n=new e(t.replace(/^0x/,"1220"),"hex");return h.encode(n)}t.a=d}).call(this,n(110).Buffer)},function(e,t,n){"use strict";function r(e){for(var t=e.length-1;t>=0;t--)if("0"!==e.slice(t,t+1))return e.slice(0,t+1)}function a(e){for(var t=0;t<e.length;t++)if("0"!==e.slice(t,t+1))return e.slice(t)}n.d(t,"b",function(){return r}),n.d(t,"a",function(){return a})},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(1),o=n(56),s=n(4),c=n(5),u=n(837),l=function(){function e(t){Object(s.a)(this,e),this.crypto=t}return Object(c.a)(e,[{key:"decryptQueryResult",value:function(){var e=Object(o.a)(a.a.mark(function e(t,n){var r,o,s,c,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("query decryptor"),r=Object(u.b)(t.encryptedContentKey),e.next=4,this.crypto.decryptName(t.encryptedName,r,n);case 4:return o=e.sent,s=t.user,e.next=8,this.crypto.decryptContentKey(r,n);case 8:return c=e.sent,l=Object(i.a)({},t,{title:Object(u.b)(o),encryptedTitle:t.encryptedName,user:"0x"+Object(u.a)(s.slice(2)),contentKey:c?c.contentKey:void 0,publicKey:Object(u.b)(t.publicKey)}),e.abrupt("return",l);case 11:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.a=l},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(11);function a(e){return(e=Object(r.a)(e)).sort(),e[Math.floor(e.length/2)]}},,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(11),a=n(114),i=n(151);function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(i.a)("delay",{rate:"The rate in 1/32th notes that it repeats",repeats:"Number of times it repeats"},"Simple midi delay function");var c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[];return function(i,s,c){var u=i&&{stepData:i,stepNumber:s,time:c,repeats:Object(a.A)(t,i,s,c)},l=Object(a.A)(e,i||n[0],s,c),f=[],h=[];console.log("rate= ",l);var d,p=o(n);try{for(p.s();!(d=p.n()).done;){var v=d.value;Math.abs(s-v.stepNumber)%l===0&&(v.repeats--,f.push({stepData:v.stepData,time:c,stepNumber:s})),v.repeats>0&&h.push(v)}}catch(m){p.e(m)}finally{p.f()}return n=h,u&&n.push(u),u||0!==f.length?(u&&(f=[].concat(Object(r.a)(f),[u])),f.length>0?Object(a.R)(f):Object(a.w)(!1)):Object(a.w)(!1)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(114),a=n(151);Object(a.a)("poly",{args:"Arguments to be evaluated"},"Splits a chord among the arguments passed. poly(switchOutput(0), switchOutput(1)) will send half the notes in a chord to output 0 and the others to output 1");var i=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=void 0,i=void 0;return function(e,n,o){return i!==n&&(a=-1),a++,i=n,Object(r.A)(t[a%t.length],e,n,o)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(6),a=n.n(r),i=function(e){return 69+12*Math.log2(e/a.a.Frequency.A4)-60}},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=n(139),h=n(6),d=n.n(h),p=n(326),v=n(288),m=n(14),y=(n(23),n(451),n(134));function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var g=function(e){Object(c.a)(n,e);var t=b(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Control Parameters",e)).setupRampParameters(),r.counter=-1,r.listParameter=new m.a("list",Object(o.a)(r),function(){return[]},{defaultValue:[0],min:0,max:1}),r.registerParameter(r.listParameter),r.setupNodeMessaging(),r.newInlet("list",function(e){return r.onListMessage(e)}),r.newOutlet("value"),r}return Object(i.a)(n,[{key:"onListMessage",value:function(e){this.listParameter.set(e[0])}},{key:"getText",value:function(){return""}},{key:"valueList",get:function(){return this.listParameter.get()},set:function(e){this.listParameter.set(Object(r.a)(e))}},{key:"stop",value:function(){Object(s.a)(Object(l.a)(n.prototype),"stop",this).call(this),this.counter=-1}},{key:"clear",value:function(){Object(s.a)(Object(l.a)(n.prototype),"clear",this).call(this),this.counter=-1}},{key:"output",value:function(e,t){var n=this;if(!this.track.sequencerEngine.playing)return this.triggers;if(0===t&&this.resetAtZero&&0!==this.counter&&(this.stop(),this._clear()),0===this.triggers.length)return this.triggers;this.counter++;var r=this.valueList[this.counter%this.valueList.length];return setTimeout(function(){n.sendMessage("value",r)},1e3*(e-d.a.Master.context.currentTime)),this.setParameterValues(e),this.triggers}},{key:"getParameterValueToSet",value:function(e){var t=this.valueList[this.counter%this.valueList.length];return this.initialParameterValues[e]+t*(this.getDepth(e)/100)}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(Object(v.a)(Object(p.a)(Object(y.a)(f.a))));t.a=g},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(310),a=function(e,t,n,a){return Object(r.b)()<e/n?e-.75*Object(r.b)()*(e-t)*a:e+.75*(n-e)*a*Object(r.b)()}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){return e*(Math.PI/180)}},function(e,t,n){"use strict";n.d(t,"a",function(){return d}),n.d(t,"b",function(){return p});var r=n(1),a=n(161),i=n(16);function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=n(200).c,u=Math.cos,l=Math.sin,f=void 0,h=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];for(var s=i[0],f=a.a.apply(void 0,[t].concat(i)),d=c().apply(void 0,i),p=d.x,v=d.y,m=d.diameter,y={},b=Math.PI,g=m/2*a.a.apply(void 0,[e].concat(i)),O=Object.keys(s).length,j=Object.keys(s).map(function(e){return Object(r.a)({},s[e],{id:e})}),k=function(e){var t,n,r,a=2*b*(e/O),i={x:p+g*u(a),y:v+g*l(a)},o=j.sort(function(e,t){return h(e,i)-h(t,i)}),c=o[0].id;y[c]=(t=i,n=s[c],{x:(r=f)*t.x+(1-r)*n.x,y:r*t.y+(1-r)*n.y}),j=o.slice(1)},w=1;w<=O;w++)k(w);return y}},p=function(e,t){return function(){var n=arguments.length<=6?void 0:arguments[6];if(!f){var a=document.createElement("canvas");a.width=i.c,a.height=i.a,f=a.getContext("2d")}var s=n.macros.find(function(t){return t.number===e}),c=n.macros.find(function(e){return e.number===t});if(!s||!c)return arguments.length<=0?void 0:arguments[0];var u,l=new Path2D(s.getEasyBlob()),h=(new Path2D(c.getEasyBlob()),c.parameters.map(function(e){return e.id})),d=Object(r.a)({},arguments.length<=0?void 0:arguments[0]),p=o(h);try{for(p.s();!(u=p.n()).done;){var v=u.value,m=d[v];if(m){for(var y=m.x,b=m.y,g=0;f.isPointInPath(l,y,b)&&g++<25;)y=(y+5)%i.c,b=(b+5)%i.a;d[v]=Object(r.a)({},d[v],{x:y,y:b})}}}catch(O){p.e(O)}finally{p.f()}return d}}},function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"a",function(){return u});var r=n(1),a=n(161),i=n(16);function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=function(e,t,n){return function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];i[0];for(var s=a.a.apply(void 0,[e].concat(i)),c=a.a.apply(void 0,[t].concat(i)),u=n?a.a.apply(void 0,[n].concat(i)):c+1,l={},f=Object.keys(s),h=c;h<u;h++){var d=h%f.length;l[f[d]]=s[f[d]]}return l}},u=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return function(){for(var t=arguments.length,s=new Array(t),c=0;c<t;c++)s[c]=arguments[c];var u,l=n.map(function(e){return a.a.apply(void 0,[e].concat(s))}),f=a.a.apply(void 0,[e].concat(s)),h=Object(r.a)({},s[0]),d=o(l);try{var p=function(){var e=u.value,t=l[0];if(t===e)return"continue";var n=Object.keys(e),a=Object.keys(t);n.forEach(function(e,n){h[e]=Object(r.a)({},t[a[n%a.length]]),h[e].x=f*(h[e].x-i.b)+i.b,h[e].y=f*(h[e].y-i.b)+i.b})};for(d.s();!(u=d.n()).done;)p()}catch(v){d.e(v)}finally{d.f()}return h}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(161),a=n(16),i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var o=r.a.apply(void 0,[e].concat(n)),s={},c=0;for(var u in n[0]){var l=n[0][u];l&&(s[u]={x:(l.x+c*o)%a.c,y:(l.y+c*o)%a.a},c++)}return s}}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});n(278);var r=n(161);function a(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var o=n[0],s=n[6],c={},u=function(e){var i,u=!1,l=a(t);try{var f=function(){var t=i.value;return t=r.a.apply(void 0,[t].concat(n)),(t=s.macros.find(function(e){return e.number===t}))?t.parameters.some(function(t){return t.id===e})?(u=!0,"break"):void 0:"continue"};for(l.s();!(i=l.n()).done;){var h=f();if("continue"!==h&&"break"===h)break}}catch(d){l.e(d)}finally{l.f()}u&&(c[e]=o[e])};for(var l in o)u(l);return c}}},function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"e",function(){return i}),n.d(t,"d",function(){return o}),n.d(t,"c",function(){return s}),n.d(t,"f",function(){return c}),n.d(t,"a",function(){return u}),n.d(t,"g",function(){return l});n(1),n(11),n(278);var r=n(161),a=function(e,t,n){return function(){for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return r.a.apply(void 0,[e].concat(i))?r.a.apply(void 0,[t].concat(i)):void 0===n?i[0]:r.a.apply(void 0,[n].concat(i))}},i=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var o=r.a.apply(void 0,[e].concat(a));r.a.apply(void 0,[t].concat(a));return o<=t}},o=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var o=r.a.apply(void 0,[e].concat(a));r.a.apply(void 0,[t].concat(a));return o>=t}},s=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var o=r.a.apply(void 0,[e].concat(a));r.a.apply(void 0,[t].concat(a));return o===t}},c=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var o=r.a.apply(void 0,[e].concat(a));r.a.apply(void 0,[t].concat(a));return o!==t}},u=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var o=r.a.apply(void 0,[e].concat(a));r.a.apply(void 0,[t].concat(a));return o&&t}},l=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var o=r.a.apply(void 0,[e].concat(a));r.a.apply(void 0,[t].concat(a));return o||t}}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(200),a=function(){var e=void 0;return function(){var t=arguments.length<=0?void 0:arguments[0],n=Object.keys(t).map(function(e){return t[e]}).filter(function(e){return e});if(0===n.length)return e||0;var a=Object(r.e)(n),i=a.x,o=a.y;if(e){var s=Math.sqrt(Math.pow(i-e.x,2)+Math.pow(o-e.y,2));return e={x:i,y:o},s}return e={x:i,y:o},0}}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(1),a=n(201),i=n(161);Object(a.a)("source",{x:"",y:""},"Transforms parameter to (x,y) coordinate");var o=function(e,t){return function(n){for(var a={},o=arguments.length,s=new Array(o>1?o-1:0),c=1;c<o;c++)s[c-1]=arguments[c];var u=i.a.apply(void 0,[e,n].concat(s)),l=i.a.apply(void 0,[t,n].concat(s));for(var f in n)a[f]=Object(r.a)({},n[f],{x:u,y:l});return a}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});n(277);var r=n(161),a=(n(360),n(278)),i=function(e){var t=void 0,n=0;return function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];var c=Object(a.a)(o),u=c.coords,l=(c.stepNumber,c.history);void 0===t&&(t=l.length-1);var f=t-r.a.apply(void 0,[e].concat(o));if(f<0)return t=void 0,u;var h=l.slice(f,t);return h[++n%h.length]}}},function(e,t,n){"use strict";n.d(t,"c",function(){return l}),n.d(t,"b",function(){return f}),n.d(t,"a",function(){return h});var r=n(11),a=n(1),i=n(161),o=n(278),s=n(201);function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(s.a)("snapshot",{snapNumber:""},"Go to snapshot given in argument");var l=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=Object(o.a)(n).effect,s=i.a.apply(void 0,[e].concat(n));return a.currentSnapshotParameter.set(s),{}}};Object(s.a)("nextSnapshot",{},"Go to next snapshot-- looping back to first snapshot if at the end.");var f=function(){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Object(o.a)(t).effect,a=r.currentSnapshotParameter.get()||0;return r.currentSnapshotParameter.set((a+1)%r.snapshots.length),{}}};Object(s.a)("interpolateSnapshot",{snapshotNumber:"",percentage:"how much of the snapshot to use"},"Go to next snapshot-- looping back to first snapshot if at the end.");var h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];var u=Object(o.a)(r),l=u.coords,f=u.effect,h=i.a.apply(void 0,[e].concat(r)),d=i.a.apply(void 0,[t].concat(r)),p=f.snapshots[h%f.snapshots.length];if(!p)return l;var v,y=m(p,l).slice(0,Math.floor(p.length*(d/50))),b=Object(a.a)({},l),g=c(y);try{for(g.s();!(v=g.n()).done;){var O=v.value,j=O.parameter,k=O.coordinates,w=O.min,x=O.max;j.id in l&&(void 0!==w&&void 0!==x&&(j.min=w,j.max=x),b[j.id]=k)}}catch(S){g.e(S)}finally{g.f()}return b}},d=function(e){return e*e},p=Math.sqrt,v=function(e,t){return p(d(e.x-t.x)+d(e.y-t.y))},m=function(e,t){return(e=Object(r.a)(e)).filter(function(e){return e.parameter.id in t}).sort(function(e,n){return v(n.coordinates,t[n.parameter.id])-v(e.coordinates,t[e.parameter.id])})}},function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return h}),n.d(t,"c",function(){return d});var r=n(11),a=n(1),i=n(278),o=n(161),s=n(249);function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=Object(s.b)();return function(){for(var e=arguments.length,n=new Array(e),c=0;c<e;c++)n[c]=arguments[c];var u=Object(i.a)(n).effect,l=(Object(i.a)(n).history,Object(i.a)(n).coords);l=Object(s.a)(o,l,n.slice(1));var h={};for(var d in l){var p=f(d,u);if(p){var v=p.context,m=v.subDevice||v.subDevice||v.device||v.track||v.lfoTrack;if(m){var y=m.id||m.name||m.number;y&&(h[y]||(h[y]={}),h[y][d]=l[d])}}}var b={};for(var g in h)b=Object(a.a)({},b,t[0%t.length].apply(t,[h[g]].concat(Object(r.a)(n.slice(1)))));return b}},f=function(e,t){var n,r=c(t.groups);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(e in a.idToParameter)return a.idToParameter[e]}}catch(i){r.e(i)}finally{r.f()}},h=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=Object(i.a)(n).coords,s=o.a.apply(void 0,[e].concat(n)),c={};for(var u in a)u in s||(c[u]=a[u]);return c}},d=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a={};return function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];var s=Object(i.a)(n).effect,u=Object(i.a)(n).history,l=Object(i.a)(n).coords;u.length<1&&(a={});var f,h=[],d=c(t);try{for(d.s();!(f=d.n()).done;){var v=f.value;v in a||(a[v]=s._parameters.filter(p(v))),h=[].concat(Object(r.a)(h),Object(r.a)(a[v]))}}catch(b){d.e(b)}finally{d.f()}var m=new Set(h.map(function(e){return e.id})),y={};return m.forEach(function(e){return y[e]=l[e]}),y}},p=function(e){return function(t){return e=e.toLowerCase(),v(t).some(function(t){return t.includes(e)})}},v=function(e){var t=[];return e.context&&(e.context.subDevice&&e.context.subDevice.name&&t.push(e.context.subDevice.name.toLowerCase()),e.context.effect&&e.context.effect.name&&t.push(e.context.effect.name.toLowerCase()),e.context.midiEffect&&e.context.midiEffect.name&&t.push(e.context.midiEffect.name.toLowerCase())),e.name&&t.push(e.name.toLowerCase()),t}},function(e,t,n){"use strict";n.d(t,"b",function(){return s}),n.d(t,"a",function(){return c});var r=n(259),a=n(136),i=n(161),o=n(201);Object(o.a)("send",{type:"",value:""},"Publishes a message of a given type with a value");var s=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];var s=i.a.apply(void 0,[e].concat(r)),c=i.a.apply(void 0,[t].concat(r));return Object(a.c)(s,c),r[0]}};Object(o.a)("receive",{type:"",function:"","skipEmpty=true":""},"Receives a message and calls a function when it does");var c=function(e,t){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n=Object(r.a)(e);return function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];var o=n();return t&&o.map(function(e){return"function"===typeof t?i.a.apply(void 0,[t].concat(r)):t})[0]||r[0]}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(1),a=n(161),i=n(16),o=n(201);Object(o.a)("translate",{x:"",y:""},"Translate parameters by (x,y) amount");var s=function(e,t){return function(){for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];var c=a.a.apply(void 0,[e].concat(o)),u=a.a.apply(void 0,[t].concat(o)),l=o[0],f={};for(var h in l)if(l[h]){var d=c/(l[h].density||1),p=u/(l[h].density||1);f[h]=Object(r.a)({},l[h],{x:(l[h].x+d)%i.c,y:(l[h].y+p)%i.a})}return f}}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var u=new(n(124).a);t.a=function(e){return function(e){Object(i.a)(n,e);var t=c(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).color="#ffffff",e}return Object(a.a)(n,[{key:"initColor",value:function(){this.color=u.getColorForHash(this.id)}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(11);function a(e,t){if(e=Object(r.a)(e),Array.isArray(e[0])||(e=e.map(function(e){return[e.x,e.y]})),t){var n=e[e.length-1],a=e[e.length-2],i=e[0],o=e[1];e.unshift(n),e.unshift(a),e.push(i),e.push(o)}return e.flat()}function i(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=(e=a(e,n)).length,o=i-4,s=n?e[2]:e[0],c=n?e[3]:e[1],u=[[s,c]],l="M"+[s,c],f=n?i-4:i-2,h=n?2:0;h<f;h+=2){var d=h?e[h-2]:e[0],p=h?e[h-1]:e[1],v=e[h+0],m=e[h+1],y=e[h+2],b=e[h+3],g=v+(y-d)/6*t,O=m+(b-p)/6*t,j=y-((h!==o?e[h+4]:y)-v)/6*t,k=b-((h!==o?e[h+5]:b)-m)/6*t;l+="C"+[g,O,j,k,y,b],u.push([g,O,j,k,y,b])}return r?u:l}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return ScaleEffect});var _Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(31),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_get__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(10),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(7),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(8),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(2),_MidiEffect_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(139),tone__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(6),tone__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(tone__WEBPACK_IMPORTED_MODULE_9__),utils_IsNumber_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(43),parameters_AbstractParameter_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(14),parameters_parameterJsonFunctions_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(128),_utils_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(843),_scales_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(1680);function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(e);if(t){var a=Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_6__.a)(this,n)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DEFAULT_NOTE=tone__WEBPACK_IMPORTED_MODULE_9___default.a.Frequency("C4"),ScaleEffect=function(_MidiEffect){Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_5__.a)(ScaleEffect,_MidiEffect);var _super=_createSuper(ScaleEffect);function ScaleEffect(e){var t;return Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__.a)(this,ScaleEffect),(t=_super.call(this,"Scale",e)).scaleParameter=new parameters_AbstractParameter_js__WEBPACK_IMPORTED_MODULE_11__.a("scale",Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_3__.a)(t),function(e,t){return[]},{defaultValue:_scales_js__WEBPACK_IMPORTED_MODULE_14__.a}),t.registerParameter(t.scaleParameter),t.referencePitchParameter=new parameters_AbstractParameter_js__WEBPACK_IMPORTED_MODULE_11__.a("referencePitch",Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_3__.a)(t),function(e,t){return[]},{defaultValue:195.99771799087463}),t.registerParameter(t.referencePitchParameter),t.subsetParameter=new parameters_AbstractParameter_js__WEBPACK_IMPORTED_MODULE_11__.a("subset",Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_3__.a)(t),function(e,t){return[]},{defaultValue:[!0,!0,!0,!0,!0,!0,!0]}),t.registerParameter(t.subsetParameter),t}return Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_2__.a)(ScaleEffect,[{key:"documentation",get:function(){return["Forces the notes to a scale. The scale can be defined using ratios where 1 is the base note, and 2 is the octave.","Can drag and drop a scala file with custom micro-tunings."]}},{key:"subset",get:function(){return this.subsetParameter.get()},set:function(e){this.subsetParameter.set(e)}},{key:"scale",get:function(){return this.scaleParameter.get()},set:function(e){var t=[];for(var n in e)t[n]=!0;this.subset=t,this.scaleParameter.set(e)}},{key:"referencePitch",get:function(){return tone__WEBPACK_IMPORTED_MODULE_9___default.a.Frequency(this.referencePitchParameter.get())}},{key:"output",value:function(){for(var e in this.triggers)if(this.triggers[e].stepData){var t=this.triggers[e].stepData.duration,n=this.getTranspose(this.triggers[e].stepData.transpose),r=this.getStep(this.triggers[e].stepData,n,this.triggers[e].stepData.duration,!0);r.duration=null===t?void 0:t,this.triggers[e].stepData=r}return this.triggers}},{key:"getTranspose",value:function getTranspose(t){var _this2=this,scale=this.scale.filter(function(e,t){return _this2.subset[t]}),octave=Math.floor(t/12),offset=t<0?(12-Math.abs(t)%12)%12:t%12,scaleNote=scale[Math.floor(scale.length*offset/12)];try{scaleNote=eval(scaleNote)}catch(e){return t}var octavedNote=this.referencePitch.transpose(12*octave)._val,transpose=Object(_utils_js__WEBPACK_IMPORTED_MODULE_13__.a)(octavedNote*scaleNote);return transpose}},{key:"getJson",value:function(){var e=Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__.a)({},Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_get__WEBPACK_IMPORTED_MODULE_4__.a)(Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(ScaleEffect.prototype),"getJson",this).call(this),{annotation:this.annotation});return e=this.saveParameterToJson(e,"scaleParameter",this.scaleParameter),e=this.saveParameterToJson(e,"subsetParameter",this.subsetParameter)}},{key:"fromJson",value:function(e,t){Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_get__WEBPACK_IMPORTED_MODULE_4__.a)(Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(ScaleEffect.prototype),"fromJson",this).call(this,e,t),this.scale=e.scale,e.subset&&(this.subset=e.subset),this.loadParameterFromJson(e,"scaleParameter",this.scaleParameter),this.loadParameterFromJson(e,"subsetParameter",this.subsetParameter),this.annotation=e.annotation}},{key:"getCopy",value:function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var t=new ScaleEffect(e);return t.fromJson(this.getJson(),!0),t}}]),ScaleEffect}(_MidiEffect_js__WEBPACK_IMPORTED_MODULE_8__.a)},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(165),l=n(114);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Pattern Switch",e)).newVar("patternNumber",0,0,16),a.clear(),a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Switches the pattern when a trigger is received."]}},{key:"getVisualizedParameters",value:function(){return[this.patternNumberParameter]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.F)(this.var("patternNumber")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=(n(151),n(165)),l=n(114),f=n(842);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var d=function(e){Object(i.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Poly",e)).newVar("outputs",2,1,8,"Number of outputs to split notes among."),a.clear(),a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Splits any polyphony chords among the outputs of this effect."]}},{key:"numberOfOutputs",get:function(){if(this.outputsParameter){var e=Math.floor(this.var("outputs")());return isNaN(e)?2:e}return 2},set:function(e){}},{key:"getVisualizedParameters",value:function(){return[this.outputsParameter]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){for(var e=[],t=0;t<this.numberOfOutputs;t++)e.push(Object(l.P)(t));this.myScript=Object(u.a)(f.a.apply(void 0,e))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=d},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(165),l=(n(213),n(545)),f=n(290),h=n(114);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var p=function(e){Object(i.a)(n,e);var t=d(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Density",e)).clear(),a.newVar("limit",4,1,32),a.newVar("windowSize",4,1,32),a.numberOfOutputs=2,a}return Object(a.a)(n,[{key:"isRealTime",value:function(){return!1}},{key:"documentation",get:function(){return["Sends triggers to output 2 when the number of triggers of the last few steps exceeds a certain threshold.","All other triggers go to output 1."]}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(h.q)(Object(f.b)(this.var("limit"),Object(l.a)(this.var("windowSize"))),Object(h.P)(1),Object(h.P)(0)))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=p},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(165),l=(n(213),n(114));function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Roll",e)).clear(),a.numberOfOutputs=2,a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Sends triggers to output 1 when the sequence is rolling.","All other triggers go to output 2."]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.q)(Object(l.J)(),Object(l.P)(0),Object(l.P)(1)))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(165),l=n(289);n(114);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Midi Gate",e)).clear(),a.numberOfOutputs=2,a.newVar("steps",new Array(16).fill(1),0,65536),a}return Object(a.a)(n,[{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.b)(this.var("steps")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(165),l=n(656);n(114);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Sparse",e)).clear(),a.numberOfOutputs=2,a.system5Objects=[],a.newVar("density",1,0,1,void 0,void 0,function(e){return a.system5Objects.forEach(function(e){return e.sendDensities()})}),a}return Object(a.a)(n,[{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.a)(this.var("density")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";n.d(t,"a",function(){return j});var r=n(1),a=n(4),i=n(5),o=n(31),s=n(7),c=n(8),u=n(2),l=n(14),f=n(123),h=n(116),d=n(128),p=n(384),v=n(193),m=n(361),y=n(242),b=n(150);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var O=Object(p.a)(Object(v.f)(". -")),j=function(e){Object(s.a)(n,e);var t=g(n);function n(e,r){var i;return Object(a.a)(this,n),(i=t.call(this)).effect=r,i.sequencerEngine=r.sequencerEngine,i.figure=e,i._initialType=0,i._initialLength=e().flat(3).length,i.figureLengthParameter=new l.a("figureLength",Object(o.a)(i),function(e,t){return i.onLengthChanged(t)},{defaultValue:i._initialLength,min:3,max:5}),i.registerParameter(i.figureLengthParameter),i.figureTypeParameter=new l.a("figureType",Object(o.a)(i),function(e,t){return i.onTypeChanged(t)},{defaultValue:i._initialType,min:0,max:7}),i.registerParameter(i.figureTypeParameter),i.registerContext(),i}return Object(i.a)(n,[{key:"registerContext",value:function(){var e=this,t=this.parameters,n=(new f.a).forMidiEffect(this.effect);t.forEach(function(t){t.setContext(n),t.setStore(e.sequencerEngine.store)})}},{key:"updateFigure",value:function(e){var t=(e=e()).flat(3).length,n=y.b[t],r=Object(b.e)(e),a=n.indexOf(r.trim());this.figureLengthParameter.set(t),this.figureTypeParameter.set(a)}},{key:"figureLength",get:function(){return this.figureLengthParameter?this.figureLengthParameter.get():this._initialLength}},{key:"figureType",get:function(){return this.figureTypeParameter?this.figureTypeParameter.get():this._initialType}},{key:"onTypeChanged",value:function(e){e=Math.round(e);var t=Math.min(7,Math.max(2,Math.round(this.figureLength))),n=y.b[t],r=n[e%n.length];this.figure=Object(p.a)(Object(v.f)(r))(),this.effect.onFiguresChanged()}},{key:"onLengthChanged",value:function(e){e=Math.min(7,Math.max(2,Math.round(e)));var t=y.b[e],n=t[Math.round(this.figureType)%t.length];this.figure=Object(p.a)(Object(v.f)(n))(),this.effect.onFiguresChanged()}},{key:"toString",value:function(){return Object(b.e)(this.figure)}},{key:"getCopy",value:function(){var e=new n(O,this.effect);return e.figureLengthParameter.set(this.figureLength),e.figureTypeParameter.set(this.figureType),e}},{key:"getJson",value:function(){var e={figureLength:this.figureLength,figureType:this.figureType};return e=Object(d.b)(e,"figureLengthParameter",this.figureLengthParameter),e=Object(d.b)(e,"figureTypeParameter",this.figureTypeParameter)}},{key:"fromJson",value:function(e){var t={};return Object(h.a)(this.figureLengthParameter,e.figureLength,t),Object(h.a)(this.figureTypeParameter,e.figureType,t),Object(r.a)({},t,Object(d.a)(e,"figureLengthParameter",this.figureLengthParameter),Object(d.a)(e,"figureTypeParameter",this.figureTypeParameter))}}]),n}(Object(m.a)(function(){return function e(){Object(a.a)(this,e)}}()))},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2),u=n(14),l=n(870),f=n(361),h=n(20),d=n(134),p=n(362),v=n(242);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var y=function(e){Object(o.a)(n,e);var t=m(n);function n(e,a){var i;return Object(r.a)(this,n),(i=t.call(this)).numberInstances=0,i.subSequence=e,i.jparams={},i.zObject=a,i.sequencerEngine=e.sequencerEngine,i.id=Object(h.uuid)(),i.setupShiftParameters(),i.newOutlet("shift"),i.newOutlet("hands"),i.newOutlet("halveningDepth"),i}return Object(a.a)(n,[{key:"deleteSlot",value:function(e){if(this.jaki){var t=this.jaki.tidals.map(function(e){return e.firstAccent}),n=[];for(var r in this.jparams)r.includes(e+"Parameter")&&(n.push(this.jparams[r]),delete this.jparams[r]);this.parameters=this.parameters.filter(function(e){return!n.includes(e)}),this.jaki.tidals.splice(e-1,1),this.jaki._restart(t),this.numberInstances--}}},{key:"getConnectedTidal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.zObject&&this.zObject.outlets;return Object(i.a)(Object(c.a)(n.prototype),"getConnectedTidal",this).call(this,e,"params",t)}},{key:"newSlotParameter",value:function(){this.numberInstances++,this.newShiftParameter(this.numberInstances),this.newDampRateParameter(this.numberInstances),this.newDampAmountParameter(this.numberInstances),this.newDoubleParameter(this.numberInstances),this.newRulesToIgnoreParameter(this.numberInstances),this.newNudgeParameter(this.numberInstances),this.newHandParameter(this.numberInstances),this.newTruncateParameter(this.numberInstances),this.newTripletParameter(this.numberInstances),this.newSwingParameter(this.numberInstances),this.newRuleParameter(this.numberInstances),this.newOffsetParameter(this.numberInstances),this.newScaleParameter(this.numberInstances),this.newTempoParameter(this.numberInstances),this.newRoutesParameter(this.numberInstances),this.newHalveningDepthParameter(this.numberInstances),this.newHalveningRateParameter(this.numberInstances),this.newHalveningFillParameter(this.numberInstances),this.newPulseSourceParameter(this.numberInstances),this.newPulseDestParameter(this.numberInstances)}},{key:"setupShiftParameters",value:function(){var e=this;this.seedParameter=new u.b("seed",this,function(t){return e.zObject&&e.onValueChange()},{defaultValue:1,min:1,max:64e3}),this.registerParameter(this.seedParameted),this.newSlotParameter(),this.newInlet("shift",function(t){return e.onMsg("shift",t)}),this.newInlet("truncate",function(t){return e.onMsg("truncate",t)}),this.newInlet("tempo",function(t){return e.onMsg("tempo",t)}),this.newInlet("hand",function(t){return e.onMsg("hand",t)}),this.newInlet("swing",function(t){return e.onMsg("swing",t)}),this.newInlet("offset",function(t){return e.onMsg("offset",t)}),this.newInlet("half",function(t){return e.onMsg("halveningDepth",t)})}},{key:"onMsg",value:function(e,t){var n=this;if(this.jaki){for(var r=this.jaki?Math.max(this.jaki.tidals.length,this.numberInstances):this.numberInstances,a=[],i=1;i<=r;i++)a.push(i);var o=a.map(function(t){return n[e+t+"Parameter"]});t=t[0],Array.isArray(t)?o.forEach(function(e,n){e&&e.set(t[n%t.length])}):o.forEach(function(e){return e.set(t)})}}},{key:"onValueChange",value:function(){this.zObject.onValueChange(),this.jaki&&this.jaki.tidals&&(this.sendMessage("hands",this.getParamValues("hand")),this.sendMessage("halveningDepth",this.getParamValues("halveningDepth")),this.sendMessage("shift",this.getParamValues("shift")))}},{key:"getParamValues",value:function(e){for(var t=[],n=0;n<this.jaki.tidals.length;n++){var r="".concat(e).concat(n+1,"Parameter");this[r]&&t.push(this[r].get())}return t}},{key:"newParameter",value:function(e,t,n){var r=this,a=new u.b(e+t,this,function(e){return r.zObject&&r.onValueChange()},n);this.registerParameter(a),this["".concat(e).concat(t,"Parameter")]=a,this.jparams["".concat(e).concat(t,"Parameter")]=a}},{key:"newAbstractParameter",value:function(e,t,n){var r=this,a=new u.a(e+t,this,function(e){return r.zObject&&r.onValueChange()},n);this.registerParameter(a),this["".concat(e).concat(t,"Parameter")]=a,this.jparams["".concat(e).concat(t,"Parameter")]=a}},{key:"newRuleParameter",value:function(e){this.newParameter("rule",e,{defaultValue:null,min:0,max:12})}},{key:"newShiftParameter",value:function(e){this.newParameter("shift",e,{defaultValue:0,min:0,max:16})}},{key:"newScaleParameter",value:function(e){this.newAbstractParameter("scale",e,{defaultValue:!1})}},{key:"newHandParameter",value:function(e){this.newParameter("hand",e,{defaultValue:v.a,min:0,max:3})}},{key:"newTruncateParameter",value:function(e){this.newParameter("truncate",e,{defaultValue:0,min:0,max:5})}},{key:"newDampRateParameter",value:function(e){this.newParameter("dampRate",e,{defaultValue:2,min:2,max:8})}},{key:"newDampAmountParameter",value:function(e){this.newParameter("dampAmount",e,{defaultValue:100,min:0,max:100})}},{key:"newCycleRatioParameter",value:function(e){this.newParameter("cyleRatio",e,{defaultValue:1,min:1,max:3})}},{key:"newHalveningRateParameter",value:function(e){this.newParameter("halveningRate",e,{defaultValue:1,min:0,max:8})}},{key:"newHalveningDepthParameter",value:function(e){this.newParameter("halveningDepth",e,{defaultValue:0,min:0,max:3})}},{key:"newHalveningFillParameter",value:function(e){this.newAbstractParameter("halveningFill",e,{defaultValue:!1})}},{key:"newTempoParameter",value:function(e){this.newParameter("tempo",e,{defaultValue:2,min:1,max:5})}},{key:"newSwingParameter",value:function(e){this.newParameter("swing",e,{defaultValue:50,min:50,max:100})}},{key:"newOffsetParameter",value:function(e){this.newParameter("offset",e,{defaultValue:0,min:0,max:100})}},{key:"newNudgeParameter",value:function(e){this.newParameter("nudge",e,{defaultValue:10,min:-30,max:30})}},{key:"newTripletParameter",value:function(e){this.newAbstractParameter("triplet",e,{defaultValue:!1})}},{key:"newDoubleParameter",value:function(e){this.newAbstractParameter("double",e,{defaultValue:!0})}},{key:"newPulseSourceParameter",value:function(e){this.newAbstractParameter("pulseSource",e,{defaultValue:!1})}},{key:"newPulseDestParameter",value:function(e){this.newAbstractParameter("pulseDest",e,{defaultValue:!1})}},{key:"newRulesToIgnoreParameter",value:function(e){this.newAbstractParameter("rulesToIgnore",e,{defaultValue:[]})}},{key:"newRoutesParameter",value:function(e){this.newAbstractParameter("routes",e,{defaultValue:[]})}},{key:"getJson",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var o=(e=Object(i.a)(Object(c.a)(n.prototype),"getJson",this)).call.apply(e,[this].concat(r));return o.numberInstances=this.numberInstances,o}},{key:"fromJson",value:function(e){for(var t,r=this.jaki?Math.max(this.jaki.tidals.length,this.numberInstances):this.numberInstances,a=2;a<=r;a++)this.deleteSlot(a);if(this.jaki&&this.jaki.tidals.length>this.numberInstances&&this.jaki.tidals.splice(this.numberInstances),e.numberInstances)for(var o=2;o<=e.numberInstances;o++)this.jaki?this.jaki.addSlot():this.newSlotParameter();for(var s=arguments.length,u=new Array(s>1?s-1:0),l=1;l<s;l++)u[l-1]=arguments[l];(t=Object(i.a)(Object(c.a)(n.prototype),"fromJson",this)).call.apply(t,[this,e].concat(u)),this.needsUpdate=!0}},{key:"getValueJson",value:function(){var e={};for(var t in this.jparams)e[t]=this.jparams[t].get();return e}},{key:"fromValueJson",value:function(e){for(var t in e)this.jparams[t].set(e[t],!0,!0)}}]),n}(Object(p.a)(Object(l.a)(Object(d.a)(Object(f.a)(function(){return function e(){Object(r.a)(this,e)}}())))))},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=c(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).cachedTidal={},e}return Object(a.a)(n,[{key:"getConnectedTidal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.outlets;if(this.cachedTidal[e])return this.cachedTidal[e];var r=this.searchForNode("jaki",t,n);return r&&(this.cachedTidal[e]=r.effect.tidals[e]),this.cachedTidal[e]}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return w});var r=n(1),a=n(11),i=n(4),o=n(5),s=n(10),c=n(7),u=n(8),l=n(2),f=n(139),h=n(286),d=n(327),p=n(375),v=n(328),m=n(170),y=n(551),b=n(134),g=n(130);function O(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var w=function(e){Object(c.a)(n,e);var t=k(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,"Rules Rack",e)).zObject=r,a.initializeConfigurations(a.adjacencyLists),a.addInitialRules(),a.newOutlet(g.h),a}return Object(o.a)(n,[{key:"addInitialRules",value:function(){this.loaded=!1,this.addEffect(new y.e(this)),this.addEffect(new y.c(this)),this.addEffect(new y.d(this)),this.addEffect(new y.n(this)),this.addEffect(new y.s(this)),this.addEffect(new y.o(this)),this.addEffect(new y.p(this)),this.addEffect(new y.u(this)),this.addEffect(new y.a(this)),this.addEffect(new y.l(this)),this.addEffect(new y.f(this)),this.addEffect(new y.i(this)),this.addEffect(new y.r(this)),this.addEffect(new y.b(this)),this.addEffect(new y.v(this)),this.loaded=!0,this.updateRules(),this.coord(0,36,10),this.coord(1,92,10),this.coord(2,144,10),this.coord(3,203,10),this.coord(4,11,72),this.coord(5,60,72),this.coord(6,130,72),this.coord(7,177,72),this.coord(8,236,72),this.coord(9,199,129),this.coord(10,12,129),this.coord(11,63,129),this.coord(12,128,129),this.coord(12,200,129),this.coord(12,230,129)}},{key:"coord",value:function(e,t,n){this.effects[e].x=t,this.effects[e].y=n}},{key:"isRack",get:function(){return!0}},{key:"addEffect",value:function(e){Object(s.a)(Object(l.a)(n.prototype),"addEffect",this).call(this,e),e.rack=this,this.updateRules()}},{key:"updateRules",value:function(){var e=this;if(this.loaded){var t=[];t=[],["Dot","Dash 1","Dash 2","Accent","Any","Times","Double","Staccato","Legato","Piano","Rest","Pianissimo","Otherwise"].forEach(function(n){t=[].concat(Object(a.a)(t),Object(a.a)(e.generateRules(e.effects.find(function(e){return e.name===n}))))}),this.rules=t,this.publishRules()}}},{key:"publishRules",value:function(){this.sendMessage(g.h,this.rules)}},{key:"connectNodes",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(s.a)(Object(l.a)(n.prototype),"connectNodes",this)).call.apply(e,[this].concat(r)),this.updateRules()}},{key:"deleteEdge",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(s.a)(Object(l.a)(n.prototype),"deleteEdge",this)).call.apply(e,[this].concat(r)),this.updateRules()}},{key:"deleteEffect",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(s.a)(Object(l.a)(n.prototype),"deleteEffect",this)).call.apply(e,[this].concat(r)),this.updateRules()}},{key:"generateRules",value:function(e,t){if(!e)return[];var n=this.adjacencyLists[e.id];if(!n)return[];var r,i=[],o=O(n);try{for(o.s();!(r=o.n()).done;){var s=r.value,c=s.effect,u=s.outputNumber,l=t;t||(l="Otherwise"===e.name?Object(m.s)():x(u)(e.predicate||e.action)),c.aux?(l=c.aux(l,c.value),i=[].concat(Object(a.a)(i),Object(a.a)(this.generateRules(c,l)))):(c.action&&(l=l.always(c.action)),i.push(l))}}catch(f){o.e(f)}finally{o.f()}return i}},{key:"dot",get:function(){return this.effects.find(function(e){return"Dot"===e.name})}},{key:"dash1",get:function(){return this.effects.find(function(e){return"Dash 1"===e.name})}},{key:"dash2",get:function(){return this.effects.find(function(e){return"Dash 2"===e.name})}},{key:"getJson",value:function(){return this.getRackJson()}},{key:"fromJson",value:function(e,t,a,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t;this.adjacencyLists={},this.initializeConfigurations(this.adjacencyLists,!1),this.effects=[],this.loaded=!1;var c=Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t),u=e.effects;for(var f in u){var d=u[f],p=Object(h.a)(d,this.track);if(c=Object(r.a)({},c,p.fromJson(d,o)),p.id!==d.id){var v,m=O(e.configurations);try{for(m.s();!(v=m.n()).done;){var y=v.value,b=y[d.id];y[p.id]=b,delete y[d.id]}}catch(g){m.e(g)}finally{m.f()}}this.addEffect(p,!1),p.x=d._x||d.x,p.y=d._y||d.y}return this.fromRackJson(e,t),this.loaded=!0,this.updateRules(),c}}]),n}(Object(b.a)(Object(d.a)(Object(p.a)(Object(v.a)(f.a))))),x=function(e){switch(e){case 0:return m.r;case 1:return m.u;default:return m.o}}},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),o=n(7),s=n(8),c=n(2),u=n(43);function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(o.a)(n,e);var t=l(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).operationsMap={},e}return Object(i.a)(n,[{key:"registerOperations",value:function(e,t){this.operationsMap[e]=t}},{key:"onOperation",value:function(e,t){var n=this.operationsMap[e];if(n){var a=t.split(" "),i=a[0],o=a.slice(1).map(function(e){return Object(u.a)(e)?parseFloat(e):e}),s=n[i];s&&s.apply(void 0,[this].concat(Object(r.a)(o)))}}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"d",function(){return i}),n.d(t,"c",function(){return o});var r="AUDITION_NEXT_SAMPLE",a="AUDITION_PREVIOUS_SAMPLE",i="TRIGGER_SAMPLE",o="RELEASE_SAMPLE"},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return p});var r=n(42),a=n.n(r),i=n(11),o=n(56),s=n(3),c=n(80),u=n(363),l=(n(412),n(23)),f=n(122);function h(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p=function(e){var t=e.zobject,n=e.setDropdownPos,r=e.zipName;return{mintToZora:Object(s.useCallback)(function(){var e=Object(o.a)(a.a.mark(function e(o){var s,c,f,h,d,p,m,b;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.stopPropagation(),n(void 0),(s=t.sequencerEngine).dispatch(Object(l.Qb)("Generating the images for your Drop.")),console.log("BOUNCING CONVOLVERS"),e.next=7,Object(u.a)(s);case 7:return console.log("SAVING PROJECT"),e.next=10,s.save("export","PUBLIC",!1,void 0,t,!0);case 10:return c=e.sent,f=c.ipfsHash,h=c.json,console.log("GETTING SAMLPES"),e.next=16,Object(u.d)(s);case 16:return d=e.sent,p=Object(u.c)(s),console.log("GETTING SCREENSHOTS"),e.next=21,v(s,s.erc721EditionSize);case 21:m=e.sent,s.dispatch(Object(l.Qb)("Uploading assets to Arweave.")),b={zipName:r,projectId:f,width:t.width||600,height:t.height||600,ipfsHashes:[f].concat(Object(i.a)(d),Object(i.a)(p)),screenshots:m},{appManifest:"CT4Uy6FMAoKyEwwinoYjnVwUD_5pkqRum4lYqhik4j4",imageManifest:"bVglaWpfEhYDXektO-EBRf_lIBVdM5sfn3ecuKLZvrs",contentURI:"https://zequencer.io/ipfs/QmRs173mWByakuKFNZc78zzShFn99hbmWumomz6bymXnCP",screenshotsCount:10},fetch("/exportZip/",{method:"POST",body:JSON.stringify(b),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){s.dispatch(Object(l.Qb)(void 0)),console.log("export returned following manifests=",e),e.projectJson=h,e.contentURI="https://zequencer.io/ipfs/"+f,e.screenshotsCount=m.length,e.attributes=y(s),s.dispatch(Object(l.nf)(e))}).catch(function(e){console.log(e)});case 26:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[t,n])}},v=function(){var e=Object(o.a)(a.a.mark(function e(t){var n,r,i,o,s,u,f,d,p=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.length>1&&void 0!==p[1]?p[1]:10,void 0,(r=t.subSequences[0].findNodeByName("three.canvas").find(function(e){return!e.isUI&&(!e.subSequence.zObject||!e.subSequence.zObject.isUI)}))&&r.effect.renderer){e.next=5;break}return e.abrupt("return",[]);case 5:if(i=[],0!==(o=t.subSequences[0].findNodeByName("erc720.tokenID")).length){e.next=15;break}return e.t0=i,e.next=11,m(r);case 11:e.t1=e.sent,e.t0.push.call(e.t0,e.t1),e.next=32;break;case 15:s=1;case 16:if(!(s<=n)){e.next=32;break}u=h(o);try{for(u.s();!(f=u.n()).done;)d=f.value,t.tokenID=s,d.onInputMessage([s])}catch(a){u.e(a)}finally{u.f()}return e.next=21,Object(c.a)(1500);case 21:return e.t2=i,e.next=24,m(r);case 24:return e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=28,Object(c.a)(1500);case 28:t.dispatch(Object(l.rb)([].concat(i)));case 29:s++,e.next=16;break;case 32:return e.abrupt("return",i);case 33:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),m=function(){var t=Object(o.a)(a.a.mark(function t(n){var r,i;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.effect.renderer.domElement.toDataURL().slice(22),i=e.from(r,"base64"),t.next=4,f.a.addBuffer(i);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),y=function(e){return e.subSequences[0].findNodeByName("erc721.attribute").map(function(e){return e.erc721Attribute}).filter(function(e){return e})}}).call(this,n(110).Buffer)},,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(3),u=n.n(c),l=n(23),f=n(133),h=n(55);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var p=function(e){Object(i.a)(n,e);var t=d(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).state={},a}return Object(a.a)(n,[{key:"isToggled",value:function(){return void 0!==this.props.instrument?this.props.instrument.isParameterConnectedToLFO(this.props.parameter,this.props.lfo):this.props.parameter&&this.props.parameter.isConnectedToLFO(this.props.lfo)}},{key:"toggle",value:function(){void 0!==this.props.instrument?this.props.instrument.toggleParameterWithLFO(this.props.parameter,this.props.lfo):(this.props.parameter.isAudioParamEnabled()||this.props.parameter.enableAudioParam(),this.isToggled()?this.props.disconnectFromLFO?this.props.disconnectFromLFO(this.props.lfo,!0):this.props.parameter.disconnectFromLFO(this.props.lfo,!0):(this.props.connectToLFO?this.props.connectToLFO(this.props.lfo,!0):this.props.parameter.connectToLFO(this.props.lfo,!0),this.props.setSelectedLFO(this.props.lfo.number))),this.setState({toggled:this.isToggled()})}},{key:"showMods",value:function(e){this.props.setShowLFOs(!0)}},{key:"onMouseOver",value:function(e){e.stopPropagation(),this.props.setContextualHelp(f.l)}},{key:"render",value:function(){var e=this,t=this.isToggled()?" toggled ":"",n=this.props.lfos.indexOf(this.props.lfo);return u.a.createElement("div",{onMouseOver:function(t){return e.onMouseOver(t)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.toggle()},className:"pushable parameter-lfo-toggle lfo-"+n+t},n+1)}}]),n}(c.PureComponent);t.a=Object(h.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(l.bb)(t))},setSelectedLFO:function(t){return e(Object(l.ud)(t))},setShowLFOs:function(t){return e(Object(l.Td)(t))},setArrangementBottomMode:function(t){return e(Object(l.y)(t))},setShowPianoRoll:function(t){return e(Object(l.Wd)(t))}}})(p)},function(e,t,n){"use strict";n.d(t,"a",function(){return u}),n.d(t,"b",function(){return l});var r=n(108),a=n(11),i=n(896),o=n(897);function s(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}window.rasterTimes=[];var u=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,i=[],c=-1,u=s(l(e,n,r));try{for(u.s();!(t=u.n()).done;){var f=t.value;f.x=Math.round(f.x),f.y=Math.round(f.y);var h=((0).noise2D(f.x,f.y)+1)/2;f.dist=h,Math.random()<1&&(h=Math.min(f.distX,f.distY)/n,f.dist=h),h>c&&(c=h),i.push(f)}}catch(b){u.e(b)}finally{u.f()}for(var d=Object(o.c)(i,n),p=[],v=[],m=2;m<Math.max(8,c);m+=1){var y=Object(o.a)(d,m);p=[].concat(Object(a.a)(p),Object(a.a)(y)),v=[].concat(Object(a.a)(v),Object(a.a)(Object(o.b)(y)))}return{triangles:d,points:i,segments:p,contours:p}},l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,o=((new Date).getTime(),e=Object(i.a)(e)),s=Object(r.a)(o,6),c=s[0],u=s[1],l=s[2],p=s[3],y=s[4],b=s[5];if(p===b)return h(e,t,n);if(u===p)return d(e,t,n);var g=Math.round(c+(p-u)/(b-u)*(y-c)),O=Math.round(p),j=[l,p,g,O,y,b];j=Object(i.a)(j);var k=d(j,t,!0,u),w=k[k.length-1],x=f(c,u,l,p,g,O,w),S=Object(r.a)(x,2),P=[c,u,l=S[0],p=w,g=S[1],O=w];P=Object(i.a)(P);var E=v(k,w);return[].concat(Object(a.a)(m(k,w)),Object(a.a)(h(P,t,E,b)))},f=function(e,t,n,r,a,i,o){return[e-(t-o)/((t-r)/(e-n)),e-(t-o)/((t-i)/(e-a))]},h=function(e,t,n,i){var o=Object(r.a)(e,6),s=o[0],c=o[1],u=o[2],l=o[3],f=o[4],h=(u-s)/(l-c),d=(f-s)/(o[5]-c),v=u,m=f,b=0,g=[];n=y(n||v,t),i=y(i||l);for(var O=l;O>c;O--){Math.abs(c-O),Math.abs(O-l);if(b%t===0){var j=p(v,O,m,O,t,n,i);g=[].concat(Object(a.a)(g),Object(a.a)(j))}if(v-=h,m-=d,++b>1e4)break}return g},d=function(e,t){for(var n=Object(r.a)(e,6),i=n[0],o=n[1],s=n[2],c=n[3],u=n[4],l=n[5],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3?arguments[3]:void 0,d=(u-i)/(l-o),v=(u-s)/(l-c),m=u,b=u,g=[],O=0,j=y(m,t),k=y(l,t),w=y(l,t),x=!0;x;w--){Math.abs(h-w),Math.abs(l-w);if(O%t===0){if(w<=o){if(!f)break;x=!1}var S=p(m,w,b,w,t,j,k);g=[].concat(Object(a.a)(g),Object(a.a)(S))}if(m-=d,b-=v,++O>1e4)break}return g},p=function(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,i=arguments.length>5?arguments[5]:void 0,o=(arguments.length>6&&arguments[6],e);i>e;)i-=a;e=Math.round(i),t=Math.round(t),n=Math.round(n),r=Math.round(r);for(var s=Math.abs(n-e),c=Math.abs(r-t),u=e<n?1:-1,l=t<r?1:-1,f=s-c,h=[],d=0;e!=n||t!=r;){if(d%a===0&&e>o){Math.abs(e-i),Math.abs(n-e);h.push(e),h.push(t)}var p=2*f;if(p>-c&&(f-=c,e+=u),p<s&&(f+=s,t+=l),++d>1e4)break}return h},v=function(e,t){for(var n=1e4,r=0;r<e.length;r+=2)e[r+1]===t&&e[r]<n&&(n=e[r]);return n},m=function(e,t){for(var n=[],r=0;r<e.length;r+=2)e[r+1]!==t&&(n.push(e[r]),n.push(e[r+1]));return n},y=function(e,t){return e-e%t}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){var t=[0,1,2],n=function(t){return e[2*t]},r=function(t){return e[2*t+1]};t.sort(function(e,t){return r(e)===r(t)?n(e)-n(t):r(e)-r(t)});var a=[];return t.forEach(function(e){a.push(n(e)),a.push(r(e))}),a}},function(e,t,n){"use strict";n.d(t,"c",function(){return s}),n.d(t,"a",function(){return l}),n.d(t,"b",function(){return f});var r=n(108),a=n(11);function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=function(e,t){if(0===e.length)return[];var n={},r=(Math.max.apply(Math,Object(a.a)(e.map(function(e){return e.y}))),Math.min.apply(Math,Object(a.a)(e.map(function(e){return e.y}))));e.forEach(function(e){e.x;var t=e.y;n[t]||(n[t]=[]),n[t].push(e)});for(var i=[],o=n[r],s=r;;){var l=o,f=c(n,s),h=n[f];if(s=f,o=h,!l||!h)break;i=[].concat(Object(a.a)(i),Object(a.a)(u(l,h)))}return i},c=function(e,t){var n,r=i(Object.keys(e).map(function(e){return parseInt(e)}));try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a>t)return a}}catch(o){r.e(o)}finally{r.f()}},u=function(e,t){for(var n=[],r=function(r){var a=e[r],i=e[r+1],o=t.find(function(e){return e.x===a.x}),s=t.find(function(e){return e.x===i.x});o&&i&&n.push([a,o,i]),s&&i&&o&&n.push([o,s,i])},a=0;a<e.length-1;a++)r(a);return n},l=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=[],a=i(e);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=o.filter(function(e){return e.dist>=n}),c=o.filter(function(e){return e.dist<n});if(0!==c.length&&0!==s.length){for(var u=s.length<c.length?s:c,l=s.length>c.length?s:c,f=[],h=[[u[0],l[0]],[u[0],l[1]]],d=0,p=h;d<p.length;d++){var v=p[d],m=[v[0],v[1]],y=m[0],b=m[1],g=(n-b.dist)/(y.dist-b.dist),O={x:g*y.x+(1-g)*b.x,y:g*y.y+(1-g)*b.y};f.push(O)}f[0].x===f[1].x&&f[0].y===f[1].y||r.push([f[0],f[1]])}}}catch(j){a.e(j)}finally{a.f()}return r},f=function(e){var t,n=Object(a.a)(e),o={},s=i(e);try{for(s.s();!(t=s.n()).done;){var c=t.value,u=Object(r.a)(c,2),l=u[0],f=u[1];l=p(l),f=p(f),o[l]||(o[l]=[]),o[f]||(o[f]=[]),o[l].push(c),o[f].push(c)}}catch(g){s.e(g)}finally{s.f()}for(var v=[];n.length>0;)for(var m=n.shift();;){var y=d(o[p(h(m))],n);y.length>0&&function(){var e=y.pop();e[1].x===h(m).x&&e[1].y===h(m).y?m.push(e[0]):m.push(e[1]),n=n.filter(function(t){return t!==e})}();var b=d(o[p(m[0])],n);if(b.length>0&&function(){var e=b.pop();m.unshift(e[1].x===m[0].x&&e[1].y===m[0].y?e[0]:e[1]),n=n.filter(function(t){return t!==e})}(),0===b.length&&0===y.length){v.push(m);break}}return v},h=function(e){return e[e.length-1]},d=function(e,t){return e||[]},p=function(e){return e.x+","+e.y}},function(e,t,n){},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"d",function(){return i}),n.d(t,"b",function(){return o});var r=1,a=2,i=3,o=4},function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return b});var r=n(42),a=n.n(r),i=n(56),o=n(108),s=n(3),c=n.n(s),u=(n(570),n(124)),l=n(122),f=n(373),h=n(6),d=n.n(h),p=n(302),v=n(141),m=n(23),y=n(55),b=(new u.a,function(t,n){return new Promise(function(t){var r=new FileReader;n.name.includes(".wav")||n.name.includes(".flac")||n.name.includes(".mp3")?(r.readAsArrayBuffer(n),r.onloadend=Object(i.a)(a.a.mark(function i(){var o,s,c,u;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o=r.result,Int8Array.from(o),a.next=4,l.a.addArrayBuffer(o);case 4:if(s=a.sent,u=new v.a(p.a),!n.name.includes("mp3")){a.next=13;break}return a.next=9,Object(f.b)(new Int8Array(o));case 9:c=a.sent,u.mp3Data=new e(o),a.next=16;break;case 13:return a.next=15,d.a.Master.context.decodeAudioData(o);case 15:c=a.sent;case 16:u.ipfsHash=s,u.audioBuffer=c,u.name=n.name,t(u);case 20:case"end":return a.stop()}},i)}))):window.alert("Only accepts .wav, .mp3, & .flac files for now")})});t.a=Object(y.b)(function(e,t){return{playlist:t.sporeStems.playlist,currentStems:t.sporeStems.stems}},function(e){return{}})(function(e){var t=e.sporeStems,n=(e.playlist,e.currentStems,Object(s.useState)(!1)),r=Object(o.a)(n,2),u=(r[0],r[1],Object(s.useState)()),l=Object(o.a)(u,2),f=l[0],h=l[1],d=Object(s.useState)(""),p=Object(o.a)(d,2),v=p[0],y=p[1],g=Object(s.useState)(!1),O=Object(o.a)(g,2),j=O[0],k=O[1],w=Object(s.useRef)(),x=(Object(s.useCallback)(function(){var e=Object(i.a)(a.a.mark(function e(n){var r,i,o,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.stopPropagation(),n.preventDefault(),n.dataTransfer.effectAllowed="none",n.dataTransfer.dropEffect="none",!n.dataTransfer.items){e.next=15;break}for(t.sequencerEngine.dispatch(Object(m.Se)(!0)),r=[],i=n.dataTransfer.items.length,o=0;o<i;o++)"file"===n.dataTransfer.items[o].kind&&r.push(b(t.sequencerEngine,n.dataTransfer.items[o].getAsFile()));return e.next=11,Promise.all(r);case 11:s=e.sent,w.current=s,t.sequencerEngine.dispatch(Object(m.Se)(!1)),k(!0);case 15:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[f,k]),Object(s.useCallback)(function(e){var t=parseFloat(e.target.value);isNaN(t)||h(t)},[h])),S=Object(s.useCallback)(function(e){var t=e.target.value;y(t)},[y]),P=Object(s.useCallback)(function(){t.newStems(w.current,v,f),k(!1),y("")},[f,v,k,y]);return j?c.a.createElement("div",{className:"spore-stems-container"},c.a.createElement("div",{className:"field-container"},c.a.createElement("div",{className:"field-label"},"Name"),c.a.createElement("input",{onChange:S,text:v,placeholder:"Enter Name"})),c.a.createElement("div",{className:"field-container"},c.a.createElement("div",{className:"field-label"},"BPM"),c.a.createElement("input",{onChange:x,text:f,placeholder:"Enter BPM"})),c.a.createElement("div",{onClick:P,className:"save-stem-btn"},"Add To Playlist")):c.a.createElement("div",{className:"spore-stems-container"},c.a.createElement("img",{draggable:"false",src:"/white-zequencer-logo.svg",className:"stems-logo"}))})}).call(this,n(110).Buffer)},function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(55);n(902);t.a=Object(i.b)(function(e,t){return{}},function(e){return{}})(function(e){for(var t=e.percentage,n=e.radius,r=2*(n-32)*Math.PI,i=(100-t)/100*r,o={},s=[],c=0;c<16;c++)s.push(t/32/100*r),s.push(t/32/100*r);return s.pop(),s.push(i),a.a.createElement("svg",{className:"circular-progress",width:2*n+"px",height:2*n+"px"},a.a.createElement("defs",null,a.a.createElement("linearGradient",{id:"linear",x1:"0%",y1:"0%",x2:"100%",y2:"0%"},a.a.createElement("stop",{offset:"0%","stop-color":"#fbe433"}),a.a.createElement("stop",{offset:"50%","stop-color":"#eae92c"}),a.a.createElement("stop",{offset:"100%","stop-color":"#28ff5d"}))),a.a.createElement("circle",{className:"outter-circle",strokeWidth:16,style:o,cx:n+16,cy:n+16,r:n-32}),t>0&&a.a.createElement("circle",{className:"inner-circle",strokeDashoffset:n+4,strokeWidth:16,strokeDasharray:s.join(","),stroke:"url(#linear)",style:o,cx:n+16,cy:n+16,r:n-32}))})},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(108),a=n(129),i=function(e){return"object"===typeof e&&0===Object.keys(e).length?"p":"p - ".concat(Object(a.b)(e),".x *\n    clamp(\n        round(p/").concat(Object(a.b)(e),".x), \n        -vec3(").concat(Object(a.b)(e),".y, ").concat(Object(a.b)(e),".z, ").concat(Object(a.b)(e),".w), \n        vec3(").concat(Object(a.b)(e),".y, ").concat(Object(a.b)(e),".z, ").concat(Object(a.b)(e),".w))")},o={cappedCylinder:function(e){var t=Object(r.a)(e,8),n=t[0],o=(t[1],t[2]),s=(t[3],t[4]),c=(t[5],t[6]),u=t[7];return{args:{p:"vec3"},returnType:"vec2",body:"\n   p = (p - ".concat(n,")*").concat(s,"  + (").concat(n,")*(").concat(s," - identity);\n   p = ").concat(i(u),";\n   float h = ").concat(Object(a.b)(o),".x;\n   float r = ").concat(Object(a.b)(o),".y;\n  vec2 d = abs(vec2(length(p.xz),p.y)) - vec2(h,r);\n  return vec2(min(max(d.x,d.y),0.0) + length(max(d,0.0)), ").concat(Object(a.b)(c),");\n")}},rect:function(e){var t=Object(r.a)(e,8),n=t[0],i=(t[1],t[2]),o=t[3],s=t[4],c=t[5],u=(t[6],t[7]);return{args:{p:"vec2"},returnType:"vec2",body:"\n    if (".concat(Object(a.b)(n),".x > 50.0) {\n      return vec2(100.0, ").concat(Object(a.b)(c),");\n    }\n    vec2 q = vec2(sdRoundBoxCoord(\n        p, \n        ").concat(Object(a.b)(n),", \n        (").concat(Object(a.b)(i),"), \n        ").concat(Object(a.b)(o),",\n        identity,\n        ").concat(Object(a.b)(s),"), ").concat(Object(a.b)(c),");\n    ").concat(u?"return vec2(abs(q.x) - "+u.code+", q.y);":"return q;","\n\n")}},box:function(e){var t=Object(r.a)(e,8),n=t[0],o=(t[1],t[2]),s=t[3],c=t[4],u=t[5],l=t[6],f=t[7];return{args:{p:"vec3"},returnType:"vec2",body:"\n\n  p = (p - ".concat(n,")*").concat(c,"  + (").concat(n,")*(").concat(c," - identity);\n  vec3 q = ").concat(i(f),";\n  return vec2(sdRoundBox3DCoord(\n        q, \n        ").concat(Object(a.b)(n),", \n        (").concat(Object(a.b)(o),"), \n        ").concat(Object(a.b)(s),", \n        ").concat(Object(a.b)(c||"identity"),", \n        ").concat(Object(a.b)(u),"), ").concat(Object(a.b)(l),");\n")}},circle:function(e){var t=Object(r.a)(e,6),n=t[0],i=(t[1],t[2]),o=(t[3],t[4],t[5]);return{args:{p:"vec2"},returnType:"vec2",body:"\n\nreturn vec2(length(p - ".concat(Object(a.b)(n),") - ").concat(Object(a.b)(i),".x, ").concat(Object(a.b)(o),");\n")}},sphere:function(e){var t=Object(r.a)(e,7),n=t[0],i=(t[1],t[2]),o=(t[3],t[4],t[5],t[6]);return{args:{p:"vec3"},returnType:"vec2",body:"\nreturn vec2(length(p - ".concat(Object(a.b)(n),") - ").concat(Object(a.b)(i),".x, ").concat(Object(a.b)(o),");\n")}},torus:function(e){var t=Object(r.a)(e,7),n=t[0],i=(t[1],t[2]),o=(t[3],t[4]),s=(t[5],t[6]);return{args:{p:"vec3"},returnType:"vec2",body:"\n    p = (p - ".concat(n,")*").concat(o,"  + (").concat(n,")*(").concat(o," - identity);\n    vec3 r = ").concat(i,";\n    float x = length(p.xz)-r.x;\n    return vec2(\n        length(vec2(x, p.y)) - r.y, \n        ").concat(Object(a.b)(s),");\n")}},plane:function(e){var t=Object(r.a)(e,7),n=t[0],i=(t[1],t[2]),o=(t[3],t[4],t[5],t[6]);return{args:{p:"vec3"},returnType:"vec2",body:"\n    return vec2(\n        dot(p, ".concat(i,") + ").concat(n,".x,\n        ").concat(Object(a.b)(o),");\n")}},hexagon:function(e){var t=Object(r.a)(e,6),n=t[0],i=(t[1],t[2]),o=(t[3],t[4]),s=t[5];return{args:{p:"vec2"},returnType:"vec2",body:"\n    p -= ".concat(Object(a.b)(n),";\n    if (").concat(Object(a.b)(o)," != 0.0) {\n    p *= rotate2D(").concat(Object(a.b)(o),");\n    }\n    float r = ").concat(Object(a.b)(i),".x;\n    const vec3 k = vec3(-0.866025404,0.5,0.577350269);\n    p = abs(p);\n     p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n    p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n    return vec2(length(p)*sign(p.y), ").concat(Object(a.b)(s),");\n\n")}},triangle:function(e){var t=Object(r.a)(e,6),n=t[0],i=(t[1],t[2]),o=t[3],s=t[4],c=t[5];return{args:{p:"vec2"},returnType:"vec2",body:"\n    p -= ".concat(Object(a.b)(n),";\n    if (").concat(Object(a.b)(s)," != 0.0) {\n    p *= rotate2D(").concat(Object(a.b)(s),");\n    }\n    float type = ").concat(Object(a.b)(o),";\n    \n   float w = ").concat(Object(a.b)(i),".x;\n   float h = ").concat(Object(a.b)(i),".y;\n   vec2 p0 = type == 3.0 ? vec2(0.0, w) : vec2(0.0, 0.0);\n   vec2 p1 = type == 0.0 ? vec2(0.0, h) : vec2(w, h);\n   vec2 p2 = type == 2.0 ? vec2(0.0, w) : vec2(w, 0.0);\n   vec2 e0 = p1 - p0;\n   vec2 e1 = p2 - p1;\n   vec2 e2 = p0 - p2;\n\n   vec2 v0 = p - p0;\n   vec2 v1 = p - p1;\n   vec2 v2 = p - p2;\n\n   vec2 pq0 = v0 - e0*clamp( dot(v0,e0)/dot(e0,e0), 0.0, 1.0 );\n   vec2 pq1 = v1 - e1*clamp( dot(v1,e1)/dot(e1,e1), 0.0, 1.0 );\n   vec2 pq2 = v2 - e2*clamp( dot(v2,e2)/dot(e2,e2), 0.0, 1.0 );\n    \n   float s = e0.x*e2.y - e0.y*e2.x;\n   vec2 d = min( min( vec2( dot( pq0, pq0 ), s*(v0.x*e0.y-v0.y*e0.x) ),\n                       vec2( dot( pq1, pq1 ), s*(v1.x*e1.y-v1.y*e1.x) )),\n                       vec2( dot( pq2, pq2 ), s*(v2.x*e2.y-v2.y*e2.x) ));\n\n   return vec2(-sqrt(d.x)*sign(d.y), ").concat(Object(a.b)(c),");\n")}},lineSegment:function(e){var t=Object(r.a)(e,6),n=t[0],i=(t[1],t[2]),o=t[3],s=t[4],c=t[5];return{args:{p:"vec2"},returnType:"vec2",body:"\nvec2 pointB = mix(".concat(Object(a.b)(n),", ").concat(Object(a.b)(i),", ").concat(Object(a.b)(o),");\n// lightsaver vec2 pa = ").concat(Object(a.b)(n)," - pointB;\n  vec2 pa = p - ").concat(Object(a.b)(n),";\n  vec2 ba = pointB - ").concat(Object(a.b)(n),";\n  float h = clamp(dot(pa, ba) / dot(ba, ba), 0.0, 1.0);\n  float sdf = abs(length(pa - ba * h)) - ").concat(Object(a.b)(s),";\n\nreturn vec2(sdf, ").concat(Object(a.b)(c),");\n")}}}},function(e,t,n){"use strict";n.d(t,"a",function(){return O});var r=n(1),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=n(115),h=n(222),d=n(116),p=n(113),v=n(123),m=n(6),y=n.n(m),b=n(979);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var O=function(e){Object(c.a)(n,e);var t=g(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Multi Filter",function(){return new y.a.Gain(1)},e)).context=(new v.a).forEffect(Object(o.a)(r)),r.preset=new h.a,r.setupFormants(),r.track={sequencerEngine:e},r.crossFade=new y.a.CrossFade(1),r.wetParameter=new p.c("Wet",r.crossFade.fade,{documentation:"Controls the amount of (wet) effected signal, vs. dry (un-effected) signal.",defaultValue:.5,min:0,max:1}),r.registerParameter(r.wetParameter),r.gainParameter=new p.c("Output Gain",r.formantsManager.output.gain,{defaultValue:1,min:0,max:4}),r.registerParameter(r.gainParameter),r.effectNode.connect(r.formantsManager.input),r.outputNode=new y.a.Gain(1),r.effectNode.connect(r.crossFade,0,0),r.formantsManager.output.connect(r.crossFade,0,1),r.crossFade.connect(r.outputNode),r}return Object(i.a)(n,[{key:"getJson",value:function(){for(var e,t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];var o=Object(r.a)({},(e=Object(s.a)(Object(l.a)(n.prototype),"getJson",this)).call.apply(e,[this].concat(a)),{gain:this.gainParameter.get(!0),multiFilter:this.getFormantsJson()});return o=this.saveParameterToJson(o,"gainParameter",this.gainParameter)}},{key:"fromJson",value:function(e,t,a,i){var o=Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,i);return"gain"in e&&Object(d.a)(this.gainParameter,e.gain,o),Object(r.a)({},o,this.loadFormantsJson(e.multiFilter,i),this.loadParameterFromJson(e,"gainParameter",this.gainParameter,i))}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(){this.outputNode.disconnect()}}]),n}(Object(b.a)(f.a.Effect))},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(115),f=n(116),h=n(6),d=n.n(h),p=n(113);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(s.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Gain",function(){return new d.a.Gain(1)},e)).effectNode.gain.value=1,r.gainParameter=new p.c("Gain",r.effectNode.gain,{documentation:"Controls the gain (or loudness) of the signal before it hits the compressor",min:0,max:6,unit:"db",defaultValue:1}),r.registerParameter(r.gainParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getJson",value:function(e){var t=Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return t.gain=this.gainParameter.get(),t=this.saveParameterToJson(t,"gainParameter",this.gainParameter)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return"gain"in e&&Object(f.a)(this.gainParameter,e.gain,a),Object(r.a)({},a,this.loadParameterFromJson(e,"gainParameter",this.gainParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(l.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(10),u=n(7),l=n(8),f=n(2),h=n(115),d=n(146),p=(n(116),n(6)),v=n.n(p);n(14);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var y=function(e){Object(u.a)(n,e);var t=m(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Granulator",function(){return new v.a.Gain(1)},e,!0)).outputNode=new v.a.Gain(1),r.loadedValue=1,r.initializeWorklets(),r.updateInitialValues(),r}return Object(s.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"initializeWorklets",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!d.isMobile&&!this.sequencerEngine.isOffline){e.next=4;break}this.effectNode.connect(this.outputNode),e.next=9;break;case 4:return e.next=6,this.sequencerEngine.initAudioWorklets();case 6:this.granulator=new AudioWorkletNode(v.a.Master.context._context,"granulator-node"),this.effectNode.connect(this.granulator),this.granulator.connect(this.outputNode);case 9:this.updateInitialValues();case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getJson",value:function(e){return Object(c.a)(Object(f.a)(n.prototype),"getJson",this).call(this)}},{key:"fromJson",value:function(e,t){return Object(c.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(h.a.Effect);t.a=y},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(31),u=n(10),l=n(7),f=n(8),h=n(2),d=n(115),p=n(146),v=(n(116),n(6)),m=n.n(v),y=n(14);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var g=function(e){Object(l.a)(n,e);var t=b(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Soft Clipper",function(){return new m.a.Gain(1)},e,!0)).outputNode=new m.a.Gain(1),r.amountParameter=new y.a("Amount",Object(c.a)(r),function(e,t){return r.softClipper?r.softClipper.parameters.get("amount").value=t:r.effectNode.gain.value=t},{documentation:"Controls the amount of soft clipping",min:0,max:8,defaultValue:1}),r.registerParameter(r.amountParameter),r.loadedValue=1,r.initializeWorklets(),r.updateInitialValues(),r}return Object(s.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"initializeWorklets",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!p.isMobile&&!this.sequencerEngine.isOffline){e.next=4;break}this.effectNode.connect(this.outputNode),e.next=10;break;case 4:return e.next=6,this.sequencerEngine.initAudioWorklets();case 6:this.softClipper=new AudioWorkletNode(m.a.Master.context._context,"soft-clipper-node"),this.amountParameter.set(this.loadedValue,!1,!1),this.effectNode.connect(this.softClipper),this.softClipper.connect(this.outputNode);case 10:this.updateInitialValues();case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getJson",value:function(e){var t=Object(u.a)(Object(h.a)(n.prototype),"getJson",this).call(this);return t.amount=this.amountParameter.get(),t}},{key:"fromJson",value:function(e,t){var r=Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,e,t);if(e.amount){this.loadedValue=e.amount;var a=this.amountParameter.set(e.amount,!1,!1),i=a.id,o=a.value;r[i]=o}return r}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(d.a.Effect);t.a=g},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2),u=n(115),l=n(6),f=n.n(l),h=n(14);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var p=function(e){Object(o.a)(n,e);var t=d(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Auto Wah",function(){return new f.a.AutoWah(50,6,-30)},e)).effectNode.gain.value=6,a.baseFrequencyParameter=new h.a("Base Frequency",a.effectNode,function(e,t){return e.baseFrequency=t},{min:0,max:1e4,unit:"hz",defaultValue:400}),a.registerParameter(a.baseFrequencyParameter),a.octaveParameter=new h.a("Octaves",a.effectNode,function(e,t){return e.octaves=t},{min:0,max:10,unit:"",defaultValue:1}),a.registerParameter(a.octaveParameter),a.qParameter=new h.c("Q",a.effectNode.Q,{min:0,max:10,unit:"",defaultValue:0}),a.registerParameter(a.qParameter),a.sensitivityParameter=new h.a("Sensitivity",a.effectNode,function(e,t){return e.sensitivity=t},{min:-12,max:6,unit:"db",defaultValue:0}),a.registerParameter(a.sensitivityParameter),a.attackParameter=new h.a("Attack",a.effectNode,function(e,t){return e.follower.attack=t},{min:0,max:2,unit:"",defaultValue:0}),a.registerParameter(a.attackParameter),a.releaseParameter=new h.a("Release",a.effectNode,function(e,t){return e.follower.release=t},{min:0,max:2,unit:"",defaultValue:0}),a.registerParameter(a.releaseParameter),a}return Object(a.a)(n,[{key:"getJson",value:function(){var e=Object(i.a)(Object(c.a)(n.prototype),"getJson",this).call(this);return e.name=this.name,e.baseFrequency=this.baseFrequencyParameter.get(),e.octave=this.octaveParameter.get(),e.q=this.qParameter.get(),e.sensitivity=this.sensitivityParameter.get(),e.attack=this.attackParameter.get(),e.release=this.releaseParameter.get(),e.wet=this.wetParameter.get(),e}},{key:"fromJson",value:function(e,t){Object(i.a)(Object(c.a)(n.prototype),"fromJson",this).call(this,e,t),"baseFrequency"in e&&this.baseFrequencyParameter.set(e.baseFrequency),"octave"in e&&this.octaveParameter.set(e.octave),"sensitivity"in e&&this.sensitivityParameter.set(e.sensitivity),"q"in e&&this.qParameter.set(e.q),"attack"in e&&this.attackParameter.set(e.attack),"release"in e&&this.releaseParameter.set(e.release),e.enabled&&this.enable(!0),"wet"in e&&this.setValue(e.wet)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(u.a.Effect);t.a=p},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(10),u=n(7),l=n(8),f=n(2),h=n(115),d=(n(116),n(6)),p=n.n(d);n(113);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var m=function(e){Object(u.a)(n,e);var t=v(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Granular",function(){return new p.a.Gain(1)},e)).effectNode.gain.value=1,r.outputNode=new p.a.Gain(1),r.initWorklet(),r.updateInitialValues(),r}return Object(s.a)(n,[{key:"initWorklet",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.a.Master.context._context,e.next=3,t.audioWorklet.addModule("/granular-processor.js");case 3:this.granularNode=new AudioWorkletNode(t,"granular-processor"),this.effectNode.connect(this.granularNode),this.granularNode.connect(this.outputNode);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"connect",value:function(e){this.connectedNode=e,this.outputNode.connect(e)}},{key:"disconnect",value:function(e){void 0!=this.connectedNode&&(this.outputNode.disconnect(e),this.connectedNode=void 0)}},{key:"getJson",value:function(e){return Object(c.a)(Object(f.a)(n.prototype),"getJson",this).call(this)}},{key:"fromJson",value:function(e,t){Object(c.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(h.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2),u=n(115),l=n(6),f=n.n(l),h=n(14);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}u.a.Effect},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2),u=n(115),l=n(6),f=n.n(l),h=n(113);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var p=function(e){Object(o.a)(n,e);var t=d(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Stereo Widener",function(){return new f.a.StereoWidener(.5)},e)).widthParameter=new h.c("Width",a.effectNode.width,{min:0,max:1,defaultValue:.5}),a.registerParameter(a.widthParameter),a.updateInitialValues(),a}return Object(a.a)(n,[{key:"getJson",value:function(){var e=Object(i.a)(Object(c.a)(n.prototype),"getJson",this).call(this);return e.width=this.widthParameter.get(),e=this.saveParameterToJson(e,"widthParameter",this.widthParameter)}},{key:"fromJson",value:function(e,t){Object(i.a)(Object(c.a)(n.prototype),"fromJson",this).call(this,e,t),this.widthParameter.set(e.width),this.loadParameterFromJson(e,"widthParameter",this.widthParameter,t)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(u.a.Effect);t.a=p},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=n(116),h=n(6),d=n.n(h),p=n(115),v=n(113),m=n(14),y=n(914);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var g=function(e){Object(c.a)(n,e);var t=b(n);function n(e){var r;Object(a.a)(this,n),r=t.call(this,"Ring Modulator",function(){return new d.a.Gain(.5)},e);var i=d.a.Master.context;return r.dryIn=r.effectNode,r.wetIn=new d.a.Gain(.5),r.dryIn.connect(r.wetIn),r.cross=new d.a.CrossFade(.5),r.dryIn.connect(r.cross,0,0),r.outGain=new d.a.Gain(1),r.outGain.connect(r.cross,0,1),r.wetParameter=new v.c("Wet",r.cross.fade,{documentation:"Controls the amount of (wet) effected signal, vs. dry (un-effected) signal.",defaultValue:.5,min:0,max:1}),r.registerParameter(r.wetParameter),r.cross.connect(r.outGain),r.vInGain=new d.a.Gain(.5),r.vIn=i.createOscillator(),r.vIn.frequency.value=30,r.vIn.start(0),r.vInInverter1=new d.a.Gain(-1),r.vInInverter2=new d.a.Gain(-1),r.vInInverter3=new d.a.Gain(-1),r.vInDiode1=new y.a(e),r.vInDiode2=new y.a(e),r.vcInverter1=i.createGain(),r.vcInverter1.gain.value=-1,r.vcDiode3=new y.a(e),r.vcDiode4=new y.a(e),r.compressor=new d.a.Compressor(-12,3),r.vIn.connect(r.vInGain),r.wetIn.connect(r.vcInverter1),r.wetIn.connect(r.vcDiode4.effectNode),r.vcInverter1.connect(r.vcDiode3.effectNode),r.vInGain.connect(r.vInInverter1),r.vInGain.connect(r.vcInverter1),r.vInGain.connect(r.vcDiode4.effectNode),r.vInInverter1.connect(r.vInInverter2),r.vInInverter1.connect(r.vInDiode2.effectNode),r.vInInverter2.connect(r.vInDiode1.effectNode),r.vInDiode1.connect(r.vInInverter3),r.vInDiode2.connect(r.vInInverter3),r.vInInverter3.connect(r.compressor),r.vcDiode3.connect(r.compressor),r.vcDiode4.connect(r.compressor),r.compressor.connect(r.outGain),r.frequencyParameter=new v.c("Frequency",r.vIn.frequency,{min:1,max:3e3,unit:"",defaultValue:30}),r.registerParameter(r.frequencyParameter),r.distortionParameter=new m.a("distortion",Object(o.a)(r),function(e,t){r.vInDiode1.distortionParameter.set(t),r.vInDiode2.distortionParameter.set(t),r.vcDiode3.distortionParameter.set(t),r.vcDiode4.distortionParameter.set(t)},{documention:"Controls the level of saturation.",min:2,max:10,unit:"",defaultValue:.3,constantAutomationRate:!0}),r.registerParameter(r.distortionParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"connect",value:function(e){this.cross.connect(e)}},{key:"disconnect",value:function(e){this.cross.disconnect()}},{key:"getJson",value:function(e){var t=Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this);return t.frequency=this.frequencyParameter.get(),t.distortion=this.distortionParameter.get(),t=this.saveParameterToJson(t,"frequencyParameter",this.frequencyParameter,e),t=this.saveParameterToJson(t,"distortionParameter",this.distortionParameter,e)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(f.a)(this.frequencyParameter,e.frequency,a),Object(f.a)(this.distortionParameter,e.distortion,a),Object(r.a)({},a,this.loadParameterFromJson(e,"frequencyParameter",this.frequencyParameter,t),this.loadParameterFromJson(e,"distortionParameter",this.distortionParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(p.a.Effect);t.a=g},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=n(115),h=n(116),d=n(6),p=n.n(d),v=n(14);n(113),n(365);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}new Float32Array(65536);var y=function(e){Object(c.a)(n,e);var t=m(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Diode",function(){return new p.a.WaveShaper([-1,1])},e)).vb=.2,r.vl=.4,r.distortionParameter=new v.a("distortion",Object(o.a)(r),function(e,t){r.recomputeCurve()},{documention:"Controls the level of saturation.",min:2,max:10,unit:"",defaultValue:.1,constantAutomationRate:!0}),r.registerParameter(r.distortionParameter),r}return Object(i.a)(n,[{key:"distortion",get:function(){return this.distortionParameter?this.distortionParameter.get():1}},{key:"recomputeCurve",value:function(){for(var e=new Float32Array(1024),t=0;t<1024;t++){var n=(t-512)/512,r=0;r=(n=Math.abs(n))<=this.vb?0:this.vb<n&&n<=this.vl?this.distortion*(Math.pow(n-this.vb,2)/(2*this.vl-2*this.vb)):this.distortion*n-this.distortion*this.vl+this.distortion*(Math.pow(this.vl-this.vb,2)/(2*this.vl-2*this.vb)),e[t]=r}this.effectNode.curve=e}},{key:"documentation",get:function(){return"Saturates the sound, making it more distorted."}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{distortionParameter:this.distortionParameter.get()});return e=this.saveParameterToJson(e,"distortion",this.distortionParameter)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(h.a)(this.distortionParameter,e.distortion,a),Object(r.a)({},a,this.loadParameterFromJson(e,"distortionParameter",this.distortionParamet,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(f.a.Effect);t.a=y},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2),u=n(115),l=n(6),f=n.n(l);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var d=1024,p=function(e){Object(o.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Oscilloscope",function(){return new f.a.Analyser({type:"waveform",size:d})},e)).size=d,a.newOutlet("Waveform Data"),a.newInlet("Start",function(){return a.onStart()}),a}return Object(a.a)(n,[{key:"dispose",value:function(){this.interval&&clearInterval(this.interval),Object(i.a)(Object(c.a)(n.prototype),"dispose",this).call(this)}},{key:"onStart",value:function(){var e=this;this.interval=setInterval(function(){e.sendMessage("Waveform Data",e.getValue())},64)}},{key:"getValue",value:function(){return this.effectNode.getValue()}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine;!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new n(e)}}]),n}(u.a.Effect);t.a=p},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),o=n.n(i),s="QmcdpaZe62u6p47s2Nmi7jYLpgTbmz6MxVnwvndNFi53Sf",c=new(function(){function e(){Object(r.a)(this,e),this.DEFAULT_BUFFER=new o.a.Buffer(window.isNFT?s:"/ipfs/"+s)}return Object(a.a)(e,[{key:"updateBuffer",value:function(){this.DEFAULT_BUFFER=new o.a.Buffer(window.isNFT?s:"/ipfs/"+s)}},{key:"setSampleRate",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];e!==o.a.context.sampleRate&&(o.a.setContext(new AudioContext({sampleRate:e,latencyHint:"playback"})),console.log("CHOOSING SAMPLE RATE=",e),window.context=o.a.Master.context,this.DEFAULT_BUFFER=new o.a.Buffer(window.isNFT?s:"/ipfs/"+s))}}]),e}());t.a=c},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(6),f=n.n(l),h=n(116),d=n(115),p=n(113);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(s.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Chebyshev",function(){return new f.a.Chebyshev(1)},e)).effectNode.oversampling="none",r.orderParameter=new p.a("Order",r.effectNode,function(e,t){return e.order=t},{min:1,max:100,unit:"",defaultValue:1}),r.registerParameter(r.orderParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"getJson",value:function(e){var t=Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return t.order=this.effectNode.order,t.enabled=this.enabledParameter.get(),t.wet=this.effectNode.wet.value,t.name=this.name,t=this.saveParameterToJson(t,"orderParameter",this.orderParameter,e)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(h.a)(this.orderParameter,e.order,a),e.enabled&&this.enable(!0),this.setValue(e.value),Object(r.a)({},a,this.loadParameterFromJson(e,"orderParameter",this.orderParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(d.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(6),f=n.n(l),h=n(115),d=n(113);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var v=function(e){Object(s.a)(n,e);var t=p(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Bit Crusher",function(){return new f.a.BitCrusher(8)},e)).bitsParameter=new d.a("Bits",r.effectNode,function(e,t){return e.bits=t},{min:1,max:8,unit:"",defaultValue:8}),r.registerParameter(r.bitsParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"getJson",value:function(e){var t=Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return t.bits=this.bitsParameter.get(),t.name=this.name,this.saveParameterToJson(t,"bitsParameter",this.bitsParameter,e)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return this.effectNode.bits=e.bits,this.effectNode.wet.value=e.wet,e.enabled&&this.enable(!0),Object(r.a)({},a,this.loadParameterFromJson(e,"bitsParameter",this.bitsParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(h.a.Effect);t.a=v},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(115),f=n(116),h=n(6),d=n.n(h),p=n(113);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(s.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Compressor",function(){return new d.a.Gain(1)},e)).effectNode.gain.value=1,r.compressorNode=new d.a.Compressor(-24,3),r.effectNode.connect(r.compressorNode),r.gainParameter=new p.c("Gain",r.effectNode.gain,{documentation:"Controls the gain (or loudness) of the signal before it hits the compressor",min:0,max:1,unit:"db",defaultValue:1}),r.registerParameter(r.gainParameter),r.thresholdParameter=new p.c("Threshold",r.compressorNode.threshold,{documentation:"The threshold of volume at which the compressor begins to compress.",min:-80,max:0,unit:"",defaultValue:-4,constantAutomationRate:!0,automatable:!1}),r.registerParameter(r.thresholdParameter),r.ratioParameter=new p.c("Ratio",r.compressorNode.ratio,{documentation:"The amount of compression that occurs once the signal passes the threshold.",min:1,max:24,unit:"",defaultValue:3,constantAutomationRate:!0}),r.registerParameter(r.ratioParameter),r.attackParameter=new p.b("Attack",r.compressorNode.attack,{constantAutomationRate:!0}),r.registerParameter(r.attackParameter),r.releaseParameter=new p.b("Release",r.compressorNode.release,{constantAutomationRate:!0}),r.registerParameter(r.releaseParameter),r.releaseParameter.set(.15),r.kneeParameter=new p.c("Knee",r.compressorNode.knee,{min:0,max:40,unit:"db",defaultValue:1,constantAutomationRate:!0}),r.registerParameter(r.kneeParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"dispose",value:function(){Object(o.a)(Object(u.a)(n.prototype),"dispose",this).call(this),this.compressorNode.dispose(),this.compressorNode=void 0}},{key:"connect",value:function(e){this.connectedNode=e,this.compressorNode.connect(e)}},{key:"disconnect",value:function(e){null!=this.connectedNode&&(this.compressorNode.disconnect(e),this.connectedNode=null)}},{key:"getJson",value:function(e){var t=Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return t.name=this.name,t.gain=this.gainParameter.get(),t.threshold=this.thresholdParameter.get(),t.ratio=this.ratioParameter.get(),t.release=this.releaseParameter.get(),t.attack=this.attackParameter.get(),t.knee=this.kneeParameter.get(),t.enabled=this.enabledParameter.get(),t=this.saveParameterToJson(t,"gainParameter",this.gainParameter),(this.thresholdParameter.isConnectedToAnyModulator()||Object.keys(this.thresholdParameter.patternToValue).length>0)&&(t.thresholdParameter=this.thresholdParameter.getJson()),(this.ratioParameter.isConnectedToAnyModulator()||Object.keys(this.ratioParameter.patternToValue).length>0)&&(t.ratioParameter=this.ratioParameter.getJson()),(this.releaseParameter.isConnectedToAnyModulator()||Object.keys(this.releaseParameter.patternToValue).length>0)&&(t.releaseParameter=this.releaseParameter.getJson()),(this.attackParameter.isConnectedToAnyModulator()||Object.keys(this.attackParameter.patternToValue).length>0)&&(t.attackParameter=this.attackParameter.getJson()),this.kneeParameter.isConnectedToAnyModulator()|Object.keys(this.kneeParameter.patternToValue).length>0&&(t.kneeParameter=this.kneeParameter.getJson()),t}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return"gain"in e&&Object(f.a)(this.gainParameter,e.gain,a),"threshold"in e&&Object(f.a)(this.thresholdParameter,e.threshold,a),"ratio"in e&&Object(f.a)(this.ratioParameter,e.ratio,a),"release"in e&&Object(f.a)(this.releaseParameter,e.release,a),"attack"in e&&Object(f.a)(this.attackParameter,e.attack,a),"knee"in e&&Object(f.a)(this.kneeParameter,e.knee,a),e.enabled&&this.enable(!0),Object(r.a)({},a,this.loadParameterFromJson(e,"gainParameter",this.gainParameter,t),this.loadParameterFromJson(e,"thresholdParameter",this.thresholdParameter,t),this.loadParameterFromJson(e,"ratioParameter",this.ratioParameter,t),this.loadParameterFromJson(e,"releaseParameter",this.releaseParameter,t),this.loadParameterFromJson(e,"attackParameter",this.attackParameter,t),this.loadParameterFromJson(e,"kneeParameter",this.kneeParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(l.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(6),f=n.n(l),h=n(116),d=n(115),p=n(113);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(s.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Distortion",function(){return new f.a.Distortion(.4)},e)).effectNode.oversampling="4x",r.distortionParameter=new p.a("Distortion",r.effectNode,function(e,t){return e.distortion=t},{min:0,max:1,unit:"%",defaultValue:.1}),r.registerParameter(r.distortionParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"getJson",value:function(){var e=Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return e.distortion=this.effectNode.distortion,e.enabled=this.enabledParameter.get(),e.wet=this.effectNode.wet.value,e.name=this.name,(this.distortionParameter.isConnectedToAnyModulator()||Object.keys(this.distortionParameter.patternToValue).length>0)&&(e.distortionParameter=this.distortionParameter.getJson()),e}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(h.a)(this.distortionParameter,e.distortion,a),e.enabled&&this.enable(!0),this.setValue(e.value),Object(r.a)({},a,this.loadParameterFromJson(e,"distortionParameter",this.distortionParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(d.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(6),f=n.n(l),h=n(116),d=n(115),p=(n(113),n(14));function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(s.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Pitch Shift",function(){return new f.a.PitchShift(0)},e)).pitchParameter=new p.a("Pitch",r.effectNode,function(e,t){e&&e._delayA&&(e.pitch=t)},{min:-24,max:24,unit:"",defaultValue:12}),r.registerParameter(r.pitchParameter),r.windowSizeParameter=new p.a("Window Size",r.effectNode,function(e,t){e&&(e.windowSize=t)},{min:.01,max:.5,unit:"",defaultValue:.03}),r.registerParameter(r.windowSizeParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"getJson",value:function(){var e=Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return e.pitch=this.pitchParameter.get(!0),e.windowSize=this.windowSizeParameter.get(!0),e.enabled=this.enabledParameter.get(!0),e.wet=this.effectNode.wet.value,e.name=this.name,e=this.saveParameterToJson(e,"pitchParameter",this.pitchParameter),e=this.saveParameterToJson(e,"windowSizeParameter",this.windowSizeParameter)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(h.a)(this.pitchParameter,e.pitch,a),Object(h.a)(this.windowSizeParameter,e.windowSize,a),e.enabled&&this.enable(!0),this.setValue(e.value),Object(r.a)({},a,this.loadParameterFromJson(e,"pitchParameter",this.pitchParameter,t),this.loadParameterFromJson(e,"windowSizeParameter",this.windowSizeParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(d.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(6),f=n.n(l),h=(n(23),n(22)),d=n(116),p=n(115),v=n(113);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var y=function(e){Object(s.a)(n,e);var t=m(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Panner",function(){return new f.a.Panner(0)},e)).panningParameter=new v.c("Panning",r.effectNode._panner.pan,{min:-1,log:!0,max:1,unit:"",defaultValue:0,automationRate:h.a,noInput:!0}),r.registerParameter(r.panningParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"getJson",value:function(){var e=Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return e.panning=this.panningParameter.get(!0),e.enabled=this.enabledParameter.get(!0),e.name=this.name,e=this.saveParameterToJson(e,"panningParameter",this.panningParameter)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(d.a)(this.panningParameter,e.panning,a),e.enabled&&this.enable(!0),Object(r.a)({},a,this.loadParameterFromJson(e,"panningParameter",this.panningParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(p.a.Effect);t.a=y},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(6),f=n.n(l),h=n(115),d=n(14);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var v=function(e){Object(s.a)(n,e);var t=p(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"EQ 3",function(){return new f.a.EQ3},e)).lowParameter=new d.a("Low",r.effectNode.low,function(e,t){return e.value=t},{min:-10,max:10,unit:"db",defaultValue:0}),r.lowFrequencyParameter=new d.a("Low Frequency",r.effectNode.lowFrequency,function(e,t){return e.value=t},{min:0,max:400,unit:"hz",defaultValue:0}),r.midParameter=new d.a("Mid",r.effectNode.mid,function(e,t){return e.value=t},{min:-10,max:10,unit:"db",defaultValue:0}),r.highParameter=new d.a("High",r.effectNode.high,function(e,t){return e.value=t},{min:-10,max:10,unit:"db",defaultValue:0}),r.highFrequencyParameter=new d.a("High Frequency",r.effectNode.highFrequency,function(e,t){return e.value=t},{min:1e3,max:1e4,unit:"hz",defaultValue:2e3}),r.registerParameter(r.lowParameter),r.registerParameter(r.midParameter),r.registerParameter(r.highParameter),r.registerParameter(r.lowFrequencyParameter),r.registerParameter(r.highFrequencyParameter),r}return Object(i.a)(n,[{key:"getJson",value:function(){return Object(r.a)({},Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{low:this.lowParameter.get(),mid:this.midParameter.get(),high:this.highParameter.get(),lowFrequency:this.lowFrequencyParameter.get(),highFrequency:this.highFrequencyParameter.get(),enabled:this.enabledParameter.get(),name:this.name})}},{key:"fromJson",value:function(e,t){Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t),this.lowParameter.set(e.low),this.midParameter.set(e.mid),this.highParameter.set(e.high),this.lowFrequencyParameter.set(e.lowFrequency),this.highFrequencyParameter.set(e.highFrequency),this.enable(e.enabled)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(h.a.Effect);t.a=v},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(6),f=n.n(l),h=n(115),d=(n(14),n(113));function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var v="peaking",m=function(e){Object(s.a)(n,e);var t=p(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"EQ 10",function(){return new f.a.Gain(1)},e)).filter31=new f.a.Filter(31,v),r.filter31.Q.value=.71,r.filter63=new f.a.Filter(63,v),r.filter63.Q.value=.71,r.filter125=new f.a.Filter(125,v),r.filter125.Q.value=.71,r.filter250=new f.a.Filter(250,v),r.filter250.Q.value=.71,r.filter500=new f.a.Filter(500,v),r.filter500.Q.value=.71,r.filter1k=new f.a.Filter(1e3,v),r.filter1k.Q.value=.71,r.filter2k=new f.a.Filter(2e3,v),r.filter2k.Q.value=.71,r.filter4k=new f.a.Filter(4e3,v),r.filter4k.Q.value=.71,r.filter8k=new f.a.Filter(8e3,v),r.filter8k.Q.value=.71,r.filter16k=new f.a.Filter(16e3,v),r.filter16k.Q.value=.71,r.outputNode=new f.a.Gain(1),r.effectNode.chain(r.filter31,r.filter63,r.filter125,r.filter250,r.filter500,r.filter1k,r.filter2k,r.filter4k,r.filter8k,r.filter16k,r.outputNode),r.gain31Parameter=new d.c("Gain 31",r.filter31.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain31Parameter),r.gain63Parameter=new d.c("Gain 63",r.filter63.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain63Parameter),r.gain125Parameter=new d.c("Gain 125",r.filter125.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain125Parameter),r.gain125Parameter=new d.c("Gain 125",r.filter125.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain125Parameter),r.gain250Parameter=new d.c("Gain 250",r.filter250.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain250Parameter),r.gain500Parameter=new d.c("Gain 500",r.filter500.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain500Parameter),r.gain1kParameter=new d.c("Gain 1k",r.filter1k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain1kParameter),r.gain2kParameter=new d.c("Gain 2k",r.filter2k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain2kParameter),r.gain4kParameter=new d.c("Gain 4k",r.filter4k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain4kParameter),r.gain8kParameter=new d.c("Gain 8k",r.filter8k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain8kParameter),r.gain16kParameter=new d.c("Gain 16k",r.filter16k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain16kParameter),r}return Object(i.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(){this.outputNode.disconnect()}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{gain63:this.gain63Parameter.get(),gain125:this.gain125Parameter.get(),gain250:this.gain250Parameter.get(),gain500:this.gain500Parameter.get(),gain1k:this.gain1kParameter.get(),gain2k:this.gain2kParameter.get(),gain4k:this.gain4kParameter.get(),gain8k:this.gain8kParameter.get(),gain16k:this.gain16kParameter.get()});return e=this.saveParameterToJson(e,"gain31Parameter",this.gain31Parameter),e=this.saveParameterToJson(e,"gain63Parameter",this.gain63Parameter),e=this.saveParameterToJson(e,"gain125Parameter",this.gain125Parameter),e=this.saveParameterToJson(e,"gain250Parameter",this.gain250Parameter),e=this.saveParameterToJson(e,"gain500Parameter",this.gain500Parameter),e=this.saveParameterToJson(e,"gain1kParameter",this.gain1kParameter),e=this.saveParameterToJson(e,"gain2kParameter",this.gain2kParameter),e=this.saveParameterToJson(e,"gain4kParameter",this.gain4kParameter),e=this.saveParameterToJson(e,"gain8kParameter",this.gain8kParameter),e=this.saveParameterToJson(e,"gain16kParameter",this.gain16kParameter)}},{key:"fromJson",value:function(e,t){Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t),this.gain63Parameter.set(e.gain63),this.gain125Parameter.set(e.gain125),this.gain250Parameter.set(e.gain250),this.gain500Parameter.set(e.gain500),this.gain1kParameter.set(e.gain1k),this.gain2kParameter.set(e.gain2k),this.gain4kParameter.set(e.gain4k),this.gain8kParameter.set(e.gain8k),this.gain16kParameter.set(e.gain16k),this.loadParameterFromJson(e,"gain31Parameter",this.gain31Parameter,t),this.loadParameterFromJson(e,"gain63Parameter",this.gain63Parameter,t),this.loadParameterFromJson(e,"gain125Parameter",this.gain125Parameter,t),this.loadParameterFromJson(e,"gain250Parameter",this.gain250Parameter,t),this.loadParameterFromJson(e,"gain500Parameter",this.gain500Parameter,t),this.loadParameterFromJson(e,"gain1kParameter",this.gain1kParameter,t),this.loadParameterFromJson(e,"gain2kParameter",this.gain2kParameter,t),this.loadParameterFromJson(e,"gain4kParameter",this.gain4kParameter,t),this.loadParameterFromJson(e,"gain8kParameter",this.gain8kParameter,t),this.loadParameterFromJson(e,"gain16kParameter",this.gain16kParameter,t),this.enable(e.enabled)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(h.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),o=n(10),s=n(7),c=n(8),u=n(2),l=n(115),f=n(6),h=n.n(f),d=n(14);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var v=function(e){Object(s.a)(n,e);var t=p(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Gate",function(){return new h.a.Gain(2)},e)).connectedTrack=void 0,a.follower=new h.a.Follower(.012,.1),a.multiplier=new h.a.Gain(100),a.gate=new h.a.Gate(-30,.001,.2),a.smoothingParameter=new d.a("Smoothing",Object(i.a)(a),function(e,t){return a.gate.smoothing=t},{min:1e-5,max:2,unit:"ms",defaultValue:.012}),a.thresholdParameter=new d.a("Threshold",Object(i.a)(a),function(e,t){return a.gate.threshold=t},{min:-30,max:6,unit:"db",defaultValue:0}),a.registerParameter(a.smoothingParameter),a.registerParameter(a.thresholdParameter),a.effectNode.connect(a.gate),a.updateInitialValues(),a}return Object(a.a)(n,[{key:"connect",value:function(e){this.gate.connect(e)}},{key:"disconnect",value:function(e){this.gate.disconnect(e)}},{key:"smoothing",get:function(){return this.smoothingParameter.get()},set:function(e){return this.smoothingParameter.set(e)}},{key:"threshold",get:function(){return this.thresholdParameter.get()},set:function(e){return this.thresholdParameter.set(e)}},{key:"setSideChainedTrack",value:function(e,t){void 0!==this.connectedTrack&&this.connectedTrack.volumeNode.disconnect(this.multiplier),e.volumeNode.chain(this.multiplier,this.follower),this.follower.connect(this.effectNode.gain),this.connectedTrack=e,this.trackNumber=t}},{key:"getJson",value:function(){var e=Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return e.trackNumber=this.trackNumber,e.threshold=this.threshold,e.smoothing=this.smoothing,e=this.saveParameterToJson(e,"smoothingParameter",this.smoothingParameter),e=this.saveParameterToJson(e,"thresholdParameter",this.thresholdParameter)}},{key:"fromJson",value:function(e,t,r){Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,r),e.enabled&&this.enable(!0),this.threshold=e.threshold,this.smoothing=e.smoothing,this.setSideChainedTrack(t[e.trackNumber],e.trackNumber),this.loadParameterFromJson(e,"thresholdParameter",this.thresholdParameter),this.loadParameterFromJson(e,"smoothingParameter",this.smoothingParameter)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),this.sequencerEngine.tracks,t),r}}]),n}(l.a.Effect);t.a=v},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(115),f=n(116),h=n(6),d=n.n(h),p=n(574),v=n(374),m=n(113);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var b=function(e){Object(s.a)(n,e);var t=y(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Tape Delay",function(){return new d.a.Gain(1)},e)).initComponents(),r.rateParameter=new m.c("Rate",r.delayNode.delayTime,{documentation:"The amount of time (in seconds) between echos.",defaultValue:.6,min:0,max:1},.07),r.registerParameter(r.rateParameter),r.feedbackParameter=new m.c("Feedback",r.feedbackNode.gain,{documentation:["The amount of delayed signal that is fed back into the effect","Be careful, past 50%-- depending on the saturation-- it can get unruly."],defaultValue:.1,min:0,max:1}),r.registerParameter(r.feedbackParameter),r.wetParameter=new m.c("Wet",r.crossFade.fade,{documentation:"Controls the amount of (wet) effected signal, vs. dry (un-effected) signal.",defaultValue:.5,min:0,max:1}),r.registerParameter(r.wetParameter),r.updateInitialValues(),r.isSaturated=!0,r}return Object(i.a)(n,[{key:"isSaturated",set:function(e){void 0!==this._isSaturated&&e!==this._isSaturated&&(e?(this.inputNode.disconnect(this.fakeSat),this.fakeSat.disconnect(this.eqNode.effectNode),this.feedbackNode.disconnect(this.fakeSat),this.inputNode.connect(this.saturatorNode.effectNode),this.saturatorNode.connect(this.eqNode.effectNode),this.feedbackNode.connect(this.saturatorNode.effectNode)):(this.inputNode.connect(this.fakeSat),this.fakeSat.connect(this.eqNode.effectNode),this.feedbackNode.connect(this.fakeSat),this.inputNode.disconnect(this.saturatorNode.effectNode),this.saturatorNode.disconnect(this.eqNode.effectNode),this.feedbackNode.disconnect(this.saturatorNode.effectNode))),this._isSaturated=e}},{key:"documentation",get:function(){return"Emulates a tape echo effect, where the signal is fed back into the effect, and saturated."}},{key:"driveParameter",get:function(){return this.saturatorNode&&this.saturatorNode.driveParameter}},{key:"lowEQParameter",get:function(){return this.eqNode&&this.eqNode.equalizerPoints[0].gainParameter}},{key:"midEQParameter",get:function(){return this.eqNode&&this.eqNode.equalizerPoints[4].gainParameter}},{key:"highEQParameter",get:function(){return this.eqNode&&this.eqNode.equalizerPoints[7].gainParameter}},{key:"initComponents",value:function(){this.inputNode=this.effectNode,this.crossFade=new d.a.CrossFade(.5),this.feedbackNode=new d.a.Gain(.35),this.saturatorNode=new p.a(this.sequencerEngine),this.saturatorNode.driveParameter.set(.95),this.registerParameter(this.driveParameter),this.delayNode=new d.a.FeedbackDelay(.1,.1),this.eqNode=new v.a(this.sequencerEngine,!1),this.fakeSat=new d.a.Gain(1),this.eqNode.equalizerPoints[0].frequencyParameter.set(300),this.eqNode.equalizerPoints[4].qParameter.set(.7),this.eqNode.equalizerPoints[7].frequencyParameter.set(4e3),this.registerParameter(this.lowEQParameter),this.registerParameter(this.midEQParameter),this.registerParameter(this.highEQParameter),this.delayNode.wet.value=1,this.inputNode.connect(this.saturatorNode.effectNode),this.saturatorNode.connect(this.eqNode.effectNode),this.eqNode.connect(this.delayNode),this.inputNode.connect(this.crossFade,0,0),this.delayNode.connect(this.crossFade,0,1),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.saturatorNode.effectNode),this.outputNode=new d.a.Gain(1),this.crossFade.connect(this.outputNode)}},{key:"registerContext",value:function(e){console.log("registering context for tape"),Object(o.a)(Object(u.a)(n.prototype),"registerContext",this).call(this,e),this.eqNode.registerContext(e)}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"dispose",value:function(){Object(o.a)(Object(u.a)(n.prototype),"dispose",this).call(this),this.delayNode.dispose(),this.eqNode.dispose(),this.saturatorNode.dispose(),this.feedbackNode.dispose(),this.crossFade.dispose(),this.outputNode.dispose(),this.fakeSat.dispose(),this.fakeSat=void 0,this.rateParameter=void 0,this.wetParameter=void 0,this.track=void 0,this.inputNode=void 0,this.feedbackParameter=void 0,this.delayNode=void 0,this.eqNode=void 0,this.saturatorNode=void 0,this.feedbackNode=void 0,this.crossFadeNode=void 0,this.outputNode=void 0,this.parameters=void 0,this.rateParameter=void 0,this.feedbackParameter=void 0,this.wetParameter=void 0,this.sequencerEngine=void 0}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{lowEQ:this.lowEQParameter.get(!0),midEQ:this.midEQParameter.get(!0),drive:this.driveParameter.get(!0),highEQ:this.highEQParameter.get(!0),feedback:this.feedbackParameter.get(!0),wet:this.wetParameter.get(!0),rate:this.rateParameter.get(!0),isSaturated:this._isSaturated});return e=this.saveParameterToJson(e,"driveParameter",this.driveParameter),e=this.saveParameterToJson(e,"lowEQParameter",this.lowEQParameter),e=this.saveParameterToJson(e,"midEQParameter",this.midEQParameter),e=this.saveParameterToJson(e,"highEQParameter",this.highEQParameter),e=this.saveParameterToJson(e,"feedbackParameter",this.feedbackParameter),e=this.saveParameterToJson(e,"rateParameter",this.rateParameter),e=this.saveParameterToJson(e,"wetParameter",this.wetParameter)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(f.a)(this.lowEQParameter,e.lowEQ,a),Object(f.a)(this.midEQParameter,e.midEQ,a),Object(f.a)(this.highEQParameter,e.highEQ,a),Object(f.a)(this.feedbackParameter,e.feedback,a),Object(f.a)(this.wetParameter,e.wet,a),Object(f.a)(this.rateParameter,e.rate,a),e.drive&&Object(f.a)(this.driveParameter,e.drive,a),void 0!==e.isSaturated&&(this.isSaturated=e.isSaturated),Object(r.a)({},a,this.loadParameterFromJson(e,"lowEQParameter",this.lowEQParameter,t),this.loadParameterFromJson(e,"driveParameter",this.driveParameter,t),this.loadParameterFromJson(e,"midEQParameter",this.midEQParameter,t),this.loadParameterFromJson(e,"highEQParameter",this.highEQParameter,t),this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter,t),this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t),this.loadParameterFromJson(e,"wetParameter",this.wetParameter,t))}}]),n}(l.a.Effect);t.a=b},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(t,n){Object(r.a)(this,e),this.minValue=t,this.maxValue=t,this.min=t,this.max=n}return Object(a.a)(e,[{key:"min",get:function(){return this.minValue},set:function(e){this.minValue="-"===e?-0:parseFloat(e)}},{key:"max",get:function(){return this.maxValue},set:function(e){this.maxValue="-"===e?-0:parseFloat(e)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(927),o=(n(6),function(){function e(t,n,a,i){Object(r.a)(this,e),this.initialBulkValues={},this.sequencerEngine=t,this.store=t.store,this.context=a,this.number=i,this.idToParameter={},this.parameterToScaler={},this.parameterIdToVoiceToNode={},this.parameters=[]}return Object(a.a)(e,[{key:"getType",value:function(){}},{key:"connect",value:function(e,t,n){if(void 0!==e){this.idToParameter[t.id]=t;var r=this.getChain(t,e);this.getModulator().connect(r[0]);for(var a=0;a<r.length-1;a++)r[a].connect(r[a+1]);return r.used=!0,void 0===this.parameterIdToVoiceToNode[t.id]&&(this.parameterIdToVoiceToNode[t.id]={}),this.parameterIdToVoiceToNode[t.id][n]=r,r}var o=new i.a(t.min,t.max);this.parameterToScaler[t.id]=o}},{key:"replaceParameterIds",value:function(e,t,n){if(e!==t){var r=this.parameterIdToVoiceToNode[e];this.parameterIdToVoiceToNode[t]=r;var a=this.parameterToScaler[e];a&&(this.parameterToScaler[t]=a),this.idToParameter[t]=n,delete this.parameterIdToVoiceToNode[e],delete this.parameterToScaler[e],delete this.idToParameter[e]}}},{key:"disconnect",value:function(e,t,n){if(this.parameterIdToVoiceToNode&&void 0!==this.parameterIdToVoiceToNode[t.id]){delete this.idToParameter[t.id];var r=this.parameterIdToVoiceToNode[t.id][n];delete this.parameterIdToVoiceToNode[t.id][n],0===Object.keys(this.parameterIdToVoiceToNode[t.id]).length&&delete this.parameterIdToVoiceToNode[t.id],void 0!==this.parameterToScaler[t.id]&&delete this.parameterToScaler[t.id];var a=this.getModulator();if(void 0!==r&&a){var i=this.getScaleFromChain(r);i.min=0,i.max=0,a.output._add.input&&a.disconnect(r[0]);for(var o=0;o<r.length-1;o++)r[o].disconnect(r[o+1]);r.used=!1,this.releaseChain(r)}}}},{key:"disposeParameters",value:function(){this.parameters.forEach(function(e){return e.dispose(!1)})}},{key:"disconnectAllModulators",value:function(){this.parameters.forEach(function(e){return e.disconnectFromAllModulators()})}},{key:"getScaleForParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.parameterToScaler[e.id])return this.parameterToScaler[e.id];if(this.parameterIdToVoiceToNode){var n=this.parameterIdToVoiceToNode[e.id];if(void 0!==n){var r=n[t];return this.getScaleFromChain(r)}}}},{key:"getDepthForParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.parameterIdToVoiceToNode[e.id];if(void 0!==n){var r=n[t];return this.getDepthFromChain(r)}}}]),e}());t.a=o},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=n(115),h=n(6),d=n.n(h),p=n(14),v=(n(113),n(365),n(282));function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var y=function(e){Object(c.a)(n,e);var t=m(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Stereo Delay",function(){return new d.a.Gain(1)},e)).initComponents(),r.isSynced=!0,r.wetParameter=new p.a("Wet",Object(o.a)(r),function(e,t){r.leftDelay.wetParameter.set(t),r.rightDelay.wetParameter.set(t)},{min:0,max:1,unit:"",defaultValue:0,constantAutomationRate:!0}),r.registerParameter(r.wetParameter),r.feedbackParameter=new p.a("Feedback",Object(o.a)(r),function(e,t){r.leftDelay.feedbackParameter.set(t),r.rightDelay.feedbackParameter.set(t)},{min:0,max:1,unit:"",defaultValue:0,constantAutomationRate:!0}),r.registerParameter(r.feedbackParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"initComponents",value:function(){this.leftDelay=new v.a(this.sequencerEngine),this.rightDelay=new v.a(this.sequencerEngine),this.effectNode.connect(this.leftDelay.effectNode),this.effectNode.connect(this.rightDelay.effectNode),this.merger=new d.a.Merge,this.leftDelay.connect(this.merger.left),this.rightDelay.connect(this.merger.right),this.outputNode=new d.a.Gain(1),this.merger.connect(this.outputNode)}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{leftDelay:this.leftDelay.getJson(),rightDelay:this.rightDelay.getJson(),wet:this.wetParameter.get(),feedback:this.feedbackParameter.get(),isSynced:this.isSynced});return e=this.saveParameterToJson(e,"wetParameter",this.wetParameter),e=this.saveParameterToJson(e,"feedbackParameter",this.feedbackParameter)}},{key:"fromJson",value:function(e,t){Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t),this.isSynced=e.isSynced,this.wetParameter.set(e.wet),this.feedbackParameter.set(e.feedback),this.leftDelay.fromJson(e.leftDelay),this.rightDelay.fromJson(e.rightDelay),this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter,t),this.loadParameterFromJson(e,"wetParameter",this.wetParameter,t)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(f.a.Effect);t.a=y},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(1),s=n(4),c=n(5),u=n(10),l=n(7),f=n(8),h=n(2),d=n(366),p=n(6),v=n.n(p),m=n(115);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var b="QmQjRkKxSgAYtuepTdHp8inhYp8QYc18KUL5fYSprqKAEt",g=function(e){Object(l.a)(n,e);var t=y(n);function n(e,r){var a;return Object(s.a)(this,n),(a=t.call(this,"Guitar Amp",function(){return new v.a.Gain(1)},e)).convolver=r||new d.a(e),r||a.convolver.setConvolverSample(b),a.convolver.wetParameter.set(1),a.effectNode.connect(a.convolver.effectNode),a.updateInitialValues(),a}return Object(c.a)(n,[{key:"dispose",value:function(){Object(u.a)(Object(h.a)(n.prototype),"dispose",this).call(this),this.convolver.dispose()}},{key:"disconnect",value:function(e){this.convolver.disconnect(e)}},{key:"connect",value:function(e){this.convolver.connect(e)}},{key:"getJson",value:function(){return Object(o.a)({},Object(u.a)(Object(h.a)(n.prototype),"getJson",this).call(this),{convolver:this.convolver.getJson()})}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,t,r),e.next=3,this.convolver.fromJson(t.convolver,r);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];console.log("get effect copy guitar amp");var r=new n(e,this.convolver.getEffectCopy(e,t));return t||(r.id=this.id),r}}]),n}(m.a.Effect);t.a=g},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=n(115),h=n(116),d=n(6),p=n.n(d),v=n(14),m=n(113);n(365);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}new Float32Array(65536);var b=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Wave Folder",function(){return new p.a.Gain(1)},e)).crossFade=new p.a.CrossFade(0),r.wetParameter=new m.c("Wet",r.crossFade.fade,{documentation:"Controls the amount of (wet) effected signal, vs. dry (un-effected) signal.",defaultValue:.5,min:0,max:1}),r.registerParameter(r.wetParameter),r.counter=0,r.waveShaperNode=new p.a.WaveShaper([-1,1]),r.effectNode.connect(r.waveShaperNode),r.postGain=new p.a.Gain(1),r.waveShaperNode.connect(r.postGain),r.effectNode.connect(r.crossFade,0,0),r.postGain.connect(r.crossFade,0,1),r.overSampleParameter=new v.a("oversample",Object(o.a)(r),function(e,t){return r.waveShaperNode.oversample=t?"4x":"none"},{min:.01,max:32,unit:"",defaultValue:!1,constantAutomationRate:!0}),r.driveParameter=new m.a("drive",r.effectNode.gain,function(e,t){r.effectNode.gain.value=t,r.postGain.gain.value=Math.pow(1/t,.6)},{documention:"Controls the level of saturation.",min:.01,max:32,unit:"",defaultValue:1,constantAutomationRate:!0}),r.registerParameter(r.driveParameter),r.stagesParameter=new v.a("stages",Object(o.a)(r),function(e,t){r.recomputeCurve()},{documention:"Controls the level of saturation.",min:2,max:10,unit:"",defaultValue:4,constantAutomationRate:!0,automatable:!1}),r.registerParameter(r.stagesParameter),r.smoothnessParameter=new v.a("smoothness",Object(o.a)(r),function(e,t){r.recomputeCurve()},{documention:"Controls the level of saturation.",min:1,max:32,unit:"",defaultValue:6,constantAutomationRate:!0,automatable:!1}),r.registerParameter(r.smoothnessParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"stages",get:function(){return this.stagesParameter?this.stagesParameter.get():4}},{key:"smoothness",get:function(){return this.smoothnessParameter?this.smoothnessParameter.get():6}},{key:"recomputeCurve",value:function(){var e=this,t=++this.counter;setTimeout(function(){if(t===e.counter){for(var n=Math.pow(2,e.smoothness+1)*(2*e.stages+1)+1,r=new Float32Array(n),a=0;a<n;a++){var i=(2*e.stages+1)*Math.PI*(a/(n-1)-.5);r[a]=Math.sin(i)}e.waveShaperNode.curve=r}},100)}},{key:"documentation",get:function(){return"Saturates the sound, making it more distorted."}},{key:"dispose",value:function(){Object(s.a)(Object(l.a)(n.prototype),"dispose",this).call(this),this.postGain.dispose(),this.waveShaperNode.dispose()}},{key:"connect",value:function(e){this.crossFade.connect(e)}},{key:"disconnect",value:function(e){this.crossFade.disconnect(e)}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{oversample:this.overSampleParameter.get(),smoothness:this.smoothnessParameter.get(),stages:this.stagesParameter.get(),drive:this.driveParameter.get()});return e=this.saveParameterToJson(e,"oversampleParameter",this.overSampleParameter),e=this.saveParameterToJson(e,"driveParameter",this.driveParameter),e=this.saveParameterToJson(e,"smoothnessParameter",this.smoothnessParameter),e=this.saveParameterToJson(e,"stagesParameter",this.stagesParameter)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(h.a)(this.driveParameter,e.drive,a),Object(h.a)(this.overSampleParameter,e.overSample,a),Object(h.a)(this.smoothnessParameter,e.smoothness,a),Object(h.a)(this.stagesParameter,e.stages,a),Object(r.a)({},a,this.loadParameterFromJson(e,"driveParameter",this.driveParameter,t),this.loadParameterFromJson(e,"overSampleParameter",this.overSampleParameter,t),this.loadParameterFromJson(e,"smoothnessParameter",this.smoothnessParameter,t),this.loadParameterFromJson(e,"stagesParameter",this.stagesParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(f.a.Effect);t.a=b},function(e,t,n){"use strict";n.d(t,"a",function(){return k});var r=n(1),a=n(11),i=n(4),o=n(5),s=n(10),c=n(7),u=n(8),l=n(2),f=n(115),h=n(192),d=n(116),p=n(6),v=n.n(p),m=(n(113),n(577));function y(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var O=12,j=new Array(O).fill(0).map(function(e,t){return 30+1e4*Math.pow(t/O,1.2)}),k=function(e){Object(c.a)(n,e);var t=g(n);function n(e){var r;Object(i.a)(this,n),(r=t.call(this,"Vocoder",function(){return new v.a.Gain(4)},e)).components=[],console.log(j),r.outGain=new v.a.Gain(2);for(var o=0;o<O;o++){var s=j[o],c=new v.a.Filter(s,"bandpass"),u=new v.a.Filter(s,"bandpass",-48),l=new v.a.Gain(0);c.Q.value=4,u.Q.value=4;var f=new v.a.Follower(.01),d=new v.a.Gain(8);c.chain(d,f,l.gain),r.effectNode.chain(l,u,r.outGain),r.components.push({filterIn:c,filterOut:u,follower:f})}return r.setupTrackParameter(),r.qParameter=new h.a("q",[].concat(Object(a.a)(r.components.map(function(e){return e.filterIn.Q})),Object(a.a)(r.components.map(function(e){return e.filterOut.Q}))),{defaultValue:30,min:.1,max:100}),r.registerParameter(r.qParameter),r.roughnessParameter=new h.a("roughness",r.components.map(function(e){return e.follower._filter.frequency}),{defaultValue:20,min:.1,max:100}),r.registerParameter(r.roughnessParameter),r.updateInitialValues(),r}return Object(o.a)(n,[{key:"dispose",value:function(){Object(s.a)(Object(l.a)(n.prototype),"dispose",this).call(this),this.components.forEach(function(e){var t=e.filterIn,n=e.filterOut,r=e.follower;t.dispose(),n.dispose(),r.dispose()}),this.outGain.dispose()}},{key:"connect",value:function(e){this.outGain.connect(e)}},{key:"disconnect",value:function(e){this.outGain.disconnect()}},{key:"onChangeTrack",value:function(e){-1!==e?(e=this.sequencerEngine.tracks[e],this._track&&this.disconnectFromTrack(this._track),this.connectToTrack(e),Object(s.a)(Object(l.a)(n.prototype),"onChangeTrack",this).call(this,e)):this._track=void 0}},{key:"disconnectFromTrack",value:function(e){var t,n=y(this.components);try{for(n.s();!(t=n.n()).done;){var r=t.value.filterIn;e.trackNode.disconnect(r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"connectToTrack",value:function(e){var t,n=y(this.components);try{for(n.s();!(t=n.n()).done;){var r=t.value.filterIn;e.trackNode.connect(r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"getJson",value:function(e){var t=Object(r.a)({},Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this,e),{q:this.qParameter.get(!0),roughness:this.roughnessParameter.get(!0),track:this.trackParameter.get(!0)});return t=this.saveParameterToJson(t,"qParameter",this.qParameter),t=this.saveParameterToJson(t,"roughnessParameter",this.roughnessParameter)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(d.a)(this.qParameter,e.q,a),Object(d.a)(this.roughnessParameter,e.roughness,a),Object(d.a)(this.trackParameter,e.track,a),Object(r.a)({},a,this.loadParameterFromJson(e,"qParameter",this.qParameter),this.loadParameterFromJson(e,"roughnessParameter",this.roughnessParameter))}},{key:"getEffectCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new n(e).fromJson(this.getJson(),t),!0}}]),n}(Object(m.a)(f.a.Effect))},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(115),f=n(116),h=n(6),d=n.n(h),p=n(113),v=n(577);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var y=function(e){Object(s.a)(n,e);var t=m(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Follower",function(){return new d.a.Gain(1)},e)).follower=new d.a.Follower,r.follower.connect(r.effectNode.gain),r.roughnessParameter=new p.c("roughness",r.follower._filter.frequency,{defaultValue:10,min:.1,max:100}),r.setupTrackParameter(),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"onChangeTrack",value:function(e){-1!==e?(e=this.sequencerEngine.tracks[e],this._track&&this._track.volumeNode.disconect(this.follower),e.volumeNode.connect(this.follower),Object(o.a)(Object(u.a)(n.prototype),"onChangeTrack",this).call(this,e)):this._track=void 0}},{key:"getJson",value:function(e){var t=Object(r.a)({},Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this,e),{roughness:this.roughnessParameter.get(!0),track:this.trackParameter.get(!0)});return t=this.saveParameterToJson(t,"roughnessParameter",this.roughnessParameter)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(f.a)(this.roughnessParameter,e.roughness,a),Object(f.a)(this.trackParameter,e.track,a),Object(r.a)({},a,this.loadParameterFromJson(e,"roughnessParameter",this.roughnessParameter))}},{key:"getEffectCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new n(e).fromJson(this.getJson(),t),!0}}]),n}(Object(v.a)(l.a.Effect))},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(31),s=n(10),c=n(7),u=n(8),l=n(2),f=n(115),h=n(914),d=n(116),p=n(6),v=n.n(p),m=n(113),y=n(14),b=n(192);function g(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var k=function(e){Object(c.a)(n,e);var t=j(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Frequency Shifter",function(){return new v.a.Gain(.5)},e)).nodeCounter=0,r._numBanks=4,r.outputNode=new v.a.Merge(1),r.wetIn=new v.a.Gain(.5),r.delaySpread=new v.a.Signal(0),r.effectNode.connect(r.wetIn),r.vInGains=[],r.delays=[[],[]],r.createGraph(),r.delaySpreadParameter=new m.c("delaySpread",r.delaySpread,{defaultValue:0,min:0,max:1,automationRate:"A_RATE"},.07),r.registerParameter(r.delaySpreadParameter),r.frequencyParameter=new b.a("frequency",[r.sineA.frequency,r.sineB.frequency],{defaultValue:30,min:1,max:1e4}),r.registerParameter(r.frequencyParameter),r.delayDirectionParameter=new y.a("delayDirection",Object(o.a)(r),function(e,t){return e.setDelayDirection(t)},{defaultValue:!0}),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"incr",value:function(){this.nodeCounter++}},{key:"createGraph",value:function(){this.sineA=new v.a.Oscillator(0,"sine"),this.incr(),this.sineA.phase=0,this.sineB=new v.a.Oscillator(0,"sine"),this.sineB.phase=90,this.incr(),this.sineA.start(0),this.sineB.start(0),this.createHilbertTransformer()}},{key:"ring",value:function(e,t,n){var r=new v.a.Compressor(-12,3);this.incr();var a=new v.a.Gain(.5);this.incr(),this.vInGains.push(a);var i=new v.a.Gain(-1);this.incr();var o=new v.a.Gain(-1);this.incr();var s=new v.a.Gain(-1);this.incr();var c=new v.a.Gain(-1);this.incr();var u=new h.a(this.sequencerEngine).effectNode;this.incr();var l=new h.a(this.sequencerEngine).effectNode;this.incr();var f=new h.a(this.sequencerEngine).effectNode;this.incr();var d=new h.a(this.sequencerEngine).effectNode;return this.incr(),e.connect(a),a.connect(i),i.connect(o),i.connect(l),o.connect(u),u.connect(s),l.connect(s),s.connect(r),a.connect(d),a.connect(c),c.connect(f),f.connect(r),d.connect(r),t.connect(c),t.connect(d),{output:r,dispose:function(){a.dispose(),r.dispose(),u.dispose(),l.dispose(),f.dispose(),d.dispose(),i.dispose(),o.dispose(),s.dispose(),c.dispose()}}}},{key:"createHilbertTransformer",value:function(){var e=this,t=new v.a.Split;this.incr(),this.wetIn.connect(t);var n=this.ring(this.sineA,t.left),r=this.ring(this.sineB,t.left),a=this.ring(this.sineA,t.right,!0),i=this.ring(this.sineB,t.right,!0),o=[n.dispose,r.dispose,a.dispose,i.dispose,function(){return t.dispose()}];n=n.output,r=r.output,a=a.output,i=i.output;for(var s=0;s<2;s++)for(var c=50,u=function(t){var u=e.numBanks/8*((t+1)/4),l=e.delayDirection?e.numBanks-t:t,f=l/1e3,h=new v.a.Filter(c,"bandpass",-24);e.incr(),h.Q.value=u;var d=new v.a.Filter(c,"allpass");e.incr(),d.Q.value=u,c+=1e4/e.numBanks;var p=new v.a.Delay(f);e.incr(),p.delayTime.input.automationRate="A_RATE";var m=new v.a.Gain(l/e.numBanks);e.incr(),e.delaySpread.chain(m,p.delayTime),p.delayTime.value=f,0===s?(h.chain(d,p,e.outputNode.left),n.connect(h),r.connect(h)):(h.chain(d,p,e.outputNode.right),a.connect(h),i.connect(h)),e.delays[s].push({delay:p,delayBlunter:m}),o.push(function(){h.dispose(),d.dispose(),p.dispose(),m.dispose()})},l=0;l<this.numBanks;l++)u(l);this.disposeList=o}},{key:"numBanks",get:function(){return this._numBanks},set:function(e){this._numBanks=e,this.disposeList&&(this.disposeList.forEach(function(e){e()}),this.disposeList=void 0),this.vInGains=[],this.delays=[[],[]],this.wetIn.disconnect(),this.nodeCounter=0,this.createHilbertTransformer()}},{key:"dispose",value:function(){Object(s.a)(Object(l.a)(n.prototype),"dispose",this).call(this),this.disposeList.forEach(function(e){return e()}),this.sineA.dispose(),this.sineB.dispose()}},{key:"randomizeDelays",value:function(){for(var e in this.delays){var t,n=g(this.delays[e]);try{for(n.s();!(t=n.n()).done;){t.value.delay.delayTime.value=Math.random()/2}}catch(r){n.e(r)}finally{n.f()}}}},{key:"clearRandom",value:function(){this.delayDirectionParameter.refresh()}},{key:"delayDirection",get:function(){return!this.delayDirectionParameter||this.delayDirectionParameter.get()}},{key:"setDelayDirection",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(var t in this.delays)for(var n in this.delays[t]){var r=e?this.numBanks-n:n,a=this.delays[t][n],i=a.delay,o=a.delayBlunter;i.delayTime.value=r/1e3,o.gain.value=r/this.numBanks}}},{key:"connect",value:function(e){this.connectedNode=e,this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{frequency:this.frequencyParameter.get(!0),delaySpread:this.delaySpreadParameter.get(!0),delayDirection:this.delayDirectionParameter.get(!0),numBanks:this.numBanks});return e=this.saveParameterToJson(e,"delaySpreadParameter",this.delaySpreadParameter),e=this.saveParameterToJson(e,"delayDirectionParameter",this.delayDirectionParameter),e=this.saveParameterToJson(e,"frequencyParameter",this.frequencyParameter)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(d.a)(this.frequencyParameter,e.frequency,a),Object(d.a)(this.delaySpreadParameter,e.delaySpread,a),Object(d.a)(this.delayDirectionParameter,e.delayDirection,a),e.numBanks&&e.numBanks!==this.numBanks&&(this.numBanks=e.numBanks),a=Object(r.a)({},a,this.loadParameterFromJson(e,"frequencyParameter",this.frequencyParameter,t),this.loadParameterFromJson(e,"delaySpreadParameter",this.delaySpreadParameter,t),this.loadParameterFromJson(e,"delayDirectionParameter",this.delayDirectionParameter,t))}}]),n}(f.a.Effect);t.a=k},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(115),f=n(116),h=n(6),d=n.n(h),p=n(113);n(577);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(s.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Transient Shaper",function(){return new d.a.Gain(1)},e)).effectNode.gain.value=1,r.follower1=new d.a.Follower,r.follower2=new d.a.Follower,r.filter=new d.a.Filter(100,"highpass"),r.effectNode.connect(r.filter),r.filter.connect(r.follower1),r.filter.connect(r.follower2),r.roughness1Parameter=new p.c("roughness1",r.follower1._filter.frequency,{defaultValue:63.8,min:.01,max:100,noInput:!0}),r.roughness2Parameter=new p.c("roughness2",r.follower2._filter.frequency,{defaultValue:2.4,min:.01,max:100,noInput:!0}),r.registerParameter(r.roughness1Parameter),r.registerParameter(r.roughness2Parameter),r.controlVoltage=new d.a.Subtract,r.follower1.connect(r.controlVoltage,0,0),r.follower2.connect(r.controlVoltage,0,1),r.input=r.effectNode,r.outputNode=new d.a.Gain(1),r.sustainNode=new d.a.Gain(1),r.effectNode.connect(r.sustainNode),r.sustainNode.connect(r.outputNode),r.controlVoltage.connect(r.sustainNode.gain),r.attackParameter=new p.c("attack",r.controlVoltage.output.gain,{defaultValue:1,min:-4,max:4,automationRate:"A_RATE"}),r.registerParameter(r.attackParameter),r.outputGainParameter=new p.c("outputGain",r.outputNode.gain,{defaultValue:1,min:0,max:2,automationRate:"A_RATE"}),r.registerParameter(r.outputGainParameter),r.sustainParameter=new p.c("sustain",r.sustainNode.gain,{defaultValue:0,min:0,max:.5,automationRate:"A_RATE"}),r.registerParameter(r.sustainParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e),this.connectedNode=e}},{key:"disconnect",value:function(e){this.outputNode.disconnect(),this.connectedNode=null}},{key:"getJson",value:function(e){var t=Object(r.a)({},Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this,e),{attack:this.attackParameter.get(!0),outputGain:this.outputGainParameter.get(!0),sustain:this.sustainParameter.get(!0)});return t=this.saveParameterToJson(t,"attackParameter",this.attackParameter),t=this.saveParameterToJson(t,"outputGainParameter",this.outputGainParameter),t=this.saveParameterToJson(t,"sustainParameter",this.sustainParameter)}},{key:"fromJson",value:function(e,t){var a=this,i=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return d.a.Master.context.isOffline?(Object(f.a)(this.attackParameter,e.attack,i),Object(f.a)(this.sustainParameter,e.sustain,i),Object(f.a)(this.outputGainParameter,e.outputGain,i)):setTimeout(function(){Object(f.a)(a.attackParameter,e.attack,i),Object(f.a)(a.sustainParameter,e.sustain,i),Object(f.a)(a.outputGainParameter,e.outputGain,i)},1e3),Object(r.a)({},i,this.loadParameterFromJson(e,"attackParameter",this.attackParameter,t),this.loadParameterFromJson(e,"sustainParameter",this.sustainParameter,t),this.loadParameterFromJson(e,"outputGainParameter",this.outputGainParameter,t))}},{key:"getEffectCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(l.a.Effect)},function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(4),o=n(5),s=n(10),c=n(7),u=n(8),l=n(2),f=n(424),h=n(23),d=(n(43),n(123),n(182));function p(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var y=function(e){Object(c.a)(n,e);var t=m(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,"Palettes",d.d,e)).palettes=[0,1],r}return Object(o.a)(n,[{key:"newPalette",value:function(){this.palettes=[].concat(Object(a.a)(this.palettes),[this.palettes.length])}},{key:"selectedPalette",get:function(){return this.track.sequencerEngine.state.effects.selectedPalettes[this.track.id]}},{key:"sequencedPalette",get:function(){return this.track.sequencerEngine.state.effects.sequencedPalettes[this.track.id]}},{key:"switchToPalette",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencedPalette,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={};e=null===e?void 0:e,r&&this.track.store.dispatch(Object(h.xd)(this.track.id,e)),this.track.store.dispatch(Object(h.Kd)(this.track.id,e));var i,o=p(this.track.getAllParameters().filter(function(n){return void 0===e&&void 0!==n.paletteToValue[t]||void 0===t&&void 0!==n.paletteToValue[e]||n.paletteToValue[e]!==n.paletteToValue[t]}));try{for(o.s();!(i=o.n()).done;){var s=i.value,c=s.set(s.getPaletteValue(e),!0,!0,n);c&&(a[c.id]=c.value)}}catch(u){o.e(u)}finally{o.f()}this.track.store.dispatch(Object(h.xb)(a))}},{key:"getJson",value:function(){return Object(r.a)({},Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{palettes:this.palettes})}},{key:"fromJson",value:function(e){Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e),this.palettes=e.palettes}},{key:"getCopy",value:function(){var e=new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.track);return e.fromJson(this.getJson()),e}}]),n}(f.a);t.a=y},function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(143),o=n(55);function s(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=new(n(124).a);t.a=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.track;if(void 0===t.frozenTracks)return[];var n,r=[],o=s(t.frozenTracks);try{for(o.s();!(n=o.n()).done;){var c=n.value.trackData;if(c){var l=c.type,f=c.samplers,h="white";l===i.f?h=Object.keys(f)[0]:l===i.b&&(h=c.presetName||"instrument");var d=u.getColorForHash(h);r.push(a.a.createElement("div",{style:{backgroundColor:d},className:"multi-freeze-part"}))}}}catch(p){o.e(p)}finally{o.f()}return a.a.createElement("div",{className:"multi-freeze-thumbnails"},r)})},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(143),a=n(168),i=n(3),o=n.n(i),s=n(158),c=n(937),u=new Set(["clap","tom","toms","clave","perc","snare","kick","hi-hat","rim","side-stick","breaks","sub","ride"]),l=function(e,t){if(!e||e.subSequence===e)return"";if(!e.getObjectType||e.getObjectType()!==a.c)return"";var n="";e&&e.tracks&&e.tracks[0]&&e.tracks[0].track&&(e=e.tracks[0].track);var i=t||e.sample;if(i&&i.tags&&((n=i.tags.find(function(e){return u.has(e)}))||(n=i.tags[0])),e&&e.getInstrumentType()==s.f&&(n="Synth"),e&&e.getTrackType()===r.e&&(n=o.a.createElement(c.a,{track:e})),e&&e.getInstrumentType()===s.h){var l=e.instrument.getSamples();l[0]&&l[0].tags&&(n=l[0].tags.find(function(e){return u.has(e)}))}return n}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r="SEQUENCER"},function(e,t,n){},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var r=n(42),a=n.n(r),i=n(56),o=n(285),s=n(171),c=n(80),u=n(199),l=n(141),f=n(23),h=n(316),d=n(6),p=n.n(d);function v(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var y=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,u,l,h,d,p,m,y;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getSelectedTrack(),r=n.presetName||n.getName(),t.store.dispatch(Object(f.gc)("Freezing instrument")),e.next=5,Object(c.a)(250);case 5:return e.next=7,Object(o.b)(t,n);case 7:return i=e.sent,e.next=10,b(t,i,r);case 10:s=e.sent,(u=t.addSampledInstrumentTrack()).resampledFrom=n.preset,l=0,h=[],d=v(s);try{for(d.s();!(p=d.n()).done;)m=p.value,t.recordingsToSave.push(m),h.push(u.instrument.newSample(3*l-12,m)),l++}catch(a){d.e(a)}finally{d.f()}return e.next=19,Promise.all(h);case 19:y=n.instrument?n.instrument.ampEnvelope.release:2e3,u.instrument.releaseParameter.set(y),t.store.dispatch(Object(f.gc)(void 0)),n.preset;case 23:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var o,c,f,d,v;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for([],o=0,c=new u.a(2,function(e,t,n){return[]}),t.state.freeze.loops,64,f=[],24,d=function(e){var u=o,d=u+64*p.a.Master.context.sampleRate*new p.a.Time("32n").toMilliseconds()/1e3,v=Object(h.a)(n,u,d,p.a.Master.context);o=d,f.push(new Promise(function(){var n=Object(i.a)(a.a.mark(function n(i){var o,u;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c.uploadBufferToIpfs(v);case 2:o=n.sent,(u=new l.a(o)).audioBuffer=v,u.tempo=t.tempo,u.name=r+": "+s.a.fromTranspose(-12+e).toString(),u.tags=["Resampled",r],i(u);case 9:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()))},v=0;v<24;v++)d(v);return e.next=11,Promise.all(f);case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()},function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return p}),n.d(t,"a",function(){return v});var r=n(42),a=n.n(r),i=n(56),o=n(153),s=(n(142),n(80),n(829),n(119),n(815)),c=n(149),u=n(162),l=n(157),f=n(122);new s.a;var h=u.a.utils.padLeft("0x0",64),d=function(e){return e?Object(o.b)(e):h},p=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,f,h,p,v,m,y;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.projectHash,r=t.bpm,i=t.title,s=t.hasArrangement,f=t.thumbnail,h=t.presetsList,p=t.patterns,v=t.previousHash,m=t.samples,console.log(t),console.log("generated project metata=",f,n,r,s,h,p),y=u.a.utils.padLeft("0x0",64),f=f?Object(o.b)(f):y,h=h.map(function(e){return Object(o.b)(e)}),new l.a(c.n,"newProjectMetadata",[d(n),d(v),i,r,f,h,m.map(d),p,s]).execute();case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),v=function(){var t=Object(i.a)(a.a.mark(function t(n,r){var i,o,s,c,u,l,h,d;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.subSequences.flatMap(function(e){return e.tracks.filter(function(e){return e.preset&&e.preset.contentHash}).map(function(e){return e.preset.contentHash})}),o=n.tracks[0]?n.tracks[0].patterns.length:0,s=n.subSequences[0].mix&&n.subSequences[0].mix.length>0,c=n.bpm,u=void 0,!(l=n.subSequences[0].findNodeByName("three.canvas").find(function(e){return!e.isUI&&(!e.subSequence.zObject||!e.subSequence.zObject.isUI)}))||!l.effect.renderer){t.next=13;break}return console.log("generating thumbnail with canvas=",l),h=l.effect.renderer.domElement.toDataURL().slice(22),d=e.from(h,"base64"),t.next=12,f.a.addBuffer(d);case 12:u=t.sent;case 13:return t.abrupt("return",{bpm:c,thumbnail:u,projectHash:r,hasArrangement:s,patterns:o,presetsList:i});case 14:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()}).call(this,n(110).Buffer)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});n(1);var r=n(42),a=n.n(r),i=n(56),o=(n(157),n(142)),s=(n(23),n(310)),c=n(119),u=(n(605),n(153),n(149),n(816)),l=(n(521),function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,l,f;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("loaded minted project =",n,r),n=parseInt(n),r=parseInt(r),e.next=5,new o.a((new u.a).contractAddress).from(c.i).select("contentHash").where("projectId",n).executeQuery();case 5:return i=e.sent,e.next=8,new o.a((new u.a).contractAddress).from(c.I).select("seedHash").where("tokenId",r).where("projectId",n).executeQuery();case 8:if(0!==(l=e.sent).length&&0!==i.length){e.next=11;break}return e.abrupt("return");case 11:for(l=l[0],i=i[0],t.tokenId=r,t.projectId=n,t.seedHash=l.seedHash,t.loadSequence(i.contentHash),Object(s.a)(l.seedHash),f=0;f<100;f++)console.log(Object(s.b)());console.log("found the project+token pair",i,l);case 20:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}())},,,function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(42),a=n.n(r),i=n(56),o=n(159),s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4?arguments[4]:void 0;return new Promise(function(){var c=Object(i.a)(a.a.mark(function i(c,u){var l,f;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!window.isNFT){a.next=3;break}return c([]),a.abrupt("return");case 3:return a.next=5,o.a.getAccount();case 5:l=a.sent,f={andTags:e,guildIds:t,isFavorited:n,user:l,byDate:r},s&&(f.startYear=s.start,f.endYear=s.end),fetch("/samplesStream/",{method:"POST",body:JSON.stringify(f),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){c(e.ids)});case 9:case"end":return a.stop()}},i)}));return function(e,t){return c.apply(this,arguments)}}())}},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return a});var r=n(189);function a(e){var t=r.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}}).call(this,n(110).Buffer)},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(368);function u(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=f(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"loadLostParameters",value:function(e){var t,n=u(this.midiEffects.effects);try{for(n.s();!(t=n.n()).done;){var r=t.value;(r.effects||[r]).filter(function(e){return e.lostParameters&&e.lostParameters.length>0}).forEach(function(e){e.lostParameters=e.loadParameters(e.lostParameters)})}}catch(a){n.e(a)}finally{n.f()}(this.tracks&&this.tracks.forEach(function(t){return e?t.loadLostParameters():t.track?t.track.loadLostParameters():0}),e)&&Object(c.a)(this).filter(function(e){return e.effect&&e.effect.lostParameters&&e.effect.lostParameters.length>0}).forEach(function(e){var t=e.effect.loadParameters(e.effect.lostParameters);e.effect.lostParameters=t.lostParameters||t})}}]),n}(e)}},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),o=(n(578),n(985)),s=n(123),c=function(){function e(t){Object(a.a)(this,e),this.track=t,this.effects=[]}return Object(i.a)(e,[{key:"addEffect",value:function(e){this.effects=[].concat(Object(r.a)(this.effects),[e]),this.linkEffectParameters()}},{key:"clear",value:function(){}},{key:"clearEffects",value:function(){this.effects.forEach(function(e){return e.dispose()}),this.effects=[]}},{key:"linkEffectParameters",value:function(){var e=this;this.effects.forEach(function(t){t.registerContext((new s.a).forTrack(e.track)),t.registerMixSession(e.track.mixSession),t.registerTrack(e.track)})}},{key:"deleteEffect",value:function(e){var t=this.effects.indexOf(e);this.effects.splice(t,1)}},{key:"getAllParameters",value:function(){var e=[];for(var t in this.effects)e=[].concat(Object(r.a)(e),Object(r.a)(this.effects[t].getParameters()));return e}},{key:"getEffect",value:function(e){var t=this.effects.filter(function(t){return t.effect==e&&t.isEnabled()});return t.length>0?t[0]:void 0}},{key:"getJson",value:function(){return this.effects.map(function(e){return e.getJson()})}},{key:"fromJson",value:function(e){for(var t in e)this.addEffect(Object(o.a)(e[t],this.track)),this.effects[this.effects.length-1].fromJson(e[t])}},{key:"getCopy",value:function(t,n){var r=new e(t);return console.log("live effects =",this.effects),r.effects=this.effects.map(function(e){return e.getCopy(t,n)}),r.linkEffectParameters(),r}}]),e}();t.a=c},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=c(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"updatePatternRollStepNumber",value:function(e){if(void 0!==this.patternRollStepNumber){var t=e.getNumberOfStepsAtBaseResolution();this.patternRollStepNumber-=this.patternRollStepNumber%t}}},{key:"initPatternBuffer",value:function(e){if(this.pattern){var t=this.pattern.stepBuckets.length;this.patternRollStepNumber=e%t,this.patternRollStepNumber%2===1&&this.patternRollStepNumber++}else this.patternRollStepNumber=e}}]),n}(e)}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=(n(585),n(6)),o=n.n(i),s=n(171),c=n(369),u=n(23),l=n(199),f=n(141);function h(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p=function(){function e(t,n){var a=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(r.a)(this,e),this.sequencerEngine=t,this.input=n,this.soundUploader=new l.a(2,function(e,t,n){return a.onSoundUploaded(t)}),this.isMaster=i,this.resampleCount=0}return Object(a.a)(e,[{key:"getRecorder",value:function(){return new window.Recorder(this.input,{numChannels:2,bufferLen:1024})}},{key:"start",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.track=t,this.freeze=n,this.sequencerEngine.store.dispatch(Object(u.Tb)(void 0===t||t.trackNumber)),this.resamplingDurationElapsed=0,this.recorder.record(e)}},{key:"stop",value:function(e){var t=this,n=Object(c.a)(e)+400;this.autoResampleMode||(e+=.2),this.recorder.stop(e),setTimeout(function(){t.recorder.getBuffer(function(e){return t.saveBuffer(e)}),t.sequencerEngine.store.dispatch(Object(u.Tb)(void 0))},n+500)}},{key:"saveBuffer",value:function(e){if(0===e[0].length)return console.log("frame count for blob is 0 so redoing the damn shit!"),void this.redoResample();this.audioBuffer=this.getAudioBuffer(e),this.soundUploader.uploadBufferToIpfs(e,!0,0)}},{key:"getAudioBuffer",value:function(e){var t=e[0].length,n=o.a.Master.context.createBuffer(2,t,o.a.Master.context.sampleRate);return n.copyToChannel(e[0],0,0),n.copyToChannel(e[1],1,0),n}},{key:"autoResampleTrack",get:function(){return this.sequencerEngine.tracks[0]}},{key:"autoResampleTrackNote",get:function(){return this.autoResampleTrack.pattern.stepBuckets[0].steps[0].transpose}},{key:"incrementNotes",value:function(e){var t,n=h(this.autoResampleTrack.pattern.stepBuckets);try{for(n.s();!(t=n.n()).done;){var r=t.value;for(var a in r.steps)r.steps[a].getPolyphony().forEach(function(t){return t.transpose+=e})}}catch(i){n.e(i)}finally{n.f()}}},{key:"autoResampleMode",get:function(){return this.sequencerEngine.autoResampleMode}},{key:"samplesPerNote",get:function(){return this.sequencerEngine.resampleConfig.samplesPerNote}},{key:"onSoundUploaded",value:function(e){var t=new f.a(e);if(t.audioBuffer=this.audioBuffer,t.name="Resampled Recording",t.tags=["Resampled"],this.autoResampleMode){t.name=s.a.fromTranspose(this.autoResampleTrackNote).toString();var n=this.autoResampleTrack;n.midiOutputs&&t.tags.push(Array.from(n.midiOutputs)[0].name)}if(t.isResampled=!0,t.samplesUsed=[],this.isMaster){var r=this.sequencerEngine.tracks.filter(function(e){return!e.muted&&e.sample}).map(function(e){return e.sample});t.samplesUsed=r.map(function(e){return e.getId()})}void 0===t.samplesUsed&&(t.samplesUsed=[]),this.freeze?this.track.freeze(t):(void 0===this.sampledInstrument&&(this.sampledInstrument=this.sequencerEngine.addSampledInstrumentTrack(),this.autoResampleMode&&this.matchLengths(this.sampledInstrument)),this.sampledInstrument.instrument.newSample(void 0,t),this.sequencerEngine.recordingsToSave.push(t)),this.autoResampleMode&&(console.log("AUTO RESAMPLE MMODEE PREPARE"),this.prepare(),this.resampleCount%this.samplesPerNote===0&&this.incrementNotes(2),this.resampleCount++,this.sequencerEngine.store.dispatch(Object(u.fd)(!0)))}},{key:"prepare",value:function(){void 0===this.recorder?this.recorder=this.getRecorder():this.recorder.clear()}},{key:"matchLengths",value:function(e){for(;e.length>this.autoResampleTrack.length;)e.halfTrackLength()}},{key:"dispatch",value:function(e){this.sequencerEngine.store.dispatch(e)}},{key:"redoResample",value:function(){this.isMaster?this.dispatch(Object(u.fd)(!0)):this.dispatch(Object(u.He)(this.track.subSequence.id,this.track.trackNumber))}}]),e}();t.a=p},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return c});var r=n(6),a=new(n.n(r).a.Time)("32n");function i(e,t,n){var r=e[0],a=e.map(function(e){return c(e-r,t,n)}),i=s(a,32),u=o(a,32,i),l=s(u,16),f=s(u=o(u,16,l),8),h=s(u=o(u,8,f),4),d=s(u=o(u,4,h),2),p=s(u=o(u,2,d),1);return u=o(u,1,p),console.log("timing 1 = "),console.log(p),{steps:u,unquantizedSteps:a,timings:[p,d,h,f,l,i].filter(function(e){return!(0===(t=e).even&&0===t.odd);var t})}}function o(e,t,n){var r=32/t;return e.map(function(e){return{stepNumber:e.stepNumber,offset:Math.max(0,Math.floor(e.stepNumber/r)%2===0?e.offset-n.even:e.offset-n.odd)}})}function s(e,t){var n=32/t,r=void 0,a=void 0;for(var i in e){var o=e[i],s=o.stepNumber,c=o.offset;Math.floor(s/n)%2===0?(1===t&&console.log("even for 1 offset = "+c),(void 0===a||a>c)&&(a=c)):(1===t&&console.log("odd for 1 offset = "+c),(void 0===r||r>c)&&(r=c))}return{resolution:t,even:a||0,odd:r||0}}function c(e,t,n){var r=e*t/n/a.toMilliseconds(),i=r-Math.floor(r);return{stepNumber:Math.floor(r),offset:i}}},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(7),s=n(8),c=n(2),u=n(6),l=n.n(u),f=(n(369),n(23)),h=n(130);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(o.a)(n,e);var t=d(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).currentStepDatas=[],e}return Object(i.a)(n,[{key:"releaseAll",value:function(e){this.getSamplers().filter(function(e){return e&&e.isLoaded()}).map(function(t){return t.releaseAll(e)}),this.instrument&&this.instrument.releaseAll(e)}},{key:"liveTriggerRelease",value:function(e,t){this.gated&&(this.triggerRelease(e,t),this.chokes.liveRelease())}},{key:"resetAnyPLockedParameters",value:function(e,t){if(this.previousPLocks&&this.previousPLocks.length>0){var n=Array.from(new Set(this.previousPLocks)).filter(function(e){return e.savedUnlockedValue}).filter(function(t){return!e||!e.pLockedParameters.includes(t)}).map(function(e){if(void 0===e.savedUnlockedValue)return{id:-1,value:-1};var n=e.set(e.savedUnlockedValue,!0,!0,t);return e.savedUnlockedValue=void 0,n}).reduce(function(e,t){var n=t.id,a=t.value;return Object(r.a)({},e,function(e,t){var n={};return n[e]=t,n}(n,a))},{});this.store.dispatch(Object(f.xb)(n))}}},{key:"handlePLockedAutomations",value:function(e,t){var n=this;if(!this.isMetronome){var r=this.store.getState().keyboard.selectedPianoRollSteps;r&&r.some(function(e){return e.track===n})||(this.resetAnyPLockedParameters(e,t),this.previousPLocks=e.triggerAutomations(t,this))}}},{key:"storeStepData",value:function(e,t){var n=this;if(!this.isMetronome){e.time=t;var r=t-l.a.Master.context.currentTime;setTimeout(function(){n.sendMessage(h.p,e)},1e3*r),this.lastPlayedStepData=e,void 0===e.stepNumber||this.currentStepDatas[0]&&this.currentStepDatas[0].stepNumber===e.stepNumber||(this.currentStepDatas=[]),void 0===e.stepNumber&&(e=e.getCopy(!0,!1,!0,!1,!1)),this.currentStepDatas.push(e)}}},{key:"trigger",value:function(e,t){var n=this;t=t||l.a.Master.context.currentTime,this.storeStepData(e,t),this.getSamplers().filter(function(e){return e&&e.isLoaded()}).filter(function(e){return e&&e.isChosen}).map(function(r){r.trigger({gated:!!n.isWarped()||!n.isFrozen&&!n.isAudioTrack&&n.gated,stepData:e,time:t,sliceNumber:e.slice})})}},{key:"triggerSamples",value:function(e,t,n){var r=this;this.soundIds.filter(function(e){return r.isRecordingPlaying(e)}).map(function(e){return r.samplers[e]}).filter(function(e){return e&&e.isLoaded()}).map(function(n){return n.trigger({gated:!1,stepData:e,time:t})})}},{key:"triggerSlice",value:function(e){var t=this.trackData.transpose;this.triggerSample(e,t)}},{key:"triggerSample",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0;this.getSamplers().filter(function(e){return e&&e.isLoaded()}).forEach(function(u){return u.trigger({gated:!!n.isWarped()||n.gated,sliceNumber:e,stepData:c||n.trackData,start:s,noDuration:o,velocity:a,transpose:t,skipRelease:r,time:i})})}},{key:"triggerRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.getSamplers().filter(function(e){return e&&e.isLoaded()}).forEach(function(n){n.release(t,e)}),this.currentStepDatas&&(this.currentStepDatas=this.currentStepDatas.filter(function(t){return t.transpose!==e}))}},{key:"triggerMidiNoteOn",value:function(e,t){this.triggerSample(0,!1,this.resolution.getTimeInStep(),e+this.trackData.transpose,!0)}},{key:"triggerMidiNoteOff",value:function(e){}},{key:"liveTrigger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.trackData,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this.triggerSample(t,e.transpose,!0,e.velocity,n,void 0===e.duration,e.start,e.track&&e),e.track=this,this.sendMessage(h.p,e),this.storeStepData(e,n),this.chokes.liveTrigger()}}]),n}(e)}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(381);function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=u(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"addRackEffect",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=this.effectRack;a||(a=new c.a(this),this.midiEffects.addEffect(a));var i=a.adjacencyLists;if(a.addEffect(e),n){var o=i[n.id]&&i[n.id].filter(function(e){return e.outputNumber===r})||[],s=o.map(function(e){return e.effect});o.forEach(function(e){return a.deleteEdge(e)}),s.forEach(function(t){return a.connectNodes(e,t)}),a.connectNodes(n,e,r)}else if(t){if(a.effects.length>1){var u,l=void 0,f=function(e){var t=i[e].find(function(e){return e.effect===a.outputNode});if(t)return l=a.effects.find(function(t){return t.id===e}),u=t,"break"};for(var h in i){if("break"===f(h))break}a.deleteEdge(u),a.connectNodes(l,e)}else a.connectNodes(void 0,e);a.connectNodes(e)}else{var d=a.adjacencyLists[-1];if(a.effects.length>1&&d.length>0){var p=d[0].effect;a.deleteEdge(d[0]),a.connectNodes(e,p)}else a.connectNodes(e);a.connectNodes(void 0,e)}}}]),n}(e)}},,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"param",gen:function(){r.requestMemory(this.memory),r.params.add(this);var e="worklet"===r.mode;return e&&r.parameters.add(this.name),this.value=this.initialValue,r.memo[this.name]=e?this.name:"memory[".concat(this.memory.value.idx,"]"),r.memo[this.name]}};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=Object.create(a);return"string"!==typeof e?(o.name=o.basename+r.getUID(),o.initialValue=e,o.min=t,o.max=n):(o.name=e,o.min=n,o.max=i,o.initialValue=t),o.defaultValue=o.initialValue,o.waapi=null,o.isWorklet="worklet"===r.mode,Object.defineProperty(o,"value",{get:function(){return null!==this.memory.value.idx?r.memory.heap[this.memory.value.idx]:this.initialValue},set:function(t){null!==this.memory.value.idx&&(this.isWorklet&&null!==this.waapi?this.waapi[e].value=t:r.memory.heap[this.memory.value.idx]=t)}}),o.memory={value:{length:1,idx:null}},o}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"counter",gen:function(){var e,t=r.getInputs(this),n="gen."+this.name;return null===this.memory.value.idx&&r.requestMemory(this.memory),r.memory.heap[this.memory.value.idx]=this.initialValue,e=this.callback(n,t[0],t[1],t[2],t[3],t[4],"memory[".concat(this.memory.value.idx,"]"),"memory[".concat(this.memory.wrap.idx,"]")),r.memo[this.name]=this.name+"_value",void 0===r.memo[this.wrap.name]&&this.wrap.gen(),[this.name+"_value",e]},callback:function(e,t,n,r,a,i,o,s){var c=this.max-this.min,u="",l="";return"number"===typeof this.inputs[3]&&this.inputs[3]<1||(u+="  if( ".concat(a," >= 1 ) ").concat(o," = ").concat(n,"\n")),u+="  var ".concat(this.name,"_value = ").concat(o,";\n  ").concat(o," += ").concat(t,"\n"),"number"===typeof this.max&&this.max!==1/0&&"number"!==typeof this.min?l="  if( ".concat(o," >= ").concat(this.max," &&  ").concat(i," > 0) {\n    ").concat(o," -= ").concat(c,"\n    ").concat(s," = 1\n  }else{\n    ").concat(s," = 0\n  }\n"):this.max!==1/0&&this.min!==1/0?l="  if( ".concat(o," >= ").concat(r," &&  ").concat(i," > 0) {\n    ").concat(o," -= ").concat(r," - ").concat(n,"\n    ").concat(s," = 1\n  }else if( ").concat(o," < ").concat(n," &&  ").concat(i," > 0) {\n    ").concat(o," += ").concat(r," - ").concat(n,"\n    ").concat(s," = 1\n  }else{\n    ").concat(s," = 0\n  }\n"):u+="\n",u+=l}};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5?arguments[5]:void 0,c=Object.create(a),u=Object.assign({initialValue:0,shouldWrap:!0},s);return Object.assign(c,{min:t,max:n,initialValue:u.initialValue,value:u.initialValue,uid:r.getUID(),inputs:[e,t,n,i,o],memory:{value:{length:1,idx:null},wrap:{length:1,idx:null}},wrap:{gen:function(){return null===c.memory.wrap.idx&&r.requestMemory(c.memory),r.getInputs(this),r.memo[this.name]="memory[ ".concat(c.memory.wrap.idx," ]"),"memory[ ".concat(c.memory.wrap.idx," ]")}}},u),Object.defineProperty(c,"value",{get:function(){if(null!==this.memory.value.idx)return r.memory.heap[this.memory.value.idx]},set:function(e){null!==this.memory.value.idx&&(r.memory.heap[this.memory.value.idx]=e)}}),c.wrap.inputs=[c],c.name="".concat(c.basename).concat(c.uid),c.wrap.name=c.name+"_wrap",c}},function(e,t,n){"use strict";n.r(t);var r=n(112),a=n(254),i=n(203);t.default=function(e){var t=a();t.in(e);var n=i(e,t.out);return n.name="delta"+r.getUID(),n}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={name:"not",gen:function(){var e=r.getInputs(this);return isNaN(this.inputs[0])?"( ".concat(e[0]," === 0 ? 1 : 0 )"):0===!e[0]?1:0}};t.default=function(e){var t=Object.create(a);return t.inputs=[e],t}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"gt",gen:function(){var e,t=r.getInputs(this);return e="  var ".concat(this.name," = "),isNaN(this.inputs[0])||isNaN(this.inputs[1])?e+="(( ".concat(t[0]," > ").concat(t[1],") | 0 )"):e+=t[0]>t[1]?1:0,e+="\n\n",r.memo[this.name]=this.name,[this.name,e]}};t.default=function(e,t){var n=Object.create(a);return n.inputs=[e,t],n.name=n.basename+r.getUID(),n}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={name:"gte",gen:function(){var e,t=r.getInputs(this);return e="  var ".concat(this.name," = "),isNaN(this.inputs[0])||isNaN(this.inputs[1])?e+="( ".concat(t[0]," >= ").concat(t[1]," | 0 )"):e+=t[0]>=t[1]?1:0,e+="\n\n",r.memo[this.name]=this.name,[this.name,e]}};t.default=function(e,t){var n=Object.create(a);return n.inputs=[e,t],n.name="gte"+r.getUID(),n}},function(e,t,n){"use strict";n.r(t);var r=n(112),a={basename:"switch",gen:function(){var e,t=r.getInputs(this);return t[1]===t[2]?t[1]:(e="  var ".concat(this.name,"_out = ").concat(t[0]," === 1 ? ").concat(t[1]," : ").concat(t[2],"\n"),r.memo[this.name]="".concat(this.name,"_out"),["".concat(this.name,"_out"),e])}};t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Object.create(a);return Object.assign(i,{uid:r.getUID(),inputs:[e,t,n]}),i.name="".concat(i.basename).concat(i.uid),i}},function(e,t,n){"use strict";n.r(t);var r=n(32),a=n(112).default,i={basename:"t60",gen:function(){var e,t,n=a.getInputs(this),i="worklet"===a.mode,o=i?"":"gen.";return isNaN(n[0])?(a.closures.add(Object(r.a)({},"exp",i?"Math.exp":Math.exp)),e="  var ".concat(this.name," = ").concat(o,"exp( -6.907755278921 / ").concat(n[0]," )\n\n"),a.memo[this.name]=e,t=[this.name,e]):t=e=Math.exp(-6.907755278921/n[0]),t}};t.default=function(e){var t=Object.create(i);return t.inputs=[e],t.name=i.basename+a.getUID(),t}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={name:"gtp",gen:function(){var e=r.getInputs(this);return isNaN(this.inputs[0])||isNaN(this.inputs[1])?"(".concat(e[0]," * ( ( ").concat(e[0]," > ").concat(e[1]," ) | 0 ) )"):e[0]*(e[0]>e[1]|0)}};t.default=function(e,t){var n=Object.create(a);return n.inputs=[e,t],n}},function(e,t,n){"use strict";n.r(t),t.default={bartlett:function(e,t){return 2/(e-1)*((e-1)/2-Math.abs(t-(e-1)/2))},bartlettHann:function(e,t){return.62-.48*Math.abs(t/(e-1)-.5)-.38*Math.cos(2*Math.PI*t/(e-1))},blackman:function(e,t,n){var r=n/2;return(1-n)/2-.5*Math.cos(2*Math.PI*t/(e-1))+r*Math.cos(4*Math.PI*t/(e-1))},cosine:function(e,t){return Math.cos(Math.PI*t/(e-1)-Math.PI/2)},gauss:function(e,t,n){return Math.pow(Math.E,-.5*Math.pow((t-(e-1)/2)/(n*(e-1)/2),2))},hamming:function(e,t){return.54-.46*Math.cos(2*Math.PI*t/(e-1))},hann:function(e,t){return.5*(1-Math.cos(2*Math.PI*t/(e-1)))},lanczos:function(e,t){var n=2*t/(e-1)-1;return Math.sin(Math.PI*n)/(Math.PI*n)},rectangular:function(e,t){return 1},triangular:function(e,t){return 2/e*(e/2-Math.abs(t-(e-1)/2))},welch:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=0===r?t:(t+Math.floor(r*e))%e,i=(e-1)/2;return 1-Math.pow((a-i)/i,2)},inversewelch:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=0===r?t:(t+Math.floor(r*e))%e,i=(e-1)/2;return Math.pow((a-i)/i,2)},parabola:function(e,t){return t<=e/2?this.inversewelch(e/2,t)-1:1-this.inversewelch(e/2,t-e/2)},exponential:function(e,t,n){return Math.pow(t/e,n)},linear:function(e,t){return t/e}}},function(e,t,n){},,,function(e,t,n){"use strict";var r=n(620),a=n(4),i=n(5),o=n(7),s=n(8),c=n(2),u=n(169),l=(n(377),n(440)),f=n(36);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var d=function(e){Object(o.a)(n,e);var t=h(n);function n(e,r,i){var o;return Object(a.a)(this,n),(o=t.call(this,e,r.getType())).event=r,o.duration=i,o}return Object(i.a)(n,[{key:"addEvent",value:function(e,t,n){new l.a(this.mix,e,t,n).execute()}},{key:"execute",value:function(){for(var e in this.events){var t=this.events[e];if(!t.isPrunable()){if(this.event.step===t.step||this.event.step===t.step+t.duration)return;if(this.event.step>t.step&&this.event.step<t.step+t.duration){var n=this.event.initialSubEvent;return n.step=this.event.step,void t.addSubEvent(n)}}}this.addEvent(this.event,0,this.event.step);var r=new f.a(!1,this.event.initialSubEvent.resolution);r.step=this.event.step+this.duration,this.addEvent(r,0,r.step)}}]),n}(u.a),p=n(257),v=n(441),m=n(442);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var b=function(e){Object(o.a)(n,e);var t=y(n);function n(e,r,i){var o;return Object(a.a)(this,n),(o=t.call(this,e,r.getType())).event=r,o.resolution=i,o}return Object(i.a)(n,[{key:"execute",value:function(){void 0!==this.resolution&&(this.event.resolution=this.resolution)}}]),n}(u.a);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var O=function(e){Object(o.a)(n,e);var t=g(n);function n(e,r,i){var o;return Object(a.a)(this,n),(o=t.call(this,e,r.getType())).event=r,o.patternNumber=i,o}return Object(i.a)(n,[{key:"execute",value:function(){this.event.patternNumber=this.patternNumber}}]),n}(u.a);function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var k=function(e){Object(o.a)(n,e);var t=j(n);function n(e,r,i){var o;return Object(a.a)(this,n),(o=t.call(this,e,r.getType())).event=r,o.xTransform=i-o.event.step,o}return Object(i.a)(n,[{key:"execute",value:function(){var e=this,t=this.mixByType.getNextEvent(this.event);if(void 0!==t){var n=this.mixByType.getNextEvent(t);(void 0===n||t.step+this.xTransform<=n.step)&&(this.event.step+=this.xTransform,t.step+=this.xTransform,this.event.initialSubEvent.step+=this.xTransform,this.event.subEvents.forEach(function(t){return t.step+=e.xTransform}),t.initialSubEvent.step+=this.xTransform,t.subEvents.forEach(function(t){return t.step+=e.xTransform}))}}}]),n}(u.a),w=n(42),x=n.n(w),S=n(11),P=n(56);function E(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var A=function(e){if(!e.tracks)return[];var t=[];return e.tracks.forEach(function(e){t=[].concat(Object(S.a)(t),Object(S.a)(e.getAllParameters().filter(function(e){return e.mixAutomation.automations.length>0})))}),t},M=n(9),R=n(23),C=function(){function e(t,n,r){Object(a.a)(this,e),this.track=t,this.pattern=n,this.step=r}return Object(i.a)(e,[{key:"execute",value:function(){var e=this.pattern.split(this.step);this.track.patterns.push(e),this.track.updateSteps(!0);var t={};t[M.a]=e,this.track.sequencerEngine.store.dispatch(Object(R.qd)(t))}}]),e}();function N(e,t,n){I(e.patterns.find(function(e){return e.overlapsStep(t)&&e.startStep<t}),t),I(e.patterns.find(function(e){return e.overlapsStep(n)&&e.startStep<n}),n);var r=e.patterns.filter(function(e){var r=e.startStep,a=e.startStep+e.length();return!(r>=t&&r<n||a>t&&a<=n)});e.patterns=r,e.updateSteps(!0)}function I(e,t){void 0!==e&&new C(e.track,e,t).execute()}function q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var _=function(e){Object(o.a)(n,e);var t=q(n);function n(e,r){var i;return Object(a.a)(this,n),(i=t.call(this,e,void 0)).selection=r,i.start=i.selection.start,i.end=i.selection.end,i}return Object(i.a)(n,[{key:"execute",value:function(){if(void 0!==this.mix.subSequence){for(var e in this.mix.mixesByType){var t=this.mix.mixesByType[e];this.deleteByType(parseInt(e),t)}for(var n in this.mix.deterministicMixesByType){var r=this.mix.deterministicMixesByType[n];this.deleteByType(parseInt(n),r)}var a,i,o;this.mix.subSequence.isTrack&&this.executeForTrack(this.mix.subSequence.tracks[0]),a=this.mix.subSequence,i=this.start,o=this.end,A(a).forEach(function(e){var t=e.mixAutomation.automations.filter(function(e){return e.step<i||e.step>o});for(var n in t){var r=t[n];r.step>o&&(r.step-=o-i,t[n]=r.getCopy())}e.mixAutomation.automations=t,e.mixAutomation.schedule(),e.mixAutomation.clearCache(),e.mixAutomation.updateRedux(!0)})}else{var s=this.mix.deterministicMixesByType[M.k];this.deleteByType(M.k,s)}}},{key:"deleteByType",value:function(e,t,n){var r=t.getEventsBetween(this.start,this.end,!0).filter(function(e){return!e.isPrunable()});for(var a in r){var i=r[a];if(void 0!==i.initialSubEvent){var o=Object(S.a)(i.subEvents);for(var s in o)new m.a(this.mix,i,o[s]).execute();new m.a(this.mix,i,i.initialSubEvent).execute()}else new v.a(this.mix,i,!0).execute()}if("LINEAR"===t.getMixType()){var c=Object(M.r)(e);if(void 0!==c){var u=t.getValueAtStep(this.start),l=Object(M.r)(e);c.step=this.start,l.step=this.end-1,c.setValue(u),l.setValue(u),c.subSequence=this.mix.subSequence,l.subSequence=this.mix.subSequence,new p.a(this.mix,c,1).execute(),new p.a(this.mix,l,1).execute()}}}},{key:"executeForTrack",value:function(e){N(e,this.start,this.end)}}]),n}(u.a);function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var F=function(e){Object(o.a)(n,e);var t=D(n);function n(e,r,i,o){var s;return Object(a.a)(this,n),(s=t.call(this,e,void 0)).step=r,s.selection=i,s.start=s.selection.start,s.end=s.selection.end,s.mixType=o,s}return Object(i.a)(n,[{key:"execute",value:function(){if(this.mix.subSequence.id===M.g.id&&(this.mixType=M.k),void 0===this.mixType){for(var e in this.mix.mixesByType){var t=this.mix.mixesByType[e];this.executeByType(parseInt(e),t)}for(var n in this.mix.deterministicMixesByType){var r=this.mix.deterministicMixesByType[n];this.executeByType(parseInt(n),r)}this.mix.subSequence.isTrack&&this.executeForTrack(this.mix.subSequence.tracks[0])}else this.mix.mixesByType[this.mixType]?this.executeByType(this.mixType,this.mix.mixesByType[this.mixType]):this.mix.deterministicMixesByType[this.mixType]&&this.executeByType(this.mixType,this.mix.deterministicMixesByType[this.mixType])}},{key:"executeByType",value:function(e,t,n){}},{key:"executeForTrack",value:function(){}},{key:"splitIntersectingPatterns",value:function(e){var t=this,n=e.patterns.find(function(e){return e.overlapsStep(t.start)&&e.startStep<t.start});this.splitPattern(n,this.start);var r=e.patterns.find(function(e){return e.overlapsStep(t.end)&&e.startStep<t.end});this.splitPattern(r,this.end)}},{key:"splitPattern",value:function(e,t){void 0!==e&&new C(e.track,e,t).execute()}}]),n}(u.a);function L(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var B=function(e){Object(o.a)(n,e);var t=L(n);function n(e,r,i,o,s){var c;return Object(a.a)(this,n),(c=t.call(this,e,r,i,o)).track=s,c}return Object(i.a)(n,[{key:"executeByType",value:function(e,t,n){var r=this,a=t.getEventsBetween(this.start,this.end,!0).filter(function(e){return!e.isPrunable()}).map(function(e){var t=e.getCopy(r.mix.sequencerEngine);return t.setTime(void 0,r.step+e.step-r.start),t.subEvents&&t.subEvents.forEach(function(e){return e.step=r.step+e.step-r.start}),t.duration=e.duration,t.subSequence=r.mix.subSequence,t});if("DETERMINISTIC"===t.getMixType()){var i=t.getEvent(this.start,!1).getCopy(this.mix.sequencerEngine);i.isPrunable()||(i.setTime(void 0,this.step),a.push(i))}if("LINEAR"===t.getMixType()){var o=Object(M.r)(e);if(void 0!==o){var s=t.getValueAtStep(this.start),c=t.getValueAtStep(this.end-1);o.setValue(s),o.setTime(void 0,this.step),o.subSequence=this.mix.subSequence;var u=Object(M.r)(e);u.setValue(c),u.setTime(void 0,this.step+this.end-this.start-1),u.subSequence=this.mix.subSequence;var l=Object(M.r)(e);l.setValue(c),l.setTime(void 0,this.step-1),l.subSequence=this.mix.subSequence,a.push(o),a.push(u),a.push(l)}}for(var f in a){var h=a[f];e===M.k?new d(this.mix,h,h.duration).execute():new p.a(this.mix,h,h.duration).execute()}}},{key:"executeForTrack",value:function(){var e=Object(P.a)(x.a.mark(function e(t){var n,r,a,i,o,s,c,u;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=1/0,a=-1/0,e.t0=x.a.keys(t.patterns);case 4:if((e.t1=e.t0()).done){e.next=33;break}if(i=e.t1.value,!((o=t.patterns[i]).startStep>=this.start&&o.startStep<this.end||o.endStep>=this.start&&o.endStep<this.end)){e.next=31;break}if(s=void 0,!(o.startStep<this.start)){e.next=16;break}return c=this.start-o.startStep,e.next=13,o.getCopy(c,c+o.endStep-this.start);case 13:s=e.sent,e.next=25;break;case 16:if(!(o.endStep>this.end)){e.next=22;break}return e.next=19,o.getCopy(0,this.end-o.startStep);case 19:s=e.sent,e.next=25;break;case 22:return e.next=24,o.getCopy();case 24:s=e.sent;case 25:s.startStep<r&&(r=s.startStep),s.endStep>a&&(a=s.endStep),s.track=this.track,u=s.startStep-this.start,s.startStep=this.step+u,n.push(s);case 31:e.next=4;break;case 33:r!==1/0&&a!==-1/0&&N(this.track,this.step+r-this.start,this.step+a-this.start),this.track.patterns=[].concat(Object(S.a)(this.track.patterns),n),this.track.updateSteps();case 36:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),n}(F),z=n(10);function J(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var V=function(e){Object(o.a)(n,e);var t=J(n);function n(e,r,i,o){return Object(a.a)(this,n),t.call(this,e,r,i,o)}return Object(i.a)(n,[{key:"getEventsAfter",value:function(e,t){return e.events.filter(function(e){return e.step>=t})}},{key:"executeByType",value:function(e,t,n){var r=this.getEventsAfter(t,this.start);for(var a in r){var i=r[a],o=(i.step,this.step-this.start);if(i.setTime(void 0,i.step+o),i.subEvents)for(var s in i.subEvents){i.subEvents[s].step+=o}}}}]),n}(F);function H(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var U=function(e){Object(o.a)(n,e);var t=H(n);function n(e,r,i){var o;return Object(a.a)(this,n),(o=t.call(this,e,void 0,r,i)).step=o.end,o}return Object(i.a)(n,[{key:"duration",get:function(){return this.end-this.start}},{key:"execute",value:function(){var e,t,r,a={start:this.end};new V(this.mix,this.end+this.duration,a).execute(),Object(z.a)(Object(c.a)(n.prototype),"execute",this).call(this),e=this.mix.subSequence,t=this.start,r=this.end,console.log("DUPLICATE START=%s END=%s",t,r),A(e).forEach(function(e){var n=Object(S.a)(e.mixAutomation.automations),a=n.filter(function(e){return e.step>=t&&e.step<r});for(var i in n){var o=n[i];o.step>r&&(n[i]=o.getCopy(),n[i].step+=r-t)}var s,c=E(a);try{for(c.s();!(s=c.n()).done;){var u=s.value.getCopy(!1);u.step+=r-t,n.push(u)}}catch(l){c.e(l)}finally{c.f()}n.sort(function(e,t){return e.step-t.step}),e.mixAutomation.automations=n,e.mixAutomation.schedule(),e.mixAutomation.clearCache(),e.mixAutomation.updateRedux(!0)})}},{key:"executeForTrack",value:function(){var e=Object(P.a)(x.a.mark(function e(){var t,n,r,a,i,o,s=this;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.mix.subSequence.tracks[0],this.splitIntersectingPatterns(t),n=this.end-this.start,t.patterns.filter(function(e){return e.startStep>=s.end}).forEach(function(e){return e.startStep+=n}),e.t0=x.a.keys(t.patterns);case 5:if((e.t1=e.t0()).done){e.next=17;break}if(r=e.t1.value,!((a=t.patterns[r]).startStep>=this.start&&a.startStep<this.end)){e.next=15;break}return i=a.startStep-this.start,e.next=12,a.getCopy();case 12:(o=e.sent).startStep=this.end+i,t.patterns.push(o);case 15:e.next=5;break;case 17:t.updateSteps();case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(B),G=function(){function e(t,n,r){Object(a.a)(this,e),this.track=t,this.pattern=n,this.startStep=r}return Object(i.a)(e,[{key:"execute",value:function(){this.pattern.startStep=this.startStep}}]),e}(),W=(n(21),n(443),n(378)),K=function(){function e(t,n,r){Object(a.a)(this,e),this.pattern=n,this.step=r,this.track=t}return Object(i.a)(e,[{key:"execute",value:function(){var e=Object(P.a)(x.a.mark(function e(){var t,n,r;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return N(this.track,this.step,this.step+this.pattern.length()),e.next=3,this.pattern.getCopy();case 3:(t=e.sent).track=this.track,t.startStep=this.step,this.track.patterns.push(t),this.track.updateSteps(!0),(n={})[M.a]=t,this.track.sequencerEngine.store.dispatch(Object(R.qd)(n)),r=this.step+t.length(),this.track.sequencerEngine.store.dispatch(Object(R.z)(r));case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"xScale",get:function(){return this.track.sequencerEngine.state.arrangement.xScale}}]),e}(),Q=function(){function e(t,n){Object(a.a)(this,e),this.pattern=n,this.track=t}return Object(i.a)(e,[{key:"execute",value:function(){var e=Object(P.a)(x.a.mark(function e(){var t,n,r;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return N(this.track,this.pattern.endStep,this.pattern.endStep+this.pattern.length()),e.next=3,this.pattern.getCopy();case 3:(t=e.sent).track=this.track,t.startStep=this.pattern.startStep+this.pattern.length(),this.track.patterns.push(t),this.track.updateSteps(!0),(n={})[M.a]=t,this.track.sequencerEngine.store.dispatch(Object(R.qd)(n)),r=t.startStep,this.track.sequencerEngine.store.dispatch(Object(R.z)(r));case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"xScale",get:function(){return this.track.sequencerEngine.state.arrangement.xScale}}]),e}(),Z=function(){function e(t,n,r){Object(a.a)(this,e),this.pattern=t,this.direction=n,this.resizedStep=r}return Object(i.a)(e,[{key:"findOverlappingPattern",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.resizedStep;return this.pattern.track.patterns.filter(function(t){return t!==e.pattern}).find(function(e){return e.overlapsStep(t)})}},{key:"cutOverlappingPattern",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.resizedStep;if(void 0!==e)if(this.direction===W.b){var n=t-e.startStep;if(n<=0)return void this.deletePattern(e);e.changeLength(n)}else{var r=t-e.startStep;if(e.cutFromStart(r),e.startStep=t,0===e.length())return void this.deletePattern(e)}}},{key:"deletePattern",value:function(e){var t=e.track;t.patterns=t.patterns.filter(function(t){return t!==e})}},{key:"execute",value:function(){if(this.direction===W.c){var e=this.resizedStep-this.pattern.startStep;if(e<=0)return;e>this.pattern.length()&&this.cutOverlappingPattern(this.findOverlappingPattern()),this.pattern.changeLength(e,!1)}else this.resizedStep<this.pattern.startStep?(this.cutOverlappingPattern(this.findOverlappingPattern()),this.pattern.addToStart(this.pattern.startStep-this.resizedStep)):(this.pattern.cutFromStart(this.resizedStep-this.pattern.startStep),0===this.pattern.length()&&this.deletePattern(this.pattern)),this.pattern.startStep=this.resizedStep;this.pattern.track.updateSteps(!0)}}]),e}();function Y(e,t){void 0===t&&(t=e);var n=t.payload,a=void 0;switch(t.type){case r.i:(a=new d(e,n.event,n.duration)).execute();break;case r.h:(a=new p.a(e,n.event,n.duration)).execute();break;case r.b:(a=new v.a(e,n.event,n.inPlace)).execute();break;case r.a:(a=new m.a(e,n.event,n.subEvent)).execute();break;case r.g:(a=new b(e,n.event,n.resolution)).execute();break;case r.f:(a=new O(e,n.event,n.pattern)).execute();break;case r.k:(a=new k(e,n.event,n.newStep)).execute();break;case r.m:(a=new B(e,n.step,n.selection,n.eventType,n.track)).execute();break;case r.c:(a=new _(e,n.selection)).execute();break;case r.e:(a=new U(e,n.selection,n.eventType)).execute();break;case r.j:return(a=new G(n.track,n.pattern,n.startStep)).execute(),a;case r.o:return(a=new C(n.track,n.pattern,n.step)).execute(),a;case r.l:return(a=new K(n.track,n.pattern,n.step)).execute(),a;case r.d:return(a=new Q(n.track,n.pattern)).execute(),a;case r.n:return(a=new Z(n.pattern,n.direction,n.resizedStep)).execute(),a;default:return}return n.event?n.event.parentEvent?(e.updateTypeRedux(n.event.parentEvent.getType()),e.prune(n.event.parentEvent.getType())):(e.updateTypeRedux(n.event.getType()),e.prune(n.event.getType())):e.updateAllTypeRedux(),a}n.d(t,"a",function(){return Y})},function(e,t,n){"use strict";var r=n(7),a=n(8),i=n(2),o=n(4),s=n(5),c=function(){function e(t,n){Object(o.a)(this,e),this.sampler=t,this.sliceNumber=n}return Object(s.a)(e,[{key:"start",get:function(){return this.sampler.getStartTime(this.sliceNumber)},set:function(e){this.sampler.slice(this.sliceNumber,e,this.end)}},{key:"end",get:function(){return this.sampler.getEndTime(this.sliceNumber)},set:function(e){this.sampler.slice(this.sliceNumber,this.start,e)}}]),e}(),u=n(42),l=n.n(u),f=n(56);function h(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.cursor.step;return e.getSelectedTrack().getEasyPattern().getStepsAtStepNumber(e.cursor.step).map(function(e){return e.step})}var d=n(43),p=n(178);function v(e,t){var n=t.split("=");if(2!=n.length)return!1;var r=n[0],a=n[1];if(!Object(d.a)(a))return!1;if(a=parseFloat(a),"length"===r)return function(e,t){t=p.a.baseResolution.transformStepAtResolution2(t,e.resolution);var n=e.getSelectedTrack();n.pattern.changeLength(t),n.updateSteps()}(e,a),!0;var i=h(e);for(var o in i){var s=i[o];if(!(r in s))return!1;s[r]=a}return e.getSelectedTrack().updateSteps(),!0}var m=n(23),y=n(941),b=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t}return Object(s.a)(e,[{key:"run",value:function(e){return"run"!==e&&(e.indexOf("=")>-1?v(this.sequencerEngine,e):e in this&&(this[e](),!0))}},{key:"warp",value:function(){this.track&&(this.track.warp(),this.sequencerEngine.update())}},{key:"gate",value:function(){this.track&&(this.track.gated=!0)}},{key:"ungate",value:function(){this.track&&(this.track.gated=!1)}},{key:"sampleSynth",value:function(){this.sequencerEngine.autoResampleMode=!0,this.sequencerEngine.masterResampler.prepare(),this.sequencerEngine.store.dispatch(Object(m.fd)(!0))}},{key:"freezeInstrument",value:function(){Object(y.a)(this.sequencerEngine)}},{key:"makeInstrument",value:function(){var e=Object(f.a)(l.a.mark(function e(){var t,n,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.sequencerEngine.addSampledInstrumentTrack(),e.t0=l.a.keys(this.sequencerEngine.tracks);case 2:if((e.t1=e.t0()).done){e.next=10;break}if(n=e.t1.value,!(r=this.sequencerEngine.tracks[n].sample)){e.next=8;break}return e.next=8,t.instrument.newSample(void 0,r);case 8:e.next=2;break;case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"pack",value:function(){this.sequencerEngine.dispatch(Object(m.cb)(!0))}},{key:"track",get:function(){return this.sequencerEngine.getSelectedTrack()}}]),e}(),g=n(11),O=n(44),j=500;function k(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;t.cursor.step;w(t)&&function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.getSelectedStepData(),r=new Set;for(;n.on;)if(r.add(n.id),t?e.right(!1):e.left(!1),n=e.getSelectedStepData(),r.has(n.id))return void e.cursor.updateRedux();e.cursor.updateRedux()}(t,e),x(t,e)}function w(e){var t=e.cursor.getStep(e.resolution);return e.getSelectedTrack().getEasyPattern().getStepsAtStepNumber(t,e.resolution).map(function(e){return e.step}).some(function(e){return e.on})}function x(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.getSelectedStepData(),r=new Set,a=0;!n.on;)if(a++,r.add(n.id),t?e.right(!1):e.left(!1),n=e.getSelectedStepData(),r.has(n.id)||a>j)return void e.cursor.updateRedux();e.cursor.updateRedux()}var S=n(1);function P(e){for(var t=e.getSelectedStep()%e.resolution.numSteps(),n=0;n<t;n++)e.left(!1);e.cursor.updateRedux()}function E(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.resolution.numSteps(),r=0;r<n;r++)e.right(!1);t&&e.cursor.updateRedux()}function T(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.resolution.numSteps(),r=0;r<n;r++)e.left(!1);e.cursor.updateRedux(),t&&e.cursor.updateRedux()}var A=500;function M(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];w(e)||x(e);for(var n=e.getSelectedTrack(),r=n.getEasyPattern(),a=[],i=new Set,o=0;w(e);){o++;var s=e.getSelectedStepData();if(i.has(s)||o>A)return;i.add(s);var c=e.cursor.getStep(e.resolution),u=r.getStepsAtStepNumber(c,e.resolution).map(function(t){return Object(S.a)({},t,{stepNumber:e.cursor.step})});a=[].concat(Object(g.a)(a),Object(g.a)(u)),e.right()}var l=C(a);return t&&e.operationManager.dispatch(Object(O.j)(n,a.map(function(e){return e.step}))),l}function R(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];P(e);for(var n=e.resolution.numSteps(),r=e.resolution.getNumberOfStepsAtBaseResolution(),a=[],i=e.getSelectedTrack(),o=i.getEasyPattern(),s=e.cursor.step,c=0;c<n;c++){var u=o.getStepsAtStepNumber(s).map(function(e){return Object(S.a)({},e,{stepNumber:s})});a=[].concat(Object(g.a)(a),Object(g.a)(u)),s+=r}var l=C(a);return t&&e.operationManager.dispatch(Object(O.j)(i,a.map(function(e){return e.step}))),l}function C(e){var t=[];for(var n in e)t.push(Object(S.a)({},e[n],{step:e[n].step.getCopy(!0,!1,!0,!1,!1)}));return t}var N=function(){function e(t){var n=this;Object(o.a)(this,e),this.sequencerEngine=t,this.cursor=t.cursor,this.currentCommand=void 0,this.number=void 0,this.killRing=[],this[0]=function(){n.zero()}}return Object(s.a)(e,[{key:"run",value:function(e){e in this&&(this.currentCommand&&this.number?(this[e](parseInt(this.number)),this.number=void 0,this.currentCommand=void 0):(this[e](),this.currentCommand=e)),Object(d.a)(e)&&(void 0===this.number&&(this.number=""),this.number+=e)}},{key:"d",value:function(e){if(e=void 0===e?1:e,"d"==this.currentCommand){this.killRing=[];for(var t=0;t<e;t++)this.killRing=[].concat(Object(g.a)(this.killRing),Object(g.a)(R(this.sequencerEngine))),E(this.sequencerEngine,!1);for(var n=0;n<e;n++)T(this.sequencerEngine,!1);this.updateRedux(),this.currentCommand=void 0}}},{key:"x",value:function(){this.killRing=function(e){var t=e.getSelectedTrack();if(w(e)){var n=e.getSelectedStepData(),r=e.cursor.step,a=C([{stepNumber:r,step:n}]);return e.operationManager.dispatch(Object(O.i)(t,r)),a}return[]}(this.sequencerEngine)}},{key:"w",value:function(e){if("d"!=this.currentCommand)if("y"!=this.currentCommand){e=void 0===e?1:e-1;for(var t=0;t<e;t++)k(!0,this.sequencerEngine)}else{e=void 0===e?1:e,this.killRing=[];for(var n=0;n<e;n++)this.killRing=[].concat(Object(g.a)(this.killRing),Object(g.a)(M(this.sequencerEngine,!1)));this.currentCommand=void 0}else{e=void 0===e?1:e,this.killRing=[];for(var r=0;r<e;r++)this.killRing=[].concat(Object(g.a)(this.killRing),Object(g.a)(M(this.sequencerEngine)));this.currentCommand=void 0}}},{key:"b",value:function(e){e=void 0===e?1:e-1;for(var t=0;t<e;t++)k(!1,this.sequencerEngine)}},{key:"h",value:function(){this.sequencerEngine.left()}},{key:"l",value:function(){this.sequencerEngine.right()}},{key:"j",value:function(){E(this.sequencerEngine)}},{key:"k",value:function(){T(this.sequencerEngine)}},{key:"t",value:function(){this.dispatch(Object(O.r)(this.track,this.stepNumber,this.resolution))}},{key:"e",value:function(){this.cursor.show=!this.cursor.show}},{key:"zero",value:function(){P(this.sequencerEngine)}},{key:"a",value:function(){this.track.doubleTrackLength()}},{key:"s",value:function(){this.track.halfTrackLength()}},{key:"o",value:function(){!function(e){var t=h(e,e.cursor.step);for(var n in t){var r=t[n].duration||1;t[n].duration=r+1}e.getSelectedTrack().updateSteps()}(this.sequencerEngine)}},{key:"i",value:function(){!function(e){var t=h(e,e.cursor.step);for(var n in t){var r=t[n].duration||1;t[n].duration=Math.max(1,r-1)}e.getSelectedTrack().updateSteps()}(this.sequencerEngine)}},{key:"y",value:function(e){if(e=void 0===e?1:e,"y"==this.currentCommand){this.killRing=[];for(var t=0;t<e;t++)this.killRing=[].concat(Object(g.a)(this.killRing),Object(g.a)(R(this.sequencerEngine,!1))),E(this.sequencerEngine,!1);for(var n=0;n<e;n++)T(this.sequencerEngine,!1);this.updateRedux(),this.currentCommand=void 0}}},{key:"p",value:function(){!function(e,t){var n=e.getSelectedTrack(),r=e.cursor.step,a=Math.min.apply(Math,Object(g.a)(t.map(function(e){return e.stepNumber})));t=t.map(function(e){return Object(S.a)({},e,{stepNumber:r+e.stepNumber-a})});var i=e.operationManager;t.forEach(function(e){return i.dispatch(Object(O.c)(n,e.step.getCopy(!0,!1,!0,!1,!1),e.stepNumber))}),n.updateSteps()}(this.sequencerEngine,Object(g.a)(this.killRing))}},{key:"stepNumber",get:function(){return this.sequencerEngine.getSelectedStep()}},{key:"track",get:function(){return this.sequencerEngine.getSelectedTrack()}},{key:"op",get:function(){return this.sequencerEngine.operationManager}},{key:"dispatch",value:function(e){this.op.dispatch(e)}},{key:"resolution",get:function(){return this.sequencerEngine.resolution}},{key:"updateRedux",value:function(){this.cursor.updateRedux()}}]),e}(),I=n(225),q=n(609),_=n(286),D=n(985);function F(){return(F=Object(f.a)(l.a.mark(function e(t,n,r){var a,i,o,s,c,u,f,h,d,p,v,y,b,g,O,j,k,w=arguments;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=w.length>3&&void 0!==w[3]?w[3]:t.getSelectedTrack(),i=w.length>4?w[4]:void 0,void 0!==a){e.next=4;break}return e.abrupt("return");case 4:if(o=L(n),s=o.effectName,c=o.parameters,u=Object(I.a)(),!(s in u)){e.next=16;break}return e.next=9,u[s](t);case 9:return f=e.sent,h=r||z(t),!i&&h&&"Effect Rack"===h.name?(h.addEffect(f),d=Object(q.a)(200,200,h),p=d.x,v=d.y,f.x=p,f.y=v):(a.effects.push(f),t.selectEffect(f)),f.enable(!0),a.updateEffects(),B(f,c),e.abrupt("return",f);case 16:if(!(s in _.b)){e.next=23;break}return y=_.b[s](a),(b=r||z(t))&&"Midi Effect Rack"===b.name?(g=Object(q.a)(200,200,b),O=g.x,j=g.y,b.addEffect(y),y.x=O,y.y=j):(a.midiEffects.addEffect(y),t.selectEffect(y)),y.enabled=!0,B(y,c),e.abrupt("return",y);case 23:if(!(s in D.b)){e.next=30;break}return k=D.b[s](a),a.liveEffects.addEffect(k),k.enabled=!0,t.store.dispatch(Object(m.rd)(k.id)),B(k,c),e.abrupt("return",k);case 30:case"end":return e.stop()}},e)}))).apply(this,arguments)}function L(e){return e.includes("[")?{effectName:e.slice(0,e.indexOf("[")),parameters:function(e){for(var t=[],n="",r="",a=!0,i=!1,o=0;o<e.length;o++){var s=e.charAt(o);if("="!=s){if(a)n+=s;else if(i){if(" "==s){t.push({parameter:n,value:r}),i=!1,a=!0,n="",r="";continue}r+=s}}else a=!1,i=!0}""!==n&&t.push({parameter:n,value:r});return t}(e=e.includes("]")?e.slice(e.indexOf("[")+1,e.indexOf("]")):e.slice(e.indexOf("[")+1))}:{effectName:e,parameters:[]}}function B(e,t){var n=function(n){var r=t[n],a=r.parameter,i=r.value,o=a.split(" ").join(""),s=e.parameters.find(function(e){return e.name.toLowerCase()===a.toLowerCase()||e.name.toLowerCase()===o.toLowerCase()});if(void 0===s)return"continue";if(i.includes("%")){i=parseFloat(i.slice(0,i.indexOf("%")));var c=s.max-s.min;s.set(c*(i/100))}else i=parseFloat(i),s.set(i)};for(var r in t)n(r)}var z=function(e){if(void 0!==e.state.effects.selectedEffect)return e.selectedEffect};function J(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var o=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(a.a)(this,n)}}var V=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t,this.emacsScripting=new b(this.sequencerEngine),this.viScripting=new N(this.sequencerEngine),this.cursor=t.cursor,this.clipboard=[],this.cmd={},this.stepFunctions={},this.stepTimes={},this.commandHistory=[],this.historyCounter=0,this.futureCalls=[]}return Object(s.a)(e,[{key:"viCommand",value:function(e){var t=void 0!==this.viScripting.currentCommand;return this.viScripting.run(e),t}},{key:"emacsCommand",value:function(e){this.emacsScripting.run(e)}},{key:"isEmacsCommand",value:function(){return"M-x"===this.sequencerEngine.state.commands.commandPrefix}},{key:"runScript",value:function(e){if(this.isEmacsCommand())return this.emacsScripting.run(e),!0;try{if(this.commandHistory.push({cursor:this.cursor.getJson(),command:e,enabled:!0}),e.startsWith("/"))this.search(e.slice(1));else if(e.startsWith("+"))this.addCommand(e.slice(1));else{if(e.startsWith(":"))return this.emacsScripting.run(e.slice(1));t=this,new Function("with(this) { "+e+"}").call(t)}return this.historyCounter=0,!0}catch(n){return void 0!==this.onFlashInfo&&this.onFlashInfo(n.message),!1}var t}},{key:"runEmacsCommand",value:function(e){}},{key:"search",value:function(e){var t=e.endsWith("/");t&&(e=e.slice(0,e.length-1));var n=e.split("+");this.sequencerEngine.searchForSounds(n,t)}},{key:"addCommand",value:function(e){!function(e,t,n){F.apply(this,arguments)}(this.sequencerEngine,e)}},{key:"getJson",value:function(){return{commandHistory:this.commandHistory.filter(function(e){return e.enabled})}}},{key:"fromJson",value:function(e){for(var t=e.commandHistory,n=0;n<t.length;n++){var r=null;if("string"===typeof t[n])this.cursor.step=0,this.cursor.track=0,r=t[n];else if("cursor"in t[n]){var a=t[n].cursor;this.cursor.step=a.step,this.cursor.track=a.track,r=t[n].command}this.runScript(r)}}},{key:"recordMix",value:function(e){this.sequencerEngine.recordingMix=e}},{key:"slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.sequencerEngine.getSelectedTrack().getSamplers()[0];return new c(t,e)}},{key:"midiFX",value:function(){var e=this;this.sequencerEngine.getSelectedTrack(),this.sequencrerEngine.midiEffects;return function(){e.sequencerEngine.getSelectedTrack()}}},{key:"left",value:function(){this.sequencerEngine.left()}},{key:"right",value:function(){this.sequencerEngine.right()}},{key:"up",value:function(){this.sequencerEngine.up()}},{key:"down",value:function(){this.sequencerEngine.down()}},{key:"arp",value:function(e){this.sequencerEngine.getSelectedTrack().trackData.arpOn=e}},{key:"arpRate",value:function(e,t){this.sequencerEngine.getSelectedTrack()}},{key:"arpOctaves",value:function(e){this.sequencerEngine.getSelectedTrack().trackData.arpOctaves=e}},{key:"steps",value:function(e){var t=this.sequencerEngine.getSelectedTrack(),n=t.getStepsAtResolution(this.sequencerEngine.resolution);void 0===e&&(e=n.length),e+this.sequencerEngine.getSelectedStep()>=n.length&&(e-=e+this.sequencerEngine.getSelectedStep()-n.length);var r=this.sequencerEngine.getSelectedStep();return new H(this.sequencerEngine,t,n.slice(r,r+e),r)}},{key:"copy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.clipboard=this.steps(e).map(function(e){return e.getCopy()}),this.clipboard[0]}},{key:"paste",value:function(){for(var e=this.steps(this.clipboard.length).stepDataList,t=0;t<e.length;t++)e[t].copyFrom(this.clipboard[t]);this.sequencerEngine.getSelectedTrack().syncBuckets(this.sequencerEngine.resolution),this.sequencerEngine.getSelectedTrack().updateSteps()}},{key:"rand",value:function(){return Math.random()}},{key:"onStepReached",value:function(e){if(e in this.stepFunctions){try{this.stepFunctions[e].map(function(e){return e()})}catch(t){void 0!==this.onFlashInfo&&this.onFlashInfo(t.message)}this.stepTimes[e]++}}},{key:"stepFunction",value:function(e){var t=this,n=this.steps().get(0),r=(this.sequencerEngine.getSelectedTrack(),this.cursor.step),a=function(){e(n,t.stepTimes[r])};r in this.stepFunctions?this.stepFunctions[r].push(a):(this.stepFunctions[r]=[a],this.stepTimes[r]=0)}},{key:"volume",value:function(e){this.sequencerEngine.getSelectedTrack().setRawVolume(e)}},{key:"start",value:function(){this.cursor.step=0}},{key:"end",value:function(){var e=this.sequencerEngine.getTrackLength();this.cursor.setStep(e-1,this.sequencerEngine.resolution)}},{key:"line",value:function(e){var t=this;this.steps(e).map(function(){t.right()})}},{key:"clearStepFunctions",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=0;t<e;t++){var n=this.cursor.step+t;delete this.stepFunctions[n]}}},{key:"pattern",value:function(e){this.sequencerEngine.switchToPattern(e)}},{key:"clearSequence",value:function(){this.sequencerEngine.clearSequence()}},{key:"clear",value:function(){this.sequencerEngine.getSelectedTrack().pattern.clear()}},{key:"upHistory",value:function(){var e=this.commandHistory.length-this.historyCounter-1,t=this.commandHistory[e];return this.historyCounter=Math.min(this.historyCounter+1,this.commandHistory.length),void 0===t?"":t.command}},{key:"downHistory",value:function(){return this.historyCounter--,this.historyCounter<=0?(this.historyCounter=0,""):this.commandHistory[this.commandHistory.length-this.historyCounter].command}},{key:"deleteHistoryForTrack",value:function(e){for(var t=[],n=0;n<this.commandHistory.length;n++)this.commandHistory[n].cursor.track!=e&&t.push(this.commandHistory[n]);this.commandHistory=t}},{key:"currentStep",get:function(){return this.sequencerEngine.trackStep}},{key:"map",value:function(e){this.sequencerEngine.stepNumberScript=e}},{key:"phi",get:function(){return 1.61803398875}},{key:"com",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=e,r=t.length-1;r>=0;r--)n=t[r](n);return n}}}]),e}();var H=function(e){Object(r.a)(n,e);var t=J(n);function n(e,r,a,i){var s,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return Object(o.a)(this,n),(s=t.call(this,e)).stepDataList=a,s.step=i,s.stepOffset=c,s.track=r,s}return Object(s.a)(n,[{key:"filter",value:function(e){return new n(this.sequencerEngine,this.track,this.stepDataList.filter(e),this.step)}},{key:"isOn",value:function(){return this.filter(function(e){return e.on})}},{key:"sync",value:function(){this.sequencerEngine.getSelectedTrack().syncBuckets(this.sequencerEngine.resolution),this.track.updateSteps()}},{key:"get",value:function(e){return this.stepDataList[e]}},{key:"even",value:function(){for(var e=[],t=0;t<this.stepDataList.length;t+=2)e.push(this.stepDataList[t]);return new n(this.sequencerEngine,this.track,e,this.step,2*this.stepOffset)}},{key:"odd",value:function(){for(var e=[],t=1;t<this.stepDataList.length;t+=2)e.push(this.stepDataList[t]);var r=this.sequencerEngine.resolution.transformStepAtBaseResolution(1);return new n(this.sequencerEngine,this.track,e,this.step+r,2*this.stepOffset)}},{key:"stepFunction",value:function(e){var t=this;this.do(function(){return t.sequencerEngine.scripting.stepFunction(e)})}},{key:"do",value:function(e){var t=this.sequencerEngine.cursor,n=t.step,r=this.step;for(var a in this.stepDataList)t.step=r,e(),r+=this.sequencerEngine.resolution.transformStepAtBaseResolution(this.stepOffset);t.step=n}},{key:"on",get:function(){return this.map(function(e){return e.on})},set:function(e){this.map(function(t,n){return t.on="function"===typeof e?e(n):e}),this.sync()}},{key:"duration",get:function(){return this.map(function(e){return e.duration})},set:function(e){this.map(function(t,n){return t.duration="function"===typeof e?e(n):e}),this.sync()}},{key:"chop",get:function(){return this.map(function(e){return e.chop})},set:function(e){this.map(function(t,n){return t.chop="function"===typeof e?e(n):e}),this.sync()}},{key:"velocity",get:function(){return this.map(function(e){return e.velocity})},set:function(e){this.map(function(t,n){return t.velocity="function"===typeof e?e(n):e}),this.sync()}},{key:"transpose",get:function(){return this.map(function(e){return e.transpose})},set:function(e){this.map(function(t,n){return t.transpose="function"===typeof e?e(n):e}),this.sync()}},{key:"attack",get:function(){return this.map(function(e){return e.attack})},set:function(e){this.map(function(t,n){return t.transpose="function"===typeof e?e(n):e}),this.sync()}},{key:"release",get:function(){return this.map(function(e){return e.release})},set:function(e){this.map(function(t,n){return t.transpose="function"===typeof e?e(n):e}),this.sync()}},{key:"map",value:function(e){var t=this.stepDataList.map(e);return this.sync(),t}}]),n}(V);t.a=V},,function(e,t,n){"use strict";var r=n(11),a=n(42),i=n.n(a),o=n(56),s=n(4),c=n(5),u=(n(127),n(435),n(159)),l=function e(){Object(s.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"month",type:"uint32"},{name:"year",type:"uint32"}],name:"newMonthlyIndex",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"month",type:"uint32"},{indexed:!0,name:"year",type:"uint64"}],name:"NewMonthlyIndex",type:"event"}],this.contractAddress="0xfaa21e766f988524d3f38b9c46c22aca11d76dd5"},f=n(221),h=n(162),d=n(119),p=n(122),v=new l,m=function(){function e(){Object(s.a)(this,e),this.indexContract=new h.a.eth.Contract(v.abi,v.contractAddress),this.indexContractAddress=this.indexContract.options.address}return Object(c.a)(e,[{key:"getIndexForMonth",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new f.a(this.indexContractAddress).from(d.x).select("hash").where("month",t).where("year",n).executeQuery();case 2:if(r=e.sent,console.log("got the results for monthly = "),console.log(r),void 0!==r&&0!==r.length){e.next=7;break}return e.abrupt("return");case 7:return a=r[0].hash,e.next=10,p.a.getJson(a);case 10:return o=e.sent,e.abrupt("return",o);case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function y(e){var t=void 0;for(var n in e){var r=e[n];void 0!==r&&(t=void 0!==t?b(t,r):r)}return t}function b(e,t){var n={};for(var r in e){var a=e[r],i=t[r];for(var o in n[r]={},a){var s=a[o],c=i[o];n[r][o]=g(s,c)}}return n}function g(e,t){var n=O(e),a=O(t),i={};for(var o in n)i[o]=o in a?[].concat(Object(r.a)(n[o]),Object(r.a)(a[o])):n[o];for(var s in a)s in n||(i[s]=n[s]);return function(e){return Object.keys(e).map(function(t){return{dimension:t,values:e[t]}})}(i)}function O(e){var t={};for(var n in e){var r=e[n];t[r.dimension]=r.values}return t}var j=n(142),k=function(){function e(){Object(s.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32",name:"ipfsHash",type:"bytes32"}],name:"newIndex",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!1,internalType:"bytes32",name:"indexHash",type:"bytes32"}],name:"NewIndex",type:"event"}],this.contractAddress="0xefBe8bf3720fE3aD117B1397DD95c77240Fe8837"}return Object(c.a)(e,[{key:"getContract",value:function(e){return console.log("getting contract w address = "+this.contractAddress),new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),w=(n(183),new k),x=new m,S={},P=function(){function e(t){var n=this;Object(s.a)(this,e),this.fullIndex=void 0,this.guildId=0,this.useMonth=!1,this.monthlyIndices=[],this.monthlyFilter=void 0,this.store=t,t&&this.store.subscribe(function(){return n.onStateUpdate()})}return Object(c.a)(e,[{key:"onStateUpdate",value:function(){var e=this.store.getState(),t=e.guilds.selectedGuild?e.guilds.selectedGuild.guildId:0;t!==this.guildId&&(this.guildId=t,this.loadIndex())}},{key:"loadNewIndex",value:function(){var e=Object(o.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.guildId=t,e.next=3,this.loadIndex();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"index",get:function(){return this.useMonth?void 0===this.monthlyIndex?this.fullIndex:this.monthlyIndex.index:this.fullIndex}},{key:"toBlock",get:function(){return this.monthlyIndex.toBlock}},{key:"fromBlock",get:function(){return this.monthlyIndex.fromBlock}},{key:"filterByMonth",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.monthlyFilter&&this.monthlyFilter.month===t&&this.monthlyFilter.year===n){e.next=4;break}return e.next=3,x.getIndexForMonth(t,n);case 3:this.monthlyIndex=e.sent;case 4:return this.useMonth=!0,this.monthlyFilter={month:t,year:n},e.abrupt("return",!0);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearFilter",value:function(){this.useMonth=!1}},{key:"loadIndex",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=n.length>0&&void 0!==n[0]?n[0]:this.guildId)||!u.a.isLoggedIn()){e.next=6;break}return e.next=4,this.fetchAndMergeIndices();case 4:return this.fullIndex=e.sent,e.abrupt("return");case 6:return e.next=8,this.fetchIndex(t);case 8:this.fullIndex=e.sent;case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchAndMergeIndices",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n,r,a,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[0],n=Array.from(new Set(t.map(function(e){return e.guildId}))),r=[],e.t0=i.a.keys(n);case 4:if((e.t1=e.t0()).done){e.next=14;break}return a=e.t1.value,o=n[a],e.t2=r,e.next=10,this.fetchIndex(o);case 10:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=4;break;case 14:return e.abrupt("return",y(r));case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchIndex",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n,r=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:this.guildId,e.next=3,this.getIndexHash(t);case 3:if(void 0!==(n=e.sent)){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.next=9,p.a.getJson(n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getAllForField",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(void 0===this.index)return[];var r=this.index[e][e].map(function(e,t){return{value:e.dimension,rank:t}});return this.sort(r),r.length<t+n?r.slice(t):r.slice(t,t+n)}},{key:"getFieldsForField",value:function(e,t,n){if(void 0===this.index)return new Set([]);var a=this.index[t][e].filter(function(e){return e.dimension==n});if(0==a.length)return new Set([]);if(void 0===a[0].values)return new Set;var i=Object(r.a)(a[0].values).map(function(e,t){return{value:e,rank:t}});return this.sort(i),new Set(i)}},{key:"freeTextSearch",value:function(e,t){var n=this.getAllForField(e,0,5e3);return n=n.filter(function(e){return e.value.toString().toLowerCase().includes(t.toLowerCase())}).map(function(e,t){return{value:e.value,rank:e.rank}})}},{key:"sort",value:function(e){return e.sort(function(e,t){return e=e.value,t=t.value,void 0===e[0]?1:void 0===t[0]?-1:e[0]===e[0].toLocaleLowerCase()&&t[0]===t[0].toLocaleLowerCase()||e[0]===e[0].toLocaleUpperCase()&&t[0]===t[0].toLocaleUpperCase()?e.localeCompare(t):e[0]===e[0].toLocaleLowerCase()?-1:1})}},{key:"getIndexHash",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in S)){e.next=4;break}return e.next=3,S[t];case 3:return e.abrupt("return",e.sent);case 4:return n=new Promise(function(){var e=Object(o.a)(i.a.mark(function e(n,r){var a,o,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new j.a(w.contractAddress).from(d.u).select("indexHash").where("guildId",t).limit(1),e.next=3,a.executeQuery();case 3:if(0!==(o=e.sent).length){e.next=7;break}return n(void 0),e.abrupt("return");case 7:s=o[0].indexHash,n(s);case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),S[t]=n,e.next=8,n;case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}();t.a=P},function(e,t,n){"use strict";var r=n(1),a=n(108),i=n(11),o=n(4),s=n(5),c=n(31),u=n(10),l=n(7),f=n(8),h=n(2),d=n(167),p=n(134),v=n(130),m=n(128),y=n(116),b=(n(241),1),g={1:[0,2,4,5,7,9,11],2:[0,2,3,5,7,8,10],3:[0,2,3,5,7,8,11]},O=n(147),j=(n(457),n(14)),k=n(139),w=n(635),x=n(286),S=n(327),P=n(375),E=n(328),T=n(322);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var M=n(382),R=n(145);function C(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return N(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function I(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}window.voicingTimes=[],window.flowTimes=[],window.networkBuildTimes=[];function q(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var F=function(e){Object(l.a)(n,e);var t=D(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Chords Rack",e,8)).initializeConfigurations(r.adjacencyLists),r.addChords(),r.initializeChordParameters(),r}return Object(s.a)(n,[{key:"addChords",value:function(){this.addEffect(new T.b(this,1)),this.addEffect(new T.b(this,2)),this.addEffect(new T.b(this,3)),this.addEffect(new T.b(this,4)),this.addEffect(new T.b(this,5)),this.addEffect(new T.b(this,6)),this.addEffect(new T.b(this,7)),this.addEffect(new T.b(this,0)),this.addEffect(new T.f(this,1)),this.addEffect(new T.f(this,3)),this.addEffect(new T.f(this,5)),this.effects[0].x=40,this.effects[0].y=47,this.effects[1].x=120,this.effects[1].y=18,this.effects[2].x=220,this.effects[2].y=16,this.effects[3].x=303,this.effects[3].y=43,this.effects[4].x=244,this.effects[4].y=76,this.effects[5].x=167,this.effects[5].y=99,this.effects[6].x=91,this.effects[6].y=86,this.effects[7].x=21,this.effects[7].y=145,this.effects[8].x=6,this.effects[8].y=200,this.effects[9].x=61,this.effects[9].y=200,this.effects[10].x=125,this.effects[10].y=200,this.connectNodes(this.effects[7],this.effects[8]),this.connectNodes(this.effects[7],this.effects[9]),this.connectNodes(this.effects[7],this.effects[10])}},{key:"clear",value:function(){this.counter=0,this.effects.forEach(function(e){return e.clear()}),this.triggers=[]}},{key:"isRack",get:function(){return!0}},{key:"clearCaching",value:function(){this.effects.forEach(function(e){e.subGraph=void 0,e.effects=void 0})}},{key:"addEffect",value:function(e){Object(u.a)(Object(h.a)(n.prototype),"addEffect",this).call(this,e),this.clearCaching(),e.rack=this}},{key:"connectNodes",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(u.a)(Object(h.a)(n.prototype),"connectNodes",this)).call.apply(e,[this].concat(r)),this.clearCaching()}},{key:"deleteEdge",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(u.a)(Object(h.a)(n.prototype),"deleteEdge",this)).call.apply(e,[this].concat(r)),this.clearCaching()}},{key:"deleteEffect",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(u.a)(Object(h.a)(n.prototype),"deleteEffect",this)).call.apply(e,[this].concat(r)),this.clearCaching()}},{key:"getJson",value:function(){return this.getRackJson()}},{key:"fromJson",value:function(e,t,a,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t;this.adjacencyLists={},this.initializeConfigurations(this.adjacencyLists,!1),this.effects=[],this.loaded=!1;var s=Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,e,t),c=e.effects;for(var l in c){var f=c[l],d=Object(x.a)(f,this.track);if(s=Object(r.a)({},s,d.fromJson(f,o)),d.id!==f.id){var p,v=q(e.configurations);try{for(v.s();!(p=v.n()).done;){var m=p.value,y=m[f.id];m[d.id]=y,delete m[f.id]}}catch(b){v.e(b)}finally{v.f()}}this.addEffect(d,!1),d.x=f._x||f.x,d.y=f._y||f.y}return this.fromRackJson(e,t),this.loaded=!0,s}}]),n}(Object(w.a)(function(e){return function(e){Object(l.a)(n,e);var t=I(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getAdjacentTransforms",value:function(e){return(this.adjacencyLists[e.id]||[]).map(function(e){return e.effect}).filter(function(e){return e.getChordEffectType()===T.e})}},{key:"getAdjacentVoices",value:function(e){var t=this.getChord(0),n=this.getChord(e),r=this.adjacencyLists[t.id]||[],a=this.adjacencyLists[n.id]||[];return[].concat(Object(i.a)(r),Object(i.a)(a)).map(function(e){return e.effect}).filter(function(e){return e.getChordEffectType()===T.d})}},{key:"getChordElements",value:function(e){return this.getAdjacentVoices(e).map(function(e){return e.degree})}},{key:"getChordVoicing",value:function(e){var t,n=[],r=C(this.getAdjacentVoices(e));try{for(r.s();!(t=r.n()).done;){var a=t.value,i=this.getAdjacentTransforms(a);0===i.length?n.push(0):n.push(i[0].value)}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"getFlowChordVoicing",value:function(e){var t=this;return function(n,r,a){if(!n)return[];var o,s,c=(new Date).getTime(),u=e(),l=t.getChord(u);if(l.subGraph)o=l.subGraph,s=l.effects;else{o={},s=[];var f=function(e){var n=t.effects.find(function(t){return t.id===e}),r=e;if(n.getChordEffectType()===T.a&&0===n.numeral)r=l.id;else if(n.getChordEffectType()===T.a&&n!==l)return"continue";var a=t.adjacencyLists[e].filter(function(e){return e.effect.getChordEffectType()!==T.a});o[r]?o[r]=[].concat(Object(i.a)(o[r]),Object(i.a)(a)):o[r]=a,s=[].concat(Object(i.a)(s),[n],Object(i.a)(a.map(function(e){return e.effect})))};for(var h in t.adjacencyLists)f(h);var d,p=C(s);try{for(p.s();!(d=p.n()).done;){var v=d.value;o[v.id]&&0!==o[v.id].length||(o[v.id]=[new M.a(t.outputNode,t.track.sequencerEngine)])}}catch(W){p.e(W)}finally{p.f()}l.subGraph=o,l.effects=s}t.effects.forEach(function(e){return e.active=!1});var m=l;n.voices=[];var y=new R.a(n,a,r);t.effects.forEach(function(e){e.onNewStep(),e.triggers.length=0}),window.networkBuildTimes.push((new Date).getTime()-c),l.input(y);var b=(new Date).getTime(),g=t.runFlow(a,r,r,m,[y],o),O=(new Date).getTime();window.flowTimes.push(O-b);var j,k={},w=C(g);try{for(w.s();!(j=w.n()).done;){var x,S=j.value,P=S.time,E=C(S.stepData.voices);try{for(E.s();!(x=E.n()).done;){var A=x.value,N=A.voice,I=A.octave,q=A.flat,_=A.thick,D=N+P;q&&(D+="+flat"+q),_&&(D+="+thick"+_),isNaN(I)||(D+="+"+I),k[D]={octave:I,time:P,voice:N,flat:q,thick:_}}}catch(W){E.e(W)}finally{E.f()}}}catch(W){w.e(W)}finally{w.f()}var F=[];for(var L in k){var B=k[L],z=B.time,J=B.octave,V=B.voice,H=B.flat,U=B.thick;F.push({voice:V,octave:J,time:z,flat:H,thick:U})}F.sort(function(e,t){return e.voice-t.voice});var G=(new Date).getTime();return window.voicingTimes.push(G-c),F}}},{key:"getStep",value:function(e){var t=this.cachedSteps[this.cacheIndex];return this.cacheIndex=(this.cacheIndex+1)%this.cachedSteps.length,t.voices=Object(i.a)(e.voices),t}}]),n}(e)}(function(e){Object(l.a)(n,e);var t=A(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"initializeChordParameters",value:function(){this.progressionStartParameter=new j.b("progressionStart",this,function(){return 0},{defaultValue:1,min:1,max:7}),this.registerParameter(this.progressionStartParameter)}},{key:"getChord",value:function(e){return this.effects.find(function(t){return t.numeral===e})}},{key:"getStartingChord",value:function(){return this.progressionStartParameter.get()}},{key:"getPossibleNextEffects",value:function(e){var t=this.getChord(e);return(this.adjacencyLists[t.id]||[]).map(function(e){return e.effect}).filter(function(e){return e.getChordEffectType()===T.a})}},{key:"getPossibleNextChords",value:function(e){return this.getPossibleNextEffects(e).map(function(e){return e.numeral})}},{key:"getNextChordEffect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.getPossibleNextEffects(e),r=this.getChord(e);return void 0!==r.nextChords[t]?r.nextChords[t]:n[0]||this.getChord(1)}},{key:"getNextChord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getNextChordEffect(e,t).numeral}}]),n}(Object(S.a)(Object(P.a)(Object(E.a)(k.a))))))),L=(n(214),n(459),n(331),n(460)),B=(n(461),n(260)),z=n(289),J=(n(462),n(170),n(165)),V=n(114),H=n(193);n(150);function U(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}n.d(t,"a",function(){return G}),window.chordTimes=[];Object(B.h)(Object(H.f)("- - . -"),Object(H.f)("- . - -"),Object(H.f)(". - - -"),Object(H.f)("- - - .")),Object(B.h)(Object(H.f)("- - ."),Object(H.f)("- . -"),Object(H.f)(". - -"));var G=function(e){Object(l.a)(n,e);var t=U(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Generative Chords",e)).chordProgression=new F(e,Object(c.a)(r)),r.progressionLengthParameter=new j.b("progressionLength",Object(c.a)(r),function(){return[]},{defaultValue:4,min:1,max:16}),r.registerParameter(r.progressionLengthParameter),r.currentChord=1,r.tidalString=". - . -",r.expressionSeries=[13,11,9,7],r.scaleParameter=new j.b("scale",Object(c.a)(r),function(){return[]},{defaultValue:b,min:1,max:3}),r.registerParameter(r.scaleParameter),r.connectedJakiEffect=void 0,r.newInlet(v.i),r.newInlet(v.g,function(){return r.reset()}),r.newOutlet(v.b),r}return Object(s.a)(n,[{key:"reset",value:function(){this.position=void 0}},{key:"getParameters",value:function(){return[].concat(Object(i.a)(this.parameters),Object(i.a)(this.chordProgression.getParameters()))}},{key:"tidalString",get:function(){return this._tidalString},set:function(e){this.tidalPattern=Object(H.f)(e)(),this._tidalString=e}},{key:"getNoteDegree",value:function(e){e=Object(O.a)(e,12);var t=this.shifted_scale().indexOf(e);return t%2===0?t+1:t+8}},{key:"getCurrentChordNotes",value:function(){return[]}},{key:"scale",get:function(){return this.scaleParameter.get()},set:function(e){this.scaleParameter.set(e,!1)}},{key:"progressionLength",get:function(){return this.progressionLengthParameter.get()}},{key:"getPossibleNextChords",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentChord;return this.chordProgression.getPossibleNextChords(e)}},{key:"getNextChord",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentChord,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.position;return this.chordProgression.getNextChord(e,t)}},{key:"chordElements",get:function(){var e=this;return this.chordProgression.getFlowChordVoicing(function(){return e.currentChord})}},{key:"output",value:function(){for(var e,t=(new Date).getTime(),r=this.triggers.length>0,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];var s=(e=Object(u.a)(Object(h.a)(n.prototype),"output",this)).call.apply(e,[this].concat(i)),c=(new Date).getTime();return r&&window.chordTimes.push(c-t),s}},{key:"clear",value:function(){var e=this;this.tidals&&this.tidals.forEach(function(e){return e.clear()}),this.freeTidals(),this.chordProgression.clear(),this.position=void 0;this.shifted_scale=Object(z.d)(function(){if(e.isInletConnected(v.i)){var t=e.receiveMessage(v.i);if(t[0]){var n=Object(a.a)(t[0],1)[0];return e._scale=n,n}if(e._scale)return e._scale}return g[e.scale]},function(){return e.currentChord-1});var t=0;this.myScript=Object(J.a)(function(e){return e&&(t=e.transpose),Object(V.w)(!0)},function(){return(arguments.length<=0?void 0:arguments[0])&&(void 0===e.position?(e.position=0,e.currentChord=e.chordProgression.getStartingChord(),e.sendMessage(v.b)):(e.position++,e.position>=e.progressionLength?(e.position=0,e.currentChord=e.chordProgression.getStartingChord(),e.sendMessage(v.b)):e.currentChord=e.getNextChord())),Object(V.w)(!0)},Object(L.b)(this.shifted_scale,this.chordElements,function(){return t}))}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}},{key:"fromJson",value:function(e){var t=Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,e);return Object(y.a)(this.scaleParameter,e.scale,t),t=Object(r.a)({},t,Object(m.a)(e,"scaleParameter",this.scaleParameter)),Object(y.a)(this.progressionLengthParameter,e.progressionLength,t),t=Object(r.a)({},t,Object(m.a)(e,"progressionLengthParameter",this.progressionLengthParameter)),e.chordProgression&&(this.chordProgression.effects=[],t=Object(r.a)({},t,this.chordProgression.fromJson(e.chordProgression))),t}},{key:"getJson",value:function(){return Object(r.a)({},Object(u.a)(Object(h.a)(n.prototype),"getJson",this).call(this),{chordProgression:this.chordProgression.getJson()})}}]),n}(Object(p.a)(d.a))},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(1),o=n(56),s=n(4),c=n(5),u=n(7),l=n(8),f=n(2),h=n(6),d=n.n(h),p=n(122),v=n(80),m=n(222),y=n(11),b=n(31),g=(n(113),n(23)),O=n(225);function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var k=n(192),w=n(116),x=n(128),S=n(14);function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var E=function(e){Object(u.a)(n,e);var t=P(n);function n(e,r){var a;Object(s.a)(this,n),(a=t.call(this)).initialBulkValues={},a.formants=e,a.oscillator=e.oscillator;var i=a.oscillator.context.getCopy();return i.forFormant(Object(b.a)(a)),i.forSubDevice(Object(b.a)(a)),i.forTrack(a.oscillator.track),a.context=i,a.number=r,a.parameters=[],a.name="Formant "+r,a.enabled=!1,a.setup(),a.sequencerEngine.dispatch(Object(g.xb)(a.initialBulkValues)),a}return Object(c.a)(n,[{key:"sequencerEngine",get:function(){return this.oscillator.sequencerEngine}},{key:"registerParameter",value:function(e,t){this.initialBulkValues=Object(i.a)({},this.initialBulkValues,e.setStore(this.oscillator.store)),e.setMixSession(this.oscillator.mixSession);var n=this.oscillator.context.getCopy();n.forFormant(this),n.forSubDevice(this),n.forTrack(this.oscillator.track),this.context=n,e.setContext(n),e.setTrack(this.oscillator.context.track),this.parameters.push(e),this.oscillator.parameters.push(e)}},{key:"input",get:function(){return this.formants.input}},{key:"output",get:function(){return this.formants.output}},{key:"initialize",value:function(){this.formantFilter||this.formantGain||(console.log("creating format nodes"),this.formantFilter=new d.a.Filter(this.formantFrequencyParameter.get(!0),this.formantType,this.rolloff),this.formantGain=this.formantFilter.output,this.setAudioParams()),this._connected||(console.log("CHIANING INIT    FORMAT"),this.input.chain(this.formantFilter,this.output),this._connected=!0),this.enabled=!0}},{key:"isEnabled",get:function(){return this.enabledParameter.get()}},{key:"bypass",value:function(){this.enabled&&(this.formantFilter&&this.formantGain&&(console.log("bypassing"),this.input.disconnect(this.formantFilter),this.formantGain.disconnect(),this._connected=!1),this.enabled=!1)}},{key:"setup",value:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(this.enabledParameter=new S.a("Formant "+(this.number+1)+" Enabled",this,function(t,n){e.enable(n)},{documentation:["When enabled, a formant filter is applied to the operator"],min:0,max:1,defaultValue:!1,automatable:!1}),this.registerParameter(this.enabledParameter),this.formantFrequencyParameter=new k.a("Formant Frequency "+(this.number+1),void 0,{min:16,max:2e4,unit:"",defaultValue:1e3*(this.number+1)}),this.registerParameter(this.formantFrequencyParameter),this.formantQParameter=new k.a("Formant Q "+(this.number+1),void 0,{min:0,documentation:["Ratio between this operator`'s frequency, and the frequency of the inputed note.","Ex: A ratio of 2 is an octave above the inputed note"],max:80,unit:"",defaultValue:20}),this.registerParameter(this.formantQParameter),this.formantGainParameter=new k.a("Formant Gain "+(this.number+1),void 0,{min:0,documentation:["Ratio between this operator`'s frequency, and the frequency of the inputed note.","Ex: A ratio of 2 is an octave above the inputed note"],max:4,unit:"",defaultValue:.5}),this.registerParameter(this.formantGainParameter),this.formantRolloffParameter=new S.a("Formant Rolloff "+(this.number+1),this,function(t,n){return e.rolloff=n},{defaultValue:-12,min:-48,max:-12,automatable:!1}),this.registerParameter(this.formantRolloffParameter),this.formantTypeParameter=new S.a("Formant Type "+(this.number+1),this,function(t,n){return e.formantType=n},{defaultValue:"bandpass",min:-48,max:-12,automatable:!1}),this.registerParameter(this.formantTypeParameter))}},{key:"formantType",get:function(){return this.formantTypeParameter?this.formantTypeParameter.get():"bandpass"},set:function(e){this.formantFilter&&(this.formantQParameter.max="lowpass"===e?12:this.formantQParameter.originalMax,this.formantFilter.type=e)}},{key:"rolloff",get:function(){return this.formantRolloffParameter?this.formantRolloffParameter.get():-12},set:function(e){this.formantFilter&&(this.formantFilter.rolloff=e)}},{key:"enable",value:function(e){e&&!this.formants.anyFormantsOn()?this.formants.enableFormants():1===this.formants.numFormants()&&!e&&this.enabled&&this.formants.disableFormants(),e?this.initialize():this.bypass()}},{key:"refreshParameters",value:function(){console.log("refresh parameters called"),this.formantFrequencyParameter.set(this.formantFrequencyParameter.get(!0)),this.formantGainParameter.set(this.formantGainParameter.get(!0)),this.formantQParameter.set(this.formantQParameter.get(!0))}},{key:"setAudioParams",value:function(){console.log("SET AUDIO PARAMS CALLED"),this.formantQParameter.setAudioParams([this.formantFilter.Q]),this.formantFrequencyParameter.setAudioParams([this.formantFilter.frequency]),this.formantGainParameter.setAudioParams([this.formantGain.gain])}},{key:"removeAudioParams",value:function(e,t){console.log("REMOVE AUDIO PARAMS CALLED"),this.formantQParameter.removeAudioParams([this.formantFilter.Q]),this.formantFrequencyParameter.removeAudioParams([this.formantFilter.frequency]),this.formantGainParameter.removeAudioParams([this.formantGain.gain]),this.formantQParameter.disableKeyScaling(),this.formantFrequencyParameter.disableKeyScaling(),this.formantGainParameter.disableKeyScaling()}},{key:"getJson",value:function(e){var t={enabled:this.enabledParameter.get(!0),frequency:this.formantFrequencyParameter.get(!0),q:this.formantQParameter.get(!0),gain:this.formantGainParameter.get(!0),effect:this.effect&&this.effect.getJson(),rolloff:this.rolloff,formantType:this.formantType};return t=Object(x.b)(t,"enabledParameter",this.enabledParameter,void 0,e),t=Object(x.b)(t,"formantFrequencyParameter",this.formantFrequencyParameter,void 0,e),t=Object(x.b)(t,"formantQParameter",this.formantQParameter,void 0,e),t=Object(x.b)(t,"formantGainParameter",this.formantGainParameter,void 0,e),t=Object(x.b)(t,"formantTypeParameter",this.formantTypeParameter,void 0,e)}},{key:"fromJson",value:function(e,t){if(window._skipFormats)return{};var n={};if(e.rolloff&&Object(w.a)(this.formantRolloffParameter,e.rolloff,n),this.formantFilter&&(this.formantFilter.rolloff=this.rolloff),Object(w.a)(this.enabledParameter,e.enabled,n),!this.enabledParameter.get(!0))return this.bypassEffect(),void this.disconnectFromAllModulators();Object(w.a)(this.formantFrequencyParameter,e.frequency,n),Object(w.a)(this.formantQParameter,e.q,n),Object(w.a)(this.formantGainParameter,e.gain,n),e.formantType?Object(w.a)(this.formantTypeParameter,e.formantType,n):Object(w.a)(this.formantTypeParameter,"bandpass",n);(new Date).getTime();e.effect?this.loadEffectFromJson(e.effect):this.bypassEffect();(new Date).getTime();return n=Object(i.a)({},n,Object(x.a)(e,"formantFrequencyParameter",this.formantFrequencyParameter,this.sequencerEngine,t,!0)),n=Object(i.a)({},n,Object(x.a)(e,"formantQParameter",this.formantQParameter,this.sequencerEngine,t,!0)),n=Object(i.a)({},n,Object(x.a)(e,"formantTypeParameter",this.formantTypeParameter,this.sequencerEngine,t,!0)),n=Object(i.a)({},n,Object(x.a)(e,"formantGainParameter",this.formantGainParameter,this.sequencerEngine,t,!0))}},{key:"disconnectParameters",value:function(){}},{key:"disconnectFromAllModulators",value:function(){console.log("disconnet from all modulators called"),this.parameters.forEach(function(e){return e.disconnectFromAllModulators()})}},{key:"ripMods",value:function(){}},{key:"isConnectedToAnyModulator",value:function(){return this.formantGainParameter.isConnectedToAnyModulator()||this.formantFrequencyParameter.isConnectedToAnyModulator()||this.formantQParameter.isConnectedToAnyModulator()}},{key:"dispose",value:function(){console.log("DISPOSING FORMANT"),this.formantFilter&&this.formantGain&&(this.parameters.forEach(function(e){return e.dispose(!0)}),this.formantFilter.dispose(),this.formantFilter=void 0),this.effect&&(this.effect.dispose(),this.effect=void 0)}},{key:"getParameters",value:function(){var e=Object(y.a)(this.parameters);return this.effect&&(e=[].concat(Object(y.a)(e),Object(y.a)(this.effect.getParameters()))),e}}]),n}(function(e){Object(u.a)(n,e);var t=j(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).effect=void 0,e}return Object(c.a)(n,[{key:"useEffect",value:function(e){this.effect&&this.effect.dispose(),this.effect=e,this.effect.registerContext(this.context),this.formantGain.disconnect(),this.formantGain.connect(this.effect.effectNode),this.effect.connect(this.output)}},{key:"bypassEffect",value:function(){this.effect&&(this.effect.parameters,this.effect.dispose(),this.effect=void 0,this.formantGain.disconnect(),this.formantGain.connect(this.output))}},{key:"loadEffectFromJson",value:function(){var e=Object(o.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.effect||t.name!==this.effect.name){e.next=4;break}this.effect.fromJson(t,[],0),e.next=9;break;case 4:return this.effect&&this.bypassEffect(),e.next=7,Object(O.b)(t,[],this.sequencerEngine,void 0,this.context);case 7:n=e.sent,this.useEffect(n.effect);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),n}(function(){return function e(){Object(s.a)(this,e)}}())),T=8,A=function(){function e(t){Object(s.a)(this,e),this.oscillator=t,this.input=new d.a.Gain(.3),this.output=new d.a.Gain(1),this.analyser=new d.a.Analyser("fft",256),this.input.connect(this.output),this.output.connect(this.analyser),this.bypassConnected=!0,this.formants=[];for(var n=0;n<T;n++)this.formants.push(new E(this,n))}return Object(c.a)(e,[{key:"dispose",value:function(){this.formants.forEach(function(e){return e.dispose()}),this.input.dispose(),this.output.dispose(),this.analyser.dispose(),this.input=void 0,this.output=void 0,this.analyser=void 0}},{key:"anyFormantsOn",value:function(){return this.formants.some(function(e){return e.enabled})}},{key:"numFormants",value:function(){return this.formants.filter(function(e){return e.enabled}).length}},{key:"enableFormants",value:function(){this.bypassConnected&&(this.input.disconnect(this.output),this.bypassConnected=!1)}},{key:"disableFormants",value:function(){this.bypassConnected||(this.input.connect(this.output),this.bypassConnected=!0)}}]),e}();function M(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var N=n(127).a.presets;t.a=function(e){return function(e){Object(u.a)(n,e);var t=C(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"loadFormantsPreset",value:function(){var e=Object(o.a)(a.a.mark(function e(t){var n,r,o,s,c,u,l,f,h,d,y,b,O,j,k,w,x,S,P;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.contentHash,e.next=3,p.a.getJson(n);case 3:if(r=e.sent,Array.isArray(r)&&(r={formants:r}),this.preset=new m.a,this.preset.contentHash=n,!(o=this.instrument)){e.next=16;break}return s=o.ampEnvelope.release,o.ampEnvelope.release=100,o.clearVoiceData(),o.loaded=!1,o.track.trackIsLoading=!0,e.next=16,Object(v.a)(100);case 16:if(c={},u=o?o.track.lfosTrack:this.sequencerEngine.currentSubSequence.lfosTrack,l=o?o.track.envelopesTrack:this.sequencerEngine.currentSubSequence.envelopesTrack,r.lfos){f=0,h=M(u.lfos);try{for(h.s();!(d=h.n()).done;)y=d.value,b=y.lfo,c=Object(i.a)({},c,b.fromJson(r.lfos[f++],!0))}catch(a){h.e(a)}finally{h.f()}}if(!r.envelopes){e.next=41;break}O=0,j=M(l.envelopes),e.prev=23,j.s();case 25:if((k=j.n()).done){e.next=33;break}if(w=k.value,x=w.envelope,!window.sporeEditor||0!==O){e.next=30;break}return e.abrupt("continue",31);case 30:c=Object(i.a)({},c,x.fromJson(r.envelopes[O++],!0));case 31:e.next=25;break;case 33:e.next=38;break;case 35:e.prev=35,e.t0=e.catch(23),j.e(e.t0);case 38:return e.prev=38,j.f(),e.finish(38);case 41:for(S=0;S<this.formants.length;S++)P=this.formants[S],c=Object(i.a)({},c,P.fromJson(r.formants[S],!0));(o?o.track:this.track).sequencerEngine.dispatch(Object(g.xb)(c)),o&&(o.loaded=!0,o.track.trackIsLoading=!1,o.ampEnvelope.release=s);case 45:case"end":return e.stop()}},e,this,[[23,35,38,41]])}));return function(t){return e.apply(this,arguments)}}()},{key:"saveFormantsAsPreset",value:function(e){var t=this,n={envelopes:this.instrument.track.envelopesTrack.envelopes.map(function(e){return e.getJson()}),lfos:this.instrument.track.lfosTrack.lfos.map(function(e){return e.getJson()}),formants:this.formantsManager.formants.map(function(e){return e.getJson(!0)})};N.newPreset(n,e,void 0,"formants",0).then(function(n){t.preset=new m.a,t.preset.contentHash=n,t.preset.name=e})}},{key:"formants",get:function(){return this.formantsManager.formants}},{key:"setupFormants",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.formantsManager=new A(this)}},{key:"initializeFormants",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.voices}},{key:"copyFormants",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},{key:"voiceHasFormant",value:function(e){return void 0!==e.formantFilters}},{key:"destroyFormants",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],!(arguments.length>1&&void 0!==arguments[1])||arguments[1],!(arguments.length>2&&void 0!==arguments[2])||arguments[2]}},{key:"getFormantsJson",value:function(e){return this.formants.map(function(t){return t.getJson(e)})}},{key:"loadFormantsJson",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;if(this.formants.forEach(function(e){return e.ripMods()}),d.a.Master.context.isOffline){var r={};for(var a in e)r=Object(i.a)({},r,this.formants[a].fromJson(e[a],t));return r}var o={},s=[];for(var c in e)s.push(this.formants[c]),n/100>=Math.random()&&(o=Object(i.a)({},o,this.formants[c].fromJson(e[c],t)));return this.formants.filter(function(e){return!s.includes(e)}).forEach(function(e){e.bypassEffect(),e.bypass()}),o}}]),n}(e)}},function(e,t,n){"use strict";var r=n(11),a=n(3),i=n.n(a),o=n(108),s=n(133),c=n(176),u=n(55),l=Object(u.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.envelope,n=e.lfo,r=e.parameter,u=e.sequencerEngine,l=e.keyScaling,f=Object(a.useRef)(void 0),h=Object(a.useRef)(0),d=Object(a.useState)(!1),p=Object(o.a)(d,2),v=p[0],m=p[1],y=Object(a.useState)(!1),b=Object(o.a)(y,2),g=b[0],O=b[1],j=Object(a.useState)(r.min),k=Object(o.a)(j,2),w=k[0],x=k[1],S=Object(a.useState)(r.max),P=Object(o.a)(S,2),E=P[0],T=P[1],A=function(e){var t=e.parameter,n=e.lfo,r=e.envelope,a=(e.sequencerEngine,e.keyScaling),i=e.zoomMin,o=e.zoomMax,s=a||t.getParameterMod(r||n);if(s.scale||a){var c=o-i,u=(Math.min(s.min,s.max)-i)/c,l=(Math.max(s.min,s.max)-i)/c-u;u<0?u=0:u>1&&(u=1);var f={marginLeft:100*u+"%",width:100*l+"%"},h="modulator-indicator",d=0,p="modulator-thumb ";return n?(p+=" lfo-"+(d=t.availableLFOs.indexOf(n))+" toggled",h+=" lfo-"+d+" toggled"):r?(h+=" lfo-"+(d=t.availableEnvelopes.indexOf(r))+" toggled",p+=" lfo-"+d+" toggled env"):a&&(p+=" key-scaling",h+=" key-scaling"),{style:f,className:h,mod:s,num:d,thumbClass:p}}}({parameter:r,envelope:t,lfo:n,sequencerEngine:u,keyScaling:l,zoomMin:w,zoomMax:E}),M=Object(a.useState)(A&&A.mod.min),R=Object(o.a)(M,2),C=R[0],N=R[1],I=Object(a.useState)(A&&A.mod.max),q=Object(o.a)(I,2),_=q[0],D=q[1],F=A&&A.mod,L=Object(a.useCallback)(function(){(g||v)&&(O(!1),m(!1))},[g,v,O,m]),B=Object(a.useCallback)(function(e){if(g||v){var t=f.current.getBoundingClientRect(),n=e.clientX-t.left,r=t.width,a=w+n/r*(E-w);g?(F.min=a,N(a)):(F.max=a,D(a))}},[B,r,F,g,v,N,D,w,E]),z=function(e){return F.max-F.min>=1e3?Math.round(e):F.max-F.min>=100?Math.round(10*e)/10:Math.round(1e4*e)/1e4},J=Object(a.useCallback)(function(){var e=(_+E)/2;x((C+w)/2),T(e)},[x,T,C,_,w,E]),V=Object(a.useCallback)(function(e){var t=(new Date).getTime();if(t-h.current<=300)J();else{h.current=t;var n=f.current.getBoundingClientRect(),r=e.clientX-n.left,a=n.width;w+r/a*(E-w)>(F.max+F.min)/2?m(!0):O(!0)}},[F,O,m,w,E,x,T,_,C]),H=Object(a.useCallback)(function(e){if(u.state.keyboard.isCommandDown){var t=F.min,n=F.max;F.min=n,F.max=t,N(n),D(t)}L(e)},[N,D,g,v,O,m]);if(!A)return i.a.createElement("div",null);var U=A.style,G=A.className,W=(A.num,A.thumbClass,"modulator-control ");return l&&(W+=" key-scaling-control"),i.a.createElement(c.a,{className:"modulator-control-container",element:s.m},i.a.createElement("div",{draggable:!0,onDragStart:function(e){return e.preventDefault()},ref:f,onMouseUp:H,onMouseDown:V,onMouseMove:B,onMouseLeave:L,className:W},i.a.createElement("div",{className:G,style:U},i.a.createElement("div",{onMouseDown:function(e){e.stopPropagation(),F.min<F.max?O(!0):m(!0)},className:F.min<F.max?"small left-edge":"big left-edge"}),i.a.createElement("div",{onMouseDown:function(e){e.stopPropagation(),F.min<F.max?m(!0):O(!0)},className:F.min<F.max?"big right-edge":"small right-edge"})),i.a.createElement("div",{className:"mod-number"},g?"Min: "+z(F.min):v?"Max: "+z(F.max):"")))});n(1787),t.a=Object(u.b)(function(e,t){return t.parameter?{lfos:t.parameter.lfos,envs:t.parameter.envelopes,keyScaling:t.parameter.keyScaling}:{}},function(e){return{}})(function(e){var t=e.parameter,n=e.sequencerEngine;if(!n||!t||!t.lfos||!t.envelopes)return[];var a=Object(r.a)(t.lfos);a.sort(function(e,t){return e.number-t.number});var o=Object(r.a)(t.envelopes);return o.sort(function(e,t){return e.number-t.number}),i.a.createElement("div",{className:"modulator-controls"},a.map(function(e){return i.a.createElement(l,{key:e.number,sequencerEngine:n,lfo:e,parameter:t})}),o.map(function(e){return i.a.createElement(l,{key:e.number,sequencerEngine:n,envelope:e,parameter:t})}),t.keyScaling?i.a.createElement(l,{sequencerEngine:n,keyScaling:t.keyScaling,parameter:t}):"")})},function(e,t,n){"use strict";var r=n(1),a=n(42),i=n.n(a),o=n(56),s=n(4),c=n(5),u=n(539),l=n.n(u),f=n(206),h=n(159),d=n(23),p=n(540),v=n(127),m=function(){function e(t){Object(s.a)(this,e),this.store=t,this.masterKey=void 0,this.masterPublicKey=void 0,this.promptingPassword=!1}return Object(c.a)(e,[{key:"needsPassword",value:function(){return void 0===this.masterPublicKey}},{key:"password",set:function(e){void 0!==e&&(this.masterKey=l.a.generateRSAKey(e,1024),this.masterPublicKey=l.a.publicKeyString(this.masterKey),h.a.getAccount().then(function(t){window.isNFT||f.a.setItem("user_password."+t,e)}))}},{key:"isCorrectPassword",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r,a,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.encryption.getPublicKey();case 2:if(void 0!==(n=e.sent)){e.next=5;break}return e.abrupt("return",!0);case 5:return r=l.a.generateRSAKey(t,1024),a=l.a.publicKeyString(r),o=n===a,e.abrupt("return",o);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"syncPassword",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.masterPublicKey){e.next=4;break}return e.next=3,this.getPassword();case 3:this.password=e.sent;case 4:t=this.getPublicKeyAsBytes32(),v.a.encryption.newPublicKey(t);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPublicKeyAsBytes32",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.masterPublicKey,t=v.a.web3.utils.toHex(e);return Object(p.a)(t)}},{key:"sleep",value:function(e){return new Promise(function(e,t){e()},e)}},{key:"getPassword",value:function(){var e=this;return this.passwordPromise?this.passwordPromise:(this.passwordPromise=new Promise(function(){var t=Object(o.a)(i.a.mark(function t(n,r){var a,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===e.masterPublicKey){t.next=3;break}return n(void 0),t.abrupt("return");case 3:return t.next=5,h.a.getAccount();case 5:if(a=t.sent,window.isNFT||null===f.a.getItem("user_password."+a)){t.next=12;break}if(o=f.a.getItem("user_password."+a),!e.isCorrectPassword(o)){t.next=12;break}return e.password=o,n(o),t.abrupt("return");case 12:e.store.dispatch(Object(d.Kc)(function(t){void 0!==t?(e.password=t,n(t)):e.passwordPromise=void 0})),e.store.dispatch(Object(d.Vd)(!0));case 14:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()),this.passwordPromise)}},{key:"getPublicKeyIfNeeded",value:function(){var e=Object(o.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=6;break}if(void 0!==this.masterPublicKey){e.next=5;break}return e.next=4,this.getPassword();case 4:this.password=e.sent;case 5:t=this.masterPublicKey;case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPrivateKeyIfNeeded",value:function(){var e=Object(o.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=6;break}if(void 0!==this.masterKey){e.next=5;break}return e.next=4,this.getPassword();case 4:this.password=e.sent;case 5:t=this.masterKey;case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),y=n(608),b=n(541),g=n.n(b),O=n(122),j=function(){function e(t,n){Object(s.a)(this,e),this.ethereum=t,this.web3=this.ethereum.web3,this.passwordManager=new m(n),this.store=n}return Object(c.a)(e,[{key:"store",set:function(e){this.passwordManager.store=e}},{key:"needsPassword",value:function(){return this.passwordManager.needsPassword()}},{key:"password",set:function(e){this.passwordManager.password=e}},{key:"syncPassword",value:function(){var e=Object(o.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.passwordManager.syncPassword();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isCorrectPassword",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.passwordManager.isCorrectPassword(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPassword",value:function(){var e=Object(o.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.passwordManager.getPassword();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"masterPublicKey",get:function(){return this.passwordManager.masterPublicKey},set:function(e){this.passwordManager.masterPublicKey=e}},{key:"masterKey",get:function(){return this.passwordManager.masterKey}},{key:"parseGuildKey",value:function(e){var t=e.privateKey,n=l.a.RSAKey.parse(JSON.stringify(t));return Object(r.a)({},e,{privateKey:n})}},{key:"generateGuildKey",value:function(e){var t=l.a.generateRSAKey(e,1024),n=l.a.publicKeyString(t),r=this.ethereum.web3.utils.toHex(n);return{publicKey:Object(p.a)(r),rawPublicKey:n,privateKey:t,passphrase:e}}},{key:"encryptAndSave",value:function(e,t,n){var r=this;!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Promise(function(){var a=Object(o.a)(i.a.mark(function a(s,c){var u,l,f;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,r.passwordManager.getPublicKeyIfNeeded(r.masterPublicKey);case 2:if(a.sent,(u=new y.a).encryptKey(r.masterPublicKey),!n){a.next=10;break}return a.next=8,r.ethereum.encryption.getEncryptedSequenceIfAny(n);case 8:void 0!==(l=a.sent)&&l[0].contentKey&&(u=new y.a(g.a.utils.hex.toBytes(u)));case 10:return a.next=12,u.encryptContent(JSON.stringify(t));case 12:f=a.sent,O.a.addJson(f).then(function(){var t=Object(o.a)(i.a.mark(function t(a){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=r.ethereum.encryption,t.t1=n,t.t2=a,t.next=5,u.encryptContent(e);case 5:t.t3=t.sent,t.t4=u.convertForEthereum(),t.t5=r.passwordManager.getPublicKeyAsBytes32(),t.t0.newEncryptedSequence.call(t.t0,t.t1,t.t2,t.t3,t.t4,t.t5),s(a);case 10:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 14:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"encryptRawContent",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a,o,s=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:this.masterPublicKey,a=s.length>3&&void 0!==s[3]&&s[3],o=s.length>4?s[4]:void 0,e.next=5,this.passwordManager.getPublicKeyIfNeeded(r);case 5:return r=e.sent,void 0===o&&(o=new y.a),o.encryptKey(r),e.t0=this.passwordManager.getPublicKeyAsBytes32(r),e.t1=o.convertForEthereum(),e.t2=o,e.next=13,o.encryptContent(t,a);case 13:return e.t3=e.sent,e.next=16,o.encryptContent(n);case 16:return e.t4=e.sent,e.t5=o.encryptedContentKey,e.abrupt("return",{publicKey:e.t0,encryptedContentKey:e.t1,contentKey:e.t2,encryptedContent:e.t3,encryptedName:e.t4,eCk:e.t5});case 19:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"encryptAndUploadJSON",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.masterPublicKey;return new Promise(function(){var r=Object(o.a)(i.a.mark(function r(a,o){var s;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.encryptRawContent(JSON.stringify(e),"",n);case 2:s=r.sent,O.a.addJson(s.encryptedContent).then(function(e){return a({publicKey:s.publicKey,encryptedContentKey:s.encryptedContentKey,encryptedContentIpfsHash:e,contentKey:s.contentKey})});case 4:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"decryptName",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n,r){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t&&void 0!==t){e.next=2;break}return e.abrupt("return","");case 2:return e.next=4,this.passwordManager.getPrivateKeyIfNeeded(r);case 4:return r=e.sent,g.a.utils.hex.toBytes(t),e.next=8,this.decryptContentKey(n,r);case 8:if(void 0!==(a=e.sent)){e.next=11;break}return e.abrupt("return","");case 11:return e.next=13,a.decryptContent(t);case 13:return t=e.sent,e.abrupt("return",t);case 15:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"decryptContentKey",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.passwordManager.getPrivateKeyIfNeeded(n);case 2:if(n=e.sent,r=this.web3.utils.toAscii("0x"+t),"failure"!==(a=l.a.decrypt(r,n)).status){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.abrupt("return",new y.a(a.plaintext));case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchAndDecrypt",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a,o,s,c,u,l=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>2&&void 0!==l[2]&&l[2],a=l.length>3?l[3]:void 0,new Date,void 0!==n.length&&(n=n[0]),o=n.contentKey,!r){e.next=11;break}return e.next=8,O.a.getSound(t);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,O.a.getJson(t,void 0,a,!0);case 13:e.t0=e.sent;case 14:return s=e.t0,e.next=17,this.passwordManager.getPrivateKeyIfNeeded();case 17:return c=new y.a(o),e.next=20,c.decryptContent(s,r);case 20:return u=e.sent,e.abrupt("return",u);case 22:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"stripHexPrefix",value:function(e){return 0===e.indexOf("0x")?e.slice(2):e}},{key:"strip",value:function(e,t){return e.slice(0,e.length-t)}},{key:"getPublicKeyFromBytes32",value:function(e){var t="0x";for(var n in e)t+=this.stripHexPrefix(e[n]);return t=this.strip(t,38),this.ethereum.web3.utils.toAscii(t)}},{key:"shareSequence",value:function(e,t){var n=this;return new Promise(function(){var r=Object(o.a)(i.a.mark(function r(a,o){var s,c;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.ethereum.encryption.getPublicKey(t);case 2:if(void 0!==(s=r.sent)){r.next=6;break}return o("User has no public key"),r.abrupt("return");case 6:c=l.a.encrypt(e.contentKey,s).cipher,c=n.web3.utils.toHex(c),n.ethereum.encryption.shareEncryptedContent(t,e.id,Object(p.a)(c),n.passwordManager.getPublicKeyAsBytes32()),a();case 10:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}}]),e}();t.a=j},function(e,t,n){"use strict";var r=n(1),a=n(42),i=n.n(a),o=n(56),s=n(4),c=n(5),u=n(537),l=n(437),f=n(838),h=(n(272),n(157)),d=n(149),p=n(122),v=n(153);function m(e,t){var n=new Set,r=Array.from(e);for(var a in r)t.has(r[a])&&n.add(r[a]);return n}var y=n(142),b=n(119),g=n(162),O=(window.web3,new u.a),j=g.a.utils.padLeft("0x0",64),k=function(){function e(t,n,r){Object(s.a)(this,e),this.web3=t,this.contract=new t.eth.Contract(O.abi,O.contractAddress),this.crypto=n,this.guilds=r,this.queryDecryptor=new f.a(this.crypto)}return Object(c.a)(e,[{key:"getPresetData",value:function(){var e=Object(o.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=4;break}return e.next=3,p.a.getJson(t);case 3:return e.abrupt("return",e.sent);case 4:if(0!==t.guildId&&null!==t.guildId&&void 0!==t.guildId){e.next=8;break}return e.next=7,p.a.getJson(t.contentHash);case 7:return e.abrupt("return",e.sent);case 8:return e.t0=JSON,e.next=11,this.crypto.fetchAndDecrypt(t.contentHash,t);case 11:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPresetTitle",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new y.a(this.contract.options.address).from(b.B).select("encryptedName").where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(r=e.sent).length){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",this.web3.utils.toAscii("0x"+r[0].encryptedName));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newPreset",value:function(e,t,n,r,a){var s=this;O.getContract(g.a);return Object(l.a)(),new Promise(function(){var c=Object(o.a)(i.a.mark(function o(c,u){var l,f,m,y,b;return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(l=void 0,f=new Array(9).fill(j),m=new Array(6).fill(j),0===a){i.next=18;break}return i.next=6,s.guilds.getGuildKey(a);case 6:return y=i.sent,i.next=9,s.crypto.encryptRawContent(JSON.stringify(e),t,y.rawPublicKey);case 9:return b=i.sent,i.next=12,p.a.addJson(b.encryptedContent);case 12:l=i.sent,t=s.web3.utils.padLeft("0x"+b.encryptedName,64),f=b.encryptedContentKey,m=y.publicKey,i.next=22;break;case 18:return t=s.web3.utils.fromAscii(t),i.next=21,p.a.addJson(e);case 21:l=i.sent;case 22:n=void 0===n?j:Object(v.b)(n),r=void 0===r?j:g.a.utils.fromAscii(r),console.log("newPreset guildId =",a),new h.a(d.h,"newPreset",[Object(v.b)(l),t,n,r,a,f,m]).execute(),c(l);case 27:case"end":return i.stop()}},o)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"tagPreset",value:function(e,t,n){null!==n&&void 0!==n||(n=0);O.getContract(g.a);return new Promise(function(){var r=Object(o.a)(i.a.mark(function r(a,o){var s;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:for(s=t.map(function(e){return g.a.utils.padRight(g.a.utils.fromAscii(e),64)});s.length<4;)s.push(j);s.length>4&&(s=s.slice(0,4)),new h.a(d.h,"tagPreset",[Object(v.b)(e),s,n]).execute().then(function(){return a()});case 4:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getTotalPresets",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new y.a(this.contract.options.address).from(b.B).select("user").select("title").select("contentHash"),e.next=3,t.executeQuery();case 3:return n=e.sent,e.abrupt("return",n.length);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPresets",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPaginatedPresets(0,t,1e3,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPaginatedPresets",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var a,o,s,c,u,l,f,h=this,d=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=d.length>2&&void 0!==d[2]?d[2]:10,o=d.length>3&&void 0!==d[3]?d[3]:0,s=new y.a(this.contract.options.address).from(b.B).select("user").select("encryptedName").select("contentHash").select("encryptedContentKey").select("publicKey").select("guildId").where("guildId",o),e.next=5,s.executeQuery();case 5:if(c=e.sent,this.isFilterEmpty(n)){e.next=10;break}return e.next=9,this.filterPresets(c,n);case 9:c=e.sent;case 10:if(0===o){e.next=28;break}return e.next=13,this.guilds.getGuildKey(o);case 13:u=e.sent,l=[],e.t0=i.a.keys(c);case 16:if((e.t1=e.t0()).done){e.next=25;break}return f=e.t1.value,e.t2=l,e.next=21,this.queryDecryptor.decryptQueryResult(c[f],u.privateKey);case 21:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=16;break;case 25:c=l,e.next=29;break;case 28:c=c.map(function(e){return Object(r.a)({},e,{title:h.web3.utils.toAscii("0x"+e.encryptedName)})});case 29:if(!(c.length<=t+a)){e.next=31;break}return e.abrupt("return",c.slice(t));case 31:return e.abrupt("return",c.slice(t,t+a));case 32:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"isFilterEmpty",value:function(e){for(var t in e.instrumentTypes)if(e.instrumentTypes[t])return!1;for(var n in e.tags)if(e.tags[n])return!1;return!0}},{key:"getPresetSampleHash",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new y.a(this.contract.options.address).from(b.L).select("sampleHash").where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(r=e.sent).length){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",r[0].sampleHash);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPresetInstrumentType",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new y.a(this.contract.options.address).from(b.K).select("instrumentType").where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(r=e.sent).length){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",r[0].instrumentType);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllTags",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r,a,o,s,c=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:0,!this.isFilterEmpty(t)){e.next=5;break}return e.next=4,this.getFilteredTags(void 0,void 0,n);case 4:return e.abrupt("return",e.sent);case 5:return e.next=7,this.getPresets(t,n);case 7:r=e.sent,a=[],e.t0=i.a.keys(r);case 10:if((e.t1=e.t0()).done){e.next=18;break}return o=e.t1.value,e.next=14,this.getTags(r[o].contentHash);case 14:(s=e.sent)&&(a=a.concat(s)),e.next=10;break;case 18:return e.abrupt("return",Array.from(new Set(a)));case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getFilteredTags",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a,o,s=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:0,a=new y.a(this.contract.address).from(b.M).where("guildId",r).select("tag"),void 0!==n&&a.where(t,n),e.next=5,a.executeQuery();case 5:return o=(o=e.sent).map(function(e){return e.tag}).filter(function(e){return""!==e}),e.abrupt("return",Array.from(new Set(o)));case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTags",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new y.a(this.contract.address).from(b.M).select("tag").where("contentHash",t),e.next=3,n.executeQuery();case 3:return(r=(r=e.sent).map(function(e){return e.tag}).filter(function(e){return""!==e})).sort(),e.abrupt("return",Array.from(new Set(r)));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"filterPresets",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a,o,s,c,u,l,f,h,d,p,v,g,O,j;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new Set,a=new Set,!n.instrumentTypes){e.next=15;break}e.t0=i.a.keys(n.instrumentTypes);case 4:if((e.t1=e.t0()).done){e.next=15;break}if(o=e.t1.value,n.instrumentTypes[o]){e.next=8;break}return e.abrupt("continue",4);case 8:return s=new y.a(this.contract.address).from(b.K).select("contentHash").where("instrumentType",o),e.next=11,s.executeQuery();case 11:for(u in c=e.sent)for(f in l=c[u].contentHash,t)t[f].contentHash===l&&r.add(t[f].contentHash);e.next=4;break;case 15:if(!n.tags){e.next=28;break}e.t2=i.a.keys(n.tags);case 17:if((e.t3=e.t2()).done){e.next=28;break}if(h=e.t3.value,n.tags[h]){e.next=21;break}return e.abrupt("continue",17);case 21:return d=new y.a(this.contract.address).from(b.M).select("contentHash").where("tag",h),e.next=24,d.executeQuery();case 24:for(v in p=e.sent)for(O in g=p[v].contentHash,t)t[O].contentHash===g&&a.add(t[O].contentHash);e.next=17;break;case 28:if(0!==r.size){e.next=32;break}return e.abrupt("return",this.convertToPresets(Array.from(a),t));case 32:if(0!==a.size){e.next=34;break}return e.abrupt("return",this.convertToPresets(Array.from(r),t));case 34:return j=Array.from(m(r,a)),e.abrupt("return",this.convertToPresets(j,t));case 36:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"convertToPresets",value:function(e,t){var n=[];for(var r in e)for(var a in t)t[a].contentHash===e[r]&&n.push(t[a]);return n}},{key:"getAllUserAddresses",value:function(){var e=Object(o.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=k},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(1),s=n(11),c=n(4),u=n(5),l=function e(){Object(c.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sampleIpfs",type:"bytes32"},{name:"notes",type:"bytes32[32]"},{name:"startTime",type:"uint32"},{name:"endTime",type:"uint32"},{name:"noteSequenceIpfs",type:"bytes32"}],name:"newNoteSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleIpfs",type:"bytes32"},{name:"notes",type:"bytes32[256]"},{name:"startTimes",type:"uint32[8]"},{name:"endTimes",type:"uint32[8]"},{name:"noteSequenceIpfs",type:"bytes32"}],name:"newNoteSequenceLarge",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"noteSequenceIpfs",type:"bytes32"}],name:"NewNoteSequence",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"noteA",type:"bytes32"},{indexed:!0,name:"noteB",type:"bytes32"},{indexed:!1,name:"startTime",type:"uint32"},{indexed:!1,name:"endTime",type:"uint32"},{indexed:!1,name:"remainingNotes",type:"bytes32"}],name:"NewNotesAggregation",type:"event"}],this.contractAddress="0x3edab21966363a5c9d69ba0ed78abc5b9c6007c5"},f=n(221),h=n(357),d=n(122),p=n(119),v=n(171),m=new l,y=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"convertToNotes",value:function(e){return e=e.filter(function(e){return void 0!==e}).filter(function(e){return void 0!==e.pitch}).map(function(e){return{note:v.a.fromTranspose(e.pitch-60).note,startTime:e.startTime,endTime:e.endTime}})}},{key:"getChordsFromSequence",value:function(e,t){var n=this;e.sort(function(e,t){return e.startTime-t.startTime}),e=this.convertToNotes(e);for(var r=[],a=0;a<e.length;a++){var i=e[a],c=Object(s.a)(t),u=[];if(i.note===c[0]){for(var l=a;l<e.length&&0!=c.length;l++){var f=c[0];if(f===e[l].note){c=c.slice(1),u.push(e[l]);for(var h=l,d=l+1;d<e.length&&f==e[d].note;d++)u.push(e[d]),h=d;l=h}else u.push(null)}0==c.length&&r.push(u)}}var p=(r=r.map(function(e){return n.pruneTrailingNulls(e)})).filter(function(e){return e.filter(function(e){return null===e}).length<=.5*e.length}).filter(function(e){return e.length>0}).map(function(e){return{startTime:e[0].startTime,endTime:e[e.length-1].endTime}}).map(function(t){return Object(o.a)({},t,{density:n.calculateDensityForSlice(t,e)})}),v=[],m=function(e){var t=p[e];p.filter(function(e){return t.startTime>e.startTime&&t.endTime<=e.endTime}).length>0||v.push(t)};for(var y in p)m(y);return v}},{key:"calculateDensityForSlice",value:function(e,t){var n=t.filter(function(t){return t.startTime>=e.startTime&&t.startTime<=e.endTime||t.endTime>=e.startTime&&t.endTime<=e.endTime}),r=e.endTime-e.startTime;return n.length/r}},{key:"pruneTrailingNulls",value:function(e){var t=[];for(var n in e){if(e.slice(n).every(function(e){return null===e}))break;t.push(e[n])}return t}},{key:"getNoteSequence",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(new f.a).from(p.y).select("noteSequenceHash").where("sampleHash",t).executeQuery();case 2:if(0!=(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return r=n[0].noteSequenceHash,e.next=8,d.a.getJson(r);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchRankedNotes",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f,h,d,p,v,m,y,b,g,O,j,k,w,x;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.searchNotes(t);case 2:n=e.sent,r=[],e.t0=a.a.keys(n);case 5:if((e.t1=e.t0()).done){e.next=20;break}for(u in i=e.t1.value,o=n[i],s=o.remainingNotes,c=100,t)l=t[u],f=s.slice(u),-1==(h=f.indexOf(l))?c-=1/t.length*200:h>0&&(c-=5*h);if(d=s.length,p=o.startTime/1e3,v=o.endTime/1e3,m=d/(v-p),!(c<80)){e.next=17;break}return e.abrupt("continue",5);case 17:r.push({score:c,density:m,result:o}),e.next=5;break;case 20:r.sort(function(e,t){return e.density-t.density}),y={},e.t2=a.a.keys(r);case 23:if((e.t3=e.t2()).done){e.next=36;break}if(b=e.t3.value,!(r[b].score<=80)){e.next=27;break}return e.abrupt("continue",23);case 27:g=r[b].result,O=g.sampleHash,j=g.remainingNotes,k=g.startTime,w=g.endTime,x={startTime:k,endTime:w,remainingNotes:j},O in y?y[O].push(x):y[O]=[x],e.next=23;break;case 36:return e.abrupt("return",y);case 37:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getStartTimesForSample",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){new f.a(m.contractAddress).from(p.z).select("startTime").where("sampleHash",t).executeQuery().then(function(t){return e(t)})}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchNotes",value:function(e){return new Promise(function(t,n){if(0!=e.length){var r=e.map(function(e){return h.b[e]}),a=new f.a(m.contractAddress).from(p.z).select("sampleHash").select("noteA").select("noteB").select("remainingNotes").select("startTime").select("endTime").where("noteA",r[0]);e.length>1&&(a=a.where("noteB",r[1])),a.executeQuery().then(function(e){return t(e)})}else t()})}}]),e}();t.a=y},function(e,t,n){"use strict";var r=n(108),a=n(1),i=n(4),o=n(5),s=n(10),c=n(7),u=n(8),l=n(2);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var h=function(e){Object(c.a)(n,e);var t=f(n);function n(e){var a;return Object(i.a)(this,n),a=t.call(this,e),e.newAttribute("overflow","visible"),a._scale="Lydian mode",a.newInlet("scale by name",function(e){var t=Object(r.a)(e,1)[0];return a.byName(t)}),a.newInlet("scale by index",function(e){var t=Object(r.a)(e,1)[0];return a.byIndex(t)}),a.newOutlet("integer scale"),a.newOutlet("scale name"),a}return Object(o.a)(n,[{key:"bang",value:function(){this.byName(this._scale)}},{key:"byName",value:function(e){var t=p[e];t&&(this._scale=e,this.sendMessage("integer scale",t),this.sendMessage("scale name",e))}},{key:"byIndex",value:function(e){var t=Object.keys(p),n=t[e%t.length],r=p[n];r&&(this._scale=n,this.sendMessage("integer scale",r),this.sendMessage("scale name",n))}},{key:"fromJson",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];(t=Object(s.a)(Object(l.a)(n.prototype),"fromJson",this)).call.apply(t,[this,e].concat(a)),this._scale=e.scale}},{key:"getJson",value:function(e){for(var t,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return Object(a.a)({},(t=Object(s.a)(Object(l.a)(n.prototype),"getJson",this)).call.apply(t,[this,e].concat(i)),{scale:this._scale})}}]),n}(n(117).a),d=n(109);n.d(t,"a",function(){return p}),n.d(t,"b",function(){return v});var p={"Acoustic scale":[0,2,4,6,7,9,10],"Natural minor scale":[0,2,3,5,7,8,10],"Algerian scale":[0,2,3,6,7,9,11,12,14,15,17],"Super Locrian scale":[0,1,3,4,6,8,10],"Augmented scale":[0,3,4,7,8,11],"Bebop dominant scale":[0,2,4,5,7,9,10,11],"Blues scale":[0,3,5,6,7,10],"Chromatic scale":[0,1,2,3,4,5,6,7,8,9,10,11],"Dorian scale":[0,2,3,5,7,9,10],"Double harmonic scale":[0,1,4,5,7,8,11],"Enigmatic scale":[0,1,4,6,8,10,11],"Flamenco scale":[0,1,4,5,7,8,11],"Gypsy scale":[0,2,3,6,7,8,10],"Half diminished scale":[0,2,3,5,6,8,10],"Harmonic major scale":[0,2,4,5,7,8,11],"Harmonic minor scale":[0,2,3,5,7,8,11],"Hirajoshi scale":[0,4,6,7,11],"Hungarian minor scale":[0,2,3,6,7,8,11],"Hungarian major scale":[0,3,4,6,7,9,10],"In scale":[0,1,5,7,8],"Insen scale":[0,1,5,7,10],"Major scale":[0,2,4,5,7,9,11],"Istrian scale":[0,1,3,4,6,7],"Iwato scale":[0,1,5,6,10],"Locrian scale":[0,1,3,5,6,8,10],"Lydian augmented scale":[0,1,3,5,6,8,10],"Lydian mode":[0,2,4,6,7,9,11],"Major Locrian scale":[0,2,4,5,6,8,10],"Major pentatonic scale":[0,2,4,7,9],"Melodic minor scale":[0,2,3,5,7,9,11],"Minor pentatonic scale":[0,3,5,7,10],"Mixolydian mode":[0,2,4,5,7,9,10],"Neapolitan major scale":[0,1,3,5,7,9,11],"Neapolitan minor scale":[0,1,3,5,7,8,11],"Octatonic scale":[0,2,3,5,6,8,9,11],"Persian scale":[0,1,4,5,6,8,11],"Phyrgian dominant scale":[0,1,4,5,7,8,10],"Phyrgian mode":[0,1,3,5,7,8,10],"Prometheus scale":[0,2,4,6,9,10],"Scale of harmonics":[0,3,4,5,7,9],"Tritone scale":[0,1,4,6,7,10],"Two-semitone tritone scale":[0,1,2,6,7,8],"Ukranian Dorian scale":[0,2,3,6,7,9,10],"Vietnamese scale of harmonics":[0,2.5,3,4,5,7],"Whole tone scale":[0,2,4,6,8,10],"Yo scale":[0,3,5,7,10]};Object(d.a)("scale",{},"search for scales",function(){return 0},{inlets:0});var v=function(e){var t=new h(e);return e.width=220,e.height=30,e.needsLoad=!0,function(e){Object(r.a)(e,1)[0];t.bang()}}},function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(4),o=n(5),s=n(10),c=n(7),u=n(8),l=n(2),f=n(424),h=n(43),d=n(123),p=n(383),v=n(182),m=n(380);function y(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var O=6,j=function(e){Object(c.a)(n,e);var t=g(n);function n(e){var r;Object(i.a)(this,n),(r=t.call(this,"Macros",v.c,e)).macros=[];for(var a=0;a<O;a++)r.newMacro();return r.randomness=15,r}return Object(o.a)(n,[{key:"getParameters",value:function(){return this.macros.map(function(e){return e.macroParameter})}},{key:"newMacro",value:function(){this.macros.push(new p.a("Macro "+(this.numMacros+1),this.track.sequencerEngine,this.context))}},{key:"context",get:function(){return(new d.a).forLiveEffect(this).forTrack(this.track)}},{key:"numMacros",get:function(){return this.macros.length}},{key:"getJson",value:function(){var e=Object(s.a)(Object(l.a)(n.prototype),"getJson",this).call(this);return Object(a.a)({},e,{macros:this.macros.map(function(e){return e.getJson()})})}},{key:"getLFOParameters",value:function(){return[]}},{key:"fromJson",value:function(e){Object(s.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e),this.ripMods();var t=[].concat(Object(r.a)(this.track.getAllParameters()),Object(r.a)(this.getLFOParameters()));for(var a in this.macros)this.macros[a].fromJson(e.macros[a],t)}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson()),t}},{key:"dispose",value:function(){this.macros.forEach(function(e){return e.unmapAllParameters()}),this.macros=void 0}},{key:"ripMods",value:function(){this.macros.forEach(function(e){return e.ripMods()})}},{key:"generateMappings",value:function(){this.macros.forEach(function(e){return e.unmapAllParameters()});var e=[].concat(Object(r.a)(this.track.effectsChain.getAllParameters()),Object(r.a)(this.track.midiEffects.getAllParameters()),Object(r.a)(this.getLFOParameters()));this.track.instrument&&(e=[].concat(Object(r.a)(e),Object(r.a)(this.track.instrument.getParameters())));var t,n=y(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(!(Math.random()>this.randomness/100||!a.automatable||m.a.includes(a.name))){var i=a.get(!0),o=i+this.randomness/100*Math.random()*(a.max-i);Math.random()<.5&&(o=i-this.randomness/100*Math.random()*(i-a.min));var s=this.macros[Math.floor(Math.random()*this.macros.length)];Object(h.a)(i)&&s.addParameter(a,i,o)}}}catch(c){n.e(c)}finally{n.f()}this.macros.forEach(function(e){return e.macroParameter.set(e.macroParameter.get())})}}]),n}(f.a),k=n(936),w=n(578),x=n(428);n.d(t,"b",function(){return S}),n.d(t,"a",function(){return P});var S={"Roll Effect":function(e){return new w.a(e)},Macros:function(e){return new j(e)},Playhead:function(e){return new x.a(e)}};function P(e,t){return e.effect===v.f?new w.a(t):e.effect===v.c?new j(t):e.effect===v.d?new k.a(t):e.effect===v.e?new x.a(t):void 0}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),o=n(7),s=n(8),c=n(2),u=n(139),l=n(158),f=(n(143),new Set(["clap","tom","toms","clave","perc","snare","kick","hi-hat","rim","side-stick","breaks","sub","ride","piano","violin"])),h=n(14);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var p=function(e){Object(o.a)(n,e);var t=d(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Midi Outputter",e)).trackOutputParameter=new h.a("trackOutput",Object(i.a)(a),function(e,t){return t},{min:0,max:16,unit:"",defaultValue:void 0}),a.registerParameter(a.trackOutputParameter),a.probabilityParameter=new h.a("probability",Object(i.a)(a),function(e,t){return t},{min:0,max:100,unit:"",defaultValue:100}),a.registerParameter(a.probabilityParameter),a}return Object(a.a)(n,[{key:"documentation",get:function(){return"Routes triggers from this track to another track."}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getAvailableParameters",value:function(){return[this.track.trackData.durationParameter,this.track.trackData.chopParameter,this.track.trackData.velocityParameter,this.track.trackData.transposeParameter,this.track.trackData.attackParameter,this.track.trackData.releaseParameter,this.track.trackData.pitchAttackParameter,this.track.trackData.pitchDecayParameter,this.track.trackData.pitchSustainParameter,this.track.trackData.pitchReleaseParameter]}},{key:"trackOutput",get:function(){return this.trackOutputParameter.get()},set:function(e){this.trackOutputParameter.set(e)}},{key:"probability",get:function(){return this.probabilityParameter.get()},set:function(e){this.probabilityParameter.set(e)}},{key:"getTrack",value:function(){return this.track.subSequence.tracks[Math.round(this.trackOutput)]}},{key:"getVisualizedParameters",value:function(){return[this.trackOutputParameter]}},{key:"getText",value:function(){var e=this.getTrack();if(e)return e.trackNumber+1+". "+function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.sample,r=e.presetName||e.getName();if(n&&n.tags&&((r=n.tags.find(function(e){return f.has(e)}))||(r=n.tags[0]),t&&(r=n.name)),e&&e.getInstrumentType()==l.f&&(r="Synth"),e&&e.getInstrumentType()===l.h){var a=e.instrument.getSamples();a[0]&&a[0].tags&&(r=a[0].tags.find(function(e){return f.has(e)}))}return r}(e)}},{key:"output",value:function(e,t,n){if(Math.random()<this.probability/100&&this.trackOutput){var r=this.track.subSequence.tracks[Math.round(this.trackOutput)];if(void 0===r||r===this.track)return this.triggers;for(var a in r.onNewStep(),this.triggers)r.midiEffects.input(this.getStep(this.triggers[a].stepData,void 0,void 0,!0),this.triggers[a].time,n);var i=r.midiEffects.output(e,t,n);r.otherTriggerCount=i.length,i.forEach(function(e){return r.trigger(e.stepData,e.time)}),r.onStepEnded(e,t)}return this.triggers}}]),n}(u.a);t.a=p},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),o=n(10),s=n(7),c=n(8),u=n(2),l=n(139),f=n(326),h=n(288),d=n(14),p=(n(23),"EQ"),v=n(134);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var y=function(e){Object(s.a)(n,e);var t=m(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Conditional Parameters",e)).setupRampParameters(),a.conditionalTypeParameter=new d.a("conditionalType",Object(i.a)(a),function(){return[]},{defaultValue:p}),a.registerParameter(a.conditionalTypeParameter),a.conditionalValueParameter=new d.a("conditionalValue",Object(i.a)(a),function(){return[]},{defaultValue:0}),a.registerParameter(a.conditionalValueParameter),a.thenValueParameter=new d.a("thenValue",Object(i.a)(a),function(){return[]},{defaultValue:0}),a.registerParameter(a.thenValueParameter),a.parametersDisabledParameter.set([0]),a.setupNodeMessaging(),a}return Object(a.a)(n,[{key:"conditionalType",get:function(){return this.conditionalTypeParameter.get(!0)}},{key:"conditionalValue",get:function(){return this.conditionalValueParameter.get(!0)}},{key:"thenValue",get:function(){return this.thenValueParameter.get(!0)}},{key:"fromParameter",get:function(){return this._parameters[0]}},{key:"getText",value:function(){return""}},{key:"stop",value:function(){Object(o.a)(Object(u.a)(n.prototype),"stop",this).call(this)}},{key:"clear",value:function(){Object(o.a)(Object(u.a)(n.prototype),"clear",this).call(this)}},{key:"output",value:function(e,t){return this.track.sequencerEngine.playing?(0===t&&this.resetAtZero&&0!==this.counter&&(this.stop(),this._clear()),0===this.triggers.length?this.triggers:(this.setParameterValues(e),this.triggers)):this.triggers}},{key:"getParameterValueToSet",value:function(e){return this.isConditionMet()?this.thenValue:this.initialParameterValues[e]}},{key:"isConditionMet",value:function(){if(!this.fromParameter)return!1;var e=this.fromParameter.getNumber();switch(this.conditionalType){case"LTE":return e<=this.conditionalValue;case"GTE":return e>=this.conditionalValue;default:return e===this.conditionalValue}}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"shouldSkipParameter",value:function(e){return 0===parseInt(e)}}]),n}(Object(h.a)(Object(f.a)(Object(v.a)(l.a))));t.a=y},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),o=n(8),s=n(2),c=n(167),u=n(165),l=(n(213),n(545),n(290),n(1)),f=n(114);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var d=function(e){Object(i.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Stats",e)).mem={},a.clear(),a}return Object(a.a)(n,[{key:"isRealTime",value:function(){return!0}},{key:"clear",value:function(){this.myScript=Object(u.a)(function(){var e={},t={},n=void 0,r=0,a=void 0;return function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];var c=o[0],u=o[1],h=(o[2],o[3]);return u=h.track.sequencerEngine.trackStep,c&&c.track.length>r&&(r=c.track.length),u%=r,c&&!t[c.track.id]&&(t[c.track.id]={},t[c.track.id][u]=0),n!==u&&(c&&(t[c.track.id][u]=0),e[u]=0),c&&(e[u]++,t[c.track.id][u]++,isNaN(t[c.track.id][u])&&(t[c.track.id][u]=0),e[u]>a&&(a=e[u])),n=u,h.mem=Object(l.a)({},e),h.trackMem=Object(l.a)({},t),h.maxTriggers=a,h.maxLength=r,Object(f.w)(!0)}}())}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=d},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),o=n(10),s=n(7),c=n(8),u=n(2),l=n(115),f=n(116),h=n(6),d=n.n(h),p=(n(113),n(11));function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(s.a)(n,e);var t=v(n);function n(e){var r,i,o;Object(a.a)(this,n);return(o=t.call(this,"Phase Shift Allpass",function(){return new d.a.Gain(1)},e))._bank0=o._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),o._bank1=o._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),o._oneSampleDelay=d.a.context.createIIRFilter([0,1],[1,0]),o.output=new d.a.Gain(1),o.offset90=new d.a.Gain(1),(r=o.effectNode).chain.apply(r,Object(p.a)(o._bank0).concat([o._oneSampleDelay,o.output])),(i=o.effectNode).chain.apply(i,Object(p.a)(o._bank1).concat([o.offset90])),o}return Object(i.a)(n,[{key:"dispose",value:function(){Object(o.a)(Object(u.a)(n.prototype),"dispose",this).call(this),this._bank0.forEach(function(e){return e.disconnect()}),this._bank1.forEach(function(e){return e.disconnect()}),this.output.dispose(),this.offset90.dispose(),this._oneSampleDelay.dispose(),this._bank0=void 0,this._bank1=void 0,this.output=void 0,this.offset90=void 0}},{key:"connect",value:function(e){this.output.connect(e)}},{key:"disconnect",value:function(e){this.output.disconnect(e)}},{key:"_createAllPassFilterBank",value:function(e){return e.map(function(e){var t=[[e*e,0,-1],[1,0,-e*e]];return d.a.context.createIIRFilter(t[0],t[1])})}}]),n}(l.a.Effect),y=n(192);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}n.d(t,"a",function(){return g});var g=function(e){Object(s.a)(n,e);var t=b(n);function n(e){var r;Object(a.a)(this,n),(r=t.call(this,"Freak Shifter",function(){return new d.a.Gain(1)},e)).output=new d.a.Gain(1),r._sine=new d.a.Oscillator(0,"sine"),r._cosine=new d.a.Oscillator(0,"sine"),r._cosine.phase=-90,r.frequencyParameter=new y.a("frequency",[r._sine.frequency,r._cosine.frequency],{defaultValue:1,min:1,max:1e4}),r.registerParameter(r.frequencyParameter),r._sineMultiply=new d.a.Multiply(0),r._cosineMultiply=new d.a.Multiply(0),r._negate=new d.a.Negate,r._add=new d.a.Add,r._phaseShifter=new m(e),r.effectNode.connect(r._phaseShifter.effectNode),r._phaseShifter.offset90.connect(r._cosineMultiply),r._cosine.connect(r._cosineMultiply.input[1]),r._phaseShifter.connect(r._sineMultiply),r._sine.connect(r._sineMultiply.input[1]),r._sineMultiply.connect(r._negate),r._cosineMultiply.connect(r._add),r._negate.connect(r._add.input[1]),r._add.connect(r.output);var i=d.a.Master.context.currentTime+.01;return r._sine.start(i),r._cosine.start(i),r}return Object(i.a)(n,[{key:"connect",value:function(e){this.output.connect(e)}},{key:"disconnect",value:function(e){this.output.disconnect(e)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(o.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{frequency:this.frequencyParameter.get(!0)});return e=this.saveParameterToJson(e,"frequencyParameter",this.frequencyParameter)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(f.a)(this.frequencyParameter,e.frequency,a),a=Object(r.a)({},a,this.loadParameterFromJson(e,"frequencyParameter",this.frequencyParameter,t))}}]),n}(l.a.Effect)},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),o=n(7),s=n(8),c=n(2),u=n(1),l=n(115),f=n(6),h=n.n(f),d=n(113),p=n(128);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var m=function(e){Object(o.a)(n,e);var t=v(n);function n(e,a,i){var o;return Object(r.a)(this,n),(o=t.call(this,e,a,i)).updateInitialValues(),o}return Object(a.a)(n,[{key:"dispose",value:function(){Object(i.a)(Object(c.a)(n.prototype),"dispose",this).call(this)}},{key:"setCompressors",value:function(e){for(var t in this.compressors=[],e)this.compressors.push(new y(t,this.store,e[t]))}},{key:"getJson",value:function(){return Object(u.a)({},Object(i.a)(Object(c.a)(n.prototype),"getJson",this).call(this),{compressors:this.compressors.map(function(e){return e.getJson()})})}},{key:"fromJson",value:function(e,t){var r=Object(i.a)(Object(c.a)(n.prototype),"fromJson",this).call(this,e,t);for(var a in e.compressors){var o=e.compressors[a].name;this.getCompressor(o).fromJson(e.compressors[a],t)}return r}},{key:"getCompressor",value:function(e){return this.compressors.find(function(t){return t.name===e})}}]),n}(l.a.Effect),y=function(){function e(t,n,a){Object(r.a)(this,e),this.name=t,this.store=n,this.compressorNode=a,this.parameters=[],this.thresholdParameter=new d.c("Threshold",this.compressorNode.threshold,{min:-80,max:8,unit:"",defaultValue:0,constantAutomationRate:!0,automatable:!1}),this.registerParameter(this.thresholdParameter),this.ratioParameter=new d.c("Ratio",this.compressorNode.ratio,{min:1,max:24,unit:"",defaultValue:3,constantAutomationRate:!0}),this.registerParameter(this.ratioParameter),this.attackParameter=new d.b("Attack",this.compressorNode.attack,{constantAutomationRate:!0}),this.registerParameter(this.attackParameter),this.releaseParameter=new d.b("Release",this.compressorNode.release,{constantAutomationRate:!0}),this.registerParameter(this.releaseParameter),this.releaseParameter.set(.1),this.kneeParameter=new d.c("Knee",this.compressorNode.knee,{min:0,max:40,unit:"db",defaultValue:1,constantAutomationRate:!0}),this.registerParameter(this.kneeParameter)}return Object(a.a)(e,[{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"getJson",value:function(){var e={name:this.name,threshold:this.thresholdParameter.get(),ratio:this.ratioParameter.get(),attack:this.attackParameter.get(),release:this.releaseParameter.get()};return e=Object(p.b)(e,"thresholdParameter",this.thresholdParameter),e=Object(p.b)(e,"ratioParameter",this.ratioParameter),e=Object(p.b)(e,"attackParameter",this.attackParameter),e=Object(p.b)(e,"releaseParameter",this.releaseParameter)}},{key:"fromJson",value:function(e,t){this.thresholdParameter.set(e.threshold),this.ratioParameter.set(e.ratio),this.attackParameter.set(e.attack),this.releaseParameter.set(e.release),Object(p.a)(e,"thresholdParameter",this.thresholdParameter,t),Object(p.a)(e,"ratioParameter",this.ratioParameter,t),Object(p.a)(e,"attackParameter",this.attackParameter),Object(p.a)(e,"releaseParameter",this.releaseParameter)}}]),e}();function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var g=function(e){Object(o.a)(n,e);var t=b(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Multiband Compressor",function(){return new h.a.MultibandCompressor},e)).setCompressors({LOW:a.effectNode.low,MID:a.effectNode.mid,HIGH:a.effectNode.high}),a}return Object(a.a)(n,[{key:"dispose",value:function(){Object(i.a)(Object(c.a)(n.prototype),"dispose",this).call(this)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(m);t.a=g},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(31),u=n(10),l=n(7),f=n(8),h=n(2),d=n(115),p=(n(146),n(32)),v=n(611);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}"undefined"===typeof AudioWorkletNode&&alert("AudioWorklet is not supported in this browser !");var y=function(e){Object(l.a)(n,e);var t=m(n);function n(e,r,a){var i;Object(o.a)(this,n),(i=t.call(this,e,"b259wf",a)).baseURL=r,i.json=a.processorOptions.json,i.json_object=JSON.parse(i.json),i.parse_ui=function(e,t){for(var n=0;n<e.length;n++)this.parse_group(e[n],t)},i.parse_group=function(e,t){e.items&&this.parse_items(e.items,t)},i.parse_items=function(e,t){for(var n=0;n<e.length;n++)this.parse_item(e[n],t)},i.parse_item=function(e,t){if("vgroup"===e.type||"hgroup"===e.type||"tgroup"===e.type)this.parse_items(e.items,t);else if("hbargraph"===e.type||"vbargraph"===e.type)t.outputs_items.push(e.address);else if("vslider"===e.type||"hslider"===e.type||"button"===e.type||"checkbox"===e.type||"nentry"===e.type){if(t.inputs_items.push(e.address),t.descriptor.push(e),void 0!==e.meta)for(var n=0;n<e.meta.length;n++)void 0!==e.meta[n].midi&&("pitchwheel"===e.meta[n].midi.trim()?t.fPitchwheelLabel.push({path:e.address,min:parseFloat(e.min),max:parseFloat(e.max)}):"ctrl"===e.meta[n].midi.trim().split(" ")[0]&&t.fCtrlLabel[parseInt(e.meta[n].midi.trim().split(" ")[1])].push({path:e.address,min:parseFloat(e.min),max:parseFloat(e.max)}));var r="set"+e.address,a="get"+e.address;r=r.replace(/\/./g,function(e){return e.substr(1,1).toUpperCase()}),a=a.replace(/\/./g,function(e){return e.substr(1,1).toUpperCase()}),t[r]=function(n){t.setParamValue(e.address,n)},t[a]=function(){return t.getParamValue(e.address)}}},i.output_handler=null,i.inputs_items=[],i.outputs_items=[],i.descriptor=[],i.fPitchwheelLabel=[],i.fCtrlLabel=new Array(128);for(var s=0;s<i.fCtrlLabel.length;s++)i.fCtrlLabel[s]=[];i.parse_ui(i.json_object.ui,Object(c.a)(i)),i.port.onmessage=i.handleMessage.bind(Object(c.a)(i));try{i.parameters&&i.parameters.forEach(function(e){return e.automationRate="k-rate"})}catch(u){}return i}return Object(s.a)(n,[{key:"handleMessage",value:function(e){var t=e.data;this.output_handler&&this.output_handler(t.path,t.value)}},{key:"destroy",value:function(){this.port.postMessage({type:"destroy"}),this.port.close()}},{key:"getJSON",value:function(){return this.json}},{key:"getMetadata",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){var n=""===t.baseURL?"main.json":t.baseURL+"/main.json";fetch(n).then(function(e){return e.json()}).then(function(t){e(t)})}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"setParamValue",value:function(e,t){this.parameters.get(e).setValueAtTime(t,0)}},{key:"setParam",value:function(e,t){this.parameters.get(e).setValueAtTime(t,0)}},{key:"getParamValue",value:function(e){return this.parameters.get(e).value}},{key:"getParam",value:function(e){return this.parameters.get(e).value}},{key:"setOutputParamHandler",value:function(e){this.output_handler=e}},{key:"getOutputParamHandler",value:function(){return this.output_handler}},{key:"getNumInputs",value:function(){return parseInt(this.json_object.inputs)}},{key:"getNumOutputs",value:function(){return parseInt(this.json_object.outputs)}},{key:"inputChannelCount",value:function(){return parseInt(this.json_object.inputs)}},{key:"outputChannelCount",value:function(){return parseInt(this.json_object.outputs)}},{key:"getParams",value:function(){return this.inputs_items}},{key:"getDescriptor",value:function(){var e={};for(var t in this.descriptor)this.descriptor.hasOwnProperty(t)&&"bypass"!=this.descriptor[t].label&&(e=Object.assign(Object(p.a)({},this.descriptor[t].label,{minValue:this.descriptor[t].min,maxValue:this.descriptor[t].max,defaultValue:this.descriptor[t].init}),e));return e}},{key:"ctrlChange",value:function(e,t,r){if(this.fCtrlLabel[t]!==[])for(var a=0;a<this.fCtrlLabel[t].length;a++){var i=this.fCtrlLabel[t][a].path;this.setParamValue(i,n.remap(r,0,127,this.fCtrlLabel[t][a].min,this.fCtrlLabel[t][a].max)),this.output_handler&&this.output_handler(i,this.getParamValue(i))}}},{key:"pitchWheel",value:function(e,t){for(var r=0;r<this.fPitchwheelLabel.length;r++){var a=this.fPitchwheelLabel[r];this.setParamValue(a.path,n.remap(t,0,16383,a.min,a.max)),this.output_handler&&this.output_handler(a.path,this.getParamValue(a.path))}}},{key:"midiMessage",value:function(e){var t=e[0]>>4,n=15&e[0],r=e[1],a=e[2];9!==n&&(11===t?this.ctrlChange(n,r,a):14===t&&this.pitchWheel(n,128*a+r))}},{key:"onMidi",value:function(e){this.midiMessage(e)}},{key:"getState",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=new Object,n=0;n<this.getParams().length;n++)Object.assign(t,Object(p.a)({},this.getParams()[n],"".concat(this.getParam(this.getParams()[n]))));return e.abrupt("return",new Promise(function(e){e(t)}));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setState",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){for(var r in t)t.hasOwnProperty(r)&&n.setParam(r,t[r]);try{n.gui.setAttribute("state",JSON.stringify(t))}catch(a){console.warn("Plugin without gui or GUI not defined",a)}e(t)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"setPatch",value:function(e){this.setState(this.presets[e])}}],[{key:"remap",value:function(e,t,n,r,a){return 1*(e-t)/(n-t)*(a-r)+r}}]),n}(Object(v.a)(AudioWorkletNode)),b=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Object(o.a)(this,e),console.log("baseLatency "+t.baseLatency),console.log("outputLatency "+t.outputLatency),console.log("sampleRate "+t.sampleRate),this.context=t,this.baseURL=n,this.pathTable=[],this.fWorkletProcessors=this.fWorkletProcessors||[]}return Object(s.a)(e,[{key:"heap2Str",value:function(e){for(var t="",n=0;0!==e[n];)t+=String.fromCharCode(e[n++]);return t}},{key:"load",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o,s,c,u,l,f,h,d,p;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={env:{memoryBase:0,tableBase:0,_abs:Math.abs,_acosf:Math.acos,_asinf:Math.asin,_atanf:Math.atan,_atan2f:Math.atan2,_ceilf:Math.ceil,_cosf:Math.cos,_expf:Math.exp,_floorf:Math.floor,_fmodf:function(e,t){return e%t},_logf:Math.log,_log10f:Math.log10,_max_f:Math.max,_min_f:Math.min,_remainderf:function(e,t){return e-Math.round(e/t)*t},_powf:Math.pow,_roundf:Math.fround,_sinf:Math.sin,_sqrtf:Math.sqrt,_tanf:Math.tan,_acoshf:Math.acosh,_asinhf:Math.asinh,_atanhf:Math.atanh,_coshf:Math.cosh,_sinhf:Math.sinh,_tanhf:Math.tanh,_isnanf:Number.isNaN,_isinff:function(e){return!isFinite(e)},_copysignf:function(e,t){return Math.sign(e)===Math.sign(t)?e:-e},_acos:Math.acos,_asin:Math.asin,_atan:Math.atan,_atan2:Math.atan2,_ceil:Math.ceil,_cos:Math.cos,_exp:Math.exp,_floor:Math.floor,_fmod:function(e,t){return e%t},_log:Math.log,_log10:Math.log10,_max_:Math.max,_min_:Math.min,_remainder:function(e,t){return e-Math.round(e/t)*t},_pow:Math.pow,_round:Math.fround,_sin:Math.sin,_sqrt:Math.sqrt,_tan:Math.tan,_acosh:Math.acosh,_asinh:Math.asinh,_atanh:Math.atanh,_cosh:Math.cosh,_sinh:Math.sinh,_tanh:Math.tanh,_isnan:Number.isNaN,_isinf:function(e){return!isFinite(e)},_copysign:function(e,t){return Math.sign(e)===Math.sign(t)?e:-e},table:new WebAssembly.Table({initial:0,element:"anyfunc"})}},n=""===this.baseURL?"b259wf.wasm":this.baseURL+"/b259wf.wasm",e.next=5,fetch(n);case 5:return r=e.sent,e.next=8,r.arrayBuffer();case 8:return i=e.sent,e.next=11,WebAssembly.compile(i);case 11:return o=e.sent,e.next=14,WebAssembly.instantiate(o,t);case 14:if(s=e.sent,c=new Uint8Array(s.exports.memory.buffer),u=this.heap2Str(c),l=JSON.parse(u),f={wasm_module:o,json:u},-1!==this.fWorkletProcessors.indexOf("b259wf")){e.next=35;break}return e.prev=20,h=/JSON_STR/g,d=g.replace(h,u),p=window.URL.createObjectURL(new Blob([d],{type:"text/javascript"})),e.next=26,this.context.audioWorklet.addModule(p);case 26:console.log("Keep the DSP name"),this.fWorkletProcessors.push("b259wf"),e.next=35;break;case 30:return e.prev=30,e.t0=e.catch(20),console.error(e.t0),console.error("Faust "+this.name+" cannot be loaded or compiled"),e.abrupt("return",null);case 35:return this.node=new y(this.context,this.baseURL,{numberOfInputs:parseInt(l.inputs)>0?1:0,numberOfOutputs:parseInt(l.outputs)>0?1:0,channelCount:Math.max(1,parseInt(l.inputs)),outputChannelCount:[parseInt(l.outputs)],channelCountMode:"explicit",channelInterpretation:"speakers",processorOptions:f}),this.node.onprocessorerror=function(){console.log("An error from b259wf-processor was detected.")},e.abrupt("return",this.node);case 40:return e.prev=40,e.t1=e.catch(0),console.error(e.t1),console.error("Faust "+this.name+" cannot be loaded or compiled"),e.abrupt("return",null);case 45:case"end":return e.stop()}},e,this,[[0,40],[20,30]])}));return function(){return e.apply(this,arguments)}}()},{key:"loadGui",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){try{var r=""===t.baseURL?"main.html":t.baseURL+"/main.html";if(!t.linkExists(r)){var a=document.createElement("link");a.rel="import",a.href=r,document.head.appendChild(a),a.onload=function(e){}}}catch(i){console.log(i),n(i)}}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"linkExists",value:function(e){return document.querySelectorAll('link[href="'.concat(e,'"]')).length>0}}]),e}(),g='\n\n    \'use strict\';\n\n    // Monophonic Faust DSP\n    class b259wfProcessor extends AudioWorkletProcessor {\n        \n        // JSON parsing functions\n        static parse_ui(ui, obj, callback)\n        {\n            for (var i = 0; i < ui.length; i++) {\n                b259wfProcessor.parse_group(ui[i], obj, callback);\n            }\n        }\n        \n        static parse_group(group, obj, callback)\n        {\n            if (group.items) {\n                b259wfProcessor.parse_items(group.items, obj, callback);\n            }\n        }\n        \n        static parse_items(items, obj, callback)\n        {\n            for (var i = 0; i < items.length; i++) {\n                callback(items[i], obj, callback);\n            }\n        }\n        \n        static parse_item1(item, obj, callback)\n        {\n            if (item.type === "vgroup"\n                || item.type === "hgroup"\n                || item.type === "tgroup") {\n                b259wfProcessor.parse_items(item.items, obj, callback);\n            } else if (item.type === "hbargraph"\n                       || item.type === "vbargraph") {\n                // Nothing\n            } else if (item.type === "vslider"\n                       || item.type === "hslider"\n                       || item.type === "button"\n                       || item.type === "checkbox"\n                       || item.type === "nentry") {\n                obj.push({ name: item.address,\n                         defaultValue: item.init,\n                         minValue: item.min,\n                         maxValue: item.max });\n            }\n        }\n        \n        static parse_item2(item, obj, callback)\n        {\n            if (item.type === "vgroup"\n                || item.type === "hgroup"\n                || item.type === "tgroup") {\n                b259wfProcessor.parse_items(item.items, obj, callback);\n            } else if (item.type === "hbargraph"\n                       || item.type === "vbargraph") {\n                // Keep bargraph adresses\n                obj.outputs_items.push(item.address);\n                obj.pathTable[item.address] = parseInt(item.index);\n            } else if (item.type === "vslider"\n                       || item.type === "hslider"\n                       || item.type === "button"\n                       || item.type === "checkbox"\n                       || item.type === "nentry") {\n                // Keep inputs adresses\n                obj.inputs_items.push(item.address);\n                obj.pathTable[item.address] = parseInt(item.index);\n            }\n        }\n     \n        static get parameterDescriptors() \n        {\n            // Analyse JSON to generate AudioParam parameters\n            var params = [];\n            b259wfProcessor.parse_ui(JSON.parse(`JSON_STR`).ui, params, b259wfProcessor.parse_item1);\n            return params;\n        }\n       \n        constructor(options)\n        {\n            super(options);\n            this.running = true;\n            \n            const importObject = {\n                    env: {\n                        memoryBase: 0,\n                        tableBase: 0,\n\n                        // Integer version\n                        _abs: Math.abs,\n\n                        // Float version\n                        _acosf: Math.acos,\n                        _asinf: Math.asin,\n                        _atanf: Math.atan,\n                        _atan2f: Math.atan2,\n                        _ceilf: Math.ceil,\n                        _cosf: Math.cos,\n                        _expf: Math.exp,\n                        _floorf: Math.floor,\n                        _fmodf: function(x, y) { return x % y; },\n                        _logf: Math.log,\n                        _log10f: Math.log10,\n                        _max_f: Math.max,\n                        _min_f: Math.min,\n                        _remainderf: function(x, y) { return x - Math.round(x/y) * y; },\n                        _powf: Math.pow,\n                        _roundf: Math.fround,\n                        _sinf: Math.sin,\n                        _sqrtf: Math.sqrt,\n                        _tanf: Math.tan,\n                        _acoshf: Math.acosh,\n                        _asinhf: Math.asinh,\n                        _atanhf: Math.atanh,\n                        _coshf: Math.cosh,\n                        _sinhf: Math.sinh,\n                        _tanhf: Math.tanh,\n\n                        // Double version\n                        _acos: Math.acos,\n                        _asin: Math.asin,\n                        _atan: Math.atan,\n                        _atan2: Math.atan2,\n                        _ceil: Math.ceil,\n                        _cos: Math.cos,\n                        _exp: Math.exp,\n                        _floor: Math.floor,\n                        _fmod: function(x, y) { return x % y; },\n                        _log: Math.log,\n                        _log10: Math.log10,\n                        _max_: Math.max,\n                        _min_: Math.min,\n                        _remainder:function(x, y) { return x - Math.round(x/y) * y; },\n                        _pow: Math.pow,\n                        _round: Math.fround,\n                        _sin: Math.sin,\n                        _sqrt: Math.sqrt,\n                        _tan: Math.tan,\n                        _acosh: Math.acosh,\n                        _asinh: Math.asinh,\n                        _atanh: Math.atanh,\n                        _cosh: Math.cosh,\n                        _sinh: Math.sinh,\n                        _tanh: Math.tanh,\n\n                        table: new WebAssembly.Table({ initial: 0, element: \'anyfunc\' })\n                    }\n            };\n            \n            this.b259wf_instance = new WebAssembly.Instance(options.processorOptions.wasm_module, importObject);\n            this.json_object = JSON.parse(options.processorOptions.json);\n         \n            this.output_handler = function(path, value) { this.port.postMessage({ path: path, value: value }); };\n            \n            this.ins = null;\n            this.outs = null;\n\n            this.dspInChannnels = [];\n            this.dspOutChannnels = [];\n\n            this.numIn = parseInt(this.json_object.inputs);\n            this.numOut = parseInt(this.json_object.outputs);\n\n            // Memory allocator\n            this.ptr_size = 4;\n            this.sample_size = 4;\n            this.integer_size = 4;\n            \n            this.factory = this.b259wf_instance.exports;\n            this.HEAP = this.b259wf_instance.exports.memory.buffer;\n            this.HEAP32 = new Int32Array(this.HEAP);\n            this.HEAPF32 = new Float32Array(this.HEAP);\n\n            // Warning: keeps a ref on HEAP in Chrome and prevent proper GC\n            //console.log(this.HEAP);\n            //console.log(this.HEAP32);\n            //console.log(this.HEAPF32);\n\n            // bargraph\n            this.outputs_timer = 5;\n            this.outputs_items = [];\n\n            // input items\n            this.inputs_items = [];\n        \n            // Start of HEAP index\n\n            // DSP is placed first with index 0. Audio buffer start at the end of DSP.\n            this.audio_heap_ptr = parseInt(this.json_object.size);\n\n            // Setup pointers offset\n            this.audio_heap_ptr_inputs = this.audio_heap_ptr;\n            this.audio_heap_ptr_outputs = this.audio_heap_ptr_inputs + (this.numIn * this.ptr_size);\n\n            // Setup buffer offset\n            this.audio_heap_inputs = this.audio_heap_ptr_outputs + (this.numOut * this.ptr_size);\n            this.audio_heap_outputs = this.audio_heap_inputs + (this.numIn * NUM_FRAMES * this.sample_size);\n            \n            // Start of DSP memory : DSP is placed first with index 0\n            this.dsp = 0;\n\n            this.pathTable = [];\n         \n            // Send output values to the AudioNode\n            this.update_outputs = function ()\n            {\n                if (this.outputs_items.length > 0 && this.output_handler && this.outputs_timer-- === 0) {\n                    this.outputs_timer = 5;\n                    for (var i = 0; i < this.outputs_items.length; i++) {\n                        this.output_handler(this.outputs_items[i], this.HEAPF32[this.pathTable[this.outputs_items[i]] >> 2]);\n                    }\n                }\n            }\n            \n            this.initAux = function ()\n            {\n                var i;\n                \n                if (this.numIn > 0) {\n                    this.ins = this.audio_heap_ptr_inputs;\n                    for (i = 0; i < this.numIn; i++) {\n                        this.HEAP32[(this.ins >> 2) + i] = this.audio_heap_inputs + ((NUM_FRAMES * this.sample_size) * i);\n                    }\n                    \n                    // Prepare Ins buffer tables\n                    var dspInChans = this.HEAP32.subarray(this.ins >> 2, (this.ins + this.numIn * this.ptr_size) >> 2);\n                    for (i = 0; i < this.numIn; i++) {\n                        this.dspInChannnels[i] = this.HEAPF32.subarray(dspInChans[i] >> 2, (dspInChans[i] + NUM_FRAMES * this.sample_size) >> 2);\n                    }\n                }\n                \n                if (this.numOut > 0) {\n                    this.outs = this.audio_heap_ptr_outputs;\n                    for (i = 0; i < this.numOut; i++) {\n                        this.HEAP32[(this.outs >> 2) + i] = this.audio_heap_outputs + ((NUM_FRAMES * this.sample_size) * i);\n                    }\n                    \n                    // Prepare Out buffer tables\n                    var dspOutChans = this.HEAP32.subarray(this.outs >> 2, (this.outs + this.numOut * this.ptr_size) >> 2);\n                    for (i = 0; i < this.numOut; i++) {\n                        this.dspOutChannnels[i] = this.HEAPF32.subarray(dspOutChans[i] >> 2, (dspOutChans[i] + NUM_FRAMES * this.sample_size) >> 2);\n                    }\n                }\n                \n                // Parse UI\n                b259wfProcessor.parse_ui(this.json_object.ui, this, b259wfProcessor.parse_item2);\n                \n                // Init DSP\n                this.factory.init(this.dsp, sampleRate); // \'sampleRate\' is defined in AudioWorkletGlobalScope  \n            }\n\n            this.setParamValue = function (path, val)\n            {\n                this.HEAPF32[this.pathTable[path] >> 2] = val;\n            }\n\n            this.getParamValue = function (path)\n            {\n                return this.HEAPF32[this.pathTable[path] >> 2];\n            }\n\n            // Init resulting DSP\n            this.initAux();\n        }\n        \n        process(inputs, outputs, parameters) \n        {\n            var input = inputs[0];\n            var output = outputs[0];\n            \n            // Check inputs\n            if (this.numIn > 0 && (!input || !input[0] || input[0].length === 0)) {\n                //console.log("Process input error");\n                return true;\n            }\n            // Check outputs\n            if (this.numOut > 0 && (!output || !output[0] || output[0].length === 0)) {\n                //console.log("Process output error");\n                return true;\n            }\n            \n            // Copy inputs\n            if (input !== undefined) {\n                for (var chan = 0; chan < Math.min(this.numIn, input.length); ++chan) {\n                    var dspInput = this.dspInChannnels[chan];\n                    dspInput.set(input[chan]);\n                }\n            }\n            \n            /*\n            TODO: sample accurate control change is not yet handled\n            When no automation occurs, params[i][1] has a length of 1,\n            otherwise params[i][1] has a length of NUM_FRAMES with possible control change each sample\n            */\n            \n            // Update controls\n            for (const path in parameters) {\n                const paramArray = parameters[path];\n                this.setParamValue(path, paramArray[0]);\n            }\n        \n          \t// Compute\n            try {\n                this.factory.compute(this.dsp, NUM_FRAMES, this.ins, this.outs);\n            } catch(e) {\n                console.log("ERROR in compute (" + e + ")");\n            }\n            \n            // Update bargraph\n            this.update_outputs();\n            \n            // Copy outputs\n            if (output !== undefined) {\n                for (var chan = 0; chan < Math.min(this.numOut, output.length); ++chan) {\n                    var dspOutput = this.dspOutChannnels[chan];\n                    output[chan].set(dspOutput);\n                }\n            }\n            \n            return this.running;\n    \t}\n        \n        handleMessage(event)\n        {\n            var msg = event.data;\n            switch (msg.type) {\n                case "destroy": this.running = false; break;\n            }\n        }\n    }\n\n    // Globals\n    const NUM_FRAMES = 128;\n    try {\n        registerProcessor(\'b259wf\', b259wfProcessor);\n    } catch (error) {\n        console.warn(error);\n    }\n',O=b,j=n(116),k=n(6),w=n.n(k),x=n(14);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var P=function(e){Object(l.a)(n,e);var t=S(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Faust WaveFolder",function(){return new w.a.Gain(1)},e,!0)).outputNode=new w.a.Gain(1),r.foldParameter=new x.a("Fold Amount",Object(c.a)(r),function(e,t){return r.faustNode?r.faustNode.setB259wfFold(t):0},{documentation:"Controls the amount of folding",min:0,max:1,defaultValue:.1}),r.registerParameter(r.foldParameter),r.offsetParameter=new x.a("Fold Offset",Object(c.a)(r),function(e,t){return r.faustNode?r.faustNode.setB259wfOffset(t):0},{documentation:"Controls the offset of folding",min:0,max:1,defaultValue:.1}),r.lowpassParameter=new x.a("Low Pass Filter",Object(c.a)(r),function(e,t){return r.faustNode?r.faustNode.setB259wfLowpass(t):0},{documentation:"Controls the offset of folding",min:0,max:1,defaultValue:.1}),r.registerParameter(r.foldParameter),r.registerParameter(r.lowpassParameter),r.registerParameter(r.offsetParameter),r.loadedValue=1,r.initializeWorklets(),r.updateInitialValues(),r}return Object(s.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"initializeWorklets",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.sequencerEngine.isOffline?this.effectNode.connect(this.outputNode):(this.plugin=new O(w.a.Master.context._context,"."),this.plugin.load().then(function(e){console.log("LOADED wave folder",e),t.effectNode.connect(e),t.faustNode=e,e.connect(t.outputNode),t.foldParameter.refresh(),t.offsetParameter.refresh(),t.lowpassParameter.refresh()})),this.updateInitialValues();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getJson",value:function(e){var t=Object(u.a)(Object(h.a)(n.prototype),"getJson",this).call(this);return t.fold=this.foldParameter.get(),t.offset=this.offsetParameter.get(),t.lowpass=this.lowpassParameter.get(),t}},{key:"fromJson",value:function(e,t){var r=Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,e,t);return e.fold&&(this.loadedValue=e.fold,Object(j.a)(this.foldParameter,e.fold,r),Object(j.a)(this.offsetParameter,e.offset,r),Object(j.a)(this.lowpassParameter,e.lowpass,r)),r}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(d.a.Effect);t.a=P},function(e,t,n){"use strict";var r=n(108),a=n(4),i=n(5),o=n(21),s=n(11);function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=new o.a(32,!1),f=function(e,t){for(var n=[],r=Math.floor(t);r>=0;r--){var a,i=c(e.getAllOnStepAtResolutionAtAnyPosition(r,l));try{for(i.s();!(a=i.n()).done;){var o=a.value;r+2*o.duration>t&&n.push(o)}}catch(s){i.e(s)}finally{i.f()}}return n},h=function(e,t,n){var r=[],a=e.stepBuckets[t];for(var i in a.steps)parseFloat(i)>=n&&(r=[].concat(Object(s.a)(r),Object(s.a)(a.steps[i].getPolyphony().filter(function(e){return e.on}))));return r},d=function(e,t,n){var r=[],a=e.stepBuckets[t];for(var i in a.steps)parseFloat(i)<=n&&(r=[].concat(Object(s.a)(r),Object(s.a)(a.steps[i].getPolyphony().filter(function(e){return e.on}))));return r},p=function(e,t){var n=null===e.transpose?(void 0).trackData.transpose:e.transpose;return n<=t.transpose&&n>t.transpose-t.numNotes},v=n(258),m=n(49),y=n(60);function b(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var O=new o.a(32,!1),j=new o.a(32,!0),k=function(){function e(t,n){Object(a.a)(this,e),this.pattern=t,this.trackData=n}return Object(i.a)(e,[{key:"getStep",value:function(e,t,n){var r=this;return this.pattern.getStepAtResolution(e,t,function(e){return null===e.transpose&&n===r.trackData.transpose||e.transpose===n})}},{key:"getStepsAtStepNumber",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O;return this.pattern.getPolyphonicStepsAtResolution(e,t)}},{key:"getStepWithTranspose",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this.pattern.getAllOnStepAtResolutionAtAnyPosition(e,t,a).filter(function(e){return e.on&&(null===(t=e).transpose&&n===r.trackData.transpose||Math.round(t.transpose)===n);var t});if(i.length>0)return i[0]}},{key:"deleteStepsAtStepNumber",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t.isTriplet?(e=j.transformStepAtResolution2(e,t),this.pattern.tripletStepBuckets[e]=new y.a(this.pattern.track,!0)):(e=O.transformStepAtResolution2(e,t),this.pattern.stepBuckets[e]=new y.a(this.pattern.track)),n&&this.update(t.isTriplet)}},{key:"deleteStepAtStepNumber",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t=this.getStepNumber(t,n);var a=n.isTriplet?this.pattern.tripletStepBuckets[t]:this.pattern.stepBuckets[t];if(void 0!==a){for(var i in a.steps){var o=a.steps[i],s=o.deleteStep(e);if(s===m.a){delete a.steps[i];break}if(void 0!==s&&s!==o){a.steps[i]=s;break}}a.anyOn()||a.clear(),r&&this.update(n.isTriplet)}}},{key:"deleteStep",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.pattern.stepBucketsMatrix;for(var r in Object(v.b)(e),n){var a=n[r];if(a){for(var i in a.steps){var o=a.steps[i].deleteStep(e);if(o===m.a){delete a.steps[i];break}if(void 0!==o){a.steps[i]=o;break}}a.anyOn()||a.clear()}}t&&this.update()}},{key:"addStep",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];e.track=this.pattern.track;var s=O.transformStepAtResolution2(t,n);o&&t>=this.pattern.length(n)&&this.pattern.changeLength(s+2*e.duration,!1);var c=this.pattern.getStepAtResolution(t,n,function(){return!0},r);if(void 0===c||i||(e=c.addStep(e)),this.pattern.setStepAtResolution(e,t,n,r),a)if(n.isTriplet)this.update(n.isTriplet);else{var u=O.transformStepAtResolution2(t,n);this.pattern.stepBucketsMatrix[u]=this.pattern.stepBuckets[u],this.pattern.needsSync=!0}return e}},{key:"getSelectedSteps",value:function(e,t){for(var n=[],r=e.fromStep;r<=e.toStep;r++){var a=this.pattern.getAllOnStepAtResolutionAtAnyPosition(r,t);n=n.concat(a)}return n}},{key:"getAllIntersectingSteps",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,a=[],i=e;i>=n;i--){var o,s=Math.floor(i),c=b(this.pattern.getAllOnStepAtResolutionAtAnyPosition(s,t));try{for(c.s();!(o=c.n()).done;){var u=o.value;s+u.duration>(r?e:Math.floor(e))&&a.push(u)}}catch(l){c.e(l)}finally{c.f()}}return a}},{key:"getSelectedPianoRollSteps",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r)return function(e){var t=e.pattern,n=e.selection,r=e.resolution,a=(e.checkIntersection,l.transformStepAtResolution2(n.stepNumber,r)),i=l.transformStepAtResolution2(n.stepNumber+n.numSteps,r),o=[];o=[].concat(Object(s.a)(o),Object(s.a)(f(t,a))),o=[].concat(Object(s.a)(o),Object(s.a)(h(t,Math.floor(a),a-Math.floor(a))));for(var c=Math.ceil(a);c<Math.floor(i);c++){var u=t.stepBuckets[c];o=[].concat(Object(s.a)(o),Object(s.a)(u.getAllOnSteps()))}return o=[].concat(Object(s.a)(o),Object(s.a)(d(t,Math.floor(i),i-Math.floor(i)))),Array.from(new Set(o)).filter(function(e){return p(e,n)})}({pattern:this.pattern,selection:e,resolution:t});for(var a=[],i=void 0,o=e.stepNumber+e.numSteps,c=!0,u=e.stepNumber;u<=e.stepNumber+e.numSteps;u++){var v=r?this.getAllIntersectingSteps(u,t,i,c):this.pattern.getAllOnStepAtResolutionAtAnyPosition(u,t);c=!1;var m=v.filter(function(t){return n.isStepSelected(t,e)});a=a.concat(m),i=u}if(r&&Math.floor(i)<Math.floor(o)){var y=O.transformStepAtResolution2(o,t),b=this.pattern.getAllOnStepAtResolutionBeforePosition(Math.floor(y),O,y-Math.floor(y)).filter(function(t){return n.isStepSelected(t,e)});a=a.concat(b)}return Array.from(new Set(a))}},{key:"getStepNumber",value:function(e,t){return t.isTriplet?j.transformStepAtResolution2(e,t):O.transformStepAtResolution2(e,t)}},{key:"isStepSelected",value:function(e,t){var n=null===e.transpose?this.trackData.transpose:e.transpose;return n<=t.transpose&&n>t.transpose-t.numNotes}},{key:"getStepNumbers",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[];for(var a in e){var i=e[a],o=this.findStepNumber(i,t,n);r.push([i,o])}return r}},{key:"transformSteps",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];(new Date).getTime();if(0===n.stepDifference&&0===n.transposeDifference)return e;var o=t.some(function(e){return e[1]+e[0].position+n.stepDifference<=0});if(a&&o&&n.stepDifference<0)return e;for(var s in t){var c=t[s][0],u=t[s][1];this.deleteStepAtStepNumber(c,u,r,!1)}var l=[],f={},h=this.pattern.length(r);for(var d in t){var p=t[d][0],v=t[d][1],m=v,y=null===p.transpose?this.trackData.transpose:p.transpose;if(isNaN(n.stepDifference)&&(n.stepDifference=0),p.transpose=y+n.transposeDifference,v+=p.position+n.stepDifference,!isNaN(v)){v<0?a?(v=0,p.position=0):v=h+v:a&&(v%=h);var b=Math.floor(v),g=v-b;p.position=g,m!==b&&(f[m]=b),this.addStep(p,b,r,g,!1),l.push(p)}}return i&&!r.isTriplet?(this.pattern.clearCache(),this.pattern.syncMatrixBySteps(f,r)):i&&this.update(r.isTriplet),l}},{key:"snapToGrid",value:function(e,t){var n=this.getStepNumbers(e,t);for(var r in n){var a=n[r][0],i=n[r][1];a.position;this.deleteStepAtStepNumber(a,i,t,!1)}var o=t.isTriplet;for(var s in n){var c=n[s][0],u=Math.round(n[s][1]);c.position=0,this.addStep(c,u,t,0,!1)}this.update(o)}},{key:"findStepNumber",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.isTriplet?this.pattern.tripletStepBucketsMatrix:this.pattern.stepBucketsMatrix;for(var a in r){var i=r[a];if(void 0!==i)for(var o in i.steps){if(i.steps[o].hasStep(e))return t.transformStepAtResolution2(n?parseFloat(a)+parseFloat(o):a,t.isTriplet?j:O)}}}},{key:"findStepNumberAndDelete",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.pattern.stepBucketsMatrix;for(var a in r){var i=r[a];for(var o in i.steps){var s=i.steps[o].deleteStep(e);if(void 0!==s)return i.steps[o]=s,n&&this.update(t.isTriplet),t.transformStepAtResolution2(a,t.isTriplet?j:O)}}}},{key:"deleteSteps",value:function(e){var t=this;e.forEach(function(e){return t.deleteStep(e,!1,void 0,!0)}),this.update()}},{key:"getAllSteps",value:function(){var e=[],t=this.pattern.stepBuckets;for(var n in t){var r=t[n];for(var a in r.steps){var i=r.steps[a];e=e.concat(i.getPolyphony().filter(function(e){return e.on}))}}return e}},{key:"pasteSteps",value:function(e,t,n,r){if(void 0!==e&&void 0!==t){var a=n.getStepNumbers(e,r),i=6e4;for(var o in a){var s=a[o][1];s<i&&(i=s)}for(var c in a)a[c][1]-=i;var u=t.stepNumber,l=[];for(var f in a){var h=a[f][0].getCopy(!0,!1,!1,!0,!1,!1),d=u+a[f][1];l.push(this.addStep(h,d,r,h.position,!1))}return this.update(r.isTriplet),l}}},{key:"getFirstStepNumber",value:function(e,t){var n,a=1/0,i=b(this.getStepNumbers(e,t));try{for(i.s();!(n=i.n()).done;){var o=n.value,s=Object(r.a)(o,2),c=s[0],u=s[1];u<a&&(a=u,c)}}catch(l){i.e(l)}finally{i.f()}return a}},{key:"getFirstOnStep",value:function(e){var t,n=0,r=b(this.pattern.stepBuckets);try{for(r.s();!(t=r.n()).done;){if(t.value.getAnyOnStep())return e.transformStepAtResolution2(n,O);n++}}catch(a){r.e(a)}finally{r.f()}return 0}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.pattern.calculateFills(this.trackData),this.pattern.clearCache(),this.pattern.syncBuckets(e)}}]),e}();t.a=k},function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(108),o=n(4),s=n(5),c=n(31),u=n(7),l=n(8),f=n(2),h=n(361),d=(n(147),n(242)),p=n(20),v=n(193),m={swap:function(e,t,n){e.swap([t,n])},mutate:function(e,t,n){e.mutate(t,n)},mutateLength:function(e,t,n){e.mutateLength(t,n)},mutateLengthBack:function(e,t,n){e.mutateLengthBack(t,n)},newFigure:function(e){e.newFigure()},removeFigure:function(e){e.removeFigure()},doubleFigures:function(e,t,n){e.doubleFigures()},halfFigures:function(e,t,n){e.halfFigures()},reverse:function(e,t,n){e.reverse(t,n)}},y=(n(362),n(384)),b=n(868),g=n(134),O=n(872);function j(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}n.d(t,"a",function(){return E});var x=Object(y.a)(Object(v.f)(". -")),S=Object(y.a)(Object(v.f)(". . -")),P=Object(y.a)(Object(v.f)(". . . -")),E=function(e){Object(u.a)(n,e);var t=w(n);function n(e,r){var s;return Object(o.a)(this,n),(s=t.call(this)).subSequence=e,s.zObject=r,s.sequencerEngine=e.sequencerEngine,s.id=Object(p.uuid)(),s.figures=[new b.a(x,Object(c.a)(s)),new b.a(S,Object(c.a)(s)),new b.a(P,Object(c.a)(s)),new b.a(S,Object(c.a)(s))],s.newInlet("swap",function(e){var t,n=Object(i.a)(e,1)[0];return(t=s).swap.apply(t,Object(a.a)(n))}),s.onFiguresChanged(),s.registerOperations("figures",m),s}return Object(s.a)(n,[{key:"swap",value:function(e){var t=Object(i.a)(e,2),n=t[0],r=t[1];if(n%=this.figures.length,r%=this.figures.length,!isNaN(n)&&!isNaN(r)){var a=this.figures[n];this.figures[n]=this.figures[r],this.figures[r]=a,this.onFiguresChanged()}}},{key:"mirror",value:function(){}},{key:"reverse",value:function(){var e=Object(a.a)(this.figures);e.reverse();var t,n=j(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.figureLength,o=r.figureType,s=d.b[i][o].split("").reverse().join(""),c=d.b[i].indexOf(s);c>-1&&r.figureTypeParameter.set(c)}}catch(u){n.e(u)}finally{n.f()}this.figures=Object(a.a)(e),this.onFiguresChanged()}},{key:"mutate",value:function(e,t){var n=this.figures[e%this.figures.length];if(n){var r=n.figureLength,a=d.b[r];(void 0===t||isNaN(t))&&(t=n.figureType+1),isNaN(t%a.length)||n.figureTypeParameter.set(t%a.length)}}},{key:"mutateLength",value:function(e,t){var n=this.figures[e%this.figures.length];if(n){n.figureLength;var r=Object.keys(d.b).map(parseFloat);if(void 0===t||isNaN(t)){var a=r.indexOf(n.figureLength);t=r[Math.min(a+1,r.length-1)]}isNaN(t)||n.figureLengthParameter.set(t)}}},{key:"mutateLengthBack",value:function(e,t){var n=this.figures[e%this.figures.length];if(n){n.figureLength;var r=Object.keys(d.b).map(parseFloat);if(void 0===t||isNaN(t)){var a=r.indexOf(n.figureLength);t=r[Math.max(0,a-1)]}isNaN(t)||n.figureLengthParameter.set(t)}}},{key:"updateFigure",value:function(e,t){for(var n=-1,r=0;r<this.figures.length;r++)if(e===this.figures[r]){n=r;break}return t=Object(y.a)(Object(v.f)(t)),this.figures[n].updateFigure(t),this.figures=Object(a.a)(this.figures),this.onFiguresChanged(),this.figures[n]}},{key:"onFiguresChanged",value:function(){var e=this;if(this.figures){this._figures=this.figures.map(function(e){return e.figure});for(var t=function(t){var n=e.getFigureInletName(t);e.inlets[n]||e.newInlet(n,function(){return e.onFigureTypeChange(t)})},n=0;n<this._figures.length;n++)t(n)}this.zObject&&this.zObject.onValueChange()}},{key:"onFigureTypeChange",value:function(e){var t=this.figures[e];if(t){var n=d.b[t.figureLength],r=(t.figureType+1)%n.length;t.figureTypeParameter.set(r)}}},{key:"newFigure",value:function(){if(this.lastRemoved)return this.figures=[].concat(Object(a.a)(this.figures),[this.lastRemoved]),this.onFiguresChanged(),void(this.lastRemoved=void 0);var e=this.figures.reduce(function(e,t){return e+t.figureLength},0);e=e%4===0?4:3;var t=Object(d.f)(e,this.figures[this.figures.length-1]),n=new b.a(x,this);n.figureLengthParameter.set(e),n.figureTypeParameter.set(t),this.figures=[].concat(Object(a.a)(this.figures),[n]),this.onFiguresChanged()}},{key:"removeFigure",value:function(){if(this.figures.length>1){var e=this.figures[this.figures.length-1];this.lastRemoved=e,this.figures=this.figures.slice(0,this.figures.length-1),this.onFiguresChanged()}}},{key:"doubleFigures",value:function(){var e=this.figures.map(function(e){return e.getCopy()});this.figures=[].concat(Object(a.a)(this.figures),Object(a.a)(e)),this.onFiguresChanged()}},{key:"halfFigures",value:function(){for(var e=[],t=0;t<this.figures.length/2;t++)e.push(this.figures[t]);this.figures=e,this.onFiguresChanged()}},{key:"getFigureInletName",value:function(e){return"figure-type-"+(e+1)}},{key:"deleteFigure",value:function(e){this.figures.indexOf(e);this.deleteInlet(this.getFigureInletName(e)),this.figures=this.figures.filter(function(t){return t!==e}),this.onFiguresChanged()}},{key:"fromJson",value:function(e){var t=e.figures,n=e.id,a={};if(this.id=n,!t)return a;for(var i=0;i<t.length;i++){var o=t[i];"string"===typeof o?(this.figures[i]=new b.a(Object(y.a)(Object(v.f)(o)),this),this.updateFigure(this.figures[i],o)):(this.figures[i]||this.newFigure(),a=Object(r.a)({},a,this.figures[i].fromJson(o)))}return this.figures=this.figures.slice(0,t.length),this.onFiguresChanged(),a}},{key:"getJson",value:function(){return{id:this.id,figures:this.figures.map(function(e){return e.getJson()})}}},{key:"getValueJson",value:function(){return this.getJson()}},{key:"fromValueJson",value:function(e){this.fromJson(e)}}]),n}(Object(O.a)(Object(g.a)(Object(h.a)(function(){return function e(){Object(o.a)(this,e)}}()))))},function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(4),o=n(5),s=n(7),c=n(8),u=n(2),l=n(173);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}r.Component;var h=n(55);t.a=Object(h.b)(function(e,t){return{params:t.effect.rnboParameters.length}},function(e){return{}})(function(e){var t=e.effect,n=e.sequencerEngine;return a.a.createElement("div",{className:"flex w-96 flex-wrap"},t.rnboParameters.map(function(e){return a.a.createElement(l.a,{name:e.name,sequencerEngine:n,lfoEnabled:!0,parameter:e,isParameter:!0,step:.001,max:e.max,min:e.min})}),t.signalParameters.map(function(e){return a.a.createElement(l.a,{name:e.name,sequencerEngine:n,lfoEnabled:!0,parameter:e,isParameter:!0,step:.001,max:e.max,min:e.min})}))})},function(e,t,n){"use strict";var r=n(1),a=(n(200),n(201)),i=n(16),o=n(249);n(11);var s=n(161);function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"a",function(){return l});Object(a.a)("navierStokes",{parameters:"",forceEmitters:"",diffusionParam:"",root:""},"Navier stokes simulationn. force=array of force parameters");var l=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:64,l=void 0,f=.1*u,h=u/i.c,d=u/i.a,p=u+2,v=(u+2)*(u+2),m=new Float32Array(v),y=new Float32Array(v),b=new Float32Array(v),g=new Float32Array(v),O=new Float32Array(v),j=new Float32Array(v),k=new Float32Array(v),w=-.5/u*1,x=.5*u,S=u+.5,P=new Array(p),E=0;E<p;E++){P[E]=new Array(p);for(var T=0;T<p;T++)P[E][T]=E+T*p}for(E=0;E<v;E++)j[E]=g[E]=O[E]=b[E]=m[E]=y[E]=k[E]=0;var A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y;e.set(k),t.set(k),n.set(k)},M=function(e,t,n,r,a){var i;C(e,n,a),C(t,r,a),i=n,n=e,N(1,e=i,n,a),i=r,r=t,N(2,t=i,r,a),I(e,t,n,r),i=n,n=e,e=i,i=r,r=t,t=i,q(1,e,n,n,r,a),q(2,t,r,n,r,a),I(e,t,n,r)},R=function(e,t,n,r,a){C(e,t,a),N(0,t,e,a),q(0,e,t,n,r,a)},C=function(e,t,n){for(var r=0;r<v;r++)e[r]+=n*t[r]},N=function(e,t,n,r){for(var a=1;a<v;a++)t[a]=n[a]*l;_(e,t)},I=function(e,t,n,r){for(var a,i,o,s,c,l,f,h,d=1;d<=u;d++){a=P[0][d-1],o=P[0][d],s=P[0][d+1],f=o-1,c=u+(h=o+1);for(var p=h;p<c;p++)n[p]=0,r[p]=(e[++h]-e[++f]+t[++s]-t[++a])*w}_(0,r),_(0,n);for(var v=0;v<6;v++){for(var m=1;m<=u;m++)for(l=P[0][m-1],o=P[0][m],s=P[0][m+1],i=n[o],o++,E=1;E<=u;E++)n[o]=i=.25*(r[o]+n[++l]+n[++o]+n[++s]+i);_(0,n)}for(var y=1;y<=u;y++)for(l=P[0][y-1],o=P[0][y],s=P[0][y+1],f=o-1,h=o+1,E=1;E<=u;E++)e[++o]-=x*(n[++h]-n[++f]),t[o]-=x*(n[++s]-n[++l]);_(1,e),_(2,t)},q=function(e,t,n,r,a,i){for(var o=1;o<=u;o++)for(var s=o*p,c=1;c<=u;c++){var l=c-f*r[++s],h=o-f*a[s];l<.5&&(l=.5),l>S&&(l=S);var d=0|l,v=d+1;h<.5&&(h=.5),h>S&&(h=S);var m=0|h,y=m+1,b=l-d,g=1-b,O=h-m,j=1-O,k=P[0][m],w=P[0][y];t[s]=g*(j*n[d+k]+O*n[d+w])+b*(j*n[v+k]+O*n[v+w])}_(e,t)},_=function(e,t){var n;switch(e){case 1:for(n=1;n<=u;n++)t[n]=t[n+p],t[P[n][u+1]]=t[P[n][u]],t[P[0][n]]=-t[P[1][n]],t[P[u+1][n]]=-t[P[u][n]];break;case 2:for(n=1;n<=u;n++)t[n]=-t[n+p],t[P[n][u+1]]=-t[P[n][u]],t[P[0][n]]=t[P[1][n]],t[P[u+1][n]]=t[P[u][n]];break;default:for(n=1;n<=u;n++)t[n]=t[n+p],t[P[n][u+1]]=t[P[n][u]],t[P[0][n]]=t[P[1][n]],t[P[u+1][n]]=t[P[u][n]]}var r=P[0][u+1];t[0]=(t[1]+t[p])/2,t[r]=(t[1+r]+t[P[u][0]])/2,t[u+1]=(t[u]+t[u+1+p])/2,t[u+1+r]=t[u+r]+t[P[u+1][u]]},D=void 0,F=Object(o.b)();return function(){for(var f=arguments.length,p=new Array(f),w=0;w<f;w++)p[w]=arguments[w];p[4].length<=1&&function(){for(A(),E=0;E<v;E++)j[E]=g[E]=O[E]=b[E]=m[E]=y[E]=k[E]=0}();var x=p[0],S=p[1];l=s.a.apply(void 0,[n].concat(p)),x=Object(o.a)(F,x,p.slice(1));var T=p[6];T.smokeResolution=u,T.D=b,T.IX=P;var C=e&&s.a.apply(void 0,[e].concat(p));if(C&&0!==Object.keys(C).length){var N=Object.keys(C).map(function(e){return C[e]}).filter(function(e){return e});if(N[0]){var I=N[0],q=I.x,_=I.y;D||(D=[q,_]),A(j,g,O);var L=D[0]-q,B=D[1]-_,z=0|Math.pow(L*L+B*B,s.a.apply(void 0,[a].concat(p)));for(z=z<1?1:z,E=0;E<z;E++){var J=(D[0]-E/z*L)*h|0,V=(D[1]-E/z*B)*d|0;Q=P[J][V],m[Q]=-L/6,y[Q]=-B/6,b[Q]=50}D[0]=q,D[1]=_}}else D=void 0;var H,U=c(s.a.apply(void 0,[t].concat(p)));try{for(U.s();!(H=U.n()).done;){var G=H.value,W=s.a.apply(void 0,[G[0]].concat(p))*h|0,K=s.a.apply(void 0,[G[1]].concat(p))*d|0,Q=P[W][u-K];m[Q]=s.a.apply(void 0,[G[2]].concat(p)),y[Q]=-1*s.a.apply(void 0,[G[3]].concat(p)),0}}catch(oe){U.e(oe)}finally{U.f()}M(m,y,g,O,.1),R(b,j,m,y,.1);var Z={};for(var Y in x){var $=x[Y],X=$.x,ee=$.y;if(!isNaN(X)&&!isNaN(ee)){var te=Math.floor(X*u/(i.c-i.b)),ne=Math.floor(ee*u/(i.a-i.b)),re=(Q=P[Math.min(te,u)][Math.min(ne,u)],m[Q]),ae=y[Q],ie=x[Y].density||1;Z[Y]=Object(r.a)({},$,{x:X+S/ie*10*re,y:ee+S/ie*10*ae})}}return Z}}},,function(e,t,n){},,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},,,,,,,,,,,,,,,,,,,function(e,t){},,,,,,,,,,,,function(e,t){},,function(e,t){},,,,,,,,,,,function(e,t){},,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},,,,,,,,,,,,,,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},,function(e,t){},,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(831),u=n(153),l=n(157),f=n(149),h=n(821),d=n(119),p=n(222),v=n(142),m=n(122),y=new h.a,b=function(){function e(t){Object(o.a)(this,e),this.web3=t,this.root=new c.a,this.contract=y.getContract(t),this.contractAddress=y.contractAddress,this.isLoaded=!1}return Object(s.a)(e,[{key:"syncFolders",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){var i,o;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.root.getJson(),t.next=3,m.a.addJson(i);case 3:o=t.sent,new l.a(f.f,"foldersUpdated",[Object(u.b)(o)]).execute().then(function(e){return n()});case 5:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"loadFolders",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new v.a(this.contractAddress).from(d.d).select("foldersHash"),e.next=3,t.executeQuery();case 3:if(0!==(n=e.sent).length){e.next=6;break}return e.abrupt("return");case 6:return r=n[0].foldersHash,e.next=9,m.a.getJson(r);case 9:i=e.sent,this.root.fromJson(i,function(e){return(new p.a).fromJson(e)}),this.isLoaded=!0;case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=b},,function(e,t,n){"use strict";n(4)},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sampleHashes",type:"bytes32[16]"},{name:"titles",type:"bytes32[16]"},{name:"youtubeVideoIds",type:"bytes32[16]"},{name:"coverArtHashes",type:"bytes32[16]"},{name:"discogIds",type:"uint256[16]"},{name:"tagsToAdd",type:"bytes32[4][16]"},{name:"stylesToAdd",type:"bytes32[4][16]"},{name:"countries",type:"bytes32[16]"},{name:"sampleYears",type:"int16[16]"}],name:"newSampleWithMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleHashes",type:"bytes32[16]"}],name:"test2",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"c",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"discogsId",type:"uint256"},{indexed:!0,name:"coverArtHash",type:"bytes32"}],name:"NewDiscogsSample",type:"event"}],this.contractAddress="0x18d2c1f1f70ecbeb6366c65cef684e229ff6d6b9"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(42),o=n.n(i),s=n(56),c=n(4),u=n(5),l=n(536),f=n(119),h=n(142),d=n(159),p=n(157),v=n(149),m=(n(127),n(233),n(153)),y=new l.a,b=function(){function e(t){Object(c.a)(this,e),this.web3=t,this.contract=new t.eth.Contract(y.abi,y.contractAddress),this.contractAddress=this.contract.options.address,this.zero=this.web3.utils.padRight("0x00",64)}return Object(u.a)(e,[{key:"saveNewSequence",value:function(e,t,n,r,a){var i=this;return new Promise(function(){var c=Object(s.a)(o.a.mark(function s(c,u){var l,f;return o.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,d.a.getAccount();case 2:for(f in void 0===o.sent&&c(),l=[],r)l.push(Object(m.b)(r[f]));e=void 0===e?i.zero:Object(m.b)(e),t=Object(m.b)(t),l.push(e),new p.a(v.r,"editSequence",[e,t,n,l,a]).execute().then(function(e){return c}).catch(function(e){return u});case 10:case"end":return o.stop()}},s)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"getSequences",value:function(e,t,n,r){var i=this;return new Promise(function(){var c=Object(s.a)(o.a.mark(function s(c,u){var l,d;return o.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return l=new h.a(i.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").fromBlock(t).toBlock(n).from(f.ib),void 0!==e&&l.where("user",e.toLowerCase()),r&&l.whereIn("newSequence",r),o.next=5,l.executeQuery(!1);case 5:(d=o.sent).sort(function(e,t){return t.blockNumber-e.blockNumber}),c(d.map(function(e){return Object(a.a)({},e,{edits:0})}));case 8:case"end":return o.stop()}},s)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"getNextSequences",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(o.a.mark(function e(r,i){var s,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=new h.a(n.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").where("previousSequence",t).from(f.ib),e.next=3,s.executeQuery();case 3:c=e.sent,r(c.map(function(e){return Object(a.a)({},e,{edits:0})}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPreviousSequences",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(o.a.mark(function e(i,s){var c,u,l;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=new h.a(n.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").where("newSequence",t).from(f.ib),e.next=3,c.executeQuery();case 3:if(0!==(u=(u=e.sent).map(function(e){return Object(a.a)({},e,{edits:0,isPrevious:!0})})).length&&u[0].previousSequence!==t){e.next=9;break}i(u),e.next=20;break;case 9:return l=u[0].previousSequence,e.t0=i,e.t1=[],e.t2=Object(r.a)(u),e.t3=r.a,e.next=16,n.getPreviousSequences(l);case 16:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t6=e.t1.concat.call(e.t1,e.t2,e.t5),(0,e.t0)(e.t6);case 20:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSequence",value:function(){var e=Object(s.a)(o.a.mark(function e(t){var n=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(o.a.mark(function e(r,i){var s,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=new h.a(n.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").where("newSequence",t).from(f.ib),e.next=3,s.executeQuery();case 3:c=e.sent,r(c.map(function(e){return Object(a.a)({},e,{edits:0})}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"watchBalance",value:function(){var e=Object(s.a)(o.a.mark(function e(){var t,n=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.getAccount();case 2:if(void 0!==(t=e.sent)){e.next=5;break}return e.abrupt("return");case 5:new h.a(this.contract.options.address).from(f.jb).select("amount").where("toUser",t.toLowerCase()).watchQuery(function(e){n.callback&&n.callback()});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=b},function(e,t,n){"use strict";var r=n(4);t.a=function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32"},{name:"endMilliseconds",type:"int32"}],name:"newSlice",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32[16]"},{name:"endMilliseconds",type:"int32[16]"}],name:"newSlices16",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32[4]"},{name:"endMilliseconds",type:"int32[4]"}],name:"newSlices4",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32[8]"},{name:"endMilliseconds",type:"int32[8]"}],name:"newSlices8",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"tag",type:"bytes32"},{name:"startMilliseconds",type:"int32"},{name:"endMilliseconds",type:"int32"}],name:"newTaggedSlice",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"tag",type:"bytes32"},{indexed:!1,name:"startMilliseconds",type:"int32"},{indexed:!1,name:"endMillisconds",type:"int32"}],name:"SliceCreated",type:"event"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"}],this.contractAddress="0xf68a5fccacd945904dbcc675752987c72f7d5bed"}},function(e,t,n){"use strict";var r=n(1),a=n(42),i=n.n(a),o=n(56),s=n(4),c=n(5),u=n(820),l=n(157),f=n(149),h=n(153),d=n(159),p=n(542),v=n(142),m=n(119),y=function(){function e(t,n){Object(s.a)(this,e),this.contract=(new u.a).getContract(t),this.web3=t,this.crypto=n,this.NULL_BYTES32=this.web3.utils.padLeft("0x0",64),this.cachedResults={}}return Object(c.a)(e,[{key:"getPublicKey",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(r,a){var o,s,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=7;break}return e.next=3,d.a.getAccount();case 3:if(void 0!==(t=e.sent)){e.next=7;break}return r(void 0),e.abrupt("return");case 7:return o=new v.a(n.contract.options.address).from(m.C).select("publicKey").where("user",t.toLowerCase()),e.next=10,o.executeQuery();case 10:if(0!==(s=e.sent).length){e.next=14;break}return r(void 0),e.abrupt("return");case 14:c="0x"+n.stripTrailingZeroes(s[0].publicKey),r(n.web3.utils.toAscii(c));case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getEncryptedContent",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n,r){var a,s,c=this,u=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]?u[3]:2,s=u.length>4?u[4]:void 0,e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(o,u){var l,f,h,d,p,y;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in c.cachedResults)){e.next=3;break}return o(c.cachedResults[t]),e.abrupt("return");case 3:return e.next=5,new v.a(c.contract.options.address).from(m.n).select("newContent").select("user").select("previousContent").select("contentType").select("encryptedName").select("publicKey").select("encryptedContentKey").select("publicKey").fromBlock(a).toBlock(s);case 5:return l=e.sent,void 0!==r&&l.where("user",r.toLowerCase()),void 0!==t&&l.where("newContent",t),f=(new Date).getTime(),e.next=11,l.executeQuery();case 11:if(h=e.sent,d=(new Date).getTime(),d-f,0!==h.length){e.next=17;break}return o(void 0),e.abrupt("return");case 17:p=[],e.t0=i.a.keys(h);case 19:if((e.t1=e.t0()).done){e.next=28;break}return y=e.t1.value,e.t2=p,e.next=24,c.convertLogResult(h[y],n);case 24:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=19;break;case 28:(new Date).getTime(),d-f,c.cachedResults[t]=p,o(p);case 32:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getEncryptedContentSharedWithMe",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a,o,s,c,u,l,f;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.cachedResults)){e.next=2;break}return e.abrupt("return",this.cachedResults[t]);case 2:return e.next=4,d.a.getAccount();case 4:return r=e.sent,a=new v.a(this.contract.options.address).from(m.c).select("encryptedContentKey").select("publicKey").select("contentHash").select("creator").where("sharedWith",r.toLowerCase()),void 0!==t&&a.where("contentHash",t),o=(new Date).getTime(),e.next=10,a.executeQuery();case 10:if(s=e.sent,c=(new Date).getTime(),c-o,0!==s.length){e.next=15;break}return e.abrupt("return",void 0);case 15:u=[],e.t0=i.a.keys(s);case 17:if((e.t1=e.t0()).done){e.next=26;break}return l=e.t1.value,e.t2=u,e.next=22,this.convertSharedLogResult(s[l],!1,n);case 22:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=17;break;case 26:return f=(new Date).getTime(),f-o,this.cachedResults[t]=u,e.abrupt("return",u);case 30:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getEncryptedSequenceIfAny",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:2,a=o.length>3?o[3]:void 0,e.next=4,this.getEncryptedContent(t,void 0,n,r,a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSequencesSharedWithUser",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n,r){var a,o,s,c,u;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.getAccount();case 2:return a=e.sent,o=new v.a(this.contract.options.address).from(m.c).select("encryptedContentKey").select("publicKey").select("contentHash").select("creator").where("sharedWith",a.toLowerCase()),void 0!==t&&o.where("contentHash",t),n&&o.fromBlock(n),r&&o.toBlock(r),e.next=9,o.executeQuery();case 9:s=e.sent,c=[],e.t0=i.a.keys(s);case 12:if((e.t1=e.t0()).done){e.next=21;break}return u=e.t1.value,e.t2=c,e.next=17,this.convertSharedLogResult(s[u]);case 17:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=12;break;case 21:return e.abrupt("return",c);case 22:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"convertSharedLogResult",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,a,o,s,c,u=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(u.length>1&&void 0!==u[1])||u[1],e.next=3,this.crypto.decryptContentKey(t.encryptedContentKey);case 3:if(a=e.sent,o=this.stripTrailingZeroes(t.publicKey),{user:t.creator,contentHash:t.contentHash,publicKey:o,contentKey:a?a.contentKey:void 0},s={},c="",!n){e.next=15;break}return e.next=11,this.getEncryptedSequenceIfAny(t.contentHash);case 11:return s=e.sent,e.next=14,this.crypto.decryptName(s[0].encryptedTitle,this.stripTrailingZeroes(t.encryptedContentKey));case 14:c=e.sent;case 15:return e.abrupt("return",Object(r.a)({},s[0],{title:c,publicKey:o,contentKey:a?a.contentKey:void 0}));case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"convertLogResult",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a,o,s,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.stripTrailingZeroes(t.encryptedContentKey),e.next=3,this.crypto.decryptName(t.encryptedName,r,n);case 3:return a=e.sent,o=t.user,e.next=7,this.crypto.decryptContentKey(r,n);case 7:return s=e.sent,c={title:this.stripTrailingZeroes(a),encryptedTitle:t.encryptedName,user:"0x"+this.stripLeadingZeroes(o.slice(2)),previousSequence:t.previousContent,newSequence:t.newContent,contentType:t.contentType,contentKey:s?s.contentKey:void 0,blockNumber:t.blockNumber,publicKey:this.stripTrailingZeroes(t.publicKey)},e.abrupt("return",c);case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newPublicKey",value:function(e){return new Promise(function(){var t=Object(o.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new l.a(f.d,"setPublicKey",[e]).execute().then(function(){return n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"newEncryptedSequence",value:function(e,t,n,r,a){var s=this;return new Promise(function(){var c=Object(o.a)(i.a.mark(function o(c,u){return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e=void 0===e?s.web3.utils.padLeft("0x0",64):Object(h.b)(e),t=Object(h.b)(t),n=s.web3.utils.padLeft("0x"+n,64),new l.a(f.d,"newEncryptedContent",[e,t,n,p.a,r,a]).execute().then(function(){return c()});case 4:case"end":return i.stop()}},o)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"newEncryptedContent",value:function(e,t,n,r,a){var s=this;return new Promise(function(){var c=Object(o.a)(i.a.mark(function o(c,u){return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e=Object(h.b)(e),t=s.web3.utils.padLeft("0x"+t,64),new l.a(f.d,"newEncryptedContent",[s.NULL_BYTES32,e,t,r,n,a]).execute().then(function(){return c()});case 3:case"end":return i.stop()}},o)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"shareEncryptedContent",value:function(e,t,n,r){return new Promise(function(){var a=Object(o.a)(i.a.mark(function a(o,s){return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t=Object(h.b)(t),new l.a(f.d,"shareEncryptedContentWith",[e,t,n,r]).execute().then(function(){return o()});case 2:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"stripTrailingZeroes",value:function(e){for(var t=e.length-1;t>=0;t--)if("0"!==e.slice(t,t+1))return e.slice(0,t+1)}},{key:"stripLeadingZeroes",value:function(e){for(var t=0;t<e.length;t++)if("0"!==e.slice(t,t+1))return e.slice(t)}},{key:"getPotentialUsers",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new v.a(this.contract.options.address).from(m.C).select("user"),e.next=3,t.executeQuery();case 3:return n=e.sent,r=Array.from(new Set(n.map(function(e){return e.user}))),e.abrupt("return",r.filter(function(e){return void 0!==e}));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=y},function(e,t,n){"use strict";var r=n(4);t.a=function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"}],name:"newIndex",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!1,name:"sampleHash",type:"bytes32"}],name:"NewIndex",type:"event"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{constant:!0,inputs:[],name:"getIndex",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"}],this.contractAddress="0xb05e78e48dc17fff1b52307e240cab6b241fe288"}},function(e,t,n){"use strict";var r=n(4);t.a=function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"previousSequences",type:"bytes32[4]"},{name:"newSequence",type:"bytes32"},{name:"diff",type:"bytes32"},{name:"title",type:"string"}],name:"editCompoundSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"previousSequence",type:"bytes32"},{name:"newSequence",type:"bytes32"},{name:"diff",type:"bytes32"},{name:"title",type:"string"}],name:"editSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"userEditing",type:"address"},{indexed:!0,name:"previousSequence",type:"bytes32"},{indexed:!0,name:"newSequence",type:"bytes32"},{indexed:!1,name:"diffHash",type:"bytes32"},{indexed:!1,name:"title",type:"string"}],name:"SequenceEdited",type:"event"}],this.contractAddress="0x16687b7db5994ac1aa22594be04af8396f5085dd"}},function(e,t,n){"use strict";var r=n(1),a=n(42),i=n.n(a),o=n(56),s=n(4),c=n(5),u=n(819),l=n(826),f=n(127),h=n(20),d=n(836),p=n(159),v=n(142),m=n(157),y=n(149),b=n(119),g=n(153),O=n(542);function j(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var w=new(n(307).a),x=(new l.a).contractAddress,S={},P=function(){function e(t,n,r){Object(s.a)(this,e),this.web3=t,this.contract=(new u.a).getContract(t),this.users=new d.a(t),this.crypto=n,this.encryption=r,this.guildKeyCache={},this.guildIdCache={},this.guildsWithAccess=void 0}return Object(c.a)(e,[{key:"initGuilds",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getGuildsForUser();case 2:return this.guilds=e.sent,e.next=5,p.a.getAccount();case 5:if(void 0!==(t=e.sent)){e.next=8;break}return e.abrupt("return");case 8:if(navigator.onLine){e.next=10;break}return e.abrupt("return");case 10:new v.a(this.contract.options.address).from(b.o).select("guildId").where("user",t.toLowerCase()).watchQuery(function(){n.newGuildCallback&&n.newGuildCallback()});case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"saveGuildKey",value:function(e,t){this.guildKeyCache[e]=t}},{key:"getGuildKey",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r,a=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.guildKeyCache)){e.next=5;break}return n=this.guildKeyCache[t],e.next=4,n;case 4:return e.abrupt("return",e.sent);case 5:return r=new Promise(function(){var e=Object(o.a)(i.a.mark(function e(n,r){var o,s,c,u,l,f,h,d;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((new Date).getTime(),void 0!==t){e.next=9;break}return e.next=4,a.getGuildsForUser();case 4:if(0!==(o=e.sent).length){e.next=8;break}return n(void 0),e.abrupt("return");case 8:t=o[0].guildId;case 9:return e.next=11,p.a.getAccount();case 11:if(void 0!==(s=e.sent)){e.next=15;break}return n(void 0),e.abrupt("return");case 15:return console.log("gettinng gulkd key ecrypted"),e.next=18,new v.a(a.contractAddress).from(b.e).select("ipfsHash").where("user",s.toLowerCase()).where("guildId",t).executeQuery();case 18:if(c=e.sent,console.log("results gguild=",c),0!==c.length){e.next=24;break}return delete a.guildKeyCache[t],n(void 0),e.abrupt("return");case 24:return u=c[0].ipfsHash,l=(new Date).getTime(),e.next=28,a.encryption.getEncryptedContent(u);case 28:if(void 0!==(f=e.sent)){e.next=33;break}return e.next=32,a.encryption.getEncryptedContentSharedWithMe(u);case 32:f=e.sent;case 33:if(console.log("encrypted content meta=",f),h=(new Date).getTime(),h-l,void 0!==f){e.next=40;break}return delete a.guildKeyCache[t],n(void 0),e.abrupt("return");case 40:return e.prev=40,e.t0=JSON,e.next=44,a.crypto.fetchAndDecrypt(u,f);case 44:e.t1=e.sent,d=e.t0.parse.call(e.t0,e.t1),(new Date).getTime(),h-l,n(a.crypto.parseGuildKey(d)),e.next=55;break;case 51:e.prev=51,e.t2=e.catch(40),console.log("error while decryptoing",e.t2),n(void 0);case 55:case"end":return e.stop()}},e,null,[[40,51]])}));return function(t,n){return e.apply(this,arguments)}}()),this.guildKeyCache[t]=r,e.next=9,r;case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newGuildWithPeople",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a=this,s=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:Object(h.uuid)(),e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(o,s){var c,u,l,f,h,d,p,v,b,O,k,w,x,S,P;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.crypto.generateGuildKey(r);case 2:return c=e.sent,c.privateKey,u=c.publicKey,e.next=7,a.crypto.encryptAndUploadJSON(c);case 7:l=e.sent,f=l.encryptedContentKey,h=l.encryptedContentIpfsHash,d=l.publicKey,p=[],v=[],b=[],O=j(n),e.prev=15,O.s();case 17:if((k=O.n()).done){e.next=31;break}return w=k.value,e.next=21,a.encryption.getPublicKey(w);case 21:return x=e.sent,e.next=24,a.crypto.encryptAndUploadJSON(c,x);case 24:S=e.sent,P=S.contentKey,p.push(Object(g.b)(S.encryptedContentIpfsHash)),v.push(P.convertForEthereum()),b.push(P.getPublicKeyAsBytes32());case 29:e.next=17;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(15),O.e(e.t0);case 36:return e.prev=36,O.f(),e.finish(36);case 39:new m.a(y.k,"createGuildWithPeople",[u,t,Object(g.b)(h),f,d]).execute().then(function(e){o()});case 40:case"end":return e.stop()}},e,null,[[15,33,36,39]])}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newGuild",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r=this,a=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:Object(h.uuid)(),e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(a,o){var s,c,u,l,f,h;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.crypto.generateGuildKey(n);case 2:return s=e.sent,s.privateKey,c=s.publicKey,e.next=7,r.crypto.encryptAndUploadJSON(s);case 7:u=e.sent,l=u.encryptedContentKey,f=u.encryptedContentIpfsHash,h=u.publicKey,new m.a(y.g,"newGuild",[c,t,Object(g.b)(f),l,h]).execute().then(function(e){a(s)});case 12:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"requestToAddMember",value:function(e,t){var n=this;return new Promise(function(){var r=Object(o.a)(i.a.mark(function r(a,o){var s,c,u,l;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.getGuildKey(e);case 2:return s=r.sent,r.next=5,n.encryption.getPublicKey(t);case 5:return c=r.sent,r.next=8,n.crypto.encryptAndUploadJSON(s,c);case 8:u=r.sent,l=u.contentKey,new m.a(y.g,"requestToAddMember",[e,t,Object(g.b)(u.encryptedContentIpfsHash),l.convertForEthereum(),l.getPublicKeyAsBytes32()]).execute().then(function(e){a()});case 11:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"leaveGuild",value:function(e){return new Promise(function(){var t=Object(o.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new m.a(y.k,"leaveGuild",[e]).execute().then(function(e){n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"voteForProposal",value:function(e,t,n){var r=this;return new Promise(function(){var a=Object(o.a)(i.a.mark(function a(o,s){return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=r.contract.methods.voteOnNewGuildMemberProposal(e,t,n),a.next=3,p.a.getAccount();case 3:a.t1=a.sent,a.t2={from:a.t1},a.t3=function(e,t){e?s(e):o()},a.t0.send.call(a.t0,a.t2,a.t3);case 7:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"getAllGuildMemberProposals",value:function(){var e=this;return new Promise(function(){var t=Object(o.a)(i.a.mark(function t(n,r){var a,o,s,c,u,l;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getGuildsForUser();case 2:a=t.sent,o=[],t.t0=i.a.keys(a);case 5:if((t.t1=t.t0()).done){t.next=14;break}return s=t.t1.value,c=a[s].guildId,t.next=10,e.getGuildMemberProposals(c);case 10:for(l in u=t.sent)o.push({guildId:c,proposalIndex:l,potentialMember:u[l]});t.next=5;break;case 14:n(o);case 15:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getGuildMemberProposals",value:function(e){var t=this;return new Promise(function(){var n=Object(o.a)(i.a.mark(function n(r,a){var o,s,c,u,l;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:return o=n.sent,n.next=5,t.contract.methods.getTotalGuildMemberProposals(e).call({from:o[0]});case 5:s=n.sent,c=[],u=0;case 8:if(!(u<s)){n.next=16;break}return n.next=11,t.contract.methods.getNewGuildMemberProposal(e,u).call({from:o[0]});case 11:l=n.sent,c.push(l);case 13:u++,n.next=8;break;case 16:r(c);case 17:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"contractAddress",get:function(){return this.contract.options.address}},{key:"getNewMemberRequestsFromGuild",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r,a,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getAccount();case 2:if(void 0!==e.sent){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,new v.a(this.contractAddress).from(b.q).select("newMember").where("guildId",t).executeQuery(!1);case 7:return n=e.sent,e.next=10,new v.a(this.contractAddress).from(b.r).select("newMember").where("guildId",t).executeQuery(!1);case 10:return r=e.sent,e.next=13,new v.a(this.contractAddress).from(b.s).select("newMember").where("guildId",t).executeQuery(!1);case 13:return a=e.sent,o=n.filter(function(e){return!r.some(function(t){return e.newMember===t.newMember})&&!a.some(function(t){return e.newMember===t.newMember})}),e.abrupt("return",o);case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptAnyNewRequests",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.a.isLoggedIn()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.getNewMemberRequests();case 4:e.sent.forEach(function(e){var n=e.guildId;return t.acceptRequestToAddToGuild(n)});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getNewMemberRequests",value:function(){var e=this;return new Promise(function(){var t=Object(o.a)(i.a.mark(function t(n,r){var a,o,s,c,u,l,f,h,d,m;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.a.getAccount();case 2:if(void 0!==(a=t.sent)){t.next=6;break}return n([]),t.abrupt("return");case 6:return t.next=8,new v.a(e.contractAddress).from(b.q).select("guildId").select("requester").where("newMember",a.toLowerCase()).executeQuery(!1);case 8:for(c in o=t.sent,s={},o)s[o[c].guildId]={requester:o[c].requester,blockNumber:o[c].blockNumber};return s=e.reduceMap(s),t.next=14,new v.a(e.contractAddress).from(b.r).select("guildId").where("newMember",a.toLowerCase()).executeQuery(!1);case 14:return u=(u=t.sent).map(function(e){return e.guildId}),t.next=18,new v.a(e.contractAddress).from(b.s).select("guildId").where("newMember",a.toLowerCase()).executeQuery(!1);case 18:l=(l=t.sent).map(function(e){return e.guildId}),f=[],t.t0=i.a.keys(s);case 22:if((t.t1=t.t0()).done){t.next=38;break}if(h=t.t1.value,d=e.countOccurences(u,parseInt(h)),m=e.countOccurences(l,parseInt(h)),!(s[h].count>d+m)){t.next=36;break}return t.t2=f,t.t3=parseInt(h),t.next=31,e.getGuildName(parseInt(h));case 31:t.t4=t.sent,t.t5=s[h].requester,t.t6=s[h].blockNumber,t.t7={guildId:t.t3,guildName:t.t4,requester:t.t5,blockNumber:t.t6},t.t2.push.call(t.t2,t.t7);case 36:t.next=22;break;case 38:n(f);case 39:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"reduceMap",value:function(e){var t={};for(var n in e){for(var r in t)r!==n||t[r].count++;t[n]=e[n],t[n].count=1}return t}},{key:"countOccurences",value:function(e,t){var n=0;for(var r in e)e[r]===t&&n++;return n}},{key:"rejectRequestToAddToGuild",value:function(e){return new Promise(function(){var t=Object(o.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new m.a(y.g,"rejectRequestToAddToGuild",[e]).execute().then(function(e){n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"acceptRequestToAddToGuild",value:function(e){return new Promise(function(){var t=Object(o.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new m.a(y.g,"acceptRequestToAddToGuild",[e]).execute().then(function(e){n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getAllMembersInUsersGuilds",value:function(e){var t=this;return new Promise(function(){var n=Object(o.a)(i.a.mark(function n(a,o){var s,c,u,l,f;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p.a.getAccount();case 2:return s=n.sent,n.next=5,t.getGuildsForUser(e);case 5:c=n.sent,u=[],l=i.a.mark(function e(n){var a,o,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=c[n],o=a.guildId,e.next=4,t.getUsersInGuild(o);case 4:l=(l=(l=e.sent).filter(function(e){return e.userId!==s})).map(function(e){return Object(r.a)({},e,{guildId:o,guildName:a.name})}),u=u.concat(l);case 8:case"end":return e.stop()}},e)}),n.t0=i.a.keys(c);case 9:if((n.t1=n.t0()).done){n.next=14;break}return f=n.t1.value,n.delegateYield(l(f),"t2",12);case 12:n.next=9;break;case 14:a(u);case 15:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getGuildsUserLeft",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return e.next=3,p.a.getAccount();case 3:t=e.sent;case 4:return n=new v.a(x).from(b.kb).select("guildId"),e.next=7,n.executeQuery();case 7:return r=e.sent,e.abrupt("return",r.map(function(e){return e.guildId}));case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGuildsForUser",value:function(e){var t=this;!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(function(){var n=Object(o.a)(i.a.mark(function n(r,a){var o,s,c,u,l,f,h,d,m;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p.a.getAccount();case 2:if(o=n.sent,void 0===e&&(e=o),void 0!==e){n.next=7;break}return r([]),n.abrupt("return");case 7:return n.next=9,t.getGuildsUserLeft(o);case 9:return s=n.sent,[],c=new v.a(t.contract.options.address).from(b.e).select("guildId").where("user",e.toLowerCase()),n.next=14,c.executeQuery(!1);case 14:u=n.sent,l={},n.t0=i.a.keys(u);case 17:if((n.t1=n.t0()).done){n.next=26;break}return f=n.t1.value,h=u[f].guildId,n.next=22,t.getGuildName(h);case 22:d=n.sent,l[h]=d,n.next=17;break;case 26:m=Object.keys(l).filter(function(e){return!s.includes(parseFloat(e))}).map(function(e){return{guildId:parseInt(e),name:l[e]}}),r(m);case 28:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"hasAccessTo",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,this.getGuildsWithAccess();case 4:return n=e.sent,e.abrupt("return",n.indexOf(t)>-1);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGuildsWithAccess",value:function(e){var t=this;return new Promise(function(){var n=Object(o.a)(i.a.mark(function n(r,a){var o,s,c;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0===t.guildsWithAccess){n.next=3;break}return r(t.guildsWithAccess),n.abrupt("return");case 3:return n.next=5,p.a.getAccount();case 5:if(o=n.sent,void 0===e&&(e=o),void 0!==e){n.next=11;break}return t.guildsWithAccess=[],r([]),n.abrupt("return");case 11:return[],s=new v.a(t.contract.options.address).from(b.e).select("guildId").where("user",e.toLowerCase()),n.next=15,s.executeQuery(!1);case 15:c=n.sent,t.guildsWithAccess=Array.from(new Set(c.map(function(e){return e.guildId}))),r(t.guildsWithAccess);case 18:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getGuildName",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,r=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return","");case 2:if(!(t in S)){e.next=6;break}return e.next=5,S[t];case 5:return e.abrupt("return",e.sent);case 6:return n=new Promise(function(){var e=Object(o.a)(i.a.mark(function e(n,a){var o,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=new v.a(r.contract.options.address).from(b.o).select("name").where("guildId",t),e.next=3,o.executeQuery(!1);case 3:if(0!==(s=e.sent).length){e.next=6;break}return e.abrupt("return","");case 6:n(s[0].name);case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),S[t]=n,e.next=10,n;case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUsersInGuild",value:function(e){var t=this;return new Promise(function(){var n=Object(o.a)(i.a.mark(function n(r,a){var o,s,c,u,l;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(navigator.onLine){n.next=3;break}return r([]),n.abrupt("return");case 3:return n.next=5,p.a.getAccount();case 5:return n.sent,o=[],n.prev=7,n.next=10,t.contract.methods.getTotalGuildUsers(e).call();case 10:s=n.sent,c=0;case 12:if(!(c<s)){n.next=23;break}return n.next=15,t.contract.methods.getUserFromGuild(e,c).call();case 15:return u=n.sent,n.next=18,t.users.getUserName(u);case 18:l=n.sent,o.push({userId:u,userName:l});case 20:c++,n.next=12;break;case 23:n.next=27;break;case 25:n.prev=25,n.t0=n.catch(7);case 27:r(o);case 28:case"end":return n.stop()}},n,null,[[7,25]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"setGuildName",value:function(e,t){var n=this;return new Promise(function(){var r=Object(o.a)(i.a.mark(function r(a,o){var s;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.web3.eth.getAccounts();case 2:s=r.sent,n.contract.methods.setNameForGuild(e,t).send({from:s[0]},function(e,t){e?o(e):a()});case 4:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getContentGuildId",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var r,a,o,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.guildIdCache)){e.next=2;break}return e.abrupt("return",this.guildIdCache[t]);case 2:if(n!==O.b){e.next=16;break}return r=new v.a(w.contractAddress).from(b.V).select("guildId").where("ipfsHash",t),e.next=6,r.executeQuery(!1);case 6:if(0!==(a=e.sent).length){e.next=10;break}return this.guildIdCache[t]=0,e.abrupt("return",0);case 10:return o=null===(o=a[0].guildId)||void 0===o?0:o,this.guildIdCache[t]=o,e.abrupt("return",o);case 16:return e.next=18,f.a.guildSequences.getGuildSequence(t);case 18:if(!(s=e.sent)){e.next=21;break}return e.abrupt("return",s.guildId);case 21:return e.abrupt("return",0);case 22:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onUserChanged",value:function(){this.guildsWithAccess=void 0,this.getGuildsWithAccess()}},{key:"getPeople",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n,r,a,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(this.contractAddress).from(b.e).select("user").executeQuery();case 2:t=e.sent,n=[],e.t0=i.a.keys(t);case 5:if((e.t1=e.t0()).done){e.next=14;break}return r=e.t1.value,a=t[r].user,e.next=10,this.users.getUserName(a);case 10:o=e.sent,n.push({id:a,userName:o}),e.next=5;break;case 14:return e.abrupt("return",n);case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=P},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(142),u=n(199),l=n(153),f=n(119),h=n(157),d=n(149),p=new(n(307).a),v=function(){function e(t){Object(o.a)(this,e),this.web3=t,this.contract=new t.eth.Contract(p.abi,p.contractAddress)}return Object(s.a)(e,[{key:"address",get:function(){return this.contract.options.address}},{key:"getGuildIdForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new c.a(this.address).from(f.V).select("guildId").where("ipfsHash",t).executeQuery();case 2:if(n=e.sent,null!==(r=n.map(function(e){return e.guildId})[0])&&void 0!==r){e.next=6;break}return e.abrupt("return",0);case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getMetadataForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new c.a(this.address).from(n).where("ipfsHash",t);case 2:return i=e.sent,r.forEach(function(e){return i.select(e)}),e.next=6,i.executeQuery();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getTagsForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,f.Z,["tag"]);case 2:return n=e.sent,e.abrupt("return",Array.from(new Set(n.map(function(e){return e.tag}))));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTitleForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,f.V,["title"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].title);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getStylesForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,f.Y,["style"]);case 2:return n=e.sent,e.abrupt("return",Array.from(new Set(n.map(function(e){return e.style}))));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCountryForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,f.U,["country"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].country);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getYearForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,f.cb,["year"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].year);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getYoutubeIdForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,f.db,["videoId"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].videoId);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getDiscogsData",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,f.l,["covertArtHash, discogsId"]);case 2:return n=e.sent,e.abrupt("return",n[0]||{coverArtHash:void 0,discogsId:void 0});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveSample",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,l,f,h,d,p,v;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getId(),r=new u.a(t.audioBuffer.numberOfChannels,function(){return[]}),e.next=4,r.uploadBufferToIpfs(t.audioBuffer);case 4:return i=e.sent,e.next=7,this.getTagsForSound(n);case 7:return o=e.sent,e.next=10,this.getTitleForSound(n);case 10:return s=e.sent,e.next=13,this.getStylesForSound(n);case 13:return c=e.sent,e.next=16,this.getCountryForSound(n);case 16:return l=e.sent,e.next=19,this.getYearForSound(n);case 19:return f=e.sent,e.next=22,this.getDiscogsData(n);case 22:return h=e.sent,d=h.coverArtHash,p=h.discogsId,e.next=27,this.getYoutubeIdForSound(n);case 27:return v=e.sent,this.newSampleWithMetadata(i,{title:s,youtubeId:v,tags:o,styles:c,country:l,year:f,guildId:0,discogsId:p,coverArtHash:d}),e.abrupt("return",i);case 30:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newSampleWithMetadata",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(a.a.mark(function e(i,o){var s,c,u,f,p,v,m,y,b,g,O,j,k,w;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(s=n.title,c=n.youtubeId,u=n.tags,f=n.styles,p=n.country,v=n.year,m=n.guildId,y=n.discogsId,b=n.coverArtHash,g=r.web3,O=g.utils.padLeft("0x0",64),void 0===u&&(u=[]),u.length>4&&(u=u.slice(0,4)),f.length>4&&(f=f.slice(0,4)),j=u.length;j<4;j++)u.push(null);for(k=f.length;k<4;k++)f.push(null);u=u.map(function(e){return e?g.utils.fromAscii(e):O}),f=f.map(function(e){return e?g.utils.fromAscii(e):O}),p=p?g.utils.fromAscii(p):O,c=c?g.utils.fromAscii(c):O,b=b?Object(l.b)(b):O,t=Object(l.b)(t),w=[t,s,c,u,f,p,void 0===v?0:v,void 0===y?0:y,b,m],new h.a(d.i,"newSampleWithMetadata",w).execute().then(function(){return i()});case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.a=v},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(1),o=n(56),s=n(4),c=n(5),u=n(818),l=n(206),f=n(159),h=n(153),d=n(157),p=n(149),v=n(142),m=n(119),y=n(837),b=n(122),g=new u.a,O=function(){function e(t,n,r,a){Object(s.a)(this,e),this.web3=t,this.encryption=r,this.crypto=a,this.guilds=n,this.contract=g.getContract(t),this.contractAddress=g.contractAddress,this.NULL_BYTES_32=t.utils.padLeft("0x0",64)}return Object(c.a)(e,[{key:"newGuildSequence",value:function(e,t,n,r){var s=this;return new Promise(function(){var c=Object(o.a)(a.a.mark(function o(c,u){var v,m,y,g,O,j,k;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s.guilds.getGuildKey(r);case 2:return v=a.sent,m=v.rawPublicKey,a.next=6,s.crypto.encryptRawContent(JSON.stringify(e),t,m);case 6:return y=a.sent,y.contentKey.contentKey,a.next=10,b.a.addJson(y.encryptedContent);case 10:return g=a.sent,a.next=13,f.a.getAccount();case 13:void 0===a.sent&&u("No accounts"),O=s.web3.utils.padLeft("0x"+y.encryptedName,64),j={contentHash:g,previousHash:n,encryptedName:O,encryptedContentKey:y.encryptedContentKey,publicKey:v.publicKey,guildId:r},l.a.setItem("guildSequence."+g,JSON.stringify(j)),k=Object(i.a)({},e),l.a.setItem("projectData",JSON.stringify(k)),l.a.setItem("projectHash",g),new d.a(p.j,"editSequence",[n?Object(h.b)(n):s.NULL_BYTES_32,Object(h.b)(g),O,y.encryptedContentKey,v.publicKey,r]).execute(),c(g);case 23:case"end":return a.stop()}},o)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"getGuildSequence",value:function(){var e=Object(o.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new v.a(this.contractAddress).select("contentHash").select("previousHash").select("user").select("encryptedName").select("guildId").select("encryptedContentKey").select("publicKey").from(m.t).where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(r=e.sent).length){e.next=13;break}if(i="guildSequence."+t,!(o=l.a.getItem(i))){e.next=12;break}o=JSON.parse(o),r=[o],e.next=13;break;case 12:return e.abrupt("return",void 0);case 13:return s=r[0],c=s.guildId,e.next=17,this.guilds.getGuildKey(c);case 17:return u=e.sent,e.abrupt("return",this._decryptQueryResult(s,u.privateKey));case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGuildSequences",value:function(){var e=Object(o.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(l.length>1&&void 0!==l[1])||l[1],r=new v.a(this.contractAddress).select("contentHash").select("previousHash").select("user").select("encryptedName").select("encryptedContentKey").select("publicKey").select("guildId").from(m.t).where("guildId",t),n){e.next=7;break}return e.next=5,f.a.getAccount();case 5:void 0!==(i=e.sent)&&r.where("address",i.toLowerCase());case 7:return e.next=9,r.executeQuery();case 9:if(0!==(o=e.sent).length){e.next=12;break}return e.abrupt("return",[]);case 12:return e.next=14,this.guilds.getGuildKey(t);case 14:if(void 0!==(s=e.sent)){e.next=17;break}return e.abrupt("return",[]);case 17:c=[],e.t0=a.a.keys(o);case 19:if((e.t1=e.t0()).done){e.next=28;break}return u=e.t1.value,e.t2=c,e.next=24,this._decryptQueryResult(o[u],s.privateKey);case 24:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=19;break;case 28:return e.abrupt("return",c);case 29:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_decryptQueryResult",value:function(){var e=Object(o.a)(a.a.mark(function e(t,n){var r,i,o,s,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=7;break}return e.next=3,this.guilds.getGuildKey(t.guildId);case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",void 0);case 6:n=r.privateKey;case 7:return i=Object(y.b)(t.encryptedContentKey),e.next=10,this.crypto.decryptName(t.encryptedName,i,n);case 10:return o=e.sent,s=t.user,e.next=14,this.crypto.decryptContentKey(i,n);case 14:return c=e.sent,u={title:Object(y.b)(o),encryptedTitle:t.encryptedName,user:s,newSequence:t.contentHash,previousSequence:t.previousHash,guildId:t.guildId,contentKey:c?c.contentKey:void 0,blockNumber:t.blockNumber,publicKey:t.publicKey&&Object(y.b)(t.publicKey)},e.abrupt("return",u);case 17:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.a=O},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(823),o=(n(153),n(149),n(157),function(){function e(t){Object(r.a)(this,e),this.web3=t,this.contract=(new i.a).getContract(t)}return Object(a.a)(e,[{key:"newResample",value:function(e,t,n,r,a){}}]),e}());t.a=o},,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=["1","162/149","81/64","4/3","3/2","18/11","4096/2187","2/1"]},function(e,t,n){},function(e,t,n){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){},,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,function(e,t){},,function(e,t){},,,,,,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(4),a=n(5),i=n(1878);t.default=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096,o=[];if("function"!==typeof AudioWorkletNode||!("audioWorklet"in AudioContext.prototype)){t.AudioWorkletNode=function(t,r,a){var i=l(t)[r],o=a&&a.outputChannelCount?a.outputChannelCount[0]:2,s=t.createScriptProcessor(n,2,o);if(s.parameters=new Map,i.properties)for(var u=0;u<i.properties.length;u++){var f=i.properties[u],h=t.createGain().gain;h.value=f.defaultValue,s.parameters.set(f.name,h)}var d=new MessageChannel;e=d.port2;var p=new i.Processor(a||{});return e=null,s.port=d.port1,s.processor=i,s.instance=p,s.onaudioprocess=c,s},Object.defineProperty((t.AudioContext||t.webkitAudioContext).prototype,"audioWorklet",{get:function(){return this.$$audioWorklet||(this.$$audioWorklet=new t.AudioWorklet(this))}});var s=function(){this.port=e};s.prototype={},t.AudioWorklet=function(){function e(t){Object(r.a)(this,e),this.$$context=t}return Object(a.a)(e,[{key:"addModule",value:function(e,t){var n=this;return fetch(e).then(function(e){if(!e.ok)throw Error(e.status);return e.text()}).then(function(e){var r={sampleRate:n.$$context.sampleRate,currentTime:n.$$context.currentTime,AudioWorkletProcessor:s,registerProcessor:function(e,t){l(n.$$context)[e]={realm:a,context:r,Processor:t,properties:t.parameterDescriptors||[]}}};r.self=r;var a=new i(r,document.documentElement);return a.exec((t&&t.transpile||String)(e)),null})}}]),e}()}function c(e){var t=this,n={},r=-1;this.parameters.forEach(function(e,a){var i=o[++r]||(o[r]=new Float32Array(t.bufferSize));i.fill(e.value),n[a]=i}),this.processor.realm.exec("self.sampleRate=sampleRate="+this.context.sampleRate+";self.currentTime=currentTime="+this.context.currentTime);var a=u(e.inputBuffer),i=u(e.outputBuffer);this.instance.process([a],[i],n)}function u(e){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);return t}function l(e){return e.$$processors||(e.$$processors={})}}},function(e,t,n){"use strict";function r(e,t){var n=document.createElement("iframe");n.style.cssText="position:absolute;left:0;top:-999px;width:1px;height:1px;",t.appendChild(n);var r=n.contentWindow,a=r.document,i="var window,$hook";for(var o in r)o in e||"eval"===o||(i+=",",i+=o);for(var s in e)i+=",",i+=s,i+="=self.",i+=s;var c=a.createElement("script");c.appendChild(a.createTextNode('function $hook(self,console) {"use strict";\n        '.concat(i,";return function() {return eval(arguments[0])}}"))),a.body.appendChild(c),this.exec=r.$hook.call(e,e,console)}n.r(t),n.d(t,"default",function(){return r})},,function(e,t,n){"use strict";n.r(t);var r=n(32),a=n(112).default,i={name:"abs",gen:function(){var e,t=a.getInputs(this),n="worklet"===a.mode,i=n?"":"gen.";return isNaN(t[0])?(a.closures.add(Object(r.a)({},this.name,n?"Math.abs":Math.abs)),e="".concat(i,"abs( ").concat(t[0]," )")):e=Math.abs(parseFloat(t[0])),e}};t.default=function(e){var t=Object.create(i);return t.inputs=[e],t}},function(e,t,n){"use strict";n.r(t);var r=n(32),a=n(112).default,i={name:"round",gen:function(){var e,t=a.getInputs(this),n="worklet"===a.mode,i=n?"":"gen.";return isNaN(t[0])?(a.closures.add(Object(r.a)({},this.name,n?"Math.round":Math.round)),e="".concat(i,"round( ").concat(t[0]," )")):e=Math.round(parseFloat(t[0])),e}};t.default=function(e){var t=Object.create(i);return t.inputs=[e],t}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"sin",gen:function(){var e,t=r.getInputs(this),n="worklet"===r.mode,a=n?"":"gen.";return isNaN(t[0])?(r.closures.add({sin:n?"Math.sin":Math.sin}),e="".concat(a,"sin( ").concat(t[0]," )")):e=Math.sin(parseFloat(t[0])),e}};t.default=function(e){var t=Object.create(a);return t.inputs=[e],t.id=r.getUID(),t.name="".concat(t.basename,"{sin.id}"),t}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"cos",gen:function(){var e,t=r.getInputs(this),n="worklet"===r.mode,a=n?"":"gen.";return isNaN(t[0])?(r.closures.add({cos:n?"Math.cos":Math.cos}),e="".concat(a,"cos( ").concat(t[0]," )")):e=Math.cos(parseFloat(t[0])),e}};t.default=function(e){var t=Object.create(a);return t.inputs=[e],t.id=r.getUID(),t.name="".concat(t.basename,"{cos.id}"),t}},function(e,t,n){"use strict";n.r(t);var r=n(112),a={basename:"tan",gen:function(){var e,t=r.getInputs(this),n="worklet"===r.mode,a=n?"":"gen.";return isNaN(t[0])?(r.closures.add({tan:n?"Math.tan":Math.tan}),e="".concat(a,"tan( ").concat(t[0]," )")):e=Math.tan(parseFloat(t[0])),e}};t.default=function(e){var t=Object.create(a);return t.inputs=[e],t.id=r.getUID(),t.name="".concat(t.basename,"{tan.id}"),t}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"tanh",gen:function(){var e,t=r.getInputs(this),n="worklet"===r.mode,a=n?"":"gen.";return isNaN(t[0])?(r.closures.add({tanh:n?"Math.tan":Math.tanh}),e="".concat(a,"tanh( ").concat(t[0]," )")):e=Math.tanh(parseFloat(t[0])),e}};t.default=function(e){var t=Object.create(a);return t.inputs=[e],t.id=r.getUID(),t.name="".concat(t.basename,"{tanh.id}"),t}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"asin",gen:function(){var e,t=r.getInputs(this),n="worklet"===r.mode,a=n?"":"gen.";return isNaN(t[0])?(r.closures.add({asin:n?"Math.sin":Math.asin}),e="".concat(a,"asin( ").concat(t[0]," )")):e=Math.asin(parseFloat(t[0])),e}};t.default=function(e){var t=Object.create(a);return t.inputs=[e],t.id=r.getUID(),t.name="".concat(t.basename,"{asin.id}"),t}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"acos",gen:function(){var e,t=r.getInputs(this),n="worklet"===r.mode,a=n?"":"gen.";return isNaN(t[0])?(r.closures.add({acos:n?"Math.acos":Math.acos}),e="".concat(a,"acos( ").concat(t[0]," )")):e=Math.acos(parseFloat(t[0])),e}};t.default=function(e){var t=Object.create(a);return t.inputs=[e],t.id=r.getUID(),t.name="".concat(t.basename,"{acos.id}"),t}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"atan",gen:function(){var e,t=r.getInputs(this),n="worklet"===r.mode,a=n?"":"gen.";return isNaN(t[0])?(r.closures.add({atan:n?"Math.atan":Math.atan}),e="".concat(a,"atan( ").concat(t[0]," )")):e=Math.atan(parseFloat(t[0])),e}};t.default=function(e){var t=Object.create(a);return t.inputs=[e],t.id=r.getUID(),t.name="".concat(t.basename,"{atan.id}"),t}},function(e,t,n){"use strict";n.r(t);var r=n(112),a=n(253),i=n(184),o="phasorN",s=n(284),c={min:0,max:1};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,u=Object.assign({},c,n),l=u.max-u.min,f=a("number"===typeof e?e*l/r.samplerate:s(i(e,l),r.samplerate),t,u);return f.name=o+r.getUID(),f}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a=(n(202).default,{basename:"peek",gen:function(){this.name;var e,t,n,a,i,o=r.getInputs(this);return a=o[0],i=o[1],n=o[2],"simple"===this.mode?e="memory[ ".concat(a," + ").concat(n," ]"):(e="  var ".concat(this.name,"_dataIdx  = ").concat(a,", \n        ").concat(this.name,"_phase = ").concat("samples"===this.mode?n:n+" * "+i,", \n        ").concat(this.name,"_index = ").concat(this.name,"_phase | 0,\n"),t="wrap"===this.boundmode?"".concat(this.name,"_index + 1 >= ").concat(i," ? ").concat(this.name,"_index + 1 - ").concat(i," : ").concat(this.name,"_index + 1"):"clamp"===this.boundmode?"".concat(this.name,"_index + 1 >= ").concat(i," -1 ? ").concat(i," - 1 : ").concat(this.name,"_index + 1"):"fold"===this.boundmode||"mirror"===this.boundmode?"".concat(this.name,"_index + 1 >= ").concat(i," - 1 ? ").concat(this.name,"_index - ").concat(i," - 1 : ").concat(this.name,"_index + 1"):"".concat(this.name,"_index + 1"),"linear"===this.interp?(e+="      ".concat(this.name,"_frac  = ").concat(this.name,"_phase - ").concat(this.name,"_index,\n        ").concat(this.name,"_base  = memory[ ").concat(this.name,"_dataIdx +  ").concat(this.name,"_index ],\n        ").concat(this.name,"_next  = ").concat(t,","),"ignore"===this.boundmode?e+="\n        ".concat(this.name,"_out   = ").concat(this.name,"_index >= ").concat(i," - 1 || ").concat(this.name,"_index < 0 ? 0 : ").concat(this.name,"_base + ").concat(this.name,"_frac * ( memory[ ").concat(this.name,"_dataIdx + ").concat(this.name,"_next ] - ").concat(this.name,"_base )\n\n"):e+="\n        ".concat(this.name,"_out   = ").concat(this.name,"_base + ").concat(this.name,"_frac * ( memory[ ").concat(this.name,"_dataIdx + ").concat(this.name,"_next ] - ").concat(this.name,"_base )\n\n")):e+="      ".concat(this.name,"_out = memory[ ").concat(this.name,"_dataIdx + ").concat(this.name,"_index ]\n\n"),r.memo[this.name]=this.name+"_out",[this.name+"_out",e])},defaults:{channels:1,mode:"phase",interp:"linear",boundmode:"wrap"}});t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,o=Object.create(a),s="undefined"===typeof e.basename?r.lib.data(e):e;return Object.assign(o,{data:s,dataName:s.name,uid:r.getUID(),inputs:[e,t,n,s]},a.defaults,i),o.name=o.basename+o.uid,o}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a=(n(318).default,n(202).default),i=n(224).default,o=(n(184).default,n(318).default),s=function(){for(var e=new Float32Array(1024),t=0,n=e.length;t<n;t++)e[t]=Math.sin(t/n*(2*Math.PI));r.globals.cycle=a(e,1,{immutable:!0})};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;"undefined"===typeof r.globals.cycle&&s();var a=Object.assign({},{min:0},n),c=i(r.globals.cycle,o(e,t,a));return c.name="cycle"+r.getUID(),c}},function(e,t,n){"use strict";n.r(t);var r=n(112),a=(n(318),n(202)),i=n(224),o=n(184),s=n(252),c=n(318),u=function(){for(var e=new Float32Array(1024),t=0,n=e.length;t<n;t++)e[t]=Math.sin(t/n*(2*Math.PI));r.globals.cycle=a(e,1,{immutable:!0})};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;"undefined"===typeof r.globals.cycle&&u();var a=Object.assign({},{min:0},n),l=o(s(1,i(r.globals.cycle,c(e,t,a))),.5);return l.name="cycle"+r.getUID(),l}},function(e,t,n){"use strict";n.r(t);var r=n(32),a=n(112).default,i={name:"ceil",gen:function(){var e,t=a.getInputs(this),n="worklet"===a.mode,i=n?"":"gen.";return isNaN(t[0])?(a.closures.add(Object(r.a)({},this.name,n?"Math.ceil":Math.ceil)),e="".concat(i,"ceil( ").concat(t[0]," )")):e=Math.ceil(parseFloat(t[0])),e}};t.default=function(e){var t=Object.create(i);return t.inputs=[e],t}},function(e,t,n){"use strict";n.r(t);var r=n(32),a=n(112).default,i={name:"min",gen:function(){var e,t=a.getInputs(this),n="worklet"===a.mode,i=n?"":"gen.";return isNaN(t[0])||isNaN(t[1])?(a.closures.add(Object(r.a)({},this.name,n?"Math.min":Math.min)),e="".concat(i,"min( ").concat(t[0],", ").concat(t[1]," )")):e=Math.min(parseFloat(t[0]),parseFloat(t[1])),e}};t.default=function(e,t){var n=Object.create(i);return n.inputs=[e,t],n}},function(e,t,n){"use strict";n.r(t);var r=n(32),a=n(112).default,i={name:"max",gen:function(){var e,t=a.getInputs(this),n="worklet"===a.mode,i=n?"":"gen.";return isNaN(t[0])||isNaN(t[1])?(a.closures.add(Object(r.a)({},this.name,n?"Math.max":Math.max)),e="".concat(i,"max( ").concat(t[0],", ").concat(t[1]," )")):e=Math.max(parseFloat(t[0]),parseFloat(t[1])),e}};t.default=function(e,t){var n=Object.create(i);return n.inputs=[e,t],n}},function(e,t,n){"use strict";n.r(t);var r=n(32),a=n(112).default,i={name:"sign",gen:function(){var e,t=a.getInputs(this),n="worklet"===a.mode,i=n?"":"gen.";return isNaN(t[0])?(a.closures.add(Object(r.a)({},this.name,n?"Math.sign":Math.sign)),e="".concat(i,"sign( ").concat(t[0]," )")):e=Math.sign(parseFloat(t[0])),e}};t.default=function(e){var t=Object.create(i);return t.inputs=[e],t}},function(e,t,n){"use strict";n.r(t);n(112);var r=n(254),a=n(203),i=n(252),o=n(184),s=n(236);t.default=function(e){var t,n=r(),c=r();return t=s(i(a(e,n.out),o(c.out,.9997))),n.in(e),c.in(t),t}},function(e,t,n){"use strict";n.r(t);var r=n(32),a=n(112),i=n(254),o=(n(203),n(252),n(184),n(236),n(963),n(431),{basename:"rate",gen:function(){var e=a.getInputs(this),t=(i(),i(),"gen."+this.name);return a.closures.add(Object(r.a)({},this.name,this)),[t+".phase"," "+" var ".concat(this.name,"_diff = ").concat(e[0]," - ").concat(t,".lastSample\n  if( ").concat(this.name,"_diff < -.5 ) ").concat(this.name,"_diff += 1\n  ").concat(t,".phase += ").concat(this.name,"_diff * ").concat(e[1],"\n  if( ").concat(t,".phase > 1 ) ").concat(t,".phase -= 1\n  ").concat(t,".lastSample = ").concat(e[0],"\n")]}});t.default=function(e,t){var n=Object.create(o);return Object.assign(n,{phase:0,lastSample:0,uid:a.getUID(),inputs:[e,t]}),n.name="".concat(n.basename).concat(n.uid),n}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a=n(252).default,i=n(184).default,o=n(203).default,s=n(236).default;t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,c=s(a(i(e,o(1,n)),i(t,n)));return c.name="mix"+r.getUID(),c}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a=(n(597).default,n(203).default,n(236).default,{basename:"clip",gen:function(){var e,t=r.getInputs(this);return e=" "+(e=" var ".concat(this.name," = ").concat(t[0],"\n  if( ").concat(this.name," > ").concat(t[2]," ) ").concat(this.name," = ").concat(t[2],"\n  else if( ").concat(this.name," < ").concat(t[1]," ) ").concat(this.name," = ").concat(t[1],"\n")),r.memo[this.name]=this.name,[this.name,e]}});t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=Object.create(a);return Object.assign(i,{min:t,max:n,uid:r.getUID(),inputs:[e,t,n]}),i.name="".concat(i.basename).concat(i.uid),i}},function(e,t,n){"use strict";n.r(t);var r=n(11),a=n(112),i=n(202),o=n(371),s=n(224),c=n(203),u=n(431),l=n(253),f=(n(236),{basename:"delay",gen:function(){var e=a.getInputs(this);return a.memo[this.name]=e[0],e[0]}}),h={size:512,interp:"none"};t.default=function(e,t,n){var d,p,v=Object.create(f);!1===Array.isArray(t)&&(t=[t]);var m=Object.assign({},h,n),y=Math.max.apply(Math,Object(r.a)(t));m.size<y&&(m.size=y),p=i(m.size),v.inputs=[],d=l(1,0,{max:m.size,min:0});for(var b=0;b<t.length;b++)v.inputs[b]=s(p,u(c(d,t[b]),0,m.size),{mode:"samples",interp:m.interp});return v.outputs=v.inputs,o(p,e,d),v.name="".concat(v.basename).concat(a.getUID()),v}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"fold",gen:function(){var e,t=r.getInputs(this);return e=this.createCallback(t[0],this.min,this.max),r.memo[this.name]=this.name+"_value",[this.name+"_value",e]},createCallback:function(e,t,n){return" "+" var ".concat(this.name,"_value = ").concat(e,",\n      ").concat(this.name,"_range = ").concat(n," - ").concat(t,",\n      ").concat(this.name,"_numWraps = 0\n\n  if(").concat(this.name,"_value >= ").concat(n,"){\n    ").concat(this.name,"_value -= ").concat(this.name,"_range\n    if(").concat(this.name,"_value >= ").concat(n,"){\n      ").concat(this.name,"_numWraps = ((").concat(this.name,"_value - ").concat(t,") / ").concat(this.name,"_range) | 0\n      ").concat(this.name,"_value -= ").concat(this.name,"_range * ").concat(this.name,"_numWraps\n    }\n    ").concat(this.name,"_numWraps++\n  } else if(").concat(this.name,"_value < ").concat(t,"){\n    ").concat(this.name,"_value += ").concat(this.name,"_range\n    if(").concat(this.name,"_value < ").concat(t,"){\n      ").concat(this.name,"_numWraps = ((").concat(this.name,"_value - ").concat(t,") / ").concat(this.name,"_range- 1) | 0\n      ").concat(this.name,"_value -= ").concat(this.name,"_range * ").concat(this.name,"_numWraps\n    }\n    ").concat(this.name,"_numWraps--\n  }\n  if(").concat(this.name,"_numWraps & 1) ").concat(this.name,"_value = ").concat(n," + ").concat(t," - ").concat(this.name,"_value\n")}};t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=Object.create(a);return Object.assign(i,{min:t,max:n,uid:r.getUID(),inputs:[e]}),i.name="".concat(i.basename).concat(i.uid),i}},function(e,t,n){"use strict";n.r(t);var r=n(112).default;t.default=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{id:r.getUID(),inputs:t,gen:function(){var e=r.getInputs(this),t="(",n=e[0],a=isNaN(n);return e.forEach(function(r,i){if(0!==i){var o=isNaN(r),s=i===e.length-1;t+=a||o?"".concat(n," % ").concat(r):n%=r,s||(t+=" % ")}}),t+=")"}}}},function(e,t,n){"use strict";n.r(t);var r=n(112),a={basename:"sah",gen:function(){var e,t=r.getInputs(this);return r.requestMemory(this.memory),e=" var ".concat(this.name,"_control = memory[").concat(this.memory.control.idx,"],\n      ").concat(this.name,"_trigger = ").concat(t[1]," > ").concat(t[2]," ? 1 : 0\n\n  if( ").concat(this.name,"_trigger !== ").concat(this.name,"_control  ) {\n    if( ").concat(this.name,"_trigger === 1 ) \n      memory[").concat(this.memory.value.idx,"] = ").concat(t[0],"\n    \n    memory[").concat(this.memory.control.idx,"] = ").concat(this.name,"_trigger\n  }\n"),r.memo[this.name]="memory[".concat(this.memory.value.idx,"]"),["memory[".concat(this.memory.value.idx,"]")," "+e]}};t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,o=Object.create(a),s={init:0};return void 0!==i&&Object.assign(s,i),Object.assign(o,{lastSample:0,uid:r.getUID(),inputs:[e,t,n],memory:{control:{idx:null,length:1},value:{idx:null,length:1}}},s),o.name="".concat(o.basename).concat(o.uid),o}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={name:"noise",gen:function(){var e,t="worklet"===r.mode,n=t?"":"gen.";return r.closures.add({noise:t?"Math.random":Math.random}),e="  var ".concat(this.name," = ").concat(n,"noise()\n"),r.memo[this.name]=this.name,[this.name,e]}};t.default=function(e){var t=Object.create(a);return t.name=a.name+r.getUID(),t}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={name:"lte",gen:function(){var e,t=r.getInputs(this);return e="  var ".concat(this.name," = "),isNaN(this.inputs[0])||isNaN(this.inputs[1])?e+="( ".concat(t[0]," <= ").concat(t[1]," | 0  )"):e+=t[0]<=t[1]?1:0,e+="\n",r.memo[this.name]=this.name,[this.name,e]}};t.default=function(e,t){var n=Object.create(a);return n.inputs=[e,t],n.name="lte"+r.getUID(),n}},function(e,t,n){"use strict";n.r(t);var r=n(112),a={basename:"bool",gen:function(){var e=r.getInputs(this);return"".concat(e[0]," === 0 ? 0 : 1")}};t.default=function(e){var t=Object.create(a);return Object.assign(t,{uid:r.getUID(),inputs:[e]}),t.name="".concat(t.basename).concat(t.uid),t}},function(e,t,n){"use strict";n.r(t);var r=n(112),a={basename:"gate",controlString:null,gen:function(){var e,t=r.getInputs(this);r.requestMemory(this.memory);var n="memory[ "+this.memory.lastInput.idx+" ]",a=this.memory.lastInput.idx+1,i=t[0],o=t[1];return e=" if( ".concat(o," !== ").concat(n," ) {\n    memory[ ").concat(n," + ").concat(a,"  ] = 0 \n    ").concat(n," = ").concat(o,"\n  }\n  memory[ ").concat(a," + ").concat(o," ] = ").concat(i,"\n\n"),this.controlString=t[1],this.initialized=!0,r.memo[this.name]=this.name,this.outputs.forEach(function(e){return e.gen()}),[null," "+e]},childgen:function(){return!1===this.parent.initialized&&r.getInputs(this),void 0===r.memo[this.name]&&(r.requestMemory(this.memory),r.memo[this.name]="memory[ ".concat(this.memory.value.idx," ]")),"memory[ ".concat(this.memory.value.idx," ]")}};t.default=function(e,t,n){var i=Object.create(a),o={count:2};void 0!==typeof n&&Object.assign(o,n),Object.assign(i,{outputs:[],uid:r.getUID(),inputs:[t,e],memory:{lastInput:{length:1,idx:null}},initialized:!1},o),i.name="".concat(i.basename).concat(r.getUID());for(var s=0;s<i.count;s++)i.outputs.push({index:s,gen:a.childgen,parent:i,inputs:[i],memory:{value:{length:1,idx:null}},initialized:!1,name:"".concat(i.name,"_out").concat(r.getUID())});return i}},function(e,t,n){"use strict";n.r(t);var r=n(112),a=n(432),i=n(253),o=n(284);t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:440,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=a(i(o(e,44100)),t);return n.name="train".concat(r.getUID()),n}},function(e,t,n){"use strict";n.r(t);n(112);var r=n(254),a=n(203),i=n(252),o=(n(184),n(236)),s=n(965),c=n(284),u=n(967);t.default=function(e){var t,n,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=r(0);return n=u(s(e,h.out),l,f),t=o(i(h.out,c(a(e,h.out),n))),h.in(t),t}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"in",gen:function(){var e="worklet"===r.mode;return e?r.inputs.add(this):r.parameters.add(this.name),r.memo[this.name]=!0===e?this.name+"[i]":this.name,r.memo[this.name]}};t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,c=Object.create(a);return c.id=r.getUID(),c.name=void 0!==e?e:"".concat(c.basename).concat(c.id),Object.assign(c,{defaultValue:i,min:o,max:s,inputNumber:t,channelNumber:n}),c[0]={gen:function(){return r.parameters.has(c.name)||r.parameters.add(c.name),c.name+"[0]"}},c[1]={gen:function(){return r.parameters.has(c.name)||r.parameters.add(c.name),c.name+"[1]"}},c}},function(e,t,n){"use strict";n.r(t);var r=n(32),a=n(112).default,i={name:"mtof",gen:function(){var e,t=a.getInputs(this);return isNaN(t[0])?(a.closures.add(Object(r.a)({},this.name,Math.exp)),e="( ".concat(this.tuning," * gen.exp( .057762265 * (").concat(t[0]," - 69) ) )")):e=this.tuning*Math.exp(.057762265*(t[0]-69)),e}};t.default=function(e,t){var n=Object.create(i);return void 0!==t&&Object.assign(t.defaults),Object.assign(n,{tuning:440}),n.inputs=[e],n}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={name:"ltp",gen:function(){var e=r.getInputs(this);return isNaN(this.inputs[0])||isNaN(this.inputs[1])?"(".concat(e[0]," * (( ").concat(e[0]," < ").concat(e[1]," ) | 0 ) )"):e[0]*(e[0]<e[1]|0)}};t.default=function(e,t){var n=Object.create(a);return n.inputs=[e,t],n}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"mstosamps",gen:function(){var e,t,n=r.getInputs(this);return isNaN(n[0])?(e="  var ".concat(this.name," = ").concat(r.samplerate," / 1000 * ").concat(n[0]," \n\n"),r.memo[this.name]=e,t=[this.name,e]):t=e=r.samplerate/1e3*this.inputs[0],t}};t.default=function(e){var t=Object.create(a);return t.inputs=[e],t.name=a.basename+r.getUID(),t}},function(e,t,n){"use strict";n.r(t);var r=n(112),a={basename:"selector",gen:function(){var e,t=r.getInputs(this),n=0;switch(t.length){case 2:n=t[1];break;case 3:e="  var ".concat(this.name,"_out = ").concat(t[0]," === 1 ? ").concat(t[1]," : ").concat(t[2],"\n\n"),n=[this.name+"_out",e];break;default:e=" var ".concat(this.name,"_out = 0\n  switch( ").concat(t[0]," + 1 ) {\n");for(var a=1;a<t.length;a++)e+="    case ".concat(a,": ").concat(this.name,"_out = ").concat(t[a],"; break;\n");e+="  }\n\n",n=[this.name+"_out"," "+e]}return r.memo[this.name]=this.name+"_out",n}};t.default=function(){for(var e=Object.create(a),t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Object.assign(e,{uid:r.getUID(),inputs:n}),e.name="".concat(e.basename).concat(e.uid),e}},function(e,t,n){"use strict";n.r(t);var r=n(112).default,a={basename:"pow",gen:function(){var e,t=r.getInputs(this),n="worklet"===r.mode,a=n?"":"gen.";return isNaN(t[0])||isNaN(t[1])?(r.closures.add({pow:n?"Math.pow":Math.pow}),e="".concat(a,"pow( ").concat(t[0],", ").concat(t[1]," )")):("string"===typeof t[0]&&"("===t[0][0]&&(t[0]=t[0].slice(1,-1)),"string"===typeof t[1]&&"("===t[1][0]&&(t[1]=t[1].slice(1,-1)),e=Math.pow(parseFloat(t[0]),parseFloat(t[1]))),e}};t.default=function(e,t){var n=Object.create(a);return n.inputs=[e,t],n.id=r.getUID(),n.name="".concat(n.basename,"{pow.id}"),n}},function(e,t,n){"use strict";n.r(t);n(112);var r=n(254),a=n(184),i=n(203);t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:44100,t=r(1),n=Math.exp(-6.907755278921/e);return t.in(a(t.out,n)),t.out.trigger=function(){t.value=1},i(1,t.out)}},function(e,t,n){"use strict";n.r(t);n(112);var r=n(254),a=n(184),i=n(968);t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:44100,t=arguments.length>1?arguments[1]:void 0,n=Object.assign({},{initValue:1},t),o=r(n.initValue);return o.in(a(o.out,i(e))),o.out.trigger=function(){o.value=1},o.out}},function(e,t,n){"use strict";n.r(t);var r=n(112),a=(n(184),n(203)),i=n(284),o=n(202),s=n(224),c=n(253),u=n(599),l=n(432),f=n(600),h=n(598),d=n(252),p=n(371),v=n(601),m=n(602),y=n(966),b=(n(236),n(317));t.default=function(){var e,t,n,g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:44100,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:44100,j=arguments.length>2?arguments[2]:void 0,k=Object.assign({},{shape:"exponential",alpha:5,trigger:null},j),w=null!==k.trigger?k.trigger:f(),x=c(1,w,{min:0,max:1/0,initialValue:-1/0,shouldWrap:!1}),S=o([0]);"linear"===k.shape?n=u(m(y(x,0),l(x,g)),i(x,g),m(y(x,0),l(x,d(g,O))),a(1,i(a(x,g),O)),v(x,-1/0),p(S,1,0,{inline:0}),0):(e=h({length:1024,type:k.shape,alpha:k.alpha}),t=h({length:1024,type:k.shape,alpha:k.alpha,reverse:!0}),n=u(m(y(x,0),l(x,g)),s(e,i(x,g),{boundmode:"clamp"}),m(y(x,0),l(x,d(g,O))),s(t,i(a(x,g),O),{boundmode:"clamp"}),v(x,-1/0),p(S,1,0,{inline:0}),0));var P="worklet"===r.mode;return!0===P&&(n.node=null,b.register(n)),n.isComplete=function(){return!0===P&&null!==n.node?new Promise(function(e){n.node.getMemoryValue(S.memory.values.idx,e)}):r.memory.heap[S.memory.values.idx]},n.trigger=function(){!0===P&&null!==n.node&&n.node.port.postMessage({key:"set",idx:S.memory.values.idx,value:0}),w.trigger()},n}},function(e,t,n){"use strict";n.r(t);var r=n(112),a=n(184),i=n(203),o=n(284),s=n(202),c=n(224),u=n(253),l=n(599),f=n(432),h=n(600),d=n(598),p=n(961),v=n(252),m=(n(969),n(964)),y=n(602),b=n(601),g=n(371),O=n(317);t.default=function(){var e,t,n,j,k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:44,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:22050,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:44100,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.6,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:44100,E=arguments.length>5?arguments[5]:void 0,T=h(),A=u(1,T,{max:1/0,shouldWrap:!1,initialValue:1/0}),M=p(1),R=Object.assign({},{shape:"exponential",alpha:5,triggerRelease:!1},E),C=s([0]);e=d({length:1024,alpha:R.alpha,shift:0,type:R.shape}),n=R.triggerRelease?M:f(A,v(k,w,x)),j=R.triggerRelease?m(M):f(A,v(k,w,x,P)),t=l(f(A,k),c(e,o(A,k),{boundmode:"clamp"}),f(A,v(k,w)),c(e,i(1,a(o(i(A,k),w),i(1,S))),{boundmode:"clamp"}),y(n,b(A,1/0)),c(e,S),j,c(e,void 0,{boundmode:"clamp"}),b(A,1/0),g(C,1,0,{inline:0}),0);var N="worklet"===r.mode;return!0===N&&(t.node=null,O.register(t)),t.trigger=function(){M.value=1,T.trigger()},t.isComplete=function(){return!0===N&&null!==t.node?new Promise(function(e){t.node.getMemoryValue(C.memory.values.idx,e)}):r.memory.heap[C.memory.values.idx]},t.release=function(){M.value=0,N&&null!==t.node?t.node.port.postMessage({key:"set",idx:(void 0).inputs[0].inputs[1].memory.value.idx,value:0}):r.memory.heap[(void 0).inputs[0].inputs[1].memory.value.idx]=0},t}},function(e,t,n){"use strict";n.r(t);var r=n(112),a=n(202),i=n(224),o=n(184),s={basename:"pan",initTable:function(){for(var e=new Float32Array(1024),t=new Float32Array(1024),n=Math.PI/180,i=0;i<1024;i++){var o=i*(90/1024);e[i]=Math.cos(o*n),t[i]=Math.sin(o*n)}r.globals.panL=a(e,1,{immutable:!0}),r.globals.panR=a(t,1,{immutable:!0})}};t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;arguments.length>3&&arguments[3];void 0===r.globals.panL&&s.initTable();var a=Object.create(s);return Object.assign(a,{uid:r.getUID(),inputs:[e,t],left:o(e,i(r.globals.panL,n,{boundmode:"clamp"})),right:o(t,i(r.globals.panR,n,{boundmode:"clamp"}))}),a.name="".concat(a.basename).concat(a.uid),a}},function(e,t,n){"use strict";n.r(t);var r=n(112),a={basename:"eq",gen:function(){var e,t=r.getInputs(this);return e=this.inputs[0]===this.inputs[1]?1:"  var ".concat(this.name," = (").concat(t[0]," === ").concat(t[1],") | 0\n\n"),r.memo[this.name]="".concat(this.name),["".concat(this.name),e]}};t.default=function(e,t){var n=Object.create(a);return Object.assign(n,{uid:r.getUID(),inputs:[e,t]}),n.name="".concat(n.basename).concat(n.uid),n}},function(e,t,n){"use strict";n.r(t);var r=n(32),a=n(112).default,i={name:"exp",gen:function(){var e,t=a.getInputs(this),n="worklet"===a.mode,i=n?"":"gen.";return isNaN(t[0])?(a.closures.add(Object(r.a)({},this.name,n?"Math.exp":Math.exp)),e="".concat(i,"exp( ").concat(t[0]," )")):e=Math.exp(parseFloat(t[0])),e}};t.default=function(e){var t=Object.create(i);return t.inputs=[e],t}},function(e,t,n){"use strict";n.r(t);var r=n(576),a=n(32),i=n(112).default,o={basename:"process",gen:function(){var e,t=i.getInputs(this);return i.closures.add(Object(a.a)({},""+this.funcname,this.func)),e="  var ".concat(this.name," = gen['").concat(this.funcname,"']("),t.forEach(function(t,n,r){e+=r[n],n<r.length-1&&(e+=",")}),e+=")\n",i.memo[this.name]=this.name,[this.name,e]}};t.default=function(){var e={},t=i.getUID();e.name="process"+t;for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return e.func=Object(r.a)(Function,a),e.call=function(){var n=Object.create(o);n.funcname=e.name,n.func=e.func,n.name="process_out_"+t,n.process=e;for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return n.inputs=a,n},e}},function(e,t,n){"use strict";n.r(t);var r=n(112),a=n(253),i=n(962),o=n(224),s=n(254),c=n(202),u="seq";t.default=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:11025,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(Array.isArray(t)){var f=i(0,0,t.length),h=o(c(t),f,{mode:"simple"});e=i(l,0,h);var d=s();d.in(e.wrap),f.inputs[0]=d.out}else e=i(l,0,t);var p=a(e.wrap,0,{min:0,max:n.length}),v=o(c(n),p,{mode:"simple"});return v.name=u+r.getUID(),v.trigger=e.wrap,v}},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return m});var r=n(42),a=n.n(r),i=n(56),o=n(122),s=n(1939),c=n(373),u=n(6),l=n.n(u),f=(n(302),n(62),n(1940)),h=n(141),d=n(23);function p(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e){window.addEventListener("dragenter",function(e){e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none"},!1),window.addEventListener("dragover",function(e){return e.preventDefault(),e.dataTransfer.effectAllowed="none",!1}),window.addEventListener("drop",function(t){return y(e,t)})}var y=function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),n.dataTransfer.effectAllowed="none",n.dataTransfer.dropEffect="none",n.dataTransfer.items)for(r=n.dataTransfer.items.length,t.dispatch(Object(d.qb)(r)),i=0;i<n.dataTransfer.items.length;i++)"file"===n.dataTransfer.items[i].kind&&(t.dispatch(Object(d.Se)(!0)),b(t,n.dataTransfer.items[i].getAsFile()));else for(i=0;i<n.dataTransfer.files.length;i++);return e.abrupt("return",!1);case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),b=function(t,n){var r=new FileReader;n.name.includes(".wav")||n.name.includes(".flac")||n.name.includes(".mp3")?(r.readAsArrayBuffer(n),r.onloadend=Object(i.a)(a.a.mark(function i(){var u,v,m,y,b,g,O;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return u=r.result,a.next=3,o.a.addArrayBuffer(u);case 3:if(v=a.sent,y=new h.a(v),!n.name.includes("flac")){a.next=14;break}return a.next=8,Object(f.a)(new Int8Array(u));case 8:return u=a.sent,a.next=11,l.a.Master.context.decodeAudioData(u);case 11:m=a.sent,a.next=24;break;case 14:if(!n.name.includes("mp3")){a.next=21;break}return a.next=17,Object(c.b)(new Int8Array(u));case 17:m=a.sent,y.mp3Data=new e(u),a.next=24;break;case 21:return a.next=23,l.a.Master.context.decodeAudioData(u);case 23:m=a.sent;case 24:y.tags=[],b=p(s.a);try{for(b.s();!(g=b.n()).done;)O=g.value,n.name.toLowerCase().includes(O.toLowerCase())&&y.tags.push(O)}catch(i){b.e(i)}finally{b.f()}y.tags.length>0&&console.log("tags for %s = ",n.name,y.tags),y.audioBuffer=m,t.addSound(y),t.dispatch(Object(d.Se)(!1)),y.name=n.name;case 32:case"end":return a.stop()}},i)}))):window.alert("Only accepts .wav, .mp3, & .flac files for now")}}).call(this,n(110).Buffer)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(32),a=(Object(r.a)({kick:"kick","hi-hat":"hi-hat",snare:"snare",clap:"clap",rim:"rim",tom:"tom",perc:"perc",breaks:"breaks",bass:"bass",sub:[["808","sub"]],keys:"keys"},"breaks","breaks"),["kick","hi-hat","snare","clap","rim","tom","perc","sub","breaks","keys","808","synth","vocal","vox","bass","pluck","chord","fx"])},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(42),a=n.n(r),i=n(56),o=(n(358),n(1941)),s=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,u,l,f,h,d,p,v,m,y,b;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p=function(e){console.info("meta data: ",e),f=e},d=function(e,t,n){console.error("decode error callback",e,t)},h=function(e,t){l.push(e)},u=function(e){var n,r,a=i===s?-1:Math.min(i+e,s);return-1!==a?(n=t.subarray(i,a),r=a-i,i=a):r=0,{buffer:n,readDataLength:r,error:!1}},!0,n=!0,!1,n=!1,0!=(r=o.create_libflac_decoder(!1))){e.next=10;break}return e.abrupt("return");case 10:if(i=0,s=t.buffer.byteLength,l=[],v=1,m=n?o.init_decoder_ogg_stream(r,u,h,d,p):o.init_decoder_stream(r,u,h,d,p),1==(v&=0==m)){e.next=18;break}return e.abrupt("return");case 18:if("file",0,y=1,y&=o.FLAC__stream_decoder_process_until_end_of_stream(r),o.FLAC__stream_decoder_get_state(r),1==y){e.next=24;break}return e.abrupt("return");case 24:return v&=o.FLAC__stream_decoder_finish(r),o.FLAC__stream_decoder_delete(r),b=c(l,f.sampleRate,f.channels,f.bitsPerSample),e.abrupt("return",b.arrayBuffer());case 28:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();function c(e,t,n,r){var a=function(e,t,n,r){var a=r/8,i=e.length*e.BYTES_PER_ELEMENT,o=new ArrayBuffer(44+i),s=new DataView(o);return l(s,0,"RIFF"),s.setUint32(4,36+i,!0),l(s,8,"WAVE"),l(s,12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,n,!0),s.setUint32(24,t,!0),s.setUint32(28,t*n*a,!0),s.setUint16(32,n*a,!0),s.setUint16(34,r,!0),l(s,36,"data"),s.setUint32(40,i,!0),function(e,t,n){for(var r=0;r<n.length;++r,++t)e.setUint8(t,n[r])}(s,44,e),s}(function(e,t,n){var r=n/8,a=24===n||8===n?1:0;a&&(r+=a);for(var i=0,o=0;o<t;++o)i+=u(e,o,r,a);for(var s,c=new Uint8Array(i),l=0,f=0,h=0,d=0,p=0,v=!1,m=0,y=e.length;m<y;++m)for(s=e[m],l=s[0].length,h=0,!1,v=!1;h<l;){for(d=0;d<t;++d)for(p=0;p<r;++p)a?a&&p===r-a?0!==s[d][h+p]&&255!==s[d][h+p]&&console.error("[ERROR] mis-aligned padding: ignoring non-padding value (padding should be 0 or 255) at "+(h+p)+" -> ",s[d][h+p]):8===n?(v=0===s[d][h+p+1],c[f++]=v?128|s[d][h+p]:127&s[d][h+p]):c[f++]=s[d][h+p]:c[f++]=s[d][h+p];h+=r}return c}(e,n,r),t,n,r);return new Blob([a],{type:"audio/wav"})}function u(e,t,n,r){for(var a,i=0,o=r>0?r/n:0,s=e.length-1;s>=0;--s)a=e[s][t].byteLength,i+=r>0?a-o*a:a;return i}function l(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(31),u=n(7),l=n(8),f=n(2),h=n(11),d=n(1),p=n(115),v=n(108),m=n(553),y=n(171),b=n(212);function g(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var j=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o,s,c,u,l,f,d,p,v,y,O,j;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=void 0,e.next=3,Object(m.a)();case 3:return e.next=5,Object(m.a)([t]);case 5:if(!((s=e.sent).length>0)){e.next=10;break}i=s[0],e.next=11;break;case 10:return e.abrupt("return",n);case 11:n.bpm=i.bpm,console.log("song =",i),i.attributes&&(r.songAttributes=i.attributes),c=[],u=g(n.subSequences),e.prev=16,u.s();case 18:if((l=u.n()).done){e.next=48;break}f=l.value,d=0,p=g(f.tracksData),e.prev=22,p.s();case 24:if((v=p.n()).done){e.next=38;break}if(y=v.value,O=y.attributes,j=d,d++,O){e.next=31;break}return e.abrupt("continue",36);case 31:if(!O.needsLazyLoad){e.next=36;break}return e.delegateYield(a.a.mark(function e(){var t,n,r,s,u,l,d,p,v,S,P,E,T,A,M;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=O["stem types"],void 0===(n=O.isLoop)&&(n=!0),r=void 0,s=k(i,t,n,c),u=!1,s||(n&&1===t.length&&"Guitars"===t[0]&&(s=k(i,t,!1,c),u=!0),1!==t.length||"Vocals"!==t[0]||n||(s=k(i,["Instruments"],!1,c)),x(t)&&!n&&(s=k(i,["Drums"],!1,c))),s){e.next=34;break}if(o){e.next=12;break}return e.next=11,Object(m.a)();case 11:o=e.sent;case 12:Object(b.a)(o),l=g(o.filter(function(e){return e!==i})),e.prev=14,l.s();case 16:if((d=l.n()).done){e.next=24;break}if(p=d.value,!(s=k(p,t,n,c))){e.next=22;break}return r=p,e.abrupt("break",24);case 22:e.next=16;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(14),l.e(e.t0);case 29:return e.prev=29,l.f(),e.finish(29);case 32:e.next=35;break;case 34:r=i;case 35:if(s){e.next=37;break}return e.abrupt("return","continue");case 37:"https://spores-stems.s3.us-east-2.amazonaws.com",v=s.uri.includes("ipfs://")?"/"+s.uri.slice("ipfs://".length):v,S="https://spores-stems.s3.us-east-2.amazonaws.com"+v,c.push(s),P=y.samplers,E=Object.keys(P),T=P[E[0]],u&&(A=Math.max.apply(Math,Object(h.a)(f.tracks.flatMap(function(e){return e[0].size}))),f.tracks[j][0].size=A,f.tracks[j][0][0][0].duration=A/2),T.sampleId=S,y.samplers[S]=T,T.tempo=r.bpm,T.slices.forEach(function(e){e.endTime=s.duration,e.transpose=i!==r?w(i,r):0}),E[0]!==S&&delete y.samplers[E[0]],i!==r&&1.5*r.bpm<i.bpm&&(M=f.tracksMidiEffects[j][0])&&(M.warpFactor=4);case 51:case"end":return e.stop()}},e,null,[[14,26,29,32]])})(),"t0",33);case 33:if("continue"!==e.t0){e.next=36;break}return e.abrupt("continue",36);case 36:e.next=24;break;case 38:e.next=43;break;case 40:e.prev=40,e.t1=e.catch(22),p.e(e.t1);case 43:return e.prev=43,p.f(),e.finish(43);case 46:e.next=18;break;case 48:e.next=53;break;case 50:e.prev=50,e.t2=e.catch(16),u.e(e.t2);case 53:return e.prev=53,u.f(),e.finish(53);case 56:return e.abrupt("return",n);case 57:case"end":return e.stop()}},e,null,[[16,50,53,56],[22,40,43,46]])}));return function(t,n,r){return e.apply(this,arguments)}}(),k=function(e,t,n,r){var a,i=g(e.stems.filter(function(e){return!r.includes(e)}));try{var o=function(){var e=a.value;if(!e.isDefaultStem)return"continue";var r=e.prettyStemTypes;return e.isLoop!==n?"continue":t.every(function(e){return r.includes(e)})?{v:e}:void 0};for(i.s();!(a=i.n()).done;){var s=o();if("continue"!==s&&"object"===typeof s)return s.v}}catch(c){i.e(c)}finally{i.f()}},w=function(e,t){var n=e.key.split(" "),r=Object(v.a)(n,2),a=r[0],i=(r[1],t.key.split(" ")),o=Object(v.a)(i,2),s=o[0],c=(o[1],y.a.fromString(a+"3"),y.a.fromString(a+"3").getTranspose()),u=y.a.fromString(s+"3").getTranspose();return c>6&&(c-=12),u>6&&(u-=12),c-u},x=function(e){var t=["Drums","Instruments","Bass"];return!!e.every(function(e){return t.includes(e)})},S=n(130),P=n(368);function E(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var M=n(80),R=n(942),C=n(363),N=(n(943),n(206)),I=n(146),q=n(20),_=n(582);function D(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return F(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var L=function(e,t){var n,r=D(t.subSequences);try{for(r.s();!(n=r.n()).done;){var a,i=n.value,o=D(i.tracks);try{for(o.s();!(a=o.n()).done;){var s,c=a.value,u=[].concat(Object(h.a)(c.effects),Object(h.a)(c.midiEffects.effects),Object(h.a)(c.liveEffects.effects)),l=D(u);try{for(l.s();!(s=l.n()).done;){var f=s.value;f.effects&&(u=[].concat(Object(h.a)(u),Object(h.a)(f.effects)))}}catch(v){l.e(v)}finally{l.f()}var d=u.find(function(t){return t.id===e});if(d)return d}}catch(v){o.e(v)}finally{o.f()}var p=i.midiEffects.effects.find(function(t){return t.id===e});if(p)return p}}catch(v){r.e(v)}finally{r.f()}},B=function(e,t,n){console.log("findInstrumentPart",e,t,n);var r,a=D(n.subSequences);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(t===_.b){var o=n.lfos.find(function(t){return t.lfo.id===e});return{type:_.b,instrument:o,effect:o,id:e}}if("MODULE_ENVELOPE"===t){var s=n.envelopes.find(function(t){return t.id===e});return s?{type:"MODULE_ENVELOPE",instrument:s,subType:s.number,id:e}:void 0}var c,u=D(i.tracks);try{for(u.s();!(c=u.n()).done;){var l=c.value;if(t===_.c||t===_.a){var f=_.d[t];return z(l,f,t,e)}if(l.instrument&&l.instrument.id===e)return{type:t,track:l,instrument:l.instrument}}}catch(h){u.e(h)}finally{u.f()}}}catch(h){a.e(h)}finally{a.f()}},z=function(e,t,n,r){var a,i=[],o=D(e.midiEffects.effects);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.effects?i=[].concat(Object(h.a)(i),Object(h.a)(s.effects)):i.push(s)}}catch(u){o.e(u)}finally{o.f()}var c=i.find(function(e){return e[t]&&e[t].id===r});if(c)return{type:n,track:e,instrument:c[t],effect:c}},J=n(23),V=function(e){for(var t=e.getJson(),n=[],r=0;r<e.sequencerEngine.numberOfPatterns();r++){var a=e.patterns[r];if(void 0!==a){for(var i={},o=0;o<a.stepBuckets.length;o++){var s=a.stepBuckets[o];if(s.anyEffectAutomation()||s.anyOn())for(var c in s.steps)i[o]=s.getJson()}i.size=a.length(),i.buckets=!0,n.push(i)}}return{patterns:n,patternsConfig:e.patterns.map(function(e){return e.getJson()}),trackData:t,trackEffectChains:e.effectsChains.map(function(e){return e.getJson()}),trackMidiEffects:e.midiEffects.getJson()}},H=n(141),U=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.pattern.volume=n.volume,!("samplers"in n)){e.next=11;break}e.t0=a.a.keys(n.samplers);case 3:if((e.t1=e.t0()).done){e.next=11;break}return i=e.t1.value,o=new H.a(i),e.next=8,o.load();case 8:t.useNewSound(o),e.next=3;break;case 11:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),G=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o,s,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.pattern.volume=n.volume,!("samplers"in n)){e.next=9;break}e.t0=a.a.keys(n.samplers);case 3:if((e.t1=e.t0()).done){e.next=9;break}return i=e.t1.value,e.next=7,t.addSound(i,n.samplers[i],void 0,!1);case 7:e.next=3;break;case 9:if("envelopes"in n)for(o in n.envelopes)t.connectToEnvelope(r.envelopes[n.envelopes[o]]);if("envelopeConnections"in n)for(s in n.envelopeConnections)c=n.envelopeConnections[s],t.connectToEnvelope(r.envelopes[c.envelope],c.mode);case 11:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),W=n(143),K=n(33),Q=n(60),Z=n(255),Y=n(251),$=n(225),X=n(123),ee=n(427),te=n(158),ne=n(6),re=n.n(ne),ae=new re.a.Time("16n"),ie=new re.a.Time("16n"),oe=function(){function e(){Object(o.a)(this,e),this.offset=0,this.parameters=[],this.initialBulkValues={}}return Object(s.a)(e,[{key:"registerParameter",value:function(e,t){var n=this.context.forInstrument(this);this.initialBulkValues=Object(d.a)({},this.initialBulkValues,e.setStore(this.store)),e.setMixSession(this.mixSession),e.setContext(n),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getSubDevices",value:function(){return[]}},{key:"getSubDeviceIndex",value:function(e){return this.getSubDevices().map(function(e){return e.value}).indexOf(e)}},{key:"getSubDevice",value:function(e){return this.getSubDevices().map(function(e){return e.value})[e]}},{key:"getName",value:function(){return""}},{key:"name",get:function(){return this.getName()}},{key:"connect",value:function(e){void 0!==e&&(this.getInstrument().connect(e),this.node=e)}},{key:"disconnect",value:function(e){this.getInstrument().disconnect(e),this.node=void 0}},{key:"dispose",value:function(){this.disconnect(),this.parameters.forEach(function(e){return e.dispose()})}},{key:"isMonophonic",value:function(){return!1}},{key:"getEnvelope",value:function(){}},{key:"getInstrument",value:function(){}},{key:"getInstrumentType",value:function(){}},{key:"releaseAll",value:function(){}},{key:"getJson",value:function(){return{instrumentType:this.getInstrumentType()}}},{key:"hasLFO",value:function(){return!1}},{key:"release",value:function(e){e=void 0!==e?e:this.lastNote,this.isMonophonic()&&this.lastNote!==e||void 0!==this.lastNote&&this.getInstrument().triggerRelease([e])}},{key:"trigger",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=e.start,r=null;e.duration&&(r="number"===typeof e.duration?ae*e.duration:new re.a.Time(e.duration));var a=isNaN(e.transpose)?0:e.transpose,i=this.getNoteFromTranspose(a),o=null===e.velocity?1:e.velocity,s=null==e.chop?1:e.chop,c=(null==r?ae:r)/s.toString();t=t||void 0,this.offset>0&&(void 0===t&&(t=re.a.Master.context.currentTime),t=ie*this.offset+t);var u=t;if((void 0!==this.lastSlideTranspose||this.hasSlide)&&this.releaseSlide(t),r&&e.slide)this.triggerSlide(i,t,r);else{if(void 0!==this.lastSlideTranspose&&(this.triggerSlide(i,t,r,!1),this.hasSlide=!0),t&&this.detuneParameter){var l=this.detuneParameter.get(!0);this.detuneSignal.setValueAtTime(l,Math.max(0,t-.001))}this.lastSlideTranspose=void 0,this.lastSlideMax=void 0;var f=this.getInstrument(),h=!this.track||this.track.gated;r===1/0&&(r=null);for(var d=0;d<s;d++)this.lastNote=i,null!==r&&h?f.triggerAttackRelease(i,r,u,o,n,e):f.triggerAttack(i,u,o,n,e),u||(u=re.a.Master.context.currentTime),u+=c;this.lastTranspose=i}}},{key:"hasNotes",value:function(){return!0}},{key:"setEnvelopes",value:function(e){var t=this.getEnvelopes();t.forEach(function(t){return t.attack=new re.a.Time((1+e.attack)/1e3)}),t.forEach(function(t){return t.release=new re.a.Time((1+e.release)/1e3)})}},{key:"getNoteFromTranspose",value:function(e){return e+this.sequencerEngine.transpose}},{key:"getDefaultNote",value:function(){return re.a.Frequency("C3")}},{key:"getParameters",value:function(){return this.parameters}},{key:"getEnvelopes",value:function(){return[]}},{key:"findParameter",value:function(e,t){var n=this.getParameters().filter(function(e){return t===e.name});return 0===n.length?0:n[0]}},{key:"freeze",value:function(){}}]),e}(),se=n(210),ce=n(22),ue=n(128),le=n(113),fe=n(10),he=n(14),de=["01_Saw","02_Triangle","03_Square","04_Noise","05_Pulse","06_Warm_Saw","07_Warm_Triangle","08_Warm_Square","09_Dropped_Saw","10_Dropped_Square","11_TB303_Square","Bass","Bass_Amp360","Bass_Fuzz_2","Bass_Sub_Dub","Bass_Sub_Dub_2","Brass","Brit_Blues","Brit_Blues_Driven","Buzzy_1","Buzzy_2","Celeste","Chorus_Strings","Dissonant_Piano","Dissonant_1","Dissonant_2","Dyna_EP_Bright","Dyna_EP_Med","Ethnic_33","Full_1","Full_2","Guitar_Fuzz","Harsh","Mkl_Hard","Organ_2","Organ_3","Phoneme_ah","Phoneme_bah","Phoneme_ee","Phoneme_o","Phoneme_ooh","Phoneme_pop_ahhhs","Piano","Putney_Wavering","Throaty","Trombone","Twelve_String_Guitar_1","Twelve_OpTines","Wurlitzer","Wurlitzer_2"],pe={},ve=function(e){return new Promise(function(t,n){e in pe?t(pe[e]):fetch(window.isNFT?"waveforms/"+e:"/waveforms/"+e,{}).then(function(e){return e.text()}).then(function(n){var r=JSON.parse(n);pe[e]=r,t(r)})})},me=function(e){return pe[e]},ye=function(e){var t=de[Math.round(e)%de.length];return ve(t)},be=function(e){var t=de[Math.round(e)%de.length];return me(t)},ge=n(192),Oe=n(116),je=n(59),ke=n(43),we=(new re.a.Frequency("C3"),function(){function e(t,n,r,a,i){!(arguments.length>5&&void 0!==arguments[5])||arguments[5];var s=arguments.length>6?arguments[6]:void 0;Object(o.a)(this,e),this.bulk={},this.sequencerEngine=t,this.id=Object(q.uuid)(),this.track=s,this.name="Osc "+this.id,this.store=t.store,this.mixSession=n,this.context=r.getCopy().forSubDevice(this).forOscillator(this),this.pitchEnvelope=i,this.synthFactory=a,this.polyphonySet=!1,this.volume=new re.a.Gain(.4)}return Object(s.a)(e,[{key:"dispose",value:function(){this.synth&&this.disposeSynth(),this.getParameters().forEach(function(e){return e.dispose()}),this.parameters=void 0}},{key:"create",value:function(){this.initVoices(),this.setupParameters(),this.setupWaveformParameters()}},{key:"isInitialized",value:function(){return void 0!==this.synth}},{key:"getEffectType",value:function(){return je.a}},{key:"getCopy",value:function(e,t,n){return n.oscillatorFrequency=this.oscillatorFrequency,n.oscillatorLevel=this.oscillatorLevel,n.detune=this.detune,n.polyphony=this.polyphony,n.portamento=this.portamento,n.oscillatorType=this.oscillatorType,n.pulseWidth=this.pulseWidth,n}}]),e}());function xe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Se=function(e){Object(u.a)(n,e);var t=xe(n);function n(e,r,a){return Object(o.a)(this,n),t.call(this,e,r,a,function(e){return new re.a.PolySynth(e,re.a.FMSynth)})}return Object(s.a)(n,[{key:"setupParameters",value:function(){Object(fe.a)(Object(f.a)(n.prototype),"setupParameters",this).call(this),this.harmonicityParameter=new le.a("Harmonicity",this,function(e,t){return e.synth.set({harmonicity:t})},{min:0,max:20,unit:"",defaultValue:3}),this.registerParameter(this.harmonicityParameter),this.modulationIndexParameter=new le.a("modulationIndex",this,function(e,t){return e.synth.set({modulationIndex:t})},{min:0,max:1e3,unit:"",defaultValue:10}),this.harmonicityParameter.setAudioParams(this.synth.voices.map(function(e){return e.harmonicity})),this.modulationIndexParameter.setAudioParams(this.synth.voices.map(function(e){return e.modulationIndex})),this.partialCountParameter=new he.a("Partial Count",this,function(e,t){return e.synth.set({oscillator:{partialCount:t}})},{min:0,automatable:!1,max:16,unit:"",defaultValue:0}),this.registerParameter(this.partialCountParameter),this.registerParameter(this.modulationIndexParameter)}},{key:"harmonicity",get:function(){return this.harmonicityParameter.get()},set:function(e){return this.harmonicityParameter.set(e)}},{key:"modulationIndex",get:function(){return this.modulationIndexParameter.get()},set:function(e){return this.modulationIndexParameter.set(e)}},{key:"partialCount",get:function(){return this.partialCountParameter.get()},set:function(e){return this.partialCountParameter.set(e)}},{key:"refreshParameters",value:function(){Object(fe.a)(Object(f.a)(n.prototype),"refreshParameters",this).call(this),this.harmonicity=this.harmonicity,this.modulationIndex=this.modulationIndex,this.partialCount=this.partialCount,this.harmonicityParameter.setAudioParams(this.synth.voices.map(function(e){return e.harmonicity})),this.modulationIndexParameter.setAudioParams(this.synth.voices.map(function(e){return e.modulationIndex}))}},{key:"getJson",value:function(){var e=Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{harmonicity:this.harmonicity,modulationIndex:this.modulationIndex,partialCount:this.partialCount});return e=Object(ue.b)(e,"harmonicityParameter",this.harmonicityParameter),e=Object(ue.b)(e,"modulationIndexParameter",this.modulationIndexParameter),e=Object(ue.b)(e,"partialCountParameter",this.partialCountParameter)}},{key:"fromJson",value:function(e){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,void 0,!0),console.log("osc =",e),this.harmonicity=parseFloat(e.harmonicity),this.modulationIndex=parseFloat(e.modulationIndex),this.partialCount=e.partialCount,Object(ue.a)(e,"harmonicityParameter",this.harmonicityParameter,this.sequencerEngine),Object(ue.a)(e,"modulationIndexParameter",this.modulationIndexParameter,this.sequencerEngine),Object(ue.a)(e,"partialCountParameter",this.partialCountParameter,this.sequencerEngine)}},{key:"mateJson",value:function(e,t){Object(fe.a)(Object(f.a)(n.prototype),"mateJson",this).call(this,e,t),this.mateParameter("harmonicity",e,this.harmonicityParameter,t),this.mateParameter("modulationIndex",e,this.modulationIndexParameter,t),this.mateParameter("partialCount",e,this.partialCountParameter,t)}}]),n}(we),Pe=function(){function e(t,n,r,a){Object(o.a)(this,e),this.sequencerEngine=t,this.store=t.store,this.mixSession=n,this.context=r.getCopy().forSubDevice(this),this.fmSynth=a,this.parameters=[],this.setupParameters()}return Object(s.a)(e,[{key:"synth",get:function(){return this.fmSynth.synth}},{key:"setupParameters",value:function(){this.oscillatorTypeParameter=new he.a("Oscillator Type",this,function(e,t){return e.synth.set({modulation:{type:t}})},{min:0,max:1,unit:"",defaultValue:"triangle",automatable:!1}),this.registerParameter(this.oscillatorTypeParameter),this.partialCountParameter=new he.a("Partial Count",this,function(e,t){return e.synth.set({modulation:{partialCount:t}})},{min:0,max:16,unit:"",defaultValue:0}),this.registerParameter(this.partialCountParameter)}},{key:"oscillatorType",get:function(){return this.oscillatorTypeParameter.get()},set:function(e){this.oscillatorTypeParameter.set(e)}},{key:"partialCount",get:function(){return this.partialCountParameter.get()},set:function(e){return this.partialCountParameter.set(e)}},{key:"refreshParameters",value:function(){this.oscillatorType=this.oscillatorType}},{key:"registerParameter",value:function(e,t){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(){var e={oscillatorType:this.oscillatorType,partialCount:this.partialCount};return e=Object(ue.b)(e,"partialCountParameter",this.partialCountParameter),Object(ue.b)(e,"oscillatorTypeParameter",this.oscillatorTypeParameter)}},{key:"fromJson",value:function(e){this.oscillatorType=e.oscillatorType,e.partialCount&&(this.partialCount=e.partialCount),Object(ue.a)(e,"oscillatorTypeParameter",this.oscillatorTypeParameter),Object(ue.a)(e,"partialCountParameter",this.partialCountParameter)}},{key:"mateJson",value:function(e,t){this.mateParameter("partialCount",e,this.partialCountParameter,t),this.mateParameter("oscillatorType",e,this.oscillatorTypeParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){Object(se.b)(this.sequencerEngine,e,t,n,r)}}]),e}();window.FADER=.05;var Ee=function(){function e(t,n,r,a,i,s,c){Object(o.a)(this,e),this.sequencerEngine=t,this.store=this.sequencerEngine.store,this.id=Object(q.uuid)(),this.mixSession=n,this.context=r.getCopy().forSubDevice(this),this.envelope=c||new re.a.ScaledEnvelope,void 0!==a&&(this.audioNode=a,this.envelope.connect(a)),this.min=i,this.max=s,this.parameters=[],this.setupParameters(),this.savedFrequency=void 0}return Object(s.a)(e,[{key:"dispose",value:function(){this.parameters.forEach(function(e){return e.dispose(!0)}),this.envelope.dispose(),this.envelope=void 0,this.parameters=void 0}},{key:"connect",value:function(e){this.envelope.connect(e)}},{key:"disconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.audioNode;this.envelope.disconnect(e)}},{key:"frequency",set:function(e){this.savedFrequency=e;var t=void 0;t=this.level>0?void 0!==this.max?e+this.level*(this.max-e):e+this.level*e*2:void 0!==this.min&&this.min<0?-1*this.level*(this.min+e):this.level*e,this.envelope.min=2*e,isNaN(t)||(this.envelope.max=t)}},{key:"level",get:function(){return void 0===this.levelParameter||void 0===this.levelParameter.get(!0)?0:this.levelParameter.get(!0)},set:function(e){this.levelParameter.set(e,!0,!0)}},{key:"triggerAttack",value:function(e,t){0!==this.level&&this.envelope.triggerAttack(e,t)}},{key:"triggerAttackRelease",value:function(e,t,n){0!==this.level&&(t=Math.max(t,0),this.envelope.triggerAttackRelease(e,t,n))}},{key:"triggerRelease",value:function(e){0!==this.level&&(e=Math.max(e,0),this.envelope.triggerRelease(e))}},{key:"setupParameters",value:function(){var e=this;this.attackParameter=new he.a("Attack",this.envelope,function(t,n){e.envelope&&(e.envelope.attack=(n+1e-6)/1e3)},{min:0,max:2e3,unit:"ms",defaultValue:10}),this.registerParameter(this.attackParameter),this.decayParameter=new he.a("Decay",this.envelope,function(t,n){e.envelope&&(e.envelope.decay=(n+1e-5)/1e3)},{min:0,max:3e3,unit:"ms",defaultValue:500}),this.registerParameter(this.decayParameter),this.sustainParameter=new he.a("Sustain",this.envelope,function(t,n){e.envelope&&(e.envelope.sustain=Math.min(n,.999))},{min:0,max:1,unit:"",defaultValue:.8}),this.registerParameter(this.sustainParameter),this.releaseParameter=new he.a("Release",this.envelope,function(t,n){e.envelope&&(e.envelope.release=(n+1e-6)/1e3)},{min:0,max:8e3,unit:"ms",defaultValue:200}),this.registerParameter(this.releaseParameter),this.attackCurveParameter=new he.a("Attack Curve",this.envelope,function(t,n){e.envelope&&(t.attackCurve=n)},{min:0,max:1e4,unit:"",defaultValue:"linear",automatable:!1}),this.registerParameter(this.attackCurveParameter),this.decayCurveParameter=new he.a("Decay Curve",this.envelope,function(e,t){return e.decayCurve=t},{min:0,max:1e4,unit:"",defaultValue:"exponential",automatable:!1}),this.registerParameter(this.decayCurveParameter),this.releaseCurveParameter=new he.a("Release Curve",this.envelope,function(e,t){return e.releaseCurve=t},{min:0,max:1e4,unit:"",defaultValue:"linear",automatable:!1}),this.registerParameter(this.releaseCurveParameter),this.levelParameter=new he.a("Level",this,function(t,n){e.envelope&&(e.frequency=e.savedFrequency||0)},{min:-1,max:1,unit:"",defaultValue:0}),this.registerParameter(this.levelParameter)}},{key:"refresh",value:function(){this.parameters.filter(function(e){return e.isConnectedToAnyLFO()}).forEach(function(e){return e.callSetter()})}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e,!0,!0)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e,!0,!0)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e,!0,!0)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e,!0,!0)}},{key:"attackCurve",get:function(){return this.attackCurveParameter.get()},set:function(e){this.attackCurveParameter.set(e,!0,!0)}},{key:"decayCurve",get:function(){return this.decayCurveParameter.get()},set:function(e){this.decayCurveParameter.set(e,!0,!0)}},{key:"releaseCurve",get:function(){return this.releaseCurveParameter.get()},set:function(e){this.releaseCurveParameter.set(e,!0,!0)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(e){var t={level:this.level,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackCurve:this.attackCurve,decayCurve:this.decayCurve,releaseCurve:this.releaseCurve,x:this.x,y:this.y,width:this.width,height:this.height};return t=Object(ue.b)(t,"attackParameter",this.attackParameter,void 0,e),t=Object(ue.b)(t,"decayParameter",this.decayParameter,void 0,e),t=Object(ue.b)(t,"sustainParameter",this.sustainParameter,void 0,e),t=Object(ue.b)(t,"releaseParameter",this.releaseParameter,void 0,e),t=Object(ue.b)(t,"attackCurveParameter",this.attackCurveParameter,void 0,e),t=Object(ue.b)(t,"decayCurveParameter",this.decayCurveParameter,void 0,e),t=Object(ue.b)(t,"releaseCurveParameter",this.releaseCurveParameter,void 0,e),t=Object(ue.b)(t,"levelParameter",this.levelParameter,void 0,e)}},{key:"fromJson",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r={};return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,Object(Oe.a)(this.attackParameter,e.attack,r,n,!0),Object(Oe.a)(this.decayParameter,e.decay,r,n),Object(Oe.a)(this.sustainParameter,e.sustain,r,n),Object(Oe.a)(this.releaseParameter,e.release,r,n),r=Object(d.a)({},r,Object(ue.a)(e,"attackParameter",this.attackParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"decayParameter",this.decayParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"sustainParameter",this.sustainParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"releaseParameter",this.releaseParameter,this.sequencerEngine,t,!0,n)),re.a.Master.context.isOffline?(Object(Oe.a)(this.levelParameter,e.level,{},n),Object(ue.a)(e,"levelParameter",this.levelParameter,this.sequencerEngine,t,!0,n)):(Object(Oe.a)(this.levelParameter,e.level,r,n),r=Object(d.a)({},r,Object(ue.a)(e,"levelParameter",this.levelParameter,this.sequencerEngine,t,!0,n))),r}},{key:"mateJson",value:function(e,t){this.mateParameter("attack",e,this.attackParameter,t),this.mateParameter("decay",e,this.decayParameter,t),this.mateParameter("sustain",e,this.sustainParameter,t),this.mateParameter("release",e,this.releaseParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){Object(se.b)(this.sequencerEngine,e,t,n,r)}}]),e}();function Te(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ae=function(e){Object(u.a)(n,e);var t=Te(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this)).notes=[],i.sequencerEngine=e,i.store=e.store,i.mixSession=r,i.context=a.getCopy().forInstrument(Object(c.a)(i)),i.ampEnvelope=new Ee(e,r,i.context),i.modulationEnvelope=new Ee(e,r,i.context),i.filter=new p.a.FilterEffect(e,ce.a),i.filterEnvelope=new Ee(e,r,i.context,i.filter.effectNode.frequency,0,1e4),i.filterEnvelope2=new Ee(e,r,i.context,i.filter.effectNode.frequency,0,1e4),i.carrierOscillator=new Se(e,r,i.context),i.modulatorOscillator=new Pe(e,r,i.context,Object(c.a)(i)),i.noiseOscillator=new re.a.NoiseSynth,i.connectSynthToFilter(),i.parameters=[],i.setupParameters(),i.carrierOscillator.onNewSynth=function(){return i.onNewSynth()},i.lastTime=void 0,i.currentNotes=[],i}return Object(s.a)(n,[{key:"getSubDevices",value:function(){return[{label:"Filter",value:this},{label:"Carrier Oscillator",value:this.carrierOscillator},{label:"Modulator Oscillator",value:this.modulatorOscillator},{label:"Amp Envelope",value:this.ampEnvelope},{label:"Filter Envelope",value:this.filterEnvelope},{label:"Filter Envelope 2",value:this.filterEnvelope2},{label:"Modulation Envelope",value:this.modulationEnvelope}]}},{key:"synth",get:function(){return this.carrierOscillator.synth}},{key:"onNewSynth",value:function(){this.connectSynthToFilter(),this.modulatorOscillator.refreshParameters()}},{key:"triggerAttack",value:function(e,t,n){this.filterEnvelope.refresh(),this.filterEnvelope2.refresh();var r=this.carrierOscillator.getNoteFromTranspose(e);this.notes.push(r),this.filterEnvelope.triggerAttack(t,n),this.filterEnvelope2.triggerAttack(t,n),this.synth.triggerAttack(r,t,n),this.noiseOscillator.triggerAttack(t,n)}},{key:"triggerAttackRelease",value:function(e,t,n,r){var a=this.carrierOscillator.getNoteFromTranspose(e);this.notes.push(a),this.filterEnvelope.refresh(),this.filterEnvelope2.refresh(),this.filterEnvelope.triggerAttackRelease(t,n,r),this.filterEnvelope2.triggerAttackRelease(t,n,r),this.synth.triggerAttackRelease(a,t,n,r),this.noiseOscillator.triggerAttackRelease(t,n,r)}},{key:"triggerRelease",value:function(e){var t=this,n=e.map(function(e){return t.carrierOscillator.getNoteFromTranspose(e)});this.filterEnvelope.triggerRelease(),this.filterEnvelope2.triggerRelease(),this.synth.triggerRelease(n),this.noiseOscillator.triggerRelease(re.a.Master.context.currentTime)}},{key:"releaseAll",value:function(){this.synth.releaseAll(),this.notes=[]}},{key:"setEnvelopes",value:function(e){this.carrierOscillator.setEnvelopes(e,this.ampEnvelope),this.setModulationEnvelopes(),this.setAmpEnvelopeForNoise(e)}},{key:"setModulationEnvelopes",value:function(){this.synth.set({modulationEnvelope:{attack:new re.a.Time((1+this.modulationEnvelope.attack)/1e3),decay:new re.a.Time((1+this.modulationEnvelope.decay)/1e3),sustain:this.modulationEnvelope.sustain,release:new re.a.Time((1+this.modulationEnvelope.release)/1e3)}})}},{key:"setAmpEnvelopeForNoise",value:function(){this.noiseOscillator.envelope.attack=new re.a.Time((1+this.ampEnvelope.attack)/1e3),this.noiseOscillator.envelope.decay=new re.a.Time((1+this.ampEnvelope.decay)/1e3),this.noiseOscillator.envelope.sustain=this.ampEnvelope.sustain,this.noiseOscillator.envelope.release=new re.a.Time((1+this.ampEnvelope.release)/1e3)}},{key:"dispose",value:function(){this.noiseOscillator.dispose(),this.filterEnvelope.dispose(),this.filterEnvelope2.dispose(),this.filter.dispose(),this.carrierOscillator.dispose(),this.noiseOscillator=void 0,this.filterEnvelope=void 0,this.filterEnvelope2=void 0,this.filter=void 0,this.carrierOscillator=void 0}},{key:"connectSynthToFilter",value:function(){this.synth.connect(this.filter.effectNode),this.noiseOscillator.connect(this.filter.effectNode)}},{key:"connect",value:function(e){void 0!==e&&this.filter.connect(e)}},{key:"disconnect",value:function(e){this.filter.disconnect(e)}},{key:"setupParameters",value:function(){var e=this;this.filterCutoffParameter=new le.a("Filter Cutoff",this.filter.effectNode.frequency,function(t,n){e.filterEnvelope.frequency=n,e.filterEnvelope2.frequency=n,e.filter.cutoffFrequency=n},{min:0,max:1e4,unit:"HZ",defaultValue:1200,constantAutomationRate:!0}),this.registerParameter(this.filterCutoffParameter,function(e){return e.filter.frequency}),this.filterQParameter=new le.a("Filter Q",this.filter.effectNode.Q,function(t,n){return e.filter.Q=n},{min:0,max:9,unit:"",defaultValue:1}),this.registerParameter(this.filterQParameter,function(e){return e.filter.Q}),this.noiseVolumeParameter=new le.a("noiseVolume",this.noiseOscillator.volume,function(t,n){return e.noiseOscillator.volume.value=n},{min:0,max:1,unit:"db",defaultValue:0}),this.registerParameter(this.noiseVolumeParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getParameters",value:function(){return[].concat(Object(h.a)(this.parameters),Object(h.a)(this.ampEnvelope.parameters),Object(h.a)(this.filterEnvelope.parameters),Object(h.a)(this.filterEnvelope2.parameters),Object(h.a)(this.modulationEnvelope.parameters),Object(h.a)(this.carrierOscillator.parameters),Object(h.a)(this.modulatorOscillator.parameters))}},{key:"filterCutoff",get:function(){return this.filterCutoffParameter.get()},set:function(e){this.filterCutoffParameter.set(e)}},{key:"filterQ",get:function(){return this.filterQParameter.get()},set:function(e){this.filterQParameter.set(e)}},{key:"isMonophonic",value:function(){return 1===this.carrierOscillator.polyphony}},{key:"refreshParameters",value:function(){this.filterQ=this.filterQ,this.filterCutoff=this.filterCutoff}},{key:"getName",value:function(){return"FM Synth"}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return te.c}},{key:"getJson",value:function(){var e={instrumentType:this.getInstrumentType(),filterCutoff:this.filterCutoff,filterQ:this.filterQ,carrierOscillator:this.carrierOscillator.getJson(),modulatorOscillator:this.modulatorOscillator.getJson(),ampEnvelope:this.ampEnvelope.getJson(),filterEnvelope:this.filterEnvelope.getJson(),filterEnvelope2:this.filterEnvelope2.getJson(),modulationEnvelope:this.modulationEnvelope.getJson(),noiseVolume:this.noiseVolumeParameter.get()};return e=Object(ue.b)(e,"filterCutoffParameter",this.filterCutoffParameter),e=Object(ue.b)(e,"filterQParameter",this.filterQParameter),e=Object(ue.b)(e,"noiseVolumeParameter",this.noiseVolumeParameter)}},{key:"fromJson",value:function(e){for(var t in this.instrumentType=e.instrumentType,this.filterCutoff=e.filterCutoff,this.filterQ=e.filterQ,e.lfos)this.lfos[t].fromJson(e.lfos[t]);this.carrierOscillator.fromJson(e.carrierOscillator),this.modulatorOscillator.fromJson(e.modulatorOscillator),this.filterEnvelope.fromJson(e.filterEnvelope),e.filterEnvelope2&&this.filterEnvelope2.fromJson(e.filterEnvelope2),this.ampEnvelope.fromJson(e.ampEnvelope),this.modulationEnvelope.fromJson(e.modulationEnvelope),Object(ue.a)(e,"filterCutoffParameter",this.filterCutoffParameter,this.sequencerEngine),Object(ue.a)(e,"filterQParameter",this.filterQParameter,this.sequencerEngine)}},{key:"getCopy",value:function(e){var t=new n(this.sequencerEngine,this.mixSession,e);return t.fromJson(this.getJson()),t}},{key:"mateJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;this.carrierOscillator.mateJson(e.carrierOscillator,t),this.modulatorOscillator.mateJson(e.modulatorOscillator,t),this.ampEnvelope.mateJson(e.ampEnvelope,t),this.filterEnvelope.mateJson(e.filterEnvelope,t),this.filterEnvelope2.mateJson(e.filterEnvelope2,t),this.modulationEnvelope.mateJson(e.modulationEnvelope,t),this.mateParameter("filterCutoff",e,this.filterCutoffParameter,t),this.mateParameter("filterQ",e,this.filterQParameter,t),this.mateParameter("noiseVolume",e,this.noiseVolumeParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){Object(se.b)(this.sequencerEngine,e,t,n,r)}},{key:"findParameter",value:function(e,t){var n=e.envelopeType,r=this.getParameters();"AMP"===n?r=this.ampEnvelope.parameters:"MODULATION"===n?r=this.modulationEnvelope.parameters:"FILTER"===n?r=this.filterEnvelope.parameters:"FILTER_2"===n&&(r=this.filterEnvelope2.parameters);var a=r.filter(function(e){return e.name===t});if(0!==a.length)return a[0]}}]),n}(oe),Me=n(178),Re=function(e,t,n,r){var a=n.getAllSteps(),i=r.getAllSteps();for(var o in a){var s=a[o];if(0!==s.pLockedParameters.length){var c=i[o];for(var u in s.pLockedParameters){var l=s.pLockedParameters[u],f=Ce(l,t);f?(f.stepToValue[c.id]=l.stepToValue[s.id],delete l.stepToValue[c.id],delete f.stepToValue[s.id],c.pLockedParameters[u]=f):delete l.stepToValue[s.id]}}}},Ce=function(e,t){return[].concat(Object(h.a)(t.getAllParameters()),Object(h.a)(t.sequencerEngine.lfos.flatMap(function(e){return e.lfo.parameters}))).filter(function(t){return!!t.context&&(t.context.effect&&e.context.effect?t.context.effect.name===e.context.effect.name:t.context.midiEffect&&e.context.midiEffect?t.context.midiEffect.name===e.context.midiEffect.name:t.context.liveEffect&&e.context.liveEffect?t.context.liveEffect.name===e.context.liveEffect.name:t.context.instrument&&e.context.instrument&&t.context.subDevice&&e.context.subDevice?t.context.subDevice.name===e.context.subDevice.name:!(!t.context.lfoTrack||!e.context.lfoTrack)&&t.context.lfoTrack.number===e.context.lfoTrack.number)}).find(function(t){return t.name===e.name})};function Ne(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ie=n(367),qe=n(182);function _e(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var De=n(315),Fe=n(952),Le=n(44);function Be(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ze=n(451),Je=n(426);function Ve(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var He=n(199),Ue=n(285),Ge=n(316),We=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i){var o,s,c,u,l,f,h,d,p,v,m;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=[],s=0,c=new He.a(2,function(e,t,n){return[]}),u=t.state.freeze.loops,l=Object(Ue.d)(t,0,i)*u,f=0;case 6:if(!(f<r)){e.next=23;break}return d=(h=s)+re.a.Master.context.sampleRate*l*new re.a.Time("32n").toMilliseconds()/1e3,p=Object(Ge.a)(n,h,d,re.a.Master.context),s=d,e.next=13,c.uploadBufferToIpfs(p);case 13:v=e.sent,(m=new H.a(v)).audioBuffer=p,m.tempo=t.tempo,m.name="Frozen Pattern "+(f+1),m.tags=["Resampled"],o.push(m);case 20:f++,e.next=6;break;case 23:return e.abrupt("return",o);case 24:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),Ke=n(237);function Qe(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ze(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ze(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ye=function(){function e(t,n,r){Object(o.a)(this,e),this.output=new re.a.Gain(1),this.parameters=[],this.number=r,this.frozenSettings=[],this.frozenSamples=[],this.frozenSamplers=[],this.sequencerEngine=t,this.track=n,this.store=t.store,this.playingParameter=new he.a("playing",this,function(e,t){return[]},{isAlwaysLocked:!0,min:0,max:32,unit:"",defaultValue:void 0,automatable:!0}),this.registerParameter(this.playingParameter),this.gainParameter=new le.c("gain",this.output.gain,{isAlwaysLocked:!0,min:0,max:1,defaultValue:1}),this.registerParameter(this.gainParameter)}return Object(s.a)(e,[{key:"updateRedux",value:function(){this.store.dispatch(Object(J.Fb)(this.track.id,this.number,Object(h.a)(this.frozenSamples)))}},{key:"registerParameter",value:function(e){this.parameters.push(e),e.setStore(this.store),e.setContext((new X.a).forTrack(this.track))}},{key:"playing",get:function(){var e=this.playingParameter.get();if(void 0!==e&&null!==e)return Math.round(e)},set:function(e){this.playingParameter.set(e)}},{key:"saveAndPlayFrozen",value:function(e){this.track.lastFrozenSettings=this.sequencerEngine.getTrackPreset(this.track.trackNumber),this.playing=e,this.track.clearEffectsAndSamplers(),this.track.effectsChains[0].initDefault(),this.track.applyWarp(),this.track.isFrozen=!0,this.track.isFrozenPlaying=!0,this.track.getTrackType()===W.b&&this.track.instrument.dispose()}},{key:"loadFrozenSample",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine.bpm;this.frozenSamples.push(e);var r={slices:void 0,offset:0,transpose:0,volume:0},a=new Ke.a(this.track,e,function(e){e.gainNode.connect(t.output)},void 0,r);return a.tempo=n,a.init(),this.output.gain.value=1,this.frozenSamplers.push(a),this.updateRedux(),a}},{key:"getJson",value:function(){var e={frozenSettings:this.frozenSettings,frozenSamples:this.frozenSamples.map(function(e){return e.getId()}),frozenTempos:this.frozenSamplers.map(function(e){return e.tempo})};return e=Object(ue.b)(e,"playingParameter",this.playingParameter),e=Object(ue.b)(e,"gainParameter",this.gainParameter)}},{key:"getJsonSync",value:function(){var e,t={frozenSettings:this.frozenSettings,frozenSamples:this.frozenSamples.map(function(e){return e.getCopy(!0)}),frozenTempos:this.frozenSamplers.map(function(e){return e.tempo})},n=Qe(this.frozenSamplers);try{for(n.s();!(e=n.n()).done;){e.value.isCopied=!0}}catch(r){n.e(r)}finally{n.f()}return t=Object(ue.b)(t,"playingParameter",this.playingParameter),t=Object(ue.b)(t,"gainParameter",this.gainParameter)}},{key:"fromJsonSync",value:function(e){for(var t in this.frozenSettings=e.frozenSettings,e.frozenSamples){var n=e.frozenSamples[t];this.loadFrozenSample(n,e.frozenTempos[t]).isCopied=!0}Object(ue.a)(e,"playingParameter",this.playingParameter,this.sequencerEngine),Object(ue.a)(e,"gainParameter",this.gainParameter,this.sequencerEngine)}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.frozenSettings=t.frozenSettings,e.t0=a.a.keys(t.frozenSamples);case 2:if((e.t1=e.t0()).done){e.next=11;break}return n=e.t1.value,r=t.frozenSamples[n],i=new H.a(r),e.next=8,i.load();case 8:this.loadFrozenSample(i,t.frozenTempos[n]),e.next=2;break;case 11:Object(ue.a)(t,"playingParameter",this.playingParameter,this.sequencerEngine);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.frozenSamples.length,this.frozenSamplers.forEach(function(e){return e.dispose()}),this.frozenSamples.forEach(function(e){return e.dispose()}),this.frozenSamplers=void 0,this.frozenSamples=void 0,this.output.dispose(),this.output=void 0}}]),e}(),$e=n(145),Xe=n(321);function et(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return tt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tt(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function nt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}new re.a.Time("16n");var rt=function(e){return function(e){Object(u.a)(n,e);var t=nt(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).frozenSamplesToSave=[],e}return Object(s.a)(n,[{key:"frozenColumn",get:function(){return this.frozenColumns[0]}},{key:"newFrozenColumn",value:function(){if(void 0===this.frozenColumns){var e=new Ye(this.sequencerEngine,this,0);return e.output.connect(this.gainNode),this.frozenColumns=[e],e}var t=new Ye(this.sequencerEngine,this,this.frozenColumns.length);return t.output.connect(this.gainNode),this.frozenColumns=[].concat(Object(h.a)(this.frozenColumns),[t]),t}},{key:"freeze",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Array.isArray(e)||(e=[e]),!this.isAudioTrack){var r=this.state.effects.pulledEffects.filter(function(e){return(!e.context||e.context.track!==t)&&e.track!==t});this.dispatch(Object(J.dd)(r));this.getAllParameters().forEach(function(e){return e.isMapped&&e.isMapped.unmap(e)})}var a=this.sample,i=this.isAudioTrack?this.newFrozenColumn():this.frozenColumns[0]||this.newFrozenColumn();a&&(e.forEach(function(e){return e.name=a.name}),e.forEach(function(e){return e.tags=e.tags.concat(a.tags)}),e.forEach(function(e){return e.videoId=a.videoId}),e.forEach(function(e){return e.sourceSample=a})),this.tagFrozenSamples(e),this.frozenSamplesToSave=[].concat(Object(h.a)(this.frozenSamplesToSave),Object(h.a)(e)),this.isFrozen||n||(this.lastFrozenSettings=this.sequencerEngine.getTrackPreset(this.trackNumber,!1)),i.frozenSettings.push(this.isAudioTrack?{}:this.lastFrozenSettings);var o=this.isFrozen;this.store.dispatch(Object(J.ue)(this.subSequence.id,this.id,!0)),this.isAudioTrack||(this.clearEffectsAndSamplers(),this.effectsChains[0].initDefault(),this.applyWarp()),e.forEach(function(e){return i.loadFrozenSample(e,void 0)}),this.getTrackType()!==W.b||o?this.getTrackType()!==W.c||o||this.tracks.forEach(function(e){var t=e.track;return t.instrument&&t.instrument.dispose()}):this.instrument.dispose(),i.playing=i.frozenSamples.length-1,this.gated=!1,this.cachedPlayhead=void 0,this.parametersToScale=void 0,this.sequencerEngine.selectTrack(0),this.sequencerEngine.selectTrack(this.trackNumber),this.isEnabled&&!this.isAudioTrack&&this.setIsEnabled(!1),this.skipMidiMasterParameter.set(!0),this.trackIsLoading=!1}},{key:"clearEffectsAndSamplers",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.volumeParameter.deleteAutomations(),this.volumeParameter.deleteLocks(),this.effectsChains.forEach(function(e){return e.clear()}),this.midiEffects.effects=[],this.liveEffects.effects=[],this.tracks&&this.tracks.forEach(function(e){var t=e.track;t.effectsChains.forEach(function(e){return e.clear()}),t.midiEffects.effects=[],t.liveEffects.effects=[]});var e=this.getAllParameters().filter(function(e){return e.automations&&e.automations.length>0});this.sequencerEngine.store.dispatch(Object(J.c)(e))}},{key:"triggerFrozenSample",value:function(e){var t=new K.a;t.loadDefaults(),this.midiEffects.input(t,e,0)}},{key:"isFrozen",get:function(){return(this.store.getState().tracks.tracksFrozen[this.subSequence.id]||{})[this.id]},set:function(e){this.store.dispatch(Object(J.ue)(this.subSequence.id,this.id,e))}},{key:"unfreeze",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o,s,c=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.cachedPlayhead=void 0,t=this.lastFrozenSettings,this.clearEffectsAndSamplers(),this.store.dispatch(Object(J.ue)(this.subSequence.id,this.id,!1)),e.next=6,this.unfreezeInstrument(t);case 6:return this.trackData=new K.a(this.sequencerEngine,this.mix,(new X.a).forTrack(this)),this.trackData.loadDefaults(),t.trackParameters&&(this.gated=t.trackParameters.gated),this.trackData.loadFromJson(t.trackData,void 0,!1,!1,this.sequencerEngine),this.effectsChains[0].dispose(),e.next=13,this.sequencerEngine.loadEffectsPreset(t,!1,this);case 13:if(!this.tracks){e.next=34;break}n=0,r=et(this.tracks),e.prev=16,r.s();case 18:if((i=r.n()).done){e.next=26;break}return o=i.value,s=o.track,e.next=23,this.sequencerEngine.loadEffectsPreset(t.trackParameters.tracks[n],!1,s);case 23:n++;case 24:e.next=18;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(16),r.e(e.t0);case 31:return e.prev=31,r.f(),e.finish(31);case 34:this.skipMidiMasterParameter.set(!1),this.frozenColumns.forEach(function(e){return e.frozenSamplers.forEach(function(e){return e.release()})}),this.frozenColumns.forEach(function(e){return e.playing=void 0}),setTimeout(function(){c.loadLostParameters()},750);case 38:case"end":return e.stop()}},e,this,[[16,28,31,34]])}));return function(){return e.apply(this,arguments)}}()},{key:"unfreezeInstrument",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.frozenJson}},{key:"getFreezeJson",value:function(){return{lastFrozenSettings:this.lastFrozenSettings,frozenColumns:this.frozenColumns.map(function(e){return e.getJson()})}}},{key:"getFreezeJsonSync",value:function(){return{lastFrozenSettings:this.lastFrozenSettings,frozenColumns:this.frozenColumns.map(function(e){return e.getJsonSync()})}}},{key:"loadFreezeJsonSync",value:function(e){for(var t in this.lastFrozenSettings=e.lastFrozenSettings,e.frozenColumns){(this.frozenColumns[parseInt(t)]||this.newFrozenColumn()).fromJsonSync(e.frozenColumns[t])}}},{key:"loadFreezeJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.lastFrozenSettings=t.lastFrozenSettings,e.t0=a.a.keys(t.frozenColumns);case 2:if((e.t1=e.t0()).done){e.next=9;break}return n=e.t1.value,r=this.frozenColumns[parseInt(n)]||this.newFrozenColumn(),e.next=7,r.fromJson(t.frozenColumns[n]);case 7:e.next=2;break;case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"applyWarp",value:function(){this.operationManager.dispatch(Object(Le.b)(new Xe.a(this),this))}},{key:"dragFreezeIntoColumn",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.newFrozenColumn(),r=void 0,a=void 0,i=void 0,o=et(this.frozenColumns);try{for(o.s();!(t=o.n()).done;){var s=t.value;for(var c in s.frozenSamples)if(s.frozenSamples[c].ipfsHash===e){a=s.frozenSamples[c],r=s.frozenSamplers[c],i=s.frozenSettings[c],s.frozenSamples.splice(c,1),s.frozenSettings.splice(c,1),s.frozenSamplers.splice(c,1),s.updateRedux();break}}}catch(u){o.e(u)}finally{o.f()}void 0!==r&&(r.gainNode.disconnect(),n.frozenSamplers.push(r),n.frozenSamples.push(a),n.frozenSettings.push(i),r.gainNode.connect(n.output),n.playing=0,n.updateRedux())}},{key:"disposeFreezes",value:function(){this.frozenColumns.forEach(function(e){return e.dispose()}),this.frozenColumns=void 0}},{key:"freezeAllPatterns",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o,s,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.dispatch(Object(J.gc)("Freezing track's patterns")),e.next=3,Object(M.a)(250);case 3:return this.sequencerEngine.stop(),e.next=6,Object(Ue.c)(this.sequencerEngine,this);case 6:return t=e.sent,e.next=9,We(this.sequencerEngine,t,this.patterns.length,[this]);case 9:for(o in n=e.sent,this.freeze(n),r=this.sequencerEngine.state.freeze.loops,i=Object(Ue.d)(this.sequencerEngine,0,this.sequencerEngine.tracks)*r,this.patterns){for(o=parseInt(o),this.switchToPattern(o),s=i/this.pattern.length(),c=0;c<Math.log2(s);c++)this.pattern.doubleTrackLength();this.frozenColumns[0].playing=o,this.store.dispatch(Object(J.gc)(void 0))}case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"tagFrozenSamples",value:function(e){var t=this;if(this.instrument){var n=te.d[this.instrument.getInstrumentType()];e.forEach(function(e){return e.tags.push(n)}),this.presetName&&e.forEach(function(e){return e.tags.push(t.presetName)})}}}]),n}(e)};function at(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var it=new K.a,ot=n(63),st=n(258);function ct(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ut(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ut(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function lt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ft=["Duration","Transpose","Velocity","Chop","Panning","Slice","reverse"],ht=function(e){Object(u.a)(n,e);var t=lt(n);function n(e,r,a,i,s,c){var u;return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c)).annotations=[],u.setupAuxEventParameters(),u}return Object(s.a)(n,[{key:"getStepDataParams",value:function(){return ft}},{key:"getCopy",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,t,r,a,i,o){return new n(e,t,r,a,i,o)},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this.trackData.getCopy(void 0,void 0,void 0,void 0,!1),o=[].concat(this.soundIds),s=t(this.trackNumber,r,this.mixSession,this.patterns.length,this.update,r.currentSubSequence);s.stepGroups=this.stepGroups;var c=this.patterns.map(function(e){return e.getCopy(void 0,void 0,s)}),u=this.currentPattern,l=c[u];for(var f in c){var h=c[f];for(var d in h.stepBuckets)for(var p in h.stepBuckets[d].track=s,h.stepBuckets[d].steps)h.stepBuckets[d].steps[p].track=s;h.track=s}this.sample&&(s.sample=this.sample.getCopy()),s.lfosTrack&&s.lfosTrack.lfos.forEach(function(t,n){return t.lfo.fromJson(e.lfosTrack.lfos[n].getJson(),a)}),s.envelopesTrack&&s.envelopesTrack.envelopes.forEach(function(t,n){return t.envelope.fromJson(e.envelopesTrack.envelopes[n].getJson(),a)}),s.name=this.name,s.videoId=this.videoId,s.effectsChains[0].dispose(),s.effectsChains=this.effectsChains.map(function(e){return e.getCopy(s,r,a)}),s.midiEffects=this.midiEffects.getCopy(s,a),s.liveEffects=this.liveEffects.getCopy(s,a),s.trackData=i,s.patterns=c,s.currentPattern=u,s.pattern=l,s.soundIds=o,s.gated=this.gated;for(var v=0;v<c.length;v++)Re(0,s,this.patterns[v],c[v]);var m,y=ct(this.connectedEnvelopes.filter(function(e){return e.envelope}).map(function(e){return e.getJson()}));try{for(y.s();!(m=y.n()).done;){var b=m.value,g=r.envelopes[b.envelope];s.connectToEnvelope(g,b.mode)}}catch(x){y.e(x)}finally{y.f()}var O={};for(var j in this.samplers)O[j]=this.samplers[j].getCopy(function(e){return s.onNewSampler(s,e)},s);for(var k in s.samplers=O,s.updateSteps(!0),s.setSends(r.sends),s.sendNodeVolumeParameters)this.sendNodeVolumeParameters[k]&&s.sendNodeVolumeParameters[k].copyFrom(this.sendNodeVolumeParameters[k],r);if(s.volumeParameter.copyFrom(this.volumeParameter,r),s.isFrozen=this.isFrozen,s.isFrozen){var w=this.getFreezeJsonSync();s.loadFreezeJsonSync(w)}return this.samplesStream?s.samplesStream=this.samplesStream.getCopy(s.sample):s.samplesStream=new De.a(s.sample,this.sequencerEngine),s.presetName=this.presetName,s}},{key:"addNotes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine.bpm,r=re.a.Time("16n").toMilliseconds();e=e.map(function(e){var a=e.velocity/127;return{transpose:e.pitch-60,startTime:1e3*e.startTime,velocity:a,duration:n/t.sequencerEngine.bpm*(1e3*(e.endTime-e.startTime))/r}});re.a.Time("32n").toMilliseconds();var a=-1;for(var i in e){var o=Object(Fe.a)(e[i].startTime,n,this.sequencerEngine.bpm);e[i].step=o.stepNumber,e[i].position=o.offset,e[i].step>a&&(a=e[i].step)}for(;a>=this.pattern.length();)this.sequencerEngine.doubleTrackLength(this.trackNumber);var s=this.getEasyPattern();e.forEach(function(e){return s.addStep(t.getStepDataForNote(e),e.step,Me.a.baseResolution,e.position,!1,!0)}),s.update(!1),this.updateSteps()}},{key:"getStepDataForNote",value:function(e){var t=new K.a(this.sequencerEngine,void 0,void 0,this);return t.on=!0,t.transpose=e.transpose,t.duration=e.duration,t.velocity=e.velocity,t}},{key:"toggleStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.store.getState().sequencer.resolution,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.pattern.toggleStep(Me.a.baseResolution.transformStepAtResolution(e,t),t,n,this.trackData.transpose===n),this.pattern.syncBuckets(),this.updateSteps()}},{key:"getStep",value:function(e){return this.pattern.getAnyStep(e%this.pattern.length())}},{key:"recordHit",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;t=t||Me.a.baseResolution;var s=new K.a(void 0,void 0,void 0,this);if(s.on=!0,s.slice=n,s.duration=r,s.transpose=a,s.velocity=i,s.release=o,void 0===this.currentPattern){var c=new Z.a(this.sequencerEngine,this),u=e-e%t.transformStepAtResolution2(16,Me.a.baseResolution);c.startStep=Me.a.baseResolution.transformStepAtResolution2(u,t),this.patterns.push(c),this.switchToPattern(this.patterns.length-1),this.updateSteps()}void 0!==this.pattern.startStep&&(e-=t.transformStepAtResolution2(this.pattern.startStep,Me.a.baseResolution)),this.pattern.isRecording=!0,this.sequencerEngine.operationManager.dispatch(Object(Le.n)(this,s,e,t,this.state.sequencer.displayResolution))}},{key:"syncBuckets",value:function(e){this.pattern.syncBuckets(e.isTriplet),this.pattern.clearCache()}},{key:"recordUnquantizedHit",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=Me.a.baseResolution,c=new K.a;c.on=!0,c.slice=t,c.velocity=i,c.duration=n,c.transpose=a,c.release=o;var u=(e+r)%this.pattern.length(s);this.sequencerEngine.operationManager.dispatch(Object(Le.n)(this,c,Math.max(0,u),s,this.state.sequencer.displayResolution,!1))}},{key:"selectSlice",value:function(e,t){for(var n=-16,r=0;r<this.soundIds.length;r++){var a=this.samplers[this.soundIds[r]].getNumberOfSlices();n<a&&(n=a)}t%=n;var i=this.pattern.stepBuckets[e];for(var o in i.steps)i.steps[o].slice=t}}]),n}(Object(ot.a)(function(e){return function(e){Object(u.a)(n,e);var t=at(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).backStreams=[],e.forwardStreams=[],e}return Object(s.a)(n,[{key:"newSampleStream",value:function(e){this.samplesStream&&this.backStreams.push(this.samplesStream),this.forwardStreams.forEach(function(e){return e.dispose()}),this.forwardStreams=[],this.samplesStream=e}},{key:"backSamplesStream",value:function(){if(console.log("BACK SAMPLES STREAM CALLED"),0!==this.backStreams.length){var e=this.backStreams.pop();this.forwardStreams=[this.samplesStream].concat(Object(h.a)(this.forwardStreams)),this.samplesStream=e}}},{key:"forwardSamplesStream",value:function(){console.log("FWD SAMPLES STREAM CALLED");var e=this.forwardStreams.shift();this.backStreams.push(this.samplesStream),this.samplesStream=e}},{key:"getSamplesStream",value:function(){return this.samplesStream}},{key:"auditionNext",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o.length>0&&void 0!==o[0])||o[0],o.length>1&&void 0!==o[1]&&o[1],!this.isFrozen){e.next=4;break}return e.abrupt("return");case 4:if(t=this.instrumentRack?this.instrumentRack.trackNumber:this.trackNumber,this.store.dispatch(Object(J.we)(this.subSequence.id,t,!0)),(new Date).getTime(),e.prev=7,!this.loadingAudition){e.next=11;break}return this.store.dispatch(Object(J.we)(this.subSequence.id,t,!1)),e.abrupt("return");case 11:n=this.getSamplesStream(),r=0;case 13:if(!(r<8)||n.hasNext()){e.next=22;break}if(7!==r){e.next=17;break}return this.store.dispatch(Object(J.we)(this.subSequence.id,t,!1)),e.abrupt("return");case 17:return e.next=19,Object(M.a)(200);case 19:r++,e.next=13;break;case 22:return this.loadingAudition=!0,e.next=25,n.getNext();case 25:i=e.sent,this.store.dispatch(Object(J.we)(this.subSequence.id,t,!1)),this.loadingAudition=!1,this.releaseAll(),this.useNewSound(i),it.track=this,it.duration=4,this.sequencerEngine.playing||this.trigger(it),this.addSoundToBrowsedSamples(i),(new Date).getTime(),e.next=41;break;case 38:e.prev=38,e.t0=e.catch(7),this.loadingAudition=!1;case 41:case"end":return e.stop()}},e,this,[[7,38]])}));return function(){return e.apply(this,arguments)}}()},{key:"auditionPrevious",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i.length>0&&void 0!==i[0])||i[0],i.length>1&&void 0!==i[1]&&i[1],!this.isFrozen){e.next=4;break}return e.abrupt("return");case 4:if(t=this.instrumentRack?this.instrumentRack.trackNumber:this.trackNumber,this.store.dispatch(Object(J.we)(this.subSequence.id,t,!0)),e.prev=6,n=this.getSamplesStream(),!this.loadingAudition){e.next=11;break}return this.store.dispatch(Object(J.we)(this.subSequence.id,t,!1)),e.abrupt("return");case 11:if(n.hasPrevious()){e.next=14;break}return this.store.dispatch(Object(J.we)(this.subSequence.id,t,!1)),e.abrupt("return");case 14:return this.loadingAudition=!0,e.next=17,n.getPrevious();case 17:return r=e.sent,this.store.dispatch(Object(J.we)(this.subSequence.id,t,!1)),this.loadingAudition=!1,this.addSoundToBrowsedSamples(r),this.releaseAll(),e.next=24,this.useNewSound(r);case 24:it.track=this,it.duration=4,this.sequencerEngine.playing||this.trigger(it),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(6),this.loadingAudition=!1;case 32:case"end":return e.stop()}},e,this,[[6,29]])}));return function(){return e.apply(this,arguments)}}()},{key:"useSound",value:function(e,t){if(t)for(var n in this.samplers)this.samplers[n].dispose(),delete this.samplers[n];this.sample=e,this.soundIds=[e.getId()],this.toAudition.push(e.getId()),this.loadTrackInfo(!0,e)}},{key:"loadAndUseNewSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isLoaded()){e.next=3;break}return e.next=3,t.load();case 3:for(n in this.samplers)this.samplers[n].isChosen=!1;this.samplers[t.getId()]?this.samplers[t.getId()].isChosen=!0:this.loadTrackInfo(!0,t),this.soundIds=[t.getId()],this.videoId=t.videoId,this.sample=t,void 0===this.videoId&&this.getTrackType(),this.name=t.name;case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"useNewSound",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Object.keys(this.samplers)[0];if(r!==e.ipfsHash){var a=this.samplers[r];if(!a)return this.useSound(e,!0),void(this.pad&&this.pad.sendTags());this.samplers[e.getId()]=a,delete this.samplers[r],a.sample=e,this.soundIds=[e.getId()],this.videoId=e.videoId,this.sample=e,void 0===this.videoId&&this.getTrackType(),this.name=e.name,a.replaceBuffer(e.audioBuffer,n),t&&(it.track=this,it.duration=4,this.sequencerEngine.playing||this.trigger(it)),this.pad&&this.pad.sendTags()}}},{key:"auditionSeek",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.dispatch(Object(J.we)(this.subSequence.id,this.trackNumber,!0)),e.next=3,this.samplesStream.seek(t);case 3:if(n=e.sent){e.next=7;break}return this.store.dispatch(Object(J.we)(this.subSequence.id,this.trackNumber,!1)),e.abrupt("return");case 7:return this.loadingAudition=!1,this.addSoundToBrowsedSamples(n),this.releaseAll(),e.next=12,this.useNewSound(n);case 12:it.track=this,it.duration=4,this.sequencerEngine.playing||this.trigger(it),this.store.dispatch(Object(J.we)(this.subSequence.id,this.trackNumber,!1));case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"auditionSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]&&s[1],r=s.length>2?s[2]:void 0,i=!(s.length>3&&void 0!==s[3])||s[3],this.store.dispatch(Object(J.we)(this.subSequence.id,this.trackNumber,!0)),o=this.sample,"string"===typeof t&&(t=new H.a(t)),t.isLoaded()){e.next=10;break}return e.next=9,t.load();case 9:t.samplesStream&&(r=t.samplesStream.getCopy(t));case 10:this.savedSoundIds=Object(h.a)(this.soundIds),this.soundIds=[t.getId()],this.toAudition.push(t.getId()),this.auditionedSounds.push(t.getId()),r&&(r.counter=r.sounds.indexOf(t.getId())),this.samplesStream&&n&&this.samplesStream.dispose(),this.samplesStream=r||new De.a(t,this.sequencerEngine),this.loadTrackInfo(!0,t),i&&this.addSoundToBrowsedSamples(t,o);case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addSoundToBrowsedSamples",value:function(e,t){var n=this,r=this.state.tracks.trackBrowsedSamples[this.id]||[];if(t){var a=r.indexOf(t);a>-1&&(r.slice(0,a).forEach(function(e){var t=e.ipfsHash,r=n.samplers[t];r&&(r.dispose(),delete n.samplers[t]),e.dispose(!0)}),r=r.slice(a))}if(!(r.indexOf(e)>-1)){var i=[e].concat(Object(h.a)(r.filter(function(t){return t.ipfsHash!==e.ipfsHash})));this.store.dispatch(Object(J.re)(this.id,i))}}},{key:"isAuditioning",value:function(){return this.auditionedSounds.length>0}},{key:"completeAudition",value:function(){for(var e in this.auditionedSounds)if(-1==this.soundIds.indexOf(this.auditionedSounds[e])){var t=this.samplers[this.auditionedSounds[e]];t&&(t.dispose(),delete this.samplers[this.auditionedSounds[e]])}this.auditionedSounds=[],this.store.dispatch(Object(J.id)(void 0))}},{key:"cancelAudition",value:function(){this.isAuditioning()&&(this.soundIds=this.savedSoundIds,this.revertAuditionedSounds()),this.store.dispatch(Object(J.id)(void 0))}},{key:"revertAuditionedSounds",value:function(){for(var e in this.auditionedSounds){var t=this.samplers[this.auditionedSounds[e]];t&&(t.dispose(),delete this.samplers[this.auditionedSounds[e]])}this.auditionedSounds=[]}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=_e(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"onRestart",value:function(e){if("clear"!==e)if(e&&void 0!==e.stepNumber)this.restartedAtStepNumber=e.stepNumber;else if(e&&e.startsWith&&e.startsWith("quantize")){var t=e.split(" "),n=16;t[1]&&(n=parseInt(t[1]));var r=this.sequencerEngine.trackStep%n;this.restartedAtStepNumber=this.sequencerEngine.trackStep-r}else this.restartedAtStepNumber=this.sequencerEngine.trackStep;else this.restartedAtStepNumber=void 0}},{key:"getPatternStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isMetronome){var n=void 0===this.pattern.startStep?0:this.pattern.startStep,r=this.pattern.length();return this.subSequence.isTrack?e-n:e%r}if(!t){if(!this.playheadEffect&&this.pattern&&1===this.speedFactor){if(this.isLooping){var a=this.loopStart;e%=this.loopLength||8,e+=a}return e%this.length}return this.lastPatternStep||0}void 0!==this.restartedAtStepNumber&&(e-=this.restartedAtStepNumber);var i=void 0===this.pattern.startStep?0:this.pattern.startStep,o=this.length,s=this.playheadDirection;if(s===Ie.a)return this.getBrownian(e,t);e=e*this.speedFactor+Math.floor(this.offset);var c=this.subSequence.isTrack?e-i:e%o;if(this.isLooping){var u=this.loopStart;c%=this.loopLength||8,c+=u}return t&this.speedFactor<1&&c===this.lastPatternStep?void 0:(s===Ie.c&&(s=Math.floor(e/o)%2===0?Ie.b:Ie.d),s===Ie.d&&(this.playheadDirection===Ie.c?(c=o-c)===o&&(c=o-2):c=o-c-2),this.lastPatternDirection=s,this.lastPatternStep=c,c)}},{key:"isPlayheadReversed",value:function(){return this.lastPatternDirection===Ie.d}},{key:"playheadEffect",get:function(){return this.cachedPlayhead?this.cachedPlayhead:(this.cachedPlayhead=this.liveEffects.effects.find(function(e){return e.effect===qe.e}),this.cachedPlayhead)}},{key:"playheadDirection",get:function(){var e=this.playheadEffect;return e?this.subSequencePlayhead.direction!==Ie.b?this.subSequencePlayhead.direction:e.direction:Ie.b}},{key:"subSequencePlayhead",get:function(){return this.subSequence.playhead}},{key:"speedFactor",get:function(){var e=this.playheadEffect;return(e?this.subSequence.playhead.speedFactor*e.speedFactor:this.subSequence.playhead?this.subSequence.playhead.speedFactor:1)*this.sequencerEngine.higherOrderSequencer.getSpeedForModule(this.subSequence)}},{key:"offset",get:function(){var e=this.playheadEffect;return e?e.offset:0}},{key:"walk",get:function(){var e=this.playheadEffect;return e?e.walk:2}},{key:"getBrownian",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===this.lastPatternStep&&t)return this.lastPatternStep=e,e;if(((e=this.lastPatternStep)+1)%this.walk===0){var n=Math.random();n<.5?e+=1:e-=n<.75?2*this.walk-1:this.walk-1,e<0?e=this.length-this.walk:e%=this.length}else e++;return t&&(this.lastPatternStep=e),e}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Ne(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getParametersToShow",value:function(){var e=Object(h.a)(this.effects);for(var t in this.effects){var n=this.effects[t];"Effect Rack"===n.name&&(e=[].concat(Object(h.a)(e),Object(h.a)(n.effects),Object(h.a)(n.macros.map(function(e){return e.macroParameter}))))}if(this.tracks)for(var r in this.tracks)e=[].concat(Object(h.a)(e),Object(h.a)(this.tracks[r].track.effects));var a=e.find(function(e){return"Filter"===e.name}),i=(e.find(function(e){return"EQ 8"===e.name}),e.find(function(e){return"Tape Delay"===e.name})),o=this.midiEffects.effects.find(function(e){return"Warp"===e.name}),s=this.midiEffects.effects.find(function(e){return"Tidal"===e.name}),c=[];return a&&c.push(a.cutoffParameter),i&&(c.push(i.rateParameter),c.push(i.wetParameter)),o&&c.push(o.loopLengthParameter),s&&c.push(s.cycleParameter),c}}]),n}(e)},rt,function(e){return function(e){Object(u.a)(n,e);var t=Be(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"convertToSampledInstrument",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.pad,n=void 0,t&&(n=t.slots.indexOf(this)),r=this.sequencerEngine.addSampledInstrumentTrack(!1,!0),i=this.sample,r.instrument.newSample(0,i,this.samplesStream.getCopy(this.sample)),this.convertGenericTrack(r),r.sample=i,t&&t.addTrack(r,n);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"copyPatterns",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.patterns.map(function(e){return e.getCopy(void 0,void 0,t)}),e.next=3,Promise.all(n);case 3:for(r in n=e.sent){for(o in(i=n[r]).stepBuckets)for(s in i.stepBuckets[o].track=t,i.stepBuckets[o].steps)i.stepBuckets[o].steps[s].track=t;i.track=t}return e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"copyEffects",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.effectsChain.getJson(),e.next=3,t.midiEffects.fromJson(this.midiEffects.getJson());case 3:return e.next=5,t.effectsChain.fromJson(n,this.sequencerEngine.tracks,this.trackNumber);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"convertGenericTrack",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyPatterns(t);case 2:return t.patterns=e.sent,t.pattern=t.patterns[this.currentPattern],t.stepGroups=t.patterns.map(function(e){return e.getAllGroups()}).reduce(function(e,t){return[].concat(Object(h.a)(e),Object(h.a)(t))},[]),n=this.trackNumber,(r=this.sequencerEngine.tracks).splice(n,1),i=this.getAllParameters(),o=i.filter(function(e){return e.automations&&e.automations.length>0}),this.sequencerEngine.store.dispatch(Object(J.c)(o)),e.next=13,this.copyEffects(t);case 13:this.sequencerEngine.tracks=[].concat(Object(h.a)(r.slice(0,n)),[this],Object(h.a)(r.slice(n))),this.sequencerEngine.deleteTrack(n,t),t.pattern.updateStepResolutionTree(),this.sequencerEngine.updateSteps(),this.sequencerEngine.selectTrack(n),t.getAllParameters().filter(function(e){return e.automations&&e.automations.length>0}).forEach(function(e){return e.automation.updateRedux()}),setTimeout(function(){t.tracks?t.tracks[0].track.loadLostParameters():t.loadLostParameters()},250);case 22:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"convertToInstrumentRack",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.sequencerEngine.addInstrumentRackTrack(!1,!0),(n=this.getTrackType())!==W.f){e.next=6;break}t.addSample(this.sample,this.samplesStream.getCopy(this.sample)),e.next=11;break;case 6:if(n!==W.b){e.next=11;break}return r=t.addInstrumentType(this.getInstrumentType()),i=this.getJson(),e.next=11,r.track.fromJson(i,void 0,!1,!1,!0,!0);case 11:return e.next=13,this.convertGenericTrack(t);case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Ve(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"setupAuxEventParameters",value:function(){this.createAuxEventType("A"),this.createAuxEventType("B"),this.createAuxEventType("C"),this.createAuxEventType("D"),this.accumulators={}}},{key:"createAuxEventType",value:function(e){var t="auxEvent"+e,n=new he.a(t+"Type",this,function(e,t){return[]},{defaultValue:Je.b,automatable:!1}),r=new he.a(t+"Variable",this,function(e,t){return[]},{defaultValue:"transpose",automatable:!1}),a=new he.a(t+"Limit",this,function(e,t){return[]},{defaultValue:1,automatable:!1,min:0,max:32}),i=new he.a(t+"Mode",this,function(e,t){return[]},{defaultValue:ze.a,automatable:!1});this[t+"TypeParameter"]=n,this[t+"LimitParameter"]=a,this[t+"ModeParameter"]=i,this[t+"VariableParameter"]=r,this.registerParameter(n),this.registerParameter(a),this.registerParameter(i),this.registerParameter(r)}},{key:"auxEventAType",get:function(){return this.auxEventATypeParameter.get()}},{key:"auxEventBType",get:function(){return this.auxEventBTypeParameter.get()}},{key:"auxEventCType",get:function(){return this.auxEventCTypeParameter.get()}},{key:"auxEventDType",get:function(){return this.auxEventDTypeParameter.get()}},{key:"getAuxLimit",value:function(e){return this["auxEvent"+e.split(" ")[2]+"LimitParameter"].get()}},{key:"getAuxVariable",value:function(e){return this["auxEvent"+e.split(" ")[2]+"VariableParameter"].get()}},{key:"getAuxMode",value:function(e){return this["auxEvent"+e.split(" ")[2]+"ModeParameter"].get()}},{key:"getAuxJson",value:function(){for(var e={},t=0,n=["A","B","C","D"];t<n.length;t++){var r=n[t],a="auxEvent"+r+"TypeParameter",i="auxEvent"+r+"VariableParameter",o="auxEvent"+r+"LimitParameter",s="auxEvent"+r+"ModeParameter";e[a]=this[a].getJson(),e[i]=this[i].getJson(),e[o]=this[o].getJson(),e[s]=this[s].getJson()}return e}},{key:"fromAuxJson",value:function(e){for(var t=0,n=["A","B","C","D"];t<n.length;t++){var r=n[t],a="auxEvent"+r+"TypeParameter",i="auxEvent"+r+"VariableParameter",o="auxEvent"+r+"LimitParameter",s="auxEvent"+r+"ModeParameter";this[a].fromJson(e[a]),this[i].fromJson(e[i]),this[o].fromJson(e[o]),this[s].fromJson(e[s])}}}]),n}(e)})(Me.a.Track)),dt=n(222),pt=n(209),vt=function(){function e(){Object(o.a)(this,e),this.output=new re.a.Gain(1),this.oscillator={_oscillator:{},type:"",customType:"",frequency:new re.a.Signal(1),waveMorpher:new re.a.Signal(1)},this.envelope=new re.a.AmplitudeEnvelope,this.detune=new re.a.Signal(0),this.frequency=this.oscillator.frequency,this._volume=new re.a.Gain(0),this.volume=this._volume.gain,this.envelope.connect(this._volume),this._volume.connect(this.output),this.loadRNBO()}return Object(s.a)(e,[{key:"dispose",value:function(){}},{key:"triggerAttack",value:function(e,t,n){this._triggerEnvelopeAttack(t,n),this.setNote(e,t)}},{key:"setNote",value:function(e,t){t=this.toSeconds(t),this.frequency.setValueAtTime(e,t)}},{key:"toSeconds",value:function(e){return re.a.isNumber(e)?e:re.a.isUndef(e)?this.now():re.a.isString(e)||re.a.isObject(e)?new re.a.Time(e).toSeconds():e instanceof re.a.TimeBase?e.toSeconds():void 0}},{key:"triggerAttackRelease",value:function(e,t,n,r){return n=this.toSeconds(n),t=this.toSeconds(t),this.triggerAttack(e,n,r),this.triggerRelease(n+t),this}},{key:"triggerRelease",value:function(){}},{key:"_triggerEnvelopeAttack",value:function(e,t){return e=this.toSeconds(e),this.envelope.triggerAttack(e,t),this}},{key:"_triggerEnvelopeRelease",value:function(e){return this.envelope.triggerRelease(e),this}},{key:"loadRNBO",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/wavetable.export.json");case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,e.next=8,Object(pt.createDevice)({context:re.a.Master.context._context,patcher:n});case 8:return this.device=e.sent,r=[{id:"tables",file:"/wavetable64.wav"}],e.next=12,this.device.loadDataBufferDependencies(r);case 12:e.sent,console.log("patcher = ",this.device),this.deviceNode=this.device.node,this.oscillator.frequency.connect(this.deviceNode),this.oscillator.waveMorpher.connect(this.deviceNode,0,1),this.deviceNode.connect(this.envelope);case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"connect",value:function(e){this.output.connect(e)}},{key:"disconnect",value:function(e){this.output.disconnect(e)}}]),e}(),mt=function(){function e(t,n,r,a){Object(o.a)(this,e),this.synth=t,this.store=n,this.mixSession=r,this.context=a,this.parameters=[],this.setupParameters()}return Object(s.a)(e,[{key:"onNewSynth",value:function(e){this.synth=e,this.refreshParameters()}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"baseFrequency",get:function(){return this.baseFrequencyParameter.get()},set:function(e){this.baseFrequencyParameter.set(e)}},{key:"octaves",get:function(){return this.octavesParameter.get()},set:function(e){this.octavesParameter.set(e)}},{key:"refreshParameters",value:function(){this.baseFrequency=this.baseFrequency,this.octaves=this.octaves,this.attack=this.attack,this.decay=this.decay,this.sustain=this.sustain,this.release=this.release}},{key:"setupParameters",value:function(){this.attackParameter=new he.a("Filter Envelope Attack",this,function(e,t){return e.synth.set({filterEnvelope:{attack:t/1e3}})},{min:0,max:1e4,unit:"ms",defaultValue:60}),this.registerParameter(this.attackParameter),this.decayParameter=new he.a("Filter Envelope Decay",this,function(e,t){return e.synth.set({filterEnvelope:{decay:t/1e3}})},{min:0,max:1,unit:"ms",defaultValue:60}),this.registerParameter(this.decayParameter),this.sustainParameter=new he.a("Filter Envelope Sustain",this,function(e,t){return e.synth.set({filterEnvelope:{sustain:t}})},{min:0,max:1,unit:"",defaultValue:.9}),this.registerParameter(this.sustainParameter),this.releaseParameter=new he.a("Filter Envelope Release",this,function(e,t){return e.synth.set({filterEnvelope:{release:t/1e3}})},{min:0,max:1,unit:"ms",defaultValue:60}),this.registerParameter(this.releaseParameter),this.baseFrequencyParameter=new he.b("Filter Envelope Base Frequency",this,function(e,t){return e.synth.set({filterEnvelope:{baseFrequency:t}})},{min:0,max:1e4,unit:"HZ",defaultValue:100}),this.registerParameter(this.baseFrequencyParameter),this.octavesParameter=new he.b("Filter Envelope Octaves",this,function(e,t){return e.synth.set({filterEnvelope:{octaves:t}})},{min:0,max:10,unit:"",defaultValue:1}),this.registerParameter(this.octavesParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),this.parameters.push(e)}},{key:"copyFrom",value:function(e){this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.baseFrequency=e.baseFrequency,this.octaves=e.octaves}},{key:"getJson",value:function(){return{baseFrequency:this.baseFrequency,octaves:this.octaves,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release}}},{key:"fromJson",value:function(e){"baseFrequency"in e&&(this.baseFrequency=e.baseFrequency),"octaves"in e&&(this.octaves=e.octaves),"attack"in e&&(this.attack=e.attack),"decay"in e&&(this.decay=e.decay),"sustain"in e&&(this.sustain=e.sustain),"releease"in e&&(this.release=e.release)}}]),e}(),yt=n(372);function bt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var gt=function(e){Object(u.a)(n,e);var t=bt(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this)).sequencerEngine=e,i.store=e.store,i.mixSession=r,i.context=a,i.synth=new re.a.PolySynth(1,vt),i.synth.volume.value=-4,i.lfos=[i.createLFO(),i.createLFO(),i.createLFO(),i.createLFO()],i.filterEnvelope=new mt(i.synth,i.store,r,a),i.polyphonySet=!1,i.parameters=[],i.parameterToSignal={},i.parameterToLFOs={},i.setupParameters(),i.lfos.forEach(function(e){return e.start()}),i.refreshParameters(),i.node=void 0,i}return Object(s.a)(n,[{key:"getName",value:function(){return"Synth"}},{key:"isMonophonic",value:function(){return 1===this.polyphony}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return te.i}},{key:"hasLFO",value:function(){return!0}},{key:"start",value:function(){this.lfos.forEach(function(e){return e.start()})}},{key:"stop",value:function(){this.lfos.forEach(function(e){return e.stop()})}},{key:"oscillatorType",get:function(){return this.oscillatorTypeParameter.get()},set:function(e){var t=this.oscillatorTypeParameter.get();this.oscillatorTypeParameter.set(e),"pulse"===e&&t!==e&&this.onChangeToPulse()}},{key:"oscillatorFrequency",get:function(){return this.oscillatorFrequencyParameter.get()},set:function(e){this.oscillatorFrequencyParameter.set(e)}},{key:"filterCutoff",get:function(){return this.filterCutoffParameter.get()},set:function(e){this.filterCutoffParameter.set(e)}},{key:"filterQ",get:function(){return this.filterQParameter.get()},set:function(e){this.filterQParameter.set(e)}},{key:"portamento",get:function(){return this.portamentoParameter.get()},set:function(e){this.portamentoParameter.set(e)}},{key:"polyphony",get:function(){return void 0===this.polyphonyParameter?8:this.polyphonyParameter.get()},set:function(e){this.polyphonyParameter.set(e)}},{key:"detune",get:function(){return this.detuneParameter.get()},set:function(e){this.detuneParameter.set(e)}},{key:"pulseWidth",get:function(){return this.pulseWidthParameter.get()},set:function(e){this.pulseWidthParameter.set(e)}},{key:"ampAttack",get:function(){return this.ampAttackParameter.get()},set:function(e){return this.ampAttackParameter.set(e)}},{key:"ampDecay",get:function(){return this.ampDecayParameter.get()},set:function(e){return this.ampDecayParameter.set(e)}},{key:"ampSustain",get:function(){return this.ampSustainParameter.get()},set:function(e){return this.ampSustainParameter.set(e)}},{key:"ampRelease",get:function(){return this.ampReleaseParameter.get()},set:function(e){return this.ampReleaseParameter.set(e)}},{key:"refreshParameters",value:function(){this.pulseWidth=this.pulseWidth,this.oscillatorType=this.oscillatorType,this.filterQ=this.filterQ,this.portamento=this.portamento,this.filterCutoff=this.filterCutoff}},{key:"createNewSynth",value:function(e){var t=this.node;this.disconnect(t),this.synth=new re.a.PolySynth(e,re.a.MonoSynth),this.filterEnvelope.onNewSynth(this.synth),this.connect(t),this.polyphonySet=!1,this.refreshParameters(),this.reconnectAllLFOParameters()}},{key:"triggerAttack",value:function(e,t,n){var r=this.getNoteFromTranspose(e);this.synth.triggerAttack(r,t,n)}},{key:"triggerAttackRelease",value:function(e,t,n,r){var a=this.getNoteFromTranspose(e);this.synth.triggerAttackRelease(a,t,n,r)}},{key:"triggerRelease",value:function(e){var t=this,n=e.map(function(e){return t.getNoteFromTranspose(e)});this.synth.triggerRelease(n)}},{key:"createLFO",value:function(){return new yt.a(this.sequencerEngine,this.mixSession,this.context)}},{key:"setupParameters",value:function(e){var t=this;this.oscillatorTypeParameter=new he.a("Oscillator Type",this,function(e,t){return e.synth.set({oscillator:{type:t}})},{min:0,max:1,unit:"",defaultValue:"triangle",automatable:!1}),this.registerParameter(this.oscillatorTypeParameter),this.oscillatorFrequencyParameter=new he.a("Oscillator Frequency",this,function(e,t){return[]},{min:0,max:1,unit:"",defaultValue:0,automatable:!1}),this.registerParameter(this.oscillatorFrequencyParameter),this.pulseWidthParameter=new he.a("Pulse Width",this,function(e,t){return e.synth.set({oscillator:{width:t}})},{min:0,max:1,unit:"",defaultValue:.1}),this.registerParameter(this.pulseWidthParameter,function(e){return e.oscillator.width}),this.filterCutoffParameter=new he.b("Filter Cutoff",this,function(e,t){e.synth.set({filter:{frequency:t}})},{min:0,max:1e4,unit:"HZ",defaultValue:1200}),this.registerParameter(this.filterCutoffParameter,function(e){return e.filter.frequency}),this.filterQParameter=new he.b("Filter Q",this,function(e,t){return e.synth.set({filter:{Q:t}})},{min:0,max:9,unit:"",defaultValue:1}),this.registerParameter(this.filterQParameter,function(e){return e.filter.Q}),this.portamentoParameter=new he.a("Portamento",this,function(e,t){return e.synth.set({portamento:t/20})},{min:0,max:10,unit:"",defaultValue:0}),this.registerParameter(this.portamentoParameter),this.detuneParameter=new he.b("Detune",this,function(e,t){e.synth.set({detune:t})},{min:-100,max:100,unit:"",defaultValue:0,automatable:!1}),this.parameterToSignal[this.detuneParameter.name]=function(e){return e.oscillator.detune},this.registerParameter(this.detuneParameter),this.polyphonyParameter=new he.b("Polyphony",this,function(e,n){t.polyphonySet&&t.createNewSynth(n),t.polyphonySet=!0},{min:0,max:16,unit:"",defaultValue:1,automatable:!1}),this.registerParameter(this.polyphonyParameter),this.ampAttackParameter=new he.a("Amp Attack",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.ampAttackParameter),this.ampDecayParameter=new he.a("Amp Decay",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.ampDecayParameter),this.ampSustainParameter=new he.a("Amp Sustain",this,function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),this.registerParameter(this.ampSustainParameter),this.ampReleaseParameter=new he.a("Amp Release",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.ampReleaseParameter)}},{key:"registerParameter",value:function(e,t){void 0!==t&&(this.parameterToSignal[e.name]=t),e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getCopy",value:function(e){var t=this,r=new n(this.store,this.mixSession,e);for(var a in r.instrumentType=this.instrumentType,r.oscillatorFrequency=this.oscillatorFrequency,r.filterCutoff=this.filterCutoff,r.filterQ=this.filterQ,r.polyphony=this.polyphony,r.portamento=this.portamento,r.filterEnvelope.copyFrom(this.filterEnvelope),r.oscillatorType=this.oscillatorType,r.pulseWidth=this.pulseWidth,r.lfos)r.lfos[a].copyFrom(this.lfos[a]);r.parameterToLFOs={};var i=function(e){var n=t.parameterToLFOs[e],a=r.getParameterByName(e);n.forEach(function(e){var n=r.lfos[t.lfos.indexOf(e)];r.connectLFOToParameter(n,a)})};for(var o in this.parameterToLFOs)i(o);return r}},{key:"getParameters",value:function(){return[].concat(Object(h.a)(this.parameters),Object(h.a)(this.filterEnvelope.parameters))}},{key:"getJson",value:function(){var e={instrumentType:this.getInstrumentType(),oscillatorType:this.oscillatorType,oscillatorFrequency:this.oscillatorFrequency,filterCutoff:this.filterCutoff,filterQ:this.filterQ,polyphony:this.polyphony,portamento:this.portamento,pulseWidth:this.pulseWidth,lfos:this.lfos.map(function(e){return e.getJson()}),parameterToLFOs:this.getParameterToLFOsJson(),filterEnvelope:this.filterEnvelope.getJson(),ampAttack:this.ampAttack,ampDecay:this.ampDecay,ampSustain:this.ampSustain,ampRelease:this.ampRelease};return e=Object(ue.b)(e,"filterCutoffParameter",this.filterCutoffParameter),e=Object(ue.b)(e,"filterQParameter",this.filterQParameter),e=Object(ue.b)(e,"portamentoParameter",this.portamentoParameter),e=Object(ue.b)(e,"pulseWidthParameter",this.pulseWidthParameter),e=Object(ue.b)(e,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter),e=Object(ue.b)(e,"oscillatorTypeParameter",this.oscillatorTypeParameter),e=Object(ue.b)(e,"ampAttackParameter",this.ampAttackParameter),e=Object(ue.b)(e,"ampDecayParameter",this.ampDecayParameter),e=Object(ue.b)(e,"ampSustainParameter",this.ampSustainParameter),e=Object(ue.b)(e,"ampReleaseParameter",this.ampReleaseParameter)}},{key:"getParameterToLFOsJson",value:function(){var e=this,t={},n=function(n){var r=[];e.parameterToLFOs[n].forEach(function(t){return r.push(e.lfos.indexOf(t))}),t[n]=r};for(var r in this.parameterToLFOs)n(r);return t}},{key:"fromJson",value:function(e){if("instrumentType"in e&&(this.instrumentType=e.instrumentType),"polyphony"in e&&(this.polyphony=e.polyphony),"oscillatorFrequency"in e&&(this.oscillatorFrequency=e.oscillatorFrequency),"pulseWidth"in e&&(this.pulseWidth=e.pulseWidth),"oscillatorType"in e&&(this.oscillatorType=e.oscillatorType),"filterCutoff"in e&&(this.filterCutoff=e.filterCutoff),"filterQ"in e&&(this.filterQ=e.filterQ),"portamento"in e&&(this.portamento=e.portamento),"filterEnvelope"in e&&this.filterEnvelope.fromJson(e.filterEnvelope),"lfos"in e)for(var t in e.lfos)this.lfos[t].fromJson(e.lfos[t]);"parameterToLFOs"in e&&this.loadParameterToLFOsJson(e.parameterToLFOs),"ampAttack"in e&&(this.ampAttack=e.ampAttack),"ampDecay"in e&&(this.ampDecay=e.ampDecay),"ampSustain"in e&&(this.ampSustain=e.ampSustain),"ampRelease"in e&&(this.ampRelease=e.ampRelease),Object(ue.a)(e,"filterCutoffParameter",this.filterCutoffParameter,this.sequencerEngine),Object(ue.a)(e,"filterQParameter",this.filterQParameter,this.sequencerEngine),Object(ue.a)(e,"portamentoParameter",this.portamentoParameter,this.sequencerEngine),Object(ue.a)(e,"pulseWidthParameter",this.pulseWidthParameter,this.sequencerEngine),Object(ue.a)(e,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter,this.sequencerEngine),Object(ue.a)(e,"oscillatorTypeParameter",this.oscillatorTypeParameter,this.sequencerEngine),Object(ue.a)(e,"ampAttackParameter",this.ampAttackParameter,this.sequencerEngine),Object(ue.a)(e,"ampDecayParameter",this.ampDecayParameter,this.sequencerEngine),Object(ue.a)(e,"ampSustainParameter",this.ampSustainParameter,this.sequencerEngine),Object(ue.a)(e,"ampReleaseParameter",this.ampReleaseParameter,this.sequencerEngine)}},{key:"getParameterByName",value:function(e){var t=this.parameters.filter(function(t){return t.name===e});if(!(t.length<1))return t[0]}},{key:"loadParameterToLFOsJson",value:function(e){var t=this,n=function(n){var r=t.getParameterByName(n);if(void 0===r)return"continue";e[n].forEach(function(e){return t.connectLFOToParameter(t.lfos[e],r)})};for(var r in e)n(r)}},{key:"connectLFOToParameter",value:function(e,t){var n=this,r=!1;void 0!==this.parameterToSignal[t.name]&&(this.synth.voices.forEach(function(a,i){var o=n.parameterToSignal[t.name](a);void 0===o?r=!0:e.connect(o,t,i)}),r||(t.name in this.parameterToLFOs?this.parameterToLFOs[t.name].add(e):this.parameterToLFOs[t.name]=new Set([e]),this.refreshParameters()))}},{key:"disconnectLFOToParameter",value:function(e,t){var n=this;this.parameterToLFOs[t.name].has(e)&&(this.synth.voices.forEach(function(r,a){e.disconnect(n.parameterToSignal[t.name](r),t,a)}),this.parameterToLFOs[t.name].delete(e))}},{key:"isParameterConnectedToLFO",value:function(e,t){return e.name in this.parameterToLFOs&&this.parameterToLFOs[e.name].has(t)}},{key:"toggleParameterWithLFO",value:function(e,t){this.isParameterConnectedToLFO(e,t)?this.disconnectLFOToParameter(t,e):this.connectLFOToParameter(t,e)}},{key:"reconnectAllLFOParameters",value:function(){var e=this,t=function(t){var n=e.parameterToLFOs[t],r=e.getParameterByName(t);n.forEach(function(t){return e.connectLFOToParameter(t,r)})};for(var n in this.parameterToLFOs)t(n)}},{key:"onChangeToPulse",value:function(){var e=this;this.pulseWidthParameter.name in this.parameterToLFOs&&this.parameterToLFOs[this.pulseWidthParameter.name].forEach(function(t){return e.connectLFOToParameter(t,e.pulseWidthParameter,!0)})}},{key:"connect",value:function(e){void 0!==e&&(this.synth.connect(e),this.node=e)}},{key:"disconnect",value:function(e){this.synth.disconnect(e),this.node=void 0}},{key:"getEnvelopes",value:function(){return this.synth.voices.map(function(e){return e.envelope})}},{key:"releaseAll",value:function(){this.synth.voices.forEach(function(e){return e.triggerRelease()})}},{key:"getNoteFromTranspose",value:function(e){return e+=this.sequencerEngine.transpose,this.getDefaultNote().transpose(e+this.oscillatorFrequency)}},{key:"setEnvelopes",value:function(e){var t=this,n=this.getEnvelopes();n.forEach(function(e){return e.attack=new re.a.Time((1+t.ampAttack)/1e3)}),n.forEach(function(e){return e.release=new re.a.Time((1+t.ampRelease)/1e3)}),n.forEach(function(e){return e.sustain=Math.min(.99,t.ampSustain)}),n.forEach(function(e){return e.decay=new re.a.Time((1+t.ampDecay)/1e3)})}}]),n}(oe);function Ot(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var jt=function(e){Object(u.a)(n,e);var t=Ot(n);function n(e,r,a,i,s,u){var l,f=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return Object(o.a)(this,n),(l=t.call(this,e,r,a,i,s,u)).setupEffects(),l.instrument=void 0,f&&l.setInstrument(new gt(r,a,(new X.a).forTrack(Object(c.a)(l)))),l.preset=new dt.a,l.preset.track=Object(c.a)(l),l}return Object(s.a)(n,[{key:"auditionNext",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var r,i,o,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.length>1&&void 0!==s[1]&&s[1],!this.isFrozen&&!r){e.next=3;break}return e.abrupt("return");case 3:if(this.getInstrumentType()!==te.h||this.preset&&this.preset.contentHash){e.next=7;break}return e.next=6,Object(fe.a)(Object(f.a)(n.prototype),"auditionNext",this).call(this);case 6:case 7:return e.abrupt("return");case 11:if(this.instrument.loaded){e.next=13;break}return e.abrupt("return");case 13:if(this.instrument.loaded=!1,this.trackIsLoading=!0,i=0,!this.preset||!this.preset.contentHash){e.next=21;break}if(i=(void 0).map(function(e){return e.contentHash}).indexOf(this.preset.contentHash),!(++i>=(void 0).length)){e.next=21;break}return e.abrupt("return");case 21:return o=(void 0)[i],e.next=24,this.sequencerEngine.auditionPreset(o,this.trackNumber,!0,!0);case 24:this.trackIsLoading=!1;case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"auditionPrevious",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r){var i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFrozen&&!r){e.next=2;break}return e.abrupt("return");case 2:if(this.getInstrumentType()!==te.h||this.preset&&this.preset.contentHash){e.next=6;break}return e.next=5,Object(fe.a)(Object(f.a)(n.prototype),"auditionPrevious",this).call(this);case 5:case 6:return e.abrupt("return");case 10:if(this.instrument.loaded){e.next=12;break}return e.abrupt("return");case 12:if(this.trackIsLoading=!0,i=0,!this.preset||!this.preset.contentHash){e.next=19;break}if(i=(void 0).map(function(e){return e.contentHash}).indexOf(this.preset.contentHash),!(--i<0)){e.next=19;break}return e.abrupt("return");case 19:return o=(void 0)[i],this.mute(!0),e.next=23,this.sequencerEngine.auditionPreset(o,this.trackNumber,!0,!0);case 23:this.mute(!1),this.trackIsLoading=!1;case 25:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"setIsEnabled",value:function(e){Object(fe.a)(Object(f.a)(n.prototype),"setIsEnabled",this).call(this,e),e||this.isFrozen||this.sequencerEngine.playing||this.getInstrument().releaseAll()}},{key:"makePublicIfNeeded",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.isFrozen;this.midiEffects.dispose(),!t&&this.instrument&&(this.instrument.dispose(),this.instrument=void 0),Object(fe.a)(Object(f.a)(n.prototype),"dispose",this).call(this,!t)}},{key:"getAllParameters",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Object(fe.a)(Object(f.a)(n.prototype),"getAllParameters",this).call(this,e);if(this.isFrozen||void 0===this.instrument)return t;var r=this.getInstrument().getParameters();return[].concat(Object(h.a)(t),Object(h.a)(r))}},{key:"getAllPatternLockedParameters",value:function(e,t){var r=Object(fe.a)(Object(f.a)(n.prototype),"getAllPatternLockedParameters",this).call(this,e,t);if(this.isFrozen)return r;var a=this.getInstrument().getParameters();return a=a.filter(function(n){return n.hasPatternLockedValues(e,t)}),r.concat(a)}},{key:"getCopy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e(this.trackNumber,t,this.mixSession,this.patterns.length,this.update,t.currentSubSequence);if(!this.isFrozen){var i=this.instrument.getCopy((new X.a).forTrack(a),a,t,r);a.setInstrument(i)}return Object(fe.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,function(){return a},t,r),a}},{key:"getName",value:function(){return void 0===this.instrument?"Instrument":this.instrument.getName()}},{key:"getTrackType",value:function(){return W.b}},{key:"getInstrument",value:function(){return this.instrument}},{key:"setInstrument",value:function(e){void 0!==this.instrument&&this.instrument.disconnect(this.gainNode),this.instrument=e,void 0!==this.instrument&&this.instrument.connect(this.gainNode)}},{key:"liveTrigger",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.isFrozen||(this.storeStepData(e,n),this.trigger(e,n,!0))}},{key:"liveTriggerRelease",value:function(e){this.isFrozen||(this.triggerRelease(e),this.currentStepDatas&&(this.currentStepDatas=this.currentStepDatas.filter(function(t){return t.transpose!==e})))}},{key:"trigger",value:function(e,t,r){this.isFrozen?Object(fe.a)(Object(f.a)(n.prototype),"trigger",this).call(this,e,t,r):void 0!==this.instrument&&(this.storeStepData(e,t),this.instrument.trigger(e,t))}},{key:"triggerRelease",value:function(e){this.isFrozen||void 0!==this.instrument&&this.instrument.release(e)}},{key:"getJson",value:function(e,t){var r=this.instrumentRack?this.instrumentRack.isFrozen:this.isFrozen;return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e),{instrumentType:this.instrument?this.instrument.getInstrumentType():this.getInstrumentType(),instrument:r?void 0:this.instrument.getJson(t),presetName:this.presetName,preset:this.preset.getJson()})}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var r,i,o,s,c,u,l,h=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(h.length>1&&void 0!==h[1])||h[1],i=!(h.length>2&&void 0!==h[2])||h[2],o=h.length>3&&void 0!==h[3]&&h[3],s=h.length>4?h[4]:void 0,h.length>5?h[5]:void 0,c=h.length>6?h[6]:void 0,Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,t,s),this.parametersToScale=void 0,r&&this.store.dispatch(Object(J.we)(this.subSequence.id,this.trackNumber,!0)),t.envelopes)for(u in t.envelopes)this.connectToEnvelope(this.sequencerEngine.envelopes[t.envelopes[u]]);if(l={},!t.isFrozen){e.next=15;break}e.next=19;break;case 15:return this.instrument||this.createNewInstrument(),e.next=18,this.instrument.fromJson(t.instrument,o,s,c);case 18:l=e.sent;case 19:if(void 0!==t.presetName&&(this.presetName=t.presetName),!t.preset){e.next=26;break}if(!i){e.next=26;break}return this.preset.fromJson(t.preset),e.next=25,this.preset.load();case 25:this.preset.name&&(this.presetName=this.preset.name);case 26:return r&&this.store.dispatch(Object(J.we)(this.subSequence.id,this.trackNumber,!1)),e.abrupt("return",l);case 28:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unfreezeInstrument",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:this.frozenJson,this.createNewInstrument(),e.next=4,this.instrument.fromJson(t.trackParameters.instrument);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"createNewInstrument",value:function(){}},{key:"isMonohonic",value:function(){return this.tracks.every(function(e){return e.track.isMonophonic()})}}]),n}(ht);function kt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wt=function(e){Object(u.a)(n,e);var t=kt(n);function n(e,r,a,i,s,u){var l;return Object(o.a)(this,n),(l=t.call(this,e,r,a,i,s,u,!1)).setInstrument(new Ae(r,a,(new X.a).forTrack(Object(c.a)(l)))),l}return n}(jt);function xt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var St=function(e){Object(u.a)(n,e);var t=xt(n);function n(e,r,a){var i;!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Object(o.a)(this,n),(i=t.call(this)).sequencerEngine=e,i.store=e.store,i.mixSession=r,i.context=a.getCopy().forInstrument(Object(c.a)(i)),i.parameters=[],i}return Object(s.a)(n,[{key:"getName",value:function(){return"Synth"}},{key:"name",get:function(){return this.getName()}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return te.f}},{key:"createLFO",value:function(){return new yt.a(this.sequencerEngine,this.mixSession,this.context)}},{key:"getCopy",value:function(e){var t=new n(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine,this.mixSession,e);return t.fromJsonSync(this.getJson()),t}},{key:"mateJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;for(var n in e.oscillators){this.getOscillator(n).mateJson(e.oscillators[n])}this.ampEnvelope.mateJson(e.ampEnvelope,t),this.filterEnvelope.mateJson(e.filterEnvelope,t),this.pitchEnvelope.mateJson(e.pitchEnvelope,t),this.mateParameter("filterCutoff",e,this.filterCutoffParameter,t),this.mateParameter("filterQ",e,this.filterQParameter,t),this.mateParameter("noiseVolume",e,this.noiseVolumeParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){Object(se.b)(this.sequencerEngine,e,t,n,r)}},{key:"dispose",value:function(){this.detuneSignal.dispose(),this.detuneParameter.dispose();var e=Object(h.a)(this.oscillatorNodes);e.reverse(),e.forEach(function(e){return e.dispose()}),this.filter.dispose(),this.hpFilter.dispose(),this.pitchEnvelope.dispose(),this.filterEnvelope.dispose(),this.hpFilterEnvelope.dispose(),this.ampEnvelope.dispose(),this.oscillatorNodes=void 0,this.filter=void 0,this.hpFilter=void 0,this.pitchEnvelope=void 0,this.filterEnvelope=void 0,this.ampEnvelope=void 0,this.parameters.forEach(function(e){return e.dispose()}),this.parameters=void 0,this._disposed=!0}},{key:"disposed",get:function(){return this._disposed}}]),n}(oe);function Pt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Et=n(586);function Tt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function At(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Mt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mt(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Mt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Rt=new(function(){function e(){Object(o.a)(this,e),this.voices=[],this.voicesCreated=0,window.voiceFactory=this}return Object(s.a)(e,[{key:"clearAnyDisposed",value:function(){var e,t=[],n=At(this.voices);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.detune._context||t.push(r)}}catch(a){n.e(a)}finally{n.f()}this.voices=this.voices.filter(function(e){return!t.includes(e)})}},{key:"newVoice",value:function(e,t,n){if(this.clearAnyDisposed(),!window.sequencerEngine.isLoading&&!re.a.Master.context.isOffline&&this.voices.length>0){var r=this.voices.find(function(e){return e.name===t});if(r){var a=this.voices.indexOf(r);return this.voices.splice(a,1),e&&(e.includes("fat")&&(r.oscillator.type="sine"),r.oscillator.type=e),r}}if(e){var i=new re.a.MonoSynth({oscillator:{type:e}});return this.voicesCreated++,e.includes("fat")&&(i.type="sine",i.type=e),i.id=0,i}var o=new re.a.MonoSynth;return o.id=0,o}},{key:"releaseVoice",value:function(e,t,n){e.disconnect(),n.isOffline||this.voices.push(e)}},{key:"destroyVoice",value:function(e){this.voices=this.voices.filter(function(t){return t!==e})}}]),e}());function Ct(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Nt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nt(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function It(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var qt=function(e){return function(e){Object(u.a)(n,e);var t=It(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"scaleByKey",value:function(e,t,n){if(!this.track.parametersToScale){var r=this.track?this.track.getAllParameters():this.getParameters();this.track.parametersToScale=r.filter(function(e){return e.keyScaling})}var a,i=(t- -32)/92,o=re.a.Master.context.isOffline,s=Ct(this.track.parametersToScale);try{for(s.s();!(a=s.n()).done;){var c=a.value,u=c.keyScaling;if(u&&c.get(!0)!==c.min){var l=c.get(!0)+u.min+(u.max-u.min)*i;if(c._audioParams){var f=c._audioParams.length;o?c._audioParams[n%f].value=l:c._audioParams[n%f].linearRampToValueAtTime(l,e+.01)}else c.audioParam&&c.audioParam.linearRampToValueAtTime?o?c.audioParam.value=l:c.audioParam.linearRampToValueAtTime(l,e+.01):c.audioParams&&c.audioParams[n]?o?c.audioParams[n].value=l:c.audioParams[n].linearRampToValueAtTime(l,e+.01):c.setter(c.object,l)}}}catch(h){s.e(h)}finally{s.f()}}}]),n}(e)};function _t(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Dt(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ft(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ft(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ft(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Lt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Bt="C",zt="A",Jt="B1",Vt="B2",Ht="X",Ut="Y";function Gt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Wt=function(e){Object(u.a)(n,e);var t=Gt(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),s=t.call(this,e,r,a,void 0,void 0,void 0,new re.a.AmplitudeEnvelope(10,10,1,100)),i&&i.connect(s.envelope),s.envelope.releaseCurve="linear",s.envelope.attackCurve="linear",s.envelope.decayCurve="linear",s}return Object(s.a)(n,[{key:"dispose",value:function(){Object(fe.a)(Object(f.a)(n.prototype),"dispose",this).call(this)}},{key:"connect",value:function(e){this.envelope.connect(e)}}]),n}(Ee),Kt=function(){function e(t,n,r,a,i){Object(o.a)(this,e),this.sequencerEngine=t,this.id=Object(q.uuid)(),this.instrument=i,this.store=this.sequencerEngine.store,this.mixSession=n,this.context=r.getCopy().forSubDevice(this),this.ampEnvelopes=a,this.parameters=[],this.setupParameters()}return Object(s.a)(e,[{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"refresh",value:function(){this.attack=this.attack,this.decay=this.decay,this.sustain=this.sustain,this.release=this.release}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e,!0,!0)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e,!0,!0)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e,!0,!0)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e,!0,!0)}},{key:"setupParameters",value:function(){var e=this;this.attackParameter=new he.a("Attack",this.envelope,function(t,n){return e.ampEnvelopes.forEach(function(e){return e.attack=n})},{min:0,max:1e4,unit:"ms",defaultValue:80,onChange:function(t){e.instrument.controller&&e.instrument.controller.sendADSRLevels()}}),this.registerParameter(this.attackParameter),this.decayParameter=new he.a("Decay",this.envelope,function(t,n){return e.ampEnvelopes.forEach(function(e){return e.decay=n})},{min:0,max:3e3,unit:"ms",defaultValue:500,onChange:function(t){e.instrument.controller&&e.instrument.controller.sendADSRLevels()}}),this.registerParameter(this.decayParameter),this.sustainParameter=new he.a("Sustain",this.envelope,function(t,n){return e.ampEnvelopes.forEach(function(e){return e.sustain=n})},{min:0,max:1,unit:"",defaultValue:.8,onChange:function(t){e.instrument.controller&&e.instrument.controller.sendADSRLevels()}}),this.registerParameter(this.sustainParameter),this.releaseParameter=new he.a("Release",this.envelope,function(t,n){return e.ampEnvelopes.forEach(function(e){return e.release=n})},{min:0,max:3e3,unit:"ms",defaultValue:100,onChange:function(t){e.instrument.controller&&e.instrument.controller.sendADSRLevels()}}),this.registerParameter(this.releaseParameter)}},{key:"getJson",value:function(){var e={attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,x:this.x,y:this.y,width:this.width,height:this.height};return e=Object(ue.b)(e,"attackParameter",this.attackParameter),e=Object(ue.b)(e,"decayParameter",this.decayParameter),e=Object(ue.b)(e,"sustainParameter",this.sustainParameter),e=Object(ue.b)(e,"releaseParameter",this.releaseParameter)}},{key:"fromJson",value:function(e,t,n){var r={};return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,Object(Oe.a)(this.attackParameter,e.attack,r,n,!0),Object(Oe.a)(this.decayParameter,e.decay,r,n,!0),Object(Oe.a)(this.sustainParameter,e.sustain,r,n,!0),Object(Oe.a)(this.releaseParameter,e.release,r,n,!0),r=Object(d.a)({},r,Object(ue.a)(e,"attackParameter",this.attackParameter,this.sequencerEngine,!1,!0,n),Object(ue.a)(e,"decayParameter",this.decayParameter,this.sequencerEngine,!1,!0,n),Object(ue.a)(e,"sustainParameter",this.sustainParameter,this.sequencerEngine,!1,!0,n),Object(ue.a)(e,"releaseParameter",this.releaseParameter,this.sequencerEngine,!1,!0,n))}},{key:"dispose",value:function(){}}]),e}(),Qt=n(328),Zt=n(375),Yt=new(function(){function e(){Object(o.a)(this,e),this.voices=[],this.voicesCreated=0,window.edgeFactory=this}return Object(s.a)(e,[{key:"newVoice",value:function(e,t,n,r){if(!re.a.Master.context.isOffline&&this.voices.length>0){var a=this.voices.find(function(t){return t.operator===e});if(a){var i=this.voices.indexOf(a);return this.voices.splice(i,1),a.operator=e,a.loadSynth(e),a}}var o=new $t(e,t,n,r);return this.voicesCreated++,o}},{key:"releaseVoice",value:function(e,t){e.modulatorNodes.forEach(function(e){return e.disconnect()}),e.sequencerEngine.isOffline||this.voices.push(e)}}]),e}());window.edgeCount=0,window.disposedEdgeCount=0;var $t=function(){function e(t,n){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;Object(o.a)(this,e),this.name=i,window.edgeCount++,this.edgeCount=window.edgeCount,this.sequencerEngine=n,this.store=n.store,this.operator=t,this.outputNumber=a,this.effect=t,this.modulatorNodes=[];for(var s=0;s<12;s++)this.modulatorNodes.push(new re.a.Gain(0));this.loadSynth(t),this.parameters=[],this.gainParameter=new le.a("Gain",this,function(e,t){return r.modulatorNodes.forEach(function(e){return e.gain.value=t})},{min:0,max:6,defaultValue:0}),this.registerParameter(this.gainParameter),this.gainParameter.setAudioParams(this.modulatorNodes.map(function(e){return e.gain}))}return Object(s.a)(e,[{key:"loadSynth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.operator;if(t.synth)for(var n in this.operator.voices){var r=t.voices[n];e&&this.modulatorNodes[n].disconnect(),this.modulatorNodes[n].connect(r.oscillator.frequency)}else;}},{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"getWeight",value:function(){return 1}},{key:"getJson",value:function(){return{}}},{key:"fromJson",value:function(){}},{key:"getCopy",value:function(){var t=new e(this.operator,this.sequencerEngine,this.outputNumber);return t.gainParameter.set(t.gainParameter.get()),t}},{key:"dispose",value:function(){this.sequencerEngine.isOffline?(window.disposedEdgeCount++,this.gainParameter.dispose(),this.modulatorNodes.forEach(function(e){return e.dispose()}),this.gainParameter=void 0,this.modulatorNodes=void 0,this._wasDisposed=!0):Yt.releaseVoice(this)}}]),e}(),Xt=n(327);function en(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function tn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return nn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function an(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return on(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return on(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function on(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function sn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var cn=function(){function e(t,n,r,a){Object(o.a)(this,e),this.oscillator=t,this.sequencerEngine=n,this.mixSession=r,this.context=a,this.ampEnvelopes=[new Wt(n,r,a)],this.connected=!1}return Object(s.a)(e,[{key:"dispose",value:function(){this.ampEnvelopes.forEach(function(e){return e.dispose()}),this.ampEnvelopes=void 0}},{key:"newVoice",value:function(){this.ampEnvelopes.push(new Wt(this.sequencerEngine,this.mixSession,this.context))}},{key:"removeVoice",value:function(){this.ampEnvelopes[this.ampEnvelopes.length-1].dispose(),this.ampEnvelopes.splice(this.ampEnvelopes.length-1,1)}}]),e}(),un=function(){function e(t,n,r,a,i,s,c){Object(o.a)(this,e),this.sequencerEngine=i,this.mixSession=s,this.context=c,this.id=n,this.name=t,this.synth=r,this.crossFadeIndex=a,this.outputs={},this.voices=[]}return Object(s.a)(e,[{key:"dispose",value:function(){for(var e in this.outputs)this.outputs[e].dispose();this.outputs={}}},{key:"newVoice",value:function(){for(var e in this.outputs)this.outputs[e].newVoice()}},{key:"removeVoice",value:function(){for(var e in this.outputs)this.outputs[e].removeVoice()}},{key:"stealOrMake",value:function(e){if(this.outputs[e.name])return this.outputs[e.name];for(var t in this.outputs)if(!this.outputs[t].connected){var n=this.outputs[t];return delete this.outputs[t],n}return new cn(e,this.sequencerEngine,this.mixSession,this.context)}},{key:"noiseSources",get:function(){return this.synth.noiseSources}},{key:"connect",value:function(e){var t=this,n=this.stealOrMake(e);for(var r in this.outputs[e.name]=n,console.log("CONNECTING OSC TO OUTPUTNODE"),e.voices){var a=e.voices[r];n.ampEnvelopes[r]||n.newVoice();var i=n.ampEnvelopes[r].envelope;a.connect(i)}if("C"===e.name)for(var o in this.noiseSources){var s=e.voices[o];this.noiseSources[o].connect(s._volume)}return n.connected=!0,n.ampEnvelopes.forEach(function(t){return t.envelope.connect(e.formantsManager.input)}),e.formantsManager.output.connect(this.synth.outputCrossFade,0,this.crossFadeIndex),function(){if(n.connected=!1,n.ampEnvelopes.forEach(function(t){return t.envelope.disconnect(e.formantsManager.input)}),e.voices.forEach(function(e,t){e.disconnect(n.ampEnvelopes[t].envelope)}),"C"===e.name)for(var r in t.noiseSources){var a=e.voices[r];t.noiseSources[r].disconnect(a._volume)}e.formantsManager.output.disconnect(t.synth.outputCrossFade,0,t.crossFadeIndex),n.disconnect=void 0}}}]),e}();function ln(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return fn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function fn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function hn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function dn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var pn=n(241);function vn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var mn=new re.a.Frequency("C3"),yn=n(979);function bn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return gn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function gn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function On(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function jn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var kn={0:"sine",.2:"triangle",.4:"square",.6:"sawtooth",.8:"pulse",1:"fatsine",1.2:"fattriangle",1.4:"fatsquare",1.8:"fatsawtooth"};window.lpf=1e3,window.len=Math.pow(2,10),window.start=88200;function wn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function xn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Sn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Pn=function(e,t,n){return!t||n?e:e+1};function En(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Tn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return An(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return An(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function An(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Mn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}window.envelopeTest=!1,window.p1=.05,window.p2=.008,window.fuck=2;var Rn=function(e){Object(u.a)(n,e);var t=Mn(n);function n(e,r,a,i){var s,c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],u=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,f=arguments.length>7?arguments[7]:void 0;return Object(o.a)(this,n),(s=t.call(this,e,r,a,function(e){return 0},i,c,l)).name=u,s.track=l,s.instrument=f,s.create(),s.setupEnvelopes(),s.setupFormants(),s.preset=new dt.a,s}return Object(s.a)(n,[{key:"initializeNewVoice",value:function(e){return e?new re.a.MonoSynth({oscillator:{type:e}}):new re.a.MonoSynth}},{key:"documentation",get:function(){var e=this.name;return"You can connect LFOs to Operator ".concat(e," by dragging a line from an LFO to the circles above the node")}},{key:"getEffectType",value:function(){return je.d}},{key:"disposeSynth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.synth;e._voices[0].context.isOffline;this.destroyFormants(e,!0),e.formantsManager.dispose();var t,n=Tn(e._voices);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.disconnectFM(),r.disconnect(),Rt.destroyVoice(r)}}catch(a){n.e(a)}finally{n.f()}e._voices.forEach(function(e){return e.dispose()}),e._voices=void 0}}]),n}(Object(ot.a)(function(e){return function(e){Object(u.a)(n,e);var t=En(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a)))._voices=[],e}return Object(s.a)(n,[{key:"releaseVoice",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Rt.releaseVoice(e,t,this.sequencerEngine)}},{key:"onPolyphonyChanged",value:function(e){var t=this;if(e>this._voices.length){for(var n=this._voices.length;n<e;n++){var r=this.newVoice();r.harmonicity||this.fm(this.carrier,!0,r,n),this._voices.push(r)}this.customOscillatorType&&this.customOscillatorTypeParameter.updateRedux(),this.setAudioParamsForParameters()}else e<this._voices.length&&(this._voices.slice(e).forEach(function(e){return t.releaseVoice(e)}),this._voices=this._voices.slice(0,e));this.oscillatorTypeParameter&&"pulse"===this.oscillatorTypeParameter.get()&&this.pulseWidthParameter.setAudioParams(this.voices.map(function(e){return e.oscillator.width}))}},{key:"initVoices",value:function(){this._voices=[this.newVoice()]}},{key:"voices",get:function(){return this._voices?this.polyphonyParameter?this._voices.slice(0,this.polyphonyParameter.get()):this._voices:[]}},{key:"synth",get:function(){return this}},{key:"newVoice",value:function(){var e=this;if(this.oscillatorTypeParameter&&this.oscillatorType){var t=Rt.newVoice(this.oscillatorType,this.name);return this.oscillatorType.includes("fat")&&(this._voices.forEach(function(e){return e.oscillator.type="sine"}),this._voices.forEach(function(t){t.oscillator.type=e.oscillatorType,t.oscillator.count=e.countParameter.get(),t.oscillator.spread=e.spreadParameter.get()})),t}return Rt.newVoice(void 0,this.name)}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=On(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).parameters=[],e}return Object(s.a)(n,[{key:"isEnabled",value:function(){return this.enabled}},{key:"setupParameters",value:function(){var e=this;this.enabledParameter=new he.a("Enabled",this,function(e,t){},{documentation:["Turns the operator on/off.","If you`re running low on CPU, try turning off some operators."],min:!1,max:!0,unit:"",defaultValue:!0,automatable:!1}),this.registerParameter(this.enabledParameter),this.name,this.voices.map(function(e){return e.volume.value=0}),this.oscillatorLevelParameter=new ge.a("Oscillator Level",this.voices.map(function(e){return e.volume}),{documentation:"Controls the volume for this operator",min:0,max:1,defaultValue:.3,onChange:function(t){e.instrument.controller&&e.instrument.controller.sendOscillatorLevels()}}),this.registerParameter(this.oscillatorLevelParameter),this.pwmParameter=new he.a("PWM",this,function(t,n){return e.voices.forEach(function(e){return 0})},{min:0,max:20,unit:"",defaultValue:0,automatable:!1}),this.registerParameter(this.pwmParameter),this.countParameter=new he.a("count",this,function(t,n){return e.voices.forEach(function(e){return e.oscillator.count=n})},{min:0,max:20,unit:"",defaultValue:3,automatable:!1}),this.registerParameter(this.countParameter),this.spreadParameter=new he.a("spread",this,function(t,n){return e.voices.forEach(function(e){return e.oscillator.spread=n})},{min:1,max:200,unit:"",defaultValue:20,automatable:!1}),this.registerParameter(this.spreadParameter),this.oscillatorFrequencyParameter=new he.a("Oscillator Frequency",this,function(e,t){return[]},{documentation:"Controls the root note for the synth.",min:0,max:1,unit:"",defaultValue:0,automatable:!1}),this.registerParameter(this.oscillatorFrequencyParameter),this.detuneParameter=new ge.a("Detune",this.voices.map(function(e){return e.detune}),{documentation:"Controls the detuning for this operator",min:-100,max:100,unit:"",defaultValue:0}),this.registerParameter(this.detuneParameter),this.portamentoParameter=new he.a("Portamento",this,function(t,n){return e.voices.forEach(function(e){return e.portamento=n/20})},{documentation:"Controls the gliding between notes for this operator",min:0,max:5,unit:"",defaultValue:0}),this.registerParameter(this.portamentoParameter),this.polyphonyParameter=new he.b("Polyphony",this,function(t,n){e.onPolyphonyChanged(n)},{min:0,max:16,unit:"",defaultValue:1,automatable:!1}),this.registerParameter(this.polyphonyParameter)}},{key:"enabled",get:function(){return this.enabledParameter.get(!0)},set:function(e){this.enabledParameter.set(e)}},{key:"oscillatorLevel",get:function(){return this.oscillatorLevelParameter.get(!0)},set:function(e){return this.oscillatorLevelParameter.set(e)}},{key:"oscillatorFrequency",get:function(){return this.oscillatorFrequencyParameter.get(!0)},set:function(e){this.oscillatorFrequencyParameter.set(e)}},{key:"detune",get:function(){return this.detuneParameter.get(!0)},set:function(e){this.detuneParameter.set(e)}},{key:"pulseWidth",get:function(){return this.pulseWidthParameter.get(!0)},set:function(e){this.pulseWidthParameter.set(e)}},{key:"portamento",get:function(){return this.portamentoParameter.get(!0)},set:function(e){this.portamentoParameter.set(e)}},{key:"harmonics",get:function(){return this.harmonicsParameter.get(!0)},set:function(e){this.harmonicsParameter.set(e)}},{key:"polyphony",get:function(){return void 0===this.polyphonyParameter?8:this.polyphonyParameter.get(!0)},set:function(e){this.polyphonyParameter.set(e,!0,!0)}},{key:"registerParameter",value:function(e,t){var n=e.setStore(this.store);this.bulk=Object(d.a)({},this.bulk,n),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"registerContext",value:function(e){}},{key:"getParameters",value:function(){var e,t=this.parameters,n=bn(this.formants);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=[].concat(Object(h.a)(t),Object(h.a)(r.getParameters()))}}catch(a){n.e(a)}finally{n.f()}return[].concat(Object(h.a)(t),Object(h.a)(this.ampEnvelope.parameters))}},{key:"refreshParameters",value:function(){this.customOscillatorType||(this.oscillatorTypeParameter.set(this.oscillatorType,!0,!0),null!==this.partials&&this.partialsParameter.set(this.partials,!0,!0)),this.customOscillatorTypeParameter.set(this.customOscillatorType,!0,!0),this.portamentoParameter.set(this.portamento,!0,!0),this.harmonicsParameter.set(this.harmonics,!0,!0),this.pulseWidthParameter.set(this.pulseWidth,!0,!0)}},{key:"oscillatorOctave",get:function(){return this.oscillatorOctaveParameter.get()}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=vn(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"triggerAttack",value:function(e,t,n,r){if(this.enabled){var a=this.getNoteFromTranspose(e);this.lastNote=e,r.triggerAttack(a,t,n)}}},{key:"triggerAttackRelease",value:function(e,t,n,r,a){if(this.enabled){var i=this.getNoteFromTranspose(e);a.triggerAttackRelease(i,t,n,r)}}},{key:"triggerRelease",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:re.a.Master.context.currentTime,a=arguments.length>3?arguments[3]:void 0;if(this.enabled&&(e&&void 0===e.map&&(e=[e]),!e||1!=this.polyphony||e[0]===this.lastNote)){var i=e&&e.map(function(e){return n.getNoteFromTranspose(e)});void 0!==t?(this.pitchEnvelope.triggerRelease(t.slotNumber),t.triggerRelease(r,a)):i&&this.triggerRelease(i,r)}}},{key:"getNoteFromTranspose",value:function(e){return this.getDefaultNote().transpose(e+this.oscillatorFrequency)}},{key:"getDefaultNote",value:function(){return mn}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=xn(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"fm",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.carrier,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.voices[0],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;console.log("OSC FM CALLED"),r.envelope.releaseCurve="end",r.name=this.name,r.isCarrier=!t;var i=void 0===t;i&&(r._frequencyNode||(r.frequency=new re.a.Signal(440,re.a.Type.Frequency),r._frequencyNode=r.frequency)),r.operatorFrequency||(r.operatorFrequency=r.oscillator.frequency),r.harmonicity?(r.volume.value=0,r.octaves.output.gain.value=0,r.harmonicity.output.gain.value=0,r.modulationIndex.output.gain.value=0,r.detune.value=0):(r.harmonicity=new re.a.Multiply(0),r.harmonicity.units=re.a.Type.Positive,r.octaves=new re.a.Multiply(0),r.octaves.units=re.a.Type.Positive,r.modulationIndex=new re.a.Multiply(0),r.modulationIndex.units=re.a.Type.Positive),i?(r.frequency.connect(r.octaves),r.octaves.connect(r.harmonicity)):(t.voices[a].frequency.connect(r.octaves),r.octaves.connect(r.harmonicity),t.voices[a].frequency.connect(r.modulationIndex)),r.harmonicity.connect(r.oscillator.frequency),this.feedback,r.disconnectFM=function(n){e.harmonicityParameter.removeAudioParam(r.harmonicity.output.gain),e.oscillatorOctaveParameter.removeAudioParam(r.octaves.output.gain),e.oscillatorLevelParameter.removeAudioParam(r.volume),e.modulationIndexParameter.removeAudioParam(r.modulationIndex.output.gain),e.detuneParameter.removeAudioParam(r.detune),t?(t._voices[a].frequency.disconnect(r.octaves),r.octaves.disconnect(r.harmonicity),t._voices[a].frequency.disconnect(r.modulationIndex)):(r.frequency.disconnect(r.octaves),r.octaves.disconnect(r.harmonicity))},n||(this.harmonicityParameter=new ge.a("Harmonicity",this.voices.map(function(e){return e.harmonicity.output.gain}),{min:0,documentation:["Ratio between this operator`'s frequency, and the frequency of the inputed note.","Ex: A ratio of 2 is an octave above the inputed note"],max:20,unit:"",times:2,defaultValue:3},0),this.registerParameter(this.harmonicityParameter),this.oscillatorOctaveParameter=new ge.a("octave",this.voices.map(function(e){return e.octaves.output.gain}),{min:0,documentation:["Controls octave"],convertToRoot:2,max:8,unit:"",defaultValue:1,times:2},0),this.registerParameter(this.oscillatorOctaveParameter),this.modulationIndexParameter=new ge.a("modulationIndex",this.voices.map(function(e){return e.modulationIndex.output.gain}),{documentation:"The level of modulation the operator will reach  at the maximum of it's envelope",min:0,max:120,unit:"",defaultValue:1}),this.registerParameter(this.modulationIndexParameter)),n&&(this.harmonicityParameter.set(this.harmonicityParameter.get(!0),!0,!0),this.oscillatorOctaveParameter.set(this.oscillatorOctaveParameter.get(!0),!0,!0),this.modulationIndexParameter.set(this.modulationIndexParameter.get(!0),!0,!0))}},{key:"setAudioParamsForParameters",value:function(){this.oscillatorLevelParameter.setAudioParams(this.voices.map(function(e){return e.volume})),this.detuneParameter.setAudioParams(this.voices.map(function(e){return e.detune})),this.harmonicityParameter.setAudioParams(this.voices.map(function(e){return e.harmonicity.output.gain})),this.oscillatorOctaveParameter.setAudioParams(this.voices.map(function(e){return e.octaves.output.gain})),this.modulationIndexParameter.setAudioParams(this.voices.map(function(e){return e.modulationIndex.output.gain}))}},{key:"connectFeedbackEdge",value:function(e,t,n){}},{key:"connectEdge",value:function(e){var t=this;if(this.voices.length,e.modulatorNodes.length,-2===e.operator.id||-3===e.operator.id){var n=-2===e.operator.id?this.instrument.outputNodeX:this.instrument.outputNodeY;return e.disconnect=n.connect(this),e}var r=[],a=function(n){var a=t.voices[n];a.connect(e.modulatorNodes[n].gain),e.operator.voices[n],a.modulationIndex.connect(e.modulatorNodes[n]),r.push(function(){a.disconnect(e.modulatorNodes[n].gain),a.modulationIndex.disconnect(e.modulatorNodes[n])})};for(var i in this.voices)a(i);return e.disconnect=function(){return r.forEach(function(e){return e()})},e}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=wn(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"setupEnvelopes",value:function(){this.ampEnvelope=new Ee(this.sequencerEngine,this.mixSession,this.context),this.ampEnvelope.releaseParameter.automatable=!1,this.connectSynthToPitchEnvelope()}},{key:"setEnvelopes",value:function(e,t,n,r){var a=e&&null!==e.releaseParameter.get()?e.release:t.releaseParameter.getKeyScaledValue(n,!1);if("C"!==this.name){var i=a+window.fuck;this.ampEnvelope.releaseParameter.set(i,!0,!0)}this._setEnvelopes(e,this.ampEnvelope,n,r),e&&null!==e.releaseParameter.get()&&t.releaseParameter.set(e.release,!0,!0)}},{key:"_setEnvelopes",value:function(e,t,n,r){var a=e&&null!==e.releaseParameter.get()?e.release:t.releaseParameter.getKeyScaledValue(n);r.envelope.attack=new re.a.Time((1+t.attackParameter.getKeyScaledValue(n))/1e3),r.envelope.decay=new re.a.Time((1+t.decayParameter.getKeyScaledValue(n))/1e3),r.envelope.sustain=Math.min(t.sustainParameter.getKeyScaledValue(n),.99),r.envelope.release=new re.a.Time((1+a)/1e3)}},{key:"connectSynthToPitchEnvelope",value:function(){var e=this;this.getDetuneVoices().forEach(function(t){return e.pitchEnvelope.connect(t)})}},{key:"disconnectSynthFromPitchEnvelope",value:function(){var e=this;this.getDetuneVoices().forEach(function(t){return e.pitchEnvelope.disconnect(t)})}},{key:"getDetuneVoices",value:function(){return this.voices.map(function(e){return e.detune})}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=jn(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"setupWaveformParameters",value:function(){var e=this;this._lastCustomType=void 0,this.customOscillatorTypeParameter=new he.a("Custom Oscillator Type",this,function(t,n){n&&e._lastCustomType!==n&&(e.oscillatorTypeParameter&&(e.oscillatorType=null),t._voices.forEach(function(e){return e.oscillator.type="sine"}),re.a.Master.context.isOffline?n&&e.setPeriodicWave(me(n)):n&&ve(n).then(function(t){return e.setPeriodicWave(t)}))},{min:0,max:2,unit:"",defaultValue:null,uxAutomatable:!1}),this.registerParameter(this.customOscillatorTypeParameter),this.oscillatorTypeParameter=new pn.a("Oscillator Type",this,function(t,n){if(void 0!==n){var r=t.oscillatorTypeParameter?t.oscillatorTypeParameter.getOptionFromNumber(n):kn[n];e.customOscillatorType=null,(r=r||n)&&r.includes("fat")&&t._voices.forEach(function(e){return e.oscillator.type="sine"}),r!==t.voices[t.voices.length-1].oscillator.type&&(t.voices.forEach(function(e){return e.oscillator.type=r}),"pulse"===r?e.pulseWidthParameter.setAudioParams(t.voices.map(function(e){return e.oscillator.width})):e.pulseWidthParameter&&e.pulseWidthParameter._audioParams&&Object(h.a)(e.pulseWidthParameter._audioParams).forEach(function(t){return e.pulseWidthParameter.removeAudioParam(t)}))}},{min:0,max:1,unit:"",defaultValue:"sine",options:kn,uxAutomatable:!1}),this.registerParameter(this.oscillatorTypeParameter),this._lastHarmonics=void 0,this.harmonicsParameter=new he.a("Harmonics",this,function(t,n){n!==e._lastHarmonics&&(e._lastWaveformA=void 0,e._lastWaveformB=void 0,t.sequencerEngine.isOffline?t.updateHarmonicsSync(n):t.updateHarmonics(n))},{min:-1,max:1,unit:"",defaultValue:0,uxAutomatable:!1}),this.registerParameter(this.harmonicsParameter),this.partialCountParameter=new he.a("Partial Count",this,function(t,n){e.customOscillatorType||t.voices.forEach(function(e){return e.oscillator.partialCount=n})},{min:0,automatable:!1,max:24,unit:"",defaultValue:0,uxAutomatable:!1}),this.registerParameter(this.partialCountParameter),this.partialsParameter=new he.a("Partials",this,function(e,t){return t&&e.voices.forEach(function(e){return e.oscillator.partials=t})},{unit:"",defaultValue:null,automatable:!1,uxAutomatable:!1}),this.registerParameter(this.partialsParameter),this.pulseWidthParameter=new ge.a("Pulse Width",void 0,{unit:"",defaultValue:.1,min:0,max:1,automatable:!1,uxAutomatable:!1}),this.registerParameter(this.pulseWidthParameter),this._lastWaveformA=void 0,this.waveformAParameter=new he.a("Waveform A",this,function(t,n){n!==e._lastWaveformA&&(t.sequencerEngine.isOffline?t.updateHarmonicsSync():t.updateHarmonics())},{defaultValue:2,min:0,max:50}),this.registerParameter(this.waveformAParameter),this.waveformBParameter=new he.a("Waveform B",this,function(t,n){n!==e._lastWaveformB&&(t.sequencerEngine.isOffline?t.updateHarmonicsSync():t.updateHarmonics())},{defaultValue:0,min:0,max:50}),this.registerParameter(this.waveformBParameter)}},{key:"updateHarmonics",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:this.harmonicsParameter.get(),this.customOscillatorType&&this.periodicWave){e.next=3;break}return e.abrupt("return");case 3:return n={imag:Object(h.a)(this.periodicWave.imag),real:Object(h.a)(this.periodicWave.real)},e.next=6,ye(this.waveformAParameter.get());case 6:return r=e.sent,e.next=9,ye(this.waveformBParameter.get());case 9:i=e.sent,o=t>0?i:r,this._updateHarmonics(t,n,o);case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"updateHarmonicsSync",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.harmonicsParameter.get();if(this.customOscillatorType&&this.periodicWave){var t={imag:Object(h.a)(this.periodicWave.imag),real:Object(h.a)(this.periodicWave.real)},n=be(e>0?this.waveformBParameter.get():this.waveformAParameter.get());this._updateHarmonics(e,t,n)}}},{key:"_updateHarmonics",value:function(e,t,n){e=Math.abs(e);for(var r=0;r<t.real.length;r++){var a=t.real[r],i=n.real[r];t.real[r]=a+(i-a)*Math.pow(e,2);var o=t.imag[r],s=n.imag[r];t.imag[r]=o+(s-o)*Math.pow(e,2)}this.setPeriodicWave(t,!0)}},{key:"setPeriodicWave",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(new Date).getTime(),t||(this.periodicWave=e);var n=re.a.Master.context.createPeriodicWave(new Float32Array(e.real),new Float32Array(e.imag));this._voices&&(this._voices.forEach(function(e){e.oscillator._wave=n,e._wave=n,e.oscillator._oscillator._wave=n,e.oscillator._type="custom",e.oscillator._oscillator._type="custom",e.oscillator._oscillator._oscillator&&e.oscillator._oscillator._oscillator.setPeriodicWave(n)}),t||(this.harmonics=this.harmonics),(new Date).getTime())}},{key:"setOscillatorSample",value:function(e){}},{key:"hasCustomWaveform",value:function(){return null!==this.partialsParameter.get()}},{key:"oscillatorType",get:function(){return this.oscillatorTypeParameter.get(!0)},set:function(e){this.oscillatorTypeParameter.set(e,!0,!0),"custom"===e&&(this.partials=[1,1,1,1,1,1,0,1,0,1,0,1].concat(Array(32).fill(0)))}},{key:"customOscillatorType",get:function(){return this.customOscillatorTypeParameter.get(!0)},set:function(e){this.customOscillatorTypeParameter.set(e,!0,!0)}},{key:"partials",get:function(){return this.partialsParameter.get(!0)},set:function(e){"custom"!==this.oscillatorType&&(this.oscillatorType="custom"),this.partialsParameter.set(e,!0,!0)}}]),n}(e)},yn.a,function(e){return function(e){Object(u.a)(n,e);var t=Sn(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getJson",value:function(e){var t=Object(d.a)({preset:this.preset.contentHash,isHarmonicityFixed:!0,enabled:this.enabled,oscillatorType:this.oscillatorType,oscillatorFrequency:this.oscillatorFrequency,oscillatorLevel:this.oscillatorLevel,polyphony:this.polyphony,portamento:this.portamento,oscillatorOctave:this.oscillatorOctave,detune:this.detune,partials:this.partials,customOscillatorType:this.customOscillatorType,harmonics:this.harmonics,pulseWidth:this.pulseWidth,spread:this.spreadParameter.get(),count:this.countParameter.get(),waveformA:this.waveformAParameter.get(),waveformB:this.waveformBParameter.get()},this.getFMJson(e));return t=Object(ue.b)(t,"oscillatorOctaveParameter",this.oscillatorOctaveParameter,void 0,e),t=Object(ue.b)(t,"waveformAParameter",this.waveformAParameter,void 0,e),t=Object(ue.b)(t,"waveformBParameter",this.waveformBParameter,void 0,e),t=Object(ue.b)(t,"pulseWidthParameter",this.pulseWidthParameter,void 0,e),t=Object(ue.b)(t,"enabledParameter",this.enabledParameter,void 0,e),t=Object(ue.b)(t,"oscillatorLevelParameter",this.oscillatorLevelParameter,void 0,e),t=Object(ue.b)(t,"detuneParameter",this.detuneParameter,void 0,e),t=Object(ue.b)(t,"portamentoParameter",this.portamentoParameter,void 0,e),t=Object(ue.b)(t,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter,void 0,e),t=Object(ue.b)(t,"harmonicsParameter",this.harmonicsParameter,void 0,e),t=Object(ue.b)(t,"oscillatorTypeParameter",this.oscillatorTypeParameter,void 0,e),t=Object(ue.b)(t,"partialsParameter",this.partialsParameter,void 0,e),t=Object(ue.b)(t,"customOscillatorTypeParameter",this.customOscillatorTypeParameter,void 0,e)}},{key:"getFMJson",value:function(e){var t={harmonicity:this.harmonicityParameter.get(!0),modulationIndex:this.modulationIndexParameter.get(!0),ampEnvelope:this.ampEnvelope.getJson(),partialCount:this.partialCountParameter.get(!0),formants:this.getFormantsJson()};return t=Object(ue.b)(t,"harmonicityParameter",this.harmonicityParameter,void 0,e),t=Object(ue.b)(t,"modulationIndexParameter",this.modulationIndexParameter,void 0,e),t=Object(ue.b)(t,"partialCountParameter",this.partialCountParameter,void 0,e)}},{key:"fromJson",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;if(window.skipOsc)return{};if((new Date).getTime(),void 0===e)return{};e.preset&&(this.preset.contentHash=e.preset);var r=this.fromFMJson(e,t,n);(new Date).getTime(),Object(Oe.a)(this.enabledParameter,e.enabled,r,n),Object(Oe.a)(this.pulseWidthParameter,e.pulseWidth,r,n);var a=e.oscillatorType;return Object(Oe.a)(this.oscillatorFrequencyParameter,e.oscillatorFrequency,r,n),Object(Oe.a)(this.portamentoParameter,e.portamento,r,n),void 0!==e.oscillatorOctave?Object(Oe.a)(this.oscillatorOctaveParameter,e.oscillatorOctave,r,n):Object(Oe.a)(this.oscillatorOctaveParameter,1,r,n),e.customOscillatorType?Object(Oe.a)(this.customOscillatorTypeParameter,e.customOscillatorType,r,n):Object(Oe.a)(this.oscillatorTypeParameter,a,r,n),e.harmonics&&Object(Oe.a)(this.harmonicsParameter,e.harmonics,r,n),void 0!==e.partials&&null!==e.partials&&("custom"!==this.oscillatorType||this.customOscillatorType||Object(Oe.a)(this.partialsParameter,e.partials,r,n)),e.spread&&Object(Oe.a)(this.spreadParameter,e.spread,r,n),e.count&&Object(Oe.a)(this.countParameter,e.count,r,n),r=Object(d.a)({},r,Object(ue.a)(e,"oscillatorOctaveParameter",this.oscillatorOctaveParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"pulseWidthParameter",this.pulseWidthParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"enabledParameter",this.enabledParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"portamentoParameter",this.portamentoParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"detuneParameter",this.detuneParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"oscillatorTypeParameter",this.oscillatorTypeParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"partialsParameter",this.partialsParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"customOscillatorTypeParameter",this.customOscillatorTypeParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"harmonicsParameter",this.harmonicsParameter,this.sequencerEngine,t,!0,n)),this.customOscillatorType&&(e.waveformA?Object(Oe.a)(this.waveformAParameter,e.waveformA,r,n):Object(Oe.a)(this.waveformAParameter,2,r,n),e.waveformB?Object(Oe.a)(this.waveformBParameter,e.waveformB,r,n):Object(Oe.a)(this.waveformBParameter,0,r,n),r=Object(d.a)({},r,Object(ue.a)(e,"waveformAParameter",this.waveformAParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"waveformBParameter",this.waveformBParameter,this.sequencerEngine,t,!0,n))),Object(ke.a)(e.detune)&&Object(Oe.a)(this.detuneParameter,e.detune,r,n),Object(Oe.a)(this.oscillatorLevelParameter,e.oscillatorLevel,r,n),r=Object(d.a)({},r,Object(ue.a)(e,"detuneParameter",this.detuneParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"oscillatorLevelParameter",this.oscillatorLevelParameter,this.sequencerEngine,t,!0,n))}},{key:"isCarrier",get:function(){return 0===this.instrument.oscillatorNodes.indexOf(this)}},{key:"fromFMJson",value:function(e,t,n){if(void 0===e)return{};var r={};return void 0!==e.harmonicity&&(e.harmonicity=Pn(e.harmonicity,this.isCarrier,e.isHarmonicityFixed),Object(Oe.a)(this.harmonicityParameter,e.harmonicity,r,n)),void 0!==e.partialCount&&Object(Oe.a)(this.partialCountParameter,e.partialCount,r,n),void 0!==e.modulationIndex&&Object(Oe.a)(this.modulationIndexParameter,e.modulationIndex,r,n),void 0!==e.ampEnvelope&&(r=Object(d.a)({},r,this.ampEnvelope.fromJson(e.ampEnvelope,t,n))),r=Object(d.a)({},r,Object(ue.a)(e,"partialCountParameter",this.partialCountParameter,this.sequencerEngine,t,!0,n)),e.harmonicityParameter&&(e.harmonicityParameter.unlockedValue=Pn(e.harmonicityParameter.unlockedValue,this.isCarrier,e.isHarmonicityFixed),e.harmonicityParameter.value=Pn(e.harmonicityParameter.value,this.isCarrier,e.isHarmonicityFixed)),r=Object(d.a)({},r,Object(ue.a)(e,"harmonicityParameter",this.harmonicityParameter,this.sequencerEngine,t,!0,n),Object(ue.a)(e,"modulationIndexParameter",this.modulationIndexParameter,this.sequencerEngine,t,!0,n)),(new Date).getTime(),"formants"in e?r=Object(d.a)({},r,this.loadFormantsJson(e.formants,t,n)):(this.formants.forEach(function(e){return e.ripMods()}),this.formants.forEach(function(e){return Object(Oe.a)(e.enabledParameter,!1,r)},n)),(new Date).getTime(),r}},{key:"mateParameter",value:function(e,t,n,r){Object(se.b)(this.sequencerEngine,e,t,n,r)}},{key:"mateJson",value:function(e,t){this.mateParameter("enabled",e,this.enabledParameter,t),this.enabled&&(this.enabled=!0,this.mateParameter("polyphony",e,this.polyphonyParameter,t),this.mateParameter("oscillatorType",e,this.oscillatorTypeParameter,t),this.mateParameter("oscillatorFrequency",e,this.oscillatorFrequencyParameter,t),this.mateParameter("detune",e,this.detuneParameter,t),this.mateParameter("portamento",e,this.portamentoParameter,t))}}]),n}(e)})(we)),Cn=function(){function e(t,n,r){Object(o.a)(this,e),this.sequencerEngine=t,this.store=t.store,this.mixSession=n,this.context=r.getCopy().forSubDevice(this),this.parameters=[],this.envelope=new Ee(this.sequencerEngine,this.mixSession,this.context,void 0,-2e3,2e3),this.setupParameters()}return Object(s.a)(e,[{key:"setupParameters",value:function(){var e=this;this.attackParameter=new he.a("Attack",this,function(t,n){e.envelope&&(e.envelope.attack=n)},{min:0,max:1e4,unit:"ms",defaultValue:1e3}),this.registerParameter(this.attackParameter),this.decayParameter=new he.a("Decay",this,function(t,n){e.envelope&&(e.envelope.decay=n)},{min:0,max:4e3,unit:"ms",defaultValue:1e3}),this.registerParameter(this.decayParameter),this.sustainParameter=new he.a("Sustain",this,function(t,n){e.envelope&&(e.envelope.sustain=n)},{min:0,max:1,unit:"",defaultValue:.5}),this.registerParameter(this.sustainParameter),this.releaseParameter=new he.a("Release",this.envelope,function(t,n){e.envelope&&(e.envelope.release=n)},{min:0,max:5e3,unit:"ms",defaultValue:1e3}),this.registerParameter(this.releaseParameter),this.levelParameter=new he.a("Level",this,function(t,n){e.envelope&&(e.envelope.level=n)},{min:-1,max:1,unit:"",defaultValue:0}),this.registerParameter(this.levelParameter),this.attackCurveParameter=new he.a("Attack Curve",this.envelope,function(e,t){return e.attackCurve=t},{min:0,max:1e4,unit:"",defaultValue:"linear",automatable:!1}),this.registerParameter(this.attackCurveParameter),this.decayCurveParameter=new he.a("Decay Curve",this.envelope,function(e,t){return e.decayCurve=t},{min:0,max:1e4,unit:"",automatable:!1,defaultValue:"linear"}),this.registerParameter(this.decayCurveParameter),this.releaseCurveParameter=new he.a("Release Curve",this.envelope,function(e,t){return e.releaseCurve=t},{min:0,max:1e4,unit:"",automatable:!1,defaultValue:"exponential"}),this.registerParameter(this.releaseCurveParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(e){var t={level:this.level,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackCurve:this.attackCurve,decayCurve:this.decayCurve,releaseCurve:this.releaseCurve};return t=Object(ue.b)(t,"attackParameter",this.attackParameter,void 0,e),t=Object(ue.b)(t,"decayParameter",this.decayParameter,void 0,e),t=Object(ue.b)(t,"sustainParameter",this.sustainParameter,void 0,e),t=Object(ue.b)(t,"releaseParameter",this.releaseParameter,void 0,e),t=Object(ue.b)(t,"levelParameter",this.levelParameter,void 0,e),t=Object(ue.b)(t,"attackCurveParameter",this.attackCurveParameter,void 0,e),t=Object(ue.b)(t,"decayCurveParameter",this.decayCurveParameter,void 0,e),t=Object(ue.b)(t,"releaseCurveParameter",this.releaseCurveParameter,void 0,e)}},{key:"fromJson",value:function(e){var t={};return Object(Oe.a)(this.attackParameter,e.attack,t),Object(Oe.a)(this.decayParameter,e.decay,t),Object(Oe.a)(this.sustainParameter,e.sustain,t),Object(Oe.a)(this.releaseParameter,e.release,t),Object(Oe.a)(this.levelParameter,e.level,t),e.attackCurve&&Object(Oe.a)(this.attackCurveParameter,e.attackCurve,t),e.decayCurve&&Object(Oe.a)(this.decayCurveParameter,e.decayCurve,t),e.releaseCurve&&Object(Oe.a)(this.releaseCurveParameter,e.releaseCurve,t),t=Object(d.a)({},t,Object(ue.a)(e,"attackParameter",this.attackParameter,this.sequencerEngine),Object(ue.a)(e,"decayParameter",this.decayParameter,this.sequencerEngine),Object(ue.a)(e,"sustainParameter",this.sustainParameter,this.sequencerEngine),Object(ue.a)(e,"releaseParameter",this.releaseParameter,this.sequencerEngine),Object(ue.a)(e,"levelParameter",this.levelParameter,this.sequencerEngine),Object(ue.a)(e,"attackCurveParameter",this.attackCurveParameter,this.sequencerEngine),Object(ue.a)(e,"decayCurveParameter",this.decayCurveParameter,this.sequencerEngine),Object(ue.a)(e,"releaseCurveParameter",this.releaseCurveParameter,this.sequencerEngine))}},{key:"getCopy",value:function(t){var n=new e(this.sequencerEngine,this.mixSession,t);return n.fromJson(this.getJson()),n}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"level",get:function(){return this.levelParameter.get()},set:function(e){this.levelParameter.set(e)}},{key:"attackCurve",get:function(){return this.attackCurveParameter.get()},set:function(e){this.attackCurveParameter.set(e)}},{key:"decayCurve",get:function(){return this.decayCurveParameter.get()},set:function(e){this.decayCurveParameter.set(e)}},{key:"releaseCurve",get:function(){return this.releaseCurveParameter.get()},set:function(e){this.releaseCurveParameter.set(e)}},{key:"refresh",value:function(){this.attackParameter.callSetter(),this.decayParameter.callSetter(),this.sustainParameter.callSetter(),this.releaseParameter.callSetter(),this.levelParameter.callSetter()}},{key:"mateJson",value:function(e,t){this.mateParameter("attack",e,this.attackParameter,t),this.mateParameter("decay",e,this.decayParameter,t),this.mateParameter("sustain",e,this.sustainParameter,t),this.mateParameter("release",e,this.releaseParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){Object(se.b)(this.sequencerEngine,e,t,n,r)}},{key:"dispose",value:function(){this.envelope.dispose(),this.envelope=void 0}}]),e}();function Nn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var In=n(32),qn=n(147);function _n(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Dn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Dn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ln=function(e,t){var n=new re.a.Frequency(e).toMidi()+1;return e+t/100*(new re.a.Frequency(n,"midi").toFrequency()-e)},Bn=function e(t,n,r){Object(o.a)(this,e),this.carrier=t,this.modulators=n,this.slotNumber=r,this.voiceNumber=r};function zn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Jn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Vn=function(e){Object(u.a)(n,e);var t=Jn(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this,e,r,a,!1)).track=i,s.id=Object(q.uuid)(),s.initializeConfigurations(s.adjacencyLists),s.loaded=!0,ve("01_Saw"),ve("03_Square"),s.setupOscillators(),s.setupOutputs(),s.setupFilters(),s.outputNode=s.filter.effectNode,s.outputNode.x=180,s.outputNode.y=200,s.setupFM(),s.setupPitchBend(),s.getParameters().forEach(function(e){return e.isLoaded=!0}),s.setupParameters(),s.refreshParameters(),s.voiceFactory=Rt,s.sequencerEngine.dispatch(Object(J.xb)(s.initialBulkValues)),s.setupSlide(),s.polyphonyParameter.set(5),s.algorithmParameter.set(3),s.connectNoise(),s.setupNoiseParameters(),s}return Object(s.a)(n,[{key:"detuneSignal",get:function(){return this.pitchBendSignal}},{key:"detuneParameter",get:function(){return this.pitchBendParameter}},{key:"detuneSignals",get:function(){var e=[];return this.oscillators.forEach(function(t){return t.voices.forEach(function(t){return e.push(t.detune)})}),e}},{key:"effects",get:function(){return this.oscillatorNodes},set:function(e){}},{key:"newEdge",value:function(e,t){return Yt.newVoice(e,this.sequencerEngine,t)}},{key:"connectEdge",value:function(e,t){return Object(fe.a)(Object(f.a)(n.prototype),"connectEdge",this).call(this,e,t),e.connectEdge(t),t}},{key:"deleteEdge",value:function(e){var t=this;if(!e.modulator){var r=function(n){t.adjacencyLists[n].indexOf(e)>-1&&(t.effects.find(function(e){return e.id===n})&&e.disconnect&&e.disconnect())};for(var a in this.adjacencyLists)r(a)}Object(fe.a)(Object(f.a)(n.prototype),"deleteEdge",this).call(this,e)}},{key:"getEffectType",value:function(){return je.d}},{key:"modulators",get:function(){return Object(h.a)(this.sequencerEngine.lfos.map(function(e){return e.lfo}))}},{key:"setSize",value:function(e,t,n,r){this.inputNode.x=0,this.inputNode.y=0,this.outputNodeX.x=e-32,this.outputNodeX.y=10,this.outputNodeY.x=e-32,this.outputNodeY.y=45}},{key:"dispose",value:function(){this.deleteAlgorithmRouting(),this.disposeOutputs(),this.disposeNoise(),Object(fe.a)(Object(f.a)(n.prototype),"dispose",this).call(this)}},{key:"getCopy",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.sequencerEngine,a=arguments.length>3?arguments[3]:void 0,i=new n(r,this.mixSession,e,t);return i.fromJsonSync(this.getJson(),a),i}},{key:"simplifyPatch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e/2;Object(fe.a)(Object(f.a)(n.prototype),"simplifyPatch",this).call(this,e);var r=this.oscillators.flatMap(function(e){return e.formantsManager.formants}).filter(function(e){return e.isEnabled});r=Object(b.a)(r);for(var a=Math.floor(r.length*t/100),i=0;i<a;i++){var o=r[i];o.getParameters().filter(function(e){return e.isMapped}).forEach(function(e){return e.isMapped.unmap(e)}),o.effect&&o.bypassEffect(),o.enabledParameter.set(!1)}}},{key:"test",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=0;t<100;t++)this.algorithmParameter.set(t%8+1),Object(M.a)(50);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(Object(ot.a)(function(e){return function(e){Object(u.a)(n,e);var t=zn(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).voiceCounter=0,e.voiceToTranspose={},e.frequencyToVoice={},e.voiceToFrequency={},e.voicesUsed=[],e.numberToVoice={},e}return Object(s.a)(n,[{key:"useVoice",value:function(e,t){var n=this.findFreeVoice(t,e);return this.buildVoice(n)}},{key:"buildVoice",value:function(e){return new Bn(this.carrierOscillator.voices[e],this.modulatorOscillators.map(function(t){return t.voices[e]}),e)}},{key:"findFreeVoice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re.a.Master.context.currentTime,t=arguments.length>1?arguments[1]:void 0,n=this.oscillators[0].getNoteFromTranspose(t).toFrequency();for(var r in this.voiceToFrequency)if(!(parseInt(r)>=this.polyphonyParameter.get())&&this.voiceToFrequency[r]===n)return parseInt(r);for(var a=this.oscillators[0].voices,i=this.voiceCounter,o=0;o<this.polyphonyParameter.get();o++){var s=(i+o)%a.length;if(0===a[s].envelope.getValueAtTime(e))return parseInt(s)}for(var c=[],u=this.voicesUsed.length-1;u>=0;u--)if((c=Array.from(new Set([].concat(Object(h.a)(c),[this.voicesUsed[u]])))).length===this.polyphonyParameter.get())return this.voicesUsed[u];return this.polyphonyParameter.get()-1}},{key:"storeVoiceFrequency",value:function(e,t,n){var r=this.oscillators[0].getNoteFromTranspose(e);this.frequencyToVoice[r.toFrequency()]=t,this.voiceToFrequency[t]=r.toFrequency(),this.voiceCounter=(this.voiceCounter+1)%this.polyphonyParameter.get(),this.numberToVoice[t]=n}},{key:"clearVoiceData",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.releaseAll(),this.voiceCounter=0,this.voiceToTranspose={},this.frequencyToVoice={},this.voiceToFrequency={},this.voicesUsed=[],this.numberToVoice={}}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Fn(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getJson",value:function(e){var t,n=(t={id:this.id,mix:this.mixParameter.get(!0),algorithm:this.algorithmParameter.get(!0),ampEnvelope:this.ampEnvelope.getJson(e),polyphony:this.polyphonyParameter.get(),instrumentType:this.getInstrumentType(),filterCutoff:this.filterCutoff,filterQ:this.filterQ,hpFilterCutoff:this.hpFilterCutoff,fmParameters:this.fmParameters,hpFilterQ:this.hpFilterQ},Object(In.a)(t,"ampEnvelope",this.ampEnvelope.getJson(e)),Object(In.a)(t,"filterEnvelope",this.filterEnvelope.getJson(e)),Object(In.a)(t,"hpFilterEnvelope",this.hpFilterEnvelope.getJson(e)),Object(In.a)(t,"pitchEnvelope",this.pitchEnvelope.getJson(e)),Object(In.a)(t,"oscillators",this.oscillatorNodes.map(function(t){return t.getJson(e)})),Object(In.a)(t,"noiseLevel",this.noiseLevelParameter.get(!0)),Object(In.a)(t,"pitchBend",this.pitchBendParameter.get(!0)),t);return n=Object(ue.b)(n,"noiseLevelParameter",this.noiseLevelParameter,void 0,e),n=Object(ue.b)(n,"filterCutoffParameter",this.filterCutoffParameter,void 0,e),n=Object(ue.b)(n,"hpFilterCutoffParameter",this.hpFilterCutoffParameter,void 0,e),n=Object(ue.b)(n,"hpFilterQParameter",this.hpFilterQParameter,void 0,e),n=Object(ue.b)(n,"filterQParameter",this.filterQParameter,void 0,e),n=Object(ue.b)(n,"algorithmParameter",this.algorithmParameter,void 0,e),n=Object(ue.b)(n,"mixParameter",this.mixParameter,void 0,e),n=Object(ue.b)(n,"pitchBendParameter",this.pitchBendParameter,void 0,e)}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f.length>1&&void 0!==f[1]&&f[1],r=f.length>2&&void 0!==f[2]&&f[2],i=f.length>3&&void 0!==f[3]?f[3]:100,!window.skipSynth){e.next=5;break}return e.abrupt("return",{});case 5:if(o=0,t){e.next=8;break}return e.abrupt("return",{});case 8:t.fmParameters&&!n&&(this.fmParameters=t.fmParameters),!n&&t.id&&(this.id=t.id);case 10:if(me("01_Saw")&&me("03_Square")){e.next=17;break}return e.next=13,Object(M.a)(100);case 13:if(!(++o>50)){e.next=15;break}return e.abrupt("return");case 15:e.next=10;break;case 17:return this.ampEnvelope.release=50,this.clearVoiceData(),(new Date).getTime(),this.loaded=!1,this.track.trackIsLoading=!0,e.next=24,Object(M.a)(120);case 24:return this.getParameters().forEach(function(e){return e.isLoaded=!1}),s={},void 0!==t.polyphony&&(c=this.polyphonyParameter.set(Math.min(6,t.polyphony),void 0,!0),u=c.id,l=c.value,s[u]=l),e.t0=d.a,e.t1={},e.t2=s,e.next=32,this.fromOscillatorsJson(t,n,i);case 32:return e.t3=e.sent,s=(0,e.t0)(e.t1,e.t2,e.t3),void 0!==t.algorithm&&Object(Oe.a)(this.algorithmParameter,t.algorithm,s,i),r&&(s=Object(d.a)({},s,this.scaleToC())),s=Object(d.a)({},s,this.fromJsonRest(t,n,i)),(new Date).getTime(),this.keepParametersInSync(),e.abrupt("return",s);case 40:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fromJsonSync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!t&&e.id&&(this.id=e.id),this.loaded=!1,this.track.trackIsLoading=!0,this.getParameters().forEach(function(e){return e.isLoaded=!1});var n={};if(void 0!==e.polyphony){var r=this.polyphonyParameter.set(e.polyphony,void 0,!0),a=r.id,i=r.value;n[a]=i}void 0!==e.algorithm&&Object(Oe.a)(this.algorithmParameter,e.algorithm,n,100),n=Object(d.a)({},n,this.fromOscillatorsJsonSync(e,t),this.fromJsonRest(e,t))}},{key:"fromJsonRest",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=(0,{});if(r=Object(d.a)({},r,this.ampEnvelope.fromJson(e.ampEnvelope,void 0,n)),void 0!==e.noiseLevel?(Object(Oe.a)(this.noiseLevelParameter,e.noiseLevel,r,n),r=Object(d.a)({},r,Object(ue.a)(e,"noiseLevelParameter",this.mixParameter,this.sequencerEngine,t))):this.noiseLevelParameter.set(0),r=Object(d.a)({},r,Object(ue.a)(e,"mixParameter",this.mixParameter,this.sequencerEngine,t),Object(ue.a)(e,"algorithmParameter",this.algorithmParameter,this.sequencerEngine,t),Object(ue.a)(e,"pitchBendParameter",this.pitchBendParameter,this.sequencerEngine,t)),e.pitchBend?Object(Oe.a)(this.pitchBendParameter,e.pitchBend,r):Object(Oe.a)(this.pitchBendParameter,0,r),void 0!==e.mix&&this.mixParameter.set(e.mix),this.detuneOffset){var a=this.pitchBendParameter.set(this.pitchBendParameter.get(!0)+this.detuneOffset),i=a.id,o=a.value;r[i]=o}return r}},{key:"keepParametersInSync",value:function(){this.getParameters().forEach(function(e){e.depthSignal&&e.depthParameter&&e.depthSignal.value!==e.depthParameter.get(!0)&&e.depthParameter.refresh(!0,!0),e._audioParams&&e._audioParams.filter(function(e){return e.input&&0!==e.value}).forEach(function(e){e.value=0}),e.audioParam&&e.audioParam.value!==e.get(!0)&&e.refresh(!0,!0)}),this.loaded=!0,this.getParameters().forEach(function(e){return e.isLoaded=!0}),this.track.trackIsLoading=!1}},{key:"fromOscillatorsJsonSync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};for(var r in this.instrumentType=e.instrumentType,this.oscillatorNodes){r=parseInt(r);var a=this.oscillatorNodes[r];n=Object(d.a)({},n,a.fromJson(e.oscillators[r],t))}return Object(d.a)({},n,this.loadFilterJson(e,t,100))}},{key:"loadOscillators",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]&&c[1],r=c.length>2?c[2]:void 0,(new Date).getTime(),e.t0=d.a,e.t1={},e.t2=i,e.next=9,this.oscillatorNodes[0].fromJson(t.oscillators[0],n,r);case 9:e.t3=e.sent,i=(0,e.t0)(e.t1,e.t2,e.t3),e.t4=a.a.keys(this.oscillatorNodes);case 12:if((e.t5=e.t4()).done){e.next=21;break}if(o=e.t5.value,0!==(o=parseInt(o))){e.next=17;break}return e.abrupt("continue",12);case 17:s=this.oscillatorNodes[o],i=Object(d.a)({},i,s.fromJson(t.oscillators[o],n,r)),e.next=12;break;case 21:return(new Date).getTime(),e.abrupt("return",i);case 23:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fromOscillatorsJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]&&o[1],r=o.length>2?o[2]:void 0,this.instrumentType=t.instrumentType,e.next=5,this.loadOscillators(t,n,r);case 5:return i=e.sent,e.abrupt("return",Object(d.a)({},i,this.loadFilterJson(t,n,r)));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadFilterJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r={};return r=Object(d.a)({},r,this.filterEnvelope.fromJson(e.filterEnvelope,t,n),this.pitchEnvelope.fromJson(e.pitchEnvelope,t,n),Object(ue.a)(e,"filterCutoffParameter",this.filterCutoffParameter,this.sequencerEngine,t,!0),Object(ue.a)(e,"filterQParameter",this.filterQParameter,this.sequencerEngine,t,!0),Object(ue.a)(e,"hpFilterCutoffParameter",this.hpFilterCutoffParameter,this.sequencerEngine,t,!0),Object(ue.a)(e,"hpFilterQParameter",this.hpFilterQParameter,this.sequencerEngine,t,!0)),e.hpFilterEnvelope&&(r=Object(d.a)({},r,this.hpFilterEnvelope.fromJson(e.hpFilterEnvelope))),Object(Oe.a)(this.filterCutoffParameter,e.filterCutoff,r),Object(Oe.a)(this.filterQParameter,e.filterQ,r),void 0!==e.hpFilterCutoff&&(Object(Oe.a)(this.hpFilterCutoffParameter,e.hpFilterCutoff,r),Object(Oe.a)(this.hpFilterQParameter,e.hpFilterQ,r)),r}},{key:"scaleToC",value:function(){var e=this.getLoudestOsc(),t=e.harmonicityParameter.get(!0),n=e.detuneParameter.get(!0),r=this.carrierOscillator.oscillatorFrequencyParameter.get(!0),a=new re.a.Frequency("C3").toFrequency(),i=a,o=a+((a+Ln(a,n))*t-i),s=new re.a.Frequency(o).toMidi(),c=s-new re.a.Frequency("C3").toMidi(),u=new re.a.Frequency(s,"midi").toFrequency(),l=o-u;l<0?(new re.a.Frequency(s-1,"midi").toFrequency(),this.detuneOffset=0):(new re.a.Frequency(s+1,"midi").toFrequency(),this.detuneOffset=0);var f=-c,h=Object(qn.a)(f,12);f=12*Math.floor(r/12)+h;var d=this.carrier.oscillatorFrequencyParameter.set(f,!1,!0),p=d.id,v=d.value,m={};return m[p]=v,m}},{key:"getLoudestOsc",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.oscillators;if(0!==e.length){var t,n,r=[],a=_n(this.oscillators);try{for(a.s();!(t=a.n()).done;){var i=t.value;this.adjacencyLists[i.id].some(function(e){return"X"===e.effect.name||"Y"===e.effect.name})&&r.push(i)}}catch(f){a.e(f)}finally{a.f()}var o,s=-1/0,c=_n(e);try{for(c.s();!(o=c.n()).done;){var u=o.value;if(r.includes(u)){var l=u.oscillatorLevelParameter.get(!0);l>s&&(n=u,s=l)}}}catch(f){c.e(f)}finally{c.f()}return n}}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Nn(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"setupOscillators",value:function(){this.pitchEnvelope=new Cn(this.sequencerEngine,this.mixSession,this.context),this.pitchEnvelope.name="Pitch Envelope",this.oscillatorNodes=[this.createNewOscillator(!0,"C"),this.createNewOscillator(!0,"A"),this.createNewOscillator(!0,"B1"),this.createNewOscillator(!0,"B2")],this.oscillators[0].enabled=!0,this.oscillators[1].enabled=!0,this.oscillators[2].enabled=!0,this.oscillators[3].enabled=!0}},{key:"carrierOscillator",get:function(){if(this.oscillatorNodes)return this.oscillatorNodes[0]}},{key:"modulatorOscillators",get:function(){if(this.oscillatorNodes)return this.oscillators.slice(1)}},{key:"oscillators",get:function(){return this.oscillatorNodes?this.oscillatorNodes.filter(function(e){return e.enabled}):[]}},{key:"getOscillator",value:function(e){return this.oscillatorNodes?this.oscillatorNodes[e]:[]}},{key:"createNewOscillator",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"A";return new Rn(this.sequencerEngine,this.mixSession,this.context,this.pitchEnvelope.envelope,e,t,this.track,this)}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=dn(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"setupFM",value:function(){var e=this,t=this.track;this.fmParameters={id:Object(q.uuid)()},this.oscillators[0].track=t,this.oscillators[0].x=83,this.oscillators[0].y=9,this.oscillators[1].track=t,this.oscillators[1].x=26,this.oscillators[1].y=9,this.oscillators[3].track=t,this.oscillators[3].x=26,this.oscillators[3].y=45,this.oscillators[2].track=t,this.oscillators[2].x=83,this.oscillators[2].y=45,this.carrier=this.oscillators[0],this.oscillators.forEach(function(t){return t===e.carrier?t.fm(void 0,!1):t.fm(e.carrier,!1)});var n=this.oscillators.reduce(function(e,t){return Object(d.a)({},e,t.bulk)},{});this.sequencerEngine.dispatch(Object(J.xb)(n)),this.oscillators[0].ampEnvelope=this.ampEnvelope,this.oscillators[0].harmonicityParameter.set(.5),this.oscillators[0].modulationIndexParameter.set(24),this.oscillators[1].harmonicityParameter.set(1),this.oscillators[2].harmonicityParameter.set(4),this.oscillators[2].modulationIndexParameter.set(32),this.oscillators[3].harmonicityParameter.set(2),this.oscillators[3].modulationIndexParameter.set(15),this.carrier=this.oscillators[0],this.oscillators[1].carrier=this.carrier,this.oscillators[2].carrier=this.carrier,this.oscillators[3].carrier=this.carrier}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=hn(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"onChangePolyphony",value:function(e){var t=this.oscillatorNodes[0].voices;if(e!==t.length){if(e>t.length)for(var n=t.length;n<e;n++)this.outputNodeX.newVoice(),this.outputNodeY.newVoice();else for(var r=e;r<t.length;r++)this.outputNodeX.removeVoice(),this.outputNodeY.removeVoice();this.refreshAmpEnvelopes()}}},{key:"refreshAmpEnvelopes",value:function(){this.ampEnvelope.ampEnvelopes=this.ampEnvelopes,this.ampEnvelope.refresh()}},{key:"setupOutputs",value:function(){var e=this.sequencerEngine,t=this.mixSession;this.outputNodeX=new un("X",-2,this,0,e,t,this.context),this.outputNodeY=new un("Y",-3,this,1,e,t,this.context),this.outputCrossFade=new re.a.CrossFade(.5),this.ampEnvelope=new Kt(e,t,this.context,this.ampEnvelopes,this),this.ampEnvelope.name="Amp Envelope";var n,r=ln(this.oscillatorNodes);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.ampEnvelope.name="Envelope "+a.name}}catch(i){r.e(i)}finally{r.f()}}},{key:"forSlot",value:function(e){var t=this.outputNodeX,n=this.outputNodeY,r=[];for(var a in t.outputs)t.outputs[a].ampEnvelopes[e]||t.newVoice(),r=[].concat(Object(h.a)(r),[t.outputs[a].ampEnvelopes[e]]);for(var i in n.outputs)n.outputs[i].ampEnvelopes[e]||n.newVoice(),r=[].concat(Object(h.a)(r),[n.outputs[i].ampEnvelopes[e]]);return r}},{key:"ampEnvelopes",get:function(){var e=this.outputNodeX,t=this.outputNodeY,n=[];for(var r in e.outputs)n=[].concat(Object(h.a)(n),Object(h.a)(e.outputs[r].ampEnvelopes));for(var a in t.outputs)n=[].concat(Object(h.a)(n),Object(h.a)(t.outputs[a].ampEnvelopes));return n}},{key:"disposeOutputs",value:function(){this.outputNodeX.dispose(),this.outputNodeY.dispose(),this.outputCrossFade.dispose(),this.outputNodeX=void 0,this.outputNodeY=void 0,this.outputCrossFade=void 0}},{key:"connectNoise",value:function(){}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=rn(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"triggerAttack",value:function(e,t,n,r,a){var i=this;if(this.loaded||re.a.Master.context.isOffline){t=re.a.Master.context.isOffline?re.a.Master.context._currentTime:re.a.Master.context.currentTime;var o=this.useVoice(e,t);if(o){var s=o.voiceNumber;this.voicesUsed.push(s),this.setEnvelopes(a,e,o),this.triggerAttackEnvelopes(t,n,o.slotNumber),this.scaleByKey(t,e,s),this.carrierOscillator.triggerAttack(e,t,n,o.carrier),o.modulators.filter(function(e,t){return i.oscillatorNodes[t].enabled}).forEach(function(e){e._triggerEnvelopeAttack(t,n)}),this.storeVoiceFrequency(e,s,o)}}}},{key:"triggerAttackRelease",value:function(e,t,n,r,a,i){var o=this;if(this.loaded||re.a.Master.context.isOffline){n=new re.a.Time(n),r>1&&(r=1);var s=this.useVoice(e,n);if(s){var c=s.voiceNumber;this.voicesUsed.push(c),this.setEnvelopes(i,void 0,s),this.triggerAttackReleaseEnvelopes(t,n,r,s.slotNumber),this.scaleByKey(n,e,c),this.carrierOscillator.triggerAttackRelease(e,t,n,r,s.carrier),s.modulators.filter(function(e,t){return o.oscillatorNodes[t].enabled}).forEach(function(e){e._triggerEnvelopeAttack(n,r),e._triggerEnvelopeRelease(n+t)}),this.storeVoiceFrequency(e,c,s),this.lastTranspose=e}}}},{key:"triggerRelease",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re.a.Master.context.currentTime,r=arguments.length>2?arguments[2]:void 0,a=(e&&e.map(function(e){return t.oscillators[0].getNoteFromTranspose(e)}))[0].toFrequency(),i=void 0===e?0:this.frequencyToVoice[a];if(this.voiceToFrequency[i]===a){var o=this.numberToVoice[i];this.setEnvelopes(void 0,void 0,o),this.triggerReleaseEnvelopes(n,o.slotNumber,r),this.voiceToTranspose[i]=e&&e[0],void 0===r&&this.carrierOscillator.triggerRelease(e,o.carrier,n,r),o.modulators.forEach(function(e){e._triggerEnvelopeRelease(n,r)})}}},{key:"isLastVoice",value:function(e){for(var t=this.oscillators[0].voices,n=(this.voiceCounter,0),r=0;r<this.polyphonyParameter.get();r++)if(t[r].envelope.getValueAtTime(e)>0&&n++,n>1)return!1;return!0}},{key:"releaseAll",value:function(){if(!this.disposed){var e,t=tn(this.oscillatorNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;n._voices.forEach(function(e){return e.envelope.release=.01}),n._voices.forEach(function(e){return e.triggerRelease()})}}catch(r){t.e(r)}finally{t.f()}this.clearSlide(),this.releaseSlide(),this.detuneSignal.value=this.detuneParameter.get(!0),this.lastTranspose=0,this.clearVoiceData(!1)}}},{key:"setEnvelopes",value:function(e,t,n){var r=this;this.ampEnvelope.refresh(),this.pitchEnvelope.refresh(),this.filterEnvelope.refresh(),this.hpFilterEnvelope.refresh(),this.carrierOscillator.setEnvelopes(e,this.ampEnvelope,t,n.carrier),this.modulatorOscillators.forEach(function(a,i){return a.setEnvelopes(e,r.ampEnvelope,t,n.modulators[i])})}},{key:"triggerAttackEnvelopes",value:function(e,t,n){this.forSlot(n).forEach(function(n){return n.envelope.triggerAttack(e,t)}),this.filterEnvelope.triggerAttack(e,t),this.hpFilterEnvelope.triggerAttack(e,t),this.pitchEnvelope.envelope.triggerAttack(e,t)}},{key:"triggerReleaseEnvelopes",value:function(e,t,n){this.forSlot(t).forEach(function(t){return t.envelope.triggerRelease(e+1/re.a.Master.context.sampleRate,n)}),this.isLastVoice(e)&&(this.filterEnvelope.triggerRelease(e),this.hpFilterEnvelope.triggerRelease(e),this.pitchEnvelope.envelope.triggerRelease(e))}},{key:"triggerAttackReleaseEnvelopes",value:function(e,t,n,r){this.forSlot(r).forEach(function(r){return r.envelope.triggerAttackRelease(e,t,n)}),this.filterEnvelope.triggerAttackRelease(e,t,n),this.hpFilterEnvelope.triggerAttackRelease(e,t,n),this.pitchEnvelope.envelope.triggerAttackRelease(e,t,n)}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=sn(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"setupParameters",value:function(){var e=this;this.polyphonyParameter=new he.b("Polyphony",this,function(t,n){if(e.oscillators[0].voices.length!==n&&e.algorithmParameter){e.deleteAlgorithmRouting(),e.onChangePolyphony(n),e.onPolyNoise(n),e.clearVoiceData();var r=Object(h.a)(e.oscillatorNodes);n<r[0]._voices.length&&r.reverse(),r.forEach(function(e){return e.polyphony=n}),e.currentAlgo=void 0,e.changeAlgorithm(e.algorithmParameter.get(),void 0,void 0,!0),e.connectPitchBend()}},{documentation:["The number of voices in the synth.","When set 1, it becomes monophonic (i.e. only 1 note can be played at a time)"],min:0,max:16,unit:"",defaultValue:1,automatable:!1}),this.registerParameter(this.polyphonyParameter),this.algorithmParameter=new he.b("Algorithm",this,function(t,n){e.changeAlgorithm(n)},{documentation:["Choose the configuration for how the operators connect with one another.","Can get wildly different timbres this way"],min:1,max:8,unit:"",defaultValue:1}),this.registerParameter(this.algorithmParameter),this.mixParameter=new le.c("Mix",this.outputCrossFade.fade,{documentation:"Controls the mix between the operators set to X and Y.",min:0,max:1,defaultValue:.5}),this.registerParameter(this.mixParameter)}},{key:"getParameters",value:function(){if(!this.parameters)return[];var e=Object(h.a)(this.parameters);for(var t in this.oscillatorNodes)e=e.concat(this.oscillatorNodes[t].getParameters());return(e=e.concat(this.ampEnvelope.parameters).concat(this.pitchEnvelope.parameters).concat(this.hpFilterEnvelope.parameters).concat(this.filterEnvelope.parameters)).filter(function(e){return void 0!==e})}},{key:"getSubDevices",value:function(){var e,t=[{value:this.oscillatorNodes[0],label:"Operator C"},{value:this.oscillatorNodes[1],label:"Operator A"},{value:this.oscillatorNodes[2],label:"Operator B1"},{value:this.oscillatorNodes[3],label:"Operator B2"},{value:this,label:"Mix & Filter"},{value:this.ampEnvelope,label:"Amp Env."},{value:this.oscillatorNodes[1].ampEnvelope,label:"Mod A Env."},{value:this.oscillatorNodes[2].ampEnvelope,label:"Mod B1 Env."},{value:this.oscillatorNodes[3].ampEnvelope,label:"Mod B2 Env."},{value:this.filterEnvelope,label:"Filter Env."},{value:this.pitchEnvelope,label:"Pitch Env."},{value:this.hpfilterEnvelope,label:"HP Filter Env."}],n=an(this.oscillatorNodes);try{for(n.s();!(e=n.n()).done;)for(var r=e.value,a=0;a<r.formants.length;a++){var i=r.formants[a];t.push({value:i,label:"Formant "+(a+1)+" "+r.name})}}catch(o){n.e(o)}finally{n.f()}return t}},{key:"getSubDeviceIndex",value:function(e){return this.getSubDevices().map(function(e){return e.value}).indexOf(e)}},{key:"getSubDevice",value:function(e){var t=this.getSubDevices()[e];if(t)return t.value}},{key:"findParameter",value:function(e,t){var n=e.envelopeType,r=this.getParameters();"AMP"===n?r=this.ampEnvelope.parameters:"PITCH"===n?r=this.pitchEnvelope.parameters:"FILTER"===n&&(r=this.filterEnvelope.parameters);var a=r.filter(function(e){return e.name===t});if(0!==a.length)return a[0]}},{key:"filterCutoff",get:function(){return this.filterCutoffParameter.get()},set:function(e){this.filterCutoffParameter.set(e,!0,!0)}},{key:"filterQ",get:function(){return this.filterQParameter.get()},set:function(e){this.filterQParameter.set(e)}},{key:"hpFilterCutoff",get:function(){return this.hpFilterCutoffParameter.get()},set:function(e){this.hpFilterCutoffParameter.set(e)}},{key:"hpFilterQ",get:function(){return this.hpFilterQParameter.get()},set:function(e){this.hpFilterQParameter.set(e)}},{key:"isMonophonic",value:function(){return 1===this.polyphonyParameter.get()}},{key:"refreshParameters",value:function(){this.filterQ=this.filterQ,this.filterCutoff=this.filterCutoff,this.hpFilterCutoff=this.hpFilterCutoff}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=en(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"setupFilters",value:function(){this.filter=new p.a.FilterEffect(this.sequencerEngine),this.hpFilter=new p.a.FilterEffect(this.sequencerEngine),this.hpFilter.hipass(),this.filter.connect(this.hpFilter.effectNode),this.filterEnvelope=new Ee(this.sequencerEngine,this.mixSession,this.context,this.filter.effectNode.frequency,0,1e4),this.filterEnvelope.name="Filter Envelope (LP)",this.filterEnvelope.attackCurve="linear",this.filterEnvelope.decayCurve="linear",this.filterEnvelope.releaseCurve="linear",this.hpFilterEnvelope=new Ee(this.sequencerEngine,this.mixSession,this.context,this.hpFilter.effectNode.frequency,0,1e4),this.hpFilterEnvelope.name="Filter Envelope (HP)",this.hpFilterEnvelope.attackCurve="linear",this.hpFilterEnvelope.decayCurve="linear",this.hpFilterEnvelope.releaseCurve="linear",this.filter.cutoffParameter.audioParam.input.automationRate="a-rate",this.outputCrossFade.connect(this.filter.effectNode),this.setupFilterParameters()}},{key:"connect",value:function(e){void 0!==e&&this.hpFilter.connect(e)}},{key:"disconnect",value:function(e){this.hpFilter.disconnect(e)}},{key:"setupFilterParameters",value:function(){var e=this;this.filterCutoffParameter=new le.a("Filter Cutoff",this.filter.effectNode.frequency,function(t,n){e.filter&&(isNaN(n)||(e.filterEnvelope&&(e.filterEnvelope.frequency=n),e.filter&&(e.filter.cutoffFrequency=n),e.oscillators&&e.oscillators.forEach(function(e){return e.cutoffFrequency=n})))},{min:0,max:1e4,unit:"HZ",defaultValue:1e4,constantAutomationRate:!0,documentation:["Controls the frequency at which filtering works at. ","Frequencies above this value will be cut."]}),this.registerParameter(this.filterCutoffParameter,function(e){return e.filter.frequency}),this.filterQParameter=new le.a("Filter Q",this.filter.effectNode.Q,function(t,n){e.filter&&(e.filter.Q=n)},{min:0,max:9,unit:"",defaultValue:1}),this.registerParameter(this.filterQParameter,function(e){return e.filter.Q}),this.hpFilterCutoffParameter=new le.a("Filter Cutoff (hi-pass)",this.hpFilter.effectNode.frequency,function(t,n){e.hpFilter&&!isNaN(n)&&(e.hpFilterEnvelope.frequency=n,e.hpFilter.cutoffFrequency=n)},{documentation:["Controls the frequency at which filtering works at. ","Frequencies below this value will be cut."],min:0,max:1e4,unit:"HZ",defaultValue:0,constantAutomationRate:!0}),this.registerParameter(this.hpFilterCutoffParameter),this.hpFilterQParameter=new le.a("Filter Q (hi-pass)",this.filter.effectNode.Q,function(t,n){e.hpFilter||(e.hpFilter.Q=n)},{min:0,max:9,unit:"",defaultValue:1}),this.registerParameter(this.hpFilterQParameter)}}]),n}(e)},qt,function(e){return function(e){Object(u.a)(n,e);var t=_t(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"setupPitchBend",value:function(){this.pitchBendSignal=new re.a.Signal(0),this.pitchBendParameter=new le.c("pitchBend",this.pitchBendSignal,{min:-200,max:200,defaultValue:0,automationRate:ce.a}),this.registerParameter(this.pitchBendParameter),this.connectPitchBend()}},{key:"onPitchBend",value:function(e){this.pitchBendParameter.set(200*e,!1,!0)}},{key:"connectPitchBend",value:function(){var e=this;this.pitchBendSignal.disconnect(),this.detuneSignals.forEach(function(t){return e.pitchBendSignal.connect(t)})}}]),n}(e)},Xt.a,Zt.a,function(e){return function(e){Object(u.a)(n,e);var t=Lt(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).currentAlgo=void 0,e.algorithms={1:{A:{feedback:!0,edges:[Bt]},B2:{edges:[Jt]},B1:{edges:[Bt,Ut]},C:{edges:[Ht]}},2:{A:{edges:[Bt]},B2:{edges:[Jt],feedback:!0},B1:{edges:[Ut]},C:{edges:[Ht]}},3:{A:{edges:[Bt,Vt,Jt],feedback:!0},B2:{edges:[Ht]},B1:{edges:[Ut]},C:{edges:[Ht]}},4:{A:{edges:[Bt]},B2:{edges:[Jt],feedback:!0},B1:{edges:[zt,Ut]},C:{edges:[Ht]}},5:{A:{edges:[Bt,Ut]},B2:{edges:[Jt,zt]},B1:{edges:[zt],feedback:!0},C:{edges:[Ht]}},6:{A:{edges:[Bt,Jt],feedback:!0},B2:{edges:[Bt,Jt]},B1:{edges:[Ut]},C:{edges:[Ht]}},7:{A:{edges:[Bt,Ht],feedback:!0},B2:{edges:[Jt,Ut]},B1:{edges:[Ut]},C:{edges:[Ht]}},8:{A:{edges:[Bt]},B2:{edges:[Ht]},B1:{edges:[Ut],feedback:!0},C:{edges:[Ht]}},9:{A:{feedback:!0,edges:[Bt]},B2:{edges:[Jt,Ht]},B1:{edges:[Bt,Ut]},C:{edges:[Ht]}}},e}return Object(s.a)(n,[{key:"changeAlgorithm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.outputNodeX,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.outputNodeY,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e!==this.currentAlgo){var a=this.algorithms[e];for(var i in r||this.deleteAlgorithmRouting(void 0,t,n),a){var o,s=a[i],c=this.getNodeByName(i,t,n),u=Dt(s.edges);try{for(u.s();!(o=u.n()).done;){var l=o.value,f=this.getNodeByName(l,t,n);this.connectNodes(c,f)}}catch(h){u.e(h)}finally{u.f()}}this.adjacencyLists=Object(d.a)({},this.adjacencyLists),this.currentAlgo=e,this.refreshAmpEnvelopes()}}},{key:"deleteAlgorithmRouting",value:function(){var e=this;for(var t in arguments.length>0&&void 0!==arguments[0]&&arguments[0],this.adjacencyLists)Object(h.a)(this.adjacencyLists[t]).forEach(function(t){return e.deleteEdge(t)});this.currentAlgo=-1}},{key:"getNodeByName",value:function(e,t,n){return e===Ht?t:e==Ut?n:this.oscillatorNodes.find(function(t){return t.name===e})}},{key:"testAlgo",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=1,n=0;case 2:if(!(n<100)){e.next=11;break}return this.algorithmParameter.set(t,!1,!1),e.next=6,Object(M.a)(200);case 6:++t>=9&&(t=1);case 8:n++,e.next=2;break;case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(e)},Et.a,function(e){return function(e){Object(u.a)(n,e);var t=Tt(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getModulatedParameters",value:function(){for(var e=[],t=0,n=Array.from(new Set(this.getParameters()));t<n.length;t++){var r=n[t];r.lfos.length+r.envelopes.length>0&&e.push(r)}return e}},{key:"getStats",value:function(){for(var e=0,t=0,n=Array.from(new Set(this.getParameters()));t<n.length;t++){var r=n[t];r.lfos.length,r.envelopes.length,e+=r.lfos.length+r.envelopes.length}return e}},{key:"simplifyPatch",value:function(e){for(var t=this.getModulatedParameters(),n=Math.floor(t.length*e/100),r=0;r<n;r++)t[r].disconnectFromAllModulators()}}]),n}(e)},Qt.a,function(e){return function(e){Object(u.a)(n,e);var t=Pt(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).noiseSources=[],e}return Object(s.a)(n,[{key:"disposeNoise",value:function(){this.noiseSources.forEach(function(e){return e.dispose()}),this.noiseLevelParameter.dispose(),this.noiseSources=void 0}},{key:"setupNoiseParameters",value:function(){this.noiseLevelParameter=new ge.a("Noise Level",this.noiseSources.map(function(e){return e.volume}),{documentation:"Controls the volume for the noise",min:0,max:1,defaultValue:0}),this.registerParameter(this.noiseLevelParameter),this.refreshNoiseParameters()}},{key:"refreshNoiseParameters",value:function(){this.noiseLevelParameter&&(this.noiseLevelParameter.setAudioParams(this.noiseSources.map(function(e){return e.volume})),this.noiseSources.forEach(function(e){return e.start()}))}},{key:"createAndAttachNoise",value:function(){var e=this.newNoiseVoice();this.noiseSources.push(e),this.refreshNoiseParameters()}},{key:"onPolyNoise",value:function(e){if(e<this.noiseSources.length){for(var t=e;e>this.noiseSources.length;)this.noiseSources[e-1].disconnect();this.noiseSources=this.noiseSources.slice(0,t)}else for(;e>this.noiseSources.length;)this.createAndAttachNoise()}},{key:"newNoiseVoice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pink",t=new re.a.Noise(e);return t.volume.value=0,t}}]),n}(e)})(St)),Hn=n(589),Un=n(35);var Gn=function(){function e(t,n,r){Object(o.a)(this,e),this.sequencerEngine=t,this.subSequence=n,this.store=t.store,this.lfos=[],this.lfos=function(e,t,n){var r=[];return r.push(new Hn.a(e,t,e.mixSession,1,n)),r.push(new Hn.a(e,t,e.mixSession,2,n)),r.push(new Hn.a(e,t,e.mixSession,3,n)),r.push(new Hn.a(e,t,e.mixSession,4,n)),r}(t,this,r),this.currentPattern=0,this.context=r}return Object(s.a)(e,[{key:"switchToPattern",value:function(e,t){return this.currentPattern=t,this.updateRedux(e,t)}},{key:"updateRedux",value:function(e,t){var n=this.getAllPatternLockedParameters(e,t),r=[];for(var a in n){var i=n[a].updateRedux(!0);void 0!==i&&(r[i.id]=i.value)}return r}},{key:"patternLocks",get:function(){var e=this.store.getState().tracks.lfoPatternLocks[this.subSequence.id]||{};return Object(d.a)({},e)}},{key:"deletePattern",value:function(e){var t=this.patternLocks;this.store.dispatch(Object(J.Zb)(this.subSequence.id,Object(Un.a)(e,t)))}},{key:"movePatternTo",value:function(e,t){var n=this.patternLocks;this.store.dispatch(Object(J.Zb)(this.subSequence.id,Object(Un.b)(e,t,n)))}},{key:"getAllPatternLockedParameters",value:function(e,t){var n=[];return this.lfos.forEach(function(r){return r.lfo.parameters.filter(function(n){return n.hasPatternLockedValues(e,t)}).forEach(function(e){return n.push(e)})}),n}},{key:"newPattern",value:function(e){var t=this,n=e-1;this.getAllPatternLockedParameters().forEach(function(e){return e.newPattern(t.currentPattern,n)});var r=this.patternLocks;r[n]=this.patternLocked,this.store.dispatch(Object(J.Zb)(this.subSequence.id,r))}},{key:"patternLocked",get:function(){return this.patternLocks[this.currentPattern]||!1},set:function(e){var t=this.patternLocks;t[this.currentPattern]=e,this.store.dispatch(Object(J.Zb)(this.subSequence.id,t)),this.updateRedux()}},{key:"togglePatternLocked",value:function(){this.patternLocked=!this.patternLocked}},{key:"start",value:function(e){for(var t in this.lfos){this.lfos[t].start(e)}}},{key:"stop",value:function(){for(var e in this.lfos){this.lfos[e].stop()}}},{key:"onBPMUpdated",value:function(){this.lfos.forEach(function(e){return e.lfo.onBPMUpdated()})}}]),e}(),Wn=new(function(){function e(){Object(o.a)(this,e),this.chains=[],this.totalCreated=0}return Object(s.a)(e,[{key:"useChain",value:function(e,t){var n=void 0;this.chains.length>0&&!t.isOffline?n=this.chains.pop():(n=[new re.a.Scale(e.min,e.max),new re.a.Gain(1)],this.totalCreated++);return n[0].min=e.min,n[0].max=e.max,n}},{key:"disposeChain",value:function(e){e.forEach(function(e){return e.dispose()})}},{key:"releaseChain",value:function(e,t){if(t.isOffline)this.disposeChain(e);else{if(this.chains.length>=50){var n=this.chains[0];this.disposeChain(n),this.chains=this.chains.slice(1)}this.chains.push(e)}}}]),e}()),Kn=n(928),Qn=n(17);function Zn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}window.offsetTime=.009,window.envelopeChainFactory=Wn;var Yn=function(e){Object(u.a)(n,e);var t=Zn(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this,e,r,a,i)).disable=!1,s.id=Object(q.uuid)(),s.lastValue=void 0,s.lastStep=void 0,s.envelope=new re.a.ScaledEnvelope,s.meter=new re.a.Analyser("waveform",32),s.envelope.connect(s.meter),s.envelope.min=0,s.envelope.max=1,s.parameters=[],s.setupParameters(),s.savedFrequency=void 0,s.parameterIdToVoiceToNode={},s}return Object(s.a)(n,[{key:"name",get:function(){return"Env "+this.number}},{key:"getType",value:function(){return Qn.a}},{key:"dispose",value:function(){for(var e in this.envelope.dispose(),this.meter.dispose(),this.parameterIdToVoiceToNode){var t=this.parameterIdToVoiceToNode[e];for(var n in t){t[n].filter(function(e){return e.dispose&&e.input}).forEach(function(e){return e.dispose()})}}this.parameterIdToVoiceToNode=void 0,this.envelope=void 0,this.meter=void 0,this.parameters=void 0}},{key:"startMetering",value:function(e){var t=this;this.meterTimer=setInterval(function(){e.sendMessage("level",t.envelope.value)},10)}},{key:"stopMetering",value:function(){clearInterval(this.meterTimer)}},{key:"getValue",value:function(e){var t=this.lastTriggerAttackRelease;if(void 0===t)return 0;var n=void 0!==t.duration,r=re.a.Master.context.isOffline?re.a.Master.context._currentTime:re.a.Master.context.currentTime,a=t.time,i=r-a,o=t.time+t.duration;if(r>=a&&(!n||r<=o))return i<=this.attack/1e3?i/(this.attack/1e3):i<=(this.attack+this.decay)/1e3?1+(i-this.attack/1e3)/(this.decay/1e3)*(this.sustain-1):this.sustain;if(r>=o&&r<=o+this.release/1e3){var s=(r-o)/(this.release/1e3);return this.sustain-this.sustain*s}return 0}},{key:"getChain",value:function(e,t){return[].concat(Object(h.a)(Wn.useChain(e,this.sequencerEngine)),[t])}},{key:"releaseChain",value:function(e){Wn.releaseChain(e.slice(0,e.length-1),this.sequencerEngine)}},{key:"getModulator",value:function(){return this.envelope}},{key:"triggerAttack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.disabled||(e=e||(re.a.Master.context.isOffline?re.a.Master.context._currentTime:re.a.Master.context.currentTime),this.envelope.triggerAttack(e,t),this.lastTriggerAttackRelease={time:e,velocity:t})}},{key:"triggerAttackRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this.disabled||(t=Math.max(t,0),isNaN(e)||isNaN(t)||isNaN(n)||(this.envelope.triggerAttackRelease(e,t,n),this.lastTriggerAttackRelease={duration:e,time:t,velocity:n}))}},{key:"triggerRelease",value:function(e){this.disabled||(this.envelope.triggerRelease(e),e=e||(re.a.Master.context.isOffline?re.a.Master.context._currentTime:re.a.Master.context.currentTime),this.lastTriggerAttackRelease&&(this.lastTriggerAttackRelease=Object(d.a)({},this.lastTriggerAttackRelease,{duration:e-this.lastTriggerAttackRelease.time})))}},{key:"setupParameters",value:function(){this.attackParameter=new he.a("Attack",this.envelope,function(e,t){e&&(e.attack=(t+1e-6)/1e3)},{min:0,max:1e4,unit:"ms",defaultValue:15}),this.registerParameter(this.attackParameter),this.decayParameter=new he.a("Decay",this.envelope,function(e,t){e&&(e.decay=(t+1e-5)/1e3)},{min:0,max:1e4,unit:"ms",defaultValue:1e3}),this.registerParameter(this.decayParameter),this.sustainParameter=new he.a("Sustain",this.envelope,function(e,t){e&&(e.sustain=t)},{min:0,max:1,unit:"",defaultValue:.9}),this.registerParameter(this.sustainParameter),this.releaseParameter=new he.a("Release",this.envelope,function(e,t){e&&(e.release=(t+1e-6)/1e3)},{min:0,max:1e4,unit:"ms",defaultValue:150}),this.registerParameter(this.releaseParameter),this.attackCurveParameter=new he.a("Attack Curve",this.envelope,function(e,t){e&&(e.attackCurve=t)},{min:0,max:1e4,unit:"",defaultValue:"linear"}),this.registerParameter(this.attackCurveParameter),this.decayCurveParameter=new he.a("Decay Curve",this.envelope,function(e,t){e&&(e.decayCurve=t)},{min:0,max:1e4,unit:"",defaultValue:"linear"}),this.registerParameter(this.decayCurveParameter),this.releaseCurveParameter=new he.a("Release Curve",this.envelope,function(e,t){e&&(e.releaseCurve=t)},{min:0,max:1e4,unit:"",defaultValue:"linear"}),this.registerParameter(this.releaseCurveParameter)}},{key:"refresh",value:function(){}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"attackCurve",get:function(){return this.attackCurveParameter.get()},set:function(e){this.attackCurveParameter.set(e)}},{key:"decayCurve",get:function(){return this.decayCurveParameter.get()},set:function(e){this.decayCurveParameter.set(e)}},{key:"releaseCurve",get:function(){return this.releaseCurveParameter.get()},set:function(e){this.releaseCurveParameter.set(e)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(){var e={id:this.id,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackCurve:this.attackCurve,decayCurve:this.decayCurve,releaseCurve:this.releaseCurve};return e=Object(ue.b)(e,"attackParameter",this.attackParameter),e=Object(ue.b)(e,"decayParameter",this.decayParameter),e=Object(ue.b)(e,"sustainParameter",this.sustainParameter),e=Object(ue.b)(e,"releaseParameter",this.releaseParameter),e=Object(ue.b)(e,"attackCurveParameter",this.attackCurveParameter),e=Object(ue.b)(e,"decayCurveParameter",this.decayCurveParameter),e=Object(ue.b)(e,"releaseCurveParameter",this.releaseCurveParameter)}},{key:"fromJson",value:function(e){this.disconnectAllModulators();var t={};e.id&&(this.id=e.id),Object(Oe.a)(this.attackParameter,e.attack,t),Object(Oe.a)(this.decayParameter,e.decay,t),Object(Oe.a)(this.sustainParameter,e.sustain,t),Object(Oe.a)(this.releaseParameter,e.release,t),e.attackCurve&&Object(Oe.a)(this.attackCurveParameter,e.attackCurve,t),e.decayCurve&&Object(Oe.a)(this.decayCurveParameter,e.decayCurve,t),e.releaseCurve&&Object(Oe.a)(this.releaseCurveParameter,e.releaseCurve,t),t=Object(d.a)({},t,Object(ue.a)(e,"attackParameter",this.attackParameter,this.sequencerEngine,!1,!0),Object(ue.a)(e,"decayParameter",this.decayParameter,this.sequencerEngine,!1,!0),Object(ue.a)(e,"sustainParameter",this.sustainParameter,this.sequencerEngine,!1,!0),Object(ue.a)(e,"releaseParameter",this.releaseParameter,this.sequencerEngine,!1,!0),Object(ue.a)(e,"attackCurveParameter",this.attackCurveParameter,this.sequencerEngine,!1,!0),Object(ue.a)(e,"decayCurveParameter",this.decayCurveParameter,this.sequencerEngine,!1,!0),Object(ue.a)(e,"releaseCurveParameter",this.releaseCurveParameter,this.sequencerEngine,!1,!0))}},{key:"getScaleFromChain",value:function(e){return e[0]}},{key:"getDepthFromChain",value:function(e){return e[1]}},{key:"mate",value:function(e,t){this.mateParameter(this.attackParameter,e.attackParameter,t),this.mateParameter(this.decayParameter,e.decayParameter,t),this.mateParameter(this.sustainParameter,e.sustainParameter,t),this.mateParameter(this.releaseParameter,e.releaseParameter,t)}},{key:"mateParameter",value:function(e,t,n){Object(se.b)(this.sequencerEngine,e,t,n)}}]),n}(Kn.a),$n=function(){function e(t,n,r,a){Object(o.a)(this,e),this.store=t.store,this.sequencerEngine=t,this.number=a,this.envelope=new Yn(t,n,(new X.a).forEnvelopeTrack(this,r),a)}return Object(s.a)(e,[{key:"name",get:function(){return"Envelope "+this.number}},{key:"getJson",value:function(){return this.envelope.getJson()}}]),e}();var Xn=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.subSequence=n,this.store=t.store,this.envelopes=function(e,t){var n=[];return n.push(new $n(e,e.mixSession,t,1)),n.push(new $n(e,e.mixSession,t,2)),n.push(new $n(e,e.mixSession,t,3)),n.push(new $n(e,e.mixSession,t,4)),n}(t,this),this.currentPattern=0}return Object(s.a)(e,[{key:"switchToPattern",value:function(e,t){return this.currentPattern=t,this.updateRedux(e,t)}},{key:"updateRedux",value:function(e,t){var n=this.getAllPatternLockedParameters(e,t),r=[];for(var a in n){var i=n[a].updateRedux(!0);void 0!==i&&(r[i.id]=i.value)}return r}},{key:"deletePattern",value:function(e){this.store.dispatch(Object(J.Db)(this.subSequence.id,Object(Un.a)(e,this.patternLocks)))}},{key:"patternLocks",get:function(){var e=this.store.getState().tracks.envelopePatternLocks[this.subSequence.id]||{};return Object(d.a)({},e)}},{key:"movePatternTo",value:function(e,t){this.store.dispatch(Object(J.Db)(this.subSequence.id,Object(Un.b)(e,t,this.patternLocks)))}},{key:"getAllPatternLockedParameters",value:function(e,t){var n=[];return this.envelopes.forEach(function(r){return r.envelope.parameters.filter(function(n){return n.hasPatternLockedValues(e,t)}).forEach(function(e){return n.push(e)})}),n}},{key:"newPattern",value:function(e){var t=this,n=e-1;this.getAllPatternLockedParameters().forEach(function(e){return e.newPattern(t.currentPattern,n)});var r=this.patternLocks;r[n]=this.patternLocked,this.store.dispatch(Object(J.Db)(this.subSequence.id,r))}},{key:"patternLocked",get:function(){return this.patternLocks[this.currentPattern]||!1},set:function(e){var t=this.patternLocks;t[this.currentPattern]=e,this.store.dispatch(Object(J.Db)(this.subSequence.id,t)),this.updateRedux()}},{key:"togglePatternLocked",value:function(){this.patternLocked=!this.patternLocked}}]),e}();function er(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function tr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var nr=function(e){Object(u.a)(n,e);var t=tr(n);function n(e,r,a,i,s,u){var l,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return Object(o.a)(this,n),(l=t.call(this,e,r,a,i,s,u,!1)).initModulators(),f&&l.setInstrument(new Vn(r,a,(new X.a).forTrack(Object(c.a)(l)),Object(c.a)(l))),l}return Object(s.a)(n,[{key:"getInstrumentType",value:function(){return te.f}},{key:"createNewInstrument",value:function(){this.instrument=void 0,this.setInstrument(new Vn(this.sequencerEngine,this.mixSession,(new X.a).forTrack(this),this))}},{key:"getAllParameters",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Object(fe.a)(Object(f.a)(n.prototype),"getAllParameters",this).call(this,e);return[].concat(Object(h.a)(t),Object(h.a)(this.lfosTrack.lfos.flatMap(function(e){return e.lfo.parameters})),Object(h.a)(this.envelopesTrack.envelopes.flatMap(function(e){return e.envelope.parameters})))}},{key:"getCopy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine,r=arguments.length>2?arguments[2]:void 0;return Object(fe.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,o){return new n(e,t,r,a,i,o,!1)},t,r)}}]),n}(function(e){Object(u.a)(n,e);var t=er(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"initModulators",value:function(){this.lfosTrack=new Gn(this.sequencerEngine,this.subSequence,(new X.a).forTrack(this)),this.envelopesTrack=new Xn(this.sequencerEngine,this.subSequence)}},{key:"hasModulators",get:function(){return!0}}]),n}(jt)),rr=n(127),ar=function(){function e(t,n){if(Object(o.a)(this,e),this.track=t,this.instrumentRack=n,this.track.instrumentRack=this.instrumentRack,this.sequencerEngine=t.sequencerEngine,this.store=this.sequencerEngine.store,this.parameters=[],this.volumeParameter=new le.c("volume",this.track.volumeNode.volume,{min:0,max:1,unit:"db",defaultValue:0}),this.registerParameter(this.volumeParameter),this.track.effectsChains[0].parameterContext=(new X.a).forTrack(n),this.track.instrument){var r=this.track.instrument.parameters;for(var a in r)r[a].setContext(r[a].context.forSubDevice(r[a].track).forTrack(n))}this.track.instrumentRack=n}return Object(s.a)(e,[{key:"dispose",value:function(){this.track.dispose(void 0,this.instrumentRack.isFrozen)}},{key:"effectsChains",get:function(){return this.track.effectsChains}},{key:"presetName",get:function(){return this.track.presetName}},{key:"getName",value:function(){return this.track.getName()}},{key:"trackNumber",get:function(){return this.track.trackNumber}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setContext((new X.a).forTrack(this.instrumentRack)),this.parameters.push(e)}},{key:"getJson",value:function(e){var t={track:this.track.getJson(e),effectsChains:this.track.effectsChains.map(function(e){return e.getJson()}),midiEffects:this.track.midiEffects.getJson(),volume:this.volumeParameter.get(),sendVolumes:this.track.getSendNodes().map(function(e){return e.volume.value})};return t=Object(ue.b)(t,"volumeParameter",this.volumeParameter)}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.track.fromJson(t.track,!1);case 2:if(this.track.effectsChains[0].clear(),this.track.effectsChains[0].fromJson(t.effectsChains[0],this.sequencerEngine.tracks,n),this.track.midiEffects.fromJson(t.midiEffects),this.volumeParameter.set(t.volume),t.sendVolumes)for(r=this.track.getSendNodes(),i=0;i<Math.min(t.sendVolumes.length,r.length);i++)r[i].volume.value=t.sendVolumes[i];Object(ue.a)(t,"volumeParameter",this.volumeParameter,this.sequencerEngine);case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCopy",value:function(){var t=Object(i.a)(a.a.mark(function t(){var n,r,i;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.track.getCopy();case 2:return n=t.sent,r=new e(n,this.instrumentRack),i=this.getJson(),t.next=7,r.fromJson(i);case 7:return t.abrupt("return",r);case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"getAllParameters",value:function(){return[].concat(Object(h.a)(this.parameters),Object(h.a)(this.track.getAllParameters()))}}]),e}();function ir(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return or(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return or(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function or(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function sr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var cr=rr.a.presets,ur=function(e){Object(u.a)(n,e);var t=sr(n);function n(e,r,a,i,s,u){var l;!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return Object(o.a)(this,n),(l=t.call(this,e,r,a,i,s,u)).setupEffects(),l.tracks=[],l.name="Instrument Rack",l.preset=new dt.a,l.preset.track=Object(c.a)(l),l}return Object(s.a)(n,[{key:"addPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.title,e.next=3,cr.getPresetData(t);case 3:return r=e.sent,e.next=6,this.sequencerEngine.loadTrackPreset(r,void 0,!0,!1,n,void 0,t);case 6:return(i=e.sent).presetName=n,o=new ar(i,this),setTimeout(function(){i.loadLostParameters()},[750]),e.abrupt("return",this.addInstrument(o));case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addSample",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.addInstrumentType(te.h)).track.sample=t,e.next=4,r.track.instrument.newSample(0,t,n);case 4:return n&&(r.track.samplesStream=n,r.track.samplesStream.initBuffers()),r.track.presetName=t.name,e.abrupt("return",r);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSubDevices",value:function(){return this.tracks.map(function(e){return{value:e,label:e.presetName||e.getName()}})}},{key:"getSubDeviceIndex",value:function(e){return this.tracks.indexOf(e)}},{key:"getSubDevice",value:function(e){return this.tracks[e]}},{key:"getSamplesStream",value:function(){var e=this.getSelectedTrack();if(e)return e.track.samplesStream}},{key:"getSelectedTrack",value:function(){return this.sequencerEngine.state.tracks.selectedRackSubTrack[this.id]}},{key:"loadTrackInfo",value:function(e,t){var n=this.getSelectedTrack();n?(n.track.loadTrackInfo(e,t),this.tracks=Object(h.a)(this.tracks)):(this.addSample(t),this.tracks=Object(h.a)(this.tracks)),this.updateSteps()}},{key:"addInstrumentType",value:function(e){var t=ia(this.sequencerEngine,"INSTRUMENT",e);t.setSends(this.sequencerEngine.sends),t.effectsChains[0].clear();var n=new ar(t,this);return this.addInstrument(n)}},{key:"getName",value:function(){return"Instrument Rack"}},{key:"getTrackType",value:function(){return W.c}},{key:"getInstrumentType",value:function(){return W.c}},{key:"instrument",get:function(){return this}},{key:"inputNode",get:function(){return this.gainNode}},{key:"addInstrument",value:function(e){var t=e.track;return t.trackNumber=this.tracks.length,this.tracks=[].concat(Object(h.a)(this.tracks),[e]),t.muteableNode.connect(this.gainNode),t.group=this,e}},{key:"deleteInstrument",value:function(e){var t=this.tracks.indexOf(e);-1!==t&&(this.tracks.splice(t,1),e.track.dispose())}},{key:"dispose",value:function(){this.tracks.forEach(function(e){return e.dispose()}),this.tracks=void 0,Object(fe.a)(Object(f.a)(n.prototype),"dispose",this).call(this,!1)}},{key:"liveTrigger",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isFrozen||this.tracks.forEach(function(t){return t.track.midiEffects.liveInputTrigger(e)})}},{key:"releaseAll",value:function(e){this.isFrozen||this.tracks.forEach(function(t){return t.track.releaseAll(e)})}},{key:"liveTriggerRelease",value:function(e,t){this.isFrozen||this.tracks.forEach(function(n){return n.track.midiEffects.liveInputRelease(e,t)})}},{key:"trigger",value:function(e,t,r){this.isFrozen?Object(fe.a)(Object(f.a)(n.prototype),"trigger",this).call(this,e,t,r):(this.tracks.forEach(function(n){n.track.midiEffects.input(e,t,r)}),this.onStepEnded(t,r))}},{key:"triggerSamples",value:function(e,t){this.isFrozen||this.tracks.forEach(function(n){return n.track.triggerSamples(e,t)})}},{key:"triggerSlice",value:function(e){this.isFrozen||this.tracks.forEach(function(t){return t.track.triggerSlice(e)})}},{key:"triggerSample",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.isFrozen||this.tracks.forEach(function(r){return r.track.triggerSample(e,t,n)})}},{key:"triggerRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isFrozen||this.tracks.forEach(function(n){return n.track.triggerRelease(e,t)})}},{key:"getJson",value:function(e){var t=Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e);return t.tracks=this.tracks.map(function(t){return t.getJson(e)}),t}},{key:"onBPMUpdated",value:function(){for(var e in this.effectsChains.forEach(function(e){return e.onBPMUpdated()}),this.tracks)for(var t in this.tracks[e].effectsChains)this.tracks[e].effectsChains[t].onBPMUpdated()}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var r,i,o,s,c,u,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._loaded){e.next=2;break}return e.abrupt("return",{});case 2:Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,t),this.store.dispatch(Object(J.we)(this.subSequence.id,this.trackNumber,!0)),r={},e.t0=a.a.keys(t.tracks);case 6:if((e.t1=e.t0()).done){e.next=22;break}return i=e.t1.value,o=t.tracks[i].track,s=o.type,c=o.instrumentType,(u=ia(this.sequencerEngine,s,c)).setSends(this.sequencerEngine.sends),l=new ar(u,this),e.t2=d.a,e.t3={},e.t4=r,e.next=17,l.fromJson(t.tracks[i],!1);case 17:e.t5=e.sent,r=(0,e.t2)(e.t3,e.t4,e.t5),this.addInstrument(l),e.next=6;break;case 22:return this.store.dispatch(Object(J.we)(this.subSequence.id,this.trackNumber,!1)),this._loaded=!0,e.abrupt("return",r);case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onNewStep",value:function(e){this.isFrozen?Object(fe.a)(Object(f.a)(n.prototype),"onNewStep",this).call(this):(Object(fe.a)(Object(f.a)(n.prototype),"onNewStep",this).call(this),this.tracks.forEach(function(t){return t.track.onNewStep(e)}))}},{key:"onStepEnded",value:function(e,t){var r=this;if(this.isFrozen)Object(fe.a)(Object(f.a)(n.prototype),"onNewStep",this).call(this);else{var a=function(n){var a=r.tracks[n].track;a.midiEffects.output(e,t,t).forEach(function(e){return a.trigger(e.stepData,e.time,t)})};for(var i in this.tracks)a(i)}}},{key:"start",value:function(){Object(fe.a)(Object(f.a)(n.prototype),"start",this).call(this),this.isFrozen||this.tracks.forEach(function(e){return e.track.start()})}},{key:"solo",value:function(e){Object(fe.a)(Object(f.a)(n.prototype),"solo",this).call(this,e),this.tracks.forEach(function(t){return t.track.solo(e,void 0,!1)})}},{key:"getCopy",value:function(e,t){var r=this,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=Object(fe.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,o){return new n(e,t,r,a,i,o)},t,a),o=function(e){var n=r.tracks[e].track,o=n.getCopy(void 0,t,a),s=new ar(o,i);o.effectsChains[0].dispose(),o.effectsChains=n.effectsChains.map(function(e){return e.getCopy(o,t,a)}),o.effectsChains[0].updateEffects(),s.volumeParameter.copyFrom(r.tracks[e].volumeParameter),i.addInstrument(s)};for(var s in this.tracks)o(s);return i}},{key:"getAllParameters",value:function(){var e=Object(fe.a)(Object(f.a)(n.prototype),"getAllParameters",this).call(this);if(this.isFrozen)return e;for(var t in this.tracks)e=[].concat(Object(h.a)(e),Object(h.a)(this.tracks[t].getAllParameters()));return e}},{key:"makePublicIfNeeded",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=a.a.keys(this.tracks);case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,this.tracks[t].track.makePublicIfNeeded();case 5:e.next=1;break;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"unfreezeInstrument",value:function(){var e,t=0,n=ir((arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.frozenJson).trackParameters.tracks);try{for(n.s();!(e=n.n()).done;){var r=e.value;this.tracks[t].track.createNewInstrument(),this.tracks[t].track.instrument.fromJson(r.track.instrument),t++}}catch(a){n.e(a)}finally{n.f()}}}]),n}(ht);function lr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var fr=function(e){Object(u.a)(n,e);var t=lr(n);function n(e,r,a,i,s){var u;return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,!0)).parameters=[],u.onParameter=new he.a("on",Object(c.a)(u),function(e,t){return[]},{min:!1,max:!0,unit:"",defaultValue:!1}),u.registerParameter(u.onParameter),u.loopParameter=new he.a("loop",Object(c.a)(u),function(e,t){return[]},{min:!1,max:!0,unit:"",defaultValue:!1}),u.registerParameter(u.loopParameter),u.loadFromJson(s),u.startTime=void 0,u.endTime=void 0,u.samplesStream=new De.a(r,e.sequencerEngine),u.isSimple=!0,u}return Object(s.a)(n,[{key:"gainNode",get:function(){return this.sampler.output}},{key:"auditionSound",value:function(e){this.sample=e,this.audioBuffer=e.audioBuffer,this.baseBuffer=new re.a.Buffer(e.audioBuffer),this.sampler._buffers._buffers[48]=this.baseBuffer,this.slice(0,0,this.getDuration()),this.registerParameter(this.volumeParameter)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.samplerData,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sliceData,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(fe.a)(Object(f.a)(n.prototype),"init",this).call(this,e,t,r),this.sampler=new re.a.Sampler({C3:this.baseBuffer},{curve:"linear"}),this.reversedBuffer=new re.a.Buffer,1===this.baseBuffer.numberOfChannels?this.reversedBuffer.fromArray(this.baseBuffer.getChannelData(0)):this.reversedBuffer.fromArray([this.baseBuffer.getChannelData(0),this.baseBuffer.getChannelData(1)]),this.reversedBuffer.reverse=!0,this.reversedSampler=new re.a.Sampler({C3:this.reversedBuffer},{curve:"linear"}),this.volumeParameter=new le.c("volume",this.sampler.output.gain,{min:0,max:1,defaultValue:1}),this.registerParameter(this.volumeParameter),this}},{key:"dispose",value:function(){this.sample.dispose(),this.sampler.dispose(),this.baseBuffer.dispose(),this.reversedBuffer.dispose(),this.reversedSampler.dispose(),this.slices=[],this.detuneSignal.dispose(),this.pitchEnvelopes.forEach(function(e){return e.dispose()}),this.sample=void 0,this.sampler=void 0,this.baseBuffer=void 0,this.pitchEnvelopes=void 0,this.detuneSignal=void 0}},{key:"isDisposed",value:function(){return void 0===this.sampler}},{key:"getSlice",value:function(){var e=this;return{buffer:this.baseBuffer,startTime:this.startTime,endTime:this.endTime,getDuration:function(){return e.endTime-e.startTime}}}},{key:"get",value:function(){return this.sampler}},{key:"newSlice",value:function(e,t){return this.startTime=e,this.endTime=t,this.slices.push(new hr(this.baseBuffer,e,t)),this.sliceData.push({startTime:e,endTime:t}),this.slice(this.slices.length-1,e,t,!0),this.slices[this.slices.length-1]}},{key:"slice",value:function(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var r=this.slices[e];n=void 0==n?this.getDuration():n,r.startTime=t,r.endTime=n;this.alpha;this.sliceData[e]={startTime:t,endTime:n},this.startTime=t,this.endTime=n,this.updateSlicesState()}},{key:"loadFromJson",value:function(e){this.onParameter.set(void 0===e.on||e.on),Object(ue.a)(e,"onParameter",this.onParameter),this.loop=e.loop||!1,Object(ue.a)(e,"loopParameter",this.loopParameter),this.detune=e.detune||0,Object(ue.a)(e,"detuneParameter",this.detuneParameter)}},{key:"detune",get:function(){return this.detuneParameter.get()},set:function(e){this.detuneParameter.set(e)}},{key:"on",get:function(){return this.onParameter.get()},set:function(e){this.onParameter.set(e)}},{key:"loop",get:function(){return this.loopParameter.get()},set:function(e){this.loopParameter.set(e)}},{key:"getJson",value:function(){var e=Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{on:this.onParameter.get(),loop:this.loop,detune:this.detune});return e=Object(ue.b)(e,"onParameter",this.onParameter),e=Object(ue.b)(e,"loopParameter",this.loopParameter),e=Object(ue.b)(e,"detuneParameter",this.detuneParameter)}},{key:"triggerAttack",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r,i,o,s,c){var u,l,h,d,p,v,m,y=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=y.length>6&&void 0!==y[6]&&y[6],t=this.getNoteFromTranspose(t),l=u?this.reversedSampler:this.get(0),h=o.start,h=this.convertToStartTime(0,h),h+=this.startTime,l.loop=this.loop,d=this.getLoopPoints(o),p=d.loopStart,v=d.loopEnd,h=p,l.loopStart=p,l.loopEnd=v,m=[],s&&m.push(s),this.triggerWaveformAnimation(r,void 0,0,0,h),e.next=16,Object(fe.a)(Object(f.a)(n.prototype),"triggerAttack",this).call(this,l,t,r,i,m,h,c,u);case 16:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,o){return e.apply(this,arguments)}}()},{key:"triggerAttackRelease",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r,i,o,s,c,u){var l,h,d,p,v,m,y,b,g=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=g.length>7&&void 0!==g[7]?g[7]:0,h=g.length>8&&void 0!==g[8]&&g[8],t=this.getNoteFromTranspose(t),d=s.start,d=this.convertToStartTime(0,d),d+=this.startTime,(p=h?this.reversedSampler:this.get(0)).loop=this.loop,v=this.getLoopPoints(s),m=v.loopStart,y=v.loopEnd,d=m,d+=this.convertToStartTime(0,l),p.loopStart=m,p.loopEnd=y,this.triggerWaveformAnimation(i,r,0,0,d),b=[],c&&b.push(c),e.next=18,Object(fe.a)(Object(f.a)(n.prototype),"triggerAttackRelease",this).call(this,p,t,r,i,o,b,d,u,h);case 18:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,o,s){return e.apply(this,arguments)}}()},{key:"triggerRelease",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.triggerReleaseWaveformAnimation(),e=e.map(function(e){return t.getNoteFromTranspose(e)}),(n?this.reversedSampler:this.get(0)).triggerRelease(e,re.a.Master.context.currentTime)}},{key:"getLoopPoints",value:function(e){var t=e.loopStart,n=e.loopLength,r=(t=this.startTime+this.getDuration()*(t/100))+this.getDuration()*(n/100);return{loopStart:t,loopEnd:Math.min(r,this.endTime)}}},{key:"setLoopPoints",value:function(e){var t=this.getLoopPoints(e),n=t.loopStart,r=t.loopEnd;for(var a in this.sampler._activeSources){this.sampler._activeSources[a].forEach(function(e){e.loopStart=n,e.loopEnd=r})}}}]),n}(Ke.a),hr=function(){function e(t,n,r){Object(o.a)(this,e),this.buffer=t,this.originalBuffer=t,this.startTime=n,this.endTime=r}return Object(s.a)(e,[{key:"getCopy",value:function(){return new e(this.buffer,this.startTime,this.endTime)}},{key:"getJson",value:function(){return{buffer:this.buffer,startTime:this.startTime,endTime:this.endTime}}},{key:"dispose",value:function(){}}]),e}(),dr=fr;var pr=function(){function e(t){Object(o.a)(this,e),this.input=this.output=new re.a.Gain(1)}return Object(s.a)(e,[{key:"loop",set:function(e){e&&void 0===this.lfo?(this.lfo=new re.a.LFO({type:"triangle",phase:90,min:.7,max:1}),this.lfo.connect(this.input.gain)):e||void 0===this.lfo||(this.lfo.dispose(),this.lfo=void 0)}},{key:"smooth",set:function(e){this.lfo&&(this.lfo.min=e)}},{key:"restart",value:function(e){this.lfo&&(this.lfo.stop(e),this.lfo.start(e))}},{key:"onTick",value:function(e){}},{key:"trigger",value:function(e,t,n){var r=t.loopLengthSeconds;if(void 0!==this.lfo&&!(r<=0)){var a=re.a.Frequency(r,"s").transpose(n);isNaN(a)||void 0===a||(this.lfo.frequency.value=a),this.restart(e)}}}]),e}(),vr=3,mr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;arguments.length>1&&arguments[1];Object(o.a)(this,e),this.outputNode=new re.a.Gain(1),this.voiceNumber=t,this.ampEnvelope=new re.a.AmplitudeEnvelope(10,10,1,100),this.ampLFO=new pr,this.ampEnvelope.connect(this.ampLFO.input),this.ampLFO.output.connect(this.outputNode),this.crossFade=new re.a.CrossFade(0),this.crossFade.connect(this.ampEnvelope),this.ampEnvelope.releaseCurve="linear",this.ampEnvelope.attackCurve="linear",this.ampEnvelope.decayCurve="linear",this.samplerToTriggers={},this.samplerToTransposes={},this.idToSampler={},this.samplerLimit=vr}return Object(s.a)(e,[{key:"clear",value:function(e){this.samplerToTriggers={},this.idToSampler={}}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"dispose",value:function(){this.outputNode.dispose(),this.ampEnvelope.dispose(),this.outputNode=void 0,this.ampEnvelope=void 0,this.samplerToTriggers=void 0}},{key:"useSampler",value:function(e,t,n,r){t||(t=re.a.Master.context.currentTime),void 0!==this.samplerToTriggers[e.id]&&void 0!==this.samplerToTriggers[e.id][n]&&0!==this.samplerToTriggers[e.id][n]||(this.samplerToTriggers[e.id]={},this.samplerToTriggers[e.id][n]=0),this.samplerToTriggers[e.id][n]++,this.idToSampler[e.id]=e,this.ampLFO.trigger(t,r,n+e.transpose),this.tooManyTriggers()>0&&this.releaseOldestTrigger(e,0,t)}},{key:"onVoiceRelease",value:function(e,t){this.samplerToTriggers[e.id]&&delete this.samplerToTriggers[e.id][t]}},{key:"disconnectSampler",value:function(e,t){return void 0===this.samplerToTriggers[e.id]||void 0===this.samplerToTriggers[e.id][t]||0===this.samplerToTriggers[e.id][t]&&(delete this.samplerToTriggers[e.id][t],!0)}},{key:"isUsed",value:function(){return Object.keys(this.samplerToTriggers).length>0}},{key:"isUsingSampler",value:function(e){return void 0!==this.samplerToTriggers[e.id]&&Object.keys(this.samplerToTriggers[e.id]).length>0}},{key:"totalTriggers",get:function(){var e=0;for(var t in this.samplerToTriggers){var n=this.samplerToTriggers[t];for(var r in n)e+=n[r]}return e}},{key:"tooManyTriggers",value:function(){return this.totalTriggers-vr}},{key:"getFromMap",value:function(e,t){return Object.keys(e).filter(function(t){return e[t]&&e[t].length>0})[t]}},{key:"releaseOldestTrigger",value:function(e,t,n){for(var r in void 0===n?n=re.a.Master.context.currentTime:(n-=.005)<0&&(n=0),this.idToSampler){this.idToSampler[r];var a=this.idToSampler[r].sampler,i=this.getFromMap(a._activeSources,t);if(void 0!==i){new re.a.Midi(i).toFrequency();return void a.triggerRelease(new re.a.Midi(i).toFrequency(),n,.1)}}var o=e.sampler,s=this.getFromMap(o._activeSources,t);o.triggerRelease(new re.a.Midi(s).toFrequency(),n,.1)}}]),e}(),yr=function(){function e(t,n,r){Object(o.a)(this,e),this.sampledInstrument=r,this.voices=[],this.outputNode=new re.a.Gain(1);for(var a=0;a<t;a++){var i=new mr(a,r);i.connect(this.outputNode),this.voices.push(i)}this.unusedVoices=Object(h.a)(this.voices),this.outputNode.connect(n),this.numVoices=t,this.samplersUsed=new Set}return Object(s.a)(e,[{key:"getVoices",value:function(){return 1===this.numVoices?[this.voices[0]]:this.voices}},{key:"clear",value:function(){this.voices.forEach(function(e){return e.clear()}),this.samplersUsed=new Set}},{key:"dispose",value:function(){this.voices.forEach(function(e){return e.dispose()}),this.outputNode.dispose(),this.voices=void 0,this.outputNode=void 0}},{key:"ampEnvelopes",get:function(){return this.voices.map(function(e){return e.ampEnvelope})}},{key:"getUnusedVoiceIfAny",value:function(e){return 1===this.numVoices?this.voices[0]:0===this.unusedVoices.length?this.voices[Math.floor(Math.random()*this.numVoices)]:this.unusedVoices.shift()}},{key:"getVoiceUsingSampler",value:function(e,t){return this.voices.find(function(n){return n.samplerToTriggers[e.id]&&n.samplerToTriggers[e.id][t]})}},{key:"useSamplerWithVoice",value:function(e,t,n,r,a){t.useSampler(e,n,r,a),this.samplersUsed.add(e)}},{key:"disconnectSamplerFromVoice",value:function(e,t,n){t.disconnectSampler(e,n)&&(t.isUsed()||(this.unusedVoices.push(t),this.samplersUsed.delete(e)))}},{key:"triggerAttack",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i,o,s){var c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=this.getUnusedVoiceIfAny(t),this.useSamplerWithVoice(t,c,r,n,o),c.ampEnvelope.triggerAttack(r,i),u=[t.triggerAttack(n,r,i,o,s,c.crossFade.input[0],!1)],this.sampledInstrument.crossFadeParameter.get()>0&&u.push(t.triggerAttack(n,r,i,o,s,c.crossFade.input[1],!0)),e.next=7,Promise.all(u);case 7:t.loop||this.disconnectSamplerFromVoice(t,c,n);case 8:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,o){return e.apply(this,arguments)}}()},{key:"triggerAttackRelease",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i,o,s,c,u){var l,f;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=this.getUnusedVoiceIfAny(t),this.useSamplerWithVoice(t,l,i,n,s),l.ampEnvelope.triggerAttackRelease(r,i,o,s),f=[t.triggerAttackRelease(n,r,i,o,s,c,l.crossFade.input[0],u,!1)],this.sampledInstrument.crossFadeParameter.get()>0&&f.push(t.triggerAttackRelease(n,r,i,o,s,c,l.crossFade.input[1],u,!0)),e.next=7,Promise.all(f);case 7:l.onVoiceRelease(t,n),this.disconnectSamplerFromVoice(t,l,n);case 9:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,o,s,c){return e.apply(this,arguments)}}()},{key:"triggerRelease",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.triggerRelease(n,!1),this.sampledInstrument.crossFadeParameter.get()>0&&t.triggerRelease(n,!0),void 0!==(r=this.getVoiceUsingSampler(t,n[0]))){e.next=5;break}return e.abrupt("return");case 5:r.totalTriggers<=1&&r.ampEnvelope.triggerRelease(re.a.Master.context.currentTime),r.onVoiceRelease(t,n[0]);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"setCrossFade",value:function(e){this.voices.forEach(function(t){return e.connect(t.crossFade.fade)})}}]),e}(),br=n(544),gr=(n(585),n(369)),Or=function(){function e(){Object(o.a)(this,e),this.isRecording=!1}return Object(s.a)(e,[{key:"input",set:function(e){if(void 0===e)return this.recorder.clear(),this.recorder.stop(),this.recorder=void 0,void(this.isRecording=!1);this.recorder=new window.Recorder(e,{numChannels:2,bufferLen:1024}),this.recorder.record((new Date).getTime()),this.startRecordLoop()}},{key:"startRecordLoop",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("start record loop");case 1:if(void 0===this.recorder){e.next=7;break}return e.next=4,this.sleep(1e4);case 4:this.isRecording||(console.log("clearing"),this.recorder.clear()),e.next=1;break;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){n()},e);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"start",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.recorder.clear(),this.isRecording=!0}},{key:"stop",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.sleep(t);case 2:e.recorder.getBuffer(function(t){var n=e.getSample(t);e.recorder.clear(),e.isRecording=!1,r(n)});case 3:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getSample",value:function(e){var t=e[0].length,n=re.a.Master.context.createBuffer(2,t,re.a.Master.context.sampleRate);n.copyToChannel(e[0],0,0),n.copyToChannel(e[1],1,0);var r=new H.a;return r.audioBuffer=n,r}}]),e}(),jr=1,kr=2,wr="MIX",xr="ALTERNATE",Sr="ROUND_ROBIN";var Pr=.025,Er=800;function Tr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Pr,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Er,a=e.getChannelData(0),i=window.api.create_buffer(a.length);window.Module.HEAPF32.set(a,i>>2),window.api.findLoop(i,a.length,t,n,r);var o=window.api.get_result_pointer(),s=new Uint16Array(window.Module.HEAP16.buffer,o,2);if(console.log("resultView = ",s),0!=s[0]||0!=s[1]){var c={start:s[0],end:s[1],difference:1};return window.api.destroy_buffer(i),c}}function Ar(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Mr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mr(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Mr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Rr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Cr=8,Nr=function(e){Object(u.a)(n,e);var t=Rr(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this)).cache={},s.sequencerEngine=e,s.store=e.store,s.mixSession=r,s.context=a,s.track=i,s.solutionNumber=0,s.outputNode=new re.a.Gain(1),s.voices=new yr(Cr,s.outputNode,Object(c.a)(s)),s.resampler=new Or,s.samplers={},s.interpolationModeParameter=new he.a("interpolationMode",Object(c.a)(s),function(e,t){return[]},{min:jr,max:kr,unit:"",defaultValue:kr,automatable:!1}),s.registerParameter(s.interpolationModeParameter),s.mixModeParameter=new pn.a("mixMode",Object(c.a)(s),function(e,t){return[]},{min:0,prettyName:"Mix Mode",options:{0:Sr,.5:wr,1:xr},max:1,unit:"",defaultValue:Sr,uxAutomatable:!1}),s.registerParameter(s.mixModeParameter),s.monophonicParameter=new he.a("monophonic",Object(c.a)(s),function(e,t){s.voices.numVoices=t?1:Cr},{min:!1,max:!0,unit:"",defaultValue:!1,automatable:!1}),s.registerParameter(s.monophonicParameter),s.crossFadeSignal=new re.a.Signal(0),s.crossFadeParameter=new le.c("crossFade",s.crossFadeSignal,{min:0,max:1,defaultValue:0,automationRate:ce.a}),s.registerParameter(s.crossFadeParameter),s.detuneSignal=new re.a.Signal(1e3),s.detuneParameter=new le.c("detune",s.detuneSignal,{min:-1e4,max:1e4,defaultValue:0,automationRate:ce.a}),s.registerParameter(s.detuneParameter),s.setupLoopParameters(),s.setupAmpEnvelopeParameters(),s.smoothParameter=new he.a("smooth",Object(c.a)(s),function(e,t){var n=1-t;s.voices.voices.forEach(function(e){return e.ampLFO.smooth=n})},{min:0,max:1,unit:"",defaultValue:!1,uxAutomatable:!1}),s.registerParameter(s.smoothParameter),s.glideParameter=new he.a("glide",Object(c.a)(s),function(e,t){return[]},{min:0,max:1e3,unit:"",defaultValue:0}),s.registerParameter(s.glideParameter),s.lastTranspose=void 0,s.triggerCounters={},s.loaded=!0,s.getParameters().forEach(function(e){return e.isLoaded=!0}),s.voices.setCrossFade(s.crossFadeSignal),s.glideTransposes={},s.setupSlide(),s}return Object(s.a)(n,[{key:"allSamplers",get:function(){var e=[];for(var t in this.samplers)e=[].concat(Object(h.a)(e),Object(h.a)(this.samplers[t]));return e}},{key:"onAttackChanged",value:function(e){for(var t in this.ampEnvelopes)this.ampEnvelopes[t].attack=e/1e3}},{key:"onDecayChanged",value:function(e){for(var t in this.ampEnvelopes)this.ampEnvelopes[t].decay=e/1e3}},{key:"onSustainChanged",value:function(e){for(var t in this.ampEnvelopes)this.ampEnvelopes[t].sustain=Math.min(.99,e)}},{key:"onReleaseChanged",value:function(e){for(var t in this.ampEnvelopes)this.ampEnvelopes[t].release=e/1e3}},{key:"loop",get:function(){return this.allSamplers.every(function(e){return e.loop})},set:function(e){this.allSamplers.forEach(function(t){return t.loop=e})}},{key:"ampEnvelopes",get:function(){return this.voices.ampEnvelopes}},{key:"setupAmpEnvelopeParameters",value:function(){var e=this;this.ampAttackParameter=new he.a("Attack",this,function(t,n){e.onAttackChanged(n)},{min:0,max:5e3,unit:"",defaultValue:10}),this.registerParameter(this.ampAttackParameter),this.ampDecayParameter=new he.a("Decay",this,function(t,n){for(var r in e.ampEnvelopes)e.ampEnvelopes[r].decay=n/1e3},{min:0,max:5e3,unit:"",defaultValue:10}),this.registerParameter(this.ampDecayParameter),this.ampSustainParameter=new he.a("Sustain",this,function(t,n){e.onSustainChanged(n)},{min:0,max:1,unit:"",defaultValue:.8}),this.registerParameter(this.ampSustainParameter),this.ampReleaseParameter=new he.a("Release",this,function(t,n){e.onReleaseChanged(n)},{min:0,max:5e3,unit:"",defaultValue:10}),this.registerParameter(this.ampReleaseParameter),this.attackParameter=this.ampAttackParameter,this.decayParameter=this.ampDecayParameter,this.sustainParameter=this.ampSustainParameter,this.releaseParameter=this.ampReleaseParameter}},{key:"setupLoopParameters",value:function(){var e=this;this.loopParameter=new he.a("loop",this,function(t,n){e.loop=n},{min:!1,max:!0,unit:"",defaultValue:!1}),this.registerParameter(this.loopParameter),this.loopStartParameter=new he.a("loopStart",this,function(t,n){Array.from(e.voices.samplersUsed).forEach(function(t){return t.setLoopPoints({loopStart:n,loopLength:e.loopLength})})},{min:0,max:100,unit:"",defaultValue:0}),this.registerParameter(this.loopStartParameter),this.loopLengthParameter=new he.a("loopLength",this,function(t,n){Array.from(e.voices.samplersUsed).forEach(function(t){return t.setLoopPoints({loopStart:e.loopStart,loopLength:n})})},{min:0,max:100,unit:"",defaultValue:100}),this.registerParameter(this.loopLengthParameter)}},{key:"loopStart",get:function(){return this.loopStartParameter.getAtStep(this.currentStep)}},{key:"loopLength",get:function(){return this.loopLengthParameter.getAtStep(this.currentStep)}},{key:"onNewStep",value:function(e,t){var n=this;if(this.currentStep=e,this.oldMixMode!==this.mixMode&&(this.cache={}),this.oldMixMode=this.mixMode,this.onAttackChanged(this.ampAttack),this.onDecayChanged(this.ampDecay),this.onSustainChanged(this.ampSustain),this.onReleaseChanged(this.ampRelease),this.loop&&(this.loopStartParameter.isConnectedToAnyModulator()||this.loopLengthParameter.isConnectedToAnyModulator()||0!==this.loopStartParameter.automations.length||0!==this.loopLengthParameter.automations.length)){var r=1-this.smoothParameter.get();this.voices.voices.filter(function(e){return e.ampLFO.lfo}).forEach(function(e){return e.ampLFO.lfo.min=r});var a=this.loopStart,i=this.loopLength;re.a.Master.context.setTimeout(function(){Array.from(n.voices.samplersUsed).forEach(function(e){return e.setLoopPoints({loopStart:a,loopLength:i})})},1/re.a.Master.context.sampleRate)}}},{key:"glide",get:function(){return this.glideParameter.getAtStep(this.trackStep)},set:function(e){this.glideParameter.set(e)}},{key:"interpolationMode",get:function(){return this.interpolationModeParameter.getAtStep(this.trackStep)},set:function(e){this.interpolationModeParameter.set(e),this.cache={}}},{key:"monophonic",get:function(){return this.monophonicParameter.get()},set:function(e){this.monophonicParameter.set(e)}},{key:"mixMode",get:function(){return this.mixModeParameter.get()},set:function(e){this.mixModeParameter.set(e),this.cache={}}},{key:"trackStep",get:function(){return this.sequencerEngine.trackStep}},{key:"ampAttack",get:function(){return this.ampAttackParameter.getAtStep(this.currentStep)}},{key:"ampDecay",get:function(){return this.ampDecayParameter.getAtStep(this.currentStep)}},{key:"ampSustain",get:function(){return this.ampSustainParameter.getAtStep(this.currentStep)}},{key:"ampRelease",get:function(){return this.ampReleaseParameter.getAtStep(this.currentStep)}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(){this.outputNode.disconnect()}},{key:"connectToTrack",value:function(e){if(!e)return this.connectedTrack=void 0,void(this.resampler.input=void 0);this.connectedTrack=e,this.resampler.input=e.volumeNode}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return te.h}},{key:"getName",value:function(){return"Sampled Instrument"}},{key:"getPitchEnvelope",value:function(e){if(0!==this.glide){var t=100*(e-(void 0===this.lastTranspose?e:this.lastTranspose)),n=new re.a.ScaledEnvelope({attack:this.glide/1e3,decay:2,min:0,max:t,sustain:1,release:.001,curve:"linear"});return n._releaseCurve="linear",n._decayCurve="linear",n}}},{key:"triggerAttack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0,i=this.getSampler(e,!1),o=i.samplers,s=i.closest;if(void 0!==o){t||(t=new re.a.Time(re.a.Master.context.currentTime)),this.scaleByKey(t,e),this.setEnvelopes(a,e);var c=this.getPitchEnvelope(e);for(var u in this.monophonic&&this.releaseAll(t),o)o[u].sampler.attack=this.ampAttackParameter.getKeyScaledValue(e)/1e3,o[u].sampler.release=Math.max(4,this.ampReleaseParameter.getKeyScaledValue(e)/1e3),this.voices.triggerAttack(o[u],0!==this.glide&&void 0!==this.lastTranspose?this.lastTranspose-s:e-s,t,n,this.getLoopPoints(r,o[u]),c);this.glideTransposes[e]=this.lastTranspose,this.lastTranspose=parseFloat(e)}}},{key:"playSampler",value:function(e){this.voices.triggerAttack(e,0,0,1,0,void 0)}},{key:"triggerAttackRelease",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i,o,s){var c,u,l,f,h,d;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=this.getSampler(t,!0),u=c.samplers,l=c.closest,void 0!==u){e.next=3;break}return e.abrupt("return");case 3:for(h in this.scaleByKey(r,t),this.setEnvelopes(s,t),this.monophonic&&!s.slide&&this.releaseAll(r),f=this.getPitchEnvelope(t),u)(d=u[h]).sampler.release=this.ampReleaseParameter.getKeyScaledValue(t)/1e3,d.sampler.attack=this.ampAttackParameter.getKeyScaledValue(t)/1e3,this.voices.triggerAttackRelease(d,0!==this.glide&&void 0!==this.lastTranspose?this.lastTranspose-l:t-l,n,r,i,this.getLoopPoints(o,d),f,o);this.glideTransposes[t]=this.lastTranspose,this.lastTranspose=parseFloat(t);case 10:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,o){return e.apply(this,arguments)}}()},{key:"getLoopPoints",value:function(e,t){return{start:e,loopStart:this.loopStart,loopLength:this.loopLength,loopLengthSeconds:(t.endTime-t.startTime)*(this.loopLength/100)}}},{key:"triggerRelease",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o,s,c,u,l,f=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=f.length>0&&void 0!==f[0]?f[0]:[0],this.releaseParameter.set(this.releaseParameter.get(),!0,!0),e.t0=a.a.keys(t);case 3:if((e.t1=e.t0()).done){e.next=13;break}if(n=e.t1.value,r=t[n],i=this.getSampler(r,!0),o=i.samplers,s=i.closest,void 0!==o){e.next=9;break}return e.abrupt("continue",3);case 9:for(u in c=0!==this.glide&&this.glideTransposes[r]||r,o)l=o[u],o[u].sampler.release=this.ampRelease/1e3,this.voices.triggerRelease(l,[c-s]);e.next=3;break;case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"releaseAll",value:function(e){for(var t in this.voices.clear(),e||(this.clearSlide(),this.detuneSignal.value=this.detuneParameter.get(!0),this.lastTranspose=0),this.samplers){this.samplers[t].forEach(function(t){t.get(0).releaseAll(e||new re.a.Time(re.a.Master.context.currentTime),.01)})}}},{key:"newSample",value:function(e,t,n){var r=this;return new Promise(function(){var o=Object(i.a)(a.a.mark(function o(s,c){var u,l;return a.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if("string"===typeof t&&(t=new H.a(t)),t=t.getCopy(),r.track.samplesStream=n||new De.a(t,r.sequencerEngine),void 0!==t.audioBuffer){o.next=6;break}return o.next=6,t.load();case 6:u={slices:void 0,offset:0,transpose:0,volume:0},(l=new dr(r.track,t,function(){return[]},void 0,u)).samplesStream=n,setTimeout(Object(i.a)(a.a.mark(function n(){var i,o;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(l.init(),r.detuneSignal.connect(l.detuneSignal.input),r.detuneParameter.set(r.detuneParameter.get()),void 0!==e){n.next=10;break}return n.next=6,r.getPitch(t);case 6:void 0===(i=n.sent)?void 0===e&&(e=0):(void 0===e&&(e=i),(o=e-i)<-30&&(o+=36),l.transpose=o),n.next=11;break;case 10:case 11:r.cache={},void 0===r.samplers[e]&&(r.samplers[e]=[]),r.samplers[e]=[].concat(Object(h.a)(r.samplers[e]),[l]),r.selectSampler(e,l),s({sampler:l,samplers:r.samplers[e]});case 16:case"end":return n.stop()}},n)})),500);case 10:case"end":return o.stop()}},o)}));return function(e,t){return o.apply(this,arguments)}}())}},{key:"getTriggerCount",value:function(e){return this.triggerCounters[e]||0}},{key:"numberOfSamplers",get:function(){var e=0;for(var t in this.samplers)e+=this.samplers[t].length;return e}},{key:"defaultSampler",get:function(){if(void 0!==this.samplers){var e=Object.keys(this.samplers)[0];if(void 0!==e)return this.samplers[e][0]}}},{key:"getAllSamplersAtExactTranspose",value:function(e){var t=this.samplers[e];return this.mixMode===xr&&(t=this.samplers[e].filter(function(e){return e.on})),t}},{key:"filterNeededSamplers",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0!==e){if(this.mixMode===Sr){var r=[e[this.getTriggerCount(t)%e.length]];return n&&(this.triggerCounters[t]=this.getTriggerCount(t)+1),r}return e}}},{key:"getSampler",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e in this.cache){var n=this.cache[e];return Object(d.a)({},n,{samplers:this.filterNeededSamplers(n.samplers,e,t)})}var r=e;e in this.samplers||(r=this.findClosest(e));var a=this.getAllSamplersAtExactTranspose(r);return this.cache[e]={closest:parseFloat(r),samplers:a},{closest:parseFloat(r),samplers:this.filterNeededSamplers(a,e,t)}}},{key:"findClosest",value:function(e){return this.interpolationMode===jr?function(e,t){var n=void 0,r=void 0;for(var a in t){a=parseInt(a);var i=Math.abs(e-a);void 0!==n?i<r&&(n=a,r=i):(n=a,r=i)}return parseFloat(n)}(e,this.samplers):function(e,t){var n=y.a.fromTranspose(e);n.octave=0;var r=void 0,a=void 0,i=void 0;for(var o in t){var s=y.a.fromTranspose(o);s.octave=0;var c=Math.abs(n.getTranspose()-s.getTranspose()),u=Math.abs(e-o);(void 0===i||c<i||c===i&&u<a)&&(r=o,i=c,a=u)}return parseFloat(r)}(e,this.samplers)}},{key:"getJson",value:function(){var e=Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{ampAttack:this.ampAttack,ampDecay:this.ampDecay,ampSustain:this.ampSustain,ampRelease:this.ampRelease,crossFade:this.crossFadeParameter.get(),interpolationMode:this.interpolationMode,mixMode:this.mixMode,samplers:{},glide:this.glide,monophonic:this.monophonic,detune:this.detuneParameter.get(),loopStart:this.loopStart,loopLength:this.loopLength,loop:this.loopParameter.get(),smooth:this.smoothParameter.get()});for(var t in this.samplers)e.samplers[t]=this.samplers[t].map(function(e){return e.getJson()});return e=Object(ue.b)(e,"ampAttackParameter",this.ampAttackParameter),e=Object(ue.b)(e,"ampDecayParameter",this.ampDecayParameter),e=Object(ue.b)(e,"ampSustainParameter",this.ampSustainParameter),e=Object(ue.b)(e,"ampReleaseParameter",this.ampReleaseParameter),e=Object(ue.b)(e,"interpolationModeParameter",this.interpolationModeParameter),e=Object(ue.b)(e,"mixModeParameter",this.mixModeParameter),e=Object(ue.b)(e,"glideParameter",this.glideParameter),e=Object(ue.b)(e,"monophonicParameter",this.monophonicParameter),e=Object(ue.b)(e,"detuneParameter",this.detuneParameter),e=Object(ue.b)(e,"loopStartParameter",this.loopStartParameter),e=Object(ue.b)(e,"loopLengthParameter",this.loopLengthParameter),e=Object(ue.b)(e,"smoothParameter",this.smoothParameter),e=Object(ue.b)(e,"loopParameter",this.loopParameter),e=Object(ue.b)(e,"crossFadeParameter",this.crossFadeParameter)}},{key:"fromJsonSync",value:function(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&this.clearSamples(),this.ampAttackParameter.set(e.ampAttack),this.ampDecayParameter.set(e.ampDecay),this.ampSustainParameter.set(e.ampSustain),this.ampReleaseParameter.set(e.ampRelease),void 0!==e.loopStart&&this.loopStartParameter.set(e.loopStart),void 0!==e.loopLength&&this.loopLengthParameter.set(e.loopLength),void 0!==e.loop&&this.loopParameter.set(e.loop),void 0!==e.crossFade&&this.crossFadeParameter.set(e.crossFade),e.interpolationMode&&(this.interpolationMode=e.interpolationMode),void 0!==e.mixMode&&(this.mixMode=Object(ke.a)(e.mixMode)?Sr:e.mixMode),void 0!==e.glide&&(this.glide=e.glide),void 0!==e.monophonic&&(this.monophonic=e.monophonic),void 0!==e.smooth&&this.smoothParameter.set(e.smooth),Object(ue.a)(e,"ampAttackParameter",this.ampAttackParameter,this.sequencerEngine),Object(ue.a)(e,"ampDecayParameter",this.ampDecayParameter,this.sequencerEngine),Object(ue.a)(e,"ampSustainParameter",this.ampSustainParameter,this.sequencerEngine),Object(ue.a)(e,"ampReleaseParameter",this.ampReleaseParameter,this.sequencerEngine),Object(ue.a)(e,"interpolationModeParameter",this.interpolationModeParameter),Object(ue.a)(e,"mixModeParameter",this.mixModeParameter),Object(ue.a)(e,"glideParameter",this.glideParameter,this.sequencerEngine),Object(ue.a)(e,"monophonicParameter",this.monophonicParameter,this.sequencerEngine),Object(ue.a)(e,"detuneParameter",this.detuneParameter,this.sequencerEngine),Object(ue.a)(e,"loopStartParameter",this.loopStartParameter,this.sequencerEngine),Object(ue.a)(e,"loopLengthParameter",this.loopLengthParameter,this.sequencerEngine),Object(ue.a)(e,"loopParameter",this.loopParameter,this.sequencerEngine),Object(ue.a)(e,"smoothParameter",this.smoothParameter,this.sequencerEngine),Object(ue.a)(e,"crossFadeParameter",this.crossFadeParameter,this.sequencerEngine),t)for(var n in t){var r=t[n];for(var a in r){var i=r[a].sample,o=e.samplers[n][a];this.setSampleForTranspose(n,i.getCopy(!0),o,r[a].tempo)}}this.samples=Object(d.a)({},this.samplers),this.loop=this.loop,void 0!==e.detune?this.detuneParameter.set(e.detune):this.detuneParameter.set(0)}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o,s,c,u=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(o in r=u.length>2&&void 0!==u[2]&&u[2],this.loaded=!1,this.store.dispatch(Object(J.we)(this.track.subSequence.id,this.track.trackNumber,!0)),this.getParameters().forEach(function(e){return e.isLoaded=!1}),this.fromJsonSync(t,void 0,r),i=[],t.samplers)if(void 0!==t.samplers[o].length)for(s in t.samplers[o])c=t.samplers[o][s],i.push(this.loadSamplerFromJson(parseFloat(o),c));else i.push(this.loadSamplerFromJson(parseFloat(o),t.samplers[o]));return e.next=9,Promise.all(i);case 9:if(this.loaded=!0,this.track.sample=this.defaultSampler&&this.defaultSampler.sample,!this.defaultSampler){e.next=15;break}return e.next=14,this.defaultSampler.samplesStream.fetch();case 14:this.track.samplesStream=this.defaultSampler.samplesStream;case 15:this.getParameters().forEach(function(e){return e.isLoaded=!0}),this.store.dispatch(Object(J.we)(this.track.subSequence.id,this.track.trackNumber,!1));case 17:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"setSampleForTranspose",value:function(e,t,n,r){var a=new dr(this.track,t,function(){return[]},n.slices,n);void 0!==r&&(a.tempo=r),a.init(void 0,void 0,!0),this.detuneSignal.connect(a.detuneSignal,0,0),void 0===this.samplers[e]&&(this.samplers[e]=[]),this.samplers[e].push(a),this.cache={}}},{key:"loadSamplerFromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new H.a(n.sampleId,this.sequencerEngine.encryptedIpfs),e.prev=1,e.next=4,r.load();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return");case 9:this.setSampleForTranspose(t,r,n);case 10:case"end":return e.stop()}},e,this,[[1,6]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearSamples",value:function(){for(var e in this.samplers){for(var t in this.samplers[e])this.samplers[e][t].dispose();delete this.samplers[e]}this.voices.clear(),this.ripMods()}},{key:"getSamples",value:function(){var e=[];for(var t in this.samplers)for(var n in this.samplers[t])e.push(this.samplers[t][n].sample);return e}},{key:"ripMods",value:function(){if(void 0!==this.parameters){var e,t=Ar(this.parameters);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.object&&n.isConnectedToAnyModulator()&&n.disconnectFromAllModulators()}}catch(r){t.e(r)}finally{t.f()}}}},{key:"dispose",value:function(){this.clearSamples(),this.voices.dispose(),this.voices=void 0,this.samplers=void 0,this.outputNode.dispose(),this.outputNode=void 0,this.parameters=void 0}},{key:"getPitch",value:function(e){var t=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var o,s,c;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0===(o=t.getNoteFromName(e.name))){n.next=4;break}return r(o),n.abrupt("return");case 4:return r(void 0),n.abrupt("return");case 10:(s=n.sent).notes.length>0&&(s.notes.sort(function(e,t){return t.endTime-t.starTime-(e.endTime-e.startTime)}),c=s.notes[0].pitch-48,r(c)),r(void 0);case 13:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"deleteSampler",value:function(e){for(var t in this.samplers){var n=this.samplers[t].indexOf(e);n>-1&&(this.samplers[t].splice(n,1),e.dispose()),0===this.samplers[t].length&&delete this.samplers[t]}this.cache={},this.voices.clear()}},{key:"selectSampler",value:function(e,t){this.cache={},this.samplers[e].filter(function(e){return e!==t}).forEach(function(e){return e.on=!1}),t.on=!0}},{key:"getNoteFromName",value:function(e){var t=void 0,n=e.match(/([A-G]||[a-g])([#b])?\d/);if(n&&!(n[0].length<2)&&(2===(e=n[0].toUpperCase()).length?t=e.substring(0,1):3===e.length&&(t=e.substring(0,2)),t&&y.a.baseNotes.indexOf(t)>-1))return y.a.fromString(e).getTranspose()}},{key:"findLoop",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o,s,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(this.solutionNumber+=500,t=this.solutionNumber),i=this.getAllSamplersAtExactTranspose(0)[0],o=Tr(i.audioBuffer,t,n,r),s=o.start,!((c=o.end)<s)){e.next=7;break}return this.solutionNumber=Math.ceil(10*Math.random()),this.findLoop(void 0,n,r),e.abrupt("return");case 7:u=100*s/(re.a.Master.context.sampleRate*i.getDuration()),this.loopStartParameter.set(u),this.loopLengthParameter.set(100*(c-s)/(re.a.Master.context.sampleRate*i.getDuration()));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.context,t=arguments.length>1?arguments[1]:void 0,r=new n(arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.sequencerEngine,this.mixSession,e,t);return r.fromJsonSync(this.getJson(),this.samplers),r}},{key:"makePublicIfNeeded",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o,s,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=a.a.keys(this.samplers);case 1:if((e.t1=e.t0()).done){e.next=21;break}t=e.t1.value,n=this.samplers[t],e.t2=a.a.keys(n);case 5:if((e.t3=e.t2()).done){e.next=19;break}return r=e.t3.value,i=this.samplers[t][r],o=i.sample,e.next=11,rr.a.guildSamples.getGuildIdForSound(o.getId());case 11:if(void 0===(s=e.sent)||0===s){e.next=17;break}return e.next=15,rr.a.guildSamples.saveSample(o);case 15:c=e.sent,o.ipfsHash=c;case 17:e.next=5;break;case 19:e.next=1;break;case 21:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setEnvelopes",value:function(e,t){var n=this.ampAttackParameter.getKeyScaledValue(t),r=this.ampDecayParameter.getKeyScaledValue(t),a=this.ampSustainParameter.getKeyScaledValue(t),i=this.ampReleaseParameter.getKeyScaledValue(t);this.onAttackChanged(n),this.onDecayChanged(r),this.onSustainChanged(a),this.onReleaseChanged(i),null!==e.releaseParameter.get()&&this.releaseParameter.set(e.releaseParameter.get())}}]),n}(Object(Et.a)(qt(oe)));function Ir(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var qr=rr.a.presets,_r=function(e){Object(u.a)(n,e);var t=Ir(n);function n(e,r,a,i,s,u){var l;!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return Object(o.a)(this,n),(l=t.call(this,e,r,a,i,s,u,!1)).setInstrument(new Nr(r,a,(new X.a).forTrack(Object(c.a)(l)),Object(c.a)(l))),l.name="Sampled Instrument",l.gated=!0,l}return Object(s.a)(n,[{key:"getInstrumentType",value:function(){return te.h}},{key:"createNewInstrument",value:function(){this.instrument=void 0,this.setInstrument(new Nr(this.sequencerEngine,this.mixSession,(new X.a).forTrack(this),this)),this.gated=!0}},{key:"tempo",get:function(){var e=this.selectedSampler||this.instrument.defaultSampler;return void 0===e?0:e.tempo}},{key:"auditionPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,e.next=3,qr.getPresetData(t);case 3:r=e.sent,this.fromJson(r.trackParameters),this.presetName=n,this.update();case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r,i,o,s){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,t,r,i,o,s);case 2:this.instrument.defaultSampler&&(this.sample=this.instrument.defaultSampler.sample);case 3:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i){return e.apply(this,arguments)}}()},{key:"loadTrackInfo",value:function(e,t){var n=this.selectedSampler||this.instrument.defaultSampler;n&&(this.sample=t,n.auditionSound(t),this.presetName=t.name,this.sequencerEngine.update()),this.store.dispatch(Object(J.we)(this.subSequence.id,this.trackNumber,!1))}},{key:"restart",value:function(){Object(fe.a)(Object(f.a)(n.prototype),"restart",this).call(this),this.isFrozen||(this.instrument.triggerCounters={},this.instrument.cache={},this.instrument.voices.clear())}},{key:"start",value:function(){Object(fe.a)(Object(f.a)(n.prototype),"start",this).call(this),this.isFrozen||this.restart()}},{key:"onNewStep",value:function(e,t){this.isFrozen?Object(fe.a)(Object(f.a)(n.prototype),"onNewStep",this).call(this):(Object(fe.a)(Object(f.a)(n.prototype),"onNewStep",this).call(this),this.instrument.onNewStep(e,t))}},{key:"getSamplesStream",value:function(){var e=this.selectedSampler||this.instrument.defaultSampler;return e?e.samplesStream:this.samplesStream}},{key:"getCopy",value:function(e,t){return Object(fe.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,o){return new n(e,t,r,a,i,o)},t)}},{key:"makePublicIfNeeded",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.instrument.makePublicIfNeeded();case 2:e.t0=a.a.keys(this.effectsChains);case 3:if((e.t1=e.t0()).done){e.next=9;break}return t=e.t1.value,e.next=7,this.effectsChains[t].makePublicIfNeeded();case 7:e.next=3;break;case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isMonophonic",value:function(){return this.instrument.monophonic}}]),n}(jt),Dr=n(576),Fr="WAVETABLE",Lr="KARPLUS_FM",Br="MONO_BASS",zr={WAVETABLE:"Wavetable Synth",KARPLUS_FM:"Karplus FM Synth",MONO_BASS:"Mono Bass Synth"},Jr={WAVETABLE:{patchName:"/wavetable.export.json",dependencies:[{id:"tables",file:"/wavetable64.wav"}]},KARPLUS_FM:{patchName:"/karplus-fm.export.json"},MONO_BASS:{patchName:"/mono-bass.export.json"}};function Vr(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Hr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Hr(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Hr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ur(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Gr(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Wr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wr(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Wr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Kr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Qr=new re.a.Frequency("C3"),Zr=function(e){Object(u.a)(n,e);var t=Kr(n);function n(e,r,a,i,s){var u;!(arguments.length>5&&void 0!==arguments[5])||arguments[5];return Object(o.a)(this,n),(u=t.call(this)).midiPort=0,u.sequencerEngine=a,u.store=a.store,u.mixSession=i,u.context=s.getCopy().forInstrument(Object(c.a)(u)),u.parameters=[],u.outputNode=new re.a.Gain(1),u.loadRNBO(Jr[e],r),u.notesDown={},u}return Object(s.a)(n,[{key:"createNoteMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{noteOnMessage:[144+t,e,100],noteOffMessage:[128+t,e,0]}}},{key:"getInstrumentType",value:function(){return te.g}},{key:"triggerAttack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re.a.Master.context.currentTime,n=(arguments.length>2&&arguments[2],t===re.a.Master.context.currentTime);e=this.toMidiNote(e);var r=this.createNoteMessage(e).noteOnMessage,a=new pt.MIDIEvent(1e3*t,this.midiPort,r);this.device.scheduleEvent(a),n&&(this.notesDown[e]=!0)}},{key:"toMidiNote",value:function(e){return Qr.transpose(e).toMidi()}},{key:"triggerRelease",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:re.a.Master.context.currentTime;re.a.Master.context.currentTime;e=this.toMidiNote(e);var r=this.createNoteMessage(e).noteOffMessage,a=new pt.MIDIEvent(1e3*n,this.midiPort,r);this.device.scheduleEvent(a)}},{key:"triggerAttackRelease",value:function(e,t,n,r){this.triggerAttack(e,n,r),this.triggerRelease(e,r,n+t-.01)}},{key:"connect",value:function(e){this.outputNode.connect(e),this.node=e}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"getInstrument",value:function(){return this}},{key:"loadRNBO",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.patchName,i=t.dependencies,e.next=3,fetch(r);case 3:return o=e.sent,e.next=6,o.json();case 6:return s=e.sent,e.next=9,Object(pt.createDevice)({context:re.a.Master.context._context,patcher:s});case 9:if(this.device=e.sent,!i){e.next=14;break}return e.next=13,this.device.loadDataBufferDependencies(i);case 13:e.sent;case 14:this.deviceNode=this.device.node,this.deviceNode.connect(this.outputNode),this.initRNBOParameters(n,this.device),this.savedJson&&this.fromSavedJson();case 18:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"fromJson",value:function(e,t){var n={};return this.device?(this.fromSavedJson(),n):(this.savedJson=e,n)}},{key:"getJson",value:function(e){var t,r=Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this)),a=Gr(this.signalParameters);try{for(a.s();!(t=a.n()).done;){var i=t.value;r[i.name]=i.get(),r=Object(ue.b)(r,i.name+"Parameter",i)}}catch(u){a.e(u)}finally{a.f()}var o,s=Gr(this.rnboParameters);try{for(s.s();!(o=s.n()).done;){var c=o.value;r[c.name]=c.get(),r=Object(ue.b)(r,c.name+"Parameter",c)}}catch(u){s.e(u)}finally{s.f()}return r}},{key:"fromSavedJson",value:function(){var e,t=this.savedJson,n=Gr(this.signalParameters);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.set(t[r.name]),Object(d.a)({},Object(ue.a)(t,r.name+"Parameter",r,!1))}}catch(s){n.e(s)}finally{n.f()}var a,i=Gr(this.rnboParameters);try{for(i.s();!(a=i.n()).done;){var o=a.value;o.set(t[o.name]),Object(d.a)({},Object(ue.a)(t,o.name+"Parameter",o,!1))}}catch(s){i.e(s)}finally{i.f()}this.savedJson=void 0}},{key:"isMonophonic",value:function(){return!1}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=Ur(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).rnboParameters=[],e.signals=[],e.signalParameters=[],e}return Object(s.a)(n,[{key:"initRNBOParameters",value:function(e,t){var n=this,r={},a={};for(var i in t.parameters.forEach(function(e){var i="parameter0",o=t.parametersById.get(e.id),s=e.name.indexOf("/"),c=s>-1?e.name.slice(s+1):e.name,u=c.split("_"),l=void 0;u.length>1&&(l=u[0]),n[i]=new he.a(c,n,function(e,t){return o.value=t},{tag:l,min:o.min,max:o.max,defaultValue:o.initialValue}),n.rnboParameters.push(n[i]),n.registerParameter(n[i]);var f=void 0;"amp"===l?f=r:"filterenv"===l&&(f=a),f&&("attack"===u[1]?f.attackParameter=n[i]:"decay"===u[1]?f.decayParameter=n[i]:"sustain"===u[1]?f.sustainParameter=n[i]:"release"===u[1]?f.releaseParameter=n[i]:"level"===u[1]&&(f.levelParameter=n[i],f.hasLevel=!0))}),Object.keys(r).length>0&&(this.ampEnvelope=r,this.ampEnvelope.name="Amp"),Object.keys(a).length>0&&(this.filterEnvelope=a,this.filterEnvelope.name="Filter"),e){var o=e[i];this.createSignalParameter(i,o.inputNumber,{defaultValue:o.defaultValue,min:o.min,max:o.max,tag:o.tag},t)}}},{key:"createSignalParameter",value:function(e,t,n,r){var a=new re.a.Signal(0),i=new le.c(e,a,n);this.registerParameter(i),this.signalParameters.push(i),this.signals.push(a),a.connect(r.node,0,t)}},{key:"getParametersByGroup",value:function(e){var t,n={},r=Vr(this.parameters);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=a.config.tag;if("amp"===i||"filterenv"===i){if(!e)continue}else if(e)continue;n[i]||(n[i]=[]),n[i].push(a)}}catch(o){r.e(o)}finally{r.f()}return n}}]),n}(e)}(oe));function Yr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var $r=function(e){Object(u.a)(n,e);var t=Yr(n);function n(){Object(o.a)(this,n);for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return t.call.apply(t,[this,Fr,{Frequency:{inputNumber:0,defaultValue:1,min:.1,max:4},WaveTable:{inputNumber:1,defaultValue:1,min:.1,max:255},"Filter Cutoff":{inputNumber:2,defaultValue:1e3,min:10,max:1e4}}].concat(r))}return n}(Zr);function Xr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ea=function(e){Object(u.a)(n,e);var t=Xr(n);function n(){Object(o.a)(this,n);for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return t.call.apply(t,[this,Lr,{Filter:{inputNumber:0,defaultValue:1e3,min:.1,max:5e3},Fuzz:{inputNumber:1,defaultValue:.1,min:0,max:1}}].concat(r))}return n}(Zr);function ta(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var na=function(e){Object(u.a)(n,e);var t=ta(n);function n(){Object(o.a)(this,n);for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return t.call.apply(t,[this,Br,{Cutoff:{inputNumber:0,defaultValue:200,min:.1,max:5e3,tag:"Filter"},Trapezoid:{inputNumber:1,defaultValue:.1,min:0,max:1,tag:"Shape"},Sinusoid:{inputNumber:2,defaultValue:.1,min:0,max:1,tag:"Shape"},Phase:{inputNumber:3,defaultValue:.1,min:0,max:1,tag:"Shape"},Width:{inputNumber:4,defaultValue:.1,min:0,max:1,tag:"Shape"},TremoloDepth:{inputNumber:5,defaultValue:.1,min:0,max:4,tag:"Tremolo"},TremoloRate:{inputNumber:6,defaultValue:32,min:.01,max:64,tag:"Tremolo"},HardSyncRatio:{inputNumber:7,defaultValue:.56,min:.01,max:4,tag:"VC2"},Resonance:{inputNumber:8,defaultValue:1,min:.01,max:6,tag:"Filter"}}].concat(r))}return Object(s.a)(n,[{key:"isMonophonic",value:function(){return!0}}]),n}(Zr);function ra(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}rr.a.presets;var aa=function(e){Object(u.a)(n,e);var t=ra(n);function n(e,r,a,i,s,c,u,l){var f;return Object(o.a)(this,n),(f=t.call(this,e,r,a,i,s,c,!1)).deviceType=u,f.setInstrument(f.getInstrumentForDevice(u)),f.name=zr[u],f.presetName=f.name,f}return Object(s.a)(n,[{key:"getInstrumentType",value:function(){return te.g}},{key:"createNewInstrument",value:function(){this.instrument=void 0,this.setInstrument(this.getInstrumentForDevice(this.deviceType)),this.gated=!0}},{key:"getInstrumentForDevice",value:function(e){switch(e){case Fr:return new $r(this.sequencerEngine,this.mix,(new X.a).forTrack(this),this);case Lr:return new ea(this.sequencerEngine,this.mix,(new X.a).forTrack(this),this);case Br:return new na(this.sequencerEngine,this.mix,(new X.a).forTrack(this),this)}}},{key:"getJson",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return Object(d.a)({},(e=Object(fe.a)(Object(f.a)(n.prototype),"getJson",this)).call.apply(e,[this].concat(r)),{deviceType:this.deviceType})}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r,i,o,s){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,t,r,i,o,s);case 2:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i){return e.apply(this,arguments)}}()},{key:"getCopy",value:function(e,t){return Object(fe.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Object(Dr.a)(Zr,t)},t)}}]),n}(jt);function ia(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.numberOfPatterns(),a=arguments.length>4?arguments[4]:void 0,i=void 0;if(t===W.b)switch(n){case te.c:i=new wt(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence);break;case te.f:i=new nr(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence);break;case te.i:i=new jt(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence);break;case te.h:i=new _r(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence);case te.g:console.log("RNBO TRACK CREATED with deviceType=",a),i=new aa(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence,a)}else t===W.c&&(i=new ur(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence));if(void 0!==i)return i}var oa=n(632),sa=n(454),ca=n(453),ua=(n(590),n(21)),la=n(122),fa=n(953);function ha(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var da=function(e){Object(u.a)(n,e);var t=ha(n);function n(e,r,a,i,s,c){var u;return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c)).audioInputChannel=void 0,u.isRecording=!1,u.samplesToUpload=[],u.soundUploader=new He.a(1,function(e,t,n){return u.onSoundUploaded(t,n)}),u}return Object(s.a)(n,[{key:"isRecordable",value:function(){return!0}},{key:"onSoundUploaded",value:function(e,t){}},{key:"setAudioInputManager",value:function(e){this.audioInputManager=e,this.audioInputManager.monitorVolume.gain.value=0}},{key:"setAudioInput",value:function(e){void 0!==this.audioInputChannel&&this.disconnectAudioInput(this.audioInputChannel),this.audioInputChannel=e,void 0!==e?(console.log("CONNECTING AUDIO INPUT M"),this.audioInputManager.connect(this.gainNode,e),this.recorder=this.audioInputManager.getRecorder()):this.disconnectAudioInput(this.audioInputChannel)}},{key:"disconnectAudioInput",value:function(e){console.log("disconnecting channel = "+e),this.audioInputManager.disconnect(this.gainNode,e),this.audioInputChannel=void 0}},{key:"isAudioInputChannelConnected",value:function(e){return this.audioInputChannel===e}},{key:"recording",value:function(e){this.isRecording=e}},{key:"startRecording",value:function(e){if(void 0!==this.recorder){var t=this,n=Object(gr.a)(e);setTimeout(function(){t.recorder.clear(),t.recorder.record()},n+0)}}},{key:"stopRecording",value:function(e){if(void 0!==this.recorder){var t=this;setTimeout(function(){t.recorder.stop(),t.recorder.getBuffer().then(function(e){t.saveBuffer(e)})},Object(gr.a)(e)+10)}}},{key:"saveBuffer",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this,{slices:void 0,offset:0,transpose:0,volume:4},n=t[0].length,(r=re.a.Master.context.createBuffer(2,n,re.a.Master.context.sampleRate)).copyToChannel(t[0],0,0),r.copyToChannel(t[0],1,0),[{startTime:0,endTime:r.duration}],i=new H.a,this.sample=i,i.isResampled=!0,i.tags=["Recorded"],i.name="Recorded",i.audioBuffer=r,this.freeze([i]),e.next=16,this.soundUploader.uploadBufferToIpfs(t,!0,0);case 16:o=e.sent,i.ipfsHash=o;case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onNewRecordedSampler",value:function(e,t){t.gainNode.connect(this.gainNode),e.switchToPattern(e.currentPattern),e.setVolume(e.getVolume()),e.setPanning(e.getPanning())}}]),n}(rt(Object(fa.a)(ht)));n(581);function pa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var va=new re.a.Time("16n"),ma=function(e){Object(u.a)(n,e);var t=pa(n);function n(e,r,a,i,s,c,u){var l;return Object(o.a)(this,n),(l=t.call(this,e,r,a,i,s,c)).midiOutputs=new Set,l.midiEngine=void 0,l.isRecordingMidi=!1,l.isEnabled=!1,l.recordedTriggers={},void 0!=u&&u||l.setupEffects(),l.audioInputManager=void 0,l.midiChannel=void 0,l.gated=!0,l.latency=0,l.ccParameters=[],l}return Object(s.a)(n,[{key:"setupCCParameters",value:function(e){console.log("OUTPUT =",e),this.ccParameters=[];for(var t=1;t<120;t++){var n=new oa.a("Midi CC "+t,t,e);this.registerParameter(n,!1),this.ccParameters.push(n)}}},{key:"getParameters",value:function(){return[].concat(Object(h.a)(Object(fe.a)(Object(f.a)(n.prototype),"getParameters",this).call(this)),Object(h.a)(this.ccParameters))}},{key:"getInstrumentType",value:function(){return te.b}},{key:"getName",value:function(){return"External Instrument"}},{key:"getCopy",value:function(){var e=Object(fe.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,o){return new n(e,t,r,a,i,o)});return e.setMidiEngine(this.midiEngine),e.midiChannel=this.middieChannel,e.sequencerEngine=this.sequencerEngine,e.midiOutputs=new Set(this.midiOutputs),e.latency=this.latency,e}},{key:"getSoundUploader",value:function(){return this.soundUploader}},{key:"setAudioSettings",value:function(e){this.audioSettings=e}},{key:"setSequencerEngine",value:function(e){this.sequencerEngine=e}},{key:"recording",value:function(e){this.isRecordingMidi=e}},{key:"toggleRecording",value:function(e){this.pattern.loopsPlaying[e]=!this.pattern.loopsPlaying[e]}},{key:"isRecordingPlaying",value:function(e){return this.pattern.loopsPlaying[e]}},{key:"getRecordings",value:function(){return this.getSamplers()}},{key:"deleteMidiOutput",value:function(e){this.midiOutputs.has(e)&&this.midiOutputs.delete(e)}},{key:"addMidiOutput",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.midiOutputs.add(e),this.setupCCParameters(this.sequencerEngine.midi.deviceToMidiCC[e.name])}},{key:"addMidiInterfaceEffect",value:function(e,t){if(!this.midiEffects.effects.filter(function(e){return"Midi Interface"===e.name})[0]){var n=new ca.a(this);n.setConfig(e,t),this.midiEffects.addEffect(n),this.sequencerEngine.update()}}},{key:"setAudioInputManager",value:function(e){this.audioInputManager=e}},{key:"onLoadTrackUrl",value:function(e,t,r){return Object(fe.a)(Object(f.a)(n.prototype),"onLoadTrackUrl",this).call(this,e,t,r)}},{key:"disconnect",value:function(){void 0!==this.audioChannel&&this.audioInputManager.disconnect(this.gainNode,this.audioChannel),this.audioChannel=void 0}},{key:"getMidiOutputs",value:function(){return this.midiOutputs}},{key:"setMidiEngine",value:function(e){this.midiEngine=e;var t=this;setTimeout(function(){t.setupMidiInput()},1e3)}},{key:"inputNoteForStep",value:function(e,t){var n=y.a.fromString(t).getTranspose();this.getStepsAtResolution(this.sequencerEngine.resolution)[e].transpose=n,this.syncBuckets(this.sequencerEngine.resolution),this.update()}},{key:"triggerMidiNoteOn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.onNoteOn(void 0,y.a.fromTranspose(e).toString(),t)}},{key:"onNoteOn",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;void 0!==this.sequencerEngine.cursor.step&&this.sequencerEngine.cursor.show&&this.inputNoteForStep(this.sequencerEngine.cursor.getStep(this.sequencerEngine.resolution),t),this.isEnabled&&(this.midiOutputs.size>0&&this.midiOutputs.forEach(function(e){return n.midiEngine.playNoteSimple(e,t,n.midiChannel,0,0,r)}),this.isRecordingMidi)}},{key:"triggerMidiNoteOff",value:function(e){this.onNoteOff(void 0,y.a.fromTranspose(e).toString())}},{key:"onNoteOff",value:function(e,t){var n=this;this.midiOutputs.size>0&&this.midiOutputs.forEach(function(e){return n.midiEngine.releaseNoteSimple(e,t,n.midiChannel,0)}),this.isRecordingMidi&&this.recordedTriggers}},{key:"setupMidiInput",value:function(){}},{key:"getTrackType",value:function(){return W.d}},{key:"liveTrigger",value:function(e){this.triggerMidiNoteOn(e.transpose)}},{key:"liveTriggerRelease",value:function(e){this.triggerMidiNoteOff(e)}},{key:"trigger",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r){var i,o,s,c,u,l,h,d,p=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFrozen){e.next=3;break}return Object(fe.a)(Object(f.a)(n.prototype),"trigger",this).call(this,t,r),e.abrupt("return");case 3:for(r-=this.latency/1e3,i=t.transpose,o=new re.a.Time(new re.a.Time(t.duration)*va),Object(gr.a)(r),s=t.release/16,c=t.chop,u=(null==o?va:o)/c,l=r,h=t.velocity,h*=1-t.start,d=0;d<c;d++)this.midiOutputs.forEach(function(e){return p.midiEngine.playNote(e,p.midiChannel,i,Object(gr.a)(l),o.toMilliseconds(),s,h)}),l+=u;case 15:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"expandRecordedTracks",value:function(){var e=this,t=Object.keys(this.pattern.loopsPlaying).filter(function(t){return e.pattern.loopsPlaying[t]});console.log("loops playing = "),console.log(t),console.log(this.samplers),t.forEach(function(t){return e.sequencerEngine.addSound(t,void 0,void 0,void 0,!0)})}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{latency:this.latency})}},{key:"fromJson",value:function(e){e.latency&&(this.latency=e.latency)}}]),n}(da);function ya(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ba(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ba(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ba(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ga(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Oa=function(e){Object(u.a)(n,e);var t=ga(n);function n(e,r,a,i,s,c){var u;!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c)).setupEffects(),u}return Object(s.a)(n,[{key:"getSampler",value:function(){var e=this.frozenColumns[0].playing||0;return this.frozenColumns[0].frozenSamplers[e]}},{key:"sample",get:function(){if(this.frozenColumns&&this.frozenColumns[0]){var e=this.frozenColumns[0].playing||0;return this.frozenColumns[0].frozenSamples[e]}}},{key:"getName",value:function(){return"Multi Freeze"}},{key:"getTrackType",value:function(){return W.e}},{key:"unfreeze",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o,s,c,u,l,f,d,p,v,m,y,b,g,O,j,k,w,x,S,P,E,T,A,M,R,C=this,N=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=N.length>0&&void 0!==N[0]?N[0]:this.frozenGroup,n=N.length>1&&void 0!==N[1]?N[1]:this.frozenTracks,r=N.length>2?N[2]:void 0,this.sequencerEngine.dispatch(Object(J.gc)("Unfreezing Tracks")),i=this.currentPattern,o=this.sequencerEngine,s=[],c=Object(h.a)(o.tracks),u=ya(n),e.prev=9,u.s();case 11:if((l=u.n()).done){e.next=27;break}if(f=l.value,!r||r===f){e.next=15;break}return e.abrupt("continue",25);case 15:if(f){e.next=19;break}return c.push(!1),s.push(!1),e.abrupt("continue",25);case 19:return d=f.patterns,p=f.trackData,f.trackEffectChains,f.trackMidiEffects,e.next=22,Ma(o,p,d,0,this.sequencerEngine.currentSubSequence);case 22:v=e.sent,c.push(v),s.push(v);case 25:e.next=11;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(9),u.e(e.t0);case 32:return e.prev=32,u.f(),e.finish(32);case 35:m=0,e.t1=a.a.keys(n);case 37:if((e.t2=e.t1()).done){e.next=72;break}if(y=e.t2.value,!r||n[y]===r){e.next=41;break}return e.abrupt("continue",37);case 41:if((b=s[m++])&&n[y]){e.next=44;break}return e.abrupt("continue",37);case 44:return g=n[y],O=g.patterns,j=g.patternsConfig,k=g.trackData,w=g.trackEffectChains,x=g.trackMidiEffects,e.next=47,Ra({sequencerEngine:o,track:b,tracks:c,patterns:O,trackData:k,trackEffectChains:w,trackMidiEffects:x,subSequence:o.currentSubSequence});case 47:if(!j){e.next=70;break}if(S=this.patterns.length,P=j.length,o.switchToPattern(S-1),!(P>S)){e.next=61;break}E=S;case 53:if(!(E<P)){e.next=59;break}return e.next=56,o.newPattern(!0);case 56:E++,e.next=53;break;case 59:e.next=69;break;case 61:if(!(P<S)){e.next=69;break}T=P;case 63:if(!(T<S)){e.next=69;break}return e.next=66,b.newPattern(!0);case 66:T++,e.next=63;break;case 69:for(A=0;A<S;A++)b.patterns[A].loadFromJson(j[Math.min(A,j.length-1)]);case 70:e.next=37;break;case 72:if(M=this.sequencerEngine.groups.newGroup(),s.filter(function(e){return e}).forEach(function(e){return e.subSequence=C.subSequence}),s.filter(function(e){return e}).forEach(function(e){return M.addTrack(e)}),!t){e.next=79;break}return t.tracks=[],e.next=79,M.fromJson(t,this.sequencerEngine);case 79:this.sequencerEngine.tracks=c.filter(function(e){return e}),this.sequencerEngine.groups.updateGroupNumbers(),this.sequencerEngine.groups.groups.forEach(function(e){return e.updateRedux()}),this.sequencerEngine.switchToPattern(i),this.sequencerEngine.updateTracks(!0),this.sequencerEngine.selectTrack(this.sequencerEngine.tracks.length-s.length),this.sequencerEngine.dispatch(Object(J.gc)(void 0)),s.filter(function(e){return e}).forEach(function(e){return e.midiEffects.effects.filter(function(e){return e.lostParameters&&e.lostParameters.length>0}).forEach(function(e){return e.loadParameters(e.lostParameters)})}),t||(R=this.pad,s.filter(function(e){return e}).forEach(function(e,t){var n=R.slots.indexOf(!1);-1===n&&(R=C.subSequence.createPad()),R.addTrack(e,n),e.trackIsLoading=!1}));case 88:case"end":return e.stop()}},e,this,[[9,29,32,35]])}));return function(){return e.apply(this,arguments)}}()},{key:"fromJson",value:function(e){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e),this.frozenGroup=e.frozenGroup,this.frozenTracks=e.frozenTracks}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{frozenGroup:this.frozenGroup,frozenTracks:this.frozenTracks})}}]),n}(ht),ja="OFF";function ka(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wa=function(e){Object(u.a)(n,e);var t=ka(n);function n(e,r,a,i,s,c){var u;return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c)).setupEffects(),u.recordingMode=ja,u.deleteInlet("trigger "),u.deleteInlet("audition sample"),u.deleteInlet("restart"),u.deleteOutlet(S.p),u}return Object(s.a)(n,[{key:"selectedRecording",get:function(){return this.trackData.selectedRecording},set:function(e){this.trackData.selectedRecording=e}},{key:"isRecorable",value:function(){return!0}},{key:"getCopy",value:function(){var e=Object(fe.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,o){return new n(e,t,r,i,a,i,o)});return e.selectedRecording=this.selectedRecording,e}},{key:"getName",value:function(){return"Audio Track"}},{key:"getSelectedRecording",value:function(){return this.selectedRecording}},{key:"setSelectedRecording",value:function(e){this.selectedRecording=e}},{key:"getRecordings",value:function(){return Object(fe.a)(Object(f.a)(n.prototype),"getSamplers",this).call(this)}},{key:"saveBuffer",value:function(e){Object(fe.a)(Object(f.a)(n.prototype),"saveBuffer",this).call(this,e),this.setSelectedRecording(0)}},{key:"getJson",value:function(){var e=Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this);return e.selectedRecording=this.selectedRecording,e}},{key:"getSelectedRecordingSampler",value:function(){return Object(fe.a)(Object(f.a)(n.prototype),"getSamplers",this).call(this)[this.selectedRecording]}},{key:"getSelectedRecordingSoundId",value:function(){return this.soundIds[this.selectedRecording]}},{key:"getTrackType",value:function(){return W.a}},{key:"toggleEnabled",value:function(){Object(fe.a)(Object(f.a)(n.prototype),"toggleEnabled",this).call(this)}},{key:"setIsEnabled",value:function(e){Object(fe.a)(Object(f.a)(n.prototype),"setIsEnabled",this).call(this,e);var t=this.audioInputManager;t&&(t.monitorVolume.gain.value=this.isEnabled?1:0)}},{key:"length",get:function(){if(0===this.frozenColumns.length||this.frozenColumns.every(function(e){return!e.frozenSamplers[e.playing]}))return Object(fe.a)(Object(f.a)(n.prototype),"length",this);var e=this.frozenColumns.map(function(e){return e.frozenSamplers[e.playing]}).filter(function(e){return e}),t=this.getMaxDuration(),r=e[0].tempo/this.sequencerEngine.bpm;return xa(r*t/re.a.Time("32n").toSeconds())}},{key:"getMaxDuration",value:function(){var e=this.frozenColumns.map(function(e){return e.frozenSamplers[e.playing]}).filter(function(e){return e});return 0===e.length?1:Math.max.apply(Math,Object(h.a)(e.map(function(e){return e.getDuration()})))}},{key:"isAudioTrack",get:function(){return!0}},{key:"scheduleAnyRecording",value:function(e,t){e%(this.length/2)===0||e%this.length===0?"PREPARING"===this.recordingMode?(this.startRecording(t),this.recordingMode="RECORDING"):"STOPPING"===this.recordingMode&&(this.stopRecording(t),this.recordingMode=ja):this.countdown=Math.min(this.length/2-e%(this.length/2),this.length-e%this.length)}},{key:"getSampler",value:function(){return this.frozenColumns.map(function(e){return e.frozenSamplers[e.playing]}).filter(function(e){return e})[0]}}]),n}(da),xa=function(e){Math.round(e);return e-e%32},Sa=wa;function Pa(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ea(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ea(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ea(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ta=Me.a.baseResolution,Aa=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f,h,d,p,v;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sequencerEngine,r=t.trackData,i=t.patterns,o=t.trackNumber,s=t.subSequence,c=t.patternParameters,u=t.tracks,l=t.trackEffects,f=t.trackMidiEffects,h=t.trackEffectChains,d=t.patternToLoad,p=t.numPatterns,e.next=3,Ma(n,r,i,o,s);case 3:return v=e.sent,e.next=6,Ra({sequencerEngine:n,track:v,tracks:u,patterns:i,trackData:r,trackEffects:l,trackMidiEffects:f,patternParameters:c,trackEffectChains:h,subSequence:s,numPatterns:p,patternToLoad:d});case 6:return v.loadLostParameters(),e.abrupt("return",v);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Ma=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i,o){var s,c,u,l,f,h,p=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=p.length>5&&void 0!==p[5]?p[5]:r.length,"type"in n&&"MIDI"===n.type,c=n.type,u=n.deviceType,l=void 0,c===W.d?l=new ma(i,t,t.mixSession,s,function(){return t.update()},t.sends):c===W.f?(l=new ht(i,t,t.mixSession,s,function(){return t.update()},o)).trackNumber=i:c===W.a?l=new Sa(i,t,t.mixSesion,s,function(){return t.update()},o):c===W.e?l=new Oa(i,t,t.mixSession,s,function(){return t.update()},o):c!==W.b&&c!==W.c||(console.log("trackData",n),f=n.instrumentType,l=ia(t,c,f,void 0,u)),l.trackNumber=i,l.setSends(t.sends),e.next=10,l.fromJson(n);case 10:return(h=e.sent)&&(l.sequencerEngine.parametersToUpdate=Object(d.a)({},l.sequencerEngine.parametersToUpdate,h)),e.abrupt("return",l);case 13:case"end":return e.stop()}},e)}));return function(t,n,r,a,i){return e.apply(this,arguments)}}(),Ra=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f,h,p,v,m,y,b,g,O,j,k,w,x,S,P,E,T,A,M,R,C,N,I,q,_;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sequencerEngine,r=t.track,i=t.tracks,o=t.patterns,s=t.trackData,c=t.patternParameters,u=t.trackEffects,l=t.trackMidiEffects,f=t.trackEffectChains,h=t.subSequence,p=t.numPatterns,v=void 0===p?o.length:p,m=t.patternToLoad,y=-16,b=[],g={},e.next=6,Ca({sequencerEngine:n,trackEffectChains:f,trackEffects:u,track:r,trackNumber:r.trackNumber,tracks:i});case 6:O=e.sent,j=O.effects,k=Na(l,r),w=k.effects,g=Object(d.a)({},g,O.bulk,k.bulk),x=0;case 12:if(!(x<v)){e.next=39;break}S=[],P=o[m||x],(E="size"in P?P.size:Ta)>y&&(y=E),T="buckets"in P,(A=new Z.a(n,r)).changeLength(E,!1),M=0;case 21:if(!(M<E)){e.next=33;break}if(M in P){e.next=26;break}return R=A.stepBuckets[M],S.push(R),e.abrupt("continue",30);case 26:if(C=A.stepBuckets[M],N=P[M],T)for(q in N)(_=C.steps[q]||new K.a).track=r,_.stepNumber=M,_.simpleLoad(N[q],j,r,w),C.steps[q]=_;else(I=C.steps[0]).track=r,I.stepNumber=M,I.simpleLoad(P[M],j,r,w),C.steps[0]=I;S.push(C);case 30:M++,e.next=21;break;case 33:A.loadStepBuckets(void 0,!0),c&&A.loadFromJson(c[x]),b.push(A);case 36:x++,e.next=12;break;case 39:return r.patterns=b,r.pattern.muted=s.muted,r.gated=s.gated,e.next=44,G(r,s,h);case 44:r.setupEffects(),n.parametersToUpdate=Object(d.a)({},n.parametersToUpdate,g);case 46:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Ca=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f,h,p,v,m,y,b,g,O,j,k,w;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.sequencerEngine,r=t.track,i=t.trackEffects,o=t.trackEffectChains,s=t.trackNumber,c=t.tracks,u={},l=[],f=r.effectsChains[0],void 0===i){e.next=28;break}h=Pa(i),e.prev=6,h.s();case 8:if((p=h.n()).done){e.next=17;break}return v=p.value,e.t0=l,e.next=13,Object($.b)(v,c,n,s);case 13:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 15:e.next=8;break;case 17:e.next=22;break;case 19:e.prev=19,e.t2=e.catch(6),h.e(e.t2);case 22:return e.prev=22,h.f(),e.finish(22);case 25:f.updateEffects(l.map(function(e){return e.effect})),e.next=65;break;case 28:if(void 0===o){e.next=63;break}m=[],y=Pa(o),e.prev=31,y.s();case 33:if((b=y.n()).done){e.next=51;break}g=b.value,O=new Y.a(r.gainNode,r.trackNode,(new X.a).forTrack(r),n),e.t3=a.a.keys(g);case 37:if((e.t4=e.t3()).done){e.next=47;break}return j=e.t4.value,k=g[j],e.next=42,Object($.b)(k,c,n,s);case 42:w=e.sent,O.addEffect(w.effect),u=Object(d.a)({},u,w.bulk),e.next=37;break;case 47:O.updateEffects(),m.push(O);case 49:e.next=33;break;case 51:e.next=56;break;case 53:e.prev=53,e.t5=e.catch(31),y.e(e.t5);case 56:return e.prev=56,y.f(),e.finish(56);case 59:r.effectsChains.forEach(function(e){return e.dispose()}),r.effectsChains=m,e.next=65;break;case 63:l=Object(ee.a)(n),f.updateEffects(l);case 65:return e.abrupt("return",{effects:l,bulk:u});case 66:case"end":return e.stop()}},e,null,[[6,19,22,25],[31,53,56,59]])}));return function(t){return e.apply(this,arguments)}}(),Na=function(e,t){if(void 0!==e){var n=t.midiEffects.fromJson(e);return t.updateMidiEffectsRedux(),{effects:t.midiEffects.effects,bulk:n}}return{effects:[],bulk:{}}},Ia=(n(312),n(159)),qa=n(283),_a=n(64),Da=n(65),Fa=function(){function e(t,n,r,a,i){Object(o.a)(this,e),this.id=Object(q.uuid)(),this.tracks=[],this.subSequence=i,this.sequencerEngine=a,this.groupNumber=r,this.tags=t,this.inputNode=new ne.Volume,this.outputNode=new ne.PanVol,this.muteableNode=new ne.Volume,this.muteableNode.connect(this.outputNode),this.meter=new ne.Meter(.9),this.outputNode.connect(this.meter),this.effectsChain=new Y.a(this.inputNode,this.muteableNode,(new X.a).forGroup(this),a),this.effectsChain.setupEffects(),this.setVolume(-2,!1),this.channelMixer=n,this.outputs=void 0,this.muted=!1,this.panning=0}return Object(s.a)(e,[{key:"updateRedux",value:function(){this.sequencerEngine.store.dispatch(Object(J.Hb)(this.id,Object(h.a)(this.tracks)))}},{key:"mix",get:function(){return this.subSequence.mix}},{key:"solo",get:function(){var e=!1;for(var t in this.tracks)e=e||this.tracks[t].getSolo();return e},set:function(e){this.tracks.forEach(function(t){return t.solo(e)})}},{key:"effects",get:function(){return this.effectsChain.effects}},{key:"getEffectNumber",value:function(e,t){return this.effects.indexOf(e)}},{key:"dispose",value:function(){this.outputs=this.channelMixer.disconnect(this.outputNode,this.outputs),this.inputNode.dispose(),this.muteableNode.dispose(),this.outputNode.dispose(),this.inputNode=void 0,this.outputNode=void 0,this.effectsChain.dispose(),this.effectsChain=void 0}},{key:"mute",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.sequencerEngine.store.getState().mix.isRecordingMix&&this.mix.addEvent(new Da.a(this.groupNumber,e)),this.muted=e,this.muteableNode.volume.value=e?-125:0}},{key:"moveEffectTo",value:function(e,t){this.effectsChain.moveEffectTo(e,t)}},{key:"deleteEffect",value:function(e){this.effectsChain.deleteEffect(e)}},{key:"connectAudio",value:function(e){this.outputs=this.channelMixer.connect(this.outputNode)}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o,s,c,u,l,f,h,p;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t.newVolume?this.setVolume(Object(qa.b)(t.volume,0,128),!1):t.newestVolume?this.setVolume(t.volume,!1):(r=128*(t.volume+40)/43,this.setVolume(r,!1)),i=[],o=0;o<t.tracks.length;o++)void 0!==(s=n.tracks[t.tracks[o]])&&(s.getTrackType()===W.f&&s.sample&&i.push(s.sample.fetchTags()),this.addTrack(s));c={},u=0;case 5:if(!(u<t.effects.length)){e.next=14;break}return e.next=8,Object($.b)(t.effects[u],n.tracks,n);case 8:l=e.sent,this.effectsChain.addEffect(l.effect),c=Object(d.a)({},c,l.bulk);case 11:u++,e.next=5;break;case 14:return Object.keys(c).length>0&&(this.sequencerEngine.parametersToUpdate=Object(d.a)({},this.sequencerEngine.parametersToUpdate,c)),e.next=17,Promise.all(i);case 17:for(f=e.sent,h=new Set,p=0;p<f.length;p++)f[p].forEach(function(e){return h.add(e)});return this.tags=Array.from(h),e.abrupt("return",this);case 22:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSendNodes",value:function(){return[]}},{key:"addTrack",value:function(e){this.hasTrack(e)||(this.tracks.push(e),e.addToGroup(this))}},{key:"hasTrack",value:function(e){return this.tracks.indexOf(e)>-1}},{key:"setVolume",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e=Math.min(1,e),this.sequencerEngine.store.getState().mix.isRecordingMix&&this.mix.addEvent(new _a.a(this.groupNumber,e)),this.volume=e,this.outputNode.volume.linearRampToValueAtTime(e,ne.Master.context.currentTime+.01),t&&!this.sequencerEngine.isLoading&&this.sequencerEngine.store.dispatch(Object(J.Ib)(this.groupNumber,e)),this.subSequence.groups.sendVolumes()}},{key:"setPanning",value:function(e){this.panning=e,this.outputNode.pan.value=e}},{key:"updateEffects",value:function(e){this.effectsChain.updateEffects()}},{key:"getJson",value:function(e){return{newestVolume:!0,tracks:this.tracks.map(function(e){return e.trackNumber}),effects:this.effectsChain.getJson(),volume:this.volume,outputs:this.outputs}}}]),e}(),La=new(function(){function e(){Object(o.a)(this,e),this.groups=[]}return Object(s.a)(e,[{key:"useGroup",value:function(e,t,n,r,a){if(0===this.groups.length||!window.explore)return new Fa(e,t,n,r,a);var i=this.groups.pop();return i.subSequence=a,i.channelMixer=t,i.sequencerEngine=r,i.tags=e,i.groupNumber=n,i.subSequence=a,i}},{key:"releaseGroup",value:function(e){window.explore?(e.outputNode.disconnect(),e.tracks=[],e.updateRedux(),e.effectsChain.clear(),this.groups.push(e)):e.dispose()}}]),e}());function Ba(e,t){return e.filter(function(e){return-1!==t.indexOf(e)})}var za=function(){function e(t,n,r,a){Object(o.a)(this,e),this.groups=[],this.subSequence=a,this.channelMixer=t,this.sends=n,this.sequencerEngine=r,this.doneLoading=!1}return Object(s.a)(e,[{key:"startSendingLevels",value:function(){var e=this;setInterval(function(){if(e.zObject){var t=e.groups.map(function(e){var t=e.meter.getLevel();return t<-80?0:Math.pow((t+80)/86,2)});e.zObject.sendMessage("group levels",t)}},20)}},{key:"sendVolumes",value:function(){this.zObject&&this.zObject.sendLevels()}},{key:"deleteGroup",value:function(e){e.tracks.forEach(function(e){return e.dispose()}),e.dispose();var t=this.groups.indexOf(e);this.groups.splice(t,1),this.updateGroupNumbers()}},{key:"updateGroupNumbers",value:function(){for(var e=0;e<this.groups.length;e++)this.groups[e].groupNumber=e}},{key:"newGroup",value:function(e){var t=La.useGroup([],this.channelMixer,this.groups.length,this.sequencerEngine,this.subSequence);return this.groups.push(t),t.connectAudio(this.getMaxChannel()),e&&this.addToGroup(e,t),t}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(a.a.mark(function e(i,o){var s,c,u,l,f,h;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=4;break}return r.sequencerEngine.tracks.forEach(function(e){return r.addTrack(e)}),i(),e.abrupt("return");case 4:s=0;case 5:if(!(s<t.length)){e.next=15;break}return c=t[s],e.next=9,La.useGroup([],r.channelMixer,r.groups.length,r.sequencerEngine,r.subSequence).fromJson(c,n);case 9:(u=e.sent).tracks.length>0&&(u.connectAudio(r.getMaxChannel()),r.groups.push(u)),c.outputs&&(l=Object(v.a)(c.outputs,2),f=l[0],h=l[1],r.channelMixer.switchChannelOutput(u.outputNode,f,h)&&(u.outputs=[f,h]));case 12:s++,e.next=5;break;case 15:i();case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateGroups",value:function(){this.groups.forEach(function(e){return e.setVolume(e.volume)}),this.groups.forEach(function(e){return e.setPanning(e.panning)})}},{key:"addToGroup",value:function(e,t){var n=e.group,r=1==n.tracks.length,a=this.groups.indexOf(n);e.disconnectFromGroup(),t.addTrack(e),t.tags=Array.from(new Set(t.tags.concat(n.tags))),r?(this.groups.splice(a,1),n.dispose(),this.groups.forEach(function(e,t){return e.groupNumber=t})):(a=n.tracks.indexOf(e),n.tracks.splice(a,1)),t.updateRedux(),n.updateRedux()}},{key:"deleteTrack",value:function(e){var t=e.group;if(void 0!==t&&null!==t){var n=1==t.tracks.length,r=this.groups.indexOf(t);e.disconnectFromGroup(),n?(this.groups.splice(r,1),t.dispose()):(r=t.tracks.indexOf(e),t.tracks.splice(r,1))}}},{key:"addTrack",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.getTrackType(),e.next=e.t0===W.f?3:10;break;case 3:if(void 0!==(n=t.sample.tags)){e.next=8;break}return e.next=7,t.sample.fetchTags();case 7:n=e.sent;case 8:return this.resolveTrackTags(t,n),e.abrupt("break",11);case 10:this.resolveTrackTags(t,[t.getTrackType()]);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addMidiTrack",value:function(e){this.resolveTrackTags(e,["Midi Tracks"])}},{key:"resolveTrackTags",value:function(e,t){var n=0,r=null;if(this.groups.length>=4)r=this.groups[Math.floor(4*Math.random())];else for(var a in this.groups){var i=this.groups[a],o=Ba(i.tags,t);o.length>n&&(r=i,n=o.length)}null!=r?(r.tags=Ba(r.tags,t),r.addTrack(e)):this.newGroup().addTrack(e)}},{key:"dispose",value:function(){this.groups.forEach(function(e){return La.releaseGroup(e)}),this.groups=void 0}},{key:"getJson",value:function(e){return this.groups.map(function(t){return t.getJson(e)})}},{key:"getMaxChannel",value:function(){var e=[];this.groups.map(function(e){return e.outputs}).filter(function(e){return void 0!==e}).forEach(function(t){return e=e.concat(t)}),this.sends.sends.map(function(e){return e.outputs}).filter(function(e){return void 0!==e}).forEach(function(t){return e=e.concat(t)});var t=e.sort(function(e,t){return e-t}).reverse();if(0===t.length)return-1;for(var n=t[0],r=0;r<n;r+=2)if(-1==t.indexOf(r)&&-1==t.indexOf(r+1))return r-1;return n}}]),e}(),Ja=n(437),Va=n(168);function Ha(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ua=n(950),Ga=n(948),Wa=n(859);function Ka(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Qa=function(e){return function(e){Object(u.a)(n,e);var t=Ka(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"dispatch",value:function(e){window.isNFT||this.sequencerEngine.dispatch(e)}},{key:"state",get:function(){return this.sequencerEngine.state}}]),n}(e)},Za=n(428),Ya=n(438),$a=n(226);function Xa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function ei(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ti(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ti(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ti(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ni(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ri=function(e){Object(u.a)(n,e);var t=ni(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this))._subSequence=e,a.sequencerEngine=r,a.effects=[],a.inputedTriggers=[],a.initShadowEffects(),a}return Object(s.a)(n,[{key:"subSequence",get:function(){return this._subSequence}},{key:"linkEffectParameters",value:function(){var e=this;[].concat(Object(h.a)(this.effects),Object(h.a)(this.shadowEffects)).forEach(function(t){t.registerContext((new X.a).forSubSequence(e.subSequence))});var t,n={},r=ei(this.effects);try{for(r.s();!(t=r.n()).done;){var a,i=ei(t.value.getParameters());try{for(i.s();!(a=i.n()).done;){var o=a.value;n=Object(d.a)({},n,o.setStore(this.sequencerEngine.store))}}catch(s){i.e(s)}finally{i.f()}}}catch(s){r.e(s)}finally{r.f()}this.sequencerEngine.dispatch(Object(J.xb)(n))}},{key:"stop",value:function(){Object(fe.a)(Object(f.a)(n.prototype),"stop",this).call(this),this.shadowEffects.forEach(function(e){return e.stop()})}},{key:"clear",value:function(){Object(fe.a)(Object(f.a)(n.prototype),"clear",this).call(this),this.shadowEffects.forEach(function(e){return e.clear()})}},{key:"dispatch",value:function(e){this.sequencerEngine.dispatch(e)}},{key:"state",get:function(){return this.sequencerEngine.state}},{key:"input",value:function(e){this.inputedTriggers.push(e)}},{key:"output",value:function(e,t,n){var r=this,a=this.inputedTriggers,i=[].concat(Object(h.a)(this.effects),Object(h.a)(this.shadowEffects));for(var o in i){var s=i[o];if(s.isEnabled()){for(var c in a){var u=a[c];s.input(u)}a=s.output(e,t,n)}}return 0!==this.transposeParameter.get()?a.map(function(e,t){return(e=r.shadowEffects[0].copyTrigger(e,t<16)).stepData.transpose+=r.transposeParameter.get(),e}):a}},{key:"getJson",value:function(){var e=Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),t=this.shadowEffects.map(function(e){return Object(d.a)({},e.getJson(),{isShadowEffect:!0})});return t.push({isShadowEffect:!0,transposeParameter:this.transposeParameter.getJson()}),[].concat(Object(h.a)(e),Object(h.a)(t))}},{key:"fromJson",value:function(e){var t=e.filter(function(e){return!e.isShadowEffect}),r=Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,t),a=e.filter(function(e){return e.isShadowEffect});for(var i in a)a[i=parseInt(i)].transposeParameter?this.transposeParameter.fromJson(a[i].transposeParameter):r=Object(d.a)({},this.shadowEffects[i].fromJson(a[i]),r);return r}},{key:"onNewStep",value:function(){this.inputedTriggers=[],[].concat(Object(h.a)(this.effects),Object(h.a)(this.shadowEffects)).forEach(function(e){return e.onNewStep()})}},{key:"triggerAttackPostFXEnvelopes",value:function(e){}},{key:"triggerAttackPreFXEnvelopes",value:function(e,t){}},{key:"triggerReleasePostFXEnvelopes",value:function(e){}},{key:"triggerReleasePreFXEnvelopes",value:function(e,t){}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=Xa(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).shadowEffects=[],e}return Object(s.a)(n,[{key:"initShadowEffects",value:function(){var e=this;this.transposeParameter=new he.a("transpose",this,function(){return[]},{min:-32,max:32,defaultValue:0}),this.transposeParameter.setStore(this.sequencerEngine.store),this.transposeParameter.setContext((new X.a).forSubSequence(this.subSequence)),this.shadowEffects=[Object($a.c)("Sparse",this._subSequence),Object($a.c)("Stats",this._subSequence),Object($a.c)("Note Display",this._subSequence)],this.shadowEffects.forEach(function(t){return t._subSequence=e._subSequence})}}]),n}(e)}(Ya.a)),ai=n(436),ii=n(26),oi=n(124);function si(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ci=n(872);var ui=n(938),li=n(579),fi=n(134),hi=n(136);function di(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}n(161);var pi=n(109);function vi(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return mi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mi(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function mi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("!",{n:"Number to compare to"},"Not boolean",function(){return 1},{inlets:1,tags:["Math"]});Object(pi.a)("<",{n:"Number to compare to"},"Allows messages to pass if they are less than a given number",function(){return 2},{inlets:2,tags:["Math"]});Object(pi.a)(">",{n:"Number to compare to"},"Allows messages to pass if they are greater than a given number",function(){return 2},{inlets:2,tags:["Math"]});Object(pi.a)("=",{n:"Number to compare to"},"Allows messages to pass if they are equal to a given number",function(){return 2},{inlets:2,tags:["Math"]});Object(pi.a)("<=",{n:"Number to compare to"},"Allows messages to pass if they are less than or equal to a given number",function(){return 2},{tags:["Math"]});Object(pi.a)(">=",{n:"Number to compare to"},"Allows messages to pass if they are greater than or equal to a given number",function(){return 2},{tags:["Math"]});Object(pi.a)("&&",{a:"Number to compare to"},"Applies logical AND to the arguments",function(){return 2},{inlets:2,tags:["Math"],isHot:!0});Object(pi.a)("||",{a:"Number to compare to"},"Applies logical OR to the arguments",void 0,{isHot:!0,inlets:2,tags:["Math"]});Object(pi.a)("filter.=",{msg:"msg to filter",n:"Number to compare msg to"},"Allows messages to pass if they are equal to a given number",function(){return 1},{inlets:function(e){return e},tags:["Math"]});Object(pi.a)("filter.!=",{msg:"msg to filter",n:"Number to compare msg to"},"Allows messages to pass if they are not equal to a given number",function(){return 1},{inlets:2,tags:["Math"]});Object(pi.a)("filter.>",{msg:"msg to filter",n:"Number to compare msg to"},"Allows messages to pass if they are greater to a given number",function(){return 1},{inlets:2,tags:["Math"]});Object(pi.a)("filter.>=",{msg:"msg to filter",n:"Number to compare msg to"},"Allows messages to pass if they are greater to a given number",function(){return 1},{inlets:2,tags:["Math"]});Object(pi.a)("filter.<=",{msg:"msg to filter",n:"Number to compare msg to"},"Allows messages to pass if they are less than or equal to a given number",function(){return 1},{inlets:2,tags:["Math"]});Object(pi.a)("filter.<",{msg:"msg to filter",n:"Number to compare msg to"},"Allows messages to pass if they are less than or equal to a given number",function(){return 1},{inlets:2,tags:["Math"]});Object(pi.a)("filter.accent",{msg:"msg to filter"},"Allows messages to pass if they are equal to a given number",function(){return 1},{});Object(pi.a)("filter.staccato",{msg:"msg to filter"},"Allows messages to pass if they are equal to a given number",function(){return 1},{});var yi={"=":function(e,t){return function(e){try{var n=parseFloat(e[0]);return isNaN(n)?e[0]===t()?["bang"]:[void 0,"bang"]:n===parseFloat(t())?["bang"]:[void 0,"bang"]}catch(r){return}}},"<":function(e,t){return function(e){try{return parseFloat(e[0])<parseFloat(t())?["bang"]:[void 0,"bang"]}catch(n){return[void 0,"bang"]}}},">":function(e,t){return function(e){try{return parseFloat(e[0])>parseFloat(t())?["bang"]:[void 0,"bang"]}catch(n){return}}},"<=":function(e,t){return function(e){try{return parseFloat(e[0])<=parseFloat(t())?["bang"]:[void 0,"bang"]}catch(n){return}}},">=":function(e,t){return function(e){try{return parseFloat(e[0])>=parseFloat(t())?["bang"]:[void 0,"bang"]}catch(n){return}}},"&&":function(e,t,n){return function(e){return e[0]&&t()?["bang",void 0]:[void 0,"bang"]}},"||":function(e,t){return function(e){return t()||e[0]?["bang"]:void 0}},"!":function(e){return function(e){try{var t=parseFloat(e[0]);return 1===t?[0]:0===t?[1]:!t}catch(n){return[void 0,"bang"]}}},"filter.=":function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){try{var t,r=parseFloat(e[0]),a=vi(n);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(void 0===i||void 0===i())break;if(isNaN(r)&&e[0]===i())return[e];if(r===parseFloat(i()))return[e[0]]}}catch(o){a.e(o)}finally{a.f()}}catch(s){}}},"filter.!=":function(e,t){return function(e){try{var n=parseFloat(e[0]);if(isNaN(n)&&e[0]!==t())return[e];if(n!==parseFloat(t()))return[e[0]]}catch(r){}}},"filter.>":function(e,t){return function(e){try{var n=parseFloat(e[0]);if(isNaN(n)&&e[0]>t())return[e];if(n>parseFloat(t()))return[e[0]]}catch(r){}}},"filter.<=":function(e,t){return function(e){try{var n=parseFloat(e[0]);if(isNaN(n)&&e[0]<=t())return[e];if(n<=parseFloat(t()))return[e[0]]}catch(r){}}},"filter.<":function(e,t){return function(e){try{var n=parseFloat(e[0]);if(isNaN(n)&&e[0]<t())return[e];if(n<parseFloat(t()))return[e[0]]}catch(r){}}},"filter.>=":function(e,t){return function(e){try{var n=parseFloat(e[0]);if(isNaN(n)&&e[0]>=t())return[e];if(n>=parseFloat(t()))return[e[0]]}catch(r){}}},"filter.accent":function(e){return function(e){if(e[0].accent)return e}},"filter.staccato":function(e){return function(e){if(e[0].staccato)return e}}};Object(pi.a)("device.isMobile",{},"",function(){return 1},{});var bi={"device.isMobile":function(e){return e.needsLoad=!0,function(e){return Object(v.a)(e,1)[0],[I.isMobile]}}},gi=n(301),Oi=n(835),ji=n.n(Oi),ki=n(373),wi=n(415);function xi(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Si(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Si(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Si(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Pi=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t=t.map(function(e){return wi.b[e]});var r,a=[],i=xi(e.tracks);try{var o=function(){var e=r.value,i=e.attributes["stem types"];!t.every(function(e){return i.includes(e)})||n&&!i.every(function(e){return t.includes(e)})||a.push(e)};for(i.s();!(r=i.n()).done;)o()}catch(s){i.e(s)}finally{i.f()}return a};function Ei(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ti(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ti(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ti(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("zpore.loadSong",{songId:""},"loads song into the spore",function(){return 1},{});var Ai=function(e){var t,n=Ei(e.tracks);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.attributes["stem types"].length>0&&r.getSamplers()[0].disposeBuffers()}}catch(a){n.e(a)}finally{n.f()}};Object(pi.a)("zpore.clearBuffers",{},"",function(){return 1},{});var Mi=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,o,s,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=window.concurrency||3,r=new ji.a({concurrency:n}),1,o=[],s=Ei(t);try{for(u=function(){var e=c.value;o.push(r.addTask(1,Object(i.a)(a.a.mark(function t(){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ri(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}))))},s.s();!(c=s.n()).done;)u()}catch(l){s.e(l)}finally{s.f()}return r.resume(),e.next=9,Promise.all(o);case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Ri=function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.copy){e.next=2;break}return e.abrupt("return",t);case 2:return e.next=4,t.sample.fetchAudio();case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Ci=(n(543),n(359)),Ni=n(117),Ii=n(142),qi=n(119);function _i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Di(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Di(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Di(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fi(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Li=(new(n(535).a)).contractAddress,Bi="https://spores-stems.s3.us-east-2.amazonaws.com",zi=function(e){Object(u.a)(n,e);var t=Fi(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).songCache={},r.uriCache={},r.loadKey(),r.auditionPool=[],r.newInlet("audition",function(e){var t=Object(v.a)(e,1)[0];return r.audition(t)}),r.newInlet("sample swapped",function(e){var t=Object(v.a)(e,1)[0];return r.onSwapped(t)}),r.newOutlet("sample pool"),r.newOutlet("audition command"),r.newInlet("pad samples",function(e){var t=Object(v.a)(e,1)[0];return r.onPadSamples(t)}),r}return Object(s.a)(n,[{key:"onPadSamples",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.padSamples=t,this.stems){e.next=4;break}return e.next=4,this.loadStems();case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"audition",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(v.a)(t,2),r=n[0],i=n[1],o=this.samplePool[r],e.next=4,this.getSong(o.songId);case 4:s=e.sent,c=s.bpm,u=s.key,(l=o.uri).startsWith("ipfs://")&&(l=Bi+"/"+l.slice("ipfs://".length)),this.sendMessage("audition command",[i,l,c,u,this.key]),this.lastAuditionIndex=r;case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onSwapped",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStemForURI(t);case 2:this.samplePool[this.lastAuditionIndex]=e.sent,console.log("sample pool =",this.samplePool),this.sendMessage("sample pool",this.samplePool.map(function(e){return e.uri}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getStemForURI",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t,!this.uriCache[t]){e.next=3;break}return e.abrupt("return",this.uriCache[t]);case 3:return t.includes(Bi)&&(t=t.slice(Bi.length+1)),t="ipfs://"+t,r=new Ii.a(Li).from(qi.G).where("uri",t),e.next=8,r.executeQuery(!0,!0);case 8:return i=e.sent[0],this.uriCache[n]=i,console.log("returning stem for uri=",n,i),e.abrupt("return",i);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadKey",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sequencerEngine.songId){e.next=3;break}return this.key="A# Minor",e.abrupt("return");case 3:return e.next=5,this.getSong(this.sequencerEngine.songId||1);case 5:t=e.sent,this.key=t.key;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadStems",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o,s,c,u=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ii.a(Li).from(qi.H).where("stemType",wi.a),e.next=3,t.executeQuery(!0,!0);case 3:return n=e.sent.map(function(e){return e.stemId}),r=new Ii.a(Li).from(qi.G).whereIn("stemId",n).where("isLoop",!0),e.next=7,r.executeQuery(!0,!0);case 7:i=(i=e.sent).filter(function(e){return 2!==e.songId}),o=_i(i);try{for(o.s();!(s=o.n()).done;)(c=s.value).uri=Bi+"/"+c.uri.slice("ipfs://".length)}catch(a){o.e(a)}finally{o.f()}this.stems=i.filter(function(e){return!u.padSamples.filter(function(e){return e}).map(function(e){return e.getId()}).includes(e.uri)}),this.stems=Object(b.a)(this.stems),this.samplePool=this.stems.slice(0,3);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSong",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.songCache[t]){e.next=2;break}return e.abrupt("return",this.songCache[t]);case 2:return n=new Ii.a(Li).from(qi.F).where("songId",t),e.next=5,n.executeQuery(!0,!0);case 5:return this.songCache[t]=e.sent[0],e.abrupt("return",this.songCache[t]);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),n}(Ni.a);Object(pi.a)("zpore.audition",{},"Auditions sounds from stem pool",function(){return 0});Object(pi.a)("zpore.songAttribute",{trigger:"",attribute:"attribute"},"Returns the song attribute stored on-chain",function(){return 1});Object(pi.a)("zpore.stemListener",{},"Auditions sounds from stem pool");var Ji={"zpore.songAttribute":function(e,t){return e.needsLoad=!0,function(n){if(n.msg,e.sequencerEngine.songAttributes)return[e.sequencerEngine.songAttributes[t()]]}},"zpore.stemListener":function(e){var t,n=void 0,r=void 0,o=void 0,s=void 0,c=void 0,u=void 0,l=function(){var a=Pi(e.sequencerEngine,t);if(0!==!a.length){var i=a.find(function(e){return!e.attributes.cued}),l=a.find(function(e){return e.attributes.cued});l.setAttribute("cued",!1),i.setAttribute("cued",!0);var f=l.getSamplers()[0];f.replaceBuffer(n,!1),f.rawOffset=0,f.ogTempo=c,f.slices[0].transpose=0,s.pattern.changeLength(r);var h=re.a.Master.context.currentTime;l.setVolume(-128,void 0,void 0,h,.01),i.setVolume(i.volumeParameter.get(),void 0,void 0,h,.01),l.setVolume(u,void 0,void 0,h+.05,3),i.setVolume(-128,void 0,void 0,h+.05,3),e.sequencerEngine.songAttributes=o,e.sendMessage(e.outputByNumber(0),null)}},f=function(){var l=Object(i.a)(a.a.mark(function i(l){var f,h,d,p,v,m,y,b,g,O,j,k,w,x,S,P,E,T,A,M,R,C,N,I,q,_,D,F,L,B,z;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(f=l.sound,h=l.transpose,d=l.onset,p=void 0===d?0:d,v=l.bpm,m=l.stemTypes,y=l.crossFadeStems,b=void 0!==y&&y,g=l.volume,O=l.blendTime,j=void 0===O?5:O,k=l.id,w=l.contractAddress,x=l.tokenId,S=l.leakBPM,P=void 0===S?v:S,t=m,E=e.sequencerEngine,0!==!(T=Pi(E,m)).length){a.next=6;break}return a.abrupt("return");case 6:if(A=T.find(function(e){return!e.attributes.cued}),(M=T.find(function(e){return e.attributes.cued})).disabled=!1,A.disabled=!1,M.setAttribute("cued",!1),A.setAttribute("cued",!0),!ArrayBuffer.isView(f)){a.next=18;break}return a.next=15,Object(gi.b)(f,k);case 15:R=a.sent,a.next=28;break;case 18:return a.next=20,fetch(f,{method:"GET"});case 20:return C=a.sent,a.next=23,C.arrayBuffer();case 23:return N=a.sent,I=new Uint8Array(N),a.next=27,Object(gi.b)(I,f);case 27:R=a.sent;case 28:for(q=M.getSamplers()[0],_=A.getSamplers()[0],n||(n=_.audioBuffer,r=A.pattern.length(),o=e.sequencerEngine.songAttributes,s=A,c=_.tempo,u=A.getVolume()),p<0?q.rawOffset=Math.abs(p):p>0&&(D=Math.max(0,44100*p),R.getChannelData(0).set(R.getChannelData(0).subarray(D)),R.getChannelData(1).set(R.getChannelData(1).subarray(D))),q.replaceBuffer(R,!1),E.bpm,q.tempo=v,q.slices[0].transpose=h,q.slices[0].endTime=q.getDuration(),F=re.a.Master.context.currentTime,M.setVolume(-128,void 0,void 0,F,.01),A.setVolume(g,void 0,void 0,F,.01),M.setVolume(g,void 0,void 0,F+.05,j),A.setVolume(-128,void 0,void 0,F+.05,j),L=q.getDuration(),B=L/(1/(8*P/60)),z=16;2*z<B;)z*=2;M.pattern.changeLength(z),e.sequencerEngine.songAttributes||(e.sequencerEngine.songAttributes={}),e.sequencerEngine.songAttributes["crossfade-stems"]=b,e.sendMessage(e.outputByNumber(0),[w,x]);case 55:case"end":return a.stop()}},i)}));return function(e){return l.apply(this,arguments)}}();window.addEventListener("message",function(e){"load-stem"===e.data.type&&f(e.data.body),"revert-stem"===e.data.type&&l()});var h=0;return function(a){var i=Object(v.a)(a,1)[0];"clear"!==i?"revert"!==i?h++%2===0?f({sound:"https://zequencer.mypinata.cloud/ipfs/QmaiaoneTeKGBiKbUn67dXb78QDaHvPkLMYo1jtby3Yaz1",transpose:-1.1973309040960682,onset:0,volume:.5,bpm:106.71758870404672,stemTypes:[1,3,2]}):f({sound:"https://zequencer.mypinata.cloud/ipfs/QmPZbYSz7fB1ibSSH3JhpFtebjuuAdQ3BzARNqFraK5L3J",transpose:5,blendTime:6,volume:0,bpm:70,stemTypes:[1,3,2]}):l():t&&(Pi(e.sequencerEngine,t).forEach(function(e){e.pattern.changeLength(r),e.getSamplers()[0].slices[0].transpose=0}),n=void 0,r=void 0,o=void 0,s=void 0,c=void 0,u=void 0,t=void 0)}},"zpore.loadSong":function(e){var t=function(){var t=Object(i.a)(a.a.mark(function t(n){var r,i,o,s,c,u,l,f,h,d,p,v,y,b,g,O,j;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=(new Date).getTime(),"number"!==typeof n){t.next=10;break}return t.next=4,Object(m.a)([n]);case 4:if(0!==(o=t.sent).length){t.next=7;break}return t.abrupt("return");case 7:i=o[0],t.next=11;break;case 10:i=n;case 11:s=e.sequencerEngine,i.attributes&&(s.songAttributes=i.attributes),s.playing&&s.stop(),Ai(e.sequencerEngine),s.bpm=i.bpm,s.currentSubSequence.findNodeByName("playback").forEach(function(e){return e.effect.bpm=i.bpm}),c=[],u=[],l=Ei(i.stems);try{for(l.s();!(f=l.n()).done;)(h=f.value).isDefaultStem&&function(){var e="https://spores-stems.s3.us-east-2.amazonaws.com/"+h.uri.slice("ipfs://".length),t=Pi(s,h.stemTypes,!0),n=t=t.filter(function(e){return!c.includes(e)});1===h.stemTypes.length&&(n=[n[0]]);var r,a=Ei(n);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i){c.push(i);var o=u.find(function(t){return t.sample.ipfsHash===e});i.sample.ipfsHash=e,i.copy=o,u.push(i)}}}catch(l){a.e(l)}finally{a.f()}}()}catch(a){l.e(a)}finally{l.f()}return d=(new Date).getTime(),t.next=25,Mi(u);case 25:p=t.sent,v=(new Date).getTime(),console.log("downloadStems took %s ms",v-d),y=Ei(p);try{for(y.s();!(b=y.n()).done;)g=b.value,O=g.copy?g.copy.sample.audioBuffer:g.sample.audioBuffer,g.getSamplers()[0].tempo=i.bpm,g.getSamplers()[0].replaceBuffer(O,!1),g.copy=void 0}catch(a){y.e(a)}finally{y.f()}i.autoPlay&&s.play(),e.sendMessage(e.outputByNumber(0),"bang"),Object(gi.a)(),Object(ki.a)(),la.a.clearCache(),j=(new Date).getTime(),console.log("song load took %s ms",j-r);case 37:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}();return function(e){var n=Object(v.a)(e,1)[0];t(n)}},"zpore.clearBuffers":function(e){return function(t){return Object(v.a)(t,1)[0],Ai(e.sequencerEngine),["bang"]}}};Object(pi.a)("midi.cc",{ccNumber:""},"",function(){return 1},{});var Vi={"midi.cc":function(e){var t;return Object(hi.e)("midi.cc",function(n){console.log("event=",n),n.controller.number===t&&e.sendMessage(e.outputByNumber(0),n.value)}),function(e){var n=Object(v.a)(e,1)[0];t=n}}},Hi=function(e){return e};Object(pi.a)("plane.filter",{parameters:"",thenClause:"",elseClause:""},"",function(){return 1},{isHot:!0,inlets:3});var Ui={"plane.filter":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0],a=new Set(r.filter(function(e){return e}).map(function(e){return e.id})),i=t(),o=n()||Hi;return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],s=Object.keys(r).filter(function(e){return a.has(e)}).reduce(function(e,t){return e[t]=r[t],e},{}),c=Object.keys(r).filter(function(e){return!a.has(e)}).reduce(function(e,t){return e[t]=r[t],e},{}),u=i.apply(void 0,[s].concat(Object(h.a)(t.slice(1)))),l=o.apply(void 0,[c].concat(Object(h.a)(t.slice(1))));return Object(d.a)({},u,l)}}}};Object(pi.a)("plane.adsr",{level:"",attack:"",decay:"",sustain:""},"",function(){return 1},{inlets:4});var Gi=function(e,t,n,r,a,i){return e<=n?{attackStage:++e,decayStage:t,stage:e/n*i}:{attackStage:e,decayStage:++t,stage:i*(1-t/r)+a*(t/r)}},Wi={"plane.adsr":function(e,t,n,r){e.needsHotReload=!0,e.needsStart=!0,e.needsStop=!0;var a=void 0;return function(e){var i=Object(v.a)(e,1)[0];console.log("level=",i);var o={},s=0,c=0;return"start"===i||"stop"===i?i=a||0:a=i,function(){var e=arguments.length<=0?void 0:arguments[0],a={},u=Gi(s,c,t(),n(),r(),i),l=0===s;s=u.attackStage,c=u.decayStage;var f=u.stage;for(var h in e){var p=e[h];!l&&o[h]||(o[h]=p);var v=o[h],m=v.x,y=v.y;m+=Math.min(320-m,m)*f,y+=Math.min(200-y,y)*f,a[h]=Object(d.a)({},p,{x:m,y:y})}return c===n()&&(o={},s=0,c=0,console.log("completed")),console.log(a),a}}}},Ki=n(319);function Qi(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Zi=function(e){Object(u.a)(n,e);var t=Qi(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet("graphics",function(e){var t=Object(v.a)(e,1)[0];return r.graphics=t.plane}),r}return n}(Ni.a),Yi=n(160),$i=function(e){return e*e},Xi=Math.sqrt,eo=function(e,t){return Xi($i(e[0]-t[0])+$i(e[1]-t[1]))};Object(pi.a)("param",{msg:"",id:""},"");Object(pi.a)("plane.distance",{a:""},"Returns distance between inputed param and current param",function(){return 1},{inlets:2});Object(pi.a)("plane.holdDistance",{a:"",distance:""},"Returns distance between inputed param and current param",function(){return 1},{inlets:2});n(548);var to=n(439),no=n(547),ro=n(277);Object(pi.a)("plane.xy",{},"");Object(pi.a)("plane.bounce",{degrees:""},"bounces parameters by degree",function(){return 1},{isHot:!0,inlets:1});Object(pi.a)("plane.fluid",{},"fluid movement using navier stokes",function(){return 1},{isHot:!0});Object(pi.a)("plane.identity",{},"fluid movement using navier stokes",function(){return 1},{isHot:!0});var ao={"plane.bounce":function(e){return function(e){var t=Object(v.a)(e,1)[0];return Object(to.a)(function(){return t})}},"plane.identity":function(e){return e.needsLoad=!0,e.needsHotReload=!0,e.needsStart=!0,function(e){return Object(Yi.a)(e),function(e){return e}}},"plane.fluid":function(e){return e.needsLoad=!0,e.needsStart=!0,e.needsHotReload=!0,function(e){return Object(Yi.a)(e),Object(no.b)()}}},io=n(550);Object(pi.a)("plane.every",{"then condition":"",n:"","else condition":""},"Every n many iterations do then, otherwise do else",function(){return 1},{isHot:!0,inlets:3});var oo={"plane.every":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0];return Object(io.c)(t(),r,n())}}},so=n(360),co=n(114),uo=n(549);Object(pi.a)("lazy.xy",{},"",function(){return 2},{outlets:["x","y"]});Object(pi.a)("lazy.*",{x:"",y:""},"",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("lazy.+",{x:"",y:""},"",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("lazy.-",{x:"",y:""},"",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("lazy./",{x:"",y:""},"",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("lazy.sin",{x:""},"",function(){return 1},{isHot:!0,inlets:1});Object(pi.a)("plane.vecField",{"x function":"","y function":"","boundary function":""},"",function(){return 1},{isHot:!0,inlets:3});Object(pi.a)("plane.reset",{"filter boolean":"true/false"},"",function(){return 1},{});Object(pi.a)("plane.seq",{args:""},"Runs functions sequentially",function(){return 1},{isHot:!0,inlets:function(e){return e}});var lo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t=Object(v.a)(e,1)[0],r=n.map(function(e){return e()}).filter(function(e){return"function"===typeof e}),a=[t].concat(Object(h.a)(r));return ro.e.apply(void 0,Object(h.a)(a))}},fo=Object(In.a)({"lazy.xy":function(e){return e.needsLoad=!0,e.needsStart=!0,e.needsHotReload=!0,function(e){return Object(v.a)(e,1)[0],[function(e,t){return e},function(e,t){return t}]}},"lazy.+":function(e,t){return e.needsHotReload=!0,function(e){var n=Object(v.a)(e,1)[0],r=t();return function(e,t){return Object(co.A)(n,e,t)+Object(co.A)(r,e,t)}}},"lazy.-":function(e,t){return e.needsHotReload=!0,function(e){var n=Object(v.a)(e,1)[0],r=t();return function(e,t){return Object(co.A)(n,e,t)-Object(co.A)(r,e,t)}}},"lazy.*":function(e,t){return e.needsHotReload=!0,function(e){var n=Object(v.a)(e,1)[0],r=t();return function(e,t){return Object(co.A)(n,e,t)*Object(co.A)(r,e,t)}}},"lazy./":function(e,t){return e.needsHotReload=!0,function(e){var n=Object(v.a)(e,1)[0],r=t();return function(e,t){return Object(co.A)(n,e,t)/Object(co.A)(r,e,t)}}},"lazy.sin":function(e){return e.needsHotReload=!0,function(e){var t=Object(v.a)(e,1)[0];return function(e,n){return Math.sin(Object(co.A)(t,e,n))}}},"plane.seq":lo,"plane.vecField":function(e,t,n){return e.needsHotReload=!0,function(e){var r=Object(v.a)(e,1)[0],a=t(),i=n();return Object(uo.a)(r,a,i)}},"plane.reset":function(e){return e.needsLoad=!0,e.needsHotReload=!0,e.needsStart=!0,function(e){var t=Object(v.a)(e,1)[0];return Object(so.a)("bang"===t||"start"===t||t)}}},"plane.seq",lo);function ho(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var po=function(e){Object(u.a)(n,e);var t=ho(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).plane=new Ki.a(e),r.plane.groupParameters([]),r.plane.onParameterMapped=function(e){r.onParameterMapped(e)},r.group.isNoCode=!0,r.rampTime=300,r.newInlet("execute",function(e){Object(v.a)(e,1)[0];r.sequencerEngine.playing&&(r.plane.output(re.a.Master.context.currentTime+r.rampTime/1e3,0,0,!0,r.rampTime),r.sendMessage("graphics",Object(c.a)(r)))}),r.newInlet("algo",function(e){var t=Object(v.a)(e,1)[0];r.receiveAlgo(t)}),r.newInlet("algo speed",function(e){var t=Object(v.a)(e,1)[0];r.plane.onSpeed([t])}),r.newInlet("rampTime",function(e){var t=Object(v.a)(e,1)[0];r.rampTime=t}),r.newOutlet("graphics"),r}return Object(s.a)(n,[{key:"lostParameters",get:function(){return this.plane.lostParameters},set:function(e){this.plane.lostParameters=e}},{key:"loadParameters",value:function(){var e;return(e=this.plane).loadParameters.apply(e,arguments)}},{key:"stop",value:function(){this.plane.stop()}},{key:"group",get:function(){return this.plane.groups[0]}},{key:"receiveAlgo",value:function(e){this.group.script=e}},{key:"onTick",value:function(e){}},{key:"onParameterMapped",value:function(e){var t=this.plane.groups[0];t&&!t._parameters.includes(e)&&(t._parameters.push(e),e.hasGroup=t,t.updateIdToParameter())}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{plane:this.plane.getJson()})}},{key:"fromJson",value:function(e){if(e&&(Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e),e.plane)){var t=e.plane.groups;e.plane.groups=[],this.plane.fromJson(e.plane),this.plane.groups[0].fromJson(t[0]),this.group.isNodeCode=!0}}}]),n}(Ni.a);Object(pi.a)("plane.group",{},"Creates grouper for mapping/controlling parameters algorithmically",function(){return 0},{inlets:0});Object(pi.a)("plane.graphics",{},"FUCK",function(){return 0},{inlets:0});var vo=Object(d.a)({"plane.group":function(e){new po(e);return e.needsStop=!0,function(e){Object(v.a)(e,1)[0]}},"plane.graphics":function(e){new Zi(e);return e.setAttribute("primary-color","black"),function(){}},param:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.needsLoad=!0,e.needsStart=!0,e.newAttribute("min-width",50),e.width=150,e.height=50,function(t){Object(v.a)(t,1)[0];var r=n.map(function(e){return e()}).filter(function(e){return e});console.log("_ids=",r);var a=r.map(function(t){return e.sequencerEngine.idToParameter[t]}).filter(function(e){return e});return console.log("PARAMETERS =",a),[a]}},"plane.holdDistance":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];return function(e){var r=n.getCoordinates(),a={};for(var i in e)if(i!==n.id){var o=e[i],s=o.x,c=o.y,u=eo([r.x,r.y],[s,c]),l=t()/u,f=r.x,h=r.y,p=(1-l)*f+l*s,v=(1-l)*h+l*c;eo([f,h],[p,v]),a[i]=Object(d.a)({},a[i],{x:p,y:v})}else a[i]=e[i];return a}}},"plane.distance":function(e,t){return function(e){var t=Object(v.a)(e,1)[0];return function(e){var n=Object(Yi.a)(e),r=n[0],a=(n.slice(1),r[Object.keys(r)[0]]),i=t.getCoordinates();return eo([i.x,i.y],[a.x,a.y])}}}},fo,ao,oo,Wi,Ui);function mo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var yo=function(e){Object(u.a)(n,e);var t=mo(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return n}(Ni.a);Object(pi.a)("h=0.sequencer",{},"",function(){return 1},{});var bo=n(165),go=n(841);function Oo(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return jo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jo(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function jo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("trig.delay",{triggers:"",delayTime:"",delayRepeats:""},"",function(){return 1},{inlets:3});var ko={"trig.delay":function(e,t,n){var r=Object(bo.a)(Object(go.a)(t,n));return function(t){var n=Object(v.a)(t,1)[0];if(n&&3===n.length){var a=Object(v.a)(n,3),i=a[0],o=a[1],s=a[2];console.log(o,s);var c=[];0===o.length&&r([],s,re.a.Master.context.currentTime,e);var u,l=Oo(o);try{var f=function(){var t=u.value,n=r([t],s,t.time,e);n.forEach(function(e){e.outputNumber=t.outputNumber}),c=[].concat(Object(h.a)(c),Object(h.a)(n))};for(l.s();!(u=l.n()).done;)f()}catch(d){l.e(d)}finally{l.f()}return[[i,c,s]]}}}};Object(pi.a)("planar",{},"",function(){return 0},{});var wo={planar:function(e){var t=new K.a;t.loadDefaults(),t.velocity=.5,t.duration=1e6,e.needsTick=!0;var n=new Ki.a(e.subSequence,e);return n.deleteInlet("use-snapshot"),n.deleteInlet("operation"),n.deleteOutlet("macros"),n.deleteOutlet("smoke"),e.effect=n,function(e){var r=Object(Yi.a)(e),a=r[0],i=r.slice(1);if(a!==S.n)console.log(n);else{var o=Object(v.a)(i,2),s=o[0],c=o[1];n.onNewStep(s,c);var u=new $e.a(t,c,s);n.input(u),n.output(c,s,s)}}}};Object(pi.a)("generative.deterministicDensityList",{seed:"",pieces:"",density:"",length:""},"Deterministically generates a list with density length. assumes -1 is a null",function(){return 1},{inlets:4,isHot:!0});var xo={"generative.deterministicDensityList":function(e,t,n,r){return function(e){var n=Object(v.a)(e,1)[0],a=t();if(!Array.isArray(a)){var i=r()||16;a=[];for(var o=0;o<i;o++)a.push(o)}for(var s=function(e,t){var n=(Math.round(e)>>>0).toString(t).split("").map(function(e){return parseInt(e,t)}),r=0,a=function(){return n[r++%n.length]};return function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var t=0;t<e;t++)if(a()<e/2)return a();return a()}}(n,a.length),c=[],u=0;u<r();u++){var l=s(t.length);console.log("num =",l);var f=a[l];c.push(f)}return[c]}}};function So(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Po(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Po(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Po(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("list.binarySum",{list:""},"Returns decimal version of binary elements of list",function(){return 1});Object(pi.a)("list.byIndices",{list:"",indices:""},"Chooses from list by indices",function(){return 1},{isHot:!0,inlets:2,inletTypes:["list","list"],type:"list"});Object(pi.a)("list.prune",{list:"",elementToPrune:""},"Prunes a list of a chosen element",function(){return 1},{isHot:!0,inlets:2,type:"list"});Object(pi.a)("list.pruneIndices",{list:"",indicesToPrune:""},"Prunes a list of a chosen element",function(){return 1},{isHot:!0,inlets:2,type:"list"});Object(pi.a)("list.lazyNth",{nth:"",list:""},"Returns nth element of list (lazily)",function(){return 1},{inlets:2,type:"list"});Object(pi.a)("list.indexedInterleaf",{list:"",offset:"",amountToSkip:""},"Interleaves with index (before el)",function(){return 1},{inlets:3,isHot:!0,type:"list"});var Eo={"list.lazyNth":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(Array.isArray(t()))return[t()[Object(qn.a)(n,t().length)]]}},"list.indexedInterleaf":function(e,t,n){return function(e){var r,a=Object(v.a)(e,1)[0],i=[],o=t()||0,s=n()||1,c=So(a);try{for(c.s();!(r=c.n()).done;){var u=r.value;i.push(o),i.push(u),o+=s}}catch(l){c.e(l)}finally{c.f()}return[i]}},"list.byIndices":function(e,t){var n=[];return e.typed(function(e){var r,a=Object(v.a)(e,1)[0],i=[],o=0,s=So(t()||[]);try{for(s.s();!(r=s.n()).done;){var c=a[r.value%a.length];i.push(c),n[o]&&(c.id=n[o].id),o++}}catch(u){s.e(u)}finally{s.f()}return n=i,[i]})},"list.prune":function(e,t){return function(e){var n=Object(v.a)(e,1)[0],r=t();if(Array.isArray(n))return[n.filter(function(e,t){return Array.isArray(r)?!r.includes(e):e!==r})]}},"list.pruneIndices":function(e,t){return function(e){var n=Object(v.a)(e,1)[0],r=t();if(Array.isArray(n))return[n.filter(function(e,t){return Array.isArray(r)?!r.includes(t):t!==r})]}},"list.binarySum":function(e){return function(e){for(var t=Object(v.a)(e,1)[0],n=0,r=0;r<t.length;r++){var a=t[r];n+=Math.pow(2,r)*a}return[n]}}},To=new re.a.Time("32n");Object(pi.a)("sequencer.list",{list:"",slot:"",speed:""},"",function(){return 2},{inlets:3,outlets:["trigger-routing","playhead"]});var Ao={"sequencer.list":function(e,t,n){e.needsTick=!0;var r=[],a=new K.a;return function(i){var o=Object(Yi.a)(i),s=o[0],c=o.slice(1);if(s===S.n){var u=function(){for(var i=Object(v.a)(c,2),o=i[0],s=i[1],u=o*(n()||1),l=(o+1)*(n()||1),f=[],h=u;h<l;h++)if(r[h%r.length]){var d=To.toSeconds()*(h-u)/(l-h),p=s+d,m=new $e.a(a,p,o,1+(t()||0));f.push(m),setTimeout(function(){e.sendMessage(e.outputByNumber(1),u%r.length)},1e3*d)}return{v:[[S.p,f],u%r.length]}}();if("object"===typeof u)return u.v}else r=s}}};Object(pi.a)("save.hook",{},"",function(){return 1},{});Object(pi.a)("export.samples",{samples:[]},"",function(){return 1},{});Object(pi.a)("time.now",{"":""},"Returns the current time (w/ web audio time)",function(){return 1},{});Object(pi.a)("time.bar",{"":""},"Returns the time (w/ web audio time) in a bar (based on current bpm)",function(){return 1},{});var Mo={"time.now":function(e){return function(e){return Object(v.a)(e,1)[0],0===re.a.Master.context.currentTime?(new Date).getTime()/1e3:re.a.Master.context.currentTime}},"time.bar":function(e){return function(e){return Object(v.a)(e,1)[0],32*new re.a.Time("32n").toSeconds()}}};Object(pi.a)("sign",{x:""},"Returns +1 if positive, -1 if negative",function(){return 1},{});Object(pi.a)("signedDedupe",{x:""},"Passes if signs changed",function(){return 1},{});Object(pi.a)("delta",{x:""},"Passes delta",function(){return 1},{});var Ro={sign:function(e){return function(e){return Object(v.a)(e,1)[0]>=0?1:-1}},signedDedupe:function(e){var t=void 0;return function(e){var n=Object(v.a)(e,1)[0],r=n>=0?1:-1;if(r!==t)return t=r,[n];t=r}},delta:function(e){e.needsStart=!0;var t=void 0;return function(e){var n=Object(v.a)(e,1)[0];if(t){var r=n-t;return t=n,[r]}t=n}}},Co=n(272),No=n.n(Co);Object(pi.a)("abi.encode",{},"",function(){return 1},{});function Io(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var qo=function(e){Object(u.a)(n,e);var t=Io(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet("loop",function(e){var t=Object(v.a)(e,1)[0];return r.onLoop(t)}),r.newInlet("choose preset",function(e){var t=Object(v.a)(e,1)[0];return r.onPreset(t)}),r.newInlet("loop-start",function(e){var t=Object(v.a)(e,1)[0];r.loopStart=t}),r.newInlet("loop-length",function(e){var t=Object(v.a)(e,1)[0];r.loopLength=t}),r.presets=[],r.newPreset(),r}return Object(s.a)(n,[{key:"track",get:function(){return this._track},set:function(e){this._track=e,this.applyLoop()}},{key:"loopStart",get:function(){return this.currentPreset.loopStart},set:function(e){this.currentPreset.loopStart=e,this.applyLoop()}},{key:"loopLength",get:function(){return this.currentPreset.loopLength},set:function(e){this.currentPreset.loopLength=e,this.applyLoop()}},{key:"applyLoop",value:function(){this.track&&(this.track.loopStart=this.loopStart,this.track.loopLength=this.loopLength,this.track.isLooping=this.isLooping)}},{key:"newPreset",value:function(){this.presets.push({loopStart:0,loopLength:8}),this.currentPreset=this.presets[this.presets.length-1]}},{key:"onLoop",value:function(e){this.isLooping=e,this.applyLoop()}},{key:"onPreset",value:function(e){this.currentPreset=this.presets[e%this.presets.length]}},{key:"getJson",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var i=(e=Object(fe.a)(Object(f.a)(n.prototype),"getJson",this)).call.apply(e,[this].concat(r));return i.presets=this.presets,i.track=this.track.trackNumber,i.isLooping=this.track.isLooping,i}},{key:"fromJson",value:function(e){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e),this.onLoop(e.isLooping),void 0!==e.track&&(this.track=this.sequencerEngine.tracks[e.track]),e.presets&&(this.presets=e.presets,this.currentPreset=this.presets[0],this.applyLoop())}}]),n}(Ni.a);Object(pi.a)("tr.loop",{looping:"",trackNumber:"",loopStart:"",loopLength:""},"",function(){return 1},{inletTypes:["number","number","number","number"],inlets:4,isHot:!0});Object(pi.a)("tr.loopUI",{},"",function(){return 0},{inlets:0});var _o=new oi.a;Object(pi.a)("svg.extractColors",{"svg string":""},"Extracts all the colors from an svg element, including the gradients");var Do={"svg.extractColors":function(){return function(e){for(var t=Object(v.a)(e,1)[0],n=[],r=0,a=['stop-color="','fill="','fill="'];r<a.length;r++)for(var i=a[r],o=t.indexOf(i);o>-1;){var s=(t=t.slice(i.length+o)).indexOf('"'),c=t.slice(0,s);c.startsWith("hsl")?c=_o.hslToHex(c):(c.startsWith("url")||"transparent"===c)&&(c=null),c&&n.push(c),o=t.indexOf(i)}return[n]}}},Fo=n(310);Object(pi.a)("random.seed",{seed:""},"Generates a pseudo-random number based on seed");var Lo={"random.seed":function(e){var t=void 0;return function(e){var n=Object(v.a)(e,1)[0];return n!==t&&(Object(Fo.a)("0x"+n.toString(16)),t=n),Object(Fo.b)()}}},Bo=function(e,t,n){return[e*Math.cos(n)+t*Math.sin(n),t*Math.cos(n)-e*Math.sin(n)]};Object(pi.a)("lengthCoord",{"[x,y]":""},"Returns length of vector from center");var zo=function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1];return Math.sqrt(Math.pow(n,2)+Math.pow(r,2))},Jo=function(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))};Object(pi.a)("distance",{"[x1,y1]":"","[x2,y2]":""},"Returns length of vector from center",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("quadrantFilter",{"[index, x, y]":"","quadrant signs list":""},"Returns length of vector from center",function(){return 1},{inlets:2});Object(pi.a)("quadrantLength",{"[x, y]":""},"Returns length of vector from center by quadrant",function(){return 1},{inlets:1});Object(pi.a)("quadrant.coord",{"[a,b,c,d]":""},"Returns 2-component vector based on 4-component vector",function(){return 1},{inlets:1});Object(pi.a)("quadrant.triangles",{"[x,y]":""},"Returns 2-component vector based on 4-component vector",function(){return 1},{inlets:1});Object(pi.a)("rotate2D",{xy:"",angle:""},"rotate by angle",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("coord.limit",{coordinate:"","minimum distance":""},"Passes message if the distance is at least minimum from last",function(){return 1},{inlets:2});Object(pi.a)("coord.interpolate",{coordinate1:"",coordinate2:"",interpolation:""},"INterpolates 2 coordinates",function(){return 1},{inlets:3,isHot:!0});var Vo={"coord.interpolate":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0];if(t()){var a=t(),i=n();return[[(1-i)*r[0]+i*a[0],(1-i)*r[1]+i*a[1]]]}}},"coord.limit":function(e,t){var n=void 0;return function(e){var r=Object(v.a)(e,1)[0];return 0===r[0]&&0===r[1]?(n=r,[r]):n?Jo(n[0],n[1],r[0],r[1])>t()?(n=r,[r]):void 0:(n=r,[r])}},"quadrant.triangles":function(e){return function(e){var t=Object(v.a)(e,1),n=Object(v.a)(t[0],2),r=n[0],a=n[1],i=(Math.abs(r),Math.abs(a),[0,0,0,0]);return r>0&&a>0?i=[r*a,0,0,0]:r>0&&a<0?i=[0,r*Math.abs(a),0,0]:r<0&&a<0?i=[0,0,Math.abs(r)*Math.abs(a),0]:r<=0&&a>=0&&(i=[0,0,0,Math.abs(r)*Math.abs(a)]),[i]}},quadrantFilter:function(e,t){return function(e){for(var n=Object(v.a)(e,1),r=Object(v.a)(n[0],3),a=r[0],i=r[1],o=r[2],s=[],c=0;c<t().length;c+=2)s.push([t()[c],t()[c+1]]);var u=s[a];if(u&&!(u[0]>0&&i<0)&&!(u[1]>0&&o<0)&&!(u[0]<0&&i>0)&&!(u[1]<0&&o>0))return[[i,o]]}},quadrantLength:function(e){return function(e){var t=Object(v.a)(e,1),n=Object(v.a)(t[0],2),r=n[0],a=n[1],i=zo([r,a]);return r>0&&a>0?[[i,0,0,0]]:r>0&&a<0?[[0,0,0,i]]:r<0&&a<0?[[0,0,i,0]]:r<0&&a>0?[[0,i,0,0]]:[[0,0,0,0]]}},"quadrant.coord":function(e){return function(e){var t=Object(v.a)(e,1),n=Object(v.a)(t[0],4),r=n[0],a=n[1],i=n[2],o=n[3],s=Math.sqrt(Math.pow(r,2),2),c=Math.sqrt(Math.pow(a,2),2),u=Math.sqrt(Math.pow(i,2),2),l=Math.sqrt(Math.pow(o,2),2),f=[s,s],h=[c,-c],d=[-u,-u],p=[-l,l];return[[f[0]+h[0]+d[0]+p[0],f[1]+h[1]+d[1]+p[1]]]}},distance:function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(Array.isArray(n)&&Array.isArray(t())){var r=Object(v.a)(n,2),a=r[0],i=r[1],o=t(),s=Object(v.a)(o,2),c=s[0],u=s[1];return Jo(a,i,c,u)}}},rotate2D:function(e,t){return function(e){var n=Object(v.a)(e,1)[0];return[Bo(n[0],n[1],t())]}}};Object(pi.a)("boundFilter",{coord:"",x:"",y:""},"Passes if coord is within bound",function(){return 1},{inlets:3});var Ho=n(1973);Object(pi.a)("three.text",{text:"",x:"",y:"",color:"",size:"",opacity:"",font:"",maxWidth:"",lineHeight:""},"Outputs text in three js to be added to scene",function(){return 1},{isHot:!0,inlets:9});var Uo={"three.text":function(e,t,n,r,a,i,o,s,c){var u=new Ho.a,l=1;Object(hi.e)("canvas.size",function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1];l=r/n});var f=!1;return function(e){var h=Object(v.a)(e,1)[0],d=r()?parseInt(r().replace(/^#/,""),16):16777215,p=t()||0,m=n()||0;if(u.text=h,u.position.x=p*l,u.position.y=m,u.strokeOpacity=1,u.position.z=.1,u.color=d,u.align="center",s()&&(u.maxWidth=s()),c()&&(u.lineHeight=c()),u.fontSize=a()||.1,void 0!==i()&&(u.strokeOpacity=i(),u.fillOpacity=i()),o()?u.font=o():u.font="/DecimaCyr.woff",u.sync(function(){}),!f)return f=!0,[u]}}},Go=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var i=[];return function(n){var a=Object(v.a)(n,2),o=a[0],s=a[1];Array.isArray(o)&&(s=o[1],o=o[0]);var c=s||o;if("node"===o)return t;if("disconnect"!==o){var u=void 0;return c&&!i.includes(c)&&(c.connect&&(c.connect(t),i.push(c)),u=[t]),e([c]),r.forEach(function(e){var t=Object(v.a)(e,2);return(0,t[0])([(0,t[1])()])}),u}i.includes(c)&&(c.disconnect(t),i=i.filter(function(e){return e!==c}))}},Wo=function(e,t){var n=[],r=function(r){var a=e[r];"string"===typeof a&&(a=function(t){return e[r]=t});var i=Go(function(e){var n=Object(v.a)(e,1)[0];if("function"===typeof a&&isNaN(n)&&void 0!==n&&a(n),void 0!==n&&!isNaN(n)){t[r]();a.value=n}},a);n.push([i,t[r]])};for(var a in t)r(a);return[e].concat(n)};Object(pi.a)("speakers~",{source:""},"speakers",function(){return 1},{isHot:!0});Object(pi.a)("osc~",{trigger:"bang triggers",frequency:"frequency","osc type":"oscillator type"},"basic oscillator",function(){return 1},{inlets:3,isHot:!0});Object(pi.a)("gain~",{source:"",level:"",rampTime:""},"plays buffer",function(){return 1},{isHot:!0,inlets:3});Object(pi.a)("effect~",{source:"source",name:"effect name"},"effect",function(){return 1},{inlets:2,isHot:!0});Object(pi.a)("filter~",{source:"source",cutoff:"cutoff",resonance:"resonance",type:"type"},"filter",function(){return 1},{inlets:4,isHot:!0});Object(pi.a)("trx.out~",{trackNumber:"source"},"Sends output of track out from track into here",function(){return 1},{inlets:1,isHot:!0});Object(pi.a)("trx.in~",{source:"source",trackNumber:"source"},"Sends output of node into the track",function(){return 1},{inlets:2,isHot:!0});Object(pi.a)("parameter.in~",{source:"source",id:"id"},"filter",function(){return 0},{inlets:2,isHot:!0});Object(pi.a)("parameter.out~",{source:"source",id:"id"},"filter",function(){return 1},{inlets:2,isHot:!0});var Ko={"effect~":function(e,t){e.needsHotReload=!0,e.needsDisconnect=!0;var n=new re.a.Gain(1),r=new re.a.Gain(1),a=void 0;return function(e,t,n){var r=[];return function(a){var i=Object(v.a)(a,2),o=i[0],s=i[1];Array.isArray(o)&&(s=o[1],o=o[0]);var c=s||o;if("node"===o)return t;if("disconnect"!==o){var u=void 0;return c&&!r.includes(c)&&(c.connect&&(c.connect(t),r.push(c)),u=[n]),e([c]),u}r.includes(c)&&(c.disconnect(t),r=r.filter(function(e){return e!==c}))}}(function(n){Object(v.a)(n,1)[0];var i=t();if(i=i.replaceAll("-"," "),!a||a.name!==i){var o=$.d[i];o&&(a=o(e.sequencerEngine),r.connect(a.effectNode),a.connect(r),e.audioEffect=a)}},n,r)},"speakers~":function(e){e.needsHotReload=!0,e.needsDisconnect=!0;var t=Wo(e.sequencerEngine.channelMixer.masterChannel.input),n=Object(v.a)(t,1)[0];return Go(function(){return 0},n)},"gain~":function(e,t,n){e.needsHotReload=!0,e.needsDisconnect=!0;var r=Wo(new re.a.Gain(1),{gain:t}),a=Object(Yi.a)(r),i=a[0],o=a.slice(1);return console.log("GAIN INIT",i,o),Go.apply(void 0,[function(){},i].concat(Object(h.a)(o)))},"osc~":function(e,t,n){e.needsHotReload=!0,e.needsDisconnect=!0;var r=Wo(re.a.Master.context._context.createOscillator(),{frequency:t,type:n}),a=Object(Yi.a)(r),i=a[0],o=a.slice(1),s=!1;return Go.apply(void 0,[function(e){Object(v.a)(e,1)[0],s||(console.log("STARTING OSC",i),i.start(),s=!0)},i].concat(Object(h.a)(o)))},"filter~":function(e,t,n,r){e.needsHotReload=!0,e.needsDisconnect=!0;var a=Wo(re.a.Master.context._context.createBiquadFilter(),{frequency:t,Q:n,type:r}),i=Object(Yi.a)(a),o=i[0],s=i.slice(1);return Go.apply(void 0,[function(e){Object(v.a)(e,1)[0]},o].concat(Object(h.a)(s)))},"trx.in~":function(e,t){e.needsHotReload=!0,e.needsDisconnect=!0;var n=Wo(new re.a.Gain(1),{}),r=Object(Yi.a)(n),a=r[0],i=r.slice(1),o=void 0;return Go.apply(void 0,[function(n){Object(Yi.a)(n);var r=t()||0;e.sequencerEngine.tracks[r]&&r!==o&&(a.connect(e.sequencerEngine.tracks[r].gainNode),console.log("connecting node to track=",e.sequencerEngine.tracks[r]),void 0!==o&&a.disconnect(e.sequencerEngine.tracks[o].gainNode),o=r)},a].concat(Object(h.a)(i)))},"trx.out~":function(e){e.needsHotReload=!0,e.needsDisconnect=!0;var t=Wo(new re.a.Gain(1),{}),n=Object(Yi.a)(t),r=n[0],a=n.slice(1),i=void 0;return Go.apply(void 0,[function(t){var n=Object(v.a)(t,1)[0];e.sequencerEngine.tracks[n]&&n!==i&&(e.sequencerEngine.tracks[n].muteableNode.connect(r),void 0!==i&&e.sequencerEngine.tracks[i].muteableNode.disconnect(r),i=n)},r].concat(Object(h.a)(a)))},"parameter.in~":function(e,t){e.needsHotReload=!0,e.needsDisconnect=!0;var n,r=Wo(new re.a.Gain(1),{}),a=Object(Yi.a)(r),i=a[0],o=a.slice(1);return Go.apply(void 0,[function(r){Object(v.a)(r,1)[0],console.log("parameter_in called"),n||(n=e.sequencerEngine.idToParameter[t()]).audioParam&&i.connect(n.audioParam)},i].concat(Object(h.a)(o)))},"parameter.out~":function(e,t){e.needsHotReload=!0,e.needsDisconnect=!0;var n,r=Wo(new re.a.Gain(1),{}),a=Object(Yi.a)(r),i=a[0],o=a.slice(1);return Go.apply(void 0,[function(r){Object(v.a)(r,1)[0],n||(n=e.sequencerEngine.idToParameter[t()]).audioParam&&n.audioParam.connect(i)},i].concat(Object(h.a)(o)))}},Qo=new oi.a;Object(pi.a)("publish",{data:"",type:""},"Publishes a message to a queue that can be subscribed to",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("subscribe",{bang:"",type:""},"Subscribes to a message",function(){return 1},{isHot:!0,inlets:2});var Zo=function(e){for(var t=[],n=e.subSequence;!n.isRoot();)t.push(n),n=n.subSequence;return t};function Yo(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return $o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $o(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function $o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Xo=new oi.a;Object(pi.a)("epublish",{data:"",type:""},"Publishes a message to a queue that can be subscribed to",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("esubscribe",{bang:"",type:""},"Subscribes to a message (bounded to subpatch)",function(){return 1},{isHot:!0,inlets:2});function es(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ts(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ts(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ts(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("sfilter",{msg:"",type:"",field:""},"Filters messages coming in based on a type and (field) subscribed to",function(){return 1},{isHot:!0,inlets:3});Object(pi.a)("esfilter",{msg:"",type:"",field:""},"Filters messages coming in based on a type and (field) subscribed to (subpatch encapsuated version)",function(){return 1},{isHot:!0,inlets:3});var ns={publish:function(e,t){e.needsHotReload=!0;var n=void 0;return function(r){var a=Object(v.a)(r,1)[0];Object(hi.c)(t(),a),e.flash(),t()!==n&&(e.attributes["primary-color"]=Qo.getColorForHash(t())),n=t()}},subscribe:function(e,t){e.needsLoad=!0,e.needsHotReload=!0;var n=void 0,r=function t(r){e.outlets?e.sendMessage(e.outputByNumber(0),r):Object(hi.g)(n,t)};return function(a){if(Object(v.a)(a,1)[0],t()!==n&&(n&&Object(hi.g)(n,r),n=t(),Object(hi.e)(t(),r),e.attributes["primary-color"]=Qo.getColorForHash(t())),t()){var i=Object(hi.d)(t());void 0!==i[0]&&r(i[0])}}},epublish:function(e,t){e.needsHotReload=!0;var n=void 0;return function(r){var a=Object(v.a)(r,1)[0];Object(hi.c)(e.subSequence.id+"."+t(),a),t()!==n&&(e.attributes["primary-color"]=Xo.getColorForHash(t())),n=t()}},esubscribe:function(e,t){e.needsLoad=!0;var n=void 0,r=Zo(e).map(function(e){return e.id+"."}),a=function t(a){e.outlets?e.sendMessage(e.outputByNumber(0),a):r.forEach(function(e){return Object(hi.g)(e+n,t)})};return function(i){if(Object(v.a)(i,1)[0],t()!==n&&(n&&r.forEach(function(e){return Object(hi.g)(e+n,a)}),n=t(),r.forEach(function(e){Object(hi.e)(e+t(),a)}),e.attributes["primary-color"]=Xo.getColorForHash(t())),t()){var o,s=Yo(r);try{for(s.s();!(o=s.n()).done;){var c=o.value,u=Object(hi.d)(c+t());void 0!==u[0]&&a(u[0])}}catch(l){s.e(l)}finally{s.f()}}}},sfilter:function(e,t,n){var r=function(t){e.sendMessage(e.outputByNumber(0),t)},a=function(e,t){var a=n();a?e[a]&&r(t):e&&r(t)},i=void 0;return function(e){var n=Object(v.a)(e,1)[0];if(i&&Object(hi.g)(t(),i),t()){i=function(e){a(e,n)},Object(hi.e)(t(),i);var r=Object(hi.d)(t());void 0!==r[0]&&a(r[0],n)}t()}},esfilter:function(e,t,n){var r=function(t){e.sendMessage(e.outputByNumber(0),t)},a=function(e,t){var a=n();a?e[a]&&r(t):e&&r(t)},i=void 0;return function(n){var r=Object(v.a)(n,1)[0],o=Zo(e).map(function(e){return e.id+"."});if(i&&o.forEach(function(e){return Object(hi.g)(e+t(),i)}),t()){i=function(e){a(e,r)},o.forEach(function(e){return Object(hi.e)(e+t(),i)});var s,c=es(o);try{for(c.s();!(s=c.n()).done;){var u=s.value,l=Object(hi.d)(u+t());void 0!==l[0]&&a(l[0],r)}}catch(f){c.e(f)}finally{c.f()}}t()}}},rs=n(984);function as(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return is(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return is(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function is(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("chord.gen",{progression:"",numeral:"",voices:""},"Generates a chord adding it to the progression (coming in on the left-inlet)",function(){return 1},{inlets:function(e){return e+1},isHot:!0});Object(pi.a)("chord.select",{progression:"",number:""},"Outputs a chord based on the number in the right inlet",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("chord.voice",{chord:"",scale:"",voices:""},"Outputs a list of notes for the chord given at a scale",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("chord.trigger",{times:"",notes:"",durations:"",outputs:"",inputs:"",inputVoiceMapping:""},"Outputs a list of triggers based on the notes, times, and durations",function(){return 1},{inlets:6});var os={"chord.gen":function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return e.needsHotReload=!0,function(e){var n=Object(v.a)(e,1)[0];"bang"===n&&(n=[]);var a=t(),i=r.map(function(e){return e()}).filter(function(e){return void 0!==e});return[[].concat(Object(h.a)(n),[[a].concat(Object(h.a)(i))])]}},"chord.select":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];return[n[(t()||0)%n.length]]}},"chord.voice":function(e,t){return e.needsHotReload=!0,function(e){var n=Object(v.a)(e,1)[0];Array.isArray(n)||(n=[n]);var r=n,a=Object(Yi.a)(r),i=a[0],o=a.slice(1);i--;var s,c=t()||[0,2,3,5,7,8,10],u=[],l=as(o);try{for(l.s();!(s=l.n()).done;){var f=s.value-1,h=c[(i+f)%c.length];i+f>=c.length&&(h+=12),u.push(h)}}catch(d){l.e(d)}finally{l.f()}return[u]}},"chord.trigger":function(e,t,n,r,a,i){return e.needsHotReload=!0,function(e){var o=Object(v.a)(e,1)[0]||[re.a.Master.context.currentTime];"bang"===o&&(o=[re.a.Master.context.currentTime]);var s,c=t()||[],u=n()||[],l=r()||[1],f=[];if(Array.isArray(u)||(u=[u]),Array.isArray(o)){if("trigger"===o[0]){o[1]=o[1].filter(function(e){return-1!==e.outputNumber});var h=o;f=o[1].map(function(e){return e.outputNumber}),o=o[1].map(function(e){return e.time}),s=h[1].map(function(e){return e.stepData.velocity}),n()||(u=h[1].map(function(e){return e.stepData.duration}))}}else o=[o];if(0!==o.length){Array.isArray(l)||(l=[l]);var d=[],p=0;if(!f.every(function(e){if(a()){var t=a();if(Array.isArray(t)){if(!t.includes(e))return!0}else if(t!==e)return!0}return!1})){var m,y=cs(i()||{}),b=ss(y),g={},O=as(c);try{for(O.s();!(m=O.n()).done;){var j=m.value,k=p++,w=k,x=f[k%f.length],P=b[w];if(!i()||void 0===P||P===x||!f.includes(P)){var E=new K.a;E.transpose=j,E.duration=u[k%u.length];var T=l[k%l.length],A=o[k%o.length];A.duration&&(E.duration=A.duration),A.time&&(A=A.time);var M=new $e.a(E,A,0,T);s&&(E.velocity=s[p%s.length]),M.keepTranspose=!0,g[k]=x,d.push(M)}}}catch(R){O.e(R)}finally{O.f()}return[[S.p,d]]}}}}},ss=function(e){var t={};for(var n in e)t[e[n]]=parseInt(n);return t},cs=function(e){for(var t={},n=0;n<e.length;n+=2){var r=e[n],a=e[n+1];t[r]=a}return t};Object(pi.a)("key.extract",{"audio buffer":"to extract"},"extract");Object(pi.a)("key.offset",{key:""},"Returns the number offset from C for a key string");var us=function(e){var t=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],n=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return function(e){var r=Object(v.a)(e,1)[0],a=t.indexOf(r);return a>=0?a:n.indexOf(r)}};Object(pi.a)("key.transform",{key1:"",key2:""},"Returns the transpose necessary to keep two sounds in key",function(){return 1},{isHot:!0,inlets:2});var ls={"key.extract":function(e){var t;return function(n){var r=Object(v.a)(n,1)[0];try{t||((t=new Worker(window.isNFT?"keyWorker.js":"/keyWorker.js",{type:"module"})).onmessage=function(t){var n=t.data,r=n.key,a=n.scale,i=n.strength;e.sendMessage(e.outputByNumber(0),[r,a,i])}),t.postMessage(r.getChannelData(0))}catch(a){}}},"key.offset":us,"key.transform":function(e,t){var n=us();return function(e){var r=Object(v.a)(e,1)[0];if(t()&&r){var a=Object(v.a)(r,2),i=a[0],o=a[1],s=t(),c=Object(v.a)(s,2),u=c[0],l=c[1],f=n(i),h=n(u);if(o===l){var d=Object(qn.a)(f-h,12);return d>6&&(d-=12),d}var p=Object(qn.a)(f-(h-3),12);return p>6&&(p-=12),p}}}};Object(pi.a)("disablePlay",{},"Disables project from playing or showing press to start");Object(pi.a)("url.searchParam",{bang:"","parameter to get":""},"Returns the url search param, the page was loaded with");var fs={"url.searchParam":function(e,t){return e.needsLoad=!0,function(e){Object(v.a)(e,1)[0];var n=window.urlSearchParams.get(t());return Object(ke.a)(n)?parseFloat(n):n||void 0}}},hs=n(307);function ds(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ps(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ps(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ps(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function vs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ms=function(e){Object(u.a)(n,e);var t=vs(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).samples=[],r.bpms={},r.basses={},r.bpmSamples=[],r.cursor=0,r.BPM_RANGE=25,r.newInlet("tag",function(e){var t=Object(v.a)(e,1)[0];return r.onTag(t)}),r.newInlet("choose",function(e){var t=Object(v.a)(e,1)[0];return r.choose(t)}),r.newInlet("nearBPM",function(e){var t=Object(v.a)(e,1)[0];return r.nearBPM(t)}),r.newInlet("shuffle ordering",function(e){var t=Object(v.a)(e,1)[0];return r.shuffleOrdering(t)}),r.newInlet("next sample",function(e){Object(v.a)(e,1)[0];return r.nextSample()}),r.newInlet("previous sample",function(e){Object(v.a)(e,1)[0];return r.previousSample()}),r.newInlet("bpm window",function(e){var t=Object(v.a)(e,1)[0];return r.BPM_RANGE=t}),r.newInlet("sample subset",function(e){var t=Object(v.a)(e,1)[0];return r.onSampleSubset(t)}),r.newInlet("set samples",function(e){var t=Object(v.a)(e,1)[0];return r.setSamples(t)}),r.newInlet("remove current sample",function(e){Object(v.a)(e,1)[0];return r.removeCurrentSample()}),r.newOutlet("sample hash"),r.newOutlet("sample and bpm"),r.newOutlet("is bass"),r}return Object(s.a)(n,[{key:"removeCurrentSample",value:function(){var e=this.bpmSamples[Object(qn.a)(this.cursor,this.bpmSamples.length)][0];delete this.bpms[e],this.bpmSamples.splice(this.cursor,1),this.samples=this.samples.filter(function(t){return t!==e}),this.sendCurrentSample()}},{key:"setSamples",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.bpmSamples=t.map(function(e){return[e]}),e.next=3,la.a.preloadSound(this.bpmSamples[0][0]);case 3:e.sent,this.sendCurrentSample();case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onSampleSubset",value:function(e){this.sampleSubset=e,this.lastBPM&&this.shuffleOrdering(this.lastBPM)}},{key:"shuffleOrdering",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.lastBPM=t,n=Object(b.a)(this.getSamplesNearestToBPM(t)),this.bpmSamples=n,this.cursor=0,this.bpmSamples[0]){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,la.a.preloadSound(this.bpmSamples[0][0]);case 8:e.sent,this.sendCurrentSample();case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendCurrentSample",value:function(){var e=Object(qn.a)(this.cursor,this.bpmSamples.length),t=this.bpmSamples[e];if(t){var n=Object(v.a)(t,2),r=n[0],a=n[1];this.basses[r]?this.sendMessage("is bass",1):this.sendMessage("is bass",0),this.sendMessage("sample hash",r),this.sendMessage("sample and bpm",[r,a]),this.preloadAdjacents()}}},{key:"preloadAdjacents",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.bpmSamples[this.cursor],t=Object(qn.a)(this.cursor+1,this.bpmSamples.length),this.bpmSamples[t]){e.next=4;break}return e.abrupt("return");case 4:if(this.bpmSamples[t]){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,la.a.preloadSound(this.bpmSamples[t][0]);case 8:return e.sent,0,n=Object(qn.a)(this.cursor-1,this.bpmSamples.length),e.next=13,la.a.preloadSound(this.bpmSamples[n][0]);case 13:e.sent,0;case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"nextSample",value:function(){this.cursor++,this.sendCurrentSample()}},{key:"previousSample",value:function(){this.cursor--,this.sendCurrentSample()}},{key:"nearBPM",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(v.a)(t,2),r=n[0],i=n[1],o=this.getSamplesNearestToBPM(r),this.sendMessage("sample hash",o[i%o.length][0]),this.sendMessage("sample and bpm",[o[i%o.length]]);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSamplesNearestToBPM",value:function(e){var t=[],n=Object.keys(this.bpms).slice(0,this.sampleSubset||this.bpms.length),r=this.samples.slice(0,this.sampleSubset||this.samples.length);if(!isNaN(e)){var a,i=ds(n);try{for(i.s();!(a=i.n()).done;){var o=a.value,s=this.bpms[o];isNaN(s)&&(s=120),Math.abs(e-s)<this.BPM_RANGE&&t.push([o,s])}}catch(h){i.e(h)}finally{i.f()}}if(0===t.length){var c,u=ds(r);try{for(u.s();!(c=u.n()).done;){var l=c.value,f=this.bpms[l];t.push([l,f])}}catch(h){u.e(h)}finally{u.f()}}return t}},{key:"onTag",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ii.a((new hs.a).contractAddress).from(qi.Z),Array.isArray(t)?n.whereIn("tag",t):n.where("tag",t),e.next=4,n.executeQuery();case 4:return r=e.sent,i=r.map(function(e){return e.ipfsHash}),this.samples=i,n=new Ii.a((new hs.a).contractAddress).from(qi.V).whereIn("ipfsHash",i),e.next=10,n.executeQuery();case 10:(r=e.sent).reverse(),o={},r.forEach(function(e){var t=ys(e.title);isNaN(t)||(o[e.ipfsHash]=t),e.title.includes("bass")&&(s.basses[e.ipfsHash]=!0)}),this.bpms=o,console.log("BASSES=",this.basses);case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"choose",value:function(e){var t=this.samples[e];t&&this.sendMessage("sample hash",t)}},{key:"getJson",value:function(){var e=Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{samples:this.samples,bpms:this.bpms,basses:Object(d.a)({},this.basses)});return console.log("saving samples json=",e),e}},{key:"fromJson",value:function(e){console.log("samples JSON =",e),Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e),this.samples=e.samples,this.bpms=e.bpms,e.basses&&(this.basses=e.basses)}}]),n}(Ni.a),ys=function(e){var t=e.trim().split(" ");e=t[1];for(var n="",r=0;r<e.length;r++){var a=e[r];if(!Object(ke.a)(a))break;n+=a}return parseInt(n)};Object(pi.a)("samples.tag",{},"Stores a list of samples with tag for fetching",function(){return 0},{inlets:0});Object(pi.a)("image.crop",{"image object":"",x:"",y:"","source width":"","source height":"","dest width":"","dest height":""},"crops an image coming as message in left-inlet",function(){return 1},{inlets:7});Object(pi.a)("image.download",{"image data URL":"",filename:""},"downlaods an image coming as message in left-inlet",function(){return 1},{inlets:2});var bs={"image.download":function(e,t){return function(e){var n=Object(v.a)(e,1)[0],r="".concat(t(),".png"),a=document.createElement("a");return a.download=r,a.href=n.src||n,a.click(),["bang"]}},"image.crop":function(e,t,n,r,a,i,o){return function(s){var c=Object(v.a)(s,1)[0];c.addEventListener("load",function(){var s=document.createElement("canvas"),u=s.getContext("2d");s.width=i(),s.height=o(),u.drawImage(c,t(),n(),r(),a(),0,0,i(),o());var l=s.toDataURL("image/png");e.sendMessage(e.outputByNumber(0),l)})}}},gs=n(302),Os=function(){function e(t,n,r){Object(o.a)(this,e),this.usePoints=r?1:0,this.index=0,this.width=t,this.height=n,this.idToWaveform={},this.idToBasicWaveform={},this.reversedIdToWaveform={}}return Object(s.a)(e,[{key:"getBasicWaveform",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e!==gs.a;return new Promise(function(a,i){r&&e in n.idToBasicWaveform?a(n.idToBasicWaveform[e]):n.computeBasicWaveform(t).then(function(t){r&&(n.idToBasicWaveform[e]=t),a(t)})})}},{key:"getWaveform",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e!==gs.a,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.height;return new Promise(function(o,s){n.computeWaveformPoints(t,0,[],function(t){r&&(n.idToWaveform[e]=t),o(t)},a,i)})}},{key:"getReversedWaveform",value:function(e,t){var n=this;return new Promise(function(r,a){e in n.reversedIdToWaveform?r(n.reversedIdToWaveform[e]):n.computeWaveformPoints(t,0,[],function(t){n.reversedIdToWaveform[e]=t,r(t)})})}},{key:"computeWaveformPoints",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i){var o,s,c,u,l,f,h,d,p,v,m,y,b,g=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=g.length>4&&void 0!==g[4]?g[4]:1,s=g.length>5?g[5]:void 0,o=1,c=this.width,!((n+1)*c>this.width)){e.next=7;break}return i([]),e.abrupt("return");case 7:for(u=Math.floor(t.length/this.width),l=(l=this.isRaw?t:t.getChannelData(0)).subarray(c*n*u,c*(n+1)*u),f=window.api.create_buffer(l.length),Math.min((n+1)*c,this.width),window.Module.HEAPF32.set(l,f>>2),window.api.getColoredWaveform(f,c,s,l.length,u,c*n,o,this.usePoints),h=window.api.get_result_pointer(),d=new Uint16Array(window.Module.HEAP16.buffer,h,7*c/o),p=[],v=0;v<d.length;v+=7)m=[d[v+4],d[v+5],d[v+6]],y=d[v+3],p.push({x:d[v],y:d[v+1],width:d[v+2],height:y,rgb:m});b=this,window.api.destroy_buffer(f),setTimeout(function(){b.computeWaveformPoints(t,n+1,r.concat(p),function(e){i(p.concat(e))})},2);case 21:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"computeBasicWaveform",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.index++,n=this.index,r=Math.floor(t.length/this.width),i=t.getChannelData(0),o=window.api.create_buffer(i.length),this.width,window.Module.HEAPF32.set(i,o>>2),window.api.getWaveform(o,parseInt(this.width),parseInt(this.height),i.length,r),s=window.api.get_result_pointer(),c=new Uint16Array(window.Module.HEAP16.buffer,s,3*this.width),u=[],!(n<this.index)){e.next=13;break}return e.abrupt("return",void 0);case 13:for(l=0,f=0;f<3*this.width;f+=3)u.push({x:l,y:c[f+1],rmsY:c[f+2]}),l++;return window.api.destroy_buffer(o),e.abrupt("return",u);case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function js(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ks(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ks(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ks(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("waveform.track",{trackNumber:""},"Returns audio buffer for track",function(){return 2},{outlets:["buffer","duration"]});Object(pi.a)("waveform.slice",{buffer:"",startTime:"",duration:""},"Returns audio buffer for track",function(){return 1},{isHot:!0,inlets:3});Object(pi.a)("waveform.sliceBackwards",{buffer:"",time:"",duration:""},"Returns audio buffer for track",function(){return 1},{isHot:!0,inlets:3});Object(pi.a)("waveform.color",{audioBuffer:"",width:"",isRawBuffer:""},"Returns a colorful waveform for an audio buffer",function(){return 1},{inlets:3});Object(pi.a)("waveform.jscolor",{audioBuffer:"",width:"",height:""},"Returns a colorful waveform for an audio buffer",function(){return 1},{inlets:3});Object(pi.a)("intarray.slice",{arr:"",from:"",to:""},"slices an int array",function(){return 1},{isHot:!0,inlets:3});var ws={"waveform.color":function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return 50},r=arguments.length>2?arguments[2]:void 0,a=0;return function(i){var o=Object(v.a)(i,1)[0];if("bang"!==o){var s=n()||50;t||(t=new Os(s,255,1)),r()&&(t.isRaw=!0,o=o[0]);var c=(new Date).getTime();t.getWaveform(a++,o).then(function(t){var n,r=new Uint8Array(4*t.length),a=0,i=[],o=js(t);try{for(o.s();!(n=o.n()).done;){var s=n.value,u=s.height;r[a++]=u,r[a++]=s.rgb[0],r[a++]=s.rgb[1],r[a++]=s.rgb[2],i.push(s.height)}}catch(f){o.e(f)}finally{o.f()}var l=(new Date).getTime();console.log("waveform get took %s ms",l-c),e.sendMessage(e.outputByNumber(0),r)})}}},"waveform.slice":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0],a=t()||0,i=n()||1,o=r.duration;return r.slice(Math.min(a,o-.01),Math.min(a+i,o))}},"waveform.sliceBackwards":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0],a=t()||0,i=n()||1,o=r.duration,s=Math.max(a-i,0),c=Math.min(a,o);c===s&&(c+=.01);var u=r.slice(s,c),l=u.getChannelData(0),f=u.getChannelData(1),h=44100*i,d=new Float32Array(h),p=new Float32Array(h);return d.set(l,h-l.length),p.set(f,h-f.length),u.fromArray([d,p]),u}},"waveform.track":function(e){return function(t){var n=Object(v.a)(t,1)[0],r=e.sequencerEngine.tracks[Object(qn.a)(Math.round(n),e.sequencerEngine.tracks.length)];if(r){var a=r.getSamplers()[0];if(a)return[a.baseBuffer,a.getDuration()]}}},"waveform.jscolor":function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return 50},n=arguments.length>2?arguments[2]:void 0;return function(e){var r=Object(v.a)(e,1)[0];if("bang"!==r){for(var a=t()||50,i=n()||255,o=r.getChannelData(0),s=Math.ceil(o.length/a),c=new Uint8Array(a),u=0,l=0;l<o.length;l+=s){for(var f=0,h=0,d=l;d<l+s;d++){var p=o[d];Math.abs(p)>.01&&(f+=Math.pow(p,2),h++)}var m=Math.sqrt(f/h);c[l/s]=(m*i+u)/2,u=m*i}return[c]}}},"intarray.slice":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0];if(void 0!==t()&&void 0!==n())return[r.slice(t(),n())]}}};function xs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ss=function(e){Object(u.a)(n,e);var t=xs(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).setup(),r.newOutlet("level"),r}return Object(s.a)(n,[{key:"setup",value:function(){this.sequencerEngine.channelMixer.masterChannel.startMetering(this)}}]),n}(Ni.a);function Ps(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Es=function(e){Object(u.a)(n,e);var t=Ps(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).setup(),r.newOutlet("level"),r.newOutlet("stereo levels"),r}return Object(s.a)(n,[{key:"setup",value:function(){this.sequencerEngine.channelMixer.masterChannel.startWaveforming(this),this.sequencerEngine.channelMixer.masterChannel.startStereoWaveforming(this)}}]),n}(Ni.a);function Ts(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var As=function(e){Object(u.a)(n,e);var t=Ts(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).setup(),r.newOutlet("level"),r}return Object(s.a)(n,[{key:"setup",value:function(){this.sequencerEngine.channelMixer.masterChannel.startFFTing(this)}}]),n}(Ni.a);function Ms(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Rs=function(e){Object(u.a)(n,e);var t=Ms(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).send=0,r.newInlet("send",function(e){var t=Object(v.a)(e,1)[0];return r.send=t}),r.newOutlet("level"),r}return Object(s.a)(n,[{key:"send",set:function(e){var t=this.getSendChannel(this._send||0);t.stopMetering(),this._send=e,(t=this.getSendChannel()).startMetering(this)}},{key:"getSendChannel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._send;return this.sequencerEngine.sends.sends[e]}}]),n}(Ni.a);function Cs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ns=function(e){Object(u.a)(n,e);var t=Cs(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).envelope=0,r.newInlet("envelope",function(e){var t=Object(v.a)(e,1)[0];return r.envelope=t}),r.newOutlet("level"),r}return Object(s.a)(n,[{key:"envelope",set:function(e){var t=this.getEnvelope(this._envelope||0);t.stopMetering(),this._envelope=e,(t=this.getEnvelope()).startMetering(this)}},{key:"getEnvelope",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._envelope;return this.sequencerEngine.envelopes[e]}}]),n}(Ni.a);Object(pi.a)("meter.mix",{},"Meter for mix channel",function(){return 0},{inlets:0});Object(pi.a)("meter.waveform",{},"Meter for mix channel",function(){return 0},{inlets:0});Object(pi.a)("meter.fft",{},"Meter for mix channel",function(){return 0},{inlets:0});Object(pi.a)("meter.send",{},"Meter for send channel",function(){return 0},{inlets:0});Object(pi.a)("meter.envelope",{},"Meter for envelope",function(){return 0},{inlets:0});var Is={"meter.send":function(e){new Rs(e);return function(e){Object(v.a)(e,1)[0]}},"meter.waveform":function(e){new Es(e);return function(){}},"meter.fft":function(e){new As(e);return function(){}},"meter.envelope":function(e){new Ns(e);return function(){}},"meter.mix":function(e){new Ss(e);return function(){}}};function qs(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return _s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _s(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ds(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Fs=100,Ls=function(e){Object(u.a)(n,e);var t=Ds(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).sequencerEngine.presetManager=Object(c.a)(r),r.presets=new Array(Fs).fill(0),r.newInlet("Load Preset",function(e){var t=Object(v.a)(e,1)[0];r.presets[t]&&r.loadPreset(t)}),r.newInlet("Interpolate",function(e){var t=Object(v.a)(e,1)[0];Array.isArray(t)&&r.interpolate(t[0],t[1],t[2])}),r.zObject.newAttribute("number of presets",16,function(e){return r.changeNumberOfPresets(e)}),Object(hi.c)("preset.new"),r}return Object(s.a)(n,[{key:"changeNumberOfPresets",value:function(e){for(var t=[],n=0;n<e;n++)void 0!==this.presets[n]?t[n]=this.presets[n]:t[n]=0;this.presets=t}},{key:"getImageHashes",value:function(){var e,t=[],n=qs(this.presets);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r)for(var a in r){var i=r[a];"three.textureLoader"===i.text&&t.push(i.effect.imageHash)}}}catch(o){n.e(o)}finally{n.f()}return t}},{key:"newPreset",value:function(e){var t={};this.presets[e]=t,this.current=t,this.loadObjectsWithScripting()}},{key:"loadObjectsWithScripting",value:function(){for(var e in this.sequencerEngine.idToObject){var t=this.sequencerEngine.idToObject[e];t.attributes&&t.attributes["scripting name"]&&t.subSequence.preset===this&&this.onValueChange(t,t.effect&&t.effect.value||t.message||t._text)}}},{key:"interpolate",value:function(e,t,n){var r=this.presets[e],a=this.presets[t];if(r&&a)for(var i in r){var o=this.sequencerEngine.idToObject[i];if(o){var s=r[i],c=a[i];o.effect&&(o=o.effect,s=s.effect,c=c.effect),o.interpolate(s,c,n)}}}},{key:"loadPreset",value:function(e){if(this.presets[e]){var t=this.presets[e];for(var n in this.current=t,t){var r=this.sequencerEngine.idToObject[n];if(r){(new Date).getTime();r.fromValueJson(t[n],void 0,!0);(new Date).getTime()}}}else this.newPreset(e)}},{key:"onValueChange",value:function(e,t){this.current&&(this.current[e.id]=e.getValueJson())}},{key:"loadMyPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=window.localStorage.getItem("preset.hash"),e.next=3,la.a.getJson(n);case 3:r=e.sent,i=r.presets.slice(0,10),(t=this.presets).splice.apply(t,[0,10].concat(Object(h.a)(i)));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"uploadPreset",value:function(){la.a.addJson(this.getJson(!0)).then(function(e){N.a.setItem("preset.hash",e)})}},{key:"getJson",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return Object(d.a)({},(e=Object(fe.a)(Object(f.a)(n.prototype),"getJson",this)).call.apply(e,[this].concat(r)),{presets:this.presets})}},{key:"fromJson",value:function(e){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e),this.presets=e.presets,this.zObject.attributes["number of presets"]!==this.presets.length&&this.zObject.setAttribute("number of presets",this.presets.length)}}]),n}(Ni.a);function Bs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var zs=function(e){Object(u.a)(n,e);var t=Bs(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return n}(Ni.a);Object(pi.a)("varz",{},"View and control all variables nested inside patch",function(){return 0},{inlets:0});Object(pi.a)("preset",{},"Create presets of object (w/ scripting name attribute set) configurations.",function(){return 0},{inlets:0});var Js={preset:function(e){new Ls(e);return function(){}}};function Vs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Hs=function(e){Object(u.a)(n,e);var t=Vs(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet("fx preset",function(e){var t=Object(v.a)(e,1)[0];return r.fxPreset=t}),r.newOutlet("fx preset"),r}return n}(Ni.a);Object(pi.a)("spore.effects",{});var Us={"spore.effects":function(e){new Hs(e);return e.width=850,e.height=700,function(){}}};Object(pi.a)("ui.usePlayButton",{},"Shows play button on bottom left");Object(pi.a)("ui.hidePlayUntil",{type:""},"Hides the play button until a message of type is received");Object(pi.a)("ui.hide",{},"Hides the ui of zequencer (sidebars)");Object(pi.a)("ui.lock",{},"locks the ui of zequencer");Object(pi.a)("ui.noDeleteKey",{flag:""},"Skip the delete key");var Gs={"ui.hide":function(e){return e.needsLoad=!0,function(t){Object(v.a)(t,1)[0],e.sequencerEngine.dispatch(Object(J.fe)(!1))}},"ui.hidePlayUntil":function(e){return function(t){Object(v.a)(t,1)[0],e.sequencerEngine.dispatch(Object(J.Vc)(!0))}},"ui.lock":function(e){return e.needsLoad=!0,function(t){Object(v.a)(t,1)[0],e.sequencerEngine.dispatch(Object(J.Re)(!0))}},"ui.noDeleteKey":function(e){return e.needsLoad=!0,function(t){var n=Object(v.a)(t,1)[0];e.sequencerEngine.noDeleteKey=!!n}},"ui.usePlayButton":function(e){return function(t){var n=Object(v.a)(t,1)[0];e.sequencerEngine.dispatch(Object(J.Te)(n))}}};Object(pi.a)("window.postMessage",{msg:"",type:""},"Sends message to parent (if this is an iframe)",function(){return 1},{inlets:2}),Object(pi.a)("iframe.postMessage",{msg:"",type:""},"Sends message to parent (if this is an iframe)",function(){return 1},{inlets:2});var Ws=function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(window.urlSearchParams.get("gallery")&&window.parent&&document.referrer){t()&&(n={type:t(),body:n});var r=document.referrer;window.parent.postMessage(n,r)}}};Object(pi.a)("iframe.onMessage",{message:"message (for testing the functionality)",type:"message name to listen for"},"Listens for messages coming from the parent window and sends them out the outlet",function(){return 1},{inlets:2});var Ks={"window.postMessage":Ws,"iframe.postMessage":Ws,"iframe.onMessage":function(e,t){var n=function(n){(n=n.data).type===t()&&e.sendMessage(e.outputByNumber(0),n.body)};return window.addEventListener("message",n),function(e){var t=Object(v.a)(e,1)[0];n(t)}}};n(309);Object(pi.a)("player~",{play:"",audioBuffer:""},"plays buffer",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("speakers~",{source:""},"speakers",function(){return 1},{isHot:!0});var Qs={"player~":function(e,t){var n=void 0,r=!1;return function(e){var a=Object(v.a)(e,1)[0],i=t();if(i&&!n&&(n=new re.a.Player(i)),n&&(a&&!r?(r=!0,n.start()):!a&&r&&(r=!1,n.stop())),n)return[n]}}};function Zs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ys=function(e){Object(u.a)(n,e);var t=Zs(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).hashMap={},r.tempos={},r.startOnsets={},r.current=1,r.newInlet("id",function(e){var t=Object(v.a)(e,1)[0];console.log("RECEIVED Z IPFS MESSAGE=",t),r.current=t,r.hashMap[r.current]&&(r.ipfsHash=r.hashMap[r.current])}),r.newOutlet("IPFS hash"),r.newOutlet("IPFS URL"),r.newOutlet("start onset"),r.newOutlet("tempo"),r}return Object(s.a)(n,[{key:"deleteId",value:function(e){var t=this.hashMap[e];delete this.hashMap[e],delete this.tempos[t],delete this.startOnsets[t]}},{key:"dropFile",value:function(e,t,n){this.hashMap[this.current]=e,this.tempos[e]=t,this.startOnsets[e]=n}},{key:"ipfsHash",set:function(e){this.hashMap[this.current]=e,this._ipfsHash=e,console.log("sending ipfs hash stored=",e),this.sendMessage("IPFS hash",e),this.sendMessage("IPFS URL",this.getURL(e)),this.sendMessage("tempo",this.tempos[e]),this.sendMessage("start onset",this.startOnsets[e])}},{key:"getURL",value:function(e){return"https://zequencer.mypinata.cloud/ipfs/"+e}},{key:"fromJson",value:function(e){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e),e.hashMap&&(this.hashMap=e.hashMap),e.startOnsets&&(this.startOnsets=e.startOnsets),e.tempos&&(this.tempos=e.tempos)}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{hashMap:this.hashMap,startOnsets:this.startOnsets,tempos:this.tempos})}}]),n}(Ni.a);Object(pi.a)("ipfs.json",{hash:"IPFS content hash to download"},"Returns the json out of inlet",function(){return 1});Object(pi.a)("ipfs.drop",{},"Returns the json out of inlet",function(){return 0},{inlets:0});var $s={"ipfs.json":function(e){var t={};return function(n){var r=Object(v.a)(n,1)[0];if(t[r])return[t[r]];la.a.getJson(r,void 0,void 0,void 0,!0).then(function(n){console.log("ipfs.getJson object returned=",r,n),t[r]=n,e.sendMessage(e.outputByNumber(0),n)})}},"ipfs.drop":function(e){e.width=150,e.height=150;new Ys(e);return function(e){Object(v.a)(e,1)[0]}}};function Xs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ec=function(e){Object(u.a)(n,e);var t=Xs(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).snapshots=[],r.newInlet("snapshots",function(e){var t=Object(v.a)(e,1)[0];console.log("received snap",t),r.snapshots=[].concat(Object(h.a)(r.snapshots),[t])}),r.newOutlet("operation"),r}return Object(s.a)(n,[{key:"useSnapshot",value:function(e){console.log("send use snapshot",e),this.sendMessage("operation","use-snapshot",e)}},{key:"takeSnapshot",value:function(){this.sendMessage("operation","take-snapshot")}},{key:"interpolateSnapshots",value:function(e){this.sendMessage("operation","interpolate-snapshots "+e.join(" "))}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{snapshots:this.snapshots})}},{key:"fromJson",value:function(e,t){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),e.snapshots&&(this.snapshots=e.snapshots)}}]),n}(Ni.a);function tc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return nc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nc(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function nc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var rc=["gl.mod","gl./","gl.*","gl.+","gl.-","gl.atan"];Object(pi.a)("operations.mutate",{"probability of mutation":"trigger mutation","from operation":"trigger mutation","to operation":"trigger mutation"},"Switches operations of objects in subpatch from one to another w/ probability. Returns a mapping of all operations and their counts",function(){return 2},{inlets:3,outlets:["stats","snapshots"]});var ac=function e(t,n,r,a,i,o){var s,c=tc(t.zObjects);try{for(c.s();!(s=c.n()).done;){var u=s.value;if(u.effect&&u.effect.zObjects&&!u.isLocked)e(u.effect,n,r,a,i,o);else if(Math.random()>n||u.isLocked)ic(u,a,i),rc.includes(u.name)&&o.push([u,u._text,u._text]);else{var l=u._text;if(u.name===r){var f=l.indexOf(" ");l=-1===f?a:a+l.slice(f),o.push([u,u._text,l]),u.text=l}ic(u,a,i)}}}catch(h){c.e(h)}finally{c.f()}},ic=function(e,t,n){rc.includes(e.name)&&oc(t)===oc(e.name)&&(n[e.name]||(n[e.name]=0),n[e.name]++)},oc=function(e){var t=Object(pi.a)(e);return t.inlets?t.inlets:0};Object(pi.a)("operations.snapshots",{},"Switches operations of objects in subpatch from one to another w/ probability. Returns a mapping of all operations and their counts",function(){return 0},{});var sc=function(e){var t,n=tc(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=Object(v.a)(r,2),i=a[0],o=a[1];i._text!==o&&(i.text=o)}}catch(s){n.e(s)}finally{n.f()}},cc=function(e){var t,n=tc(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=Object(v.a)(r,3),i=a[0],o=(a[1],a[2]);i._text!==o&&(console.log("setting snap zobject=%s -> %s",i._text,o),i.text=o)}}catch(s){n.e(s)}finally{n.f()}},uc={"operations.mutate":function(e,t,n){var r=[];return function(a){var i=Object(v.a)(a,2),o=i[0],s=i[1];if("undo"!==o)if("take-snapshot"!==o)if("use-snapshot"!==o){var c=t(),u=n();if(c&&u){var l=[],f={};window.stopGLCompile=!0,ac(e.subSequence.subSequence||e.subSequence,o,c,u,f,l),window.stopGLCompile=!1,e.sequencerEngine.compile();var d=[];for(var p in f)d.push([p,f[p]]);var m,y=tc(rc);try{for(y.s();!(m=y.n()).done;){var b=m.value;f[b]||d.push([b,0])}}catch(j){y.e(j)}finally{y.f()}return d.sort(function(e,t){return t[1]-e[1]}),r.push(l),[d]}}else s&&(s=s.map(function(t){var n=Object(v.a)(t,3),r=n[0],a=n[1],i=n[2];return[e.sequencerEngine.idToObject[r],a,i]}),window.stopGLCompile=!0,cc(s),window.stopGLCompile=!1,e.sequencerEngine.compile());else{var g=r[r.length-1];g&&(g=g.map(function(e){return[e[0].id,e[1],e[2]]}),e.sendMessage(e.outputByNumber(1),Object(h.a)(g)))}else{var O=r.pop();O&&sc(O)}}},"operations.snapshots":function(e){new ec(e);return function(e){Object(v.a)(e,1)[0]}}};function lc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var fc=function(e){Object(u.a)(n,e);var t=lc(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet("url",function(e){return r.url=e[0]}),r}return n}(Ni.a);Object(pi.a)("icon",{},"creates an icon with supplied",function(){return 0},{inlets:0});function hc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return dc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dc(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function dc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("document.title",{title:""},"Sets the title of the webpage to the argument passed");Object(pi.a)("window.size",{},"Returns the size of the window");Object(pi.a)("sub.setGlobalSize",{size:""},"sets the size of all subpatches");var pc=function e(t,n,r){t.zObject&&t.isCustom&&(console.log("setting canvas size object=",n,r,t),t.zObject.width=n,t.zObject.height=r);var a,i=hc(t.zObjects);try{for(i.s();!(a=i.n()).done;){var o=a.value;"subpatch"===o.name&&e(o.effect,n,r)}}catch(s){i.e(s)}finally{i.f()}};Object(pi.a)("canvas.setGlobalSize",{size:""},"sets the size of all subpatches");var vc=function e(t,n,r){var a,i=hc(t.zObjects);try{for(i.s();!(a=i.n()).done;){var o=a.value;"three.canvas"===o.name&&(console.log("setting canvas size object=",n,r,o),o.width=n,o.height=r,o.effect.sendMessage("size",[n,r])),o.effect&&o.effect.zObjects&&e(o.effect,n,r)}}catch(s){i.e(s)}finally{i.f()}};Object(pi.a)("window.postMessage",{msg:""},"Sends message to parent (if this is an iframe)");Object(pi.a)("modal",{show:"1 to show 0 to hide",text:"The main text (arrays are seperated by lines)","ok button text":"","cancel button text":"","link text":"","link url":""},"Creates a modal",function(){return 2},{inlets:6});Object(pi.a)("progressbar",{"start/stop":"",text:""},"Shows a progressbar spinner",function(){return 0},{inlets:2});Object(pi.a)("motion.rampTo",{trigger:"",time:"",min:"",max:"",skipFirst:"",parts:""},"Ramps from min to max in time milliseconds using ",function(){return 1},{inlets:6});Object(pi.a)("motion.rampBack",{trigger:"",time:"",min:"",max:""},"Ramps from min to max back to min in time milliseconds using ",function(){return 1},{inlets:4});Object(pi.a)("motion.slowdown",{coords:"",speed:""},"Slows down in coming coordinate data by a factor (replaying them at slower speed)",function(){return 1},{inlets:2});Object(pi.a)("motion.spring",{trigger:"",start:"",end:"",stiffness:"",dampening:"",mass:"",endVelocity:"",rate:""},"",function(){return 2},{inlets:8,outlets:["value","finished"]});Object(pi.a)("motion.list",{list:""},"LIST",function(){return 1});var mc={"motion.list":function(e,t){var n=new Array(6).fill(0),r=[];setInterval(function(){for(var t=[],a=!0,i=0;i<n.length;i++){var o=n[i];if(0===o)t.push(0);else{a=!1;var s=o-(new Date).getTime(),c=s/r[i];t.push(Math.max(0,c)),s<0&&(n[i]=0)}}a||e.sendMessage(e.outputByNumber(0),t)},20);return function(e){for(var t=Object(v.a)(e,1)[0],a=0;a<t.length;a++)t[a]>0&&(r[a]=t[a]*new re.a.Time("32n").toSeconds()*1e3,n[a]=(new Date).getTime()+r[a])}},"motion.spring":function(e,t,n,r,a,i,o,s){var c=void 0;return function(u){if("clear"!==Object(v.a)(u,1)[0]){var l=t(),f=n(),h=r()||-30,d=a()||-.97;(new Date).getTime(),c&&clearInterval(c);var p=l,m=0,y=i()||.1,b=o()||.01;c=setInterval(function(){var t=s()||30;p+=(m+=(h*(p-f)+d*m)/y*(t/1e3))*(t/1e3),Math.abs(m)<b?(clearInterval(c),e.sendMessage(e.outputByNumber(0),f),e.sendMessage(e.outputByNumber(1),"bang")):e.sendMessage(e.outputByNumber(0),p)},s()||30)}else clearInterval(c)}},"motion.rampTo":function(e,t,n,r,a,i){var o;return function(s){if("clear"!==Object(v.a)(s,1)[0]){var c=void 0===r()?1:r(),u=void 0===n()?0:n();if(u!==c){var l=i()||30,f=t(),h=u,d=(c-u)/l;o&&clearInterval(o);var p=!0;o=setInterval(function(){if(h+=d,c>u&&h>c||c<u&&h<c)return e.sendMessage(e.outputByNumber(0),c),void clearInterval(o);a()&&p||e.sendMessage(e.outputByNumber(0),h),p=!1},f/l)}}else o&&clearInterval(o)}},"motion.rampBack":function(e,t,n,r){return function(a){Object(v.a)(a,1)[0];var i=r()||1,o=n()||0,s=t(),c=o,u=(i-o)/20,l=setInterval(function(){if(c+=u,i>o&&c>i||i<o&&c<i)if(u<0)e.sendMessage(e.outputByNumber(0),i),clearInterval(l);else{c+=u*=-1;var t=o;o=i,i=t}else e.sendMessage(e.outputByNumber(0),c)},s/20)}},"motion.slowdown":function(e,t){var n=void 0,r=void 0;return function(a){var i,o,s,c=Object(v.a)(a,1)[0],u=(new Date).getTime(),l=u-n;(void 0===n||u-r>200)&&(n=u),r=u,i=c,o=Math.max(0,l*t()-l),s=n,setTimeout(function(){s===n&&e.sendMessage(e.outputByNumber(0),i)},o)}}},yc=n(830);function bc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return gc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gc(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function gc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Oc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var jc=function(e){Object(u.a)(n,e);var t=Oc(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet("load",function(){return r.load()}),r.newInlet("get skin",function(e){var t=Object(v.a)(e,1)[0];return r.onSkin(t)}),r.newOutlet("skin"),r}return Object(s.a)(n,[{key:"onSkin",value:function(e){this.skins&&this.skins[e]&&this.sendMessage("skin",this.skins[e])}},{key:"load",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ii.a((new yc.a).contractAddress).from(qi.E),e.next=3,t.executeQuery();case 3:n=e.sent,r={},i=bc(n);try{for(i.s();!(o=i.n()).done;)s=o.value,r[s.skinId]=s.imageHash}catch(a){i.e(a)}finally{i.f()}this.skins=r;case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{skins:this.skins})}},{key:"fromJson",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];(t=Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this)).call.apply(t,[this,e].concat(a)),e.skins&&(this.skins=e.skins)}}]),n}(Ni.a),kc=n(587),wc=n(433);function xc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Sc=function(e,t){if(e<500&&e>60){if(void 0===t.onsets[0]){var n=t.tempo;t.analyze(void 0,!0),t.tempo=n}void 0!==t.onsets[0]&&t.onsets[0]<1200&&(e=t.onsets[0])}return e};function Pc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ec(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ec(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ec(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Tc=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f,h,d;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ii.a((new hs.a).contractAddress).from(qi.Z).where("tag","spores"),e.next=3,n.executeQuery();case 3:return r=e.sent,n=new Ii.a((new hs.a).contractAddress).from(qi.V).whereIn("ipfsHash",r.map(function(e){return e.ipfsHash})),e.next=7,n.executeQuery();case 7:r=e.sent,i=[],o=Pc(r);try{for(o.s();!(s=o.n()).done;)c=s.value,u=c.title,l=u.split(" "),f=l[1],h=Ac(f),console.log("title = %s extacted=%s",u,h),Math.abs(h-t)<=10&&i.push(c)}catch(a){o.e(a)}finally{o.f()}return console.log("matching bpms = ",i),d=(r=i)[Math.floor(Math.random()*r.length)],console.log("random sample chosen=",d),e.abrupt("return",d.ipfsHash);case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Ac=function(e){for(var t="",n=0;n<e.length;n++){var r=e[n];if(!Object(ke.a)(r))break;t+=r}return parseInt(t)};function Mc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Rc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rc(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Rc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Cc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}window.getRandomRiddim=Tc;var Nc=function(e){Object(u.a)(n,e);var t=Cc(n);function n(e){var r;if(Object(o.a)(this,n),(r=t.call(this,e)).playlist=[],r.stems=void 0,r.newInlet("load song",function(){var e=Object(i.a)(a.a.mark(function e(t){var n,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object(v.a)(t,1),i=n[0],r.sequencerEngine.playing&&r.sequencerEngine.play(),!(o=r.playlist[i])){e.next=6;break}return e.next=6,r.loadsong(o);case 6:r.sequencerEngine.play();case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),r.newInlet("load mutation",function(e){var t=Object(v.a)(e,1)[0];r.loadMutation(t)}),r.newInlet("load url",function(e){var t=Object(v.a)(e,1)[0];r.loadFromURL(t)}),r.newInlet("load sample",function(e){var t=Object(v.a)(e,1)[0];r.loadSampleFromURL(t)}),r.newInlet("load alt. sample",function(e){var t=Object(v.a)(e,1)[0];r.loadSampleFromURL(t,"vocals")}),r.newOutlet("bpm changed"),r.newOutlet("on loaded"),r.newOutlet("sample loaded"),r.newOutlet("song buffer"),r.newOutlet("sample buffer"),window.addEventListener("message",function(e){return r.receiveIFrameMessage(e)}),r.loadCount=0,window.parent&&document.referrer){var s=document.referrer;window.parent.postMessage("ready for stems",s)}return r}return Object(s.a)(n,[{key:"receiveIFrameMessage",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f,h,d,p,v,m;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("load-song"!==(n=t.data).type){e.next=8;break}r=n.body,i=parseInt(r),(o=this.playlist[i])&&this.loadSong(o),e.next=61;break;case 8:if("nft-jacker"!==n.type){e.next=61;break}this.sequencerEngine.playing&&(this.sequencerEngine.stop(),this.sequencerEngine.seekToTrackStep(0)),s=n.body,c=[],this.zObject.dispatch(Object(J.hf)("loading nft jacker")),u=void 0,e.t0=a.a.keys(s.samples);case 15:if((e.t1=e.t0()).done){e.next=46;break}if(l=e.t1.value,f=s.samples[l],"other"!==l||!s.containsSample){e.next=23;break}return e.next=21,Tc(u);case 21:h=e.sent,f=h;case 23:if(void 0,(d=new H.a(f)).name=l,!c[0]||c[0].ipfsHash!==f){e.next=41;break}if(d.audioBuffer=c[0].audioBuffer,u){e.next=39;break}return e.prev=29,e.next=32,Object(wc.a)(c[0].audioBuffer);case 32:p=e.sent,u=p.tempo,e.next=39;break;case 37:e.prev=37,e.t2=e.catch(29);case 39:e.next=43;break;case 41:return e.next=43,d.fetchAudio(!0);case 43:c.push(d),e.next=15;break;case 46:if(!s.containsSample){e.next=52;break}return e.next=49,Object(kc.a)(c.find(function(e){return"main"===e.name}).audioBuffer);case 49:e.t3=e.sent,e.next=53;break;case 52:e.t3=void 0;case 53:if(v=e.t3,!(m={samples:c,name:"nft-jacked",bpm:u,sampleBPM:v})){e.next=59;break}return e.next=58,this.loadSong(m,!0);case 58:this.loadCount>=1&&this.sequencerEngine.play();case 59:this.zObject.dispatch(Object(J.hf)(void 0)),this.loadCount++;case 61:case"end":return e.stop()}},e,this,[[29,37]])}));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromURL",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f,h,d;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t,r=t,i=t,t.includes(" ")&&(t=t.split(" ")),Array.isArray(t)&&(n=t[0],i=t[1]||t[0],r=t[2]||t[0]),console.log("Main =%s space=%s",n,i),o={samples:{main:n,alt:r,space:i},bpm:120},s=[],this.zObject.dispatch(Object(J.hf)("loading nft jacker")),c=void 0,e.t0=a.a.keys(o.samples);case 10:if((e.t1=e.t0()).done){e.next=25;break}if(u=e.t1.value,void 0,(l=new H.a(o.samples[u])).name=u,!s[0]||o.samples[u]!==c){e.next=19;break}l.audioBuffer=s[0].audioBuffer,e.next=21;break;case 19:return e.next=21,l.fetchAudio(!0);case 21:c||(c=o.samples[u]),s.push(l),e.next=10;break;case 25:return f=120,e.prev=26,e.next=29,Object(wc.a)(s[0].audioBuffer);case 29:h=e.sent,f=h.bpm,e.next=36;break;case 34:e.prev=34,e.t2=e.catch(26);case 36:return d={samples:s,name:"nft-jacked",bpm:f},e.next=39,this.loadSong(d,!1);case 39:this.zObject.dispatch(Object(J.hf)(void 0));case 40:case"end":return e.stop()}},e,this,[[26,34]])}));return function(t){return e.apply(this,arguments)}}()},{key:"setBPM",value:function(e){this.sequencerEngine.bpm=e,this.sendMessage("bpm changed",e)}},{key:"getJson",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return Object(d.a)({},(e=Object(fe.a)(Object(f.a)(n.prototype),"getJson",this)).call.apply(e,[this].concat(r)),{playlist:this.playlist.map(function(e){return Object(d.a)({},e,{samples:e.samples.map(function(e){return{ipfsHash:e.ipfsHash,name:e.name}})})})})}},{key:"fromJson",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];(t=Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this)).call.apply(t,[this,e].concat(a)),e.playlist&&this.loadPlaylistJSON(e.playlist)}},{key:"loadPlaylistJSON",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f,h,d,p,v,m;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=0,r=Mc(t);try{for(r.s();!(i=r.n()).done;){o=i.value,s=o.samples,c=o.name,u=o.bpm,l=[],f=Mc(s);try{for(f.s();!(h=f.n()).done;)d=h.value,p=d.ipfsHash,v=d.name,(m=new H.a(p)).name=v,l.push(m)}catch(a){f.e(a)}finally{f.f()}this.newStems(l,c,u,!1,0==n),n++}}catch(a){r.e(a)}finally{r.f()}this.stems=this.playlist[0];case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newStems",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i={samples:e,name:t,bpm:n};this.playlist.push(i),r?this.loadSong(i):a&&this.loadSong(i,!0)}},{key:"loadMutation",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sequencerEngine.tokenID=t,n=this.stems.samples.filter(function(e){return e.name.includes("mutation")}),r=n[t]){e.next=5;break}return e.abrupt("return");case 5:if((i=r).isLoaded()){e.next=9;break}return e.next=9,i.fetchAudio();case 9:5,o=this.getTrackForIndex(5),this.disposeSampler(o.getSamplers()[0]),this.lastMutation&&(this.lastMutation.audioBuffer=void 0),this.lastMutation=r,o&&(s=o.getSamplers()[0],c=new re.a.Buffer(i.audioBuffer),s.slices[0].buffer=c,s.baseBuffer=c,s.slices[0].sampler._buffers._buffers[48]=c,s.slices[0].startTime=0,s.slices[0].endTime=c.duration,s.sample=i),(u=o.getSamplers()[0])&&(u.tempo=this.stems.bpm);case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadSong",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f,d,p,v,m,y=this,b=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!(b.length>1&&void 0!==b[1])||b[1],Object(gi.a)(),Object(Ci.b)(),la.a.clearCache(),n&&(this.sequencerEngine.playing&&this.sequencerEngine.stop(),this.sequencerEngine.trackStep>0&&this.sequencerEngine.seekToTrackStep(0)),"number"===typeof t&&(t=this.playlist[t]),i=(r=t).samples,r.name,o=r.bpm,r.sampleBPM,s=r.startOnset,0,i=Object(h.a)(i),u=0,l=Mc(i),e.prev=11,d=a.a.mark(function e(){var t,n,r,i,s,l,h;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.value,n=t.name,y.sequencerEngine.isLoading||y.zObject.dispatch(Object(J.hf)("Loading stem ".concat(1+u," of 6"))),!(r=y.tracks.find(function(e){return e.presetName===n}))){e.next=9;break}if((i=r.getSamplers()[0]).sample.getId()!==t.getId()){e.next=9;break}return"main"===n&&(c=i.sample.audioBuffer),e.abrupt("return","continue");case 9:if(t.isLoaded()){e.next=12;break}return e.next=12,t.fetchAudio();case 12:u++,r&&(s=r.getSamplers()[0],l=new re.a.Buffer(t.audioBuffer),"main"===n&&(c=t.audioBuffer),s.onsets=[],s.slices[0].buffer=l,s.baseBuffer=l,s.slices[0].sampler._buffers._buffers[48]=l,s.slices[0].startTime=0,s.slices[0].endTime=l.duration,s.sample=t,h=o,s.tempo=h);case 14:case"end":return e.stop()}},e)}),l.s();case 14:if((f=l.n()).done){e.next=21;break}return e.delegateYield(d(),"t0",16);case 16:if("continue"!==e.t0){e.next=19;break}return e.abrupt("continue",19);case 19:e.next=14;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(11),l.e(e.t1);case 26:return e.prev=26,l.f(),e.finish(26);case 29:if(void 0!==s){p=Mc(this.tracks);try{for(p.s();!(v=p.n()).done;)v.value.getSamplers()[0].onsets=[1e3*s]}catch(g){p.e(g)}finally{p.f()}}this.setBPM(o),this.stems=t,this.zObject.dispatch(Object(J.hf)(void 0)),this.sendMessage("on loaded",o),this.sendMessage("song buffer",c),window.parent&&document.referrer&&(m=document.referrer,window.parent.postMessage({type:"song-player-progress",body:0},m));case 36:case"end":return e.stop()}},e,this,[[11,23,26,29]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getTrackForIndex",value:function(e){var t,n=Mc(this.sequencerEngine.currentSubSequence.pads);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.slots[e])return r.slots[e]}}catch(a){n.e(a)}finally{n.f()}}},{key:"disposeExistingSamples",value:function(){var e,t=Mc(this.playlist);try{for(t.s();!(e=t.n()).done;){e.value.samples.forEach(function(e){return e.audioBuffer=void 0})}}catch(o){t.e(o)}finally{t.f()}var n,r=this.sequencerEngine.tracks,a=Mc((r=[].concat(Object(h.a)(r.slice(0,4)),[r[5]])).map(function(e){return e.getSamplers()[0]}));try{for(a.s();!(n=a.n()).done;){var i=n.value;this.disposeSampler(i)}}catch(o){a.e(o)}finally{a.f()}}},{key:"disposeSampler",value:function(e){e.sample.audioBuffer=void 0,e.audioBuffer=void 0,e.slices[0].buffer.originalCopy=void 0,e.slices[0].buffer.reversedCopy=void 0,e.slices[0].buffer=void 0,e.baseBuffer&&e.baseBuffer.dispose(),e.baseBuffer=void 0}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=xc(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"loadSampleFromURL",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="juice",r=void 0,Array.isArray(t)&&(r=t[1],t=t[0]),(i=new H.a(t)).name=n,e.next=7,i.fetchAudio(!0);case 7:return e.next=9,this.cropSilence(i.audioBuffer,t);case 9:if(i.audioBuffer=e.sent,e.t1=r,e.t1){e.next=15;break}return e.next=14,Object(kc.a)(i.audioBuffer);case 14:e.t1=e.sent;case 15:if(e.t0=e.t1,e.t0){e.next=18;break}e.t0=120;case 18:return r=e.t0,o=this.tracks.find(function(e){return e.presetName===n}),e.next=22,this.adjustSamplerLengthAndBPM(o,i,r);case 22:this.replaceSampleWith(n,i,r,!0),this.sendMessage("sample loaded","bang"),this.sendMessage("sample buffer",i.audioBuffer);case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cropSilence",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o,s,c,u,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(Ci.a)(t,n);case 3:if(i=e.sent,!(r=i.offset).error){e.next=7;break}return e.abrupt("return",t);case 7:e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",t);case 12:return r>.08&&(r*=.1),o=t.getChannelData(0),s=I.isMobile?void 0:t.getChannelData(1),c=r*re.a.Master.context.sampleRate,u=re.a.Master.context,o.length,(l=u.createBuffer(I.isMobile?1:2,o.length-c+1,u.sampleRate)).getChannelData(0).set(o.subarray(c)),I.isMobile||l.getChannelData(1).set(s.subarray(c)),e.abrupt("return",l);case 22:case"end":return e.stop()}},e,null,[[0,9]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"replaceSampleWith",value:function(e,t,n,r){var a=this.tracks.find(function(t){return t.presetName===e}),i=a.getSamplers()[0],o=new re.a.Buffer(t.audioBuffer);return i.slices[0].buffer=o,i.baseBuffer=o,i.slices[0].sampler._buffers._buffers[48]=o,i.slices[0].startTime=0,i.slices[0].endTime=o.duration,i.sample=t,i.tempo=n,i.tempoOverride=n,a}},{key:"bpm",get:function(){return this.sequencerEngine.bpm}},{key:"adjustSamplerLengthAndBPM",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o,s,c,u,l,f,h,d,p,v,m,y,b,g,O;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t.getSamplers()[0],i=n.audioBuffer.duration*(this.bpm/r),o=new re.a.Time("32n").toSeconds(),c=(s=i/o)-s%32,u=32;2*u<=c;)u*=2;return c=2*u,l=Math.min(256,c),t.pattern.changeLength(l),f=[],e.prev=13,e.next=16,Object(Ci.a)(this.firstSampler.baseBuffer._buffer,this.firstSampler.sample.ipfsHash);case 16:h=e.sent,f[0]=1e3*h.offset,e.next=23;break;case 20:e.prev=20,e.t0=e.catch(13),f=[];case 23:if(!f||!f[0]){e.next=43;break}if(0!==(d=f[0])){e.next=27;break}return e.abrupt("return");case 27:d=Sc(d,this.firstSampler),p=t.pattern.length()*new re.a.Time("32n").toSeconds(),v=p,m=d/1e3,this.bpm,y=2*m%v/new re.a.Time("32n").toSeconds(),b=Math.floor(y),g=y-b,b=Math.floor(b/2),g/=2,window.GLOBAL_OFFSET=b,console.log("SHIFTING TRACK OVER step=%s off=%s",b,g),this.shiftTrackStep(t,b,g),O=this.tracks.find(function(e){return"env 1"===e.presetName}),this.shiftTrackStep(O,b,g);case 43:case"end":return e.stop()}},e,this,[[13,20]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"shiftTrackStep",value:function(e,t,n){e.pattern.clear();var r=new K.a(this.sequencerEngine,void 0,void 0,e);r.on=!0,r.duration=e.pattern.length(),e.pattern.stepBuckets[t].steps[n]=r,e.updateSteps()}},{key:"tracks",get:function(){return this.sequencerEngine.tracks}},{key:"firstSampler",get:function(){return this.tracks[0].getSamplers()[0]}}]),n}(e)}(Ni.a)),Ic=n(605),qc=n(162),_c=n(814),Dc=n(157),Fc=n(149),Lc=(new _c.a,function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ic.a.providers.Web3Provider(window.ethereum,"any"),e.next=3,n.send("eth_requestAccounts",[]);case 3:return r=e.sent,i=n.getSigner(),e.next=7,i.signMessage(t);case 7:return o=e.sent,e.abrupt("return",{flatSignature:o,splitSignature:Ic.a.utils.splitSignature(o),account:r[0]});case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Bc=n(153),zc=n(181);function Jc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Vc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vc(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Vc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("spore",{"spore hash":"ipfs hash of new spore sound",tokenID:"tokenID of spores.vision ERC720",sliderData:"recorded slider movements",modeData:"recorded mode changes"},"Creates a new spore",function(){return 1},{inlets:4});Object(pi.a)("spore.sparse",{sliderData:"recorded slider changes"},"Creates a spare list baed on stepse",function(){return 1},{inlets:1});var Hc=function(e,t,n){e=e.slice(-16);for(var r=Math.pow(t,2),a=1,i=0;i<e.length;i+=4)r+=Math.pow(e[i+n],2),a++;return isNaN(r)?1:Math.sqrt(r/a)+.1*(e=e.slice(-4))[n]};Object(pi.a)("spore.loadSpores",{list:"List of spore results"},"Loads a bunch of spore recordings as tracks, and outputs the associated heatmaps via the outlet",function(){return 2},{inlets:1,outlets:["audio buffers","spore heatmap datas"]});Object(pi.a)("spore.convertList",{list:""},"Balls",function(){return 1},{inlets:1});var Uc=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=0,i=Jc(t),e.prev=3,i.s();case 5:if((o=i.n()).done){e.next=14;break}return s=o.value,c=new H.a(s),console.log("DOWNLOADING %s of %s",r++,t.length),e.next=11,c.fetchAudio();case 11:n.push(c.audioBuffer);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),i.e(e.t0);case 19:return e.prev=19,i.f(),e.finish(19);case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}},e,null,[[3,16,19,22]])}));return function(t){return e.apply(this,arguments)}}(),Gc=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=Jc(t),e.prev=2,r.s();case 4:if((i=r.n()).done){e.next=13;break}return o=i.value,e.t0=n,e.next=9,la.a.getJson(o);case 9:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t2=e.catch(2),r.e(e.t2);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}},e,null,[[2,15,18,21]])}));return function(t){return e.apply(this,arguments)}}();Object(pi.a)("spore.getPlayRate",{list:""},"Balls",function(){return 1},{inlets:1});Object(pi.a)("spore.stems",{});var Wc=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,a={},i=Jc(e);try{for(i.s();!(t=i.n()).done;){var o=t.value,s=Object(v.a)(o,2),c=s[0],u=s[1];c>=n&&c<r&&(a[c]=u[3])}}catch(l){i.e(l)}finally{i.f()}return a},Kc=function(e){var t=Object.keys(e)[Object.keys(e).length-1];for(var n in e)for(;void 0===e[n+1]&&!(t>=n);)e[n+1]=e[n],n++;return e};Object(pi.a)("spore.skins",{},"Creates a spare list baed on stepse",function(){return 0},{inlets:0});var Qc={spore:function(e,t,n,r){return function(o){var s=Object(v.a)(o,1)[0];if(n()&&r()){var c={sliderChanges:n(),modeChanges:r()};la.a.addJson(c).then(function(n){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return new Promise(function(){var r=Object(i.a)(a.a.mark(function r(i){var o,s,c,u,l,f,h;return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("new spore w data hash=",n),r.next=3,Lc("A new spore.");case 3:(o=r.sent).account,o.flatSignature,s=o.splitSignature,c=s.r,u=s.s,l=s.v,f={r:c,s:u,v:l,message:"A new spore.",sporeHash:Object(Bc.b)(e),dataHash:Object(Bc.b)(n),tokenId:t},h="https://zequencer.io",window.location.hostname.includes("localhost")&&(h=""),fetch(h+"/newSpore/",{method:"POST",body:JSON.stringify(f),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){i(e.transactionHash)});case 12:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}())}(s,t(),n).then(function(t){e.sendMessage(e.outputByNumber(0),t)})})}}},"spore.skins":function(e){new jc(e);return function(e){Object(v.a)(e,1)[0]}},"spore.stems":function(e){new Nc(e);return function(e){Object(v.a)(e,1)[0]}},"spore.sparse":function(e){return function(e){var t,n=[],r=void 0,a=Jc(Object(v.a)(e,1)[0]);try{for(a.s();!(t=a.n()).done;){var i=t.value,o=Object(v.a)(i,2),s=o[0],c=o[1];if(!r||r[0]!==s){r=[s,c],s||(s=0);var u=n.slice(-4);u.length<4&&(u=[0,0,0,0]);for(var l=4*n.length;l<s;l+=4)u=u.map(function(e){return Math.max(0,.9*e)}),n=[].concat(Object(h.a)(n),Object(h.a)(u));var f=Hc(n,c[0],0),d=Hc(n,c[1],1),p=Hc(n,c[2],2),m=Hc(n,c[3],3);n.push(f),n.push(d),n.push(p),n.push(m)}}}catch(y){a.e(y)}finally{a.f()}return[n]}},"spore.loadSpores":function(e){var t=void 0,n=void 0;return function(r){var a=Object(v.a)(r,1)[0];a=a.slice(0,1),t?e.sendMessage(e.outputByNumber(0),t):Uc(a.map(function(e){return e.sporeHash})).then(function(n){console.log("load spores returned w/ =",t),t=n,e.sendMessage(e.outputByNumber(0),n)}),n?e.sendMessage(e.outputByNumber(1),n):Gc(a.map(function(e){return e.dataHash})).then(function(t){n=t,e.sendMessage(e.outputByNumber(1),t)})}},"spore.convertList":function(e){return function(e){var t,n={},r=Jc(Object(v.a)(e,1)[0]);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=Object(v.a)(a,2),o=i[0],s=i[1];isNaN(o)&&(o=0),n[o]=s}}catch(c){r.e(c)}finally{r.f()}return[n]}},"spore.getPlayRate":function(e){return function(e){var t=Object(v.a)(e,1)[0],n=t.sliderChanges,r=t.modeChanges;console.log(n);for(var a={},i=0;i<r.find(function(e){return 2===e[1]})[0];i++)a[i]=1;for(var o=0;o<r.length;o++){var s=Object(v.a)(r[o],2),c=s[0],u=s[1];if(2===u){var l=r.slice(o+1).find(function(e){return 2===e[1]||-1===e[1]});a=Object(d.a)({},a,Wc(n,c,l?l[0]:c+1))}else-1===u&&(a[c]=1)}return[Kc(a)]}}};Object(pi.a)("haptic.vibrate",{ms:"milliseconds to vibrate"},"Vibrates on mobile for specified time");function Zc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Yc=function(e){Object(u.a)(n,e);var t=Zc(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newOutlet("on pressed"),r.newOutlet("on released"),r}return n}(Ni.a);Object(pi.a)("buttonPresser",{},"Sends a bang thru one outlet on press and thru another one release",function(){return 0},{inlets:0});function $c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Xc=function(e){Object(u.a)(n,e);var t=$c(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).envelope=new Yn(r.sequencerEngine,r.sequencerEngine.mixSession,(new X.a).forZObject(r.zObject),0),r.envelope.attack=5,r.envelope.decay=90,r.envelope.sustain=.1,r.envelope.release=15,r.newInlet("modulate parameter",function(e){var t=Object(v.a)(e,1)[0];return r.onParameter(t)}),r.newInlet("trigger attack release",function(e){var t=Object(v.a)(e,1)[0];return r.onTriggerAttackRelease(t)}),r.newInlet("attack",function(e){var t=Object(v.a)(e,1)[0];return r.envelope.attack=t}),r.newInlet("decay",function(e){var t=Object(v.a)(e,1)[0];return r.envelope.decay=t}),r.newInlet("release",function(e){var t=Object(v.a)(e,1)[0];return r.envelope.release=t}),r.newInlet("sustain",function(e){var t=Object(v.a)(e,1)[0];return r.envelope.sustain=t}),r.newOutlet("depth mapped"),r}return Object(s.a)(n,[{key:"onParameter",value:function(e){if(Array.isArray(e)){var t=Object(v.a)(e,4),n=t[0],r=t[1],a=t[2],i=t[3];if(r&&n){var o=n.parameters.find(function(e){return e.name.toLowerCase().includes(r.toLowerCase())});if(console.log("parameter found=",o),o&&o.audioParam){if(o.depthParameter||o.initDepth(),this.envelope.connect(o.audioParam,o,0),o.connectToDepth(void 0,this.envelope,!1),void 0!==a&&void 0!==i){var s=this.envelope.getScaleForParameter(o);s.min=a,s.max=i}console.log("sending depth mapped=",o.depthParameter),this.sendMessage("depth mapped",o.depthParameter)}}}}},{key:"onTriggerAttackRelease",value:function(e){var t=e.time,n=e.duration,r=e.velocity;this.envelope.triggerAttackRelease(n,t,r)}}]),n}(Ni.a);Object(pi.a)("envelope",{},"Creates a new envelope that can control parameters",function(){return 0},{inlets:0});var eu={envelope:function(e){new Xc(e);return e.attributes["primary-color"]="#cb3737",e.attributes["secondary-color"]="#1c1c1c",function(){return 0}}},tu=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(isNaN(e))return e;var n=Math.pow(10,t);return Math.round(n*e)/n},nu=n(239),ru=n(129),au=n(208),iu=n(156),ou=n(163);Object(pi.a)("gl.uniform",{value:"",name:"",skipRender:""},"Creates a new uniform variable with value from left-inlet, in GLSL.",function(){return 1},{tags:"GLSL",inlets:3});var su=function(e,t,n){e.needsHotReload=!0,e.needsLoad=!0;var r={};e.uniforms=r;var a={},i=void 0;return function(o,s){var c=Object(v.a)(o,1)[0],u=!!n&&n();if("start"===c){if(void 0!==i)return void(c=i);c=0}"bang"===c&&(c=0);var l=e.id?t()+"_"+e.id.replaceAll("-",""):t();l=l.replaceAll("-","_");var f=Object(nu.c)(c),h=void 0===i||"object"===typeof i||i!==c;if(i=c,f,r[l]){r[l].value=c;var d=r[l].update||window.fallBackUpdate[l];if(d&&h){if(d(c,u),!s)return}else if(d&&!h&&!s)return}else r[l]={value:c};return a.code=l,a.uniforms=r,a.hashCode=Object(au.a)(a.code+f),a.type=f,a.model=function(){return i},a}};Object(pi.a)("gl.variable",{value:"",name:"",type:""},"Creates a new uniform variable with value from left-inlet, in GLSL.",function(){return 1},{tags:"GLSL",inlets:3});var cu=function(e,t,n){e.needsHotReload=!0;var r={};return function(a){var i=Object(v.a)(a,1)[0],o=t()+e.id.replaceAll("-","");return r.code=o,i&&i.uniforms?r.uniforms=i.uniforms:r.uniforms={},i&&i.functions&&(r.functions=i.functions),i&&i.variables?r.variables=Object(d.a)({},i.variables):r.variables={},i&&i.closure&&(r.closure=Object(d.a)({},i.closure)),i&&i.frames&&(r.frames=i.frames),r.variables[o]={code:i&&i.code?i.code:Object(ru.b)(i),type:n()},r.type=n(),r.hashCode=Object(au.a)(r.code),e.flash(),i&&i.model&&(r.model=i.model),r}};Object(pi.a)("gl.if",{value:"",name:"",type:"",condition:"",defaultValue:""},"Creates a new uniform variable with if statement value from left-inlet, in GLSL.",function(){return 1},{isHot:!0,tags:"GLSL",inlets:5});var uu=function(e,t,n,r,a){e.needsHotReload=!0;var i,o={};return function(s){var c=Object(v.a)(s,1)[0],u=t()+e.id.replaceAll("-","");if(o.code=u,c&&c.uniforms?o.uniforms=c.uniforms:o.uniforms={},c&&c.functions&&(o.functions=c.functions),c&&c.variables?o.variables=Object(d.a)({},c.variables):o.variables={},c&&c.closure&&(o.closure=Object(d.a)({},c.closure)),r()&&r().variables&&(o.variables=Object(d.a)({},o.variables,r().variables)),a()&&a().variables&&(o.variables=Object(d.a)({},o.variables,a().variables)),r()&&r().uniforms&&(o.uniforms=Object(d.a)({},o.uniforms,r().uniforms)),a()&&a().uniforms&&(o.uniforms=Object(d.a)({},o.uniforms,a().uniforms)),r()&&r().functions&&(o.functions=Object(d.a)({},o.functions,r().functions)),a()&&a().functions&&(o.functions=Object(d.a)({},o.functions,a().functions)),o.variables[u]={code:c&&c.code?c.code:Object(ru.b)(c),type:{condition:r()?r().code:1,type:n(),defaultValue:a()&&a().code||"0.0"}},o.hashCode=Object(au.a)(o.code+JSON.stringify(o.functions||{})),o.hashCode!==i)return i=o.hashCode,e.flash(),o.type=n(),o}},lu=n(211),fu=function(e){return function(e){var t=new Set;return function e(n){if(n&&"object"===typeof n){if(-1!==t.has(n))return!0;for(var r in t.add(n),n)if(n.hasOwnProperty(r)&&e(n[r]))return!0}return!1}(e)}(e)?Array.isArray(e)?JSON.stringify(e):"object":JSON.stringify(e)},hu=n(588),du=n(362);function pu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var vu=function(e){Object(u.a)(n,e);var t=pu(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zc.d,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;return Object(o.a)(this,n),(r=t.call(this)).subSequence=e,r.sequencerEngine=e.sequencerEngine,r.text="",r.type=a,r.window={id:Object(q.uuid)()},a===zc.a?(r.message=zc.a,r.storedMesage=zc.a):a===zc.c&&(r.text=0),r.id=s||Object(q.uuid)(),r.sequencerEngine.idToObject[r.id]=Object(c.a)(r),i?r.newInlet("Input",function(e){r._onExecute?r._onExecute(e[0]):i.apply(void 0,[e[0]].concat(Object(h.a)(e.splice(1))))}):r.newInlet("Input",function(e){r.type!==zc.c||isNaN(e[0])?"bang"===e[0]?r.execute():(r.storedMessage=r.pipeText(e[0]),r.execute(r.storedMessage)):(r._text=e[0],r.storedMessage=e[0],r.execute(r.storedMessage))}),a!==zc.a&&r.newInlet("Replace",function(e){return r.onReplaceText(e)}),r.newOutlet("Output"),r.newOutlet("Raw Message"),r.min=0,r.max=100,r.round=!1,r.newAttribute("primary-color"),r.newAttribute("secondary-color"),r.newAttribute("background-color"),r.newAttribute("width",0),r.newAttribute("align to center",!1),r.newAttribute("Include in Presentation",!1),r.newAttribute("scripting name"),r.newAttribute("read-only",!1),r.newAttribute("glsl uniform",!1,function(e){return r.setupUniform(e)}),r.newAttribute("trigger GL re-render",!0),r}return Object(s.a)(n,[{key:"isGLUniform",get:function(){return this.attributes["glsl uniform"]}},{key:"setupUniform",value:function(e){this.glUniform=e?su({id:this.id},function(){return"znumber"}):void 0,this.refresh()}},{key:"getObjectType",value:function(){return Va.d}},{key:"getAllParameters",value:function(){return[]}},{key:"delete",value:function(){if(this.isInlet){var e="Input "+this.inletNumber;this.subSequence.deleteInlet(e,this.inletNumber)}if(this.isOutlet){var t="Output "+this.outletNumber;this.subSequence.deleteOutlet(t,this.outletNumber)}this.subSequence.deleteNode(this)}},{key:"getJson",value:function(){var e={id:this.id,isDeleted:this.isDeleted,type:this.type,text:this._text,message:this.type===zc.c?this.message:void 0,inletNumber:this.inletNumber,outletNumber:this.outletNumber,min:this.min,max:this.max,round:this.round},t=this.getAttributesJson();return t&&(e.attributes=t),e}},{key:"interpolate",value:function(e,t,n){e&&t&&this.type===zc.c&&(this._text=e.text*n+t.text*(1-n),this.message=this.text,this.storedMessage=this.text,this.execute(this._text))}},{key:"fromValueJson",value:function(e){this._text=e.text,this.message=this.text,this.storedMessage=this.text,this.execute(this._text)}},{key:"fromJson",value:function(e,t){if(t||(this.id=e.id,this.sequencerEngine.idToObject[this.id]=this),void 0!==e.type&&(this.type=e.type),this.isDeleted=e.isDeleted,e.type===zc.c?this.text=parseFloat(e.text):this.text=e.text,void 0!==e.type&&(this.type=e.type,this.type===zc.a&&(this.message=zc.a,this.storedMessage=zc.a)),this.inletNumber=e.inletNumber,this.outletNumber=e.outletNumber,void 0!==this.inletNumber&&(this.isInlet=!0),void 0!==this.outletNumber&&(this.isOutlet=!0),void 0!==e.min&&(this.min=e.min),void 0!==e.max&&(this.max=e.max),void 0!==e.round&&(this.round=e.round),e.attributes)for(var n in e.attributes)this.setAttribute(n,e.attributes[n]);this.execute(this._text)}},{key:"sendReplacement",value:function(e){if(e=e[0],"string"===typeof this.message){var t=this.message.replaceAll("$1",e);this.execute(t)}else this.execute(e)}},{key:"pipeText",value:function(e){if(this.type===zc.b){var t=Array.isArray(e)?e:[e];return this.message.map(function(e){var n=e;if("string"===typeof e){for(var r=0;r<t.length;r++)n=n.replaceAll("$"+(r+1),t[r]);Object(ke.a)(n)&&(n=parseFloat(n))}return n})}if("string"!==typeof this.message)return this.message;var n=this.message;if(Array.isArray(e))for(var r=0;r<e.length;r++)n=n.replaceAll("$"+(r+1),tu(e[r],3));else n="string"===typeof e?n.replaceAll("$1",e):n.replaceAll("$1",tu(e,3));return n}},{key:"onReplaceText",value:function(e){if(null!==e[0]){if(this.message=e[0],this.lastMessage=this.message,Array.isArray(this.message))this._text=this.message.map(function(e){return"object"===typeof e?fu(e):e}).join(" ");else if(ArrayBuffer.isView(this.message))this._text=Array.from(this.message).join(" ");else if(Array.isArray(e[0]))this._text=e[0].join(" ");else if("string"===typeof e[0]||"number"===typeof e[0])this._text=e[0];else if(e[0])if(e[0].getJson)this._text=fu(e[0].getJson());else try{this._text=fu(e[0])}catch(t){this._text="input"}this.storedMessage=this.message}}},{key:"text",set:function(e){if(this.subSequence.propagate(Object(lu.s)(this,e)),this.type===zc.c)return this._text=e,this.message=e,this.storedMessage=this.message,void this.onValueChange(this.message);e||(e=""),e=e.toString(),this._text=e,this.onValueChange(e);var t=e.split(" ").filter(function(e){return""!=e});if(t.length>1){var n=[];this.type=zc.b;try{if((n=t.map(function(e){return e.startsWith("$")?e:parseFloat(e)})).some(function(e){return(!e.startsWith||!e.startsWith("$"))&&isNaN(e)}))return this.message=e,this.storedMessage=this.message,void(this.type=zc.d)}catch(r){return this.type=zc.d,this.storedMessage=this.message,void(this.message=e)}this.message=n,this.storedMessage=this.message}else try{this.message=Object(ke.a)(e)?parseFloat(e):e,this.storedMessage=this.message,isNaN(this.message)&&(this.message=e)}catch(r){this.message=e,this.storedMessage=this.message}}},{key:"refresh",value:function(){this.lastSentMessage&&this.execute(this.lastSentMessage,!0)}},{key:"execute",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.storedMessage,t=arguments.length>1?arguments[1]:void 0;if(this.lastSentMessage=e,this.glUniform){this.message=e,this.attributes["trigger GL re-render"]||(window.stopRender=!0);var n=this.glUniform([e],t);n&&this.sendMessage("Output",n),this.attributes["trigger GL re-render"]||(window.stopRender=!1),this.sendMessage("Raw Message",e)}else this.sendMessage("Output",e),this.sendMessage("Raw Message",e)}},{key:"duplicate",value:function(){var e=this.getJson(),t=this.state.windows.windowPositions[this.id],n=t.x,r=t.y,a=this.width||200,i=(this.width,this.subSequence.createZMessage(n+a,r,this.dataType));i.fromJson(e,!0);var o=this.state.windows.presentationWindowPositions[this.id];o&&this.dispatch(Object(J.Zc)(i.id,{x:o.x+a,y:o.y}))}},{key:"onPosition",value:function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1];this.dispatch(Object(J.Zc)(this.id,{x:n,y:r})),this.dispatch(Object(J.Ze)(this.id,{x:n,y:r}))}},{key:"select",value:function(){this.dispatch(Object(J.Ed)(this))}}]),n}(Object(du.a)(Object(hu.a)(Qa(Object(fi.a)(function(){return function e(){Object(o.a)(this,e)}}())))));function mu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var yu=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=new vu(e.subSequence,zc.c);return a.text=t,a.min=n,a.max=r,a},bu=function(e){Object(u.a)(n,e);var t=mu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).x=yu(Object(c.a)(r),0),r.y=yu(Object(c.a)(r),0),r.z=yu(Object(c.a)(r),0),r.zObject.hasInletFields=!0,r.newInlet("x",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.x,t)}),r.newInlet("y",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.y,t)}),r.newInlet("z",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.z,t)}),r.newOutlet("Vec3"),r}return Object(s.a)(n,[{key:"on",value:function(e,t){isNaN(t)||(e.text=t,this.sendObject())}},{key:"sendObject",value:function(){var e=[this.x._text,this.y._text,this.z._text];this.sendMessage("Vec3",e)}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{x:this.x._text,y:this.y._text,z:this.z._text})}},{key:"fromJson",value:function(e,t){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.x.text=e.x,this.y.text=e.y,this.z.text=e.z}}]),n}(Ni.a),gu=n(281),Ou=n(138),ju=n(238),ku=n(314);Object(pi.a)("gl.vec3",{x:"",y:"",z:""},"Creates a GLSL expression representing a 3-component vector, from each inlet",function(){return 1},{inletTypes:Object(Ou.l)("float"),type:function(){return"vec3"},isHot:!0,tags:"GLSL",inlets:3});var wu=function(e,t,n){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(r){var a=Object(ou.a)(r,t,n);return e.flash(),"(vec3(".concat(Object(ru.b)(a[0]),", ").concat(Object(ru.b)(a[1]),", ").concat(Object(ru.b)(a[2]),"))")},t,n),function(e,t,n){return[e,t,n]}))};Object(pi.a)("gl.vec2",{x:"",y:""},"Creates a GLSL expression representing a 2-component vector, from each inlet",function(){return 1},{inletTypes:Object(Ou.l)("float"),type:function(){return"vec2"},isHot:!0,tags:"GLSL",inlets:2});var xu=function(e,t){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"vec2(".concat(Object(ru.b)(r[0]),", ").concat(Object(ru.b)(r[1]),")")},t),function(e,t){return[e,t]}))};Object(pi.a)("gl.vec4",{x:"",y:"",z:"",w:""},"Creates a GLSL expression representing a 4-component vector, from each inlet",function(){return 1},{inletTypes:Object(Ou.l)("float"),type:function(){return"vec4"},isHot:!0,inlets:4,tags:"GLSL",connects:{object:"gl.fragColor"}});var Su={"gl.vec2":xu,"gl.vec3":wu,"gl.vec4":function(e,t,n,r){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(a){var i=Object(ou.a)(a,t,n,r);return e.flash(),"vec4(".concat(Object(ru.b)(i[0]),", ").concat(Object(ru.b)(i[1]),", ").concat(Object(ru.b)(i[2]),", ").concat(Object(ru.b)(i[3]),")")},t,n,r),function(e,t,n,r){return[e,t,n,r]}))}};function Pu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Eu=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-10,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,a=new vu(e.subSequence,zc.c);return a.text=t,a.min=n,a.max=r,a},Tu=function(e){Object(u.a)(n,e);var t=Pu(n);function n(e){var r;Object(o.a)(this,n),(r=t.call(this,e)).x=Eu(Object(c.a)(r),0,-1,1),r.y=Eu(Object(c.a)(r),0,-1,1),r.zObject.hasInletFields=!0,r.newInlet("x",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.x,t)}),r.newInlet("y",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.y,t)}),r.newOutlet("List"),r.newOutlet("Vec2");var a=r.id.replaceAll("-","");return r.xUniform=su({},function(){return"vec2x"+a},function(){return!1}),r.yUniform=su({},function(){return"vec2y"+a},function(){return!1}),r.vec2=xu(r.zObject,function(){return r.yUniform([r.y._text],!0)}),r}return Object(s.a)(n,[{key:"on",value:function(e,t){isNaN(t)||(e.text=t,this.sendObject())}},{key:"sendObject",value:function(){var e=[this.x._text,this.y._text],t=this.xUniform([this.x._text],!0);this.yUniform([this.y._text],!0);this.sendMessage("List",e),this.sendMessage("Vec2",this.vec2([t]))}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{x:this.x._text,y:this.y._text})}},{key:"fromJson",value:function(e,t){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.x.text=e.x,this.y.text=e.y}}]),n}(Ni.a);Object(pi.a)("vec3",{},"Creates a 3-component list made out of numbers",function(){return 0},{inlets:0});Object(pi.a)("vec2",{},"Creates a 2-component list made out of numbers",function(){return 0},{inlets:0});function Au(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Mu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mu(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Mu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("rubik.init",{},"Initializes a rubiks cube returning a list of indices");var Ru=[6,3,0,7,4,1,8,5,2],Cu=[2,5,8,1,4,7,0,3,6];Object(pi.a)("rubik.turnFace",{face:"List of indices representing the face being turned",direction:"0 for left and 1 for right",dimension:"x or y"},"Turn a face (represented as list of indices) either left (0) or right (1)",function(){return 1},{inlets:3});Object(pi.a)("rubik.getFace",{indices:"list of indices of the rubik cube (in its current configuration)",value:"value in dimension we want to acces",dimension:"x,y,z"},"Gets a list of indices representing a desired face",function(){return 1},{inlets:3});var Nu=[[0,1,2,3,4,5,6,7,8],[9,10,11,12,13,14,15,16,17],[18,19,20,21,22,23,24,25,26]],Iu=[[0,1,2,9,10,11,18,19,20],[3,4,5,12,13,14,21,22,23],[6,7,8,15,16,17,24,25,26]];Object(pi.a)("rubik.setFace",{indices:"list of indices of the rubik cube (in its current configuration)",value:"value in dimension we want to acces",dimension:"x,y,z"},"Sets a list of indices representing a desired face in the rubiks indices and return the new cube",function(){return 1},{inlets:4});Object(pi.a)("rubik.applyIndices",{"list to shuffle":"",indices:""},"Transforms a given a list using the indices passed in the right inlet",function(){return 1},{inlets:2});var qu={"rubik.turnFace":function(e,t,n){return function(e){var r,a=Object(v.a)(e,1)[0],i=[],o=0,s=Au(("y"===n()?!t():t())?Ru:Cu);try{for(s.s();!(r=s.n()).done;){var c=r.value;i[o]=a[c],o++}}catch(u){s.e(u)}finally{s.f()}return[i]}},"rubik.init":function(){return function(e){Object(Yi.a)(e);for(var t=[],n=0;n<27;n++)t.push(n);return[t]}},"rubik.getFace":function(e,t,n){return function(e){for(var r=Object(v.a)(e,1)[0],a=t(),i="y"===n()?Nu[a]:Iu[a],o=[],s=0;s<i.length;s++)o.push(r[i[s]]);return[o]}},"rubik.setFace":function(e,t,n,r){return function(e){var a=Object(v.a)(e,1)[0],i=n(),o=r(),s=t();Object(h.a)(a),a=Object(h.a)(a);for(var c="y"===o?Nu[i]:Iu[i],u=0;u<c.length;u++)a[c[u]]=s[u];return[a]}},"rubik.applyIndices":function(e,t){return function(e){var n=Object(v.a)(e,1)[0],r=t();if(!r)return[n];for(var a=[],i=0;i<n.length;i++){var o=n[i];a[r[i]]=o}return[a]}}};Object(pi.a)("list.fillIndex",{size:""},"Creates a list of size n with elements from 0...n");var _u={"list.fillIndex":function(){return function(e){for(var t=Object(v.a)(e,1)[0],n=[],r=0;r<t;r++)n.push(r);return[n]}}};function Du(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Fu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Fu(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Fu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Lu=["A","B","C","D","E"];Object(pi.a)("audioFX",{name:""},"Creates an audio fx (to be put somewhere",function(){return 1},{inlets:2});Object(pi.a)("mixChannel",{},"Controls effects in the mix channel");Object(pi.a)("sendChannel",{name:""},"Controls effects in a send channel",function(){return 2},{outlets:["Effects","Send"]});Object(pi.a)("sendVolumes",{name:""},"Controls send volumes of tracks",function(e){return 1},{});Object(pi.a)("groupSendVolumes",{name:""},"Controls send volumes of groups of tracks",function(e){return 1},{});var Bu={audioFX:function(e,t){return function(n){Object(v.a)(n,1)[0];var r=Object($a.b)(t(),e.sequencerEngine);if(r)return[r]}},mixChannel:function(e){return function(t){var n=Object(v.a)(t,1)[0],r=e.sequencerEngine.channelMixer.masterChannel.effectsChain,a=r.effects.find(function(e){return e.name===n.name});return a?[a]:(r.addEffect(n),[n])}},sendChannel:function(e,t){return function(n){var r=Object(v.a)(n,1)[0],a=e.sequencerEngine.sends.sends.find(function(e){return e.name.toLowerCase()===t().toLowerCase()}),i=a.effectsChain,o=i.effects.find(function(e){return e.name===r.name});return o?[o,a]:(i.addEffect(r),[r,a])}},sendVolumes:function(e,t){return function(n){var r=Object(v.a)(n,1)[0];if(Array.isArray(r)){var a=Object(v.a)(r,2),i=a[0],o=a[1],s=e.sequencerEngine.tracks[i];if(s){var c=s.sendNodeVolumeParameters[Lu.indexOf(t())];if(c){var u=yb(o,-80,2,1);c.set(u,!1)}}}}},groupSendVolumes:function(e,t){return function(n){var r=Object(v.a)(n,1)[0];if(Array.isArray(r)){var a=Object(v.a)(r,2),i=a[0],o=a[1],s=e.sequencerEngine.groups.groups[i];if(s){var c,u=Du(s.tracks);try{for(u.s();!(c=u.n()).done;){var l=c.value;if(!l)return;var f=l.sendNodeVolumeParameters[Lu.indexOf(t())];if(!f)return;var h=yb(o,-80,2,1);f.set(h,!1)}}catch(d){u.e(d)}finally{u.f()}}}}}};function zu(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ju(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ju(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ju(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Vu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Hu=function(e){Object(u.a)(n,e);var t=Vu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet("Playback Speed",function(e){var t=Object(v.a)(e,1)[0];return r.onPlaybackSpeed(t)}),r.newInlet("bpm changed",function(e){var t=Object(v.a)(e,1)[0];r.bpm=t,r.sendMessage("bpm",t)}),r.newInlet("snap detune",function(){r.snapDetune()}),r.newInlet("clear detune",function(){r.lastDetune=void 0}),r.newInlet("Detune Only Speed",function(e){var t=Object(v.a)(e,1)[0];r.onPlaybackSpeed(t,!0)}),r.newOutlet("bpm"),r.newOutlet("detune"),r.bpm=r.sequencerEngine.bpm,r}return Object(s.a)(n,[{key:"snapDetune",value:function(){var e=this;this.lastDetune&&function(){var t=e.lastDetune;t-=t%100;var n,r=zu(e.sequencerEngine.tracks);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.instrument?a.instrument.detuneParameter&&(a.instrument.detuneParameter.skipPatternLock=!0,a.instrument.detuneParameter.set(t,!1,void 0,re.a.Master.context.currentTime,500),a.instrument.detuneParameter.skipPatternLock=!1):a.getSamplers().forEach(function(e){e.detuneParameter.skipPatternLock=!0,e.detuneParameter.set(t,!1,void 0,re.a.Master.context.currentTime,500),e.detuneParameter.skipPatternLock=!1})}}catch(i){r.e(i)}finally{r.f()}}()}},{key:"onPlaybackSpeed",value:function(e,t){var n=50+(this.bpm-50)*(1-e),r=1e3*(1-e)-1e3;this.lastDetune=r,t||this.sequencerEngine.bpmParameter.set(n,!1);var a,i=zu(this.sequencerEngine.tracks);try{for(i.s();!(a=i.n()).done;){var o=a.value;o.instrument?o.instrument.detuneParameter&&(o.instrument.detuneParameter.skipPatternLock=!0,o.instrument.detuneParameter.set(r,!1),o.instrument.detuneParameter.skipPatternLock=!1):o.getSamplers().forEach(function(e){e.detuneParameter.skipPatternLock=!0,e.detuneParameter.set(r,!1),e.detuneParameter.skipPatternLock=!1})}}catch(s){i.e(s)}finally{i.f()}t||this.sendMessage("bpm",n),this.sendMessage("detune",r),this.sequencerEngine.globalDetune=r,r-=r%100}}]),n}(Ni.a);Object(pi.a)("playback",{},"",function(){return 0},{inlets:0});function Uu(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Gu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gu(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Gu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Wu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ku=function(e){Object(u.a)(n,e);var t=Wu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet("group volumes",function(e){var t=Object(v.a)(e,1)[0];return r.onLevels(t)}),r.newOutlet("group volumes "),r.newOutlet("group levels"),r.sequencerEngine.groups.zObject=Object(c.a)(r),r.sequencerEngine.groups.startSendingLevels(),r}return Object(s.a)(n,[{key:"groups",get:function(){return this.sequencerEngine.groups.groups}},{key:"sendLevels",value:function(){var e,t=[],n=Uu(this.groups);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r){var a=r.volume;t.push(a<pb?0:Math.pow((a-pb)/(1-pb),window.ROOTY))}else t.push(0)}}catch(i){n.e(i)}finally{n.f()}this.sendMessage("group volumes ",t)}},{key:"onLevels",value:function(e){console.log("on levels=",e);for(var t=0;t<e.length;t++){var n=e[t];if(!isNaN(n)){var r=this.groups[t];if(r){var a=yb(n,pb,1,1);r.volume!==a&&(console.log("sending %s to group",n,r,r.volume),r.setVolume(a,!1,!1))}}}}}]),n}(Ni.a);Object(pi.a)("groups",{"":""},"Controls groups",function(){return 0},{inlets:0});var Qu=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"function"===typeof e?e.apply(void 0,n):e};function Zu(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Yu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Yu(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Yu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("concat",{},"Concatenates the list arguments together",void 0,{tags:"List",inlets:function(e){return e},isHot:!0});Object(pi.a)("lconcat",{},"Concatenates the list arguments together (lazily)",void 0,{tags:"List",inlets:function(e){return e}});Object(pi.a)("list.prependIndex",{},"Prepends index at every element of inputted list");Object(pi.a)("list.appendEvery",{toAppend:""},"Prepends index at every element of inputted list",function(){return 1},{inlets:2});Object(pi.a)("listMax",{},"returns max number of list",function(){return 1},{inlets:1,tags:"List"});Object(pi.a)("push",{length:"arg"},"Pushes msgs to beginning of list until length limit is met (First-in-first-out)",void 0,{tags:"List"});Object(pi.a)("append",{length:"arg"},"Pushes msgs into list until limit (bang sends its stored list if needed)",void 0,{inlets:2,tags:"List"});Object(pi.a)("appendList",{"list to append":"",limit:""},"Pushes msgs into list until limit",void 0,{inlets:2,tags:"List"});Object(pi.a)("nth",{n:"n"},"Get nth element from list",void 0,{inlets:2,tags:"List",isHot:!0});Object(pi.a)("map",{fn:""},"Applies function to each element of list",void 0,{tags:"List",inlets:["list","fn"]});Object(pi.a)("interleaf",{value:"",position:""},"Interleaves a number every x many positions",void 0,{tags:"List",inlets:3});var $u=function(e,t,n){var r;return function(e){var a=Object(v.a)(e,1)[0],i=Qu(t)||0,o=Qu(n)||2;if(ArrayBuffer.isView(a))return 0===a.length?a:[r=Xu(a,i,o,r)];if(Array.isArray(a)){for(var s=[],c=0;c<a.length;c++)c>0&&c%o===0&&s.push(i),s.push(a[c]);return a.length%o===0&&s.push(i),[s]}}},Xu=function(e,t,n,r){for(var a=e.length+Math.floor(e.length/n),i=r&&a.lengthh===r.length?r:new Float32Array(a),o=0,s=0;s<e.length;s++)s>0&&s%n===0&&(i[o++]=t),i[o++]=e[s];return e.length%n===0&&(i[i.length-1]=t),i};Object(pi.a)("list",{},"Creates a list out of the inputed message (if possible",void 0,{tags:"List"});Object(pi.a)("sublist",{},"Creates a list out of the inputed message (if possible",void 0,{tags:"List"});Object(pi.a)("smokeVertices",{size:""},"Yo",void 0,{inlets:3});Object(pi.a)("smokeColors",{size:""},"Yo");Object(pi.a)("flattenList",{},"Flattens a list of lists",void 0,{tags:"List"});Object(pi.a)("cList",{itemSize:""},"Turns a list into  [0,1,2,3]");Object(pi.a)("list.partition",{list:"",size:""},"Partitions 1d list into groups based on size",void 0,{inlets:2,isHot:!0});Object(pi.a)("list.reverse",{list:""},"Reverse a list and outputs the reversed list out of outlet");Object(pi.a)("list.indexOf",{},"Indexof in list",function(){return 1},{tags:"List",inlets:2,isHot:!0});Object(pi.a)("fillArray",{val:"",start:"",end:"",length:""},"Fills a new array of given length from start to end with value",function(){return 1},{inlets:4});Object(pi.a)("interleavedConcat",{lists:""},"Intereaves a list of lists");Object(pi.a)("centerFillArray",{val:"",length:""},"Fills a new array of given length from start to end with value",function(){return 1},{inlets:2});Object(pi.a)("listOsc",{"list of osc":""},"Returns a list for an oscilloscope ready to be thrown into a texture",function(){return 1},{inlets:1});Object(pi.a)("sparseList",{"List of indices":"","Length of outputed list":"","Value to place in each slot":"","Chunk Size":"","Chunk Offset":"","Inputed Array":"","Default Value":""},"Returns a list of given length w elements placed at indices of inputed list",function(){return 1},{isHot:!0,inlets:7});Object(pi.a)("singleSparseList",{"List of indices":"","Length of outputed list":"","Value to place in each slot":"","Chunk Size":"","Chunk Offset":"","Inputed Array":""},"Returns a list of given length w elements placed at indices of inputed list",function(){return 1},{inlets:5});Object(pi.a)("sparseMerge",{},"Merges lists together into one list ",void 0,{tags:"List",inlets:function(e){return e},isHot:!0});Object(pi.a)("list.skipEvery",{list:"",chunkSize:"",offsetToSkip:""},"Filters every #'d element out of inputted list",function(){return 1},{inlets:2});Object(pi.a)("list.isEveryEmpty",{list:"",chunkSize:"",offsetToSkip:"",threshold:""},"Filters every #'d element out of inputted list and returns true if empty",function(){return 1},{inlets:4});Object(pi.a)("list.ratioBelow",{list:"",chunkSize:"",offsetToSkip:"",threshold:""},"Returns ratio of elements below a threshold",function(){return 1},{inlets:4});Object(pi.a)("list.fromSparse",{sparseList:"",partitionSize:""},"",function(){return 1},{inlets:2,isHot:!0});Object(pi.a)("repeatList",{listToRepeat:"","number of repeats":""},"repeats an inputed list for a number of times",function(){return 1},{inlets:2});Object(pi.a)("list.coordTexture",{"list of coordinates":""},"Creates a 4 dimensional list out of 2 dimensional coordinates");var el=function(e){return Math.max(0,Math.min(255,127+127*e))};Object(pi.a)("fakeNormalize",{array:"",factor:""},"F",function(){return 1},{inlets:2});Object(pi.a)("normalizeDecimal",{array:"",factor:""},"F",function(){return 1},{inlets:2});Object(pi.a)("maxBin",{array:""},"F",function(){return 1},{inlets:1});Object(pi.a)("list.indicesFromToggles",{},"",function(){return 1},{});var tl={"list.indicesFromToggles":function(e){return function(e){for(var t=Object(v.a)(e,1)[0],n=[],r=0;r<t.length;r++)t[r]&&n.push(r);return[n]}},maxBin:function(e,t){return function(e){for(var t=Object(v.a)(e,1)[0],n=-1e7,r=-1,a=0;a<t.length;a++)t[a]>n&&(r=a,n=t[a]);return[r]}},fakeNormalize:function(e,t){return function(e){for(var n=Object(v.a)(e,1)[0],r=0;r<n.length;r++)n[r]=(n[r]+1)/2*t();return[n]}},repeatList:function(e,t){return function(e){for(var n=Object(v.a)(e,1)[0],r=[],a=t()||1,i=0;i<a;i++)for(var o=0;o<n.length;o++)r.push(n[o]);return[r]}},"list.coordTexture":function(e){return function(e){for(var t=Object(v.a)(e,1)[0],n=[],r=0;r<t.length;r+=2){var a=el(t[r]),i=el(t[r+1]);n.push(a),n.push(i),n.push(0),n.push(0)}return[n]}},normalizeDecimal:function(e,t){return function(e){for(var n=Object(v.a)(e,1)[0],r=0;r<n.length;r++)n[r]=Math.max(0,Math.min(1,(n[r]- -160)/164))*t();return[n]}},"list.fromSparse":function(e,t){return function(e){for(var n=Object(v.a)(e,1)[0],r=[],a=0;a<n.length;a+=t())for(var i=0;i<t();i++)n[a+i]&&r.push(i);return[r]}}},nl=n(1845),rl=n.n(nl);function al(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return il(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return il(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function il(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ol=new oi.a;Object(pi.a)("color.toTextureList",{hex:""},"Converts a list of colors (in hex format) to a list, for a texture",function(){return 1});var sl=function(){return function(e){var t=Object(v.a)(e,1)[0];"string"===typeof t&&(t=t.split(" "));var n,r=[],a=al(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i){var o=cl()([i])[0],s=Object(v.a)(o,3),c=s[0],u=s[1],l=s[2];r.push(Math.floor(255*c)),r.push(Math.floor(255*u)),r.push(Math.floor(255*l)),r.push(255)}}}catch(f){a.e(f)}finally{a.f()}return[r]}};Object(pi.a)("sample.toColor",{hash:""},function(){return 1});Object(pi.a)("hexToRGB",{"hexadecimal color string":""},"Returns rgb/rgba values in 3/4-part array for hexadecimal string");var cl=function(e){return function(e){var t=Object(v.a)(e,1)[0];if("string"===typeof t&&"#"===t[0]){var n=(t=t.slice(1)).slice(0,2),r=t.slice(2,4),a=t.slice(4,6),i=t.slice(6,8),o=[parseInt(n,16)/255,parseInt(r,16)/255,parseInt(a,16)/255];return""!==i&&o.push(parseInt(i,16)/255),[o]}}};Object(pi.a)("color.brightness",{"color hex":""},"Returns brightness of color",function(){return 1},{});Object(pi.a)("color.name",{"color hex":""},"Returns name of color",function(){return 1},{});var ul={"color.brightness":function(e){return function(e){var t=Object(v.a)(e,1)[0];return ol.getBrightness(t)}},"sample.toColor":function(e){return function(e){var t=Object(v.a)(e,1)[0];return ol.getColorForHash(t)}},"color.toTextureList":sl,"color.name":function(e){return function(e){var t=Object(v.a)(e,1)[0];return[rl.a.name(t)[1]]}},hexToRGB:cl},ll={moveTo:function(e,t,n,r){t.moveTo(n,r)},clear:function(e,t){t.clearRect(0,0,2*e.zObject.width,2*e.zObject.height)},rect:function(e,t,n,r,a,i){t.beginPath(),t.rect(n,r,a,i)},lineTo:function(e,t,n,r){t.lineTo(n,r)},beginPath:function(e,t){t.beginPath()},closePath:function(e,t){t.closePath()},circle:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;t.beginPath(),a>0&&t.arc(n,r,a,i,o)},stroke:function(e,t,n){t.strokeStyle=n,t.stroke()},lineWidth:function(e,t,n){t.lineWidth=n},fill:function(e,t,n){t.fillStyle=n,t.fill()},triangle:function(e,t,n,r,a,i,o,s){t.beginPath(),t.moveTo(n,r),t.lineTo(a,i),t.lineTo(o,s),t.closePath()}},fl=(n(1847),Object(d.a)({},ll,{drawArray:function(e,t,n,r,a){t.fillStyle=r;for(var i=0;i<a.length;i+=2){var o=a[i],s=a[i+1];if(!(o>e.zObject.width||s>e.zObject.height)){t.beginPath();var c=o%n;o-=c,o+=n-c,s-=s%n,t.rect(o,s,n,n),t.fill()}}},drawTriangles:function(e,t,n,r){if(!window.arrDebug){t.strokeStyle=n;for(var a=0;a<r.length;a+=6)t.beginPath(),t.moveTo(r[a],r[a+1]),t.lineTo(r[a+2],r[a+3]),t.lineTo(r[a+4],r[a+5]),t.stroke()}}}));function hl(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return dl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dl(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function dl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var vl=function(e){Object(u.a)(n,e);var t=pl(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet("operation",function(e){var t=Object(v.a)(e,1)[0];return r.onOperation(t)}),r.customAttributes=[],r}return Object(s.a)(n,[{key:"subpatch",get:function(){if(this.subSequence.zObject)return this.subSequence}},{key:"loadBang",value:function(){if(this.subpatch){var e=this.subpatch.zObject.attributes;for(var t in e)this.subpatch.zObject.setAttribute(t,e[t])}}},{key:"onOperation",value:function(e){var t=this;if(this.subpatch){var n=e.split(" ");"create"===n[0]&&(this.customAttributes.push(n[1]),this.newOutlet("Attribute "+n[1]),this.subpatch.zObject.newAttribute(n[1],"",function(e){t.sendMessage("Attribute "+n[1],e)}))}}},{key:"getJson",value:function(e){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e),{customAttributes:this.customAttributes})}},{key:"fromJson",value:function(e,t){if(Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e),e.customAttributes){e.customAttributes=Array.from(new Set(e.customAttributes));var r,a=hl(e.customAttributes);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.onOperation("create "+i)}}catch(o){a.e(o)}finally{a.f()}}}}]),n}(Ni.a);Object(pi.a)("attributes",{operation:""},"Allows creating and controlling attributes for the containing subpatch dynamically",function(){return 0},{inlets:0});var ml=n(164);function yl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var bl=function(e){Object(u.a)(n,e);var t=yl(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).loader=new ml.Y,r.newInlet("load by IPFS",function(e){var t=Object(v.a)(e,1)[0];return r.loadImage(t)}),r.newOutlet("texture"),r.zObject.newAttribute("load on start",!0),r.loading=!1,r.hashToTexture={},r}return Object(s.a)(n,[{key:"loadImage",value:function(e){var t=this;return new Promise(function(n){t.loading=!0;0;if(t.hashToTexture[e])return t.sendMessage("texture",t.hashToTexture[e]),t.texture=t.hashToTexture[e],t.loading=!1,void n();t.imageHash=e,t.zObject.onValueChange();var r=e.startsWith("http")?e:"https://zequencer.io/ipfs/"+e;t.sendMessage("texture",t.loader.load(r,function(r){t.loading=!1,t.texture=r,t.hashToTexture[e]=r,n()}))})}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{imageHash:this.imageHash})}},{key:"fromJson",value:function(e,t,r){console.log("TEXTURE LOADER.fromJson"),Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),(r||this.zObject.attributes["load on start"])&&this.loadImage(e.imageHash)}}]),n}(Ni.a);Object(pi.a)("three.dataTexture",{dataArray:"",width:"",height:""},"Creates a three.js data texture out of an array of data and optional width/height",function(){return 1},{inlets:3});var gl=function(e,t,n){var r,a=void 0;return function(e){var i=Object(v.a)(e,1)[0];if(Array.isArray(i)||ArrayBuffer.isView(i)){var o=t()||Math.round(Math.sqrt(i.length)),s=n()||Math.round(Math.sqrt(i.length));return ArrayBuffer.isView(i)?(a&&a.length===i.length||(a=new Uint8Array(o*s*4)),a.set(i)):(a&&a.length===i.length||(a=new Uint8Array(i.length)),i.length<=a.length?a.set(i):a.set(i.slice(0,a.length))),r&&r.source.data.width===o&&r.source.data.height===s||(r=new ml.m(a,o,s)),r.needsUpdate=!0,r}}};Object(pi.a)("three.textureLoader",{},"Load images into three.js textures",function(){return 0},{inlets:0});var Ol={"three.dataTexture":gl,"three.textureLoader":function(e){return e.effect=new bl(e),e.needsLoad=!0,function(t){Object(Yi.a)(t),e.effect.imageHash&&e.effect.loadImage(e.effect.imageHash)}}};Object(pi.a)("print",{message:"to print"},"prints to javascript console");function jl(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return kl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kl(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function kl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function wl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var xl=function(e){Object(u.a)(n,e);var t=wl(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet("ADSR Levels",function(e){return r.onADSRLevels(e[0])}),r.newOutlet("ADSR levels"),r.newInlet("Oscillator Levels",function(e){return r.onOscillatorLevels(e[0])}),r.newOutlet("Oscillator levels"),r}return Object(s.a)(n,[{key:"sendOscillatorLevels",value:function(){if(this.synth){var e=this.synth.oscillatorNodes.map(function(e){return e.oscillatorLevelParameter.get(!0)});this.sendMessage("Oscillator levels",e)}}},{key:"sendADSRLevels",value:function(){if(this.synth){this.synth.ampEnvelope;this.sendMessage("ADSR levels",[this.attack,this.decay,this.sustain,this.release])}}},{key:"amp",get:function(){return this.synth.ampEnvelope}},{key:"attack",get:function(){if(this.synth)return Pl(this.amp.attack,this.amp.attackParameter.min,this.amp.attackParameter.max)},set:function(e){if(this.synth){var t=Sl(e,this.amp.attackParameter.min,this.amp.attackParameter.max);t!==this.amp.attack&&this.amp.attackParameter.set(t,!1)}}},{key:"decay",get:function(){if(this.synth)return Pl(this.amp.decay,this.amp.decayParameter.min,this.amp.decayParameter.max)},set:function(e){if(this.synth){var t=Sl(e,this.amp.decayParameter.min,this.amp.decayParameter.max);t!==this.amp.decay&&this.amp.decayParameter.set(t,!1)}}},{key:"sustain",get:function(){if(this.synth)return this.amp.sustain},set:function(e){this.synth&&e!==this.amp.sustain&&this.amp.sustainParameter.set(e,!1)}},{key:"release",get:function(){if(this.synth)return Pl(this.amp.release,this.amp.releaseParameter.min,this.amp.releaseParameter.max)},set:function(e){if(this.synth){var t=Sl(e,this.amp.releaseParameter.min,this.amp.releaseParameter.max);t!==this.amp.release&&this.amp.releaseParameter.set(t,!1)}}},{key:"onOscillatorLevels",value:function(e){this.synth&&Array.isArray(e)&&this.synth.oscillatorNodes.forEach(function(t,n){var r=e[n%e.length];r!==t.oscillatorLevelParameter.get(!0)&&t.oscillatorLevelParameter.set(r,!1)})}},{key:"onADSRLevels",value:function(e){this.synth&&Array.isArray(e)&&(isNaN(e[0])||(this.attack=e[0]),isNaN(e[1])||(this.decay=e[1]),isNaN(e[2])||(this.sustain=e[2]),isNaN(e[3])||(this.release=e[3]))}},{key:"linkSynth",value:function(e){this.synth=e,this.synth.controller=this}},{key:"getJson",value:function(e){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e),{synthId:this.synth.id})}},{key:"fromJson",value:function(e,t){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t);var r,a=jl(this.subSequence.getRootSubSequence().tracks);try{for(a.s();!(r=a.n()).done;){var i=r.value;i&&i.instrument&&i.instrument.id===e.synthId&&this.linkSynth(i.instrument)}}catch(o){a.e(o)}finally{a.f()}}}]),n}(Ni.a),Sl=function(e,t,n){return(e=Math.max(0,e))*(n-t)},Pl=function(e,t,n){return e=Math.max(0,e),Math.pow((e-t)/(n-t),1)};Object(pi.a)("synthcontrol",{},"FUCK",function(){return 0},{inlets:0});Object(pi.a)("switch",{switchNumber:""},"switch inlets based on first inlet",void 0,{isHot:!0,inlets:function(e){return e+1}});Object(pi.a)("outSwitch",{switchNumber:""},"switch inlets based on first inlet",function(e){return e},{inlets:function(e){return 2}});var El=n(423);Object(pi.a)("globalReverse",{},"When 1 is received from inlet, whole track is reversed. When 0 whole track is not reversed",function(){return 0},{inlets:1});Object(pi.a)("loop",{"looping on":"","loop length (bars)":""},"When 1 is received in left inlet, looping starts. O stops loop and continues play",function(){return 0},{inlets:2,isHot:!0});Object(pi.a)("gl.xyOscilloscope",{"left texture":"","right texture":"",uv:"","num samples":"",lineWidth:""},"",function(){return 1},{inletTypes:["sampler2D","sampler2D","vec2","float","float"],type:"float",isHot:!0,inlets:5});function Tl(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Al(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Al(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Al(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ml(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Rl=function(e,t){var n=t.zobject;e.instances.forEach(function(e){var t=e.lookupObject(n);console.log("DELETING OBJ=",n,t),t&&t.delete()})},Cl=function(e,t){var n=t.zmessage;e.instances.forEach(function(e){var t=e.lookupObject(n);console.log("DELETING OBJ=",n,t),t&&e.deleteNode(t)})},Nl=function(e,t){var n=t.zobject,r=n._text;e.instances.forEach(function(e){e.registerObject(n,e.createZObject(0,0,r))})},Il=function(e,t){var n=t.zmessage,r=n.dataType;e.instances.forEach(function(e){var t=e.createZMessage(0,0,r);e.registerObject(n,t)})},ql=function(e,t){var n=t.inlet,r=t.isInstanceInlet;e.instances.forEach(function(e){e.registerObject(n,r?e.newInstanceInlet():e.newInlet())})},_l=function(e,t){var n=t.outlet;e.instances.forEach(function(e){e.registerObject(n,e.newOutlet())})},Dl=function(e,t){var n=t.sourceNode,r=t.destNode,a=t.sourceType,i=t.destType;e.instances.forEach(function(e){var t=e.lookupObject(n);e.lookupObject(r).connectInlet(i,t,a)})},Fl=function(e,t){var n=t.sourceNode,r=t.destNode,a=t.sourceType,i=t.destType;e.instances.forEach(function(e){var t=e.lookupObject(n);e.lookupObject(r).disconnectInlet(i,t,a)})},Ll=function(e,t){var n=t.zobject,r=t.text;e.instances.forEach(function(e){var t=e.lookupObject(n);t&&(t.text=r)})},Bl=function(e,t){var n=t.zmessage,r=t.text;e.instances.forEach(function(e){var t=e.lookupObject(n);t&&(t.text=r)})},zl=function(e,t){var n=t.inletNumber;e.instances.forEach(function(e){var t=e.inletObjects.find(function(e){return e.inletNumber===n});e.toggleInlet(t)})};function Jl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Vl(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Hl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Hl(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Hl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ul=function(e,t){var n={};for(var r in t)n[e[r]||r]=t[r];return n},Gl=function(e,t){var n={};for(var r in t){var a,i=Wl(e,r),o=[],s=Vl(t[r]);try{for(s.s();!(a=s.n()).done;){var c=a.value,u={};for(var l in c)u[l]=Wl(e,c[l]);o.push(u)}}catch(f){s.e(f)}finally{s.f()}n[i]=o}return n},Wl=function(e,t){var n=t.split(".");return 1===n.length?e[n[0]]||t:n[0]+"."+e[n[1]]};function Kl(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ql(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ql(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ql(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Zl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Yl=n(591),$l=n(584);function Xl(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ef(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ef(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ef(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var tf=function(){function e(t){Object(o.a)(this,e),this.subpatch=t,this.nameToObject={},this.hiddenObjects=[],this.parameters=[]}return Object(s.a)(e,[{key:"createParameters",value:function(){var e=this;this.parameters=[],this.getOptionsAtLevel().filter(function(t){return!e.hiddenObjects.includes(t)}).forEach(function(t){return e.createParameter(t)})}},{key:"createParameter",value:function(e){var t=this.getVariableContext(e),n=this.getFullVariableName(""===t?e.id:t);this.parameters.push(new he.a(n,e,function(t,n){e.getObjectType()===Va.d?(e.text=n,e.execute()):e.effect.setValue(n)},{min:this.getVariableMin(e),max:this.getVariableMax(e),defaultValue:this.getVariableValue(e)}))}},{key:"getVariableMin",value:function(e){return e.effect?0:e.min}},{key:"getVariableMax",value:function(e){return e.effect?0:e.max}},{key:"getVariableValue",value:function(e){return e.effect?e.effect.value:e.message}},{key:"getJson",value:function(){return{hiddenObjects:this.hiddenObjects.map(function(e){return e.id}),parameters:this.parameters.map(function(e){return{name:e.name,id:e.id,min:e.min,max:e.max,depth:e.depth}})}}},{key:"fromJson",value:function(e){if(e){var t=this.getOptionsAtLevel();if(this.hiddenObjects=e.hiddenObjects.map(function(e){return t.find(function(t){return t.id===e})}).filter(function(e){return e}),e.parameters&&e.parameters.length>0){this.createParameters();for(var n=0;n<e.parameters.length;n++){var r=this.parameters[n];r&&(r.id=e.parameters[n].id,r.name=e.parameters[n].name,e.parameters[n].min&&(r.min=e.parameters[n].min,r.max=e.parameters[n].max,r.depth=e.parameters[n].depth))}}}}},{key:"hideObject",value:function(e){this.hiddenObjects.push(e)}},{key:"registerPattr",value:function(e,t){this.nameToObject[e]=t}},{key:"getValue",value:function(e){return e.getObjectType()===Va.d?e.message:e.effect?e.effect.value:0}},{key:"getFullVariableName",value:function(e){for(var t=this.subpatch,n=[""];t.getRootSubSequence;)t.zObject&&n.push(t.zObject.args[0]),t=t.subSequence;return n.reverse(),n.join("::")+e}},{key:"getOptionsAtLevel",value:function(){return[].concat(Object(h.a)(this.subpatch.zMessages.filter(function(e){return e.type===zc.c})),Object(h.a)(this.subpatch.zObjects.filter(function(e){return"macro"===e.name})))}},{key:"getNextLevels",value:function(){return this.subpatch.zObjects.filter(function(e){return e.effect&&!e.effect.implements&&e.effect.pattr}).map(function(e){return e.effect.pattr})}},{key:"getVariableContext",value:function(e){var t=Object.values(e.getOutboundNodes()).flat(2).map(function(e){return e.node}),n=t.find(function(e){return"gl.uniform"===e.name});if(n)return n.args[0];var r=t.find(function(e){return e.name});return r?r.name:""}},{key:"getNestedParameters",value:function(){var e,t=Object(h.a)(this.parameters),n=Xl(this.getNextLevels());try{for(n.s();!(e=n.n()).done;){var r=e.value;t=[].concat(Object(h.a)(t),Object(h.a)(r.getNestedParameters()))}}catch(a){n.e(a)}finally{n.f()}return t}}]),e}();function nf(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return rf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rf(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function rf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function af(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var of=function(e){return function(e){Object(u.a)(n,e);var t=af(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).zObjects=[],e.zMessages=[],e}return Object(s.a)(n,[{key:"initPattr",value:function(){this.pattr=new tf(this)}},{key:"updateZObjectRedux",value:function(){this.sequencerEngine.isLoading||this.dispatch(Object(J.lf)(this.id,Object(h.a)(this.zObjects)))}},{key:"updateZMessageRedux",value:function(){this.sequencerEngine.isLoading||this.dispatch(Object(J.af)(this.id,Object(h.a)(this.zMessages)))}},{key:"createZObject",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=this.newZObject();return n&&(a.text=n),e&&!this.sequencerEngine.isLoading&&this.dispatch(Object(J.Ze)(a.id,{x:e,y:t})),this.subSequence.presentationMode&&a.setAttribute("Include in Presentation",!0),this.zObjects=[].concat(Object(h.a)(this.zObjects),[a]),this.updateZObjectRedux(),void 0===e||void 0===t?a:(!this.sequencerEngine.isLoading&&r&&this.dispatch(Object(J.Ed)(a)),"subpatch"===a.name&&Object(hi.c)("preset.new"),a)}},{key:"createZMessage",value:function(e,t,n,r,a,i,o,s){var c=new vu(this,n,r,a);return i&&(c.text=i),this.presentationMode&&c.setAttribute("Include in Presentation",!0),s&&(c.dragOnLoad=s),e&&!this.sequencerEngine.isLoading&&this.dispatch(Object(J.Ze)(c.id,{x:e,y:t})),this.zMessages=[].concat(Object(h.a)(this.zMessages),[c]),this.updateZMessageRedux(),!this.sequencerEngine.isLoading&&o&&this.dispatch(Object(J.Ed)(c)),c}},{key:"getZObjectsJson",value:function(e){return{zObjects:this.zObjects.filter(function(e){return!e.doNotSave}).map(function(t){return t.getJson(e)}),zMessages:this.zMessages.map(function(e){return e.getJson()})}}},{key:"loadZObjectsJson",value:function(e){if(e){var t,n=e.zObjects,r=e.zMessages,a=nf(n);try{for(a.s();!(t=a.n()).done;){var i=t.value;this.createZObject().fromJson(i)}}catch(u){a.e(u)}finally{a.f()}var o,s=nf(r);try{for(s.s();!(o=s.n()).done;){var c=o.value;this.createZMessage().fromJson(c)}}catch(u){s.e(u)}finally{s.f()}}}},{key:"executeAllMessages",value:function(){this.zMessages.forEach(function(e){return e.execute()});var e,t=nf(this.zObjects);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isSubPatch&&n.effect.zMessages.forEach(function(e){return e.execute()})}}catch(r){t.e(r)}finally{t.f()}}},{key:"deleteNode",value:function(e,t){if(!t){var n=e;n.inletNumber,n.outletNumber,n.isInlet,n.isOutlet}if(this.zObjects.includes(e)||this.zMessages.includes(e)||!e.zObject||(e=e.zObject),e.plugin){var r=this.state.plugins.pluginsLoaded.filter(function(t){return t!==e.plugin});this.dispatch(Object(J.Xc)(r))}e.pluginViewerFor&&e.pluginViewerFor.delete(),this.zObjects.includes(e)&&(this.propagate(Object(lu.u)(e)),e.disposeMessaging(),this.zObjects=this.zObjects.filter(function(t){return t!==e}),this.dispatch(Object(J.lf)(this.id,Object(h.a)(this.zObjects)))),this.zMessages.includes(e)&&(this.propagate(Object(lu.r)(e)),e.disposeMessaging(),this.zMessages=this.zMessages.filter(function(t){return t!==e}),this.dispatch(Object(J.af)(this.id,Object(h.a)(this.zMessages))))}},{key:"scheduleZObjects",value:function(e,t){var n,r=nf(this.sequencerEngine.tickingObjects);try{for(r.s();!(n=r.n()).done;){n.value.sendMessageToInlet([S.n,t,e])}}catch(a){r.e(a)}finally{r.f()}}},{key:"stopZObjects",value:function(){var e,t=nf(this.zObjects);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.needsStop)n.effect&&n.effect.stop?n.effect.stop():n.sendMessageToInlet([S.l]);else if(n.needsTick)n.sendMessageToInlet([S.l]);else if(n.effect&&n.effect.zObjects){var r,a=nf(n.effect.zObjects);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.needsTick&&i.sendMessageToInlet([S.l])}}catch(o){a.e(o)}finally{a.f()}}}}catch(o){t.e(o)}finally{t.f()}}},{key:"loadBangZObjects",value:function(){if(!(this.instances&&this.instances.length>0)){(new Date).getTime();var e,t=nf(this.zObjects);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.needsLoad)if("gl.uniform"===n.name){var r=Object.values(n.getInboundNodes()).flat().map(function(e){return e.node}).filter(function(e){return e.type===zc.c});if(0===r.length){if(n.subSequence.implements)continue;n.sendMessageToInlet([S.k])}r.forEach(function(e){e.skipLoad=!0,e.execute(e.message)})}else n.sendMessageToInlet([S.k]);else n.effect&&n.effect.zObjects&&n.effect.loadBangZObjects()}}catch(s){t.e(s)}finally{t.f()}(new Date).getTime();var a,i=nf(this.zMessages);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!o.skipLoad){(new Date).getTime();o.type===zc.c&&o.execute(o.message);(new Date).getTime()}}}catch(s){i.e(s)}finally{i.f()}(new Date).getTime()}}},{key:"loadNFTZObjects",value:function(){var e,t=nf(this.zObjects);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.needsNFT)n.sendMessageToInlet([S.e]);else if(n.effect&&n.effect.zObjects){var r,a=nf(n.effect.zObjects);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.needsNFT&&i.sendMessageToInlet([S.e])}}catch(o){a.e(o)}finally{a.f()}}}}catch(o){t.e(o)}finally{t.f()}}},{key:"startZObjects",value:function(){var e,t=nf(this.zObjects);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.needsTick||n.needsStart?n.name.includes("subpatch")||n.sendMessageToInlet([S.k]):n.effect&&n.effect.zObjects&&n.name.includes("subpatch")&&n.effect.startZObjects()}}catch(i){t.e(i)}finally{t.f()}var r,a=nf(this.zMessages);try{for(a.s();!(r=a.n()).done;){r.value.type,zc.c}}catch(i){a.e(i)}finally{a.f()}}},{key:"encapsulateObjects",value:function(e,t,n,r){var a=this,i=this.state.windows.selectedElements;if(n){i={};var o,s=nf(n);try{for(s.s();!(o=s.n()).done;){var c=o.value;i[c.id]=c}}catch(ge){s.e(ge)}finally{s.f()}}var u,l=Object.keys(i),f=l.map(function(e){return a.zObjects.find(function(t){return t.id===e})}).filter(function(e){return e}),d=l.map(function(e){return a.zMessages.find(function(t){return t.id===e})}).filter(function(e){return e}),p=[].concat(Object(h.a)(f),Object(h.a)(d),Object(h.a)(f.filter(function(e){return e.effect}).map(function(e){return e.effect}))),v=[],m=0,y=[],b=0,g={},O={},j=[],k=nf(p);try{for(k.s();!(u=k.n()).done;){var w=u.value;w.effect&&w.effect.getInnerNodes&&(j=[].concat(Object(h.a)(j),Object(h.a)(w.effect.getInnerNodes())),p=[].concat(Object(h.a)(p),Object(h.a)(w.effect.getInnerNodes())))}}catch(ge){k.e(ge)}finally{k.f()}var x,S=nf(p);try{for(S.s();!(x=S.n()).done;){var P=x.value;if(P.getOutboundNodes){P.pad&&(P=P.pad);var E=P.getOutboundNodes(),T=P.getInboundNodes();for(var A in E){var M=E[A].filter(function(e){var t=e.node;return!p.includes(t)});if(0!==M.length){var R,C=!1,N=void 0,I=nf(y);try{for(I.s();!(R=I.n()).done;){var q=R.value;q.connections[0].node===M[0].node&&A===M[0].type&&(C=!0,N=q.outletNumber)}}catch(ge){I.e(ge)}finally{I.f()}if(!C){b++;var _="string"===typeof P.name&&P.name||P.zObject&&P.zObject.name;O[b]=_+"."+A}void 0!==N&&(b=N);var D={connections:M,outletNumber:b,type:A,object:P};y.push(D)}}for(var F in T){var L=T[F].filter(function(e){var t=e.node;return!p.includes(t)});if(0!==L.length){var B,z=!1,V=nf(v);try{for(V.s();!(B=V.n()).done;){B.value.connections[0].node===L[0].node&&L[0].type===F&&(z=!0)}}catch(ge){V.e(ge)}finally{V.f()}if(!z){m++;var H="string"===typeof P.name&&P.name||P.zObject&&P.zObject.name;g[m]=H+"."+F}v.push({connections:L,inletNumber:m,type:F,object:P})}}}}}catch(ge){S.e(ge)}finally{S.f()}var U=this.createZObject(e,t);U.text="subpatch";var G=U.effect;r&&(U.args[0]=r),G.zMessages=[].concat(Object(h.a)(G.zMessages),Object(h.a)(d)),this.zMessages=this.zMessages.filter(function(e){return!d.includes(e)}),G.zObjects=[].concat(Object(h.a)(G.zObjects),Object(h.a)(f)),this.zObjects=this.zObjects.filter(function(e){return!f.includes(e)}),this.updateZObjectRedux(),this.updateZMessageRedux();for(var W=2;W<=m;W++){G.newInlet(W)._text=g[W]}for(var K=2;K<=b;K++){G.newOutlet(K)._text=O[K]}G.updateZObjectRedux(),G.updateZMessageRedux();var Q,Z=nf(d);try{for(Z.s();!(Q=Z.n()).done;){var Y=Q.value;Y.clearMessagingRedux(),Y.subSequence=G,Y.updateMessagingRedux()}}catch(ge){Z.e(ge)}finally{Z.f()}for(var $=0,X=j;$<X.length;$++){var ee=X[$];ee.clearMessagingRedux(),ee.subSequence=G,ee.updateMessagingRedux()}var te,ne=nf(f);try{for(ne.s();!(te=ne.n()).done;){var re=te.value;re.effect&&(re.effect.clearMessagingRedux(),re.effect.trackMeter||re.effect.tracks||(re.effect.subSequence=G),re.effect.updateMessagingRedux()),re.clearMessagingRedux(),re.subSequence=G,re.updateMessagingRedux()}}catch(ge){ne.e(ge)}finally{ne.f()}for(var ae=function(){var e=oe[ie],t=e.connections,n=e.type,r=e.object,a=e.inletNumber;t.forEach(function(e){r.disconnectInlet(n,e.node,e.type),G.connectInlet("Input "+a,e.node,e.type)});var i=G.inletObjects[a-1];r.connectInlet(n,i,"Output")},ie=0,oe=v;ie<oe.length;ie++)ae();for(var se=function(){var e=ue[ce],t=e.connections,n=e.type,r=e.object,a=e.outletNumber;t.forEach(function(e){e.node.disconnectInlet(e.type,r,n),e.node.connectInlet(e.type,G,"Output "+a)}),G.outletObjects[a-1].connectInlet("Input",r,n)},ce=0,ue=y;ce<ue.length;ce++)se();var le,fe=this.state.windows.windowPositions,he=l.map(function(e){return fe[e]}),de=100-Math.min.apply(Math,Object(h.a)(he.map(function(e){return e.x}))),pe=100-Math.min.apply(Math,Object(h.a)(he.map(function(e){return e.y}))),ve={},me=nf(p);try{for(me.s();!(le=me.n()).done;){var ye=le.value,be=ye.id;fe[be]&&(ve[be]={x:fe[be].x+de,y:fe[be].y+pe},ye.x=ve[be].x,ye.y=ve[be].y)}}catch(ge){me.e(ge)}finally{me.f()}this.dispatch(Object(J.O)(ve))}},{key:"deleteInletObject",value:function(e,t){e.isDeleted=!0;var n=Object.keys(this.inlets)[t-1];this.disconnectFromInlet(n),this.inletObjects.filter(function(e){return!e.isDeleted}).forEach(function(e,t){return e.inletNumber=t+1})}},{key:"deleteOutletObject",value:function(e,t){var n=Object.keys(this.outlets)[t-1];this.deleteOutlet(n),this.outletObjects=this.outletObjects.filter(function(t){return t!==e}),this.outletObjects.forEach(function(e,t){return e.outletNumber=t+1})}},{key:"createZTrack",value:function(e,t,n){this.createZObject(t,n,"track "+(e.trackNumber+1))}},{key:"getMessagingEdgeById",value:function(e){return this.sequencerEngine.idToEdge[e]}},{key:"findAllNumberNodes",value:function(){return Object(P.a)(this).filter(function(e){return e.type===zc.c})}},{key:"findAllColorNodes",value:function(){return Object(P.a)(this).filter(function(e){return"color"===e.name})}},{key:"findNodeByName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(P.a)(this).filter(function(n){return"string"===typeof n.name&&(t?n.name===e:n.name.toLowerCase().includes(e.toLowerCase()))})}},{key:"moveObjectInto",value:function(e,t,n){if(!e.isInlet&&!e.isOutlet){for(var r in e.inlets)e.disconnectFromInlet(r);for(var a in e.outlets)e.disconnectFromOutlet(a);if(e.effect&&e.effect.inlets){for(var i in e.effect.inlets)e.effect.disconnectFromInlet(i);for(var o in e.effect.outlets)e.effect.disconnectFromOutlet(o)}var s=e.subSequence;s.zObjects.includes(e)&&(s.zObjects=s.zObjects.filter(function(t){return t!==e}),this.zObjects.push(e)),s.zMessages.includes(e)&&(s.zMessages=s.zMessages.filter(function(t){return t!==e}),this.zMessages.push(e)),this.updateZObjectRedux(),this.updateZMessageRedux(),s.updateZObjectRedux(),s.updateZMessageRedux(),e.subSequence=this,e.effect&&(e.effect.subSequence=this),this.dispatch(Object(J.tc)(void 0)),t&&n&&(this.dispatch(Object(J.Ze)(e.id,{x:t,y:n})),this.dispatch(Object(J.Zc)(e.id,{x:t,y:n})))}}},{key:"switchToPattern",value:function(e,t,n){var r=this.getAllPatternLockedParameters(t,e),a={},i=new Set;for(var o in r){var s=r[o];if(!i.has(s.id)){i.add(s.id);var c=Object($l.a)(this.sequencerEngine,s,t,n);c&&(a[c.id]=c.value)}}this.dispatch(Object(J.xb)(a))}},{key:"getAllPatternLockedParameters",value:function(e,t){var n,r=[],a=nf(Object(P.a)(this));try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i&&i.effect&&i.effect.parameters){var o,s=nf(i.effect.getParameters?i.effect.getParameters():i.effect.parameters);try{for(s.s();!(o=s.n()).done;){var c=o.value;c&&r.push(c)}}catch(u){s.e(u)}finally{s.f()}}}}catch(u){a.e(u)}finally{a.f()}return r.filter(function(n){return n.hasPatternLockedValues(e,t)})}},{key:"cleanUnusedUniforms",value:function(){var e=this.findAllNumberNodes().filter(function(e){return e.attributes["glsl uniform"]&&!e.attributes["scripting name"]}),t=0,n=0;console.log("total numbers=%s",e.length,e);var r,a=nf(e);try{var i=function(){var a=r.value;a.getInboundNodes();0===Object.values(a.getInboundNodes()).flat().length?(console.log(Object.keys(a.inlets).flatMap(function(e){return a.inlets[e].connections})),console.log("clearing %s of %s",t++,e.length),a.attributes["glsl uniform"]=!1):n++};for(a.s();!(r=a.n()).done;)i()}catch(o){a.e(o)}finally{a.f()}console.log("cleaned = %s skipped= %s",t,n)}},{key:"cleanUnusedColors",value:function(){var e,t=this.findAllColorNodes().filter(function(e){return!e.attributes["scripting name"]}),n=0,r=0,a=nf(t);try{for(a.s();!(e=a.n()).done;){var i=e.value,o=(i.effect.getInboundNodes(),i.effect.getOutboundNodes());if(o["gl color"]&&0===Object.values(i.effect.getInboundNodes()).flat().length){console.log("clearing %s of %s",r++,t.length);var s=i.effect._color.slice(1),c=s.slice(0,2),u=s.slice(2,4),l=s.slice(4,6),f=(s.slice(6,8),[parseInt(c,16)/255,parseInt(u,16)/255,parseInt(l,16)/255].map(ru.b)),h=i.windowPosition,d="gl.vec4 ".concat(f[1]," ").concat(f[2]," 1.0"),p=i.subSequence.createZObject(h.x,h.y,d),v=i.subSequence.createZMessage(h.x,h.y-5,zc.c);for(var m in v.text=f[0],o){var y,b=nf(o[m]);try{for(b.s();!(y=b.n()).done;){var g=y.value,O=g.node,j=g.type;O.connectInlet(j,p,m)}}catch(k){b.e(k)}finally{b.f()}}p.connectInlet("Input",v,"Output 1"),i.delete()}else n++}}catch(k){a.e(k)}finally{a.f()}console.log("cleaned = %s skipped= %s",r,n)}}]),n}(e)};function sf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var cf=function(e){return function(e){Object(u.a)(n,e);var t=sf(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getDependencyJSON",value:function(){var e="subpatch"===this.name?this.effect:this,t=Object(Yl.e)(e.getInboundNodes(),this.state),n=Object(Yl.e)(e.getOutboundNodes(),this.state),r=Array.from(new Set([].concat(Object(h.a)(t.effects),Object(h.a)(n.effects)))),a=Array.from(new Set([].concat(Object(h.a)(t.midiEffects),Object(h.a)(n.midiEffects)))),i=t.json,o=n.json;return{objectDependencies:{effects:r.map(function(e){return e.getJson()}),midiEffects:a.map(function(e){return e.getJson()})},inbound:i,outbound:o}}},{key:"fromDependencyJSON",value:function(e,t,n){console.log("from dependency=",e,t,n);var r=e.inbound,a=e.outbound;n&&(r=n.inbound,a=n.outbound);var i=Object(Yl.d)(this.effect||this,r,a,e.objectDependencies,t,this.zObject||this);console.log("positions=",i),this.dispatch(Object(J.O)(i))}}]),n}(e)};function uf(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return lf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lf(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function lf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ff(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hf=function(e){Object(u.a)(n,e);var t=ff(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this)).id=Object(q.uuid)(),s.subSequence=e,s.sequencerEngine=r,s.sequencerEngine.idToObject[s.id]=Object(c.a)(s),s.zObject=a,s.name=i,s.trackData=new K.a,s.trackData.loadDefaults(),s.inletObjects=[],s.outletObjects=[],s.newInlet(1),s.newOutlet(1),s.zObject.newAction("Create Instance",function(){return s.newInstance()}),s.outletInstanceMapping={},s.inletInstanceMapping={},s.isInitialLoad=!0,s.initPattr(),s.setupPresetListener(),s}return Object(s.a)(n,[{key:"getRootSubSequence",value:function(){return this.subSequence.getRootSubSequence?this.subSequence.getRootSubSequence():this.subSequence}},{key:"getJson",value:function(e,t){return Object(d.a)({id:this.id},this.getZObjectsJson(e),{numInlets:this.inletObjects.length,fillColor:this.fillColor,numOutlets:this.outletObjects.length,isCustom:this.isCustom,width:this.width,height:this.height,inletObjects:this.inletObjects.map(function(e){return e.getJson()}),outletObjects:this.outletObjects.map(function(e){return e.getJson()}),instanceInlets:this.instanceInlets.filter(function(e){return e}).map(function(e){return e.id}),instances:this.instances.filter(function(e){return e}).map(function(e){return e.id}),outletInstanceMapping:this.outletInstanceMapping,inletInstanceMapping:this.inletInstanceMapping,pattr:this.pattr.getJson()})}},{key:"getParameters",value:function(){return this.zObjects.flatMap(function(e){return e.getAllParameters()})}},{key:"fromJson",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;arguments.length>4&&arguments[4];this.zMessages.forEach(function(e){r&&(e.isInlet||e.isOutlet)||t.deleteNode(e,!0)}),this.zObjects.forEach(function(e){return t.deleteNode(e,!0)}),n||(this.id=e.id,this.sequencerEngine.idToObject[this.id]=this),this.fillColor=e.fillColor,this.isCustom=e.isCustom,this.width=e.width,this.height=e.height,this.isCustom&&(this.zObject.width=this.width,this.zObject.height=this.height);var i,o={},s=e.zObjects,c=e.zMessages,u=uf(s);try{for(u.s();!(i=u.n()).done;){var l=i.value,f=this.createZObject(),h=f.fromJson(l,n);(o=Object(d.a)({},o,h))[l.id]=f.id,f.effect&&l.effect&&(o[l.effect.id]=f.effect.id)}}catch(_){u.e(_)}finally{u.f()}this.zMessages=this.zMessages.filter(function(e){return r||!e.isOutlet&&!e.isInlet});var p,v=uf(c);try{for(v.s();!(p=v.n()).done;){var m=p.value;if(void 0!==m.outletNumber){var y="Output "+m.outletNumber;if(this.outlets[y]&&r){if(!this.outletInstanceMapping[m.id]){var b=Object(q.uuid)();this.outletInstanceMapping[m.id]=b;var g=[];this.outlets[y]&&(g=this.outlets["Output "+m.outletNumber].connections,this.deleteOutlet("Output "+m.outletNumber),this.outletObjects.splice(m.outletNumber-1,1)),this.newOutlet(m.outletNumber,b);var O,j=uf(g);try{for(j.s();!(O=j.n()).done;){var k=O.value,w=k.destNode,x=k.sourceType,S=k.destType;w.connectInlet(S,this,x)}}catch(_){j.e(_)}finally{j.f()}}o[m.id]=this.outletInstanceMapping[m.id]}else{this.outlets[y]&&(this.deleteOutlet("Output "+m.outletNumber),this.outletObjects.splice(m.outletNumber-1,1));var P=n?Object(q.uuid)():m.id;this.newOutlet(m.outletNumber,P),o[m.id]=P}}else if(void 0!==m.inletNumber)if(this.inlets["Input "+m.inletNumber]&&r){if(!this.inletInstanceMapping[m.id]){var E=Object(q.uuid)();this.inletInstanceMapping[m.id]=E,this.inlets["Input "+m.inletNumber]&&(this.deleteInlet("Input "+m.inletNunmber),this.inletObjects.splice(m.inletNumber-1,1)),this.newInlet(m.inletNumber,E)}o[m.id]=this.inletInstanceMapping[m.id]}else{this.inlets["Input "+m.inletNumber]&&(this.deleteInlet("Input "+m.inletNunmber),this.inletObjects.splice(m.inletNumber-1,1));var T=n?Object(q.uuid)():m.id;this.newInlet(m.inletNumber,T),o[m.id]=T,this.inletInstanceMapping[m.id]=T}else{var A=this.createZMessage();A.fromJson(m,n),o[m.id]=A.id}}}catch(_){v.e(_)}finally{v.f()}if(e.inletObjects){for(var M=0;M<e.inletObjects.length;M++)this.inletObjects[M]&&(this.inletObjects[M]._text=e.inletObjects[M].text);for(var R=0;R<e.outletObjects.length;R++)this.outletObjects[R]&&(this.outletObjects[R]._text=e.outletObjects[R].text)}if(e.instanceInlets&&!r){var C,N=uf(e.instanceInlets);try{var I=function(){var e=C.value,n=t.inletObjects.find(function(t){return t.id===e||t.id===o[e]});t.instanceInlets.push(n)};for(N.s();!(C=N.n()).done;)I()}catch(_){N.e(_)}finally{N.f()}}return e.instances&&!r&&(this.instanceIds=e.instances),!r&&a&&(e.outbound||e.inbound)&&(this.sequencerEngine.dispatch(Object(J.fc)(this.sequencerEngine.sequenceId,!1)),this.sequencerEngine.dispatch(Object(J.fc)(this.sequencerEngine.sequenceId,!0))),this.updateMessagingRedux(),this.isInitialLoad=!1,this.pattr.fromJson(e.pattr),this.onNewPresetManager(),o}},{key:"deencapsulate",value:function(){var e=this;this.zMessages.forEach(function(e){e.isInlet=!1,e.isOutlet=!1}),this.subSequence.zMessages=[].concat(Object(h.a)(this.subSequence.zMessages),Object(h.a)(this.zMessages)),this.subSequence.zObjects=[].concat(Object(h.a)(this.subSequence.zObjects),Object(h.a)(this.zObjects)),this.subSequence.zObjects=this.subSequence.zObjects.filter(function(t){return t!==e.zObject}),this.subSequence.updateZObjectRedux(),this.subSequence.updateZMessageRedux();var t,n=uf(this.zMessages);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.clearMessagingRedux(),r.subSequence=this.subSequence,r.updateMessagingRedux()}}catch(s){n.e(s)}finally{n.f()}var a,i=uf(this.zObjects);try{for(i.s();!(a=i.n()).done;){var o=a.value;o.effect&&(o.effect.clearMessagingRedux&&o.effect.clearMessagingRedux(),o.effect.subSequence=this.subSequence,o.effect.updateMessagingRedux&&o.effect.updateMessagingRedux()),o.clearMessagingRedux(),o.subSequence=this.subSequence,o.updateMessagingRedux()}}catch(s){i.e(s)}finally{i.f()}this.zMessages=[],this.zObjects=[],this.updateZObjectRedux(),this.updateZMessageRedux(),this.dispatch(Object(J.We)([]))}},{key:"newZObject",value:function(){return new ib(this)}},{key:"newInlet",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inletObjects.length+1,r=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s="Input "+t;a=a||50+100*(t-1),i=i||50;var c=this.createZMessage(a,i,void 0,void 0,r);return c.isInlet=!0,c.inletNumber=t,c.deleteOutlet("Raw Message"),this.inletObjects.push(c),Object(fe.a)(Object(f.a)(n.prototype),"newInlet",this).call(this,s,function(t){return e.onInletMessage(c,t)}),o&&this.propagate(Object(lu.n)(c,!1)),c}},{key:"newOutlet",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.outletObjects.length+1,r=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o="Output "+t;Object(fe.a)(Object(f.a)(n.prototype),"newOutlet",this).call(this,o),a=a||50+100*(t-1),i=i||350;var s=this.createZMessage(a,i,void 0,function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return e.sendMessage.apply(e,[o,t].concat(r))},r);return s.linkedOutlet=this.outlets[o],s.outletNumber=t,s.isOutlet=!0,this.outletObjects.push(s),this.propagate(Object(lu.p)(s)),s}},{key:"evaluateAsFunction",value:function(e){var t=this.inletObjects[0];if(t){this.outletObjects[0];for(var n=df(t.outlets);n;){var r=n.connections[0];if(!r)break;var a=r.destNode;if(a.isOutlet)break;e=a.function([e]),Array.isArray(e)&&(e=e[0]),n=df(a.outlets)}return e}}},{key:"dispose",value:function(){var e,t=uf(this.instances);try{for(t.s();!(e=t.n()).done;){e.value.zObject.delete()}}catch(n){t.e(n)}finally{t.f()}}},{key:"isDeletable",value:function(){return!0}},{key:"createZObject",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var i=(e=Object(fe.a)(Object(f.a)(n.prototype),"createZObject",this)).call.apply(e,[this].concat(r));return this.propagate(Object(lu.t)(i)),i}},{key:"createZMessage",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var i=(e=Object(fe.a)(Object(f.a)(n.prototype),"createZMessage",this)).call.apply(e,[this].concat(r));return this.propagate(Object(lu.q)(i)),i}},{key:"deleteInlet",value:function(e,t){var n=this;if(window.noReload=!0,this.inlets[e]&&this.inlets[e].connections){var r,a=uf(this.inlets[e].connections);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.deleteConnection(i)}}catch(f){a.e(f)}finally{a.f()}}for(var o=this.inletObjects.find(function(e){return e.inletNumber===t}),s=function(e){var t="Input "+e,r="Input "+(e-1),a=n.inlets[t],i=n.inlets[r],o=a.connections,s=n.inletObjects.find(function(t){return t.inletNumber===e});i.action=function(e){return n.onInletMessage(s,e)},s.inletNumber=e-1;var c,u=uf(o);try{for(u.s();!(c=u.n()).done;){var l=c.value;n.deleteConnection(l),n.connectInlet(r,l.sourceNode,l.sourceType)}}catch(f){u.e(f)}finally{u.f()}},c=t+1;c<=this.inletObjects.length;c++)s(c);var u=this.inletObjects.length;this.inletObjects=this.inletObjects.filter(function(e){return e!==o});var l="Input "+u;delete this.inlets[l],this.numInlets--,window.noReload=!1}},{key:"deleteOutlet",value:function(e,t){var n=this;if(window.noReload=!0,this.outlets[e]&&this.outlets[e].connections){var r,a=uf(this.outlets[e].connections);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.destNode.deleteConnection(i)}}catch(f){a.e(f)}finally{a.f()}}for(var o=this.outletObjects.find(function(e){return e.outletNumber===t}),s=function(e){var t="Output "+e,r="Output "+(e-1),a=n.outlets[t],i=n.outlets[r],o=a.connections,s=n.outletObjects.find(function(t){return t.outletNumber===e});i.action=function(e){return n.onInletMessage(s,e)},s.outletNumber=e-1;var c,u=uf(o);try{for(u.s();!(c=u.n()).done;){var l=c.value;l.destNode.deleteConnection(l),l.destNode.connectInlet(l.destType,l.sourceNode,r)}}catch(f){u.e(f)}finally{u.f()}},c=t+1;c<=this.outletObjects.length;c++)s(c);var u=this.outletObjects.length;this.outletObjects=this.outletObjects.filter(function(e){return e!==o});var l="Output "+u;delete this.outlets[l],this.numOutlets--,window.noReload=!1}},{key:"isRoot",value:function(){return!1}},{key:"presentationMode",get:function(){return this.state.spatial.presentationMode[this.id]},set:function(e){this.dispatch(Object(J.Yc)(this.id,e))}}]),n}(cf(function(e){return function(e){Object(u.a)(n,e);var t=Ml(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a)))._presetManager=void 0,e.searchedForPresets=!1,e}return Object(s.a)(n,[{key:"setupPresetListener",value:function(){var e=this;Object(hi.e)("preset.new",function(){return e.onNewPresetManager()})}},{key:"onNewPresetManager",value:function(){this.searchedForPresets=!1}},{key:"presetManager",get:function(){if(this.searchedForPresets)return this._presetManager;var e,t=Tl(Zo({subSequence:this}));try{for(t.s();!(e=t.n()).done;){var n=e.value.zObjects.find(function(e){return"preset"===e.name});if(n){n=n.effect,this._presetManager=n;break}}}catch(r){t.e(r)}finally{t.f()}return this.searchedForPresets=!0,this._presetManager}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=Jl(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"propagate",value:function(e){this.insideInstance()&&function(e,t){var n=void 0;switch(t.type){case lu.i:n=Nl;break;case lu.f:n=Il;break;case lu.k:n=Ll;break;case lu.h:n=Bl;break;case lu.c:n=ql;break;case lu.e:n=_l;break;case lu.a:n=Dl;break;case lu.b:n=Fl;break;case lu.j:n=Rl;break;case lu.g:n=Cl;break;case lu.d:n=zl}n&&n(e,t)}(this,e)}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=Zl(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).instances=[],e.instanceInlets=[],e}return Object(s.a)(n,[{key:"newInstance",value:function(){var e=this.subSequence.createZObject(this.x,this.y,"instancedSubpatch").effect;e.implements=this,this.instances.push(e),this.copyIntoInstance(e),this.onChange()}},{key:"toggleInlet",value:function(e){this.instanceInlets.includes(e)?this.instanceInlets=this.instanceInlets.filteR(function(t){return t!==e}):this.instanceInlets.push(e),this.propagate(Object(lu.o)(e.inletNumber))}},{key:"newInstanceInlet",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inletObjects.length+1,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=this.newInlet(e,t,n,r,!1);return this.instanceInlets.push(a),this.propagate(Object(lu.n)(a,!0)),a}},{key:"onInletMessage",value:function(e,t){if(this.hasInstances&&!this.instanceInlets.includes(e)){var n,r=Kl(this.instances);try{for(r.s();!(n=r.n()).done;){var a=n.value,i=this.inletObjects.indexOf(e),o=a.inletObjects[i];o&&o.sendMessage.apply(o,["Output"].concat(Object(h.a)(t)))}}catch(s){r.e(s)}finally{r.f()}}else e.sendMessage.apply(e,["Output"].concat(Object(h.a)(t)))}},{key:"hasInstances",get:function(){return this.instances.length>0}},{key:"insideInstance",value:function(){return!!this.hasInstances||this.subSequence.insideInstance()}},{key:"onChange",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}},{key:"copyIntoInstance",value:function(e){var t,n=this,r=Kl(this.zObjects);try{for(r.s();!(t=r.n()).done;){var a=t.value;if("subpatch"===a.name){var i=a.effect;i.showAllOutlets=!0;var o=e.createZObject(0,0,"instancedSubpatch");e.registerObject(a,o),i.instances.push(o.effect),i.copyIntoInstance(o.effect),a.effect&&e.registerObject(a.effect,o.effect)}else{var s=e.createZObject(0,0,a.text);s.fromJson(a.getJson(),!0),e.registerObject(a,s),a.effect&&e.registerObject(a.effect,s.effect)}}}catch(h){r.e(h)}finally{r.f()}var c,u=Kl(this.zMessages);try{for(u.s();!(c=u.n()).done;){var l=c.value;if((!l.isInlet||"continue"!==function(){var t=l.inletNumber,r=e.inletObjects.find(function(e){return e.inletNumber===t}),a=void 0;return r?(a=r,e.registerObject(l,r)):n.instanceInlets.includes(l)?(a=e.newInstanceInlet(),e.registerObject(l,a)):((a=e.newInlet())._text=l._text,e.registerObject(l,a)),a._text=l._text,"continue"}())&&(!l.isOutlet||"continue"!==function(){var t=l.outletNumber,n=e.outletObjects.find(function(e){return e.outletNumber===t});if(n)n._text=l._text,e.registerObject(l,n);else{var r=e.newOutlet();r._text=l._text,e.registerObject(l,r)}return"continue"}())){var f=e.createZMessage(0,0,l.dataType);f.fromJson(l.getJson(),!0),e.registerObject(l,f)}}}catch(h){u.e(h)}finally{u.f()}this.copyConnectionsIntoInstance(e)}},{key:"copyConnectionsIntoInstance",value:function(e){var t=this.zObject.getPresetJson().inletConnections,n={};for(var r in e.objectRegistry)n[r]=e.objectRegistry[r].id;t=Gl(n,t),this.sequencerEngine.loadInletConnectionsForId(t,!0)}}]),n}(e)}(Object(fi.a)(of(Qa(function(){return function e(){Object(o.a)(this,e)}}())))))))),df=function(e){return e[Object.keys(e)[0]]},pf=hf,vf=0,mf=function(e){return function(){for(var t={id:(vf++).toString(),flash:function(){return 0},typed:function(e){return e}},n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=r.slice(1).map(function(e){return"function"===typeof e?e:function(){return e}}),o=ip[e].apply(ip,[t].concat(Object(h.a)(i))),s=r[0];return"function"===typeof s&&(s=s()),o([s],!0)}};Object(pi.a)("gl.convertCoord",{coordinates:"",size:""},"Converts screen space coords to uv-style coords",function(){return 1},{inlets:2});Object(pi.a)("gl.float2Vec3",{float:"",min:"",max:""},"Converts a float to unisgned vec3",function(){return 1},{inlets:3,isHot:!0,inletTypes:["float","float","float"],type:"vec3"});Object(pi.a)("gl.vec3ToFloat",{vec3:"",min:"",max:""},"Converts a float to unisgned vec3",function(){return 1},{inlets:3});Object(pi.a)("gl.float2Vec2",{float:"",min:"",max:""},"Converts a float to unisgned vec3",function(){return 1},{inlets:3,isHot:!0,inletTypes:["float","float","float"],type:"vec2"});Object(pi.a)("gl.vec2ToFloat",{vec2:"",min:"",max:""},"Converts a float to unisgned vec3",function(){return 1},{inlets:3});var yf={"gl.float2Vec3":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0],a=mf("gl.*"),i=mf("gl.-"),o=mf("gl.vec3"),s=mf("gl./"),c=mf("gl.mod"),u=a(s(i(r,t()),i(n(),t())),a(256,a(256,255))),l=c(u,256),f=c(s(u,256),256),h=s(s(u,256),256),d=o(s(l,256),s(f,256),s(h,256));return d.type="vec3",d}},"gl.vec3ToFloat":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0],a=mf("gl.*"),i=mf("gl.-"),o=mf("gl./"),s=(mf("gl.mod"),mf("gl.+")),c=mf("gl.unpack")(r),u=c[0],l=c[1],f=c[2],h=o(s(s(u,a(l,256),a(f,a(256,256)))),o(256,o(256,256))),d=o(a(h,s(i(n(),t()),t())),256);return d.type="float",d}},"gl.float2Vec2":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0],a=mf("gl.*"),i=mf("gl.-"),o=mf("gl.vec2"),s=mf("gl./"),c=mf("gl.mod"),u=a(s(i(r,t),i(n,t)),a(256,255)),l=c(u,256),f=s(u,256),h=o(s(l,256),s(f,256));return h.type="vec2",h}},"gl.vec2ToFloat":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0];console.log("vec2 to float called w=",r);var a=mf("gl.*"),i=mf("gl.-"),o=mf("gl./"),s=(mf("gl.mod"),mf("gl.+")),c=mf("gl.unpack")(r),u=s(c[0],a(c[1],256)),l=s(a(o(o(u,256),1),i(n,t),t));return l.type="float",l}}},bf=n(166);function gf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}Object(pi.a)("gl.eq",{a:"",b:""},"Fuck",function(){return 1},{inletTypes:["float","float"],type:function(){return"bool"},isHot:!0,inlets:2});var Of=function(e,t){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"(".concat(Object(ru.b)(r[0])," == ").concat(Object(ru.b)(r[1]),")")},t))};Object(pi.a)("gl.gt",{a:"",b:""},"Fuck",function(){return 1},{inletTypes:["float","float"],type:function(){return"bool"},isHot:!0,inlets:2});Object(pi.a)("gl.gte",{a:"",b:""},"Fuck",function(){return 1},{inletTypes:["float","float"],type:function(){return"bool"},isHot:!0,inlets:2});Object(pi.a)("gl.lt",{a:"",b:""},"Fuck",function(){return 1},{inletTypes:["float","float"],type:function(){return"bool"},isHot:!0,inlets:2});Object(pi.a)("gl.lte",{},"Fuck",function(){return 1},{inletTypes:["float","float"],type:function(){return"bool"},isHot:!0,inlets:2});var jf=function(e,t){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"(".concat(Object(ru.b)(r[0])," <= ").concat(Object(ru.b)(r[1]),")")},t))};Object(pi.a)("gl.and",{a:"",b:""},"Fuck",function(){return 1},{inletTypes:["bool","bool"],type:function(){return"bool"},isHot:!0,inlets:2});Object(pi.a)("gl.or",{},"Fuck",function(){return 1},{inletTypes:["bool","bool"],type:function(){return"bool"},isHot:!0,inlets:2});Object(pi.a)("gl.cond",{condition:"",thenStatement:"",elseStatement:""},"Fuck",function(){return 1},{inletTypes:["bool",Object(Ou.k)("float","vec2","vec3","vec4"),Object(Ou.k)("float","vec2","vec3","vec4")],type:function(){return arguments.length<=1?void 0:arguments[1]},isHot:!0,inlets:3});var kf=function(e,t,n){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(r){var a=Object(ou.a)(r,t,n);return e.flash(),"(\n    ".concat(Object(ru.b)(a[0])," ? \n        ").concat(Object(ru.b)(a[1])," : \n        ").concat(Object(ru.b)(a[2]),")")},t,n))};Object(pi.a)("gl.pass",{},"Fuck",function(){return 1},{isHot:!0,inlets:3});Object(pi.a)("gl.switch",{switchNumber:""},"switches based on argument",function(){return 1},{inlets:function(e){return e+1}});Object(pi.a)("gl.anyLTE",{"condition list":"",list:""},"Returns 1 if any of the elements in first inlet is below the 2nd",function(){return 1},{inlets:2});var wf=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(0===r.length)return 0;var i=e(t,n.slice(1),r.slice(1),a+1),o=r[0],s=n[0];return kf(t,function(){return 1},function(){return i})([jf(t,function(){return s})([o])])};Object(pi.a)("gl.listSwitch",{list:""},"Returns 1 if any of the elements in first inlet is below the 2nd",function(){return 1},{inlets:2});var xf=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(1===r.length)return r[0]();var i=e(t,n,r.slice(1),a+1),o=a;return kf(t,r[0],function(){return i})([Of(t,function(){return o})([n])])},Sf={"gl.switch":function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(t){var r=Object(v.a)(t,1)[0];return xf(e,r,n.filter(function(e){return null!==e()&&void 0!==e()}),0)}},"gl.cond":kf,"gl.gt":function(e,t){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"(".concat(Object(ru.b)(r[0])," > ").concat(Object(ru.b)(r[1]),")")},t))},"gl.gte":function(e,t){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"(".concat(Object(ru.b)(r[0])," >= ").concat(Object(ru.b)(r[1]),")")},t))},"gl.lt":function(e,t){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"(".concat(Object(ru.b)(r[0])," < ").concat(Object(ru.b)(r[1]),")")},t))},"gl.lte":jf,"gl.and":function(e,t){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"(".concat(Object(ru.b)(r[0])," && ").concat(Object(ru.b)(r[1]),")")},t))},"gl.or":function(e,t){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"((".concat(Object(ru.b)(r[0]),") || (").concat(Object(ru.b)(r[1]),"))")},t))},"gl.eq":Of,"gl.pass":function(e,t,n){return e.needsHotReload=!0,Object(iu.a)(function(r){var a=Object(ou.a)(r,t,n);return e.flash(),"(".concat(Object(ru.b)(a[1])," == ").concat(Object(ru.b)(a[2])," ? ").concat(Object(ru.b)(a[0])," : 0.0)")},t,n)},"gl.listSwitch":function(e,t){return function(n){var r=Object(v.a)(n,1)[0];if(t())return xf(e,r,t().map(function(e){return function(){return e}}),0)}},"gl.anyLTE":function(e,t){return function(n){var r=Object(v.a)(n,1)[0];if(t()&&r)return wf(e,r,t(),0)}}},Pf={depth:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n[0],i=n[1];if(e.dimensionFactors[a]=[0,0,i],e.dimensions[a]){var o=e.dimensions[a][2],s=Object(v.a)(e.dimensionsUniforms[a],3);s[0],s[1],(0,s[2])([o*i])}}};function Ef(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}Object(pi.a)("sdf.directionalScale",{"sdf list":"",coord:""},"Translate group of sdfs",function(){return 1},{isHot:!0,inlets:3});var Tf={"sdf.directionalScale":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(Array.isArray(n)&&t()&&Array.isArray(t())){var r=t(),a=Object(v.a)(r,2),i=a[0],o=a[1];return[n.map(function(e){var t=i,n=o;if(Array.isArray(e)){var r=Object(h.a)(e);r.id=e.id;var a=Object(v.a)(r,3),s=(a[0],a[1]),c=a[2],u=1,l=1;return l=c>0?1+(n*=n>0?1.8:.7):n>0?1-.7*n:1-1.8*n,u=s>0?1+(t*=t>0?1.8:.7):t>0?1-.7*t:1-1.8*t,r[1]=s*u,r[2]=c*l,r}}).filter(function(e){return e})]}}}};Object(pi.a)("gl.length",{vector:""},"Returns the gl expression that calculates length of vector",function(){return 1},{type:function(e){return"float"},inletTypes:Object(Ou.l)(Object(Ou.k)("vec2","vec3","vec4")),inlets:1});Object(pi.a)("gl.sdRoundBox",{position:"",size:"",cornerRadius:""},"Fuck",function(){return 1},{isHot:!0,inlets:3});Object(pi.a)("gl.sdRoundRect",{position:"",sizeVec:"",cornerRadius:""},"Fuck",function(){return 1},{isHot:!0,inlets:3});Object(pi.a)("gl.circle",{position:"",radius:""},"Creates circle sdf for given radius and position",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("gl.sdfMerge",{sdf:""},"Merges sdfs given as arguments",function(){return 1},{isHot:!0,inlets:function(e){return e}});Object(pi.a)("sdf.unionList",{"sdf list":""},"Merges sdfs given as arguments",function(){return 1},{type:"float",isHot:!0});var Af=function e(t){if(0===t.length)return Object(ru.b)(0);var n=t[0];return 1===t.length?Object(ru.b)(n):"min(".concat(Object(ru.b)(n),", ").concat(e(t.slice(1)),")")};Object(pi.a)("gl.between",{number:"",a:"",b:""},"Returns 1 if value is between a and b-- 0 otherwise",function(){return 1},{inletTypes:Object(Ou.l)("float"),type:function(){return"float"},isHot:!0,inlets:3});var Mf=function(e,t,n){return Object(ju.a)(Object(iu.a)(function(e){var r=Object(ou.a)(e,t,n);return"(".concat(Object(ru.b)(r[0])," >= ").concat(Object(ru.b)(r[1])," && ").concat(Object(ru.b)(r[0])," < ").concat(Object(ru.b)(r[2])," ? 1.0 : 0.0)")},t,n),e,t,n)};Object(pi.a)("gl.notBetween",{number:"",a:"",b:""},"Returns 0 if value is between a and b-- 1 otherwise",function(){return 1},{inletTypes:Object(Ou.l)("float"),type:function(){return"float"},isHot:!0,inlets:3});var Rf=Object(d.a)({"gl.length":function(e){return e.needsHotReload=!0,Object(ju.a)(Object(gu.b)(Object(iu.a)(function(t){var n=Object(ou.a)(t);return e.flash(),"length(".concat(Object(ru.b)(n[0]),")")}),function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1];return Math.sqrt(n*n+r*r)}),e)},"gl.between":Mf,"gl.notBetween":function(e,t,n){return Object(ju.a)(Object(iu.a)(function(e){var r=Object(ou.a)(e,t,n);return"(".concat(Object(ru.b)(r[0])," >= ").concat(Object(ru.b)(r[1])," && ").concat(Object(ru.b)(r[0])," < ").concat(Object(ru.b)(r[2])," ? 0.0 : 1.0)")},t,n),e,t,n)},"gl.sdRoundBox":function(e,t,n){return e.needsHotReload=!0,Object(iu.a)(function(r){var a=Object(ou.a)(r,t,n);return e.flash(),"sdRoundBox(".concat(Object(ru.b)(a[0]),", vec2(").concat(Object(ru.b)(a[1]),"), (").concat(Object(ru.b)(a[2]),"))")},t,n)},"gl.sdRoundRect":function(e,t,n){return e.needsHotReload=!0,Object(iu.a)(function(r){var a=Object(ou.a)(r,t,n);return e.flash(),"sdRoundBox(".concat(Object(ru.b)(a[0]),", ").concat(Object(ru.b)(a[1]),", (").concat(Object(ru.b)(a[2]),"))")},t,n)},"gl.sdfMerge":function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.needsHotReload=!0,iu.a.apply(void 0,[function(t){var r=[t].concat(Object(h.a)(n.filter(function(e){return 0!==e()&&void 0!==e()}).map(function(e){return e()}))),a=ou.a.apply(void 0,Object(h.a)(r));return Af(a),e.flash(),Af(a)}].concat(n))},"gl.circle":function(e,t){return e.needsHotReload=!0,Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"length((gl_FragCoord.xy-vec2(width, height))/height - ".concat(Object(ru.b)(r[0]),") - ").concat(Object(ru.b)(r[1]))},t)},"sdf.unionList":function(e){return e.needsHotReload=!0,function(t){var n=Object(v.a)(t,1)[0],r=ru.a.apply(void 0,Object(h.a)(n)),a=r.functions,i=r.codes,o=r.uniforms,s=r.variables;Af(i),e.flash();var c=Af(i);return{type:Ou.b,code:c,uniforms:o,variables:s,functions:a}}}},Tf),Cf=n(364),Nf=n(904),If=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"2.0",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0;(1===(o=1/o)||isNaN(o))&&(o="1.0");var c="",u="sdf1"+r,l="sdf2"+r;return c+="\n    vec2 ".concat(u," = ").concat("scene"===e?"scene.xy":e,";\n    vec2 ").concat(l," = ").concat(t,";\n    float d1").concat(r," = ").concat(l,".x;\n    float d2").concat(r," = ").concat(u,".x;\n    float k").concat(r," = ").concat(n,";\n\n    float h").concat(r," = max(k").concat(r,"-abs(d1").concat(r,"-d2").concat(r,"),0.0)/k").concat(r,";\n    float m").concat(r," = pow(h").concat(r,",").concat(a,")*0.5;\n    float s").concat(r," = m").concat(r,"*k").concat(r,"*(1.0/").concat(a,");\n"),i||(c+="\n    float mAccumulator = 0.0; \n"),c+="\n\n  if (d1".concat(r," < d2").concat(r,") {\n    scene = vec3(d1").concat(r," - s").concat(r,", ").concat(void 0!==s?s:l+".y",", mAccumulator + m").concat(r,");\n    mAccumulator += h").concat(r,"*h").concat(r,"*").concat(o,";\n  } else {\n    scene = vec3(d2").concat(r," - s").concat(r,",  ").concat(void 0!==s?"scene.y":u+".y",", mAccumulator + m").concat(r,");\n    mAccumulator +=  h").concat(r,"*h").concat(r,"*").concat(o,";\n  }")},qf=function(e,t,n,r){var a="sdf1"+r,i="sdf2"+r;return""+"\n    vec2 ".concat(a," = ").concat("scene"===e?"scene.xy":e,";\n    vec2 ").concat(i," = ").concat(t,";\n    float d1").concat(r," = ").concat(i,".x;\n    float d2").concat(r," = ").concat(a,".x;\n    float k").concat(r," = ").concat(n,";\n    float h").concat(r," = max(k").concat(r,"-abs(-d1").concat(r,"-d2").concat(r,"),0.0);\n    float m").concat(r," =  h").concat(r,"*h").concat(r,"*0.25;\n\n    float addend").concat(r," = m").concat(r,"/k").concat(r,";\n  if (-").concat(i,".x > ").concat(a,".x) {\n    scene = vec3(-d1").concat(r," + addend").concat(r,", ").concat(i,".y + (1.0 - h").concat(r,"), 1.0 - m").concat(r,");\n  } else {\n    scene = vec3(d2").concat(r," + addend").concat(r,", ").concat(a,".y + h").concat(r,", m").concat(r,");\n  }")},_f=function(e,t,n,r,a,i,o,s,c){if(0===r||!r){var u="\n  vec2 sdfVec".concat(o," = ").concat(e,";\n  if (sdfVec").concat(o,".x < ").concat(n?t:"scene",".x) {\n    scene = vec3(sdfVec").concat(o,", 0.0);\n  }\n");return n&&(u+="\n  else {\n    scene = vec3(".concat(t,", 0.0);\n  }\n")),u}if(1===r){var l="\n  if (".concat(e,".x < ").concat(n?t:"scene",".x) {\n    scene = vec3(").concat(t,", 0.0);\n  }\n");return n&&(l+="\n  else {\n    scene = vec3(".concat(e,", 0.0);\n  }\n")),l}return 2===r?"\n    float addend = 0.0;\n  if (-".concat(e,".x > scene.x) {\n    scene = vec3(-").concat(e,".x + addend, ").concat(e,".y, 0.0);\n  } else {\n    scene = vec3(scene.x + addend, scene.y, 0.0);\n  }\n"):4===r?n?qf(e,t,a,o):qf(t,e,a,o):3===r?n?If(e,t,a,o,i,s,c):If(t,e,a,o,i,s,c):""};function Df(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ff(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ff(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ff(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("gl.sdf",{position:"",type:"",sizeVec:"",cornerRadius:""},"Creates sdf for a type",function(){return 2},{isHot:!0,inlets:4});var Lf=function(e,t,n,r,a,i,o,s,c){e.needsHotReload=!0;var u=Object(q.uuid)().replaceAll("-","");return function(l){var f=Object(v.a)(l,1)[0],h=Object(Cf.g)(t())?Object(ru.a)(f,t,n,r,a,i,o,s,c):Object(ru.a)(f,t,n,r,i,o,s,c),d=h.codes,p=h.functions,m=h.variables,y=h.uniforms;0===Object.keys(d[4]).length&&(d[4]=void 0),e.flash();d[6];var b,g,O="(1.0*gl_FragCoord.xy-vec2(width, height))/height",j=Nf.a[d[1]];if(d[7]=c(),j){var k="sdf"+u;p[k]=j(d),"box"!==d[1]&&"sphere"!==d[1]||(O="vec3((1.0*gl_FragCoord.xy-vec2(width, height))/height, 0.0)"),b=function(e){return"".concat(k,"(").concat(e,")")},g="".concat(k,"(").concat(O,")")}return[{id:u,code:b,position:f,functions:p,variables:m,uniforms:y},{id:u,code:g,position:f,functions:p,variables:m,uniforms:y}]}};Object(pi.a)("gl.sdfScene",{"list of sdfs":"",type:"",morph:"",offset:"","operations list":""},"Creates a scene out of all the sdfs");var Bf=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.125,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2;r=Array.isArray(r)?r.map(function(e){return e.code?e.code:e}):r.code?[r.code]:[r],a=Array.isArray(a)?a.map(function(e){return e.code?e.code:e}):a.code?[a.code]:[a];for(var i=[],o=[],s=0;s<e.length;s++)i[s]=r[s%r.length],o[s]=a[s%a.length];return function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.2,i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(Array.isArray(r)||(r=[r]),void 0===s&&(s=r.filter(function(e){return 3===e}).length),n&&1===t.length)return"scene = vec3(".concat(t[0],", 0.0)");if(0===t.length)return"";var u=_f(t[0],n?t[1]:"scene",n,r&&r[0],Array.isArray(a)?a[0]:a,Array.isArray(i)?i[0]:i,t.length,o,s,c);return r&&3===r[0]&&(o=t.length),a=Array.isArray(a)?a.slice(1):a,i=Array.isArray(i)?i.slice(1):i,u+(1===t.length?"":e(n?t.slice(2):t.slice(1),!1,r&&r.slice(1),a,i,o,s,c+1))}("function"===typeof e[0].code?e.map(function(e){return e.code(t)}):e.map(function(e){return e.code}),!0,n,i,o)};Object(pi.a)("gl.mat3",{x:"",y:"",z:""},"Creates a GLSL expression representing a 3x3 matrix",function(){return 1},{inletTypes:["vec3","vec3","vec3"],type:"mat3",isHot:!0,tags:"GLSL",inlets:3});function zf(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Jf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Jf(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Jf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Vf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}window.MIN_SDF_VALUE=.0051;window._corner=1.25;var Hf=function(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))},Uf=function(e,t){var n=[(2*e[0]-t[0])/t[1],-(2*e[1]-t[1])/t[1]],r=window.offset_v||0;return n[1]+=r,n};function Gf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Wf=[Ou.b,Ou.d,Ou.e,Ou.f];Object(pi.a)("gl.+",{a:"",args:""},"Merges sdfs given as arguments",function(){return 1},{inletTypes:Object(Ou.l)(Ou.k.apply(void 0,Wf)),type:nu.d,isHot:!0,inlets:function(e){return e+2}});var Kf=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.needsHotReload=!0,e.typed(Object(gu.b)(iu.a.apply(void 0,[function(t){var r=[t].concat(Object(h.a)(n.filter(function(e){return 0!==e()&&void 0!==e()}).map(function(e){return e()}))),a=ou.a.apply(void 0,Object(h.a)(r));return e.flash(),Qf(a)}].concat(n)),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return e+t},0)}))},Qf=function e(t){if(0===t.length)return Object(ru.b)(0);var n=t[0];return 1===t.length?Object(ru.b)(n):"(".concat(Object(ru.b)(n)," + ").concat(e(t.slice(1)),")")};Object(pi.a)("gl.-",{x:"x",y:"y"},"Creates GLSL expression for subtraction",function(){return 1},{inletTypes:Object(Ou.l)(Ou.k.apply(void 0,Wf)),type:nu.d,tags:"GLSL",isHot:!0,inlets:2});Object(pi.a)("gl.*",{x:"",y:""},"Creates GLSL expression for multiplication",function(){return 1},{inletTypes:Object(Ou.l)(Ou.k.apply(void 0,Wf)),type:nu.d,tags:"GLSL",isHot:!0,inlets:2});var Zf=function(e,t){return e.needsHotReload=!0,Object(ju.a)(Object(gu.b)(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"(".concat(Object(ru.b)(r[0]),") * (").concat(Object(ru.b)(r[1]),")")},t),function(e,t){return Array.isArray(e)&&!Array.isArray(t)?e.map(function(e){return e*t}):Array.isArray(t)&&!Array.isArray(e)?t.map(function(t){return t*e}):Array.isArray(t)&&Array.isArray(e)?t.map(function(t,n){return t*e[n]}):e*t}),e,t)};Object(pi.a)("gl./",{},"Fuck",function(){return 1},{inletTypes:Object(Ou.l)(Ou.k.apply(void 0,Wf)),type:nu.d,isHot:!0,inlets:2});function Yf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var $f=function(e){return!Array.isArray(e)};function Xf(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return eh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function eh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function th(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function nh(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return rh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function rh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ah(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ih=function(e){Object(u.a)(n,e);var t=ah(n);function n(e){var r;return Object(o.a)(this,n),r=t.call(this,e),e.skipHotReload=!0,r.skipHotReload=!0,r.dimensionVecs={},r.positionVecs={},r.indexedUniforms={},r.uniformValues={},r.positionUniforms=[],r.dimensionsUniforms=[],r.cornerUniforms=[],r.glSDFs=[],r.positions=[],r.dimensions=[],r.corners=[],r.newInlet("SDF List",function(e){var t=Object(v.a)(e,1)[0];return r.onSDFList(t)}),r.newInlet("mouse down",function(e){var t=Object(v.a)(e,1)[0];return r.onMouseDown(t)}),r.newInlet("mouse up",function(e){var t=Object(v.a)(e,1)[0];return r.onMouseUp(t)}),r.newInlet("mouse move",function(e){var t=Object(v.a)(e,1)[0];return r.onMouseMove(t)}),r.newInlet("slider values",function(e){var t=Object(v.a)(e,1)[0];return r.onSliderValues(t)}),r.newInlet("size",function(e){var t=Object(v.a)(e,1)[0];r.size=t}),Object(hi.e)("canvas.size",function(e){r.size=e}),r.newInlet("operations",function(e){var t=Object(v.a)(e,1)[0];return r.onOperation(t)}),r.newInlet("SDF Morpher",function(e){var t=Object(v.a)(e,1)[0];r.sdfMorpher=t,r.onSDFList(r.lastSDFs,!0)}),r.newInlet("SDF Offset",function(e){var t=Object(v.a)(e,1)[0];r.sdfOffset=t,r.onSDFList(r.lastSDFs,!0)}),r.newInlet("SDF Operation List",function(e){var t=Object(v.a)(e,1)[0];r.onSDFOperationList(t)}),r.newInlet("SDF Smoothness",function(e){var t=Object(v.a)(e,1)[0];r.smoothness=t,r.onSDFList(r.lastSDFs,!0)}),r.newInlet("SDF Smooth Factor",function(e){var t=Object(v.a)(e,1)[0];r.smoothFactor=t,r.onSDFList(r.lastSDFs,!0)}),r.clickBoundary=0,r.newInlet("click boundary",function(e){var t=Object(v.a)(e,1)[0];r.clickBoundary=t}),r.newInlet("enabled",function(e){var t=Object(v.a)(e,1)[0];r.enabled=t,r.onSDFList(r.lastSDFs,!0)}),r.newInlet("bounds",function(e){var t=Object(v.a)(e,1)[0],n=r.bounds!==t;r.bounds=t,n&&r.onSDFList(r.lastSDFs,!0)}),r.newOutlet("Merged GL SDF"),r.newOutlet("GL SDF List"),r.newOutlet("GL SDF Evaluators"),r.newOutlet("vec2(sdf,index)"),r.newOutlet("Index Clicked"),r.newOutlet("On Slider Change"),r.newOutlet("On Slider SDF Change"),r.newInlet("transformation matrix",function(e){var t=Object(v.a)(e,1)[0];return r.onTransformationMatrix(t)}),r.newInlet("transformation matrix list",function(e){var t=Object(v.a)(e,1)[0];return r.onTransformationList(t)}),r.newOutlet("Transformed Positions"),r.newOutlet("sdf released"),r.newOutlet("mouse SDF value"),r.newOutlet("rotated mouse value"),r.newOutlet("SDF Manager"),r.newOutlet("SDF Mouse Move"),r.newOutlet("SDF Mouse Over"),r.setup(),r}return Object(s.a)(n,[{key:"getJson",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return Object(d.a)({},(e=Object(fe.a)(Object(f.a)(n.prototype),"getJson",this)).call.apply(e,[this].concat(r)),{hasBounds:void 0!==this.bounds})}},{key:"fromJson",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];(t=Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this)).call.apply(t,[this,e].concat(a)),this.needsBounds=e.hasBounds}},{key:"ztype",get:function(){return Ou.i}},{key:"hotReload",value:function(){if(this.lastSDFs&&(this.onSDFList(this.lastSDFs),this.lastSent))for(var e in this.lastSent)this.sendMessage(e,this.lastSent[e])}},{key:"flash",value:function(){}},{key:"onSDFList",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.needsBounds||this.bounds){if(!e)return!1;if(e=ch(e),(e=oh(e)).every(function(e){return e.copyId}))return!1;if(this.lastSDFs=Object(h.a)(e),this.inlets.enabled.connections.length>0&&void 0===this.enabled)return!1;var r=uh(e,this.cachedSDFs);if(!n&&this.storedSDFs&&!r)return this.updateUniforms(e),this.sendMessage("SDF Manager",this),this.cachedSDFs=e,!1;var a=[],i=[],o={};window.stopRender=!0;var s,c=nh(e);try{var u=function(){var n=s.value,r=n.id,c=t.getIndexForId(r);if(sh(n)){var u=t.handleSDFCopy(c,n,e),l=u.sdf,f=u.sdfEvaluator,h=Object(bf.a)(u,["sdf","sdfEvaluator"]);return a.push(l),i.push(f),o=Object(d.a)({},o,h.uniforms),"continue"}var p=Object(v.a)(n,1)[0],m=Object(Cf.a)(n),y=Object(Cf.f)(n),b=Object(Cf.c)(n),g=t.getPosition(c,n),O=t.getDimensions(c,n),j=t.getCorner(c,m),k=t.getRotation(c,y),w=t.getRepeats(c,n),x=void 0===b?void 0:t.getLineWidth(c,b);t.indexedUniforms[c]=Object(d.a)({},t.indexedUniforms[c],g.uniforms,O.uniforms,k.uniforms),x&&(t.indexedUniforms[c]=Object(d.a)({},t.indexedUniforms[c],x.uniforms)),Object(Cf.h)(p)&&(t.indexedUniforms[c]=Object(d.a)({},t.indexedUniforms[c],j.uniforms)),Object(Cf.g)(p)&&(t.indexedUniforms[c]=Object(d.a)({},t.indexedUniforms[c],w.uniforms)),o=Object(d.a)({},o,t.indexedUniforms[c]),g.uniforms=t.indexedUniforms[c],O.uniforms=t.indexedUniforms[c],j.uniforms=t.indexedUniforms[c],k.uniforms=t.indexedUniforms[c],w.uniforms=t.indexedUniforms[c];var S=c,P=t.glSDFs[c]||Lf(t.zObject,function(){return p},function(){return O},function(){return j},function(){return t.transformationMatrices[S]||t.transformationMatrix},function(){return k},function(){return S},function(){return w},function(){return x});t.glSDFs[c]=P;var E=P([g])[1],T={},A=t.name("singleSDF",c);T[A]={code:"(("+E.code+").x)",type:"float"},E=Object(d.a)({},E,{variables:T,code:A}),a.push(E),i.push(P([g])[0])};for(c.s();!(s=c.n()).done;)u()}catch(_){c.e(_)}finally{c.f()}if(window.stopRender=!1,this.zObject.needsHotReload=!1,0===a.length)return!1;this.storedSDFs=a,this.storedSDFList=e;var l=Object(Cf.g)(e[0]?e[0][0]:"box"),f=l?"vec3":"vec2",p=function(e,t,n,r,a,i,o){var s=Object(q.uuid)().replaceAll("-",""),c="scene"+s,u="position"+s;return function(e){var s=Object(v.a)(e,1)[0],l={},f={},h={},p={code:"1.0"};n&&void 0!==n()&&(l=(p=n()).functions,h=p.variables,f=p.uniforms);var m={code:"0.0"};r&&void 0!==r()&&(m=r(),l=Object(d.a)({},l,m.functions),h=Object(d.a)({},h,m.variables),f=Object(d.a)({},f,m.uniforms));var y,b=Df(s);try{for(b.s();!(y=b.n()).done;){var g=y.value;h=Object(d.a)({},h,g.variables),f=Object(d.a)({},f,g.uniforms),l=Object(d.a)({},l,g.functions)}}catch(_){b.e(_)}finally{b.f()}p.functions&&(l=Object(d.a)({},p.functions,l)),m.functions&&(l=Object(d.a)({},m.functions,l)),f=Object(d.a)({},f,p.uniforms,m.uniforms);var O=t()||"vec3",j=m.code;if(m.codeEvaluator){var k=m.functions[Object.keys(m.functions)[0]],w=Object.keys(k.args).length,x="vec3"===s[0].position.type?"vec3(0.0, offset_v, 0.0)":"vec2(0.0, offset_v)";j=2===w?m.codeEvaluator("p + ".concat(x,", scene")):3===w?m.codeEvaluator("p + ".concat(x,", scene, ")+u+"(scene.y)"):m.codeEvaluator("p + ".concat(x))}return l[c]={args:{p:O},returnType:"vec3",body:"\n//if (abs(p.x) > 0.3 || abs(p.y) > 0.8) {\n//    return vec3(200.0, -1.0, 0.0);\n//}\nvec3 scene = vec3(0.0, -1.0, 0.0);\n".concat(Bf(s,"p",a(),i()||.2,o()||"2.0"),";\nreturn  vec3(scene.x * (").concat(p.codeEvaluator?p.codeEvaluator("p"):p.code,") + \n(").concat(j,"), scene.y, scene.z);\n")},{code:function(e){return c+"("+e+")"},type:"vec3",functions:l,uniforms:f,variables:h,frames:m&&m.frames,evaluator:c}}}(this.zObject,function(){return f},function(){return t.sdfMorpher},function(){return t.sdfOffset},function(){return t.sdfOperationsList},function(){return t.smoothness},function(){return t.smoothFactor})([i]);if(o=Object(d.a)({},o,p.uniforms),this.smoothness){var m,y=nh(Array.isArray(this.smoothness)?this.smoothness:[this.smoothness]);try{for(y.s();!(m=y.n()).done;){var b=m.value;b.uniforms&&(o=Object(d.a)({},o,b.uniforms))}}catch(_){y.e(_)}finally{y.f()}}if(this.smoothFactor){var g,O=nh(Array.isArray(this.smoothFactor)?this.smoothFactor:[this.smoothFactor]);try{for(O.s();!(g=O.n()).done;){var j=g.value;j.uniforms&&(o=Object(d.a)({},o,j.uniforms))}}catch(_){O.e(_)}finally{O.f()}}for(var k=l?"vec3((1.0*gl_FragCoord.xy-vec2(width, height))/height, 0.0)":"(1.0*gl_FragCoord.xy-vec2(width, height))/height",w=p.code(k),x=p.functions,S=0,P=a;S<P.length;S++){var E=P[S];x=Object(d.a)({},x,E.functions)}var T,A="sdfVec"+this.id.replaceAll("-",""),M={code:"(("+A+").x)",functions:x,uniforms:Object(d.a)({},o),variables:{}},R="sdfValue"+this.id.replaceAll("-","");if(void 0!==this.enabled&&((T=Of(this,function(){return 1})([this.enabled])).uniforms&&(o=Object(d.a)({},o,T.uniforms)),T.variables&&(M.variables=Object(d.a)({},M.variables,T.variables))),M.variables[A]={code:w,type:"vec3"},this.bounds){var C=jf(this,function(){return 0})([this.bounds]);C.uniforms&&(M.uniforms=Object(d.a)({},M.uniforms,C.uniforms)),C.variables&&(M.variables=Object(d.a)({},M.variables,C.variables)),C.functions&&(M.functions=Object(d.a)({},M.functions,C.functions)),M.variables[A].type={type:"vec3",defaultValue:"vec3(10.0, -1.0, 0.0)",condition:C.code}}M.variables[R]={code:M.code,type:void 0!==this.enabled?{type:"float",defaultValue:"0.0",condition:T.code}:"float"},M.code=R;var N={code:A,functions:x,uniforms:Object(d.a)({},o),variables:M.variables},I={evaluator:p.evaluator,functions:p.functions,uniforms:N.uniforms};return this.lastSent={"Merged GL SDF":M,"vec2(sdf,index)":N,"GL SDF List":a,"GL SDF Evaluators":p,Evaluator:I},M.type="float",N.type="vec2",this.sendMessage("Merged GL SDF",M),this.sendMessage("vec2(sdf,index)",N),this.sendMessage("GL SDF List",a),this.sendMessage("GL SDF Evaluators",p),this.sendMessage("SDF Manager",this),this.zObject.needsHotReload=!1,this.sendTransformedPositions(),this.type=Ou.i,this.cachedSDFs=Object(h.a)(e),!0}}},{key:"updateUniforms",value:function(e){this.zObject.needsHotReload=!1,window.stopRender=!0;var t,n=0,r=nh(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;this.cachedSDFs&&this.cachedSDFs[n]&&a===this.cachedSDFs[n]||this.updateUniformsForSDF(a,e),n++}}catch(i){r.e(i)}finally{r.f()}window.stopRender=!1}}]),n}(Object(ot.a)(function(e){return function(e){Object(u.a)(n,e);var t=Gf(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).idToIndex={},e.indexCounter=0,e}return Object(s.a)(n,[{key:"newSDF",value:function(e){var t=this.indexCounter;return this.idToIndex[e]=t,this.indexCounter++,t}},{key:"getIndexForId",value:function(e){var t=this.idToIndex[e];return void 0===t&&(t=this.newSDF(e)),t}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=th(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"setup",value:function(){this.tMatrix=[[1,0,0],[0,1,0],[0,0,1]];var e=this.name("globalMatrix",0);this.globalMatrixUniform=su({},function(){return e}),this.transformationMatrix=this.globalMatrixUniform([[[1,0,0],[0,1,0],[0,0,1]]],!0),this.transformationMatrices=[],this.transformationMatricesUniforms=[]}},{key:"onPivot",value:function(e){this.pivot=e,this.globalPivotUniform([e])}},{key:"onTransformationMatrix",value:function(e){if(!Array.isArray(e)&&"object"===typeof e)return this.userInputMatrix=e,void this.onSDFList(this.lastSDFs,!0);Array.isArray(e)&&!e.some(function(e){return!Array.isArray(e)})&&(this.userInputMatrix=void 0,this.tMatrix=e,this.globalMatrixUniform([e]))}},{key:"onTransformationList",value:function(e){var t,n,r=this,a=!1;window.stopRender=!0,this.currentTransformations=Object(h.a)(e);for(var i=0;i<e.length;i++){var o=e[i];Array.isArray(o)&&Array.isArray(o[0])&&(this.transformationMatrices[i]?this.transformationMatricesUniforms[i]([o]):function(){var e=r.name("sdfTransform",i);r.transformationMatricesUniforms[i]=su({},function(){return e}),r.transformationMatrices[i]=r.transformationMatricesUniforms[i]([o],!0),a=!0}(),t=this.transformationMatricesUniforms[i],n=o)}window.stopRender=!1,t&&t([n]),a&&this.onSDFList(this.lastSDFs,!0),this.sendTransformedPositions()}},{key:"sendTransformedPositions",value:function(){if(this.currentTransformations){var e,t=[],n=0,r=Xf(this.positions);try{for(r.s();!(e=r.n()).done;){var a=e.value,i=Object(v.a)(a,3),o=i[0],s=i[1],c=i[2],u=this.currentTransformations[n];if(!u)return;var l=Object(v.a)(u,3),f=l[0],h=l[1],d=l[2];t.push([o*f[0]+s*f[1]+c*f[2],o*h[0]+s*h[1]+s*h[2],o*d[0]+s*d[1]+c*d[2]]),n++}}catch(p){r.e(p)}finally{r.f()}this.sendMessage("Transformed Positions",t)}}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Yf(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).glDimensions=[],e.glPositions=[],e.glCorners=[],e.glLineWidths=[],e.lineWidthUniforms=[],e.lineWidths=[],e.rotations=[],e.rotationUniforms=[],e.glRepeats=[],e.repeats=[],e.repeatsUniforms=[],e.glRotations=[],e}return Object(s.a)(n,[{key:"getTypeForId",value:function(e){var t=this.lastSDFs.find(function(t){return t.id===e});if(t)return t[0]}},{key:"updatePosition",value:function(e,t,n){this.positions[e]=[t,n],(0,this.positionUniforms[e])([this.positions[e]])}},{key:"updateUniformsForSDF",value:function(e,t){this.lastMouseOver=void 0,this.isHovered=void 0;var n=this.getIndexForId(e.id);if(this.getTypeForId(e.copyId||e.id),$f(e)){var r=!0;return n===t.length-1&&(r=!1),void this.updateUniformsForCopy(n,e,t,r)}var a=Object(Cf.a)(e),i=this.lineWidths[n],o=Object(Cf.c)(e),s=Object(Cf.f)(e);this.positions[n]=Object(Cf.d)(e);var c=this.rotations[n];this.rotations[n]=s;var u=this.dimensions[n];this.dimensions[n]=Object(Cf.b)(e),this.repeats[n]=Object(Cf.e)(e);var l=this.corners[n];this.corners[n]=a;var f=this.positionUniforms[n];if(f){var h=this.repeatsUniforms[n],d=this.dimensionsUniforms[n],p=this.cornerUniforms[n],v=this.lineWidthUniforms[n],m=this.rotationUniforms[n];if(f([this.positions[n]]),u&&u[0]===this.dimensions[n][0]&&u[1]===this.dimensions[n][1]||d([this.dimensions[n]]),Object(Cf.g)(e[0])){var y=this.dimensionFactors[n];y&&y[2],h([this.repeats[n]])}o!==i&&v([o]),e===t[t.length-1]&&(window.stopRender=!1,Object(hi.c)("shader.render")),a!==l&&p([a]),s!==c&&m([s])}else n===t.length-1&&Object(hi.c)("shader.render")}},{key:"updateUniformsForCopy",value:function(e,t,n,r){t.id;var a=t.offset,i=t.copyId,o=this.getTypeForId(i);Object(Cf.g)(o)||(a=a.slice(0,2)),this.positions[e]=a;var s=this.positionUniforms[e];window.stopRender=r,s([this.positions[e]])}},{key:"handleSDFCopy",value:function(e,t,n){for(var r,a,i=this,o=(t.id,t.offset),s=t.copyId,c=0;c<n.length;c++){var u=n[c];if(u.id===s){a=c,r=u;break}}if(!r)return{sdf:void 0,sdfEvaluator:void 0};var l=this.glDimensions[a],f=this.glPositions[a],h=this.glCorners[a],d=this.glRotations[a],p=this.getTypeForId(s),m=Zf(this.zObject,function(){return f})(["circle"===p?-1:1]),y=Kf(this.zObject,function(){return m}),b=r;b[1]=o[0],b[2]=o[1],Object(Cf.g)(p)&&(b[3]=o[2]);var g=y([this.getPosition(e,b)]),O=this.glSDFs[e]||Lf(this.zObject,function(){return r[0]},function(){return l},function(){return h},function(){return i.transformationMatrices[e]||i.transformationMatrix},function(){return d},function(){return e});this.glSDFs[e]=O;var j=O([g]),k=Object(v.a)(j,2),w=k[0],x=k[1],S=x.uniforms;return this.indexedUniforms[e]=S,{sdf:x,sdfEvaluator:w,uniforms:S}}},{key:"getPosition",value:function(e,t){var n=Object(Cf.d)(t),r=Object(v.a)(n,3);r[0],r[1],r[2],this.positions[e]=n;var a=this.name("position",e);this.uniformValues[a]=n;var i=this.positionUniforms[e]||su({},function(){return a});return this.positionUniforms[e]=i,this.glPositions[e]=i([n],!0),this.glPositions[e]}},{key:"getRepeats",value:function(e,t){var n=Object(Cf.e)(t);this.repeats[e]=n;var r=this.name("repeats",e);this.uniformValues[r]=n;var a=this.repeatsUniforms[e]||su({},function(){return r});return this.repeatsUniforms[e]=a,this.glRepeats[e]=a([n],!0),this.glRepeats[e]}},{key:"name",value:function(e,t){return e+t+this.id.replaceAll("-","")}},{key:"getDimensions",value:function(e,t){var n=Object(Cf.b)(t),r=Object(v.a)(n,3),a=r[0],i=r[1],o=r[2],s=this.name("dimension",e);this.dimensions[e]=n,this.uniformValues[s]=[a,i,o];var c=this.dimensionsUniforms[e]||su({},function(){return s});return this.dimensionsUniforms[e]=c,this.glDimensions[e]=c([Object(Cf.g)(t[0])?[a,i,o]:[a,i]],!0),this.glDimensions[e]}},{key:"getCorner",value:function(e,t){var n=this.name("corner",e),r=this.cornerUniforms[e]||su({},function(){return n});return this.corners[e]=t,this.cornerUniforms[e]=r,this.glCorners[e]=r([t],!0),this.glCorners[e]}},{key:"getLineWidth",value:function(e,t){var n=this.name("linewidth",e),r=this.lineWidthUniforms[e]||su({},function(){return n});return this.lineWidths[e]=t,this.lineWidthUniforms[e]=r,this.glLineWidths[e]=r([t],!0),this.glLineWidths[e]}},{key:"getRotation",value:function(e,t){var n=this.name("rotation",e),r=this.rotationUniforms[e]||su({},function(){return n});return this.rotations[e]=t,this.rotationUniforms[e]=r,this.glRotations[e]=r([t],!0),this.glRotations[e]}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Vf(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).lastSliderValues=[0,0,0,0],e.mouseSliderStart={},e.sdfsClicked=[],e.lastMouseMove={},e.touches={},e}return Object(s.a)(n,[{key:"isMouseDown",value:function(){return this.sdfsClicked.length>0}},{key:"onMouseDown",value:function(e){var t=Object(v.a)(e,2);if(t[0],t[1],this.lastSDFs){for(var n=[],r=!1,a=0;a<this.lastSDFs.length;a++){this.corners[a];var i=this.positions[a],o=this.lastSDFs[a],s=this.dimensions[a];if(o&&o.copyId){var c,u=-1,l=0,f=zf(this.lastSDFs);try{for(f.s();!(c=f.n()).done;){if(c.value.id===o.copyId){u=l;break}l++}}catch(m){f.e(m)}finally{f.f()}if(u>-1){var h=this.positions[u];i[0]+=h[0],i[1]+=h[1],this.corners[u],s=this.dimensions[u]}}if(!(s[0]>.7)){var d=this.sdfAtPoint(e,a);n.push(d),d<this.clickBoundary&&!r&&(this.sdfsClicked.push(a),this.touches[a]=e,this.lastMouseMove[a]=e,this.sendMessage("Index Clicked",a),r=!0)}}var p=Math.min.apply(Math,n);this.sendMessage("mouse SDF value",p),r||this.sendMessage("Index Clicked",-1)}}},{key:"sdfForCoord",value:function(e,t){for(var n=0;n<this.lastSDFs.length;n++){this.corners[n];var r=this.positions[n],a=this.lastSDFs[n],i=this.dimensions[n];if(a&&a.copyId){var o,s=-1,c=0,u=zf(this.lastSDFs);try{for(u.s();!(o=u.n()).done;){if(o.value.id===a.copyId){s=c;break}c++}}catch(f){u.e(f)}finally{u.f()}if(s>-1){var l=this.positions[s];r[0]+=l[0],r[1]+=l[1],this.corners[s],i=this.dimensions[s]}}if(!(i[0]>.7)&&this.sdfAtPoint([e,t],n)<0)return n}return-1}},{key:"getTouch",value:function(e,t){var n=1e6,r=-1,a=this.lastMouseMove;for(var i in a){var o=Hf(a[i][0],a[i][1],e[0],e[1]);o<n&&o<90&&(r=parseInt(i),n=o)}return r}},{key:"onMouseMove",value:function(e,t){for(var n=[],r=!0,a=0;a<this.positions.length;a++)this.sdfAtPoint(e,a)<this.clickBoundary&&(r=!1,a!==this.lastMouseOver&&(n.push(a),this.lastMouseOver=a));if(this.isMouseDown()||(1===n.length?(this.isHovered=!0,this.sendMessage("SDF Mouse Over",n[0])):n.length>0?(this.isHovered=!0,this.sendMessage("SDF Mouse Over",n)):r&&this.isHovered&&(this.isHovered=!1,this.lastMouseOver=void 0,this.sendMessage("SDF Mouse Over",-1))),this.sdfsClicked.length>0){if(!this.lastSliderValues)return;var i=this.getTouch(e);if(window.mouseDown=i,i<0)return;this.lastMouseMove[i]=e,this.sendMessage("SDF Mouse Move",[i].concat(Object(h.a)(e))),this.touches[i]=e;var o=this.sdfAtPoint(e,i),s=this.dimensions[i],c=this.screenToGLCoords(e[0],e[1]),u=this.positions[i],l=this.dimensions[i],f=this.corners[i];if(!l)return;l[0]>l[1]&&(f*=.5);var d=this.sdfOffset?this.getMaxY(e,i):u[1]+l[1]/2+f,p=this.sdfOffset?this.getMinY(e,i):u[1]-l[1]/2-f,v=(Uf(e,this.size),this.lastSliderValues[i],(c[1]-p)/(d-p));v=Math.max(0,Math.min(1,v)),void 0!==t&&(this.mouseSliderStart[t]=v);var m=v-this.mouseSliderStart[i];isNaN(m)&&(m=0);var y=m<0?this.mouseSliderStart[i]:1-this.mouseSliderStart[i],b=!1;(0===y||isNaN(y))&&(y=1e-5,b=!0),m*=1/y*.4;var g=v,O=this.lastSliderValues[i];if(void 0===O&&(O=0),v=O+m,v=Math.min(1,Math.max(v,0)),b&&(g=1,v=1),isNaN(v))return;void 0===t&&(this.mouseSliderStart[i]=g),this.lastSliderValues[i]=v;var j=-Math.min(s[0]+0,s[1]+0);o=j-v*j;var k=v;o=Math.max(j+window.MIN_SDF_VALUE,o),this.sendMessage("On Slider Change",[i,Math.min(1,k)]),this.sendMessage("On Slider SDF Change",[i,Math.min(0,o)])}}},{key:"screenToGLCoords",value:function(e,t){var n=[e,t],r=this.size||[400,400];return Uf(n,r)}},{key:"getOperationAtIndex",value:function(e){return this.sdfOperationsList?this.sdfOperationsList[Math.max(0,e-1)]:0}},{key:"getDownstreamSubtractions",value:function(e){for(var t=[],n=e+1;n<this.positions.length;n++)2===this.getOperationAtIndex(n)&&t.push(n);return t}},{key:"sdfAtPoint",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=this.getDownstreamSubtractions(t),i=this.getOperationAtIndex(t);if(!n&&2===i)return 1;if(!n){var o,s=zf(a);try{for(s.s();!(o=s.n()).done;){var c=o.value,u=this.sdfAtPoint(e,c,!0);if(u<0)return-u}}catch(w){s.e(w)}finally{s.f()}}var l=this.corners[t],f=this.positions[t],h=this.dimensions[t],d=this.size||[400,400],p=f||this.positions[t],v=h||this.dimensions[t],m=l||this.corners[t],y=r?e:Uf(e,d),b=y;if(!p)return 1;y=[y[0]-p[0],y[1]-p[1]],y=Bo(y[0],y[1],-this.rotations[t]),this.sendMessage("rotated mouse value",y);var g=[Math.abs(y[0])-v[0]+m,Math.abs(y[1])-v[1]+m],O=Math.min(Math.max(g[0],g[1]),0),j=Math.pow(Math.max(0,g[0]),2)+Math.pow(Math.max(0,g[1]),2),k=O+Math.sqrt(j)-m;if(this.sdfOffset)try{k+=this.sdfOffset.model(b)}catch(x){}return k}},{key:"onMouseUp",value:function(e){if(!e||void 0===e[0])return this.touches={},this.sdfsClicked.length=0,this.lastMouseMove={},void this.sendMessage("sdf released",-1);var t=this.getTouch(e,!0);if(t>=0){var n=this.sdfsClicked.indexOf(t);this.sdfsClicked.splice(n,1),delete this.touches[t],delete this.lastMouseMove[t]}this.sendMessage("sdf released",t)}},{key:"debug",value:function(e){this.sequencerEngine.dispatch(Object(J.df)(e))}},{key:"onSliderValues",value:function(e){if(e&&(this.lastSliderValues=e),this.storedSDFs){for(var t=[],n=0;n<e.length;n++){var r=e[n],a=this.dimensions[n];if(a){var i=-Math.min(a[0]+0,a[1]+0),o=i-r*i;t.push(Math.max(i+window.MIN_SDF_VALUE,o))}}2!==t.length&&this.sendMessage("On Slider SDF Change",t)}}},{key:"getMinY",value:function(e,t){var n=Object(v.a)(e,2),r=n[0],a=n[1];return Uf([0,this.raytrace([r,a],this.getUpwardAngles(),t)],this.size)[1]}},{key:"getMaxY",value:function(e,t){var n=Object(v.a)(e,2),r=n[0],a=n[1];return Uf([0,this.raytrace([r,a],this.getDownwardAngles(),t)],this.size)[1]}},{key:"raytrace",value:function(e,t,n){for(var r=Object(v.a)(e,2),a=r[0],i=r[1],o=0,s=i,c=new Set,u=0;u<120;u++){o+=4;var l,f=zf(t);try{for(f.s();!(l=f.n()).done;){var h=l.value;if(!c.has(h)){var d=this.getNextPointAtAngle(a,i,h,o),p=this.sdfAtPoint(d,n);(d[1]>=this.size[1]||d[1]<=0||p>0)&&(c.add(h),s=d[1])}}}catch(m){f.e(m)}finally{f.f()}}return s}},{key:"getUpwardAngles",value:function(){return[1.6]}},{key:"getDownwardAngles",value:function(){return[4.76]}},{key:"getNextPointAtAngle",value:function(e,t,n,r){return[e+r*Math.cos(n),t+r*Math.sin(n)]}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=gf(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"ztype",get:function(){return""}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Ef(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).dimensionFactors=[],e}return Object(s.a)(n,[{key:"onSDFOperationList",value:function(e){this.sdfOperationsList=e,this.lastSDFs&&this.onSDFList(this.lastSDFs,!0)}},{key:"onOperation",value:function(e){if(e&&e.split){var t=e.split(" "),n=t[0],r=Pf[n],a=t.slice(1).map(function(e){return parseFloat(e)});r&&r.apply(void 0,[this].concat(Object(h.a)(a)))}}}]),n}(e)})(Ni.a)),oh=function(e){var t=e.filter(function(e){return!sh(e)}),n=e.filter(function(e){return sh(e)});return[].concat(Object(h.a)(t),Object(h.a)(n))},sh=function(e){return!Array.isArray(e)},ch=function(e){if(!e||!0===e)return[];e.some(function(e){return"number"===typeof e})&&(e=e.filter(function(e){return!Object(ke.a)(e)}));for(var t=0;t<e.length;t++){var n=e[t];if("string"===typeof n){var r=n.split(" ").map(function(e){return Object(ke.a)(e)?parseFloat(e):e});e[t]=r}e[t].id||(e[t].id=t)}return e},uh=function(e,t){if(!e||!t)return!0;if(e.length!==t.length)return!0;for(var n=0;n<e.length;n++)if(e.id!==t.id)return!0;return!1};Object(pi.a)("gl.unpack",{"vec2/vec3/vec4":""},"Unpacks a vector into its components, sending them out through its outlets",function(){return 4},{inletTypes:Object(Ou.k)(Ou.d,Ou.e,Ou.f),type:function(){return["float","float","float","float"]},inlets:1});var lh=function(e){return e.needsHotReload=!0,e.typed(function(e){var t=Object(v.a)(e,1)[0],n=t.uniforms,r=t.frames,a=t.functions,i=t.variables,o=t.closure,s=t.model,c=Object(ou.a)(t),u={uniforms:n,variables:i,closure:o,functions:a};return[Object(d.a)({},u,{frames:r,type:"float",code:"((".concat(Object(ru.b)(c[0]),").r)"),model:function(e){return s(e)[0]}}),Object(d.a)({},u,{frames:r,type:"float",code:"((".concat(Object(ru.b)(c[0]),").g)"),model:function(e){return s(e)[1]}}),Object(d.a)({},u,{frames:r,type:"float",code:"((".concat(Object(ru.b)(c[0]),").b)"),model:function(e){return s(e)[2]}}),Object(d.a)({},u,{frames:r,type:"float",code:"((".concat(Object(ru.b)(c[0]),").a)"),model:function(e){return s(e)[3]}})]})};Object(pi.a)("sdf.smoothUnion",{"sdf manager":"",smooth:"",smoothPower:""},"",function(){return 2},{inletTypes:[Ou.i,Ou.b,Ou.b],outlets:["SDF GL",Ou.i],type:function(){return[Ou.b,Ou.i]},inlets:3,isHot:!0});var fh=function(e,t,n){return e.needsHotReload=!0,function(e){var r=Object(v.a)(e,1)[0];if(r&&r.onSDFList){var a=new Array(r.lastSDFs.length).fill(3);return r.sdfOperationsList&&r.sdfOperationsList.length===a.length&&r.smoothness===t()&&r.smoothFactor===n()||(r.smoothness=t(),r.smoothFactor=n(),r.sdfOperationsList=a,r.onSDFList(r.lastSDFs,!0)),[r.lastSent["Merged GL SDF"],r]}}},hh={"sdf.smoothUnion":fh};Object(pi.a)("sdf.displace",{"sdf manager":"","displacement function":""},"Hooks up mouse events to sdf",function(){return 1},{inletTypes:[Ou.i,Ou.a],type:[Ou.b,Ou.i],isHot:!0,outlets:["SDF GL",Ou.i],inlets:2});Object(pi.a)("sdf.list",{"list of sdf shapes":""},"Creates sdf manager out of list of shapes",function(){return 2},{type:function(){return[Ou.b,Ou.i]},outlets:["SDF GL",Ou.i]});var dh=function(e){var t=new ih({sequencerEngine:e,subSequence:e.subSequence,id:e.id,flash:function(e){return 0},newAttribute:function(){return 0}});return function(e,n){var r=Object(v.a)(e,1)[0];return r!==t.lastSDFs&&t.onSDFList(r,n),[t.lastSent["Merged GL SDF"],t]}};Object(pi.a)("sdf.operations",{"sdf manager":"","operation list":"",smoothness:"","smooth factor":""},"Hooks up mouse events to sdf",function(){return 2},{isHot:!0,outlets:["SDF GL",Ou.i],outletTypes:["float","object"],inlets:4});Object(pi.a)("sdf.index",{"sdf manager":""},"Returns the sdf index of the sdf manager ",function(){return 1},{isHot:!0,inletTypes:[Ou.i],type:"float",inlets:1});Object(pi.a)("sdf.mix",{"sdf manager":""},"Returns the sdf mix of the sdf manager ",function(){return 1},{outlet:"mix",inletTypes:[Ou.i],type:function(){return"float"},isHot:!0,inlets:1});Object(pi.a)("sdf.mouse",{"sdf manager":"",clickBoundary:""},"Modular mouse events for sdfs",function(){return 3},{outlets:["index clicked","sdf released","sdf mouse moved","sdf mouse over"],inletTypes:[Ou.i],isHot:!0,inlets:2});Object(pi.a)("sdf.bounds",{"sdf manager":"","bounds sdf":""},"Hooks up mouse events to sdf",function(){return 2},{inletTypes:[Ou.i,"float"],isHot:!0,outlets:["SDF GL",Ou.i],outletTypes:["float",Ou.i],inlets:2});var ph=Object(d.a)({"sdf.bounds":function(e,t){return e.needsHotReload=!0,function(e){var n=Object(v.a)(e,1)[0];if(n&&n.onSDFList)return n.bounds!==t()&&(n.bounds=t(),n.onSDFList(n.lastSDFs,!0)),[n.lastSent["Merged GL SDF"],n]}},"sdf.index":function(e){var t={typed:function(e){return e}};return e.needsHotReload=!0,e.typed(function(e){var n=Object(v.a)(e,1)[0];if(n&&n.onSDFList){var r=n.lastSent["vec2(sdf,index)"],a=lh(t)([r])[1];return a.type="float",a}})},"sdf.displace":function(e,t){return e.needsHotReload=!0,function(e){var n=Object(v.a)(e,1)[0];if(n&&n.onSDFList&&(console.log("displace called"),n.sdfOffset!==t())){n.sdfOffset=t(),n.onSDFList(n.lastSDFs,!0);var r=n.lastSent["Merged GL SDF"];return console.log("returning",r),[r,n]}}},"sdf.operations":function(e,t,n,r){return e.needsHotReload=!0,function(e){var a=Object(v.a)(e,1)[0];if(a&&a.onSDFList)return a.sdfOperationsList===t()&&a.smoothness===n()&&a.smoothFactor===r()||(a.sdfOperationsList=t(),a.smoothness=n(),a.smoothFactor=r(),a.onSDFList(a.lastSDFs,!0)),[a.lastSent["Merged GL SDF"],a]}},"sdf.mouse":function(e,t){e.needsHotReload=!0;var n=void 0;Object(hi.e)("mouse-down",function(e){n&&n.inlets["mouse down"].action([e])}),Object(hi.e)("mouse-up",function(e){n&&n.inlets["mouse up"].action([e])}),Object(hi.e)("mouse-move",function(e){n&&n.inlets["mouse move"].action([e])});var r=function(t){e.sendMessage(e.outputByNumber(0),t)},a=function(t){e.sendMessage(e.outputByNumber(1),t)},i=function(t){e.sendMessage(e.outputByNumber(2),t)},o=function(t){e.sendMessage(e.outputByNumber(3),t)};return function(e){var s=Object(v.a)(e,1)[0],c=(n=s).outlets;n.clickBoundary=t()||0,c&&(c["Index Clicked"].actions.includes(r)||c["Index Clicked"].actions.push(r),c["sdf released"].actions.includes(a)||c["sdf released"].actions.push(a),c["SDF Mouse Move"].actions.includes(i)||c["SDF Mouse Move"].actions.push(i),c["SDF Mouse Over"].actions.includes(o)||c["SDF Mouse Over"].actions.push(o))}},"sdf.mix":function(e){e.needsHotReload=!0;var t={typed:function(e){return e}};return e.typed(function(e){var n=Object(v.a)(e,1)[0];if(n&&n.onSDFList){var r=n.lastSent["vec2(sdf,index)"];return[lh(t)([r])[2]]}})},"sdf.list":dh},hh);Object(pi.a)("grid.puzzleAlgo",{list:"",w:"",h:"",algo:"",useLines:""},"",function(){return 1},{isHot:!0,inlets:5});var vh=function(e,t){if((e=e.map(function(e){return t[e]}).filter(function(e){return e}))[0]){var n=e.reduce(function(e,t){return e+t[1]},0)/e.length,r=e.reduce(function(e,t){return e+t[2]},0)/e.length,a=e.length*e[0][3],i=[e[0][0],n,r,a].concat(Object(h.a)(e[0].slice(4)));return i.id=e[0][0].id,i}},mh=function(e,t,n){switch(e){case 0:return[0];case 1:return[0,t];case 2:return[0,1];case 3:return[0,t,2*t];case 4:return[0,1,2];case 5:return[0,t,2*t,t+1];case 6:return[0,t,2*t,t-1];case 7:return[0,1,2,t+1];case 8:return[0,1,2,1-t];case 9:return[0,1,t,t+1];case 10:return[0,t+1];case 11:case 11:return[0,t-1];case 12:return[0,1,2,t,t+1];case 13:return[0,1,t,t+1,t+2]}};Object(pi.a)("sdf.individualSDFs",{"list of sdf shapes":""},"takes a list of SDF definitions and returns a  list of gl SDFs");Object(pi.a)("sdf.partitionedSmoothUnion",{partitions:"",smoothness:"",smoothPower:""},"",function(){return 2},{isHot:!0,inlets:3,outlets:["list of SDF gl floats","list of SDF mix floats","list of SDF managers"]});var yh={"sdf.individualSDFs":function(e){var t,n=[];return function(r){for(var a=Object(v.a)(r,1)[0],i=[],o=0;o<a.length;o++){var s=a[o],c=n[o]||dh(e);n[o]=c;var u=t&&(t.length!==a.length||t.some(function(e,t){return e.some(function(e){var n=e.id;return!a[t].map(function(e){return e.id}).includes(n)})}));Array.isArray(s[0])||(s=[s]),console.log("sdf list =",s);var l=c([s],u),f=Object(v.a)(l,2),h=f[0];f[1],i.push(h)}return t=a,[i]}},"grid.puzzleAlgo":function(e,t,n,r,a){return function(e){for(var i=Object(v.a)(e,1)[0],o=[],s=function(e){var s=r().slice(e,e+2),c=Object(v.a)(s,2),u=c[0],l=c[1],f=mh(l,t(),n());if(!f)return"continue";var d=f.map(function(e){return e+u}),p=[];if(a())for(var m=Array.from(new Set(d.map(function(e){return e%t()}))),y=function(){var e=g[b],n=d.filter(function(n){return n%t()===e}),r=vh(n,i);r&&(p=[].concat(Object(h.a)(p),[r]))},b=0,g=m;b<g.length;b++)y();else d.forEach(function(e){if(i[e]){var t=Object(h.a)(i[e]);t.id=i[e].id,p.push(t)}});p.length>0&&o.push(p)},c=0;c<r().length;c+=2)s(c);return t(),n(),[o]}},"sdf.partitionedSmoothUnion":function(e,t,n){var r,a=[],i=[];return function(o){for(var s=Object(v.a)(o,1)[0],c=[],u=[],l=[],f=0;f<s.length;f++){var h=s[f],d=a[f]||dh(e);a[f]=d;var p=d([h],r&&(r.length!==s.length||r.some(function(e,t){return e.some(function(e){var n=e.id;return!s[t].map(function(e){return e.id}).includes(n)})}))),m=Object(v.a)(p,2),y=(m[0],m[1]),b=i[f]||fh(e,t,n);b[f]=b;var g=b([y]),O=Object(v.a)(g,1)[0];c.push(O);var j=lh(e)([y.lastSent["vec2(sdf,index)"]])[2];u.push(j),l.push(y)}return r=s,[c,u,l]}}};function bh(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return gh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function gh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("sdf.lazyUnionList",{"manager list":""},"",function(){return 1},{type:Ou.a});var Oh=function(e){return e.needsHotReload=!0,function(t){var n,r=Object(v.a)(t,1)[0],a=r.map(function(e){return e.lastSent&&e.lastSent.Evaluator}).filter(function(e){return e}).map(function(e){return e.evaluator}),i=ru.a.apply(void 0,Object(h.a)(r.filter(function(e){return e.lastSent}).map(function(e){return e.lastSent.Evaluator}))),o=i.functions,s=i.uniforms,c=(i.closures,i.variables),u="lazyUnion"+e.id.replaceAll("-",""),l="\nvec3 scene = vec3(10000.0, -1.0, 0.0);\nvec3 ret = vec3(0.0); ",f=0,d=bh(a);try{for(d.s();!(n=d.n()).done;){var p=n.value;l+="\nret = ".concat(p,"(p);\nif (ret.x < scene.x) {\n   scene = vec3(ret.x, ").concat(f++,".0, ret.z);\n}\n\n")}}catch(m){d.e(m)}finally{d.f()}return l+="\nreturn scene;\n",o[u]={args:{p:"vec2"},returnType:"vec3",body:l},{type:Ou.a,functions:o,functionName:u,func:o[u],codeEvaluator:function(e){return"".concat(u,"(").concat(e,")")},uniforms:s,variables:c}}};Object(pi.a)("sdf.lazyUnion",{"SDF Manager":""},"",function(){return 1},{inletTypes:[Ou.i],type:Ou.a});Object(pi.a)("sdf.lazySmoothUnionList",{"manager list":"",smooth:"",smoothFactor:""},"",function(){return 1},{type:Ou.a,inlets:3});Object(pi.a)("sdf.repeatLimited",{point:"",spacing:"",limA:"",limB:""},"",function(){return 1},{inletTypes:["vec2","float","float","float"],type:"vec2",inlets:4,isHot:!0});function jh(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return kh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function kh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("sdf.positionTexture",{"sdf list":""},"Returns a texture with all positions/dimensions of sdfs",function(){return 1},{});var wh=function(e){return Math.floor(255*e)};Object(pi.a)("gl.fwidth",{x:""},"Creates GLSL expression calculating fwidth (partial derivative) of inlet",function(){return 1},{inletTypes:Object(Ou.l)("float"),type:function(){return"float"},tags:"GLSL",inlets:1});Object(pi.a)("gl.sqrt",{x:""},"Creates GLSL expression calculating sqrt of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(pi.a)("gl.floor",{x:""},"Creates GLSL expression calculating floor of inlet",function(){return 1},{inletTypes:[Object(Ou.k)("float","vec2","vec3","vec4")],type:function(e){return e},tags:"GLSL",inlets:1});Object(pi.a)("gl.sign",{x:""},"Creates GLSL expression calculating sign of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(pi.a)("gl.log",{x:""},"Creates GLSL expression calculating the natural logarithm of an inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(pi.a)("gl.round",{x:""},"Creates GLSL expression calculating floor of inlet",function(){return 1},{inletTypes:Object(Ou.l)(Object(Ou.k)("float","vec2","vec3","vec4")),type:nu.d,tags:"GLSL",inlets:1});Object(pi.a)("gl.ceil",{x:""},"Creates GLSL expression calculating ceil of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(pi.a)("gl.rand",{vec2:""},"Creates GLSL expression for calculating a pseudo-random number given a vec2",function(){return 1},{inletTypes:["vec2"],type:"float",tags:"GLSL",inlets:1});Object(pi.a)("gl.sin",{x:""},"Creates GLSL expression calculating sin of inlet",function(){return 1},{inletTypes:Object(Ou.l)(Object(Ou.k)("float","vec2","vec3","vec4")),type:nu.d,tags:"GLSL",inlets:1});Object(pi.a)("gl.cos",{x:""},"Creates GLSL expression calculating cosine of inlet",function(){return 1},{inletTypes:Object(Ou.l)(Object(Ou.k)("float","vec2","vec3","vec4")),type:nu.d,tags:"GLSL",inlets:1});Object(pi.a)("gl.acos",{x:""},"Creates GLSL expression calculating acosine of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(pi.a)("gl.tan",{x:""},"Creates GLSL expression calculating tangent of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(pi.a)("gl.atan",{y:"",x:""},"Creates GLSL expression calculating arc-tangent of inlets",function(){return 1},{inletTypes:["float","float"],type:function(){return"float"},isHot:!0,tags:"GLSL",inlets:2});Object(pi.a)("gl.asinh",{x:""},"Creates GLSL expression calculating asinh of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(pi.a)("gl.pow",{y:"",x:""},"Creates GLSL expression calculating pow (exponent) of inlets",function(){return 1},{inletTypes:["float","float"],type:function(){return"float"},isHot:!0,tags:"GLSL",inlets:2});Object(pi.a)("gl.distance",{a:"",b:""},"Creates GLSL expression calculating distance between inlets",function(){return 1},{inletTypes:["vec2","vec2"],type:function(){return"float"},isHot:!0,tags:"GLSL",inlets:2});Object(pi.a)("gl.smoothstep",{a:"",b:"",c:""},"Creates GLSL expression calculating smoothstep of inlets",function(){return 1},{inletTypes:["float","float",Object(Ou.k)("float","vec2","vec3","vec4")],type:function(e,t,n){return n},isHot:!0,tags:"GLSL",inlets:3});var xh=function(e,t,n){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(r){var a=Object(ou.a)(r,t,n);return e.flash(),"smoothstep(".concat(Object(ru.b)(a[0]),", ").concat(Object(ru.b)(a[1]),", ").concat(Object(ru.b)(a[2]),")")},t,n),function(e,t,n){var r=Math.max(0,Math.min(1,(n-e)/(t-e)));return r*r*(3-2*r)}))};Object(pi.a)("gl.smoothbetween",{min:"",max:"",smoothness:"",value:""},"Creates GLSL expression calculating smoothstep of inlets",function(){return 1},{inletTypes:["float","float","float","float"],type:"float",isHot:!0,tags:"GLSL",inlets:4});Object(pi.a)("gl.ddx",{x:""},"Creates GLSL expression calculating ddx (partial derivative) of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(pi.a)("gl.ddy",{x:""},"Creates GLSL expression calculating ddy (partial derivative) of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(pi.a)("gl.rotate",{vec2:"",theta:""},"Creates GLSL expression calculating rotations of vec2 by angle",function(){return 1},{inletTypes:["vec2","float"],type:function(){return"vec2"},isHot:!0,tags:"GLSL",inlets:2});var Sh={"gl.sin":function(e){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(t){var n=Object(ou.a)(t);return e.flash(),"sin(".concat(Object(ru.b)(n[0]),")")}),function(e){return Math.sin(e)}))},"gl.asinh":function(e){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(t){var n=Object(ou.a)(t);return e.flash(),"asinh(".concat(Object(ru.b)(n[0]),")")}),function(e){return Math.asin(e)}))},"gl.cos":function(e){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"cos(".concat(n,")")}),function(e){return Math.cos(e)}))},"gl.acos":function(e){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"acos(".concat(n,")")}),function(e){return Math.cos(e)}))},"gl.tan":function(e){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"tan(".concat(Object(ru.b)(n),")")}),function(e){return Math.tan(e)}))},"gl.atan":function(e,t){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"atan(".concat(Object(ru.b)(r[0]),", ").concat(Object(ru.b)(r[1]),")")},t),function(e,t){return Math.atan2(e,t)}))},"gl.pow":function(e,t){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"pow(".concat(Object(ru.b)(r[0]),", ").concat(Object(ru.b)(r[1]),")")},t),function(e,t){return Math.pow(e,t)}))},"gl.floor":function(e){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"floor(".concat(Object(ru.b)(n),")")}),function(e){return Math.floor(e)}))},"gl.round":function(e){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"round(".concat(Object(ru.b)(n),")")}),function(e){return Math.round(e)}))},"gl.ceil":function(e){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"ceil(".concat(Object(ru.b)(n),")")}),function(e){return Math.ceil(e)}))},"gl.sqrt":function(e){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"sqrt(".concat(Object(ru.b)(n),")")}),function(e){return Math.sqrt(e)}))},"gl.smoothstep":xh,"gl.rand":function(e){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(t){var n=(t=t||{}).code||t||"vec2(0.,0.)";return e.flash(),"rand(".concat(Object(ru.b)(n),")")}))},"gl.fwidth":function(e){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"fwidth(".concat(Object(ru.b)(n),")")}))},"gl.ddx":function(e){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"dFdx(".concat(Object(ru.b)(n),")")}))},"gl.ddy":function(e){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"dFdx(".concat(Object(ru.b)(n),")")}))},"gl.distance":function(e,t){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"distance(".concat(Object(ru.b)(r[0]),", ").concat(Object(ru.b)(r[1]),")")},t),function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2),Math.pow(e[0]-t[0],2))}))},"gl.rotate":function(e,t){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"".concat(Object(ru.b)(r[0]),"*rotate2D(").concat(Object(ru.b)(r[1]),")")},t),function(e,t){return Array.isArray(e)?Bo(e[0],e[1],2*Math.PI-t):t}))},"gl.sign":function(e){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"sign(".concat(Object(ru.b)(n),")")}),function(e){return e>=0?1:-1}))},"gl.log":function(e){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"log(".concat(Object(ru.b)(n),")")}),function(e){return Math.log(e)}))},"gl.smoothbetween":function(e,t,n,r){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(a){var i=Object(ou.a)(a,t,n,r).map(ru.b),o=Object(v.a)(i,4),s=o[0],c=o[1],u=o[2],l=o[3];return e.flash(),"smoothstep(".concat(s,", ").concat(s,"+").concat(u,", ").concat(l,") * smoothstep(-").concat(c,", -").concat(c,"+").concat(u,", -").concat(l,") ")},t,n,r),function(e,t,n){var r=Math.max(0,Math.min(1,(n-e)/(t-e)));return r*r*(3-2*r)}))}};function Ph(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Eh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Eh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Eh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("sdf.smoothUnionByList",{list:"",smoothness:"",smoothPower:""},"",function(){return 1},{inlets:3,isHot:!0});var Th=function(e,t,n){return function(r){var a,i=Object(v.a)(r,1)[0],o=ru.a.apply(void 0,Object(h.a)(i).concat([t,n])),s=(o.codes,o.uniforms),c=o.functions,u=o.variables,l="smoothUnion"+e.id.replaceAll("-",""),f={p:"vec2"},d=Ph(i);try{for(d.s();!(a=d.n()).done;){f[a.value.code]="vec2"}}catch(p){d.e(p)}finally{d.f()}c[l]={returnType:"vec3",args:f,body:"\nvec3 scene = vec3(0.0, -1.0, 0.0);\n".concat(Bf(i,"p",i.map(function(e){return 3}),t()||.2,n()||"2.0"),";\nreturn scene;\n          ")};return{type:"float",code:"".concat(l,"(").concat("(1.0*gl_FragCoord.xy-vec2(width, height))/height",",").concat(i.map(function(e){return"vec2(".concat(e.code,", 0.0)")}).join(","),")"),functions:c,uniforms:s,variables:u}}};Object(pi.a)("sdf.smoothUnionByPartitions",{partitionedList:"",smoothness:"",smoothPower:""},"",function(){return 2},{inlets:3,isHot:!0,outlets:["GL SDFs","GL Mixes"]});Object(pi.a)("sdf.sumMixes",{"list of sdf mixes":"","list of sdfs to clamp":""},"",function(){return 1},{inlets:2,type:"float"});var Ah={"sdf.smoothUnionByList":Th,"sdf.smoothUnionByPartitions":function(e,t,n){var r=[];return function(a){var i,o=[],s=[],c=0,u=Ph(Object(v.a)(a,1)[0]);try{for(u.s();!(i=u.n()).done;){var l=i.value,f=r[c]||Th({id:Object(q.uuid)()},t,n);if(r[c]=f,l.length>0){var h=lh(e)([f([l])]),d=h[0];o.push(d),s.push(h[2]),c++}}}catch(p){u.e(p)}finally{u.f()}return[o,s]}},"sdf.sumMixes":function(e,t){return function(n){var r=Object(v.a)(n,1)[0],a=function(t,n){return Zf(e,function(){return t})([xh(e,function(){return-.01},function(){return n})([.2])])},i=t()||new Array(r.length+1).fill(1),o=Kf.apply(void 0,[e].concat(Object(h.a)(r.slice(1).map(function(e,t){return function(){return a(e,i[t+1])}}))))([a(r[0],i[0])]);return o.type="float",[o]}}};function Mh(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Rh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Rh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("sdf.indexOfList",{"sdfs list":"",smooth:""},"Returns the # index of current sdf at pixel",function(){return 1},{type:"float",isHot:!0,inlets:2});var Ch=function(e,t){var n=new ih({sequencerEngine:t,subSequence:t.subSequence,id:t.id,flash:function(e){return 0},newAttribute:function(){return 0}});return function(r){var a=Object(v.a)(r,2),i=(a[0],a[1]),o=e(r);if(o){var s=!1;if(s=Array.isArray(o[0])?"string"===typeof o[0][0]?n.onSDFList([o[0]]):n.onSDFList(o[0]):n.onSDFList(o),n.lastSent){var c=n.lastSent["Merged GL SDF"];return c.type="float",o[0].type=Ou.g,s||i?[o[0],c,n]:[o[0]]}console.log("no last sent",t,o)}}};function Nh(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ih(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ih(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ih(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("sdf.rotateList",{"list of sdf definitions":""},"",function(){return 3},{isHot:!0,inletTypes:"list",outlets:["SDF Definition List","sdf gl","SDF Manager"],type:["list","float","SDF Manager"],inlets:2});var qh={"sdf.rotateList":function(e,t){return Ch(function(e){var n=Object(v.a)(e,1)[0];if(!t())return[n];var r,a=[],i=Nh(n);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=o.id;(o=Object(h.a)(o)).id=s;var c=o,u=Object(v.a)(c,3),l=(u[0],u[1]),f=u[2],d=Bo(l,f,t());o[1]=d[0],o[2]=d[1],a.push(o)}}catch(p){i.e(p)}finally{i.f()}return[a]},e)}};Object(pi.a)("sdf.estimateNormal2D",{"SDF Manager":"",normal:""},"Estimates normal assuming the z coordinate is the SDF",function(){return 1},{inlets:2,inletTypes:[Object(Ou.k)("SDF Manager",Ou.a)],isHot:!0,type:"vec3"});var _h=function(e,t,n){for(var r="",a=0;a<n;a++){var i=t[a%t.length];r+="\nif (index == ".concat(a,".0) {\nreturn ").concat(i.code,";\n}\n")}return r+="\nreturn defaultColor;\n"};Object(pi.a)("sdf.indexedColors",{index:"",colors:"",numColors:""},"",function(){return 1},{inlets:3,isHot:!0});var Dh=function(e,t,n){return function(r){var a=Object(v.a)(r,1)[0],i=t()||[],o=n()||i.length,s=ru.a.apply(void 0,[a].concat(Object(h.a)(i.map(function(e){return function(){return e}})))),c=(s.codes,s.uniforms),u=s.functions,l=s.variables,f="getColor"+e.id.replaceAll("-","");return u[f]={args:{index:"float",defaultColor:"vec4"},returnType:"vec4",body:_h(0,i,o)},{code:f+"(".concat(a.code,", vec4(0.0, 0.0, 0.0, 1.0))"),uniforms:c,functions:u,variables:l,type:"vec4"}}};Object(pi.a)("sdf.light2D",{"sdf manager":"",colors:"","default color":"",samples:"",numColors:"",maxSDF:"",traceIterations:""},"",function(){return 1},{inletTypes:[Object(Ou.k)(Ou.i,Ou.a),Ou.a,"vec4"],inlets:7,isHot:!0,type:"vec4"});var Fh=function(e,t,n,r,a,i,o){return function(e){var s=Object(v.a)(e,1)[0];console.log("MANAGER LIGHT=",s);var c=o()||14,u=t()||[],l=r()||32;console.log("SAMPLES=",l);var f=a()||u.length,p=n()||{code:"vec4(0.0, 0.0, 0.0, 1.0)"},m="sampler2D"===s.type;if(!m&&!s.lastSent&&s.type!==Ou.a)return"";console.log("manager=",s),console.log("manager.type=",s.type);var y=s.type===Ou.a?Object(d.a)({evaluator:s.functionName},s):"sampler2D"===s.type?Object(d.a)({evaluator:s},s):s.lastSent.Evaluator,b=y.evaluator,g=y.functions,O=y.uniforms;g||(g={});var j=Array.isArray(u)?ru.a.apply(void 0,[n,r].concat(Object(h.a)(u.map(function(e){return function(){return e}})))):Object(ru.a)(n,r,function(){return u}),k=u.type===Ou.a,w=u.func&&Object.keys(u.functions).find(function(e){return u.functions[e]===u.func}),x=k?u.functions:{},S=k?u.uniforms:{},P=k&&Object.keys(u.func.args).length,E=mf("gl.vec2ToFloat"),T=mf("gl.texture2D"),A=function(e){return T(b.code,e).code},M=function(e){return m?"vec3((".concat(e,".z == 0.0 ? -1.0 : 1.0)*").concat(E(e,0,i).code,", 0.0, 0.0)"):"".concat(b,"(").concat(e,")")};O=Object(d.a)({},O,j.uniforms);var R,C="sampler2D"===u.type;C||k||(g.getColor={args:{index:"float",defaultColor:"vec4"},returnType:"vec4",body:_h(0,u,f)}),g.trace={returnType:"vec4",args:{p:"vec2",dir:"vec2",defaultColor:"vec4",dist:"vec3"},body:"\n        float iters = ".concat(c,".0;\n        float first = -1.0;\n        for (float j = 0.0; j < iters; j++) {\n          ").concat(m?"vec4 tex = "+A("p")+";":"","\n          vec3 ret = j==0.0 ? dist : ").concat(M(m?"tex":"p"),";\n          float index = ret.y;\n          float d = ret.x;\n          if (d < float(1e-8)) {\n            float term = 1.0;\n            return term*").concat(k?w+(1===P?"(p)":2===P?"(p, ret)":"(p, ret.x, ret.y)"):C?"texture2D("+u.code+", vec2(mod(index, "+f+".0) / "+f+".0, 0.0))":"getColor(index, defaultColor)",";\n          }\n          if (d > float(1e6)) break;\n          p -= dir * d;\n        }\n    return defaultColor;\n")},g.trandom={args:{_st:"vec2"},returnType:"float",body:"\n return fract(sin(dot(_st.xy,\n        vec2(12.9898,78.233)))*\n        43758.5453123);\n"},R="\n    vec2 uv = (1.0*gl_FragCoord.xy-vec2(width, height))/height+vec2(0.0, offset_v);\n    ".concat(m?"uv = ((gl_FragCoord.xy/vec2(width, height))/2.0);":"","\n    vec4 col = ").concat(p.code,";\n    //float iters = 1.0; \n    ").concat(m?"vec4 tex = "+A("uv")+";":"","\n    vec3 ret = ").concat(M(m?"tex":"uv"),";\n    float dist = ret.x;\n    float iters = dist < 0.0 ? 0.1 : max(2.0, min(1.0, 1.0 / pow(dist, .6)));\n    iters = 1.0;\n     \n    for (float i = 0.0; i < iters*").concat(l,".0; i++) {\n        float t = (i + trandom(uv+i)) / ").concat(Object(ru.b)(l)," * 2. * 3.1415;\n        vec4 c = vec4(0.0, 0.0, 0.0, 1.0);\n        vec2 dir = vec2(cos(t), sin(t));\n        col += trace(uv, dir, c, ret);\n    }\n    vec4 x = col / ").concat(Object(ru.b)(l),";\n    x.w = 1.0;\n    return x;\n          "),g.fullTrace={args:{},returnType:"vec4",body:R},g=Object(d.a)({},g,x),O=Object(d.a)({},O,S),console.log("FUNCTIONS returning=",g);return{isHashCode:Object(au.a)(g.trace),code:"fullTrace()",functions:g,uniforms:O,type:"vec4",variables:j.variables,frames:s.frames}}};Object(pi.a)("sdf.halfwayVector",{camera:"",point:"",lightDirection:""},"",function(){return 1},{type:["vec3","vec3","vec3"],inlets:3});var Lh={"sdf.estimateNormal2D":function(e){return e.typed(function(e){var t,n=Object(v.a)(e,1)[0],r=Object(ru.a)(n),a=r.uniforms,i=r.functions,o=r.variables;if(n.type===Ou.a)t=n.functionName;else{if(!n.lastSent)return;t=n.lastSent.Evaluator.evaluator}var s="point_uv_123";return o.point_uv_123={code:"((1.0*gl_FragCoord.xy-vec2(width, height))/height)",type:"vec2"},{code:"normalize(vec3(\n          ".concat(t,"(vec2(").concat(s,".x + EPSILON, ").concat(s,".y)).x - ").concat(t,"(vec2(").concat(s,".x - EPSILON, ").concat(s,".y)).x,\n          ").concat(t,"(vec2(").concat(s,".x, ").concat(s,".y + EPSILON)).x - ").concat(t,"(vec2(").concat(s,".x, ").concat(s,".y - EPSILON)).x,\n          2.0 * EPSILON\n))\n"),functions:i,uniforms:a,variables:o}})},"sdf.light2D":Fh,"sdf.indexedColors":Dh,"sdf.halfwayVector":function(e,t,n){return Object(iu.a)(function(e){var r=Object(ou.a)(e,t,n).map(ru.b),a=Object(v.a)(r,3),i=a[0],o=a[1],s=a[2];return"normalize(normalize(".concat(i," - ").concat(o,") + ").concat(s,")")},t,n)}};Object(pi.a)("sdf.hex",{x:"",y:"",size:"",rotation:""},"Creates a hexagon",function(){return 3},{outlets:["SDF Object","SDF GL","SDF Manager"],inlets:4,isHot:!0});Object(pi.a)("sdf.circle",{x:"",y:"",radius:""},"Creates a hexagon",function(){return 3},{outlets:["SDF Object","SDF GL","SDF Manager"],inlets:3,isHot:!0});Object(pi.a)("sdf.rect",{x:"",y:"",width:"",height:"",round:"",rotation:""},"Creates a hexagon",function(){return 3},{inlets:6,inletTypes:Object(Ou.l)(Ou.h),type:function(){return[Ou.g,Ou.b,Ou.i]},outlets:["SDF Object","SDF GL","SDF Manager"],isHot:!0});Object(pi.a)("sdf.triangle",{x:"",y:"",width:"",height:"",round:"",rotation:""},"Creates a hexagon",function(){return 3},{inlets:6,inletTypes:Object(Ou.l)(Ou.h),type:function(){return[Ou.g,Ou.b,Ou.i]},outlets:["SDF Object","SDF GL","SDF Manager"],isHot:!0});Object(pi.a)("sdf.combine",{list:"list of sdfs","sdf operations":"0-union 1-intersect 2-subtract 3 -smoothunion 4-smooth subtrsact",smoothness:""},"",function(){return 2},{isHot:!0,outlets:["SDF","vec3(sdf,index,mix)"],inlets:3});Object(pi.a)("sdf.lineSegment",{x1:"",y1:"",x2:"",y2:"",ratio:"",lineWidth:""},"Creates a hexagon",function(){return 3},{inlets:6,inletTypes:Object(Ou.l)(Ou.h),type:function(){return[Ou.g,Ou.b,Ou.i]},outlets:["SDF Object","SDF GL","SDF Manager"],isHot:!0});var Bh={"sdf.triangle":function(e,t,n,r,a,i){var o=Object(q.uuid)();return Ch(function(e){var s=Object(v.a)(e,1)[0],c=Array.isArray(s)?s[1]:t()||0,u=["triangle",Array.isArray(s)?s[0]:s,c,n()||.1,r()||.1,a()||0,i()||0];return u.id=o,[u]},e)},"sdf.hex":function(e,t,n,r){var a=Object(q.uuid)();return Ch(function(e){var i=["hexagon",Object(v.a)(e,1)[0],t()||0,n()||.1,n()||.1,0,r()||0];return i.id=a,[i]},e)},"sdf.rect":function(e,t,n,r,a,i){var o=Object(q.uuid)();return Ch(function(e){var s=Object(v.a)(e,1)[0],c=Array.isArray(s)?s[1]:t()||0,u=["rect",Array.isArray(s)?s[0]:s,c,n()||.1,r()||.1,a()||.1,i()||0];return u.id=o,[u]},e)},"sdf.circle":function(e,t,n,r){var a=Object(q.uuid)();return Ch(function(e){var r=Object(v.a)(e,1)[0],i=Array.isArray(r)?r[1]:t()||0,o=["circle",Array.isArray(r)?r[0]:r,i,n()||.1,n()||.1,0,0];return o.id=a,[o]},e)},"sdf.combine":function(e,t,n){var r=new ih({sequencerEngine:e,subSequence:e.subSequence,id:e.id,flash:function(e){return 0},newAttribute:function(){return 0}});return function(e){var a=Object(v.a)(e,1)[0],i=t();i&&r.onSDFOperationList(i),void 0!==n()?(r.smoothness=n(),r.onSDFList(a,!0)):r.onSDFList(a);var o=r.lastSent["Merged GL SDF"];return o.type="float",[o,Object(d.a)({},r.lastSent["vec2(sdf,index)"],{type:"vec3"})]}},"sdf.lineSegment":function(e,t,n,r,a,i){var o=Object(q.uuid)();return Ch(function(e){var s=Object(v.a)(e,1)[0],c=Array.isArray(s)?s[1]:t()||0,u=["lineSegment",Array.isArray(s)?s[0]:s,c,n(),r(),a(),i()||.01];return u.id=o,[u]},e)}},zh=n(150);function Jh(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Vh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Vh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("sdf.circularRect",{count:"the number of rectangles",radius:"the size of the circle to be made up of rectangles",widths:"",heights:"",rounds:"",offsets:""},"",function(){return 3},{isHot:!0,inlets:6,type:function(){return[Ou.g,Ou.b,Ou.i]},outlets:["SDF Object","SDF GL","SDF Manager"]});Object(pi.a)("jaki.leafPoint",{leafNumber:"",radius:"",len:""},"returns leaf point",function(){return 1},{inlets:3});Object(pi.a)("jaki.toCircularList",{},"",function(){return 1},{});Object(pi.a)("jaki.cycleProgress",{tidals:""},"",function(){return 2},{outlets:["progress","leaf number","symbol number"]});Object(pi.a)("jaki.indexToFigure",{index:"",cycles:""},"",function(){return 1},{inlets:2});Object(pi.a)("jaki.figureToIndexRange",{figure:"",cycles:""},"",function(){return 1},{inlets:2});Object(pi.a)("sdf.translate",{"sdf list":"",x:"",y:""},"Translate group of sdfs",function(){return 1},{isHot:!0,inlets:3});Object(pi.a)("sdf.translateYIndex",{"sdf list":"",index:"",y:""},"Translate group of sdfs",function(){return 1},{isHot:!0,inlets:3});Object(pi.a)("sdf.scale",{"sdf list":"",scale:""},"Translate group of sdfs",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("sdf.scaleX",{"sdf list":"",scale:""},"Translate group of sdfs",function(){return 1},{isHot:!0,inlets:2});var Hh={"sdf.translate":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0];if(Array.isArray(r))return void 0===t()||void 0===n()?[r]:[r.map(function(e){if(Array.isArray(e)){var r=Object(h.a)(e);return r[1]+=t(),r[2]+=n(),r}}).filter(function(e){return e})]}},"sdf.scale":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(Array.isArray(n))return void 0===t()?[n]:[n.map(function(e){if(Array.isArray(e)){var n=Object(h.a)(e);return n[1]*=t(),n[2]*=t(),n[3]*=t(),n[4]*=t(),n[5]*=t(),n}}).filter(function(e){return e})]}},"sdf.scaleX":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(Array.isArray(n))return void 0===t()?[n]:[n.map(function(e){if(Array.isArray(e)){var n=Object(h.a)(e);return n[1]*=t(),n.id=e.id,n}}).filter(function(e){return e})]}},"sdf.translateYIndex":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0];if(Array.isArray(r))return void 0===n()||void 0===t()?[r]:[r.map(function(e,r){if(r!==t())return e;if(Array.isArray(e)){var a=Object(h.a)(e);return a[2]+=n(),a.id=e.id,a}}).filter(function(e){return e})]}}},Uh=function(e,t,n,r,a,i,o,s,c,u,l){var f=r(),h=a(),d=i()||.1,p=o()||.1,v=void 0===s()?.1:s(),m=c()||0,y=u()||0;l=void 0===l()?.5:l();for(var b=[],g=Array.isArray(n)?n[0]:n,O=Array.isArray(n)?n[1]:n,j=0;j<g;j++)for(var k=0;k<O;k++){var w=j,x=k,S=Array.isArray(l)?l:void 0===l?[.5,0]:[l,0];k%2===0&&(w+=S[0]),j%2===0&&(x+=S[1]);var P=t+w+"_"+k,E=[e,f+w*(d+(Array.isArray(m)?m[0]:m)),h+x*(p+(Array.isArray(m)?m[1]:m)),d,p,v,y||0];E.id=P,b.push(E)}return[b]};Object(pi.a)("sdf.square3D",{count:"",x:"",y:"",size:"",round:"",spacing:"",angle:"",linewidth:""},"Creates a grid of rectangles",function(){return 1},{inletTypes:Object(Ou.l)(Ou.h),type:function(){return[Ou.g,Ou.b,Ou.i]},outlets:["SDF Object","SDF GL","SDF Manager"],inlets:8,isHot:!0});Object(pi.a)("sdf.gridHex",{count:"",x:"",y:"",size:"",spacing:"",rotation:""},"Creates a hexagon",function(){return 1},{inlets:6,isHot:!0});Object(pi.a)("sdf.fourRect",{x:"",y:"",width:"",height:"",round:"",rotation:"",fullRotation:"",alternateDimensions:""},"Creates 4 rectangles circling the center",function(){return 1},{inletTypes:Object(Ou.l)(Ou.h),type:function(){return[Ou.g,Ou.b,Ou.i]},outlets:["SDF Object","SDF GL","SDF Manager"],inlets:8,isHot:!0});Object(pi.a)("sdf.gridRect",{count:"",x:"",y:"",w:"",h:"",round:"",spacing:"",rotation:"",altOffset:""},"Creates a grid of rectangles",function(){return 1},{inletTypes:Object(Ou.l)(Ou.h),type:function(){return[Ou.g,Ou.b,Ou.i]},outlets:["SDF Object","SDF GL","SDF Manager"],inlets:9,isHot:!0});Object(pi.a)("sdf.gridTriangle",{count:"",x:"",y:"",w:"",h:"",round:"",spacing:"",rotation:"",altOffset:""},"Creates a grid of rectangles",function(){return 1},{inletTypes:Object(Ou.l)(Ou.h),type:function(){return[Ou.g,Ou.b,Ou.i]},outlets:["SDF Object","SDF GL","SDF Manager"],inlets:9,isHot:!0});Object(pi.a)("sdf.indexedScale",{indices:"",scale:"",list:""},"Scales by index",function(){return 1},{inlets:3,isHot:!0});Object(pi.a)("sdf.scaleDimension",{indices:"",scale:"",list:""},"Scale dimension",function(){return 1},{inlets:2,isHot:!0});Object(pi.a)("sdf.setRotation",{sdfList:"",scaleList:"",factor:""},"Set rotation",function(){return 1},{inlets:2,isHot:!0});Object(pi.a)("sdf.scalePosition",{list:"",scaleList:""},"Scale dimension",function(){return 1},{inlets:2,isHot:!0});Object(pi.a)("sdf.setY",{list:"",index:"",y:""},"Scale dimension",function(){return 1},{inlets:3,isHot:!0});Object(pi.a)("sdf.setPosition",{list:"",index:"",coord:""},"Set position of index",function(){return 1},{inlets:3,isHot:!0});Object(pi.a)("sdf.scaleWidth",{list:"",scale:""},"Scale dimension",function(){return 1},{inlets:2,isHot:!0});Object(pi.a)("sdf.scaleHeight",{list:"",scale:""},"Scale dimension",function(){return 1},{inlets:2,isHot:!0});Object(pi.a)("sdf.scaleCorner",{list:"",scale:""},"Scale dimension",function(){return 1},{inlets:2,isHot:!0});Object(pi.a)("sdf.combineGrid",{list:"","combined indices":""},"Combines",function(){return 1},{inlets:2,isHot:!0});Object(pi.a)("sdf.fromPositions",{positions:"",type:"",w:"",h:"",r:""},"Fuck",function(){return 3},{inlets:3,outlets:["SDF List","SDF GL","SDF Manager"]});Object(pi.a)("sdf.extractPoints",{list:"",length:""},"returns list of points",function(){return 1},{inlets:2,isHot:!0});var Gh=Object(d.a)({"sdf.extractPoints":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];return[n.slice(0,t()||n.length).map(function(e){return e.slice(1,3)})]}},"sdf.gridTriangle":function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=Object(q.uuid)().replaceAll("-","");return Ch(function(e){var t=Object(v.a)(e,1)[0];return Uh.apply(void 0,["triangle",a,t].concat(n))},e)},"sdf.fromPositions":function(e,t,n,r,a){var i=[];return Ch(function(e){var o=Object(v.a)(e,1)[0],s=t()||"rect",c=n()||.1,u=r()||c,l=a()||c;i=Object(h.a)(i);for(var f=0;f<o.length;f+=2){var d=o[f],p=o[f+1],m=f/2,y=i[m]||[s,d,p,c,u,l,0],b=y.id;i[m]=Object(h.a)(y),i[m][1]=d,i[m][2]=p,i[m][3]=1*c,i[m][4]=1*u,i[m][5]=1*l,i[m].id=b||Object(q.uuid)()}return[i]},e)},"sdf.gridHex":function(e,t,n,r,a,i){Object(q.uuid)().replaceAll("-","");return function(e){for(var o=Object(v.a)(e,1)[0],s=[],c=t(),u=n(),l=r()||0,f=a()||0,h=0;h<o;h++)for(var d=0;d<o;d++){var p=h;d%2===0&&(p+=.5);var m=["hexagon",c+p*(l+f),u+d*(l+f),l,l,0,i()||0];s.push(m)}return[s]}},"sdf.gridRect":function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=Object(q.uuid)().replaceAll("-","");return Ch(function(e){var t=Object(v.a)(e,1)[0];return Uh.apply(void 0,["rect",a,t].concat(n))},e)},"sdf.fourRect":function(e,t,n,r,a,i,o,s){var c=Object(q.uuid)().replaceAll("-","");return Ch(function(e){var u=Object(v.a)(e,1)[0],l=t(),f=n()||.1,h=r()||.1,d=a()||.1,p=i()||0,m=[p,p+.5*Math.PI,p,p+.5*Math.PI],y=[u,-u,-u,u],b=[l,l,-l,-l],g=[f,h,f,h],O=[h,f,h,f];s()&&(g=[f,f,f,f],O=[h,h,h,h]);for(var j=[],k=0;k<4;k++){var w=Bo(y[k],b[k],o()||0),x=Object(v.a)(w,2),S=["rect",x[0],x[1],O[k],g[k],d,m[k]];S.id=c+"_"+k,j.push(S)}return[j]},e)},"sdf.setY":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0];if(void 0!==t()&&void 0!==n()){var a=Object(h.a)(r),i=a[t()];return i[2]=n(),i.id=r[t()].id,[a]}}},"sdf.setPosition":function(e,t,n){var r=void 0;return function(e){var a=Object(v.a)(e,1)[0];if(r=a.map(function(e){return Object(h.a)(e)}),void 0===t()||void 0===n())return[a];if("clear"===n())return[Object(h.a)(r)];var i=Object(h.a)(a),o=Object(h.a)(i[t()]);return o[1]=n()[0],o[2]=n()[1],o.id=a[t()].id,i[t()]=o,[i]}},"sdf.combineGrid":function(e,t){var n=[];return Ch(function(e){var r=Object(v.a)(e,1)[0];if(t()){for(var a=Object(h.a)(r),i=function(e){var i=t().slice(e,e+2),o=Object(v.a)(i,2),s=o[0],c=o[1],u=a[s],l=a[c],f=Object(v.a)(u,7),h=f[0],d=f[1],p=f[2],m=f[3],y=f[4],b=f[5],g=(f[6],Object(v.a)(l,7)),O=(g[0],g[1]),j=g[2],k=(g[3],g[4],g[5],g[6],d-O),w=p-j;O>d&&(k=O-d,w=j-p);var x=[h,(d+O)/2,(p+j)/2,2*m,y,b,Math.PI-Math.atan2(w,k)];x.id=n[e]||Object(q.uuid)(),n[e]=x.id;var S=(r=r.filter(function(e){return e!==l})).indexOf(u);r[S]=x},o=0;o<t().length;o+=2)i(o);return[r]}},e)},"sdf.indexedScale":function(e,t,n){return function(e){for(var r=Object(v.a)(e,1)[0],a=Object(h.a)(r),i=0;i<n().length;i++)if(n()[i]){var o=Object(h.a)(a[i]);o[3]*=t(),o[4]*=t(),o[5]*=t(),o.id=a[i].id,a[i]=o}return[a]}},"sdf.scaleDimension":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(null===t())return[n];for(var r=Object(h.a)(n),a=0;a<n.length;a++){var i=Object(h.a)(r[a]),o=Array.isArray(t())?t()[a%t().length]:t();i[3]*=o,i[4]*=o,i[5]*=o,i.id=r[a].id,r[a]=i}return[r]}},"sdf.scaleWidth":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(t()){var r=t();Array.isArray(r)||(r=[r]);for(var a=Object(h.a)(n),i=0;i<n.length;i++)if(a[i]&&Array.isArray(a[i])){var o=Object(h.a)(a[i]);o[3]*=r[i%r.length],o.id=a[i].id,a[i]=o}return[a]}}},"sdf.scaleCorner":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(t()){var r=t();Array.isArray(r)||(r=[r]);for(var a=Object(h.a)(n),i=0;i<n.length;i++)if(a[i]&&Array.isArray(a[i])){var o=Object(h.a)(a[i]);o[5]*=r[i%r.length],o.id=a[i].id,a[i]=o}return[a]}}},"sdf.setRotation":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0];if(null===t())return[r];for(var a=void 0===n()?Math.PI:n(),i=Object(h.a)(r),o=0;o<r.length;o++){var s=Object(h.a)(i[o]),c=Array.isArray(t())?t()[o%t().length]:t();s[6]=c*a,s.id=i[o].id,i[o]=s}return[i]}},"sdf.scaleHeight":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(t()){var r=t();Array.isArray(r)||(r=[r]);for(var a=Object(h.a)(n),i=0;i<n.length;i++)if(a[i]&&Array.isArray(a[i])){var o=Object(h.a)(a[i]);o[4]*=r[i%r.length],o.id=a[i].id,a[i]=o}return[a]}}},"sdf.scalePosition":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(t()){var r=t();Array.isArray(r)||(r=[r]);for(var a=Object(h.a)(n),i=0;i<n.length;i++)if(a[i]&&Array.isArray(a[i])){var o=Object(h.a)(a[i]);o[1]*=r[i%r.length],o[2]*=r[i%r.length],o.id=a[i].id,a[i]=o}return[a]}}},"sdf.circularRect":function(e,t,n,r,a,i){var o=void 0;return Ch(function(e){var s=Object(v.a)(e,1)[0],c=i()||[0,0];if(Array.isArray(c)||(c=[c,c]),n()&&Array.isArray(n())&&n().length>s&&(s=n().length),!o){o=[];for(var u=0;u<Math.max(16,2*s);u++)o[u]=Object(q.uuid)()}var l=t()||5,f=n()?Array.isArray(n())?n():[n()]:new Array(s).fill(1),d=r()?Array.isArray(r())?r():[r()]:new Array(s).fill(1),p=Object(h.a)(a()||new Array(s).fill(1));Array.isArray(d)||(d=[d]);for(var m=f.length;m<s;m++)f[m]=f[m%n().length];for(var y=d.length;y<s;y++)d[y]=d[y%r().length];for(var b=p.length;b<s;b++)p[b]=p[b%a().length];for(var g=2*Math.PI*l,O=f.reduce(function(e,t){return t>1?e+t+2:e+t},0),j=f.reduce(function(e,t){return e+t},0),k=.25*g/O,w=[],x=0,S=0;S<s;S++){var P=o[S]||Object(q.uuid)();o[S]=P;var E=l;f[S]>1&&(8===f[S]?x+=3.5:x+=Math.log2(f[S])-.5);var T=2*(x+0)*Math.PI/j,A=Bo(0,E,T),M=Object(v.a)(A,2),R=M[0],C=M[1];f[S];var N=f[S];2===N&&(N=3),isNaN(R)&&(R=0),isNaN(C)&&(C=0),isNaN(k)&&(k=.1),isNaN(N)&&(N=1),isNaN(T)&&(T=0);var I=N*k;isNaN(I)&&(I=.1);var _=d[S],D=p[S],F=1;4===f[S]&&(F*=2,I*=2);var L=["rect",R+c[0],C+c[1],I,F*_*k,F*D*k,T];L.id=P,w.push(L),f[S]>1&&(8===f[S]?x+=3.5:x+=Math.log2(f[S])-.5),x++}for(var B=s;B<o.length;B++){var z=f[B]*k;isNaN(z)&&(z=.01);var J=["rect",100,100,z,k,k,0];J.id=o[B],w.push(J)}return[w]},e)},"jaki.toCircularList":function(e){var t,n=void 0;return function(e){var r=Object(v.a)(e,1)[0][0].cycle;if(n&&Object(zh.e)(r)===Object(zh.e)(n))return t;n=r;for(var a=[],i=0;i<r.length;i++)if(Array.isArray(r[i]))a.push(r[i].cycleLength);else{if(!r[i].type)return;var o=r[i].type,s=o.type,c=(o.value,r[(i+1)%r.length]);"."===s?a.push(1):"-"===s&&c&&c.type&&1===c.type.value&&a.push(2)}return t=[a],[a]}},"jaki.leafPoint":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0],a=n(),i=t(),o=r%a*2*Math.PI/a,s=Bo(0,i,o),c=Object(v.a)(s,2);return[[c[0],c[1]]]}},"jaki.cycleProgress":function(e){return function(e){var t=Object(v.a)(e,1)[0][0];if(t){var n,r=t.lastLeaf;if(r){for(var a=-1,i=0,o=0;o<=t.cycle.length;o++){var s=t.cycle[o],c=s;if(s)if(Array.isArray(s)){a++;var u,l=!1,f=Jh(s);try{for(f.s();!(u=f.n()).done;){if(u.value.id===r.id){l=!0;break}i++}}catch(d){f.e(d)}finally{f.f()}if(l)break}else{if(s.type&&"."===s.type.type?a++:s.type&&0===s.type.value&&a++,c.id===r.id)break;i++}}n=i;var h=t.cycleLength/2;return isNaN(n)?void 0:[n/h,n,a]}}}},"jaki.indexToFigure":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];Array.isArray(n)&&(n=n[0]);var r=t();if(r){for(var a=r[0].cycle,i=0,o=0,s=a[0].figureId,c=0;c<a.length;c++){var u=a[c];if(u){if(s!==u.figureId&&o++,s=u.figureId,u.type&&"."===u.type.type?i===n:i===n+1)return[o];if(Array.isArray(u)){var l,f=Jh(u);try{for(f.s();!(l=f.n()).done;)l.value.figureId!==s&&o++,s=u.figureId}catch(h){f.e(h)}finally{f.f()}i++}else u.type&&"."===u.type.type?i++:u.type&&0===u.type.value&&i++}}return[-1]}}},"jaki.figureToIndexRange":function(e,t){return function(e){var n=Object(v.a)(e,1)[0],r=t();if(r){for(var a=r[0].cycle,i=0,o=0,s=a[0].figureId,c=void 0,u=void 0,l=0;l<a.length;l++){var f=a[l];if(f){if(s!==f.figureId&&o++,o===n&&void 0===c&&(c=i),o===n+1&&void 0===u){u=i;break}s=f.figureId,Array.isArray(f)?i++:f.type&&"."===f.type.type?i++:f.type&&0===f.type.value&&i++}}return void 0===u&&(u=i),[[c,u]]}}},"sdf.square3D":function(e,t,n,r,a,i,o,s){var c=Object(q.uuid)().replaceAll("-","");return Ch(function(e){for(var u=Object(v.a)(e,1)[0],l=function(e,t,n,r,a,i,o,s){for(var c=r(),u=a(),l=i()||.1,f=o()||.1,h=void 0===s()?.1:s(),d=[],p=0;p<n;p++){var v=t+p,m=[e,c,u,l,f,h,0];m.id=v,d.push(m)}return[d]}("rect",c,u,t,n,r,r,a)[0],f=t(),h=n(),d=0;d<u;d++){var p=f+i()*d*Math.cos(o()),m=h+i()*d*Math.sin(o());l[d][1]=p,l[d][2]=m,l[d][7]=s()||.01}return[l]},e)}},Hh),Wh=Object(d.a)({},Bh,yh,Ah,{"sdf.indexOfList":function(e,t){return function(n){var r=Object(v.a)(n,1)[0];r=Object(h.a)(r).reverse();for(var a=ru.a.apply(void 0,[t].concat(Object(h.a)(r))),i=a.functions,o="indexOfList"+e.id.replaceAll("-",""),s={},c=t()?t().code:"0.4",u="\n  float _minSDF = 100000.0;\n  float _minIndex = -1.0;\n  float dist = 0.0;\n  float _sdfIndex = -1.0;\n  float len = 0.0;\n",l=0;l<r.length;l++)u+="\n  if (".concat(r[l].code," > 0.0 && ").concat(r[l].code," < ").concat(c,") {\n  dist += smoothstep(").concat(c,", -").concat(c,", ").concat(r[l].code,");\n  len++;\n  }\n  if (").concat(r[l].code," < 0.0 && ").concat(r[l].code," > -").concat(c,") {\n  dist += smoothstep(").concat(c,", -").concat(c,", ").concat(r[l].code,");\n  len++;\n  }\n  if (").concat(r[l].code," < 0.0) {\n    _sdfIndex = ").concat(l,".0;\n  }\n  if (").concat(r[l].code," < _minSDF) {\n    _minSDF = ").concat(r[l].code,";\n    _minIndex = ").concat(l,".0;\n  }\n");u+="\nif (_sdfIndex == -1.0) {\n_sdfIndex = _minIndex;\n}\n",u+="return _sdfIndex + max(0.01, dist/(len));";var f,p=Mh(r);try{for(p.s();!(f=p.n()).done;)s[f.value.code]="float"}catch(y){p.e(y)}finally{p.f()}i[o]={returnType:"float",args:s,body:u};var m="".concat(o,"(").concat(r.map(function(e){return e.code}).join(","),")");return Object(d.a)({},a,{code:m,type:"float"})}}},qh,Lh,{"sdf.positionTexture":function(e){var t=16,n=gl(0,function(){return t},function(){return 1});return function(e){var r,a=[],i=jh(Object(v.a)(e,1)[0]);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=(o[1]+1)/2,c=(o[2]+1)/2,u=o[3],l=o[4];a.push(wh(s)),a.push(wh(c)),a.push(wh(u)),a.push(wh(l))}}catch(f){i.e(f)}finally{i.f()}return t=a.length/4,n([a])}}},ph,Gh,{"sdf.lazyUnionList":Oh,"sdf.lazySmoothUnionList":function(e,t,n){return e.needsHotReload=!0,function(r){var a=Object(v.a)(r,1)[0],i=a.map(function(e){return e.lastSent&&e.lastSent.Evaluator}).filter(function(e){return e}).map(function(e){return e.evaluator}),o=ru.a.apply(void 0,Object(h.a)(a.filter(function(e){return e.lastSent}).map(function(e){return e.lastSent.Evaluator})).concat([t,n])),s=o.functions,c=o.uniforms,u=(o.closures,o.variables),l=(t()?t().code:void 0)||"0.1",f=(n()?n().code:void 0)||"2.0",d="lazySmoothUnion"+e.id.replaceAll("-",""),p="\nvec3 scene = vec3(10000.0, -1.0, 0.0);\n";console.log("evaluators=",i);for(var m=0;m<i.length-1;m++)p+=0===m?If(i[m+1]+"(p).xy",i[m]+"(p).xy",l,m,f,m,i.length,Object(ru.b)(m)):If("scene",i[m+1]+"(p).xy",l,m,f,m,i.length,Object(ru.b)(m));return p+="\nreturn scene;\n",s[d]={args:{p:"vec2"},returnType:"vec3",body:p},{type:Ou.a,functions:s,functionName:d,func:s[d],codeEvaluator:function(e){return"".concat(d,"(").concat(e,")")},uniforms:c,variables:u}}},"sdf.lazyUnion":function(e){var t=Oh(e);return e.typed(function(e){var n=Object(v.a)(e,1)[0];return t([[n]])})},"sdf.repeatLimited":function(e,t,n,r){return e.typed(Object(iu.a)(function(e){var a=Object(ou.a)(e,t,n,r).map(ru.b),i=Object(v.a)(a,4),o=i[0],s=i[1],c=i[2],u=i[3];return"".concat(o,"-").concat(s,"*clamp(round(").concat(o,"/").concat(s,"),vec2(").concat(c,"),vec2(").concat(u,"))")},t,n,r))}});Object(pi.a)("gl.alpha",{color:"",alpha:""},"Sets alpha channel of color to argument",function(){return 1},{inletTypes:["vec4","float"],type:function(){return"float"},isHot:!0,inlets:2});Object(pi.a)("gl.black",{},"Sets alpha channel of color to argument",function(){return 1},{type:"vec4",isHot:!0,inlets:0});Object(pi.a)("gl.white",{},"Sets alpha channel of color to argument",function(){return 1},{type:"vec4",isHot:!0,inlets:0});Object(pi.a)("gl.red",{},"Sets alpha channel of color to argument",function(){return 1},{type:"vec4",isHot:!0,inlets:0});Object(pi.a)("gl.green",{},"Sets alpha channel of color to argument",function(){return 1},{type:"vec4",isHot:!0,inlets:0});Object(pi.a)("gl.blue",{},"Sets alpha channel of color to argument",function(){return 1},{type:"vec4",isHot:!0,inlets:0});Object(pi.a)("gl.rgb2hsl",{"rgb vec3":""},"Returns a vec3 of hsl representation of rgb vec3 passed in",function(){return 1},{inlets:1});Object(pi.a)("gl.hsl2rgb",{"hsl vec3":""},"Returns a vec3 of rgb representation of hsl vec3 passed in",function(){return 1},{inlets:1});Object(pi.a)("gl.color",{hexColor:""},"Converts hex color into vec4 with uniforms",function(){return 1},{type:function(){return"vec4"},connects:{object:"gl.fragColor"}});var Kh=function(e){e.needsHotReload=!0;var t,n,r,a={};return function(i,o){var s=Object(v.a)(i,1)[0];if("start"!==s){s.slice&&7===s.length||(s="#000000");var c=(s=s.slice(1)).slice(0,2),u=s.slice(2,4),l=s.slice(4,6),f=(s.slice(6,8),[parseInt(c,16)/255,parseInt(u,16)/255,parseInt(l,16)/255]),h=a.r||su(e,function(){return"color"});a.r=h;var p=h([[].concat(f,["1.0"])]);p&&(n=p.code,t=p.uniforms,!0);var m="".concat(n),y={code:m,hashCode:Object(au.a)(m),variables:{},functions:{},type:"vec4",uniforms:Object(d.a)({},t)};return o||!r?(r=!0,[y]):void 0}}};Object(pi.a)("gl.hueShift",{color:"","shift amount":""},"Shifts color's saturation by a given amount",function(){return 1},{inletTypes:["vec4","float"],type:function(){return"vec4"},isHot:!0,inlets:2});Object(pi.a)("gl.saturationShift",{color:"","shift amount":""},"Shifts color's saturation by a given amount",function(){return 1},{inletTypes:["vec4","float"],type:function(e){return"vec4"},isHot:!0,inlets:2});Object(pi.a)("gl.lightShift",{color:"","shift amount":""},"Shifts color's saturation by a given amount",function(){return 1},{inletTypes:["vec4","float"],type:function(){return"vec4"},isHot:!0,inlets:2});Object(pi.a)("gl.colorSwapRG",{color:"vec4",swap:"float"},"Conditionally swaps the R and G values in the vec4 passed in left-inlet, when 2nd inlet is 1.",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("gl.colorSwapRB",{color:"vec4",swap:"float"},"Conditionally swaps the R and B values in the vec4 passed in left-inlet, when 2nd inlet is 1.",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("gl.colorSwapGB",{color:"vec4",swap:"float"},"Conditionally swaps the G and B values in the vec4 passed in left-inlet, when 2nd inlet is 1.",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("gl.palette",{number:"",factor:"",color1:"",color2:"",color3:"",color4:""},"",function(){return 1},{isHot:!0,inletTypes:["float","float","vec4","vec4","vec4","vec4"],type:"vec4",inlets:6});var Qh={"gl.palette":function(e,t,n,r,a,i){return e.typed(Object(iu.a)(function(e){var o=Object(ou.a)(e,t,n,r,a,i).map(ru.b),s=Object(v.a)(o,6),c=s[0],u=s[1],l=s[2],f=s[3],h=s[4],d=s[5];return"(".concat(l," + ").concat(f,"*cos(").concat(u,"*2.*PI*(").concat(h,"*").concat(c,"+").concat(d,")))")},t,n,r,a,i))},"gl.hueShift":function(e,t){return e.needsHotReload=!0,Object(ju.a)(function(e){var n=Object(v.a)(e,1)[0],r=Object(ru.a)(n,t),a=r.codes,i=(r.feedback,r.closure),o=r.uniforms,s=r.variables,c=r.functions;return c.hueShiftFunc={args:{color:"vec4",shift:"float"},returnType:"vec4",body:"\n        vec3 hsl = rgb2hsl(vec3(color.x, color.y, color.z));\n        vec3 sRGB = hsl2rgb(vec3(mod(hsl.x + shift, 1.0), hsl.y, hsl.z ));\n        return vec4(sRGB.x, sRGB.y, sRGB.z, color.w);\n"},t&&void 0!==t()&&(s=Object(d.a)({},s,t().variables),o=Object(d.a)({},o,t().uniforms)),n&&(o=Object(d.a)({},o,n.uniforms),s=Object(d.a)({},s,n.variables)),{code:"(hueShiftFunc(".concat(Object(ru.b)(a[0]),", ").concat(Object(ru.b)(a[1]),"))"),type:"vec4",functions:c,closure:i,frames:n.frames,uniforms:o,variables:s}},e,t)},"gl.lightShift":function(e,t){return e.needsHotReload=!0,Object(ju.a)(function(e){var n=Object(v.a)(e,1)[0],r=Object(ru.a)(n,t),a=r.codes,i=(r.closure,r.uniforms),o=r.variables,s=r.functions;return s.lightShiftFunc={args:{color:"vec4",shift:"float"},returnType:"vec4",body:"\n        vec3 hsl = rgb2hsl(vec3(color.x, color.y, color.z));\n        vec3 sRGB = hsl2rgb(vec3(hsl.x, hsl.y, clamp(hsl.z + shift, 0.0, 1.0)));\n        return vec4(sRGB.x, sRGB.y, sRGB.z, color.w);\n"},t&&void 0!==t()&&(o=Object(d.a)({},o,t().variables),i=Object(d.a)({},i,t().uniforms)),n&&(i=Object(d.a)({},i,n.uniforms),o=Object(d.a)({},o,n.variables)),{code:"(lightShiftFunc(".concat(Object(ru.b)(a[0]),", ").concat(Object(ru.b)(a[1]),"))"),type:"vec4",functions:s,uniforms:i,variables:o}},e,t)},"gl.saturationShift":function(e,t){return e.needsHotReload=!0,Object(ju.a)(Object(iu.a)(function(e){var n=Object(ou.a)(e,t),r="rgb2hsl(vec3(".concat(Object(ru.b)(n[0]),".x, ").concat(Object(ru.b)(n[0]),".y, ").concat(Object(ru.b)(n[0]),".z))"),a="hsl2rgb(vec3((".concat(r,").x, min((").concat(r,").y + ").concat(Object(ru.b)(n[1]),", 1.0), (").concat(r,").z))");return"vec4(".concat(a,", (").concat(n[0],").w)")},t),e,t)},"gl.hsl2rgb":function(e){return e.needsHotReload=!0,Object(iu.a)(function(e){var t=Object(ou.a)(e);return"hsl2rgb(".concat(Object(ru.b)(t[0]),")")})},"gl.rgb2hsl":function(e){return e.needsHotReload=!0,Object(iu.a)(function(e){var t=Object(ou.a)(e);return"rgb2hsl(".concat(Object(ru.b)(t[0]),")")})},"gl.color":Kh,"gl.colorSwapRG":function(e,t){return Object(iu.a)(function(e){var n=Object(ou.a)(e,t),r=Object(v.a)(n,2),a=r[0],i=r[1];return a=Object(ru.b)(a),i=Object(ru.b)(i),"((".concat(i,") == 1.0 ? \n    vec4(").concat(a,".g, ").concat(a,".r, ").concat(a,".b, ").concat(a,".a) : ").concat(a,")")},t)},"gl.colorSwapGB":function(e,t){return Object(iu.a)(function(e){var n=Object(ou.a)(e,t),r=Object(v.a)(n,2),a=r[0],i=r[1];return a=Object(ru.b)(a),i=Object(ru.b)(i),"((".concat(i,") == 1.0 ? \n    vec4(").concat(a,".r, ").concat(a,".b, ").concat(a,".g, ").concat(a,".a) : ").concat(a,")")},t)},"gl.colorSwapRB":function(e,t){return Object(iu.a)(function(e){var n=Object(ou.a)(e,t),r=Object(v.a)(n,2),a=r[0],i=r[1];return a=Object(ru.b)(a),i=Object(ru.b)(i),"((".concat(i,") == 1.0 ? \n    vec4(").concat(a,".b, ").concat(a,".g, ").concat(a,".r, ").concat(a,".a) : ").concat(a,")")},t)},"gl.alpha":function(e,t){return e.needsHotReload=!0,Object(ju.a)(Object(iu.a)(function(e){var n=Object(ou.a)(e,t),r=Object(v.a)(n,2),a=r[0],i=r[1];return"vec4(".concat(a,".r, ").concat(a,".g, ").concat(a,".b, ").concat(Object(ru.b)(i),")")},t),e,t)},"gl.black":function(e,t){return e.needsHotReload=!0,e.needsLoad=!0,Object(ju.a)(Object(iu.a)(function(){return"vec4(0.0, 0.0, 0.0, 1.0)"},t),e)},"gl.white":function(e,t){return e.needsHotReload=!0,e.needsLoad=!0,Object(ju.a)(Object(iu.a)(function(){return"vec4(1.0, 1.0, 1.0, 1.0)"},t),e,t)},"gl.red":function(e,t){return e.needsHotReload=!0,e.needsLoad=!0,Object(ju.a)(Object(iu.a)(function(){return"vec4(1.0, 0.0, 0.0, 1.0)"},t),e,t)},"gl.green":function(e,t){return e.needsHotReload=!0,e.needsLoad=!0,Object(ju.a)(Object(iu.a)(function(){return"vec4(0.0, 1.0, 0.0, 1.0)"},t),e,t)},"gl.blue":function(e,t){return e.needsHotReload=!0,e.needsLoad=!0,Object(ju.a)(Object(iu.a)(function(){return"vec4(0.0, 0.0, 1.0, 1.0)"},t),e,t)}};function Zh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Yh=function(e){Object(u.a)(n,e);var t=Zh(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e))._color="#000000",r.newOutlet("color"),r.newOutlet("gl color","vec4"),r.glColor=Kh(Object(c.a)(r)),r}return Object(s.a)(n,[{key:"color",get:function(){return this._color},set:function(e){this._color=e,this.sequencerEngine.isLoading?this.sendMessage("gl color",this.glColor([this._color],!0)[0]):this.glColor([e]),this.sendMessage("color",e),this.zObject.onValueChange(e)}},{key:"refresh",value:function(){this.sendMessage("gl color",this.glColor([this._color],!0)[0])}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{color:this.color})}},{key:"fromJson",value:function(e,t){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.color=e.color}},{key:"interpolate",value:function(e,t,n){var r=[parseInt(e.color.slice(1,3),16),parseInt(e.color.slice(3,5),16),parseInt(e.color.slice(5,7),16)],a=r[0],i=r[1],o=r[2],s=[parseInt(t.color.slice(1,3),16),parseInt(t.color.slice(3,5),16),parseInt(t.color.slice(5,7),16)],c=s[0],u=s[1],l=s[2],f=[Math.round(a*n+c*(1-n)),Math.round(i*n+u*(1-n)),Math.round(o*n+l*(1-n))].map(function(e){return e.toString(16)}).map(function(e){return 1===e.length?"0"+e:e});this._color="#"+f[0]+f[1]+f[2],this.sendMessage("color",this._color),this.glColor([this._color])}}]),n}(Ni.a);function $h(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Xh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Xh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ed(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var td=function(e){Object(u.a)(n,e);var t=ed(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e)).innerPatch=new pf(i.subSequence,i.sequencerEngine,i.zObject,"composite"),i.objects=[],i.baseObject=i.innerPatch.createZObject(0,0,r),i.connectObjects(i.baseObject,a),i.newOutlet("output"),i}return Object(s.a)(n,[{key:"connectObjects",value:function(e,t){var n=this,r=0,a=Object.keys(this.baseObject.inlets);a=[a[a.length-1]].concat(Object(h.a)(a.slice(0,a.length-1)));var i,o=$h(t);try{for(o.s();!(i=o.n()).done;){var s=i.value,c=s.object,u=s.outlet;(c=this.innerPatch.createZObject(0,0,c)).composite=this.zObject,this.baseObject.connectInlet(a[r],c.effect,u),c.effect.refresh(),this.objects.push(c),r++}}catch(l){o.e(l)}finally{o.f()}this.baseObject.sendMessage=function(e,t){n.sendMessage("output",t)}}},{key:"consumeBaseMessage",value:function(e){var t=Object.keys(this.baseObject.inlets);this.baseObject.onArg(t.length-1,e)}},{key:"refresh",value:function(){this.objects.forEach(function(e){return e.refresh()})}},{key:"fromJson",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];if((t=Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this)).call.apply(t,[this,e].concat(a)),e.objects){var o,s=0,c=$h(e.objects);try{for(c.s();!(o=c.n()).done;){var u=o.value;this.objects[s].fromJson(u),s++}}catch(l){c.e(l)}finally{c.f()}}}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{objects:this.objects.map(function(e){return e.getJson()})})}}]),n}(Ni.a);Object(pi.a)("gl.mixColors",{"mix amount":""},"",function(){return 0},{inletTypes:["float"],type:"vec4",inlets:1});var nd={"gl.mixColors":function(e){e.isComposite=!0;var t=new td(e,"gl.mix",[{object:"color",outlet:"gl color"},{object:"color",outlet:"gl color"}]);return function(e){t.consumeBaseMessage(e)}}};Object(pi.a)("gl.water.lightWave",{ro:"",rd:"",d:"",time:"",waterHeight:"",iChannel0:"",iChannel1:"",iChannel2:""},"",function(){return 1},{isHot:!0,type:"vec4",inlets:8});Object(pi.a)("gl.water.rd",{ro:""},"",function(){return 1},{type:"vec3",inletTypes:["vec3"],inlets:1});Object(pi.a)("gl.water.intersectWave",{ro:"",rd:"",waveHeight:""},"Cast ray directly onto plane (no raymarching)",function(){return 1},{isHot:!0,inletTypes:["vec3","vec3","float"],type:"float",inlets:3});var rd={"gl.water.intersectWave":function(e,t,n){return e.typed(Object(iu.a)(function(e){var r=Object(ou.a)(e,t,n).map(ru.b),a=Object(v.a)(r,3),i=a[0],o=a[1],s=a[2];return"((".concat(i,".y - ").concat(s,") / -").concat(o,".y)")},t,n))},"gl.water.lightWave":function(e,t,n,r,a,i,o,s){return function(e){var c=Object(v.a)(e,1)[0],u=Object(ru.a)(c,t,n,a,r,i,o,s),l=u.codes,f=u.frames,h=(u.closure,u.uniforms),d=u.functions,p=u.variables,m=l.map(ru.b),y=Object(v.a)(m,8),b=y[0],g=y[1],O=y[2],j=y[3],k=y[4],w=y[5],x=y[6],S=y[7];return j=j||.125,d.wave={returnType:"float",args:{p:"vec3",t:"float"},body:"\n #define T(x,y) texture2D(".concat(S,", mod((p.xz + vec2(x,y)*t) / 30., 1.0)).rgb\n\tvec3 c1 = T(2., 2.);\n\tvec3 c2 = T(2.52, 5.);\n\tvec3 c3 = T(3.32, 9.);\n   #undef T\n\tc1 += c2 - c3;\n\tfloat z = (c1.x + c1.y + c1.z) / 12.;\n\treturn p.y + z;\n")},d.normWave={returnType:"vec3",args:{p:"vec3",t:"float"},body:"\n\tconst vec2 e = vec2(.25,0);\n\treturn normalize(vec3(\n\t\twave(p + e.xyy, t),\n\t\twave(p + e.yxy, t),\n\t\twave(p + e.yyx, t))\n      - wave(p, t)\n\t);\n"},d.lightWave={returnType:"vec4",args:{ro:"vec3",rd:"vec3",d:"float",t:"float"},body:"\n    float waveHeight = ".concat(j,";\n    vec3 p = ro + rd * d; // hit point on plane\n    float sh = wave(p, t) - .5*waveHeight; //.25; // wave height variation\n    p.xz += 2. * sh * rd.xz; // bump offset, parallax mapping - subtle\n    sh = wave(p, t) - .5*waveHeight; //.25; // reeval height after bump offset\n\tvec3 n = normWave(p,t) // surface normal\n\t, l1 = normalize(vec3(1.0)); // main parallel light ('sun')\n\tfloat nv = dot(rd, n)\n\t, spc = pow(max(0., dot(reflect(l1, n), rd)), 30.) // sun specular\n    , eta = 1.003/1.3 // air vs. water\n    , waterdepth = 4.; //+ sh\n    vec3 rfd = refract(rd, n, eta);  // refract view direction\n    float depthest = -waterdepth / rfd.y; // water depth estimate along refracted path\n\tvec3 ref = texture2D(").concat(w,", reflect(rd, n).xy).rgb // reflection environment cubemap\n    , rfa = texture2D(").concat(x,", (p + rfd*depthest).xz / 6.).rgb; // regular refraction\n   \n    ref *= .5;\n    rfa *= exp2(-.125 * depthest); // extinct by water depth estimate\n    vec3 xxx = rfa + ref + spc;\n    return vec4(xxx.x,xxx.y,xxx.z, 1.0); // sum all light - in wrong gamma\n")},{code:"lightWave(".concat(b,", ").concat(g,", ").concat(O,", ").concat(k,")"),uniforms:h,functions:d,variables:p,frames:f,type:"vec4"}}},"gl.water.rd":function(e,t){return function(e){var t=Object(v.a)(e,1)[0],n=Object(ru.a)(t),r=n.codes,a=n.closure,i=n.frames,o=n.uniforms,s=n.functions,c=n.variables,u=Object(v.a)(r,1)[0];return s.water_rd={args:{ro:"vec3"},returnType:"vec3",body:"\nvec2 p = gl_FragCoord.xy;\nvec2 r = vec2(width*2.0, height*2.0);\nvec2 q = (p + p - r) * .5/r.y; // signed aspect-correct uv\nvec3 rc = vec3(0); // look at point, spins around\nvec3 ww = normalize(rc - ro)\n\t, uu = normalize(cross(vec3(0,1,0), ww))\n\t, vv = normalize(cross(ww, uu));\n\treturn normalize(uu * q.x + vv * q.y + ww);\n"},{code:"water_rd(".concat(u,")"),functions:s,closure:a,uniforms:o,variables:c,frames:i,type:"vec3"}}}};Object(pi.a)("texture.fromList",{list:"",elementSize:""},"Returns a texture with size [length , 1] from a list. \nThe data will be stored in the x-component of each texel.\n",function(){return 1},{inletTypes:["list"],inlets:2,type:"sampler2D"});Object(pi.a)("texture.fromColorList",{list:""},"Returns a texture with size [length , 1] from a list. \nThe data will be stored in the x-component of each texel.\n",function(){return 1},{inletTypes:["list"],type:"sampler2D"});var ad={"texture.fromList":function(e,t){var n=16,r=gl(0,function(){return n},function(){return 1}),a=su(e,function(){return"texture_list"}),i=void 0;return function(e,o){var s=Object(v.a)(e,1)[0],c=t()||1;s&&void 0!==s.length||(s=[0]),n=s.length/c;for(var u=[],l=0;l<s.length;l+=c){for(var f=0;f<c;f++)u.push(s[l+f]);for(var h=c;h<4;h++)u.push(0)}var d=a([r([u])],void 0===i||o);return d&&(i=d,d.type="sampler2D"),d}},"texture.fromColorList":function(e){var t=16,n=gl(0,function(){return t},function(){return 1}),r=su(e,function(){return"texture_list"}),a=void 0;return function(e,i){var o=Object(v.a)(e,1)[0];"start"!==o&&o&&void 0!==o.length||(o=["#000000"]),t=o.length;var s=sl()([o])[0],c=r([n([s])],void 0===a||i);return c&&(a=c,c.type="sampler2D"),c}}};Object(pi.a)("gl.advect",{texture:"",xy:""},"",function(){return 1},{inlets:2,inletTypes:["sampler2D","vec2"],type:"vec4"});Object(pi.a)("gl.texture2D",{texture:"",textureCoords:""},"Calls texture2D on texture and texture coords",function(){return 1},{inletTypes:["sampler2D","vec2"],type:function(){return"vec4"},isHot:!0,inlets:2});var id=function(e,t){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"(texture2D((".concat(Object(ru.b)(r[0]),"), (").concat(Object(ru.b)(r[1]),")))")},t))};Object(pi.a)("gl.textureVec2",{texture:"",index:"",length:""},"Returns vec2 at index from list of given length",function(){return 1},{inletTypes:["sampler2D","float","float"],type:function(){return"vec2"},isHot:!0,inlets:3});Object(pi.a)("gl.sample",{layer:"",coordinate:""},"",function(){return 2},{isHot:!0,inlets:2,outlets:["color","texture"],inletTypes:["vec4","vec2"],type:function(){return"vec4"}});Object(pi.a)("gl.feedback",{feedback:"",coordinate:""},"",function(){return 3},{inlets:2,isHot:!0,inletTypes:["vec4","vec2"],type:function(){return"vec4"},outlets:["color","function","texture"]});var od=0,sd={"gl.sample":function(e,t){e.needsHotReload=!0;var n=su(new ib(e.subSequence),function(){return"texture"}),r=id(new ib(e.subSequence),t),a={};return e.typed(function(e){var t=Object(v.a)(e,1)[0];if("string"!==typeof t){var i=Object(h.a)(t.frames||[]),o=Object(d.a)({},t,{frames:void 0,texture:n});i.push(o);var s=n([2],!0),c=r([s]);for(var u in c.frames=i,c.type="vec4",c)a[u]=c[u];return s.frames=i,s.type="sampler2D",[c,s]}})},"gl.feedback":function(e,t){e.needsHotReload=!0,e.needsLoad=!0;var n=su(new ib(e.subSequence),function(){return"texture"}),r=id(new ib(e.subSequence),t),a=void 0,i=void 0,o={};return e.typed(function(s){var c=Object(v.a)(s,1)[0];if("string"===typeof c&&(c={fuck:"yo"+od++},o=c),c.isFeedbackOutput=!0,(!c||a!==t()||i!==c)&&(!i||!c||a!==t()||i.code!==c.code)){for(var u in i=c,a=t(),c)o[u]=c[u];var l=[].concat(),f={frames:void 0,texture:n,feedback:c};l.push(f);var h=n([2],!0),d=r([h]);d.frames=l,d.type="vec4";var p="feedback"+e.id.replaceAll("-",""),m={};m[p]={returnType:"vec4",args:{nv:"vec2"},body:"\n    return texture2D(".concat(h.code,", nv);\n")};var y={codeEvaluator:function(e){return"(".concat(p,"(").concat(e,"))")},functions:m,uniforms:h.uniforms,frames:l,func:m[p]};return h.type="sampler2D",h.frames=l,[d,y,h]}})}};Object(pi.a)("gl.offset_v",{},"",function(){return 1},{});Object(pi.a)("gl.globalUniformRender",{},"Enables/disables triggering re-renders by uniforms when they update.",function(){return 0},{});Object(pi.a)("gl.piecewiseSampleSmooth",{texture:"",x:"",res:""},"",function(){return 1},{isHot:!0,inletTypes:["sampler2D","float","float"],type:"float",inlets:3});Object(pi.a)("gl.piecewiseSampleSmoothVec4",{texture:"",x:"",res:""},"",function(){return 1},{isHot:!0,inletTypes:["sampler2D","float","float"],type:"vec4",inlets:3});var cd={"gl.piecewiseSampleSmooth":function(e,t,n){return e.typed(function(e){var r=Object(v.a)(e,1)[0],a=Object(ru.a)(r,t,n),i=a.codes,o=a.closure,s=a.uniforms,c=a.functions,u=a.variables,l="samplePiecewiseSmoothgenerated";return c[l]={returnType:"float",args:{iChannel0:"sampler2D",x:"float",res:"float"},body:"\n    float xTimesRes = x * res;\n\n    // Left sample point:\n    float x1 = floor(xTimesRes) / res;\n    float y1 = texture(iChannel0, vec2(x1, 0.0)).x;\n\n    // Right sample point:\n    float x2 = ceil(xTimesRes) / res;\n    float y2 = texture(iChannel0, vec2(x2, 0.0)).x;\n\n    // Prevent small breaks in the line:\n    x2 += 0.001;    \n\n    // Fit half of a sine wave between sample points:\n    float sine = sin(((x - x1) / (x2 - x1) * 2.0 - 1.0) * 1.5707963267);\n    return y1 + (0.5 + 0.5 * sine) * (y2 - y1);\n"},i=i.map(ru.b),{code:"".concat(l,"(").concat(i[0],", ").concat(i[1],", ").concat(i[2],")"),uniforms:s,frames:r.frames,variables:u,functions:c,closure:o,type:"float"}})},"gl.piecewiseSampleSmoothVec4":function(e,t,n){return e.typed(function(e){var r=Object(v.a)(e,1)[0],a=Object(ru.a)(r,t,n),i=a.codes,o=a.closure,s=a.uniforms,c=a.functions,u=a.variables,l="samplePiecewiseSmoothVec4";return c[l]={returnType:"vec4",args:{iChannel0:"sampler2D",x:"float",res:"float"},body:"\n    float xTimesRes = x * res;\n\n    // Left sample point:\n    vec4 x1 = vec4(floor(xTimesRes) / res);\n    vec4 y1 = texture(iChannel0, vec2(x1.x, 0.0));\n\n    // Right sample point:\n    vec4 x2 = vec4(ceil(xTimesRes) / res);\n    vec4 y2 = texture(iChannel0, vec2(x2.x, 0.0));\n\n    // Prevent small breaks in the line:\n    x2 += 0.001;    \n\n    // Fit half of a sine wave between sample points:\n    vec4 sine = sin(((x - x1) / (x2 - x1) * 2.0 - 1.0) * 1.5707963267);\n    return y1 + (0.5 + 0.5 * sine) * (y2 - y1);\n"},i=i.map(ru.b),{type:"vec4",code:"".concat(l,"(").concat(i[0],", ").concat(i[1],", ").concat(i[2],")"),uniforms:s,frames:r.frames,variables:u,functions:c,closure:o}})}},ud=function(e,t){var n=t!==e;return Array.isArray(e)&&Array.isArray(e)&&Array.isArray(t)&&(n=e.length!==t.length||!e.every(function(e,n){return t[n]===e})),n},ld=n(569);function fd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hd=function(e){return function(e){Object(u.a)(n,e);var t=fd(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"setupColors",value:function(e){var t=this;this.uxColorGL=Kh(Object(d.a)({},this,{id:this.id+"3"})),this.uxColorHex=e,this.intersectColorGL=Kh(Object(d.a)({},this,{id:this.id+"2"})),this.intersectColorHex=e,this.MAIN_COLOR="MAIN_COLOR"+this.id,this.INTERSECT_COLOR="INTERSECT_COLOR"+this.id,this.newInlet("color",function(e){var n=Object(v.a)(e,1)[0],r=!Array.isArray(n)||ud(n,t.background);t.background=n,r&&t.compile()},Object(Ou.k)(Ou.f,Ou.g)),this.newInlet("intersectColor",function(e){var n=Object(v.a)(e,1)[0],r=!Array.isArray(n)||ud(n,t.intersectColor);t.intersectColor=n,r&&t.compile()},Object(Ou.k)(Ou.f,Ou.g))}},{key:"setUXBackground",value:function(e){var t=!1;this.background&&(t=!0),this.background=void 0,this.uxColorHex=e,this.uxColorGL([e]),t&&this.compile()}},{key:"setUXIntersectColor",value:function(e){var t=!1;this.intersectColor&&(t=!0),this.intersectColor=void 0,this.intersectColorHex=e,this.intersectColorGL([e]),t&&this.compile()}},{key:"color",get:function(){return this.background||this.uxColorGL([this.uxColorHex],!0)[0]}},{key:"intersectionColor",get:function(){return this.intersectColor||this.intersectColorGL([this.intersectColorHex],!0)[0]}}]),n}(e)};function dd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function pd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function vd(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return md(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return md(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function md(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function yd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var bd=function(e){Object(u.a)(n,e);var t=yd(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this)).isSubLayer=r,a.id=Object(q.uuid)(),a.subLayers=[],a.zObject=e,a.sequencerEngine=e.sequencerEngine,a.sequencerEngine.idToObject[a.id]=Object(c.a)(a),a.subSequence=e.subSequence,a._sdf=0,a._blur=.0051,a._value=0,a.newInlet("SDF",function(e){var t=Object(v.a)(e,1)[0];a.SDF=t,a.layerManager.layers.filter(function(e){return!e._sdf}).forEach(function(e){return e.SDF=t})},Object(Ou.k)(Ou.b,Ou.g)),a.newNumberField("blur",.001,.001),a.newNumberField("value",0),a.setupColors("#ffffff"),a.sdfUniform=su(Object(c.a)(a),function(){return"sdf"}),a.colorUniform=su(Object(c.a)(a),function(){return"color"}),a.intersectionColorUniform=su(Object(c.a)(a),function(){return"intersectColor"}),a.intersectPreviousLayer=0,a.newInlet("intersect",function(e){var t=Object(v.a)(e,1)[0];a.intersectPreviousLayer=t,a.compile()}),a.newNumberField("intersectionMix",0),a}return Object(s.a)(n,[{key:"intersectPreviousLayer",get:function(){return this._intersectPreviousLayer},set:function(e){this._intersectPreviousLayer=e,this.isSubLayer||this.compile()}},{key:"enabled",get:function(){return this.layerManager.enabled}},{key:"layerManager",get:function(){return this.zObject.effect}},{key:"flash",value:function(){}},{key:"compileLayer",value:function(e,t){return Array.isArray(this.SDF)?this.compileLayerAsList(e,t):this._compile(e,this.SDF,this.color,this.blur,this.value,this.enabled,this.intersectionColor,t)}},{key:"_compile",value:function(e,t,n,r,a,i,o,s){var c=mf("gl.variable"),u=c(t,"layerSDF","float"),l=c(mf("gl.+")(u,a),"sdfPlus","float"),f=mf("gl.smoothstep")(r,0,l),h=c(n,"layerColor","vec4"),d=mf("gl.mix")(e,h,f),p=c(d,"mixedLayer","vec4");if(void 0!==i){var v=mf("gl.eq")(i,1);p=mf("gl.if")(d,"mixedLayer","vec4",v,e)}var m=p;return this.intersectPreviousLayer&&s?this.intersect(e,m,s,l,o,r,a):(!p.frames&&u.frames&&(p.frames=u.frames),p)}},{key:"intersect",value:function(e,t,n,r,a,i,o){var s=mf("gl.max")(n,r),c=a;return this._compile(t,s,c,i,o,this.enabled)}},{key:"compileLayerAsList",value:function(e,t){for(var r=gd(this.SDF,e),a=mf("gl.min"),i=0;i<this.SDF.length;i++){var o=0==i?r:this.SDF[i],s=this.getArg(this.intersectionColor,i),c=this.getArg(this.color,i),u=this.getArg(this.blur,i),l=this.getArg(this.value,i),f=this.getArg(this.enabled,i),h=this.subLayers[i]||new n(this.zObject,!0);h.intersectPreviousLayer=Array.isArray(this.intersectPreviousLayer)?this.intersectPreviousLayer[i%this.intersectPreviousLayer.length]:this.intersectPreviousLayer,this.subLayers[i]=h,e=h._compile(e,o,c,u,l,f,s,t),t=t?a(t,o):o}return e}},{key:"getArg",value:function(e,t){return Array.isArray(e)?e[t%e.length]:e}},{key:"compile",value:function(){this.zObject.effect.compile()}},{key:"SDF",get:function(){return this._sdf?this._sdf:this.sdfUniform([0],!0)},set:function(e){var t=ud(e,this._sdf);this._sdf=e,t&&this.compile()}},{key:"blur",get:function(){return this.getNumber("blur")}},{key:"value",get:function(){return this.getNumber("value")}},{key:"fromJson",value:function(e){this.id;this.id=e.id,this.sequencerEngine.idToObject[this.id]=this;this.id;this.sequencerEngine.idToObject[this.id]=this,this.uxColorHex=e.uxColorHex,this.name=e.name,this.updateNumber("value",e.value),this.updateNumber("blur",e.blur),e.intersectPreviousLayer&&(this.intersectPreviousLayer=e.intersectPreviousLayer),e.intersectColorHex&&(this.intersectColorHex=e.intersectColorHex);var t={};return t[e.id]=this.id,t}},{key:"getJson",value:function(){return{name:this.name,id:this.id,uxColorHex:this.uxColorHex,blur:this.receivedNumbers.blur,value:this.receivedNumbers.value,intersectPreviousLayer:this.intersectPreviousLayer,intersectColorHex:this.intersectColorHex}}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=pd(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"hasInletFields",get:function(){return!0}}]),n}(e)}(Object(ld.a)(function(e){return function(e){Object(u.a)(n,e);var t=dd(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).numbers={},e.glNumbers={},e.receivedNumbers={},e.numberUniforms={},e}return Object(s.a)(n,[{key:"newNumberField",value:function(e,t){var n=this,r=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=new vu(e.subSequence,zc.c);return a.text=t,a.min=n,a.max=r,a}(this,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,1);this.numbers[e]=r,this.numberUniforms[e]=su(this,function(){return e}),this.newInlet(e,function(t){var r=Object(v.a)(t,1)[0];return n.updateNumber(e,r)},Object(Ou.k)("float","number"))}},{key:"updateNumber",value:function(e,t){isNaN(t)?(this.glNumbers[e]=t,this.compile()):(this.numberUniforms[e]([t]),this.numbers[e]._text=t),this.receivedNumbers[e]=t}},{key:"getNumber",value:function(e){return this.glNumbers[e]?this.glNumbers[e]:this.numberUniforms[e]([this.numbers[e]._text],!0)}}]),n}(e)}(hd(Object(fi.a)(function(){return function e(){Object(o.a)(this,e)}}())))))),gd=function(e,t){var n,r={},a={},i={},o=vd(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;r=Object(d.a)({},r,s.variables),a=Object(d.a)({},a,s.functions),i=Object(d.a)({},i,s.uniforms)}}catch(c){o.e(c)}finally{o.f()}return t&&t.variables&&(r=Object(d.a)({},r,t.variables)),Object(d.a)({},e[0],{variables:r,uniforms:i,functions:a})},Od=bd;function jd(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return kd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kd(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function kd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function wd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var xd=function(e){Object(u.a)(n,e);var t=wd(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).layers=[],r.setupColors("#000000"),r.enabled=void 0,r.newInlet("enable",function(e){var t=Object(v.a)(e,1)[0];r.enabled=t,r.compile()}),r.newOutlet("output color"),r.newLayer(),r}return Object(s.a)(n,[{key:"refresh",value:function(){return this.compile()}},{key:"isSharingSameSDF",value:function(){var e=this;return this.layers.every(function(t){return t.SDF===e.layers[0].SDF})}},{key:"newLayer",value:function(){var e=new Od(this.zObject);this.layers.push(e);var t=this.layers.find(function(e){return e._sdf});t&&(e.SDF=t._sdf),this.compile()}},{key:"getInnerNodes",value:function(){return this.layers}},{key:"compile",value:function(){var e,t=this,n=this.color,r=void 0,a=mf("gl.min"),i=jd(this.layers);try{for(i.s();!(e=i.n()).done;){var o=e.value;if(o._sdf){var s=o._sdf;n=o.compileLayer(n,r),r=r?a(r,s):s}}}catch(l){i.e(l)}finally{i.f()}this.zObject.onValueChange();n.functions,this.id.replaceAll("-","");if(void 0===this.enabled)n.type="vec4",this.sendMessage("output color",n);else{var c=Of(this,function(){return 1})([this.enabled]),u=uu(this,function(){return"layerEnabled"+t.id.replaceAll("-","")},function(){return"vec4"},function(){return c},function(){return t.color});u.type="vec4",this.sendMessage("output color",u([n]))}}},{key:"flash",value:function(){this.zObject.flash()}},{key:"getJson",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return Object(d.a)({},(e=Object(fe.a)(Object(f.a)(n.prototype),"getJson",this)).call.apply(e,[this].concat(r)),{layers:this.layers.map(function(e){return e.getJson()}),uxColorHex:this.uxColorHex})}},{key:"fromJson",value:function(e){this.id;for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];(t=Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this)).call.apply(t,[this,e].concat(a));this.id;this.sequencerEngine.idToObject[this.id]=this;if(e.layers){this.uxColorHex=e.uxColorHex;var o={};o[e.id]=this.id;var s,c=jd(e.layers);try{for(c.s();!(s=c.n()).done;){var u=s.value;o=Object(d.a)({},o,this.layers[this.layers.length-1].fromJson(u)),e.layers.length>this.layers.length&&this.newLayer()}}catch(l){c.e(l)}finally{c.f()}return o}}}]),n}(hd(Ni.a));Object(pi.a)("sdf.layers",{},"Manages anti-aliased layers for SDFs",function(){return 0},{inlets:0,connects:[{outlet:"Output 1",object:"gl.fragColor",inlet:"Input"}]});Object(pi.a)("constraint.nearEdge",{value:""},"Creates constraint near edge");var Sd={"constraint.nearEdge":function(e){return function(e){var t=Object(v.a)(e,1)[0];return{type:"NEAR_EDGE",value:t}}}};function Pd(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ed(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ed(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ed(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Td=function(e,t,n,r){for(var a,i,o=Rd(r,t),s=Object(v.a)(o,4),c=s[0],u=s[1],l=s[2],f=s[3],h=Ad(n,c,u,l,f,e),d=1,p=0,m=1/0,y=1;a=h,i=e,!(Math.abs(a-i)<.01)&&p++<16;){var b=1+d*(1/16),g=1-d*(1/16),O=c*b,j=u*b,k=c*g,w=u*g,x=Ad(n,O,j,l,f,e),S=Object(v.a)(x,2),P=S[0],E=S[1],T=Ad(n,k,w,l,f,e),A=Object(v.a)(T,2),M=A[0],R=A[1];if(P<m&&0===E&&(m=P,y=b),M<m&&0===R&&(m=M,y=g),P<.01)return[O,j];if(M<.01)return[k,w];d++,0}return[c*y,u*y]},Ad=function(e,t,n,r,a,i){var o,s=1/0,c=-1/0,u=Nd(e,t,n,r,a),l=Pd(u);try{for(l.s();!(o=l.n()).done;){var f=o.value.sdf,h=Math.abs(i-f);h<s&&(s=h),f+i>0&&h>c&&(c=h)}}catch(p){l.e(p)}finally{l.f()}var d=Md(u,i);return d>0?[c,d]:[s,d]},Md=function(e,t){var n,r=0,a=Pd(e);try{for(a.s();!(n=a.n()).done;){n.value.sdf+t>0&&r++}}catch(i){a.e(i)}finally{a.f()}return r},Rd=function(e,t){var n=e.lastSDFs[t].slice(1,3),r=Object(v.a)(n,2),a=r[0],i=r[1],o=Object(v.a)(e.dimensions[t],2);return[a,i,o[0],o[1]]},Cd=function(e,t,n,r){return[[[e+n,t+r],[1,1]],[[e,t+r],[0,1]],[[e-n,t+r],[-1,1]],[[e,t-r],[0,-1]],[[e+n,t-r],[1,-1]],[[e-n,t],[-1,0]],[[e-n,t-r],[-1,-1]],[[e+n,t],[1,0]]]},Nd=function(e,t,n,r,a){var i,o=[],s=Pd(Cd(t,n,r,a));try{for(s.s();!(i=s.n()).done;){var c=i.value,u=Object(v.a)(c,2),l=u[0],f=u[1],h=e.sdfAtPoint(l,0,void 0,!0);o.push({sdf:h,direction:f,pt:l})}}catch(d){s.e(d)}finally{s.f()}return o},Id={NEAR_EDGE:function(e,t,n){(new Date).getTime();for(var r=0;r<n.positions.length;r++){n.positions[r];var a=Td(e,r,t,n),i=Object(v.a)(a,2),o=i[0],s=i[1];n.updatePosition(r,o,s)}(new Date).getTime()}};Object(pi.a)("sdf.constraint",{"constraint program":""},"Creates constraint based on sdfs",function(){return 1},{isHot:!0,inlets:3});var qd=Object(d.a)({"sdf.constraint":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0],a=Id[r.type];a&&a(r.value,t(),n())}}},Sd);Object(pi.a)("gl.resolution",{},"Creates GLSL expression for the resolution vec2",function(){return 1},{inlets:0,tags:"GLSL"});Object(pi.a)("gl.xy",{},"Creates GLSL expression for the current pixel/'s x & y coordinates as a vec2",function(){return 1},{inlets:0,type:"vec2",tags:"GLSL"});Object(pi.a)("gl.bad_uv",{},"Creates GLSL expression for the current pixel/'s x & y coordinates as a vec2",function(){return 3},{inlets:0,type:function(){return["vec2","float","float"]},outlets:["vec2","u","v"],tags:"GLSL"});Object(pi.a)("gl.nuv",{},"Creates GLSL expression for normalized vector of current pixels coordinate",function(){return 3},{inlets:0,type:function(){return["vec2","float","float"]},outlets:["vec2","u","v"],tags:"GLSL"});Object(pi.a)("gl.pixel",{},"Returns size of 1 pixel (as vec2) normalized from 0-1",function(){return 3},{inlets:0,type:function(){return["vec2","float","float"]},outlets:["vec2","u","v"],tags:"GLSL"});Object(pi.a)("gl.uv",{},"Creates GLSL expression for the current pixel/'s x & y coordinates as a vec2",function(){return 3},{type:function(){return["vec2","float","float"]},inlets:0,tags:"GLSL",outlets:["vec2","u","v"]});Object(pi.a)("gl.x",{},"Creates GLSL expression for the current pixel/'s x-coordinate",function(){return 1},{type:function(){return"float"},inlets:0,tags:"GLSL"});Object(pi.a)("gl.iframe",{},"Creates GLSL expression for the # iteration of the shader (increases by 1 every re-render)",function(){return 1},{type:function(){return"float"},inlets:0,tags:"GLSL"});Object(pi.a)("gl.y",{},"Creates an GLSL expression for the current pixel/'s y-coordinate",function(){return 1},{type:function(){return"float"},inlets:0,tags:"GLSL"});Object(pi.a)("gl.width",{},"Creates GLSL expression for the canvas/'s width",function(){return 1},{type:function(){return"float"},tags:"GLSL",isHot:!0,inlets:0});Object(pi.a)("gl.height",{},"Creates GLSL expression for the canvas/'s height",function(){return 1},{type:function(){return"float"},tags:"GLSL",isHot:!0,inlets:0});Object(pi.a)("gl.normalize",{v:""},"Normalizes a vector",function(){return 1},{inletTypes:Object(Ou.l)(Object(Ou.k)(Ou.d,Ou.e)),type:nu.d});Object(pi.a)("gl.cx_div",{a:"vec2",b:"vec2"},"Complex division in glsl",function(){return 1},{inletTypes:["vec2","vec2"],type:"vec2",isHot:!0,inlets:2});Object(pi.a)("gl.cx_mul",{a:"vec2",b:"vec2"},"Complex division in glsl",function(){return 1},{inletTypes:["vec2","vec2"],type:"vec2",isHot:!0,inlets:2});Object(pi.a)("gl.cx_sin",{a:"vec2"},"Complex sin in glsl",function(){return 1},{inletTypes:["vec2","vec2"],type:"vec2",isHot:!0,inlets:1});Object(pi.a)("gl.cx_cos",{a:"vec2"},"Complex cos in glsl",function(){return 1},{isHot:!0,inlets:1});Object(pi.a)("gl.cx_tan",{a:"vec2"},"Complex cos in glsl",function(){return 1},{isHot:!0,inlets:1});var _d={args:{z:"vec2"},returnType:"vec2",body:"\n    return vec2(\n    length(z),\n    atan(z.y, z.x)\n  );\n"};Object(pi.a)("gl.cx_log",{a:"vec2"},"Complex tan in glsl",function(){return 1},{inletTypes:["vec2"],type:"vec2"});Object(pi.a)("gl.cx_pow",{a:"vec2",b:"float"},"Complex power in glsl",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("gl.im",{a:"vec2"},"Complex imaginary part in glsl",function(){return 1},{isHot:!0,inlets:1});var Dd={"gl.cx_pow":function(e,t){return e.needsHotReload=!0,function(e){var n=Object(v.a)(e,1)[0],r=Object(ru.a)(n,t),a=r.codes,i=r.uniforms,o=r.functions,s=r.variables;return o.as_polar=_d,o.cx_pow={args:{v:"vec2",p:"float"},returnType:"vec2",body:"\n    vec2 z = as_polar(v);\n    return pow(z.x, p) * vec2(cos(z.y * p), sin(z.y * p));\n"},{code:"cx_pow(".concat(Object(ru.b)(a[0]),", ").concat(Object(ru.b)(a[1]),")"),uniforms:i,functions:o,variables:s}}},"gl.cx_div":function(e,t){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(e){var n=Object(ou.a)(e,t),r=Object(v.a)(n,2),a=r[0],i=r[1];return a="("+Object(ru.b)(a)+")",i="("+Object(ru.b)(i)+")","cx_div(".concat(a,", ").concat(i,")")},t))},"gl.cx_sin":function(e){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(e){var t=Object(ou.a)(e),n=Object(v.a)(t,1)[0];return n="("+Object(ru.b)(n)+")","cx_sin(".concat(n,")")}))},"gl.cx_cos":function(e){return e.needsHotReload=!0,Object(iu.a)(function(e){var t=Object(ou.a)(e),n=Object(v.a)(t,1)[0];return n="("+Object(ru.b)(n)+")","cx_cos(".concat(n,")")})},"gl.cx_mul":function(e,t){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(e){var n=Object(ou.a)(e,t),r=Object(v.a)(n,2),a=r[0],i=r[1];return a="("+Object(ru.b)(a)+")",i="("+Object(ru.b)(i)+")","cx_mul(".concat(a,", ").concat(i,")")},t))},"gl.cx_log":function(e){return e.needsHotReload=!0,e.typed(function(e){var t=Object(v.a)(e,1)[0],n=Object(ru.a)(t),r=n.codes,a=n.uniforms,i=n.functions,o=n.variables;return o=t.variables,i.as_polar=_d,i.cx_log={args:{a:"vec2"},returnType:"vec2",body:"\n    vec2 polar = as_polar(a);\n    float rpart = polar.x;\n    float ipart = polar.y;\n    if (ipart > PI) ipart=ipart-(2.0*PI);\n    return vec2(log(rpart),ipart);\n"},{code:"cx_log(".concat(Object(ru.b)(r[0]),")"),uniforms:a,functions:i,variables:o}})}},Fd=n(571),Ld={mod289:{args:{x:"vec3"},returnType:"vec3",body:"\nreturn x - floor(x * (1.0 / 289.0)) * 289.0;\n"},mod289_4:{args:{x:"vec4"},returnType:"vec4",body:"\nreturn x - floor(x * (1.0 / 289.0)) * 289.0; \n"},permute:{args:{x:"vec4"},returnType:"vec4",body:"\nreturn mod289_4(((x*34.0)+1.0)*x);\n"},taylorInvSqrt:{args:{r:"vec4"},returnType:"vec4",body:"\nreturn 1.79284291400159 - 0.85373472095314 * r; \n"},fade:{args:{t:"vec3"},returnType:"vec3",body:"\nreturn t*t*t*(t*(t*6.0-15.0)+10.0);\n"},perlin:{args:{P:"vec3"},returnType:"float",body:"\n    vec3 i0 = mod289(floor(P)), i1 = mod289(i0 + vec3(1.0));\n    vec3 f0 = fract(P), f1 = f0 - vec3(1.0), f = fade(f0);\n    vec4 ix = vec4(i0.x, i1.x, i0.x, i1.x), iy = vec4(i0.yy, i1.yy);\n    vec4 iz0 = i0.zzzz, iz1 = i1.zzzz;\n    vec4 ixy = permute(permute(ix) + iy), ixy0 = permute(ixy + iz0), ixy1 = permute(ixy + iz1);\n    vec4 gx0 = ixy0 * (1.0 / 7.0), gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n    vec4 gx1 = ixy1 * (1.0 / 7.0), gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n    gx0 = fract(gx0); gx1 = fract(gx1);\n    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0), sz0 = step(gz0, vec4(0.0));\n    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1), sz1 = step(gz1, vec4(0.0));\n    gx0 -= sz0 * (step(0.0, gx0) - 0.5); gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n    gx1 -= sz1 * (step(0.0, gx1) - 0.5); gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n    vec3 g0 = vec3(gx0.x,gy0.x,gz0.x), g1 = vec3(gx0.y,gy0.y,gz0.y),\n        g2 = vec3(gx0.z,gy0.z,gz0.z), g3 = vec3(gx0.w,gy0.w,gz0.w),\n        g4 = vec3(gx1.x,gy1.x,gz1.x), g5 = vec3(gx1.y,gy1.y,gz1.y),\n        g6 = vec3(gx1.z,gy1.z,gz1.z), g7 = vec3(gx1.w,gy1.w,gz1.w);\n    vec4 norm0 = taylorInvSqrt(vec4(dot(g0,g0), dot(g2,g2), dot(g1,g1), dot(g3,g3)));\n    vec4 norm1 = taylorInvSqrt(vec4(dot(g4,g4), dot(g6,g6), dot(g5,g5), dot(g7,g7)));\n    g0 *= norm0.x; g2 *= norm0.y; g1 *= norm0.z; g3 *= norm0.w;\n    g4 *= norm1.x; g6 *= norm1.y; g5 *= norm1.z; g7 *= norm1.w;\n    vec4 nz = mix(vec4(dot(g0, vec3(f0.x, f0.y, f0.z)), dot(g1, vec3(f1.x, f0.y, f0.z)),\n        dot(g2, vec3(f0.x, f1.y, f0.z)), dot(g3, vec3(f1.x, f1.y, f0.z))),\n        vec4(dot(g4, vec3(f0.x, f0.y, f1.z)), dot(g5, vec3(f1.x, f0.y, f1.z)),\n            dot(g6, vec3(f0.x, f1.y, f1.z)), dot(g7, vec3(f1.x, f1.y, f1.z))), f.z);\n    return 2.2 * mix(mix(nz.x,nz.z,f.y), mix(nz.y,nz.w,f.y), f.x);\n"}};Object(pi.a)("gl.perlin",{vec3:""},"Returns perlin noise for a pt in 3D space",function(){return 1},{inletTypes:Object(Ou.l)(Object(Ou.k)("vec3")),type:"float"});Object(pi.a)("gl.turbulence",{vec3:""},"Returns turbulence for perlin noise for a pt in 3D space",function(){return 1},{inletTypes:"vec3",type:"float"});var Bd={"gl.perlin":function(e){return e.typed(function(e){var t=Object(v.a)(e,1)[0],n=Object(ru.a)(t),r=n.codes,a=n.closure,i=n.functions,o=n.variables,s=n.uniforms;o=t.variables;var c="perlin("+Object(ru.b)(r[0])+")";return{closure:a,uniforms:s,functions:Object(d.a)({},i,Ld),code:c,variables:o}})},"gl.turbulence":function(e){return function(e){var t=Object(v.a)(e,1)[0],n=Object(ru.a)(t),r=n.codes,a=n.closure,i=n.functions,o=n.variables,s=n.uniforms;return o=t.variables,(i=Object(d.a)({},i,Ld)).turbulence={args:{P:"vec3"},returnType:"float",body:"\nfloat f = 0., s = 1.;\n    for (int i = 0 ; i < 5 ; i++) {\n        f += abs(perlin(s * P)) / s;\n        s *= 2.;\n        P = vec3(.866 * P.x + .5 * P.z, P.y + 100., -.5 * P.x + .866 * P.z);\n    }\n    return f;\n"},{closure:a,uniforms:s,functions:i,code:"turbulence("+Object(ru.b)(r[0])+")",variables:o}}}};function zd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Jd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=new vu(e.subSequence,zc.c);return a.text=t,a.min=n,a.max=r,a},Vd=function(e){Object(u.a)(n,e);var t=zd(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newOutlet("SDF Object"),r.type="box",r.zObject.setAttribute("primary-color","#545460"),r.zObject.hasInletFields=!0,r.x=Jd(Object(c.a)(r),0),r.y=Jd(Object(c.a)(r),0),r.z=Jd(Object(c.a)(r),0,-3,3),r.w=Jd(Object(c.a)(r),.1,0,1),r.h=Jd(Object(c.a)(r),.2,0,1),r.d=Jd(Object(c.a)(r),.1,0,1),r.c=Jd(Object(c.a)(r),.1,0,1),r.r=Jd(Object(c.a)(r),0,-Math.PI,Math.PI),r.repeatSpread=Jd(Object(c.a)(r),0,-1,1),r.repeatCountX=Jd(Object(c.a)(r),0,0,8),r.repeatCountX.round=!0,r.repeatCountY=Jd(Object(c.a)(r),0,0,8),r.repeatCountY.round=!0,r.repeatCountZ=Jd(Object(c.a)(r),0,0,8),r.repeatCountZ.round=!0,r.newInlet("x",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.x,t)}),r.newInlet("y",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.y,t)}),r.newInlet("z",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.z,t)}),r.newInlet("width",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.w,t)}),r.newInlet("height",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.h,t)}),r.newInlet("depth",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.d,t)}),r.newInlet("corner",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.c,t)}),r.newInlet("rotation",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.r,t)}),r.newInlet("repeat spread",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.repeatSpread,t)}),r.newInlet("repeat x",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.repeatCountX,t)}),r.newInlet("repeat y",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.repeatCountY,t)}),r.newInlet("repeat z",function(e){var t=Object(v.a)(e,1)[0];return r.on(r.repeatCountZ,t)}),r}return Object(s.a)(n,[{key:"on",value:function(e,t){isNaN(t)||(e.text=t,this.sendObject())}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{x:this.x._text,y:this.y._text,z:this.z._text,w:this.w._text,h:this.h._text,d:this.d._text,c:this.c._text,r:this.r._text,repeatSpread:this.repeatSpread._text,repeatCountX:this.repeatCountX._text,repeatCountY:this.repeatCountY._text,repeatCountZ:this.repeatCountZ._text,type:this.type})}},{key:"fromJson",value:function(e,t){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),void 0!==e.x&&(this.x.text=e.x,this.y.text=e.y,this.z.text=e.z,this.w.text=e.w,this.h.text=e.h,this.d.text=e.d,isNaN(e.repeatCountX)||(this.repeatSpread.text=e.repeatSpread,this.repeatCountX.text=e.repeatCountX,this.repeatCountY.text=e.repeatCountY,this.repeatCountZ.text=e.repeatCountZ),isNaN(e.r)||(this.r.text=e.r),this.c.text=e.c,this.type=e.type)}},{key:"sendObject",value:function(){var e=[];(e=Object(Cf.g)(this.type)?[this.type,this.x._text,this.y._text,this.z._text,this.w._text,this.h._text,this.d._text,this.c._text,this.r._text,[this.repeatSpread._text,this.repeatCountX._text,this.repeatCountY._text,this.repeatCountZ._text]]:[this.type,this.x._text,this.y._text,this.w._text,this.h._text,this.c._text,this.r._text]).id=this.id,this.sendMessage("SDF Object",e)}}]),n}(Ni.a);Object(pi.a)("gl.estimateNormal",{sdfs:"list of sdfs",rayOrigin:"",rayDirection:"","ray marched distance":""},"Estimates normal for list of sdfs (to be unioned together)",function(){return 1},{isHot:!0,inlets:4});var Hd=function(e,t,n,r){var a="estimateNormal_"+Object(q.uuid)().replaceAll("-","").slice(0,4);return function(e){var i=Object(v.a)(e,1)[0],o=Object(ru.a)(i,t,n,r),s=o.codes,c=o.uniforms,u=o.functions;return u[a]={args:{p:"vec3"},returnType:"vec3",body:"\nreturn normalize(vec3(\n        ".concat(i.code("vec3(p.x + EPSILON, p.y, p.z)"),".x - ").concat(i.code("vec3(p.x - EPSILON, p.y, p.z)"),".x,\n        ").concat(i.code("vec3(p.x, p.y + EPSILON, p.z)"),".x - ").concat(i.code("vec3(p.x, p.y - EPSILON, p.z)"),".x,\n        ").concat(i.code("vec3(p.x, p.y, p.z  + EPSILON)"),".x - ").concat(i.code("vec3(p.x, p.y, p.z - EPSILON)"),".x\n    ));\n")},{code:"".concat(a,"(").concat(s[1]," + ").concat(s[2]," * ").concat(s[3],")"),functions:u,uniforms:c}}};Object(pi.a)("gl.diffusedLight",{normal:"",rayOrigin:"",rayDirection:"","ray marched distance":"","light position":"",d1:"",d2:""},"Calculates light",function(){return 1},{isHot:!0,inlets:7});var Ud=function(e,t,n,r,a,i,o){return Object(iu.a)(function(e){var s=Object(ou.a)(e,t,n,r,a,i,o),c="(".concat(s[1]," + ").concat(s[2]," * ").concat(s[3],")"),u="normalize(".concat(s[4]," - ").concat(c,") * ").concat(Object(ru.b)(s[5]));return"clamp(dot(".concat(s[0],", ").concat(u,"), 0., 1.) * ").concat(Object(ru.b)(s[6])," + ").concat(Object(ru.b)(s[6]))},t,n,r,a,i,o)};Object(pi.a)("gl.raymarching3D",{sdfList:"list of sdf objects to be used for ray marching",rayOrigin:"origin of eye (vec3)",fieldOfView:"field of view angle (float)"},"Creates a new uniform variable with value from left-inlet, in GLSL.",function(){return 3},{isHot:!0,tags:"GLSL",inlets:3,outlets:["raymarched distance","ray direction","sdf value"]});var Gd=function(e,t,n,r){e.needsHotReload=!0;var a=Object(q.uuid)(),i="raymarching_"+a.replaceAll("-","").slice(0,4),o="shadow_"+a.replaceAll("-","").slice(0,4),s="normal_"+a.replaceAll("-","").slice(0,4);return function(e){var a=Object(v.a)(e,1)[0],c=Object(ru.a)(a,t,n,r),u=c.codes,l=c.uniforms,f=c.functions,h=c.variables;f[s]={args:{pos:"vec3"},returnType:"vec3",body:"\nvec2 e = vec2(1.0,-1.0)*0.5773;\n    const float eps = 0.0005;\n    return normalize( e.xyy*".concat(a.code("pos + e.xyy*eps"),".x + \n\te.yyx*").concat(a.code("pos + e.yyx*eps"),".x + \n\te.yxy*").concat(a.code("pos + e.yxy*eps"),".x + \n\te.xxx*").concat(a.code("pos + e.xxx*eps"),".x);\n")},f[o]={args:{ro:"vec3",rd:"vec3",tmin:"float",tmax:"float",k:"float"},returnType:"float",body:"\n    float res = 1.0;\n    float t = tmin;\n    for( int i=0; i<64; i++ )\n    {\n\tfloat h = ".concat(a.code("ro + rd*t"),".x;\n        res = min( res, k*h/t );\n        t += clamp( h, 0.003, 0.10 );\n        if( res<0.002 || t>tmax ) break;\n    }\n    return clamp( res, 0.0, 1.0 );\n")},f[i]={args:{rayOrigin:"vec3",fieldOfView:"float",rayDirection:"vec3"},returnType:"vec4",body:"\nfloat depth = ".concat(Object(ru.b)(1e-4),";\nfloat index = -1.0;\nvec3 ogRayOrigin = rayOrigin;\nfloat dist = 0.0;\n\nfor(int i=0; i<").concat(90,";i++){\n    vec3 di =  ").concat(a.code("rayOrigin + depth*rayDirection"),";\n    dist = di.x;\n    if (dist < ").concat(1e-4,") {\n        // need to calculate the shadow \n        index = di.y;\n        break;\n    }\n    if (depth > ").concat(80.01,") {\n        break;\n    }\n    depth += dist;\n}\nif (depth < ").concat(80.01,") {\n/*\n  vec3 pos = rayOrigin + depth*rayDirection;\n  vec3 nor = ").concat(s,"(pos);\n  vec3 lig = ").concat(u[3],";\n  float dif = clamp( dot(nor,lig), 0.0, 1.0 );\n  if ( dif>0.001 ) dif *= ").concat(o,"( pos+nor*0.001, lig, 0.001, 1.0, 32.0 );\n  float amb = 0.5 + 0.5*dot(nor,vec3(0.0,1.0,0.0));\n*/\n  return vec4(depth, index, 0.0, 0.0);\n}\nreturn vec4(").concat(80.01,", index, 0., 0.);\n")},h||(h={}),h.rayDir={type:"vec3",code:"getRayDir(lookAt(".concat(Object(ru.b)(u[1]),", vec3(0.0, 0.0, 0.0), vec3(0.0,0.0,0.5)), ").concat(Object(ru.b)(u[2]),")")};var d="(".concat(i,"(").concat(Object(ru.b)(u[1]),", ").concat(Object(ru.b)(u[2]),", rayDir))"),p=a.code("vec3((1.0*gl_FragCoord.xy-vec2(width, height))/height, 0.0)");return[{code:d,variables:h,uniforms:l,functions:f,hashCode:Object(au.a)(d)},{code:"rayDir",variables:h,uniforms:l,functions:f,hashCode:Object(au.a)("rayDir")},{code:p,variables:h,uniforms:l,functions:f,hashCode:Object(au.a)(p)}]}},Wd={"gl.estimateNormal":Hd,"gl.raymarching3D":Gd,"gl.sdf":Lf,"gl.diffusedLight":Ud};Object(pi.a)("sdf.softShadow",{scene:"scene to compute soft shadow for",rayOrigin:"origin of ray",rayDirection:"direction of ray",k:"softness of shadow"},"Creates a soft shadow",function(){return 1},{inlets:4});function Kd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Qd=function(e){Object(u.a)(n,e);var t=Kd(n);function n(e){var r;return Object(o.a)(this,n),r=t.call(this,e),e.skipHotReload=!0,r.skipHotReload=!0,r.setup(),r.newInlet("GL SDF Evaluators",function(e){var t=Object(v.a)(e,1)[0];return r.onSDFs(t)}),r.newInlet("Light Position",function(e){var t=Object(v.a)(e,1)[0];return r.onLightPosition(t)}),r.newInlet("Light Diffusion",function(e){var t=Object(v.a)(e,1)[0];return r.onLightDiffusion(t)}),r.newInlet("Camera Position",function(e){var t=Object(v.a)(e,1)[0];return r.onCameraPosition(t)}),r.newInlet("Field of View",function(e){var t=Object(v.a)(e,1)[0];return r.onFieldOfView(t)}),r.newOutlet("Light Strength"),r.newOutlet("Raw Light Strength"),r.newOutlet("Ray-Marched Distance"),r.newOutlet("Ray-Marched Index"),r.newOutlet("Normal"),r.newOutlet("Data"),r}return Object(s.a)(n,[{key:"hotReload",value:function(){this.lastSDFs&&this.onSDFs(this.lastSDFs)}},{key:"onCameraPosition",value:function(e){this._cameraPosition=e,this.rayOriginXUniform([e[0]]),this.rayOriginYUniform([e[1]]),this.rayOriginZUniform([e[2]])}},{key:"onLightDiffusion",value:function(e){this._lightDiffusion=e,this.lightDiffusionUniform([e])}},{key:"onLightPosition",value:function(e){Array.isArray(e)&&(this._lightPosition=e,this.lightPositionXUniform([e[0]]),this.lightPositionYUniform([e[1]]),this.lightPositionZUniform([e[2]]))}},{key:"setup",value:function(){var e=this;this.rayOriginXUniform=su({},function(){return e.name("rayOriginX")}),this.rayOriginYUniform=su({},function(){return e.name("rayOriginY")}),this.rayOriginZUniform=su({},function(){return e.name("rayOriginZ")}),this.rayOriginVec3=wu(this.zObject,function(){return e.rayOriginYUniform([e.rayOriginY],!0)},function(){return e.rayOriginZUniform([e.rayOriginZ],!0)}),this.fieldOfViewUniform=su({},function(){return e.name("fieldOfView")}),this.lightPositionXUniform=su({},function(){return e.name("lighPositionX")}),this.lightPositionYUniform=su({},function(){return e.name("lightPositionY")}),this.lightPositionZUniform=su({},function(){return e.name("lightPositionZ")}),this.lightDiffusionUniform=su({},function(){return e.name("lightDiffusion")}),this.lightPositionVec3=wu(this.zObject,function(){return e.lightPositionYUniform([e.lightPositionY],!0)},function(){return e.lightPositionZUniform([e.lightPositionZ],!0)}),this.raymarcher=Gd(this.zObject,function(){return e.rayOrigin},function(){return e.fieldOfViewUniform([e.fieldOfView],!0)},function(){return e.lightPosition}),this.normalEstimator=Hd(this.zObject,function(){return e.rayOrigin},function(){return e.rayDirection},function(){return e.rayMarchedDistance}),this.lightDiffuser=Ud(this.zObject,function(){return e.rayOrigin},function(){return e.rayDirection},function(){return e.rayMarchedDistance},function(){return e.lightPosition},function(){return e.lightDiffusionUniform([e.lightDiffusion],!0)},function(){return.64}),this.occlusion=function(e,t,n,r,a){var i="ao"+Object(q.uuid)().replaceAll("-","");return function(e){var o=Object(v.a)(e,1)[0],s=Object(ru.a)(o,t,n,r,a),c=s.codes,u=s.uniforms,l=s.functions,f=s.variables;return l[i]={args:{rayOrigin:"vec3",rayDirection:"vec3",distance:"float",nor:"vec3"},returnType:"float",body:"\n      vec3 pos = rayOrigin + rayDirection*distance;\n      float occ = 0.0;\n      float sca = 1.0;\n      for( int i=0; i<5; i++ )\n      {\n          float hr = 0.01 + 0.12 * float( i ) / 4.0;\n          vec3 aopos =  nor * hr + pos;\n          float dd = ".concat(o.code(" aopos "),".x;\n          occ += -(dd-hr)*sca;\n          sca *= 0.95;\n      }\n      return clamp( 1.0 - 3.0*occ, 0.0, 1.0 );    \n")},{code:"".concat(i,"(").concat(c.slice(1).map(function(e){return Object(ru.b)(e)}).join(","),")"),uniforms:u,functions:l,variables:f}}}(this.zObject,function(){return e.rayOrigin},function(){return e.rayDirection},function(){return e.rayMarchedDistance},function(){return e.normal})}},{key:"onFieldOfView",value:function(e){this.fieldOfViewUniform([e])}},{key:"fieldOfView",get:function(){return 90}},{key:"lightDiffusion",get:function(){return void 0===this._lightDiffusion?1.96:this._lightDiffusion}},{key:"rayOriginX",get:function(){return this._cameraPosition?this._cameraPosition[0]:.2}},{key:"rayOriginY",get:function(){return this._cameraPosition?this._cameraPosition[1]:.2}},{key:"rayOriginZ",get:function(){return this._cameraPosition?this._cameraPosition[2]:1}},{key:"lightPositionX",get:function(){return this._lightPosition?this._lightPosition[0]:0}},{key:"lightPositionY",get:function(){return this._lightPosition?this._lightPosition[1]:1.8}},{key:"lightPositionZ",get:function(){return this._lightPosition?this._lightPosition[2]:1.8}},{key:"rayOrigin",get:function(){var e=this.rayOriginXUniform([this.rayOriginX],!0);return this.rayOriginVec3([e])}},{key:"lightPosition",get:function(){return this.lightPositionVec3([this.lightPositionXUniform([this.lightPositionX],!0)])}},{key:"onSDFs",value:function(e){var t=this;this.rayOriginXUniform([this.rayOriginX]),this.rayOriginYUniform([this.rayOriginY]),this.lastSDFs=e;var n=this.raymarcher([e]),r=Object(v.a)(n,2),a=r[0],i=r[1];this.rayMarchedReturn=cu(this.zObject,function(){return"rayMarchedReturn"},function(){return"vec4"})([a]);var o=this.rayMarchedReturn.code,s=Object(d.a)({},a,{code:o+".x"}),c=Object(d.a)({},a,{code:o+".y"});this.rayMarchedDistance=cu(this.zObject,function(){return t.name("rayMarchedDistance")},function(){return"float"})([s]),this.rayMarchedIndex=cu(this.zObject,function(){return t.name("rayMarchedIndex")},function(){return"float"})([c]),this.rayDirection=cu(this.zObject,function(){return t.name("rayDirection")},function(){return"vec3"})([i]);var u=this.normalEstimator([e]),l=u,f=this.lightDiffuser([l]),h=Mf(this.zObject,function(){return 0},function(){return 80.01});this.normal=l;var p=Zf(this.zObject,function(){return h([t.rayMarchedDistance])}),m=cu(this.zObject,function(){return t.name("shadow")},function(){return"float"})([Object(d.a)({},this.rayMarchedReturn,{code:this.rayMarchedReturn.code+".z"})]),y=cu(this.zObject,function(){return t.name("hitNormal")},function(){return"float"})([Object(d.a)({},this.rayMarchedReturn,{code:this.rayMarchedReturn.code+".w"})]),b=this.occlusion([this.lastSDFs]),g=cu(this.zObject,function(){return t.name("occlusion")},function(){return"float"})([b]),O=p([f]),j=e.functions;O.functions=Object(d.a)({},O.functions,u.functions,a.functions,b.functions,j),O.variables=Object(d.a)({},m.variables,y.variables,this.rayDirection.variables,this.rayMarchedReturn.variables,this.rayMarchedDistance.variables,this.rayMarchedIndex.variables,g.variables,O.variables,l.variables),this.rayMarchedIndex.variables=Object(d.a)({},m.variables,y.variables,this.rayDirection.variables,this.rayMarchedReturn.variables,this.rayMarchedDistance.variables,this.rayMarchedIndex.variables,g.variables,O.variables,l.variables),this.rayMarchedDistance.functions=Object(d.a)({},this.rayMarchedDistance.functions,b.functions),this.rayMarchedDistance.variables=Object(d.a)({},m.variables,y.variables,this.rayMarchedReturn.variables,this.rayMarchedIndex.variables,this.rayMarchedDistance.variables,g.variables),this.sendMessage("Light Strength",O),this.sendMessage("Ray-Marched Distance",this.rayMarchedDistance),this.sendMessage("Normal",l),this.sendMessage("Ray-Marched Index",this.rayMarchedIndex),console.log("scene = ",this.lastSDFs),this.sendMessage("Data",{occlusion:g,rayOrigin:this.rayOrigin,rayDirection:this.rayDirection,rayMarchedDistance:this.rayMarchedDistance,scene:this.lastSDFs,normal:l})}},{key:"name",value:function(e){return e+this.id.replaceAll("-","")}}]),n}(Ni.a);Object(pi.a)("gl.sdfManager",{},"Create and manage multiple SDF objects with mouse events",function(){return 0},{inlets:0,altName:"sdf.manager",connects:[{outlet:"GL SDF Evaluators",object:"raymarching.manager",inlet:"GL SDF Evaluators"}]});var Zd=function(e){new ih(e);return function(){}};Object(pi.a)("sdf.simple",{},"Create and manage multiple SDF objects with mouse events",function(){return 0},{isHot:!0,inlets:0,connects:[{outlet:"GL SDF Evaluators",object:"raymarching.manager",inlet:"GL SDF Evaluators"}]});Object(pi.a)("gl.rayMarchingManager",{},"Manages ray marching for sdfs",function(){return 0},{inlets:0,altName:"raymarching.manager",connects:[{outlet:"Data",object:"gl.directionalLighting",inlet:"Input"}]});var Yd=function(e){new Qd(e);return function(){}};Object(pi.a)("gl.sdfBuilder",{},"Graphically build sdf objects (to send to sdf-manager)",function(){return 0},{inlets:0,altName:"sdf.builder",connects:{object:"uniqueAppend"}});var $d=function(e){var t=new Vd(e);return e.needsLoad=!0,function(){t.sendObject()}};Object(pi.a)("gl.sdfCopy",{sdf:"",offset:""},"Takes an SDF and outputs an offsetted copy (SDF Manager will efficiently output it)",function(){return 1},{isHot:!0,inlets:2,altName:"sdf.copy"});var Xd=function(e,t){var n=Object(q.uuid)();return function(e){var r=Object(v.a)(e,1)[0],a=t();if(r&&r.id)return{id:n,copyId:r.id,offset:a}}};Object(pi.a)("gl.sdfMultiCopies",{sdf:"",count:"",offset:""},"Takes an SDF and outputs an offsetted copy (SDF Manager will efficiently output it)",function(){return 1},{isHot:!0,inlets:3,altName:"sdf.multiCopies"});var ep=function(e,t,n){Object(q.uuid)();var r=void 0;return function(e){var a=Object(v.a)(e,1)[0];if(n()&&a&&a.id){if(!r||r.length<t())for(var i=function(e){r.push(Xd(0,function(){return[n()[0]*(e+1),n()[1]*(e+1),n()[2]*(e+1)]}))},o=(r=[]).length;o<t();o++)i(o);return[r.map(function(e){return e([a])})]}}};Object(pi.a)("gl.sdfCubeLayout",{sdf:"",count:"",offset:""},"Takes an SDF and creates copies of it in a cube formantion",function(){return 1},{altName:"sdf.cubeLayout",isHot:!0,inlets:3});var tp=function(e,t,n){Object(q.uuid)();var r=void 0,a=[];return function(e){var i=Object(v.a)(e,1)[0],o=n(),s=t();if(o&&i&&i.id){r||(r=[]);for(var c=0,u=[],l=[],f=function(e){for(var t=[],n=function(n){for(var i=[],u=function(t){if(0===e&&0===n&&0===t)return i.push(void 0),"continue";var s=[o*e,o*n,-o*t];i.push(s),l[c]=function(){return a[n][e][t]},r[c]||(r[c]=Xd(0,function(){return a[n][e][t]})),c++},f=0;f<s;f++)u(f);t.push(i)},i=0;i<s;i++)n(i);u.push(t)},d=0;d<s;d++)f(d);a=u;var p=r.map(function(e){return e([i])});return[[i].concat(Object(h.a)(p))]}}};Object(pi.a)("gl.fog",{distance:"",amount:""},"Creates fog",function(){return 1},{inlets:2});function np(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return rp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rp(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function rp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("gl.directionalLighting",{Data:"",lightPosition:"vec3",lightAttentuation:"float",lightColor:"vec4",shininess:"float",fresnel:"vec3",diffuse:"float",specular:"float",ambient:"vec3",shadow:"float"},"Calculates how much lighting should occur at a given ray end point",function(){return 1},{isHot:!0,connects:[{outlet:"Output 1",object:"gl.fragColor",inlet:"Input"}],inlets:10});var ap={"gl.directionalLighting":function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=Object(q.uuid)().replaceAll("-",""),i="directionalLighting_"+a.slice(0,4),o=function(){var e=[],t=function(t,n,r){if(void 0===t)return r;if(!isNaN(t)||Array.isArray(t)){if(!e[n]){var a=Object(q.uuid)().replaceAll("-",""),i=su({},function(){return"arg_"+n+a});e[n]=i}return e[n]([t],!0)}return t};return function(e){return(e=Object(h.a)(e).map(function(e){return void 0===e||isNaN(e)&&0===Object.keys(e).length?void 0:e}).slice(0,9))[0]=t(e[0],0,"vec3(0.5, 0.8, 1.0)"),e[1]=t(e[1],1,"1.0"),e[2]=t(e[2],2,"vec4(0.9, 0.8, 1.0, 1.0)"),e[3]=t(e[3],3,"1.0"),e[4]=t(e[4],4,"vec3(0.5, 0.8, 1.0)"),e[5]=t(e[5],5,.8),e[6]=t(e[6],6,.8),e[7]=t(e[7],7,"vec4(0.3, 0.1, 0.2, 1.0)"),e[8]=t(e[8],8,"1.0"),e}}();return function(e){var t=Object(v.a)(e,1)[0],r=t.scene,s=ru.a.apply(void 0,[t.scene,t.occlusion,t.rayOrigin,t.rayDirection,t.rayMarchedDistance,t.normal].concat(n)),c=s.codes,u=s.variables,l=s.uniforms,f=s.functions;c=[].concat(Object(h.a)(c.slice(0,6)),Object(h.a)(o(c.slice(6)))),l=Object(d.a)({},l,function(e){var t,n={},r=np(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.uniforms&&(n=Object(d.a)({},n,a.uniforms))}}catch(i){r.e(i)}finally{r.f()}return n}(c)),c=c.map(function(e){return e.code?e.code:e});var p=t.rayMarchedDistance;l=Object(d.a)({},p.uniforms,l),f=Object(d.a)({},p.functions,f),u=Object(d.a)({},p.variables,u),f.calculateTransmittance={args:{ro:"vec3",rd:"vec3",tmin:"float",tmax:"float",atten:"float"},returnType:"vec3",body:"\n     const int MAX_DEPTH = 4;\n    float hitPoints[MAX_DEPTH];\n    int depth = 0;\n    \n    for (float t = tmin; t < tmax;)\n    {\n        float h = abs(".concat(r.code("ro + t * rd"),".x);\n        if (h < 1e-5) { hitPoints[depth++] = t; t += 0.01; };\n        if (depth >= MAX_DEPTH) break;\n        t += h;\n    }\n    \n    float thickness = 0.0;\n    for (int i = 0; i < depth - 1; i += 2) thickness += hitPoints[i+1] - hitPoints[i];\n    \n    return vec3(1.0) * exp(-atten * thickness * thickness);\n")};var m="softShadow"+a;f[m]={args:{ro:"vec3",rd:"vec3",mint:"float",tmax:"float",k:"float"},returnType:"float",body:"\n         float res = 1.0;\n        float t = mint;\n\n        for( int i = 0; i < ".concat(4,"; i++ ) {\n          float h = ").concat(r.code("ro + rd * t"),".x;\n          res = min( res, k * h / t );\n          t += clamp( h, 0.02, 0.10 );\n          if( h<0.001 || t>tmax ) break;\n        }\n\n        return clamp( res, 0.0, 1.0 );\n")},f[i]={args:{occlusion:"float",rayOrigin:"vec3",rayDirection:"vec3",distance:"float",normal:"vec3",lightPosition:"vec3",lightAttenuation:"float",lightColorRaw:"vec4",shininess:"float",fresnel:"vec3",diffuse:"float",specular:"float",ambientRaw:"vec4",shadow:"float"},returnType:"vec4",body:"\n  vec3 lightColor = vec3(lightColorRaw.x, lightColorRaw.y, lightColorRaw.z);\n  vec3 ambient = vec3(ambientRaw.x, ambientRaw.y, ambientRaw.z);\n  vec3 surfacePosition = rayOrigin + rayDirection*distance;\n  vec3  outputColor   = vec3( 0. );\n  vec3 surfaceToLightDirection = normalize( lightPosition - surfacePosition );\n  vec3 lightDir = normalize(vec3(1.0, .5, -1.0));\n\n// todo: figure out translucency correctly opacity\n/*\n  float t = 0.8;\n  lightColor = t * lightColor * calculateTransmittance(surfacePosition+normal*vec3(0.01), lightDir, 0.01, 10.0, 2.0*lightAttenuation);\n  lightColor += (1.0 - t) * calculateTransmittance(surfacePosition+normal*vec3(0.01), rayDirection, 0.01, 10.0, 0.5*lightAttenuation);\n*/\n\n  // get similarity between normal and direction to light\n  float diffuseCoefficient = dot( normal, surfaceToLightDirection ); \n  // get reflection angle for light striking surface\n  vec3 angleOfReflection = reflect( -surfaceToLightDirection, normal );\n  // see if reflected light travels to camera and generate coefficient accordingly\n  float specularAngle = clamp( dot( angleOfReflection, -rayDirection ), 0., 1. );\n  float specularCoefficient = pow( specularAngle, shininess );\n  // lights should have an attenuation factor\n  float attenuation = 1. / ( lightAttenuation * pow( length( lightPosition - surfacePosition ), 2. ) ); \n  // bias, scale, power\n  float _fresnel = fresnel.x + fresnel.y * pow( 1.0 + dot( rayDirection, normal ), fresnel.z ); \n  // shadow was here\n  diffuseCoefficient *= ".concat(m,"( surfacePosition, normalize( lightPosition ), 0.02, 2.5, shadow);\n  vec3 color = vec3( 0. );\n  color += 1.2 * diffuseCoefficient * diffuse * lightColor;\n  color += 2.2 * specularCoefficient * specular * lightColor;\n  color += 0.3 * (ambient * lightColor) * occlusion;\n  color += (_fresnel * lightColor);\n  // texture\n  // gamma correction must occur before light attenuation\n  // which means it must be applied on a per-light basis unfortunately\n  vec3 gammaCorrectedColor = pow( color, vec3( 1./2.2 ) );\n  vec3 attenuatedColor = 2. * gammaCorrectedColor * attenuation; \n  outputColor += attenuatedColor;\n  return vec4(outputColor.x, outputColor.y, outputColor.z, 1.0);\n")};var y="".concat(i,"(\n\t").concat(c.slice(1).join(",\n\t"),")");return console.log("lighting frames=",r.frames),{code:y,type:"vec4",frames:r.frames,functions:f,uniforms:l,variables:u}}}};Object(pi.a)("gl.dot",{x:"x",y:"y"},"Creates GLSL expression for dot product of vectors",function(){return 1},{inletTypes:Object(Ou.l)(Object(Ou.k)("vec2","vec3","vec4")),type:"float",tags:"GLSL",isHot:!0,inlets:2});Object(pi.a)("gl.fragColor",{color:""},"Outputs the GLSL vec4 in the inlet to the shader. Represents the final output for the shader",function(){return 1},{inlets:1,inletTypes:Object(Ou.l)(Object(Ou.k)("vec4")),tags:"GLSL",connects:{object:"gl.material"}});var ip=Object(d.a)({"gl.uniform":su,"gl.variable":cu,"gl.if":uu,"gl.fragColor":function(e){return e.needsHotReload=!0,e.typed(function(t){var n=Object(v.a)(t,1)[0],r=n.code||n,a=(n.uniforms,n.variables),i=n.functions;return e.flash(),Object(ku.a)("gl_FragColor = "+r+";",n.uniforms,a,i)})},"gl.x":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"gl_FragCoord.x",hashCode:"gl_FragCoord.x",variables:{},model:function(e){return e},uniforms:{},type:"float"};return function(){return t}},"gl.y":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"gl_FragCoord.y",hashCode:Object(au.a)("gl_FragCoord.y"),variables:{},model:function(e){return e},uniforms:{},type:"float"};return function(){return e.flash(),t}},"gl.+":Kf,"gl.-":function(e,t){return e.needsHotReload=!0,e.typed(Object(gu.b)(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"(".concat(Object(ru.b)(r[0]),") - (").concat(Object(ru.b)(r[1]),")")},t),function(e,t){if(Array.isArray(e)&&Array.isArray(t)){for(var n=[],r=0;r<e.length;r++)n.push(e[r]-t[r]);return n}return e-t}))},"gl.*":Zf,"gl./":function(e,t){return e.needsHotReload=!0,Object(ju.a)(Object(gu.b)(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"(".concat(Object(ru.b)(r[0]),") / (").concat(Object(ru.b)(r[1]),")")},t),function(e,t){return e/t}),e,t)},"gl.dot":function(e,t){return e.needsHotReload=!0,e.typed(Object(iu.a)(function(n){var r=Object(ou.a)(n,t);return e.flash(),"(dot((".concat(Object(ru.b)(r[0]),"), (").concat(Object(ru.b)(r[1]),")))")},t))},"gl.xy":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"gl_FragCoord.xy",hashCode:"gl_FragCoord.xy",variables:{},type:"vec2",model:function(e){return e},uniforms:{}};return function(){return t}},"gl.resolution":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"vec2(width, height)",hashCode:"vec2(width, height)",variables:{},uniforms:{}};return function(){return t}},"gl.width":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"width",hashCode:"width",type:"float"};return function(n){return Object(v.a)(n,1)[0],e.flash(),t}},"gl.height":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"height",type:"float",hashCode:Object(au.a)("height")};return function(n){return Object(v.a)(n,1)[0],e.flash(),t}},"gl.texture2D":id,"gl.textureVec2":function(e,t,n){return e.needsHotReload=!0,e.typed(function(e){var r=Object(v.a)(e,1)[0],a=Object(ru.a)(r,t,n),i=a.codes,o=a.uniforms,s=a.functions,c=a.variables;return c=r.variables,s.texture_vec2={args:{a:"sampler2D",index:"float",length:"float"},returnType:"vec2",body:"\n\nreturn texture2D(a, vec2(index/length, 0.0)).xy;\n"},{code:"texture_vec2(".concat(i[0],", ").concat(Object(ru.b)(i[1]),", ").concat(Object(ru.b)(i[2]),")"),uniforms:o,functions:s,variables:c}})}},ru.c,Sf,Rf,{"gl.offset_v":function(e){return function(e){var t=Object(v.a)(e,1)[0];window.offset_v=t,Object(hi.c)("shader.render")}}},Su,Sh,Qh,{"gl.advect":function(e,t){return function(e){var n=Object(v.a)(e,1)[0],r=Object(ru.a)(n,t),a=r.codes,i=r.closure,o=r.functions,s=r.variables,c=r.uniforms;return(o=Object(d.a)({},o)).advect={args:{tx:"sampler2D",U:"vec2"},returnType:"vec4",body:"\nfloat k = 0.25;\nfloat l = 0.7;\nfloat m = 0.0;\n  vec4 Q = vec4(0.0);\n  vec2 R = vec2(width*2.0, height*2.0);\n \t\n  vec2 O = U,A = U+vec2(1.0,0.0),B = U+vec2(0.0,1.0),C = U+vec2(-1.0,0.0),D = U+vec2(0.0,-1.0);\n  vec4 u,a,b,c,d;\n  float ds = 0.;\n \tvec2 g = vec2(0);\n    vec2 vdv = vec2(0);\n \t\n    float s = 0.5;\n \t\n    u = texture2D(tx, U/R); U -= u.xy*s;\n    a = texture2D(tx, A/R); b = texture2D(tx, B/R); c = texture2D(tx, C/R); d = texture2D(tx, D/R);\n    A -=a.xy*s; B -=b.xy*s; C -=c.xy*s; D -=d.xy*s;     \n    g += vec2(a.z-c.z,b.z-d.z);\n    //vdv += vec2(u.x*(c.x-a.x)+u.y*(d.x-b.x), u.x*(c.y-a.y)+u.y*(d.y-b.y))/2.; \t\n \tQ = texture2D(tx, U/R);\n \tvec4 N = 0.25*(a+b+c+d);\n    float div = 0.25*((c.x-a.x)+(d.y-b.y));\n \tQ.z = N.z-k*div;\n \tQ.xy += g*l;\n    //Q.xy -= vdv*m;\n \t//Q *= 0.9999;\n \tif (iframe < 1.0) Q = vec4(.5,0,0,0);\n \tif (length(U-vec2(0.075,0.15)*R) < 4.0) Q.xyw = vec3(Q.xy*0.5+0.5*vec2(-1.0,0),1.);\n    if (length(U-vec2(0.075,0.5)*R) < 16.0) Q.xyw=vec3(0.,0.,1.);\n    if (length(U-vec2(0.115,0.75)*R)+ length(U-vec2(0.055,0.82)*R)< R.x/12.) Q.xyw=vec3(0.,0.,1.);\n \tif (U.x<1.||U.y<1.||R.x-U.x<1.||R.y-U.y<1.) Q.xy=vec2(.5,0);\nreturn Q;\n"},{closure:i,uniforms:c,type:"vec4",functions:o,code:"advect(".concat(a[0],", ").concat(a[1],")"),variables:s,frames:n.frames}}},"gl.globalUniformRender":function(e){return function(e){var t=Object(v.a)(e,1)[0];window.hardStopRender=!t}},"gl.unpack":lh,"gl.bad_uv":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"bad_uv",hashCode:Object(au.a)("(1.0*gl_FragCoord.xy-vec2(width, height))/height"),variables:{bad_uv:{code:"(1.0*gl_FragCoord.xy-vec2(width, height))/height+vec2(0.0, offset_v)",type:"vec2"}},model:function(e){return e},uniforms:{},type:"vec2"};return function(){return[t,Object(d.a)({},t,{hashCode:Object(au.a)("bad_uv.x"),code:"(bad_uv.x)",type:"float"}),Object(d.a)({},t,{hashCode:Object(au.a)("bad_uv.y"),code:"(bad_uv.y)",type:"float"})]}},"gl.nuv":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"nuv",hashCode:Object(au.a)("((gl_FragCoord.xy/vec2(width, height))/2.0)"),variables:{nuv:{code:"((gl_FragCoord.xy/vec2(width, height))/2.0)",type:"vec2"}},model:function(e){return e},uniforms:{},type:"vec2"};return function(){return[t,Object(d.a)({},t,{hashCode:Object(au.a)("nuv.x"),code:"(nuv.x)",type:"float"}),Object(d.a)({},t,{hashCode:Object(au.a)("nuv.y"),code:"(nuv.y)",type:"float"})]}},"gl.pixel":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"pix",hashCode:Object(au.a)("((1.0/vec2(width, height)) +  vec2(1.0/(2.0*width), 1.0/(2.0*height))"),variables:{pix:{code:"((1.0/vec2(width, height))/2.0)",type:"vec2"}},model:function(e){return e},uniforms:{},type:"vec2"};return function(){return[t,Object(d.a)({},t,{hashCode:Object(au.a)("pix.x"),code:"(pix.x)",type:"float"}),Object(d.a)({},t,{hashCode:Object(au.a)("pix.y"),code:"(pix.y)",type:"float"})]}}},Wd,{"gl.sdfManager":Zd,"sdf.manager":Zd,"gl.normalize":function(e){return e.typed(Object(iu.a)(function(e){var t=Object(ou.a)(e);return"normalize(".concat(Object(ru.b)(t[0]),")")}))},"sdf.simple":function(e){var t=new ih(e);return t.deleteInlet("operations"),t.deleteInlet("SDF Morpher"),t.deleteInlet("transformation matrix"),t.deleteInlet("transformation matrix list"),t.deleteOutlet("GL SDF Evaluators"),t.deleteOutlet("GL SDF List"),t.deleteOutlet("Transformed Positions"),function(){}},"gl.sdfBuilder":$d,"sdf.builder":$d,"gl.rayMarchingManager":Yd,"raymarching.manager":Yd,"gl.mat3":function(e,t,n){return e.typed(Object(iu.a)(function(r){var a=Object(ou.a)(r,t,n);return e.flash(),"mat3(".concat(Object(ru.b)(a[0]),", ").concat(Object(ru.b)(a[1]),", ").concat(Object(ru.b)(a[2]),")")},t,n))},"gl.sdfCopy":Xd,"sdf.copy":Xd,"gl.sdfMultiCopies":ep,"sdf.multiCopies":ep,"gl.sdfCubeLayout":tp,"sdf.cubeLayout":tp,"gl.uv":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"bad_uv",hashCode:Object(au.a)("(1.0*gl_FragCoord.xy-vec2(width, height))/height"),variables:{bad_uv:{code:"(1.0*gl_FragCoord.xy-vec2(width, height))/height+vec2(0.0, offset_v)",type:"vec2"}},model:function(e){return e},uniforms:{},type:"vec2"};return function(){return[t,Object(d.a)({},t,{hashCode:Object(au.a)("bad_uv.x"),code:"(bad_uv.x)",type:"float"}),Object(d.a)({},t,{hashCode:Object(au.a)("bad_uv.y"),code:"(bad_uv.y)",type:"float"})]}}},Fd.c,{"gl.fog":function(e,t){return Object(iu.a)(function(e){var n=Object(ou.a)(e,t);return"1. - exp( -".concat(Object(ru.b)(n[0])," * ").concat(Object(ru.b)(n[1]),")")},t)},"gl.convertCoord":function(e,t){var n=[400,400];return Object(hi.e)("canvas.size",function(e){n=e}),function(e){var r=Object(v.a)(e,1)[0],a=t()||n||[400,400],i=[(2*r[0]-a[0])/a[1],-(2*r[1]-a[1])/a[1]],o=window.offset_v||0;return i[1]+=o,[i]}}},sd,ap,Dd,Bd,qd,{"sdf.layers":function(e){new xd(e);return e.setAttribute("primary-color","transparent"),e.hasInletFields=!0,function(){}}},cd,rd,ad,{"gl.iframe":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"iframe",hashCode:"iframe",variables:{},model:function(e){return e},uniforms:{},type:"float"};return function(){return t}}},nd,Wh,yf,{"gl.model":gu.a,"gl.xyOscilloscope":function(e,t,n,r,a){return e.typed(function(i){var o=Object(v.a)(i,1)[0],s=e.id.replaceAll("-",""),c=Object(ru.a)(o,t,n,r),u=c.codes,l=(c.closure,c.uniforms),f=c.functions,h=c.variables,d=u.map(ru.b),p=Object(v.a)(d,4),m=p[0],y=p[1],b=p[2],g=(p[3],.001*(a()||1)),O="getOscPoint"+s;f[O]={args:{x:"float",leftTexture:"sampler2D",rightTexture:"sampler2D"},returnType:"vec2",body:"\n   float left = x * ".concat(.9375,";\n   float right = fract(x - ").concat(.224399476," / ").concat(.9375,") * ").concat(.9375,";\n    \n   float pointX = texture(leftTexture,vec2(left, 1.0)).x;\n   float pointY = texture(rightTexture,vec2(right, 1.0)).x;\n\n   return vec2(pointX, pointY);\n")};var j="getStereoOscilloscope"+s;return f[j]={args:{uv:"vec2",left:"sampler2D",right:"sampler2D"},returnType:"float",body:"\n    float oneOverN = 1.0 / float(".concat(r()||100,");\n    \n    float posOffset = 0.0;\n    float timeOffset = 0.0;\n    float xOffset = fract(posOffset + timeOffset) * oneOverN;\n    \n    float acc = 0.0;\n    for (int i = 0; i < ").concat(r()||100,"; i++) {\n        float x = float(i) * oneOverN + xOffset;\n        vec2 point = ").concat(O,"(x, left, right);\n\n        vec2 pa = point - uv;\n        float d = dot(pa, pa);\n        \n        acc += 1.0 / (d + ").concat(g,"*").concat(g,"); // Inverse square law\n\t}\n\t\n    return acc * oneOverN * ").concat(3.01," * ").concat(g,";\n")},{functions:f,uniforms:l,code:"".concat(j,"(").concat(b,", ").concat(m,", ").concat(y,")"),type:"float",variables:h}})}});function op(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return sp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sp(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function sp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("uniqueAppend",{value:"",limit:""},"Appends but keeping indices of elements w same id ",function(){return 1},{inlets:2,connects:[{outlet:"Output 1",object:"sdf.manager",inlet:"SDF List"}]});function cp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var up=function(e){Object(u.a)(n,e);var t=cp(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return n}(Ni.a);function lp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var fp=function(e){Object(u.a)(n,e);var t=lp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newOutlet("playing"),r.newOutlet("stepNumber offset"),r.newOutlet("current stepNumber"),r.newOutlet("new percentage"),e.sequencerEngine.mixButtons.push(Object(c.a)(r)),r.newInlet("pause vs stop",function(e){var t=Object(v.a)(e,1)[0];return r.onPauseOrStop(t)}),r.newInlet("toggle play/stop",function(e){var t=Object(v.a)(e,1)[0];return r.onToggle(t)}),r.newInlet("stop",function(e){Object(v.a)(e,1)[0];return r.onStop()}),r.newInlet("seek to percentage",function(e){var t=Object(v.a)(e,1)[0];return r.seek(t)}),r.newInlet("pause",function(e){var t=Object(v.a)(e,1)[0];return r.pause(t)}),r.newInlet("nudge",function(e){var t=Object(v.a)(e,1)[0];return r.nudge(t)}),r.nudgeStorer=0,r}return Object(s.a)(n,[{key:"nudge",value:function(e){var t=this.sequencerEngine.stepNumberOffset+this.sequencerEngine.trackStep;if(t+32*e>=0){var n=this.sequencerEngine.tracks.filter(function(e){return e.sample}).map(function(e){return e.getSamplers()[0].getDuration()}),r=Math.max.apply(Math,Object(h.a)(n))/new re.a.Time("32n").toSeconds();this.sequencerEngine.seekToTrackStep(Math.min(r,t+32*e),void 0,!0)}}},{key:"scheduleNudge",value:function(e,t){this.scheduled={nudge:e,modulo:t}}},{key:"seek",value:function(e){if(e=parseFloat(e),!isNaN(e)){var t=this.sequencerEngine.tracks.filter(function(e){return e.sample}).map(function(e){return e.getSamplers()[0].getDuration()}),n=Math.max.apply(Math,Object(h.a)(t))/new re.a.Time("32n").toSeconds(),r=e/100*n;r-=r%32,r+=(this.sequencerEngine.stepNumberOffset+this.sequencerEngine.trackStep)%32,this.sequencerEngine.seekToTrackStep(r,void 0,!0),this.sendMessage("new percentage",r/n*100)}}},{key:"onToggle",value:function(e){this.sequencerEngine.dispatch(Object(J.Pb)(!0)),this.sequencerEngine.schedulePlay()}},{key:"onStop",value:function(){this.sequencerEngine.stop(),this.sequencerEngine.seekToTrackStep(0),this.sequencerEngine.dispatch(Object(J.Nc)(void 0)),this.sequencerEngine.dispatch(Object(J.B)(void 0)),this.sequencerEngine.dispatch(Object(J.z)(0))}},{key:"sendCurrentStepNumber",value:function(e){this.handleSchedules(e),this.sendMessage("current stepNumber",e)}},{key:"handleSchedules",value:function(e){this.scheduled&&e%this.scheduled.modulo===0&&(e+this.scheduled.nudge>=0&&this.sequencerEngine.seekToTrackStep(e+this.scheduled.nudge,void 0,!0),delete this.scheduled,this.nudgeStorer=0)}},{key:"onPauseOrStop",value:function(e){this.pauseOrStop=e}},{key:"pause",value:function(){this.sequencerEngine.playing&&this.sequencerEngine.play()}},{key:"handleStop",value:function(){if(this.pauseOrStop){var e=this.sequencerEngine.lastTrackStep||0;e+=this.sequencerEngine.stepNumberOffset||0,this.sequencerEngine.stepNumberOffset=e,this.sendMessage("stepNumber offset",e)}}}]),n}(Ni.a);Object(pi.a)("submix",{},"Mix between sub-sequences");Object(pi.a)("mixbuttons",{},"Buttons to start/stop/record",function(){return 0},{inlets:0});function hp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var dp=function(e){Object(u.a)(n,e);var t=hp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet("roll",function(e){var t=Object(v.a)(e,1)[0];return r.onRoll(t)}),r.newInlet("triplet roll",function(e){var t=Object(v.a)(e,1)[0];return r.onRoll(t,!0)}),r.newInlet("enable roll-viewer",function(e){var t=Object(v.a)(e,1)[0];return r.enableRollViewer(t)}),r}return Object(s.a)(n,[{key:"enableRollViewer",value:function(e){e=!!e,this.zObject.dispatch(Object(J.Cb)(e))}},{key:"onRoll",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<=0)this.sequencerEngine.sequenceRolling=!1,this.sequencerEngine.trackRolling=!1;else{var n=new ua.a(e,t);this.sequencerEngine.resolution=n,this.sequencerEngine.sequenceRolling=!0,this.sequencerEngine.trackRolling=!0}}}]),n}(Ni.a);Object(pi.a)("roll",{},"Roller",function(){return 0},{inlets:0});function pp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var vp=function(e){Object(u.a)(n,e);var t=pp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet("Speed",function(e){var t=Object(v.a)(e,1)[0];return r.onSpeed(t)}),r.newInlet("Density",function(e){var t=Object(v.a)(e,1)[0];return r.onDensity(t)}),r.newOutlet("Density "),r.newOutlet("Speed "),r.playhead.system5Objects.push(Object(c.a)(r)),r.densityEffect.system5Objects.push(Object(c.a)(r)),r}return Object(s.a)(n,[{key:"sendSpeeds",value:function(){this.sendMessage("Speed ",this.playhead.speedFactorParameter.get())}},{key:"sendDensities",value:function(){this.sendMessage("Density ",this.densityEffect.densityParameter.get())}},{key:"playhead",get:function(){return this.getRoot().playhead}},{key:"densityEffect",get:function(){return this.getRoot().midiEffects.shadowEffects[0]}},{key:"getRoot",value:function(){for(var e=this.subSequence;!e.tracks;)e=e.subSequence;return e}},{key:"onSpeed",value:function(e){this.playhead.speedFactorParameter.set(e)}},{key:"onDensity",value:function(e){this.getRoot().midiEffects.shadowEffects[0].densityParameter.set(e)}}]),n}(Ni.a);Object(pi.a)("system5",{},"Some system level controls over the subsequence");function mp(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return yp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yp(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function yp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var gp=function(e){Object(u.a)(n,e);var t=bp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).samples=[],r.newInlet("send sample",function(e){var t=Object(v.a)(e,1)[0];return r.sendSample(t)}),r.newOutlet("sample"),r.lastSampleSent=void 0,r}return Object(s.a)(n,[{key:"deleteSample",value:function(e){this.samples=this.samples.filter(function(t){return t!==e})}},{key:"sendSample",value:function(e){("number"!==typeof e||(e=this.samples[e%this.samples.length]))&&(this.sendMessage("sample",e),this.lastSampleSent=e)}},{key:"addSample",value:function(e){this.samples.includes(e)||(this.samples=[].concat(Object(h.a)(this.samples),[e]))}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{samples:this.samples.map(function(e){return e.getId()})})}},{key:"fromJson",value:function(e,t){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.fetchSamples(e.samples)}},{key:"fetchSamples",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=mp(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=11;break}return i=r.value,o=new H.a(i),e.next=8,o.load(!1);case 8:this.addSample(o);case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),n.e(e.t0);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}},e,this,[[1,13,16,19]])}));return function(t){return e.apply(this,arguments)}}()}]),n}(Ni.a);Object(pi.a)("sampleBank",{},"Store samples and send them to tracks",function(){return 0},{inlets:0});function Op(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var jp=function(e){Object(u.a)(n,e);var t=Op(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return n}(Ni.a);Object(pi.a)("ztracker",{},"A tracker for showing/editing a pattern like in the 90s");var kp=n(320);Object(pi.a)("tidal",{},"A tidal sequencer that sends triggers out",void 0,{});Object(pi.a)("outputNumber",{n:"Slot number to send output"},"Sends triggers to specific slot in the pad (1-9)",void 0,{inlets:2});Object(pi.a)("matrix",{},"Creates a 2D array",void 0,{operations:{set:{params:["x","y","value"],description:"Sets value at x, y position"}}});function wp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var xp=function(e){Object(u.a)(n,e);var t=wp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).value=0,r.newInlet("input",function(e){var t=Object(v.a)(e,1)[0];return r.onInput(t)}),r.newOutlet("output"),r}return Object(s.a)(n,[{key:"onInput",value:function(e){this.zObject.flash(),"start"!==e?"bang"===e?this.toggle():0!==e&&1!==e||(this.value=e,this.sendMessage("output",this.value)):this.sendMessage("output",this.value)}},{key:"toggle",value:function(){return this.value=0===this.value?1:0,this.sendMessage("output",this.value),this.value}},{key:"getJson",value:function(e){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e),{value:this.value,needsLoad:!0})}},{key:"fromJson",value:function(e,t){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.value=e.value,e.needsLoad?this.zObject.needsLoad=!0:this.zObject.needsLoad=!1}}]),n}(Ni.a);Object(pi.a)("toggle",{},"Toggles 0/1 when clicked",function(){return 0},{inlets:0});Object(pi.a)("messageSplitter",{},"Splits multi-part message, sending out from each outlet",function(e){return e});Object(pi.a)("messageFilter",{condition:""},"Lets messages pass through when condition is met.",void 0,{isHot:!0,inlets:2});Object(pi.a)("messageFilterLazy",{condition:""},"Lets messages pass through when condition is met.",void 0,{inlets:2});Object(pi.a)("dedupe",{},"only pass if different");Object(pi.a)("dedupe.deep",{},"only pass if different");var Sp=function(e,t){if(!e||!t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0};Object(pi.a)("message.rateLimit",{msg:"",rateLimit:"messages/sec"},"limits messages coming thru by messages/sec",function(){return 1},{inlets:2});Object(pi.a)("message.receivedQuickly",{msg:"",time:""},"Passes message thru if its received 2 in quick succession",function(){return 1},{inlets:2,isHot:!0});Object(pi.a)("record.messages",{messages:""},"Records incoming messages starting from when the record is engaged");Object(pi.a)("play.messages",{messages:""},"Plays output of record.messages starting from when the play is engaged");var Pp={"play.messages":function(e){e.needsTick=!0;var t,n=[],r=[],a=!1,i=void 0,o=void 0,s=function(){a=!0,o=0,r=Object(h.a)(n),t=r.shift()};return function(c){var u=Object(Yi.a)(c),l=u[0];switch(u.slice(1),l){case S.k:return;case 1:return void(a||s());case 0:return void(a=!1);case"play":return void s();case"stop":return void(a=!1);case S.n:if(i=e.sequencerEngine.trackStep,a&&t){var f=i-o;if(t[0]<=f){var h=t;return t=r.shift(),[h[1]]}}return;default:n=l}}},"record.messages":function(e){var t;e.needsTick=!0;var n=[],r=0;return function(a){var i=Object(Yi.a)(a),o=i[0],s=i.slice(1);switch(o){case"clear":return void(n=[]);case S.k:return void re.a.Master.context.currentTime;case S.n:return Object(v.a)(s,1)[0],void(t=e.sequencerEngine.trackStep);default:n.push([t-r,o,re.a.Master.context.currentTime])}return[n]}}};function Ep(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Tp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Tp(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Tp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ap(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Mp=function(e){Object(u.a)(n,e);var t=Ap(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).snapshots=[],r.newInlet("cursor",function(e){var t=Object(v.a)(e,2),n=t[0],a=t[1];return r.cursor=[n,a]}),r.newInlet(S.o,function(e){var t=Object(v.a)(e,1)[0];r.tidals=t}),r.newInlet("take snapshot",function(e){return r.takeSnapshot(e)}),r.newInlet("use snapshot",function(e){var t=Object(v.a)(e,1)[0];return r.useSnapshot(t)}),r.newOutlet("cursor"),r}return Object(s.a)(n,[{key:"takeSnapshot",value:function(){if(this.tidals&&this.cursor){var e,t=[],n=Ep(this.tidals);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=r.cycle,i=r.cycleLength;t.push([a,i])}}catch(o){n.e(o)}finally{n.f()}this.snapshots=[].concat(Object(h.a)(this.snapshots),[{tidals:t,cursor:this.cursor}])}}},{key:"useSnapshot",value:function(e){var t=this.snapshots[e];t&&this.sendMessage.apply(this,["cursor"].concat(Object(h.a)(t.cursor)))}}]),n}(Ni.a);Object(pi.a)("jsnapshot",{},"Takes snapshots of the jaki object parameters to be recalled and sequenced",function(){return 0},{inlets:0});function Rp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Cp=function(e){Object(u.a)(n,e);var t=Rp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newOutlet("up"),r.newOutlet("down"),r.newOutlet("right"),r.newOutlet("left"),r.newOutlet("A"),r.newOutlet("B"),r}return n}(Ni.a);Object(pi.a)("dpad",{},"A d-pad interface for controlling via bangs",function(){return 0},{inlets:0});function Np(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ip=function(e){Object(u.a)(n,e);var t=Np(n);function n(e){var r;return Object(o.a)(this,n),r=t.call(this,e),e.setAttribute("primary-color","#cdcdcd"),e.setAttribute("secondary-color","#b4b4b4"),r}return n}(Ni.a);Object(pi.a)("cirklon",{},"Cirklon sequencer interface",function(){return 0},{inlets:0});function qp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var _p=function(e){Object(u.a)(n,e);var t=qp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet("pattern switch",function(e){return r.patternSwitch([e])}),r.newOutlet("pattern switched"),r}return Object(s.a)(n,[{key:"patternSwitch",value:function(e){var t=this.zObject;e=Math.round(e);for(var n=t.subSequence;;){var r=t.subSequence;if(!r.zObject){n=t.subSequence;break}t=r.zObject}this.sequencerEngine.switchToPattern(e-1,void 0,n)}}]),n}(Ni.a);Object(pi.a)("patterns",{},"Patterns manager",function(){return 0},{tags:"Sequencer",inlets:0});function Dp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Fp=function(e){Object(u.a)(n,e);var t=Dp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet(S.o,function(e){return r.tidals=e[0]}),r.newInlet("toggle lock",function(e){return r.lock(e[0])}),r}return Object(s.a)(n,[{key:"lock",value:function(e){this.tidals[e]&&this.tidals[e].lockGroove(!this.tidals[e].cycleParameter.immutable)}}]),n}(Ni.a);Object(pi.a)("jrepl",{},"Analyze & control underlying tidal patterns in a jaki object",function(){return 0},{inlets:0});var Lp=n(361),Bp=n(326),zp=n(288);function Jp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Vp=function(e){Object(u.a)(n,e);var t=Jp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e,!1)).store=e.sequencerEngine.store,r.track=e,r.parameters=[],r.loaded=!0,r.valueParameter=new he.a("value",Object(c.a)(r),function(e,t,n,a){return r.onValue(t,a)},{defaultValue:0}),r.setupRampParameters(),e.effect=Object(c.a)(r),r.value=0,r.context=(new X.a).forZObject(Object(c.a)(r)),r.newInlet("value",function(e){var t=Object(v.a)(e,1)[0];return r.setValue(t)}),r.newInlet("map parameter",function(e){var t=Object(v.a)(e,1)[0];return r.onMapParameter(t)}),r.newOutlet("value changed"),r.newOutlet("map parameter "),r.zObject.newAttribute("set exactly",!1),r}return Object(s.a)(n,[{key:"onMapParameter",value:function(e){if(e.audioParam||Array.isArray(e)){var t,n;if(e.audioParam)"depth"===(t=e).name&&t.set(0),n=100;else{var r=Object(v.a)(e,3),a=r[0],i=r[1];if(n=r[2],!i||!a)return;t=a.parameters.find(function(e){return e.name.toLowerCase().includes(i.toLowerCase())})}t&&(this._parameters.includes(t)||this.lostParameters&&this.lostParameters.find&&this.lostParameters.find(function(e){return e.id===t.id})||this.setParameter(t),this.depthParameters[this._parameters.length-1]&&this.depthParameters[this._parameters.length-1].set(n||1))}}},{key:"getJson",value:function(){return Object(d.a)({},this.getMappableJson(),{id:this.id,value:this.value})}},{key:"fromJson",value:function(e,t){this.loaded=!1,Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),void 0!==e.value&&(this.value=e.value),this.loaded=!0,this.sendMessage("value changed",e.value)}},{key:"sortParameters",value:function(){}},{key:"min",get:function(){return 0}},{key:"max",get:function(){return 1}},{key:"value",get:function(){return this.valueParameter.get()},set:function(e){this.valueParameter.set(e,!0,!0),this.zObject.onValueChange(e)}},{key:"setValue",value:function(e){this.valueParameter.set(e,!1,!0)}},{key:"onValue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.value,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re.a.Master.context.currentTime;if(this.loaded&&e!==this.lastValue&&!isNaN(e)){this.zObject.onValueChange(e),this.sequencerEngine.playing||this.sequencerEngine.dispatch(Object(J.wb)(this.id,e));for(var n={},r=0;r<this._parameters.length;r++){var a=this._parameters[r],i=a.max,o=a.min,s=this.getDepth(r),c=this.initialParameterValues[r],u=s<0?c-o:i-c,l=c+e*(this.getDepth(r)/100)*u,f=a.set(this.zObject.attributes["set exactly"]?e:Math.min(i,Math.max(o,l)),!0,!0,t,this.rampTime/1e3),h=f.id,p=f.value;n[h]=p}this.lastValue=e,this.sequencerEngine.playing?this.parametersToUpdate=Object(d.a)({},this.parametersToUpdate,n):this.sequencerEngine.dispatch(Object(J.xb)(n)),this.sendMessage("value changed",e)}}},{key:"fromValueJson",value:function(e){e.value&&(this.value=e.value)}},{key:"getValueJson",value:function(){return{value:this.value}}}]),n}(Object(Bp.a)(Object(zp.a)(Object(Lp.a)(Ni.a))));Object(pi.a)("macro",{name:""},"Map several parameters to a macro object to control",function(){return 0},{inlets:0});var Hp=n(379),Up=Object(Hp.a)();function Gp(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Wp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wp(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Wp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Kp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Qp=function(e){Object(u.a)(n,e);var t=Kp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newOutlet("script"),r.code="",r.logs=[],r.storedMatches=[],r}return Object(s.a)(n,[{key:"clearErrors",value:function(e){this.syntaxErrors=void 0}},{key:"onNewErrors",value:function(e){var t=e[0];if(!(t.length<7)){var n=t[6].split("\n"),r=t[7].split("\n"),a=this.checkCode(n,!0),i=this.checkCode(r);this.syntaxErrors=a||i}}},{key:"checkCode",value:function(e,t){var n,r=0,a=-1,i=-1,o=this.code.split("\n").filter(function(e){return""!==e}),s=Gp(e);try{for(s.s();!(n=s.n()).done;){var c=n.value;c.includes(o[0])&&(i=r),c.includes("1: #version 300 es")&&(a=r),c.includes("equirectUv")&&(i=r+6),t&&c.startsWith("57:")&&(i=r+1),r++}}catch(h){s.e(h)}finally{s.f()}var u,l=[],f=Gp(e.slice(1,a));try{for(f.s();!(u=f.n()).done;){var h=u.value;if(!h.includes("#version")){var d=h.split(" ")[1].split(":")[1],p=parseFloat(d)-i;p+=t?1:2,l.push({lineNumber:p,errorMessage:h.slice(h.indexOf(d)+d.length)})}}}catch(h){f.e(h)}finally{f.f()}var v=e.slice(i).map(function(e){return e.slice(e.indexOf(":")+2)}),m=this.parsedCode||this.code;if(1!==v.length)return v.every(function(e){return m.includes(e)})?l:void 0}},{key:"getJson",value:function(e){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e),{code:this.code})}},{key:"fromJson",value:function(e,t){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.code=e.code}},{key:"doc",get:function(){return Up}},{key:"eval",value:function(e){this.code=e}},{key:"hasSyntaxError",value:function(e){return!1}},{key:"code",get:function(){return this._script},set:function(e){this._script=e,e=this.parseScript(e),this.sendMessage("script",e)}},{key:"parsedCode",get:function(){this.parseScript(this._script)}},{key:"parseScript",value:function(e){var t=this;if(e){var n=e.match(/@[a-z]*/g);if(!n)return e;var r,a=Gp(n);try{var i=function(){var n=r.value,a=n.slice(1);t.inlets[a]||t.newInlet(a,function(e){var n=Object(v.a)(e,1)[0];t.storedMatches[a]=n,t.eval(t.code)}),e=e.replaceAll(n,t.storedMatches[a]||"")};for(a.s();!(r=a.n()).done;)i()}catch(o){a.e(o)}finally{a.f()}return e}}}]),n}(Ni.a);Object(pi.a)("script",{},"Write script to control some other object that uses scripting",function(){return 0},{tags:"Scripting",inlets:0});Object(pi.a)("envelope.attack",{number:""},"Triggers envelope specified by nnumber",function(){return 0});Object(pi.a)("envelope.release",{number:""},"Triggers envelope specified by nnumber",function(){return 0});var Zp={"envelope.attack":function(e,t){return function(){for(var n=e.subSequence;!n.tracks&&n.subSequence;)n=n.subSequence;n.envelopesTrack.envelopes[t()||0].envelope.triggerAttack()}},"envelope.release":function(e,t){return function(){for(var n=e.subSequence;!n.tracks&&n.subSequence;)n=n.subSequence;n.envelopesTrack.envelopes[t()||0].envelope.triggerRelease()}}},Yp=n(619);Object(pi.a)("key.shortcut",{bang:"",key:""},"Listens for key press events and triggers a bang when they occur",void 0,{tags:"Keyboard",isHot:!0,inlets:2});Object(pi.a)("key.down",{bang:"",key:""},"Listens for key press events and triggers a bang when they occur",void 0,{tags:"Keyboard",isHot:!0,inlets:2});Object(pi.a)("key.up",{bang:"",key:""},"Listens for key up events and triggers a bang when they occur",void 0,{tags:"Keyboard",isHot:!0,inlets:2});var $p={"key.shortcut":function(e,t){var n=void 0;e.needsLoad=!0;var r=function(t){if(!Object(Yp.a)(t)&&t.key===n){if(e.sequencerEngine.isAnyTrackEnabled())return;e.sendMessage(e.outputByNumber(0),"bang")}};return window.addEventListener("keydown",r),function(a){var i=t();if("dispose"===a[0])return n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.removeBinding(n),void window.removeEventListener("keydown",r);n&&i!==n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.removeBinding(n),i&&i!==n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.addBinding(i),n=i}},"key.up":function(e,t){var n=void 0;e.needsLoad=!0;var r=function(t){if(!Object(Yp.a)(t)&&t.key===n){if(e.sequencerEngine.isAnyTrackEnabled())return;e.sendMessage(e.outputByNumber(0),"bang")}};return window.addEventListener("keyup",r),function(a){var i=t();if("dispose"===a[0])return n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.removeBinding(n),void window.removeEventListener("keyup",r);n&&i!==n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.removeBinding(n),i&&i!==n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.addBinding(i),n=i}},"key.down":function(e,t){var n=void 0;e.needsLoad=!0;var r=function(t){if(!Object(Yp.a)(t)&&t.key===n){if(e.sequencerEngine.isAnyTrackEnabled())return;e.sendMessage(e.outputByNumber(0),"bang")}};return window.addEventListener("keydown",r),function(a){var i=t();if("dispose"===a[0])return n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.removeBinding&&e.sequencerEngine.keyListener.removeBinding(n),void window.removeEventListener("keydown",r);n&&i!==n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.removeBinding(n),i&&i!==n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.addBinding(i),n=i}}};Object(pi.a)("store",{bang:"","stored message":""},"Stores a message until it receives a bang, which triggers it to send that stored message",void 0,{tags:"Messages",inlets:2});var Xp=n(311),ev=(n(200),n(976));function tv(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return nv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nv(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function nv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("centroid",{pts:""},"Centoid of ist of poinnts");var rv=function(){return function(e){for(var t=Object(v.a)(e,1)[0],n=0,r=0,a=0;a<t.length;a+=2)n+=t[a],r+=t[a];return[[n/(t.length/2),r/(t.length/2)]]}};Object(pi.a)("dHull",{pts:"",length:""},"computes hull for pts index",void 0,{inlets:2,isHot:!0,tags:"Graphics"});var av=function(e,t,n){return e<n&&n<t||e>n&&n>t},iv=function(e,t,n,r,a){if(1===e.length)return 0;for(var i=e.length,o=[],s=0;s<i;s++){var c=s,u=(s+1)%i;lv(n[2*c],n[2*c+1],n[2*u],n[2*u+1])<20||(av(e[c],e[u],t)||s===i-1&&av(e[c],2*Math.PI-e[u],t))&&o.push(c)}for(var l=1e5,f=void 0,h=0,d=o;h<d.length;h++){var p=d[h],v=p,m=(p+1)%i,y=(lv(n[2*v],n[2*v+1],r,a)+lv(n[2*m],n[2*m+1],r,a))/2;0===m&&(y*=1.7),y>140||y<l&&(l=y,f=m)}return f},ov=function(e,t,n){for(var r=0,a=0;a<e.length;a+=2){var i=a/2;t.includes(i)||(n[r++]=e[a],n[r++]=e[a+1])}};function sv(e,t,n){for(var r=arguments.length,a=new Array(r>3?r-3:0),i=3;i<r;i++)a[i-3]=arguments[i];return 1===arguments.length?e:(t=Math.max(t,0),n=Math.max(n,0),a=a||[],e.set(e.subarray(t+n,e.length-a.length),t+a.length),e.set(a,t),e)}var cv=function(e,t,n,r){r.sort(function(r,a){return uv(e,t,r,n)-uv(e,t,a,n)})},uv=function(e,t,n,r){var a,i=1e5,o=t[2*n],s=t[2*n+1],c=tv(r);try{for(c.s();!(a=c.n()).done;){var u=a.value,l=e[2*u],f=e[2*u+1],h=lv(l,f,o,s);h<10&&(h*=1e4),h<i&&(i=h)}}catch(d){c.e(d)}finally{c.f()}return i},lv=function(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))};Object(pi.a)("loadBang",{},"Sends bang on load",void 0,{tags:"Bang"});Object(pi.a)("startBang",{},"Sends bang on start",void 0,{tags:"Bang"});Object(pi.a)("averageDistance",{a:"",b:""},"Computes average distance",void 0,{inlets:2});Object(pi.a)("average",{list:"",b:""},"Computes average of list",void 0,{inlets:1});var fv=n(572);Object(pi.a)("three.shaderMaterial",{},"Creates a material out of shaders",function(){return 0},{tags:"Graphics",inlets:0,connects:{object:"three.mesh",inlet:"1"}});Object(pi.a)("three.basicMaterial",{color:"",wireframe:""},"Creates a basic material with color in 2nd inlet",void 0,{tags:"Graphics",isHot:!0,inlets:2,connects:{object:"three.mesh",inlet:"1"}});Object(pi.a)("three.vertexColorsMaterial",{color:"",wireframe:""},"Creates a basic material with color in 2nd inlet",void 0,{tags:"Graphics",isHot:!0,inlets:2,connects:{object:"three.mesh",inlet:"1"}});Object(pi.a)("three.setVertexColors",{color:"",wireframe:""},"Creates a basic material with color in 2nd inlet",void 0,{tags:"Graphics",isHot:!0,inlets:2,connects:{object:"three.mesh",inlet:"1"}});Object(pi.a)("three.pointsMaterial",{color:""},"Creates a basic material with color in 2nd inlet",void 0,{tags:"Graphics",inlets:1});var hv={"three.vertexColorsMaterial":function(e,t){var n=new ml.B({vertexColors:!0,wireframe:!1,blending:ml.a});return n.side=ml.o,n.needsUpdate=!0,function(e){var r=Object(v.a)(e,1)[0];return r&&"string"===typeof r&&(r=new ml.k(r)),n.color=r||16777215,n.side=ml.o,n.wireframe=!!t(),n.needsUpdate=!0,[n]}},"three.setVertexColors":function(e,t){return function(e){for(var n=Object(v.a)(e,1)[0],r=n.getAttribute("position"),a=t()||[],i=[],o=new ml.k,s=0;s<r.count;s+=3)o.set(a[s%a.length]||16777215*Math.random()),i.push(o.r,o.g,o.b),i.push(o.r,o.g,o.b),i.push(o.r,o.g,o.b);return n.setAttribute("color",new ml.q(i,3)),[n]}},"three.pointsMaterial":function(e,t){var n=new ml.N({color:16777215,blending:ml.a});return n.needsUpdate=!0,function(e){var t=Object(v.a)(e,1)[0];return t&&"string"===typeof t&&(t=new ml.k(t)),n.color=t||16777215,n.needsUpdate=!0,[n]}},"three.basicMaterial":function(e,t){var n=new ml.B({color:16777215,wireframe:!1,blending:ml.a});return n.side=ml.o,n.needsUpdate=!0,function(e){var r=Object(v.a)(e,1)[0];return r&&"string"===typeof r&&(r=new ml.k(r)),n.color=r||16777215,n.side=ml.o,n.wireframe=!!t(),n.needsUpdate=!0,[n]}},"three.shaderMaterial":function(e){var t=new fv.a(e);return e.effect=t,function(){}}};n(860);function dv(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return pv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pv(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function pv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("spline",{tension:"",points:""},"Returns cubic spline",void 0,{tags:"Graphics",inlets:3});Object(pi.a)("convexHull",{},"Returns convex hull as Float32Array of pts");Object(pi.a)("delaymessage",{},"Sends bang message to outlets in order (left-to-right). Each argument creates an outlet eg: bangbang 0 0 0 0 ceates 4 outlets)",function(e){return e},{inlets:2,tags:"Bang"});Object(pi.a)("bangbang",{},"Sends bang message to outlets in order (left-to-right). Each argument creates an outlet eg: bangbang 0 0 0 0 ceates 4 outlets)",function(e){return e},{inlets:1,tags:"Bang"});Object(pi.a)("messagemessage",{},"Sends messages to outlets in order (left-to-right). Each argument creates an outlet eg: bangbang 0 0 0 0 ceates 4 outlets)",function(e){return e},{inlets:1,tags:"Bang"});Object(pi.a)("altbang",{},"Sends bang message to outlet alternating order (left-to-right)",function(e){return e},{inlets:1,tags:"Bang"});Object(pi.a)("alt",{},"Sends message to outlet alternating order (left-to-right)",function(e){return e},{inlets:1,tags:"Order"});Object(pi.a)("ifSend",{},"Sends message if argument is true",function(e){return 1},{inlets:2});Object(pi.a)("randomThru",{},"Sends message to a randomly selected outlet",function(e){return e},{inlets:1,tags:"Order"});var vv={randomThru:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.needsStart=!0,function(t){var r=Object(v.a)(t,1)[0];if(r!==S.k){var a=n.filter(function(e){return void 0!==e()}).length,i=Math.floor(Math.random()*a);e.sendMessage(e.outputByNumber(i),r)}}},ifSend:function(e,t){return function(e){if(t())return e}},messagemessage:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t=[];return n.forEach(function(n,r){void 0===n()&&t.push(void 0),t.push(e[0])}),t}},alt:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=0;return e.needsStart=!0,function(t){var r=Object(v.a)(t,1)[0];if(r!==S.k){var i=n.filter(function(e){return void 0!==e()}),o=a++%i.length;e.sendMessage(e.outputByNumber(o),r)}else a=0}},bangbang:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(t){n.forEach(function(t,n){void 0!==t()&&e.sendMessage(e.outputByNumber(n),"bang")})}},altbang:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=0;return e.needsStart=!0,function(t){if(Object(v.a)(t,1)[0]!==S.k){var r=n.filter(function(e){return void 0!==e()}),i=a++%r.length;e.sendMessage(e.outputByNumber(i),"bang")}else a=0}},delaymessage:function(e,t){return function(n){var r=Object(v.a)(n,1)[0];isNaN(t())||setTimeout(function(){e.sendMessage(e.outputByNumber(0),r)},t())}}};Object(pi.a)("three.orthographicCamera",{left:"",right:"",top:"",bottom:"",near:"",far:""},"Create an orthographic camera ",void 0,{tags:"Graphics",isHot:!0,inlets:7,connects:{object:"three.render",inlet:"1"},operations:mv});var mv={position:{parameters:["x","y","z"],description:"Sets the position of the camera."},lookAt:{parameters:["x","y","z"],description:"Sets where the camera is pointing"},zoom:{parameters:["amount"],description:"Sets the zoom of the camera"}},yv=function(e){return e.split(" ").filter(function(e){return""!==e}).slice(1).map(function(e){return parseFloat(e)})},bv=function(e,t){if("bang"===t)return!1;if("string"===typeof t){if(t.startsWith("position")){var n=yv(t),r=Object(v.a)(n,3),a=r[0],i=r[1],o=r[2];return e.position.x=a,e.position.y=i,e.position.z=o,!0}if(t.startsWith("lookAt")){var s=yv(t),c=Object(v.a)(s,3),u=c[0],l=c[1],f=c[2];return e.lookAt(u,l,f),!0}if(t.startsWith("zoom")){var h=yv(t),d=Object(v.a)(h,1)[0];return e.zoom=d,!0}}return!1};Object(pi.a)("three.perspectiveCamera",{fov:"",aspect:"",near:"",far:""},"Create a perspective camera ",void 0,{tags:"Graphics",isHot:!0,inlets:5,operations:mv,connects:{object:"three.render",inlet:"1"}});var gv=function(e,t){return void 0===e?t:e},Ov={"three.orthographicCamera":function(e,t,n,r,a,i,o){e.needsStart=!0;var s=new ml.I(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1e4,1e4);return s.position.z=0,s.position.y=0,s.position.x=0,function(e){var c=Object(v.a)(e,1)[0];bv(s,c);var u=gv(t(),-1),l=gv(n(),1),f=gv(r(),-1),h=gv(a(),1),d=gv(i(),1),p=gv(o(),1);return s.left=u,s.right=l,s.top=f,s.bottom=h,s.far=p,s.near=d,s.updateProjectionMatrix(),s}},"three.perspectiveCamera":function(e,t,n,r,a){var i=new ml.J(80,1,1,1e4);return i.position.z=5,e.needsStart=!0,function(e){var o=Object(v.a)(e,1)[0];bv(i,o);var s=gv(t(),80),c=gv(n(),1),u=gv(r(),1),l=gv(a(),1e4);return i.fov=s,i.aspect=c,i.far=l,i.near=u,i.updateProjectionMatrix(),[i]}}};Object(pi.a)("three.mesh",{geometry:"",material:""},"Create a mesh out of geometry and material",function(){return 1},{isHot:!0,inlets:2,connects:{object:"three.scene"},operations:{position:{parameters:["x","y","z"],description:"Sets the position of the mesh."},rotation:{parameters:["x","y"],description:"Rotates the mesh."}}});var jv=function(e,t){var n,r,a;return function(e){var i=Object(v.a)(e,1)[0];if("string"===typeof i)if(i.startsWith("position")){var o=i.split(" ").slice(1).map(function(e){return parseFloat(e)}),s=Object(v.a)(o,3),c=s[0],u=s[1],l=s[2];n&&(n.position.set(c,u,l),n.needsUpdate=!0)}else if(i.startsWith("rotation")){var f=i.split(" ").slice(1).map(function(e){return parseFloat(e)}),h=Object(v.a)(f,2),d=h[0];h[1];n&&(n.rotation.x=d,n.rotation.y=d)}if(Array.isArray(i)?i=a:a=i,i&&i.attributes||n)return(!n||Qu(t)&&r!==Qu(t))&&((r=Qu(t)||new ml.B({color:4388225,wireframe:!0})).side=ml.o,r.needsUpdate=!0,n?n.material=r:n=new ml.A(i,r)),[n]}};Object(pi.a)("three.cube",{x:"",y:"",z:""},"Create a cube",function(){return 1},{tags:"Graphics",isHot:!0,inlets:3});Object(pi.a)("three.gridHelper",{},"Grid helper",function(){return 1},{tags:"Graphics"});Object(pi.a)("three.points",{points:"",size:"",material:"",isStatic:""},"Creates an object of poinntss to be added to a scene",void 0,{tags:"Graphics",isHot:!0,inlets:4});Object(pi.a)("three.attribute",{mesh:"",name:"",itemSize:"",array:""},"Receives a Mesh object and sets an attribute with the arguments",void 0,{tags:"Graphics",inlets:4});var kv={"three.attribute":function(e,t,n,r){var a=!1;return function(e){var i=Object(v.a)(e,1)[0];if(i&&i.geometry&&t()&&n()&&r()){var o=i.geometry;return a&&o.attributes[t()].array.length===r().length?(o.attributes[t()].array.set(r(),0),o.attributes[t()].needsUpdate=!0):o.setAttribute(t(),new ml.g(r(),n())),a=!0,[i]}}},"three.points":function(e,t,n,r){var a,i,o,s=void 0;return function(e){var c=Object(v.a)(e,1)[0];if(ArrayBuffer.isView(c))if(!a||n()&&n()!==o.material){a||(a=new ml.h);var u=c;r()||(u=new Float32Array(2*c.length)).set(c,0),a.setAttribute("position",new ml.q(u,3)),i=n()||new ml.N({color:10079487,size:t()||1}),o?(o.material=i,o.material.needsUpdate=!0):o=new ml.M(a,i),a.setDrawRange(0,c.length/3)}else!r()&&a.attributes.position.array.length<c.length?(a.setAttribute("position",new ml.q(c,3)),a.attributes.position.needsUpdate=!0):r()||(a.attributes.position.array.set(c,0),a.attributes.position.needsUpdate=!0),a.setDrawRange(0,c.length/3),s!==(t()||1)&&(o.material.size=t()||1,o.material.needsUpdate=!0,s=o.material.size);return[o]}},"three.gridHelper":function(){var e=new ml.s(10,10);return function(){return[e]}},"three.cube":function(e,t,n){var r=new ml.e(100,100,100),a=new ml.E;a.side=ml.o;var i=new ml.A(r,a);return function(e){var r=Object(v.a)(e,1)[0];return i.position.x=void 0===r?2:r,i.position.y=void 0===t()?2:t(),i.position.z=void 0===n()?2:n(),[i]}},"three.mesh":jv};Object(pi.a)("float32Array",{list:""},"creates a Float32Array out of a list",void 0,{tags:"List"});function wv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var xv=function(e){Object(u.a)(n,e);var t=wv(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ml.U([new ml.bb(0,.5),new ml.bb(-.5,-.5),new ml.bb(.5,-.5)]),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return Object(o.a)(this,n),(e=t.call(this)).inited=!1,e.updateShapes(r,a),e}return Object(s.a)(n,[{key:"updateShapes",value:function(e,t){this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};var n=[],r=[],a=[],i=[],o=0,s=0;if(!1===Array.isArray(e))u(e);else for(var c=0;c<e.length;c++)u(e[c]),this.addGroup(o,s,c),o+=s,s=0;function u(e){var o=r.length/3,c=e.extractPoints(t),u=c.shape,l=c.holes;!1===ml.V.isClockWise(u)&&(u=u.reverse());for(var f=0,h=l.length;f<h;f++){var d=l[f];!0===ml.V.isClockWise(d)&&(l[f]=d.reverse())}for(var p=ml.V.triangulateShape(u,l),v=0,m=l.length;v<m;v++){var y=l[v];u=u.concat(y)}for(var b=0,g=u.length;b<g;b++){var O=u[b];r.push(O.x,O.y,0),a.push(0,0,1),i.push(O.x,O.y)}for(var j=0,k=p.length;j<k;j++){var w=p[j],x=w[0]+o,S=w[1]+o,P=w[2]+o;n.push(x,S,P),s+=3}}this.inited&&this.index.array.length>=n.length?(this.index.array.set(n,0),this.index.needsUpdate=!0):(this.setIndex(n),this.index.needsUpdate=!0),this.inited&&this.attributes.position.array.length>=r.length?(this.attributes.position.array.set(r,0),this.attributes.position.needsUpdate=!0):(this.setAttribute("position",new ml.q(r,3)),this.attributes.position.needsUpdate=!0),this.inited&&this.attributes.normal.array.length>=a.length?(this.attributes.normal.array.set(a,0),this.attributes.normal.needsUpdate=!0):(this.setAttribute("normal",new ml.q(a,3)),this.attributes.normal.needsUpdate=!0),this.inited&&this.attributes.uv.array.length>=i.length?(this.attributes.uv.array.set(i,0),this.attributes.uv.needsUpdate=!0):(this.setAttribute("uv",new ml.q(i,2)),this.attributes.uv.needsUpdate=!0),this.inited&&this.computeVertexNormals(),this.inited=!0,this.setDrawRange(0,n.length)}},{key:"toJSON",value:function(){var e=Object(fe.a)(Object(f.a)(n.prototype),"toJSON",this).call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var a=e[n];t.shapes.push(a.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}],[{key:"fromJSON",value:function(e,t){for(var r=[],a=0,i=e.shapes.length;a<i;a++){var o=t[e.shapes[a]];r.push(o)}return new n(r,e.curveSegments)}}]),n}(ml.h);Object(pi.a)("three.bufferGeometry",{vertices:"",itemSize:"",index:""},"Create a BufferGeometry (to be passed to three.mesh)",function(){return 1},{tags:"Graphics",inlets:3,connects:{object:"three.mesh"}});var Sv=function(e,t,n){var r=new ml.h,a=!1,i=!1;return function(e){var o=Object(v.a)(e,1)[0];if(o&&o.buffer){if(a)o.length>r.attributes.position.array.length?r.attributes.position.array=o:r.attributes.position.array.set(o,0),i=!1;else{var s=new Float32Array(2*o.length);s.set(o,0),r.setAttribute("position",new ml.g(s,Qu(t)||3)),a=!0}r.attributes.position.needsUpdate=!0}if(Qu(n)&&"string"!==typeof Qu(n)&&!i){if(r.index&&r.index.array.length>=Qu(n).length)r.index.array.set(Qu(n),0);else{var c=new Uint32Array(2*Qu(n).length);c.set(Qu(n),0),r.setIndex(new ml.g(c,1))}r.index.needsUpdate=!0,r.computeVertexNormals(),r.attributes.normal.needsUpdate=!0,i=!0}if(Qu(n)&&r.setDrawRange(0,Qu(n).length),i)return[r]}};Object(pi.a)("three.circleGeometry",{bang:"Sends the geometry out through the outlet"},"Create a simple circle geometry (to be passed to mesh)",function(){return 1},{tags:"Graphics",connects:{object:"three.mesh"}});Object(pi.a)("three.planeGeometry",{width:"",height:""},"Create a PlaneGeometry(to be passed to three.mesh)",function(){return 1},{tags:"Graphics",inlets:2,connects:{object:"three.mesh"}});Object(pi.a)("three.renderTarget",{width:"",height:""},"Set the renderTarget for a canvas",function(){return 2},{tags:"Graphics",inlets:2,outlets:["target","texture"],connects:{object:"three.canvas",inlet:"renderTarget"}});Object(pi.a)("three.torus",{x:"",y:"",z:""},"Create a cube",function(){return 1},{tags:"Graphics",inlets:3});Object(pi.a)("three.boxGeometry",{},"Create a simple box geometry (to be passed to mesh)",function(){return 1},{tags:"Graphics",connects:{object:"three.mesh"}});Object(pi.a)("three.shapeGeometry",{vertices:"List of points",segmentLength:"Number of segments"},"Create a simple box geometry (to be passed to mesh)",function(){return 1},{tags:"Graphics",inlets:2,connects:{object:"three.mesh"}});var Pv={"three.shapeGeometry":function(e,t){var n;return function(e){for(var r=Object(v.a)(e,1)[0],a=[],i=0;i<r.length;i+=2)a.push(new ml.bb(r[i],r[i+1]));var o=t()||200;return n?n.updateShapes(new ml.U(a),o):n=new xv(new ml.U(a),o),[n]}},"three.circleGeometry":function(e){var t=new ml.j(140,64);return function(n){return Object(v.a)(n,1)[0],console.log("sending circle geometry out",e.subSequence.zObject.args[0],t),[t]}},"three.boxGeometry":function(e,t,n,r,a,i,o){return function(e){return Object(v.a)(e,1)[0],[new ml.f(t()||100,n()||100,r()||100,a()||10,i()||10,o()||10)]}},"three.torus":function(e,t,n){var r=new ml.Z(100,25,15,30),a=new ml.B({color:5592405}),i=new ml.A(r,a);return function(e){return Object(v.a)(e,1)[0],[i]}},"three.renderTarget":function(e,t){var n=new ml.eb(300,300,{minFilter:ml.x,magFilter:ml.x,format:ml.P});return function(e){var r=Object(v.a)(e,1)[0];return"texture"===r?[void 0,n.texture]:"bang"===r?[n]:(r&&t()&&(r!==n.width||t()!==n.height)&&(n=new ml.eb(r,t(),{minFilter:ml.x,magFilter:ml.G,format:ml.P})),[n])}},"three.bufferGeometry":Sv,"three.planeGeometry":function(e,t){var n=new ml.L(300,300);return function(t){return Object(v.a)(t,1)[0],e.geometry=n,[n]}}};Object(pi.a)("three.planeRenderer",{material:"","add to scene":""},"Renders a material as a plane",function(){return 1},{isHot:!0,inlets:2,connects:[{inlet:"operation",outlet:"Output 1",object:"three.canvas"}]});var Ev=0,Tv=0,Av=function(){function e(t){Object(o.a)(this,e),this.id=Tv++,this.zCanvas=t,this.zObject=t.zObject,this.sequencerEngine=this.zObject.sequencerEngine,this.subSequence=this.zObject.subSequence,this.isInitialized=!1,this.renderTargets=[]}return Object(s.a)(e,[{key:"addToScene",value:function(e){console.log("adding to scene",e),console.log("add to scene=",this.planeRenderer),this.planeRenderer.function([e])}},{key:"render",value:function(){if(this.operation){this.checkRenderTargetSizes();var e=this.renderTarget,t=this.alternateRenderTarget;this.hasFeedback?(this.onRenderTarget(e),this.bindInputTexture(t.texture),this.swapTargets()):this.onRenderTarget(e),this.drawFrame(),this.outputTexture&&!this.hasFeedback&&this.bindOutputTexture(e.texture),this.hasFeedback&&(this.hasNextFrame()?this.bindOutputTexture(t.texture):this.onRenderTarget(null),this.drawFrame())}}},{key:"indexOf",value:function(){return this.zCanvas.frames.indexOf(this)}},{key:"hasNextFrame",value:function(){return void 0!==this.zCanvas.frames[this.indexOf()+1]}},{key:"drawFrame",value:function(){var e;(e=this.zCanvas).onOperation.apply(e,Object(h.a)(this.operation))}},{key:"bindInputTexture",value:function(e){window.stopRender=!0,"function"===typeof this.inputTexture&&(this.inputTexture([e],!0),window.stopRender=!1)}},{key:"bindOutputTexture",value:function(e){window.stopRender=!0,this.outputTexture([e],!0),window.stopRender=!1}},{key:"onRenderTarget",value:function(e){this.zCanvas.onRenderTarget(e)}},{key:"hasFeedback",get:function(){return 2===this.renderTargets.length}},{key:"renderTarget",get:function(){return this.renderTargets[0]}},{key:"alternateRenderTarget",get:function(){return this.renderTargets[1]}},{key:"swapTargets",value:function(){var e=Object(v.a)(this.renderTargets,2),t=e[0],n=e[1];this.renderTargets=[n,t]}},{key:"fromFrame",value:function(e){this.isInitialized||this.initGLFrame(),this.initRenderTargets(e),this.inputTexture=e.inputTexture,this.outputTexture=e.outputTexture}},{key:"initRenderTargets",value:function(e){this.renderTargets[0]||!e.texture&&!e.isFeedbackOutput||(this.renderTargets[0]=this.createRenderTarget()),e.hasFeedback&&!this.renderTargets[1]&&(this.renderTargets[1]=this.createRenderTarget()),this.checkRenderTargetSizes()}},{key:"initGLFrame",value:function(){var e=this;this.glSubPatch=new pf(this.subSequence,this.sequencerEngine,this.zObject,"planeRenderer"),this.glSubPatch.isSynchronous=!0,this.fragColor=this.glSubPatch.createZObject(0,0,"gl.fragColor"),this.material=this.glSubPatch.createZObject(0,0,"gl.material"),this.planeRenderer=this.glSubPatch.createZObject(0,0,"three.planeRenderer"),this.material.connectInlet("Input",this.fragColor,"Output 1"),this.planeRenderer.connectInlet("Input",this.material,"Output 1"),this.planeRenderer.sendMessage=function(t,n){e.operation=n,n&&(e.zCanvas.frames.length>1?e.zCanvas.renderFrames(0):e.zCanvas.onOperationHelper("render"))},this.isInitialized=!0}},{key:"createRenderTarget",value:function(e){var t=new ml.eb(2*this.zObject.width,2*this.zObject.height,{minFilter:ml.x,magFilter:ml.G,format:ml.P});return t.id=Ev++,t}},{key:"checkRenderTargetSizes",value:function(){for(var e in this.renderTargets){var t=this.renderTargets[e];t.width===2*this.zObject.width&&t.height===2*this.zObject.height||(this.needsFullRender=!0,this.renderTargets[e]=this.createRenderTarget())}}}]),e}();function Mv(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Rv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rv(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Rv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Cv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Nv=0;function Iv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var qv=function(e){Object(u.a)(n,e);var t=Iv(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e))._color="#000000",r.newInlet("operation",function(e){r.onOperationHelper(e)}),r.queue=[],window.requestAnimationFrame(function(){return r.draw()}),r}return Object(s.a)(n,[{key:"getFunctionDefinition",value:function(e){return fl[e]}},{key:"enqueue",value:function(e){this.queue.push(e)}},{key:"onOperation",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];if(this.ctxt){var i=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];if(e.split){var i=e.split(" ").filter(function(e){return""!==e}),o=i[0],s=i.slice(1).map(function(e){return Object(ke.a)(e)?parseFloat(e):e}),c=t.getFunctionDefinition(o);if(c)return function(){return c.apply(void 0,[t,t.ctxt].concat(Object(h.a)(s),r))}}};if(Array.isArray(e)){e.map(function(e){return i.apply(void 0,[e].concat(r))}).filter(function(e){return e}).forEach(function(n){return t.enqueue.apply(t,[n,e].concat(r))});return this.requested||(window.requestedTime=(new Date).getTime(),this.first||(this.first=!0)),void(this.requested=!0)}var o=i.apply(void 0,[e].concat(r));o&&this.enqueue.apply(this,[o,e].concat(r)),this.requested||(window.requestedTime=(new Date).getTime(),this.first||(this.first=!0)),this.requested=!0}}},{key:"draw",value:function(){var e=this;window.zRender.push((new Date).getTime()-window.requestedTime),window.lastRenderTime=(new Date).getTime(),window.renderSize.push(this.queue.length),this.queueforEach(function(e){return e()}),this.queue.length=0,this.requested=!1,window.requestAnimationFrame(function(){return e.draw()})}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=Cv(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).frames=[],e}return Object(s.a)(n,[{key:"createRenderTarget",value:function(e){var t=new ml.eb(2*this.zObject.width,2*this.zObject.height,{minFilter:ml.x,magFilter:ml.G,format:ml.P});return t.id=Nv++,t}},{key:"checkSize",value:function(e){return e.width!==2*this.zObject.width||e.height!==2*this.zObject.height?(this.needsFullRender=!0,this.createRenderTarget()):e}},{key:"onOperationHelper",value:function(e){if("render"!==e){if(Array.isArray(e)){var t=e[0].type;if(Array.isArray(e[0].type)&&(t=e[0].type[0]),"Mesh"===t&&(console.log("received a mesh"),this.addToScene(e[0])),"vec4"!==t){var n=Object(Yi.a)(e),r=n[0],a=n.slice(1);if("string"!==typeof r){if(Array.isArray(r)){var i=Object(Yi.a)(r),o=i[0],s=i.slice(1);if(Array.isArray(o)){var c=Object(Yi.a)(o),u=c[0],l=c.slice(1);this.onOperation.apply(this,[u].concat(Object(h.a)(l)))}else this.onOperation.apply(this,[o].concat(Object(h.a)(s)))}}else"render"===r&&this.frames.length>0?this.renderFrames(0):this.onOperation.apply(this,[r].concat(Object(h.a)(a)))}else this.handleGLMessage(e[0])}}else this.renderFrames(0)}},{key:"renderFrames",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.needsFullRender&&(e=0,this.needsFullRender=!1),e>0){var t=this.frames[e];t.texture&&(window.stopRender=!0,t.renderTargetB||t.texture([t.renderTarget.texture],!0),window.stopRender=!1)}this.queue.length=0;for(var n=e;n<this.frames.length;n++)this.frames[n].render()}},{key:"addToScene",value:function(e){var t=this.frames[0];t&&t.addToScene(e)}},{key:"handleGLMessage",value:function(e){var t=e.frames||[],n=[].concat(Object(h.a)(t),[e]);this._frames=n;var r,a,i=[],o=[],s=Mv(n);try{for(s.s();!(a=s.n()).done;){var c=a.value;c.texture&&o.push(c.texture),c.feedback?r=c.texture:(c.isFeedbackOutput?(c.outputTexture=o[0],c.texture?c.inputTexture=c.texture:c.inputTexture=r,c.hasFeedback=!0):c.outputTexture=c.texture,i.push(c))}}catch(f){s.e(f)}finally{s.f()}(n=i).length!==this.frames.length&&(this.frames=[]);for(var u=0;u<n.length;u++){var l=this.frames[u]||new Av(this);l.fromFrame(n[u]),this.frames[u]=l,this.frames[u].fragColor.onInputMessage([Object(d.a)({},n[u],{frames:void 0})])}this.onOperationHelper(["render"])}},{key:"initGLFrame",value:function(e){e.glSubPatch=new pf(this.subSequence,this.sequencerEngine,this.zObject,"planeRenderer"),e.glSubPatch.isSynchronous=!0,e.fragColor=e.glSubPatch.createZObject(0,0,"gl.fragColor"),e.material=e.glSubPatch.createZObject(0,0,"gl.material"),e.planeRenderer=e.glSubPatch.createZObject(0,0,"three.planeRenderer"),e.material.connectInlet("Input",e.fragColor,"Output 1"),e.planeRenderer.connectInlet("Input",e.material,"Output 1")}}]),n}(e)}(Ni.a));window.renderSize=[],window.zRender=[];var _v=void 0,Dv=[],Fv={clear:function(e){e.renderer.clear()},addToScene:function(e,t,n){var r=e.camera;e.scene.add(n),r.position.z=3},cube:function(e,t,n){var r=e.camera;e.scene.add(n),r.position.z=5},camera:function(e,t,n,r,a){var i=e.camera;i.position.x=n,i.position.y=r,i.position.z=a},draw:function(e,t){},render:function(e,t,n,r){if(n){var a=(new Date).getTime();if(_v){var i=1e3/(a-_v);Dv.unshift(i),window.fps=function(e){for(var t=0,n=0,r=0;r<20;r++)e[r]&&(n+=e[r],t++);return n/t}(Dv)}_v=a;var o=window.errors.length;if(e.renderer.render(n,r),window.errors.length-o>0)return window.errors.splice(o+1)}},autoClear:function(e,t,n){e.renderer.autoClear=!1}},Lv=Object(d.a)({},Fv);function Bv(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return zv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zv(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function zv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Jv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Vv=[],Hv=function(e){Object(u.a)(n,e);var t=Jv(n);function n(e){var r;return Object(o.a)(this,n),r=t.call(this,e),Vv.push(Object(c.a)(r)),r.newInlet("render target",function(e){var t=Object(v.a)(e,1)[0];return r.onRenderTarget(t)}),r.newInlet("get image data",function(e){Object(v.a)(e,1)[0];return r.onGetImageData()}),r.newInlet("get image data URL",function(e){Object(v.a)(e,1)[0];return r.onGetImageDataURL()}),r.newOutlet("mouse-move"),r.newOutlet("mouse-click"),r.newOutlet("mouse-down"),r.newOutlet("mouse-up"),r.newOutlet("isMouseDown"),r.newInlet("size ",function(e){var t=Object(v.a)(e,1)[0];r.onSizeChange(t)}),r.newOutlet("size"),r.newOutlet("image data"),r.newOutlet("image URL"),r.zObject.newAttribute("fill full-screen",!0),r.zObject.setAttribute("primary-color","transparent"),r.zObject.newAttribute("set as background",!1),r.iFrame=0,r}return Object(s.a)(n,[{key:"onSizeChange",value:function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1];this.zObject.width=n,this.zObject.height=r,this.sendMessage("size",e)}},{key:"onGetImageDataURL",value:function(){this.canvas;var e=this.canvas.toDataURL("image/png"),t=new Image;t.src=e,this.sendMessage("image URL",t)}},{key:"ctxt",get:function(){return this._ctxt},set:function(e){this._ctxt=e}},{key:"onGetImageData",value:function(){if(this.ctxt){var e=this.ctxt,t=this.zObject.width*this.zObject.height*4*16;this.pixels&&this.pixels.length===t||(this.pixels=new Uint8Array(t));var n=this.pixels;e.getContext().readPixels(0,0,e.getContext().drawingBufferWidth,e.getContext().drawingBufferHeight,e.getContext().RGBA,e.getContext().UNSIGNED_BYTE,n);for(var r=[],a=0;a<n.length;a+=4)n[a]>0&&r.push(a/4);this.sendMessage("image data",n)}}},{key:"onMouseDown",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.sendMessage("mouse-down",t),this.sendMessage("isMouseDown",1),Object(hi.c)("mouse-down",t)}},{key:"onMouseUp",value:function(e,t){this.sendMessage("isMouseDown",0),this.sendMessage("mouse-up",[e,t]),Object(hi.c)("mouse-up",[e,t])}},{key:"enqueue",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];this.queue.push({fn:e,operation:t,vargs:r})}},{key:"onMouseMove",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Object(hi.c)("mouse-move",t),this.sendMessage("mouse-move",t)}},{key:"onMouseClick",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.sendMessage("mouse-click",t)}},{key:"width",get:function(){return this.zObject.width}},{key:"height",get:function(){return this.zObject.height}},{key:"onRenderTarget",value:function(e){var t=this;if(this.renderer){var n=e&&"null"!==e?e:null;this.enqueue(function(){t.renderer.setRenderTarget(n)},"setRenderTarget",[n])}}},{key:"getFunctionDefinition",value:function(e){return Lv[e]}},{key:"draw",value:function(){window.zRender.push((new Date).getTime()-window.requestedTime),window.lastRenderTime=(new Date).getTime();var e=this.dedupeQueue(this.queue);if(0===e.length)return this.requested=!1,void(this===Vv[0]&&window.requestAnimationFrame(function(){return Vv.forEach(function(e){return e.draw()})}));window.renderSize.push(e.length);var t=[];e.length>0&&(this.iFrame++,Object(hi.c)("shader.iframe",this.iFrame)),e.forEach(function(e){var n=(0,e.fn)();n&&(t=[].concat(Object(h.a)(t),Object(h.a)(n)))}),this.lastErrorsLength!==t.length&&(t.length>0?this.scripts.forEach(function(e){return e.effect.onNewErrors(t)}):this.scripts.forEach(function(e){return e.effect.clearErrors(t)}),this.lastErrorsLength=t.length),this.queue.length=0,this.requested=!1,this===Vv[0]&&window.requestAnimationFrame(function(){return Vv.forEach(function(e){return e.draw()})})}},{key:"scripts",get:function(){return Object(P.a)(this.subSequence.getRootSubSequence?this.subSequence.getRootSubSequence():this.subSequence).filter(function(e){return"script"===e.name})}},{key:"dedupeQueue",value:function(e){var t,n,r=[],a=Bv(e);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=(i.fn,i.operation),s=i.vargs;t&&o===t.operation&&s.every(function(e,n){return e===t.vargs[n]})||(r.push(i),t=i)}}catch(c){a.e(c)}finally{a.f()}return r}},{key:"fromJson",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this)).call.apply(e,[this].concat(r))}}]),n}(qv);Object(pi.a)("three.canvas",{},"Creates a threejs canvas (3D)",function(){return 0},{inlets:0,tags:"Graphics"});Object(pi.a)("three.vector3",{},"Creates a 3-dimensional vector object",void 0,{isHot:!0,inlets:3,tags:"Graphics"});Object(pi.a)("three.vector2",{},"Creates a 2-dimensional vector object",void 0,{isHot:!0,inlets:2,tags:"Graphics"});Object(pi.a)("three.gray",{shade:""},"Gray");var Uv={"three.gray":function(e){return function(e){var t=Object(v.a)(e,1)[0];return new ml.k(t,t,t),[[t,t,t]]}},"three.vector3":function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0];return new ml.cb(r,t(),n())}},"three.vector2":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];return new ml.bb(n,t())}},"three.canvas":function(e){var t=new Hv(e);return e.effect=t,e.width=300,e.height=300,e.needsHotReload=!0,t.needsHotReload=!0,e.needsLoad=!0,function(t){Object(v.a)(t,1)[0]===S.k&&e.effect.sendMessage("size",[e.width,e.height])}}};Object(pi.a)("three.scene",{},"Create a scene in three js, any objects sent to it are added to it.",void 0,{tags:"Graphics",connects:{object:"three.render"}});Object(pi.a)("three.render",{scene:"",camera:""},"Render a scene and camera",void 0,{tags:"Graphics",isHot:!0,inlets:2,connects:{object:"three.canvas",inlet:"operation"}});Object(pi.a)("three.ambientLight",{color:"",intensity:""},"Creates an ambient light (to be added to scene)",void 0,{tags:"Graphics",isHot:!0,inlets:2});Object(pi.a)("three.directionalLight",{color:"",intensity:""},"Creates an ambient light (to be added to scene)",void 0,{tags:"Graphics",isHot:!0,inlets:2});var Gv={"three.ambientLight":function(e,t){var n=new ml.b(16777215,1);return function(e){var r=Object(v.a)(e,1)[0];return"bang"===r?[n]:(n.color=r||16777215,n.intensity=t()||1,[n])}},"three.directionalLight":function(e,t){var n=new ml.n(16777215,1);return n.position.setScalar(100),function(e){var r=Object(v.a)(e,1)[0];return"bang"===r?[n]:(n.color=r||16777215,n.intensity=t()||1,[n])}},"three.scene":function(e){var t=new ml.Q;return function(e){var n=Object(Yi.a)(e),r=n[0],a=n.slice(1);switch(r){case"remove":return t.remove.apply(t,Object(h.a)(a)),[t];case"bang":return[t];case"clear":return t.clear(),[t];default:return Array.isArray(r)?r.forEach(function(e){e&&!t.children.includes(e)&&t.add(e)}):t.children.includes(r)||t.add(r),[t]}}},"three.render":function(e,t){var n=new ml.I(-1,1,1,-1,-1,1);return function(r){var a=Object(v.a)(r,1)[0];if("dispose"!==a){var i=n;t()&&(i=t()),"bang"!==a&&i.lookAt(a.position),e.lastOutput=["render",a,i],e.sendMessage(e.outputByNumber(0),e.lastOutput)}}}};Object(pi.a)("delaunay",{},"computes delaunay triangulation for pts",void 0,{tags:"Graphics"});Object(pi.a)("delaunayIndex",{},"computes delaunay triangulation for pts index",void 0,{tags:"Graphics"});var Wv=function(e){var t;return function(e){var n=Object(v.a)(e,1)[0];if(n&&n&&(ArrayBuffer.isView(n)||Array.isArray(n)&&!n.some(function(e){return!Object(ke.a)(e)})))return t?(n.forEach(function(e,n){return t.coords[n]=e}),t.update()):t=new ev.a(n),[t.triangles]}},Kv=n(897),Qv=n(895);Object(pi.a)("canvas",{},"Javascript canvas for 2D drawing",function(){return 0},{tags:"Graphics"});Object(pi.a)("coords",{},"Creates a coord object from arguments (x,y)",void 0,{inlets:2,isHot:!0});Object(pi.a)("rasterTriangle",{},"Returns a list of coordinates representing the raster points",void 0,{inlets:4,isHot:!0});Object(pi.a)("rasterTriangles",{},"Returns a list of coordinates representing the raster points",void 0,{inlets:2,isHot:!0});Object(pi.a)("triangulate",{},"Returns a list of triangles for a set of points",void 0,{inlets:2,isHot:!0});Object(pi.a)("drawArray",{size:""},"Returns a list of coordinates representing the raster points",void 0,{inlets:3});Object(pi.a)("drawTriangles",{},"Returns a list of coordinates representing the raster points",void 0,{inlets:2});Object(pi.a)("triangle",{},"Send draw triangle operation to canvas with the 3 inputed coords",void 0,{isHot:!0,inlets:4});var Zv=new oi.a;Object(pi.a)("color",{},"Outputs a color",function(){return 0},{tags:"Colors"});Object(pi.a)("compliment",{rotate:""},"Rotates a color (0-10), complimenting it",void 0,{isHot:!0,inlets:2,tags:"Colors"});var Yv={color:function(e){var t=new Yh(e);return e.effect=t,e.needsLoad=!0,e.needsHotReload=!0,function(e){var n=Object(v.a)(e,1)[0];"string"===typeof n&&n.startsWith("#")?t.color=n:t.color=t.color}},compliment:function(e,t){return function(e){return Zv.hslToHex(Zv.compliment(Zv.saturate(e[0],1),t()))}}};Object(pi.a)("metro",{},"Sends tick every 1/32th step (when project is playing)",void 0,{tags:"Ticker"});Object(pi.a)("syncedMetro",{},"Sends tick every 1/32th step (when project is playing)",void 0,{tags:"Ticker"});Object(pi.a)("setInterval",{},"Sends every so often",void 0,{tags:"Ticker"});Object(pi.a)("setIntervalFast",{msInterval:""},"Sends every so often",void 0,{tags:"Ticker"});Object(pi.a)("setTimeout",{timeout:""},"Sends bang after timeout in ms",void 0,{tags:"Ticker"});var $v=function(e){return function(t){var n=Object(v.a)(t,1)[0];Object(M.a)(n).then(function(){e.sendMessage(e.outputByNumber(0),S.a)})}};Object(pi.a)("metroTimer",{},"Sends tick every 1/32th step (when project is playing)",function(){return 1},{tags:"Ticker"});function Xv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var em=function(e){Object(u.a)(n,e);var t=Xv(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this)).zObject=e,r.sequencerEngine=e.sequencerEngine,r.subSequence=e.subSequence,r.startUpNumber=0,r.newInlet("Start Up Calls",function(e){return r.startUpNumber=e[0]}),r.newOutlet("Random Number"),r}return Object(s.a)(n,[{key:"getJson",value:function(){return{startUpNumber:this.startUpNumber}}},{key:"fromJson",value:function(e){this.startUpNumber=e.startUpNumber}},{key:"getParameters",value:function(){return[]}},{key:"startUp",value:function(){for(var e=0;e<this.startUpNumber;e++)this.execute()}},{key:"execute",value:function(){console.log("executing random number"),this.sendMessage("Random Number",Object(Fo.b)())}}]),n}(Object(fi.a)(function(){return function e(){Object(o.a)(this,e)}}())),tm=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"balance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"operator",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"owner",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"_approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"}];Object(pi.a)("nft",{},"Random number generator based on NFT's token seed",function(e){return 0});Object(pi.a)("erc720.tokenID",{},"Returns the tokenID URL param of this page (for ERC720 tokens)",function(e){return 1});Object(pi.a)("erc721.tokenURI",{tokenId:"",contractAddress:""},"Returns the tokenURI for a given ERC721 token",function(e){return 1},{isHot:!0,inlets:2});Object(pi.a)("erc721.ownerOf",{tokenId:"",contractAddress:""},"Returns the tokenURI for a given ERC721 token",function(e){return 1},{isHot:!0,inlets:2});Object(pi.a)("erc721.imageURI",{tokenURI:""},"Returns the image section a given ERC721 tokens metadata",function(e){return 1},{isHot:!0,inlets:1});Object(pi.a)("erc721.decodeBase64",{tokenURI:""},"Returns the image section a given ERC721 tokens metadata",function(e){return 1},{isHot:!0,inlets:1});Object(pi.a)("erc721.attribute",{value:"","trait type":""},"Returns the tokenURI for a given ERC721 token",function(e){return 1},{isHot:!0,inlets:2});Object(pi.a)("erc721.editionSize",{editionSize:""},"");var nm={"erc721.imageURI":function(e,t){return function(e){var t=Object(v.a)(e,1)[0],n="data:application/json;base64,";if(t.startsWith(n)){var r=atob(t.slice(n.length));return[JSON.parse(r).image]}}},"erc721.attribute":function(e,t){return function(n){var r=Object(v.a)(n,1)[0],a=e.sequencerEngine.tokenID,i=e.sequencerEngine;i.erc721Attributes||(i.erc721Attributes={}),void 0!==a&&(i.erc721Attributes[a]||(i.erc721Attributes[a]=[]),i.erc721Attributes[a]=i.erc721Attributes[a].filter(function(e){return e.trait_type!==t()}),i.erc721Attributes[a].push({trait_type:t(),value:r}),i.erc721Attributes[a].sort(function(e,t){return e.trait_type.localeCompare(t.trait_type)}))}},"erc721.tokenURI":function(e,t,n){return function(r){var a=Object(v.a)(r,1)[0];new(new No.a(new No.a.providers.HttpProvider("https://".concat(n()?"goerli":"mainnet",".infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c"))).eth.Contract)(tm,t()).methods.tokenURI(a).call().then(function(t){e.sendMessage(e.outputByNumber(0),t)})}},"erc721.decodeBase64":function(e){return function(e){var t=Object(v.a)(e,1)[0];if(t.indexOf("base64,")>=0)return atob(t.slice(t.indexOf("base64,")+"base64,".length))}},"erc721.editionSize":function(e){return function(t){var n=Object(v.a)(t,1)[0];e.sequencerEngine.erc721EditionSize=n}}};function rm(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return am(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return am(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function am(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function im(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var om=function(e){Object(u.a)(n,e);var t=im(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).rulesToFilter=[],r.newInlet("rules",function(e){var t=Object(v.a)(e,1)[0];return r.processRules(t)}),r.newOutlet("processed rules"),r}return Object(s.a)(n,[{key:"updateRules",value:function(e){e=Object(h.a)(e),this.rulesToFilter=e,this.zObject.onValueChange(e),this._rules&&this.processRules(this._rules)}},{key:"processRules",value:function(e){var t=this;this._rules=e;var n,r=[],a=rm(e);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=Object(d.a)({},i),s=i.always,c=i.series;if(s&&!Array.isArray(s)&&(s=[s]),c&&!Array.isArray(c)&&(c=[c]),s){var u,l=[],f=rm(s);try{var p=function(){var e=u.value;t.rulesToFilter.some(function(t){return t.type===e.type})||l.push(e)};for(f.s();!(u=f.n()).done;)p()}catch(w){f.e(w)}finally{f.f()}o.always=l}if(c){var v,m=[],y=rm(c);try{for(y.s();!(v=y.n()).done;){var b=v.value;b=Array.isArray(b)?Object(h.a)(b):[b];var g,O=[],j=rm(b);try{var k=function(){var e=g.value;t.rulesToFilter.some(function(t){return t.type===e.type})||O.push(e)};for(j.s();!(g=j.n()).done;)k()}catch(w){j.e(w)}finally{j.f()}m.push(O)}}catch(w){y.e(w)}finally{y.f()}o.series=m}r.push(o)}}catch(w){a.e(w)}finally{a.f()}this.sendMessage("processed rules",r)}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{rulesToFilter:this.rulesToFilter})}},{key:"fromJson",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];(t=Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this)).call.apply(t,[this,e].concat(a)),e.rulesToFilter&&this.updateRules(e.rulesToFilter)}}]),n}(Ni.a);function sm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var cm=n(870),um=n(61),lm=n(170);function fm(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return hm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hm(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function hm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}um.a,um.b,um.c;var dm=[um.a,um.b,um.c,lm.a,lm.e,lm.m,lm.i,lm.h,lm.j,lm.c,lm.d,lm.k],pm=function(e){return e.type?e.type.type||e.type:e},vm=function(e,t){for(var n=[],r=function(e,t){return n.some(function(n){return n.some(function(n){return n.x===e&&n.y===t})})},a=function(n,r){for(var a=[],o=function(n){if(!e[r][n])return s=n,"break";if(a.push({x:n,y:r}),r>=t-1)return s=n,"continue";var o=i(n,r+1),c=[o],u=[o];if(e[r][n]===um.a){var l=i(n+1,r+1);c.push(l),u.push(l)}for(var f=function(){var t=u.pop();if(0===t.length)return"continue";t.forEach(function(n){var r=i(n.x,t[0].y+1);if(r.length>0&&(c.push(r),u.push(r)),e[(n.x,t[0].y)]===um.a){var a=i(n.x+1,t[0].y+1);a.length>0&&(c.push(a),u.push(a))}})};u.length>0;)f();c.forEach(function(e){return a=[].concat(Object(h.a)(a),Object(h.a)(e))}),e[r][n]===um.a&&n++,s=n},s=n;s<t;s++){var c=o(s);if("break"===c)break}var u=[];return a.forEach(function(e){u.some(function(t){return t.x==e.x&&t.y===e.y})||u.push(e)}),u},i=function(n,r,a){if(r>=t)return[];for(var i=[],o=function(t){return!!e[r][t]&&(i.push({x:t,y:r}),!0)},s=n;s<t&&o(s);s++)e[r][s]===um.a&&s++;for(var c=n-1;c<=0&&(o(c)||e[r][c-1]===um.a);c--);return i},o=0;o<t;o++)for(var s=0;s<t;s++){if(e[o][s]&&!r(s,o)){var c=a(s,o);n.push(c)}}return n},mm=function(e){return 1===e.length?e[0]:e},ym=function(e){var t=[];return e.forEach(function(e){if(0===t.length)t.push([e]);else{var n=t[t.length-1];n[0].x===e.x?n.push(e):t.push([e])}}),t},bm=function(e){return e.map(function(e){return e.type})},gm=function(e,t,n){return e.filter(function(e){var r=e.x,a=e.y;return t[a][r]===n})},Om=function(e,t){return e.filter(function(e){return e.x===t})},jm=function(e,t){var n,r=[],a=fm(e);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=i.x,s=i.y,c=t[s][o];c===um.a?(r.push({x:o,y:s,type:Object(zh.b)(0)}),r.push({x:o+1,y:s,type:Object(zh.b)(1)})):c===um.b?r.push({x:o,y:s,type:Object(zh.c)()}):r.push({x:o,y:s,type:c})}}catch(u){a.e(u)}finally{a.f()}return r},km=function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=fm(dm);try{var i=function(){var a=n.value;if(e.some(function(e){return t[e.y][e.x]===a}))return{v:r?pm(a):a}};for(a.s();!(n=a.n()).done;){var o=i();if("object"===typeof o)return o.v}}catch(s){a.e(s)}finally{a.f()}},wm=function(e,t){var n={};return e.forEach(function(e){var r=km(e,t);n[r]||(n[r]=0),n[r]++}),n},xm=Object(Hp.a)(),Sm=function(e){return e.reduce(function(e,t){return e[t.x]||(e[t.x]=[]),e[t.x].push(t),e},{})};xm("delete",{blockNumber:"block to delete from"},"Deletes a cell in block inside the grid ");xm("clearBlock",{blockNumber:"block to clear",ratio:"block to clear (0-1)"},"Deletes all cells in a block ");xm("add",{blockNumber:"block to add to",position:"position to add it to",type:"type to add"},"Adds a cell to block at a certain position");var Pm=[lm.m,lm.e].map(function(e){return e.type}),Em=[lm.h,lm.i,lm.j,lm.a,lm.k].map(function(e){return e.type}),Tm=function(e,t,n){for(var r=0;r<t.length;r++){var a=t[r],i=a.x,o=a.y;if(Am(e[o][i].type,n.type))return{x:i,y:o}}},Am=function(e,t){return e===t||(!(!Pm.includes(e)||!Pm.includes(t))||!(!Em.includes(e)||!Em.includes(t)))};xm("append",{blockNumber:"block to shift",type:"type to append [ACCENT, PIANO, PIANISSIMO, REST, REGULAR, LEGATO, STACCATO]"},"Shifts a block in grid by 1 to the right");function Mm(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Rm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rm(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Rm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}xm("shift",{blockNumber:"block to shift"},"Shifts a block in grid by 1 to the right");var Cm=function(e,t,n,r,a,i){for(var o=function(r){if("-"===e[a][r-1])return"continue";e[a][r]||t.some(function(e){return e.x===r&&e.y===a})||n.some(function(e){return e.x===r&&e.y===a})||t.push({x:r,y:a})},s=r;s<i;s++)o(s)},Nm=function(e,t){var n,r=Sm(t),a=Object.keys(r).map(function(e){return parseInt(e)}),i=Math.max.apply(Math,Object(h.a)(a)),o=[],s=Mm(t);try{for(s.s();!(n=s.n()).done;){var c=n.value,u=c.x,l=c.y;"-"===e[l][u]?(Cm(e,o,t,u,l+1,Math.max(u+2,i)),Cm(e,o,t,u+2,l,Math.max(u+3,i))):Cm(e,o,t,u,l,i)}}catch(d){s.e(d)}finally{s.f()}var f=[].concat(Object(h.a)(t),o);return f.sort(function(e,t){return e.x-t.x}),f},Im=function(e){for(var t=[],n=0;n<e.size;n++)t.push(Object(h.a)(e.cells[n]));e.savedCells=t},qm={clearBlock:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=e.cells,a=e.size,i=vm(r,a);if(i&&!isNaN(t)){var o=(i=i.filter(function(e){return e.length>1}))[t%i.length];if(o){o=o.filter(function(e){var t=e.x,n=e.y;return r[n]&&"-"!==r[n][t]&&"."!==r[n][t]});var s=Math.floor(n*o.length);o.slice(0,s).forEach(function(t){var n=t.x,r=t.y;return e.set(n,r,!1)})}}},delete:function(e,t){var n=e.cells,r=e.size,a=vm(n,r);if(a&&!isNaN(t)){var i=(a=a.filter(function(e){return e.length>1}))[t%a.length];if(i){var o=function(e){return e.reduce(function(e,t){return e[t.y]||(e[t.y]=[]),e[t.y].push(t),e},{})}(i=i.filter(function(e){var t=e.x,r=e.y;return n[r]&&"-"!==n[r][t]&&"."!==n[r][t]})),s=Object.keys(o).map(function(e){return parseInt(e)}),c=Math.max.apply(Math,Object(h.a)(s));if(o[c]){var u=o[c][0],l=u.x,f=u.y;e.set(l,f,!1)}}}},add:function(e,t,n,r){var a=e.cells,i=function(e,t){for(var n=[],r=function(e,t){return n.some(function(n){return n.some(function(n){return n.x===e&&n.y===t})})},a=function(n,r){var a=[],o=r,s=n;if(e[r][n]!==um.a&&e[r][n]!==um.b)for(var c=!1,u=r;u<t;u++){for(var l=n;l<t;l++){if(e[u][l]===um.a||e[u][l]===um.b){o=u,s=l,c=!0;break}if(!e[u][l]&&!e[u-1][l]&&!e[u-1][l-1])break}if(c)break}e[o][s]===um.a?a=[{x:s-1,y:o-1},{x:s,y:o},{x:s+1,y:o},{x:s+2,y:o-1}]:e[o][s]===um.b&&(a=[{x:s-1,y:o},{x:s,y:o+1},{x:s+1,y:o}]);for(var f=[],d=function(n){if(!e[r][n])return p=n,"break";if(f.push({x:n,y:r}),r>=t-1)return p=n,"continue";var a=i(n,r+1),o=[a],s=[a];if(e[r][n]===um.a){var c=i(n+1,r+1);o.push(c),s.push(c)}for(var u=function(){var t=s.pop();if(0===t.length)return"continue";t.forEach(function(n){var r=i(n.x,t[0].y+1);if(r.length>0&&(o.push(r),s.push(r)),e[(n.x,t[0].y)]===um.a){var a=i(n.x+1,t[0].y+1);a.length>0&&(o.push(a),s.push(a))}})};s.length>0;)u();o.forEach(function(e){return f=[].concat(Object(h.a)(f),Object(h.a)(e))}),e[r][n]===um.a&&n++,p=n},p=n;p<t;p++){var v=d(p);if("break"===v)break}return f.forEach(function(e){a.some(function(t){return t.x==e.x&&t.y===e.y})||a.push(e)}),a},i=function(n,r,a){if(r>=t)return[];for(var i=[],o=function(t){return!!e[r][t]&&(i.push({x:t,y:r}),!0)},s=n;s<t&&o(s);s++)e[r][s]===um.a&&s++;for(var c=n-1;c<=0&&(o(c)||e[r][c-1]===um.a);c--);return i},o=0;o<t;o++)for(var s=0;s<t;s++)if(e[o][s]&&!r(s,o)){var c=a(s,o);n.push(c)}return n}(a,e.size),o=i[t%i.length];if(o&&r){var s=Sm(o),c=Object.keys(s).map(function(e){return parseFloat(e)});if(void 0===n||-1===n){var u=1e3;for(var l in s)s[l].length<u&&(u=s[l].length,n=c.indexOf(parseInt(l)))}var f=c[n%c.length],d={type:r,value:""};if(void 0===f){var p=km(o,a),v=gm(o,a,p)[0];if(v){var m=v.y,y=Math.max.apply(Math,Object(h.a)(o.map(function(e){return e.x})));"-"===p&&y===v.x&&y++,y++,e.set(y,m,d)}}else{var b=s[f=parseInt(f)],g=Tm(e.cells,b,d);if(g)e.set(g.x,g.y,d);else{var O=Math.max.apply(Math,Object(h.a)(b.map(function(e){return e.y})))+1;e.set(f,O,d)}}}},append:function(e,t,n){var r=e.cells,a=e.size,i=vm(r,a),o=i[t%i.length];if(o&&n){var s=Sm(o),c=Object.keys(s).map(function(e){return parseInt(e)}),u={type:n,value:""},l=s[Math.max.apply(Math,Object(h.a)(c))][0],f=l.x,d=l.y;"-"===r[d][f]&&f++,f++,e.set(f,d,u)}},shift:function(e,t){var n=e.cells,r=e.size,a=vm(n,r),i=a[t%a.length];if(i){var o=km(i,n);if(0!==(i=(i=Nm(n,i)).filter(function(e){var t=e.x,r=e.y;return n[r][t]!==o})).length){for(var s=n[i[0].y][i[0].x],c=0;c<i.length;c+=1){i[c];var u=i[(c+1)%i.length],l=n[u.y][u.x];n[u.y][u.x-1]&&(s="-"===n[u.y][u.x-2]?n[u.y+1][u.x-1]:n[u.y][u.x-1]),n[u.y][u.x]=s,s=l}e.updateRedux(),e.calculateRules()}}},save:Im,restore:function(e){e.savedCells&&(e.cells=Object(h.a)(e.savedCells),Im(e),e.calculateRules(),e.updateRedux())}};function _m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Dm(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Fm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Fm(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Fm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Lm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Bm(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return zm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zm(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function zm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Jm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Vm=function(e){Object(u.a)(n,e);var t=Jm(n);function n(e,r){var a;Object(o.a)(this,n),(a=t.call(this)).id=Object(q.uuid)(),a.subSequence=e,e.sequencerEngine.idToObject[a.id]=Object(c.a)(a),a.zObject=r,a.size=15,a.cells=[],a.symbols=[];for(var i=0;i<a.size;i++)a.cells.push(new Array(a.size).fill(!1));return a.newInlet(S.d,function(e){return a.onOperation(e[0])}),a.newOutlet(S.h),a.newInlet("save",function(){return a.save()}),a.newInlet("restore",function(e){var t=Object(v.a)(e,1)[0];return a.restore(t)}),a.newInlet("interpolate",function(e){var t=Object(v.a)(e,1)[0];return a.interpolate(t)}),a.newInlet("interpolation factor",function(e){var t=Object(v.a)(e,1)[0];isNaN(t)||(a.interpolationFactor=t)}),a.newOutlet("saved"),a.newOutlet("density"),a.interpolationFactor=.5,a}return Object(s.a)(n,[{key:"interpolate",value:function(e){if(!this.zObject.sequencerEngine.isLoading&&(this.lastStepNumber!==this.zObject.sequencerEngine.trackStep&&(this.operationsCount=0),!(this.operationsCount++>12))){this.lastStepNumber=this.zObject.sequencerEngine.trackStep;for(var t=0;t<e.length;t++)for(var n=e[t],r=0;r<n.length;r++){var a=n[r];Math.random()<this.interpolationFactor&&(this.cells[t][r]="object"===typeof a?Object(d.a)({},a):a)}this.updateRedux(),this.calculateRules()}}},{key:"current",get:function(){return this.cells},set:function(e){this.cells=e,this.calculateRules(),this.updateRedux()}},{key:"getCurrentCopy",value:function(){var e,t=[],n=Bm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cells);try{for(n.s();!(e=n.n()).done;){var r,a=e.value,i=[],o=Bm(a);try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(!!s&&("string"===typeof s?s:Object(d.a)({},s)))}}catch(c){o.e(c)}finally{o.f()}t.push(i)}}catch(c){n.e(c)}finally{n.f()}return t}},{key:"getConnectedTidal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object(fe.a)(Object(f.a)(n.prototype),"getConnectedTidal",this).call(this,e,"rules")}},{key:"set",value:function(e,t,n){e>=this.size||t>=this.size||(this.cells[t][e]=n,this.calculateRules(),this.updateRedux())}},{key:"setColor",value:function(e,t,n){var r=this.cells[t][e];r&&(r.color=n)}},{key:"drag",value:function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(e!==n||t!==r){var i=this.cells[t][e];return!this.cells[r][n]&&(this.cells[r][n]=i,this.cells[t][e]=!1,a&&(this.calculateRules(),this.updateRedux()),!0)}}},{key:"updateRedux",value:function(){this.zObject.dispatch(Object(J.Vb)(this.id,Object(h.a)(this.cells)))}},{key:"getParameters",value:function(){return[]}},{key:"getSelected",value:function(e){for(var t=e.x1,n=e.y1,r=e.x2,a=e.y2,i={},o=n;o<=a;o++)for(var s=t;s<=r;s++)this.cells[o][s]&&(i[s+","+o]=!0);return i}},{key:"getJson",value:function(){return{id:this.id,cells:this.cells}}},{key:"fromJson",value:function(e,t){console.log("jaki grid loaded isCopy=%s",t),e.id&&!t&&(console.log("updating jaki grid id to ",this.id),this.id=e.id,this.subSequence.sequencerEngine.idToObject[this.id]=this),e.cells&&(this.cells=e.cells,console.log("calculating the rules"),this.calculateRules())}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=sm(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).stack=[],e}return Object(s.a)(n,[{key:"save",value:function(){var e=this.getCurrentCopy();this.stack.push(e),this.updateRedux(),this.sendMessage("saved",this.getCurrentCopy())}},{key:"getCurrentCopy",value:function(){}},{key:"restore",value:function(e){if(Array.isArray(e))this.current=e;else if(0!==this.stack.length){var t=this.stack[this.stack.length-1];this.current=this.getCurrentCopy(t)}}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=_m(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).lastStepNumber=void 0,e.operationsCount=0,e}return Object(s.a)(n,[{key:"onOperation",value:function(e){if("string"===typeof e&&(this.lastStepNumber!==this.zObject.sequencerEngine.trackStep&&(this.operationsCount=0),!(this.operationsCount++>52))){var t=e.split(" ").filter(function(e){return""!==e}),n=t[0],r=t.slice(1).map(function(e){return Object(ke.a)(e)?parseFloat(e):e}),a=qm[n];a&&(a.apply(void 0,[this].concat(Object(h.a)(r))),this.lastStepNumber=this.zObject.sequencerEngine.trackStep)}}}]),n}(e)}(Object(cm.a)(function(e){return function(e){Object(u.a)(n,e);var t=Lm(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"calculateRules",value:function(){(new Date).getTime();var e=function(e,t){var n,r=function(t,n,r){var a=t.some(function(t){var n=t.x,r=t.y;return e[r][n]===um.a});t.some(function(t){var n=t.x,r=t.y;return e[r][n]===um.b}),(t=jm(t,e)).sort(function(e,t){return e.x-t.x});var i=[],o=function(e,t,a){return e(t).every(n,r).always(mm(bm(a)))};if(a){var s=gm(t,e,um.a)[0],c=Om(t,s.x-1);c.length>0&&i.push(o(lm.r,Object(zh.b)(0),c));var u=Om(t,s.x).filter(function(e){return pm(e)!==um.a});u.length>0&&i.push(o(lm.u,Object(zh.b)(0),u));var l=Om(t,s.x+1).filter(function(e){return pm(e)!==um.a});l.length>0&&i.push(o(lm.u,Object(zh.b)(1),l));var f=t.filter(function(e){return e.x>s.x+1});if(f.length>0){var d,p=ym(f).map(bm).map(mm);i.push((d=Object(lm.o)(Object(zh.b)(1)).every(n,r)).series.apply(d,Object(h.a)(p)))}}else{var v=km(t,e,!1),m=gm(t,e,v)[0];if(!m)return[];var y=Om(t,m.x-1),b=Om(t,m.x).filter(function(e){return pm(e)!==v}),g=Om(t,m.x+1),O=v===um.b?Object(zh.c)():v;if(y.length>0&&i.push(o(lm.r,O,y)),b.length>0&&i.push(o(lm.u,O,b)),g.length>0){var j,k=ym(g).map(bm).map(mm);i.push((j=Object(lm.o)(O).every(n,r)).series.apply(j,Object(h.a)(k)))}}return i.forEach(function(e){return e.block=t}),i},a=vm(e,t),i=[],o=wm(a,e),s={},c=fm(a);try{for(c.s();!(n=c.n()).done;){var u=n.value,l=km(u,e),f=s[l]||0;i=[].concat(Object(h.a)(i),Object(h.a)(r(u,o[l],f))),s[l]=f+1}}catch(d){c.e(d)}finally{c.f()}return i.push(Object(lm.s)().always(lm.k)),i}(this.cells,this.size);(new Date).getTime(),this.rules=e,this.sendMessage(S.h,e),this.sendMessage("density",this.getDensity())}},{key:"getDensity",value:function(){var e,t=0,n=0,r=Dm(vm(this.cells,this.size));try{for(r.s();!(e=r.n()).done;)t+=e.value.length,n+=5}catch(a){r.e(a)}finally{r.f()}return t/n}}]),n}(e)}(Object(fi.a)(function(){return function e(){Object(o.a)(this,e)}}()))))));function Hm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Um=function(e){Object(u.a)(n,e);var t=Hm(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet("choose",function(){return r.onChoose()}),r.newInlet("set probabilities",function(e){var t=Object(v.a)(e,1)[0];return r.setProbabilities(t)}),r.newOutlet("choice"),r.newOutlet("probabilities"),r.probabilities={rest:0,pianissimo:0,piano:0,regular:0,accent:0,staccato:0,legato:0,double:0,flam:0},r}return Object(s.a)(n,[{key:"setProbabilities",value:function(e){for(var t=Object.keys(this.probabilities),n=0;n<e.length;n++)this.setProbability(t[n],e[n]);this.probabilities=Object(d.a)({},this.probabilities)}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{probabilities:this.probabilities})}},{key:"fromJson",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];(t=Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this)).call.apply(t,[this,e].concat(a)),this.probabilities=e.probabilities}},{key:"setProbability",value:function(e,t){this.probabilities[e]=t,this.sendMessage("probabilities",Object.values(Gm(this.probabilities)))}},{key:"onChoose",value:function(){var e=Gm(this.probabilities),t=Math.random(),n=0;for(var r in e){if(t<n+e[r])return void this.sendMessage("choice",r);n+=e[r]}}}]),n}(Ni.a),Gm=function(e){var t=0;for(var n in e)t+=e[n];var r={};for(var a in e)r[a]=e[a]/t;return r};Object(pi.a)("jgrid",{},"A grid based rule generator for the jaki object",function(e){return 0},{tags:"Rhythm",inlets:0,operationDocs:xm,connects:{object:"jaki",inlet:"rules"}});Object(pi.a)("jtypes",{},"Probabilistically choose a hit type based on user input",function(){return 0},{inlets:0});Object(pi.a)("jrules.filter",{},"Filters out rules",function(){return 0},{inlets:0});var Wm=n(568);function Km(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Qm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qm(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Qm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Zm=new re.a.Time("16n");Object(pi.a)("jpolygons",{tidals:""},"Converts Jaki object tidals into polygons to be rendered",void 0,{tags:"Rhythm"});var Ym=function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{x:e,y:e},o=arguments.length>6?arguments[6]:void 0;arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(null===o.transpose)return[void 0,void 0];var s=Xm(t,i,a,r),c=Xm((t+1)%n,i,a,r),u=Xm((t+2)%n,i,a,r),l=Xm((t+3)%n,i,a,r),f=Xm(Object(qn.a)(t-3,n),i,a,r),h=Xm(Object(qn.a)(t-2,n),i,a,r),d=Xm(Object(qn.a)(t-1,n),i,a,r),p=s,v=Object(Wm.a)(s,l,c,h),m=Object(Wm.a)(d,u,h,c),y=Object(Wm.a)(s,f,u,d),b=new Float32Array(8);return b[0]=p.x,b[1]=p.y,b[2]=v.x,b[3]=v.y,b[4]=m.x,b[5]=m.y,b[6]=y.x,b[7]=y.y,[Object(Xp.c)({x:e,y:e},m),b]},$m=function(e,t,n,r,a,i){var o={x:e,y:e},s=Xm(n,o,r,a),c=Xm((n+1)%i,o,r,a),u=(Xm((n+2)%i,o,r,a),Xm((n+3)%i,o,r,a)),l=(Xm(Object(qn.a)(n-3,i),o,r,a),Xm(Object(qn.a)(n-2,i),o,r,a)),f=(Xm(Object(qn.a)(n-1,i),o,r,a),Object(Wm.a)(s,u,c,l)),h=new Float32Array(6);return h[0]=s.x,h[1]=s.y,h[2]=f.x,h[3]=f.y,h[4]=c.x,h[5]=c.y,h},Xm=function(e,t,n,r,a){r.flat(16);var i=r.length,o=a?-2*Math.PI*e/i-1.5*Math.PI:2*Math.PI*e/i-.5*Math.PI;return{x:t.x+n*Math.cos(o),y:t.y+n*Math.sin(o),deg:o}};Object(pi.a)("jhits",{"trigger-routing":"",tidals:"",radius:""},"Outputs coords of triggers",function(){return 3},{inlets:3,outlets:["positions","durations","trigger durations"]});var ey=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:133,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:140,r=void 0,a=[],i=0;i<e.length;i++){var o=e[i].cycle,s=r||Math.max(.001,t-24*i);a.push(s);for(var c=o,u=c.length,l=0;l<c.length;l++){var f=c[l];Array.isArray(f)&&(f=f[0]);var h=Ym(n,l,u,o,s,{x:n,y:n},f),d=Object(v.a)(h,2),p=d[0];d[1];p&&(r=p)}}return a};Object(pi.a)("jclock",{tidals:""},"Returns meshes for the clock hands",void 0,{inlets:1});function ty(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ny(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ny(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ny(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("polygonsToMeshes",{polygons:"",material:""},"Converts a list of polygon points to meshes",void 0,{tags:"Graphics",inlets:2});function ry(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ay(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ay(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ay(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var iy=function(e){for(var t=e.tracks[0].patterns.length,n=[],r=0;r<t;r++)e.switchToPattern(r),n.push(e.length);return n},oy=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f,h,d,p,v,m,y;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.sequencerEngine).store.dispatch(Object(J.gc)("Freezing track's patterns")),e.next=4,Object(M.a)(100);case 4:return n.stop(),r=t.slots.filter(function(e){return e}),i=r[0].patterns.length,o=iy(n),n.switchToPattern(0),e.next=11,Object(Ue.a)(n,t);case 11:return s=e.sent,e.next=14,We(n,s,i,r);case 14:c=e.sent,u=sy(t),l=u.frozenPad,f=u.frozenTracks,h=ry(r);try{for(h.s();!(d=h.n()).done;)p=d.value,n.deleteTrack(p.trackNumber)}catch(a){h.e(a)}finally{h.f()}v=n.addMultiFreezeTrack(),m=v.patterns.length;case 20:if(!(m<i)){e.next=26;break}return e.next=23,v.newPattern(!0);case 23:m++,e.next=20;break;case 26:for(v.freeze(c,!0),v.frozenPad=l,v.frozenTracks=f,y=0;y<i;y++)n.switchToPattern(y),v.currentPattern=y,v.pattern.changeLength(o[y]),v.frozenColumns[0].playing=y;n.switchToPattern(0),n.switchToPattern(n.currentPattern),n.store.dispatch(Object(J.gc)(void 0)),n.tracks.forEach(function(e){return e.trackIsLoading=!1});case 34:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),sy=function(e){var t,n=e.getJsonForPack(),r=[],a=ry(e.tracks);try{for(a.s();!(t=a.n()).done;){var i=t.value;r.push(!!i&&V(i))}}catch(o){a.e(o)}finally{a.f()}return{frozenPad:n,frozenTracks:r}};function cy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var uy=function(e){Object(u.a)(n,e);var t=cy(n);function n(e){var r;return Object(o.a)(this,n),r=t.call(this,e),e.setAttribute("secondary-color","#020202"),e.setAttribute("primary-color","#1b1b1b"),e.newAttribute("slot-color"),e.newAttribute("slot-opacity"),e.newAttribute("Pads Per Row",3),e.newAttribute("Number of Pads",9,function(e){r.pad&&r.pad.onChangePadsCount(e)}),e.newAttribute("Show Track Names",!0),e.newAttribute("stereo oscilloscope",!1,function(e){e&&(r.pad?r.pad.startStereoWaveforming():r.needsStereoWaveforming=!0)}),e.newAction("Clear Pattern",function(){return r.clearPattern()}),e.newAction("Freeze Pads",function(){return r.freezePads()}),r}return Object(s.a)(n,[{key:"clearPattern",value:function(){this.pad.slotTracks.forEach(function(e){return e.pattern.clear()}),this.sequencerEngine.updateTracks()}},{key:"isDeletable",value:function(){return this.pad&&0===this.pad.slots.filter(function(e){return e}).length}},{key:"dispose",value:function(){this.subSequence.deletePad(this.pad)}},{key:"freezePads",value:function(){oy(this.pad)}},{key:"linkPad",value:function(e){e&&(this.pad=e,this.pad.zObject=this.zObject,this.pad.zObject.newAttribute("minimized",!1),this.pad.onSizeChange(this.zObject.width,this.zObject.height),this.needsStereoWaveforming&&this.pad.startStereoWaveforming())}},{key:"getJson",value:function(e){var t=Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e),r=void 0,a=void 0;if(e){var i=this.pad.getJsonForPack();r=[];for(var o=0;o<i.length;o++)r.push(i[o]);a=i.fx}return Object(d.a)({},t,{padId:this.pad.id,pad:r,fx:a})}},{key:"fromJson",value:function(e,t){var r=this;Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t);var a=e.padId,i=this.subSequence.getRootSubSequence?this.subSequence.getRootSubSequence():this.subSequence;e.pad?(console.log("load pack as pads=",e.pad),i.loadPackAsPads(e.pad,e.fx,this.pad).then(function(e){return r.linkPad(e)})):this.linkPad(i.pads.find(function(e){return e.id===a}))}}]),n}(Ni.a);Object(pi.a)("pad",{},"Drum pad for sounds",function(e){return 0},{inlets:0});Object(pi.a)("pad.showSequencer",{flag:""},"Shows sequencer");Object(pi.a)("zl",{mode:"mode"},"Concatenates the list arguments together",void 0,{isHot:!0});Object(pi.a)("split",{min:"min",max:"max"},"Sends incoming msgs that are within a range out the left-inlet, and the rest through the right.",void 0,{tags:"Messages"});function ly(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}new oi.a;Object(pi.a)("comment",{},"Creates comment box");var fy=function(e){Object(u.a)(n,e);var t=ly(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).text="",r}return Object(s.a)(n,[{key:"fromJson",value:function(e){this.text=e.text}},{key:"getJson",value:function(){return{text:this.text}}},{key:"getParameters",value:function(){return[]}}]),n}(Ni.a);Object(pi.a)("get",{object:"object",field:"number"},"Gets field from meessage. I.E. get ",void 0,{isHot:!0,inlets:2,tags:"Object Utilities"});Object(pi.a)("set",{field:"number",value:"number"},"Sets field from message. I.E. set ",void 0,{tags:"Object Utilities"});Object(pi.a)("object.create",{value:"number",field:"number"},"Create an object json out of value and field",void 0,{tags:"Object Utilities",inlets:2});Object(pi.a)("object.keys",{object:"object"},"Gets keys as list from object",function(){return 1},{tags:"Object Utilities"});Object(pi.a)("object.builder",{args:"args"},"Creats a list out of the inlets",void 0,{isHot:!0,tags:"List",inlets:function(e){return e+1}});function hy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function dy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var py=function(e){Object(u.a)(n,e);var t=dy(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e,r,a,"Instanced")).instanceObjectMapping={},i}return Object(s.a)(n,[{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];arguments.length>2&&arguments[2];return this.id=t?Object(q.uuid)():e.id,this.sequencerEngine.idToObject[this.id]=this,{}}},{key:"getJson",value:function(){return{id:this.id}}},{key:"dispose",value:function(){var e=this;this.implements&&(this.implements.instances=this.implements.instances.filter(function(t){return t!==e}))}},{key:"isDeletable",value:function(){return!0}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=hy(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).objectRegistry={},e}return Object(s.a)(n,[{key:"registerObject",value:function(e,t){this.objectRegistry[e.id]=t}},{key:"lookupObject",value:function(e){return this.objectRegistry[e.id]}}]),n}(e)}(pf));Object(pi.a)("subpatch",{name:"Name of the subpatch"},"Creates an encapsulated patcher",function(){return 0},{inlets:[]});Object(pi.a)("instancedSubpatch",{},"Creates an encapsulated patcher",function(){return 0},{inlets:[]});Object(pi.a)("track",{},"Track object",function(){return 0},{inlets:0});Object(pi.a)("counter",{min:"",max:""},"counts number of input messages received",function(){return 2},{tags:"Ticker",isHot:!0,inlets:["Input","Direction","Reset"]});Object(pi.a)("simpleCounter",{value:"",min:"",max:""},"counts number of input messages received",void 0,{tags:"Ticker",isHot:!0,inlets:["decrement","increment","value"]});var vy=1e-5;Object(pi.a)("list.matrixMultiplyList",{"list of matrices (1&2)":""},"Takes 2 lists and multiples each pair of matrices together into a new list",function(){return 1},{isHot:!0,inlets:2});Object(pi.a)("list.matrixMultiply",{"list of matrices 1":"","matrix of matrices 2":""},"Takes 2 lists and multiples each pair of matrices together into a new list",function(){return 1},{isHot:!0,inlets:2});function my(e,t){for(var n=e.length,r=e[0].length,a=(t.length,t[0].length),i=new Array(n),o=0;o<n;++o){i[o]=new Array(a);for(var s=0;s<a;++s){i[o][s]=0;for(var c=0;c<r;++c)i[o][s]+=e[o][c]*t[c][s],Math.abs(i[o][s]-0)<vy&&(i[o][s]=0)}}return i}Object(pi.a)("list.allIdentity",{"list of matrices 1":""},"Takes 2 lists and multiples each pair of matrices together into a new list",function(){return 1});var yy=function(e){var t=Object(v.a)(e,3),n=t[0],r=t[1],a=t[2];return 1===n[0]&&0===n[1]&&0===n[2]&&0===r[0]&&1===r[1]&&0===r[2]&&0===a[0]&&0===a[1]&&1===a[2]},by={"list.matrixMultiply":function(e,t){return function(e){var n=Object(v.a)(e,1)[0],r=t();if(!n&&r)return[r];if(!r)return[n];for(var a=[],i=0;i<n.length;i++){var o=n[i],s=r[i];if(o&&s){var c=my(o,s);a.push(c)}}return[a]}},"list.matrixMultiplyList":function(e){return function(e){var t=Object(v.a)(e,1)[0],n=Object(v.a)(t,2),r=n[0],a=n[1];if(!r&&a)return[a];if(!a)return[r];for(var i=[],o=0;o<r.length;o++){var s=r[o],c=a[o];if(s&&c){var u=my(s,c);i.push(u)}}return[i]}},"list.allIdentity":function(e){return function(e){var t=Object(v.a)(e,1)[0];if(Array.isArray(t))return t.every(function(e){return yy(e)})?[0]:[t]}}},gy=n(607);Object(pi.a)("jvelocities",{cycles:""},"Returns list of velocities for cycle",function(){return 1},{});function Oy(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return jy(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jy(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function jy(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(pi.a)("jaki.info",{tidals:""},"",function(){return 4},{outlets:["cycle string","figures","length","accent count","generated cycle"]});Object(pi.a)("jaki.leafType",{triggers:""},"",function(){return 6},{});Object(pi.a)("jaki.handBinary",{hand:""},"Converts hand value to binary list of lenght 2");Object(pi.a)("jaki.fromBinary",{binary:""},"Converts to hand values from binary list");Object(pi.a)("jaki.triggerHands",{triggers:""},"Returns a list of durations per hand",function(){return 1},{});function ky(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wy=function(e){Object(u.a)(n,e);var t=ky(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).newInlet(S.o,function(e){e[0]&&(r.tidals=e[0],r.jaki=r.tidals[0].scriptEffect)}),r}return n}(Ni.a);Object(pi.a)("jdebug",{},"",function(){return 1},{inlets:0});function xy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Sy=function(e){Object(u.a)(n,e);var t=xy(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).color="#A19A9A",r.backgroundColor="#100B0B",r.fillColor="#757474",r.dotColor="#B5B5B5",r.newInlet("color",function(e){r.color=e[0]}),r.newInlet("backgroundColor",function(e){return r.backgroundColor=e[0]}),r.newInlet("fillColor",function(e){return r.fillColor=e[0]}),r.newInlet("dotColor",function(e){return r.dotColor=e[0]}),r}return n}(Ni.a),Py=n(869),Ey=n(993),Ty=n(871);Object(pi.a)("jaki",{},"Generative drums",["trigger-routing"],{inlets:[S.f,S.h,S.c],tags:"Rhythm",connects:[{outlet:S.o,object:"jgraphics",inlet:S.o},{outlet:"trigger-routing",object:"pad",inlet:"trigger-routing"}]});Object(pi.a)("jparams",{},"Parameters for Jaki Object",void 0,{tags:"Rhythm",inlets:[],outlets:["params"],connects:{object:"jaki",inlet:"params"}});Object(pi.a)("jrules",{},"Rules for Jaki Object",function(e){return 0},{});Object(pi.a)("jfigures",{},"Figures for Jaki Object",["figures"],{tags:"Rhythm",connects:{object:"jaki",inlet:"figures"}});Object(pi.a)("jgraphics",{},"Draws graphics for a Jaki object",void 0,{tags:"Rhythm",inlets:[S.o]});var Ay={jaki:function(e){var t=new K.a;t.loadDefaults(),t.velocity=.5,t.duration=1e6,e.needsTick=!0;var n=new gy.a(e.subSequence,e);return e.effect=n,function(e){var r=Object(Yi.a)(e),a=r[0],i=r.slice(1);switch(a){case S.n:var o=Object(v.a)(i,2),s=o[0],c=o[1];if(n.onNewStep(s,c),0===s){var u=new $e.a(t,c,s);n.input(u),n._seedTrigger=u}var l=n.output(c,s,s);return[[S.p,l,s]];case S.l:n.stop();break;case S.k:n.clear();break;case S.f:var f=i[0]!==n.jakiParams;n.jakiParams.needsUpdate&&(f=!0,n.jakiParams.needsUpdate=!1),n.jakiParams=i[0],i[0].jaki=n,f&&n.registerContext(),i[0].onValueChange();break;case S.h:var h=i[0];Array.isArray(h[0])?h.forEach(function(e,t){return n.rules[t].rules=e}):n.rules[0].rules=h;break;case S.c:"string"===typeof i[0]?n.figures.onOperation("figures",i[0]):n.figures=i[0]}}},jparams:function(e){var t=new Py.a(e.subSequence,e);return e.newAttribute("overflow","visible"),e.setAttribute("primary-color","#111010"),e.setAttribute("border-radius",30),e.newAttribute("minimized",!1),e.effect=t,e.needsStart=!0,function(e){return Object(v.a)(e,1)[0],t}},jrules:function(e){var t=new Ty.a(e.subSequence,e);return e.width=340,e.height=240,t.width=340,t.height=240,e.effect=t,e.needsStart=!0,function(e){Object(v.a)(e,1)[0],t.publishRules()}},jfigures:function(e){var t=new Ey.a(e.subSequence,e);return e.effect=t,e.needsLoad=!0,function(e){return Object(v.a)(e,1)[0],t}},jgraphics:function(e){var t=new Sy(e);return e.effect=t,function(e){var n=Object(v.a)(e,2),r=n[0],a=n[1];switch(r){case S.o:t.tidals=a}}},jdebug:function(e){new wy(e);return e.setAttribute("primary-color","#5800ff"),e.setAttribute("border-radius",30),function(e){Object(v.a)(e,1)[0]}},"jrules.filter":function(e){new om(e);return function(){}},jvelocities:function(e){var t=void 0;return function(e){var n=Object(v.a)(e,1)[0][0];if(n){var r=n.cycle;if(t||(t=new Array(r.length).fill(0)),t.length<r.length)for(var a=t.length;a<r.length;a++)t[a]=0;else t.length>r.length&&(t=t.slice(0,r.length));var i=n.lastLeafStep;if(i){var o=n.lastLeafNumber,s=i.wasRest?.01:Math.max(.01,i.velocity);return t[o]=s,[t]}}else console.log("no tidal")}},"jaki.info":function(e){return function(e){var t=Object(v.a)(e,1)[0][0],n=t.scriptEffect;if(n){var r=n.figures.figures.map(function(e){return e.figureLength}).join(" - "),a=n.figures.figures.map(function(e){return e.toString()}).join("");a=a.replaceAll(" ","");var i,o=t.cycleLength/2,s=0,c=Oy(t.cycle);try{for(c.s();!(i=c.n()).done;)i.value.accent&&s++}catch(u){c.e(u)}finally{c.f()}return[a,r,o,s,t.cycleString.replaceAll("'","").replaceAll(",","").replaceAll(" ","")]}}},"jaki.leafType":function(e){return function(e){var t=Object(v.a)(e,1)[0];if(t[1]){var n,r=new Array(6).fill(void 0),a=Oy(t[1]);try{for(a.s();!(n=a.n()).done;){var i=n.value;r[i.outputNumber-1]=i.stepData.leafType.type}}catch(o){a.e(o)}finally{a.f()}return r}}},"jaki.handBinary":function(e){return function(e){var t=Object(v.a)(e,1)[0];return 0===t?[[0,1]]:1===t?[[1,0]]:2===t?[[1,1]]:[[0,0]]}},"jaki.fromBinary":function(e){return function(e){for(var t=Object(v.a)(e,1)[0],n=[],r=0;r<t.length;r+=2)0===t[r]&&0===t[r+1]?n.push(3):1===t[r]&&0===t[r+1]?n.push(1):0===t[r]&&1===t[r+1]?n.push(0):1===t[r]&&1===t[r+1]&&n.push(2);return[n]}},"jaki.triggerHands":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(n[1]&&Array.isArray(n[1])){var r,a=new Array(2*(t()||7)).fill(0),i=Oy(n[1]);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=o.stepData;a[2*(o.outputNumber-1)+(s.hand?0:1)]=s.duration}}catch(c){i.e(c)}finally{i.f()}return[a]}}}};Object(pi.a)("jwhen",{predicate:"predicate",action:"action"},"When predicate is met do action",void 0,{isHot:!0});Object(pi.a)("jbefore",{predicate:"predicate",action:"action"},"When predicate is met do action",void 0,{isHot:!0});Object(pi.a)("jafter",{predicate:"predicate",action:"action"},"When predicate is met do action",void 0,{isHot:!0});Object(pi.a)("jotherwise",{action:"action"},"If no other predicates are met, do action",void 0,{isHot:!0});var My=function(e){switch(e){case"accent":return lm.a;case"legato":return lm.e;case"piano":return lm.i;case"rest":return lm.k;case"staccato":return lm.m;case".":return Object(zh.c)();case"-":return Object(zh.b)(0);case"--":return Object(zh.b)(1);case"double":return lm.c;case"flam":return lm.d;case"after":return lm.o;case"before":return lm.r}},Ry={jwhen:function(e,t,n){return function(){var e=My(t()),r=My(n());if(e&&r)return Object(lm.u)(e).always(r)}},jotherwise:function(e,t){return function(){var e=My(t());if(e)return Object(lm.s)().always(e)}},jafter:function(e,t,n){return function(){var e=My(t()),r=My(n());if(e&&r)return Object(lm.o)(e).always(r)}},jbefore:function(e,t,n){return function(){var e=My(t()),r=My(n());if(e&&r)return Object(lm.r)(e).always(r)}}};Object(pi.a)("+",{},"Adds the inlets together outputting it from the outlet",void 0,{isHot:!0,inlets:2,tags:["Math"]});Object(pi.a)("-",{},"Subtracts the 2nd inlet from the 1st, outputting it from the outlet",void 0,{isHot:!0,inlets:2,tags:["Math"]});Object(pi.a)("notNaN",{x:""},"Psas if it is a number");Object(pi.a)("!",{x:""},"!x");Object(pi.a)("*",{},"Multiplies the left and right inlets together",void 0,{isHot:!0,inlets:2,tags:["Math"]});Object(pi.a)("/",{},"Divides the left and right inlets together",void 0,{isHot:!0,tags:["Math"],inlets:2});Object(pi.a)("pow",{a:"",b:""},"Returns left inlet raised to power of right inlet",void 0,{inlets:2,isHot:!0,tags:["Math"]});Object(pi.a)("spow",{a:"",b:""},"Returns left inlet raised to signed power of right inlet",void 0,{inlets:2,isHot:!0,tags:["Math"]});Object(pi.a)("sqrt",{},"Returns square-root of left inlet",void 0,{tags:["Math"]});Object(pi.a)("sin",{},"Returns sine of left inlet",void 0,{tags:["Math"]});Object(pi.a)("atan",{a:"",b:""},"Returns atan2 of left inlet",void 0,{inlets:2,tags:["Math"]});Object(pi.a)("cos",{},"Returns cosine of left inlet",void 0,{tags:["Math"]});Object(pi.a)("round",{},"Returns rounded value of left inlet",void 0,{tags:["Math"]});Object(pi.a)("remainderRound",{x:"",y:""},"Returns rounded value of left inlet",void 0,{inlets:2,tags:["Math"]});Object(pi.a)("floor",{},"Returns floored value of left inlet",void 0,{tags:["Math"]});Object(pi.a)("%",{a:""},"Returns remainder of the left-inlet divided by the right-inlet",void 0,{inlets:2,isHot:!0,tags:["Math"]});Object(pi.a)("mod",{a:""},"Returns remainder of the left-inlet (not negative adjusted) divided by the right-inlet",void 0,{inlets:2,isHot:!0,tags:["Math"]});Object(pi.a)("remainder",{a:""},"Returns remainder and divider of the left-inlet divided by the right-inlet",function(){return 2},{inlets:2,isHot:!0,tags:["Math"]});Object(pi.a)("abs",{a:""},"Returns absolute value of the left-inlet",void 0,{inlets:1,tags:["Math"]});Object(pi.a)("max",{a:"",b:""},"Returns max value of the left-inlet and right-inlet",void 0,{inlets:2,tags:["Math"]});Object(pi.a)("min",{a:"",b:""},"Returns min value of the left-inlet and right-inlet",void 0,{inlets:2,tags:["Math"]});Object(pi.a)("amin",{a:"",b:""},"Returns (absolute value) min value of the left-inlet and right-inlet",void 0,{inlets:2,tags:["Math"]});Object(pi.a)("filterBetween",{value:"",a:"",b:""},"Passes if value is between a and b",void 0,{inlets:3,tags:["Math"]});Object(pi.a)("number2hex",{number:""},"Converts number in base 10 to a hexadecimal string");Object(pi.a)("hexalist",{number:""},"Convert a number in base 10 to a list of numbers from 0-15 (i.e. hexa)",void 0,{inlets:1});Object(pi.a)("clamp",{a:"",b:"",c:""},"Returns clamped value of inlet",void 0,{inlets:3,isHot:!0,tags:["Math"]});Object(pi.a)("pi",{},"Returns value for pi when it receives a message");Object(pi.a)("random.int",{max:""},"Returns random int from 0 - max");var Cy={"+":function(e,t){return function(e){if(Array.isArray(e[0]))return[e[0].map(function(e,n){return Array.isArray(t())?isNaN(e)||isNaN(t()[n])?e:e+t()[n]:e+t()})];var n=t()+e[0];return isNaN(n)?1:n}},pi:function(e){return e.needsLoad=!0,function(){return Math.PI}},min:function(e,t){return function(e){return Array.isArray(e[0])?[e[0].map(function(e){return Math.min(e,t())})]:[Math.min(e[0],t())]}},max:function(e,t){return function(e){return[Math.max(e[0],t())]}},clamp:function(e,t,n){return function(e){return isNaN(e[0])?t():Math.min(Math.max(e[0],t()),n())}},"-":function(e,t){return function(e){if(Array.isArray(e[0]))return[e[0].map(function(e,n){return Array.isArray(t())?e-t()[n]:e-t()})];var n=e[0]-t();return isNaN(n)?1:n}},"*":function(e,t){return function(e){if(Array.isArray(e[0]))return[e[0].map(function(e,n){return Array.isArray(t())?isNaN(e)||isNaN(t()[n%t().length])?e:e*t()[n%t().length]:isNaN(t())||isNaN(e)?e:e*t()})];var n=t()*e[0];return isNaN(n)?1:n}},"/":function(e,t){return function(e){if(Array.isArray(e[0]))return[e[0].map(function(e,n){return Array.isArray(t())?e/t()[n]:e/t()})];var n=e[0]/t();return isNaN(n)?1:n}},"%":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(Array.isArray(n)){var r=t();return[n.map(function(e){return Object(qn.a)(e,r)})]}return Object(qn.a)(n,t())}},pow:function(e,t){return function(e){var n=t();isNaN(n)&&(n=1);var r=e[0];return Array.isArray(r)?[r.map(function(e){return Math.pow(e,n)})]:Math.pow(e[0],n)}},sqrt:function(){return function(e){return Math.sqrt(e[0])}},round:function(){return function(e){var t=Math.round(e[0]);if(!isNaN(t))return t}},floor:function(){return function(e){if(Array.isArray(e[0]))return[e[0].map(function(e){return Math.floor(e)})];var t=Math.floor(e[0]);return isNaN(t)?void 0:t}},abs:function(e){return function(e){return Array.isArray(e[0])?[e[0].map(function(e){return Math.abs(e)})]:Math.abs(e[0])}},hexalist:function(e){return function(e){for(var t=e[0].toString(16),n=[],r=0;r<t.length;r++)n.push(parseInt(t[r],16));return[n]}},remainder:function(e,t){return function(e){return[[Object(qn.a)(e[0],t()),Math.floor(e[0]/t())]]}},sin:function(){return function(e){return Math.sin(e[0])}},cos:function(){return function(e){return Math.cos(e[0])}},notNaN:function(){return function(e){var t=Object(v.a)(e,1)[0];if(!isNaN(t))return[t]}},"random.int":function(e){return function(e){var t=Object(v.a)(e,1)[0];return Math.floor(Math.random()*t)}},"!":function(){return function(e){var t=Object(v.a)(e,1)[0];return 0===t?[1]:1===t?[0]:[!t]}},amin:function(e,t){return function(e){var n=Object(v.a)(e,1)[0],r=t();return Math.abs(n)>r?n<0?-r:r:n}},number2hex:function(){return function(e){return Object(v.a)(e,1)[0].toString(16)}},filterBetween:function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0],a=n();if(r>=t()&&r<=a)return[r]}},atan:function(e,t){return function(e){return Math.atan2(e[0],t())}},spow:function(e,t){return function(e){var n=t();isNaN(n)&&(n=1);var r=e[0];return Array.isArray(r)?[r.map(function(e){return(e<0?-1:1)*Math.pow(e,n)})]:(e[0]<0?-1:1)*Math.pow(e[0],n)}},remainderRound:function(e,t){return function(e){var n=Object(v.a)(e,1)[0],r=Object(qn.a)(n,t());return r>t()/2?n-r+t():n-r}},mod:function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(Array.isArray(n)){var r=t();return[n.map(function(e){return e%r})]}return n%t()}}};Object(pi.a)("pack",{args:"args"},"Creats a list out of the inlets",void 0,{tags:"List",inlets:function(e){return e}});Object(pi.a)("packFull",{args:"args"},"Creats a list out of the inlets (once all inlets are full)",void 0,{tags:"List",isHot:!0,inlets:function(e){return e}});Object(pi.a)("pak",{args:"args"},"Creates a list out of the inlets (all hot inlets)",void 0,{tags:"List",inlets:function(e){return e},isHot:!0});Object(pi.a)("unpack",{args:"args"},"Send a list out individual outlets",function(e){return e},{tags:"List"});Object(pi.a)("replacepak",{list:"override list",args:"args"},"Pak but allows overriding the list",void 0,{tags:"List",inlets:function(e){return e+1},isHot:!0});Object(pi.a)("indexpack",{"index + value pair":""},"Inserts into stored list at index",function(){return 1},{inlets:function(e){return e+1}});Object(pi.a)("togglepack",{"index + value pair":""},"Inserts into stored list at index",function(){return 1},{inlets:function(e){return e+1}});Object(pi.a)("select",{args:"args"},"Matches messages by arguments and sends them to the respective output",function(e){return e},{tags:"Messages"});Object(pi.a)("between",{args:"args"},"Matches messages by arguments and sends them to the respective output",function(e){return e+1},{tags:"Messages"});Object(pi.a)("nameIndex",{args:"args"},"");var Ny=function(e,t){try{return parseFloat(e)===parseFloat(t)}catch(n){return e===t}};function Iy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var qy=function(e){Object(u.a)(n,e);var t=Iy(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).x=.5,r.y=.5,r.newInlet("xy",function(e){var t=Object(v.a)(e,1)[0];return r.onXY(t)}),r.newOutlet("xy"),r}return Object(s.a)(n,[{key:"onXY",value:function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1];this.setXY(n,r)}},{key:"sendCoordinates",value:function(){this.sendMessage("xy",[this.x,this.y])}},{key:"setXY",value:function(e,t){this.x=e,this.y=t,this.sendCoordinates()}},{key:"x",get:function(){return this._x},set:function(e){this._x=e}},{key:"y",get:function(){return this._y},set:function(e){this._y=e}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{x:this.x,y:this.y})}},{key:"fromJson",value:function(e,t){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.x=e.x,this.y=e.y}}]),n}(Ni.a);function _y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Dy=function(e){Object(u.a)(n,e);var t=_y(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).coordinates=[],r.numberOfCoordinates=0,r.newCoordinates(),r.newCoordinates(),r.newOutlet("coordinates"),r.zObject.newAttribute("x-axis","x"),r.zObject.newAttribute("y-axis","y"),r}return Object(s.a)(n,[{key:"newCoordinates",value:function(){this.zObject.newAttribute("coordinate-color-"+(this.numberOfCoordinates+1),"#ffffff"),this.zObject.newAttribute("coordinate-name-"+(this.numberOfCoordinates+1),"type name"),this.coordinates[this.numberOfCoordinates]={x:.5,y:.5},this.coordinates=Object(h.a)(this.coordinates),this.numberOfCoordinates++}},{key:"sendCoordinates",value:function(){this.sendMessage("coordinates",this.coordinates.map(function(e){return[e.x,e.y]}))}},{key:"setXY",value:function(e,t,n){this.coordinates[n]={x:e,y:t},this.sendCoordinates()}},{key:"getJson",value:function(){return Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{coordinates:this.coordinates,numberOfCoordinates:this.numberOfCoordinates})}},{key:"fromJson",value:function(e,t){Object(fe.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.numberOfCoordinates=2,this.coordinates=e.coordinates}}]),n}(Ni.a);Object(pi.a)("interface.xy",{},"Interface for controlling 2 numbers using x/y plane",function(){return 0},{inlets:0});Object(pi.a)("interface.multiXY",{},"Interface for controlling multiple pairs of 2 numbers using x/y plane",function(){return 0},{inlets:0});var Fy=n(1848),Ly=n.n(Fy),By=(n(358),n(309),!0);window.addEventListener("message",zy,!1);var zy=function(e){"use-pinata"===e.data?By=!0:"use-zequencer"===e.data&&(By=!1)};Object(pi.a)("record.mix",{"start/stop":"1 for start to for stop","channel input":"","max time":"","only send buffer":"if true then we dont convert/store on pinata"},"Records the global mix to a file",function(){return 7},{inlets:4,outlets:["hash","mp3 buffer","raw buffer","start step","silence at start","start time","end time"]});Object(pi.a)("record.pause",{"start/stop":"1 for start to for stop"},"Records the global mix to a file",function(){return 3});var Jy=function(e,t){return new Promise(function(n){var r=new FormData;t?r.append("file",e):r.append("file",new Blob([e]));fetch("https://api.pinata.cloud/pinning/pinFileToIPFS",{method:"POST",headers:{pinata_api_key:"66a8464d59553776562c",pinata_secret_api_key:"96b4e32f40381e7e062569b89530f28051e00b488ec88bf3aa21c920be109109"},body:r}).then(function(){var e=Object(i.a)(a.a.mark(function e(t){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:r=e.sent,n(r.IpfsHash);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())})},Vy=function(e){for(var t=[],n=new Ly.a.Mp3Encoder(e.length,44100,128),r=e[0],a=e[1],i=0;i<r.length;i+=1152){for(var o=r.subarray(i,i+1152),s=a?a.subarray(i,i+1152):void 0,c=0;c<o.length;c++)o[c]*=32767.5,s&&(s[c]*=32767.5);(u=s?n.encodeBuffer(o,s):n.encodeBuffer(o)).length>0&&t.push(u)}var u;return(u=n.flush()).length>0&&t.push(u),new Blob(t,{type:"audio/mp3"})},Hy=Object(d.a)({"record.mix":function(e,t,n,r){var o=e.sequencerEngine.channelMixer,s=[],c=!1,u=function(){var u=Object(i.a)(a.a.mark(function u(l){var f,h,d,p;return a.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:f=Object(v.a)(l,1),h=f[0],console.log("record mix called msg=",h),d=o.recorderWorklet;case 3:if(d){u.next=10;break}return console.log("no worklet"),u.next=7,Object(M.a)(100);case 7:d=o.recorderWorklet,u.next=3;break;case 10:console.log("finally passed reocrder worklet"),p=n()||30,d.maxChunks=Math.ceil(p/5),t()&&!s.includes(t())&&(t().connect(d),s.push(t())),"pause"===h?(console.log("pause"),c||d.stop()):"clear"===h?(console.log("msg clear"),d.clear()):0===h?(console.log("msg == =0"),d.stop(),e.sendMessage(e.outputByNumber(2),zc.a),c=!0,console.log("get buffer called"),d.getBuffer().then(function(){var t=Object(i.a)(a.a.mark(function t(n){var i,o,s,c,u,l,f;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.buffer,o=n.startTime,s=n.endTime,i){t.next=4;break}return console.log("no buffer"),t.abrupt("return");case 4:if(console.log("sending...",i[0].length),c=d.startSliceTime/re.a.Time("32n").toSeconds(),u=d.silenceLength,e.sendMessage(e.outputByNumber(3),c),e.sendMessage(e.outputByNumber(4),u),e.sendMessage(e.outputByNumber(5),o),e.sendMessage(e.outputByNumber(6),s),0!==i[0].length){t.next=14;break}return console.log("buffer was empty so not doing shit"),t.abrupt("return");case 14:if(!r()){t.next=17;break}return e.sendMessage(e.outputByNumber(2),i),t.abrupt("return");case 17:return t.next=19,Vy(i);case 19:if(l=t.sent,!By){t.next=26;break}return t.next=23,Jy(l,!0);case 23:t.t0=t.sent,t.next=29;break;case 26:return t.next=28,la.a.addArrayBuffer(l);case 28:t.t0=t.sent;case 29:f=t.t0,e.sendMessage(e.outputByNumber(0),f),e.sendMessage(e.outputByNumber(1),l),e.sendMessage(e.outputByNumber(2),i);case 33:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())):1===h&&(console.log("recorder worklet. record"),d.record());case 15:case"end":return u.stop()}},u)}));return function(e){return u.apply(this,arguments)}}();return function(e){return u(e)}},lengthCoord:function(e){return function(e){var t=Object(v.a)(e,1),n=Object(v.a)(t[0],2),r=n[0],a=n[1];return zo([r,a])}},"record.pause":function(e){var t=e.sequencerEngine.channelMixer;return function(e){Object(v.a)(e,1)[0];var n=t.recorderWorklet;n&&n.stop()}}},bs,Qc,{"interface.xy":function(e){new qy(e);return e.width=300,e.height=300,function(e){Object(v.a)(e,1)[0]}},"interface.multiXY":function(e){new Dy(e);return e.width=300,e.height=300,function(e){Object(v.a)(e,1)[0]}},"window.size":function(){return function(e){Object(Yi.a)(e);var t=document.getElementsByTagName("html")[0],n=[[t.clientWidth,t.clientHeight]];return console.log("WINDOW SIZE RECORDED = ",n),n}}},Ko,{indexpack:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=void 0;return function(e){var t=Object(v.a)(e,1)[0];if("clear"===t&&a){var r=new Array(a.length);return r.fill(0),a=r,[r]}var i=n.filter(function(e){return void 0!==e()&&null!==e()}).length;if(t.length===i)return[a=Object(h.a)(t)];var o=Object(v.a)(t,2),s=o[0],c=o[1];if(!a){a=new Array(i).fill(0);for(var u=0;u<a.length;u++)a[u]=n[u]()}return a[s]=c,[a]}},togglepack:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=void 0;return e.newAttribute("partition",1),function(t){var r=Object(v.a)(t,1)[0];if("clear"===r&&a){var i=new Array(a.length);return i.fill(0),a=i,[i]}var o=n.filter(function(e){return void 0!==e()&&null!==e()}).length;if(r.length!==o){var s=Object(v.a)(r,2),c=s[0],u=s[1];if(!a){a=new Array(o).fill(0);for(var l=0;l<a.length;l++)a[l]=n[l]()}var f=e.attributes.partition;if(e.attributes.partition>1){for(var d=c-c%f,p=d+f,m=d;m<p;m++)a[m]=0;a[c]=u}else a[c]?a[c]=0:a[c]=u;return[a]}a=Object(h.a)(r)}},replacepak:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a;return e.lastMessageReceived=0,function(t){var r=Object(v.a)(t,1)[0];if(r!==a&&Array.isArray(r))return e.args=Object(h.a)(r),void(a=r);a=r;var i=n.map(function(e){return e()}).filter(function(e){return void 0!==e});return i=i.slice(0,i.length),[Object(h.a)(i)]}}},os,fs,ws,ls,Ks,Is,ul,Ol,Us,yi,Mo,{concat:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=[];return function(e){if("bang"===e[0])return a;var t=n.map(function(e){return e()}).filter(function(e){return void 0!==e}).flatMap(function(e){return e});t=t.slice(0,t.length-1);var r=e[0]||[];return Array.isArray(r)||(r=[r]),a=[[].concat(Object(h.a)(r),Object(h.a)(t))]}}},Ro,{disablePlay:function(e){return function(t){var n=Object(v.a)(t,1)[0];e.sequencerEngine.disablePlay=!!n}},"sub.setGlobalSize":function(e){return function(t){var n=Object(v.a)(t,1)[0],r=Object(v.a)(n,2),a=r[0],i=r[1],o=e.subSequence;o.getRootSubSequence&&(o=o.getRootSubSequence()),console.log("set global size = ",a,i,o),pc(o,a,i)}},"canvas.setGlobalSize":function(e){return function(t){var n=Object(v.a)(t,1)[0],r=Object(v.a)(n,2),a=r[0],i=r[1],o=e.subSequence;o.getRootSubSequence&&(o=o.getRootSubSequence()),console.log("set canvas global size = ",a,i,o),vc(o,a,i)}},"list.indexOf":function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(!Array.isArray(n))return-1;var r=t();return n.indexOf(r)}},"save.hook":function(e){return function(e){return Object(v.a)(e,1)[0],"bang"}}},Ao,$s,{"list.prependIndex":function(e){return function(e){for(var t=Object(v.a)(e,1)[0],n=[],r=0;r<t.length;r++)Array.isArray(t[r])&&n.push([r].concat(Object(h.a)(t[r])));return[n]}}},uc,{"list.appendEvery":function(e,t){return function(e){for(var n=Object(v.a)(e,1)[0],r=[],a=t(),i=0;i<n.length;i++)Array.isArray(n[i])&&(Array.isArray(a)?r.push([].concat(Object(h.a)(n[i]),[a[i]])):r.push([].concat(Object(h.a)(n[i]),[a])));return[r]}},fillArray:function(e,t,n,r){return function(e){for(var a=Object(v.a)(e,1)[0],i=new Array(r()).fill(0),o=t();o<n();o++)i[o]=a;return[i]}}},ns,{listOsc:function(e){var t=void 0,n=void 0,r=void 0;return function(e){var a=Object(v.a)(e,1)[0];if(a&&(Array.isArray(a)||ArrayBuffer.isView(a))){t&&Math.pow(a.length,2)===t.length||(t=new Uint8Array(Math.pow(a.length,2)),n=new Uint8Array(Math.pow(a.length,2))),r&&t.set(n);for(var i=a.length,o=0;o<a.length;o++){var s=a[o],c=Math.floor(Math.abs(s)*i/2);if(s<0)for(var u=i/2;u>i/2-c;u--)t[u*i+o]=100;else for(var l=i/2;l<i/2+c;l++)t[l*i+o]=100}return r=a,t}}},centerFillArray:function(e,t){return function(e){var n=Object(v.a)(e,1)[0],r=new Array(t()).fill(0),a=Math.floor(Math.abs(n)*t()/2),i=0;if(n<0)for(var o=t()/2;o>t()/2-a;o--)r[o]=i++/a*100;else for(var s=t()/2;s<t()/2+a;s++)r[s]=i++/a*100;return r}},icon:function(e){new fc(e);return function(){}},interleavedConcat:function(){var e=[];return function(t){var n=Object(v.a)(t,1)[0];if(!Array.isArray(n))return[];e.length=0;for(var r=0;r<n[0].length;r++){var a,i=Zu(n);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.push(o[r])}}catch(s){i.e(s)}finally{i.f()}}return[e]}},between:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t=Object(v.a)(e,1)[0];if(t<n[0]()){var r=new Array(n.length).fill(void 0);return r[0]=t,r}for(var a=n.filter(function(e){return e()}).length,i=0;i<a-1;i++){var o=n[i](),s=n[i+1]();if(o<=t&&t<s){var c=new Array(n.length).fill(void 0);return c[i+1]=t,c}}if(t>=n[a-1]()){var u=new Array(n.length).fill(void 0);return u[a]=t,u}}},nameIndex:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t=Object(v.a)(e,1)[0];return n.map(function(e){return e()}).indexOf(t)}},interleaf:$u,"list.reverse":function(e){return function(e){var t=Object(v.a)(e,1)[0];return(t=Object(h.a)(t)).reverse(),[t]}},scale:rs.b,playback:function(e){new Hu(e);return function(){}},"pad.showSequencer":function(e){return function(t){var n=Object(v.a)(t,1)[0],r=e.sequencerEngine.currentSubSequence.pads[0];n&&r?e.dispatch(Object(J.Ud)(r)):e.dispatch(Object(J.Ud)(!1))}}},Bu,{nth:function(e,t){return function(e){return e[0][t()%e[0].length]}},"document.title":function(){return function(e){var t=Object(v.a)(e,1)[0];window.document.title=t}},"object.create":function(e,t){return function(e){var n={};return n[t()]=e,[n]}},"list.skipEvery":function(e,t,n){var r=void 0;return function(e){var a=Object(v.a)(e,1)[0],i=((new Date).getTime(),a.length/t()),o=a.length-i;r||(r=new Uint8Array(o));for(var s=0,c=0;c<a.length;c++)c%t()!==n()&&(r[s++]=a[c]);return(new Date).getTime(),[r]}},"list.isEveryEmpty":function(e,t,n,r){return function(e){for(var a=Object(v.a)(e,1)[0],i=((new Date).getTime(),r()),o=n(),s=t(),c=0;c<a.length;c++)if(c%s!==o&&a[c]>i)return[0];return(new Date).getTime(),[1]}},"samples.tag":function(e){new ms(e);return function(){}},"list.ratioBelow":function(e,t,n,r){return function(e){for(var a=Object(v.a)(e,1)[0],i=((new Date).getTime(),r()),o=n(),s=t(),c=0,u=0,l=0;l<a.length;l++)l%s!==o&&(a[l]<i&&c++,u++);return(new Date).getTime(),c/u}},uniqueAppend:function(e,t){var n=[];return function(e){var r=Object(v.a)(e,1)[0];"object"!==typeof r[0]&&(r=[r]);var a,i=op(r);try{for(i.s();!(a=i.n()).done;){for(var o=a.value,s=-1,c=0;c<n.length;c++)o.id===n[c].id&&(s=c);-1===s&&n.length<(t()||1)?n.push(o):n[s]=o,n.length>(t()||1)&&n.shift()}}catch(u){i.e(u)}finally{i.f()}if(n.length===(t()||1))return[n]}},modal:function(e,t,n,r,a,i){return function(o){if(Object(v.a)(o,1)[0]){var s=void 0,c=a(),u=i();if(Array.isArray(c)){s=[];for(var l=0;l<c.length;l++)s.push({text:c[l],url:u[l]})}else c&&u&&(s={text:c,url:u});e.dispatch(Object(J.gf)({zobject:e,text:t(),link:s,okButtonText:n(),cancelButtonText:r()}))}else e.dispatch(Object(J.gf)(void 0))}},progressbar:function(e,t){return function(n){Object(v.a)(n,1)[0]?e.dispatch(Object(J.hf)(t())):e.dispatch(Object(J.hf)(void 0))}},centroid:rv,"erc720.tokenID":function(e){e.needsLoad=!0;return window.addEventListener("message",function(t){if("erc721.tokenId"===(t=t.data).type){var n=t.body;e.sequencerEngine.tokenID=n,e.sendMessage(e.outputByNumber(0),n)}}),function(t){var n=Object(v.a)(t,1)[0];return"number"===typeof n&&(e.sequencerEngine.tokenID=n),[e.sequencerEngine.tokenID]}},"list.partition":function(e,t){return function(e){for(var n=Object(v.a)(e,1)[0],r=[],a=0;a<n.length;a+=t())r.push(n.slice(a,a+t()));return[r]}},messageSplitter:function(e){return function(t){for(var n=Object(Yi.a)(t).slice(0),r=0;r<n.length;r++)e.sendMessage(e.outputByNumber(r),n[r])}},"three.planeRenderer":function(e,t){e.needsLoad=!0;var n=new pf(e.subSequence,e.sequencerEngine,e,"planeRenderer"),r=n.createZObject(0,0,"three.planeGeometry"),a=n.createZObject(0,0,"three.orthographicCamera 0 1 0 1 -1 1"),i=n.createZObject(0,0,"three.scene"),o=n.createZObject(0,0,"three.mesh"),s=n.createZObject(0,0,"three.render");s.connectInlet("camera",a,"Output 1"),s.connectInlet("Input",i,"Output 1"),i.connectInlet("Input",o,"Output 1"),o.connectInlet("geometry",o,"Output 1"),new vu(n,void 0,function(t){e.lastOutput=t,e.sendMessage(e.outputByNumber(0),t)}).connectInlet("Input",s,"Output 1");var c=void 0;return function(e){var n=Object(v.a)(e,1)[0];if(n&&"Mesh"===n.type)i.onInputMessage(n);else{if(c!==t())return c=t(),void i.onInputMessage(c);if("dispose"!==n)return"start"===n?(r.bang(),void a.bang()):void(o.args&&n&&(r.bang(),a.bang(),o.lastMessageReceived=[r.geometry],o.onArg(1,[n])))}}}},Gs,{messageFilter:function(e,t){return function(e){if(t())return e}}},Js,{"haptic.vibrate":function(e){return function(e){var t=Object(v.a)(e,1)[0];"vibrate"in navigator&&navigator.vibrate(t)}},matrix:function(e){e.updates=0;var t=function(t,n){e.matrix=new Array(n);for(var r=0;r<n;r++)e.matrix[r]=new Array(t).fill(0);e.updates++};return e.newAttribute("size",5,function(e){t(e,e)}),function(n){var r=Object(v.a)(n,1)[0];if("string"===typeof r){var a=function(e){var t=e.split(" ");return[t[0],t.slice(1).map(function(e){return parseFloat(e)})]}(r),i=Object(v.a)(a,2),o=i[0],s=i[1];switch(console.log("operation =",o,s),o){case"clear":for(var c=e.matrix,u=0;u<c.length;u++)for(var l=0;l<c[u].length;l++)c[u][l]=0;return e.updates++,[c];case"toggle":var f=s[0];if(isNaN(f))return;var h=f%e.matrix.length,d=Math.floor(f/e.matrix.length)%e.matrix.length,p=e.matrix[h][d];return e.matrix[h][d]=0===p?1:0,e.updates++,[e.matrix];case"init":return t(s[0],s[1]),void e.updates++;case"set":return e.matrix[s[1]]&&s[0]<e.matrix[s[1]].length&&(e.matrix[s[1]][s[0]]=s[2],e.updates++),[e.matrix];case"values":for(var m=[],y=0;y<e.matrix.length;y++)for(var b=e.matrix[y],g=0;g<b.length;g++)b[g]===s[0]&&m.push([g,y]);return[m];case"closests":for(var O=[],j=e.matrix[s[1]][s[0]],k=0;k<e.matrix.length;k++)for(var w=e.matrix[k],x=0;x<w.length;x++)if(x!==s[0]&&k!==s[1]){var S=w[x];O.push([x,k,Math.abs(S-j)])}return O.sort(function(e,t){return e[2]-t[2]}),[O.map(function(e){var t=Object(v.a)(e,2);return[t[0],t[1]]})];case"get":if(e.matrix[s[1]])return[e.matrix[s[1]][s[0]]];break;case"init":return void t(s[0],s[1])}}}},globalReverse:function(e){return function(t){var n=Object(v.a)(t,1)[0];e.sequencerEngine.reverse=!!n}},loop:function(e,t){return function(n){var r=Object(v.a)(n,1)[0],a=t()||0;0===a&&(r=!1),a=Math.pow(2,a)/8,r?e.sequencerEngine.startNewLoop(a):e.sequencerEngine.looping=!1}},push:function(e,t){var n=[];return function(e){return n.unshift(e[0]),n.length>t()&&n.pop(),[n]}},"gl.material":El.a,vec3:function(e){var t=new bu(e);return e.needsLoad=!0,function(){t.sendObject()}},vec2:function(e){var t=new Tu(e);return e.needsLoad=!0,function(){t.sendObject()}},buttonPresser:function(e){new Yc(e);return e.newAttribute("button-color","#ffffff"),e.width=50,e.height=50,function(){}},groups:function(e){new Ku(e);return function(){}}},_u,{select:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){for(var t=0;t<n.length;t++){var r=n[t]();if(Ny(r,e[0])){var a=new Array(n.length).fill(void 0);return a[t]=e,a}}}}},tl,ip,{attributes:function(e){var t=new vl(e);return e.needsLoad=!0,function(e){return Object(v.a)(e,1)[0],t.loadBang(),[]}}},Pp,{varz:function(e){return new zs(e),function(){}},toggle:function(e){var t=new xp(e);return e.needsLoad=!0,e.width=50,e.height=50,function(e){var n=Object(v.a)(e,1)[0];"start"===n&&t.onInput(n)}},sparseList:function(e,t,n,r,a,i,o){return function(e){var s=Object(v.a)(e,1)[0],c=n()||100;Array.isArray(c)||(c=[c]);var u=r()||1,l=a()||[0],f=Math.round(t()*u);if(!isNaN(f)){var d,p=(i()?Object(h.a)(i()):void 0)||new Array(f).fill(o()||0),m=Zu(s);try{for(m.s();!(d=m.n()).done;){var y,b=d.value,g=0,O=Zu(l);try{for(O.s();!(y=O.n()).done;){var j=y.value;p[(parseInt(b)*u+j)%p.length]=c[g%c.length],g++}}catch(k){O.e(k)}finally{O.f()}}}catch(k){m.e(k)}finally{m.f()}return[p]}}},singleSparseList:function(e,t,n,r,a){return function(e){var i=Object(v.a)(e,1)[0],o=r()||1,s=a()||[0];Array.isArray(s)||(s=[s]);var c=Math.round(t()*o);if(!isNaN(c)){var u,l=new Array(c).fill(0),f=Zu(i);try{for(f.s();!(u=f.n()).done;){var h,d=u.value,p=Zu(s);try{for(p.s();!(h=p.n()).done;){var m=h.value;l[parseInt(d)*o+m]=n()}}catch(y){p.e(y)}finally{p.f()}}}catch(y){f.e(y)}finally{f.f()}return[l]}}},smokeColors:function(e){var t;return function(e){var n=Object(v.a)(e,1)[0];t||(t=new Float32Array(3*n.length));for(var r=0;r<n.length;r++){var a=Math.min(1,10*n[r]);t[3*r]=a,t[3*r+1]=a,t[3*r+2]=a}return[t]}},submix:function(e){new up(e);return function(){}},mixbuttons:function(e){new fp(e);return function(){}},loadBang:function(e){return e.needsLoad=!0,function(){return["bang"]}},startBang:function(e){return e.needsStart=!0,function(){return console.log("start bang called"),["bang"]}},average:function(e){return function(e){var t=Object(v.a)(e,1)[0],n=0;if(!t)return 0;for(var r=0;r<t.length;r++)n+=t[r];return n/t.length}},roll:function(e){new dp(e);return function(){}},macro:function(e){var t=new Vp(e);return e.needsLoad=!0,function(e){Object(v.a)(e,1)[0],t.sendMessage("value changed",t.value)}},mouseSDF:El.b,triangulate:function(e,t){return function(e){var n=e[0];if(n&&t())return[Object(Kv.c)(n,t())]}},print:function(){return function(e){var t=Object(v.a)(e,1)[0];return console.log(t)}},averageDistance:function(e,t){return function(e){var n=Object(v.a)(e,1)[0],r=t(),a=0;if(!n||!r)return 0;for(var i=0;i<n.length;i+=2){var o=n[i],s=n[i+1],c=r[i],u=r[i+1];a+=Math.sqrt(Math.pow(o-c,2)+Math.pow(s-u,2))}return a/(n.length/2)}},dpad:function(e){var t=new Cp(e);return e.effect=t,function(){}},system5:function(e){return e.effect=new vp(e),function(){}},sampleBank:function(e){return e.effect=new gp(e),function(){}},drawTriangles:function(e,t){return function(n){var r=n[0],a=t()||"#ffffff";e.sendMessage(e.outputByNumber(0),"drawTriangles",a,r)}},jrepl:function(e){new Fp(e);return function(){}},cirklon:function(e){return e.effect=new Ip(e),function(){}},patterns:function(e){return e.effect=new _p(e),function(){}},store:function(e,t){return function(n){var r=Object(v.a)(n,1)[0];if("clear"===r&&(e.args[0]=void 0),"bang"===r){if(void 0===t())return;return[t()]}}},drawArray:function(e,t,n){return function(r){var a=r[0],i=t()||2,o=n()||"#ffffff";e.sendMessage(e.outputByNumber(0),"drawArray",i,o,a)}},polygonsToMeshes:function(e,t){var n=[],r=[],a=[],i=[];return function(o){var s=Object(v.a)(o,1)[0];if(s){var c,u=0,l=[],f=ty(s);try{var h=function(){var e=c.value,o=$u(0,0,2)([e]),s=Wv()([e]);i[u]=s&&s[0];var f=u;n[u]||(n[u]=Sv(0,void 0,function(){return i[f]}));var h=n[u](o);if(h){a[u]||(a[u]=jv(0,function(){return t()}));var d=a[u](h);d&&(l.push(d[0]),r.push(d[0]))}u++};for(f.s();!(c=f.n()).done;)h()}catch(g){f.e(g)}finally{f.f()}var d,p=[],m=[],y=ty(r);try{for(y.s();!(d=y.n()).done;){var b=d.value;l.includes(b)?m.push(b):p.push(b)}}catch(g){y.e(g)}finally{y.f()}return r=m,e.sendMessage.apply(e,[e.outputByNumber(0),"remove"].concat(p)),[l]}}},triangle:function(e,t,n,r){return function(a){var i=a[0],o=t(),s=n();i&&o&&s&&(e.sendMessage(e.outputByNumber(0),"triangle ".concat(i.x," ").concat(i.y," ").concat(o.x," ").concat(o.y," ").concat(s.x," ").concat(s.y)),e.sendMessage(e.outputByNumber(0),"fill ".concat(r())))}},synthcontrol:function(e){var t=new xl(e);return e.needsLoad=!0,function(){t.sendADSRLevels(),t.sendOscillatorLevels()}},switch:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a,i;return function(e){var t=Object(v.a)(e,1)[0]-1;if(n[t]){var r=n[t]();if(a!==t||i!==r)return i=r,a=t,[r];i=r,a=t}}},outSwitch:function(e,t){return function(e){var n=Object(v.a)(e,1)[0],r=t(),a=new Array(r).fill(void 0);return a[r-1]=n,a}},dedupe:function(e){var t;return e.needsStart=!0,e.newAttribute("needsStart",!0,function(t){e.needsStart=t}),e.newAttribute("loadWith",void 0,function(e){t=e}),function(e){var n=Object(v.a)(e,1)[0];if("start"!==n)return n!==t?(t=n,[n]):void 0;t=void 0}},"dedupe.deep":function(e){var t;return e.needsStart=!0,function(e){var n=Object(v.a)(e,1)[0];if("start"!==n)return Sp(n,t)?void 0:(t=n,[n]);t=void 0}},"message.rateLimit":function(e,t){var n=0,r=void 0;return function(e){var a=Object(v.a)(e,1)[0],i=(new Date).getTime(),o=i-i%1e3;if(o!==r&&(n=0,r=o),n<t())return n++,[a]}},messageFilterLazy:function(e,t){return function(e){if(t())return e}},jpolygons:function(e){return e.width=280,e.height=280,function(e){var t=Object(v.a)(e,1)[0];if(t.some(function(e){return e.needsUpdate})){t.forEach(function(e){return e.needsUpdate=!1}),t=t.filter(function(e){return e.inUse||e.lastUsed<1});for(var n=[],r=void 0,a=0;a<t.length;a++)for(var i=t[a].cycle,o=r||Math.max(10,133-24*a),s=i,c=s.length,u=0;u<s.length;u++){var l=s[u];Array.isArray(l)&&(l=l[0]);var f=Ym(140,u,c,i,o,{x:140,y:140},l),h=Object(v.a)(f,2),d=h[0],p=h[1];if(p&&n.push(p),d&&(r=d),l.type&&"-"===l.type.type&&0===l.type.value){var m=$m(140,l,u,o,i,c);m&&n.push(m)}}return[n]}}},jhits:function(e,t,n){var r=[];return function(e){var a=e[0]&&e[0][1];if(a){var i=t();if(i){var o=n()?0:140,s=ey(i,n()?n():133,o);a.length>0&&a.map(function(e){return 6-e.outputNumber});var c,u=i.length?i.length:5,l=new Array(2*u).fill(100),f=new Array(u).fill(0),h=new Array(u).fill(0),d=[],p=Km(r);try{for(p.s();!(c=p.n()).done;){var v=c.value,m=v.x,y=v.y,b=v.duration,g=v.tidalNumber;b-=.5,f[g]=b,v.duration=b,b>0&&(l[2*g]=m,l[2*g+1]=y,d.push(v))}}catch(E){p.e(E)}finally{p.f()}r=d;var O,j=Km(a);try{for(j.s();!(O=j.n()).done;){var k=O.value;if(-1!==k.outputNumber){var w=(k.outputNumber-1)%i.length,x=Xm(k.stepData.leafNumber,{x:o,y:o},s[w],i[w].cycle,!0),S=x.x,P=x.y;l[2*w]=S,l[2*w+1]=P,f[w]=4*k.stepData.duration,h[w]=k.stepData.duration*Zm.toSeconds()*1e3,r.push({x:S,y:P,duration:4*k.stepData.duration,tidalNumber:w})}}}catch(E){j.e(E)}finally{j.f()}return[l,f,h]}}}},jclock:function(e){var t=new ml.w({color:16777215}),n=[];return function(e){var r=Object(v.a)(e,1)[0];if(r){for(var a=ey(r),i=0;i<r.length;i++)for(var o=r[i],s=o.cycle.flat(16),c=0;c<s.length;c++){var u=s[c];if(o.currentCycles&&o.currentCycles[u.id]){var l=Xm(c,{x:140,y:140},a[i],s).deg,f=new ml.p(140,140,a[i],a[i],1.5*Math.PI,l,!1,0).getSpacedPoints(c);if(n[i])n[i].geometry.setFromPoints(f),n[i].geometry.attributes.position.needsUpdate=!0;else{var h=(new ml.h).setFromPoints(f),d=new ml.v(h,t);n[i]=d}break}}return[n]}}},ztracker:function(e){return e.effect=new jp(e),function(){}},coords:function(e,t){return function(e){return{x:e[0],y:t()}}},rasterTriangle:function(e,t,n,r){return function(e){var a=e[0];if(a&&t()&&n()&&r())return[Object(Qv.b)([a,t(),n()],Math.max(5,r()))]}},tidal:function(e){e.needsTick=!0;var t=new kp.a(e.subSequence,void 0,e);t.subSequence=e.subSequence,e.effect=t;var n=new K.a;return n.loadDefaults(),n.velocity=.5,n.duration=1e6,function(r){var a=Object(Yi.a)(r),i=a[0],o=a.slice(1);switch(i){case"restart":break;case S.n:var s=Object(v.a)(o,2),c=s[0],u=s[1];if(t.onNewStep(c,u),0===c){var l=new $e.a(n,u,c);t.input(l)}var f=t.output(u,c,c);f.forEach(function(e){e.stepData.time=e.time,e.stepData.stepNumber=e.stepNumber,e.outputNumber=1}),f.forEach(function(t){var n=t.stepData;e.sendMessage(e.outputByNumber(0),n)})}}},outputNumber:function(e,t){return function(e){var n=Object(v.a)(e,1)[0];if(n[0]===S.p){var r=n[1];return r=r.map(function(e){return Object(d.a)({},e,{outputNumber:t()||1})}),[[S.p,r]]}}},rasterTriangles:function(e,t){return function(e){var n=t()||4,r=e[0];if(r&&n){var a=function(){for(var e=[],t=0;t<r.length;t+=6){var a=r.slice(t,t+6);Object(Qv.b)(a,Math.max(1,n)).forEach(function(t){return e.push(t)})}return{v:[e]}}();if("object"===typeof a)return a.v}}},metro:function(e,t){return e.needsTick=!0,function(e){return S.a}},syncedMetro:function(e,t){return e.needsTick=!0,function(t){var n=Object(v.a)(t,3),r=n[0],a=(n[1],n[2]);"tick"===r&&$v(function(){e.sendMessage(e.outputByNumber(0),S.a)},1e3*(a-re.a.Master.context.currentTime))}},setInterval:function(e,t){var n=window.setInterval(function(){e&&e.function&&e.bang()},80);return function(e){if("dispose"!==e[0])return S.a;clearInterval(n)}},setTimeout:$v,setIntervalFast:function(e,t){var n,r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;n=window.setInterval(function(){e&&e.function&&e.bang()},t)};return r(),function(e){if("dispose"!==e[0])return Object(ke.a)([e])&&(clearInterval(n),r(e)),S.a;clearInterval(n)}},lconcat:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=[];return function(e){if("bang"===e[0])return a;var t=n.map(function(e){return e()}).filter(function(e){return void 0!==e}).flatMap(function(e){return e}),r=e[0]||[];return Array.isArray(r)||(r=[r]),a=[[].concat(Object(h.a)(r),Object(h.a)(t))]}},jsnapshot:function(e){new Mp(e);return function(){}},counter:function(e,t,n){var r=0,a=1;return e.needsStart=!0,e.setAttribute("Send min on load",!0,function(e){}),function(e){var i=Object(v.a)(e,2),o=i[0],s=i[1];switch(o){case S.k:return void(r=t());case"Direction":return void(a=s);case"Reset":return[r=t()]}return(r+=a)>=n()?[r=t()+r-n(),"bang"]:r}},simpleCounter:function(e,t,n,r){var a=void 0;return function(e){void 0===a&&(a=t()||0);var i=Object(v.a)(e,2),o=i[0],s=i[1];console.log("type=%s value=",o,s);var c="bang"===s?1:s;switch(o){case"decrement":return(a-=c)<n()&&(a=n()),[a];case"increment":return(a+=c)>r()&&(a=r()),[a];case"value":return[a=s]}return a}}},Zp,{canvas:function(e){var t=new qv(e);return e.effect=t,e.width=300,e.height=300,function(){}}},Uv,Pv,vv,Gv,hv,$p,kv,Ov,{script:function(e){var t=new Qp(e);return t.width=350,t.height=350,e.effect=t,e.needsLoad=!0,function(){t.code=t.code}},float32Array:function(e){return function(e){var t=Object(v.a)(e,1)[0];return[Float32Array.from(t)]}},map:function(e,t){var n;return function(t){var r=Object(v.a)(t,2),a=(r[0],r[1]);if(a&&(Array.isArray(a)||ArrayBuffer.isView(a))){var i=e.inlets.fn;if(i){var o=i.connections[0].sourceNode;if(ArrayBuffer.isView(a)){n||(n=new Float32Array(a.length));for(var s=0;s<a.length;s++){var c=a[s],u=o.evaluateAsFunction?o.evaluateAsFunction(c,s):o.function([c]);n[s]=u}}else n=a.map(function(e,t){return o.evaluateAsFunction?o.evaluateAsFunction(e,t):o.function([e])});return[n]}}}},spline:function(e,t,n){var r,a=void 0,i=[];return function(e){var o=Object(v.a)(e,1)[0];if(ArrayBuffer.isView(o)||Array.isArray(o)){i.length=0;for(var s=0;s<o.length;s+=2)i.push(new ml.cb(o[s],o[s+1],0));a?(a.tension=t()||1,a.points=i):a=new ml.i(i,!0,"catmullrom",t()||1);var c=a.getPoints(n()||150),u=0;r&&2*c.length===r.length||(r=new Float32Array(2*c.length));var l,f=dv(c);try{for(f.s();!(l=f.n()).done;){var h=l.value;r[u++]=h.x,r[u++]=h.y}}catch(d){f.e(d)}finally{f.f()}return r}return[r]}},convexHull:function(){return function(e){var t=Object(v.a)(e,1)[0];return[Object(Xp.a)(t)]}},smokeVertices:function(e,t,n){var r;return function(e){var n=Object(v.a)(e,1)[0],a=t()||300,i=t()||300;return r||(r=new Float32Array(new Array(n.length).fill(0).flatMap(function(e,t){var n=t%66;return[a*(n/64),i*((t-n)/66/64),0]})))}},flattenList:function(e){return function(e){var t=Object(v.a)(e,1)[0];if(Array.isArray(t))return[t.flat(16)]}},cList:function(e,t){return function(e){for(var n=Object(v.a)(e,1)[0],r=[],a=0;a<n.length;a+=t())r.push(a/t());return[Float32Array.from(r)]}},listMax:function(e){return function(e){var t=Object(v.a)(e,1)[0];return[Math.max.apply(Math,Object(h.a)(t))]}},pack:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t=n.map(function(e){return e()}).filter(function(e){return void 0!==e});return t=t.slice(0,t.length-1),[[].concat(Object(h.a)(e),Object(h.a)(t))]}},packFull:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(t){if("clear"!==t[0]){var r=n.map(function(e){return e()}).filter(function(e){return void 0!==e}),a=[].concat(Object(h.a)(t),Object(h.a)(r.slice(0,r.length-1)));if(!a.some(function(e){return!e}))return[a]}else{for(var i=0;i<e.args.length;i++)e.args[i]=0;e.lastMessageReceived=0}}},pak:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t=n.map(function(e){return e()}).filter(function(e){return void 0!==e});return t=t.slice(0,t.length-1),[[].concat(Object(h.a)(e),Object(h.a)(t))]}},nft:function(e){var t=new em(e);return e.effect=t,e.needsNFT=!0,function(e){switch(Object(v.a)(e,1)[0]){case S.e:t.startUp();break;default:t.execute()}}},append:function(e,t){var n=[];return function(e){if("bang"===e[0])return[n];if("clear"!==e[0]){if(n.push(e[0]),!t())return[n];for(;n.length>t();)n.shift();return[n]}n=[]}},appendList:function(e,t){var n=[];return function(e){Array.isArray(e[0])||(e[0]=[e[0]]);var r,a=Zu(e[0]);try{for(a.s();!(r=a.n()).done;){var i=r.value;n.push(i)}}catch(o){a.e(o)}finally{a.f()}for(;n.length>t();)n.shift();return[n]}},pad:function(e){var t=new uy(e);return t.zObject=e,e.effect=t,e.width=201,e.height=227,e.needsStart=!0,e.needsLoad=!0,function(t){Object(v.a)(t,1)[0],e.effect.pad&&(e.effect.pad.onSizeChange(e.width,e.height),e.effect.pad.sendTags())}},unpack:function(e){return function(e){return ArrayBuffer.isView(e[0])?Array.from(e[0]):e[0]}},subpatch:function(e,t){var n=new pf(e.subSequence,e.sequencerEngine,e,t);return e.effect=n,e.isSubPatch=!0,function(){}},instancedSubpatch:function(e){var t=new py(e.subSequence,e.sequencerEngine,e);return e.effect=t,e.isSubPatch=!0,function(){}},split:function(e,t,n){return function(e){return e=e[0],t()<=e&&e<=n()?[e]:[void 0,e]}},jgrid:function(e){var t=new Vm(e.subSequence,e);return e.width=270,e.height=186,e.effect=t,e.needsLoad=!0,e.needsStart=!0,e.newAttribute("overflow","hidden"),function(e){var n=Object(Yi.a)(e),r=n[0];switch(n.slice(1),r){case S.k:t.calculateRules()}}},jtypes:function(e){new Um(e);return e.width=220,e.height=134,function(){}},track:function(e,t){var n=t()-1,r=e.subSequence;r.getRootSubSequence&&(r=r.getRootSubSequence());var a=r.tracks[n%r.tracks.length];return a?(e.id=a.id,e.width=80,e.height=80,a&&(e.effect=a,a.zObject=e),e.needsStart=!0,e.newAttribute("show-sequencer",!1),e.newAttribute("send-levels",!1,function(e){return a.sendLevels(e)}),e.newAttribute("level-smoothness",.9,function(e){return a.trackMeter.smoothness=e}),e.newAttribute("volume pattern-locked",!0),function(n){var a=t()-1,i=r.tracks[a];i&&(e.effect=i,i.zObject=e)}):function(){}},comment:function(e){var t=new fy(e);e.sequencerEngine.state.sequencer.backgroundColor;return e.attributes["font-size"]="10",e.attributes["primary-color"]="#c7fc19",e.attributes["secondary-color"]="#000000",e.width=100,e.height=25,e.effect=t,function(){}},delaunay:function(e){var t;return function(e){var n=Object(v.a)(e,1)[0];if(n&&Array.isArray(n)&&!n.some(function(e){return!Object(ke.a)(e)})){t?t=new ev.a(n):(n.forEach(function(e,n){return t.coords[n]=e}),t.update());for(var r=[],a=0;a<t.triangles.length;a+=3){var i=[t.triangles[a],t.triangles[a+1],t.triangles[a+2]];r.push(n[2*i[0]]),r.push(n[2*i[0]+1]),r.push(n[2*i[1]]),r.push(n[2*i[1]+1]),r.push(n[2*i[2]]),r.push(n[2*i[2]+1])}return[r]}}},delaunayIndex:Wv,dHull:function(e,t){var n,r,a,i=[];return function(e){var o=Object(v.a)(e,1)[0];if(o){n&&n.coords.length===o.length?(n.coords.set(o,0),n.update()):n=new ev.a(o);var s=n.hull,c=o.length/2-s.length;a&&a.length===2*c||(a=new Float32Array(2*c)),ov(o,s,a),r&&r.coords.length===a.length?(r.coords.set(0,a),r.update()):r=new ev.a(a);var u=r.hull;cv(o,a,s,u);var l,f=Math.min(t()||0,u.length),h=f+s.length,d=new Float32Array(2*h),p=0,m=tv(s);try{for(m.s();!(l=m.n()).done;){var y=l.value;d[p++]=o[2*y],d[p++]=o[2*y+1]}}catch(B){m.e(B)}finally{m.f()}var b=rv()([o]),g=Object(v.a)(b,1),O=Object(v.a)(g[0],2),j=O[0],k=O[1],w=0;i.length=0;var x,S=tv(s);try{for(S.s();!(x=S.n()).done;){var P=x.value,E=o[2*P],T=o[2*P+1],A=Object(qn.a)(Math.atan2(T-k,E-j),2*Math.PI);i.push(A)}}catch(B){S.e(B)}finally{S.f()}p=0;var M,R=tv(u);try{for(R.s();!(M=R.n()).done;){var C=M.value;if(++p>f)break;var N=[a[2*C],a[2*C+1]],I=N[0],q=N[1],_=Object(qn.a)(Math.atan2(q-k,I-j),2*Math.PI),D=iv(i,_,d,I,q);void 0!==D||(Math.PI,void 0!==(D=iv(i,_,d,I,q)))?(i.splice(D,0,_),sv(d,2*D,0,I,q)):w++}}catch(B){R.e(B)}finally{R.f()}if(w>0){for(var F=new Float32Array(d.length-2*w),L=0;L<d.length/2-w;L++)F[2*L]=d[2*L],F[2*L+1]=d[2*L+1];return F}return[d]}}},zl:function(e,t){var n=[];return function(e){e=e[0];var r=t();"string"===typeof e&&(r=e),n=e[0];var a=Object(h.a)(n);switch(r){case"rev":return[a.reverse()]}}},get:function(e,t){return function(e){if(null!==e[0][t()]&&void 0!==e[0][t()])return[e[0][t()]]}},set:function(e,t,n){return function(e){return e[0][t()]=n(),[n()]}},"object.keys":function(e){return function(e){var t=Object(v.a)(e,1)[0];return[Object.keys(t)]}},"object.builder":function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){for(var t=n.map(function(e){return e()}).filter(function(e){return void 0!==e}),r={},a=0;a<t.length-1;a+=2){var i=t[a],o=t[a+1];r[i]=o}return[r]}}},Yv,Cy,Ay,{list:function(){return function(e){return[[Object(v.a)(e,1)[0]]]}},sublist:function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0];if(ArrayBuffer.isView(r)||Array.isArray(r))return[r.slice(t(),n())]}}},Ry,eu,{sparseMerge:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t,r=Object(v.a)(e,1)[0],a=n.map(function(e){return e()}).filter(function(e){return void 0!==e}),i=[],o=Zu([r||[]].concat(Object(h.a)(a)));try{for(o.s();!(t=o.n()).done;)for(var s=t.value,c=0;c<s.length;c++)s[c]&&(i[c]=s[c])}catch(u){o.e(u)}finally{o.f()}return[i]}}},by,qu,Qs,{boundFilter:function(e,t,n){return function(e){var r=Object(v.a)(e,1)[0];if(Math.abs(r[0])<t()&&Math.abs(r[1])<n())return[r]}}},Uo,Vo,mc,nm,Do,Lo,{"tr.loop":function(e,t,n,r){return function(a){var i=Object(v.a)(a,1)[0],o=e.sequencerEngine.tracks[Math.round(t()||0)];o&&(o.loopStart=n()||0,o.loopLength=r()||8,o.isLooping=!!i)}},"tr.loopUI":function(e){new qo(e);return function(e){Object(v.a)(e,1)[0]}},"abi.encode":function(e){return function(e){var t,n=Object(v.a)(e,1)[0];return[(t=new No.a(new No.a.providers.HttpProvider("https://mainnet.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")).eth.abi).encodeParameter.apply(t,Object(h.a)(n))]}}},Eo,{"export.samples":function(e){return function(t){var n=Object(v.a)(t,1)[0];return e.samples=n,"bang"}}},xo,wo,{"h=0.sequencer":function(e){new yo(e);return function(e){Object(v.a)(e,1)[0]}}},vo,ko,Vi,{"zpore.audition":function(e){new zi(e);return function(){}},metroTimer:function(e,t){return e.needsTick=!0,function(t){var n=Object(v.a)(t,3),r=n[0],a=n[1],i=n[2];if("tick"===r)return[[a,i,e.sequencerEngine.bpm,e.sequencerEngine.globalDetune||0]]}},"message.receivedQuickly":function(e,t){var n=void 0;return function(e){var r=Object(v.a)(e,1)[0],a=(new Date).getTime();if(a-n<t())return[r];n=a}}},Ji,bi),Uy=function(e,t,n){var r=e.inletTypes&&e.inletTypes[n+1];if(t&&t.type===Ou.a&&!Ky(r)){var a=t.func.returnType;return e.closureReturnType=a,Gy(t)}return t},Gy=function(e){var t=e.func,n=Object.values(t.args),r=Fd.a.apply(void 0,[{id:"cls"}].concat(Object(h.a)(n.map(function(e){return function(){return e}}))))([0]);return Fd.b.apply(void 0,[{}].concat(Object(h.a)(r.map(function(e){return function(){return e}}))))([e])},Wy=function(e){return mf("gl.genFunction")(e,"za",e.type,void 0,1)},Ky=function(e){if(!e)return!1;if(Array.isArray(e)){var t=e[0];return t.or?t.or.includes(Ou.a):t===Ou.a}var n=e;return n.or?n.or.includes(Ou.a):n===Ou.a},Qy=n(445);function Zy(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Yy(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Yy(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Yy(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function $y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Xy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function eb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function tb(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return nb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nb(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function nb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ab=rr.a.presets,ib=function(e){Object(u.a)(n,e);var t=rb(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this)).arr=[],r.preset=new dt.a,r.id=Object(q.uuid)(),r.subSequence=e,r.sequencerEngine=e.sequencerEngine,r.sequencerEngine.idToObject[r.id]=Object(c.a)(r),r.counter=0,r.text="",r.name="",r.args=[],r.function=void 0,r.mutations=new Array(16).fill(!1),r.window={id:Object(q.uuid)()},r.newInlet("Input",function(e){r.onInputMessage(e)}),r.newAttribute("primary-color"),r.newAttribute("secondary-color"),r.newAttribute("border-radius"),r.newAttribute("Include in Presentation",!1),r.newAttribute("scripting name"),r.newAttribute("hot inlets",!1),r.newAttribute("font-size",10),r}return Object(s.a)(n,[{key:"getObjectType",value:function(){return Va.e}},{key:"getInstrumentType",value:function(){return"zobject."+this.name}},{key:"getAllParameters",value:function(){return this.effect?this.effect.getParameters():[]}},{key:"effect",get:function(){return this._effect},set:function(e){this._effect=e;var t,n={},r=tb(e.getParameters());try{for(r.s();!(t=r.n()).done;){var a=t.value;n=Object(d.a)({},n,a.setStore(this.sequencerEngine.store))}}catch(i){r.e(i)}finally{r.f()}this.sequencerEngine.store.dispatch(Object(J.xb)(n))}},{key:"bang",value:function(){this.onInputMessage([S.a])}},{key:"getJson",value:function(e,t){var n={id:this.id,text:this.text,width:this.width,height:this.height};e&&t&&(n=Object(d.a)({},n,this.getDependencyJSON()));var r=this.getAttributesJson();if(r&&(n.attributes=r),this.plugin&&(n.plugin=this.plugin),this.effect&&(n.effect=this.effect&&this.effect.getJson(e)),this.height&&(n.height=this.height),this.width&&(n.width=this.width),this.mutations.some(function(e){return e})){var a=Object(h.a)(this.mutations);a.reverse();var i=a.indexOf(!0);n.mutations=this.mutations.slice(0,a.length-i)}return n}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o={};if(t||(this.id=e.id,this.sequencerEngine.idToObject[this.id]=this),o[e.id]=this.id,n||e.text!==this.text&&(this.text=e.text),e.mutations){this.dependencies=e.mutations;for(var s=this.dependencies.length;s<16;s++)this.dependencies.push(!1)}return this.loadAttributesFromJson(e),this.effect&&e.effect&&(o=Object(d.a)({},o,this.effect.fromJson(e.effect,t,n,r,a)),!t||this.effect.zObjects||i||(this.effect.id=Object(q.uuid)(),o[e.effect.id]=this.effect.id),this.sequencerEngine.idToObject[this.effect.id]=this.effect),e.width&&e.height&&(this.width=e.width,this.height=e.height),e.plugin&&(this.plugin=e.plugin),r&&e.outbound&&this.fromDependencyJSON(e,a,i),o}},{key:"isHot",get:function(){return this.attributes["hot inlets"]},set:function(e){this.setAttribute("hot inlets",e)}},{key:"onNewFunction",value:function(e,t){var n=this;this.name=e,this.registerTypes(e);var r=Object(pi.a)(e),a=r.outlets,i=r.isHot,o=r.inlets;this.isHot=i,this.defaultAttributes["hot inlets"]=!0;var s=1,c=!1;a&&(Array.isArray(a)?(s=a.length,c=!0):s=a(t.length));var u=Object.keys(this.outlets).length;if(u>s){for(var l=u-1;l>s-1;l--)this.deleteOutlet(this.outputByNumber(l,!0),!1);this.updateMessagingRedux()}else if(u<s)for(var f=u;f<s;f++)this.newOutlet(c?a[f]:this.outputByNumber(f,!0));if(void 0!==o)if(Array.isArray(o)){for(var d in this.inlets)o.includes(d)||this.deleteInlet(d);var p,v=tb(o);try{var m=function(){var e=p.value;if(n.inlets[e])return"continue";n.newInlet(e,function(t){n.onInputMessage([e].concat(Object(h.a)(t)))})};for(v.s();!(p=v.n()).done;)m()}catch(y){v.e(y)}finally{v.f()}}else if("function"===typeof o)o=Math.max(0,o(t.length)),this.onNewArgs(new Array(Math.max(0,o-1)).fill(0));else if(this.onNewArgs(new Array(Math.max(0,o-1)).fill(0)),0===o)return!0}},{key:"onNewArgs",value:function(e){var t=this,n=Object.keys(this.inlets);if(this.previousArgs=Object(h.a)(this.args),this.args=e,this.mutations=new Array(16).fill(!1),n.length<=e.length)for(var r=function(e){t.newInlet(e,function(n){return t.onArg(e,n)})},a=n.length;a<=e.length;a++)r(a);else if(n.length>e.length)for(var i=n.length;i>e.length;i--)this.deleteInlet(i)}},{key:"onArg",value:function(e,t){this.previousArgs=Object(h.a)(this.args),this.args[e-1]=t[0],this.mutations[e-1]=!0,this.isHot&&void 0!==this.lastMessageReceived&&this.onInputMessage(this.lastMessageReceived)}},{key:"refresh",value:function(){if(!this.sequencerEngine.isLoading){var e=S.a;this.lastMessageReceived&&(e=Array.isArray(this.lastMessageReceived)?[this.lastMessageReceived[0],!0]:this.lastMessageReceived),this.onInputMessage(e),this.effect&&this.effect.refresh&&this.effect.refresh()}}},{key:"needsTick",get:function(){return this._needsTick},set:function(e){this._needsTick=e,this.sequencerEngine.tickingObjects.push(this)}},{key:"onInputMessage",value:function(e){if(e=function(e,t){if(Array.isArray(t)&&t[0]){if(t[0].closure&&Ky(e.inletTypes))return Wy(t[0]);if(t[0].func&&!Ky(e.inletTypes)){var n=t[0],r=n.func.returnType;return e.closureReturnType=r,Gy(n)}}return t}(this,e),!this._disposed&&this.function)if(e&&"clearAllMessages"===e[0]){this.lastMessageReceived=0;for(var t=0;t<this.args.length;t++)this.args[t]=void 0}else{if(this.dependencies&&this.isHot&&!this.needsLoad)for(var n=0;n<this.dependencies.length;n++)if(this.dependencies[n]&&!this.mutations[n]&&(this.wasSuppressed=!0,this.lastMessageReceived=e,"three.mesh"!==this.name))return;Array.isArray(e)||(this.arr[0]=e,e=this.arr),this.lastMessageReceived=e;var r=this.function(e);if(void 0!==r){if(this.storeOutputType(r),this.lastOutput=r,!Array.isArray(r))return this.closureReturnType&&"object"===typeof r&&(r.type=this.closureReturnType),void this.sendMessage(this.outputByNumber(0),r);for(var a=0;a<r.length;a++){var i=r[a];if(void 0!==i){this.outputByNumber(a);this.closureReturnType&&(i.type=this.closureReturnType),this.sendMessage(this.outputByNumber(a),i)}}}}}},{key:"outputByNumber",value:function(e,t){var n="Output "+(e+1);return this.outlets[n]||t?n:Object.keys(this.outlets)[e]}},{key:"sendMessageToInlet",value:function(e){this.onInputMessage(e)}},{key:"loadPresetJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=this.id;this.sequencerEngine.bulkConnections={},"subpatch"===this.name&&this.sequencerEngine.dispatch(Object(J.fc)(this.sequencerEngine.sequenceId,!0));var o=this.fromJson(e,!0,t,n,r,a);if(this.id=i,!e.windowPositions||!e.inletConnections)return this.loadBulkConnections(),void("subpatch"===this.name&&this.sequencerEngine.dispatch(Object(J.fc)(this.sequencerEngine.sequenceId,!1)));this.dispatch(Object(J.O)(Ul(o,e.windowPositions))),e.presentationPositions&&this.dispatch(Object(J.N)(Ul(o,e.presentationPositions))),this.sequencerEngine.checkSubPatchInstances(o);var s=Gl(o,e.inletConnections);this.sequencerEngine.loadInletConnectionsForId(s),this.sequencerEngine.checkInstanceConnections(),this.effect&&this.effect.zObjects&&this.effect.loadBangZObjects(),this.sequencerEngine.dispatch(Object(J.fc)(this.sequencerEngine.sequenceId,!1)),this.loadBulkConnections(),this.sequencerEngine.compile(),this.sequencerEngine.groups.sendVolumes()}},{key:"loadBulkConnections",value:function(){for(var e in this.sequencerEngine.bulkConnections){var t=this.state.windows.inletConnections[e]||{};this.dispatch(Object(J.Mb)(e,Object(d.a)({},t,this.sequencerEngine.bulkConnections[e])))}}},{key:"position",get:function(){return this.state.windows.windowPositions[this.id]}},{key:"delete",value:function(){var e=this;this.isDeletable()&&(this.subSequence.deleteNode(this),this.effect&&this.effect.dispose&&this.effect.dispose(),this.state.plugins.pluginsLoaded&&this.state.plugins.pluginsLoaded.includes(this)&&this.dispatch(Object(J.Xc)(this.state.plugins.pluginsLoaded.filter(function(t){return t!==e}))))}},{key:"duplicate",value:function(){var e=this.getPresetJson(),t=this.state.windows.windowPositions[this.id],n=t.x,r=t.y,a=this.width||200,i=(this.width,this.subSequence.createZObject(n+a,r));i.loadPresetJson(e);var o=this.state.windows.presentationWindowPositions[this.id];o&&this.dispatch(Object(J.Zc)(i.id,{x:o.x+a,y:o.y}))}},{key:"loadPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.preset=new dt.a(t.title,t.contentHash,t.user,t.blockNumber),e.next=3,ab.getPresetData(t);case 3:r=e.sent,this.loadPresetJson(r,void 0,!0,void 0,n);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPresetJson",value:function(){var e=this,t=this.getJson(!0,!0);if(!(this.effect&&this.effect.zObjects))return t;var n={},r=this.getAllInnerObjects();r.forEach(function(t){var r=t.id;return n[r]=e.state.windows.windowPositions[r]});var a={};r.forEach(function(t){var n=t.id;return a[n]=e.state.windows.presentationWindowPositions[n]});var i,o=this.state.windows.inletConnections[this.effect.id],s=tb(r);try{for(s.s();!(i=s.n()).done;){var c=i.value;c.effect&&c.effect.zObjects&&(o=Object(d.a)({},o,this.state.windows.inletConnections[c.effect.id]))}}catch(u){s.e(u)}finally{s.f()}return Object(d.a)({},t,{inletConnections:o,windowPositions:n,presentationPositions:a})}},{key:"getAllInnerObjects",value:function(){if(this.effect&&this.effect.zObjects){var e=this.effect;return[].concat(Object(h.a)(e.zObjects),Object(h.a)(e.zMessages),Object(h.a)(e.zObjects.flatMap(function(e){return e.getAllInnerObjects()})))}return[]}},{key:"disposeMessaging",value:function(){this._disposed=!0,this.function,Object(fe.a)(Object(f.a)(n.prototype),"disposeMessaging",this).call(this)}},{key:"isDeletable",value:function(){return!this.effect||!this.effect.isDeletable||this.effect.isDeletable()}},{key:"flash",value:function(){if(!window.stopGLCompile){var e=this.state.zobject.viewableSubPatches;if(this.subSequence.getRootSubSequence){if(!e||e[e.length-1]!==this.subSequence)return}else;this.subSequence.hasInstances||this.sequencerEngine.isLoading||this.dispatch(Object(J.ef)(this.id,(new Date).getTime()))}}},{key:"hotReload",value:function(){Object(Qy.a)(this)}},{key:"hide",value:function(){this.dispatch(Object(J.Oe)(this.id,!0))}},{key:"isHidden",get:function(){return this.state.spatial.hiddenObjects[this.id]}},{key:"isLocked",get:function(){return this.state.spatial.lockedObjects[this.id]}}]),n}(Object(ot.a)(function(e){return function(e){Object(u.a)(n,e);var t=Xy(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"currentPattern",get:function(){return this.state.sequencer.currentPattern[this.subSequence.id]}},{key:"patternLocks",get:function(){return this.state&&this.state.effects.effectPatternLocks[this.id]||{}}},{key:"locked",get:function(){return this.patternLocks[this.currentPattern]}},{key:"lock",set:function(e){this.lockPattern(this.currentPattern,e)}},{key:"lockPattern",value:function(e,t){var n=Object(d.a)({},this.patternLocks);n[e]=t,this.dispatch(Object(J.yb)(this.id,n))}}]),n}(e)},ld.a,function(e){return function(e){Object(u.a)(n,e);var t=di(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).subscribedFunctions=[],e}return Object(s.a)(n,[{key:"subscribeArgs",value:function(e){for(var t=this,n=function(n){var r=e[n];if(t.subscribedFunctions[n]){var a=Object(v.a)(t.subscribedFunctions[n],2),i=a[0],o=a[1];Object(hi.g)(i,o)}if("string"===typeof r&&r.startsWith(":")){t.subscribedFunctions[n]=[r.slice(1),function(e){t.onArg(n+1,[e])}],Object(hi.e)(r.slice(1),t.subscribedFunctions[n][1]);var s=Object(hi.d)(r.slice(1));s&&s[0]&&t.subscribedFunctions[n][1](s[0])}},r=0;r<e.length;r++)n(r)}}]),n}(e)},du.a,function(e){return function(e){Object(u.a)(n,e);var t=eb(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).actions={},e}return Object(s.a)(n,[{key:"newAction",value:function(e,t){this.actions[e]=t}},{key:"executeAction",value:function(e){this.actions[e]()}}]),n}(e)},hu.a,Qa,fi.a,function(e){return function(e){Object(u.a)(n,e);var t=$y(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).cachedArgs={},e.cachedResolvedArgs={},e}return Object(s.a)(n,[{key:"text",get:function(){return this._text},set:function(e){var t=this;this._text=e;var n=e.split(" ").filter(function(e){return" "!==e&&""!==e}),r=n[0];if(Hy[r]){var a=this.args,i=this.name!==r,o=(this.name,Hy[r]),s=this.parseArgs(n.splice(1)),c=this.onNewFunction(r,s);a===this.args&&(this.previousArgs=Object(h.a)(this.args)),this.subscribeArgs(s),this.args=Object(h.a)(s);var u=new Array(Math.max(16,s.length)).fill(void 0).map(function(e,n){return function(){return Uy(t,t.args[n],n)}});i?(this.dependencies=void 0,this.function=o.apply(void 0,[this].concat(Object(h.a)(u))),this.registerName(this.name,r),"preset"===r&&Object(hi.c)("preset.new")):this.previousArgs=this.args,c&&this.deleteInlet("Input"),this.needsLoad&&!this.sequencerEngine.isLoading&&this.onInputMessage(["start"]),this.needsHotReload&&!this.sequencerEngine.isLoading&&Object(Qy.b)(this),this.subSequence.propagate(Object(lu.v)(this,e))}else this.function=void 0}},{key:"resolveArg",value:function(e,t){return Uy(this,e,t)}},{key:"isValid",value:function(){return void 0!==this.function}},{key:"parseArgs",value:function(e){var t,n=[],r=Zy(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;a&&a.startsWith&&a.startsWith("0x")?n.push(a):Object(ke.a)(a)?n.push(parseFloat(a)):n.push(a)}}catch(i){r.e(i)}finally{r.f()}return n}},{key:"registerName",value:function(e,t){var n=this,r=this.sequencerEngine.nameToObjects;r[t]||(r[t]=[]),r[t].push(this),r[e]&&(r[e]=r[e].filter(function(e){return e!==n}))}}]),n}(e)},cf)(function(){return function e(){Object(o.a)(this,e)}}()));function ob(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var sb=n(954),cb=n(383);function ub(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function lb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function fb(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return hb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hb(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function hb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function db(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var pb=-40,vb=9,mb=new oi.a;function yb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=(e=Math.min(Math.max(0,e),r))/r;return t+(n-t)*Math.pow(a,1/window.ROOTY)}window.ROOTY=3;var bb=function(e){Object(u.a)(n,e);var t=db(n);function n(e){var r,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(o.a)(this,n),(r=t.call(this)).subSequence=e,r.sequencerEngine=e.sequencerEngine,r.id=Object(q.uuid)(),r.sequencerEngine.idToObject[r.id]=Object(c.a)(r),r.tracks=new Array(vb).fill(!1),a&&r.createEffectRack(),r.newInlet(S.q,function(e){return r.onTrigger(e)}),r.newInlet("slider values",function(e){return r.onSliderValues(e)}),r.newInlet("set enabled",function(e){var t=Object(v.a)(e,1)[0];return r.setTracksEnabled(t)}),r.newInlet("unmuted",function(e){var t=Object(v.a)(e,1)[0];return r.setTracksUnmuted(t)}),r.newInlet("restart",function(e){var t=Object(v.a)(e,1)[0];return r.restartTracks(t)}),r.newOutlet("pads playing"),r.newOutlet("notes playing"),r.newOutlet("slider levels"),r.newOutlet("effect added"),r.newOutlet("stereo oscilloscope"),r.setupAuditioning(),r.isPad=!0,r}return Object(s.a)(n,[{key:"restartTracks",value:function(e){this.tracks.filter(function(e){return e}).forEach(function(t){return t.onRestart(e)})}},{key:"onLiveTrigger",value:function(e){var t=this.tracks[e];t&&t.midiEffects.liveInputTrigger(new K.a(t),t)}},{key:"onLiveRelease",value:function(e){var t=this.tracks[e];t&&t.midiEffects.liveInputRelease(0,0,t)}},{key:"onChangePadsCount",value:function(e){if(!isNaN(e))if(e>this.tracks.length){var t=new Array(e-this.tracks.length).fill(!1);this.tracks=[].concat(Object(h.a)(this.tracks),Object(h.a)(t))}else{for(var n=e;n<this.tracks.length;n++)this.tracks[n]&&this.removeTrack(this.tracks[n]);this.tracks=this.tracks.slice(0,e)}}},{key:"padFXMode",get:function(){return this.state.pads.padFXMode[this.id]||li.a},set:function(e){var t,n=fb(this.tracks);try{for(n.s();!(t=n.n()).done;){var r=t.value;r&&r.outputTypeParameter.set(e)}}catch(a){n.e(a)}finally{n.f()}this.dispatch(Object(J.xc)(this.id,e))}},{key:"getObjectType",value:function(){return Va.b}},{key:"onSlots",value:function(e){e=e[0],this.slotsMapping=e}},{key:"onTrigger",value:function(e){if((e=e[0])&&e[1]){var t,n={},r=fb(e[1]);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=a.outputNumber-1;this.slotsMapping&&void 0!==this.slotsMapping[i]&&(i=this.slotsMapping[i]);var o=this.slots[i];if(o){var s=a=Object(d.a)({},a),c=s.stepData,u=s.time,l=s.stepNumber;n[o.id],n[o.id]=!0,a.outputNumber=0;var f=o.trackData.transpose,h=o.trackData.release,p=o.trackData.attack,v=(c.leaf,c);v.accent,v.piano,v.pianissimo,v.staccato,v.legato;(c=o.midiEffects.getStep(c)).duration*=o.trackData.duration,c.release=h,c.attack=p,a.keepTranspose?c.transpose+=f:c.transpose=f,c.track=o,o.disabled||(o.midiEffects.input(c,u,l),o.midiEffects.receivedTriggers=o.midiEffects.inputedTriggers)}}}catch(m){r.e(m)}finally{r.f()}}}},{key:"onChoke",value:function(e){e=parseFloat(e[0]),isNaN(e)||(this.choking=2*e)}},{key:"onNewStep",value:function(){this.choking--}},{key:"color",get:function(){return mb.getColorForHash(this.id)}},{key:"slots",get:function(){return this.tracks}},{key:"containsSample",value:function(e){return this.tracks.filter(function(e){return!e.isFrozen}).find(function(t){return t&&t.sample===e})}},{key:"switch",value:function(e,t){var n=this.tracks[e],r=this.tracks[t];this.tracks[e]=r,this.tracks[t]=n,this.updateRedux()}},{key:"removeTrack",value:function(e){for(var t in this.tracks)this.tracks[t]===e&&(this.tracks[t]=!1);e.pad=void 0,this.updateRedux(),this.onTrackRemoved(e)}},{key:"slotTracks",get:function(){return this.tracks.filter(function(e){return e})}},{key:"patternLength",get:function(){return Math.max.apply(Math,Object(h.a)(this.slotTracks.filter(function(e){return e.pattern}).map(function(e){return e.pattern.length()})))}},{key:"addTrack",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e){e.changeOutputType(this.padFXMode),this.slots[t]&&this.deleteTrack(this.slots[t],n);var r=Object(h.a)(this.tracks);r[t]=e,this.tracks=r,e.pad&&e.pad.removeTrack(e),e.pad=this,n&&this.updateRedux(),this.onTrackAdded(e),this.sendTags(),this.sendSamples()}}},{key:"newSample",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sequencerEngine.addSound(t,void 0,void 0,void 0,void 0,void 0,!1);case 2:return r=e.sent,this.addTrack(r,n),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateRedux",value:function(){this.tracks=Object(h.a)(this.tracks),this.dispatch(Object(J.zc)(this.id,this.tracks))}},{key:"deleteTrack",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.slots.indexOf(e);-1!==n&&(this.slots[n]=!1,e.pad=!1,t&&this.updateRedux())}},{key:"getJson",value:function(){return{id:this.id,tracks:this.tracks.map(function(e){return!1===e?e:e.trackNumber}),x:this.x,name:this.name,y:this.y,padFXMode:this.padFXMode,fxMacroValue:this.fxMacro.macroParameter.get(!0),fxMacro:this.fxMacro.macroParameter.getJson()}}},{key:"getParameters",value:function(){return this.getAllParameters()}},{key:"getAllParameters",value:function(){return this.fxMacro&&this.effectRack?[this.fxMacro.macroParameter].concat(Object(h.a)(this.effectRack.getParameters())):[]}},{key:"getJsonForPack",value:function(){var e,t=[],n=fb(this.tracks);try{for(n.s();!(e=n.n()).done;){var r=e.value;r?r.sample?t.push({type:"SAMPLE",contentHash:r.sample.getId(),preset:this.sequencerEngine.getTrackPreset(r.trackNumber)}):r.preset&&r.preset.contentHash?t.push({type:"PRESET",contentHash:r.preset.contentHash,preset:this.sequencerEngine.getTrackPreset(r.trackNumber)}):t.push(!1):t.push(!1)}}catch(a){n.e(a)}finally{n.f()}return t.fx=this.effectRack.getJson(),t}},{key:"fromJson",value:function(e){e.id&&(this.id=e.id,this.sequencerEngine.idToObject[this.id]=this);var t=0,n=[];Array.isArray(e)?n=e:(n=e.tracks,this.x=e.x,this.y=e.y),void 0===e.fxMacroValue?this.createEffectRack():this.linkEffectRackContext();for(var r=0;r<n.length;r++){var a=n[r];if(!1!==a){var i=this.subSequence.tracks[parseFloat(a)];this.addTrack(i,t)}t++}this.fxMacroValue=e.fxMacroValue,this.fxMacroJson=e.fxMacro,e.fx&&this.effectRack.fromJson(e.fx),e.padFXMode&&(this.padFXMode=e.padFXMode),this.name=e.name}},{key:"deletePad",value:function(){var e=this;if(this.subSequence.deletePad(this),this.sequencerEngine.sends.sends){var t=this.sequencerEngine.sends.sends.filter(function(t){return t.pad===e});this.sequencerEngine.sends.deleteSends(t)}}},{key:"sendPadMessages",value:function(e){for(var t=this,n=[],r=[],a=this.state.tracks.triggers,i=0;i<this.slots.length;i++){var o=this.slots[i];if(o){var s=[],c=a[o.trackNumber];if(c)for(var u in c){if(c[u])s=o.currentStepDatas?o.currentStepDatas.map(function(e){return e.transpose}):[],n.push(1);else;}if(o.notesTriggered&&Object.keys(o.notesTriggered).length>0){if(o.isFrozen){n.push(1),r.push(s);continue}var l=o.lastPlayedStepData?o.lastPlayedStepData.duration:1,f=o.lastPlayedStepData?o.lastPlayedStepData.velocity:1;s=o.currentStepDatas?o.currentStepDatas.map(function(e){return e.transpose}):[],n.push(Math.max(0,f*(1+Math.max.apply(Math,Object(h.a)(Object.values(o.notesTriggered)))/l)))}else n.push(0);r.push(s)}else n.push(0),r.push([])}n.length<12&&(n=[].concat(Object(h.a)(n),Object(h.a)(new Array(12-n.length).fill(0)))),r.length<12&&(r=[].concat(Object(h.a)(r),Object(h.a)(new Array(12-r.length).fill(0)))),e?setTimeout(function(){t.sendMessage("pads playing",n),t.sendMessage("notes playing",r.map(function(e){return Array.isArray(e)?Array.from(new Set(e)):e}))},1e3*(e-re.a.Master.context.currentTime)-10):(this.sendMessage("pads playing",n),this.sendMessage("notes playing",r.map(function(e){return Array.from(new Set(e))})))}},{key:"onSizeChange",value:function(e,t){this.sendMessage("size",[e,t])}},{key:"sendSamples",value:function(){var e,t=[],n=fb(this.slots);try{for(n.s();!(e=n.n()).done;){var r=e.value.sample;t.push(r)}}catch(a){n.e(a)}finally{n.f()}this.sendMessage("samples",t)}},{key:"sendTags",value:function(){var e,t=[],n=fb(this.slots);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r){var a=r.sample;t.push(Object(ui.a)(r,a))}else t.push("")}}catch(i){n.e(i)}finally{n.f()}this.sendMessage("track types",t)}},{key:"mouseDown",value:function(e,t){var n=new Array(this.slots.length).fill(0);n[e]=t?1:0,this.sendMessage("mouse downs",n)}},{key:"sendSliderLevels",value:function(){var e,t=[],n=fb(this.slots);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r){var a=r.volumeParameter.get(!0);t.push(a<pb?0:Math.pow((a-pb)/(0-pb),window.ROOTY))}else t.push(0)}}catch(i){n.e(i)}finally{n.f()}this.sendMessage("slider levels",t)}},{key:"onSliderValues",value:function(e){for(var t=Object(v.a)(e,1)[0],n=0;n<t.length;n++){var r=t[n],a=this.slots[n];if(a){var i=yb(r,pb,0,1);a.volumeParameter.get(!0)!==i&&a.setVolume(i,!1,!1)}}}},{key:"onAddEffectMessage",value:function(e){var t=this.effectRack,n=t.effects.find(function(t){return t.name===e.name});t.isCollapsed=!0,n?this.sendMessage("effect added",n):(this.addRackEffect(e),this.sendMessage("effect added",e)),this.dispatch(Object(J.vb)(this.effectRack.id,!0))}},{key:"setTracksEnabled",value:function(e){Array.isArray(e)||(e=""===e?[]:[e]);var t,n=0,r=fb(this.tracks);try{for(r.s();!(t=r.n()).done;){var a=t.value;a&&(e.includes(n)?a.disabled=!1:a.disabled=!0),n++}}catch(i){r.e(i)}finally{r.f()}}},{key:"setTracksUnmuted",value:function(e){Array.isArray(e)||(e=""===e?[]:[e]);var t,n=0,r=fb(this.tracks);try{for(r.s();!(t=r.n()).done;){var a=t.value;a&&(e.includes(n)?a.mute(!1):a.mute(!0)),n++}}catch(i){r.e(i)}finally{r.f()}}}]),n}(Object(ci.a)(function(e){return function(e){Object(u.a)(n,e);var t=si(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"setupAuditioning",value:function(){var e=this;this.newInlet("auditition",function(t){var n=Object(v.a)(t,1)[0];return e.onAudition(n)}),this.newOutlet("samples"),this.newOutlet("audition swapped")}},{key:"onAudition",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)){e.next=2;break}return e.abrupt("return");case 2:return n=Object(v.a)(t,5),r=n[0],i=n[1],o=n[2],s=n[3],c=n[4],console.log("audition bpm=%s sampleKey=%s songKey=%s",o,s,c),u=new H.a(i),e.next=7,u.fetchAudio(!0);case 7:if(l=this.slots[r],f=l.sample._id||l.sample.getId(),l){e.next=11;break}return e.abrupt("return");case 11:this.replaceSampleWith(l,u,o,void 0,s,c),this.sendMessage("audition swapped",f),this.sendSamples();case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"replaceSampleWith",value:function(e,t,n,r,a,i){var o=e.getSamplers()[0],s=new re.a.Buffer(t.audioBuffer);return o.slices[0].buffer=s,o.baseBuffer=s,o.slices[0].sampler._buffers._buffers[48]=s,o.slices[0].startTime=0,o.slices[0].endTime=s.duration,o.slices[0].transpose=w({key:i},{key:a}),console.log("transpose diff for %s -> %s is %s",a,i,o.slices[0].transpose),o.sample._id=t.getId(),e}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=ob(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).sliderCanvases={},e.sliderMeshes={},e.sliderPlanes={},e.sliderCameras={},e.sliderRenderers={},e}return Object(s.a)(n,[{key:"onSliderMaterial",value:function(e){for(var t in this.sliderMaterial=e,this.sliderMeshes){var n=this.sliderMeshes[t];if(n)if(0===n.inlets[1].connections.length){var r=this.inlets["sliders material"].connections[0].sourceNode;this.sliderMeshes[t].connectInlet("1",r,"Output 1"),this.sliderPlanes[t].bang(),this.sliderCameras[t].bang()}else this.sliderRenderers[t].onInputMessage(this.sliderRenderers[t].lastMessageReceived)}}},{key:"newZObject",value:function(e){var t=new ib(this.subSequence);return t.text=e,t}},{key:"newSliderRenderer",value:function(e){var t=this.newZObject("three.planeGeometry"),n=this.newZObject("three.scene"),r=this.newZObject("three.mesh"),a=this.newZObject("three.orthographicCamera 0 150 0 150 -1 1"),i=this.newZObject("three.render");i.connectInlet("1",a,"Output 1"),i.connectInlet("Input",n,"Output 1"),n.connectInlet("Input",r,"Output 1"),r.connectInlet("Input",t,"Output 1");var o=this.newZObject("three.canvas");return o.effect.connectInlet("operation",i,"Output 1"),a.bang(),this.sliderPlanes[e]=t,this.sliderMeshes[e]=r,this.sliderCanvases[e]=o,this.sliderCameras[e]=a,this.sliderRenderers[e]=i,o}},{key:"freeSliderRenderer",value:function(e){this.sliderMeshes[e]=void 0,this.sliderCanvases[e]=void 0}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=lb(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"initShaderBackground",value:function(){var e=this;this.scene=new ib(this.subSequence),this.scene.text="three.scene",this.render=new ib(this.subSequence),this.render.text="three.render",this.canvas=new ib(this.subSequence),this.canvas.text="three.canvas",this.camera=new ib(this.subSequence),this.camera.text="three.orthographicCamera 0 201 0 227 -1 1",this.render.connectInlet("camera",this.camera,"Output 1"),this.render.connectInlet("Input",this.scene,"Output 1"),this.canvas.effect.connectInlet("operation",this.render,"Output 1"),this.camera.bang(),this.newInlet("background scene",function(t){e.showCanvas=!0,e.scene.onInputMessage(t)})}}]),n}(e)}(Object(fi.a)(function(e){return function(e){Object(u.a)(n,e);var t=ub(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"createEffectRack",value:function(){this.send=this.sequencerEngine.sends.createNewSend(this);var e=Object($a.b)("Effect Rack",this.sequencerEngine);e.pad=this,e.context=(new X.a).forSubSequence(this.subSequence),this.effectRack=e,this.send.addEffect(e),this.fxMacro=new cb.a("Pad Send",this.sequencerEngine,(new X.a).forSubSequence(this.subSequence)),this.fxMacro.macroParameter.isAlwaysLocked=!0}},{key:"send",get:function(){return this._send},set:function(e){this._send=e,this.needsStereoWaveforming&&this.startStereoWaveforming()}},{key:"startStereoWaveforming",value:function(){this.send?this.send.startStereoWaveforming(this,"stereo oscilloscope"):this.needsStereoWaveforming=!0}},{key:"linkEffectRackContext",value:function(){this.effectRack&&(this.effectRack.pad=this,this.effectRack.registerContext((new X.a).forSubSequence(this.subSequence)))}},{key:"effects",get:function(){return this.effectRack?this.effectRack.effects:[]}},{key:"effectsChain",get:function(){return this.effectRack}},{key:"sendNumber",get:function(){return this.sequencerEngine.sends.sends.indexOf(this.send)}},{key:"addRackEffect",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(fe.a)(Object(f.a)(n.prototype),"addRackEffect",this)).call.apply(e,[this].concat(r)),this.updateEffectRedux()}},{key:"updateEffectRedux",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(h.a)(this.effectRack.effects);this.dispatch(Object(J.wc)(this.id,e))}},{key:"onTrackAdded",value:function(e){this.fxMacro&&this.fxMacro.addParameter(e.sendNodeVolumeParameters[this.sendNumber],0,1)}},{key:"syncTracksToEffects",value:function(){var e=this;this.fxMacro=new cb.a("Pad Send",this.sequencerEngine,(new X.a).forSubSequence(this.subSequence)),this.fxMacro.macroParameter.isAlwaysLocked=!0,void 0!==this.fxMacroValue&&this.fxMacro.macroParameter.set(this.fxMacroValue),this.fxMacroJson&&this.fxMacro.macroParameter.fromJson(this.fxMacroJson,this.sequencerEngine),this.tracks.filter(function(e){return e}).forEach(function(t){return e.onTrackAdded(t)}),this.linkEffectRackContext()}},{key:"onTrackRemoved",value:function(e){this.fxMacro&&(this.fxMacro.unmapParameter(e.sendNodeVolumeParameters[this.sendNumber],!1),e.sendNodeVolumeParameters[this.sendNumber].set(0))}}]),n}(e)}(Object(sb.a)(Qa(function(){return function e(){Object(o.a)(this,e)}}())))))))));function gb(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ob(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ob(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ob(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function jb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var kb=n(9),wb=n(939);function xb(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Sb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Sb(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Sb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Pb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Eb=function(e){Object(u.a)(n,e);var t=Pb(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this)).subSequence=e,r.sequencerEngine=e.sequencerEngine,r.id=Object(q.uuid)(),r.tracks=[],r.type=wb.a,r}return Object(s.a)(n,[{key:"dispose",value:function(){this.tracks.forEach(function(e){return e.sequencer=void 0}),this.subSequence.removeSequencer(this)}},{key:"fromJson",value:function(e){var t=this;this.id=e.id,this.x=e.x,this.y=e.y,e.width&&e.height&&(this.width=e.width,this.height=e.height);var n,r=xb(e.tracks);try{var a=function(){var e=n.value,r=t.subSequence.tracks.find(function(t){return t.id===e});r&&t.addTrack(r)};for(r.s();!(n=r.n()).done;)a()}catch(i){r.e(i)}finally{r.f()}}},{key:"getJson",value:function(){return{id:this.id,x:this.x,y:this.y,width:this.width,height:this.height,tracks:this.tracks.map(function(e){return e.id})}}},{key:"removeTrack",value:function(e){this.tracks=this.tracks.filter(function(t){return t!==e}),e.sequencer=void 0,this.updateRedux()}},{key:"addTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.tracks.length;this.tracks.includes(e)||(e.sequencer=this,this.tracks[t]=e,this.updateRedux())}},{key:"updateRedux",value:function(){this.tracks=Object(h.a)(this.tracks),this.dispatch(Object(J.Ld)(this.id,this.tracks))}}]),n}(Qa(function(){return function e(){Object(o.a)(this,e)}}()));function Tb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Ab(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Mb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mb(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Mb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Rb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Cb=["A","B","C","D","E","F","G","H","I","J","K","L","M","N"],Nb=function(e){Object(u.a)(n,e);var t=Rb(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(o.a)(this,n),(r=t.call(this)).sequencerEngine=e,r.store=e.store,r.isTrack=a,r.id=Object(q.uuid)(),r.groups=new za(e.channelMixer,e.sends,e,Object(c.a)(r)),r.lfosTrack=new Gn(e,Object(c.a)(r)),r.envelopesTrack=new Xn(e,Object(c.a)(r)),r.tracks=[],r.mix=new ai.a(e,Object(c.a)(r)),r.setAutomationToShow(kb.i),r.midiEffects=new ri(Object(c.a)(r),e),r.playhead=new Za.a(Object(c.a)(r)),r.playhead.registerContext((new X.a).forSubSequence(Object(c.a)(r))),r.subSequence=Object(c.a)(r),r.trackData=new K.a(e,r.mix,(new X.a).forSubSequence(Object(c.a)(r))),r.trackData.loadDefaults(),r.initColor(),r.higherRolling=void 0,r.initPattr(),r}return Object(s.a)(n,[{key:"state",get:function(){return this.sequencerEngine.state}},{key:"getEffectNumber",value:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.midiEffects.getEffectNumber(e):0}},{key:"moveMidiEffectTo",value:function(e,t){this.midiEffects.moveEffectTo(e,t)}},{key:"name",get:function(){var e=this.sequencerEngine.subSequences.indexOf(this);return Cb[e]}},{key:"linearRampFade",value:function(e,t,n){this.tracks.forEach(function(r){return r.linearRampFade(e,t,n)})}},{key:"presentationMode",get:function(){return this.state.spatial.presentationMode[this.id]},set:function(e){this.dispatch(Object(J.Yc)(this.id,e))}},{key:"fade",set:function(e){e=e||0,this.fadeVolume!==e&&(this.muted||this.tracks.forEach(function(t){return t.fade=e}),this.store.dispatch(Object(J.ke)(this.id,e)))}},{key:"mute",set:function(e){var t=e?0:this.fadeVolume;this.tracks.forEach(function(e){return e.fade=t}),this.store.dispatch(Object(J.le)(this.id,e))}},{key:"disposeParameters",value:function(){this.lfos.forEach(function(e){return e.lfo.disposeParameters()}),this.envelopes.forEach(function(e){return e.disposeParameters()})}},{key:"dispose",value:function(){this.pads.forEach(function(e){return e.deletePad()}),this.tracks.forEach(function(e){return e.dispose()}),this.groups.dispose(),this.tracks=void 0,this.groups=void 0,this.envelopes.forEach(function(e){return e.dispose()}),this.lfos.forEach(function(e){return e.lfo.dispose()}),this.lfosTrack=void 0,this.envelopesTrack=void 0}},{key:"addTrack",value:function(e){e.subSequence=this,this.tracks.push(e),this.isTrack&&this.groups.addTrack(e)}},{key:"setId",value:function(e){this.id=e,e+1}},{key:"channelMixer",get:function(){return this.sequencerEngine.channelMixer}},{key:"sends",get:function(){return this.sequencerEngine.sends}},{key:"lfos",get:function(){return this.lfosTrack.lfos}},{key:"length",get:function(){var e,t=-1,n=Ab(this.tracks);try{for(n.s();!(e=n.n()).done;){var r=e.value.length;r>=t&&(t=r)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"envelopes",get:function(){return this.envelopesTrack.envelopes.map(function(e){return e.envelope})}},{key:"fadeVolume",get:function(){return this.store.getState().mix.subSequenceFades[this.id]||1}},{key:"setAutomationToShow",value:function(e){this.store.dispatch(Object(J.x)(this.id,e))}},{key:"volumeAutomationMix",get:function(){return this.mix.mixesByType[kb.l]}},{key:"loopStart",get:function(){return this.store.getState().arrangement.selection.start}},{key:"looping",get:function(){return this.store.getState().arrangement.selection.start}},{key:"updateVolumeFromAutomation",value:function(e){var t=this.volumeAutomationMix.getValueAtStep(e,this.fadeVolume);this.looping&&e===this.loopStart?(this.mix.restart(),this.fade=t):this.fadeVolume!==t&&this.store.dispatch(Object(J.ke)(this.id,t))}},{key:"getJson",value:function(){return{id:this.id,isTrack:this.isTrack,playhead:this.playhead.getJson(),color:this.color,pattr:this.pattr.getJson()}}},{key:"fromJson",value:function(e){this.id=e.id,void 0!==e.isTrack&&(this.isTrack=e.isTrack),e.playhead&&this.playhead.fromJson(e.playhead),e.color?this.color=e.color:this.initColor(),this.pattr.fromJson(e.pattr)}},{key:"getAllParameters",value:function(){return[].concat(Object(h.a)(this.playhead.parameters),Object(h.a)(this.midiEffects.getAllParameters()),Object(h.a)(this.pads.flatMap(function(e){return e.getAllParameters()})))}},{key:"getAllEffects",value:function(){return[].concat(Object(h.a)(this.midiEffects.effects),Object(h.a)(this.pads.flatMap(function(e){return void 0===e.effectRack?[]:e.effectRack.effects})))}},{key:"newPattern",value:function(){if(0!==this.tracks.length){var e=this.tracks[0].patterns.length,t=this.tracks[0].currentPattern,n=this.getAllEffects();n.forEach(function(t){return t.locked&&t.lockPattern(e,!0)});var r=n.flatMap(function(e){return e.getParameters()}),a=this.pads.map(function(e){return e.fxMacro.macroParameter.get()});r.forEach(function(n){return n.newPattern(t,e)}),this.pads.forEach(function(e,t){return e.fxMacro.macroParameter.set(a[t])})}}},{key:"insideInstance",value:function(){return!1}},{key:"propagate",value:function(){}},{key:"isRoot",value:function(){return!0}}]),n}(Object(Ua.a)(function(e){return function(e){Object(u.a)(n,e);var t=Ha(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"loadSubPatch",value:function(e){var t=this;return new Promise(function(n){Object(Ja.b)(void 0,"zobject.subpatch",[],0,void 0,!1).then(function(r){var a=r.find(function(t){return t.title.includes(e)});if(a){var i=t.createZObject(1,1,"subpatch",!1);i.loadPreset(a),i.isUI=!0,console.log("setting isUI =",i),n(i)}})})}}]),n}(e)}(of(function(e){return function(e){Object(u.a)(n,e);var t=Tb(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"newZObject",value:function(){return new ib(this)}}]),n}(e)}(Object(Ga.a)(Object(Wa.a)(Qa(function(e){return function(e){Object(u.a)(n,e);var t=Pb(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).sequencers=[],e}return Object(s.a)(n,[{key:"createSequencer",value:function(){var e=new Eb(this);return this.sequencers=[].concat(Object(h.a)(this.sequencers),[e]),this.updateRedux(),e}},{key:"removeSequencer",value:function(e){this.sequencers=this.sequencers.filter(function(t){return t!==e}),this.updateRedux()}},{key:"deleteTrackFromSequencers",value:function(e){this.sequencers.filter(function(t){return t.tracks.includes(e)}).forEach(function(t){return t.removeTrack(e)})}},{key:"getSequencersJson",value:function(){return this.sequencers.map(function(e){return e.getJson()})}},{key:"loadSequencersJson",value:function(e){if(e){var t,n=xb(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.createSequencer().fromJson(r)}}catch(a){n.e(a)}finally{n.f()}}}},{key:"updateRedux",value:function(){this.dispatch(Object(J.Md)(this.id,this.sequencers))}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=jb(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).pads=[],e.updating=!1,e}return Object(s.a)(n,[{key:"schedulePads",value:function(){this.pads.forEach(function(e){return e.onNewStep()})}},{key:"sendPadMessages",value:function(e){this.pads.forEach(function(t){return t.sendPadMessages(e)})}},{key:"loadPackAsPads",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i){var o,s,c,u,l,f,h,d,p,v;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.sequencerEngine.dispatch(Object(J.fc)(this.sequencerEngine.sequenceId,!0)),console.log("load pack as pads loading now=",this.sequencerEngine.isLoading),o=r||this.createPad(),s=[],o.packHash=i,this.updating=!0,c=0;case 7:if(!(c<t.length)){e.next=34;break}if(u=t[c]){e.next=11;break}return e.abrupt("continue",31);case 11:if(s.push(c),l=r&&r.slots[c]&&r.slots[c].getTrackType(),f=u.preset.trackData.trackType,!r||!r.slots[c]||l===f){e.next=22;break}return h=r.slots[c].trackNumber,r.removeTrack(r.slots[c]),this.sequencerEngine.deleteTrack(h),e.next=20,this.sequencerEngine.loadTrackPreset(u.preset,void 0,!0);case 20:d=e.sent,o.addTrack(d,c,void 0,!1);case 22:if(!r||!r.slots[c]){e.next=27;break}return e.next=25,this.sequencerEngine.auditionPreset({data:u.preset},r.slots[c].trackNumber,void 0,!0,!1);case 25:e.next=31;break;case 27:return e.next=29,this.sequencerEngine.loadTrackPreset(u.preset,void 0,!0);case 29:p=e.sent,o.addTrack(p,c,void 0,!1);case 31:c++,e.next=7;break;case 34:for(v=0;v<r.slots.length;v++)r.slots[v]&&!s.includes(v)&&this.sequencerEngine.deleteTrack(r.slots[v].trackNumber);n&&(o.effectRack.fromJson(n,void 0,void 0,!0),o.updateEffectRedux()),this.updating=!1,this.sequencerEngine.dispatch(Object(J.fc)(this.sequencerEngine.sequenceId,!1)),o.updateRedux();case 39:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"deletePad",value:function(e){this.pads=this.pads.filter(function(t){return t!==e}),e.slotTracks.forEach(function(e){return e.pad=void 0}),this.updateRedux()}},{key:"deleteTrackFromPads",value:function(e){var t=this.pads.find(function(t){return t.slots.includes(e)});t&&t.deleteTrack(e)}},{key:"createPad",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,a=new bb(this,t),i=r&&0===this.pads.length;if(n){var o=this.createZObject(5,5,"pad");if(o.effect.linkPad(a),this.state.samples.droppedSamples){var s=this.state.samples.droppedSamples;s>9&&o.setAttribute("Number of Pads",s)}}if(this.pads=[].concat(Object(h.a)(this.pads),[a]),e){var c,u=0,l=gb(this.tracks);try{for(l.s();!(c=l.n()).done;){var f=c.value;f.pad||a.addTrack(f,u++),u>=9&&(u=0,a=new bb(this),this.pads=[].concat(Object(h.a)(this.pads),[a]))}}catch(d){l.e(d)}finally{l.f()}}return this.updateRedux(),i&&!this.sequencerEngine.isOffline&&this.dispatch(Object(J.Ud)(a)),a}},{key:"checkPads",value:function(){var e,t=this.findNodeByName("pad",!0).map(function(e){return e.effect.pad}),n=gb(this.pads);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(!t.includes(r)){var a=this.state.windows.windowPositions[r.id]||{x:0,y:0};this.createZObject(a.x,a.y,"pad").effect.linkPad(r)}r.sendSliderLevels()}}catch(i){n.e(i)}finally{n.f()}}},{key:"updateRedux",value:function(){this.dispatch(Object(J.Ac)(this.id,this.pads))}},{key:"getPadsJson",value:function(){return this.pads.map(function(e){return e.getJson()})}},{key:"loadPadsJson",value:function(e){if(e){var t,n=gb(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.createPad(void 0,!1,!1).fromJson(r)}}catch(a){n.e(a)}finally{n.f()}}}},{key:"addTrackToPadIfPossible",value:function(e){var t=void 0,n=void 0;if(this.state.spatial.showPadSequencer)!0===(t=this.state.spatial.showPadSequencer)&&(t=this.pads[0]),-1===(n=t.tracks.indexOf(!1))&&(t=void 0);else{var r,a=gb(this.pads);try{for(a.s();!(r=a.n()).done;){var i=r.value,o=i.tracks.indexOf(!1);o>-1&&!i.tracks.includes(e)&&(n=o,t=i)}}catch(c){a.e(c)}finally{a.f()}}if(t)t.addTrack(e,n,!0,!this.updating);else if(this.state.sequencer.viewMode===ii.b){var s=this.createPad(void 0,void 0,void 0,e);this.dispatch(Object(J.Ze)(s.id,{x:5,y:5})),s.addTrack(e,0,!0,!this.updating),this.sequencerEngine.selectTrack(e.trackNumber)}}}]),n}(e)}(function(){return function e(){Object(o.a)(this,e)}}())))))))))),Ib=n(949);n(981);function qb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var _b=function(){function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"name",type:"bytes32"}],name:"syncClockMaster",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"name",type:"bytes32"}],name:"syncClockSlave",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"",type:"address"},{indexed:!0,name:"",type:"bytes32"},{indexed:!1,name:"index",type:"bytes32"}],name:"ClockSyncMaster",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"",type:"address"},{indexed:!0,name:"",type:"bytes32"},{indexed:!1,name:"index",type:"bytes32"}],name:"ClockSyncSlave",type:"event"}],this.contractAddress="0x17eafcd1dc39c8d78ff165e1dbd0fe9e82afbdc2"}return Object(s.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),Db=n(72),Fb=n(78);function Lb(e){return new Promise(function(t){var n=new Blob([new Uint8Array(e)]),r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsText(n)})}function Bb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var zb=n(1868),Jb=(rr.a.web3,function(e){Object(u.a)(n,e);var t=Bb(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this)).sequencerEngine=e,r.store=r.sequencerEngine.store,r.contract=(new _b).getContract(rr.a.web3),r.listeningForClockSyncs=!1,r.connected=!1,r.isInitial=!0,r.userToSignal={},r}return Object(s.a)(n,[{key:"setClockType",value:function(e){this.store.dispatch(Object(J.U)(e)),this.initiator=e===Db.a,this.clockType=e,e!==Db.b&&(this.setupWebRTC(),this.listeningForClockSyncs!==e&&this.listenForClockSyncs(e))}},{key:"retry",value:function(){this.setupWebRTC()}},{key:"startListening",value:function(){this.connected?console.log("is connected"):this.listenForClockSyncs(Db.c)}},{key:"stopListening",value:function(){this.timer&&clearInterval(this.timer)}},{key:"listenForClockSyncs",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.timer&&clearInterval(this.timer),this.listeningForClockSyncs=t,this.isInitial||this.store.dispatch(Object(J.ab)(Fb.d)),e.next=5,Ia.a.getAccount();case 5:n=e.sent,this.listenCallback(t,n),this.timer=setInterval(function(){r.listenCallback(t,n)},1e4);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"listenCallback",value:function(e,t){var n=this,r=e===Db.a?Db.c:Db.a;fetch("/getClockUsers/"+r+"/"+t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(){var r=Object(i.a)(a.a.mark(function r(i){var o,s,c,u,l,f;return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!n.connected){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,i.json();case 4:o=r.sent,s=[],r.t0=a.a.keys(o);case 7:if((r.t1=r.t0()).done){r.next=20;break}if(c=r.t1.value,(u=o[c].userId)!==t){r.next=12;break}return r.abrupt("continue",7);case 12:return l=o[c].signal,r.next=15,rr.a.users.getUserName(u);case 15:f=r.sent,e===Db.a?(n.signal(l),n.store.dispatch(Object(J.Z)(f))):u in n.userToSignal||(s.push(f),n.store.dispatch(Object(J.I)(s))),n.userToSignal[u]=l,r.next=7;break;case 20:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}())}},{key:"syncToUser",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.isInitial=!1,this.setClockType(Db.c),this.signal(this.userToSignal[t]),e.next=5,rr.a.users.getUserName(t);case 5:n=e.sent,this.userToConnectTo=t,this.store.dispatch(Object(J.Z)(n));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setupWebRTC",value:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(t,n){e.connected=!1,e.peer=new zb({reconnectTimer:1e3,channelConfig:{maxRetransmits:5,reliable:!1,ordered:!1},initiator:e.initiator,trickle:!1}),e.peer.on("error",function(t){console.log(t),e.connected=!1,e.retry()}),e.peer.on("signal",function(t){return e.onSignal(t)}),e.peer.on("connect",function(){e.connected=!0,e.store.dispatch(Object(J.ab)(Fb.c)),e.tellServerWeConnected(),clearInterval(e.timer)}),e.peer.on("data",function(t){return e.onMessageFromPeer(t)}),e.peer.on("close",function(){e.connected=!1,e.store.dispatch(Object(J.ab)(Fb.a))}),t()})}},{key:"onSignal",value:function(e){var t=this;la.a.addJson(e).then(function(){var e=Object(i.a)(a.a.mark(function e(n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.clockType===Db.a?t.publishMaster(n):t.publishSlave(n,t.userToConnectTo);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}},{key:"onMessageFromPeer",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,Lb(t);case 3:e.t1=e.sent,n=e.t0.parse.call(e.t0,e.t1),e.t2=n.type,e.next=6===e.t2?8:1===e.t2?10:2===e.t2?17:4===e.t2?19:5===e.t2?21:3===e.t2?23:30;break;case 8:return this.onTransferTrack(n.payload),e.abrupt("break",30);case 10:return this.lastTickTime=(new Date).getTime(),this.step=parseInt(n.payload.step),this.time=parseFloat(n.payload.time),this.length=parseInt(n.payload.length),this.peer.send(JSON.stringify({type:2,payload:""})),this.updateClockTickUI(this.step),e.abrupt("break",30);case 17:return this.peer.send(JSON.stringify({type:3})),e.abrupt("break",30);case 19:return this.sequencerEngine.stop(),e.abrupt("break",30);case 21:return this.sequencerEngine.bpm=n.payload,e.abrupt("break",30);case 23:return this.rtt=(new Date).getTime()-this.lastTickTime,r=this.rtt/2,i=this.step%this.sequencerEngine.length,(o=this.sequencerEngine.length)>this.length&&(o=this.length),i!==o-2||this.initiator||this.sequencerEngine.playing||!this.isPlayScheduled||(s=this.lastTickTime-r+this.time-(new Date).getTime(),s+=new re.a.Time("32n").toMilliseconds(),this.sequencerEngine.timeToCompare=(new Date).getTime()+s,this.sequencerEngine.play()),e.abrupt("break",30);case 30:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateClockTickUI",value:function(e){var t=this.length||this.sequencerEngine.length;if(0===(e%=t)%4){var n=e/t*100,r=25;n>=25&&n<50?r=50:n>=50&&n<75?r=75:n>=75&&(r=100),this.store.dispatch(Object(J.T)(r))}}},{key:"signal",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,la.a.getJson(t);case 2:n=e.sent,console.log("calling peer ignal with data =",n),this.peer.signal(n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"publishMaster",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.dispatch(Object(J.ab)(Fb.d)),e.next=3,Ia.a.getAccount();case 3:r=e.sent,fetch("/publishClock/"+r,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({clockType:Db.a,signal:t})});case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"askToConnect",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.dispatch(Object(J.ab)(Fb.d)),this.setClockType(Db.a),e.next=4,Ia.a.getAccount();case 4:n=e.sent,fetch("/askToConnect/"+n,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({userToConnectTo:t})});case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"publishSlave",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.dispatch(Object(J.ab)(Fb.d)),e.next=3,Ia.a.getAccount();case 3:r=e.sent,fetch("/publishClock/"+r,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({clockType:Db.c,signal:t,userToConnectTo:n})});case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onStop",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.connected&&this.initiator&&this.peer.send(JSON.stringify({type:4}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onBPMChanged",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.connected&&this.clockType===Db.a&&this.peer.send(JSON.stringify({type:5,payload:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onTick",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.connected&&this.clockType===Db.a&&(this.peer.send(JSON.stringify({type:1,payload:{step:n,time:t,length:this.sequencerEngine.length}})),this.updateClockTickUI(n));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"tellServerWeConnected",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ia.a.getAccount();case 2:t=e.sent,fetch("/clocksConnected/"+t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}});case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"state",get:function(){return this.store.getState()}},{key:"isPlayScheduled",get:function(){return this.state.clock.playScheduled}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=qb(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"onTransferTrack",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.preset,r=t.pattern,e.next=3,this.sequencerEngine.loadTrackPreset(n,void 0,!0);case 3:(i=e.sent).pattern.changeLength(r.size),e.t0=a.a.keys(r);case 6:if((e.t1=e.t0()).done){e.next=13;break}if("size"!==(o=e.t1.value)){e.next=10;break}return e.abrupt("continue",6);case 10:i.pattern.stepBuckets[o].fromJson(r[o]),e.next=6;break;case 13:i.pattern.syncBuckets(),this.sequencerEngine.updateSteps();case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"transferTrack",value:function(e){var t=this.sequencerEngine.getTrackPreset(e.trackNumber),n=e.pattern.stepBuckets,r={size:n.length};for(var a in n)n[a].anyOn()&&(r[a]=n[a].getJson());var i={preset:t,pattern:r};this.peer.send(JSON.stringify({type:6,payload:i})),this.sequencerEngine.deleteTrack(e.trackNumber)}}]),n}(e)}(function(){return function e(){Object(o.a)(this,e)}}()))),Vb=n(1875),Hb=n.n(Vb),Ub=n(45);function Gb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Wb=0,Kb=n(596);function Qb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Zb=function e(){Object(o.a)(this,e)},Yb=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t,this.ccToCallback={},this.callbacks=[]}return Object(s.a)(e,[{key:"setCallback",value:function(e,t){this.ccToCallback[e]=t}},{key:"send",value:function(e,t){(t=Math.round(t))<0?t=0:t>127&&(t=127),this.output.sendControlChange(e,t)}},{key:"onEvent",value:function(e){var t=this.ccToCallback[e.controller.number];t&&t(e.value),38!==e.controller.number&&6!==e.controller.number&&96!==e.controller.number&&97!==e.controller.number&&this.sequencerEngine.store.dispatch(Object(J.ac)({number:e.controller.number,value:e.value}))}}]),e}(),$b="FILTER",Xb="DELAY",eg="SEND_A",tg=function(){function e(t){Object(o.a)(this,e),this.action=t}return Object(s.a)(e,[{key:"onChange",value:function(e,t){this.action===eg&&e&&e.setSendVolume(0,Object(qa.b)(t,0,128))}}]),e}(),ng="RESOLUTION",rg="TRACK_ROLL",ag="SEQUENCE_ROLL",ig={1:new ua.a(4,!1),2:new ua.a(4,!0),3:new ua.a(8,!1),4:new ua.a(8,!0),5:new ua.a(16,!1),6:new ua.a(16,!0),7:new ua.a(32,!1),8:new ua.a(32,!0)},og=0,sg=function(){function e(t,n,r){Object(o.a)(this,e),this.cc=r,this.sequencerEngine=t,this.lastNumber=0,this.ccToAction=this.convertConfig(n.cc),n.actions&&(this.noteToAction=this.convertConfig2(n.actions)),n.note&&(this.noteToAction=this.convertConfig(n.note)),n.ccActions&&(this.ccToAction=this.convertConfig2(n.ccActions)),this.overwrittenCC=new Set,this.knob1Action=new tg($b),this.knob2Action=new tg(Xb),this.knob3Action=new tg(eg),this.rollingCount=0}return Object(s.a)(e,[{key:"state",get:function(){return this.sequencerEngine.state}},{key:"overwrite",value:function(e){this.overwrittenCC.add(e)}},{key:"onNoteOnEvent",value:function(e){var t=e.note.number;if(void 0!==this.noteToAction){var n=this.noteToAction[t];if(void 0!==n){switch(n.action){case ag:this.onSequenceRollOn(n.track);break;case"PLAY":this.onPlay();break;case"RECORD":this.onRecord();break;case"CLEAR":this.onClear();break;case"PATTERN_SWITCH":this.onPatternSwitch(n.track);break;case"NEXT_PATTERN":this.onNextPattern();break;case"PREVIOUS_PATTERN":this.onPreviousPattern();break;default:return!0}return!0}}}},{key:"onNoteOffEvent",value:function(e){var t=e.note.number;if(void 0!==this.noteToAction){var n=this.noteToAction[t];if(void 0!==n){switch(n.action){case ag:this.onSequenceRollOff(n.track);break;case"PATTERN_SWITCH":break;default:return!0}return!0}}}},{key:"onEvent",value:function(e,t){if(this.ccToAction){var n=this.ccToAction[e];if(void 0!==n&&!this.overwrittenCC.has(e))switch(n.action){case"VOLUME":this.onVolume(n.track,t);break;case"KNOB_1":this.onKnob1(n.track,t);break;case"KNOB_2":this.onKnob2(n.track,t);break;case"KNOB_3":this.onKnob3(n.track,t);break;case"CHANGE_SELECTED_TRACK":this.changeSelectedTrack(t);break;case"BROWSE_SOUNDS":this.browseSounds(t);break;case"CHANGE_TRANSPOSE":this.changeTranspose(t);break;case"CHANGE_START_SLICE":this.changeStartSlice(t);break;case"CHANGE_END_SLICE":this.changeEndSlice(t);break;case"CHANGE_VOLUME":this.changeVolume(t)}}}},{key:"onVolume",value:function(e,t){var n=this.sequencerEngine.subSequences[e];void 0!==n&&(n.fade=t/128)}},{key:"onKnob1",value:function(e,t){var n=this.getTrack(e);this.knob1Action.onChange(n,t);var r=this.sequencerEngine.subSequences[e];void 0!==r&&this.sequencerEngine.switchToSubSequence(r.id)}},{key:"onKnob2",value:function(e,t){var n=this.getTrack(e);this.knob2Action.onChange(n,t);var r=this.sequencerEngine.subSequences[e];void 0!==r&&this.sequencerEngine.switchToSubSequence(r.id)}},{key:"onKnob3",value:function(e,t){var n=this.getTrack(e);this.knob3Action.onChange(n,t);var r=this.sequencerEngine.subSequences[e];void 0!==r&&this.sequencerEngine.switchToSubSequence(r.id)}},{key:"convertConfig2",value:function(e){var t={};for(var n in e){t[e[n]]={action:n}}return t}},{key:"convertConfig",value:function(e){var t={};for(var n in e){var r={track:Object(ke.a)(n)?parseInt(n):n},a=e[n];for(var i in a){t[a[i]]=Object(d.a)({},r,{action:i})}}return t}},{key:"getTrack",value:function(e){if("MASTER"!==e)return this.sequencerEngine.tracks[e]}},{key:"onSequenceRollOn",value:function(e){var t=ig[e];void 0!==t&&(this.sequencerEngine.resolution=t,this.sequencerEngine.trackRolling=!0,this.sequencerEngine.setSequenceRolling(!0,t),this.rollingCount++)}},{key:"onSequenceRollOff",value:function(e){this.rollingCount--,0===this.rollingCount&&(this.sequencerEngine.trackRolling=!1,this.sequencerEngine.setSequenceRolling(!1,void 0))}},{key:"onPatternSwitch",value:function(e){this.sequencerEngine.switchToPattern(e)}},{key:"onNextPattern",value:function(){this.sequencerEngine.switchToNextPattern()}},{key:"onPreviousPattern",value:function(){this.sequencerEngine.switchToPreviousPattern()}},{key:"onPlay",value:function(){this.sequencerEngine.play()}},{key:"onClear",value:function(){var e=this.sequencerEngine.getSelectedMidiTrack();e&&(e.pattern.clear(),e.updateSteps())}},{key:"onRecord",value:function(){this.sequencerEngine.recording(!this.sequencerEngine.isRecording)}},{key:"changeSelectedTrack",value:function(e){this.sequencerEngine.getSelectedMidiTrack();var t=Math.floor(e/128*this.sequencerEngine.tracks.length);this.sequencerEngine.selectTrack(t)}},{key:"browseSounds",value:function(e){var t=this,n=++og;setTimeout(function(){if(og===n){var r=t.sequencerEngine.getSelectedMidiTrack();if(void 0!==r)if(Math.abs(t.lastBrowseValue-e)<=2)e>=125&&t.resetBrowseToZero();else{var a=void 0===t.lastBrowseValue||e>=t.lastBrowseValue;t.lastBrowseValue=e,a?r.auditionNext(!0,!0):r.auditionPrevious(!0,!0),e>=125&&t.resetBrowseToZero()}}},50)}},{key:"resetBrowseToZero",value:function(){for(var e in this.lastBrowseValue=0,this.ccToAction)if("BROWSE_SOUNDS"===this.ccToAction[e].action)return void this.cc.send(parseInt(e),0)}},{key:"changeResolution",value:function(e){var t=1+Math.floor(e/128*8);this.sequencerEngine.resolution=ig[t]}},{key:"changeStartSlice",value:function(e){var t=e/128,n=this.sequencerEngine.getSelectedMidiTrack();if(n){var r=Object.keys(n.samplers);if(0!==r.length){var a=n.samplers[r[r.length-1]],i=this.getSlice(n),o=a.getSlice(i),s=t*o.endTime;s<o.endTime&&a.slice(i,s,o.endTime,void 0,void 0,!0)}}}},{key:"getSlice",value:function(e){return this.state.tracks.selectedTrackSlice[e.id]||0}},{key:"changeEndSlice",value:function(e){var t=e/128,n=this.sequencerEngine.getSelectedMidiTrack();if(n){var r=Object.keys(n.samplers);if(0!==r.length){var a=n.samplers[r[r.length-1]],i=this.getSlice(n),o=a.getSlice(i),s=a.getDuration(),c=o.startTime+t*(s-o.startTime);c>o.startTime&&a.slice(i,o.startTime,c,void 0,void 0,!0)}}}},{key:"changeVolume",value:function(e){var t=e/128,n=this.sequencerEngine.getSelectedMidiTrack();if(n){var r=64*Math.pow(t,.5)-60;n.setVolume(r)}}},{key:"changeTranspose",value:function(e){var t=this.sequencerEngine.getSelectedMidiTrack();if(t){var n=e/128*48-24;t.trackData.transpose=n}}}]),e}(),cg=n(1876),ug=function(){function e(t,n,r){Object(o.a)(this,e),this.sequencerEngine=t,this.store=this.sequencerEngine.store,this.input=n,this.output=r,this.step=0,this.subSequenceNumber=0,this.patternNumber=0,this.numberOfPatterns=1,this.setupLights(),this.setupListeners()}return Object(s.a)(e,[{key:"setupListeners",value:function(){var e=this;this.input.addListener("noteon","all",function(e){}),this.input.addListener("noteoff","all",function(e){}),this.store.subscribe(function(){return e.onStateUpdate()})}},{key:"onStateUpdate",value:function(){var e=this.store.getState(),t=this.sequencerEngine.getSubSequence(e.sequencer.currentSubSequence);if(void 0!==t){var n=this.sequencerEngine.subSequences.indexOf(t),r=e.sequencer.currentPattern[t.id],a=e.sequencer.numberOfPatterns;this.subSequenceNumber===n&&this.patternNumber===r&&this.numberOfPatterns===a||(this.patternNumber=r,this.subSequenceNumber=n,this.idToPattern=e.sequencer.currentPattern,this.numberOfPatterns=a,this.onStateChanged())}}},{key:"onStateChanged",value:function(){this.pad.reset(8),console.log("patternNumber = "+this.patternNumber+" and subSequenceNumber = "+this.subSequenceNumber),this.color(this.pad.red,8,this.subSequenceNumber);for(var e=0;e<this.sequencerEngine.subSequences.length;e++)this.color(this.pad.red,0,e);for(var t in this.idToPattern){t=parseInt(t),console.log("id we got = "+t);var n=this.sequencerEngine.getSubSequence(t);if(void 0===n)return;var r=this.sequencerEngine.subSequences.indexOf(n),a=this.idToPattern[t],i=n.tracks[0];if(void 0!==i)for(var o=0;o<Math.min(8,i.patterns.length);o++)this.color(this.pad.yellow,o,r);console.log("coloring x = "+a+" y ="+r),this.color(this.pad.red,a,r)}}},{key:"onTick",value:function(){}},{key:"setupLights",value:function(){var e=this;this.pad=new cg.a,this.pad.connect().then(function(){e.pad.reset(8),e.pad.on("key",function(t){return e.handleKeyPressed(t)}),e.onStateUpdate()})}},{key:"handleKeyPressed",value:function(e){var t=e.x,n=e.y;if(e.pressed){var r=this.sequencerEngine.subSequences[n];if(void 0!==r){var a=r.tracks[0];void 0!==a&&t<a.patterns.length&&(this.sequencerEngine.switchToSubSequence(r.id),this.sequencerEngine.switchToPattern(t))}}}},{key:"color",value:function(e,t,n){this.pad.col(e,{0:t,1:n,x:t,y:n,length:2,pressed:!0})}}]),e}();function lg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var fg=["Launchpad Mini"],hg=["IAC Driver Bus 1","IAC Driver Bus 2","IAC Driver Bus 3"],dg={"Akai MPD26 Port 1":Kb.i,"MPD218 Port A":Kb.i},pg=function(e){Object(u.a)(n,e);var t=lg(n);function n(e,r,a){var i;Object(o.a)(this,n),i=t.call(this);Object(c.a)(i);return i.keyboardEngine=e,i.sequencerEngine=i.keyboardEngine.sequencerEngine,i.keyboardHelper=r,i.deviceToMidiCC={},i.sliders={},i.controllerInputs=[],i.controllerOutputs=[],i.inputToMode={},i.updateBpm=a,i.previousTimestamp=null,i.currentTimestamp=null,window.isNFT||Hb.a.enable(function(e){e?console.log("WebMidi could not be enabled.",e):i.setup()},!0),i}return Object(s.a)(n,[{key:"setup",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadAvailableDevices();case 2:this.setupKeyboardRouting(),void 0!==this.onEnableCallback&&this.onEnableCallback();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"store",get:function(){return this.sequencerEngine.store}},{key:"state",get:function(){return this.store.getState()}},{key:"loadAvailableDevices",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){Hb.a.inputs.filter(function(e){return!fg.some(function(t){return t===e.name})&&!hg.some(function(t){return t===e.name})}).forEach(function(e){return t.trackInput(e,dg[e.name]||Kb.h)});var r=Hb.a.inputs.filter(function(e){return fg.some(function(t){return t===e.name})}),a=Hb.a.outputs.filter(function(e){return fg.some(function(t){return t===e.name})});r.length>0&&void 0===t.launchPad&&(t.launchPad=new ug(t.sequencerEngine,r[0],a[0])),Hb.a.outputs.map(function(e){return t.trackOutput(e)}),e()}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"setStartCallback",value:function(e){this.startCallback=e}},{key:"setStopCallback",value:function(e){this.stopCallback=e}},{key:"getInputs",value:function(){return Hb.a.inputs}},{key:"getOutputs",value:function(){return Hb.a.outputs}},{key:"getTrackedInputs",value:function(){return this.controllerInputs}},{key:"getTrackedOutputs",value:function(){return this.controllerOutputs}},{key:"isOutputTracked",value:function(e){return this.controllerOutputs.some(function(t){return t.name==e.name})}},{key:"getOutput",value:function(e){var t=this.controllerOutputs.filter(function(e){return e.name==t.name});return t.length>0?t[0]:null}},{key:"playNote",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;t=t||"all",(n=Math.round(n))>70?n=70:n<-36&&(n=-36);var s=y.a.fromTranspose(n).toString();if(null!=e&&(r-=0,e.playNote(s,t,{velocity:o,time:"+"+r}),void 0!==a)){var c=r+a-20;c-r<10&&(c+=10-(c-r)),e.stopNote(s,t,{time:"+"+c,release:i})}}},{key:"playNoteSimple",value:function(e,t,n,r){n=n||"all",e.playNote(t,n,{release:r})}},{key:"releaseNoteSimple",value:function(e,t,n,r){n=n||"all",e.stopNote(t,n,{release:r})}},{key:"trackOutput",value:function(e){for(var t in this.controllerOutputs)if(this.controllerOutputs[t].name===e.name)return;this.controllerOutputs.push(e),void 0===this.deviceToMidiCC[e.name]&&(this.deviceToMidiCC[e.name]=new Yb(this.sequencerEngine)),this.deviceToMidiCC[e.name].output=e}},{key:"untrackOutput",value:function(e){for(var t=-1,n=0;n<this.controllerOutputs.length;n++)if(this.controllerOutputs[n].name===e.name){t=n;break}t>-1&&(this.controllerOutputs.splice(t,1),delete this.inputToMode[e.name])}},{key:"trackInput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Kb.h;if(this.addControlChangeListeners(e),console.log("track input =",e.name),sa.a[e.name]&&void 0===this.sliders[e.name]){console.log("FOUND DEVICE TO SLIDER",e.name);var n=sa.a[e.name];this.sliders[e.name]=new sg(this.sequencerEngine,n,this.deviceToMidiCC[e.name])}for(var r in this.controllerInputs)if(this.controllerInputs[r].name===e.name)return;this.controllerInputs.push(e),this.setInputMode(e,t)}},{key:"isInputTracked",value:function(e){return this.controllerInputs.some(function(t){return t.name==e.name})}},{key:"isInputSynced",value:function(e){return void 0!==this.systemInput&&this.systemInput.name==e.name}},{key:"untrackInput",value:function(e){for(var t=-1,n=0;n<this.controllerInputs.length;n++)if(this.controllerInputs[n].name===e.name){t=n;break}t>-1&&(this.controllerInputs.splice(t,1),delete this.inputToMode[e.name])}},{key:"setInputMode",value:function(e,t){this.inputToMode[e.name]=t}},{key:"syncOutput",value:function(e){this.systemOutput===e?this.systemOutput=void 0:this.systemOutput=e}},{key:"onTick",value:function(e,t,n){if(void 0!==this.systemOutput){var r=new re.a.Time("32n").toMilliseconds()/3;e+=20;for(var a=0;a<3;a++)this.systemOutput.sendClock({time:"+"+e}),e+=r}this.launchPad&&this.launchPad.onTick(t,n)}},{key:"onPlay",value:function(){void 0!==this.systemOutput&&this.systemOutput.sendStart({time:"+0"})}},{key:"onStop",value:function(){void 0!==this.systemOutput&&this.systemOutput.sendStop()}},{key:"syncInput",value:function(e){void 0!==this.systemInput&&this.removeSystemListeners(),this.systemInput=e,this.addSystemInputListeners()}},{key:"unsyncInput",value:function(e){this.removeSystemListeners(),this.systemInput=void 0}},{key:"removeSystemListeners",value:function(){this.systemInput.removeListener("clock","all"),this.systemInput.removeListener("start","all"),this.systemInput.removeListener("stop","all")}},{key:"addSystemInputListeners",value:function(){var e=this;this.last10=[],this.systemInput.addListener("start","all",function(t){e.sequencerEngine.play(0,!0)}),this.systemInput.addListener("stop","all",function(t){e.sequencerEngine.stop()})}},{key:"onEnable",value:function(e){this.onEnableCallback=e}},{key:"addControlChangeListeners",value:function(e){var t=this;e.removeListener("pitchbend","all"),e.removeListener("controlchange","all"),void 0===this.deviceToMidiCC[e.name]&&(this.deviceToMidiCC[e.name]=new Yb(this.sequencerEngine));var n=e.name,r=this.deviceToMidiCC[e.name];r.input=e,e.addListener("controlchange","all",function(e){var a=t.sliders[n];t.onControlChange(r,a,e)}),e.addListener("pitchbend","all",function(e){t.onPitchBend(e)})}},{key:"removeListeners",value:function(e){e.removeListener("noteon","all"),e.removeListener("noteoff","all")}},{key:"getInputsForMode",value:function(e){var t=this;return this.controllerInputs.filter(function(n){return n.name in t.inputToMode&&t.inputToMode[n.name]==e})}},{key:"getInputMode",value:function(e){return this.inputToMode[e]||Kb.h}},{key:"setupKeyboardRouting",value:function(){var e=this;Hb.a.inputs.forEach(function(t){return e.removeListeners(t)}),this.addNoteOnListener(function(t,n,r){r<.1||(window.triggerReceived=(new Date).getTime(),r=Math.min(1,r+.1),e.keyboardHelper.onNoteDown(n,!0,t,r))},void 0),this.addNoteOffListener(function(t,n){e.keyboardHelper.onNoteOff(n,!0,t)},void 0)}},{key:"addNoteOnListener",value:function(e,t){var n=this;void 0===t&&(t=function(){return n.controllerInputs});Hb.a.inputs.map(function(r){return r.addListener("noteon","all",function(a){var i=n.sliders[r.name];if((!i||!i.onNoteOnEvent(a))&&t().some(function(e){return e.name==r.name})){var o=a.note.name+a.note.octave;e(r.name,o,a.velocity)}})})}},{key:"addNoteOffListener",value:function(e,t){var n=this;void 0===t&&(t=function(){return n.controllerInputs});Hb.a.inputs.map(function(r){return r.addListener("noteoff","all",function(a){var i=n.sliders[r.name];if((!i||!i.onNoteOffEvent(a))&&t().some(function(e){return e.name==r.name})){var o=a.note.name+a.note.octave;e(r.name,o)}})})}},{key:"updateSteps",value:function(e){}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=Qb(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"onControlChange",value:function(e,t,n){if(console.log("on control change=",n,n.controller.number,n.value),Object(hi.c)("midi.cc",n),e.onEvent(n),t&&t.onEvent(n.controller.number,n.value),n.controller.number===Kb.c)this.sequencerEngine.play();else if(n.controller.number===Kb.f)this.sequencerEngine.stop();else if(n.controller.number===Kb.e){var r=this.sequencerEngine.store.getState();this.sequencerEngine.recording(!r.sequencer.isRecording)}else n.controller.number===Kb.b?this.sequencerEngine.switchToNextPattern():n.controller.number===Kb.d?this.sequencerEngine.switchToPreviousPattern():n.controller.number===Kb.g?this.sequencerEngine.sustain(n.value):n.controller.number===Kb.a&&this.onModulationChange(n.value);if(n.controller.number>=1&&n.controller.number<=6){var a=this.sequencerEngine.groups.groups[n.controller.number-1];void 0!==a&&a.tracks.length}else this.onControllerAux(n)}},{key:"onPitchBend",value:function(e){var t=this.sequencerEngine.getSelectedTrack();t.instrument&&t.instrument.onPitchBend&&t.instrument.onPitchBend(e.value)}},{key:"onModulationChange",value:function(e){this.sequencerEngine.getSelectedTrack}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=Gb(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"midiMappings",get:function(){return this.state.midi.mappings}},{key:"midiMapMode",get:function(){return this.state.midi.midiMapMode}},{key:"onMappedParameterChange",value:function(e){var t=this,n=this.midiMappings[e.controller.number].map(function(e){return t.sequencerEngine.idToParameter[e]}).filter(function(e){return e&&e.object}),r=e.value/127;if(n.length>0){var a=++Wb,i=n[0];this.sequencerEngine.dispatch(Object(J.Hc)(i)),setTimeout(function(){Wb===a&&t.sequencerEngine.dispatch(Object(J.Hc)(void 0))},150)}n.forEach(function(e){return e.normalizedSet(r)})}},{key:"isParameterMapped",value:function(e){var t=e.controller.number;return this.midiMappings[t]&&(void 0===this.parameterSelected||this.midiMappings[t].indexOf(this.parameterSelected)>-1)}},{key:"onControllerAux",value:function(e){console.log("ON CONTROLLER AUX=",e),console.log("action selected=",this.actionSelected);var t=e.controller.number;this.midiMapMode===Ub.a?this.store.dispatch(Object(J.d)(t)):this.isParameterMapped(e)?this.onMappedParameterChange(e):this.actionMappings[t]&&(void 0===this.actionSelected||this.actionMappings[t].indexOf(this.actionSelected)>-1)?this.actionMappings[t].forEach(function(t){return t.execute(e.value)}):this.midiMapMode===Ub.b&&this.actionSelected?this.store.dispatch(Object(J.p)(this.actionSelected,t)):this.midiMapMode===Ub.b&&this.parameterSelected&&this.store.dispatch(Object(J.Ec)(this.parameterSelected,t))}},{key:"parameterSelected",get:function(){return this.state.midi.parameterSelected}},{key:"actionSelected",get:function(){return this.state.midi.actionSelected}},{key:"actionMappings",get:function(){return this.state.midi.actionMappings}}]),n}(e)}(Zb))),vg=n(951);function mg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var yg=new ua.a(4,!1),bg=function(e){Object(u.a)(n,e);var t=mg(n);function n(e,r,a,i,s){var c;return Object(o.a)(this,n),(c=t.call(this,-1,e,r,a,i,{id:-1})).isMetronome=!0,s||c.initPattern(),c}return Object(s.a)(n,[{key:"getCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,t,r,a,i,o){return new n(e,t,r,a,!0)},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine;return Object(fe.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,e,t)}},{key:"newFrozenColumn",value:function(){}},{key:"dispose",value:function(){Object(fe.a)(Object(f.a)(n.prototype),"dispose",this).call(this)}},{key:"initPattern",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new H.a("QmfJwbUmKMiE1Mrme2xHpHUJP2bVM3BFeUtzQgpDqHssCw"),e.next=3,t.fetchAudio();case 3:this.addSound(t),(n=this.getEasyPattern()).addStep(this.getOnBeat(),0,yg,0),n.addStep(this.getOffBeat(),1,yg,0),n.addStep(this.getOffBeat(),2,yg,0),n.addStep(this.getOffBeat(),3,yg,0),this.muteableNode.toMaster(),this.mute(!0);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOnBeat",value:function(){var e=new K.a;return e.on=!0,e.velocity=.7,e}},{key:"getOffBeat",value:function(){var e=new K.a;return e.on=!0,e.velocity=.2,e}},{key:"updateSteps",value:function(){}},{key:"getUpdateStepsAction",value:function(){return[]}}]),n}(ht),gg=(n(616),function(e,t){return 1!==t.speedFactor&&((e=Sg(e)).duration/=t.speedFactor),Og(t)?(e=Sg(e),e=jg(e,e.auxEventAParameter,t.auxEventAType),e=jg(e,e.auxEventBParameter,t.auxEventBType),e=jg(e,e.auxEventCParameter,t.auxEventCType),e=jg(e,e.auxEventDParameter,t.auxEventDType)):e}),Og=function(e){return e.auxEventAType!==Je.b||e.auxEventBType!==Je.b||e.auxEventCType!==Je.b||e.auxEventDType!==Je.b},jg=function(e,t,n){if(n===Je.b)return e;var r=t.get(),a=e.track,i=a.getAuxVariable(t.name);switch(n){case Je.c:kg(i,e,r);break;case Je.a:wg(i,e,a,r,t)}return e},kg=function(e,t,n){t[e]+=Math.random()*n},wg=function(e,t,n,r,a){void 0===n.accumulators[e]&&(n.accumulators[e]=0),n.accumulators[e]+=r;var i=n.getAuxLimit(a.name);n.getAuxMode(a.name);xg(n,e)>i&&xg(n,e,0),t[e]+=xg(n,e)},xg=function(e,t,n){if(void 0===n)return e.accumulators[t];e.accumulators[t]=n},Sg=function(e){var t=new K.a(void 0,void 0,void 0,e.track);return t.transpose=e.transpose,t.velocity=e.velocity,t.on=e.on,t.duration=e.duration,t.attack=e.attack,e.track.instrument?t.release=null:t.release=e.release,t.start=e.start,t.chop=e.chop,t.pitchAttack=e.pitchAttack,t.pitchSustain=e.pitchSustain,t.pitchRelease=e.pitchRelease,t.pitchDecay=e.pitchDecay,t.slice=e.slice,t.reverse=e.reverse,t.panning=e.panning,t.selectedRecording=e.selectedRecording,t.palette=e.palette,t.auxEventA=e.auxEventA,t.auxEventB=e.auxEventB,t.auxEventC=e.auxEventC,t.auxEventD=e.auxEventD,t},Pg=n(234);function Eg(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Tg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Tg(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Tg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ag=function(e){var t,n=new Set,r=0,a=Eg(e.subSequences);try{for(a.s();!(t=a.n()).done;){var i,o=Eg(t.value.tracks);try{for(o.s();!(i=o.n()).done;){var s=i.value;r+=s.triggerCount||0,Object.keys(s.notesTriggered||{}).forEach(function(e){return n.add(parseFloat(e))})}}catch(c){o.e(c)}finally{o.f()}}}catch(c){a.e(c)}finally{a.f()}Object(Pg.a)(Array.from(n)),Object(Pg.f)(r)};function Mg(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Rg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rg(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Rg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Cg(e,t,n,r,a){for(var i in t.filter(function(e){return void 0!==e}).forEach(function(e){return e.chokes.onStep()}),Ig(n,t),n=Ng(n,t))if(void 0!==t[i]&&void 0!==t[i].chokes&&void 0!==t[i].chokes.choke){var o=t[i].chokes.choke,s=n[i];for(var c in s){var u=s[c],l=2*u.stepData.duration;o.chokes.newChoke(l,u.time)}}n=Dg(n,t,r,a);for(var f=[],p=Math.max.apply(Math,Object(h.a)(t.map(function(e){return e.trackNumber}))),v=function(e){var n=t.find(function(t){return t.trackNumber===e});f.push(n)},m=0;m<=p;m++)v(m);t=f;var y,b=Mg(e.subSequences);try{for(b.s();!(y=b.n()).done;){var g,O=Mg(y.value.tracks);try{for(O.s();!(g=O.n()).done;){var j=g.value;if(j){for(var k=j.notesTriggered||{},w=Object.keys(k),x=0,S=w;x<S.length;x++){var P=S[x];k[P]-=.5,k[P]<=-1.5&&delete k[P]}j.notesTriggered=Object(d.a)({},k)}}}catch(A){O.e(A)}finally{O.f()}}}catch(A){b.e(A)}finally{b.f()}var E=function(e){var i=t[e],o=i&&i.notesTriggered||{};return void 0===i||void 0===i.chokes||i.chokes.isChoked()?(i&&(i.triggerCount=0),"continue"):i.pad&&i.pad.choking>0?(i.triggerCount=0,"continue"):void 0===n[e]?(i.triggerCount=0,"continue"):(0===n[e].length?a%2===0&&(i.triggerCount=n[e].length):i.triggerCount=n[e].length,n[e].forEach(function(e){var t=Math.round(e.stepData.transpose),n=o[t]||0,s=i.isWarped()?2:0;o[t]=Math.max(n,e.stepData.duration+s);var c=gg(e.stepData,i);c.stepNumber=e.rolledStepNumber||e.stepNumber,c.time=r,i.trigger(c,e.time,a)}),void(i.notesTriggered=Object(d.a)({},o)))};for(var T in n)E(T);return Ag(e),n}var Ng=function(e){var t=new Set([]);for(var n in e){e[n].filter(function(e){return e.chokes&&e.chokes.length>0}).forEach(function(e){return e.chokes.forEach(function(e){return t.add(e.trackNumber)})})}var r={};for(var a in e)t.has(parseInt(a))||(r[a]=e[a]);return r},Ig=function(e,t){for(var n in e)for(var r=e[n].filter(function(e){return e.grabs&&e.grabs.length>0}),a=0;r.length>0&&!(++a>=100);){var i,o=r.shift(),s=Mg(o.grabs);try{for(s.s();!(i=s.n()).done;){var c=i.value;if(qg(c,e)){r.push(o);break}_g(o,c,e,t),o.resolved=!0}}catch(u){s.e(u)}finally{s.f()}}},qg=function(e,t){var n=e.trackNumber,r=(e.fromParam,e.toParam,t[n]);if(void 0===r||0===r.length)return!1;var a=r[0];return a.grabs.length>0&&!a.resolved},_g=function(e,t,n,r){var a=t.trackNumber,i=t.add,o=t.fromParam,s=t.toParam,c=(t.isTime,n[a]),u=r[a];if(u){var l=void 0,f=e.stepData[s+"Parameter"],h=-32,d=32;if(void 0===c||0===c.length){if("transpose"!==o)return!1;if(u.notesTriggered){l=Fg(u.notesTriggered);var p=u.notesTriggered[l];if(void 0===l||p<2)return!1;l=parseFloat(l)}}else{var v=c[0];if(t.isTime)return e.time=v.time,!0;var m=v.stepData[o+"Parameter"];if(void 0===m||void 0===f)return!1;l=m.get(),h=m.min,d=m.max}var y=(l-h)/(d-h),b=f.min+y*(f.max-f.min);f.set(i?f.get()+b:b)}},Dg=function(e,t,n,r){if(0===t.length)return e;var a=t[0].subSequence;a.midiEffects.onNewStep();var i={};for(var o in e){var s=e[o],c=t[o];c&&c.isFrozen&&c.skipMidiMaster||c&&c.skipMidiMaster?(i[c.trackNumber]||(i[c.trackNumber]=[]),i[c.trackNumber]=s):s.forEach(function(e){return a.midiEffects.input(e)})}var u,l=Mg(a.midiEffects.output(n,r,r));try{for(l.s();!(u=l.n()).done;){var f=u.value;if(f.stepData&&f.stepData.track){var h=f.stepData.track.trackNumber;if(void 0===h)continue;i[h]||(i[h]=[]),i[h].push(f)}}}catch(d){l.e(d)}finally{l.f()}return i},Fg=function(e){var t=-4,n=void 0;for(var r in e)t<e[r]&&(n=r,t=e[r]);return n},Lg=n(240);function Bg(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return zg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zg(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function zg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Jg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Vg=new re.a.Time("32n"),Hg=n(34),Ug=n(62),Gg=n(580),Wg=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];for(var r in Object(o.a)(this,e),this.name=t,this.id=Object(q.uuid)(),this.patterns=n,this.algorithmTypes=[],this.durationPercentages=[],n)this.algorithmTypes.push(Gg.d),this.durationPercentages.push(100)}return Object(s.a)(e,[{key:"deleteSubSequence",value:function(e){this.patterns.splice(e,1)}},{key:"getJson",value:function(){return{name:this.name,patterns:this.patterns,algorithmTypes:this.algorithmTypes,durationPercentages:this.durationPercentages}}}]),e}();function Kg(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Qg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qg(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Qg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Zg=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t,this.scenes=[]}return Object(s.a)(e,[{key:"subSequences",get:function(){return this.sequencerEngine.subSequences}},{key:"state",get:function(){return this.sequencerEngine.state}},{key:"newScene",value:function(){var e,t="Scene "+(this.scenes.length+1),n=[],r=Kg(this.subSequences);try{for(r.s();!(e=r.n()).done;){var a=e.value;n.push(a.tracks[0].currentPattern)}}catch(o){r.e(o)}finally{r.f()}var i=new Wg(t,n);this.scenes=[].concat(Object(h.a)(this.scenes),[i]),this.sequencerEngine.dispatch(Object(J.od)(this.scenes)),this.sequencerEngine.dispatch(Object(J.hb)(i))}},{key:"moveScene",value:function(e,t){var n=Object(Un.b)(e,t,this.scenes);this.scenes=Object.keys(n).map(function(e){return n[e]}),this.sequencerEngine.dispatch(Object(J.od)(Object(h.a)(this.scenes)))}},{key:"deleteSubSequence",value:function(e){this.scenes.forEach(function(t){return t.patterns.splice(e,1)}),this.scenes.forEach(function(t){return t.algorithmTypes.splice(e,1)}),this.scenes.forEach(function(t){return t.durationPercentages.splice(e,1)})}},{key:"newSubSequence",value:function(){this.scenes.forEach(function(e){return e.patterns.push(0)}),this.scenes.forEach(function(e){return e.algorithmTypes.push(Gg.d)}),this.scenes.forEach(function(e){return e.durationPercentages.push(100)})}},{key:"deleteScene",value:function(e){var t=this.scenes.indexOf(e);this.scenes.splice(t,1),this.sequencerEngine.dispatch(Object(J.od)(Object(h.a)(this.scenes))),this.sequencerEngine.dispatch(Object(J.hb)(void 0))}},{key:"switchToScene",value:function(e){if(e){for(var t in this.subSequences){var n=this.subSequences[t],r=e.patterns[t];this.sequencerEngine.switchToPattern(r,!1,n)}this.sequencerEngine.dispatch(Object(J.hb)(e))}}},{key:"currentScene",get:function(){return this.state.sequencer.currentScene}},{key:"onNewStep",value:function(e){var t=this.currentScene;if(!(void 0===t||e<=1))for(var n in t.algorithmTypes){var r=this.subSequences[n],a=t.algorithmTypes[n],i=t.durationPercentages[n];if(e%Math.round(r.length*i/100)===0&&r.tracks[0]){var o=r.tracks[0].currentPattern,s=r.tracks[0].patterns.length;switch(a){case Gg.b:this.sequencerEngine.switchToPattern((o+1)%s,!1,r,!0);continue;case Gg.c:(o-=1)<0&&(o=s-1),this.sequencerEngine.switchToPattern(o,!1,r,!0);continue;case Gg.a:var c=Math.random();if(c<.5)continue;c<.75?this.sequencerEngine.switchToPattern((o+1)%s,!1,r,!0):((o-=1)<0&&(o=s-1),this.sequencerEngine.switchToPattern(o,!1,r,!0))}}}}},{key:"getJson",value:function(){return this.scenes.map(function(e){return e.getJson()})}},{key:"fromJson",value:function(e){var t,n=Kg(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=new Wg(r.name,r.patterns);r.algorithmTypes&&(a.algorithmTypes=r.algorithmTypes),r.durationPercentages&&(a.durationPercentages=r.durationPercentages),this.scenes.push(a)}}catch(i){n.e(i)}finally{n.f()}this.sequencerEngine.dispatch(Object(J.od)(Object(h.a)(this.scenes)))}}]),e}();function Yg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}n(622);var $g=n(36),Xg=function(){function e(){Object(o.a)(this,e),this.trackToSlices={},this.trackToTransposes={}}return Object(s.a)(e,[{key:"clear",value:function(){this.trackToSlices={},this.trackToTransposes={}}},{key:"addTrackSlice",value:function(e,t,n){void 0===n?e in this.trackToSlices?this.trackToSlices[e].add(t):this.trackToSlices[e]=new Set([t]):e in this.trackToTransposes?this.trackToTransposes[e].add(n):this.trackToTransposes[e]=new Set([n])}},{key:"deleteTrack",value:function(e){e in this.trackToSlices&&delete this.trackToSlices[e],e in this.trackToTransposes&&delete this.trackToTransposes[e]}},{key:"removeTrackSlice",value:function(e,t,n){if(void 0!==n){var r=this.trackToTransposes[e];void 0===r||(r.size<=1?delete this.trackToTransposes[e]:this.trackToTransposes[e].delete(n))}else{var a=this.trackToSlices[e];void 0===a||(a.size<=1?delete this.trackToSlices[e]:this.trackToSlices[e].delete(t))}}},{key:"getTrackSlicesRolling",value:function(e){var t=e.trackNumber,n=[];return(this.trackToTransposes[t]||[]).forEach(function(e){return n.push(new eO(parseInt(t),0,e))}),(this.trackToSlices[t]||[]).forEach(function(e){return n.push(new eO(parseInt(t),e,void 0))}),n}},{key:"getTriggerTimes",value:function(e,t){return Object(Lg.a)(e,t)}},{key:"getTrackRollEffectIfAny",value:function(e){for(var t in e.liveEffects.effects){var n=e.liveEffects.effects[t];if(n.effect===qe.f)return n}}},{key:"getTriggers",value:function(e,t,n){var r=this.getTrackRollEffectIfAny(n);if(r){var a=r.rollFactor;(t=t.getCopy()).resolution*=a}var i=this.getTriggerTimes(e,t),o=[];return 0==i.length?o:(this.getTrackSlicesRolling(n).forEach(function(e){return i.forEach(function(t){return o.push(new tO(e,t.time,t.step))})}),o)}}]),e}(),eO=function e(t,n,r){Object(o.a)(this,e),this.trackNumber=t,this.sliceNumber=n,this.transpose=r},tO=function e(t,n,r){Object(o.a)(this,e),this.trackSlice=t,this.time=n,this.step=r},nO=Xg,rO=(n(271),function(){function e(t){Object(o.a)(this,e),this.type=t}return Object(s.a)(e,[{key:"execute",value:function(e){}}]),e}());function aO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var iO=function(e){Object(u.a)(n,e);var t=aO(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this,ng)).sequencerEngine=e,a.resolution=r,a}return Object(s.a)(n,[{key:"execute",value:function(e){var t=this,n=oO.filter(function(e){return e.isTriplet===t.resolution.isTriplet}),r=127/n.length,a=Math.floor(e/r);a>=n.length&&(a=n.length-1);var i=n[a];this.sequencerEngine.resolution.equals(i)||(this.sequencerEngine.resolution=i)}}]),n}(rO),oO=[new ua.a(4,!1),new ua.a(4,!0),new ua.a(8,!1),new ua.a(8,!0),new ua.a(16,!1),new ua.a(16,!0),new ua.a(32,!1),new ua.a(32,!0)],sO=iO,cO=function(){function e(){Object(o.a)(this,e),this.parameterLocks=[]}return Object(s.a)(e,[{key:"addParameterLock",value:function(e,t,n,r,a){this.parameterLocks.push(new uO(e,t,n,r,a))}},{key:"deleteParameterLock",value:function(e){var t=this.parameterLocks.indexOf(e);t>-1&&this.parameterLocks.splice(t,1)}},{key:"fromJson",value:function(e,t){for(var n in e){var r=e[n],a=void 0===r.effectNumber?this.getTrackParameterFromJson(r,t):this.getEffectParameterFromJson(r,t);void 0!==a&&this.parameterLocks.push(new uO(r.trackNumber,r.groupNumber,r.sendNumber,r.effectNumber,a))}}},{key:"getTrackParameterFromJson",value:function(e,t){var n=e.trackNumber;if(void 0!==n){var r=t.tracks[n].trackData,a=e.parameter.name,i=r.parameters.filter(function(e){return e.name===a});if(!(i.length<1)){var o=i[0];return o.min=e.parameter.min,o.max=e.parameter.max,o}}}},{key:"getEffectParameterFromJson",value:function(e,t){var n=void 0;if(void 0!==e.trackNumber)n=t.tracks[e.trackNumber].effects[e.effectNumber];else if(void 0!==e.groupNumber){var r=t.groups.groups[e.groupNumber];if(void 0===r)return;n=r.effects[e.effectNumber]}else if(void 0!==e.sendNumber){n=t.sends.sends[e.sendNumber].effects[e.effectNumber]}if(void 0!==n){var a=e.parameter.name,i=n.parameters.filter(function(e){return e.name===a});if(!(i.length<1)){var o=i[0];return o.min=e.parameter.min,o.max=e.parameter.max,o}}}},{key:"getJson",value:function(){return this.parameterLocks.map(function(e){return e.getJson()})}}]),e}(),uO=function(){function e(t,n,r,a,i){Object(o.a)(this,e),this.trackNumber=t,this.sendNumber=r,this.groupNumber=n,this.effectNumber=a,this.parameter=i}return Object(s.a)(e,[{key:"getJson",value:function(){var e={parameter:this.parameter.getJson(),effectNumber:this.effectNumber};return void 0!==this.trackNumber&&(e.trackNumber=this.trackNumber),void 0!==this.groupNumber&&(e.groupNumber=this.groupNumber),void 0!==this.sendNumber&&(e.sendNumber=this.sendNumber),e}}]),e}(),lO=cO,fO=(n(66),n(67),new Hg.a(0),n(611));function hO(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return dO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dO(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function dO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var vO=function(e){Object(u.a)(n,e);var t=pO(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Object(o.a)(this,n),(r=t.call(this,e,"recorder-processor")).counter_=0,r.port.onmessage=function(e){return r.handleMessage_(e)},r.chunks=[],r.sendChannelCount(a),r.maxChunks=30,r.times=[],r.startedAt=void 0,r}return Object(s.a)(n,[{key:"_getBuffer",value:function(){var e,t=0,n=hO(this.chunks);try{for(n.s();!(e=n.n()).done;){t+=e.value.recLength}}catch(d){n.e(d)}finally{n.f()}for(var r=[],a=0;a<2;a++){var i,o=new Float32Array(t),s=0,c=hO(this.chunks);try{for(c.s();!(i=c.n()).done;){var u=i.value;if(!u.buffers[a])return;var l,f=hO(u.buffers[a]);try{for(f.s();!(l=f.n()).done;){var h=l.value;o.set(h,s),s+=h.length}}catch(d){f.e(d)}finally{f.f()}}}catch(d){c.e(d)}finally{c.f()}r.push(o)}return r}},{key:"mergeBuffers",value:function(e,t){for(var n=new Float32Array(t),r=0,a=0;a<e.length;a++)n.set(e[a],r),r+=e[a].length;return n}},{key:"clear",value:function(){this.times=[],this._startedAt=void 0,this.startedAt=void 0,this.chunks=[],this.port.postMessage({message:"clear",contextTimestamp:this.context.currentTime})}},{key:"sendChannelCount",value:function(e){this.port.postMessage({message:"channel-count",count:e,contextTimestamp:this.context.currentTime})}},{key:"flush",value:function(){this.port.postMessage({message:"flush",contextTimestamp:this.context.currentTime})}},{key:"record",value:function(){this.recording=!0,this.startedAt=re.a.now(),this._startedAt=void 0,console.log("record()"),this.port.postMessage({message:"record",contextTimestamp:this.context.currentTime})}},{key:"stop",value:function(){this.recording=!1,console.log("stop()"),this.port.postMessage({message:"stop",contextTimestamp:this.context.currentTime})}},{key:"getBuffer",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n){var r,i,o;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.startSliceTime=e._startedAt?e._startedAt-e.startedAt:0,(new Date).getTime(),e.chunks){t.next=4;break}return t.abrupt("return",void 0);case 4:return e.flushEndTime=e.context.currentTime,e.waitingForFlush=n,e.flush(),e.recording=!1,t.next=10,e.sleep(1500);case 10:e.waitingForFlush&&(e.waitingForFlush=void 0,r=e._startedAt||e.startedAt,i=new Worker(window.isNFT?"mergerWorker.js":"/mergerWorker.js"),o=e.flushEndTime,i.onmessage=function(t){e.chunks=[],e.buffer=void 0,n({buffer:t.data,startTime:r,endTime:o})},i.postMessage({chunks:e.chunks,isMobile:!1}));case 11:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"sleep",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){setTimeout(function(){e()},t)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveChunk",value:function(e){if(this.chunks.length>=this.maxChunks){this.chunks.splice(0,1);var t=this.times.splice(0,1);this._startedAt=t[0]}0===this.chunks.length&&this.checkSilence(e.buffers),this.chunks.push(e),this.times.push(re.a.now())}},{key:"checkSilence",value:function(e){var t,n=0,r=hO(e[0]);try{for(r.s();!(t=r.n()).done;){var a,i=hO(t.value);try{for(i.s();!(a=i.n()).done;){if(0!==a.value)break;n++}}catch(o){i.e(o)}finally{i.f()}}}catch(o){r.e(o)}finally{r.f()}this.silenceLength=n/44100}},{key:"handleMessage_",value:function(e){var t=this,n=e.data.message;if("get_buffer"===n.type)this.buffer=n.data;else if(("chunk"===n.type||"flush"===n.type)&&(this.saveChunk(n.data),"flush"===n.type)){var r=this.waitingForFlush,a=this._startedAt||this.startedAt,i=new Worker(window.isNFT?"mergerWorker.js":"/mergerWorker.js"),o=this.flushEndTime;i.onmessage=function(e){t.chunks=[],t.buffer=void 0,r({buffer:e.data,startTime:a,endTime:o})},i.postMessage({chunks:this.chunks,isMobile:!1}),this.waitingForFlush=!1}}}]),n}(Object(fO.a)(AudioWorkletNode));function mO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var yO=function(e){return function(e){Object(u.a)(n,e);var t=mO(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"startMetering",value:function(e){var t=this;this.meterInterval=setInterval(function(){var n=t.getMeter().getLevel();e.sendMessage("level",n<-80?0:Math.pow((n+80)/86,2))},20)}},{key:"startStereoWaveforming",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"stereo levels";this.meterInterval2=setInterval(function(){var r=t.getStereoWaveforms(),a=Object(v.a)(r,2),i=a[0],o=a[1];e.sendMessage(n,[i.getValue(),o.getValue()])},20)}},{key:"startWaveforming",value:function(e){var t=this;this.meterInterval2=setInterval(function(){var n=t.getWaveform().getValue();e.sendMessage("level",n)},20)}},{key:"startFFTing",value:function(e){var t=this;this.meterInterval3=setInterval(function(){var n=t.getFFT().getValue();e.sendMessage("level",n)},20)}},{key:"stopMetering",value:function(){clearInterval(this.meterInterval),clearInterval(this.meterInterval2),clearInterval(this.meterInterval3)}},{key:"getMeter",value:function(){}},{key:"getWaveform",value:function(){}},{key:"getFFT",value:function(){}}]),n}(e)};function bO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var gO=function(e){Object(u.a)(n,e);var t=bO(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this)).sequencerEngine=e,r.output=new re.a.Volume,r.input=new re.a.Gain(1),r.meter=new re.a.Meter(.9),r.waveform=new re.a.Analyser({type:"waveform",size:512}),r.leftWaveform=new re.a.Analyser({type:"waveform",size:512}),r.rightWaveform=new re.a.Analyser({type:"waveform",size:512}),r.fft=new re.a.Analyser({type:"fft",size:256}),r.output.connect(r.meter),r.splitter=new re.a.Split,r.output.connect(r.splitter),r.splitter.left.connect(r.leftWaveform),r.splitter.right.connect(r.rightWaveform),r.output.connect(r.waveform),r.output.connect(r.fft),r.effectsChain=new Y.a(r.input,r.output,(new X.a).forSend(Object(c.a)(r)),e),r.effectsChain.setupEffects(),r}return Object(s.a)(n,[{key:"getMeter",value:function(){return this.meter}},{key:"getWaveform",value:function(){return this.waveform}},{key:"getStereoWaveforms",value:function(){return[this.leftWaveform,this.rightWaveform]}},{key:"getFFT",value:function(){return this.fft}},{key:"getJson",value:function(){return this.effectsChain.getJson()}},{key:"fromJson",value:function(e){this.effectsChain.clear(),this.effectsChain.fromJson(e,this.sequencerEngine.tracks)}},{key:"dispose",value:function(){this.output.dispose(),this.input.dispose(),this.effectsChain.dispose(),this.output=void 0,this.input=void 0,this.effectsChain=void 0}},{key:"disconnect",value:function(e){this.output.disconnect(e)}},{key:"connect",value:function(e){this.output.connect(e)}},{key:"addEffect",value:function(e){this.effectsChain.addEffect(e),this.effectsChain.linkEffectParameters()}},{key:"moveEffectTo",value:function(e,t){this.effectsChain.moveEffectTo(e,t)}},{key:"deleteEffect",value:function(e){this.effectsChain.deleteEffect(e)}},{key:"copyFrom",value:function(e){this.effectsChain.fromJson(e.effectsChain.getJson(),void 0,void 0,!0)}}]),n}(yO(function(){return function e(){Object(o.a)(this,e)}}())),OO=n(374),jO=n(366),kO=n(282),wO=(n(573),n(83),n(84),p.a.FilterEffect),xO=function(){function e(t,n,r){Object(o.a)(this,e),this.input=n,this.output=r,this.sequencerEngine=t,this.eq=new OO.a(t,!1),this.auxSend=new re.a.Gain(0),this.getLowEQ().frequencyParameter.set(250),this.getMidEQ().frequencyParameter.set(1e3),this.getMidEQ().qParameter.set(.9),this.getHighEQ().frequencyParameter.set(3400),this.input.connect(this.eq.effectNode),this.eq.outputNode.connect(this.auxSend),this.hp=new wO(t,!1),this.hp.hipass(),this.lp=new wO(t,!1),this.lp.lowpass(),this.hp.cutoffFrequency=0,this.lp.cutoffFrequency=3e4,this.eq.connect(this.hp.effectNode),this.hp.connect(this.lp.effectNode),this.lp.connect(this.output)}return Object(s.a)(e,[{key:"resetFilters",value:function(){this.hp.cutoffFrequency=0,this.lp.cutoffFrequency=3e4}},{key:"filter",set:function(e){if(e>=.5){var t=(e-.5)/.5;this.hp.cutoffFrequency=1e4*Math.pow(t,4)+5,this.lp.cutoffFrequency=30040}else{var n=e/.5;this.hp.cutoffFrequency=5,this.lp.cutoffFrequency=3e4*Math.pow(n,4)+40}}},{key:"dispose",value:function(){this.eq.dispose(),this.auxSend.dispose(),this.hp.dispose(),this.lp.dispose(),this.auxSend=void 0,this.eq=void 0,this.input=void 0,this.output=void 0,this.hp=void 0,this.lp=void 0}},{key:"color",set:function(e){this.auxSend.gain.value=e}},{key:"getLowEQ",value:function(){return this.eq.equalizerPoints[0]}},{key:"getMidEQ",value:function(){return this.eq.equalizerPoints[4]}},{key:"getHighEQ",value:function(){return this.eq.equalizerPoints[7]}}]),e}(),SO=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t,this.isMulti=!1,this.lazyConnections=[],this.ctxt=re.a.Master.context._context,this.ctxt.destination.maxChannelCount>=2&&(this.ctxt.destination.channelCount=this.ctxt.destination.maxChannelCount,this.ctxt.destination.channelCountMode="explicit",this.ctxt.destination.channelInterpretation="discrete"),this.masterChannel=new gO(t),this.stereoOnly=t.stereoOnly,this.maxChannel=0,this.stereoConnected=!0,this.masterChannel.connect(re.a.Master),this.outputConnections=[],this.stereoOnly,this.setupAudioWorklet()}return Object(s.a)(e,[{key:"channelCount",get:function(){return this.multiMerger.numberOfInputs}},{key:"updateChannelCount",value:function(){re.a.Master.context._context.destination.maxChannelCount>=2&&(this.ctxt.destination.channelCount=this.ctxt.destination.maxChannelCount,this.ctxt.destination.channelCountMode="explicit",this.ctxt.destination.channelInterpretation="discrete")}},{key:"connectMixEffects",value:function(){this.mixEffects||(this.masterChannel.disconnect(),this.mixEffects=new xO(this.sequencerEngine,this.masterChannel.output,re.a.Master))}},{key:"dispose",value:function(){this.mixEffects&&this.mixEffects.dispose(),this.masterChannel.dispose(),this.masterChannel=null}},{key:"setVolume",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.05;this.masterChannel.output.volume.exponentialRampToValueAtTime(e,t),this.sequencerEngine.store.dispatch(Object(J.ic)(this.sequencerEngine.getSequenceId(),e))}},{key:"numberOfChannels",value:function(){return this.stereoConnected?2:this.ctxt.destination.channelCount}},{key:"disconnect",value:function(e,t){e.disconnect()}},{key:"switchChannelOutput",value:function(e,t,n){if(this.stereoOnly||t>=this.numberOfChannels()||n>=this.numberOfChannels())return!1;var r=this.outputConnections.find(function(t){return t.output===e});return!!r&&(r.splitter.disconnect(),r.splitter.connect(this.multiMerger,0,t),n&&r.splitter.connect(this.multiMerger,1,n),!0)}},{key:"connect",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.maxChannel;if(e.connect(this.masterChannel.input),!this.stereoOnly){var r=function(){var r=re.a.Master.context.createChannelSplitter(2);e.connect(r);var a=n%t.channelCount,i=(n+1)%t.channelCount;return r.connect(t.multiMerger,0,a),r.connect(t.multiMerger,1,i),{splitter:r,output:e,leftChannel:a,rightChannel:i}};this.isMulti?this.outputConnections.push(r()):this.lazyConnections.push(r)}return[n%32,(n+1)%32]}},{key:"switchOutputs",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isMulti=t,t?(this.stereoOnly||(void 0===this.multiMerger&&(this.stereoOnly||(this.multiMerger=re.a.Master.context.createChannelMerger(32))),this.multiMerger.connect(re.a.Master),re.a.Master.channelCount=32,this.lazyConnections.forEach(function(t){e.outputConnections.push(t())}),this.lazyConnections=[]),this.stereoConnected&&this.masterChannel.disconnect(re.a.Master)):(this.masterChannel.connect(re.a.Master),this.stereoConnected||this.stereoOnly||this.multiMerger.disconnect(re.a.Master)),this.stereoConnected=!t}},{key:"setupAudioWorklet",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("setting up audio worklet with context state=",re.a.Master.context._context.state),t=this.recorderWorklet&&this.recorderWorklet.recording,!this.sequencerEngine.isOffline&&!re.a.Master.context.isOffline){e.next=4;break}return e.abrupt("return");case 4:e.next=8;break;case 8:return n=re.a.Master.context._context,e.next=11,n.audioWorklet.addModule(window.isNFT?"RecorderWorklet.js":"/RecorderWorklet.js");case 11:this.recorderWorklet=new vO(re.a.Master.context._context,2),this.masterChannel.output.connect(this.recorderWorklet),t&&this.recorderWorklet.record();case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),PO=new(function(){function e(){Object(o.a)(this,e),this.channelMixers=[]}return Object(s.a)(e,[{key:"use",value:function(e){if(0===this.channelMixers.length||!window.explore)return new SO(e);var t=this.channelMixers.pop();return t.sequencerEngine=e,t.mixEffects&&(t.mixEffects.hp.cutoffFrequency=0,t.mixEffects.lp.cutoffFrequency=3e4),t}},{key:"release",value:function(e){this.channelMixers.push(e)}}]),e}()),EO=(n(317),{export:function(e){e===window&&(e.ssd=EO.history,e.input=EO.in,e.ternary=EO.switch,delete EO.history,delete EO.in,delete EO.switch),Object.assign(e,EO),Object.defineProperty(EO,"samplerate",{get:function(){return EO.gen.samplerate},set:function(e){}}),EO.in=e.input,EO.history=e.ssd,EO.switch=e.ternary,e.clip=EO.clamp},gen:n(112).default,abs:n(1880).default,round:n(1881).default,param:n(961).default,add:n(252).default,sub:n(203).default,mul:n(184).default,div:n(284).default,accum:n(253).default,counter:n(962).default,sin:n(1882).default,cos:n(1883).default,tan:n(1884).default,tanh:n(1885).default,asin:n(1886).default,acos:n(1887).default,atan:n(1888).default,phasor:n(318).default,phasorN:n(1889).default,data:n(202).default,peek:n(224).default,peekDyn:n(1890).default,cycle:n(1891).default,cycleN:n(1892).default,history:n(254).default,delta:n(963).default,floor:n(597).default,ceil:n(1893).default,min:n(1894).default,max:n(1895).default,sign:n(1896).default,dcblock:n(1897).default,memo:n(236).default,rate:n(1898).default,wrap:n(431).default,mix:n(1899).default,clamp:n(1900).default,poke:n(371).default,delay:n(1901).default,fold:n(1902).default,mod:n(1903).default,sah:n(1904).default,noise:n(1905).default,not:n(964).default,gt:n(965).default,gte:n(966).default,lt:n(432).default,lte:n(1906).default,bool:n(1907).default,gate:n(1908).default,train:n(1909).default,slide:n(1910).default,in:n(1911).default,t60:n(968).default,mtof:n(1912).default,ltp:n(1913).default,gtp:n(969).default,switch:n(967).default,mstosamps:n(1914).default,selector:n(1915).default,utilities:n(317).default,pow:n(1916).default,attack:n(1917).default,decay:n(1918).default,windows:n(970).default,env:n(598).default,ad:n(1919).default,adsr:n(1920).default,ifelse:n(599).default,bang:n(600).default,and:n(602).default,pan:n(1921).default,eq:n(1922).default,neq:n(601).default,exp:n(1923).default,process:n(1924).default,seq:n(1925).default});EO.gen.lib=EO;function TO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function AO(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return MO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return MO(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function MO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function RO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var CO=["Mutate","Duration"],NO=function(e){Object(u.a)(n,e);var t=RO(n);function n(e,r,a,i,s,c){var u;return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c)).controlParameters=[],u}return Object(s.a)(n,[{key:"getName",value:function(){return"Z4 Control"}},{key:"getTrackType",value:function(){return W.g}},{key:"trigger",value:function(e,t,n){if(null!==e.mutate){var r,a={},i=AO(this.controlParameters);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=o.get();if(e.mutate<0?s+=.01*e.mutate*(s-o.min):s+=.01*e.mutate*(o.max-s),s<=o.max&&s>=o.min){var c=o.set(s,!0,!0,t),u=c.id,l=c.value;a[u]=l}}}catch(f){i.e(f)}finally{i.f()}this.store.dispatch(Object(J.xb)(a))}}},{key:"triggerRelease",value:function(e){}},{key:"getStepDataParams",value:function(){return CO}}]),n}(ht),IO=qc.a.utils.padLeft("0x0",64),qO=function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/presets-backup.json");case 2:return t=e.sent,console.log(t),e.next=6,t.text();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),_O=function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o,s,c,u,l,f,h;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qO();case 2:t=(t=(t=e.sent).replaceAll("\\u0000","")).replaceAll("\\u000",""),(t=JSON.parse(t)).reverse(),t=t.slice(1200),console.log("len = ",t.length),n=400,r=0;case 11:if(!(r<t.length)){e.next=29;break}return i=t.slice(r,r+n),o=new Array(9).fill(IO),s=new Array(6).fill(IO),c=i.map(function(e){return Object(Bc.b)(e.contentHash)}),u=i.map(function(e){return qc.a.utils.fromAscii(e.title)}),l=qc.a.utils.fromAscii(te.f),f=[c,u,l,0,o,s],console.log(f),h=new Dc.a(Fc.h,"newPresets",f),e.next=23,h.execute();case 23:return e.sent,e.next=26,Object(M.a)(6e4);case 26:r+=n,e.next=11;break;case 29:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();window.migratePreset=_O;var DO=n(256);function FO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var LO=function(e){Object(u.a)(n,e);var t=FO(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this)).sequencerEngine=e,i.store=e.store,i.mixSession=r,i.context=a,i.synth=new re.a.MetalSynth,i.setupParameters(),i}return Object(s.a)(n,[{key:"getInstrumentType",value:function(){return te.e}},{key:"getName",value:function(){return"Metal Synth"}},{key:"setupParameters",value:function(){var e=this;this.frequencyParameter=new he.a("Frequency",this,function(t,n){return e.synth.frequency.value=n},{min:0,max:15e3,unit:"",defaultValue:200}),this.registerParameter(this.frequencyParameter),this.resonanceParameter=new he.a("Resonance",this,function(t,n){return e.synth.resonance=n},{min:0,max:1e4,unit:"",defaultValue:100}),this.registerParameter(this.resonanceParameter),this.harmonicityParameter=new he.a("Harmonicity",this,function(t,n){return e.synth.harmonicity=n},{min:0,max:200,unit:"",defaultValue:100}),this.registerParameter(this.harmonicityParameter),this.modulationIndexParameter=new he.a("Modulation Index",this,function(t,n){return e.synth.modulationIndex=n},{min:0,max:200,unit:"",defaultValue:20}),this.registerParameter(this.modulationIndexParameter),this.attackParameter=new he.a("Attack",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.attackParameter),this.decayParameter=new he.a("Decay",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:200}),this.registerParameter(this.decayParameter),this.sustainParameter=new he.a("Sustain",this,function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),this.registerParameter(this.sustainParameter),this.releaseParameter=new he.a("Release",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:1e3}),this.registerParameter(this.releaseParameter)}},{key:"frequency",get:function(){return this.frequencyParameter.get()},set:function(e){this.frequencyParameter.set(e)}},{key:"resonance",get:function(){return this.resonanceParameter.get()},set:function(e){this.resonanceParameter.set(e)}},{key:"harmonicity",get:function(){return this.harmonicityParameter.get()},set:function(e){this.harmonicityParameter.set(e)}},{key:"modulationIndex",get:function(){return this.modulationIndexParameter.get()},set:function(e){this.modulationIndexParameter.set(e)}},{key:"ampAttack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"ampDecay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"ampSustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"ampRelease",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"setEnvelopes",value:function(e){var t=this,n=this.getEnvelopes();n.forEach(function(e){return e.attack=new re.a.Time((1+t.ampAttack)/1e3)}),n.forEach(function(e){return e.release=new re.a.Time((1+t.ampRelease)/1e3)}),n.forEach(function(e){return e.sustain=t.ampSustain}),n.forEach(function(e){return e.decay=new re.a.Time((1+t.ampDecay)/1e3)})}},{key:"getInstrument",value:function(){return this.synth}},{key:"getEnvelopes",value:function(){return[this.synth.envelope]}},{key:"hasNotes",value:function(){return!1}},{key:"getJson",value:function(){var e=Object(d.a)({},Object(fe.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{frequency:this.frequency,resonance:this.resonance,harmonicity:this.harmonicity,modulationIndex:this.modulationIndex,ampAttack:this.ampAttack,ampDecay:this.ampDecay,ampSustain:this.ampSustain,ampRelease:this.ampRelease});return e=Object(ue.b)(e,"frequencyParameter",this.frequencyParameter),e=Object(ue.b)(e,"resonanceParameter",this.resonanceParameter),e=Object(ue.b)(e,"harmonicityParameter",this.harmonicityParameter),e=Object(ue.b)(e,"modulationIndexParameter",this.modulationIndexParameter),e=Object(ue.b)(e,"attackParameter",this.attackParameter),e=Object(ue.b)(e,"decayParameter",this.decayParameter),e=Object(ue.b)(e,"sustainParameter",this.sustainParameter),e=Object(ue.b)(e,"releaseParameter",this.releaseParameter)}},{key:"fromJson",value:function(e){this.frequency=e.frequency,this.resonance=e.resonance,this.harmonicity=e.harmonicity,this.modulationIndex=e.modulationIndex,this.ampAttack=e.ampAttack,this.ampDecay=e.ampDecay,this.ampSustain=e.ampSustain,this.ampRelease=e.ampRelease,Object(ue.a)(e,"frequencyParameter",this.frequencyParameter),Object(ue.a)(e,"resonanceParameter",this.resonanceParameter),Object(ue.a)(e,"modulationIndexParameter",this.modulationIndexParameter),Object(ue.a)(e,"harmonicityParameter",this.harmonicityParameter),Object(ue.a)(e,"attackParameter",this.attackParameter),Object(ue.a)(e,"decayParameter",this.decayParameter),Object(ue.a)(e,"sustainParameter",this.sustainParameter),Object(ue.a)(e,"releaseParameter",this.releaseParameter)}}]),n}(oe);function BO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var zO=function(e){Object(u.a)(n,e);var t=BO(n);function n(e,r,a,i,s,u){var l;return Object(o.a)(this,n),(l=t.call(this,e,r,a,i,s,u)).setInstrument(new LO(r,a,(new X.a).forTrack(Object(c.a)(l)))),l}return n}(jt),JO=n(38);function VO(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return HO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return HO(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function HO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function UO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var GO=["A","B","C","D","E","F","G","H"],WO=function(){function e(t,n,r){Object(o.a)(this,e),this.sends=[],this.channelMixer=n,this.sequencerEngine=r,this.masterBus=new KO("Master Bus",void 0,void 0,void 0,r);var a=new KO("A",this.masterBus,n,0,r),i=new jO.a(r);i.enable(!0),i.setWet(1),a.addEffect(i);var s=new KO("B",this.masterBus,n,1,r),c=new kO.a(r);c.enable(!0),c.setWet(1),s.addEffect(c),this.sends.push(a),this.sends.push(s),a.setSends(this),s.setSends(this)}return Object(s.a)(e,[{key:"createNewSend",value:function(e){var t=new KO(GO[this.sends.length],this.masterBus,this.channelMixer,this.sends.length,this.sequencerEngine,e);for(var n in t.setSends(this),this.sends.push(t),this.sequencerEngine.subSequences){var r=this.sequencerEngine.subSequences[n];for(var a in r.tracks)r.tracks[a].newSend(t)}return t}},{key:"dispose",value:function(){this.sends.forEach(function(e){return e.dispose()}),this.masterBus.dispose(),this.sends=void 0}},{key:"deleteSends",value:function(e){this.sends=this.sends.filter(function(t){return!e.includes(t)}),e.map(function(e){return e.dispose()})}},{key:"getSends",value:function(){return this.sends}},{key:"getJson",value:function(){return this.sends.map(function(e){return e.getJson()})}},{key:"loadFromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=0;case 1:if(!(r<t.length)){e.next=12;break}if(i=t[r],void 0===n||void 0!==i.pad){e.next=5;break}return e.abrupt("continue",9);case 5:return o=r,(i.pad||r>=this.sends.length)&&(this.createNewSend(),o=this.sends.length-1),e.next=9,this.sends[o].fromJson(i);case 9:r++,e.next=1;break;case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"copyFrom",value:function(e){var t=this;for(var n in e.sends){var r=e.sends[n].effects.map(function(e){return e.getEffectCopy(t.sequencerEngine,!1)});this.sends[n]||this.createNewSend(),this.sends[n].replaceEffects(r)}}}]),e}(),KO=function(e){Object(u.a)(n,e);var t=UO(n);function n(e,r,a,i,s,u){var l;return Object(o.a)(this,n),(l=t.call(this)).name=e,l.sequencerEngine=s,l.sendNumber=i,l.inputVolume=new re.a.Volume(0),l.outputVolume=new re.a.Volume(0),l.muteableNode=new re.a.Volume(0),l.muteableNode.connect(l.outputVolume),l.meter=new re.a.Meter(.9),l.muteableNode.connect(l.meter),l.leftWaveform=new re.a.Analyser({type:"waveform",size:512}),l.rightWaveform=new re.a.Analyser({type:"waveform",size:512}),l.splitter=new re.a.Split,l.muteableNode.connect(l.splitter),l.splitter.left.connect(l.leftWaveform),l.splitter.right.connect(l.rightWaveform),l.pad=u,l.tracks=[],l.muted=!1,l.effectsChain=new Y.a(l.inputVolume,l.muteableNode,(new X.a).forSend(Object(c.a)(l)),s),void 0===r?l.inputVolume.connect(l.outputVolume):l.outputs=a.connect(l.outputVolume),l.sendNodes=[],l.channelMixer=a,l}return Object(s.a)(n,[{key:"getStereoWaveforms",value:function(){return[this.leftWaveform,this.rightWaveform]}},{key:"getMeter",value:function(){return this.meter}},{key:"outputNode",get:function(){return this.outputVolume}},{key:"dispose",value:function(){this.inputVolume.dispose(),this.outputVolume.dispose(),this.muteableNode.dispose(),this.effectsChain.dispose(),this.effectsChain=void 0,this.inputVolume=void 0,this.outputVolume=void 0,this.muteableNode=void 0,this.effectsChain=void 0}},{key:"newSend",value:function(e){var t=new re.a.Volume(-100);this.outputVolume.connect(t),e.connectToTrack(t),this.sendNodes.push(t)}},{key:"getSendNodes",value:function(){return this.sendNodes}},{key:"setSends",value:function(e){this.sends=e}},{key:"moveEffectTo",value:function(e,t){this.effectsChain.moveEffectTo(e,t)}},{key:"deleteEffect",value:function(e){this.effectsChain.deleteEffect(e)}},{key:"mute",value:function(e){this.muted=e,this.muteableNode.volume.value=e?-120:0}},{key:"updateEffects",value:function(){this.effectsChain.updateEffects()}},{key:"getVolume",value:function(){return this.outputVolume.volume.value}},{key:"setVolume",value:function(e){this.outputVolume.volume.value=e}},{key:"connectToTrack",value:function(e,t){(t=t||!1)&&e.disconnect(this.inputVolume),e.connect(this.inputVolume)}},{key:"getEffects",value:function(){return this.effectsChain.effects}},{key:"getName",value:function(){return this.name}},{key:"addEffect",value:function(e){this.effectsChain.addEffect(e),this.effectsChain.linkEffectParameters()}},{key:"getLastEffect",value:function(){return 0==this.effectsChain.effects.length?this.inputVolume:this.effectsChain.effects[this.effectsChain.effects.length-1]}},{key:"getJson",value:function(){return{pad:this.pad?this.pad.id:void 0,volume:this.getVolume(),effectsChain:this.effectsChain.getJson(),outputs:this.outputs}}},{key:"replaceEffects",value:function(e){var t=this;this.effectsChain.clear(),e.map(function(e){return t.effectsChain.addEffect(e)})}},{key:"effects",get:function(){return this.effectsChain.effects}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setVolume(t.volume),n=[],this.effectsChain.effects.forEach(function(e){return e.dispose()}),this.effectsChain.effects=[],n=t.effectsChain?t.effectsChain:t.effects,this.effectsJson=n,t.outputs&&(r=Object(v.a)(t.outputs,2),i=r[0],o=r[1],this.channelMixer.switchChannelOutput(this.outputNode,i,o)&&(this.outputs=[i,o])),t.pad&&(t.pad,this.padId=t.pad);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"hookupPads",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o,s=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pad){e.next=2;break}return e.abrupt("return",!0);case 2:if(this.padId){e.next=6;break}return e.next=5,this.loadEffectsJson();case 5:return e.abrupt("return",!0);case 6:t=void 0,n=VO(this.sequencerEngine.subSequences),e.prev=8,n.s();case 10:if((r=n.n()).done){e.next=19;break}if(i=r.value,!(o=i.pads.find(function(e){return e.id===s.padId}))){e.next=17;break}return this.pad=o,t=o,e.abrupt("break",19);case 17:e.next=10;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(8),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:return t&&this.sequencerEngine.switchToSubSequence(t.subSequence.id),e.next=30,this.loadEffectsJson();case 30:return t&&(this.pad.effectRack=this.effects[0],this.pad.send=this,this.pad.syncTracksToEffects(),this.pad.updateEffectRedux()),e.abrupt("return",void 0!==t);case 32:case"end":return e.stop()}},e,this,[[8,21,24,27]])}));return function(){return e.apply(this,arguments)}}()},{key:"loadEffectsJson",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._loaded){e.next=2;break}return e.abrupt("return");case 2:for(r in t=this.effectsJson,n={},t)i=Object($.b)(t[r],void 0,this.sequencerEngine,void 0,this.pad&&(new X.a).forSubSequence(this.pad.subSequence)),this.effectsChain.addEffect(i.effect),n=Object(d.a)({},n,i.bulk);this.sequencerEngine.parametersToUpdate=Object(d.a)({},this.sequencerEngine.parametersToUpdate,n),this._loaded=!0;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(yO(function(){return function e(){Object(o.a)(this,e)}}())),QO=WO,ZO=function(){function e(t){Object(o.a)(this,e),this.store=t,this.input=void 0,re.a.Master.context.isOffline||(this.setupRecording(),this.splitter=void 0,this.init(),this.deviceId=void 0)}return Object(s.a)(e,[{key:"init",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.explore&&!window.isNFT){e.next=2;break}return e.abrupt("return");case 2:if(void 0===(t=!window.isNFT&&N.a.getItem("deviceId"))){e.next=16;break}if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=7;break}return console.log("no enumerate"),e.abrupt("return");case 7:return e.next=9,navigator.mediaDevices.enumerateDevices();case 9:if(!e.sent.some(function(e){return e.deviceId===t})){e.next=16;break}return e.next=13,navigator.mediaDevices.getUserMedia({audio:{deviceId:t,echoCancellation:!1}});case 13:n=e.sent,console.log("STREAM=",n),this.newInputSource(n,t);case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getInputChannels",value:function(){return void 0===this.input?[]:[1,2]}},{key:"connect",value:function(e,t){1==t?this.splitter.left.connect(e):this.splitter.right.connect(e)}},{key:"disconnect",value:function(e,t){1==t?this.splitter.left.disconnect():this.splitter.right.disconnect()}},{key:"getRecorder",value:function(){return new window.Recorder(this.input,{numChannels:1,bufferLen:1024})}},{key:"newInputSource",value:function(e,t){this.input&&this.splitter,this.startUserMedia(e),t&&(this.deviceId=t),this.store.dispatch(Object(J.G)(t))}},{key:"startUserMedia",value:function(e){re.a.Master.context.isOffline||(this.input=this.audioContext.createMediaStreamSource(e),this.monitorVolume=new re.a.Gain(1),this.splitter=new re.a.Split,this.input.chain(this.monitorVolume,this.splitter))}},{key:"dispose",value:function(){this.splitter&&this.splitter.dispose(),this.input&&this.input.disconnect(),this.input=void 0,this.splitter=void 0}},{key:"setupRecording",value:function(){var e=this;if(!(re.a.Master.context.isOffline||window.explore||window.isNFT||window.spores)){try{window.AudioContext=re.a.Master.context,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,window.URL=window.URL||window.webkitURL,this.audioContext=re.a.Master.context}catch(t){}void 0!==navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({audio:{mandatory:{echoCancellation:!1}}}).then(function(t){return e.startUserMedia(t)}).catch(function(e){})}}}]),e}(),YO=function(){function e(){Object(o.a)(this,e),this.latency=0}return Object(s.a)(e,[{key:"getLatency",value:function(){return this.latency}},{key:"setLatency",value:function(e){this.latency=e}}]),e}(),$O=n(13),XO=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t}return Object(s.a)(e,[{key:"state",get:function(){return this.sequencerEngine.state}},{key:"execute",value:function(){}},{key:"undo",value:function(){}},{key:"roomName",get:function(){return"test"}},{key:"serialize",value:function(e,t){var n=Object(d.a)({},e);return n.payload=Object(d.a)({},n.payload),n.payload.track&&(n.payload.track.subSequence&&(n.payload.subSequence=n.payload.track.subSequence.id),n.payload.track=n.payload.track.trackNumber),n.contentId=this.getContentId(e),{type:"operation",operation:Object(d.a)({},n,{uuid:t,timestamp:Date.now()})}}},{key:"deserialize",value:function(e){var t=Object(d.a)({},e.payload);if(void 0!==t.track)if(void 0!==t.subSequence){var n=this.sequencerEngine.getSubSequence(t.subSequence);n&&(t.track=n.tracks[e.payload.track])}else t.track=this.sequencerEngine.tracks[e.payload.track];return e.payload.resolution&&(t.resolution=(new ua.a).fromJson(e.payload.resolution)),Object(d.a)({},e,{payload:t})}},{key:"deserializeStep",value:function(e,t,n){var r=new K.a;return r.track=t,r.stepNumber=n,r.loadFromJson(e,t.effects,void 0,void 0,void 0,t,t.midiEffects),r.id=e.id,r}},{key:"getStepLocations",value:function(e,t,n){var r=e.getStepNumbers(t),a=[];for(var i in r){var o=r[i][0];a.push({id:o.id,transpose:o.transpose,stepNumber:n?r[i][1]+o.position:r[i][1]})}return a}},{key:"getStepsForStepNumbers",value:function(e,t){var n=t.getEasyPattern(),r=[],a=function(t){var a=e[t],i=n.getAllSteps().find(function(e){return e.id===a.id});i&&r.push(i)};for(var i in e)a(i);return r}},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(n,e);case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"getContentId",value:function(){return 0}},{key:"getDependentActions",value:function(){return[]}},{key:"dependsOn",value:function(e){return this.getDependentActions().indexOf(e)>-1}},{key:"conflictsWith",value:function(e,t){return this.dependsOn(t.type)&&e.contentId===t.contentId}}]),e}();function ej(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var tj=function(e){Object(u.a)(n,e);var t=ej(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"serialize",value:function(e,t){var r=Object(fe.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.step=a.payload.step.getJson(),r}},{key:"deserialize",value:function(e){var t=Object(fe.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload,a=r.track;if(void 0!==a)return r.step=this.deserializeStep(r.step,a,r.stepNumber),t}}]),n}(XO);function nj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var rj=function(e){Object(u.a)(n,e);var t=nj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.step,r=e.stepNumber,a=e.resolution,i=void 0===a?Me.a.baseResolution:a,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=Math.floor(r);return t.sequencerEngine.resolution=i,t.getEasyPattern().deleteStepAtStepNumber(n,s,i,o),o?t.updateSteps():t.pattern.needsSync=!0,{}}},{key:"undo",value:function(e){new ij(this.sequencerEngine).execute(e.payload.track,e.payload.step,e.payload.stepNumber,e.payload.resolution),e.payload.track.updateSteps()}},{key:"getContentId",value:function(e){return e.payload.step.id}}]),n}(tj);function aj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ij=function(e){Object(u.a)(n,e);var t=aj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.step,r=e.stepNumber,a=e.resolution,i=void 0===a?Me.a.baseResolution:a,o=e.displayResolution,s=void 0===o?Me.a.baseResolution:o,c=e.isRecording,u=void 0===c||c,l=e.isQuantized,f=void 0===l||l,h=e.slide,d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===t)return{};var p=Math.floor(r),v=r-p;n.slide=h;var m=t.getEasyPattern();return m.addStep(n,p,i,v,void 0,void 0,u),!f&&s.isTriplet&&m.update(),d&&this.updateRedux(n,p,v,t,i,s),{}}},{key:"state",get:function(){return this.sequencerEngine.store.getState()}},{key:"updateRedux",value:function(e,t,n,r,a,i){var o=i.transformStepAtResolution2(t+n,a);n=o-(t=Math.floor(o));var s=r.subSequence.isTrack?r.subSequence.id:r.id,c=Object(h.a)(this.state.tracks.trackSteps[s]||[]),u=Object(d.a)({},this.state.tracks.trackFills[s]||[]),l=Object(h.a)(this.state.tracks.trackStepIds[s]||[]),f=this.state.tracks.trackPianoRollSteps[s]||{},p=Object(d.a)({},this.state.tracks.trackPianoRollPositions[s]),v=this.state.tracks.trackPianoRollDurations[s]||{},m=this.state.tracks.trackPatternSteps[s]||{};f[e.transpose]=Object(d.a)({},f[e.transpose]),p[e.transpose]=Object(d.a)({},p[e.transpose]),v[e.transpose]=Object(d.a)({},v[e.transpose]),u=u||new Array(c.length).fill(!1),c[t]=!0,l[t]=e,m[r.currentPattern]=Object(h.a)(c),f[e.transpose][t]=!0,p[e.transpose][t]=n;var y=new ua.a(16,!1);v[e.transpose][t]=a.transformStepAtResolution2(e.duration,y);for(var b=0;b<e.duration;b++)u[(b+t)%c.length]=!0;this.sequencerEngine.store.dispatch(Object(J.v)(s,c,f,u,l,p,v,m))}},{key:"undo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];new rj(this.sequencerEngine).execute(e.payload,t),t&&e.payload.track.updateSteps()}},{key:"getContentId",value:function(e){return e.payload.step.id}}]),n}(tj);function oj(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return sj(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sj(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function sj(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function cj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var uj=function(e){Object(u.a)(n,e);var t=cj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t,n=e.effect,r=e.parameters,a=(!(arguments.length>1&&void 0!==arguments[1])||arguments[1],{}),i=oj(r);try{for(i.s();!(t=i.n()).done;){var o=t.value;o.hasGroup&&(a[o.id]=o.hasGroup);var s=n._parameters.indexOf(o);n.unmapParameter(s)}}catch(c){i.e(c)}finally{i.f()}return{idToGroup:a}}},{key:"undo",value:function(e){var t=e.payload,n=t.parameters,r=t.idToGroup,a=t.effect;n.forEach(function(e){a.setParameter(e),r[e.id]&&(r[e.id]._parameters.push(e),e.hasGroup=r[e.id])})}}]),n}(XO),lj=n(286);function fj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hj=function(e){Object(u.a)(n,e);var t=fj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){e.effect,e.track,e.group,e.send}},{key:"undo",value:function(e){}},{key:"serialize",value:function(e,t){var r=Object(fe.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation,i=a.payload;return void 0!==i.group&&(i.group=i.group.groupNumber),void 0!==a.send&&(i.send=i.send.sendNumber),i.isMidiEffect=i.effect.isMidiEffect(),i.effect=i.effectJson,r}},{key:"deserialize",value:function(e){var t,r=Object(fe.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),a=r.payload,i=a.track||a.group||a.send;return a.isMidiEffect?void 0===(t=i.midiEffects.getEffectById(a.effect.id))&&(t=Object(lj.a)(a.effect,i)).fromJson(a.effect):void 0===(t=i.effectsChain.getEffectById(a.effect.id))&&(t=Object($a.b)(a.effect.name,this.sequencerEngine)).fromJson(a.effect,this.sequencerEngine.tracks,a.track.trackNumber),a.effect=t,r}}]),n}(XO);function dj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var pj=function(e){Object(u.a)(n,e);var t=dj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.effect,n=e.track,r=e.group,a=e.send,i=n||r||a;t.isMidiEffect()?i.midiEffects.addEffect(t):i.effectsChain.addEffect(t)}}]),n}(hj);function vj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var mj=function(e){Object(u.a)(n,e);var t=vj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.effect,n=e.track,r=e.group,a=e.send,i=n||r||a,o=t.getJson();switch(t.getEffectType()){case je.a:i.effectsChain.deleteEffect(t);break;case je.c:i.midiEffects.deleteEffect(t);break;case je.b:i.liveEffects.deleteEffect(t)}return this.sequencerEngine.selectEffect(void 0),{effectJson:o}}}]),n}(hj);function yj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var bj=function(e){Object(u.a)(n,e);var t=yj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.effect,n=e.track,r=e.group,a=e.send,i=n||r||a;t.toggleEnabled(),i&&!t.isMidiEffect()&&i.effectsChain&&i.effectsChain.updateEffects()}}]),n}(hj),gj=function(e){return e.deserialize=function(e){return Object(d.a)({},e,{operation:e})},e.serialize=function(e){return Object(d.a)({},e,{operation:e})},e.getContentId=function(e){return 1},e};function Oj(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return jj(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jj(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function jj(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var kj=function(e,t,n){for(var r in t){var a,i=Oj(t[r]);try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.node,c=o.type;e.connectInlet(r,s,c)}}catch(v){i.e(v)}finally{i.f()}}for(var u in n){var l,f=Oj(n[u]);try{for(f.s();!(l=f.n()).done;){var h=l.value,d=h.node,p=h.type;d.connectInlet(p,e,u)}}catch(v){f.e(v)}finally{f.f()}}},wj=(n(603),function(e,t,n){var r=t.state.windows,a=r.windowPositions,i=r.presentationWindowPositions,o=n?i:a,s={};for(var c in e)s[c]=o[c];return s}),xj={DELETE_PATCHER_EDGE:function(e){return gj(function(t){var n=t.sourceNode,r=t.sourceType,a=t.destNode,i=t.destType,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n=e.idToObject[n.id],a=e.idToObject[a.id],o?a.connectInlet(i,n,r):a.disconnectInlet(i,n,r)})},CONNECT_PATCHER_EDGE:function(e){return gj(function(t){var n=t.sourceNode,r=t.sourceType,a=t.destNode,i=t.destType,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n=e.idToObject[n.id],a=e.idToObject[a.id],o?a.disconnectInlet(i,n,r):a.connectInlet(i,n,r)})},DELETE_PATCHER_NODE:function(e){return gj(function(t){var n=t.node,r=t.subSequence,a=t.objectJson,i=t.inbound,o=t.outbound,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n=e.idToObject[n.id],!s){var c=n.subSequence,u=n.getJson(),l=n.getInboundNodes(),f=n.getOutboundNodes();return n.delete(),{subSequence:c,objectJson:u,inbound:l,outbound:f}}var h=r.createZObject(void 0,void 0,void 0,!1);h.fromJson(a),kj(h,i,o)})},SET_PATCHER_WINDOW_POSITIONS:function(e){return gj(function(t,n){var r=t.positions,a=t.isPresentationMode,i=t.savedPositions;if(!n){var o=wj(r,e,a);return a?e.dispatch(Object(J.N)(r)):e.dispatch(Object(J.O)(r)),{savedPositions:o}}a?e.dispatch(Object(J.N)(i)):e.dispatch(Object(J.O)(i))})}};function Sj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Pj=function(e){Object(u.a)(n,e);var t=Sj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.from,n=e.to,r=e.isMidiEffect,a=void 0!==r&&r,i=e.track,o=e.group,s=e.send,c=i||o||s;a?c.midiEffects.moveEffectTo(t,n):c.effectsChain.moveEffectTo(t,n),i&&i.updateSteps()}},{key:"undo",value:function(e){}},{key:"serialize",value:function(e,t){var r=Object(fe.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation,i=a.payload;return void 0!==i.group&&(i.group=i.group.groupNumber),void 0!==a.send&&(i.send=i.send.sendNumber),r}}]),n}(XO);function Ej(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Tj=function(e){Object(u.a)(n,e);var t=Ej(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.stepNumber,r=e.resolution,a=void 0===r?Me.a.baseResolution:r,i=t.getEasyPattern(),o=i.getStepsAtStepNumber(n,a),s=o.map(function(e){return Object(d.a)({},e,{step:e.step.getCopy()})});return i.deleteSteps(o.map(function(e){return e.step})),t.updateSteps(),{stepsDeleted:s}}},{key:"undo",value:function(e){}}]),n}(XO);function Aj(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Mj(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mj(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Mj(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Rj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Cj=0,Nj=function(e){Object(u.a)(n,e);var t=Rj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.steps,r=e.transformation,a=e.resolution,i=void 0===a?Me.a.baseResolution:a,o=e.wrap,s=void 0===o||o,c=e.isPianoRoll,u=void 0!==c&&c,l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return{};var d=t.getEasyPattern(),p=d.getStepNumbers(n,i).filter(function(e){return e[0]}),v=new Set(p.filter(function(e){return e&&e[0]}).map(function(e){return e[0].transpose})),m=t.getEasyPattern().transformSteps(n,p,r,i,s,u),y=new Set(m.filter(function(e){return e}).map(function(e){return e.transpose}));if(l)if(f){var b=++Cj;setTimeout(function(){b===Cj&&t.updateSteps(!u,!0,i.isTriplet)},50)}else u&&this.sequencerEngine.state.sequencer.displayResolution.isTriplet&&d.update(),u||i.isTriplet||t.getEasyPattern().pattern.syncMatrix(),u?this.updateReduxForRows(v,y,t,i.isTriplet):t.updateSteps(!u&&i.isTriplet,!0,i.isTriplet);var g=this.sequencerEngine.store.getState().keyboard.selectedPianoRollSteps;if(l&&!f&&g){var O=function(e){if(g[e]){var t=m.find(function(t){return t&&t.id===g[e].id});g[e]=t}};for(var j in g)O(j);this.sequencerEngine.store.dispatch(Object(J.yd)(Object(h.a)(g)))}return{stepNumbers:p}}},{key:"updateReduxForRows",value:function(e,t,n,r){if(n){var a,i=n.id,o=Object(d.a)({},this.state.tracks.trackPianoRollSteps[i]),s=Object(d.a)({},this.state.tracks.trackPianoRollPositions[i]),c=Object(d.a)({},this.state.tracks.trackPianoRollDurations[i]),u=n.getEasyPattern().pattern.getUpdateStepsAction(r),l=Aj([].concat(Object(h.a)(Array.from(e)),Object(h.a)(Array.from(t))));try{for(l.s();!(a=l.n()).done;){var f=a.value;o[f]=u.pianoRollSteps[f],c[f]=u.pianoRollDurations[f],s[f]=u.pianoRollPositions[f]}}catch(v){l.e(v)}finally{l.f()}var p=this.state.tracks.trackPatternSteps[i]||{};p[n.currentPattern]=u.steps,this.sequencerEngine.store.dispatch(Object(J.v)(i,u.steps,o,u.trackFills,u.stepToId,s,c,p))}}},{key:"undo",value:function(e){var t=Object(d.a)({},e.payload.transformation);t.stepDifference=-1*t.stepDifference,t.transposeDifference=-1*t.transposeDifference,this.execute(Object(d.a)({},e.payload,{transformation:t}))}},{key:"serialize",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r){var i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(fe.a)(Object(f.a)(n.prototype),"serialize",this).call(this,t,r),(o=i.operation).payload.steps=o.payload.steps.filter(function(e){return e}).map(function(e){return e.id}),o.payload.stepNumbers=o.payload.stepNumbers.filter(function(e){var t=Object(v.a)(e,2),n=t[0];t[1];return n}).map(function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1];return[n.id,r]}),e.abrupt("return",i);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserialize",value:function(e){var t=Object(fe.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload,a=r.track;if(void 0!==a){var i=r.steps;return r.steps=this.getStepsForStepNumbers(i.map(function(e){return{id:e}}),a,Me.a.baseResolution),t}}},{key:"getContentId",value:function(e){return e.payload.steps.map(function(e){return e&&e.id})}}]),n}(XO);function Ij(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var qj=function(e){Object(u.a)(n,e);var t=Ij(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.steps,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===t)return{stepsDeleted:[]};var a=t.getEasyPattern().getStepNumbers(n,Me.a.baseResolution);return t.getEasyPattern().deleteSteps(n),r&&t.updateSteps(),t.sequencerEngine.dispatch(Object(J.yd)(void 0)),{stepsDeleted:a}}},{key:"undo",value:function(e){var t=new ij(this.sequencerEngine),n=e.payload.stepsDeleted;for(var r in n)t.execute({track:e.payload.track,step:n[r][0],stepNumber:n[r][1],resolution:Me.a.baseResolution});e.payload.track.updateSteps()}},{key:"serialize",value:function(e,t){var r=Object(fe.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.steps=a.payload.steps.map(function(e){return e.getJson()}),a.payload.stepsDeleted=a.payload.stepsDeleted.map(function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1];return[n.getJson(),r]}),r}},{key:"deserialize",value:function(e){var t=this,r=Object(fe.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),a=r.payload,i=a.track;if(void 0!==i){var o=a.steps.map(function(e){return t.deserializeStep(e,i,e.stepNumber)});return a.steps=this.getStepsForStepNumbers(o,i,Me.a.baseResolution),r}}},{key:"getContentId",value:function(e){return e.payload.steps.map(function(e){return e&&e.id})}}]),n}(XO);function _j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Dj=function(e){Object(u.a)(n,e);var t=_j(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.steps,r=e.stepNumber,a=e.resolution,i=void 0===a?Me.a.baseResolution:a,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===t)return{steps:[]};t.instrumentTrack&&(t=t.instrumentTrack);var s=t.getEasyPattern().pattern.getStepResolutionTree(i.isTriplet).search(r,i).toggle(n&&n[0]?n[0].stepBucket.steps[0].id:void 0);return t.pattern.syncMatrix(),o&&(t.pattern.syncBucketsAtStep(r,i),t.updateSteps(void 0,!0)),t.pattern.needsSync=!0,{steps:s}}},{key:"undo",value:function(e){var t=e.payload.track.getEasyPattern();if(void 0!==e.payload.steps){var n=e.payload.resolution.isTriplet?t.pattern.tripletStepBuckets:t.pattern.stepBuckets;for(var r in e.payload.steps){var a=e.payload.steps[r];n[a.stepNumber]=a.stepBucket}}t.update(e.payload.resolution.isTriplet),e.payload.track.updateSteps()}},{key:"serialize",value:function(e,t){var r=Object(fe.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.steps&&(a.payload.steps=a.payload.steps.map(function(e){return Object(d.a)({},e,{stepBucket:e.stepBucket.getJson()})})),r}},{key:"deserialize",value:function(e){var t=Object(fe.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload;if(void 0!==r.track){var a=r.track,i=[];if(e.payload.steps)for(var o in e.payload.steps){var s=e.payload.steps[o],c=s.stepBucket,u=s.stepNumber,l=new Q.a(a,c.isTriplet);for(var h in c){var d=c[h],p=new K.a;p.track=a,p.stepNumber=u,p.loadFromJson(d,a.effects,void 0,void 0,void 0,a,a.midiEffects),p.id=d.id,l.steps[h]=p}i.push({stepNumber:u,stepBucket:l})}return r.steps=i,t}}},{key:"getContentId",value:function(e){return e.payload.steps[0].id}}]),n}(XO);function Fj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Lj=function(e){Object(u.a)(n,e);var t=Fj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.patternNumber,n=this.sequencerEngine.tracks.map(function(e){return e.patterns[t]});return this.sequencerEngine.deletePattern(t),{patterns:n,patternNumber:t}}},{key:"undo",value:function(e){var t=e.payload.patterns,n=e.payload.patternNumber;for(var r in t){var a=this.sequencerEngine.tracks[r],i=a.patterns.slice(0,n).concat([t[r]]).concat(a.patterns.slice(n));a.patterns=i,a.switchToPattern(a.currentPattern),a.updateSteps()}this.sequencerEngine.store.dispatch(Object(J.sc)(this.sequencerEngine.numberOfPatterns()))}}]),n}(XO);function Bj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var zj=function(e){Object(u.a)(n,e);var t=Bj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.track,r=e.step,a=e.stepNumber,i=e.resolution,o=void 0===i?Me.a.baseResolution:i,s=e.displayResolution,c=void 0===s?Me.a.baseResolution:s,u=e.isQuantized,l=void 0===u||u,h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(fe.a)(Object(f.a)(n.prototype),"execute",this).call(this,{track:t,step:r,stepNumber:a,resolution:o,isRecording:!0,displayResolution:c,isQuantized:l},h)}}]),n}(ij);function Jj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Vj=0,Hj=function(e){Object(u.a)(n,e);var t=Jj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.track,n=(e.step,e.parameter),r=e.value,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=n.get();if(n.set(r),a)if(i){var s=++Vj;setTimeout(function(){s===Vj&&t.updateSteps()},50)}else t.updateSteps();return{previousValue:o}}},{key:"state",get:function(){return this.sequencerEngine.store.getState()}},{key:"undo",value:function(e){var t=e.payload;this.execute(Object(d.a)({},t,{value:t.savedValue}))}},{key:"serialize",value:function(e,t){var r=Object(fe.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.step=a.payload.step.id,a.payload.parameter=a.payload.parameter.name,r}},{key:"deserialize",value:function(e){var t=Object(fe.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload,a=r.track;if(void 0!==a&&(r.step=this.getStepsForStepNumbers([{id:r.step}],a)[0],void 0!==r.step))return r.parameter=r.step.parameters.find(function(e){return e.name===r.parameter}),t}},{key:"getContentId",value:function(e){return[e.payload.parameter.id,e.payload.step.id]}}]),n}(XO);function Uj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Gj=function(e){Object(u.a)(n,e);var t=Uj(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"serialize",value:function(e,t){var r=Object(fe.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation.payload;if(a.parameter){var i=a.parameter,o=i.id,s=i.context,c=i.name;a.parameter={id:o,context:s&&s.getJson(),name:c}}if(a.automation){var u=a.automation.parameter;u&&(a.parameter=u.getJson()),a.automation=a.automation.id}return r}},{key:"deserialize",value:function(e){var t=Object(fe.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload,a=r.parameter,i=(a.id,a.name),o=a.context;if(void 0!==o.track&&(r.track=this.sequencerEngine.tracks[o.track]),void 0!==o.subTrack&&(r.track=r.track.tracks[o.subTrack].track),void 0!==o.midiEffect){if(r.track){var s=r.track.midiEffects.effects[o.midiEffect].parameters.find(function(e){return e.name===i});r.parameter=s||void 0}}else if(void 0!==o.effect&&-1!==o.effect){if(r.track){var c=r.track.effects[o.effect];o.subDevice&&(c=c.getSubDevice(o.subDevice)),o.macro&&(c=c.macros.find(function(e){return e.id===o.macro}));var u=c.getParameters().find(function(e){return e.name===i});r.parameter=u||void 0}}else if(o.isInstrument)if(r.instrument=r.track.instrument,o.subDevice){var l=r.instrument.getSubDevice(o.subDevice);r.parameter=l.parameters.find(function(e){return e.name===i})}else r.parameter=r.instrument.parameters.find(function(e){return e.name===i});else r.parameter=void 0;return r.automation&&r.parameter&&(r.automation=r.parameter.unlockedAutomation),t}},{key:"getContentId",value:function(e){var t=e.payload;return t.point?t.point.id:t.parameter?t.parameter.id:0}}]),n}(XO);function Wj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Kj=function(e){Object(u.a)(n,e);var t=Wj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.parameter,n=e.value,r=e.automation,a=void 0!==r&&r,i=e.isBulk,o=void 0!==i&&i;void 0!==t&&t.set(n,a,o)}},{key:"undo",value:function(e){var t=e.payload;t.parameter.set(t.savedValue)}},{key:"getContentId",value:function(e){return e.payload.parameter.id}}]),n}(Gj);function Qj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Zj=function(e){Object(u.a)(n,e);var t=Qj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.steps,r=e.resolution,a=void 0===r?Me.a.baseResolution:r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=t.getEasyPattern(),s=o.getStepNumbers(n,a);for(var c in s){var u=s[c][0];u&&(s[c][1]=s[c][1]+u.position,s[c][0]=u.id)}var l=this.getStepLocations(o,n,!0);o.snapToGrid(n,a);var f=this.getStepLocations(o,n,!1);for(var h in f)f[h].stepDifference=f[h].stepNumber-l[h].stepNumber,f[h].transposeDifference=f[h].transpose-l[h].transpose;return i&&(a.isTriplet?t.updateSteps(void 0,void 0,!0):t.updateSteps()),{stepNumbers:s,stepLocations:f}}},{key:"undo",value:function(e){var t=e.payload,n=t.stepNumbers,r=t.steps,a=t.track,i=t.resolution,o=a.getEasyPattern().getStepNumbers(r,i),s=new Nj(this.sequencerEngine);for(var c in o){var u=o[c][1],l=n[c][1],f=(r[c],{stepDifference:l-u,transposeDifference:0});s.execute({track:a,steps:r,transformation:f,resolution:i})}}},{key:"serialize",value:function(e,t){var r=Object(fe.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.steps=a.payload.steps.map(function(e){return e.getJson()}),r}},{key:"deserialize",value:function(e){var t=this,r=Object(fe.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),a=r.payload,i=a.track;if(void 0!==i){var o=a.steps.map(function(e){return t.deserializeStep(e,i,e.stepNumber)});return a.steps=this.getStepsForStepNumbers(o,i,Me.a.baseResolution),r}}},{key:"getContentId",value:function(e){return e.payload.steps.map(function(e){return e.id})}}]),n}(XO);function Yj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var $j=function(e){Object(u.a)(n,e);var t=Yj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.value;t&&!isNaN(n)&&t.setVolume(n)}}]),n}(XO);function Xj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ek=function(e){Object(u.a)(n,e);var t=Xj(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.mute;t&&t.mute(n)}}]),n}(XO);function tk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var nk=function(e){Object(u.a)(n,e);var t=tk(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.step,r=e.value,a=e.pointId;return{point:t.addBreakPoint(n,r,a)}}},{key:"undo",value:function(e){var t=e.payload;t.automation.removeBreakPoint(t.point)}}]),n}(Gj);function rk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ak=function(e){Object(u.a)(n,e);var t=rk(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.point;t.removeBreakPoint(n)}},{key:"undo",value:function(e){var t=e.payload;t.automation.addBreakPoint(t.point.step,t.point.value,t.point.id)}}]),n}(Gj);function ik(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ok=function(e){Object(u.a)(n,e);var t=ik(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.points;t.removeBreakPoints(n)}},{key:"undo",value:function(e){var t=e.payload,n=t.automation;t.points.forEach(function(e){return n.addBreakPoint(e.step,e.value,e.id)})}}]),n}(Gj);function sk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ck=function(e){Object(u.a)(n,e);var t=sk(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.point,r=e.step,a=e.value;t.movePoint(n,r,a)}},{key:"undo",value:function(e){var t=e.payload;this.execute(Object(d.a)({},t,{step:t.savedStep,value:t.savedValue}))}}]),n}(Gj);function uk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var lk=function(e){Object(u.a)(n,e);var t=uk(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.points,r=e.stepDiff,a=e.valueDiff;t.movePoints(n,r,a)}}]),n}(Gj);function fk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hk=function(e){Object(u.a)(n,e);var t=fk(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.point,r=n.getJson?n.getJson():n;return t.quantizePoint(n),{savedPoint:r}}},{key:"undo",value:function(e){var t=e.payload;t.automation.movePoint(t.point,t.savedPoint.step,t.savedPoint.value)}}]),n}(Gj);function dk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function pk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var vk=function(e){Object(u.a)(n,e);var t=pk(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.value,r=e.oldValue;return{points:t.record(n,r),automation:t}}},{key:"undo",value:function(e){var t=e.payload;t.points.forEach(function(e){return t.automation.removeBreakPoint(e)})}}]),n}(function(e){Object(u.a)(n,e);var t=dk(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"serialize",value:function(e,t){var r=Object(fe.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t);if(void 0===(e=e.payload))return r;var a=e.automation;if(void 0===a)return r;var i=a.parameter;return r.automation=a.id,r.parameter=i,r}},{key:"deserialize",value:function(e){var t=Object(fe.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e);t.payload;return t}}]),n}(XO));function mk(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return yk(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yk(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function yk(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var gk=function(e){Object(u.a)(n,e);var t=bk(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.tracks,n=e.patternToLoad,r=[],a=1;this.sequencerEngine.tracks.length>0&&(a=this.sequencerEngine.tracks[0].patterns.length),this.sequencerEngine.loadLFOsAndEnvelopes(t[0]);var i,o=mk(t);try{for(o.s();!(i=o.n()).done;){var s=i.value;r.push(Aa(Object(d.a)({},s,{subSequence:this.sequencerEngine.currentSubSequence,sequencerEngine:this.sequencerEngine,tracks:this.sequencerEngine.tracks,numPatterns:a,patternToLoad:n})))}}catch(u){o.e(u)}finally{o.f()}var c=this.sequencerEngine;return Promise.all(r).then(function(e){var t=c.groups.newGroup();e.forEach(function(e){var n=c.tracks.length;c.setupNewTrack(e,void 0,!0,!1),e.setupEffects(),e.trackNumber=n,t.addTrack(e)}),c.updateTracks(!0)}),{addedTracks:r}}},{key:"undo",value:function(e){var t=this,n=e.payload;Promise.all(n.addedTracks).then(function(e){t.sequencerEngine.deleteTracks(e),t.sequencerEngine.updateTracks()})}}]),n}(XO);function Ok(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var jk=function(e){Object(u.a)(n,e);var t=Ok(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.track,r=t.preset,i=t.loadMods,o=t.loadEffects,s=t.interpolation,c=this.sequencerEngine.getTrackPreset(n.trackNumber),u=n.preset?n.preset.name:void 0,l=n.preset,console.log("AUDITION PRESET OP"),e.next=7,this.sequencerEngine.auditionPreset(r,n.trackNumber,i,o,!0,s);case 7:return e.abrupt("return",{presetJson:c,presetName:u,savedPreset:l});case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"undo",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,r=n.track,i=n.presetJson,o=n.presetName,s=n.savedPreset,e.next=4,this.sequencerEngine.auditionPreset({data:i,presetName:o},r.trackNumber,!0,!0,!1);case 4:r.presetName=o,s&&(r.preset=s,r.preset.name=o);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),n}(XO);function kk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wk=function(e){Object(u.a)(n,e);var t=kk(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e.sourceNode,n=e.sourceType,r=e.destNode,a=e.destType;return r.connectInlet(a,t,n),{}}},{key:"undo",value:function(e){var t=e.payload,n=t.sourceNode,r=t.sourceType,a=t.destNode,i=t.destType;a.disconnectInlet(i,n,r)}}]),n}(XO),xk=function(){function e(t){Object(o.a)(this,e),this.addStepAction=new ij(t),this.deleteStepAction=new rj(t),this.deleteStepNumberAction=new Tj(t),this.moveStepsAction=new Nj(t),this.deleteStepsAction=new qj(t),this.toggleStepAction=new Dj(t),this.deletePatternAction=new Lj(t),this.recordStepAction=new zj(t),this.updateStepParameterAction=new Hj(t),this.addEffectAction=new pj(t),this.deleteEffectAction=new mj(t),this.toggleEffectAction=new bj(t),this.moveEffectAction=new Pj(t),this.updateParameterAction=new Kj(t),this.updateTrackVolumeAction=new $j(t),this.updateTrackMuteAction=new ek(t),this.addAutomationBreakPointAction=new nk(t),this.removeAutomationBreakPointAction=new ak(t),this.removeAutomationBreakPointsAction=new ok(t),this.moveAutomationBreakPointAction=new ck(t),this.moveAutomationBreakPointsAction=new lk(t),this.snapToGridAction=new Zj(t),this.snapAutomationBreakPoint=new hk(t),this.recordAutomationAction=new vk(t),this.loadProjectTracks=new gk(t),this.unmapPlanarParameters=new uj(t),this.connectPatcherEdge=new wk(t),this.auditionPreset=new jk(t)}return Object(s.a)(e,[{key:"getAction",value:function(e){switch(e.type){case $O.c:return this.addStepAction;case $O.k:return this.deleteStepAction;case $O.m:return this.deleteStepNumberAction;case $O.t:return this.recordStepAction;case $O.r:return this.moveStepsAction;case $O.l:return this.deleteStepsAction;case $O.A:return this.toggleStepAction;case $O.j:return this.deletePatternAction;case $O.D:return this.updateStepParameterAction;case $O.b:return this.addEffectAction;case $O.g:return this.deleteEffectAction;case $O.z:return this.toggleEffectAction;case $O.q:return this.moveEffectAction;case $O.C:return this.updateParameterAction;case $O.F:return this.updateTrackVolumeAction;case $O.E:return this.updateTrackMuteAction;case $O.a:return this.addAutomationBreakPointAction;case $O.u:return this.removeAutomationBreakPointAction;case $O.v:return this.removeAutomationBreakPointsAction;case $O.o:return this.moveAutomationBreakPointAction;case $O.p:return this.moveAutomationBreakPointsAction;case $O.y:return this.snapToGridAction;case $O.x:return this.snapAutomationBreakPoint;case $O.n:return this.loadProjectTracks;case $O.d:return this.auditionPreset;case $O.s:return this.recordAutomationAction;case $O.B:return this.unmapPlanarParameters;default:var t=xj[e.type];return t?t(this.sequencerEngine):void 0}}},{key:"makeCopyOfAction",value:function(e){var t;switch(e.type){case $O.c:case $O.k:case $O.t:return(t=Object(d.a)({},e)).payload.step=t.payload.step.getCopy(!0,!0,!0),t;case $O.r:return(t=Object(d.a)({},e)).payload.steps=e.payload.steps,t;case $O.l:return(t=Object(d.a)({},e)).payload.steps=e.payload.steps.map(function(e){return e.getCopy(!0,!0,!0)}),t;case $O.D:case $O.C:return(t=Object(d.a)({},e)).payload.savedValue=e.payload.parameter.get(),t;case $O.o:return(t=Object(d.a)({},e)).payload.savedStep=e.payload.point.step,t.payload.savedValue=e.payload.point.value,t;default:return Object(d.a)({},e)}}}]),e}();function Sk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Pk=function(e,t){return Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]),e.sort(),t.sort(),e.length===t.length&&e.every(function(e,n){return e===t[n]})},Ek=function(e,t){var n=e.operation;if(Mk(n.type))return Tk(e,t);for(var r=t.length-1;r>=0;r--){if(!Ak(n,t[r]))break}var a=t[r+1];return a&&void 0!==a.operation.payload.savedValue&&(e.operation.payload.savedValue=a.operation.payload.savedValue),[].concat(Object(h.a)(t.slice(0,r+1)),[e])},Tk=function(e,t){for(var n=e.operation,r=t.length-1;r>=0;r--){var a=t[r];if(!Ak(n,a)){r++;break}n=Ik(n,a.operation)}return[].concat(Object(h.a)(t.slice(0,r)),[Object(d.a)({},e,{operation:n})])};function Ak(e,t){return t.length&&(t=t[t.length-1]),t.operation&&(t=t.operation),(e.type===t.type||e.type===$O.y&&t.type===$O.r)&&(!!Ck(e.type)&&Pk(e.contentId,t.contentId))}var Mk=function(e){return Rk.has(e)},Rk=new Set([$O.r,$O.y]),Ck=function(e){return Nk.has(e)},Nk=new Set([$O.D,$O.F,$O.o,$O.p,$O.r,$O.y]),Ik=function(e,t){var n=e.payload,r=t.payload;if(e.type===$O.r){var a=n.transformation,i=r.transformation,o={stepDifference:a.stepDifference+i.stepDifference,transposeDifference:a.transposeDifference+i.transposeDifference};return Object(d.a)({},t,{payload:Object(d.a)({},r,{transformation:o})})}if(e.type===$O.y&&t.type===$O.r){var s=e.payload.stepLocations,c=r.transformation,u={stepDifference:c.stepDifference+s[0].stepDifference,transposeDifference:c.transposeDifference+s[0].transposeDifference};return Object(d.a)({},t,{payload:Object(d.a)({},r,{transformation:u})})}return e};function qk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function _k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Dk=function(e){Object(u.a)(n,e);var t=_k(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).sequencerEngine=e,r.uuids=new Set,r}return Object(s.a)(n,[{key:"dispatch",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]&&s[1],r=s.length>2&&void 0!==s[2]&&s[2],!(!n&&this.roomActionsManager&&this.roomActionsManager.actionsRemaining<=0)){e.next=4;break}return e.abrupt("return",{});case 4:if(i=this.makeCopyOfAction(t),void 0!==this.getAction(t)){e.next=7;break}return e.abrupt("return",{});case 7:return e.next=9,this.runAction(t,!r,n);case 9:if(o=e.sent,i.payload=Object(d.a)({},i.payload,o),n){e.next=14;break}return e.next=14,this.logAction(i);case 14:return e.abrupt("return",o);case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"runAction",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.getAction(e);if(void 0!==r)return"function"===typeof r?r(e.payload):r.execute(e.payload,t,n)}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=qk(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).executedActions=[],e.undoneActions=[],e.queuedActions=[],e.queuedContentIds=[],e}return Object(s.a)(n,[{key:"logAction",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(q.uuid)(),r=this.getAction(t),e.next=4,this._logAction(n,r,t);case 4:i=e.sent,t=Object(d.a)({},t,{payload:Object(d.a)({},t.payload),contentId:r.getContentId(t)}),Mk(t.type)?void 0===(o=this.lastAction)?this.executedActions.push(t):(s=this.getAction(o.operation).deserialize(o.operation),i?this.executedActions[this.executedActions.length-1]=s:this.executedActions.push(s)):i?this.executedActions[this.executedActions.length-1]=this.combineWithLast(t):this.executedActions.push(Object(d.a)({},t,{uuid:n})),this.executedActions[this.executedActions.length-1].uuid=this.lastAction?this.lastAction.operation.uuid:n;case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"undo",value:function(){if(this.executedActions.length>0){var e=this.executedActions.pop();if(this.undoAction(e,!1),this.undoneActions.push(e),$O.e.indexOf(e.type)>-1){var t=this.executedActions[this.executedActions.length-1];if(void 0===t)return void this.sequencerEngine.updateTracks(!0);this.shouldAlsoUndo(e,t)?this.undo():this.sequencerEngine.updateTracks(!0)}else this.sequencerEngine.updateTracks(!0)}}},{key:"undoAction",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getAction(e);return void 0===n?{}:(this.roomActionsManager&&this.roomActionsManager.removeActionWithId(e.uuid),"function"===typeof n?n(e.payload,!0):n.undo(e,t))}},{key:"shouldAlsoUndo",value:function(e,t){return-1!==$O.e.indexOf(t.type)&&Math.abs(e.timestamp-t.timestamp)<5e3}},{key:"redo",value:function(){if(this.undoneActions.length>0){var e=this.undoneActions.pop();this.runAction(e),this.logAction(e),this.sequencerEngine.updateTracks(!0)}}},{key:"_logAction",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.serialize(r,t);case 2:if(!(i=e.sent)){e.next=10;break}return o=this.queuedActions.length,this.queuedActions=Ek(i,this.queuedActions),s=this.queuedActions.length,this.updateQueuedContentIds(),this.queuedActions[this.queuedActions.length-1].operation.uuid=t,e.abrupt("return",s===o);case 10:return e.abrupt("return",!1);case 11:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"updateQueuedContentIds",value:function(){var e=new Set;for(var t in this.queuedActions){var n=this.queuedActions[t].operation;Array.isArray(n.contentId)?n.contentId.forEach(function(t){return e.add(t)}):e.add(n.contentId)}e.size!==this.queuedContentIds.length&&(this.queuedContentIds=Array.from(e))}},{key:"combineWithLast",value:function(e){var t=this.executedActions[this.executedActions.length-1];return t&&void 0!==t.payload.savedValue&&(e.payload.savedValue=t.payload.savedValue),e}},{key:"lastAction",get:function(){return this.queuedActions[this.queuedActions.length-1]}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=Sk(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"setupSyncing",value:function(){}},{key:"onSyncedOperation",value:function(e){var t=e.operation,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.uuids.has(t.uuid)){var r=this.getAction(t);void 0!==r&&void 0!==(r=r.deserialize(t))&&this.dispatch(r,!0,n)}}}]),n}(e)}(xk))),Fk=n(610);function Lk(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Bk(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Bk(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Bk(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function zk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Jk=0;window.Tone=re.a;var Vk=function(e){Object(u.a)(n,e);var t=zk(n);function n(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:re.a.Transport;var r,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;return Object(o.a)(this,n),(r=t.call(this)).isOffline=s,r.idToParameter={},r.stereoOnly=i,r.engineId=Jk++,r.transport.swingSubvision="16n",r.ethereum=rr.a,r.context=re.a.Master.context,r.idToObject={},r.idToEdge={},r.nameToObjects={},r.tickingObjects=[],r.store=e,r.encryptedIpfs=new Fk.a(r.store,rr.a.guilds,rr.a.encryption,rr.a.crypto),r.mix=new ai.a(Object(c.a)(r)),r.channelMixer=PO.use(Object(c.a)(r)),r.audioInputManager=new ZO(r.store),r.sends=new QO(!1,r.channelMixer,Object(c.a)(r)),r.subSequences=[],r.newSubSequence(),r.audioSettings=new YO,r.recordingsCounter=1,r.operationManager=new Dk(Object(c.a)(r)),Object(DO.a)(r.operationManager),r.parameterLocks=[new lO,new lO],window.spores||(void 0!==a?r.aubio=a:r.initAubio()),r.initGenish(),window.sequencerEngine=Object(c.a)(r),r.resampleConfig={samplesPerNote:1},r}return Object(s.a)(n,[{key:"initAudioWorklets",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.audioWorkletsInitialized){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,re.a.Master.context.audioWorklet.addModule(window.isNFT?"clipper.js":"/clipper.js");case 4:this.audioWorkletsInitialized=!0;case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"transport",get:function(){return re.a.Transport}},{key:"initAubio",value:function(){var e=this;window.Aubio().then(function(t){e.aubio=t})}},{key:"newSubSequence",value:function(e,t){var n=new Nb(this,void 0!==t);return t&&n.addTrack(t),void 0!==e&&n.setId(e),this.addSubSequence(n,void 0===t),this.scenes&&this.scenes.newSubSequence(),n}},{key:"deleteSubSequence",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentSubSequence.id;if(1!==this.subSequences.length){var t=-1;for(var n in this.subSequences)if(this.subSequences[n].id===e){t=n;break}if(!(t<0)){this.scenes.deleteSubSequence(t);var r=this.subSequences.filter(function(t){return t.id!==e})[0];this.switchToSubSequence(r.id),this.subSequences[t].dispose(),this.subSequences.splice(t,1),this.store.dispatch(Object(J.ne)(this.engineId,this.subSequences.map(function(e){return e.id})))}}}},{key:"addSubSequence",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.subSequences.push(e),this.currentSubSequence=e,this.store.dispatch(Object(J.ne)(this.engineId,this.subSequences.map(function(e){return e.id}))),this.store.dispatch(Object(J.gb)(e.id,0)),t&&this.store.dispatch(Object(J.jb)(this.engineId,this.currentSubSequence.id))}},{key:"switchToSubSequence",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.subSequences.filter(function(t){return t.id===e})[0];void 0!==n&&(this.currentSubSequence=n,this.store.dispatch(Object(J.jb)(this.engineId,this.currentSubSequence.id)),this.store.dispatch(Object(J.sc)(this.currentSubSequence.id,this.numberOfPatterns())),t&&(this.updateTracks(),this.tracks[0]&&this.switchToPattern(this.tracks[0].currentPattern)),this.groups.updateGroups())}},{key:"switchToNextSubSequence",value:function(){var e=this.subSequences.indexOf(this.currentSubSequence);e<this.subSequences.length-1?e++:e=0,this.switchToSubSequence(this.subSequences[e].id)}},{key:"switchToPreviousSubSequence",value:function(){var e=this.subSequences.indexOf(this.currentSubSequence);e>0?e--:e=this.subSequences.length-1,this.switchToSubSequence(this.subSequences[e].id)}},{key:"mixes",get:function(){return[].concat(Object(h.a)(this.subSequences.map(function(e){return e.mix})),[this.mix])}},{key:"tracks",get:function(){return this.currentSubSequence.tracks},set:function(e){this.currentSubSequence.tracks=e}},{key:"groups",get:function(){return this.currentSubSequence.groups},set:function(e){this.currentSubSequence.groups=e}},{key:"sequenceId",get:function(){return this.getSequenceId()}},{key:"getSequenceId",value:function(){return void 0===this.loadedSequenceId?0:this.loadedSequenceId}},{key:"setMasterVolume",value:function(e,t){this.groups.channelMixer.setVolume(e,t)}},{key:"getMasterVolume",value:function(){this.groups.channelMixer.getVolume()}},{key:"resolution",get:function(){return this.state.sequencer.resolution}},{key:"displayResolution",get:function(){return this.state.sequencer.displayResolution}},{key:"state",get:function(){return this.store.getState()}},{key:"getSubSequenceName",value:function(e){for(var t=["A","B","C","D","E","F","G","H","I","J","K"],n=0;n<this.subSequences.length;n++)if(this.subSequences[n].id===e)return t[n];return""}},{key:"getSubSequence",value:function(e){return this.subSequences.filter(function(t){return t.id===e})[0]}},{key:"auditionSound",value:function(e,t){var n=this.tracks[t];this.tracks.filter(function(e){return e!==n}).filter(function(e){return e.isAuditioning()}).forEach(function(e){return e.completeAudition()}),n.auditionSound(e)}},{key:"addSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i){var o,s,c,u,l,f=this,h=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=h.length>4&&void 0!==h[4]&&h[4],s=h.length>5?h[5]:void 0,c=!(h.length>6&&void 0!==h[6])||h[6],h.length>7?h[7]:void 0,u={slices:void 0===r||0==r.length?void 0:r,offset:0,transpose:0,volume:0},void 0!==n){e.next=23;break}return(l=new ht(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return f.update()},this.currentSubSequence)).setSends(this.sends),l.setupEffects(),this.currentSubSequence.addTrack(l),l.switchToPattern(this.currentPattern),e.next=13,l.addSound(t,u,!0);case 13:return this.groups.addTrack(l),o&&(this.recordingsCounter++,this.newRecordingToSaveLater(t)),s&&(l.samplesStream=s),this.state.selector.sourceExploring||this.selectTrack(this.tracks.length-1),this.tracks.filter(function(e){return e.isAuditioning()}).forEach(function(e){return e.completeAudition()}),l.updateSteps(),c&&this.currentSubSequence.addTrackToPadIfPossible(l),e.abrupt("return",l);case 23:if(!(this.tracks.length>n)){e.next=28;break}return(l=this.tracks[n]).addSound(t,u),this.selectTrack(n),e.abrupt("return",l);case 28:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"transcribeIntoMidi",value:function(e){var t=this;return new Promise(function(n,r){var a=e.getSamplers()[0],i=a.getSlice(0);Object(br.a)(i.buffer._buffer).then(function(e){var r=e.notes;t.addMultiSynthTrack().addNotes(r,a.tempo),n()})})}},{key:"duplicateTrack",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.tracks[t]){e.next=2;break}return e.abrupt("return");case 2:n=this.tracks[t].pad,r=this.tracks[t].getCopy(void 0,this),this.setupNewTrack(r,!0,!0),r.setupEffects(),n&&((i=n.slots.indexOf(!1))>-1?n.addTrack(r,i):this.currentSubSequence.createPad().addTrack(r,0)),this.currentSubSequence.addTrack(r),this.updateTracks(),this.groups.addTrack(r),this.update();case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTracks",value:function(e){this.tracks=this.tracks.filter(function(t){return!e.includes(t)}),e.forEach(function(e){return e.dispose()})}},{key:"deleteTrack",value:function(e,t){"MIDI"==this.tracks[e].getTrackType()&&this.tracks[e].disconnect();var n=this.tracks[e],r=n.sample,a=this.samplesToSync.indexOf(r);for(var i in a>-1&&this.samplesToSync.splice(a,1),this.tracks)this.tracks[i].chokes.choke===n&&(this.tracks[i].chokes.choke=void 0);n.group;this.groups.deleteTrack(n),this.groups.updateGroupNumbers(),this.rollingManager.deleteTrack(n),n.subSequence.deleteTrackFromPads(n),n.subSequence.deleteTrackFromSequencers(n),t?this.tracks[e]=t:this.tracks.splice(e,1),this.tracks=Object(h.a)(this.tracks),this.cursor.track>=e&&(this.cursor.track--,this.cursor.track<0&&(this.cursor.track=0)),this.scripting.deleteHistoryForTrack(e),this.keyboardEngine&&this.keyboardEngine.deleteTrack(e),this.tracks.forEach(function(e,t){e.trackNumber=t}),this.tracks.forEach(function(e,t){return e.updateSteps()});var o=n.subSequence.id,s=this.state.effects.effectsChainToShow[o]||{};this.store.dispatch(Object(J.Bb)(o,Object(Un.a)(e,s))),this.dispatch(Object(J.f)(n.id)),this.updateSteps(),this.update(),this.selectTrack(Math.max(e-1,0));var c=this.tracks.map(function(e){return e.isWarped()});this.store.dispatch(Object(J.me)(o,c)),n.dispose(),0===this.tracks.length&&this.dispatch(Object(J.Wd)(!1))}},{key:"deleteGroup",value:function(e){this.tracks=this.tracks.filter(function(t){return-1===e.tracks.indexOf(t)}),this.groups.deleteGroup(e),this.store.dispatch(Object(J.Hb)(e.id,[])),this.updateSteps(),this.update()}},{key:"length",get:function(){var e=-1;for(var t in this.subSequences)for(var n in this.subSequences[t].tracks){var r=this.subSequences[t].tracks[n].length;r>=e&&(e=r)}return e}},{key:"newPattern",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.currentSubSequence.pads.map(function(e){return e.fxMacro.macroParameter.get()}),r=this.numberOfPatterns()+1,(new Date).getTime(),this.currentSubSequence.newPattern(),i=this.tracks.map(function(e){return e.newPattern(t)}),e.next=7,Promise.all(i);case 7:(new Date).getTime(),this.switchToPattern(this.tracks[0].patterns.length-1),this.currentSubSequence.pads.forEach(function(e,t){return e.fxMacro.macroParameter.set(n[t])}),this.store.dispatch(Object(J.sc)(this.currentSubSequence.id,r)),this.lfosTrack.newPattern(r),this.envelopesTrack.newPattern(r);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deletePattern",value:function(e){if(0!=this.tracks.length&&1!=this.tracks[0].patterns.length){e=e||this.tracks[0].currentPattern,this.tracks.map(function(t){return t.deletePattern(e)});var t=e>0?e-1:0;this.switchToPattern(t),this.store.dispatch(Object(J.sc)(this.currentSubSequence.id,this.numberOfPatterns())),this.lfosTrack.deletePattern(e),this.envelopesTrack.deletePattern(e)}}},{key:"subSequenceMix",get:function(){return this.currentSubSequence.mix}},{key:"switchToPattern",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.currentSubSequence,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!(e<0||n.tracks.length<=0||n.tracks[0].patterns.length<=e)){var o=this.currentPattern;if(this.currentPattern!==e){Object(Pg.b)(n,e),r||this.dispatch(Object(J.hb)(void 0)),this.state.mix.isRecordingMix&&!t?n.mix.addEvent(new Hg.a(e)):t&&!i||n.mix.holdEvent(new Hg.a(e));var s=n.lfosTrack.switchToPattern(o,e);s=Object(d.a)({},s,n.envelopesTrack.switchToPattern(o,e)),this.switchToPatternHelper(e,n,s,a),this.getAllPatternLockedParameters(o,e).forEach(function(e){return e.updateRedux()}),n.findNodeByName("patterns").forEach(function(t){return t.effect.sendMessage("pattern switched",e+1)}),n.pads.forEach(function(e){return e.sendSliderLevels()}),n.switchToPattern(e,this.currentPatternNumber||0,a),this.currentPatternNumber=e}}}},{key:"currentPattern",get:function(){return this.getCurrentPattern(this.currentSubSequence)}},{key:"getCurrentPattern",value:function(e){return this.store.getState().sequencer.currentPattern[e.id]}},{key:"switchToPatternHelper",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentSubSequence,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=t.tracks.map(function(t){return t.switchToPattern(e,void 0,r)});if(!window.explore){var i={};for(var o in a){var s=a[o];s.volume&&(i[s.volume.id]={volume:s.volume.volume,panning:s.panning.panning,mute:s.mute.mute}),n=Object(d.a)({},n,a[o].bulkUpdate)}this.store.dispatch(Object(J.xb)(n)),this.store.dispatch(Object(J.Ie)(i))}this.store.dispatch(Object(J.gb)(t.id,e)),this.viewMode!==ii.a&&this.updateSteps()}},{key:"updateSteps",value:function(e){var t=this.tracks.map(function(e){return e.getUpdateStepsAction()});this.store.dispatch(Object(J.rf)(t))}},{key:"switchToLastPattern",value:function(){0!=this.tracks.length&&this.switchToPattern(this.numberOfPatterns()-1)}},{key:"switchToPreviousPattern",value:function(){if(0!=this.tracks.length){var e=this.tracks[0].currentPattern-1%this.tracks[0].patterns.length;this.switchToPattern(e)}}},{key:"switchToNextPattern",value:function(){if(0!=this.tracks.length){var e=this.tracks[0].currentPattern+1%this.tracks[0].patterns.length;this.switchToPattern(e)}}},{key:"movePatternTo",value:function(e,t){this.tracks.forEach(function(n){return n.movePatternTo(e,t)}),this.switchToPattern(t),this.lfosTrack.movePatternTo(e,t)}},{key:"numberOfPatterns",value:function(){return 0==this.tracks.length?1:this.tracks[0].patterns.length}},{key:"isLoaded",value:function(e){return void 0!==this.tracks&&void 0!==this.tracks[e]&&this.tracks[e].isLoaded()}},{key:"setUpdateCallback",value:function(e){this.callback=e}},{key:"update",value:function(e){window.isNFT||window.projectId||!e||window.multiMix||window.documentation||window.landing||this.tokenId||window.location.href.includes(e)||window.history.pushState("page2","Title","/v3/"+e)}},{key:"addTrack",value:function(e){this.currentSubSequence.addTrack(e),e.setupEffects(),this.groups.addTrack(e),this.setupNewTrack(e)}},{key:"addAudioTrack",value:function(){var e=this,t=new Sa(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return this.setupNewTrack(t),t.warp(),t}},{key:"addMultiFreezeTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]),n=new Oa(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return this.groups.addTrack(n),this.setupNewTrack(n,t),n}},{key:"addZ4Track",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]),n=new NO(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return this.groups.addTrack(n),this.setupNewTrack(n,t),n}},{key:"addSampledInstrumentTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]),n=new _r(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return this.groups.addTrack(n),this.setupNewTrack(n,t),n}},{key:"addRNBOTrack",value:function(e){var t=this,n=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2]),r=new aa(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return t.update()},this.currentSubSequence,e);return this.groups.addTrack(r),this.setupNewTrack(r,n),r}},{key:"addInstrumentRackTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]),n=new ur(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return this.groups.addTrack(n),this.setupNewTrack(n,t),n}},{key:"addInstrumentTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new jt(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addFMSynthTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new wt(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addMetalSynthTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new zO(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addMultiSynthTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new nr(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence,!0));return this.groups.addTrack(t),this.setupNewTrack(t),t.preset.name="Empty Patch",t.presetName="Empty Patch",t}},{key:"addMidiTrack",value:function(){var e=this,t=new ma(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return t.setMidiEngine(this.midi),t.setAudioSettings(this.audioSettings),this.setupNewTrack(t),t}},{key:"setupNewTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];e.isRecordable()&&this.setupRecordableTrack(e,t),e.sequencerEngine=this,n||e.setSends(this.sends),e.setKeyboardEngine(this.keyboardEngine),t||this.currentSubSequence.addTrack(e),t?e.switchToPattern(0):(e.switchToPattern(this.tracks[0].currentPattern),a||this.currentSubSequence.addTrackToPadIfPossible(e)),r&&(this.update(),this.updateTracks())}},{key:"setupRecordableTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.setAudioInputManager(this.audioInputManager),t||this.groups.addTrack(e),e.setSequencerEngine(this)}},{key:"updateTracks",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.tracks.forEach(function(t,n){t.trackNumber=n,t.sequencerEngine=e,t.patterns.forEach(function(t){return t.sequencerEngine=e})}),!window.explore){var n=this.tracks.map(function(e){return e.getUpdateStepsAction(t)});this.store.dispatch(Object(J.rf)(n))}}},{key:"dispose",value:function(){for(var e in this.playSequence&&this.playSequence.dispose(),this.loadedSamples)this.loadedSamples[e].dispose();this.metronome&&this.metronome.dispose(),this.metronome=void 0,this.loadedSamples={},PO.release(this.channelMixer),this.channelMixer=void 0,this.sends.dispose(),this.subSequences.forEach(function(e){return e.disposeParameters()}),this.subSequences.forEach(function(e){return e.dispose()}),this.store.dispatch(Object(J.b)(this.sequenceId)),this.audioInputManager.dispose(),this.idToParameter={}}},{key:"newSequence",value:function(){for(var e in this.subSequences){this.subSequences[e].dispose()}this.subSequences=[],this.newSubSequence(),this.mix=new ai.a(this),this.update(),this.store.dispatch(Object(J.sc)(this.currentSubSequence.id,1)),this.store.dispatch(Object(J.l)()),this.loadedSequenceId=void 0,this.stop()}},{key:"scrollToSelectedTrack",value:function(){}},{key:"patternLocks",set:function(e){this.store.dispatch(Object(J.Jd)(e))}},{key:"togglePatternLock",value:function(){this.store.dispatch(Object(J.Id)(this.currentPattern,!this.patternLocked))}},{key:"viewMode",get:function(){return this.state.sequencer.viewMode}},{key:"patternLocked",get:function(){return this.store.getState().sequencer.patternLocks[this.currentPattern]||!1}},{key:"getAllPatternLockedParameters",value:function(){return[].concat(Object(h.a)(this.parameters),Object(h.a)(this.currentSubSequence.getAllParameters())).filter(function(e){return e.hasPatternLockedValues()})}},{key:"guildId",get:function(){return this.state.guilds.selectedGuild?this.state.guilds.selectedGuild.guildId:0}},{key:"metronomeOn",get:function(){return this.metronome&&!this.metronome.muted},set:function(e){this.metronome.mute(!e)}},{key:"getScale",value:function(){var e=new Set;for(var t in this.tracks){var n=this.tracks[t];for(var r in n.patterns)n.patterns[r].getEasyPattern().getAllSteps().map(function(t){return e.add(y.a.fromTranspose(t.transpose).note)})}return Array.from(e)}},{key:"dispatch",value:function(e){this.store.dispatch(e)}},{key:"createPad",value:function(e){this.currentSubSequence.createPad(e)}},{key:"getSamplesPerTrack",value:function(){return Object(C.e)(this)}},{key:"refreshUniform",value:function(){Object(hi.c)("shader.render")}},{key:"compile",value:function(){var e,t=Lk(this.subSequences);try{var n=function(){var t,n=e.value,r=Lk(n.findNodeByName("gl.material"));try{for(r.s();!(t=r.n()).done;){t.value.refresh()}}catch(i){r.e(i)}finally{r.f()}var a=n.findNodeByName("three.canvas");setTimeout(function(){a.forEach(function(e){console.log("sending size to canvas",e.effect,[e.effect.width,e.effect.height]),e.effect.onSizeChange([e.effect.width,e.effect.height])})},4e3)};for(t.s();!(e=t.n()).done;)n()}catch(r){t.e(r)}finally{t.f()}}},{key:"getPhotos",value:function(){return Object(C.c)(this)}},{key:"saveWindowPositions",value:function(){var e=this.state.windows.windowPositions;la.a.addJson(e)}},{key:"loadWindowPositions",value:function(){var e=this;la.a.getJson("QmUWjd8HbxTxRG6G8d4DYsWQbtgsRKDp1kKeCp2JGeMZQP").then(function(t){e.dispatch(Object(J.O)(t))})}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=TO(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"initGenish",value:function(){}}]),n}(e)}(function(){return function e(){Object(o.a)(this,e)}}()));n(552);function Hk(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Uk(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Uk(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Uk(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Wk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Kk(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Qk(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qk(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Qk(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Zk=function(e){var t,n=[],r=[],a=0,i=Kk(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;o.time-a>2&&(n.push(r),r=[]),r.push(o),a=o.time+o.duration}}catch(s){i.e(s)}finally{i.f()}return r.length>0&&n.push(r),n},Yk=function(e){var t=e,n=function(e){var t,n={},r=Kk(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=a.track.trackNumber;n[i]||(n[i]=[]),n[i].push(a)}}catch(o){r.e(o)}finally{r.f()}return n}(e),r=Object.keys(n);r.sort(function(e,t){return n[e].length-n[t].length}),console.log(r.map(function(e){return[e,n[e].length]}));var a=r[0];r.length>2&&(a=r[1]),console.log("min track=",a,n[a]),e=n[a];for(var i=ew(e),o=[],s=0;s<i.length-3;s++)for(var c=s+2;c<i.length;c++)for(var u=2;u<i.length-c;u++){var l=i.slice(s,s+u),f=i.slice(c,c+u);if(l.length===f.length){var h=Xk(l,f);h>0&&o.push({estimation:h,i:s,j:c,k:u})}}o.sort(function(e,t){return e.estimation-t.estimation});var d=o[0];if(d){var p=$k(60/(e[d.j].time-e[d.i].time)),v=e[d.i].time,m=e[d.j].time;m+=m-v;var y,b=[],g=Kk(t);try{for(g.s();!(y=g.n()).done;){var O=y.value;v<=O.time&&O.time<m&&b.push(O)}}catch(j){g.e(j)}finally{g.f()}return{bpm:p,loop:b}}},$k=function(e){for(;e<70;)e*=2;return e},Xk=function(e,t){for(var n=0,r=0,a=0;a<e.length;a++)a<t[a]&&(n+=Math.abs(t[a]-e[a]),r++);return n/r},ew=function(e){var t,n=[],r=void 0,a=Kk(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;r&&n.push(i.time-r.time),r=i}}catch(o){a.e(o)}finally{a.f()}return n};window.createPattern=function(){var e=window.sequencerEngine,t=Zk(aw()),n=t[t.length-1];if(n&&0!==n.length){var r=Yk(n);if(r){var a=r.loop,i=r.bpm;if(a[0]){e.bpmParameter.set(i,!1);var o,s=new re.a.Time("32n").toSeconds(),c=a[0].time,u=Kk(a);try{for(u.s();!(o=u.n()).done;){var l=o.value,f=(l.time-c)/s,h=Math.floor(f),d=f-h,p=l.track;h>p.pattern.length()&&p.doubleTrackLength(),p.recordUnquantizedHit(h,0,l.duration/(2*s),d,l.transpose||0,l.velocity)}}catch(v){u.e(v)}finally{u.f()}}}}},window.getGhostChunks=Zk;var tw=function(){var e=[];return{record:function(t,n,r,a,i){e.push({track:t,time:n,duration:r,transpose:a,velocity:i})},drain:function(){var t=[].concat(e);return e.length=0,t},peek:function(){return[].concat(e)}}}(),nw=tw.record,rw=tw.drain,aw=tw.peek;window.drain=rw,window.peek=aw;function iw(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ow(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ow(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ow(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var sw=function(){function e(){Object(o.a)(this,e),this.addListeners(),this.currentChord=void 0,this.lastChordTime=void 0,this.newChordListeners=[],this.sameChordListeners=[],this.octaveUpListeners=[],this.octaveDownListeners=[]}return Object(s.a)(e,[{key:"addListeners",value:function(){}},{key:"setCurrentChord",value:function(e){this.currentChord=e,this.lastChordTime=(new Date).getTime()}},{key:"chordOn",value:function(e){}},{key:"dispatchEvent",value:function(e){var t=new Event(e);t.chord=this.currentChord,window.dispatchEvent(t)}},{key:"sameChord",value:function(){this.dispatchEvent("SAME_CHORD")}},{key:"octaveDown",value:function(e){this.dispatchEvent("OCTAVE_DOWN")}},{key:"twoOctavesDown",value:function(e){this.dispatchEvent("TWO_OCTAVES_DOWN")}},{key:"octaveUp",value:function(e){this.dispatchEvent("OCTAVE_UP")}},{key:"twoOctavesUp",value:function(e){this.dispatchEvent("TWO_OCTAVES_UP")}},{key:"newChord",value:function(e){this.setCurrentChord(e),this.dispatchEvent("NEW_CHORD")}},{key:"stripOctave",value:function(e){return new Set(Array.from(e).map(function(e){return y.a.fromString(e).note}))}},{key:"chordContains",value:function(e,t){e=this.stripOctave(e);var n,r=iw(t=this.stripOctave(t));try{for(r.s();!(n=r.n()).done;){var a=n.value;if(!e.has(a))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}},{key:"isOctaveUp",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=!0,i=iw(e);try{for(i.s();!(n=i.n()).done;){var o=n.value,s=y.a.fromString(o).addTranspose(12*r).toString();t.has(s)||(a=!1)}}catch(c){i.e(c)}finally{i.f()}return a}},{key:"isOctaveDown",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=!0,i=iw(e);try{for(i.s();!(n=i.n()).done;){var o=n.value,s=y.a.fromString(o).addTranspose(-12*r).toString();t.has(s)||(a=!1)}}catch(c){i.e(c)}finally{i.f()}return a}},{key:"isSameChord",value:function(e,t){return this.eqSet(e,t)}},{key:"eqSet",value:function(e,t){if(e.size!==t.size)return!1;var n,r=iw(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(!t.has(a))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}},{key:"chordOff",value:function(e){}},{key:"addCallback",value:function(){}}]),e}(),cw=function(){function e(t,n){Object(o.a)(this,e),this.chordsManager=new sw,this.sequencerEngine=t,this.store=this.sequencerEngine.store,this.keyboardEngine=n,this.recordedTriggers={},this.notesDown=new Set}return Object(s.a)(e,[{key:"onNoteDown",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(n&&this.addNoteOn(e),!(e in this.recordedTriggers)){var i=this.store.getState().sequencer.resolution,o=this.store.getState().sequencer.quantized;this.keyboardEngine.onKeyDown(e,i,!this.sequencerEngine.rolling,n,r,a);var s=this.keyboardEngine.recordHit(e,n,i,o,r,a);null!=s&&("tracks"in s?s.recordedTriggers.forEach(function(e){e.release=t.release;t.sequencerEngine.tracks[e.trackNumber];t.sequencerEngine.rollingManager.addTrackSlice(e.trackNumber,0,s.transpose),t.store.dispatch(Object(J.of)(e.trackNumber,e.sliceNumber))}):(this.sequencerEngine.rollingManager.addTrackSlice(s.trackNumber,s.sliceNumber),this.store.dispatch(Object(J.of)(s.trackNumber,s.sliceNumber))),this.recordedTriggers[e]=s)}}},{key:"onAlphabetKeyDown",value:function(e){this.onNoteDown(e.key,!1)}},{key:"addNoteOn",value:function(e){}},{key:"addNoteOff",value:function(e){}},{key:"onNoteOff",value:function(e){var t=this;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.addNoteOff(e),e in this.recordedTriggers){var n=this.recordedTriggers[e];if(void 0!==n.tracks)n.recordedTriggers.forEach(function(e){return t.store.dispatch(Object(J.pf)(e.trackNumber,e.sliceNumber))}),n.recordedTriggers.filter(function(e){return e.rolling}).forEach(function(e){e.track;t.sequencerEngine.rollingManager.removeTrackSlice(e.trackNumber,0,n.transpose)}),n.tracks.filter(function(e){return e.trackData}).filter(function(e){return!e.rolling}).forEach(function(r){t.releaseAndRecord(r,n,e,!0)});else{var r=this.sequencerEngine.tracks[n.trackNumber];if(void 0===r)return;this.sequencerEngine.rollingManager.removeTrackSlice(n.trackNumber,n.sliceNumber,void 0),this.store.dispatch(Object(J.pf)(n.trackNumber,n.sliceNumber)),r.rolling||this.releaseAndRecord(r,n,e)}delete this.recordedTriggers[e]}}},{key:"onKeyUp",value:function(e){this.onNoteOff(e.key)}},{key:"releaseAndRecord",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=t.transpose;void 0===a&&(a=e.trackData.transpose),e.midiEffects.liveInputRelease(r?a+e.trackData.transpose:a,t.sliceNumber),e.sequencerEngine.playing&&this.store.getState().sequencer.isRecording||e.subSequence.isTrack&&this.store.getState().mix.isRecordingMix?t.record(this.sequencerEngine):(t.recordedTriggers&&(t=t.recordedTriggers[0]),t.getDuration&&nw(e,t.startTime,t.getDuration().duration/1e3,a,t.velocity))}}]),e}();function uw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var lw=function(e){Object(u.a)(n,e);var t=uw(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,rg)).sequencerEngine=e,r}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e>63.5;this.sequencerEngine.trackRolling=t}}]),n}(rO);function fw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hw=function(e){Object(u.a)(n,e);var t=fw(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,ag)).sequencerEngine=e,r}return Object(s.a)(n,[{key:"execute",value:function(e){var t=e>63.5;console.log("excecuting sequence roll action"),this.sequencerEngine.sequenceRolling=t}}]),n}(rO);function dw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function pw(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return vw(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vw(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function vw(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function mw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var yw=new re.a.Time("16n"),bw=new re.a.Time("32n"),gw=function(e){Object(u.a)(n,e);var t=mw(n);function n(e,r,a,i,s,u){var l;return Object(o.a)(this,n),(l=t.call(this,e,r,a,i,u)).playCount=0,l.currentStepTime=null,l.previousStepTime=null,l.lastTrackStep=void 0,l.tracksToRecord={},l.tracksRecording={},l.tracksToStopRecording={},l.rollingManager=new nO,l.mixButtons=[],l.nextTimeScheduled=void 0,l.nextStepScheduled=void 0,l.startedTransportExplicitly=!1,l.patternSwitchScheduled=null,l.stepNumberOffset=0,l.isRecording=!1,l.playing=!1,l.sequenceRolling=!1,l.resampler=void 0,l.automationStep=0,l.bpmParameter=new le.a("BPM",l.transport.bpm,function(e,t,n){return l.onNewBpm(t,n)},{min:1,max:500,unit:""}),l.bpmParameter.setContext((new X.a).forSequencerEngine(Object(c.a)(l))),window.explore?l.bpmParameter.set(re.a.Transport.bpm.value):l.bpmParameter.set(Ow()),l.swingParameter=new he.a("Swing",Object(c.a)(l),function(e,t){l.onNewSwing(t)},{min:50,max:75,unit:"",defaultValue:50}),l.parameters=[],l.registerParameter(l.bpmParameter),l.registerParameter(l.swingParameter),l.latency=void 0,l.clockSync=new Jb(Object(c.a)(l)),l.masterResampler=new vg.a(Object(c.a)(l),l.groups.channelMixer.stereoMerger,!0),l.transpose=0,l.autoResampleMode=!1,l.metronome=!s&&new bg(Object(c.a)(l),l.mixSession,1,function(){return[]}),l.deleting=!1,l.scenes=new Zg(Object(c.a)(l)),l.parametersToUpdate={},l.initAudition(),l}return Object(s.a)(n,[{key:"registerParameter",value:function(e){this.parameters.push(e),e.setContext((new X.a).forSequencerEngine(this));var t=e.setStore(this.store);this.dispatch(Object(J.xb)(t))}},{key:"startPlaySequence",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.playSequence.cancel(),this.playSequence.start(t),this.getSamplerPlaySequence&&this.getSamplerPlaySequence().start(t);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"schedulePlay",value:function(){!this.playing&&this.clockSync.connected&&this.clockSync.clockType===Db.c?this.store.dispatch(Object(J.Uc)(!0)):this.play()}},{key:"play",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.playCount++,"suspended"===this.context._context.state&&this.playCount++>=2&&(console.log("was suspended so trying to resume"),this.context._context.resume().then(function(){return t.channelMixer.setupAudioWorklet()})),this.keyboardHelper&&(this.keyboardHelper.release=void 0),this.playTimestamp=(new Date).getTime(),this.playing=!this.playing,this.latency=void 0,this.firstStep=!0,this.trackStep=this.isLooping?this.loopStart:this.startStep,this.state.keyboard.cursor&&!window.isNFT&&this.isShowingPianoRoll()&&(this.trackStep=Me.a.baseResolution.transformStepAtResolution2(this.state.keyboard.cursor,this.displayResolution)),this.currentStep=0,this.previousStep=0,this.previousStepTime=void 0,this.currentStepTime=void 0,this.playing){n||this.hasAtleastOneSequencerEnginePlaying()||this.updateBpm(this.bpm),this.startPlaySequence(e,n),!n&&this.hasAtleastOneSequencerEnginePlaying()||(this.startedTransportExplicitly=!0,this.transport.start("+0.00001"),this.midi&&this.midi.onPlay()),this.restartAllMixes();var r,a=pw(this.subSequences);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.startZObjects(),i.midiEffects.clear(),i.tracks.forEach(function(e){return e.restart()}),i.tracks.forEach(function(e){return e.start()})}}catch(o){a.e(o)}finally{a.f()}this.store.dispatch(Object(J.Ob)(this.getSequenceId(),!0))}else this.stop();this.store.dispatch(Object(J.Uc)(!1)),this.sendPlayChange(this.playing)}},{key:"restartAllMixes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.isLooping;for(var t in this.mixes.forEach(function(t){return t.restart(e)}),this.setSequenceRolling(!1,void 0,!0),this.subSequences)for(var n in this.subSequences[t].tracks){this.subSequences[t].tracks[n].patternRollStepNumber=void 0}this.schedulePatternBufferClear=!1}},{key:"stop",value:function(){var e=this;this.restartAllMixes(),this.latency=void 0,this.playing=!1;this.trackStepReal;for(var t in this.trackStepReal=0,this.higherOrderSequencer.stop(),this.playSequence.stop(),this.startedTransportExplicitly=!1,this.clearScheduledAutomations(),this.hasMultipleSequencerEnginesPlaying()||(this.transport.stop("+0.01"),this.midi&&this.midi.onStop()),this.subSequences)this.subSequences[t].lfosTrack.stop(),this.subSequences[t].stopZObjects();this.tracks.forEach(function(e){return e.effects.filter(function(e){return e.syncable()}).forEach(function(e){return e.stop()})}),Object(hi.a)();var n,r=pw(this.subSequences);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.midiEffects.stop(),a.tracks.forEach(function(t){t.stepGroups.length>0&&(t.pattern.transformStepBuckets=[],t.pattern.isTransformed=!1,t.subSequence===e.currentSubSeuqence&&t.updateSteps()),t.resetAnyPLockedParameters(),t.midiEffects.stop(),t.notesTriggered={},!t.isFrozen&&t.instrument&&t.instrument.releaseAll&&t.instrument.releaseAll(),t.tracks&&t.tracks.forEach(function(e){return e.track.midiEffects.stop()})})}}catch(o){r.e(o)}finally{r.f()}for(var i in this.store.dispatch(Object(J.Ob)(this.getSequenceId(),!1)),this.state.sequencer.viewMode!==ii.a&&this.store.dispatch(Object(J.Pb)(!1)),this.clockSync&&this.clockSync.onStop(),this.subSequences)this.subSequences[i].tracks.forEach(function(e){e.chokes.chokingDuration=0,e.chokes.liveRelease()});this.resetAutomationParameters(),this.playSequence.cancel(),this.loadNewSequence(),this.handleStopMode(),this.lastTrackStep=void 0}},{key:"startStep",get:function(){var e=this.state.sequencer.viewMode;return void 0===this.state.arrangement.cursorStep||e===ii.c&&!this.isLooping?0:this.state.arrangement.cursorStep}},{key:"seekToTrackStep",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(arguments.length>2?arguments[2]:void 0)?e<this.stepNumberOffset?this.stepNumberOffset=e:(this.stepNumberOffset=0,this.trackStep=e-this.stepNumberOffset):(this.trackStep=e,this.store.dispatch(Object(J.fb)(this.getSequenceId(),e)),this.mixes.forEach(function(t){return t.seekToTrackStep(e)}),0===e&&(this.stepNumberOffset=0)),0==e&&n&&(this.isShowingPianoRoll()||this.switchToPatternHelper(0)),this.isLooping&&(this.looping=!1,this.startNewLoop(this.bars)),this.subSequences.forEach(function(e){return e.tracks.forEach(function(e){return e.scheduleTrackPatternChangeIfAny(t.trackStep,!0)})})}},{key:"loadNewSequence",value:function(){this.playSequence&&this.playSequence.dispose(),this.playSequence=this.getPlaySequence()}},{key:"sleep",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){setTimeout(function(){return e(t)},t)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"isLooping",get:function(){return this.state.arrangement.looping}},{key:"looping",set:function(e){this.store.dispatch(Object(J.A)(e))}},{key:"loopStart",get:function(){return this.state.arrangement.selection.start}},{key:"loopEnd",get:function(){return this.state.arrangement.selection.end}},{key:"startNewLoop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=32*e,n=this.trackStep;for(n-=Object(qn.a)(n+(this.stepNumberOffset||0),t);n<0;)n+=16;this.dispatch(Object(J.F)(n,n+t)),this.looping=!0,this.bars=e}},{key:"getPlaySequence",value:function(){var e=this,t=Array(16).fill(1).map(function(e,t){return t}),n=new re.a.Sequence(function(t,n){e.scheduleStep(t,n)},t,"32n");return n.loop=!0,n}},{key:"getLoopedStep",value:function(e){if(this.isLooping){var t=(e-this.loopStart)%(this.loopEnd-this.loopStart);return e=this.loopStart+t}return e}},{key:"handleLatency",value:function(e){if(void 0===this.latency&&!this.clockSync.initiator){this.timeToCompare=this.timeToCompare-(new Date).getTime(),this.latency=this.timeToCompare-this.getMilliseconds(e),this.latency+=bw.toMilliseconds();var t=(new Date).getTime()-this.playTimestamp;this.latency-=t/2}return this.latency&&(e+=this.latency/1e3),e+=this.state.sequencer.latency/1e3}},{key:"handleMixSessionStep",value:function(e){var t=this;if(this.state.mix.isPlayingMix){for(var n in this.isLooping&&this.trackStep===this.loopStart&&this.restartAllMixes(!0),this.subSequences){var r=this.subSequences[n],a=this.subSequences[n].mix.getValue(kb.i,this.automationStep);void 0!==a&&a!==this.getCurrentPattern(r)&&this.switchToPattern(a,!0,r,void 0,e)}var i=this.isSequenceRollingAtStep(this.automationStep);void 0!==i&&i!==this.isSequenceRolling&&this.setSequenceRolling(i,void 0,!0);try{this.mixes.forEach(function(n){return n.scheduleNext(t.trackStep,e)})}catch(o){console.log(o)}}}},{key:"scheduleParametersToRecord",value:function(e){if(this.isRecording){var t=this.state.tracks.parametersToRecord,n=function(n){var r=t[n];if(!r||!r.context)return"continue";if(r.context.track){var a=r.context.track,i=a.pattern,o=e%a.length,s=i.stepBuckets[o];for(var c in s.steps){var u=s.steps[c];if(u.on)u.parameters.filter(function(e){return e.name===r.name}).forEach(function(e){return e.set(r.get())})}}};for(var r in t)n(r)}}},{key:"scheduleAnyTrackRecording",value:function(e,t){this.store.getState();this.tracksToRecord[e.trackNumber]?(e.startRecording(t),this.store.dispatch(Object(J.qf)(e.trackNumber,!0)),this.tracksRecording[e.trackNumber]=!0,delete this.tracksToRecord[e.trackNumber]):this.tracksToStopRecording[e.trackNumber]&&(e.stopRecording(t),this.store.dispatch(Object(J.qf)(e.trackNumber,!1)),delete this.tracksRecording[e.trackNumber],delete this.tracksToStopRecording[e.trackNumber])}},{key:"scheduleAnyMasterResampling",value:function(e){var t=this.store.getState();void 0!==this.resampler&&(this.resampler.resamplingDurationElapsed++,this.resampler.resamplingDurationElapsed==t.tracks.resampleDuration&&(this.resampler.stop(e),this.resampler=void 0)),t.sequencer.resampleMaster&&(this.store.dispatch(Object(J.fd)(!1)),this.resampler=this.masterResampler,this.resampler.start(e))}},{key:"scheduleAnyTrackResampling",value:function(e,t){var n=this.store.getState();if(e.subSequence===this.currentSubSequence){void 0!==e.resampler&&(e.resampler.resamplingDurationElapsed++,e.resampler.resamplingDurationElapsed==n.tracks.resampleDuration&&(e.resampler.stop(t),e.resampler=void 0));var r=n.tracks.tracksToResample,a=r.indexOf(e.trackNumber);a>-1&&(r.splice(a,1),this.store.dispatch(Object(J.Ne)(r)),e.resampler=e.masterResampler,e.resampler.start(t)),n.tracks.trackToFreeze&&n.tracks.trackToFreeze.trackNumber===e.trackNumber&&n.tracks.trackToFreeze.subSequenceId===e.subSequence.id&&(e.resampler=e.masterResampler,e.resampler.start(t,e,!0),this.store.dispatch(Object(J.He)(void 0)))}}},{key:"scheduleAnyFrozenTrackPlaying",value:function(e,t){}},{key:"scheduleAnyAudioTrackPlaying",value:function(e,t){if("MIDI"===e.getTrackType()&&Object.keys(e.samplers).length>0){var n=new K.a;n.loadDefaults(),n.attack=80,n.release=yw.toMilliseconds()/4,e.triggerSamples(n,t)}}},{key:"scheduleTrackRolling",value:function(e,t,n){var r=this;e.subSequence.isTrack||(t=e.getPatternStep(t));var a=this.getMilliseconds(n),i=e.getFactoredResolution();setTimeout(function(){var a=r.rollingManager.getTriggers(t,i,e);if(a.filter(function(t){return t.trackSlice.trackNumber===e.trackNumber}).length>0){e.onNewStep(),a.forEach(function(a){if(void 0!==(e=r.tracks[a.trackSlice.trackNumber])){var o=new K.a;o.slice=a.trackSlice.sliceNumber,o.velocity=e.trackData.velocity,o.transpose=void 0===a.trackSlice.transpose?e.trackData.transpose:a.trackSlice.transpose+e.trackData.transpose,o=e.getStepDataForStep(o);var s=new re.a.Time(n)+a.time;o.track=e,e.midiEffects.input(o,s,t),(r.isRecording||e.subSequence.isTrack&&r.isRecordingMix)&&e.recordHit(a.step,i,o.slice,null,o.transpose,o.velocity,r.keyboardHelper.release)}}),a=e.midiEffects.output(n,t);var o=[e],s={};s[e.trackNumber]=a,Cg(r,o,s,n,t),e.onStepEnded(n,t)}},a-20)}},{key:"scheduleSamplesRolling",value:function(e,t){var n=this;this.tracks.filter(function(e){return e.rolling}).forEach(function(r){return n.scheduleTrackRolling(r,e,t)})}},{key:"missedNextScheduledStep",value:function(){return re.a.Master.context.currentTime<=this.nextTimeScheduled}},{key:"scheduleNext",value:function(e,t,n){var r=this,a=this.tracks[e];if(a.getTrackType()!==W.b){var i=this.rollingManager.getTriggerTimes(this.nextStepScheduled,this.resolution,a),o=a.getFactoredResolution();i.forEach(function(e){var i=new K.a;i.slice=t,i.transpose=void 0===n?a.trackData.transpose:n+a.trackData.transpose,i=a.getStepDataForStep(i),a.trigger(i,r.nextTimeScheduled+e.time),r.isRecording&&(a.recordHit(e.step,o,t,i.duration,i.transpose),a.updateSteps())})}}},{key:"getCurrentStepTime",value:function(){var e=this.getMilliseconds(this.latestStepTime),t=new re.a.Time(re.a.Master.context.currentTime).toMilliseconds()-new re.a.Time(this.previousStepTime).toMilliseconds();return t<0||e>0&&e>t?this.previousStepTime:this.latestStepTime}},{key:"getCurrentStep",value:function(e,t){Math.abs(new re.a.Time(re.a.Master.context.currentTime)-new re.a.Time(this.latestAbsoluteTime)),Math.abs(new re.a.Time(re.a.Master.context.currentTime)-new re.a.Time(this.previousAbsoluteTime));var n=void 0;n=t?t.subSequence.isTrack?1e6:t.pattern.length():this.length;var r=this.lastTrackStep%n;return e=e||Me.a.baseResolution,Math.floor(r/(Me.a.baseResolution.numSteps()/e.numSteps()))}},{key:"getMilliseconds",value:function(e){return new re.a.Time(e).toMilliseconds()-new re.a.Time(re.a.Master.context.currentTime).toMilliseconds()}},{key:"recordTrack",value:function(e){this.tracksToRecord[e]=!0}},{key:"stopRecordingTrack",value:function(e){this.tracksToStopRecording[e]=!0}},{key:"isTrackRecording",value:function(e){return this.tracksRecording[e]}},{key:"doubleTrackLength",value:function(e){this.tracks[e].doubleTrackLength(),this.transport.loopStart="0:0:0",this.transport.loopEnd=this.length/32+":0:0"}},{key:"halfTrackLength",value:function(e){this.tracks[e].halfTrackLength(),this.transport.loopStart="0:0:0",this.transport.loopEnd=this.length/32+":0:0"}},{key:"isRecordingMix",get:function(){return this.store.getState().mix.isRecordingMix}},{key:"lfos",get:function(){return this.lfosTrack.lfos}},{key:"envelopesTrack",get:function(){return this.currentSubSequence.envelopesTrack}},{key:"lfosTrack",get:function(){return this.currentSubSequence.lfosTrack}},{key:"envelopes",get:function(){return this.envelopesTrack.envelopes.map(function(e){return e.envelope})}},{key:"onNewBpm",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=i.length>1&&void 0!==i[1]&&i[1],void 0!==t&&t<500&&t>=1&&(n||(this.transport.bpm.value=t),this.store.dispatch(Object(J.J)(t)),this.clockSync&&this.clockSync.onBPMChanged(t),window.parent&&document.referrer&&(r=document.referrer,window.parent.postMessage({type:"bpm-updated",body:t},r)));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bpm",get:function(){return this.bpmParameter.get()},set:function(e){this.bpmParameter.set(e,!1)}},{key:"swing",get:function(){return this.swingParameter.get()},set:function(e){this.swingParameter.set(e)}},{key:"updateBpm",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],this.bpm=t,!n){for(r in this.subSequences)this.subSequences[r].lfosTrack.onBPMUpdated();this.tracks.forEach(function(e){return e.onBPMUpdated()})}case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onNewSwing",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=(t-50)/50,this.transport.swing=n;case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateSwing",value:function(e){this.swing=e}},{key:"recording",value:function(e){this.store.dispatch(Object(J.Rb)(e)),this.isRecording=e,this.tracks.filter(function(e){return"MIDI"===e.getTrackType()}).map(function(t){return t.recording(e)})}},{key:"connectToKeyboardEngine",value:function(e){var t=this;this.keyboardEngine=e,this.keyboardHelper=new cw(this,e),this.midi=new pg(e,this.keyboardHelper,function(e){return t.updateBpm(e)}),this.midi.setStartCallback(function(){return t.play()}),this.midi.setStopCallback(function(){return t.stop()})}},{key:"hasMultipleSequencerEnginesPlaying",value:function(){var e=this.store.getState().sequencer.isPlaying;return Object.keys(e).filter(function(t){return e[t]}).length>1}},{key:"hasAtleastOneSequencerEnginePlaying",value:function(){var e=this.store.getState().sequencer.isPlaying;return Object.keys(e).filter(function(t){return e[t]}).length>0}},{key:"state",get:function(){return this.store.getState()}},{key:"isLoading",get:function(){var e=this.state.sequencer.loadingSequence;return Object.keys(e).some(function(t){return!0===e[t]})}},{key:"sustain",value:function(e){var t,n=this,r=pw(this.tracks.filter(function(e){return e.isEnabled}));try{var a=function(){var r=t.value,a=void 0;if(r.getTrackType()!==W.b)return"continue";var i=r.instrument;a=i.getInstrumentType()===te.f?i.ampEnvelope:i;var o=n.keyboardHelper,s=0;for(var c in 127===e?(a.releaseParameter.set(2500,!0),s=2500):(a.releaseParameter.set(100,!0),s=100),o.release=s,o.recordedTriggers){var u=o.recordedTriggers[c];u.recordedTriggers&&u.recordedTriggers.forEach(function(e){return e.release=s})}};for(r.s();!(t=r.n()).done;)a()}catch(i){r.e(i)}finally{r.f()}}},{key:"isShowingPianoRoll",value:function(){return this.state.sequencer.showPianoRoll&&this.state.arrangement.bottomMode===Ug.b}},{key:"isAnyTrackEnabled",value:function(){var e,t=pw(this.subSequences);try{for(t.s();!(e=t.n()).done;){if(e.value.tracks.some(function(e){return e.isEnabled}))return!0}}catch(n){t.e(n)}finally{t.f()}return!1}},{key:"sendPlayChange",value:function(e){this.subSequences.forEach(function(t){t.findNodeByName("mixbuttons").forEach(function(t){t.effect.sendMessage("playing",e?1:0)})})}},{key:"handleStopMode",value:function(){this.subSequences.forEach(function(e){e.findNodeByName("mixbuttons").forEach(function(e){e.effect.handleStop(),e.effect.sendMessage("playing",0)})})}}]),n}(Object(ot.a)(function(e){return function(e){Object(u.a)(n,e);var t=Yg(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"initAudition",value:function(){var e=this,t=new ht(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);t.setSends(this.sends),t.setupEffects(),t.trackNumber=-2,t.trackNode.connect(re.a.Master),this.auditionTrack=t}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=dw(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"rolling",get:function(){return this.store.getState().sequencer.trackRolling}},{key:"trackRolling",set:function(e){this.state.midi.midiMapMode===Ub.b&&this.store.dispatch(Object(J.o)(new lw(this))),this.store.dispatch(Object(J.De)(e)),this.rollingManager.clear()}},{key:"setSequenceRolling",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.rollingResolution,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.automationStep,a=arguments.length>4?arguments[4]:void 0;if(Object(Pg.d)(e,t.resolution,t.isTriplet),this.state.midi.midiMapMode===Ub.b&&this.store.dispatch(Object(J.o)(new hw(this))),e){if(e!=this.isSequenceRolling||a){var i=t.getNumberOfStepsAtBaseResolution();for(var o in r-=r%i,this.subSequences)this.subSequences[o].initPatternBuffer(r),this.subSequences[o].tracks.forEach(function(e){return e.initPatternBuffer(r)});n&&(this.trackRolling=!0)}}else this.schedulePatternBufferClear=!0;if(this.isSequenceRolling=e,!n)if(this.store.getState().mix.isRecordingMix){var s=this.resolution;this.mix.addEvent(new $g.a(e,s))}else this.store.getState().mix.isPlayingMix&&this.mix.holdEvent(new $g.a(e,this.resolution))}},{key:"onResolutionUpdate",value:function(e){if(this.isSequenceRolling){var t=e.getNumberOfStepsAtBaseResolution(),n=this.trackStep;for(var r in n-=n%t,this.subSequences)this.subSequences[r].initPatternBuffer(n),this.subSequences[r].tracks.forEach(function(e){return e.initPatternBuffer(n)})}}},{key:"isSequenceRollingAtStep",value:function(e){if(this.store.getState().mix.isPlayingMix){var t=this.mix.getValue(kb.k,e);return this.mix.getValue(kb.k,e-1),t}return this.isSequenceRolling}},{key:"sequenceRolling",set:function(e){this.setSequenceRolling(e)}},{key:"scheduleSequenceRollingIfNeeded",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.store.getState(),this.schedulePatternBufferClear?(e.patternRollStepNumber=void 0,this.schedulePatternBufferClear=!1,!1):!(!this.isSequenceRolling||!r&&!e.rolling)&&!(!r&&void 0!==e.subSequence.higherRolling&&!1===e.subSequence.higherRolling)&&(e.updatePatternRollStepNumber(this.rollingResolution),!0)}},{key:"rollingResolution",get:function(){if(this.store.getState().mix.isPlayingMix){var e=this.mix.getEvent(kb.k,this.automationStep);if(void 0!==e)return e.getSubEvent(this.automationStep).getValue()}return this.resolution},set:function(e){if(this.store.getState().mix.isRecordingMix){var t=this.mix.getEvent(kb.k,this.automationStep),n=new JO.a(e);n.step=this.automationStep,t.addSubEvent(n)}else this.state.mix.isPlayingMix&&this.mix.holdEvent(new JO.a(e))}},{key:"resolution",get:function(){return this.state.sequencer.resolution},set:function(e){var t=e.resolution!==this.resolution.resolution||e.isTriplet!=this.resolution.isTriplet;if(this.resolution.isTriplet!==e.isTriplet)for(var n in this.subSequences)for(var r in this.subSequences[n].tracks){var a=this.subSequences[n].tracks[r];a.pattern.needsSync&&a.pattern.syncBuckets(this.resolution.isTriplet)}this.rollingResolution=e,this.state.midi.midiMapMode===Ub.b&&this.store.dispatch(Object(J.o)(new sO(this,e))),this.store.dispatch(Object(J.gd)(e)),(t||e.resolution>=32||e.isTriplet)&&this.onResolutionUpdate(e)}},{key:"displayResolution",get:function(){return this.state.sequencer.displayResolution}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Jg(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).inputTriggers=[],e.inputTracks=[],e.resolvedInputTriggers=[],e.otherModules=[],e.otherTriggers=[],e}return Object(s.a)(n,[{key:"scheduleStep",value:function(e,t){var n=this;e=this.handleLatency(e);var r=this.storeStepAndTime(t,e);this.handleMixSessionStep(e),this.higherOrderSequencer.onNewStep(this.trackStep,e),this.applyHigherOrderSequencing(this.trackStep),this.scenes.onNewStep(this.trackStep),this.mixButtons.forEach(function(e){return e.sendCurrentStepNumber(n.trackStep)}),void 0!==this.stepOneCallback&&(this.startedTransportExplicitly&&15==t?this.stepOneCallback(e):this.startedTransportExplicitly||0!=t||this.stepOneCallback(e)),t=this.trackStep,this.scripting&&this.scripting.onStepReached(t),t%this.length===0&&this.scheduleAnyMasterResampling(e),this.scheduleParametersToRecord(t),r?this.scheduleParameterAutomations(t,e,!0):this.isLooping&&t===this.loopStart?this.scheduleParameterAutomations(t,e,!0):this.scheduleParameterAutomations(t,e,!1),this.scheduleSubSequences(t,e),this.metronome&&this.scheduleTrack(this.metronome,t,e).forEach(function(e){return n.metronome.trigger(e.stepData,e.time,t)}),this.scheduleSamplesRolling(t,e),t%=this.length;var a=this.storeLastStepAndTime(t,e);this.clockSync.onTick(this.getMilliseconds(e),t),this.midi&&this.midi.onTick(this.getMilliseconds(e),t,this.resolution),Object.keys(this.parametersToUpdate).length>0&&(this.dispatch(Object(J.xb)(this.parametersToUpdate)),this.parametersToUpdate={}),re.a.context.setTimeout(function(){n.playing&&(n.lastTrackStepReal=a,n.previousStepReal=n.trackStepReal,n.previousStepTimeReal=n.currentStepTime,n.trackStepReal=a,n.currentStepTime=e,n.store.dispatch(Object(J.db)(n.getSequenceId(),t,n.trackStep)))},this.getMilliseconds(e)/1e3)}},{key:"scheduleSubSequences",value:function(e,t){var n=this,r=this.higherOrderSequencer,a=r.inputModules,i=this.inputTriggers,o=this.inputTracks,s=this.resolvedInputTriggers,c=this.otherModules,u=this.otherTriggers;i.length=0,o.length=0,s.length=0,c.length=0,u.length=0;var l,f=Bg(a);try{for(f.s();!(l=f.n()).done;){var d=l.value;if(r.shouldPlayModule(d)){o.push(d.tracks);var p=r.getStepForModule(e,d);i.push(this.scheduleTracks(Object(h.a)(d.tracks),p,t))}}}catch(E){f.e(E)}finally{f.f()}i.forEach(function(r,a){return s.push(Cg(n,o[a],r,t,e))});var v=s.flatMap(function(e,t){return a[t].tracks.flatMap(function(t){var n=t.trackNumber;return e[n]})}).filter(function(e){return e});r.input(v),r.output(t,e),this.subSequences.forEach(function(e){a.includes(e)||c.push(e)});var m,y=[],b=Bg(c);try{for(b.s();!(m=b.n()).done;){var g=m.value;if(this.state.mix.isPlayingMix&&g.updateVolumeFromAutomation(e),r.shouldPlayModule(g)){var O=this.higherOrderSequencer.getStepForModule(e,g);g.schedulePads(t,O),this.scheduleSubSequenceZObjects(g,t,O);var j,k=this.scheduleTracks(Object(h.a)(g.tracks),O,t),w=Bg(r.getOutputForModule(g));try{for(w.s();!(j=w.n()).done;){var x=j.value;u.push(k),y.push(x.tracks)}}catch(E){w.e(E)}finally{w.f()}}}}catch(E){b.e(E)}finally{b.f()}u.forEach(function(r,a){return Cg(n,y[a],r,t,e)});var S,P=Bg(this.subSequences);try{for(P.s();!(S=P.n()).done;)S.value.sendPadMessages(t)}catch(E){P.e(E)}finally{P.f()}}},{key:"scheduleSubSequenceZObjects",value:function(e,t,n){if(n=Math.floor(n*e.playhead.speedFactor),e.lastPatternStep!==n)if(e.lastPatternStep=n,this.scheduleSequenceRollingIfNeeded(e,n,t,!0)){var r=this.resolution,a=r.getNumberOfStepsAtBaseResolution(),i=e.patternRollStepNumber+n%a;if(!r.isTriplet)return void e.scheduleZObjects(t,i);var o=Math.floor(i);re.a.Time("32n"),i=o;var s,c=Bg(Object(Lg.a)(i,r,!0));try{for(c.s();!(s=c.n()).done;){var u=s.value;e.scheduleZObjects(t+u.time,i)}}catch(l){c.e(l)}finally{c.f()}}else e.scheduleZObjects(t,n)}},{key:"scheduleTracks",value:function(e,t,n){var r=this;if(void 0!==e){e=function(e){return e}(e);var a,i={},o=Bg(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;this.setGroupBits(s,t)}}catch(u){o.e(u)}finally{o.f()}for(var c=0;c<e.length;c++)try{!function(){var a=e[c],o=r.scheduleTrack(e[c],t,n);i[a.trackNumber]=o,o.forEach(function(e){return Object(Pg.e)(a,e)})}()}catch(u){console.log("caught error while scheduling track err = "),console.log(u)}return i}}},{key:"scheduleTrack",value:function(e,t,n){e.subSequence.isTrack&&e.scheduleTrackPatternChangeIfAny(t);var r=e.getPatternStep(t,!0);e.sendMessage("pattern progress",100*r/e.length);var a=Math.floor(r),i=new re.a.Time("32n")*(r-a);e.isEnabled;try{e.pattern.mix.scheduleNext(a,n,this)}catch(x){console.log("caught an error while scheduling pattern events = "),console.log(x)}if(e.scheduleAnyRecording(r,n),this.deleting&&e.deleteAtStep(a),0==a&&(this.scheduleAnyFrozenTrackPlaying(e,n),this.scheduleAnyTrackRecording(e,n),this.scheduleAnyTrackResampling(e,n),this.scheduleAnyAudioTrackPlaying(e,n),this.scheduleAnyStepGroups(e,n)),this.scheduleSequenceRollingIfNeeded(e,a,n)){var o=e.getFactoredResolution(),s=o.getNumberOfStepsAtBaseResolution(),c=e.patternRollStepNumber+r%s;if(c%=e.pattern.stepBuckets.length,!o.isTriplet){var u,l=this.getTrackTriggers(e,n,c,e.pattern,r),f=Bg(l);try{for(f.s();!(u=f.n()).done;)u.value.rolledStepNumber=c}catch(x){f.e(x)}finally{f.f()}return l}var d=Math.floor(c),p=(c-d)*re.a.Time("32n");e.isPlayheadReversed()&&(p*=-1),c=d;var v,m=[],y=0,b=Bg(Object(Lg.a)(c,o,!0));try{for(b.s();!(v=b.n()).done;){var g=v.value;m=[].concat(Object(h.a)(m),Object(h.a)(this.getTrackTriggers(e,n-p+g.time,c,e.pattern,r,0===y))),y++}}catch(x){b.e(x)}finally{b.f()}for(var O=0,j=m;O<j.length;O++)j[O].rolledStepNumber=c;return 0===m.length?this.getTrackTriggers(e,n-p,c,e.pattern,r):m}if(!e.isMetronome&&e.speedFactor>1){for(var k=[],w=1;w<=e.speedFactor;w++)k=[].concat(Object(h.a)(k),Object(h.a)(this.getTrackTriggers(e,n+i,r,e.pattern,r))),n+=new re.a.Time("32n"),r++;return k}return this.getTrackTriggers(e,n+i,r,e.pattern,r)}},{key:"getTrackTriggers",value:function(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=e.isPlayheadReversed(a),s=n,c=a,u=void 0;e.isWarped()&&0===this.trackStep&&(n=0,a=0,u={stepNumber:s,actualStepNumber:c});var l=r.getBucket(n);i&&e.onNewStep(n,t);var f=l?l.steps:[],d=[];if(e.isFrozen||e.getTrackType()===W.a)0===n&&e.triggerFrozenSample(t);else for(var p in f){var v=f[p];o&&(p*=-1);var m=new re.a.Time(t)+Vg*p,y=v.getPolyphony();for(var b in y=[].concat(Object(h.a)(y.filter(function(e){return!e.slide})),Object(h.a)(y.filter(function(e){return e.slide})))){var g=y[b];if(e.deleting)d.push(g);else if(!this.isStepMasked(g)){var O=this.transformStep(g,m,a),j=O.time,k=O.step;k.slide||e.handlePLockedAutomations(k,j),e.midiEffects.input(k,j,a,u)}}}if(e.deleting)return d.length>0&&this.operationManager.dispatch(Object(Le.j)(e,d)),[];var w=e.midiEffects.output(t,n,a).filter(function(e){return e.stepData&&e.stepData.track});return e.disabled?[]:this.shouldPlayStep(a)?w:[]}},{key:"storeLastStepAndTime",value:function(e,t){this.nextStepScheduled=e;var n=this.getLoopedStep(this.trackStep+1),r=this.trackStep;this.lastTrackStep=this.trackStep,this.trackStep=n,this.previousStepTime=this.latestStepTime,this.latestStepTime=t,new re.a.Time(this.latestStepTime);var a=this.currentStep;return this.currentStep=e,this.previousStep=a,r}},{key:"storeStepAndTime",value:function(e,t){var n=this.firstStep;if(this.firstStep){var r,a=Bg(this.subSequences);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.lfosTrack.start(t),i.tracks.filter(function(e){return e.lfosTrack}).forEach(function(e){return e.lfosTrack.start(t)})}}catch(o){a.e(o)}finally{a.f()}this.firstStep=!1}return this.lastTrackStep===this.trackStep&&(this.trackStep+=1),this.nextTimeScheduled=t,this.automationStep,this.automationStep=this.getLoopedStep(this.trackStep),n}},{key:"shouldPlayStep",value:function(e){return e%=32,e=Math.floor(e/2),this.state.steps.masterStepToggles[e]}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Gk(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"setGroupBits",value:function(e,t){if(0===e.getPatternStep(t)){var n,r=Hk(e.stepGroups);try{for(r.s();!(n=r.n()).done;){var a=n.value;Object(st.f)(a)}}catch(i){r.e(i)}finally{r.f()}}}},{key:"scheduleAnyStepGroups",value:function(e,t){e.stepGroups.length>0&&(e.pattern.transform(),this.state.groups.stepsGroupMode&&e.subSequence===this.currentSubSequence&&e.updateSteps())}},{key:"transformStep",value:function(e,t,n){return e.group?Object(st.i)(e,e.group,t,n):{step:e,time:t}}},{key:"isStepMasked",value:function(e){var t=e.probability/100,n=Math.random();return!e.on||n>t||Object(st.g)(e)}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Wk(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"resetAutomationParameters",value:function(){}},{key:"clearScheduledAutomations",value:function(){var e=this.state.automation.automationSchedulers[this.sequenceId]||{},t=this.state.automation.automationMixSchedulers[this.sequenceId]||{},n=Object(d.a)({},e,t),r={};for(var a in n)if(n[a].clear(),n[a].parameter){var i=n[a].parameter.updateRedux();if(i){var o=i.id,s=i.value;r[o]=s}}Object.keys(r).length>0&&this.store.dispatch(Object(J.xb)(r))}},{key:"scheduleParameterAutomations",value:function(e,t,n){this.multiSequencerEngine&&(e=this.multiSequencerEngine.trackStep);var r=this.state.automation.automationSchedulers[this.sequenceId]||{},a=this.state.mix.isPlayingMix&&this.state.automation.automationMixSchedulers[this.sequenceId]||{},i=Object(d.a)({},r,a),o={};for(var s in i){var c=i[s],u=c.parameter;if(void 0!==u&&(!c.isMix||this.state.mix.isPlayingMix)){var l=u.track,f=this.length;if(void 0!==l){if(l.instrumentRack&&(l=l.instrumentRack),void 0===l.pattern)continue;f=l.length}if(c.isMix?(n&&c.start(t),0===c.eventIds.length&&c.automations.some(function(t){return t.step>=e&&t.step<e+32})&&c.schedule(e,t,Math.max(0,t-.001))):e%f===0&&c.schedule(e,t),u.onNewStep(e),u.context&&u.context.macro){var h=u.context.macro.subMacros;for(var p in h){var v=h[p].parameter;v.onNewStep(e),o[v.id]=v.getAtStep(e)}}this.trackStep%2===0&&-1===this.state.automation.parameterSliderDown.indexOf(u)&&c.automations.length>0&&(c.isMix&&!c.hasEventsAfterStep(e)||(o[u.id]=c.getValueAtStep(e)))}}this.trackStep%2===0&&Object.keys(o).length>0&&this.store.dispatch(Object(J.xb)(o))}},{key:"updateAutomationRedux",value:function(e,t){this.store.dispatch(Object(J.k)(e,t))}}]),n}(e)})(Vk)),Ow=function(){return 60+Math.floor(120*Math.random())},jw=gw,kw=n(834),ww=n(608),xw=n(412),Sw=(n(982),n(521));function Pw(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ew(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ew(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ew(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Tw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Aw=rr.a.presets,Mw=function(e){Object(u.a)(n,e);var t=Tw(n);function n(e,r,a,i,s,c){var u;return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c)).recordingsToSave=[],u.loadedSequenceId=void 0,u.samplesToSync=[],u.loadedSamples={},u.editHistory=[],u}return Object(s.a)(n,[{key:"handleSaveHook",value:function(){var e,t=Pw(this.currentSubSequence.findNodeByName("save.hook"));try{for(t.s();!(e=t.n()).done;){e.value.sendMessageToInlet([S.a])}}catch(n){t.e(n)}finally{t.f()}}},{key:"save",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Sw.c,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,u=void 0!==o&&n!=Sw.c?o.guildId:0;return new Promise(function(){var l=Object(i.a)(a.a.mark(function i(l,f){var h,d,p,v,m;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.handleSaveHook(),h=t.currentSubSequence,d=t.sequenceId,a.next=5,t.saveAnyNewRecordings(u,r,void 0!==s);case 5:for(v in p={hasPatterns:!0,subSequences:t.getSubSequences(),sendVolumes:t.getSendVolumesToSave(),bpm:t.bpm,swing:t.swing,resolution:Me.a.baseResolution.toString(),gateMode:t.gateMode,scripting:t.scripting.getJson(),parameterLocks:t.parameterLocks.map(function(e){return e.getJson()}),effectsCollapsed:t.state.effects.effectCollapsed,cableSegmentations:t.state.spatial.cableSegmentations,modulesCollapsed:t.state.pads.modulesCollapsed,effectStarred:t.state.effects.effectStarred,mix:t.mix.getJson(),sends:t.sends.getJson(),patternColors:t.store.getState().toolbar.patternColors,lfos:t.lfos.map(function(e){return e.getJson()}),envelopes:t.envelopes.map(function(e){return e.getJson()}),lfoPatternLocks:t.state.tracks.lfoPatternLocks,envelopePatternLocks:t.state.tracks.envelopePatternLocks,hiddenObjects:t.state.spatial.hiddenObjects,theme:t.state.sequencer.theme,effectPatternLocks:t.state.effects.effectPatternLocks,patternLocks:t.state.sequencer.patternLocks,trackPatternLocks:t.state.tracks.trackPatternLocks,scenes:t.scenes.getJson(),windowPositions:Iw(t.state.windows.windowPositions,t),presentationWindowPositions:t.state.windows.presentationWindowPositions,presentationMode:t.state.spatial.presentationMode,higherOrderSequencer:t.higherOrderSequencer.getJson(),inletConnections:Nw(t.state.windows.inletConnections,t),lockedObjects:t.state.spatial.lockedObjects,samplesMetadata:Object(C.b)(t),pluginsLoaded:t.state.plugins.pluginsLoaded&&t.state.plugins.pluginsLoaded.map(function(e){return e.id}),pulledEffects:t.state.effects.pulledEffects.map(function(e){return e.type&&!e.getEffectType?{x:e.x,y:e.y,width:e.width,height:e.height,id:e.id||e.instrument.id,instrumentId:e.instrument.id,type:e.type,subType:e.subType}:e.id}),masterChannel:t.channelMixer.masterChannel.getJson()},s&&(p.nftZObject=s.id),t.state.sequencer.wallpaper&&(p.wallpaper=t.state.sequencer.wallpaper),p)p[v]&&0!==p[v].length||delete p[v];p=Object(ue.b)(p,"bpmParameter",t.bpmParameter),p=Object(ue.b)(p,"swingParameter",t.swingParameter),t.switchToSubSequence(h.id),m=new kw.a(!0),n===Sw.b?rr.a.crypto.encryptAndSave(e,p,t.loadedSequenceId,r).then(function(e){t.update(e),t.saveProjectMetadata(e),l(e)}):n===Sw.a?rr.a.guildSequences.newGuildSequence(p,e,t.loadedSequenceId,o.guildId).then(function(e){t.update(e),t.saveProjectMetadata(e),l(e)}):n===Sw.c&&m.save(e,p,t.loadedSequenceId,t.getSamples(),r,c,t.bpm).then(function(n){var a=t.sequenceId;t.update(n.ipfsHash),r&&t.saveProjectMetadata(n.ipfsHash,a,t.getSamples(),e),t.loadedSequenceId=n.ipfsHash,t.updateAutomationRedux(d,t.loadedSequenceId),l(c?{ipfsHash:n.ipfsHash,json:p}:n.ipfsHash)});case 15:case"end":return a.stop()}},i)}));return function(e,t){return l.apply(this,arguments)}}())}},{key:"getTrackMidiEffectsToSave",value:function(){var e=[];for(var t in this.tracks)e.push(this.tracks[t].midiEffects.getJson());return e}},{key:"getTrackLiveEffectsToSave",value:function(){var e=[];for(var t in this.tracks)e.push(this.tracks[t].liveEffects.getJson());return e}},{key:"getTrackEffectsToSave",value:function(){var e=[];for(var t in this.tracks){for(var n=[],r=this.tracks[t].effects,a=0;a<r.length;a++)n.push(r[a].getJson());e.push(n)}return e}},{key:"getTrackEffectsChainsToSave",value:function(){var e=[];for(var t in this.tracks)e.push(this.tracks[t].effectsChains.map(function(e){return e.getJson()}));return e}},{key:"getSubSequences",value:function(){var e=[];for(var t in this.subSequences){this.switchToSubSequence(this.subSequences[t].id,!1);for(var n=[],r=[],a=0;a<this.subSequences[t].tracks.length;a++){var i=this.subSequences[t].tracks[a],o=V(i),s=o.patterns,c=o.trackData;r.push(c),n.push(s)}var u=this.subSequences[t].groups.getJson(),l=this.subSequences[t].lfosTrack.lfos.map(function(e){return e.getJson()}),f=this.subSequences[t].envelopesTrack.envelopes.map(function(e){return e.getJson()});e.push(Object(d.a)({},this.subSequences[t].getJson(),{tracks:n,tracksData:r,lfos:l,envelopes:f,groups:u,tracksPatterns:this.getTracksPatternsToSave(),tracksEffectsChains:this.getTrackEffectsChainsToSave(),tracksMidiEffects:this.getTrackMidiEffectsToSave(),tracksLiveEffects:this.getTrackLiveEffectsToSave(),tracksParameters:this.getTracksParametersToSave(),sendVolumes:this.getSendVolumesToSave(),mix:this.subSequences[t].mix.getJson(),id:this.subSequences[t].id,midiEffects:this.subSequences[t].midiEffects.getJson(),pads:this.subSequences[t].getPadsJson(),sequencers:this.subSequences[t].getSequencersJson(),zobjects:this.subSequences[t].getZObjectsJson()}))}return e}},{key:"getSendVolumesToSave",value:function(){return this.tracks.map(function(e){return e.getSendNodes().map(function(e){return e.volume.value})})}},{key:"getTracksPatternsToSave",value:function(){return this.tracks.map(function(e){return e.patterns.map(function(e){return e.getJson()})})}},{key:"getTracksParametersToSave",value:function(){return this.tracks.map(function(e){return e.trackData.getJson()})}},{key:"loadSubSequences",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,o,s,c=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=[],0===this.tracks.length&&this.subSequences.length<=1&&(this.subSequences.forEach(function(e){return e.dispose()}),this.subSequences=[]),o=a.a.mark(function e(o){var s,u,l,f,h,d,p;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n||parseInt(o)===n){e.next=2;break}return e.abrupt("return","continue");case 2:return s=t.subSequences[o],u=s.id,l=c.newSubSequence(u),f=s.tracks.map(function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ma(c,s.tracksData[n],t,n,l);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),e.next=8,Promise.all(f);case 8:for(d in h=e.sent,s.tracksData)"chokes"in(p=s.tracksData[d])&&h[d].chokes.fromJson(p.chokes,h);h.forEach(function(e){return l.addTrack(e)}),l.fromJson(s),r.push(l);case 13:case"end":return e.stop()}},e)}),e.t0=a.a.keys(t.subSequences);case 4:if((e.t1=e.t0()).done){e.next=12;break}return s=e.t1.value,e.delegateYield(o(s),"t2",7);case 7:if("continue"!==e.t2){e.next=10;break}return e.abrupt("continue",4);case 10:e.next=4;break;case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAllRecordingsToSave",value:function(){var e=this.recordingsToSave.filter(function(e){return void 0!==e.audioBuffer});for(var t in this.subSequences){var n=this.subSequences[t];for(var r in n.tracks)e=[].concat(Object(h.a)(e),Object(h.a)(n.tracks[r].frozenSamplesToSave))}return[].concat(Object(h.a)(e),Object(h.a)(this.samplesToSync))}},{key:"saveAnyNewRecordings",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f,d,p,v,m,y,b,g,O,j,k,w,x,S,P,E,T,A,M,R=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=R.length>1&&void 0!==R[1]&&R[1],r=R.length>2?R[2]:void 0,i=this.recordingsToSave.filter(function(e){return void 0!==e.audioBuffer}),e.t0=a.a.keys(this.subSequences);case 4:if((e.t1=e.t0()).done){e.next=19;break}o=e.t1.value,s=this.subSequences[o],e.t2=a.a.keys(s.tracks);case 8:if((e.t3=e.t2()).done){e.next=17;break}if(c=e.t3.value,0!==t||!n&&!r||window.installation){e.next=14;break}if(!r){e.next=14;break}return e.next=14,s.tracks[c].makePublicIfNeeded();case 14:i=[].concat(Object(h.a)(i),Object(h.a)(s.tracks[c].frozenSamplesToSave)),e.next=8;break;case 17:e.next=4;break;case 19:for(f in u=new ww.a,l=[],i){for(d=i[f],p=d.name,v=["","","",""],m=d.videoId||"",y=d.getTagsToSave(),b=(new Date).getFullYear(),y.length>4&&(y=y.slice(0,4)),g=y.length;g<4;g++)y.push("");"",O=d.getId(),l.push({ipfsHash:O,title:p,videoId:m,tags:y,styles:v,country:"",year:b,coverArt:void 0,discogsId:void 0})}for(j in this.samplesToSync){for(k=this.samplesToSync[j],w=k.name,x=["","","",""],S=k.videoId||"",(P=k.tags).length>4&&(P.reverse(),P=P.slice(0,4)),E=P.length;E<4;E++)P.push("");T=k.year||2020,A=k.country||"",M=k.getId(),l.push({ipfsHash:M,title:w,videoId:S,tags:P,styles:x,country:A,year:T,coverArt:k.coverArtHash,discogsId:k.discogsId})}if(0!==l.length){e.next=25;break}return e.abrupt("return");case 25:0!==t?rr.a.newEncryptedSamples(l,t,u):rr.a.newSamplesWithMetadata(l,0);case 26:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadTrackPatternLocks",value:function(e){var t=Object(d.a)({},e.trackPatternLocks);e.tracks&&((t={})[this.currentSubSequence.id]=e.trackPatternLocks),t=Object(d.a)({},this.state.tracks.trackPatternLocks,t),this.store.dispatch(Object(J.u)(t))}},{key:"loadTrackMidiEffects",value:function(e,t,n){if(void 0!==e.tracksMidiEffects){var r=n[t].midiEffects.fromJson(e.tracksMidiEffects[t]);return{effects:n[t].midiEffects.effects,bulk:r}}return{effects:[],bulk:{}}}},{key:"loadTrackEffects",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o,s,c,u,l,f,h,p,v,m,y,b;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],o=r[n].effectsChains[0],s={},void 0===t.tracksEffects){e.next=17;break}c=0;case 5:if(!(c<t.tracksEffects[n].length)){e.next=14;break}return e.t0=i,e.next=9,Object($.b)(t.tracksEffects[n][c],r,this,n);case 9:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 11:c++,e.next=5;break;case 14:o.updateEffects(i.map(function(e){return e.effect})),e.next=47;break;case 17:if(void 0===t.tracksEffectsChains){e.next=45;break}u=r[n],l=t.tracksEffectsChains[n],f=[],e.t2=a.a.keys(l);case 22:if((e.t3=e.t2()).done){e.next=41;break}h=e.t3.value,p=new Y.a(u.gainNode,u.trackNode,(new X.a).forTrack(u),this),v=l[h],e.t4=a.a.keys(v);case 27:if((e.t5=e.t4()).done){e.next=37;break}return m=e.t5.value,y=v[m],e.next=32,Object($.c)(y,r,this,n);case 32:b=e.sent,p.addEffect(b.effect),s=Object(d.a)({},s,b.bulk),e.next=27;break;case 37:p.updateEffects(),f.push(p),e.next=22;break;case 41:u.effectsChains.forEach(function(e){return e.dispose()}),u.effectsChains=f,e.next=47;break;case 45:i=Object(ee.a)(this),o.updateEffects(i);case 47:return e.abrupt("return",{effects:i,bulk:s});case 48:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadSubSequenceMix",value:function(e,t){t.mix.loadFromJson(e.mix,this)}},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){return n()},e);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getSleepTime",value:function(){return this.state.mix.isPlayingMix?100:0}},{key:"loadSubSequencePatterns",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o,s,c,u=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:!(u.length>3&&void 0!==u[3])||u[3],i={},o=n.tracks,s=0;case 4:if(!(s<t.tracks.length)){e.next=11;break}return c=o[s],e.next=8,Ra({sequencerEngine:this,track:c,tracks:o,patterns:t.tracks[s],trackData:t.tracksData[s],trackEffects:t.tracksEffects&&t.tracksEffects[s],trackEffectChains:t.tracksEffectsChains&&t.tracksEffectsChains[s],trackMidiEffects:t.tracksMidiEffects?t.tracksMidiEffects[s]:[],patternParameters:t.tracksPatterns[s],subSequence:n});case 8:s++,e.next=4;break;case 11:return e.abrupt("return",i);case 12:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadSubSequenceTracksParameters",value:function(e,t){for(var n in e.tracksParameters){var r=e.tracksParameters[n];t[n].trackData.loadFromJson(r,void 0,!1,!1,this),t[n].pattern.calculateFills(r)}}},{key:"loadSubSequencePatternParameters",value:function(e,t){for(var n in t)for(var r=t[n],a=0;a<r.patterns.length;a++)r.patterns.length>a&&r.patterns[a].loadFromJson(e.tracksPatterns[n][a])}},{key:"loadSubSequenceEffects",value:function(e,t){for(var n in t){var r=t[n];this.setupNewTrack(r,!0,!0,!1);for(var a=r.getSendNodes(),i=0;i<e.sendVolumes[n].length;i++)a[i]&&(a[i].volume.value=e.sendVolumes[n][i]);void 0!==e.tracksLiveEffects&&r.liveEffects.fromJson(e.tracksLiveEffects[n])}if(e.midiEffects){var o=this.currentSubSequence.midiEffects.fromJson(e.midiEffects);this.dispatch(Object(J.xb)(o))}}},{key:"getMaxSubSequenceId",value:function(){var e=-1;for(var t in this.subSequences){var n=this.subSequences[t].id;n>e&&(e=n)}return e}},{key:"loadSubSequenceLFOs",value:function(e,t){var n={};for(var r in e.lfos){var a=e.lfos[r];n=Object(d.a)({},n,t.lfos[parseInt(r)].lfo.fromJson(a))}return n}},{key:"loadSubSequenceEnvelopes",value:function(e,t){for(var n in e.envelopes){var r=e.envelopes[n];t.envelopes[parseInt(n)].fromJson(r)}}},{key:"normalizeSubSequenceIds",value:function(e){var t=this,n={},r=function(r){var a=e.subSequences[r].id;Cw(a)||t.subSequences.some(function(e){return e.id===a})?n[a]=Object(q.uuid)():n[a]=a};for(var a in e.subSequences)r(a);this.convertSubSequenceIds(e,n)}},{key:"convertSubSequenceIds",value:function(e,t){for(var n in e.subSequences){var r=e.subSequences[n];void 0!==t[r.id]&&(r.id=t[r.id]),e.subSequences[n]=r}var a={},i={},o={},s=new Set(Object.values(t));for(var c in e.trackPatternLocks){if(void 0!==t[c])a[t[c]]=e.trackPatternLocks[c];else s.has(c)||(a[c]=e.trackPatternLocks[c])}for(var u in e.envelopePatternLocks){if(void 0!==t[u])o[t[u]]=e.envelopePatternLocks[u];else s.has(u)||(o[u]=e.envelopePatternLocks[u])}for(var l in e.lfoPatternLocks){if(void 0!==t[l])i[t[l]]=e.lfoPatternLocks[l];else s.has(l)||(i[l]=e.lfoPatternLocks[l])}e.trackPatternLocks=a,e.lfoPatternLocks=i,e.envelopePatternLocks=o}},{key:"loadSequence",value:function(e,t){var n=this;return this.setLoadingProgress(e,0),new Promise(function(){var r=Object(i.a)(a.a.mark(function r(o,s){var c,u,l,f,h,p;return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n.store.dispatch(Object(J.fc)(e,!0)),r.next=3,Ia.a.getAccount();case 3:if(c=r.sent,u=void 0,r.prev=5,window.isNFT||N.a.getItem("projectHash")!==e){r.next=10;break}u=N.a.getItem("projectData"),r.next=36;break;case 10:if(window.isNFT||!N.a.getItem("sequence."+e)){r.next=14;break}u=N.a.getItem("sequence."+e),r.next=36;break;case 14:if(void 0===c){r.next=36;break}return r.next=17,rr.a.guildSequences.getGuildSequence(e);case 17:if(void 0!==(l=r.sent)){r.next=23;break}return r.next=21,rr.a.encryption.getSequencesSharedWithUser(e);case 21:l=(l=r.sent)[0];case 23:if(void 0===l){r.next=29;break}return r.next=26,rr.a.crypto.fetchAndDecrypt(e,l);case 26:u=r.sent,r.next=36;break;case 29:return r.next=31,rr.a.encryption.getEncryptedSequenceIfAny(e);case 31:if(void 0===(f=r.sent)){r.next=36;break}return r.next=35,rr.a.crypto.fetchAndDecrypt(e,f);case 35:u=r.sent;case 36:r.next=40;break;case 38:r.prev=38,r.t0=r.catch(5);case 40:h=!1,0==n.tracks.length&&(h=!0),p=new kw.a(!Cw(e),Cw(e)?e:void 0,Cw(e)?void 0:e,u),void 0===t&&p.loadTitle().then(function(e){n.store.dispatch(Object(J.Hd)(e))}),n.dispatch(Object(J.Y)(!1)),p.load().then(function(){var r=Object(i.a)(a.a.mark(function r(i){var s,c,u,l,f,p,v,m,y,b,g,O,k,w,x,S,P,E,T,A,M,R,C,N,q,_,D,F,L,B,z,V,H,U,G,W,K,Q,Z,Y,$,X,ee,te,ne,re,ae,ie,oe,se,ce,le,fe;return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(void 0===n.songId){r.next=4;break}return r.next=3,j(n.songId,i,n);case 3:i=r.sent;case 4:if(n.bulkConnections={},n.loadedSequenceId=e,void 0===t&&(n._wallpaper=i.wallpaper),i.wallpaper&&(window.exhibit||!window.explore||I.isMobile)&&void 0===t&&n.dispatch(Object(J.Ye)(i.wallpaper)),!((s=Object(xw.a)(i)).length<=18)){r.next=13;break}return r.next=12,Object(xw.b)(s,n.encryptedIpfs,n.getSleepTime(),n);case 12:n.loadedSamples=r.sent;case 13:if(n.setLoadingProgress(e,25),n.normalizeSubSequenceIds(i),n.length,c=Me.a.oldDefaultResolution,i.groups,n.hasAtleastOneSequencerEnginePlaying()||void 0===t&&(n.updateBpm(i.bpm),Object(ue.a)(i,"bpmParameter",n.bpmParameter)),"samplesMetadata"in i&&(window.samplesMetadata=i.samplesMetadata),void 0===i.subSequences){for(l in i.subSequences=[{id:0,tracks:i.tracks,tracksData:i.tracksData,groups:i.groups,envelopes:i.envelopes,lfos:i.lfos,tracksParameters:i.tracksParameters,tracksPatterns:i.tracksPatterns,tracksEffects:i.tracksEffects,tracksMidiEffects:i.tracksMidiEffects,tracksLiveEffects:i.tracksLiveEffects,sendVolumes:i.sendVolumes}],u={},i.tracksData)f=i.tracksData[l],u[l]=f.patternLocks;i.trackPatternLocks=u}return n.normalizeSubSequenceIds(i),"swing"in i&&(n.updateSwing(i.swing),Object(ue.a)(i,"swingParameter",n.swingParameter)),c=Rw(i.resolution),p=!1,"hasPatterns"in i&&(p=!0),h&&(n.playSequence=n.getPlaySequence()),r.next=29,n.loadSubSequences(i,t);case 29:if(v=r.sent,n.loadTrackPatternLocks(i),!("sends"in i)){r.next=34;break}return r.next=34,n.sends.loadFromJson(i.sends,t);case 34:n.setLoadingProgress(e,35),m={},r.t0=a.a.keys(v);case 37:if((r.t1=r.t0()).done){r.next=63;break}return y=r.t1.value,n.setLoadingProgress(e,35+parseFloat(y)/v.length*35),(new Date).getTime(),b=void 0!==t?t:y,n.switchToSubSequence(v[y].id,!1),r.t2=d.a,r.t3={},r.t4=m,r.next=48,n.loadSubSequencePatterns(i.subSequences[b],v[y],c,p);case 48:r.t5=r.sent,m=(0,r.t2)(r.t3,r.t4,r.t5),n.loadSubSequenceTracksParameters(i.subSequences[b],v[y].tracks),n.loadSubSequenceEffects(i.subSequences[b],v[y].tracks),m=Object(d.a)({},m,n.loadSubSequenceLFOs(i.subSequences[b],v[y])),n.loadSubSequenceEnvelopes(i.subSequences[b],v[y]),n.loadSubSequenceMix(i.subSequences[b],v[y]),v[y].loadPadsJson(i.subSequences[b].pads),v[y].loadSequencersJson(i.subSequences[b].sequencers),g=(new Date).getTime(),v[y].loadZObjectsJson(i.subSequences[b].zobjects),O=(new Date).getTime(),console.log("LOADING ZOBJECT DATA took %s ms",O-g),r.next=37;break;case 63:n.switchToSubSequence(v[0].id,!1),n.store.dispatch(Object(J.xb)(m)),"effectPatternLocks"in i&&n.dispatch(Object(J.r)(i.effectPatternLocks)),"lfoPatternLocks"in i&&(k=Object(d.a)({},i.lfoPatternLocks),i.tracks&&((k={})[n.currentSubSequence.id]=i.lfoPatternLocks),k=Object(d.a)({},n.state.tracks.lfoPatternLocks,k),n.store.dispatch(Object(J.t)(k))),n.setLoadingProgress(e,80),"envelopePatternLocks"in i&&(w=Object(d.a)({},i.envelopePatternLocks),i.tracks&&((w={})[n.currentSubSequence.id]=i.envelopePatternLocks),w=Object(d.a)({},n.state.tracks.envelopePatternLocks,w),n.store.dispatch(Object(J.s)(w))),n.gateMode=!("gateMode"in i)||i.gateMode,r.t6=a.a.keys(v);case 71:if((r.t7=r.t6()).done){r.next=79;break}return x=r.t7.value,S=void 0!==t?t:x,n.switchToSubSequence(v[x].id,!1),r.next=77,v[x].groups.fromJson(i.subSequences[S].groups,n);case 77:r.next=71;break;case 79:return n.setLoadingProgress(e,90),"mix"in i&&n.mix.loadFromJson(i.mix,n),n.loadParameterLocks(i),r.next=84,n.sleep(n.getSleepTime());case 84:for(P in n.setLoadingProgress(e,95),v)for(T in(E=v[P]).tracks)void 0===(A=E.tracks[T]).group&&("MIDI"===A.getTrackType()?E.groups.addMidiTrack(A):void 0!==A.sample&&void 0!==A.sample.ipfsHash&&E.groups.addTrack(A)),n.loadPulledEffects(i.pulledEffects);M=Pw(v);try{for(C=function(){var e=R.value;setTimeout(function(){var t=(new Date).getTime();console.log("LOADING LOST PARAMETERS"),e.loadLostParameters(!0);var n,r=Pw(e.tracks);try{for(r.s();!(n=r.n()).done;){var a,i=n.value,o=Pw(i.patterns);try{for(o.s();!(a=o.n()).done;){a.value.getAllSteps().forEach(function(e){return e.loadParameterLocks()})}}catch(c){o.e(c)}finally{o.f()}window.isNFT||i.updateSteps()}}catch(c){r.e(c)}finally{r.f()}var s=(new Date).getTime();console.log("loading lost took %s ms",s-t)},750)},M.s();!(R=M.n()).done;)C()}catch(he){M.e(he)}finally{M.f()}if("lockedObjects"in i&&n.store.dispatch(Object(J.Qe)(i.lockedObjects)),"masterChannel"in i&&void 0===t&&n.channelMixer.masterChannel.fromJson(i.masterChannel),"patternColors"in i)for(N in i.patternColors)n.store.dispatch(Object(J.Lc)(parseInt(N),i.patternColors[N]));"scenes"in i&&n.scenes.fromJson(i.scenes),"effectsCollapsed"in i&&n.dispatch(Object(J.K)(i.effectsCollapsed)),"cableSegmentations"in i&&(console.log("setting cable segmentations=",i.cableSegmentations),n.dispatch(Object(J.Q)(i.cableSegmentations))),"effectStarred"in i&&n.dispatch(Object(J.L)(i.effectStarred)),q=[],_=Pw(n.sends.sends),r.prev=98,_.s();case 100:if((D=_.n()).done){r.next=108;break}return F=D.value,r.next=104,!F.hookupPads();case 104:if(!r.sent){r.next=106;break}q.push(F);case 106:r.next=100;break;case 108:r.next=113;break;case 110:r.prev=110,r.t8=r.catch(98),_.e(r.t8);case 113:return r.prev=113,_.f(),r.finish(113);case 116:void 0!==t&&n.sends.deleteSends(q),L=(new Date).getTime(),n.checkSubPatchInstances(),B=(new Date).getTime(),console.log("check substance instances  took %s ms",B-L),"inletConnections"in i&&n.loadInletConnections(i.inletConnections,i.cableSegmentations),console.log("loaded inlet connections took %s ms",(new Date).getTime()-B),console.log("checking instance connections"),z=(new Date).getTime(),n.checkInstanceConnections(),V=(new Date).getTime(),console.log("checked instance took %s ms",V-z),"higherOrderSequencer"in i&&void 0===t&&n.higherOrderSequencer.fromJson(i.higherOrderSequencer),"nftZObject"in i&&(n.nftZObject=n.findNodeById(i.nftZObject)),n.updateTracks(),n.store.dispatch(Object(J.sc)(n.numberOfPatterns())),void 0!==n.update&&n.update(e),n.selectTrack(0),H=(new Date).getTime();for(U=v.length-1;U>=0;U--){n.switchToSubSequence(v[U].id,!0),n.currentSubSequence.loadBangZObjects(),n.currentSubSequence.loadNFTZObjects(),G=Pw(n.tracks);try{for(G.s();!(W=G.n()).done;)W.value.midiEffects.setupMessageReader()}catch(he){G.e(he)}finally{G.f()}}if(K=(new Date).getTime(),console.log("load bangs took %s ms",K-H),n.checkPads(),Q=(new Date).getTime(),console.log("check pads took %s ms",Q-K),n.setLoadingProgress(e,100),n.store.dispatch(Object(J.fc)(e,!1)),n.dispatch(Object(J.M)(n.bulkConnections)),"presentationWindowPositions"in i&&n.dispatch(Object(J.N)(i.presentationWindowPositions)),!("windowPositions"in i)){r.next=166;break}if(!Array.isArray(i.windowPositions)){r.next=165;break}Z={},Y=n.getAllZObjects(),Y.map(function(e){return e.id}),$=0;case 152:if(!($<i.windowPositions.length)){r.next=162;break}if(X=i.windowPositions[$],ee=i.windowPositions[$+1],Y[$/2]){r.next=157;break}return r.abrupt("continue",159);case 157:te=Y[$/2].id,null!==X&&null!==ee&&(Z[te]={x:X,y:ee});case 159:$+=2,r.next=152;break;case 162:n.dispatch(Object(J.O)(Z)),r.next=166;break;case 165:n.dispatch(Object(J.O)(i.windowPositions));case 166:i.pluginsLoaded&&(ne=i.pluginsLoaded.map(function(e){return n.findNodeById(e)}).filter(function(e){return e}),n.dispatch(Object(J.Xc)(ne))),re=(new Date).getTime(),console.log("compiling and everything else took %s ms",re-Q),ae=Pw(n.subSequences);try{for(ae.s();!(ie=ae.n()).done;){oe=ie.value,se=Pw(oe.pads);try{for(se.s();!(ce=se.n()).done;)(le=ce.value).sendSamples(),le.sendSliderLevels()}catch(he){se.e(he)}finally{se.f()}}}catch(he){ae.e(he)}finally{ae.f()}n.dispatch(Object(J.Y)(!0)),fe=(new Date).getTime(),console.log("FINAL SHIT TOOK %s ms",fe-re),n.acknowledgeFinish(),o(),window.logRedux=!1;case 177:case"end":return r.stop()}},r,null,[[98,110,113,116]])}));return function(e){return r.apply(this,arguments)}}());case 46:case"end":return r.stop()}},r,null,[[5,38]])}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"acknowledgeFinish",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!1,n=function(e){"finished-acknowledged"===e.data.type&&(t=!0)},window.addEventListener("message",n);case 3:if(t){e.next=9;break}return window.parent&&document.referrer&&(r=document.referrer,window.parent.postMessage("Finished Loading Project",r)),e.next=7,Object(M.a)(250);case 7:e.next=3;break;case 9:window.removeEventListener("message",n);case 10:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"newNumberOfPatterns",value:function(e){for(var t=this.numberOfPatterns();t<e;t++)this.newPattern(!0)}},{key:"combineWithSequencerEngine",value:function(e){for(var t in e.subSequences){var n=e.subSequences[t];if(void 0!==this.getSubSequence(n.id)){var r=-1;for(var a in this.subSequences){var i=this.subSequences[a].id;i>r&&(r=i)}n.id=r+1,this.addSubSequence(n)}}}},{key:"loadParameterLocks",value:function(e){if("parameterLocks"in e){var t=e.parameterLocks;for(var n in this.parameterLocks=[],t){var r=new lO;r.fromJson(t[n],this),this.parameterLocks.push(r)}for(;this.parameterLocks.length<2;)this.parameterLocks.push(new lO)}}},{key:"loadSlices",value:function(e,t){var n=[];return"samplersParameters"in e&&(Array.isArray(e.samplersParameters[t])?n=e.samplersParameters[t]:n.push({startTime:e.samplersParameters[t].startTime,endTime:e.samplersParameters[t].endTime})),n}},{key:"newRecordingToSaveLater",value:function(e){this.recordingsToSave.push(e)}},{key:"getParameterFromJson",value:function(e){var t=e.context,n=new X.a,r=void 0,a=[];if(void 0!==t.track){var i=0;void 0!==t.chainNumber&&(i=t.effectsChainNumber),a=(r=this.tracks[t.track]).effectsChains[i].effects,n=n.forTrack(r)}else if(void 0!==t.group){var o=this.groups.groups[t.group];a=o.effects,n=n.forGroup(o)}else if(void 0!==t.sends){var s=this.sends.sends[t.sends];a=s.effects,n=n.forSend(s)}var c=void 0;if(t.isInstrument)c=r.instrument.parameters;else if(void 0!==t.effect&&-1!=t.effect){c=a[t.effect].parameters}else void 0!==r&&(c=r.trackData.parameters);if(void 0!==c){var u=e.name,l=c.filter(function(e){return e.name===u});if(l.length>=1)return l[0]}}},{key:"getEffectsPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o,s,c,u,l,f,h;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},i={},t.effectsChains&&(t.trackEffectsChains=t.effectsChains),!t.trackEffectsChains){e.next=26;break}o=[],e.t0=a.a.keys(t.trackEffectsChains);case 6:if((e.t1=e.t0()).done){e.next=25;break}s=e.t1.value,c=new Y.a(n.gainNode,n.trackNode,(new X.a).forTrack(n),this),u=t.trackEffectsChains[s],c.initDefault(),e.t2=a.a.keys(u);case 12:if((e.t3=e.t2()).done){e.next=22;break}return l=e.t3.value,f=u[l],e.next=17,Object($.c)(f,this.tracks,this,s);case 17:h=e.sent,i=Object(d.a)({},i,h.bulk),c.addEffect(h.effect),e.next=12;break;case 22:o.push(c),e.next=6;break;case 25:r.effectsChains=o;case 26:return t.midiEffects&&(r.midiEffects=new Ya.a(n),i=Object(d.a)({},i,r.midiEffects.fromJson(t.midiEffects))),this.store.dispatch(Object(J.xb)(i)),e.abrupt("return",r);case 29:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadEffectsPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:this.tracks[this.store.getState().cursor.track],n&&this.loadLFOsAndEnvelopes(t),e.next=4,this.getEffectsPreset(t,r);case 4:(i=e.sent).effectsChains&&(r.effectsChains=i.effectsChains),i.midiEffects&&(r.midiEffects=i.midiEffects),t.liveEffects&&(r.liveEffects=new Ib.a(r),r.liveEffects.fromJson(t.liveEffects));case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"auditionPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o,s,c,u,l,f,p,v,m,y,b=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(b.length>2&&void 0!==b[2])||b[2],i=b.length>3&&void 0!==b[3]&&b[3],o=!(b.length>4&&void 0!==b[4])||b[4],s=b.length>5?b[5]:void 0,c=t.title,o){e.next=9;break}e.t0=t.data,e.next=12;break;case 9:return e.next=11,Aw.getPresetData(t);case 11:e.t0=e.sent;case 12:if(u=e.t0,(l=this.tracks[n]).tracks&&u.trackParameters.type!==W.c?l=(l=this.state.tracks.selectedRackSubTrack[l.id]||l.tracks[0]).track:l.tracks&&Object(h.a)(l.tracks).forEach(function(e){return l.deleteInstrument(e)}),f={},r&&(f=this.loadLFOsAndEnvelopes(u,l)),l.preset=new dt.a(t.title,t.contentHash,t.user,t.blockNumber),l.preset.track=l,l.preset.data=u,l.preset.tags=t.tags,l.presetName=c,l.preset.name=c,l.getAllParameters().forEach(function(e){return e.unmap()}),l.liveEffects.clearEffects(),p=l.volumeParameter.get(),l.getTrackType()!==W.f){e.next=29;break}return e.next=29,U(l,u.trackParameters,this.currentSubSequence);case 29:return e.t1=d.a,e.t2={},e.t3=f,e.next=34,l.fromJson(u.trackParameters,void 0,!1,!1,!0,!0,s);case 34:return e.t4=e.sent,f=(0,e.t1)(e.t2,e.t3,e.t4),l.setVolume(p),v=l.getAllParameters(),m=v.filter(function(e){return e.automations&&e.automations.length>0}),this.store.dispatch(Object(J.c)(m)),i&&l.effectsChains.forEach(function(e){return e.clear()}),l.midiEffects.clear(),l.midiEffects.effects.forEach(function(e){return e.dispose()}),l.midiEffects.effects=[],l.preset.hasEdits=!1,l.presetName=c,e.t5=d.a,e.t6={},e.t7=f,e.next=51,this.loadPresetEffects(l,u,!i);case 51:for(e.t8=e.sent,f=(0,e.t5)(e.t6,e.t7,e.t8),l.loadLostParameters(),l.setIsEnabled(l.isEnabled),y=2;y<l.sendNodeVolumeParameters.length;y++)this.sends.sends[y].pad!==l.pad&&l.sendNodeVolumeParameters[y].set(-90);this.store.dispatch(Object(J.xb)(f)),this.update(),l.updateSteps(),l.preset.loadMods=r,l.preset.loadEffects=i,this.addPresetToBrowsedPresets(l,l.preset),this.loadedProject=!0;case 63:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"addPresetToBrowsedPresets",value:function(e,t){var n=this.state.tracks.trackBrowsedPresets[e.id]||[];if(!n.some(function(e){return e.contentHash===t.contentHash})){var r=[t].concat(Object(h.a)(n.filter(function(e){return e.ipfsHash!==t.ipfsHash})));this.store.dispatch(Object(J.qe)(e.id,r))}}},{key:"loadPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o,s,c,u,l,f;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.contentHash,i=t.title,void 0===r&&"string"===typeof t&&(r=t),e.next=5,Aw.getPresetData(t);case 5:return o=e.sent,e.next=8,Aw.getPresetInstrumentType(r);case 8:if(e.sent!==te.a){e.next=12;break}return this.loadEffectsPreset(o,n),e.abrupt("return");case 12:if(void 0!==o.tracks){e.next=17;break}return e.next=15,this.loadTrackPreset(o,r,n,void 0,i,void 0,t);case 15:return this.tracks[this.tracks.length-1].presetName=i,e.abrupt("return");case 17:for(c in s={},o.tracks)s[c]=this.tracks.length,this.loadTrackPreset(o.tracks[c],void 0,n);if(o.keyMappings)for(u in o.keyMappings)l=o.keyMappings[u],f=s[l.trackNumber],this.keyboardEngine.map(l.key,f,l.sliceNumber);case 20:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadLFOsAndEnvelopes",value:function(e,t){return{}}},{key:"loadPresetAsSubSequence",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.contentHash,i=t.name,void 0===r&&"string"===typeof t&&(r=t),void 0!==n){e.next=7;break}return e.next=6,Aw.getPresetData(t);case 6:n=e.sent;case 7:return e.next=9,this.loadTrackPreset(n,r,!1,!1,i,1,t);case 9:o=e.sent,this.newSubSequence(void 0,o),this.loadLFOsAndEnvelopes(n),o.trackNumber=0,o.updateSteps();case 14:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadTrackPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o,s,c,u,l,f,h,p,v=this,m=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(m.length>3&&void 0!==m[3])||m[3],o=m.length>4?m[4]:void 0,s=m.length>5&&void 0!==m[5]?m[5]:this.numberOfPatterns(),c=m.length>6?m[6]:void 0,u=void 0,t.trackParameters.type!==W.d){e.next=13;break}return u=new ma(this.tracks.length,this,this.mixSession,s,function(){return v.update()},this.currentSubSequence),e.next=9,G(u,t.trackParameters,this.currentSubSequence);case 9:u.setMidiEngine(this.midi),this.setupRecordableTrack(u),e.next=21;break;case 13:if(t.trackParameters.type!==W.b&&t.trackParameters.type!==W.c){e.next=18;break}l=t.trackParameters.instrumentType,u=ia(this,t.trackParameters.type,l,s),e.next=21;break;case 18:return u=new ht(this.tracks.length,this,this.mixSession,s,function(){return v.update()},this.sends),e.next=21,G(u,t.trackParameters,this.currentSubSequence);case 21:return u.setSends(this.sends),e.next=24,u.fromJson(t.trackParameters,void 0,void 0,void 0,!0);case 24:return f=e.sent,u.trackData.loadFromJson(t.trackData,void 0,!1,!1,this),e.t0=d.a,e.t1={},e.t2=f,e.next=31,this.loadPresetEffects(u,t);case 31:if(e.t3=e.sent,f=(0,e.t0)(e.t1,e.t2,e.t3),u.gated=t.trackParameters.gated,r&&this.loadLFOsAndEnvelopes(t,u),this.parametersToUpdate=Object(d.a)({},this.parametersToUpdate,f),i){if(this.setupNewTrack(u,!0,!0),this.groups.addTrack(u),"sendVolumes"in t)for(h=u.getSendNodes(),p=0;p<t.sendVolumes.length;p++)h[p]&&(h[p].volume.value=t.sendVolumes[p]);this.currentSubSequence.addTrack(u),u.switchToPattern(this.currentPattern),u.updateSteps(),this.update()}return u.presetId=n,u.presetName=o,c&&(u.preset=new dt.a(o,n,c.user,c.blockNumber),u.preset.load(),u.preset.track=u),this.currentSubSequence.addTrackToPadIfPossible(u),setTimeout(function(){u.loadLostParameters()},750),e.abrupt("return",u);case 43:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadPresetEffects",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o,s,c,u,l,f,h,p,v,m,y=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=y.length>2&&void 0!==y[2]&&y[2],i={},r){e.next=41;break}if(!n.trackEffects){e.next=17;break}o=[],s=0;case 6:if(!(s<n.trackEffects.length)){e.next=14;break}return e.next=9,Object($.b)(n.trackEffects[s],this.tracks,this);case 9:c=e.sent,o.push(c.effect);case 11:s++,e.next=6;break;case 14:t.effectsChains[0].effects=o,e.next=41;break;case 17:if(!n.trackEffectsChains){e.next=41;break}u=[],e.t0=a.a.keys(n.trackEffectsChains);case 20:if((e.t1=e.t0()).done){e.next=39;break}l=e.t1.value,f=new Y.a(t.gainNode,t.trackNode,(new X.a).forTrack(t),this),h=n.trackEffectsChains[l],e.t2=a.a.keys(h);case 25:if((e.t3=e.t2()).done){e.next=35;break}return p=e.t3.value,v=h[p],e.next=30,Object($.c)(v,this.tracks,this,l);case 30:m=e.sent,i=Object(d.a)({},i,m.bulk),f.addEffect(m.effect),e.next=25;break;case 35:f.updateEffects(),u.push(f),e.next=20;break;case 39:t.effectsChains.forEach(function(e){return e.dispose()}),t.effectsChains=u;case 41:return n.midiEffects&&(i=Object(d.a)({},i,t.midiEffects.fromJson(n.midiEffects))),n.liveEffects&&t.liveEffects.fromJson(n.liveEffects),e.abrupt("return",i);case 44:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"saveProjectAsPreset",value:function(){var e=this,t=[];for(var n in this.tracks){var r=this.getTrackPreset(n);t.push(r)}var a=void 0;t.length>0&&(a=t[0].lfos);var i={lfos:a,tracks:t,keyMappings:this.keyboardEngine.keyMappings,midiMappings:this.keyboardEngine.midiMappings},o=window.prompt("Type name of preset");Aw.newPreset(i,o).catch(function(e){console.log(e)}).then(function(t){e.presetId=t})}},{key:"saveZObjectPreset",value:function(e,t){var n=e.getInstrumentType(),r=e.getPresetJson();Aw.newPreset(r,t,void 0,n,0)}},{key:"saveTrackPreset",value:function(e,t,n,r,o){var s=this;return new Promise(function(){var o=Object(i.a)(a.a.mark(function o(c,u){var l,f,h,d;return a.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(l=s.tracks[e],0!=r){o.next=4;break}return o.next=4,l.makePublicIfNeeded();case 4:f=n?s.getEffectPreset(e):s.getTrackPreset(e),h=n?te.a:l.getInstrumentType(),l.tracks&&(h=W.c),d=void 0,void 0===l.sample||n||(d=l.sample.getId()),Aw.newPreset(f,t,d,h,r).catch(function(e){console.log(e)}).then(function(){var e=Object(i.a)(a.a.mark(function e(n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l.presetId=n,console.log("preset id=",n),s.dispatch(Object(J.ad)({contentHash:n,title:t,name:t,tags:[]})),!l.resampledFrom||!l.resampledFrom.contentHash){e.next=6;break}return e.next=6,rr.a.xanadu.presetResampled(l.resampledFrom.contentHash,n);case 6:h===te.b&&void 0!==(r=l.midiEffects.effects.filter(function(e){return"Midi Interface"===e.name})[0])&&(i=r.midiOutput.name,Aw.tagPreset(n,[i])),c(n);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return o.stop()}},o)}));return function(e,t){return o.apply(this,arguments)}}())}},{key:"updateTrackPreset",value:function(e){var t=this.getTrackPreset(e),n=this.tracks[e];Aw.updatePresetIpfsHash(n.presetId,t)}},{key:"getEffectPreset",value:function(e){var t=this.tracks[e],n=t.effectsChains.map(function(e){return e.getJson()});return{lfo:this.lfos.map(function(e){return e.getJson()}),envelopes:this.envelopes.map(function(e){return e.getJson()}),trackEffectsChains:n,midiEffects:t.midiEffects.getJson(),liveEffects:t.liveEffects.getJson()}}},{key:"getTrackPreset",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.tracks[e],r=n.getSendNodes().map(function(e){return e.volume.value}),a=n.effectsChains.map(function(e){return e.getJson(t)}),i=n.lfosTrack||this.lfosTrack,o=n.envelopeTrack||this.envelopesTrack;return{lfos:i.lfos.map(function(e){return e.getJson(t)}),envelopes:o.envelopes.map(function(e){return e.getJson()}),trackData:n.trackData.getJson(),trackParameters:n.getJson(!0,t),sendVolumes:r,sendVolumees:r,trackEffectsChains:a,midiEffects:n.midiEffects.getJson(t),liveEffects:n.liveEffects.getJson(t)}}},{key:"loadOldMixFromJson",value:function(e){if(void 0!==e){var t={},n={};for(var r in e.deterministicMixesByType)1===parseInt(r)?n[r]=e.deterministicMixesByType[r]:t[r]=e.deterministicMixesByType[r];this.mix.loadFromJson(Object(d.a)({},e,{deterministicMixesByType:t})),this.currentSubSequence.mix.loadFromJson(Object(d.a)({},e,{deterministicMixesByType:n}))}}},{key:"getSamples",value:function(){var e=[];for(var t in this.subSequences){var n=this.subSequences[t];for(var r in n.tracks){var a=n.tracks[r];if(a.sample&&e.push(a.sample.getId()),a.frozenColumns){var i,o=Pw(a.frozenColumns);try{for(o.s();!(i=o.n()).done;){var s,c=Pw(i.value.frozenSamples);try{for(c.s();!(s=c.n()).done;){var u=s.value;e.push(u.getId())}}catch(l){c.e(l)}finally{c.f()}}}catch(l){o.e(l)}finally{o.f()}}}}return e}},{key:"addSampleToSync",value:function(e){this.samplesToSync.push(e)}},{key:"replaceWithEncryptedSample",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o,s,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r in this.subSequences)for(o in(i=this.subSequences[r]).tracks){for(u in s=i.tracks[o],c={},s.samplers)u===t?c[n]=s.samplers[u]:c[u]=s.samplers[u];s.samplers=c,s.soundIds=Object.keys(s.samplers)}case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadSampleFromSequence",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o,s,c,u,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,la.a.getJson(n);case 2:for(s in r=e.sent,i=r.subSequences,o={},i)for(l in c=i[s],u=function(e){e=parseInt(e);var n=c.tracksData[e];if(t in n.samplers){(o=Object(d.a)({},c)).trackParameters=n,o.sendVolumes=c.sendVolumes[e],o.trackPatterns=c.tracksPatterns[e],o.trackEffectsChains=c.tracksEffectsChains[e],o.trackMidiEffects=c.tracksMidiEffects[e],o.trackLiveEffects=c.tracksLiveEffects[e],o.trackData=c.tracksParameters[e],o.mix=c.mix,o.tracks=c.tracks[e];var r=c.groups.find(function(t){return t.tracks.indexOf(e)>-1});r.tracks=[0],o.groups=[r]}l=e},c.tracksData)u(l);this.loadPresetAsSubSequence({},o);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"setLoadingProgress",value:function(e,t){this.store.dispatch(Object(J.Gd)(e,t))}},{key:"loadPulledEffects",value:function(e){if(e){var t,n=[],r=Pw(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;if("object"===typeof a){var i=a.id,o=a.type,s=a.instrumentId,c=a.x,u=a.y,l=a.width,f=a.height,h=B(s||i,o,this);h&&n.push(Object(d.a)({},a,h,{x:c,y:u,width:l,height:f}))}else{var p=L(a,this);p&&n.push(p)}}}catch(v){r.e(v)}finally{r.f()}this.dispatch(Object(J.dd)(n))}}},{key:"trackIDExists",value:function(e,t){return this.subSequences.flatMap(function(e){return e.tracks}).some(function(n){return n.id===e&&n!==t})}},{key:"checkPads",value:function(){this.subSequences.forEach(function(e){return e.checkPads()})}},{key:"getAllZObjects",value:function(){var e,t=[],n=Pw(this.subSequences);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=[].concat(Object(h.a)(t),Object(h.a)(Object(P.a)(r)))}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"generateProjectMetadata",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(R.a)(this,t);case 2:e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveProjectMetadata",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i){var o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(M.a)(1e3);case 2:return e.next=4,Object(R.a)(this,t);case 4:(o=e.sent).samples=r,o.previousHash=n,o.title=i,Object(R.b)(o);case 9:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getSamplesForMint",value:function(){return C.d(this)}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=A(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"loadInletConnections",value:function(e,t){var n=this,r=0,a=(new Date).getTime(),i=this.nameToObjects.subpatch||[],o=function(a){var o=n.subSequences.find(function(e){return e.id===a});if(o)n.switchToSubSequence(o.id);else{var s,c=E(n.subSequences);try{for(c.s();!(s=c.n()).done;){var u=s.value,l=(new Date).getTime(),f=i.find(function(e){return e.effect.id===a}),h=(new Date).getTime();if(r+=h-l,f){o=u;break}}}catch(d){c.e(d)}finally{c.f()}}n.loadInletConnectionsForId(e[a],void 0,t,a)};for(var s in e)o(s);var c=(new Date).getTime();console.log("patchloader.loadInletConnections took %s ms",c-a),console.log("total search took =%s ms",r)}},{key:"loadInletConnectionsForId",value:function(e,t,n,r){for(var a in(new Date).getTime(),e){var i,o=e[a],s=a.split("."),c=s[0],u=s[1],l=this.findNodeById(u),f=E(o);try{for(f.s();!(i=f.n()).done;){var h=i.value,d=void 0,p=void 0,v=void 0;Array.isArray(h)?(p=h[0],d=h[1],v=h[2]):(d=h.sourceType,p=h.sourceId,v=h.id);var m=this.findNodeById(p);if(l&&m){if(m.isSubPatch&&m.instances.length>0)continue;var y=n&&n[v];l.connectInlet(c,m,d,v,t,y)}}}catch(b){f.e(b)}finally{f.f()}}(new Date).getTime(),this.idToObject[r]}},{key:"findNodeById",value:function(e,t){return this.idToObject[e]?this.idToObject[e]:void 0}},{key:"_findNodeById",value:function(e,t){var n,r=E(this.currentSubSequence.pads);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.id===e)return a}}catch(x){r.e(x)}finally{r.f()}var i=this.tracks.find(function(t){return t.id===e});if(i)return i;var o=t?this.subSequences.reduce(function(e,t){return[].concat(Object(h.a)(e),Object(h.a)(Object(P.a)(t)))},[]).find(function(t){return t.id===e||t.effect&&t.effect.id===e}):this.subSequences.reduce(function(e,t){return[].concat(Object(h.a)(e),Object(h.a)(Object(P.a)(t)))},[]).find(function(t){return t.id===e});if(o)return o;for(var s=0,c=[].concat(Object(h.a)(this.subSequences),Object(h.a)(this.tracks));s<c.length;s++){var u=c[s];if(u.getAllEffects){var l=u.getAllEffects().find(function(t){return t.id===e});if(l)return l}if(u.effects){var f,d=E(u.effects);try{for(d.s();!(f=d.n()).done;){var p=f.value;if(p.id===e)return p;if(p.effects){var v,m=E(p.effects);try{for(m.s();!(v=m.n()).done;){var y=v.value;if(e===y.id)return y}}catch(x){m.e(x)}finally{m.f()}}}}catch(x){d.e(x)}finally{d.f()}}var b,g=E(u.midiEffects.effects);try{for(g.s();!(b=g.n()).done;){var O=b.value;if(O.id===e)return O;if(O.effects){var j,k=E(O.effects);try{for(k.s();!(j=k.n()).done;){var w=j.value;if(e===w.id)return w}}catch(x){k.e(x)}finally{k.f()}}}}catch(x){g.e(x)}finally{g.f()}}}},{key:"checkSubPatchInstances",value:function(e){var t,n=E(this.subSequences);try{for(n.s();!(t=n.n()).done;){var r,a=t.value,i=a.findNodeByName("subpatch",!0),o=a.findNodeByName("instancedSubpatch",!0),s=E(i);try{for(s.s();!(r=s.n()).done;){var c=r.value,u=(c=c.effect).instanceIds;if(u){e&&(u=u.map(function(t){return e[t]||t}));var l,f=E(u);try{var h=function(){var e=l.value,t=o.map(function(e){return e.effect}).find(function(t){return t.id===e});t&&!t.implements&&(c.instances.push(t),(new Date).getTime(),c.copyIntoInstance(t),(new Date).getTime(),t.implements=c)};for(f.s();!(l=f.n()).done;)h()}catch(d){f.e(d)}finally{f.f()}c.instanceIds=void 0}}}catch(d){s.e(d)}finally{s.f()}}}catch(d){n.e(d)}finally{n.f()}}},{key:"checkInstanceConnections",value:function(){var e,t=E(this.subSequences);try{for(t.s();!(e=t.n()).done;){var n,r=e.value,a=r.findNodeByName("subpatch",!0),i=(r.findNodeByName("instancedSubpatch",!0),E(a));try{for(i.s();!(n=i.n()).done;){var o,s=n.value,c=E((s=s.effect).instances);try{for(c.s();!(o=c.n()).done;){var u=o.value;s.copyConnectionsIntoInstance(u)}}catch(l){c.e(l)}finally{c.f()}}}catch(l){i.e(l)}finally{i.f()}}}catch(l){t.e(l)}finally{t.f()}}}]),n}(e)}(jw));function Rw(e){var t=e.toString().indexOf("t");return t>0?new ua.a(parseInt(e.slice(0,t)),!0):new ua.a(parseInt(e),!1)}function Cw(e){return!isNaN(parseFloat(e))&&isFinite(e)}var Nw=function(e,t){var n={};for(var r in e){var a={};for(var i in e[r]){var o,s=[],c=Pw(e[r][i]);try{for(c.s();!(o=c.n()).done;){var u=o.value,l=t.findNodeById(u.destId);if(t.findNodeById(u.sourceId)&&l){var f=[u.sourceId,u.sourceType];u.segmentation&&f.push(u.id),s.push(f)}}}catch(h){c.e(h)}finally{c.f()}s.length>0&&(a[i]=s)}Object.keys(a).length>0&&(n[r]=a)}return n},Iw=function(e,t){var n=t.getAllZObjects().map(function(e){return e.id}),r=[];for(var a in e){var i=n.indexOf(a);i<-1||(e[a]?0===e[a].x&&0===e[a].y||(r[2*i]=e[a].x,r[2*i+1]=e[a].y):(r[2*i]=0,r[2*i+1]=0))}return r},qw=Mw,_w=n(946),Dw=n(435),Fw=n(977),Lw=new ua.a(32,!1),Bw=function(){function e(t){Object(o.a)(this,e),this.store=t,this.step=0,this.track=0,this.group=0,this.show=!1}return Object(s.a)(e,[{key:"step",get:function(){return this.store.getState().cursor.step},set:function(e){this.store.dispatch(Object(J.mb)(e)),this.updateRedux()}},{key:"track",get:function(){return this.store.getState().cursor.track},set:function(e){this.store.dispatch(Object(J.nb)(e))}},{key:"show",get:function(){return this.store.getState().cursor.show},set:function(e){this.store.dispatch(Object(J.lb)(e))}},{key:"getJson",value:function(){return{step:this.step,track:this.track}}},{key:"getStep",value:function(e){return void 0===e?this.step:e.transformStepAtResolution2(this.step,Lw)}},{key:"setStep",value:function(e,t){this.step=Lw.transformStepAtResolution2(e,t)}},{key:"resolution",get:function(){return this.store.getState().sequencer.resolution}},{key:"updateRedux",value:function(){this.store.dispatch(Object(J.Cd)(this.track)),this.store.dispatch(Object(J.Bd)(this.getStep(this.resolution))),this.store.dispatch(Object(J.Nc)(this.getStep(this.resolution)))}}]),e}(),zw=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(o.a)(this,e),this.module=null,this.orientation=r,this.size=n,this.y=t}return Object(s.a)(e,[{key:"getJson",value:function(){return{module:this.module&&this.module.id,orientation:this.orientation,size:this.size,y:this.y,x:this.x}}},{key:"fromJson",value:function(e,t){this.x=e.x,this.y=e.y,this.orientation=e.orientation,this.size=e.size,this.module=e.module&&t.subSequences.find(function(t){return t.id===e.module})}}]),e}();n(39);function Jw(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Vw(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vw(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Vw(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Hw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Uw=n(630);function Gw(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ww(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ww(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ww(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Kw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Qw=n(48),Zw=n(27);function Yw(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return $w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $w(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function $w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Xw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ex=function(e,t,n,r){var a=n?n.get():100,i=Math.max(.001,(10-e)/10);return t.min+(t.max-t.min)*i*r*(a/100)};function tx(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function nx(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function rx(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function ax(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ix(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ix(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ix(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ox(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var sx=n(899);function cx(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ux(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ux(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ux(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function lx(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var fx=n(606);function hx(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return dx(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dx(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function dx(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function px(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function vx(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function mx(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var yx=function(e){Object(u.a)(n,e);var t=mx(n);function n(e){var r;Object(o.a)(this,n),(r=t.call(this)).sequencerEngine=e,r.matrix=new Array(16).fill([]),r.steps=[];for(var a=0;a<16;a++)r.matrix[a]=new Array(10).fill(0);return r.initScripting(),r.initDisabledParameters(),r.initAutomation(),r}return Object(s.a)(n,[{key:"stop",value:function(){this.wasRolling=!1,this.currentAlgorithms={}}}]),n}(Object(ot.a)(function(e){return function(e){Object(u.a)(n,e);var t=ox(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"processGraphics",value:function(e,t){var n,r=Math.floor(e/2)%16,a=ax(t);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=i.type,s=i.arg,c=r,u=s&&s[0]&&Object(qn.a)(s[0],10),l=s&&s[1],f=s&&s[2];switch(o){case"DRAW":this.newStep(c,u,l,f);break;case"ERASE":var h=this.matrix[c].filter(function(e){return e});if(void 0!==u){var d=this.matrix[c][u];d&&(h=[d])}e&&this.deleteSteps(h)}}}catch(p){a.e(p)}finally{a.f()}this.updateRedux()}}]),n}(e)},zp.a,function(e){return function(e){Object(u.a)(n,e);var t=lx(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).currentAlgorithms={},e.algorithmTypes={0:[sx.a],1:[sx.c]},e}return Object(s.a)(n,[{key:"onNewStep",value:function(e,t){var n=this;e%32===0&&this.scheduleAutomations(e,t),this.updateAutomationRedux(e);var r={},a=new Set;for(var i in this.currentAlgorithms){var o=this.currentAlgorithms[i];a.has(o)||(o.duration--,o.elapsed++,a.add(o)),o.duration>0&&(r[i]=o)}var s=this.matrix[e/2%16];if(s){var c,u=cx(s);try{var l=function(){var t=c.value;if(!t)return"continue";var a={types:n.getAlgorithmTypes(t),y:t.y,x:t.x,orientation:t.orientation,elapsed:0,stepNumber:e,module:t.module,duration:2*t.size};a.types.forEach(function(e){return r[e]=a})};for(u.s();!(c=u.n()).done;)l()}catch(f){u.e(f)}finally{u.f()}this.currentAlgorithms=r}else this.currentAlgorithms=r;this.checkOrientations(this.currentAlgorithms)}},{key:"checkOrientations",value:function(e){this._getOutputForModule={}}},{key:"getAlgorithmTypes",value:function(e){return this.algorithmTypes[e.orientation]||[]}},{key:"isEmpty",get:function(){return 0===this.steps.length}},{key:"shouldPlayModule",value:function(e){if(this.isEmpty||this.isFreeform(e))return!0;var t=this.currentAlgorithms[sx.a]||this.currentAlgorithms[sx.c];return t&&this.isModuleRouted(e,t.orientation)}},{key:"isRolling",value:function(){var e=this.currentAlgorithms[sx.d];return this.wasRolling=void 0!==e,{isRolling:void 0!==e,isNewRoll:e&&0===e.elapsed,modules:e&&this.getModulesRoutedIn(e.orientation)}}},{key:"getStepForModule",value:function(e,t){if(this.isEmpty||this.isFreeform(t))return e;var n=this.currentAlgorithms[sx.c];return n&&this.isModuleRouted(t,n.orientation)?e-n.stepNumber:e}},{key:"getSpeedForModule",value:function(e){if(this.isEmpty||this.isFreeform(e))return 1;var t=this.currentAlgorithms[sx.b];if(t&&this.isModuleRouted(e,t.orientation)){var n=t.y;return n<4?2:4===n?1:.5}return 1}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=rx(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getSelection",value:function(e){var t=e.x1,n=e.y1,r=e.x2,a=e.y2;return this.steps.filter(function(e){var i=e.x,o=e.y;return t<=i&&i<=r&&n<=o&&o<=a})}},{key:"setStepSize",value:function(e,t,n){this.matrix[e][t]&&(this.matrix[e][t].size=n,this.updateRedux())}},{key:"moveStepTo",value:function(e,t,n,r){if(this.matrix[e]){var a=this.matrix[e][t];a&&(n=Object(qn.a)(n,this.matrix.length-a.size+1),r=Object(qn.a)(r,this.matrix[0].length-a.size+1),this.matrix[e][t]=0,this.matrix[n][r]&&this.deleteSteps([this.matrix[n][r]]),this.matrix[n][r]=a,a.x=n,a.y=r,this.updateRedux())}}},{key:"noIntersect",value:function(e,t){return!0}},{key:"newStep",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.matrix=Object(h.a)(this.matrix),this.matrix[e][t]&&this.deleteSteps([this.matrix[e][t]]);var a=new zw;return this.matrix[e][t]=a,a.x=e,a.y=t,a.size=n,a.orientation=r,this.steps.push(a),a}},{key:"toggle",value:function(e,t){this.matrix=Object(h.a)(this.matrix),this.matrix[e][t]?this.matrix[e][t].orientation=0===this.matrix[e][t].orientation?1:0:this.noIntersect(e,t)&&(this.matrix[e][t]=new zw,this.matrix[e][t].x=e,this.matrix[e][t].y=t,this.steps.push(this.matrix[e][t])),this.updateRedux(e)}},{key:"deleteSteps",value:function(e){for(var t=0;t<this.matrix.length;t++)for(var n=0;n<this.matrix[t].length;n++)e.includes(this.matrix[t][n])&&(this.matrix[t][n]=0);this.steps=this.steps.filter(function(t){return!e.includes(t)}),this.updateRedux()}},{key:"updateRedux",value:function(e){this.computeShapes(),void 0!==e&&(this.matrix[e]=Object(h.a)(this.matrix[e])),this.sequencerEngine.dispatch(Object(J.Kb)(Object(h.a)(this.matrix)))}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Kw(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getParamsJson",value:function(){return{parameters:this._parameters.map(function(e){return{id:e.id,context:e.context&&e.context.getJson(),name:e.name,coordinates:e.getCoordinates()}}),depthParameters:this.depthParameters.map(function(e){return e.getJson()})}}},{key:"fromParamsJson",value:function(e,t){return delete e.depth,this.parametersJson=e.parameters,this.lostParameters=this.loadParameters(e.parameters,!0).lostParameters,this.loadDepthJson(e,t),{}}},{key:"loadParameters",value:function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a={},i=this.sequencerEngine,o=[],s=Gw(e);try{var c=function(){var e=t.value,s="object"===typeof e?e.id:e,c=void 0;"BPM"===e.name&&(c=i.bpmParameter);var u=i.higherOrderSequencer;if(!c&&u&&(c=u.macros.map(function(e){return e.macroParameter}).find(function(e){return s===e.id})),!c){var l,f=Gw(i.subSequences);try{for(f.s();!(l=f.n()).done;){var d,p=Gw(l.value.tracks);try{for(p.s();!(d=p.n()).done;){var v=d.value.getAllParameters().find(function(e){return s===e.id});if(v){c=v;break}}}catch(C){p.e(C)}finally{p.f()}}}catch(C){f.e(C)}finally{f.f()}}if(!c){var m,y=Gw(i.subSequences);try{for(y.s();!(m=y.n()).done;){var b,g=Gw(m.value.lfos);try{for(g.s();!(b=g.n()).done;){var O=b.value,j=(O=O.lfo).parameters.find(function(e){return s===e.id});if(j){c=j;break}}}catch(C){g.e(C)}finally{g.f()}}}catch(C){y.e(C)}finally{y.f()}}if(!c){var k,w=Gw(i.subSequences);try{for(w.s();!(k=w.n()).done;){var x=k.value,S=[].concat(Object(h.a)(x.midiEffects.effects),[x.playhead]);if(c=[].concat(Object(h.a)(S.flatMap(function(e){return e.getParameters()})),Object(h.a)(x.pads.filter(function(e){return e.fxMacro}).map(function(e){return e.fxMacro.macroParameter})),Object(h.a)(x.pads.filter(function(e){return e.effectRack}).map(function(e){return e.effectRack.getParameters()}))).find(function(e){return s===e.id}))break}}catch(C){w.e(C)}finally{w.f()}}if(c||(c=i.sends.sends.flatMap(function(e){return e.effects}).flatMap(function(e){return e.getParameters()}).find(function(e){return s===e.id})),!c){var P,E=Gw(i.subSequences);try{for(E.s();!(P=E.n()).done;){var T,A=Gw(P.value.envelopes);try{for(A.s();!(T=A.n()).done;){var M=T.value.parameters.find(function(e){return s===e.id});if(M){c=M;break}}}catch(C){A.e(C)}finally{A.f()}}}catch(C){E.e(C)}finally{E.f()}}if(!c&&!r&&"object"===typeof e&&(c=Object(Uw.a)(e,n.track,i))){a[s]=c;var R=e.coordinates;R.x,R.y}c?n.setParameter(c):o.push(e)};for(s.s();!(t=s.n()).done;)c()}catch(u){s.e(u)}finally{s.f()}return this.sortParameters(),{lostParameters:o,newMappings:a}}},{key:"sortParameters",value:function(){var e=this;if(this.parametersJson){var t=this.parametersJson.map(function(t,n){var r=t.id;return e._parameters.find(function(e){return e&&e.id===r})}).filter(function(e){return e});this._parameters=t}}},{key:"loadDepthJson",value:function(e,t){if(e.depthParameters){var n,r=0,a=Gw(e.depthParameters);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=this.newDepthParameter();o.fromJson(i,this.sequencerEngine,t),this.depthParameters[r++]=o}}catch(s){a.e(s)}finally{a.f()}}}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=nx(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getJson",value:function(){return Object(d.a)({},this.getParamsJson(),{macros:this.macros.map(function(e){return e.getJson()}),algorithmTypes:this.algorithmTypes,scriptEffect:this.scriptEffect.getJson(),inputModules:this.inputModules.map(function(e){return e.id}),freeformModules:this.freeformModules.map(function(e){return e.id}),routings:this.getRoutingJson(),matrix:this.matrix.map(function(e){return e.map(function(e){return e&&e.getJson()})})})}},{key:"fromJson",value:function(e){var t=this,n=e.macros,r=e.routings,a=e.matrix,i=e.algorithmTypes,o=e.scriptEffect,s=e.inputModules,c=(e.outputModules,e.freeformModules);this.algorithmTypes=i,n&&this.loadMacrosJson(n),e.parameters&&this.fromParamsJson(e),o&&this.scriptEffect.fromJson(o),s&&(this.inputModules=s.map(function(e){return t.getModule(e)})),c&&(this.freeformModules=c.map(function(e){return t.getModule(e)})),r&&this.fromRoutingJson(r);for(var u=0;u<a.length;u++)for(var l=a[u],f=0;f<l.length;f++)l[f]&&(this.matrix[u][f]=new zw,this.matrix[u][f].fromJson(l[f],this.sequencerEngine),this.steps.push(this.matrix[u][f]));this.updateRedux()}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=vx(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).routings={0:{},1:{}},e.freeformModules=[],e._getOutputForModule={},e._getModulesRouted={},e._getModulesRoutedIn={},e._isModuleRouted={},e._getModule={},e._outputModules=void 0,e}return Object(s.a)(n,[{key:"outputModules",get:function(){if(this._outputModules)return this._outputModules;var e=this.routings[0],t=this.routings[1];return this._outputModules=Array.from(new Set([].concat(Object(h.a)(Object.values(e).flatMap(function(e){return e})),Object(h.a)(Object.values(t).flatMap(function(e){return e}))))),this._outputModules}},{key:"getOutputForModule",value:function(e){var t=e?e.id:"none";if(this._getOutputForModule[t])return this._getOutputForModule[t];if(this.isEmpty||this.isFreeform(e))return this._getOutputForModule[t]=[e],[e];var n=Object.values(this.currentAlgorithms)[0].orientation;return this._getOutputForModule[t]=this.routings[n][e.id]||[],this._getOutputForModule[t]}},{key:"getModulesRoutedIn",value:function(e){var t=this;return this._getModulesRoutedIn[e]?this._getModulesRoutedIn[e]:(this._getModulesRoutedIn[e]=Object.keys(this.routings[e]).map(function(e){return t.getModule(e)}),this._getModulesRoutedIn[e])}},{key:"getModulesRouted",value:function(e){return this._getModulesRouted[e]?this._getModulesRouted[e]:(this._getModulesRouted[e]=Object.values(this.routings[e]).flatMap(function(e){return e}),this._getModulesRouted[e])}},{key:"isModuleRouted",value:function(e,t){var n=e?e.id+"."+t:t;if(this._isModuleRouted[n])return this._isModuleRouted[n];if(!e)return this._isModuleRouted[n]=!0,!0;var r=Object.keys(this.routings[t]).includes(e.id);return this._isModuleRouted[n]=r,r}},{key:"modules",get:function(){return this.sequencerEngine.subSequences}},{key:"getModule",value:function(e){return this._getModule[e]?this._getModule[e]:(this._getModule[e]=this.modules.find(function(t){return t.id===e}),this._getModule[e])}},{key:"connectModules",value:function(e,t,n){var r=this.routings[e];if(t){var a=r[t.id]||[];a.push(n),r[t.id]=a,this.updateRoutableRedux()}}},{key:"disconnectModules",value:function(e,t,n){var r=this.routings[e],a=r[t.id]||[];a=a.filter(function(e){return e!==n}),r[t.id]=a,this.updateRoutableRedux()}},{key:"isFreeform",value:function(e){return this.freeformModules.includes(e)}},{key:"connectToFreeform",value:function(e){this.freeformModules.push(e),this.updateRoutableRedux()}},{key:"disconnectFromFreeform",value:function(e){this.freeformModules=this.freeformModules.filter(function(t){return t!==e}),this.updateRoutableRedux()}},{key:"clearRoutingCache",value:function(){this._getOutputForModule={},this._getModulesRouted={},this._isModuleRouted={},this._outputModules=void 0,this._getModulesRoutedIn={}}},{key:"updateRoutableRedux",value:function(){this.clearRoutingCache(),this.dispatch(Object(J.vc)(Object(d.a)({},this.routings)))}},{key:"getRoutingJson",value:function(){var e={};for(var t in this.routings){var n={};for(var r in this.routings[t])n[r]=this.routings[t][r].map(function(e){return e.id});e[t]=n}return e}},{key:"fromRoutingJson",value:function(e){var t=this,n=function(n){n=parseInt(n);var a=function(r){var a=t.getModule(r);e[n][r].forEach(function(e){return t.connectModules(n,a,t.getModule(e))})};for(var i in e[n])a(i);r=n};for(var r in e)n(r)}}]),n}(e)},Qa,function(e){return function(e){Object(u.a)(n,e);var t=tx(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).automationPaths=[],e}return Object(s.a)(n,[{key:"computeShapes",value:function(){for(var e=this,t=Object(h.a)(this.steps).sort(function(e,t){return e.x===t.x?t.y-e.y:e.x-t.x}),n=Object(h.a)(t),r=[],a=function(){for(var t=n.shift(),a=[t],i=e.findAdjoiningSteps(t);i;)n=n.filter(function(e){return e!==i}),a.push(i),i=e.findAdjoiningSteps(i);r.push(a)};n.length>0;)a();for(var i=[],o=0,s=r;o<s.length;o++){for(var c=s[o],u=[{x:c[0].x,y:c[0].y}],l=0;l<c.length;l++){var f=c[l],d=f.x+f.size,p=f.y+f.size,v=c[l+1];v?d===v.x&&p===v.y?f.orientation===v.orientation||0===f.orientation&&1===v.orientation?u=[].concat(Object(h.a)(u),[{x:d,y:p}]):1===f.orientation&&0===v.orientation&&(u=[].concat(Object(h.a)(u),[{x:d,y:f.y},{x:d,y:p}])):u=d===v.x&&p===v.y+v.size?[].concat(Object(h.a)(u),[{x:d,y:p},{x:v.x,y:v.y}]):[].concat(Object(h.a)(u),[{x:d,y:p},{x:d,y:10},{x:v.x,y:10},{x:v.x,y:v.y}]):u=[].concat(Object(h.a)(u),[{x:d,y:p}])}i.push(u)}this.automationPaths=i}},{key:"findAdjoiningSteps",value:function(e){var t=e.x,n=e.y,r=e.size,a=t+r,i=n+r;if(this.matrix[a])for(var o=a;o<16;o++){if(this.matrix[o][i])return this.matrix[o][i];for(var s=i;s<10;s++)if(this.matrix[o][s])return this.matrix[o][s];for(var c=i;c>0;c--)if(this.matrix[o][c])return this.matrix[o][c]}}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Xw(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).currentAutomations=[],e.depthParameters=[],e._automations={},e._parameters=[],e.initialParameterValues=[],e.initialParameterDepths=[],e}return Object(s.a)(n,[{key:"initAutomation",value:function(){this.automationDepthParameter=new he.a("automationDepth",this,function(){return[]},{defaultValue:1,min:0,max:0}),this.registerParameter()}},{key:"newDepthParameter",value:function(e){var t=new he.a("depth",this,function(e,t){return t},{units:"%",min:0,max:100,defaultValue:100});return this.context&&t.setContext(this.context),t.setStore(this.sequencerEngine.store),this.registerParameter(t),t}},{key:"setParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._parameters.length;this._parameters[t]=e,this.initialParameterValues[t]=e.get(!0),e.higherOrdered=this,this.depthParameters[t]||(this.depthParameters[t]=this.newDepthParameter(e))}},{key:"unmapParameter",value:function(e){this._parameters[e].higherOrdered=!1;var t=this._parameters[e];this._parameters.splice(e,1),t.context.macro&&(this.macros=this.macros.filter(function(e){return e!==t.context.macro}),t.context.macro.dispose(),t.updateRedux())}},{key:"getDepth",value:function(e){return 1}},{key:"setEffectParameterValues",value:function(e){this.dispatch(Object(J.xb)(e))}},{key:"scheduleAutomations",value:function(e,t){var n=this,r=this.automationPaths.length;this.currentAutomations=[],0!==r&&this._parameters.filter(function(e,t){return!n.parametersDisabled.includes(t)}).forEach(function(a,i){return n.automateWithPath(e,t,a,n.automationPaths[i%r])})}},{key:"automateWithPath",value:function(e,t,n,r){var a=this;if(this._automations[n.id]){var i=this._automations[n.id];i.clearCache(),i.automations=[]}var o=this._parameters.indexOf(n);if(!this.depthParameters[o]||0!==this.depthParameters[o].get()){var s=this._automations[n.id]||new Zw.a(n,!1,this.sequencerEngine);this._automations[n.id]=s;var c,u=void 0,l=Yw(r);try{var f=function(){var e=c.value,t=e.x,r=e.y,i=u===2*t?2*t+.1:2*t;0===i&&(i=.1),s.automations.push(new Qw.a(i,function(){return ex(r,n,a.depthParameters[o],a.automationDepthParameter.get())})),u=i};for(l.s();!(c=l.n()).done;)f()}catch(h){l.e(h)}finally{l.f()}s.start(t,!0,1e-4),s.schedule(e,t,t,0),this.currentAutomations.push(s)}}},{key:"updateAutomationRedux",value:function(e){if(e%2===0){e%=32;var t,n={},r=Yw(this.currentAutomations);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=a.parameter;i.onNewStep(e),n[i.id]=a.getValueAtStep(e)}}catch(o){r.e(o)}finally{r.f()}Object.keys(n).length>0&&this.setEffectParameterValues(n)}}}]),n}(e)},Lp.a,function(e){return function(e){Object(u.a)(n,e);var t=px(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).inputModules=[],e}return Object(s.a)(n,[{key:"initScripting",value:function(){this.scriptEffect=new fx.a(this),this.scriptEffect._subSequence=this,this.trackData=new K.a}},{key:"input",value:function(e){this.scriptEffect.onNewStep();var t,n=hx(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=r.stepData.track,i=this.scriptEffect.copyTrigger(r,!0);i.stepData.track=a,this.scriptEffect.input(i)}}catch(o){n.e(o)}finally{n.f()}}},{key:"output",value:function(e,t){var n=this.scriptEffect.output(e,t,t);if(0!==n.length){var r=n.filter(function(e){return e.graphics}).map(function(e){return e.graphics});this.processGraphics(t,r)}}},{key:"toggleInput",value:function(e){var t=this.inputModules;t.includes(e)?this.inputModules=t.filter(function(t){return t!==e}):this.inputModules=[].concat(Object(h.a)(t),[e]),this.updateScriptingRedux()}},{key:"toggleOutput",value:function(e){var t=this.outputModules;t.includes(e)?this.outputModules=t.filter(function(t){return t!==e}):this.outputModules=[].concat(Object(h.a)(t),[e]),this.updateScriptingRedux()}},{key:"updateScriptingRedux",value:function(){this.sequencerEngine.dispatch(Object(J.pc)(this.inputModules,this.outputModules))}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Hw(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).macros=[],e}return Object(s.a)(n,[{key:"createMacro",value:function(e){var t,n=[],r=1e7,a=void 0,i=Jw(e);try{for(i.s();!(t=i.n()).done;){var o=t.value,s=(o.get(!0)-o.min)/(o.max-o.min);s<r&&(r=s,a=o),n[o.id]=s}}catch(d){i.e(d)}finally{i.f()}var c,u=Math.max(1e-5,r),l=new cb.a("macro +"+e.length,this.sequencerEngine,this.context,!1,u),f=Jw(e);try{for(f.s();!(c=f.n()).done;){var h=c.value;h===a?l.addParameter(h):function(){var e=(h.get(!0)+h.min*(u-1))/u,t=h.name.toLowerCase();["level","gain","volume"].some(function(e){return t.includes(e)})&&(e=h.max),l.addParameter(h,h.min,e)}()}}catch(d){f.e(d)}finally{f.f()}return this.macros.push(l),this.setParameter(l.macroParameter),l}},{key:"loadMacrosJson",value:function(e){var t,n=[],r=Jw(this.modules);try{for(r.s();!(t=r.n()).done;){var a=t.value;n=[].concat(Object(h.a)(n),Object(h.a)(a.getAllParameters()));var i,o=Jw(a.lfos);try{for(o.s();!(i=o.n()).done;){var s=i.value;n=[].concat(Object(h.a)(n),Object(h.a)(s.lfo.parameters))}}catch(g){o.e(g)}finally{o.f()}var c,u=Jw(a.envelopes);try{for(u.s();!(c=u.n()).done;){var l=c.value;n=[].concat(Object(h.a)(n),Object(h.a)(l.parameters))}}catch(g){u.e(g)}finally{u.f()}var f,d=Jw(a.tracks);try{for(d.s();!(f=d.n()).done;){var p=f.value;n=[].concat(Object(h.a)(n),Object(h.a)(p.getAllParameters()))}}catch(g){d.e(g)}finally{d.f()}}}catch(g){r.e(g)}finally{r.f()}var v,m=Jw(e);try{for(m.s();!(v=m.n()).done;){var y=v.value,b=new cb.a(y.name,this.sequencerEngine,this.context,!1);b.fromJson(y,n),this.macros.push(b)}}catch(g){m.e(g)}finally{m.f()}}}]),n}(e)})(function(){return function e(){Object(o.a)(this,e)}}()));function bx(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return gx(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gx(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function gx(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ox(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function jx(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return kx(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kx(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function kx(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function wx(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var xx=new ua.a(32,!1),Sx=function(e){Object(u.a)(n,e);var t=wx(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];arguments.length>5&&arguments[5];return Object(o.a)(this,n),r=t.call(this,e,i,s,a,u),u||(r.searcher=new Dw.a(new Fw.a(e),Object(c.a)(r)),r.searcher.cache.loadIndex()),r.cursor=new Bw(e),r.stereoOnly=a,r}return Object(s.a)(n,[{key:"setScripting",value:function(e){this.scripting=e}},{key:"clearSequence",value:function(){this.tracks.map(function(e){return e.pattern.clear()}),this.updateTracks()}},{key:"getSelectedStep",value:function(){return this.cursor.getStep(this.resolution)}},{key:"getSelectedStepData",value:function(){return this.getSelectedTrack().getStepAtResolution(this.cursor.step,xx)}},{key:"getSelectedMidiTrack",value:function(){return this.tracks[this.state.tracks.selectedMidiTrack]}},{key:"getSelectedTrack",value:function(){return void 0===this.cursor.track?0:this.tracks?this.tracks[this.cursor.track]:void 0}},{key:"selectMidiTrack",value:function(e){this.store.dispatch(Object(J.vd)(e))}},{key:"selectEffect",value:function(e){if(!e||e.name){this.selectedEffect=e,this.dispatch(Object(J.rd)(e?e.id:void 0));var t=this.state.selector.quickAddSearchText;t&&""!==t||this.dispatch(Object(J.Ed)(e))}}},{key:"selectTrack",value:function(e){this.cursor.track=e;var t=this.state.selector.quickAddSearchText;t&&""!==t||this.dispatch(Object(J.Ed)(this.tracks[e])),this.state.mix.selectedTrack!==this.cursor.track&&(this.store.dispatch(Object(J.Cd)(e)),this.store.dispatch(Object(J.a)())),this.store.dispatch(Object(J.vd)(e)),this.tracks[e]&&this.tracks[e].updateSteps(),this.tracks[e]&&(this.cursor.step=this.cursor.step%this.tracks[e].pattern.length()),this.store.dispatch(Object(J.Bd)(this.cursor.getStep(this.resolution))),this.store.dispatch(Object(J.td)(void 0));var n,r=jx(this.currentSubSequence.pads);try{for(r.s();!(n=r.n()).done;){n.value.sendMessage("selected track",e)}}catch(a){r.e(a)}finally{r.f()}}},{key:"select",value:function(e,t,n){void 0!==this.tracks[e]&&(n&&n.subSequence!==this.currentSubSequence&&this.switchToSubSequence(n.subSequence.id),this.tracks[e].stepSelected(t),this.cursor.setStep(t,this.resolution),this.cursor.track=e,this.store.dispatch(Object(J.Cd)(e)),this.store.dispatch(Object(J.Bd)(t)))}},{key:"selectGroupStep",value:function(e,t){this.cursor.setStep(t,this.resolution),this.cursor.group=e,this.store.dispatch(Object(J.Bd)(t))}},{key:"isSelectedTrackPad",value:function(){var e=this.getSelectedTrack();return e&&void 0!==e.pad}},{key:"left",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;if(0!=this.tracks.length){var n=this.cursor.getStep(this.resolution);if(--n<0){t||this.up(e);var r=this.getTrackLength();return this.cursor.setStep(r-1,this.resolution),void(e&&(this.store.dispatch(Object(J.Cd)(this.cursor.track)),this.store.dispatch(Object(J.Bd)(r-1))))}this.cursor.setStep(n,this.resolution),this.tracks[this.cursor.track].stepSelected(this.cursor.step),e&&this.cursor.updateRedux()}}},{key:"getTrackLength",value:function(){return this.getSelectedTrack().getStepsAtResolution(this.resolution).length}},{key:"right",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;if(0!=this.tracks.length){var n=this.tracks[this.cursor.track].getStepsAtResolution(this.resolution).length,r=this.cursor.getStep(this.resolution);if(++r>=n)return this.cursor.step=0,t||this.down(e),void(e&&this.cursor.updateRedux());this.cursor.setStep(r,this.resolution),this.tracks[this.cursor.track].stepSelected(this.cursor.step),this.store.getState().mix.selectedTrack!==this.cursor.track&&e&&this.store.dispatch(Object(J.Cd)(this.cursor.track)),e&&this.store.dispatch(Object(J.Bd)(r))}}},{key:"setSelectedTrack",value:function(e){this.store.dispatch(Object(J.Cd)(e))}},{key:"up",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!=this.tracks.length){if(0==this.cursor.track)return this.cursor.track=this.tracks.length-1,void(this.store.getState().mix.selectedTrack!==this.cursor.track&&this.selectTrack(this.cursor.track));this.cursor.track--,this.store.getState().mix.selectedTrack!==this.cursor.track&&this.selectTrack(this.cursor.track),this.tracks[this.cursor.track].stepSelected(this.cursor.step)}}},{key:"down",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!=this.tracks.length){if(this.cursor.track==this.tracks.length-1)return this.cursor.track=0,void this.selectTrack(this.cursor.track);this.cursor.track++,this.store.getState().mix.selectedTrack!==this.cursor.track&&this.selectTrack(this.cursor.track),this.tracks[this.cursor.track].stepSelected(this.cursor.step)}}},{key:"getSample",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r){var i,o,s,c,u;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,rr.a.getGuildsWithAccess();case 2:return i=n.sent,n.next=5,Object(_w.a)(e,i);case 5:return o=n.sent,0,s=o[0],c=new H.a(s),n.next=11,c.load();case 11:u=new De.a(c,t),console.log("get sample tags=",e),u.sounds=o,u.initBuffers(),r({sample:c,samplesStream:u});case 16:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}())}},{key:"searchForSounds",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o,s,c,u,l,f,h,d,p,v,m,y,b,g,O=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=O.length>2&&void 0!==O[2]?O[2]:this.getSelectedTrack(),i=!(O.length>3&&void 0!==O[3])||O[3],o=!(O.length>4&&void 0!==O[4])||O[4],s=O.length>5?O[5]:void 0,c=!(O.length>6&&void 0!==O[6])||O[6],u=O.length>7&&void 0!==O[7]&&O[7],l=O.length>8?O[8]:void 0,r||!n){e.next=9;break}return e.abrupt("return");case 9:return(new Date).getTime(),e.next=12,rr.a.getGuildsWithAccess();case 12:return f=e.sent,e.next=15,Object(_w.a)(t,f,s,u,l);case 15:if(h=e.sent,d=(new Date).getTime(),!(h.length>0)){e.next=50;break}if(p=h[0],!n){e.next=36;break}if(v=i?new H.a(p):r.sample,(m=c?new De.a(v,this):r.samplesStream).tags=t,m.sounds=h.slice(1),m.filterFavorites=s,i){e.next=30;break}c&&r.newSampleStream(m),r.updateSteps(),e.next=34;break;case 30:return e.next=32,v.load();case 32:m.initBuffers(),r.auditionSound(v,!1,m);case 34:e.next=50;break;case 36:return y=new H.a(p),e.next=39,y.load();case 39:return e.next=41,this.addSound(y,void 0,void 0,void 0,void 0,void 0,o);case 41:return b=(new Date).getTime(),b-d,(g=this.tracks[this.tracks.length-1]).samplesStream.tags=t,g.samplesStream.sounds=h.slice(1),this.scrollToSelectedTrack(),g.updateSteps(),setTimeout(function(){g.samplesStream.initBuffers()},250),e.abrupt("return",g);case 50:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=Ox(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).higherOrderSequencer=new yx(Object(c.a)(e)),e}return Object(s.a)(n,[{key:"applyHigherOrderSequencing",value:function(e){var t=this.higherOrderSequencer.wasRolling,n=this.higherOrderSequencer.isRolling(),r=n.isRolling,a=n.isNewRoll,i=n.modules;if(r!==t||a){var o=this.higherOrderSequencer.getStepForModule(e);this.setSequenceRolling(r,void 0,!0,o,a);var s,c=bx(this.subSequences);try{for(c.s();!(s=c.n()).done;){var u=s.value;u.higherRolling=r?i.includes(u):void 0}}catch(l){c.e(l)}finally{c.f()}}}}]),n}(e)}(qw));t.default=Sx},,function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(7),u=n(8),l=n(2),f=n(308),h=n(149),d=n(142),p=(n(221),n(153)),v=n(157),m=n(233),y=n(119);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}function g(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}n(159);var k=n(127),w=n(122);function x(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var E=n(833),T=(new Date(2018,7,3),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.a,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(o.a)(this,e),this.ethereum=t,this.linkedPromiseList=void 0,this.results=[],this.includePrivate=n}return Object(s.a)(e,[{key:"executeQuery",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=7e6,!navigator.onLine){e.next=5;break}return e.next=4,this.getCurrentBlock();case 4:n=e.sent;case 5:return e.next=7,this.start(t,n-3e6,n);case 7:return this.linkedPromiseList=e.sent,e.abrupt("return",this);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getNext",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.linkedPromiseList&&!this.canceled){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.next=4,this.linkedPromiseList.getCurrent();case 4:if(t=e.sent,t=Array.from(new Set(t)),this.results=this.results.concat(t),this.results=this.sort(this.results),void 0!==this.linkedPromiseList){e.next=10;break}return e.abrupt("return",void 0);case 10:return e.next=12,this.linkedPromiseList.getNext();case 12:return this.linkedPromiseList=e.sent,e.abrupt("return",this.linkedPromiseList);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var o,s=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n<=3e6)){e.next=2;break}return e.abrupt("return",new Promise(function(e,t){return e(void 0)}));case 2:return console.log("Get Sequences start fromBlock=%s toBlock=%s",n,r),o=this.ethereum.tokenizedSequences,e.abrupt("return",new E.a(Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.getSequences(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),new E.a(Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.ethereum.getNewSequences(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),this.start(t,n-3e6,r-3e6))));case 5:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sort",value:function(e){return e.sort(function(e,t){return t.blockNumber-e.blockNumber}),e}},{key:"getCurrentBlock",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ethereum.web3.eth.getBlockNumber();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}()),A=n(834);function M(e){return R.apply(this,arguments)}function R(){return(R=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===m.d?3:14;break;case 3:return console.log("link type was correct"),n=new T,e.next=7,n.executeQuery();case 7:return e.next=9,n.getNext();case 9:if(!e.sent){e.next=13;break}console.log("getting next"),e.next=7;break;case 13:return e.abrupt("return",k.a.collapseAllSequences(n.results).map(function(e){return new A.a(void 0,void 0,e.newSequence,void 0,e.title)}));case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}var C=function e(){Object(o.a)(this,e)};function N(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var _={},D=n(831),F=n(141),L=n(412);function B(e,t){return z.apply(this,arguments)}function z(){return(z=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===m.d?3:7;break;case 3:return e.next=5,H(n);case 5:return r=e.sent,e.abrupt("return",r.map(function(e){return{linkType:t,fromData:n,toData:e}}));case 7:return e.next=9,k.a.xanadu.getLinks(t,n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function J(e,t,n){return V.apply(this,arguments)}function V(){return(V=Object(i.a)(a.a.mark(function e(t,n,r){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===m.d?3:8;break;case 3:return(i=new F.a(r)).fromData=n,e.next=7,i.fetchMetadata();case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function H(e){return U.apply(this,arguments)}function U(){return(U=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.getJson(t);case 2:return n=e.sent,e.abrupt("return",Object(L.a)(n));case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function G(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var W=function(e){Object(c.a)(n,e);var t=G(n);function n(e,r,a,i){var s,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return Object(o.a)(this,n),(s=t.call(this,a,i,c)).linkType=e,s.fromData=r,s.isLoaded=!1,s}return Object(s.a)(n,[{key:"isDynamic",value:function(){return!0}},{key:"load",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:k.a.xanadu,!this.isRoot()){e.next=5;break}return e.next=4,this.loadRoot(t);case 4:return e.abrupt("return");case 5:return e.next=7,B(this.linkType,this.fromData);case 7:n=e.sent,e.t0=a.a.keys(n);case 9:if((e.t1=e.t0()).done){e.next=19;break}return r=e.t1.value,i=n[r],e.t2=this,e.next=15,J(this.linkType,this.fromData,i.toData);case 15:e.t3=e.sent,e.t2.addItem.call(e.t2,e.t3),e.next=9;break;case 19:this.isLoaded=!0;case 20:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadRoot",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t=this,r=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>0&&void 0!==r[0]?r[0]:k.a.xanadu,e.next=3,M(this.linkType);case 3:return e.sent.map(function(e){return new n(t.linkType,e.getId(),e.getName(),t)}).forEach(function(e){return t.addFolder(e)}),this.isLoaded=!0,e.abrupt("return",this);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(D.a);function K(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}function Q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var Z=function(e){Object(c.a)(n,e);var t=Q(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this)).web3=e,r.contract=(new f.a).getContract(e),r.linkFolder=new W(m.d),r.sequencesCache=void 0,r}return Object(s.a)(n,[{key:"load",value:function(){return this.linkFolder.loadRoot(this)}},{key:"newDataType",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newDataType",[this.web3.utils.fromAscii(t),n]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newLinkType",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newLinkType",[this.web3.utils.fromAscii(t),n]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newLinks",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newLink",[this.web3.utils.fromAscii(t),n,r]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getDataTypes",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.a((new f.a).contractAddress).from(y.j).select("dataType").select("description"),e.next=3,t.executeQuery();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getLinkTypes",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.a((new f.a).contractAddress).from(y.w).select("linkType").select("description"),e.next=3,t.executeQuery();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getLinks",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o,s,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new d.a((new f.a).contractAddress).from(y.v).select("fromData").select("toData").where("linkType",t),n&&i.where("fromData",n),r&&i.where("toData",r),e.next=5,i.executeQuery();case 5:o=e.sent,s=[],c=function(e){var t=o[e].fromData;if(s.some(function(e){return e.fromData===t}))return"continue";s.push(o[e])},e.t0=a.a.keys(o);case 9:if((e.t1=e.t0()).done){e.next=16;break}if(u=e.t1.value,"continue"!==c(u)){e.next=14;break}return e.abrupt("continue",9);case 14:e.next=9;break;case 16:return e.abrupt("return",s);case 17:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(function(e){return function(e){Object(c.a)(n,e);var t=K(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"presetResampled",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.newLinks(m.b,Object(p.b)(t),Object(p.b)(n));case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getResampledPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLinks(m.b,t);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].toData);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),n}(e)}(function(e){return function(e){Object(c.a)(n,e);var t=j(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"syncProjectBPM",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newAnnotation",[this.web3.utils.fromAscii(m.c),Object(p.b)(t),this.web3.utils.fromAscii(n.toString())]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getProjectsWithBPM",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o,s,c,u,l,h,p;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new d.a((new f.a).contractAddress).from(y.g).select("data").select("annotationData").where("annotationType",m.c).whereIn("data",t),r&&i.where("address",r.toLowerCase()),e.next=4,i.executeQuery();case 4:o=e.sent,s={},c=g(o);try{for(c.s();!(u=c.n()).done;)l=u.value,h=l.data,p=parseInt(l.annotationData),void 0===s[h]&&p===n&&(s[h]=p)}catch(a){c.e(a)}finally{c.f()}return e.abrupt("return",Object.keys(s));case 9:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getProjectBPM",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new d.a((new f.a).contractAddress).from(y.g).select("data").select("annotationData").where("data",t).where("annotationType",m.c),n&&r.where("address",n.toLowerCase()),e.next=4,r.executeQuery();case 4:if(0!==(i=e.sent).length){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.abrupt("return",parseInt(i[0].annotationData));case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}]),n}(e)}(function(e){return function(e){Object(c.a)(n,e);var t=q(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"rateSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:m.e,e.next=3,new v.a(h.q,"newAnnotation",[this.web3.utils.fromAscii(r),Object(p.b)(t),this.web3.utils.fromAscii(n.toString())]).execute();case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSoundsWithRating",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o,s,c,u,l,h,p;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new d.a((new f.a).contractAddress).from(y.g).select("data").select("annotationData").whereIn("data",t),r&&i.where("address",r.toLowerCase()),e.next=4,i.executeQuery();case 4:o=e.sent,s={},c=N(o);try{for(c.s();!(u=c.n()).done;)l=u.value,h=l.data,p=parseInt(l.annotationData),void 0===s[h]&&p===n&&(s[h]=p)}catch(a){c.e(a)}finally{c.f()}return e.abrupt("return",Object.keys(s));case 9:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSoundRating",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:m.e,r=c.length>2?c[2]:void 0,i=n+"."+t,r&&(i+=" "+r),!(i in _)){e.next=6;break}return e.abrupt("return",_[i]);case 6:return o=new d.a((new f.a).contractAddress).from(y.g).select("data").select("annotationData").where("data",t),r&&o.where("address",r.toLowerCase()),e.next=10,o.executeQuery();case 10:if(0!==(s=e.sent).length){e.next=14;break}return _[i]=void 0,e.abrupt("return",void 0);case 14:return _[i]=parseInt(s[0].annotationData),e.abrupt("return",_[i]);case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),n}(e)}(function(e){return function(e){Object(c.a)(n,e);var t=b(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"syncPadType",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newAnnotation",[this.web3.utils.fromAscii(m.a),Object(p.b)(t),this.web3.utils.fromAscii(n)]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPacksWithType",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new d.a((new f.a).contractAddress).from(y.g).select("data").select("annotationData").where("annotationData",n),e.next=3,i.executeQuery();case 3:return o=e.sent,e.abrupt("return",o.map(function(e){return e.data}));case 5:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(e)}(function(e){Object(c.a)(n,e);var t=P(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).annotationContentCache={},e}return Object(s.a)(n,[{key:"newAnnotationType",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newAnnotationType",[this.web3.utils.fromAscii(t),n]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAnnotations",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=s.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=s[i];return o=new d.a((new f.a).contractAddress).from(y.g).select("data").select("annotationData").select("address").where("annotationType",t).whereIn("data",r),e.next=4,o.executeQuery();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getContentReferences",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new d.a((new f.a).contractAddress).from(y.g).select("data").where("annotationData",t),e.next=3,n.executeQuery();case 3:return r=e.sent,e.abrupt("return",r.map(function(e){return e.data}));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getFlattenedAnnotations",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,s,c,u,l,f,h,d,p,v,m=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=m.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=m[i];return e.next=3,this.getAnnotations.apply(this,[t].concat(r));case 3:o=e.sent,s={},c=x(o);try{for(c.s();!(u=c.n()).done;)l=u.value,(f=l.annotationData)in s||(s[f]=[]),s[f].push(l)}catch(a){c.e(a)}finally{c.f()}for(d in h=[],s)p=s[d],v={annotationData:d,address:p[0].address,contentHashes:p.map(function(e){return e.data}),blockNumber:p[0].blockNumber},h.push(v);return e.abrupt("return",h);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAnnotationContents",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,o,s,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAnnotations(t,n);case 2:r=e.sent,i=this.web3.utils,o=x(r),e.prev=5,o.s();case 7:if((s=o.n()).done){e.next=17;break}return c=s.value,u=void 0,i.fromAscii(c.annotationData),e.next=13,w.a.getJson(Object(p.a)(i.fromAscii(c.annotationData)));case 13:u=e.sent,c.content=u;case 15:e.next=7;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(5),o.e(e.t0);case 22:return e.prev=22,o.f(),e.finish(22);case 25:return e.abrupt("return",r);case 26:case"end":return e.stop()}},e,this,[[5,19,22,25]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newAnnotation",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newAnnotation",[this.web3.utils.fromAscii(t),Object(p.b)(n),this.web3.utils.fromAscii(r)]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"newAnnotationContent",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.addJson(r);case 2:return i=e.sent,e.next=5,this.newAnnotationHash(t,n,i);case 5:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"newAnnotationHash",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newAnnotation",[this.web3.utils.fromAscii(t),Object(p.b)(n),Object(p.b)(r)]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getAnnotationTypes",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.a((new f.a).contractAddress).from(y.h).select("annotationType").select("description"),e.next=3,t.executeQuery();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),n}(C))))));t.a=Z},,function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=function(){function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"}],name:"new2DMapping",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"ipfsHash",type:"bytes32"}],name:"New2DMapping",type:"event"}],this.contractAddress="0x50ff08f58ba3d2cbeaa07326267332e41dc946aa"}return Object(s.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),u=n(119),l=n(221),f=n(122),h="X",d=function(){function e(t){if(Object(o.a)(this,e),t.length<=1)this.pivot=t[0];else{var n=this.getPivotAndDimension(t);this.pivot=n.pivot,this.dimension=n.dimension,this.range=n.range;var r=t.indexOf(this.pivot);t.splice(r,1);var a=this.getSubTreePoints(this.pivot,this.dimension,t);this.leftSubTree=new e(a.left),this.rightSubTree=new e(a.right)}}return Object(s.a)(e,[{key:"getSubTreePoints",value:function(e,t,n){var r=[],a=[],i=this.getValueForDimension(e,t);for(var o in n){var s=n[o],c=this.getValueForDimension(s,t);c<i?r.push(s):c>=i&&a.push(s)}return{left:r,right:a}}},{key:"getValueForDimension",value:function(e,t){return t===h?e.point[0]:e.point[1]}},{key:"getPivotAndDimension",value:function(e){var t=this.chooseDimension(e),n=t.dimension,r=(t.max+t.min)/2,a=void 0,i=1e4;for(var o in e){var s=e[o],c=n===h?Math.abs(s.point[0]-r):Math.abs(s.point[1]-r);c<i&&(a=s,i=c)}return{pivot:a,dimension:n,range:{min:t.min,max:t.max}}}},{key:"chooseDimension",value:function(e){var t=1e4,n=1e4,r=-1e4,a=-1e4;for(var i in e){var o=e[i].point[0],s=e[i].point[1];o<t&&(t=o),o>r&&(r=o),s<n&&(n=s),s>a&&(a=s)}return r-t>a-n?{dimension:h,min:t,max:r}:{dimension:"Y",min:n,max:a}}},{key:"getPointsInRange",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(void 0===this.pivot)return[];var i=this.pivot.point[0],o=this.pivot.point[1],s=[];return i>=e&&i<=n&&o>=t&&o<=r&&s.push(this.pivot),this.dimension==h?(i<=n&&e<=this.range.max&&void 0!==this.rightSubTree&&(s=s.concat(this.rightSubTree.getPointsInRange(e,t,n,r,a+1))),i>=e&&n>=this.range.min&&void 0!==this.leftSubTree&&(s=s.concat(this.leftSubTree.getPointsInRange(e,t,n,r,a+1)))):"Y"===this.dimension&&(o<=r&&t<=this.range.max&&void 0!==this.rightSubTree&&(s=s.concat(this.rightSubTree.getPointsInRange(e,t,n,r,a+1))),o>=t&&r>=this.range.min&&void 0!==this.leftSubTree&&(s=s.concat(this.leftSubTree.getPointsInRange(e,t,n,r,a+1)))),s}},{key:"size",value:function(){var e=1;return void 0!==this.leftSubTree&&(e+=this.leftSubTree.size()),void 0!==this.rightSubTree&&(e+=this.rightSubTree.size()),e}},{key:"inRange",value:function(e,t,n,r){return void 0!==this.range&&(this.dimension===h?e>=this.range.min&&e<=this.range.max:t>=this.range.min&&t<=this.range.max)}}]),e}(),p=new c,v=function(){function e(t){Object(o.a)(this,e),this.contract=p.getContract(t),this.loaded=!1}return Object(s.a)(e,[{key:"load",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new l.a(this.contract.contractAddress).from(u.f).select("ipfsHash").executeQuery();case 2:if(0!==(t=e.sent).length){e.next=5;break}return e.abrupt("return");case 5:return n=t[t.length-1].ipfsHash,e.next=8,f.a.getJson(n);case 8:r=e.sent,this.points=r,this.pointsMap=this.getMap(r),console.log("constructing KD tree"),this.kdTree=new d(this.points),console.log("finished constructing KD tree size="),console.log(this.kdTree.size()),this.loaded=!0;case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPointsInRange",value:function(e,t,n,r){var a=(new Date).getTime(),i=this.kdTree.getPointsInRange(e,t,n,r),o=(new Date).getTime();return console.log("finished getting points in "+(o-a)+" ms"),i}},{key:"getMap",value:function(e){var t={};for(var n in e){var r=e[n];t[r.path]=r}return t}},{key:"findSimilarSounds",value:function(e){var t=void 0;for(var n in this.points)this.points[n].path===e&&(t=this.points[n]);if(void 0===t)return console.log("no point"),[];var r=[];for(var a in this.points){var i=this.distance(t,this.points[a]);r.push({point:this.points[a],distance:i})}return r.sort(function(e,t){return e.distance-t.distance}),r.slice(0,100).map(function(e){return e.point.path})}},{key:"distance",value:function(e,t){var n=e.point[0],r=e.point[1],a=t.point[0],i=t.point[1];return Math.sqrt(Math.pow(a-n,2)+Math.pow(i-r,2))}}]),e}();t.a=v},,function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=n(822),u=n(157),l=n(149),f=n(142),h=n(119),d=n(122),p=n(159);var v=n(153),m=new c.a,y=function(){function e(t){Object(o.a)(this,e),this.web3=t,this.contract=m.getContract(t),this.contractAddress=m.contractAddress}return Object(s.a)(e,[{key:"sendMessage",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3?arguments[3]:void 0;return new Promise(function(){var s=Object(i.a)(a.a.mark(function i(s,c){var f,h,m;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(void 0!==e){a.next=4;break}return a.next=3,p.a.getAccount();case 3:e=a.sent;case 4:return f={type:r,referenceHash:n,content:o},a.next=7,d.a.addJson(f,!0);case 7:h=a.sent,m=Object(v.b)(h),n=null!==n?Object(v.b)(n):t.web3.utils.padLeft("0x0",64),new u.a(l.l,"sendPublicMessage",[e,n,m]).execute().then(function(){s(h)});case 11:case"end":return a.stop()}},i)}));return function(e,t){return s.apply(this,arguments)}}())}},{key:"getMessages",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,o=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:null,n=o.length>1?o[1]:void 0,e.next=4,this.getQuery(t,n);case 4:return r=e.sent,e.next=7,r.executeQuery();case 7:return i=e.sent,e.abrupt("return",i);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"watchForNewMessages",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:null,n=i.length>1?i[1]:void 0,r=i.length>2?i[2]:void 0,e.next=5,this.getQuery(t,n);case 5:e.sent.watchQuery(r);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getQuery",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:null,n=i.length>1?i[1]:void 0,r=new f.a(this.contractAddress).from(h.Q).select("fromUser").select("referenceHash").select("messageHash").where("referenceHash",t),n&&r.where("toUser",n),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=y},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),o=n(4),s=n(5),c=function(){function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"reasoningHash",type:"bytes32"}],name:"copyStrikeSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"newDesignatedAgent",type:"address"}],name:"switchDesignatedAgent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"}],name:"takedownSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"reasoningHash",type:"bytes32"}],name:"SampleCopyStrike",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"}],name:"SampleTakenDown",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"agent",type:"address"}],name:"NewDesignatedAgent",type:"event"}],this.contractAddress="0xAd4752a6C01C2B25b6248bEB33B1B03f2BE9F9E7"}return Object(s.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),u=n(153),l=n(221),f=n(119),h=n(122),d=new c,p=function(){function e(t){Object(o.a)(this,e),this.web3=t,this.contract=d.getContract(t),this.contractAddress=d.contractAddress}return Object(s.a)(e,[{key:"getCopyStrikedSamples",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new l.a(this.contractAddress).from(f.T).select("sampleHash").select("reasoningHash"),e.next=3,t.executeQuery();case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTakenDownSamples",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new l.a(this.contractAddress).from(f.ab).select("sampleHash"),e.next=3,t.executeQuery();case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"copyStrikeSample",value:function(e,t,n){var r=this;return new Promise(function(){var o=Object(i.a)(a.a.mark(function i(o,s){var c,l,f;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,r.web3.eth.getAccounts();case 2:return c=a.sent,l={reasoning:n,emailAddress:t},a.next=6,h.a.addJson(l,!0);case 6:f=a.sent,f=Object(u.b)(f),e=Object(u.b)(e),r.contract.methods.copyStrikeSample(e,f).send({from:c[0]},function(e,t){e?s():o()});case 10:case"end":return a.stop()}},i)}));return function(e,t){return o.apply(this,arguments)}}())}},{key:"takeDownSample",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var o;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:o=n.sent,e=Object(u.b)(e),t.contract.methods.takedownSample(e).send({from:o[0]},function(e,t){e?i():r()});case 5:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}}]),e}();t.a=p},,,,,,function(e,t,n){"use strict";n.r(t);var r=n(108),a=n(3),i=n.n(a),o=n(11),s=n(55),c=(n(997),n(23)),u=Object(s.b)(function(e,t){return{minimizedSubPatches:e.zobject.minimizedSubPatches,viewableSubPatches:e.zobject.viewableSubPatches}},function(e){return{setViewableSubPatches:function(t){return e(Object(c.We)(t))},setMinimizedSubPatches:function(t){return e(Object(c.lc)(t))}}})(function(e){var t=e.minimizedSubPatches,n=e.viewableSubPatches,r=e.setViewableSubPatches,s=e.setMinimizedSubPatches,c=Object(a.useCallback)(function(e){if(n.includes(e))return t.includes(e)||s([].concat(Object(o.a)(t),[e])),void r(Object(o.a)(n.filter(function(t){return t!==e})));r([].concat(Object(o.a)(n),[e]))},[t,n]),u=[].concat(Object(o.a)(t),Object(o.a)(n.filter(function(e){return!t.includes(e)})));return i.a.createElement("div",{className:"minimized-subpatches"},u.map(function(e){return i.a.createElement("div",{onClick:function(){return c(e)},className:n.includes(e)?"subpatch-option viewing":"subpatch-option"},i.a.createElement("img",{src:"/subpatch-light.svg"}),e.name())}))}),l=Object(s.b)(function(e,t){return{minimizedSubPatches:e.zobject.minimizedSubPatches,viewableSubPatches:e.zobject.viewableSubPatches}},function(e){return{}})(function(e){var t=e.minimizedSubPatches,n=e.viewableSubPatches;return 0===t.length&&0===n.length?"":i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},onMouseDown:function(e){return e.stopPropagation()},className:"subpatch-dock"},i.a.createElement(u,null))}),f=n(136),h=n(324),d=n.n(h),p=(n(1009),Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.sequencerEngine,n=Object(a.useState)(!1),o=Object(r.a)(n,2),s=o[0],c=o[1],u=Object(a.useState)(),l=Object(r.a)(u,2),f=l[0],h=l[1],p=Object(a.useState)(!1),v=Object(r.a)(p,2),m=v[0],y=v[1],b=Object(a.useState)(),g=Object(r.a)(b,2),O=g[0],j=g[1];Object(a.useEffect)(function(){window.addEventListener("click",k)},[c]);var k=Object(a.useCallback)(function(){c(!1)},[c]);Object(a.useEffect)(function(){if(t){var e=t.currentSubSequence.findNodeByName("spore.stems")[0];console.log("spore stems found=",e),e&&(h(e.effect),j(e.effect.playlist[0]))}},[t]);var w="spores-playlister";return s&&(w+=" showing"),f?i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:w},s?i.a.createElement("div",{className:"spores-playlist"},i.a.createElement("div",{onClick:function(){return c(!1)},className:"arrow-down"}),i.a.createElement("div",{className:"artist-name"},"Keyon Christ"),f.playlist.map(function(e){return i.a.createElement("div",{onClick:function(n){O!==e?(t.stop(),t.seekToTrackStep(0),j(e),y(!0),f.loadSong(e).then(function(e){y(!1),setTimeout(function(){t.play()},150)})):c(!1)},className:e===O?"song-item current":"song-item"},i.a.createElement("div",{className:"song-title"},e.name),e===O&&m&&i.a.createElement(d.a,{sizeUnit:"px",className:"pulse-loader",size:6,color:"#aab7ba",loading:!0}))})):i.a.createElement("img",{onClick:function(){return c(!0)},className:"pushable spores-icon",src:(window.isNFT?"":"/")+"spores-icon-glow2.svg"})):""})),v=function(e){var t=e.rollSteps,n=e.stepNumber,r=(e.resolution,{left:39*(n=n/2%16),width:39*(t/=2)});return i.a.createElement("div",{className:"roll-visualizer",style:r})},m=n(4),y=n(5),b=n(7),g=n(8),O=n(2);function j(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var x=function(e){Object(b.a)(n,e);var t=w(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"getClassName",value:function(e){var t=Math.floor(this.props.currentStep/2)%16,n="";(n=this.props.stepNumber===t?"current-step step":this.props.stepNumber<t?"previous-step step":"step",this.props.toggled&&this.props.stepNumber!==t&&(n+=" toggled"),void 0!==this.props.rollingStepNumber)&&(Math.floor(this.props.rollingStepNumber/2)%16===this.props.stepNumber&&(n+=" rolling-step"));return n}},{key:"isCurrent",value:function(){var e=Math.floor(this.props.currentStep/2)%16;return!(!this.props.toggled||this.props.stepNumber!==e)}},{key:"render",value:function(){var e=this.getClassName(),t={};if(this.isCurrent()){var n,r=0,a=j(this.props.sequencerEngine.tracks);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.isFrozen||(r+=(o.triggerCount||0)+(o.otherTriggerCount||0))}}catch(s){a.e(s)}finally{a.f()}r>0&&(r=Math.pow(r,1.3),t.boxShadow="0px 0px ".concat(r,"px ").concat(r,"px #ff5151"))}return i.a.createElement("div",{style:t,onMouseOver:this.props.onMouseOver,onMouseDown:this.props.onMouseDown,className:e})}}]),n}(a.Component),S=Object(s.b)(function(e,t){return{toggled:e.steps.masterStepToggles[t.stepNumber]}},null)(x),P=Object(s.b)(function(e,t){var n=t.sequencerEngine.getSequenceId();return{stepNumber:e.sequencer.currentGlobalStep[n]||0,masterStepToggles:e.steps.masterStepToggles,isSequenceRolling:t.sequencerEngine.isSequenceRolling}},function(e){return{setMasterStepToggles:function(t){return e(Object(c.hc)(t))},mouseDown:function(t){return e(Object(c.j)(t))}}})(function(e){var t=Object(a.useCallback)(function(t){var n=e.masterStepToggles;n[t]=!n[t],e.setMasterStepToggles(n)},[]),n=Object(a.useCallback)(function(n){e.sequencerEngine.state.keyboard.isMouseDown&&t(n)},[]),r=Array(16).fill(0),o=e.stepNumber,s=void 0,c=void 0,u=void 0;if(e.isSequenceRolling){var l=e.sequencerEngine.tracks[0];if(l){var f=l.getFactoredResolution().getNumberOfStepsAtBaseResolution(),h=l.patternRollStepNumber+e.stepNumber%f;s=h%l.pattern.stepBuckets.length,c=f,u=l.patternRollStepNumber}}return i.a.createElement("div",{onMouseUp:function(){return e.mouseDown(!1)},onMouseDown:function(){return e.mouseDown(!0)},className:"steps-visualizer"},e.isSequenceRolling?i.a.createElement(v,{rollSteps:c,stepNumber:u}):"",r.map(function(r,a){return i.a.createElement(S,{key:a,sequencerEngine:e.sequencerEngine,onMouseOver:function(){return n(a)},onMouseDown:function(){return t(a)},stepNumber:a,rollingStepNumber:void 0!==s?o:s,currentStep:void 0!==s?s:o})}))}),E=n(26),T=(n(1010),Object(s.b)(function(e,t){return{enableRollViewer:e.sequencer.enableRollViewer,viewMode:e.sequencer.viewMode,halftime:t.sequencerEngine&&t.sequencerEngine.keyListener&&t.sequencerEngine.keyListener.halftime,sequenceRolling:e.sequencer.trackRolling&&t.sequencerEngine&&t.sequencerEngine.isSequenceRolling,rollResolution:e.sequencer.resolution}},function(e){return{}})(function(e){var t=e.viewMode,n=e.sequenceRolling,r=e.enableRollViewer,a=e.sequencerEngine,o=e.halftime,s=e.rollResolution;return n||o?t===E.a?"":r?i.a.createElement("div",{className:"rolling-viewer"},i.a.createElement("div",{className:"roll-text"},n?i.a.createElement("span",null,"ROLLING ",s.toString()):i.a.createElement("span",null,"HALF-TIME"),i.a.createElement(P,{sequencerEngine:a}))):"":""}),n(32)),A="N",M="S",R="W",C="E",N=function(e,t){switch(e){case A:return" c 0 -5 0 -5 0 -".concat(t);case M:return" c 0 5 0 5 0 ".concat(t);case C:return" c 5 0 5 0 ".concat(t," 0");case R:return" c -5 0 -5 0 -".concat(t," 0")}},I=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;switch(e){case"SW":return" c 0, ".concat(t,", ").concat(t,", ").concat(t," ").concat(t,", ").concat(t," ");case"SE":return" c ".concat(t,", 0 ").concat(t,", -").concat(t," ").concat(t,", -").concat(t," ");case"NE":return" c 0, -".concat(t," -").concat(t,", -").concat(t," -").concat(t,", -").concat(t," ");case"NW":return" c -".concat(t,", 0 -").concat(t,", ").concat(t," -").concat(t,", ").concat(t," ")}},q=function e(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{sideLength:t,nextLength:n},s=function(e){return e>t?"":(t-=e,N(a,e))};return{go:s,smooth:function(e,r,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20;if(i>t)return s(i-t);switch(t-=Math.abs(i),n-=r,a){case M:return" c 0,".concat(e," ").concat(r,",").concat(o," ").concat(r,",").concat(i," ");case C:return" c ".concat(e,",0 ").concat(o,",").concat(-r," ").concat(i,",").concat(-r," ");case A:return" c 0,".concat(-e," ").concat(-r,",").concat(-o," ").concat(-r,",").concat(-i," ");case R:return" c ".concat(-e,",0 ").concat(-o,",").concat(r," ").concat(-i,",").concat(r," ")}},complete:function(){var e=I(a===M?"SW":a===A?"NE":a===C?"SE":"NW",r);return N(a,t)+" "+e},next:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;return e(n,o.sideLength,t,a===M?C:a===C?A:a===R?M:R,i+1,{sideLength:o.nextLength,nextLength:o.sideLength})}}};function _(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var F=function(e,t,n,r){var a=t%2===0?r:n,i=t%2===0?n:r;return Array.isArray(e)?[a*e[0]/100,i*e[1]/100,a*e[2]/100]:a*e/100},L=function(e,t,n){var r,a=t,i=n,o=_(e.filter(function(e){return"attribute"===e.type}));try{for(o.s();!(r=o.n()).done;){var s=r.value;"radius"===s.value.type&&(a=s.value.value),"relative"===s.type&&(i=s.value)}}catch(c){o.e(c)}finally{o.f()}return{radius:a,relative:i}},B=function(e){var t,n=[],r=_(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.operations?n=[].concat(Object(o.a)(n),Object(o.a)(a.operations)):n.push(a)}}catch(i){r.e(i)}finally{r.f()}return n},z=function(e){return{type:"walk",value:e}},J=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20;return{depth:function(n){return e(t,n,r,a)},tension:function(a){return e(t,n,r,a)},start:function(t){return e(t,n,r,a)},end:function(r){return e(t,n,r,a)},mirror:function(){return e(t,-n,r,a)},type:"smooth",value:[t,n,r,a]}},V=(n(1011),function(e){var t=e.top,n=void 0===t?0:t,s=e.children,c=e.svgFilter,u=e.fill,l=void 0===u?"#0000008c":u,f=e.stroke,h=void 0===f?"white":f,d=e.className,p=void 0===d?"":d,v=e.algo,m=void 0===v?[]:v,y=e.relative,b=void 0===y||y,g=e.radius,O=void 0===g?60:g,j=Object(a.useRef)(),k=Object(a.useState)({width:0,height:0}),w=Object(r.a)(k,2),x=w[0],S=w[1],P=Object(a.useCallback)(function(){if(j.current){var e={width:j.current.offsetWidth,height:j.current.offsetHeight};S(e)}},[S]);Object(a.useEffect)(function(){new ResizeObserver(P).observe(j.current)},[]);var E=Math.max(20,x.width-2*O),T=Math.max(20,x.height-2*O),A=((new Date).getTime(),function(e){var t,n=e.radius,r=e.algo,a=e.relative,i=e.width,s=e.height,c=e.top,u="M 0, ".concat(n+(void 0===c?0:c)," "),l=void 0,f=0,h=0,d=0,p=n,v=_(r);try{for(v.s();!(t=v.n()).done;){var m=t.value,y=L(m,p,a),b=(y._radius,y._relative);void 0===b&&(b=a),m=m.filter(function(e){return"attribute"!==e.type});var g=B(m),O=0;l||(l=q(s,i,n,M));var j,k=_(g);try{for(k.s();!(j=k.n()).done;){var w,x=j.value,S=b?F(x.value,f,i,s):x.value;"walk"===x.type?u+=l.go(S):(O+=S[1],u+=(w=l).smooth.apply(w,Object(o.a)(S)))}}catch(P){k.e(P)}finally{k.f()}u+=l.complete(),l=l.next(),O<0&&(f%2===0?h+=-O:d+=-O),f++}}catch(P){v.e(P)}finally{v.f()}return{xIncrease:h,yIncrease:d,d:u}}({width:E,height:T,algo:m,radius:O,relative:b,top:n})),R=A.d,C=A.xIncrease,N=A.yIncrease;(new Date).getTime();return i.a.createElement("div",{style:{blockSize:"fit-content"},ref:j,className:"relative flex flex-col "+p},i.a.createElement("svg",{width:C+x.width+100+"px",height:N+x.height+100+"px",className:"absolute top-0 left-0 z-0"},c&&c.def,i.a.createElement("path",{filter:c&&c.name,stroke:h,fill:l,d:R})),s)}),H={def:i.a.createElement("defs",null,i.a.createElement("filter",{id:"shadow","color-interpolation-filters":"sRGB"},i.a.createElement("feDropShadow",{dx:"5",dy:"3",stdDeviation:"3","flood-opacity":"0.5"}),"),")),name:"url(#shadow)"},U=(n(1012),Object(s.b)(function(e,t){return{playing:t.sequencerEngine.playing}},function(e){return{}})(function(e){var t,n=Object(a.useRef)(void 0),o=Object(a.useState)(!1),s=Object(r.a)(o,2),c=s[0],u=s[1],l=Object(a.useState)((t={2000:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMTAgMTEwIj48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9Imd6ciIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSg2Ni40NTc4IDI0LjM1NzUpIHNjYWxlKDc1LjI5MDgpIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgcj0iMSIgY3g9IjAiIGN5PSIwJSI+PHN0b3Agb2Zmc2V0PSIxNS42MiUiIHN0b3AtY29sb3I9ImhzbCgyMiwgNzMlLCA4NiUpIiAvPjxzdG9wIG9mZnNldD0iMzkuNTglIiBzdG9wLWNvbG9yPSJoc2woMjIsIDgxJSwgNzglKSIgLz48c3RvcCBvZmZzZXQ9IjcyLjkyJSIgc3RvcC1jb2xvcj0iaHNsKDY3LCA5MSUsIDYzJSkiIC8+PHN0b3Agb2Zmc2V0PSI5MC42MyUiIHN0b3AtY29sb3I9ImhzbCg3MSwgOTYlLCA1MSUpIiAvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iaHNsKDcxLCA5NiUsIDUwJSkiIC8+PC9yYWRpYWxHcmFkaWVudD48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNSw1KSI+PHBhdGggZD0iTTEwMCA1MEMxMDAgMjIuMzg1OCA3Ny42MTQyIDAgNTAgMEMyMi4zODU4IDAgMCAyMi4zODU4IDAgNTBDMCA3Ny42MTQyIDIyLjM4NTggMTAwIDUwIDEwMEM3Ny42MTQyIDEwMCAxMDAgNzcuNjE0MiAxMDAgNTBaIiBmaWxsPSJ1cmwoI2d6cikiIC8+PHBhdGggc3Ryb2tlPSJyZ2JhKDAsMCwwLDAuMDc1KSIgZmlsbD0idHJhbnNwYXJlbnQiIHN0cm9rZS13aWR0aD0iMSIgZD0iTTUwLDAuNWMyNy4zLDAsNDkuNSwyMi4yLDQ5LjUsNDkuNVM3Ny4zLDk5LjUsNTAsOTkuNVMwLjUsNzcuMywwLjUsNTBTMjIuNywwLjUsNTAsMC41eiIgLz48L2c+PC9zdmc+",2001:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMTAgMTEwIj48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9Imd6ciIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSg2Ni40NTc4IDI0LjM1NzUpIHNjYWxlKDc1LjI5MDgpIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgcj0iMSIgY3g9IjAiIGN5PSIwJSI+PHN0b3Agb2Zmc2V0PSIxNS42MiUiIHN0b3AtY29sb3I9ImhzbCgyMiwgNzMlLCA4NiUpIiAvPjxzdG9wIG9mZnNldD0iMzkuNTglIiBzdG9wLWNvbG9yPSJoc2woMjIsIDgxJSwgNzglKSIgLz48c3RvcCBvZmZzZXQ9IjcyLjkyJSIgc3RvcC1jb2xvcj0iaHNsKDY3LCA5MSUsIDYzJSkiIC8+PHN0b3Agb2Zmc2V0PSI5MC42MyUiIHN0b3AtY29sb3I9ImhzbCg3MSwgOTYlLCA1MSUpIiAvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iaHNsKDcxLCA5NiUsIDUwJSkiIC8+PC9yYWRpYWxHcmFkaWVudD48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNSw1KSI+PHBhdGggZD0iTTEwMCA1MEMxMDAgMjIuMzg1OCA3Ny42MTQyIDAgNTAgMEMyMi4zODU4IDAgMCAyMi4zODU4IDAgNTBDMCA3Ny42MTQyIDIyLjM4NTggMTAwIDUwIDEwMEM3Ny42MTQyIDEwMCAxMDAgNzcuNjE0MiAxMDAgNTBaIiBmaWxsPSJ1cmwoI2d6cikiIC8+PHBhdGggc3Ryb2tlPSJyZ2JhKDAsMCwwLDAuMDc1KSIgZmlsbD0idHJhbnNwYXJlbnQiIHN0cm9rZS13aWR0aD0iMSIgZD0iTTUwLDAuNWMyNy4zLDAsNDkuNSwyMi4yLDQ5LjUsNDkuNVM3Ny4zLDk5LjUsNTAsOTkuNVMwLjUsNzcuMywwLjUsNTBTMjIuNywwLjUsNTAsMC41eiIgLz48L2c+PC9zdmc+"},Object(T.a)(t,"2001","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMTAgMTEwIj48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9Imd6ciIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSg2Ni40NTc4IDI0LjM1NzUpIHNjYWxlKDc1LjI5MDgpIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgcj0iMSIgY3g9IjAiIGN5PSIwJSI+PHN0b3Agb2Zmc2V0PSIxNS42MiUiIHN0b3AtY29sb3I9ImhzbCgyMiwgNzMlLCA4NiUpIiAvPjxzdG9wIG9mZnNldD0iMzkuNTglIiBzdG9wLWNvbG9yPSJoc2woMjIsIDgxJSwgNzglKSIgLz48c3RvcCBvZmZzZXQ9IjcyLjkyJSIgc3RvcC1jb2xvcj0iaHNsKDY3LCA5MSUsIDYzJSkiIC8+PHN0b3Agb2Zmc2V0PSI5MC42MyUiIHN0b3AtY29sb3I9ImhzbCg3MSwgOTYlLCA1MSUpIiAvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iaHNsKDcxLCA5NiUsIDUwJSkiIC8+PC9yYWRpYWxHcmFkaWVudD48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNSw1KSI+PHBhdGggZD0iTTEwMCA1MEMxMDAgMjIuMzg1OCA3Ny42MTQyIDAgNTAgMEMyMi4zODU4IDAgMCAyMi4zODU4IDAgNTBDMCA3Ny42MTQyIDIyLjM4NTggMTAwIDUwIDEwMEM3Ny42MTQyIDEwMCAxMDAgNzcuNjE0MiAxMDAgNTBaIiBmaWxsPSJ1cmwoI2d6cikiIC8+PHBhdGggc3Ryb2tlPSJyZ2JhKDAsMCwwLDAuMDc1KSIgZmlsbD0idHJhbnNwYXJlbnQiIHN0cm9rZS13aWR0aD0iMSIgZD0iTTUwLDAuNWMyNy4zLDAsNDkuNSwyMi4yLDQ5LjUsNDkuNVM3Ny4zLDk5LjUsNTAsOTkuNVMwLjUsNzcuMywwLjUsNTBTMjIuNywwLjUsNTAsMC41eiIgLz48L2c+PC9zdmc+"),Object(T.a)(t,"2001","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMTAgMTEwIj48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9Imd6ciIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSg2Ni40NTc4IDI0LjM1NzUpIHNjYWxlKDc1LjI5MDgpIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgcj0iMSIgY3g9IjAiIGN5PSIwJSI+PHN0b3Agb2Zmc2V0PSIxNS42MiUiIHN0b3AtY29sb3I9ImhzbCgyMiwgNzMlLCA4NiUpIiAvPjxzdG9wIG9mZnNldD0iMzkuNTglIiBzdG9wLWNvbG9yPSJoc2woMjIsIDgxJSwgNzglKSIgLz48c3RvcCBvZmZzZXQ9IjcyLjkyJSIgc3RvcC1jb2xvcj0iaHNsKDY3LCA5MSUsIDYzJSkiIC8+PHN0b3Agb2Zmc2V0PSI5MC42MyUiIHN0b3AtY29sb3I9ImhzbCg3MSwgOTYlLCA1MSUpIiAvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iaHNsKDcxLCA5NiUsIDUwJSkiIC8+PC9yYWRpYWxHcmFkaWVudD48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNSw1KSI+PHBhdGggZD0iTTEwMCA1MEMxMDAgMjIuMzg1OCA3Ny42MTQyIDAgNTAgMEMyMi4zODU4IDAgMCAyMi4zODU4IDAgNTBDMCA3Ny42MTQyIDIyLjM4NTggMTAwIDUwIDEwMEM3Ny42MTQyIDEwMCAxMDAgNzcuNjE0MiAxMDAgNTBaIiBmaWxsPSJ1cmwoI2d6cikiIC8+PHBhdGggc3Ryb2tlPSJyZ2JhKDAsMCwwLDAuMDc1KSIgZmlsbD0idHJhbnNwYXJlbnQiIHN0cm9rZS13aWR0aD0iMSIgZD0iTTUwLDAuNWMyNy4zLDAsNDkuNSwyMi4yLDQ5LjUsNDkuNVM3Ny4zLDk5LjUsNTAsOTkuNVMwLjUsNzcuMywwLjUsNTBTMjIuNywwLjUsNTAsMC41eiIgLz48L2c+PC9zdmc+"),t)),f=Object(r.a)(l,2),h=f[0],d=f[1],p=Object(a.useCallback)(function(e,t){n.current=!0;var r=document.referrer;console.log("choosing zorb id=",t),window.parent.postMessage({type:"lootbox-item-selected",body:t},r),u(!0)},[u]);Object(a.useEffect)(function(){window.addEventListener("message",v)},[d]),Object(a.useEffect)(function(){if(e.playing&&!n.current){var t=document.referrer;console.log("sending fallback zorb"),window.parent.postMessage({type:"lootbox-item-selected",body:Object.keys(h)[0]},t),u(!0)}},[e.playing,h,u]);var v=Object(a.useCallback)(function(e){"lootbox"===e.data.type&&(console.log("received lootbox",e.data.body),d(e.data.body))},[d]);if(c)return"";var m=[[],[],[],[z(5),J().start(8).end(19).tension(32).depth(40),J().start(10).end(19).tension(32).depth(-40)]];return i.a.createElement(V,{svgFilter:H,algo:m,radius:23,fill:"#fbf5f508",stroke:"#ffffff0f",className:Object.keys(h).length>4?"bigger loot-box":"loot-box"},i.a.createElement("div",{className:"z-30 loot-inner"},Object.keys(h).map(function(e){return i.a.createElement("div",{onClick:function(t){return p(t,e)},className:"pushable loot-option"},i.a.createElement("img",{src:h[e]}))})))})),G=n(42),W=n.n(G),K=n(56),Q=n(31),Z=n(6),Y=n.n(Z),$=n(44),X=n(256),ee=n(619),te=n(168);var ne=n(287),re=n(9);n(48),n(974),n(622);function ae(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ie(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function oe(e,t){return t===re.g.id?e.mix:e.getSubSequence(t).mix}function se(e){for(var t in e)if(e[t].end>e[t].start)return!1;return!0}var ce=function(e,t){var n,r=ae(e.subSequences);try{for(r.s();!(n=r.n()).done;){var a=n.value.tracks.find(function(e){return e.id===t});if(a)return a}}catch(i){r.e(i)}finally{r.f()}},ue=function(e){var t=e.state,n=t.arrangement.rowSelections;if(se(n)){var r=t.arrangement.selectedEvents,a=t.arrangement.selectedRows;if(void 0!==a&&0!==a.length){var i=a[0];for(var o in r){var s=parseInt(o),u=r[o];if(s!==re.a){var l=he(e,i);void 0!==u.parentEvent?l.dispatch(Object(ne.a)(u.parentEvent,u)):l.dispatch(Object(ne.b)(u,!0))}else de(e,u)}e.dispatch(Object(c.qd)(void 0))}}else!function(e,t){for(var n in t)ce(e,n)||oe(e,n).dispatch(Object(ne.c)(t[n]))}(e,n)},le=function(e,t){var n={};n[t.id]=t,e.dispatch(Object(c.qd)(n)),e.state.arrangement.patternSelected&&e.dispatch(Object(c.C)(t)),e.dispatch(Object(c.z)(t.step))},fe=function(e){var t=e.arrangement.selectedEvents;if(t&&0!==Object.keys(t).length)return t[Object.keys(t)[0]]},he=function(e,t){return t===re.g.id?e.mix:e.getSubSequence(t).mix},de=function(e,t){if(void 0===e.state.keyboard.selectedPianoRollSteps){var n=t.track,r=n.patterns.indexOf(t);n.deletePattern(r),e.switchToPattern(0),n.updateSteps(),e.dispatch(Object(c.E)([]))}},pe=n(258),ve=n(80),me=n(21);function ye(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return be(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ge=new me.a(32,!1),Oe=function(e,t){e.sequencerEngine.dispatch(Object(c.yd)(t))},je=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ge;t=ge.transformStepAtResolution2(t,n);for(var r=e.pattern,a=r.stepBuckets,i=t+1;i<a.length;i++)if(a[i].anyOn())return n.transformStepAtResolution2(i,ge);return n.transformStepAtResolution2(r.stepBuckets.length,ge)};function ke(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return we(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return we(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function we(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var xe=function(e,t,n){var a=0,i=e.getEasyPattern(),o=!t||0==t.length,s=e.sequencerEngine.state;o&&(t=i.getAllSteps(),a=e.pattern.length(n));var u,l=-1,f=ke(i.getStepNumbers(t,n));try{for(f.s();!(u=f.n()).done;){var h=u.value,d=Object(r.a)(h,2),p=d[0],v=d[1];v>l&&(l=v,p)}}catch(g){f.e(g)}finally{f.f()}var m=l+(n.resolution/4-l%(n.resolution/4));o||void 0===s.keyboard.cursor?o||(a=m):a=s.keyboard.cursor-s.keyboard.cursor%(n.resolution/4),(o||a>=e.pattern.length(n))&&e.doubleTrackLength();var y=o?i.getFirstOnStep(n):i.getFirstStepNumber(t,n);a+=o?y:y%(n.resolution/4);e.getEasyPattern().pasteSteps(t,{stepNumber:a},i,n);e.updateSteps();var b=m-(y-y%(n.resolution/4));e.sequencerEngine.dispatch(Object(c.Nc)(a+b))},Se=n(143),Pe=n(62),Ee={2:new me.a(4,!1),3:new me.a(4,!0),4:new me.a(8,!1),5:new me.a(8,!0),6:new me.a(16,!1),7:new me.a(16,!0),8:new me.a(32,!1),9:new me.a(32,!0)},Te=n(50),Ae=n(43),Me=n(45),Re=n(873);function Ce(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}function Ne(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ie(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var _e=function(e){Object(b.a)(n,e);var t=qe(n);function n(e,r){var a;return Object(m.a)(this,n),(a=t.call(this)).sequencerEngine=e,a.disableTab=r,a.installation=r,a.store=e.store,a.onKeyDown=a.onKeyDown.bind(Object(Q.a)(a)),a.onKeyUp=a.onKeyUp.bind(Object(Q.a)(a)),a.keysDown={},a.effectToCopy=void 0,a.sequencerEngine.keyListener=Object(Q.a)(a),a.checkMetaKey(),a.lastViewMode=void 0,a.halftime=void 0,a.bindings={},a}return Object(y.a)(n,[{key:"addBinding",value:function(e){this.bindings[e]=!0}},{key:"removeBinding",value:function(e){delete this.bindings[e]}},{key:"checkMetaKey",value:function(){var e=this;setInterval(function(){void 0!==e.lastMetaPressedTime&&((new Date).getTime()-e.lastMetaPressedTime>=5e3&&e.dispatch(Object(c.W)(!1)))},1e3)}},{key:"onKeyUp",value:function(e){var t=this;this.keysDown[e.key&&e.key.toLowerCase()]=!1,Object(ee.a)(e)||("Meta"===e.key||"Control"===e.key?(this.lastMetaPressedTime=void 0,this.dispatch(Object(c.W)(!1))):"/"===e.key?this.dispatch(Object(c.Yd)(!this.state.spatial.showSearchWindow)):"~"===e.key||"`"===e.key?(void 0!==this.halftime&&(this.sequencerEngine.subSequences.forEach(function(e,n){return e.playhead.speedFactorParameter.set(t.halftime[n],!1)}),this.halftime=void 0),"`"===e.key&&(this.sequencerEngine.sequenceRolling=!1)):Object(Ae.a)(e.key)||this.sequencerEngine.keyboardHelper.onKeyUp(e))}},{key:"onKeyDown",value:function(e){var t=this;if((!this.keysDown[e.key&&e.key.toLowerCase()]||e.ctrlKey||e.metaKey)&&(!Object(ee.a)(e)||"d"===e.key&&e.metaKey)&&(this.keysDown[e.key&&e.key.toLowerCase()]=!0,!this.state.sequencer.loadingText&&(!this.bindings[e.key]||e.ctrlKey||e.metaKey||this.sequencerEngine.isAnyTrackEnabled()))){if(32==e.keyCode&&e.target==window.document.body){if(e.preventDefault(),(this.viewMode===E.a||this.state.arrangement.looping)&&(this.sequencerEngine.playing||this.dispatch(Object(c.Pb)(!0))),window.synthz)return;return this.sequencerEngine.schedulePlay(),!1}var n=e.target===window.document.body;if(this.viMode&&!e.metaKey&&!e.ctrlKey&&!e.ctrlKey){if("Escape"===e.key)return void this.dispatch(Object(c.Ve)(!1));if(this.scripting.viCommand(e.key),Object(Ae.a)(e.key))return}if("Space"!==e.key){if(!this.viMode&&e.key>="a"&&e.key<="z"&&!e.metaKey&&!e.ctrlKey&&!e.ctrlKey)return this.sequencerEngine.keyboardHelper.onAlphabetKeyDown(e,this.cursor.track),!0;if(this.installation||"x"===e.key&&(e.metaKey||e.ctrlKey)&&this.state.commands.commandInput&&(this.state.commands.commandInput.focus(),this.dispatch(Object(c.X)("M-x"))),"m"===e.key&&(e.ctrlKey||e.metaKey))return e.preventDefault(),this.sequencerEngine.metronomeOn=!this.sequencerEngine.metronomeOn,!1;if("~"===e.key&&(this.halftime=this.sequencerEngine.subSequences.map(function(e){return e.playhead.speedFactorParameter.get()}),this.sequencerEngine.subSequences.forEach(function(e,n){return e.playhead.speedFactorParameter.set(t.halftime[n]/2,!1)})),"n"===e.key&&(e.ctrlKey||e.ctrlKey))return e.preventDefault(),this.selectedTrack.auditionNext(!0,!0),!1;if("R"===e.key){var r,a=Ne(this.sequencerEngine.subSequences);try{for(a.s();!(r=a.n()).done;){r.value.tracks.forEach(function(e){return e.setIsEnabled(!1)})}}catch(d){a.e(d)}finally{a.f()}}if("p"===e.key&&(e.ctrlKey||e.ctrlKey))return e.preventDefault(),this.selectedTrack.auditionPrevious(!0,!0),!1;if("i"===e.key&&(e.ctrlKey||e.metaKey)){e.preventDefault();var i=this.selectedTrack;!i||this.selectedEffect&&this.selectedEffect.name.includes("Effect Rack")||this.dispatch(Object(c.Ge)(i))}if("Escape"===e.key&&this.dispatch(Object(c.Gb)(void 0)),"g"===e.key&&e.metaKey)return e.preventDefault(),this.planarSelected||this.groupSteps(),!0;if("\\"===e.key&&e.metaKey&&this.dispatch(Object(c.fe)(!this.state.spatial.sidebarsShowing)),"z"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),e.shiftKey?this.sequencerEngine.operationManager.redo():this.sequencerEngine.operationManager.undo(),!0;if("k"===e.key&&(e.metaKey||e.ctrlKey))return this.midiMapMode===Me.b?this.dispatch(Object(c.kc)(Me.c)):this.dispatch(Object(c.kc)(Me.b)),!0;if("y"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),function(e){var t=e.state.pads.selectedEdge;if(t){var n=t.id,r=e.currentSubSequence.getMessagingEdgeById(n);if(r){r.segmentation?r.segmentation=!1:r.segment();var a=r.sourceId,i=r.destId;r.sourceNode.zObject&&(a=r.sourceNode.zObject.id),r.destNode.zObject&&(i=r.destNode.zObject.id);var o=e.state.windows.windowPositions[a],s=e.state.windows.windowPositions[i].y-o.y,u=o.y+.5*s;e.dispatch(Object(c.P)(n,u)),e.dispatch(Object(c.P)(n,u))}}}(this.sequencerEngine),!0;if("j"===e.key&&(e.metaKey||e.ctrlKey))return this.midiMapMode===Me.a?this.dispatch(Object(c.kc)(Me.c)):this.dispatch(Object(c.kc)(Me.a)),!0;if("d"===e.key&&(e.ctrlKey||e.metaKey)){if(void 0!==this.selectedEffect&&("Effect Rack"===this.selectedEffect.name||"Midi Effect Rack"===this.selectedEffect.name))return;return e.preventDefault(),e.stopPropagation(),this.selectedZObject&&this.selectedZObject.getObjectType()===te.c?this.sequencerEngine.duplicateTrack(this.sequencerEngine.cursor.track):this.selectedZObject&&this.selectedZObject.getObjectType()===te.e&&this.selectedZObject.duplicate(),!1}if("a"===e.key&&(e.metaKey||e.ctrlKey)){if(e.preventDefault(),this.planarSelected)return;return this.state.automation.show&&this.state.sequencer.showPianoRoll&&this.state.arrangement.bottomMode===Pe.b?this.selectAllTrackAutomationPoints():this.viewMode===E.a?this.state.arrangement.patternSelected?this.selectAllTrackSteps():this.selectAllTrackAutomationPoints():this.selectAllTrackSteps(),this.dispatch(Object(c.td)(void 0)),!1}if("E"===e.key)return e.preventDefault(),this.dispatch(Object(c.Re)(!this.state.zobject.uxLocked)),!1;if("P"===e.key)return e.preventDefault(),this.state.spatial.showPadSequencer||this.dispatch(Object(c.Yc)(!this.state.spatial.presentationMode)),!1;if("w"===e.key&&(e.ctrlKey||e.ctrlKey))return e.preventDefault(),this.viewMode===E.c&&(this.dispatch(Object(c.Wd)(!this.showPianoRoll)),this.dispatch(Object(c.y)(Pe.c))),!1;if("s"===e.key&&(e.ctrlKey||e.metaKey)){var o=this.selectedTrack.getSamplers()[0];o&&o.autoSlice(4)}else{if("p"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),this.dispatch(Object(c.Ed)(void 0)),this.dispatch(Object(c.Wd)(!this.showPianoRoll)),this.dispatch(Object(c.y)(Pe.b)),!1;if("s"===e.key&&(e.metaKey||e.ctrlKey)){if(e.preventDefault(),this.viewMode===E.c){var s=this.selectedTrack,u=this.state.cirklon.cirklonMode[s.id];this.dispatch(Object(c.R)(s.id,"SLOPE"===u?void 0:"SLOPE"))}return!1}if("g"===e.key&&(e.metaKey||e.ctrlKey)){if(e.preventDefault(),this.viewMode===E.c){var l=this.selectedTrack,f=this.state.cirklon.cirklonMode[l.id];this.dispatch(Object(c.R)(l.id,"GANG"===f?void 0:"GANG"))}return!1}}if(!Object(Ae.a)(e.key)||this.viewMode===E.c&&this.selectedEffect&&"Plane Parameters"===this.selectedEffect.name)if("="===e.key)this.sequencerEngine.switchToNextPattern();else if("+"===e.key);else if("-"===e.key)this.sequencerEngine.switchToPreviousPattern();else if("]"===e.key)this.dispatch(Object(c.Zd)(!0));else if("c"===e.key&&(e.metaKey||e.ctrlKey))this.copy();else if("v"===e.key&&(e.metaKey||e.ctrlKey))this.paste();else if("b"===e.key&&(e.metaKey||e.ctrlKey))this.duplicateSteps();else{if("l"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),this.legato(),!1;if("r"===e.key&&e.ctrlKey)return e.preventDefault(),this.rollSteps(),!1;if("t"===e.key&&e.ctrlKey)return e.preventDefault(),this.toggleTriplets(),!1;if("Backspace"!=e.key||this.hasHigherOrderSteps())if("`"==e.key)this.sequencerEngine.isSequenceRolling||(this.sequencerEngine.sequenceRolling=!0);else{if("\\"==e.key||"h"==e.key&&e.ctrlKey)return e.preventDefault(),this.hide(),!1;if("o"===e.key&&e.metaKey)console.log("o and metakey"),e.preventDefault(),this.connectLastZObjects();else if("."==e.key)this.record();else if("Meta"===e.key||"Control"===e.key)this.onMetaKeyDown();else if("Tab"!==e.key||this.disableTab)if("'"===e.key)this.onClickRollingMode();else if("Shift"===e.key&&n)this.onShiftKeyDown();else if("ArrowRight"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;this.keyboardContext&&"ztracker"===this.keyboardContext.name?this.onArrowDown(e,!0):this.onArrowRight(e,!0)}else if("ArrowLeft"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;this.keyboardContext&&"ztracker"===this.keyboardContext.name?this.onArrowUp(e,!0):this.onArrowLeft(e,!0)}else{if("ArrowUp"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;return this.keyboardContext&&"ztracker"===this.keyboardContext.name?this.onArrowLeft(e,!0):this.onArrowUp(e)}if("ArrowDown"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;this.keyboardContext&&"ztracker"===this.keyboardContext.name?this.onArrowRight(e,!0):this.onArrowDown(e)}else if("Enter"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;this.onEnterKeyDown()}}else{if(e.preventDefault(),this.isShowingSoundsPane())return void this.hideSidebar();if(this.state.instruments.showingFormants)return;if(this.waveformShowing)return}}else{if(this.sequencerEngine.noDeleteKey)return;if(void 0!==this.selectedFreeze)return void this.deleteSelectedFreeze();if(this.pointsSelected.length>0&&(this.showPianoRoll&&this.state.automation.show||this.viewMode===E.a))this.deleteSelectedPoints();else if(this.viewMode===E.a){var h=this.getSelectedSteps();h&&h.length>0?this.deleteSelectedSteps():ue(this.sequencerEngine)}else this.deleteSelectedSteps()}}else if(n)return void this.onNumberKeyDown(e)}}}},{key:"waveformShowing",get:function(){return this.state.sequencer.waveformShowing}},{key:"onNumberKeyDown",value:function(e){var t=parseInt(e.key);if(this.viewMode!==E.a||this.isPlayingMix)if(this.sequencerEngine.rolling&&!e.metaKey){if(t>=2&&t<=9){var n=Ee[t];null!==n&&(this.sequencerEngine.resolution=n)}}else if(e.ctrlKey){e.preventDefault();var r=t-1;this.sequencerEngine.tracks[r]&&(this.sequencerEngine.selectTrack(r),this.sequencerEngine.tracks[r].toggleEnabled())}else{var a=t;this.sequencerEngine.switchToPattern(a-1)}}},{key:"onMetaKeyDown",value:function(){this.dispatch(Object(c.W)(!0)),this.lastMetaPressedTime=(new Date).getTime()}},{key:"hide",value:function(){var e=this;if(this.state.tracks.tracksToHide.length>0)this.dispatch(Object(c.Me)([]));else{if(!this.sequencerEngine.tracks.some(function(e){return e.isEffectsShowing()})){var t=this.sequencerEngine.tracks.filter(function(t){return t!==e.selectedTrack}),n=[].concat(Object(o.a)(this.state.tracks.tracksToHide.filter(function(t){return t!==e.selectedTrack})),Object(o.a)(t));this.dispatch(Object(c.Me)(Array.from(new Set(n))))}this.hideSidebar(),this.dispatch(Object(c.i)(!1)),this.dispatch(Object(c.Wd)(!1))}}},{key:"hideSidebar",value:function(){this.dispatch(Object(c.Fd)(!1)),this.dispatch(Object(c.Sd)(!1)),this.dispatch(Object(c.Xd)(!1)),this.dispatch(Object(c.ae)(!1)),this.dispatch(Object(c.ee)(Te.a))}},{key:"selectAllTrackAutomationPoints",value:function(){var e=this.sequencerEngine.tracks[this.cursor.track];if(void 0!==e){var t=this.state.automation.trackParameter[e.id];if(void 0!==t)if((this.state.automation.pointsSelected[e.id]||[]).length>0){var n,r=Ne(this.sequencerEngine.tracks);try{for(r.s();!(n=r.n()).done;){var a=n.value;this.dispatch(Object(c.H)(a.id,[]))}}catch(i){r.e(i)}finally{r.f()}}else this.viewMode===E.a?this.dispatch(Object(c.H)(e.id,Object(o.a)(t.mixAutomation.automations))):this.dispatch(Object(c.H)(e.id,Object(o.a)(t.automations)))}}},{key:"selectAllTrackSteps",value:function(){var e=this.sequencerEngine.tracks[this.cursor.track];if(!(void 0===e||this.viewMode===E.c&&e.isEffectsShowing())||this.state.sequencer.showPianoRoll&&this.state.arrangement.bottomMode===Pe.b){this.dispatch(Object(c.ld)(!1));e.currentPattern;if(void 0===this.getSelectedSteps()){var t=e.getEasyPattern().getAllSteps();this.dispatch(Object(c.yd)(t))}else this.dispatch(Object(c.yd)(void 0))}}},{key:"copy",value:function(){this.copiedNodesForRack.length>0||(this.selectedEffect?(this.effectToCopy=this.selectedEffect,this.dispatch(Object(c.je)(void 0))):this.copySteps())}},{key:"paste",value:function(){if(!(this.copiedNodesForRack.length>0))if(void 0===this.state.keyboard.stepsToCopy&&void 0!==this.effectToCopy&&void 0!==this.selectedTrack&&this.selectedTrack.isEffectsShowing()){var e=this.effectToCopy.isMidiEffect()?this.effectToCopy.getCopy(this.selectedTrack):this.effectToCopy.getEffectCopy(this.sequencerEngine);this.effectToCopy.isMidiEffect()?this.selectedTrack.midiEffects.addEffect(e):this.selectedTrack.effectsChain.addEffect(e),this.sequencerEngine.update()}else this.pasteSteps()}},{key:"copySteps",value:function(){var e=this.getSelectedSteps();if(void 0!==e){this.dispatch(Object(c.je)(e));var t=this.selectedTrack;this.dispatch(Object(c.sb)(t.getEasyPattern()))}}},{key:"pasteSteps",value:function(){if(void 0!==this.state.keyboard.stepsToCopy){var e=this.cursor.getStep(this.resolution),t=this.sequencerEngine.tracks[this.cursor.track];if(t){var n=t.getEasyPattern().pasteSteps(this.state.keyboard.stepsToCopy,{stepNumber:e},this.state.keyboard.easyPatternToCopy,this.state.sequencer.displayResolution);t.updateSteps(),this.dispatch(Object(c.yd)(n)),this.dispatch(Object(c.ge)(e))}}}},{key:"record",value:function(){var e=!this.isRecording;this.dispatch(Object(c.Rb)(e)),this.sequencerEngine.recording(e)}},{key:"getSelectedSteps",value:function(){var e=this.sequencerEngine.store.getState().keyboard.selectedPianoRollSteps;if(!e||0!==e.length)return e}},{key:"deleteSelectedPoints",value:function(){var e=this.state.automation.trackParameter[this.selectedTrack.id];void 0!==e&&this.selectedTrack&&(this.sequencerEngine.operationManager.dispatch(Object($.o)(this.viewMode===E.a?e.mixAutomation:e.automation,this.pointsSelected)),this.dispatch(Object(c.H)(this.selectedTrack.id,[])))}},{key:"deleteSelectedSteps",value:function(){this.sequencerEngine.store.getState();var e=this.getSelectedSteps();void 0!==e&&(this.sequencerEngine.operationManager.dispatch(Object($.j)(this.selectedTrack,e)),this.store.dispatch(Object(c.yd)(void 0)))}},{key:"onShiftKeyDown",value:function(){}},{key:"currentScene",get:function(){return this.state.sequencer.currentScene}},{key:"scenes",get:function(){return this.state.sequencer.scenes}},{key:"showingSoundList",get:function(){return this.state.selector.showingSoundList||this.state.packs.packSelected}},{key:"currentSoundInList",get:function(){return this.state.selector.currentSoundInList},set:function(e){this.dispatch(Object(c.ib)(e))}},{key:"currentTagInList",get:function(){return this.state.selector.currentTagInList},set:function(e){this.dispatch(Object(c.kb)(e))}},{key:"onClickRollingMode",value:function(){this.sequencerEngine.resolution=this.state.sequencer.displayResolution,this.dispatch(Object(c.De)(!this.trackRolling)),this.dispatch(Object(c.Ve)(!1)),this.sequencerEngine.rollingManager.clear()}},{key:"onEnterKeyDown",value:function(){this.showingSoundList&&void 0!==this.currentSoundInList||this.cursor.track>=0&&this.cursor.track<this.sequencerEngine.tracks.length&&this.sequencerEngine.getSelectedStep()>=0&&this.onClickStep(this.cursor.track,this.sequencerEngine.getSelectedStep())}},{key:"onClickStep",value:function(e,t){void 0===this.getSelectedSteps()&&(this.sequencerEngine.tracks[e].pattern.clearCache(),this.sequencerEngine.operationManager.dispatch(Object($.r)(this.sequencerEngine.tracks[e],t,this.resolution)),this.sequencerEngine.select(e,t),this.cursor.track=e)}},{key:"dispatch",value:function(e){this.store.dispatch(e)}},{key:"state",get:function(){return this.store.getState()}},{key:"selectedEffect",get:function(){if(this.state.zobject.selectedZObject&&this.state.zobject.selectedZObject.getObjectType()===te.a&&void 0!==this.state.effects.selectedEffect&&(!this.state.sequencer.showPianoRoll||this.state.arrangement.bottomMode!==Pe.b))return this.sequencerEngine.selectedEffect}},{key:"planarSelected",get:function(){return this.state.zobject.selectedZObject&&"Plane Parameters"===this.state.zobject.selectedZObject.name}},{key:"midiMapMode",get:function(){return this.state.midi.midiMapMode}},{key:"viewMode",get:function(){return this.state.sequencer.viewMode}},{key:"alternateViewMode",get:function(){return this.state.sequencer.alternateViewMode}},{key:"showGroups",get:function(){return this.state.sequencer.showGroups}},{key:"pointsSelected",get:function(){var e=this.selectedTrack;return e&&this.state.automation.pointsSelected[e.id]||[]}},{key:"isCompactMode",get:function(){return this.state.sequencer.isCompactMode}},{key:"cursor",get:function(){return this.sequencerEngine.cursor}},{key:"cursorStepData",get:function(){if(this.selectedTrack)return this.selectedTrack.pattern.stepBuckets[this.cursor.step].steps[0]}},{key:"resolution",get:function(){return this.state.sequencer.displayResolution}},{key:"sampleAuditioning",get:function(){return this.state.audition.sampleAuditioning}},{key:"trackRolling",get:function(){return this.state.sequencer.trackRolling}},{key:"isRecording",get:function(){return this.state.sequencer.isRecording}},{key:"selectedTrack",get:function(){return this.sequencerEngine.tracks[this.cursor.track]}},{key:"scripting",get:function(){return this.sequencerEngine.scripting}},{key:"viMode",get:function(){return this.viewMode===E.c&&this.state.commands.viMode}},{key:"trackFocused",get:function(){return this.state.sequencer.trackFocused}},{key:"isPlayingMix",get:function(){return this.state.mix.isPlayingMix}},{key:"onSelectTrack",value:function(e){this.sequencerEngine.cursor.track=e}},{key:"isShowingSoundsPane",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return!!this.state.spatial.showSearchWindow||!this.state.selector.sidebarCollapsed&&(this.state.sequencer.showSelectorMode||this.state.sequencer.sidebarViewMode!==Te.a)}},{key:"isShowingPianoRoll",get:function(){return this.showPianoRoll&&this.state.arrangement.bottomMode===Pe.b}},{key:"showPianoRoll",get:function(){return this.state.sequencer.showPianoRoll}},{key:"showSamples2D",get:function(){return this.state.selector.showSamples2D}},{key:"selectedFreeze",get:function(){return this.state.freeze.selectedFreeze}},{key:"deleteSelectedFreeze",value:function(){var e,t=this.selectedTrack,n=this.selectedFreeze,r=Ne(t.frozenColumns);try{for(r.s();!(e=r.n()).done;){var a=e.value,i=-1;for(var o in a.frozenSamples)a.frozenSamples[o].ipfsHash===n&&(i=parseInt(o));if(!(i<0)){a.frozenSettings.splice(i,1),a.frozenSamples.splice(i,1),a.frozenSamplers[i].gainNode.disconnect(),a.frozenSamplers.splice(i,1),a.updateRedux();break}}}catch(s){r.e(s)}finally{r.f()}t.frozenColumns.every(function(e){return 0===e.frozenSamplers.length})&&t.isFrozen&&t.unfreeze(),this.dispatch(Object(c.td)(void 0))}},{key:"copiedNodesForRack",get:function(){return this.state.effects.copiedNodesForRack}},{key:"trackerParameterToEdit",get:function(){return this.state.mix.trackerParameterToEdit}},{key:"newSlice",value:function(){var e=this.selectedTrack;if(e.getTrackType()===Se.f){var t=e.getSamplers()[0];t.newSlice(),this.dispatch(Object(c.Dd)(e.id,t.slices.length-1))}}},{key:"moveSteps",value:function(e,t,n){var r={stepDifference:t,transposeDifference:n},a=e[0].track;this.sequencerEngine.operationManager.dispatch(Object($.l)(a,e,r,0===t?void 0:this.resolution,!1,!1))}},{key:"duplicateSteps",value:function(){var e=this.selectedTrack,t=this.getSelectedSteps(),n=this.resolution;xe(e,t,n)}},{key:"duplicateAllSteps",value:function(){var e=this;this.sequencerEngine.tracks.forEach(function(t){xe(t,void 0,e.resolution)})}},{key:"legato",value:function(){var e=this.selectedTrack;if(e){var t=this.getTrackSelectedSteps();t&&0!==t.length||(t=e.getEasyPattern().getAllSteps()),function(e,t){for(var n=e.getEasyPattern().getStepNumbers(t,ge),a=e.sequencerEngine.operationManager,i=0;i<n.length;i++){var o=Object(r.a)(n[i],2),s=o[0],c=o[1],u=je(e,c);if(void 0!==u){var l=(u-c)/2;a.dispatch(Object($.t)(e,s,s.durationParameter,l))}}}(e,t)}}},{key:"getTrackSelectedSteps",value:function(){if(this.selectedTrack){var e=this.getSelectedSteps();return e&&0!==e.length||(e=[this.cursorStepData]),e}}},{key:"rollSteps",value:function(){var e=this.getTrackSelectedSteps();e&&function(e,t){for(var n=e.getEasyPattern(),a=n.getStepNumbers(t,ge),i=e.sequencerEngine.state.sequencer.displayResolution.getNumberOfStepsAtBaseResolution(),s=(e.sequencerEngine.operationManager,[]),c=0;c<a.length;c++){var u=Object(r.a)(a[c],2),l=u[0],f=u[1],h=je(e,f);if(void 0!==h)for(var d=f+i;d<h;d+=i)s=[].concat(Object(o.a)(s),Object(o.a)(n.pasteSteps([l],{stepNumber:d},n,ge)))}Oe(e,[].concat(Object(o.a)(t),Object(o.a)(s))),e.updateSteps()}(this.selectedTrack,e)}},{key:"tripletSteps",value:function(){var e=this.selectedTrack,t=this.getSelectedSteps();e&&t&&0!==t.length&&function(e,t){var n=e.getEasyPattern(),a=e.sequencerEngine.state.sequencer.displayResolution,i=a.getCopy(),o=n.getStepNumbers(t,a);i.isTriplet=!i.isTriplet,e.sequencerEngine.dispatch(Object(c.gd)(i));var s=e.sequencerEngine.operationManager;s.dispatch(Object($.j)(e,t));var u,l=ye(o);try{for(l.s();!(u=l.n()).done;){var f=u.value,h=Object(r.a)(f,2),d=h[0],p=h[1],v=i.isTriplet?1.5:2/3;s.dispatch(Object($.c)(e,d,Math.round(p*v),i))}}catch(m){l.e(m)}finally{l.f()}e.sequencerEngine.dispatch(Object(c.gd)(a)),e.updateSteps(!0,void 0,i.isTriplet)}(e,t)}},{key:"focusSearch",value:function(){var e=Object(K.a)(W.a.mark(function e(){var t;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.viewMode!==E.a&&this.viewMode!==E.b){e.next=4;break}return this.dispatch(Object(c.Nd)(!0)),e.next=4,Object(ve.a)(200);case 4:if((t=this.state.selector.searchInput)&&t.current&&t.current.focus){e.next=7;break}return e.abrupt("return");case 7:t.current.focus();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isEffectsShowing",value:function(){return!this.isShowingPianoRoll&&(this.selectedTrack&&this.selectedTrack.isEffectsShowing())}},{key:"toggleTriplets",value:function(){var e=this.state.sequencer.displayResolution,t=new me.a(e.resolution,!e.isTriplet);this.dispatch(Object(c.ob)(t)),this.sequencerEngine.updateSteps()}},{key:"groupSteps",value:function(){var e=this.selectedTrack;if(e){var t=this.getSelectedSteps();if(this.stepsGroupMode&&t&&t.every(function(e){return!e.group}));else if(this.stepsGroupMode||!t||0===t.length||t.every(function(e){return e.group}))return this.toggleStepsGroupMode(),void this.dispatch(Object(c.yd)(void 0));Object(pe.e)(t,e)}}},{key:"stepsGroupMode",get:function(){return this.state.groups.stepsGroupMode}},{key:"toggleStepsGroupMode",value:function(){this.dispatch(Object(c.ie)(!this.stepsGroupMode)),this.sequencerEngine.updateSteps()}},{key:"sampleExplorerSelected",get:function(){return this.state.selector.sampleExplorerSelected}},{key:"hasHigherOrderSteps",value:function(){var e=this.state.higherOrder.selectedSteps;return e&&e.length>0}},{key:"selectedZObject",get:function(){return this.state.zobject.selectedZObject}},{key:"keyboardContext",get:function(){return this.state.keyboard.keyboardContext}},{key:"connectLastZObjects",value:function(){var e=this.state.zobject.selectedZObjectHistory,t=e.slice(e.length-2),n=Object(r.a)(t,2),a=n[0],i=n[1];a&&i&&Object(X.a)(Object($.d)(a,"Output 1",i,"Input"))}}]),n}(function(e){Object(b.a)(n,e);var t=Ce(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"onArrowDown",value:function(e){if(e.preventDefault(),this.sampleExplorerSelected)this.state.zobject.selectedZObject?this.selectedTrack.auditionNext():this.sequencerEngine.auditionTrack.auditionNext();else if(this.isShowingSoundsPane(!1)){var t=e.ctrlKey||e.metaKey?10:1;this.showingSoundList?void 0===this.currentSoundInList?this.currentSoundInList=0:this.currentSoundInList+=t:void 0===this.currentTagInList?this.currentTagInList=0:this.currentTagInList+=t}else if(this.viewMode===E.b&&this.currentScene){var n=this.scenes.indexOf(this.currentScene),r=this.scenes[(n+1)%this.scenes.length];this.sequencerEngine.scenes.switchToScene(r)}else if(!this.showSamples2D||!this.isShowingSoundsPane()){if(this.sampleAuditioning)window.dispatchEvent(new Event(Re.a));else{var a=this.getSelectedSteps();a&&a.length>0?this.moveSteps(a,0,e.ctrlKey||e.metaKey?-12:-1):(this.sequencerEngine.tracks.length,this.sequencerEngine.down(),this.onSelectTrack(this.cursor.track))}return!0}}},{key:"onArrowRight",value:function(e,t){if(this.isShowingSoundsPane(!1)){var n=e.ctrlKey||e.metaKey?10:1;this.showingSoundList||(void 0===this.currentTagInList?this.currentTagInList=0:this.currentTagInList+=n)}else if(!this.waveformShowing&&(e.preventDefault(),!this.showSamples2D||!this.isShowingSoundsPane())){if(this.viewMode===E.a)return function(e){var t=fe(e.state);if(t){var n=t.subSequence.mix;if(n){var r=n.getNextEvent(t);return r?le(e,r):void 0}}}(this.sequencerEngine);if(this.cursor.track in this.sequencerEngine.tracks){var r=this.getSelectedSteps();r&&r.length>0?this.moveSteps(r,e.ctrlKey||e.metaKey?4:1,0):this.sequencerEngine.right(void 0,t)}}}},{key:"onArrowLeft",value:function(e,t){if(this.isShowingSoundsPane(!1)){var n=e.ctrlKey||e.metaKey?10:1;this.showingSoundList||(void 0===this.currentTagInList?this.currentTagInList=0:this.currentTagInList=Math.max(0,this.currentTagInList-n))}else if(!this.waveformShowing&&(e.preventDefault(),!this.showSamples2D||!this.isShowingSoundsPane())){if(this.viewMode===E.a)return function(e){var t=fe(e.state);if(t){var n=t.subSequence.mix;if(n){var r=n.getPreviousEvent(t);return r?le(e,r):void 0}}}(this.sequencerEngine);var r=this.getSelectedSteps();r&&r.length>0?this.moveSteps(r,e.ctrlKey||e.metaKey?-4:-1,0):this.sequencerEngine.left(void 0,t)}}},{key:"onArrowUp",value:function(e){if(e.preventDefault(),this.sampleExplorerSelected)this.state.zobject.selectedZObject?this.selectedTrack.auditionPrevious():this.sequencerEngine.auditionTrack.auditionPrevious();else if(this.isShowingSoundsPane(!1)){var t=e.ctrlKey||e.metaKey?10:1;this.showingSoundList?void 0===this.currentSoundInList?this.currentSoundInList=0:this.currentSoundInList=Math.max(0,this.currentSoundInList-t):void 0===this.currentTagInList?this.currentTagInList=0:this.currentTagInList=Math.max(0,this.currentTagInList-t)}else if(this.viewMode===E.b&&this.currentScene){var n=this.scenes.indexOf(this.currentScene)-1,r=this.scenes[n<0?this.scenes.length-1:n];this.sequencerEngine.scenes.switchToScene(r)}else if(!this.showSamples2D||!this.isShowingSoundsPane()){if(this.sampleAuditioning)window.dispatchEvent(new Event(Re.b));else{var a=this.getSelectedSteps();a&&a.length>0?this.moveSteps(a,0,e.ctrlKey||e.metaKey?12:1):(this.sequencerEngine.up(),this.onSelectTrack(this.cursor.track))}return!0}}}]),n}(function(){return function e(){Object(m.a)(this,e)}}())),De=n(312),Fe=n.n(De),Le=function(){var e=Object(a.useState)([]),t=Object(r.a)(e,2);return{ordering:t[0],setOrdering:t[1],sizeRef:Object(a.useRef)({width:250,height:150})}},Be=function(e){e.sequencerEngine.dispatch(Object(c.Ce)(e))},ze=function(e){var t=e.clear,n=e.selected;Object(a.useEffect)(function(){return window.addEventListener("mousedown",r),function(){return window.removeEventListener("mousedown",r)}},[t]);var r=Object(a.useCallback)(function(){n&&t()},[t,n])},Je=function(e){var t=e.ref,n=e.useTop,i=void 0===n||n,o=e.useLeft,s=void 0===o||o,c=Object(a.useState)(void 0),u=Object(r.a)(c,2),l=u[0],f=u[1];return ze({clear:function(){return f(void 0)},selected:l}),{onContextMenu:Object(a.useCallback)(function(e){if(e.preventDefault(),e.stopPropagation(),t){var n=t.current.getBoundingClientRect(),r={x:s?e.clientX-n.left+t.current.scrollLeft:e.clientX,y:i?e.clientY-n.top+t.current.scrollTop:e.clientY};f(r)}else{var a={x:e.clientX,y:e.clientY};f(a)}},[f,i,s,t]),dropdownPos:l,setDropdownPos:f}},Ve=(n(412),n(363)),He=n(874),Ue=(n(1681),0),Ge=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.children,n=e.dropdownPos,r=e.setDropdownPos,o=e.className,s=Object(a.useRef)(void 0),c=Object(a.useRef)(!1),u=Object(a.useRef)(0);Object(a.useRef)(++Ue);Object(a.useEffect)(function(){return s.current&&s.current.addEventListener("mousewheel",l),function(){s.current&&s.current.removeEventListener("mousewheel",l)}},[n]);var l=Object(a.useCallback)(function(e){e.stopPropagation()},[]);Object(a.useEffect)(function(){return window.addEventListener("mouseup",f),function(){window.removeEventListener("mouseup",f)}},[r,n]);var f=Object(a.useCallback)(function(){u.current++,1===u.current&&c.current?c.current=!1:r&&(c.current=!1,r(void 0))},[r,n]);return Object(a.useEffect)(function(){n?(u.current=0,c.current=!0):(u.current=0,c.current=!1)},[n]),n?i.a.createElement("div",{onMouseDown:function(e){},ref:s,style:{left:n.x-10,top:n.y-10},onMouseUp:function(e){},onClick:function(){},className:"context-menu "+o},t):(u.current=0,[])}),We=function(e){return i.a.createElement("div",Object.assign({className:"menu-item"},e),e.children)},Ke=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.name,n=e.children;return i.a.createElement("div",{className:"sub-menu menu-item"},i.a.createElement("div",{className:"sub-menu-name"},t),i.a.createElement("div",{className:"arrow-right"}),i.a.createElement("div",{className:"sub-menu-children"},n))}),Qe=n(437),Ze=function(e){Object(a.useEffect)(function(){return e.current&&e.current.addEventListener("mousewheel",t),function(){e.current&&e.current.removeEventListener("mousewheel",t)}},[]);var t=function(e){return e.stopPropagation()}},Ye=function(e){return e=e.toLowerCase(),function(){var e=new Set;for(var t in f.b)e.add(t);for(var n in f.f)e.add(n);return Array.from(e)}().filter(function(t){return t.toLowerCase().startsWith(e)})},$e=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){e.sequencerEngine;var t=e.zobject,n=e.setText,o=e.text,s=e.setEditing,c=Object(a.useRef)();Ze(c);var u=Object(a.useState)([]),l=Object(r.a)(u,2),f=l[0],h=l[1],d=Object(a.useState)([]),p=Object(r.a)(d,2),v=p[0],m=p[1];Object(a.useEffect)(function(){Object(Qe.b)(void 0,"zobject.subpatch",[],0,void 0,!1).then(function(e){m(e)})},[m]),Object(a.useEffect)(function(){if(o){var e=v.filter(function(e){return e.title.toLowerCase().includes(o.toLowerCase())});h(e)}else h([])},[v,o,h]);var y=Object(a.useCallback)(function(e){t.text="subpatch",t.loadPreset(e),n("subpatch"),s(!1)},[t,o,n,s]),b=f;return b.sort(function(e,t){return e.blockNumber-t.blockNumber}),i.a.createElement("div",{ref:c,onClick:function(e){return e.stopPropagation()},className:0===b.length?"autocomplete-messages empty":"autocomplete-messages"},b.map(function(e){return i.a.createElement("div",{onClick:function(){return y(e)},className:"pub-option"},e.title)}))}),Xe=0,et=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2?arguments[2]:void 0,r=Object(a.useRef)(0);Object(a.useRef)(Xe++);return Object(a.useCallback)(function(a){var i=(new Date).getTime(),o=i-r.current;r.current=i,o<=t?e(a):n&&n(a)},[e,n])},tt=n(291);function nt(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return rt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rt(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function rt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var at=function(e,t){var n,r=e.offsetLeft,a=e.offsetTop,i=document.createElement("div"),o=getComputedStyle(e),s=nt(o);try{for(s.s();!(n=s.n()).done;){var c=n.value;i.style[c]=o[c]}}catch(p){s.e(p)}finally{s.f()}var u="INPUT"===e.tagName?e.value.replace(/ /g,"."):e.value,l=u.substr(0,t);i.textContent=l,"TEXTAREA"===e.tagName&&(i.style.height="auto"),"INPUT"===e.tagName&&(i.style.width="auto");var f=document.createElement("span");f.textContent=u.substr(t)||".",i.appendChild(f),document.body.appendChild(i);var h=f.offsetLeft,d=f.offsetTop;return document.body.removeChild(i),{x:r+h,y:a+d}},it=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.library,n=(e.setLibrary,e.input),o=e.possibilities,s=e.setPossibilities,c=e.scrollTop,u=e.choosePossibility,l=e.selectedChoice,f=e.doc,h=(e.effect,Object(a.useRef)());Object(a.useEffect)(function(){return h.current&&h.current.addEventListener("mousewheel",d),function(){h.current&&h.current.removeEventListener("mousewheel",d)}},[o]);var d=function(e){return e.stopPropagation()},p=Object(a.useState)(void 0),v=Object(r.a)(p,2),m=v[0],y=v[1],b=Object(a.useState)(""),g=Object(r.a)(b,2),O=g[0],j=g[1];Object(a.useEffect)(function(){return window.addEventListener("click",k),function(){return window.removeEventListener("click",k)}},[o,s]);var k=Object(a.useCallback)(function(){o.length>0&&s([])},[o,s]);Object(a.useEffect)(function(){n.current&&y(at(n.current,n.current.selectionStart))},[o]),Object(a.useEffect)(function(){t||j("")},[t,j]);var w={};m&&(w.top=m.y+16-c,w.left=m.x,w.maxHeight=n.current.offsetHeight-w.top);var x=Object(a.useCallback)(function(e){e.stopPropagation(),Object(tt.a)(t).then(function(e){j(e)})},[t,j]);return t||0!==o.length?i.a.createElement("div",{ref:h,style:w,className:"possibilities"},t&&i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},onMouseUp:function(e){return e.stopPropagation()},className:"library-view"},i.a.createElement("div",{className:"library"},i.a.createElement("div",null,"Library: ",t),i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},onMouseUp:x,className:"see-source-btn"},"See Source")),""!==O&&i.a.createElement("textarea",{className:"see-source"},O)),o.map(function(e,t){return i.a.createElement("div",{key:t,onMouseUp:function(t){t.stopPropagation(),u(e)},onMouseDown:function(e){e.stopPropagation()},className:e===l?"selected option":"option"},i.a.createElement("div",{className:"args"},i.a.createElement("div",{className:"keyword"},e),i.a.createElement("div",{className:"param"},"(",Object.keys(f(e).params).join(", "),")")),i.a.createElement("div",{className:"description"},f(e).description))})):[]}),ot=n(1),st=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=(arguments.length>2&&arguments[2],[]),r=[],a=[],i=[];for(var o in e.current)if(e.current[o]){var s=e.current[o].current;if(s)n.push(s.offsetLeft+(t?s.offsetWidth:0)),r.push(s.offsetTop+(t?s.offsetHeight:0)),i.push(s.offsetHeight),a.push(s.offsetWidth)}return{lefts:n,tops:r,widths:a,heights:i}},ct=function(e,t,n,r,a){var i=a.lefts,o=a.tops,s=a.widths,c=a.heights;for(var u in i){var l=s[u],f=c[u],h=i[u]-l,d=o[u]-f;if(e>=h&&e<=h+l&&t>=d&&t<=d+f)return!0}return!1},ut=function(e,t,n,r,a){var i=t.offsetLeft,o=t.offsetTop,s=t.offsetWidth+i,c=t.offsetHeight+o;return a&&void 0!==a[r]&&(i=a[r].x,o=a[r].y,s=t.offsetWidth+a[r].x,c=t.offsetHeight+a[r].y),lt(e,i,o,s,c,n,a)},lt=function(e,t,n,r,a,i,o){if(!e)return!1;var s=t,c=n,u=r,l=a,f={x1:e.offsetLeft,y1:e.offsetTop,x2:e.offsetLeft+e.offsetWidth,y2:e.offsetTop+e.offsetHeight};return o&&void 0!==o[i]&&(f.x1=o[i].x,f.y1=o[i].y,f.x2=o[i].x+e.offsetWidth,f.y2=o[i].y+e.offsetHeight),s<=f.x2&&u>=f.x1&&c<=f.y2&&l>=f.y1};function ft(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ht(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ht(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var dt=function(e){var t=e.element,n=e.skipPlacement,r=e.setWindowScale,i=e.sequencerEngine,s=e.ref,u=e.setSize,l=e.sizeRef,f=e.containerRef,h=e.setCoords,d=e.handleScroll,p=e.elements;Object(a.useEffect)(function(){if(f&&!n){if(t&&void 0!==t.x&&(h({x:t.x,y:t.y}),void 0!==t.width&&r({x:t.width,y:t.height}),m(t.x,t.y,!0)),t&&void 0===t.x&&(i&&i.state.windows.windowPositions[t.id]||v(t)),t&&p.current&&(p.current[t.id]=s),t.needsPlacement){var e=function e(t,n,r,a,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};for(var c in s[r]||(s[r]=0),s[r]++,i)if(!(c===r||s[c]>6)){var u=i[c].current;if(u){var l=Object(ot.a)({},o);if(l[r]={x:t,y:n},ut(a,u,r,c,l)){var f={x:u.offsetLeft,y:u.offsetTop};o[c]&&(f=o[c]);var h={x:f.x+a.offsetWidth+50,y:f.y};o[c]=h,o=Object(ot.a)({},o,e(h.x,h.y,c,u,i,o,s))}}}return o}(t.x,t.y,t.id,s.current,p.current);i.dispatch(Object(c.O)(e))}}else t&&void 0!==t.width&&r&&r({x:t.width,y:t.height})},[]);var v=Object(a.useCallback)(function(e){if(f){var t=st(function(e){if(!e)return{current:{}};var t=Object(o.a)(i.state.zobject.zobjectsStack);t.reverse();var n,r={},a=ft(t);try{for(a.s();!(n=a.n()).done;){var s=n.value;r[s.id]=e.current[s.id]}}catch(u){a.e(u)}finally{a.f()}for(var c in e.current)r[c]=e.current[c];return{current:r}}(p)),n=t.tops,r=t.lefts,a=t.widths,c=t.heights;for(var u in n){var l=n[u],d=r[u],v=a[u],y=d+5,b=l-c[u];if(y+s.current.offsetWidth<=f.current.offsetWidth&&!ct(y,b,s.current.offsetWidth,s.current.offsetHeight,t))return h({x:y,y:b}),void m(y,b,!0);if(!ct(y=d-v,b=l+5,s.current.offsetWidth,s.current.offsetHeight,t))return e.id,h({x:y,y:b}),void m(y,b,!0)}}},[]),m=Object(a.useCallback)(function(e,n,r){if(l&&s.current){var a=l.current;if(a){if(e+s.current.offsetWidth>a.width||n+s.current.offsetHeight>a.height){var f={width:Math.max(a.width,e+s.current.offsetWidth),height:Math.max(a.height,n+s.current.offsetHeight)};return l.current=f,void u(f)}if(r)return;var h=function(e){var t=st(e,!1,!0),n=t.lefts,r=t.tops;return{minLeft:Math.min.apply(Math,Object(o.a)(n)),minTop:Math.min.apply(Math,Object(o.a)(r))}}(p),v=h.minTop,m=h.minLeft,y=function(e){var t=st(e,!0,!0),n=t.lefts,r=t.tops;return{maxLeft:Math.max.apply(Math,Object(o.a)(n)),maxTop:Math.max.apply(Math,Object(o.a)(r))}}(p),b=y.maxTop,g=y.maxLeft;if(v-=100,m-=100,i&&t.subSequence&&!t.subSequence.getRootSubSequence){var O=i.state.spatial,j=O.edgesSize,k=O.edgesPadding,w={width:g-m,height:b-v};w.width===j.width&&w.height===j.height||i.dispatch(Object(c.ub)(w.width+300,w.height+300)),k.x===m&&k.y===v||m!==1/0&&v!==1/0&&i.dispatch(Object(c.tb)(m,v))}if(g<a.width||b<a.height){if(!(g>a.width||b>a.height))return;var x={width:Math.max(a.width,g),height:Math.max(a.height,b)};if(l.current=x,u(x),i)i.state.spatial.mainScrollRef&&d(e,n,l)}}}},[u,p]);return{adjust:m,placeWindow:v}};function pt(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return vt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vt(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function vt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var mt=function(e){var t,n=e.isSimple,i=void 0!==n&&n,s=e.sizeRef,u=e.sequencerEngine,l=e.initialCoords,f=e.expand,h=e.ref,d=e.containerRef,p=e.size,v=e.basicContainerRef,m=e.setSize,y=e.element,b=e.elements,g=(e.isPad,e.ordering),O=e.setOrdering,j=e.windowPosition,k=e.skipPlacement,w=e.dragOnLoad,x=void 0!==w&&w,S=Object(a.useRef)(void 0),P=Object(a.useState)(x),E=Object(r.a)(P,2),A=E[0],M=E[1],R=Object(a.useRef)(void 0),C=Object(a.useRef)(void 0),N=Object(a.useState)({x:10,y:10}),I=Object(r.a)(N,2),q=I[0],_=I[1],D=Object(a.useState)(void 0),F=Object(r.a)(D,2),L=F[0],B=F[1],z=Object(a.useState)(y&&y.width?{x:y.width,y:y.height}:{x:0,y:0}),J=Object(r.a)(z,2),V=J[0],H=J[1],U=Object(a.useState)(l),G=Object(r.a)(U,2),W=G[0],K=G[1],Q=Object(a.useCallback)(function(e){K(e),u&&e&&y&&(y.presentationMode?u.dispatch(Object(c.Zc)(y.id,e)):u.dispatch(Object(c.Ze)(y.id,e)))},[u,y,K]),Z=function(e){e.sequencerEngine;return{handleScroll:Object(a.useCallback)(function(e,t,n){},[])}}({sequencerEngine:u}).handleScroll,Y=dt({element:y,skipPlacement:k,setWindowScale:H,sequencerEngine:u,ref:h,setSize:m,size:p,sizeRef:s,containerRef:d,setCoords:Q,handleScroll:Z,elements:b}),$=Y.adjust,X=(Y.placeWindow,Object(a.useCallback)(function(){if(g&&!(g.length>0&&g.indexOf(y)===g.length-1)){var e=g.filter(function(e){return e!==y});e=[].concat(Object(o.a)(e),[y]),O(e)}},[g,O,y])),ee=Object(a.useCallback)(function(e,t){var n=e.clientX,r=e.clientY;if(d){var a=d.current.getBoundingClientRect();n=e.clientX-a.left-q.x,r=e.clientY-a.top-q.y;var i=window._scale||1;t||(n/=i,r/=i)}return{x:n,y:r}},[d,q]),te=function(e){var t=e.ref,n=e.setCoords,r=e.sequencerEngine,i=e.setWindowScale,o=e.windowScale,s=e.adjust,u=e.updateOrdering,l=e.setIsResizing,f=e.element,h=e.getXY,d=Object(a.useRef)(f&&f.width?{width:f.width,height:f.height}:{width:0,height:0}),p=Object(a.useRef)({x:0,y:0}),v=Object(a.useCallback)(function(e,t,a,o){var u=t-p.current.x,l=a-p.current.y,f=d.current,h=f.width,v=f.height;"NW"===e?n({x:Math.max(0,t),y:Math.max(0,a)}):"SW"===e?(a=o.y,l*=-1):"NE"===e?(u*=-1,t=o.x):"SE"===e&&(u*=-1,l*=-1,t=void 0,a=void 0);var m=h-u,y=v-l;o.height=y,o.width=m,r&&(r.dispatch(Object(c.if)(o.id,{width:m,height:v,newHeight:y})),o.effect&&o.effect.pad&&o.effect.pad.onSizeChange(m,y)),i({x:m,y:y}),s(o.x,o.y),void 0!==t&&void 0!==a&&(t=Math.max(0,t),a=Math.max(0,a),n({x:t,y:a}))},[o,i,n]),m=Object(a.useCallback)(function(e,t){t.stopPropagation(),d.current=y(),p.current=h(t),l(e),u()},[o,l]),y=Object(a.useCallback)(function(){return{width:t.current.offsetWidth,height:t.current.offsetHeight}},[]);return{resizeWindow:v,startResizing:m}}({element:y,ref:h,setCoords:Q,sequencerEngine:u,setWindowScale:H,windowScale:V,adjust:$,updateOrdering:X,setIsResizing:B,getXY:ee}),ne=te.startResizing,re=te.resizeWindow;Object(a.useEffect)(function(){j&&($(j.x,j.y),y.x=j.x,y.y=j.y)},[j,m]),Object(a.useEffect)(function(){X()},[]);var ae=function(){if(u){var e=u.state.windows.selectedElements;return Object.keys(e)}return[]};Object(a.useEffect)(function(){y&&void 0!==y.x&&setTimeout(function(){$(y.x,y.y)},50)},[f]),Object(a.useEffect)(function(){return window.addEventListener("mousemove",ue),window.addEventListener("mousedown",ie),window.addEventListener("mouseup",ce),function(){window.removeEventListener("mousemove",ue),window.removeEventListener("mousedown",ie),window.removeEventListener("mouseup",ce)}},[_,Q,y,A,q,m,L,A,B,V,H]);var ie=Object(a.useCallback)(function(e){},[]),oe=Object(a.useCallback)(function(e){e.stopPropagation();var t=h.current.getBoundingClientRect();if(C.current={x:e.pageX,y:e.pageY},u){if(S.current=Object(ot.a)({},u.state.spatial.editorPadding),u.state.zobject.uxLocked||u.state.spatial.lockedObjects[y.id])return;var n={},r=u.state.spatial.presentationMode,a=u.state.windows.windowPositions,i=u.state.windows.presentationWindowPositions;for(var o in b.current){var s=r&&i[o]||a[o];n[o]=Object(ot.a)({},s)}R.current=n}u&&(ae().includes(y.id)||u.dispatch(Object(c.Ad)({}))),_({x:e.clientX-t.left,y:e.clientY-t.top}),M(!0),X()},[_,M,g,O]),se=Object(a.useCallback)(function(e){e.stopPropagation(),X()},[g,O]),ce=Object(a.useCallback)(function(){(A||L)&&(B(!1),M(!1),_({x:0,y:0}))},[M,B,_,L,A]),ue=Object(a.useCallback)(function(e){if(A||L){var t=ee(e),n=t.x,r=t.y;if(u&&S.current){var a=u.state.spatial.editorPadding;n+=a.x-S.current.x,r+=a.y-S.current.y}if(!d&&!L){var i={x:e.pageX-q.x,y:e.pageY-q.y};if(v){var o=v.current.getBoundingClientRect();i.x-=o.left,i.y-=o.top}return y&&y.subSequence&&y.subSequence.getRootSubSequence&&(i.y=Math.max(0,i.y)),void Q(i)}if(A){var l=ae(),f={x:e.pageX,y:e.pageY};if(n+=d.current.scrollLeft,r+=d.current.scrollTop,l.length>0&&f&&C.current){var h,p=f.x-C.current.x,m=f.y-C.current.y,b={},g=pt(l);try{for(g.s();!(h=g.n()).done;){var O=h.value;if(O!==y.id){var j=R.current[O],k=window._scale||1;j&&(b[O]={x:j.x+p/k,y:j.y+m/k})}}}catch(D){g.e(D)}finally{g.f()}var w={};console.log("selected=",l);var x,P=pt(l);try{for(P.s();!(x=P.n()).done;){var E=x.value;for(var T in E=u.idToObject[E],console.log("node inlets=",E.inlets),E.inlets){var M,N=pt(E.inlets[T].connections);try{for(N.s();!(M=N.n()).done;){var I=M.value;console.log("segmentation now=",I.segmentation),I.segmentation+=m}}catch(D){N.e(D)}finally{N.f()}}w=Object(ot.a)({},w,E.updateMessagingRedux())}}catch(D){P.e(D)}finally{P.f()}var _=y.subSequence.state.windows.inletConnections[y.subSequence.id]||{};u.dispatch(Object(c.Mb)(y.subSequence.id,Object(ot.a)({},_,w))),y.presentationMode?u.dispatch(Object(c.N)(b)):u.dispatch(Object(c.O)(b))}y&&y.subSequence&&y.subSequence.getRootSubSequence&&(n=Math.max(0,n),r=Math.max(0,r)),$(n,r),Q({x:n,y:r}),Z(n,r,s),y.x=n,y.y=r}else L&&re(L,n,r,y)}},[A,y,_,Q,q,m,b,H,V,L]),le={};if(g&&g.includes(y)){var fe=g.indexOf(y);le.zIndex=10*(1+fe)}return i?{isDragging:A,zIndex:le.zIndex,onContextMenu:se,onMouseDown:oe,onMouseUp:ce,startResizing:ne}:(W&&(le.top=W.y,le.left=W.x),t={adjust:$,onContextMenu:se,setWindowScale:H,style:le,isDragging:A,onMouseDown:oe,windowScale:V,onMouseUp:ce,setCoords:Q},Object(T.a)(t,"isDragging",A),Object(T.a)(t,"startResizing",ne),Object(T.a)(t,"coords",W),Object(T.a)(t,"zIndex",le.zIndex),t)},yt=n(239),bt=n(181),gt=n(130),Ot=n(124),jt=function(e,t,n){var r=e.sequencerEngine.findNodeById(n.edge.destId),a=e.sequencerEngine.findNodeById(n.edge.sourceId);r&&a&&r.disconnectInlet(n.edge.destType,a,n.edge.sourceType),e.connectInlet(t,a,n.sourceType)},kt=new Ot.a,wt=Object(s.b)(function(e,t){var n=t.subSequence||t.effect.subSequence||t.effect.track&&t.effect.track.subSequence;if(n){var r=t.effect.numInlets;return t.effect.effect&&(r+=t.effect.effect.numInlets),{drawingEdge:e.pads.drawingEdges[n.id],numInlets:r,movingEdge:e.pads.movingEdge,compilationError:t.effect.compilationError}}return{}},function(e){return{setZObjectTooltip:function(t,n,r,a,i){return e(Object(c.jf)(t,n,r,a,i))},setSelectedPadEdge:function(t){return e(Object(c.wd)(t))}}})(function(e){var t=e.doc,n=e.effect,s=e.drawingEdge,c=e.movingEdge,u=e.setZObjectTooltip,l=e.setSelectedPadEdge,f=Object(a.useState)(void 0),h=Object(r.a)(f,2),d=h[0],p=h[1],v=Object(a.useState)(void 0),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useState)(void 0),O=Object(r.a)(g,2),j=O[0],k=O[1],w=Object(a.useCallback)(function(e,t){s&&s.type?(p(void 0),Object(X.a)(Object($.d)(s.node,s.type,t,e))):c&&(p(void 0),jt(t,e,c),l(void 0))},[s,c,p]),x=Object(a.useCallback)(function(e,t,n,r){if(e.stopPropagation(),e.metaKey){var a=n.zObject?n.zObject.windowPosition:n.windowPosition,i=n.subSequence.createZMessage(a.x+25*r,a.y-10,bt.c,void 0,void 0,void 0,!0,!0);i.min=-1,i.max=1,Object(X.a)(Object($.d)(i,"Output",n,t))}},[]);Object(a.useEffect)(function(){if(d){var e=n.zObject?n.zObject.id:n.id,t=n.state.windows.windowPositions[e];if(!t)return;u(n.subSequence.id,{x:t.x+20*d.i,y:t.y-30},d.text,y,j)}else u(void 0)},[d,n,y,j]);var S=Object(a.useCallback)(function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if("instancedSubpatch"!==n.name&&void 0!==r&&t&&t(n.name)&&t(n.name).params){var a=t(n.name),i=Object.keys(t(n.name).params),s=Object.values(t(n.name).params);isNaN(a.inlets)?Array.isArray(a.inlets)&&(i=a.inlets):i.length<a.inlets&&(r-=a.inlets-i.length);var c=n.name+": "+(i[r]||e);s[r]&&""!==s[r]&&(c+=" "+s[r]),n.effect&&n.effect.inletObjects&&n.effect.inletObjects[r]&&""===(c=n.effect.inletObjects[r]._text)&&(c=Object.keys(n.effect.inlets)[r]),p({text:c,i:r})}else p({text:e,i:r});if(t&&t(n.name).inletTypes){var u=Object(yt.a)(t(n.name),r);if("function"===typeof u)return;b(u);var l=n.lastMessageReceived,f=[l&&l[0]?l[0].type:void 0].concat(Object(o.a)(n.args.map(function(e){return e&&e.type})));f[r]&&k(f[r])}},[p,k]);if(!n.inlets)return"";var P=Object.keys(n.inlets);P.includes("Input")&&(P=["Input"].concat(Object(o.a)(P.filter(function(e){return"Input"!==e}))));var E=[],T=[];n.effect&&n.effect.inlets&&function(){for(var e=Object.keys(n.effect.inlets).filter(function(e){return!P.includes(e)}),t=n.effect,r=[],a=(n.name,function(n){t.inletObjects&&t.inletObjects[n]&&""!==t.inletObjects[n]._text?T[n]=t.inletObjects[n]._text:T[n]=e[n],t.inletObjects&&t.inletObjects[n]&&t.inletObjects[n].isDeleted?T.splice(-1):t.inletObjects&&t.inletObjects[n]&&t.implements&&!t.implements.instanceInlets.find(function(e){return e.inletNumber===t.inletObjects[n].inletNumber})?T.splice(-1):t.inletObjects&&t.inletObjects[n]&&t.hasInstances&&t.instanceInlets.includes(t.inletObjects[n])?T.splice(-1):(t.implements&&t.implements.inletObjects&&t.implements.inletObjects[n]&&""!==t.implements.inletObjects[n]._text&&(T[n]=t.implements.inletObjects[n]._text),r.push(e[n]))}),i=0;i<e.length;i++)a(i);E=r}(),T=T.filter(function(e){return e}),n.isOutlet&&(P=P.slice(0,1));var A=function(e){return s&&s.type===e?{backgroundColor:kt.getColorForHash(e)}:{}},M=Object(a.useCallback)(function(e,r,a){var i=e.isInletConnected(r)?"inlet connected":"inlet";if(!t||!t(n.name))return i;var o=Object(yt.a)(t(n.name),a);return o?(Array.isArray(o)||(o=[o]),i+=" "+o.filter(function(e){return e&&e.replaceAll}).map(function(e){return e.replaceAll(" ","-")}).join(" "),e.compilationError&&e.compilationError.inlet===a&&(i+=" error-inlet"),i):i},[n.compilationError]),R={};return i.a.createElement("div",{style:"color"!==n.name?{width:n.width}:{},className:"inlets"},P.map(function(e,t){return i.a.createElement("div",{onMouseDown:function(r){return x(r,e,n,t)},key:e,onMouseLeave:function(){return p(void 0)},onMouseOver:function(){return S(e,t)},style:Object(ot.a)({},R,A(e)),onMouseUp:function(){return w(e,n)},id:n.getFullType(e),className:M(n,e,t)})}),E.map(function(e,t){return i.a.createElement("div",{key:e,onMouseLeave:function(){return p(void 0)},style:Object(ot.a)({},R,A(e)),onMouseOver:function(){return S(T[t],t+P.length)},onMouseUp:function(){return w(e,n.effect)},onMouseDown:function(r){return x(r,e,n.effect,t+P.length)},id:n.effect.getFullType(e),className:M(n.effect,e,t+P.length)})}))}),xt=function(e){var t=e.containerRef;return{getXY:Object(a.useCallback)(function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];window._scale;if(!t||!t.current)return{x:0,y:0};var r=t.current.getBoundingClientRect(),a=n?t.current.scrollLeft:0,i=n?t.current.scrollTop:0;return{x:e.clientX-r.left+a,y:e.clientY-r.top+i}},[])}},St=(n(1682),new Ot.a),Pt=Object(s.b)(function(e,t){var n=t.effect.subSequence||t.effect.track&&t.effect.track.subSequence;return t.effect.effect?{numOutlets:t.effect.numOutlets+t.effect.effect.numOutlets,drawingEdge:n&&e.pads.drawingEdges[n.id]}:{numOutlets:t.effect.numOutlets,movingEdge:e.pads.movingEdge,drawingEdge:n&&e.pads.drawingEdges[n.id]}},function(e){return{setDrawingPadEdge:function(t,n){return e(Object(c.pb)(t,n))},setZObjectTooltip:function(t,n,r,a,i){return e(Object(c.jf)(t,n,r,a,i))}}})(function(e){var t=e.doc,n=e.subSequence,o=e.drawingEdge,s=e.setDrawingPadEdge,c=e.effect,u=e.containerRef,l=e.setZObjectTooltip,f=e.scale,h=Object(a.useState)(void 0),d=Object(r.a)(h,2),p=d[0],v=d[1],m=Object(a.useState)(void 0),y=Object(r.a)(m,2),b=y[0],g=y[1],O=Object(a.useState)(void 0),j=Object(r.a)(O,2),k=j[0],w=j[1];xt({containerRef:u,scale:f}).getXY;Object(a.useEffect)(function(){if(p){var e=c.zObject?c.zObject.id:c.id,t=c.state.windows.windowPositions[e],n=c.zObject?c.zObject.height||25:c.height||25;if(!t)return;l(c.subSequence.id,{x:t.x+20*p.i,y:t.y+n+10},p.text,b,k)}else l(void 0)},[p,c,b,k]);var x=Object(a.useCallback)(function(e,t){var r=n.state.pads.movingEdge;r&&(v(void 0),function(e,t,n){var r=e.sequencerEngine.findNodeById(n.edge.destId),a=e.sequencerEngine.findNodeById(n.edge.sourceId);console.log("move edge outlet outletType=",t,a,r),r&&a&&r.disconnectInlet(n.edge.destType,a,n.edge.sourceType),r.connectInlet(n.edge.destType,e,t)}(t,e,r))},[]),S=Object(a.useCallback)(function(e,n){if(v({text:c.name?c.name+": "+e:e,i:n}),t){var r=c.effect&&c.effect.outlets[e]&&c.effect.outlets[e].type?c.effect.outlets[e].type:Object(yt.b)(t(c.name),n);g(r),c.outputtedTypes&&w(c.outputtedTypes[n])}},[v,g,w]),P=Object(a.useCallback)(function(e,t,r,a){e.stopPropagation(),a.getFullType(t);var i={x:e.clientX,y:e.clientY},o=n||a.subSequence||a.track&&a.track.subSequence;o.state.spatial.edgesPadding,s(o.id,Object(ot.a)({},i,{effect:a,type:t,outputNumber:r,node:a,x1:i.x*(window._scale||1),y1:i.y*(window._scale||1),x2:i.x*(window._scale||1),y2:i.y*(window._scale||1)}))},[n]);if(!c.outlets)return"";var E=Object.keys(c.outlets),T=[],A=[];if(c.effect&&c.effect.inlets&&(!c.effect.hasInstances||c.effect.showAllOutlets)){var M=Object.keys(c.effect.outlets).filter(function(e){return!E.includes(e)});T=M;for(var R=c.effect,C=0;C<M.length;C++)R.outletObjects&&R.outletObjects[C]&&""!==R.outletObjects[C]._text?A[C]=R.outletObjects[C]._text:A[C]=M[C]}var N=function(e){return o&&o.type===e?{backgroundColor:St.getColorForHash(e)}:{}},I=function(e,n,r){var a=e.isOutletConnected(n)?"outlet connected":"outlet";if(!t||!t(c.name))return a;var i=Object(yt.b)(t(c.name),r);return i?(Array.isArray(i)||(i=[i]),a+=" "+i.map(function(e){return e.replaceAll(" ","-")}).join(" ")):a};return i.a.createElement("div",{style:"color"!==c.name?{width:c.width}:{},className:"outlets"},E.map(function(e,t){return i.a.createElement("div",{key:e,onMouseLeave:function(){return v(void 0)},style:N(e),onMouseOver:function(){return S(e,t)},onMouseDown:function(n){return P(n,e,t,c)},onMouseUp:function(){return x(e,c)},id:c.getFullType(e),className:I(c,e,t)})}),T.map(function(e,t){return i.a.createElement("div",{key:e,onMouseLeave:function(){return v(void 0)},onMouseOver:function(){return S(A[t],E.length+t)},onMouseUp:function(){return x(e,c.effect)},style:N(e),onMouseDown:function(n){return P(n,e,t,c.effect)},id:c.effect.getFullType(e),className:I(c.effect,e,t)})}))}),Et=function(e){var t=e.ref,n=e.code,i=e.onChange,o=e.doc,s=e.skipMouse,c=void 0!==s&&s,u=e.timeout,l=void 0===u?250:u,f=e.disable,h=Object(a.useState)([]),d=Object(r.a)(h,2),p=d[0],v=d[1],m=Object(a.useState)(void 0),y=Object(r.a)(m,2),b=y[0],g=y[1],O=Object(a.useState)(void 0),j=Object(r.a)(O,2),k=j[0],w=j[1],x=Object(a.useState)(void 0),S=Object(r.a)(x,2),P=S[0],E=S[1],T=Object(a.useRef)(0);Object(a.useEffect)(function(){if(!f&&t&&t.current)return t.current.addEventListener("keydown",A),t.current.addEventListener("keyup",R),c||t.current.addEventListener("mouseup",R),function(){t.current&&(t.current.removeEventListener("keydown",A),t.current.removeEventListener("keyup",R),c||t.current.removeEventListener("mouseup",R))}},[n,b,p,k,w,g,f]);var A=Object(a.useCallback)(function(e){return"Tab"!==e.key||(e.preventDefault(),e.stopPropagation(),k&&C(k),!1)},[n,i,p,v,p,k,w]),M=Object(a.useCallback)(function(e){var t=1;for(e-=2;e>=0&&t>0;e--)")"===n.charAt(e)?t++:"("===n.charAt(e)&&t--;if(e>0){var r=Ct(e,n),a=r.x,i=r.y;E({x:a,y:i}),setTimeout(function(){E(void 0)},1e3)}},[E,n]),R=Object(a.useCallback)(function(){var e=Object(K.a)(W.a.mark(function e(r){var a,i,s,c,u,h;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.current){e.next=2;break}return e.abrupt("return");case 2:if(!f){e.next=4;break}return e.abrupt("return");case 4:return T.current++,a=T.current,e.next=8,Object(ve.a)(l);case 8:if(a===T.current){e.next=10;break}return e.abrupt("return");case 10:if("Tab"!==r.key){e.next=12;break}return e.abrupt("return",!1);case 12:if(i=t.current.selectionStart,")"===r.key&&M(i),s=n.replaceAll("("," ").replaceAll(")"," "),""===(c=Rt(s,i))&&(c=Rt(s,i-1)),""!==c.trim()){e.next=21;break}return p.length>0&&v([]),b&&g(void 0),e.abrupt("return");case 21:if("load"!==c&&"library"!==c){e.next=26;break}if(""===(u=Mt(s,i))){e.next=26;break}return g(u),e.abrupt("return");case 26:if(1!==(h=o().filter(function(e){return e.startsWith(c)})).length||h[0]!==c.trim()){e.next=30;break}return h.length>0&&v([]),e.abrupt("return");case 30:v(h),w(h.find(function(e){return e===c})||h[0]);case 32:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[n,b,p,v,w,g,f]),C=Object(a.useCallback)(function(e){var r=Tt(n,t.current.selectionStart),a=At(n,t.current.selectionStart),o=n.substring(0,0===r?0:r+1),s=n.substring(a);i({target:{value:o+e+s}}),setTimeout(function(){var n=o.length+e.length;t.current&&(t.current.focus(),t.current.setSelectionRange(n,n),v([]),g(void 0))},50)},[n,i,g,v]);return{choosePossibility:C,library:b,possibilities:p,setPossibilities:v,setLibrary:g,selectedChoice:k,matchingParenthesis:P}},Tt=function(e,t){for(t--;t>0&&" "!==e.charAt(t)&&"\n"!==e.charAt(t)&&","!==e.charAt(t)&&")"!==e.charAt(t)&&"("!==e.charAt(t);)t--;return t},At=function(e,t){for(t--;t<e.length&&" "!==e.charAt(t)&&"\n"!==e.charAt(t)&&","!==e.charAt(t)&&")"!==e.charAt(t)&&"("!==e.charAt(t);)t++;return t},Mt=function(e,t){for(var n="",r=!1,a=t;a<e.length;a++)if('"'!==e.charAt(a))r&&(n+=e.charAt(a));else{if(r)return n;r=!0}return n},Rt=function(e,t){e=String(e),t=Number(t)>>>0;var n=e.slice(0,t+1).search(/\S+$/),r=e.slice(t).search(/\s/);return r<0?e.slice(n):e.slice(n,r+t)},Ct=function(e,t){e++;var n=(t=t.slice(0,e+1)).split("\n"),r=n.length-1;return{x:9*(e-n.slice(0,n.length-1).reduce(function(e,t){return e+t.length+1},0)),y:22*r}},Nt=Object(s.b)(function(e,t){return{}},function(e){return{setAccumulatorParameterSelected:function(t){return e(Object(c.n)(t))}}})(function(e){var t=e.zobject,n=e.setAccumulatorParameterSelected,o=Object(a.useState)(t.function([])),s=Object(r.a)(o,2),c=s[0];s[1];return c=Array.isArray(c)?c[0]:[c],console.log("parameters=",c),i.a.createElement("div",{onClick:function(){return n(c[0])},className:"param-component"},c.map(function(e){return i.a.createElement("div",{className:"param-name"},e.name)}))}),It=n(434),qt=n(980),_t=n(894),Dt=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.sequencerEngine,n=e.parameter,o=e.connectToLFO,s=e.disconnectFromLFO,c=Object(a.useCallback)(function(){if(n)return n.availableLFOs;if(void 0!==t&&n){var e=n.track||n.context&&n.context.track;return e&&e.subSequence?e.subSequence.lfosTrack.lfos.map(function(e){return e.lfo}):n.context.subSequence?n.context.subSequence.lfosTrack.lfos.map(function(e){return e.lfo}):t.lfosTrack.lfos.map(function(e){return e.lfo})}return[]},[n]),u=Object(a.useState)(c()),l=Object(r.a)(u,2),f=l[0],h=l[1];return Object(a.useEffect)(function(){h(c())},[n,h]),i.a.createElement("div",{className:"modulators-container"},i.a.createElement("div",{className:"lfo-boxes"},f&&f.map(function(e,t){return i.a.createElement(_t.a,Object(T.a)({connectToLFO:o,disconnectFromLFO:s,key:t,isToggled:!0,parameter:n,lfo:e,lfos:f},"parameter",n))})),i.a.createElement(qt.a,{sequencerEngine:t,parameter:n}))}),Ft=n(173),Lt=new Ot.a,Bt=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.setSelectedColor,n=e.macro,o=e.macroToShow,s=e.setMacroToShow,c=Object(a.useState)(!1),u=Object(r.a)(c,2),l=u[0],f=u[1],h=Object(a.useState)(n.color),d=Object(r.a)(h,2),p=d[0],v=d[1],m=n===o,y=n.effect.track.sequencerEngine,b=n.signalParameter,g=Object(a.useCallback)(function(e){n.color=e.hex,v(e.hex),t(e)},[t,n,v]);return Object(a.useEffect)(function(){v(n.color)},[n,v]),i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},className:"macro-info"},i.a.createElement("div",{style:{backgroundColor:Lt.getColorForHash(n.id)},className:"macro-indicator"}),i.a.createElement("div",{className:"macro-name"},n.name),i.a.createElement(Dt,{parameter:b,sequencerEngine:y,disconnectFromLFO:function(e,t){return n.disconnectFromLFO(e,t)},connectToLFO:function(e,t){return n.connectToLFO(e,t)}}),i.a.createElement("div",{onClick:function(){return f(!l)},style:{backgroundColor:p},className:l?"color-btn showing":"color-btn"}),l&&i.a.createElement(It.a,{color:p,onChange:g}),i.a.createElement("div",{onClick:function(){return s(m?void 0:n)},className:m?"selected macro-show-btn":"macro-show-btn"},m?"Collapse":"Expand"))}),zt=Object(s.b)(function(e,t){return{value:t.parameter[t.arg],_value:t.parameter.get(!0),depth:t.parameter._depth,minMax:e.effects.parameterMinMax[t.parameter.id]}},function(e){return{setParameterMinMax:function(t){return e(Object(c.Fc)(t))}}})(function(e){var t=e.value,n=e.parameter,o=e.arg,s=e.label,c=e.setParameterMinMax,u=Object(a.useState)(!1),l=Object(r.a)(u,2),f=l[0],h=l[1],d=Object(a.useState)(t),p=Object(r.a)(d,2),v=p[0],m=p[1];Object(a.useEffect)(function(){m(t)},[t,m]);var y=Object(a.useCallback)(function(e){var t=e.target.value;if("."===t)t=0;else if("-"===t)t=0;else if(""===t)t=0;else if(!Object(Ae.a)(t))return;t=parseFloat(t),n[o]=t;var r={};r[n.id]={min:n.min,max:n.max},r[n.id][o]=t,c(r),m(t)},[m,o,n]);Object(a.useEffect)(function(){f||m(t)},[f,t,m]);var b=Object(a.useCallback)(function(e){"Enter"===e.key&&h(!1)},[h]),g="d-parameter-"+o;return f?i.a.createElement("div",{className:g},s,":",i.a.createElement("input",{onKeyDown:b,className:"min-max-input",value:v,onChange:y,type:"text"})):i.a.createElement("div",{onClick:function(){return h(!0)},className:g},s,": ",Math.round(1e3*t)/1e3)}),Jt=new Ot.a,Vt=Object(s.b)(function(e,t){return{value:t.parameter.get(!0),depth:t.parameter._depth}},function(e){return{}})(function(e){var t=e.value,n=e.setSelected,r=e.selected,o=e.setParameter,s=e.parameter,c=e.parameterSelected,u=e.depth,l=e.isBoundsMode,f=(e.max,e.min,s),h=Object(a.useCallback)(function(e){var t=e.hasGroup.effect._parameters;e.hasGroup.effect.unmapParameter(t.indexOf(e)),n(r.filter(function(t){return t!==e}))},[n,r]);t=t<10?Math.round(1e3*t)/1e3:s.max-s.min>=1e3?Math.round(t):s.max-s.min>=100?Math.round(10*t)/10:Math.round(100*t)/100,u=Math.round(100*u)/100;var d=f.locked2D?"device-parameter locked":"device-parameter";return r.includes(f)&&(d+=" selected"),i.a.createElement("div",{onClick:function(){return n([f])},id:c===f?"accumulator-map-source":"",className:d},i.a.createElement("div",{onClick:function(){return o(f===c?void 0:f)},className:"dot",style:{backgroundColor:Jt.getColorForHash(f.name)}}),i.a.createElement("div",{className:"d-parameter-name"},f.name),l?i.a.createElement(zt,{arg:"min",label:"Min",parameter:s}):i.a.createElement("div",{className:"d-parameter-value"},t),l?i.a.createElement(zt,{arg:"max",label:"Max",parameter:s}):i.a.createElement("div",{className:"d-parameter-depth"},u),f.hasGroup&&!l?i.a.createElement("div",{onClick:function(){return h(f)},className:"ungroup-parameter"},"Unmap"):"")});function Ht(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ut(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ut(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gt(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Wt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wt(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Wt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Kt=new Ot.a,Qt=function(e){var t=e.device,n=e.parameters,r=e.parameterSelected,o=e.setParameter,s=e.setSelected,c=e.selected,u=e.isBoundsMode;Object(a.useEffect)(function(){return function(){return n.includes(r)?o(void 0):void 0}},[r,n]);var l=n.filter(function(e){return!e.isPlaneMacro}),f=Object(a.useCallback)(function(){s(l)},[l]);return i.a.createElement("div",{className:"device"},i.a.createElement("div",{onClick:f,className:"device-name"},t),i.a.createElement("div",{className:"device-parameters"},l.map(function(e){return i.a.createElement(Vt,{isBoundsMode:u,setSelected:s,selected:c,parameter:e,setParameter:o,parameterSelected:r})})))},Zt=function(e){var t,n=new Set,r=Gt(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.hasGroup&&n.add(a.hasGroup)}}catch(i){r.e(i)}finally{r.f()}return Array.from(n)},Yt=Object(s.b)(function(e,t){return{_parameters:t.effect._parameters,parameterSelected:e.effects.accumulatorParameterSelected}},function(e){return{setParameter:function(t){return e(Object(c.n)(t))}}})(function(e){var t=e.macroToShow,n=e.setSelectedColor,s=e.setMacroToShow,c=e.setSelected,u=e.effect,l=e.setFilteredParameters,f=e.selected,h=e.filteredParameters,d=void 0===h?[]:h,p=e.setParameter,v=e.parameterSelected,m=e.expanded,y=e.isBoundsMode,b=e._parameters,g=Object(a.useState)(!1),O=Object(r.a)(g,2),j=O[0],k=O[1],w=Object(a.useState)(""),x=Object(r.a)(w,2),S=x[0],P=x[1];Object(a.useEffect)(function(){l(""===S?Object(o.a)(u._parameters):function(e,t){var n,r=[],a=Ht(e._parameters);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=[];i&&i.name&&(i.context&&(i.context.subDevice&&i.context.subDevice.name&&o.push(i.context.subDevice.name.toLowerCase()),i.context.effect&&i.context.effect.name&&o.push(i.context.effect.name.toLowerCase()),i.context.midiEffect&&i.context.midiEffect.name&&o.push(i.context.midiEffect.name.toLowerCase())),o.push(i.name.toLowerCase()),o.some(function(e){return e.includes(t.toLowerCase())})&&r.push(i))}}catch(s){a.e(s)}finally{a.f()}return r}(u,S)),c([])},[u,c,S,l,b]);var E=d.length>0?d:f,T=!1;E[0]&&E[0].isPlaneMacro&&(T=E[0],E=T.parameters),!T&&t&&(T=t);var A,M=[].concat(Object(o.a)(Zt(E)),[void 0]),R={},C=Gt(M);try{var N=function(){var e=A.value,t=E.filter(function(t){return t.hasGroup===e});if(0===t.length)return"continue";var n,r={},a=Gt(t);try{for(a.s();!(n=a.n()).done;){var i=n.value,o="Other";i.context&&(o=i.context.subDevice?i.context.subDevice.name:i.context.effect?i.context.effect.name:i.context.midiEffect?i.context.midiEffect.name:i.context.instrument?i.context.instrument.getName():i.context.lfoTrack?"LFO "+i.context.lfoTrack.lfo.number:"Other"),r[o]||(r[o]=[]),r[o].push(i)}}catch(s){a.e(s)}finally{a.f()}R[e?e.id:0]=r};for(C.s();!(A=C.n()).done;)N()}catch(I){C.e(I)}finally{C.f()}return j?i.a.createElement("div",{draggable:!0,onDragStart:function(e){return e.preventDefault()},onDragOver:function(e){return e.preventDefault()},className:"plane-sidebar hide"},i.a.createElement("div",{className:"sidebar-header"},i.a.createElement("div",{className:"collapse-toggle"},i.a.createElement("div",{onClick:function(){return k(!j)},className:j?"arrow-down":"arrow-right"})))):i.a.createElement("div",{draggable:!0,onDragStart:function(e){return e.preventDefault()},onDragOver:function(e){return e.preventDefault()},className:"plane-sidebar"},m?i.a.createElement("div",{className:"sidebar-header"},i.a.createElement("div",{className:"collapse-toggle"},i.a.createElement("div",{onClick:function(){return k(!j)},className:"arrow-right"}))):"",i.a.createElement("div",{className:"plane-search-container"},i.a.createElement("input",{value:S,onChange:function(e){return P(e.target.value)},type:"text",placeholder:"Search for parameters",className:"plane-search"}),i.a.createElement("div",{onClick:function(){return P("")},className:"clear-btn"},"x")),i.a.createElement("div",{className:"plane-results parameters-list"},T&&i.a.createElement(Bt,{setSelectedColor:n,macroToShow:t,setMacroToShow:s,macro:T}),Object.keys(R).map(function(e,t){return i.a.createElement("div",{key:e,className:"plane-param-group"},i.a.createElement("div",{className:"group-parameters-name"},i.a.createElement("div",{onClick:function(){return c("0"===e?E.filter(function(e){return!e.hasGroup}):E.filter(function(t){return t.hasGroup&&t.hasGroup.id===e}))},className:"group-thumb",style:{backgroundColor:"0"===e?"gray":Kt.getColorForHash(e)}}),i.a.createElement("div",null,"0"===e?"Not Grouped":"Group "+(u.groups.map(function(e){return e.id}).indexOf(e)+1))),i.a.createElement("div",{className:"group-parameters"},Object.keys(R[e]).map(function(t){return i.a.createElement(Qt,{key:t.id,setSelected:c,isBoundsMode:y,selected:f,setParameter:p,parameterSelected:v,device:t,parameters:R[e][t]})})))})))}),$t=Object(s.b)(function(e,t){return{selected:e.plane.selectedParameters[t.effect.id],filteredParameters:e.plane.filteredParameters[t.effect.id],macroToShow:e.plane.macroToShow[t.effect.id],isRegionMode:e.plane.regionMode[t.effect.id]}},function(e,t){return{setIsRegionMode:function(n){return e(Object(c.Rc)(t.effect.id,n))},setMacroToShow:function(n){return e(Object(c.Qc)(t.effect.id,n))},setSelected:function(n){return e(Object(c.zd)(t.effect.id,n))},setFilteredParameters:function(n){return e(Object(c.Eb)(t.effect.id,n))}}})(function(e){var t=e.effect,n=(e.setIsRegionMode,e.setMacroToShow),r=e.setSelected,a=e.setFilteredParameters,o=e.selected,s=void 0===o?[]:o,c=e.filteredParameters,u=e.macroToShow,l=e.isRegionMode;return i.a.createElement("div",{className:"plane-parameters"},i.a.createElement("div",{className:"plane-inner"},i.a.createElement(Yt,Object(T.a)({setSelectedColor:function(){return 0},macroToShow:u,setMacroToShow:n,isBoundsMode:l,setSelected:r,expanded:!1,filteredParameters:c,setFilteredParameters:a,selected:s,effect:t},"setSelected",r))))}),Xt=Object(s.b)(function(e,t){return{parametersDisabled:t.effect.parametersDisabled}},function(e){return{}})(function(e){var t=e.effect,n=e.i,r=e.parametersDisabled,s=r.includes(n),c="param-enabled-btn ";s&&(c+=" disabled");var u=Object(a.useCallback)(function(){var e;e=s?r.filter(function(e){return e!==n}):[].concat(Object(o.a)(r),[n]),t.parametersDisabledParameter.set(e,!1)},[r,s,t,n]);return i.a.createElement("div",{onClick:u,className:c})}),en=n(567),tn=Object(s.b)(function(e,t){return{depth:t.accumulator.getDepth(t.i)}},function(e){return{}})(function(e){var t=e.depth,n=e.i,o=e.parameter,s=e.accumulator,c=e.isDraggable,u=Object(a.useState)(void 0),l=Object(r.a)(u,2),f=l[0],h=l[1],d=Object(a.useState)(t),p=Object(r.a)(d,2),v=p[0],m=(p[1],Object(a.useRef)(void 0));Object(a.useCallback)(function(e){if("Enter"===e.key){var t=parseFloat(v);if(isNaN(t))return;s.depthParameters[n].set(t),h(!1)}},[h,n,o,v,s]);return Object(a.useEffect)(function(){m.current&&f&&(m.current.focus(),m.current.select())},[f]),i.a.createElement(en.a,{isDraggable:c,track:s.track,parameter:s.depthParameters[n],units:"%",stopPropagation:!1})}),nn=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.svgRef,n=e.points,r=n.x1,a=n.x2,o=n.y1,s=n.y2,c=(n.height1,n.width1),u=(n.height2,n.width2);if(t.current){var l=t.current.getBoundingClientRect();r-=l.left,a-=l.left,o-=l.top,s-=l.top}return i.a.createElement("polygon",{points:[r,o,a,s,a+u,s,r+c,o]})});window.testA=-15,window.testB=-5;n(1799);var rn=Object(a.memo)(function(e){e.edgesSize,e.edgesPadding;var t=e.scale,n=void 0===t?1:t,o=(e.editorPadding,e.scrollContainer),s=e.destinationPosition,u=e.parameter,l=(e.scrollHeight,e.sequencerEngine),f=e.fillSize,h=Object(a.useRef)();if(u&&u.context)u.context.subDevice||u.context.effect||u.context.midiEffect;var d=function(e,t,n,i){var o=Object(a.useState)(void 0),s=Object(r.a)(o,2),u=s[0],l=s[1],f=Object(a.useState)(void 0),h=Object(r.a)(f,2),d=h[0],p=h[1],v=Object(a.useState)(void 0),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useState)(void 0),O=Object(r.a)(g,2),j=O[0],k=O[1],w=Object(a.useState)(void 0),x=Object(r.a)(w,2),S=x[0],P=x[1],E=Object(a.useState)(void 0),T=Object(r.a)(E,2),A=T[0],M=T[1],R=Object(a.useCallback)(function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j;if(e&&e.context){var a=e.context&&e.context.track;a&&a.isEffectsShowing&&!a.isEffectsShowing()&&a.showEffects(!0);var i=e.isMapped;if(i&&i.track&&i.track.isEffectsShowing&&!i.track.isEffectsShowing()&&i.track.showEffects(!0),e.context.lfoTrack&&e.context.lfoTrack.sequencerEngine.dispatch(Object(c.Td)(!0)),A&&S){var o=A.getBoundingClientRect(),s=A.offsetHeight,u=o.width,f=o.left,h=o.top-s,p=S.getBoundingClientRect(),v=S.offsetHeight,m=p.width,y=p.left,b=p.top-v;t&&t.current.getBoundingClientRect();var g=!1;if(r&&r.className.includes("plane")){g=!0,b-=25;var O=r.getBoundingClientRect(),k=O.top;k>p.top?b+=k-p.top:k+O.height<p.top&&(b-=p.top-(k+O.height)-5)}g||(b+=v),b<=(h+=s)?b+=v:h+=s;var w=d&&d.getBoundingClientRect(),x=1e4;w&&(x=135+w.width);var P=Math.max(135,y);P>x&&(P=x,m=1),f>x&&(f=x,u=1),P+m>x&&(m=x-P);var E={x1:Math.max(135,f),y1:h,x2:P,y2:b,width1:f<135?10:u,width2:y<135?0:m,height1:s,height2:v};l(E)}else l(void 0)}},[e,l,p,S,A,j,n]);Object(a.useEffect)(function(){if(!e)return l(void 0),M(void 0),P(void 0),p(void 0),void(d&&d.removeEventListener("scroll",R));setTimeout(function(){var t=document.getElementById("parameter-"+e.id);I(t,p);var n=document.getElementById("accumulator-map-source");I(n,b);var r=N(n,k);M(t),P(n),R(void 0,r)},50)},[e,l,M,P,p,k,A,S,n]),Object(a.useEffect)(function(){return d&&d.addEventListener("scroll",R),function(){return d?d.removeEventListener("scroll",R):[]}},[l,e,d,S,A]),Object(a.useEffect)(function(){return j&&j.addEventListener("scroll",R),function(){return j?j.removeEventListener("scroll",R):[]}},[l,e,j,S,A]),Object(a.useEffect)(function(){R()},[i,e,l,S,A]),Object(a.useEffect)(function(){return y&&y!==d&&y.addEventListener("scroll",R),function(){return y&&y!==d?y.removeEventListener("scroll",R):[]}},[l,e,y,d,j,S,A,n]);var C=Object(a.useCallback)(function(e,t,n,r){for(var a=0;e&&a<30;){if(void 0===e.className)return;if(e.className.includes(t)&&(!n||!e.className.includes(n)))break;e=e.parentNode,a++}if(e&&e.className.includes(t))return r(e),e},[b,p]),N=Object(a.useCallback)(function(e,t){return C(e,"parameters-list",void 0,t)},[b]),I=Object(a.useCallback)(function(e,t){return C(e,"effects-view","instrument-rack",t)},[b,p]);return u}(u,o,n,s);return Object(a.useEffect)(function(){if(f)return h.current.style.width=o.current.offsetWidth,void(h.current.style.height=o.current.offsetHeight);var e=l.state.spatial,t=e.edgesSize,n=(e.editorPadding,e.edgesPadding);h.current.style.width=t.width+"px",h.current.style.height=t.height+"px",h.current.style.minWidth=t.width+"px",h.current.style.minHeight=t.height+"px",h.current.style.left=n.x,h.current.style.top=n.y},[d]),i.a.createElement("svg",{style:{},ref:h,className:"parameter-link-visualizer"},d&&i.a.createElement(nn,{points:d,svgRef:h}))}),an=(Object(s.b)(function(e,t){var n,r=e.effects.accumulatorParameterSelected;if(r&&r.context){var a=r.context.subDevice||r.context.effect||r.context.midiEffect;a&&(n=e.windows.windowPositions[a.id])}return{destinationPosition:n,parameter:r}},function(e){return{}})(rn),function(e){var t=e.ref;e.effect;return{preventDragging:function(e){for(var n=t.current.parentNode,r=0;r<20&&n;r++)!n.className||!n.className.includes("effect")||n.className.includes("inner-effect")||n.className.includes("effects-view")||n.className.includes("effect-rack")||n.setAttribute("draggable",e),n=n.parentNode}}}),on=Object(s.b)(function(e,t){return{isMacroMapping:e.effects.isMacroMapping}},function(e){return{setParameterToMap:function(t){return e(Object(c.Ic)(t))},setIsMacroMapping:function(t){return e(Object(c.Nb)(t))}}})(function(e){e.track;var t=e.isMacroMapping,n=e.setIsMacroMapping,r=e.onClick,a=e.setParameterToMap,o=e.label,s="macro-map-button";return t&&(s+=" mapping"),i.a.createElement("div",{onClick:function(e){e.stopPropagation();var i=!t;a(void 0),n(i),r&&r(i)},className:s},o||"Map")});function sn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return cn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function cn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var un=function(e){var t=e.setAccumulatorParameterSelected,n=e.parameter,r=e.parameterSelected,o=Object(a.useRef)(void 0),s=n===r;return i.a.createElement("div",{ref:o,id:s?"accumulator-map-source":"",onClick:function(){return t(s?void 0:n)},className:s?"selected mapped-parameter":"mapped-parameter"},n.name)},ln=Object(s.b)(function(e,t){var n,r={isSelected:e.effects.selectedEffect===t.effect.id,isMapping:e.effects.isMacroMapping,parameterToMap:e.effects.isMacroMapping&&e.effects.parameterToMap,parameterSelected:e.effects.accumulatorParameterSelected},a=sn(t.effect._parameters);try{for(a.s();!(n=a.n()).done;){var i=n.value;i&&(r[i.id]=i.get(!0))}}catch(o){a.e(o)}finally{a.f()}return r},function(e){return{setIsMacroMapping:function(t){return e(Object(c.Nb)(t))},setAccumulatorParameterSelected:function(t){return e(Object(c.n)(t))}}})(function(e){var t=e.isDraggable,n=e.i,o=e.onMapped,s=e.effect,c=e.isMapping,u=e.parameterToMap,l=e.isSelected,f=e.setIsMacroMapping,h=e.parameterSelected,d=e.label,p=e.setAccumulatorParameterSelected,v=e.skipSelected,m=Object(a.useState)(!1),y=Object(r.a)(m,2),b=y[0],g=y[1],O=Object(a.useRef)(void 0),j=an({ref:O}).preventDragging,k=Object(a.useCallback)(function(){s.unmapParameter(n),o()},[n]);Object(a.useEffect)(function(){b&&p(void 0)},[b]),Object(a.useEffect)(function(){c&&u&&b&&s._parameters[n]!==u&&(s.setParameter(u,n),o(),f(!1),v||p(u),g(!1))},[c,u,l,b,n,o,g]),Object(a.useEffect)(function(){return function(){p(void 0),f(!1)}},[]);var w="accumulator-mapper";return b&&(w+=" mapping"),c&&!b&&(w+=" disable"),i.a.createElement("div",{onMouseDown:function(){return t&&j(!1)},onMouseUp:function(){return t&&j(!0)},ref:O,className:w},i.a.createElement(on,{label:d,onClick:g}),s._parameters[n]&&i.a.createElement(Xt,{i:n,effect:s}),s._parameters[n]&&i.a.createElement(un,{parameterSelected:h,setAccumulatorParameterSelected:p,parameter:s._parameters[n]}),s._parameters[n]&&i.a.createElement("div",{className:"acc-parameter-value"},s._parameters[n].get(!0)),s._parameters[n]&&i.a.createElement(tn,{isDraggable:t,accumulator:s,i:n,parameter:s._parameters[n]}),s._parameters[n]&&i.a.createElement("div",{onClick:k,className:"delete-parameter-btn"},"x"))}),fn=(n(1800),new Ot.a),hn=Object(s.b)(function(e,t){return{selected:e.plane.selectedParameters[t.params.plane.id],isRegionMode:e.plane.regionMode[t.params.plane.id],planeMapping:e.effects.planeMapping,parameterSelected:e.effects.accumulatorParameterSelected,parameters:t.params.plane._parameters}},function(e,t){return{setIsRegionMode:function(n){return e(Object(c.Rc)(t.params.plane.id,n))},setPlaneMapping:function(t){return e(Object(c.Tc)(t))},setSelected:function(n){return e(Object(c.zd)(t.params.plane.id,n))},setFilteredParameters:function(n){return e(Object(c.Eb)(t.params.plane.id,n))}}})(function(e){var t=e.params,n=e.setSelected,o=e.parameterSelected,s=e.selected,c=e.planeMapping,u=e.setPlaneMapping,l=e.setFilteredParameters,f=e.setIsRegionMode,h=e.isRegionMode,d=e.parameters,p=Object(a.useRef)(),v=Object(a.useState)(!1),m=Object(r.a)(v,2),y=m[0],b=m[1];Ze(p),Object(a.useEffect)(function(){o&&n([o])},[o]);var g=Object(a.useCallback)(function(){s&&s.forEach(function(e){var n=t.plane._parameters.indexOf(e);t.plane.unmapParameter(n)}),n([])},[s,n]),O=Object(a.useCallback)(function(){if(console.log("selected =",s),s&&s[0]){var e=t.zObject.windowPosition,r=e.x,a=e.y;t.subSequence.createZObject(r-300,a,"param "+s.map(function(e){return e.id}).join(" "))}n([])},[s,n]);return i.a.createElement("div",{ref:p,className:"params-group"},i.a.createElement("div",{className:"map-buttons"},i.a.createElement(ln,{onMapped:function(){return[]},effect:t.plane,skipSelected:!0,label:"map params"}),i.a.createElement("div",{onClick:function(e){e.stopPropagation(),u(c?void 0:t.plane)},className:c?"mappy-btn mapping":"mappy-btn"},"map device")),i.a.createElement("div",{className:"p-toolbar"},s&&s.length>0&&i.a.createElement("div",{onClick:g,className:"unmap-button"},"unmap (",s.length,")",i.a.createElement("div",{style:{backgroundColor:fn.getColorForHash(s[0].name)},className:"dot"})),s&&s.length>0&&i.a.createElement("div",{onClick:function(){return f(!h)},className:h?"unmap-button selected":"unmap-button"},"bounds"),s&&s.length>0&&i.a.createElement("div",{onClick:O,className:"unmap-button"},"create node (",s.length,")")),i.a.createElement("div",{className:"p-tabs"},i.a.createElement("div",{onClick:function(){l(void 0),y&&n([]),b(!y)},className:y?"show tab":"tab"},i.a.createElement("div",{className:"tab-left"}),i.a.createElement("div",{className:"name"},i.a.createElement("img",{src:"/search-icon.svg"})),i.a.createElement("div",{className:"tab-right"})),i.a.createElement("div",{className:"parameters-count"},d.length,i.a.createElement("div",{className:"hollow-dot"}))),y&&i.a.createElement($t,{effect:t.plane}))}),dn=function(e){var t=e.x1,n=e.y1,r=e.x2,a=e.y2;return Math.sqrt(Math.pow(r-t,2)+Math.pow(a-n,2))},pn=n(16);function vn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return mn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function mn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function yn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return bn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function bn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var gn=0,On=function(e){var t=e.ref,n=e.effect,i=e.setEffectParameterValues,s=e.filteredParameters,c=e.isRegionMode,u=e.isDensitiesMode,l=e.setDensities,f=e.setSelectedDensity,h=e.macroToShow,d=e.setSelected,p=e.selected,v=Object(a.useRef)(0),m=Object(a.useState)(!1),y=Object(r.a)(m,2),b=y[0],g=y[1],O=n.track.sequencerEngine,j=Object(a.useState)(void 0),k=Object(r.a)(j,2),w=k[0],x=k[1],S=Object(a.useState)(void 0),P=Object(r.a)(S,2),E=P[0],T=P[1],A=Object(a.useCallback)(function(e){var n=t.current.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}},[t]),M=Object(a.useCallback)(function(e){e.stopPropagation();var t=A(e),r=t.x,a=t.y;b?n.setPencil(r,a):x({x1:r,y1:a,x2:r,y2:a})},[x,d,b]),R=Object(a.useCallback)(function(e){if(b)n.setPencil(null,null);else{if(w){if(w.x1!==w.x2&&w.y1!==w.y2){if(u){var t=dn(w);if(!isNaN(w.x1)&&!isNaN(w.y1)){var r=n.newRegion(w.x1,w.y1,t);l(n.regions),f(r)}}if(c){var a,i=w.x1,v=w.x2,m=w.y1,y=w.y2,g=yn(p);try{for(g.s();!(a=g.n()).done;){var j=a.value,k=j.originalMin+(j.originalMax-j.originalMin)*(i/pn.c),S=j.originalMin+(j.originalMax-j.originalMin)*(v/pn.c);j.min=k,j.max=S,(j.get(!0)<k||j.get(!0)>S)&&j.set(k+.1*(S-k));var P=j.depthParameter;if(P){var A=P.originalMin+(P.originalMax-P.originalMin)*(m/pn.a),M=P.originalMin+(P.originalMax-P.originalMin)*(y/pn.a);P.min=A,P.max=M,(P.get(!0)<A||P.get(!0)>M)&&(j.depth=A+.1*(M-A))}}}catch(C){g.e(C)}finally{g.f()}return d(Object(o.a)(p)),x(void 0),void(E&&T(void 0))}var R=function(e,t,n,r){var a,i=[],o=e.x1,s=e.x2,c=e.y1,u=e.y2,l=(Math.min(o,s),Math.min(c,u),vn(n||t._parameters));try{for(l.s();!(a=l.n()).done;){var f=a.value;if(!f.planeMacro||f.planeMacro===r){var h=f.getCoordinates(pn.c,pn.a,pn.b),d=h.x,p=h.y;d>=o&&d<=s&&p>=c&&p<=u&&i.push(f)}}}catch(C){l.e(C)}finally{l.f()}return i}(w,n,s,h);O.state.keyboard.isCommandDown?d([].concat(Object(o.a)(p),Object(o.a)(R))):d(R)}else E||d([]);x(void 0)}E&&T(void 0)}},[b,h,l,f,c,u,x,w,p,d,T,E,s,p]),C=Object(a.useCallback)(function(e,t){if(e.preventDefault(),!b){var r=(new Date).getTime();if(p.includes(t)){if(r-v.current<=380)if(1===p.length)if(t.planeMacro)d([t]);else{var a=n.getGroupForParameter(t);d(a?Object(o.a)(a._parameters):[t])}else d([t])}else{n.getGroupForParameter(t);t.planeMacro,d([t])}v.current=r,T(A(e))}},[T,p,d,b]);Object(a.useEffect)(function(){return window.isNFT&&window.addEventListener("mousemove",N),function(){window.isNFT&&window.removeEventListener("mousemove",N)}},[w,x,E,p,T,b]);var N=Object(a.useCallback)(function(e){var t=A(e),r=t.x,a=t.y;if(!window.isNFT||O.playing)if(window.isNFT&&b&&!n.pencilXParameter.get(!0)&&n.setPencil(r,a),b&&n.pencilXParameter.get(!0)&&n.pencilYParameter.get(!0)){if(gn++,window.isNFT){var o=gn;setTimeout(function(){o===gn&&n.setPencil(null,null)},1e3)}parseFloat;var s=n.pencilXParameter.get(!0),c=n.pencilYParameter.get(!0);dn({x1:r,y1:a,x2:s,y2:c})>12&&n.setPencil(r,a)}else if(E){var u=r-E.x,l=a-E.y,f=Math.abs;if(f(u)<=2&&f(l)<=2)return;var h,d={},v=((new Date).getTime(),yn(p));try{for(v.s();!(h=v.n()).done;){var m=h.value;if(!m.locked2D)if(m.isPlaneMacro)m.moveCoordinates(u,l);else{var y=m.moveCoordinates(u,l),g=y.id,j=y.value;d[g]=j}}}catch(k){v.e(k)}finally{v.f()}(new Date).getTime();i(d),T({x:r,y:a}),n.sendMacroMessages()}else x(Object(ot.a)({},w,{x2:r,y2:a}))},[w,x,E,p,T,b]);return{startDragging:C,onMouseDown:M,onMouseUp:R,onMouseMove:N,selection:w,selected:p,setSelected:d,setDrawMode:g,drawMode:b}},jn=n(413),kn=n(166);function wn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return xn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function xn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Sn=function(e,t){return{drawForces:function(t){for(var n=e.groups.flatMap(function(e){return e.variables.filter(function(e){return e.name.includes("force")})}),r=n.length/4,a=[],i=function(e){var r=n.filter(function(t){return t.name.includes(new String(e))}),i=r.find(function(e){return e.name.includes("force.x")}).get(),o=pn.a-r.find(function(e){return e.name.includes("force.y")}).get(),s=r.find(function(e){return e.name.includes("force.dx")}).get(),c=-1*r.find(function(e){return e.name.includes("force.dy")}).get(),u=i+(s*=.25),l=o+(c*=.25);t.beginPath(),t.strokeStyle="white",t.lineWidth=2,function(e,t,n,r,a){var i=r-t,o=a-n,s=Math.atan2(o,i);e.moveTo(t,n),e.lineTo(r,a),e.lineTo(r-10*Math.cos(s-Math.PI/6),a-10*Math.sin(s-Math.PI/6)),e.moveTo(r,a),e.lineTo(r-10*Math.cos(s+Math.PI/6),a-10*Math.sin(s+Math.PI/6))}(t,i,o,u,l),t.stroke();var f=new Path2D;f.arc(i,o,5,0,2*Math.PI),t.fillStyle="white",t.fill(f);var h=new Path2D;h.arc(u,l,14,0,2*Math.PI),t.fillStyle="transparent",t.fill(h),a.push({start:f,end:h})},o=1;o<=r;o++)i(o);return a},getForceParameters:function(t){var n=e.groups.flatMap(function(e){return e.variables.filter(function(e){return e.name.includes("force")})}).filter(function(e){return e.name.includes(new String(t))}),r=n.find(function(e){return e.name.includes("force.x")}),a=n.find(function(e){return e.name.includes("force.y")}),i=n.find(function(e){return e.name.includes("force.dx")}),o=n.find(function(e){return e.name.includes("force.dy")});return[r,a,i,o]}}};function Pn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return En(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return En(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function En(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Tn=Object(s.b)(function(e,t){var n,r="",a=Pn(t.effect.groups);try{for(a.s();!(n=a.n()).done;){var i,o=Pn(n.value.variables);try{for(o.s();!(i=o.n()).done;){var s=i.value;r+=s.name+","+s.get()}}catch(c){o.e(c)}finally{o.f()}}}catch(c){a.e(c)}finally{a.f()}return{forces:r}},null)(function(e){var t=e.onClick,n=e.onMouseMove,r=e.onMouseUp,o=e.onMouseDown,s=e.forcePaths,c=(e.effect,e.forces),u=e.drawForces,l=Object(a.useRef)(void 0),f=Object(a.useRef)(void 0);Object(a.useEffect)(function(){f.current=l.current.getContext("2d"),f.current.scale(window.devicePixelRatio,window.devicePixelRatio)},[]),Object(a.useEffect)(function(){f.current&&window.requestAnimationFrame(h)},[c]);var h=Object(a.useCallback)(function(){f.current.clearRect(0,0,pn.c,pn.a),s.current=u(f.current)},[]),d={height:pn.a,width:pn.c};return i.a.createElement("canvas",{style:d,onClick:t,onMouseMove:n,onMouseUp:r,onMouseDown:o,ref:l,width:window.devicePixelRatio*pn.c,height:window.devicePixelRatio*pn.a,className:"force-drawer"})});function An(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Mn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Mn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Rn,Cn=Object(s.b)(function(e,t){return{parameterMinMax:e.effects.parameterMinMax}},function(e){return{}})(function(e){var t=Object(a.useRef)(void 0),n=Object(a.useRef)(void 0);Object(a.useEffect)(function(){n.current=t.current.getContext("2d"),n.current.scale(window.devicePixelRatio,window.devicePixelRatio)},[]),Object(a.useEffect)(function(){window.requestAnimationFrame(r)},[e.isRegionMode,e.parameterMinMax,e.selected]);var r=Object(a.useCallback)(function(){if(n.current){var t=n.current;if(t.clearRect(0,0,pn.c,pn.a),e.isRegionMode){var r,a=An(e.selected.flatMap(function(e){return e.isPlaneMacro?e.parameters:e}));try{for(a.s();!(r=a.n()).done;){var i=r.value,o=i.min,s=i.max,c=i.originalMin,u=i.originalMax,l=i.depthParameter;t.strokeStyle="#00a4ff",t.fillStyle="#23757b4f",t.setLineDash([3]),t.lineWidth=1;var f=pn.c*(o-c)/(u-c),h=l?pn.a*(l.min-l.originalMin)/(l.originalMax-l.originalMin):0,d=l?pn.a*(l.max-l.min)/(l.originalMax-l.originalMin):pn.a,p=pn.c*(s-o)/(u-c);t.fillRect(f,h,p,d),t.strokeRect(f,h,p,d)}}catch(v){a.e(v)}finally{a.f()}}}},[e.isRegionMode,e.parameterMinMax,e.parameters,e.selected]);return i.a.createElement("canvas",{style:{width:pn.c,height:pn.a},width:window.devicePixelRatio*pn.c,height:window.devicePixelRatio*pn.a,className:"canvas-regions",ref:t})});Float32Array.BYTES_PER_ARRAY;new Ot.a;var Nn=function(e,t,n){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);var r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,t),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)||console.log("An error occurred compiling the shaders:"+e.getShaderInfoLog(r));var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,n),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)||console.log("An error occurred compiling the shaders:"+e.getShaderInfoLog(a));var i=e.createProgram();return e.attachShader(i,r),e.attachShader(i,a),e.linkProgram(i),i},In=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=Object(a.useRef)(void 0),n=Object(a.useRef)(void 0),r=Object(a.useRef)(void 0),o=Object(a.useRef)(void 0),s=Object(a.useRef)(void 0),c=Object(a.useRef)(void 0);Object(a.useEffect)(function(){n.current=t.current.getContext("webgl",{preserveDrawingBuffer:!0});var e=n.current;r.current=function(e){var t=(10*pn.c/600).toFixed(1);return console.log("pointSize = ",t),Nn(e,["precision mediump float;","attribute vec4 aPosition;","attribute float vertColor;","varying float fragColor;","void main() {","gl_PointSize = ".concat(t,";"),"gl_Position = aPosition;","fragColor = vertColor;","}"].join("\n"),["precision mediump float;","varying float fragColor;","void main() {","gl_FragColor = vec4(1,1,1,0.1*fragColor);","}"].join("\n"))}(e),o.current=function(e){return Nn(e,"\nprecision mediump float;\nattribute vec4 a_position;\nvoid main() {\n   gl_Position = a_position;\n}\n","\nprecision mediump float;\n\nuniform vec4 u_color;\n\nvoid main() {\n   gl_FragColor = u_color;\n}\n")}(e),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0)},[]),Object(a.useEffect)(function(){u()},[e.coords]);var u=Object(a.useCallback)(function(){var a=n.current;if(a&&r.current&&(a.clear(a.COLOR_BUFFER_BIT),e.effect.D)){a.useProgram(r.current);var i=function(e,t,n,r,a,i,o){if(i.current)e.bindBuffer(e.ARRAY_BUFFER,i.current),e.bufferData(e.ARRAY_BUFFER,Rn,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,o.current),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW);else{i.current=e.createBuffer(),Rn=new Float32Array(new Array(r.length).fill(0).flatMap(function(e,t){var n=t%66;return[n/64*2-1,2*(1-(t-n)/66/64)-1]})),e.bindBuffer(e.ARRAY_BUFFER,i.current),e.bufferData(e.ARRAY_BUFFER,Rn,e.STATIC_DRAW);var s=e.getAttribLocation(t,"aPosition");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),o.current=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,o.current),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW);var c=e.getAttribLocation(t,"vertColor");e.enableVertexAttribArray(c),e.vertexAttribPointer(c,1,e.FLOAT,!1,0,0)}return r.length}(a,r.current,t.current,e.effect.D,e.effect,s,c);a.drawArrays(a.POINTS,0,i)}},[]);return i.a.createElement("canvas",{style:{width:pn.c,height:pn.a},width:pn.c,height:pn.a,className:"canvas-shader",ref:t})});function qn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return _n(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _n(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Dn=new Ot.a;window.blur=6,window.macroOpacity=.7,window.r=50,window.g=55,window.b=65;var Fn=function(e){var t=e.ctxt,n=e.gradientColor,r=e.macroPaths,s=e.paths,c=(e.forcePaths,e.splineTension),u=e.blur,l=(e.setMacroToShow,e.macroToShow),f=e.parameters,h=e.selection,d=(e.startDragging,e.coords),p=e.effect,v=(e.setEffectParameterValues,Object(kn.a)(e,["ctxt","gradientColor","macroPaths","paths","forcePaths","splineTension","blur","setMacroToShow","macroToShow","parameters","selection","startDragging","coords","effect","setEffectParameterValues"])),m=Object(a.useRef)(void 0),y=Object(a.useRef)(pn.c),b=Object(a.useRef)(pn.a);Object(a.useEffect)(function(){t.current=m.current.getContext("2d"),t.current.scale(window.devicePixelRatio,window.devicePixelRatio)},[]),Object(a.useEffect)(function(){pn.c!==y.current&&(t.current.scale(window.devicePixelRatio,window.devicePixelRatio),y.current=pn.c,b.current=pn.a)},[pn.c,pn.a]),Object(a.useEffect)(function(){t.current&&window.requestAnimationFrame(g)},[c,n,v.selectedColor,d,f,l,v.filteredParameters,v.isRegionMode]);var g=Object(a.useCallback)(function(){var e=t.current;if(e.clearRect(0,0,pn.c,pn.a),h&&(e.fillStyle="#b00909",e.fillRect(h.x1,h.y1,Math.abs(h.x2-h.x1),Math.abs(h.y2-h.y1))),!v.filteredParameters||0===v.filteredParameters.length){var a,i=qn(p.groups);try{for(i.s();!(a=i.n()).done;){var c=a.value,u=c._parameters.filter(function(e){return!e.planeMacro}),m=Array.from(new Set(c._parameters.filter(function(e){return e.planeMacro}).map(function(e){return e.planeMacro}))),y=u.map(function(e){return e.getCoordinates()}),b="M "+(y=[].concat(Object(o.a)(y),Object(o.a)(m.map(function(e){return e.coordinates})))).map(function(e){return e.x+" "+e.y}).join(", "),g=new Path2D(b);e.setLineDash([1]),e.strokeStyle=Dn.transparent(Dn.saturate(Dn.getColorForHash(c.id),2),.6),e.stroke(g)}}catch(B){i.e(B)}finally{i.f()}}e.setLineDash([]);var O,j=v.selected||[],k=qn([].concat(Object(o.a)(p.macros.filter(function(e){return!j.includes(e)})),Object(o.a)(j.filter(function(e){return p.macros.includes(e)}))));try{for(k.s();!(O=k.n()).done;){var w=O.value,x=w.getEasyBlob(),S=x.x,P=x.y,E=x.diameter,T=x.d,A=new Path2D(T),M=w.color;if(n){var R=e.createRadialGradient(S,P,E,S+15,P+40,5);R.addColorStop(0,n),R.addColorStop(1,Dn.transparent(Dn.saturate(M,2),v.isFiltered?.1:window.macroOpacity)),e.fillStyle=R}else e.fillStyle=Dn.transparent(Dn.saturate(M,2),v.isFiltered?.1:window.macroOpacity);e.fill(A),(l===w||j.includes(w))&&(e.setLineDash([3]),e.lineWidth=1,e.strokeStyle="white",e.stroke(A)),r.current[w.id]=A}}catch(B){k.e(B)}finally{k.f()}var C,N=qn(f);try{for(N.s();!(C=N.n()).done;){var I=C.value,q=I.id;if(d[q]){var _=d[q],D=_.x,F=_.y,L=new Path2D;L.arc(D,F,7,0,2*Math.PI),j.includes(I)?(e.lineWidth=2,e.strokeStyle=Dn.getColorForHash(I.name),e.stroke(L),e.fillStyle="black"):e.fillStyle=Dn.getColorForHash(I.name),e.fill(L),s.current[q]=L}}}catch(B){N.e(B)}finally{N.f()}},[v.selected,n,d,f,l,v.filteredParameters,v.isRegionMode]),O={width:pn.c,height:pn.a};return u>0&&(O.filter="blur(".concat(u,"px)")),i.a.createElement("canvas",{style:O,className:"canvas-drawer",width:window.devicePixelRatio*pn.c,height:window.devicePixelRatio*pn.a,ref:m})},Ln=Object(s.b)(function(e,t){return{gradientColor:e.plane.gradientColors[t.effect.id],splineTension:t.effect.splineTension}},function(e){return{}})(function(e){var t=e.isRegionMode,n=e.selectedColor,s=e.setMacroToShow,c=e.startDragging,u=e.coords,l=e.filteredParameters,f=e.parameters,h=e.macroToShow,d=e.setParameterMinMax,p=e.setEffectParameterValues,v=e.containerRef,m=e.effect,y=e.selected,b=e.selection,g=e.parameterSelected,O=e.sequencerEngine,j=e.macros,k=e.splineTension,w=Object(kn.a)(e,["isRegionMode","selectedColor","setMacroToShow","startDragging","coords","filteredParameters","parameters","macroToShow","setParameterMinMax","setEffectParameterValues","containerRef","effect","selected","selection","parameterSelected","sequencerEngine","macros","splineTension"]),x=Object(a.useRef)(void 0),S=Object(a.useRef)([]),P=Object(a.useRef)({}),E=Object(a.useRef)({}),T=Sn(m),A=T.drawForces,M=T.getForceParameters,R=function(e){var t=e.forcePaths,n=e.effect,i=e.containerRef,s=e.ctxt,c=e.selected,u=void 0===c?[]:c,l=e.startDragging,f=e.parameters,h=e.paths,d=e.macroPaths,p=e.setMacroToShow,v=e.setEffectParameterValues,m=e.getForceParameters,y=Object(a.useRef)(void 0),b=Object(a.useState)(void 0),g=Object(r.a)(b,2),O=g[0],j=g[1],k=Object(a.useState)(void 0),w=Object(r.a)(k,2),x=w[0],S=w[1],P=Object(a.useCallback)(function(e){var r,a=i.current.getBoundingClientRect(),c=2*(e.clientX-a.left),p=2*(e.clientY-a.top),v=1,m=wn(t.current);try{for(m.s();!(r=m.n()).done;){var y=r.value,b=y.start,g=y.end;if(s.current.isPointInPath(b,c,p))return e.stopPropagation(),void j(v);if(s.current.isPointInPath(g,c,p))return e.stopPropagation(),void S(v);v++}}catch(E){m.e(E)}finally{m.f()}for(var O=[].concat(Object(o.a)(u.filter(function(e){return n.macros.includes(e)})),Object(o.a)(n.macros.filter(function(e){return!u.includes(e)}))),k=0,w=[].concat(Object(o.a)(f),Object(o.a)(O));k<w.length;k++){var x=w[k],P=h.current[x.id]||d.current[x.id];if(P&&s.current.isPointInPath(P,c,p)){l(e,x);break}}},[l,f,j,S]),E=Object(a.useCallback)(function(e){var t,r=i.current.getBoundingClientRect(),a=2*(e.clientX-r.left),c=2*(e.clientY-r.top),l=wn([].concat(Object(o.a)(u.filter(function(e){return n.macros.includes(e)})),Object(o.a)(n.macros.filter(function(e){return!u.includes(e)}))));try{for(l.s();!(t=l.n()).done;){var f=t.value,h=d.current[f.id];if(h&&s.current.isPointInPath(h,a,c)){var v=(new Date).getTime();return v-y.current<=250&&p(f),void(y.current=v)}}}catch(m){l.e(m)}finally{l.f()}},[p]),T=Object(a.useCallback)(function(){j(void 0),S(void 0)},[j,S]);return{onMouseMove:Object(a.useCallback)(function(e){if(void 0!==O||void 0!==x){var t=i.current.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top,o={};if(void 0!==O){var s=m(O),c=Object(r.a)(s,4),u=c[0],l=c[1],f=c[2],h=c[3],d=u.get()+.25*f.get(),p=l.get()+.25*h.get(),y=n,b=pn.a-a,g=d-y,j=p-b;o[u.id]=u.set(y,!1,!0).value,o[l.id]=l.set(b,!1,!0).value,o[f.id]=f.set(4*g,!1,!0).value,o[h.id]=h.set(4*j,!1,!0).value}else{var k=m(x),w=Object(r.a)(k,4),S=w[0],P=w[1],E=w[2],T=w[3],A=[S.get(),pn.a-P.get()],M=4*(n-A[0]),R=-4*(a-A[1]);o[E.id]=E.set(M,!1,!0).value,o[T.id]=T.set(R,!1,!0).value}v(o)}},[O,x]),onMouseUp:T,onMouseDown:P,onClick:E}}({forcePaths:S,effect:m,containerRef:v,ctxt:x,selected:y,startDragging:c,parameters:f,paths:P,macroPaths:E,setMacroToShow:s,setEffectParameterValues:p,getForceParameters:M}),C=R.onClick,N=R.onMouseMove,I=R.onMouseUp,q=R.onMouseDown;return[i.a.createElement(Cn,{selected:y,isRegionMode:t}),i.a.createElement(Fn,Object.assign({drawForces:A,getForceParameters:M,forcePaths:S,splineTension:k,ctxt:x,paths:P,macroPaths:E,blur:w.blur,selectedColor:n,setMacroToShow:s,startDragging:c,coords:u,filteredParameters:l,parameters:f,gradientColor:w.gradientColor,macroToShow:h,isFiltered:void 0!==l,setParameterMinMax:d,effect:m,parameterSelected:g,setEffectParameterValues:p,containerRef:v,selected:y,selection:b,sequencerEngine:O,macros:j},w)),i.a.createElement(In,{coords:u,effect:m}),i.a.createElement(Tn,{drawForces:A,forcePaths:S,onClick:C,onMouseMove:N,onMouseUp:I,onMouseDown:q,effect:m})]}),Bn=Object(s.b)(function(e,t){var n=t.graphics.graphics,r={isRegionMode:e.plane.regionMode[n.id]};return n._parameters.map(function(e){return r[e.id]=e.get()}),n._parameters.map(function(e){return r[e.id+"depth"]=e.depth}),r},function(e,t){return{}})(function(e){var t=e.graphics,n=e.isRegionMode,r=e.parameterSelected,o=e.setSelected,s=e._graphics,c=e.setEffectParameterValues,u=e.selected,l=e.filteredParameters,f=Object(kn.a)(e,["graphics","isRegionMode","parameterSelected","setSelected","_graphics","setEffectParameterValues","selected","filteredParameters"]),h=Object(a.useRef)();s.track=t;var d=On({ref:h,setSelectedDensity:function(){return 0},selected:u||[],setSelected:o,setDensities:function(){return 0},effect:s,setEffectParameterValues:c,filteredParameters:l,isRegionMode:n,isDensitiesMode:!1,macroToShow:void 0}),p=(d.setDrawMode,d.drawMode,d.selection),v=d.startDragging,m=d.onMouseDown,y=d.onMouseMove,b=d.onMouseUp,g=l||s._parameters,O={};return Object(jn.a)(g).forEach(function(e,t){return O[g[t].id]=e}),i.a.createElement("div",{onMouseDown:m,onMouseUp:b,onMouseMove:y,ref:h,className:"canvas-manager"},s&&i.a.createElement(Ln,Object.assign({blur:0,selectedColor:"#ffffff",startDragging:v,coords:O,filteredParameters:l,parameters:g,setParameterMinMax:function(){return 0},effect:s,parameterSelected:r,setEffectParameterValues:c,containerRef:h,selected:u,selection:p,sequencerEngine:t.sequencerEngine,isRegionMode:n,macros:[]},f)))}),zn=Object(s.b)(function(e,t){if(!t.graphics.graphics)return{};var n=t.graphics.graphics;return Object(T.a)({_graphics:t.graphics.graphics,filteredParameters:e.plane.filteredParameters[n.id],selected:e.plane.selectedParameters[n.id],parameterSelected:e.effects.accumulatorParameterSelected},"parameterSelected",e.effects.accumulatorParameterSelected)},function(e,t){return{setSelected:function(n){return e(Object(c.zd)(t.graphics.graphics.id,n))},setEffectParameterValues:function(t){return e(Object(c.xb)(t))}}})(function(e){return e._graphics?i.a.createElement("div",{className:"p-graphics-component"},i.a.createElement(Bn,e)):""}),Jn=n(61),Vn=n(170),Hn=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.cell,n="";switch(t.type||t){case Jn.b:n=i.a.createElement("div",{className:"symbol dot"});break;case Jn.a:n=i.a.createElement("div",{className:"symbol dash"});break;case Jn.c:n=i.a.createElement("div",{className:"symbol pulse"});break;case!1:break;default:var r=t.type||t;n=i.a.createElement("div",{className:"symbol "+r.toLowerCase()})}return n}),Un=n(150),Gn=[Vn.k,Vn.h,Vn.i,Vn.j,Vn.c,Vn.d],Wn={};Wn[Jn.b]="Dot",Wn[Jn.a]="Dash",Wn[Jn.c]="Pulse",Wn[Vn.a.type]="Accent",Wn[Vn.m.type]="Staccato",Wn[Vn.e.type]="Legato",Wn[Vn.i.type]="Piano (soft)",Wn[Vn.j.type]="Default strength",Wn[Vn.h.type]="Pianissimo (softest)",Wn[Vn.k.type]="Rest (doesnt play)",Wn[Vn.c.type]="Double (play faster)",Wn[Vn.d.type]="2 notes almost at the same time",Wn[Vn.g.type]="Nudge forward",Wn[Vn.f.type]="Nudge backwarrd";var Kn=function(e){var t=e.option,n=e.mode,o=e.setMode,s=e.noTooltip,c=Object(a.useState)(!1),u=Object(r.a)(c,2),l=u[0],f=u[1],h="option ";t===n&&(h+=" selected"),h+=" "+(t===Jn.b?"dot":t===Jn.a?"dash":t===Jn.c?"pulse":t.type);var d=i.a.createElement(Hn,{cell:t});return i.a.createElement("div",{onMouseOver:function(){return f(!0)},onMouseLeave:function(){return f(!1)},className:h,onClick:function(){return o(t)}},d,!s&&l&&i.a.createElement("div",{className:"option-tooltip"},Wn[t.type||t]))},Qn=function(e){var t=e.mode,n=e.setMode,o=Object(a.useState)(!1),s=Object(r.a)(o,2),c=s[0],u=s[1];return Object(a.useEffect)(function(){Gn.includes(t)||u(!1)},[t,u]),i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},className:"grid-toolbar"},i.a.createElement(Kn,{option:Jn.b,mode:t,setMode:n}),i.a.createElement(Kn,{option:Jn.a,mode:t,setMode:n}),i.a.createElement(Kn,{option:Jn.c,mode:t,setMode:n}),i.a.createElement(Kn,{option:Vn.a,mode:t,setMode:n}),i.a.createElement(Kn,{option:Vn.m,mode:t,setMode:n}),i.a.createElement(Kn,{option:Vn.e,mode:t,setMode:n}),i.a.createElement("div",{onClick:function(){return u(!c)},className:c?"show more-options":"more-options"},Gn.includes(t)?i.a.createElement(Kn,{noTooltip:!0,option:t,mode:t,setMode:n}):"...",c&&i.a.createElement("div",{className:"options-overlay"},i.a.createElement(Kn,{option:Vn.k,mode:t,setMode:n}),i.a.createElement(Kn,{option:Vn.h,mode:t,setMode:n}),i.a.createElement(Kn,{option:Vn.i,mode:t,setMode:n}),i.a.createElement(Kn,{option:Vn.j,mode:t,setMode:n}),i.a.createElement(Kn,{option:Vn.c,mode:t,setMode:n}),i.a.createElement(Kn,{option:Vn.d,mode:t,setMode:n}),i.a.createElement(Kn,{option:Vn.f,mode:t,setMode:n}),i.a.createElement(Kn,{option:Vn.g,mode:t,setMode:n}))))},Zn=(n(1801),Object(s.b)(function(e,t){return{rulesToFilter:t.jrules.rulesToFilter}},function(e){return{}})(function(e){var t=e.jrules,n=e.rulesToFilter,s=Object(a.useState)(void 0),c=Object(r.a)(s,2),u=c[0],l=c[1],f=Object(a.useState)(t.rulesToFilter),h=Object(r.a)(f,2),d=h[0],p=h[1];Object(a.useEffect)(function(){p(n)},[n,p]);var v=Object(a.useCallback)(function(e){var n=d.filter(function(t){return t.type!==e.type});p(n),t.updateRules(n)},[d,p]);return Object(a.useEffect)(function(){if(u){var e=[].concat(Object(o.a)(d),[u]);t.updateRules(e),p(e),l(void 0)}},[u,d,p,l]),i.a.createElement("div",{className:"jrules"},i.a.createElement(Qn,{mode:u,setMode:l}),i.a.createElement("div",{className:"rules-to-filter"},d.map(function(e){return i.a.createElement("div",{onClick:function(){return v(e)},className:"cell on"},i.a.createElement(Hn,{cell:e.type||e}))})))})),Yn=new Ot.a,$n=function(e){var t=e.lastLeaf,n=e.cell,r=[];n.accent&&r.push("accent"),n.pianissimo&&r.push("pianissimo"),n.piano&&r.push("piano"),n.staccato&&r.push("staccato"),n.nudgeBackward&&r.push("nudge-backward"),n.nudgeForward&&r.push("nudge-forward"),n.legato&&r.push("legato"),null===n.transpose&&r.push("rest");var a="cell-rules";t&&t.id===n.id&&(a+=" current",n.hand=t.hand,n.velocity=t.velocity,n.outputNumber=t.outputNumber,t.pulse&&(a+=" pulse"));var o=n&&n.outputNumber||0,s=Yn.saturate(Yn.getColorForHash(o),3);return i.a.createElement("div",{className:a},r.map(function(e){return i.a.createElement("div",{style:{opacity:"rest"===e?0:1},className:"cell"},i.a.createElement("div",{className:"symbol "+e}))}),i.a.createElement("div",{className:"hand-info"},n.hand?"L":"R"),i.a.createElement("div",{className:"velocity-info"},i.a.createElement("div",{style:{height:40*n.velocity,backgroundColor:s},className:"vel-indicator"})))},Xn=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.data,n=e.lastLeaf;return t?(Array.isArray(t)||(t=[t]),i.a.createElement("div",{className:"cell-data"},t.map(function(e){return i.a.createElement($n,{lastLeaf:n,cell:e})}))):""}),er=n(242),tr=Object(s.b)(function(e,t){return{figureLength:t.figure.figureLength,figureType:t.figure.figureType,lastLeaf:t.tidal.lastLeaf}},function(e){return{}})(function(e){e.figure;for(var t,n,r=e._figure,a=e.figureLength,s=e.figureType,c=e.tidal,u=e.lastLeaf,l=c.cycle,f=r.map(function(e){return e.id}),h=l.filter(function(e){return f.includes(e.id)}),d=[],p=!1,v=void 0,m=0;m<h.length;m++){var y=h[m].type.type;0===m&&"-"===y&&1===h[m].type.value&&(t=h[m]),p?d[d.length-1]=[d[d.length-1],h[m]]:d.push("."===y?[h[m]]:h[m]),p=!p&&"-"===y;var b=l.indexOf(h[m]);b===l.length-1&&v<3&&(n=!0),v=b}if(t&&(d[d.length-1]=[d[d.length-1],t]),!er.b[a][s])return"";n&&(d=[d[d.length-1]].concat(Object(o.a)(d.slice(0,d.length-1))));return i.a.createElement("div",{className:"figure-drawer"},er.b[a][s].split(" ").map(function(e,t){return i.a.createElement("div",{className:"cell-info"},i.a.createElement("div",{className:"cell on"},"-"===e?i.a.createElement("div",{className:"dash-inner"},i.a.createElement("div",{className:"symbol dash"})):i.a.createElement("div",{className:"symbol dot"})),i.a.createElement(Xn,{lastLeaf:u,data:d[t]}))}))}),nr=(n(1802),Object(s.b)(function(e,t){return{jaki:t.jdebug.jaki,tidals:t.jdebug.tidals,cycle:t.jdebug.tidals&&t.jdebug.tidals[0]&&t.jdebug.tidals[0].cycle}},function(e){return{}})(function(e){e.jdebug;var t=e.jaki,n=e.tidals,r=t&&t.figures.figures;return r?i.a.createElement("div",{className:"jdebug"},n.slice(0,1).map(function(e){return i.a.createElement("div",{className:"debug-figures"},r.map(function(r,a){return i.a.createElement(tr,{cycle:n.cycle,_figure:t.figures._figures[a],tidal:e,figure:r})}))})):""})),rr=(n(1803),Object(s.b)(function(e,t){return{isLooping:t.track.isLooping,loopStart:t.track.loopStart,loopLength:t.track.loopLength,start:t.track.lastTriggeredStart||0}},function(e){return{}})(function(e){var t=e.track,n=e.start,r=(e.isLooping,e.force),a=e.onDrag;if(!t.isLooping&&!r)return"";var o={},s={width:n+"%",left:0};if(t.isLooping&&t.isWarped()){var c=t.midiEffects.effects.find(function(e){return"Warp"===e.name}),u=c.getStartTimeLoop(t.loopStart,0);o={left:u+"%",width:c.getStartTimeLoop(t.loopStart+t.loopLength,0)-u+"%"},s={left:n+"%",width:"5px"}}return i.a.createElement("div",{className:"track-loop-info"},t.isLooping&&i.a.createElement("div",{onMouseDown:function(e){return a?a(e):0},style:o,className:"inner-loop"}),i.a.createElement("div",{style:s,className:"inner-start"}))})),ar=Object(s.b)(function(e,t){return{}},function(e){return{setParametersToRecord:function(t){return e(Object(c.Jc)(t))},setStepParameterSelected:function(t){return e(Object(c.he)(t))}}})(function(e){var t=e.name,n=e.min,o=e.max,s=e.setValue,c=e.value,u=e.track,l=e.parameters,f=e.rounded,h=void 0!==f&&f,d=e.isSelected,p=Object(a.useRef)(void 0),v=Object(a.useState)(!1),m=Object(r.a)(v,2),y=(m[0],m[1]),b=Object(a.useState)(!1),g=Object(r.a)(b,2),O=g[0],j=g[1];Object(a.useEffect)(function(){return window.addEventListener("mouseup",w),window.addEventListener("mousemove",k),function(){window.removeEventListener("mouseup",w),window.removeEventListener("mousemove",k)}},[l,j,O,s,d]);var k=Object(a.useCallback)(function(e){if(O){var t=O.y,r=O.number,a=t-e.pageY,i=Math.pow(a/t,2);a<0&&(i*=-1);var c=i*(o-(n+.001))+r;c=Math.max(n,Math.min(o,c)),h&&(c=Math.round(c)),s(c)}},[l,j,O,s,u]),w=Object(a.useCallback)(function(e){O&&j(!1)},[j,O]),x="param-value ";return d&&(x+=" selected"),i.a.createElement("div",{onMouseDown:function(e){j({number:c,y:e.pageY})},onMouseOver:function(){return y(!0)},onMouseLeave:function(){return y(!1)},className:x},i.a.createElement("div",{ref:p,className:"param-name"},t),i.a.createElement("div",{className:"param-value-number"},c))}),ir=n(175),or=n.n(ir),sr=10;function cr(e){function t(e){var t=e.getName();return void 0===t?"":t.length>=sr?t.slice(0,sr)+"...":t}function n(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.track;if(n)return{value:n,label:n.trackNumber+1+". "+t(n)}}var r=e.className?e.className+" tracks-dropdown-container":"tracks-dropdown-container";return i.a.createElement("div",{className:r},i.a.createElement(or.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:function(){var t=e.sequencerEngine.tracks.filter(function(t){return void 0===e.trackToSkip||t!==e.trackToSkip}).map(n);return[{label:"None",value:null}].concat(Object(o.a)(t))}(),onChange:function(t){return e.onSelectTrack(t.value)},value:n(),placeholder:"Track"}))}n(1804);var ur=Object(s.b)(function(e,t){return{trackStep:t.loopUI.sequencerEngine.trackStep}},function(e){return{}})(function(e){var t=e.loopUI,n=e.trackStep,s=Object(a.useState)(t.track),c=Object(r.a)(s,2),u=c[0],l=c[1],f=Object(a.useState)(t.presets.indexOf(t.currentPreset)),h=Object(r.a)(f,2),d=h[0],p=h[1],v=Object(a.useState)(t.presets),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useRef)(),O=Object(a.useState)(t.loopLength||4),j=Object(r.a)(O,2),k=j[0],w=j[1],x=Object(a.useState)(t.loopStart),S=Object(r.a)(x,2),P=S[0],E=S[1],T=Object(a.useState)(u&&u.isLooping),A=Object(r.a)(T,2),M=A[0],R=A[1],C=Object(a.useState)(void 0),N=Object(r.a)(C,2),I=N[0],q=N[1],_=Object(a.useState)(128),D=Object(r.a)(_,2),F=D[0],L=D[1];Object(a.useEffect)(function(){if(u){var e=6400/u.midiEffects.effects.find(function(e){return"Warp"===e.name}).getSliceLoopLength(0,0);L(e)}},[u]);var B=Object(a.useCallback)(function(){t.onLoop(!M),R(!M)},[M]);Object(a.useEffect)(function(){t.track=u},[u]);var z=Object(a.useCallback)(function(e){var t=g.current.getBoundingClientRect(),n=e.clientX-t.left;q({x:n,loopStart:u.loopStart})},[q]),J=Object(a.useCallback)(function(){var e=P%32,n=P-e;t.loopStart=n,E(n),(n=k-(e=k%8))<=0&&(n=k+(8-e)),t.loopLength=n,w(n)},[P,E,w,k]),V=Object(a.useCallback)(function(){E(P+=16),t.loopStart=P},[P,E]),H=Object(a.useCallback)(function(){E(P-=16),t.loopStart=P},[P,E]),U=Object(a.useCallback)(function(e){if(void 0!==I){var n=g.current.getBoundingClientRect(),r=(e.clientX-n.left-I.x)/g.current.offsetWidth,a=6400/u.midiEffects.effects.find(function(e){return"Warp"===e.name}).getSliceLoopLength(0,0),i=Math.round(r*a+I.loopStart);t.loopStart=i,E(i)}},[I,u,E]),G=Object(a.useCallback)(function(e){t.onPreset(e),p(e),E(t.currentPreset.loopStart),w(t.currentPreset.loopLength)},[p,E,w]);Object(a.useEffect)(function(){t.loopStart=P,t.loopLength=k},[P,k]);var W=n;M&&(W=n%(k||8),W+=P);return i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},onMouseMove:U,onMouseLeave:function(){return q(void 0)},onMouseUp:function(){return q(void 0)},ref:g,className:"loop-ui"},i.a.createElement(cr,{sequencerEngine:t.sequencerEngine,track:u,onSelectTrack:l}),i.a.createElement("div",{onClick:B,className:M?"loop-btn looping":"loop-btn"},i.a.createElement("div",{className:"zloop-icon"})),u&&i.a.createElement(rr,{onDrag:z,loopStart:P,loopLength:k,track:u}),i.a.createElement("div",{className:"step-and-quantize"},i.a.createElement("div",{className:"current-step"},i.a.createElement("div",{className:"current-label"},"Current Step"),i.a.createElement("div",{className:"step-value"},W||0)),i.a.createElement("div",{className:"quantize-fields"},i.a.createElement("div",{onClick:H,className:"prev"}),i.a.createElement("div",{onClick:J,className:"quantize-b pushable"},"quantize"),i.a.createElement("div",{onClick:V,className:"next"}))),i.a.createElement("div",{className:"parameters"},i.a.createElement(ar,{name:"Loop Start",value:P,setValue:E,min:0,max:F,rounded:!0}),i.a.createElement(ar,{name:"Loop Length",value:k,setValue:w,min:1,max:F,rounded:!0})),i.a.createElement("div",{className:"loop-presets"},y.map(function(e,t){return i.a.createElement("div",{onClick:function(){return G(t)},className:d===t?"current preset":"preset"},t+1)}),i.a.createElement("div",{onClick:function(){t.newPreset(),b(Object(o.a)(t.presets))},className:"new-preset"},"+")))}),lr=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.automationPaths;return t.map(function(e){return i.a.createElement("path",{fill:"transparent",d:(t=e,"M "+32*t[0].x+","+32*t[0].y+" L "+t.slice(1).map(function(e){return 32*e.x+","+32*e.y}).join(",")),strokeWidth:2,stroke:"red"});var t})}),fr=Object(s.b)(function(e,t){return{show:e.higherOrder.show}},function(e){return{setShowHigherOrderSequencer:function(t){return e(Object(c.Rd)(t))}}})(function(e){var t=e.setShowHigherOrderSequencer,n=e.show;return i.a.createElement("div",{className:"higher-order-component"},i.a.createElement("div",{className:"higher-order-header"},i.a.createElement("div",{className:"name"},"H=O Sequencer"),i.a.createElement("div",{className:"collapse-container"},i.a.createElement("div",{onClick:function(){return t(!n)},className:n?"arrow-down":"arrow-left"}))))}),hr=n(151),dr=Object(s.b)(function(e,t){return{num:t.higherOrderSequencer.sequencerEngine.subSequences.length,inputModules:e.higherOrder.inputModules,outputModules:e.higherOrder.outputModules}},function(e){return{}})(function(e){var t=e.inputModules,n=(e.outputModules,e.higherOrderSequencer),r=n.sequencerEngine.subSequences;return i.a.createElement("div",{className:"module-router"},r.map(function(e){return i.a.createElement("div",{className:"module-routes"},i.a.createElement("div",{className:"module-indicator"},e.name),i.a.createElement("img",{onClick:function(){return n.toggleInput(e)},src:t.includes(e)?"/gray-arrow.svg":"/black-arrow.svg"}))}))});function pr(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return vr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vr(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function vr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var mr=function(e){return e.automations&&e.automations.length},yr=function(e){return e.mixAutomation&&e.mixAutomation.automations&&e.mixAutomation.automations.length},br=Object(s.b)(function(e,t){var n=t.force;return{hasAutomations:mr(n[0])||mr(n[1])||mr(n[2])||mr(n[3])||yr(n[0])||yr(n[1])||yr(n[2])||yr(n[3])}},function(e){return{}})(function(e){var t=e.force,n=e.name,r=e.hasAutomations,o=Object(a.useCallback)(function(){var e,n=pr(t);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=r.mixAutomation;r.automation.deleteAutomations(),a.deleteAutomations()}}catch(i){n.e(i)}finally{n.f()}},[t]);return i.a.createElement("div",{className:"script-force"},n,r?i.a.createElement("img",{onClick:o,src:"/automation-icon-disabled.png",className:"automation-icon"}):"")}),gr=Object(s.b)(function(e,t){return{forces:t.effect.forces}},function(e){return{}})(function(e){var t=e.forces,n=Object.keys(t).length;return i.a.createElement("div",{className:"script-forces"},n>0&&i.a.createElement("div",{className:"forces-label"},"Forces"),Object.keys(t).map(function(e){return i.a.createElement(br,{name:e,force:t[e]})}))}),Or=Object(s.b)(function(e,t){return{variables:e.effects.scriptVariables[t.effect.id]}},function(e){return{}})(function(e){var t=e.effect,n=e.variables,r=e.sequencerEngine;return n?i.a.createElement("div",{className:"script-variables"},n.filter(function(e){return e&&e.name}).filter(function(e){return!e.hide}).sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(e){return i.a.createElement(Ft.a,{name:e.name,key:e.id,min:e.min,max:e.max,step:e.max-Math.floor(e.max)!==0||e.min-Math.floor(e.min)!==0||Math.abs(e.max-e.min)<2?.01:1,parameter:e,lfoEnabled:!0,sequencerEngine:r,isParameter:!0,effectNumber:0})}),t.forces&&i.a.createElement(gr,{effect:t})):[]}),jr=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.leaf,n=e.sequencerEngine,o=e.setLeafDetails,s=Object(a.useState)(t.track),c=Object(r.a)(s,2),u=c[0],l=c[1];Object(a.useEffect)(function(){l(t.track)},[t,l]);var f=Object(a.useCallback)(function(e){t.track=e,l(e)},[t,l]);return i.a.createElement("div",{className:"leaf-details"},i.a.createElement("div",{onClick:function(e){return o(void 0)},className:"delete-btn"},"x"),"Send trigger to track:",i.a.createElement(cr,{sequencerEngine:n,track:u,onSelectTrack:f}))}),kr=n(311),wr=n(568),xr=n(147),Sr=new Ot.a,Pr=window.factor||2,Er=Object(s.b)(function(e,t){var n={};return t.tidals.forEach(function(e){n[e.id]=e.currentCycles,n["cycle"+e.id]=e.cycle}),n},function(e){return{}})(function(e){var t=e.leafDetails,n=e.setLeafDetails,r=e.backgroundColor,o=e.color,s=e.WIDTH,c=void 0===s?280:s,u=e.HEIGHT,l=void 0===u?280:u,f=e.dotColor,h=e.tidals,d=e.total,p=void 0===d?1:d,v=e.radius,m=void 0===v?c/2*.95:v,y=Object(kn.a)(e,["leafDetails","setLeafDetails","backgroundColor","color","WIDTH","HEIGHT","dotColor","tidals","total","radius"]),b=Object(a.useRef)(void 0),g=Object(a.useRef)([]),O=Object(a.useRef)(void 0);Object(a.useEffect)(function(){O.current=b.current.getContext("2d"),k()},[]),Object(a.useEffect)(function(){O.current&&O.current.scale(window.devicePixelRatio,window.devicePixelRatio)},[c,l]);var j=c/2;Object(a.useEffect)(function(){O.current&&k()},[y,f,t,c,l,m,j]);var k=Object(a.useCallback)(function(){var e=O.current;e.clearRect(0,0,c,l),g.current=[];for(var t=void 0,n=0;n<h.length;n++)for(var r=h[n],a=r.cycle,i=t||Math.max(10,m-12*Pr*n),o=a,s=o.length,u=0;u<o.length;u++){var f=o[u];if(0===u&&(t=w(e,u,s,a,i,j,f)),Array.isArray(f)&&(f=f[0]),y.sequencerEngine.tracks[n]&&x(e,f,u,i,a,n,s,r))break}},[o,c,l,f,r,h,p,t,j,m]),w=function(e,t,n,r,a,i,o){var s=P((t+1)%n,i,a,r),c=P((t+2)%n,i,a,r),u=P(Object(xr.a)(t-2,n),i,a,r),l=P(Object(xr.a)(t-1,n),i,a,r),f=Object(wr.a)(l,c,u,s);return Object(kr.c)({x:i,y:i},f)},x=function(e,t,n,a,i,o,s,c){var u=P(n,j,a,i),l=u.deg,h=u.x,d=u.y,p=S(t,o/s,o,s),v=p.fill,m=(p.stroke,p.radius);if(!c.currentCycles||!c.currentCycles[t.id])return!1;v=Sr.brighten(v,window.bright||.5);var y=new Path2D;if(y.arc(j,j,a,1.5*Math.PI,l),e.strokeStyle=f,e.stroke(y),null!==t.transpose){var b=new Path2D;if(m<0&&(m=1),b.arc(h,d,Pr*m,0,2*Math.PI),g.current.push({leaf:t,path:y,nth:o}),e.fillStyle=f,e.fill(b),t.staccato){var O=.3*m*Pr;e.fillStyle=r,e.fillRect(h-.5*O,d-.5*O,O,O)}}return!0},S=Object(a.useCallback)(function(e,t,n,a){var i=y.sequencerEngine.tracks[n],s=i?Sr.getColorForTrack(i):o,u=c/280*5*(a-n)/a;return e.accent?u*=2:e.piano?u/=2:e.pianissimo&&(u/=2),null===e.transpose?{fill:Sr.transparent(Sr.saturate(r,1)),stroke:s,radius:u}:{fill:s,radius:u}},[o,c,l,j,r]),P=Object(a.useCallback)(function(e,t,n,r){e*=1;var a=r.length,i=2*Math.PI*e/a-.5*Math.PI;return{x:t+n*Math.cos(i),y:t+n*Math.sin(i),deg:i}},[j,m,c,l]),E=Object(a.useCallback)(function(e){},[n]);return i.a.createElement("canvas",{onMouseDown:E,className:"tidal-art",style:{width:c,height:l},width:c*window.devicePixelRatio,height:l*window.devicePixelRatio,ref:b})});n(895),n(896);function Tr(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ar(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ar(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ar(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Mr=new Ot.a,Rr=window.factor||2,Cr=Object(a.memo)(function(e){var t=e.leafDetails,n=e.WIDTH,r=void 0===n?280:n,o=e.HEIGHT,s=void 0===o?280:o,c=e.setLeafDetails,u=e.FULL_RADIUS,l=void 0===u?r/2*.95:u,f=e.isScript,h=e.backgroundColor,d=e.color,p=e.tidals,v=e.fillColor,m=e.dotColor,y=e.radius,b=void 0===y?l:y,g=Object(kn.a)(e,["leafDetails","WIDTH","HEIGHT","setLeafDetails","FULL_RADIUS","isScript","backgroundColor","color","tidals","fillColor","dotColor","radius"]),O=(p=p.filter(function(e){return e.inUse||e.lastUsed<1})).length,j=Object(a.useRef)(void 0),k=Object(a.useRef)([]),w=Object(a.useRef)(void 0);Object(a.useEffect)(function(){w.current=j.current.getContext("2d"),S()},[]),Object(a.useEffect)(function(){w.current&&w.current.scale(window.devicePixelRatio,window.devicePixelRatio)},[r,s]);var x=r/2;Object(a.useEffect)(function(){w.current&&(6===p.length||f)&&window.requestAnimationFrame(S)},[g,x,m,t,p,v,r,s,b]);var S=Object(a.useCallback)(function(){var e=w.current;e.clearRect(0,0,r,s),k.current=[];for(var t=void 0,n=0;n<p.length;n++){var a=p[n],i=a.cycle,o=t||Math.max(10,b-12*Rr*n);if(0===n&&(e.beginPath(),e.arc(x,x,o,0,2*Math.PI),e.fillStyle=h,e.fill(),e.closePath()),!g.sequencerEngine||g.sequencerEngine.tracks[n])for(var c=i,u=c.length,l=0;l<c.length;l++){var f=c[l];Array.isArray(f)&&(f=f[0]);var d=g.sequencerEngine&&g.sequencerEngine.tracks[n];if(!g.sequencerEngine||d){var v=P(e,l,u,i,o,{x:x,y:x},f);v&&(t=v)}f.type&&"-"===f.type.type&&0===f.type.value&&E(e,f,l,o,i,u),T(e,f,l,o,i,n,u,a)}}},[d,x,h,p,O,t,v,b,r,s]),P=Object(a.useCallback)(function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{x:x,y:x},o=arguments.length>6?arguments[6]:void 0;arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(null!==o.transpose){var s=A(t,i,a,r),c=A((t+1)%n,i,a,r),u=A((t+2)%n,i,a,r),l=A((t+3)%n,i,a,r),f=A(Object(xr.a)(t-3,n),i,a,r),h=A(Object(xr.a)(t-2,n),i,a,r),p=A(Object(xr.a)(t-1,n),i,a,r),m=s,y=Object(wr.a)(s,l,c,h),b=Object(wr.a)(p,u,h,c),g=Object(wr.a)(s,f,u,p);return e.beginPath(),e.lineWidth=1,e.moveTo(m.x,m.y),e.lineTo(y.x,y.y),e.lineTo(b.x,b.y),e.lineTo(g.x,g.y),e.closePath(),e.fillStyle=v,e.fill(),e.strokeStyle=d,e.stroke(),Object(kr.c)({x:x,y:x},b)}},[x,b,r,s,v,d]),E=Object(a.useCallback)(function(e,t,n,r,a,i){var o={x:x,y:x},s=A(n,o,r,a),c=A((n+1)%i,o,r,a),u=(A((n+2)%i,o,r,a),A((n+3)%i,o,r,a)),l=(A(Object(xr.a)(n-3,i),o,r,a),A(Object(xr.a)(n-2,i),o,r,a)),f=(A(Object(xr.a)(n-1,i),o,r,a),Object(wr.a)(s,u,c,l));e.lineWidth=1,e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(f.x,f.y),e.lineTo(c.x,c.y),e.closePath(),e.fillStyle=v,e.fill(),e.strokeStyle=d,e.stroke()},[x,b,s,r,v,d]),T=function(e,t,n,r,a,i,o,s){},A=(Object(a.useCallback)(function(e,t,n){var r=m,a=5*t;return null===e.transpose?{fill:Mr.transparent(Mr.saturate(h,1)),stroke:r,radius:a}:{fill:r,radius:a}},[m,h,b]),Object(a.useCallback)(function(e,t,n,r){e*=1;r.flat(16);var a=r.length,i=2*Math.PI*e/a-.5*Math.PI;return{x:t.x+n*Math.cos(i),y:t.y+n*Math.sin(i),deg:i}},[x,b,r,s])),M=Object(a.useCallback)(function(e){var t,n=j.current.getBoundingClientRect(),r=Math.round(2*(e.clientX-n.left)),a=Math.round(2*(e.clientY-n.top)),i=Tr(k.current);try{for(i.s();!(t=i.n()).done;){var o=t.value,s=o.leaf,u=o.path;if(w.current.isPointInPath(u,r,a)){c(s);break}}}catch(l){i.e(l)}finally{i.f()}},[c]);return i.a.createElement("canvas",{onMouseDown:M,className:"tidal-art structure",style:{width:r,height:s},width:r*window.devicePixelRatio,height:s*window.devicePixelRatio,ref:j})}),Nr=Object(s.b)(function(e,t){var n={};return t.tidals.forEach(function(e){n["cycle"+e.id]=e.cycle}),n},function(e){return{}})(Cr);window.magik=1.5,window.rad=1;new Ot.a,Object(s.b)(function(e,t){var n={};return t.tidals.forEach(function(e){n[e.id]=e.currentCycles,n["cycle"+e.id]=e.cycle}),n},function(e){return{}})(function(e){var t=e.displayRef,n=e.backgroundColor,r=e.color,o=e.tidals,s=e.total,c=void 0===s?1:s,u=(e.radius,Object(kn.a)(e,["displayRef","backgroundColor","color","tidals","total","radius"])),l=Object(a.useRef)(void 0),f=Object(a.useRef)(void 0);Object(a.useEffect)(function(){f.current=l.current.getContext("2d"),f.current.scale(window.devicePixelRatio,window.devicePixelRatio),h()},[]),Object(a.useEffect)(function(){f.current&&h()},[u]);var h=Object(a.useCallback)(function(){var e=f.current;e.clearRect(0,0,495,400),e.beginPath(),e.rect(0,0,495,400),e.fillStyle=n,e.fill();for(var a=0;a<Math.min(1,o.length);a++){for(var i=o[a],s=i.cycle.flat(16),c=(s.length,!1),u=Math.max(1,15-3*a),l={x:2*u,y:2*u},h=!1,d=0;d<s.length;d++){var p=s[d];if(p.type){var v=p.type,m=v.type,y=v.value;if(d>0){var b=p.accent?2*u:u;"-"===m?(l.x+=3*b,0===y&&(c=!c)):"."===m&&(h&&(l.y+=3*b),c=!c)}h="."===m;var g=l.x,O=l.y;if(c&&(O=400-O),null!==p.transpose){e.beginPath(),e.fillStyle=r;var j=window.rad*u;p.accent&&(j*=2);var k=2*Math.PI;p.staccato&&(k=Math.PI),i.currentCycles&&i.currentCycles[p.id]&&(e.fillStyle="red",e.fillStyle="#FFA47D"),a>0&&(e.fillStyle="gray",j=u),e.arc(g,O,j,0,k),p.piano||p.pianissimo?(e.strokeStyle=r,e.lineWidth=2,e.stroke()):e.fill()}}}0===a&&(l.x+=4*u,l.y+=4*u,e.fillStyle="black",e.fillRect(l.x,l.y,495-l.x-u,100),t.current&&(t.current.style.left=l.x+"px",t.current.style.top=l.y+"px",t.current.style.width=495-l.x+"px",t.current.style.height="100px"))}},[r,n,o,c]);return i.a.createElement("canvas",{className:"tidal-art",style:{width:495,height:400},width:495*window.devicePixelRatio,height:400*window.devicePixelRatio,ref:l})}),n(329);function Ir(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return qr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qr(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function qr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}new Ot.a;var _r=Object(a.memo)(function(e){var t=e.effect,n=e.cycle,r=e.total,o=e.parts,s=Object(a.useRef)(void 0);Object(a.useEffect)(function(){return o.current[n.id]||(o.current[n.id]=[]),o.current[n.id].push(s),function(){o.current[n.id]&&(o.current[n.id]=o.current[n.id].filter(function(e){return e!==s}))}},[n,o]);var c={width:r+"%"},u=0,l=Object(a.useCallback)(function(e){return"object"===typeof e?Math.max(1,Math.floor(t.var(e.name)())):Math.floor(e)},[t]),f="tidal-part";if(Array.isArray(n)){var h,d=Ir(n);try{for(d.s();!(h=d.n()).done;){var p=h.value;p&&(u+="*"===p.operator||"^"===p.operator?l(p.operand):1)}}catch(b){d.e(b)}finally{d.f()}}else if(n.cycle&&Array.isArray(n.cycle)){var v,m=Ir(n.cycle);try{for(m.s();!(v=m.n()).done;){var y=v.value;y&&(u+="^"===y.operator||"*"===y.operator?l(y.operand):1)}}catch(b){m.e(b)}finally{m.f()}}else null===n.transpose&&(f+=" rest"),null!==n.transpose&&(c.filter="hue-rotate("+window.hrotate*n.transpose+"deg)");return i.a.createElement("div",{ref:s,style:c,className:f},Array.isArray(n.cycle||n)?(n.cycle||n).filter(function(e){return e}).map(function(e,n){return"*"===e.operator||"^"===e.operator?new Array(l(e.operand)).fill(0).map(function(r,a){return i.a.createElement(_r,{effect:t,key:n+"-"+a,parts:o,cycle:e,total:100/u})}):i.a.createElement(_r,{parts:o,effect:t,key:n,cycle:e,total:100/u})}):i.a.createElement("span",null,Object(Un.f)(n,!0)))}),Dr=_r;new Ot.a;window.hrotate=4;var Fr=Object(s.b)(function(e,t){return{cycle:t.effect.cycle,currentCycles:t.effect.currentCycles}},function(e){return{}})(function(e){var t=e.effect,n=e.cycle,r=e.currentCycles,s=Object(a.useRef)({}),c=Object(a.useRef)([]);return Object(a.useEffect)(function(){if(r){var e=s.current;for(var t in c.current.forEach(function(e){e.current&&e.current.style&&(e.current.style.borderBottom="none")}),c.current=[],r)e[t]&&(e[t].forEach(function(e){e.current&&e.current.style&&(e.current.style.borderBottom="1px solid white")}),c.current=[].concat(Object(o.a)(c.current),Object(o.a)(e[t])))}},[r]),i.a.createElement("div",{className:"tidal-visualizer"},i.a.createElement(Dr,{parts:s,effect:t,cycle:n,total:100}))}),Lr=Object(s.b)(function(e,t){var n={};return t.tidals.forEach(function(e){return n[e.id]=e.inUse}),n},function(e){return{}})(function(e){var t=e.tidals,n=e.isScript,o=e.WIDTH,s=e.HEIGHT,c=e.color,u=void 0===c?"#A19A9A":c,l=e.backgroundColor,f=void 0===l?"#100B0B":l,h=e.fillColor,d=void 0===h?"#757474":h,p=e.dotColor,v=void 0===p?"#B5B5B5":p,m=Object(a.useRef)(),y=Object(a.useState)(!1),b=Object(r.a)(y,2),g=(b[0],b[1],Object(a.useState)({x:0,y:0})),O=Object(r.a)(g,2),j=(O[0],O[1],Object(a.useState)(void 0)),k=Object(r.a)(j,2),w=k[0],x=k[1],S=t.filter(function(e){return e.inUse||e.lastUsed<1});S[0];return 0===S.length?"":i.a.createElement("div",{className:"script-tidals"},w&&i.a.createElement(jr,{setLeafDetails:x,sequencerEngine:t[0].track.sequencerEngine,leaf:w}),i.a.createElement("div",{ref:m,className:"display"},i.a.createElement("span",null)),i.a.createElement(Nr,{leafDetails:w,setLeafDetails:x,isScript:n,sequencerEngine:t[0].track.sequencerEngine,backgroundColor:f,color:u,fillColor:d,WIDTH:o,HEIGHT:s,dotColor:v,tidals:t}),i.a.createElement(Er,{leafDetails:w,WIDTH:o,HEIGHT:s,setLeafDetails:x,sequencerEngine:t[0].track.sequencerEngine,backgroundColor:f,dotColor:v,color:u,tidals:S,total:S.length}))}),Br=(Object(s.b)(function(e,t){return{variables:e.effects.scriptVariables[t.tidal.id]}},function(e){return{}})(function(e){var t=e.sequencerEngine,n=e.variables,r=void 0===n?[]:n;return i.a.createElement("div",{className:"tidal-variables"},(r||[]).map(function(e){return i.a.createElement(Ft.a,{name:e.name,min:e.min,max:e.max,step:e.max-Math.floor(e.max)!==0||e.min-Math.floor(e.min)!==0||Math.abs(e.max-e.min)<2?.01:1,parameter:e,lfoEnabled:!0,sequencerEngine:t,isParameter:!0,effectNumber:0})}))}),Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.code,n=e.setCode,o=e.isLoading,s=e.setIsLoading,c=e.scriptType,u=Object(a.useState)([]),l=Object(r.a)(u,2),f=l[0],h=l[1];Object(a.useEffect)(function(){Object(tt.c)(c).then(h)},[h,c]);var d=Object(a.useCallback)(function(e){n('const fn = load("'+e.title+'");\n'+t),s(!1)},[t,n,s]);return o?i.a.createElement("div",{className:"load-script-flow"},f.map(function(e){return i.a.createElement("div",{onClick:function(){return d(e)},className:"script-option"},e.title)}),i.a.createElement("div",{className:"load-toolbar"},i.a.createElement("div",{onClick:function(){return s(!1)},className:"cancel-btn"},"Cancel"))):[]}));var zr=Object(s.b)(function(e,t){return{graphics:t.effect.graphics}},function(e){return{}})(function(e){e.effect,e.graphics;return""}),Jr=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.matchingParenthesis;if(!t)return[];var n={top:t.y,left:t.x};return i.a.createElement("div",{style:n,className:"matching-parenthesis"})}),Vr=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.scriptType,n=e.isSaving,o=e.setIsSaving,s=e.code,c=Object(a.useState)(""),u=Object(r.a)(c,2),l=u[0],f=u[1],h=Object(a.useCallback)(Object(K.a)(W.a.mark(function e(){return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(tt.d)(s,t,l);case 2:o(!1);case 3:case"end":return e.stop()}},e)})),[s,l,o,t]);return n?i.a.createElement("div",{className:"save-script-flow"},i.a.createElement("input",{placeholder:"Type name for script",type:"text",value:l,onChange:function(e){return f(e.target.value)}}),i.a.createElement("div",{className:"save-toolbar"},i.a.createElement("div",{onClick:function(){return o(!1)},className:"cancel-btn"},"Cancel"),i.a.createElement("div",{onClick:h,className:"done-btn"},"Done")),i.a.createElement("div",{className:"info"},"To load use ",i.a.createElement("br",null),i.a.createElement("code",null,'const fn = load("NAME YOU CHOSE HERE");'))):[]}),Hr=(n(898),Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.code,n=(e.doc,e.scrollTop),r=t.replace(/[^0-9\n\s]/g," "),a=t.replace(/[^a-zA-Z\n\s]/g," "),o={top:-n};return[i.a.createElement("pre",{style:o,className:"syntax-highlighter number"},r),i.a.createElement("pre",{style:o,className:"syntax-highlighter letter"},a)]}),n(223)),Ur=function(e,t){for(var n=0,r=0;r<e.length;r++)e[r]==t&&n++;return n},Gr=function(e,t){for(var n="",r=0;r<t;r++)n+=e;return n},Wr=n(1805),Kr=n.n(Wr),Qr=n(1806);n(1807),n(1808),n(1809),n(1810);window.startColor="#ff4d24",window.hueShift=4;var Zr=new Ot.a,Yr=0,$r=function(e){var t=e.syntaxErrors,n=e.code,r=e.lineNumber,a=e.running,o=e.syntaxError,s=e.scrollTop;if(!t||0===t.length)return"";var c=(n||"").split("\n"),u="highlighter";a&&(u+=" running");Zr.saturate(window.startColor,1);return c.map(function(e,n){return i.a.createElement("div",{key:n,style:{width:.5*e.length+"em",top:19*n-2-s,height:19},className:t&&t.some(function(e){return e.lineNumber===n+1})||o&&n+1===r?"syntax-error "+u:u})})},Xr=Object(s.b)(function(e,t){return{syntaxErrorLine:t.effect.syntaxErrorLine,code:t.effect.code,tidals:t.effect.tidals,variables:e.effects.scriptVariables[t.effect.id],logs:t.effect.logs,logNum:t.effect.logs&&t.effect.logs.length,syntaxErrors:t.effect.syntaxErrors}},null)(function(e){e.tidals,e.isDraggable;var t,n=e.logs,o=e.scriptType,s=void 0===o?"USER_SCRIPT":o,c=e.effect,u=e.sequencerEngine,l=(e.variables,e.lang),f=void 0===l?Qr.languages.js:l,h=e.doc,d=e.setExpanded,p=e.disableSyntaxHelper,v=e.expanded,m=e.width,y=e.height,b=Object(a.useRef)(void 0),g=Object(a.useRef)(void 0),O=Object(a.useState)(!1),j=Object(r.a)(O,2),k=j[0],w=j[1],x=Object(a.useRef)(void 0),S=(Object(a.useRef)(void 0),Object(a.useState)(!1)),P=Object(r.a)(S,2),E=P[0],A=P[1],M=Object(a.useState)(c.code),R=Object(r.a)(M,2),C=R[0],N=R[1],I=Object(a.useRef)(0),q=Object(a.useRef)(!1),_=Object(a.useRef)(!1),D=Object(a.useState)(!1),F=Object(r.a)(D,2),L=F[0],B=F[1],z=Object(a.useState)(!1),J=Object(r.a)(z,2),V=J[0],H=J[1],U=Object(a.useState)(0),G=Object(r.a)(U,2),W=G[0],K=G[1];an({ref:b}).preventDragging;Object(a.useEffect)(function(){N(c.code)},[c,c.code,N]),Object(a.useEffect)(function(){c&&c.expanded&&"USER_SCRIPT"===s&&d(!0)},[]),Ze(b);var Q=Object(a.useCallback)(function(e){var t=g.current;t&&K(t.scrollTop),N(e.target.value);var n=++Yr;setTimeout(function(){n===Yr&&(c.hasSyntaxError(e.target.value)?H(!0):H(!1))},1e3)},[N,H,K]),Z=Et({ref:g,code:C,onChange:Q,doc:h,disable:p}),Y=Z.library,$=Z.setLibrary,X=Z.choosePossibility,ee=Z.possibilities,te=Z.setPossibilities,ne=Z.selectedChoice,re=Z.matchingParenthesis;Object(a.useEffect)(function(){if((q.current||_.current)&&g.current){if(q.current){q.current=!1;var e=function(e,t){var n="",r=e.split("\n"),a=0,i=0,o=0,s=0;for(var c in r){var u=r[c],l=Ur(u,"("),f=Ur(u,")"),h=Ur(u,"{"),d=Ur(u,"}"),p=a-i-d,v=u.trimStart();n+=Gr("  ",p)+v,parseInt(c)<r.length-1&&(n+="\n"),a+=l+h,i+=f+d,o<=t&&t<=o+u.length+1&&(s=t+2*p),o+=u.length+1}return{indented:n,caret:s}}(C,I.current+1);if(e.indented===C)return;ae(e.indented,e.caret)}if(_.current){var t=_.current;_.current=void 0;var n=I.current+1,r=function(e,t,n){return t.slice(0,n)+e+t.slice(n)}(t,C,I.current+1);ae(r,n)}}},[C,N]);var ae=Object(a.useCallback)(function(e,t){var n=x.current.scrollTop,r=g.current.style.resize,a=g.current.style.overflow;g.current.style.resize="none",x.current.style.overflow="hidden",g.current.style.overflow="hidden",g.current.blur(),N(e),setTimeout(function(){g.current.setSelectionRange(t,t),x.current.scrollTo(0,n),g.current.style.resize=r,g.current.focus(),x.current.style.overflow="scroll",g.current.style.overflow=a},10)},[N]);function ie(){var e=document.getElementById(c.id+"-script");e&&e.removeEventListener("scroll",oe)}Object(a.useEffect)(function(){N(c.code);var e=g.current;return e&&e.addEventListener("scroll",oe),ie},[c,N]);var oe=Object(a.useCallback)(function(){var e=document.getElementById(c.id+"-script");e&&K(e.scrollTop)},[K]),se=(Object(a.useCallback)(function(){},[C]),Object(a.useCallback)(function(){c.eval(C,void 0,!0),B(!0),setTimeout(function(){return B(!1)},100)},[C,B])),ce=Object(a.useCallback)(function(e){g.current&&(I.current=g.current.selectionStart),"Enter"===e.key&&e.ctrlKey?(e.stopPropagation(),e.preventDefault(),se()):"Enter"===e.key?q.current=!0:"{"===e.key?_.current="}":"("===e.key||'"'===e.key||e.key},[se]),ue="execute-button",le="user-script-component";L&&(ue+=" running",le+=" running"),Object(a.useEffect)(function(){g.current=document.getElementById(c.id+"-script")},[c]),v&&(le+=" expanded");var fe="";n&&(fe=n[n.length-1]);var he="script-and-tidal";return v&&"User Script"===c.name&&(he+=" expanded"),V&&(le+=" syntax-error"),i.a.createElement("div",{className:he},i.a.createElement("div",{ref:b,className:le},d?i.a.createElement("img",{onClick:function(){c.expanded=!v,d(v?void 0:c)},className:"expanded-icon",src:"/expand-icon.svg"}):"",i.a.createElement("div",{draggable:!0,ref:x,onDragStart:function(e){return e.preventDefault()},onMouseDown:function(){te([]),$(void 0)},style:v?{height:340}:y?{height:y,width:m}:{},className:"script-box"},i.a.createElement(Vr,{scriptType:s,setIsSaving:w,code:C,isSaving:k}),i.a.createElement(Br,(t={setCode:N,code:C,scriptType:s,setIsLoading:A},Object(T.a)(t,"code",C),Object(T.a)(t,"isLoading",E),t)),i.a.createElement(Kr.a,{textareaId:c.id+"-script",value:C||"",onValueChange:function(e){return Q({target:{value:e}})},highlight:function(e){return Object(Qr.highlight)(e,f)},onKeyDown:ce,onMouseDown:function(e){e.stopPropagation()},spellCheck:"false",className:"user-script-code"}),i.a.createElement($r,{scrollTop:W,running:L,lineNumber:c.syntaxErrorLine,syntaxErrors:c.syntaxErrors,syntaxError:V,code:C}),i.a.createElement(Jr,{matchingParenthesis:re}),i.a.createElement(it,{library:Y,setLibrary:$,doc:h,effect:c,selectedChoice:ne,choosePossibility:X,scrollTop:W,input:g,setPossibilities:te,possibilities:ee})),E||k?"":i.a.createElement("div",{className:"script-toolbar"},i.a.createElement("div",{className:"load-script-btn",onClick:function(){return A(!0)}},"Load"),i.a.createElement("div",{className:"save-script-btn",onClick:function(){return w(!0)}},"Save"),i.a.createElement("div",{className:ue,onClick:se},i.a.createElement("div",{className:"arrow-right"}),i.a.createElement("span",null,"Run"))),i.a.createElement(zr,{effect:c}),i.a.createElement(Or,{sequencerEngine:u,effect:c}),i.a.createElement("div",{className:"log-display"},fe)))}),ea=(Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.higherOrderSequencer,n=t.scriptEffect;return i.a.createElement("div",{className:"module-scripter"},i.a.createElement(dr,{higherOrderSequencer:t}),i.a.createElement(Xr,{doc:hr.a,effect:n}))}),Object(s.b)(function(e,t){return{orientationRoutings:e.higherOrder.orientationRoutings,modulesLen:t.higherOrderSequencer.modules.length}},function(e){return{setHigherOrderStepsSelected:function(t){return e(Object(c.Lb)(t))}}})(function(e){var t=e.orientation,n=e.higherOrderSequencer,r=(e.setHigherOrderStepsSelected,n.routings[t]),o=n.modules,s=Object(a.useCallback)(function(e,t){return r[e.id]&&r[e.id].includes(t)},[r]),c=Object(a.useCallback)(function(e,r){s(e,r)?n.disconnectModules(t,e,r):n.connectModules(t,e,r)},[r]),u=Object(a.useCallback)(function(e){n.isFreeform(e)?n.disconnectFromFreeform(e):n.connectToFreeform(e)},[]);return i.a.createElement("div",{className:"orientation-routing"},i.a.createElement("div",{className:"out-label"},"OUTPUT"),i.a.createElement("div",{className:"module-outs"},o.map(function(e){return i.a.createElement("div",{key:e.id},i.a.createElement("div",{className:"m-name"},e.name),i.a.createElement("div",{className:"out-line"}))}),i.a.createElement("div",null,i.a.createElement("div",{className:"m-name"},"free"),i.a.createElement("div",{className:"out-line"}))),i.a.createElement("div",{className:"m-row"},i.a.createElement("div",{className:"in-label"},"INPUT"),i.a.createElement("div",null,o.map(function(e){return i.a.createElement("div",{key:e.id,className:"m-routing"},i.a.createElement("div",{className:"m-name"},e.name),i.a.createElement("div",{className:"in-line"}),o.map(function(t){return i.a.createElement("div",{key:t.id,onClick:function(){return c(e,t)},className:s(e,t)?"m-option connected":"m-option"})}),i.a.createElement("div",{onClick:function(){return u(e)},className:n.isFreeform(e)?"m-option connected":"m-option"}))}))))})),ta=(Object(s.b)(function(e,t){return{orientationRoutings:e.higherOrder.orientationRoutings,modulesLen:t.higherOrderSequencer.modules.length}},function(e){return{setHigherOrderStepsSelected:function(t){return e(Object(c.Lb)(t))}}})(function(e){var t=e.orientation,n=e.higherOrderSequencer,o=e.setHigherOrderStepsSelected,s=Object(a.useRef)(void 0),c=function(e){var t=e.ref,n=e.higherOrderSequencer,i=e.orientation,o=Object(a.useState)(void 0),s=Object(r.a)(o,2),c=s[0],u=s[1],l=Object(a.useState)(void 0),f=Object(r.a)(l,2),h=f[0],d=f[1];Object(a.useEffect)(function(){return window.addEventListener("keydown",p),function(){return window.removeEventListener("keydown",p)}},[h,d]);var p=Object(a.useCallback)(function(e){if(h&&"Backspace"===e.key){var t=h.from,r=h.to;t=n.getModule(t),-1===r?n.disconnectFromFreeform(t):(r=n.getModule(r),n.disconnectModules(i,t,r)),d(void 0)}},[h,d]),v=function(e){var n=t.current.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}},m=Object(a.useCallback)(function(e){h&&d(void 0),c&&n.connectModules(i,c.module,e)},[c,h,d]);return{onMouseMove:Object(a.useCallback)(function(e){if(c){var t=v(e),n=t.x,r=t.y;u(Object(ot.a)({},c,{x2:n,y2:r}))}},[c,u]),onMouseUp:m,onMouseDown:Object(a.useCallback)(function(e,t){var n=v(e),r=n.x,a=n.y;u({module:t,x1:r,y1:a,x2:r,y2:a})},[u]),setDragging:u,dragging:c,selectedEdge:h,setSelectedEdge:d}}({ref:s,orientation:t,higherOrderSequencer:n}),u=c.selectedEdge,l=c.setSelectedEdge,f=c.onMouseMove,h=c.onMouseUp,d=c.onMouseDown,p=c.setDragging,v=c.dragging;Object(a.useEffect)(function(){u&&o(void 0)},[u]);var m=n.routings[t],y=n.modules,b=function(){return{x:0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?10:70,y:10+27*(arguments.length>1?arguments[1]:void 0)}},g=function(e){for(var t=n.modules,r=0;r<t.length;r++)if(t[r].id===e)return r;return-1},O=Object(a.useCallback)(function(){return{x:25,y:b(0,n.modules.length).y}},[]),j=Object(a.useCallback)(function(){v&&n.connectToFreeform(v.module)},[v]),k=Object.keys(m),w=O(),x=w.x,S=w.y;return i.a.createElement("svg",{height:S+15,width:100,ref:s,onMouseUp:function(){return p(void 0)},onMouseLeave:function(){return p(void 0)},onMouseMove:f,className:"orientation-routing"},i.a.createElement("marker",{id:"o-arrowhead",markerWidth:"10",markerHeight:"8",refX:"4",refY:"2",orient:"auto"},i.a.createElement("polygon",{points:"0 0, 5 2, 0 4",fill:"white"})),v&&i.a.createElement("line",{stroke:"white",x1:v.x1,x2:v.x2,y1:v.y1,y2:v.y2}),n.freeformModules.map(function(e){var t=b(0,g(e.id)),n=O(),r=t.x,a=t.y,o=n.x+15,s=n.y,c="M ".concat(r,",").concat(a," C ").concat(r+30,", ").concat(a," ").concat(r+15,", ").concat(a+5," ").concat(o,", ").concat(s),f="module-edge";return u&&-1===u.to&&u.from===e.id&&(f+=" selected"),i.a.createElement("path",{onMouseUp:function(t){t.stopPropagation(),l({from:e.id,to:-1})},className:f,markerEnd:"url(#o-arrowhead)",stroke:"white",d:c})}),k.map(function(e){return m[e].map(function(t){var n,r,a,o,s=b(0,g(e)),c=b(1,g(t.id)),f=(n=s.x,r=s.y,a=c.x,o=c.y,"M "+n+", "+r+" C "+(n+a)/2+", "+r+","+(n+a)/2+", "+o+","+(a-10)+", "+o),h="module-edge";return u&&u.from===e&&u.to===t.id&&(h+=" selected"),i.a.createElement("path",{onMouseUp:function(n){n.stopPropagation(),l({from:e,to:t.id})},d:f,markerEnd:"url(#o-arrowhead)",stroke:"white",className:h})})}),y.map(function(e,t){return i.a.createElement("g",null,i.a.createElement("circle",{onMouseDown:function(t){return d(t,e)},fill:"white",cx:b(0,t).x,cy:b(0,t).y,r:10}),i.a.createElement("text",{x:7,y:5+b(0,t).y,fill:"black"},e.name))}),y.map(function(e,t){var n=b(1,t),r=n.x,a=n.y;return i.a.createElement("g",null,i.a.createElement("circle",{onMouseUp:function(){return h(e)},fill:"white",cx:r,cy:a,r:10}),i.a.createElement("text",{x:2+r-5,y:5+a,fill:"black"},e.name))}),i.a.createElement("rect",{onMouseUp:j,fill:"white",x:x,y:S,width:30,height:15}),i.a.createElement("text",{fill:"black",x:6+x,y:S+11},"Free"))}),Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.sequencer,n=e.orientation,s=e.type,c=e.name,u=Object(a.useState)(t.algorithmTypes[n].includes(s)),l=Object(r.a)(u,2),f=l[0],h=l[1],d=Object(a.useCallback)(function(){t.algorithmTypes[n]=f?t.algorithmTypes[n].filter(function(e){return e!==s}):[].concat(Object(o.a)(t.algorithmTypes[n]),[s]),h(!f)},[t,f,h]),p="algorithm-choice";return f&&(p+=" chosen"),i.a.createElement("div",{onClick:d,className:p},c)})),na=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t={};return 0===e.orientation?(t.borderLeft="32px solid white",t.borderTop="32px solid transparent"):(t.borderRight="32px solid white",t.borderBottom="32px solid transparent"),i.a.createElement("div",{className:"triangle-icon",style:t})}),ra=n(899),aa=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.orientation,n=e.higherOrderSequencer;return i.a.createElement("div",{className:"algorithm-chooser"},i.a.createElement(na,{orientation:t}),i.a.createElement(ea,{orientation:t,higherOrderSequencer:n}),i.a.createElement("div",{className:"algorithm-choices"},i.a.createElement(ta,{orientation:t,sequencer:n,type:ra.a,name:"Play"}),i.a.createElement(ta,{orientation:t,sequencer:n,type:ra.c,name:"Restart"}),i.a.createElement(ta,{orientation:t,sequencer:n,type:ra.d,name:"Roll"}),i.a.createElement(ta,{orientation:t,sequencer:n,type:ra.b,name:"Speed"})))}),ia=new Ot.a,oa=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.i,n=e.mouseDown,r=e.selectedParameters,s=e.setSelectedParameters,c=e.higherOrderSequencer,u=e.parameter,l=e.setParameters,f=u.context,h=f.lfosTrack,d=f.track,p=(f.instrument,f.effect),v=(f.midiEffect,f.subDevice),m=d&&d.subSequence;h&&(m=h.subSequence);var y=Object(a.useCallback)(function(){c.setParameter(u),l(Object(o.a)(c._parameters))},[u]),b=Object(a.useCallback)(function(e){r&&n.current&&s([].concat(Object(o.a)(r),[t]))},[t,r,s]);if(d&&d.isMetronome)return"";if(f.formant&&!f.formant.enabled)return"";var g="parameter-result";return r&&Object(o.a)(r).sort()&&r.includes(t)&&(g+=" selected"),i.a.createElement("div",{onMouseOver:b,onMouseDown:function(e){return e.metaKey&&r?s([].concat(Object(o.a)(r),[t])):s([t])},onClick:y,className:g},m&&i.a.createElement("div",{style:{backgroundColor:m.color},className:"p-sub-sequence"},m.name),i.a.createElement("div",{className:"p-name"},u.name),d&&i.a.createElement("div",{style:{backgroundColor:ia.getColorForTrack(d)},className:"p-track"},d.trackNumber+1,". ",d.getName()),v&&i.a.createElement("div",{style:{backgroundColor:ia.getColorForHash(d?d.getName()+v.name:v.name)},className:"p-sub-device"},v.name),p&&i.a.createElement("div",{className:"p-effect"},p.name))}),sa=n(39),ca=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.higherOrderSequencer,n=e.setParameters,o=Object(a.useState)(""),s=Object(r.a)(o,2),c=s[0],u=s[1],l=Object(a.useState)([]),f=Object(r.a)(l,2),h=f[0],d=f[1],p=Object(a.useState)(void 0),v=Object(r.a)(p,2),m=v[0],y=v[1],b=Object(a.useRef)(!1);Object(a.useEffect)(function(){d(""!==c?sa.a.search(c).filter(function(e){return e.audioParam||e.audioParams}):[])},[c,d]),Object(a.useEffect)(function(){y(void 0)},[h,y]);var g=Object(a.useCallback)(function(){var e=Array.from(new Set(m.map(function(e){return h[e]}))),r=t.createMacro(e);y(void 0),n([r.macroParameter])},[m,h,y]),O=Object(a.useCallback)(function(e){u(e.target.value)},[u]);return i.a.createElement("div",{onMouseDown:function(){return b.current=!0},onMouseUp:function(){return b.current=!1},onMouseLeave:function(){return b.current=!1},className:"parameter-searcher"},i.a.createElement("input",{placeholder:"Search for parameters",className:"parameter-searcher",value:c,type:"text",onChange:O}),i.a.createElement("div",{onClick:function(){return u("")},className:"delete-btn"},"x"),i.a.createElement("div",{className:"parameter-results"},h.filter(function(e){return!t._parameters.includes(e)}).filter(function(e){return!e.hasMacro}).map(function(e,r){return i.a.createElement(oa,{mouseDown:b,selectedParameters:m,setSelectedParameters:y,i:r,setParameters:n,higherOrderSequencer:t,key:e.id+"-"+r,parameter:e})})),m&&i.a.createElement("div",{onClick:g,className:"create-macro-btn"},"Create Macro (",m.length,")"))}),ua=Object(s.b)(function(e,t){return{len:t.effect._parameters.length,_parameters:t.effect._parameters}},function(e){return{}})(function(e){var t=e.effect,n=e.children,s=e.len,c=e._parameters,u=e.isDraggable,l=Object(a.useState)(t._parameters),f=Object(r.a)(l,2),h=f[0],d=f[1];return Object(a.useEffect)(function(){d(c)},[s,d,t]),i.a.createElement("div",{className:"acc-column mappings parameters-list"},h.map(function(e,n){return i.a.createElement(ln,{isDraggable:u,key:n,onMapped:function(){return d(Object(o.a)(t._parameters))},i:n,effect:t})}),i.a.createElement(ln,{isDraggable:u,key:h.length,onMapped:function(){return d(Object(o.a)(t._parameters))},effect:t,i:h.length}),n)}),la=Object(s.b)(function(e,t){return{}},function(e){return{setIsMacroMapping:function(t){return e(Object(c.Nb)(t))},setAccumulatorParameterSelected:function(t){return e(Object(c.n)(t))}}})(function(e){var t=e.higherOrderSequencer,n=Object(a.useState)([]),o=Object(r.a)(n,2),s=o[0],c=o[1];return i.a.createElement("div",{className:"higher-order-parameters"},i.a.createElement("div",null,i.a.createElement(ua,{parametersList:s,effect:t}),i.a.createElement(Ft.a,{name:"Depth",sequencerEngine:t.sequencerEngine,min:0,max:1,step:.001,parameter:t.automationDepthParameter})),i.a.createElement(ca,{parametersList:s,setParameters:c,higherOrderSequencer:t}))}),fa=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.higherOrderSequencer;e.selected;return i.a.createElement("div",{className:"higher-sidebar"},i.a.createElement(fr,null),i.a.createElement("div",{className:"inner-higher-sidebar"},i.a.createElement("div",null,i.a.createElement(aa,{higherOrderSequencer:t,orientation:0}),i.a.createElement(aa,{higherOrderSequencer:t,orientation:1})),i.a.createElement(la,{higherOrderSequencer:t})))}),ha=Object(s.b)(function(e,t){return{trackStep:t.sequencerEngine.trackStep,playing:t.sequencerEngine.playing}},function(e){return{}})(function(e){var t=e.playing,n={left:e.trackStep%32*16};return t?i.a.createElement("div",{style:n,className:"higher-playhead"}):""}),da=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.setDragging,n=e.dragging,s=e.isDragging,c=e.setSelected,u=e.orientation,l=e.stepData,f=e.size,h=e.higherOrderSequencer,d=e.isSelected,p=e.setSelection,v=e.x,m=e.y,y=Object(kn.a)(e,["setDragging","dragging","isDragging","setSelected","orientation","stepData","size","higherOrderSequencer","isSelected","setSelection","x","y"]),b=Object(a.useRef)(void 0),g=Object(a.useRef)(!1),O=Object(a.useState)(l.module&&l.module.color),j=Object(r.a)(O,2),k=(j[0],j[1]),w="higher-order-step";s&&(w+=" dragging");var x=Je({ref:b}),S=x.onContextMenu,P=x.dropdownPos;x.setDropdownPos;Object(a.useEffect)(function(){k(y.color)},[y.color,k]);w+=" on",w+=" orientation-"+u;var E=function(e){var t=e.setSelection,n=e.acted,r=e.setSelected,i=e.higherOrderSequencer,o=e.dragging,s=e.setDragging,c=Object(a.useCallback)(function(e,t){n.current&&o&&o.x===e&&o.y==t&&i.toggle(e,t),s(void 0)},[s,o]);return{onMouseDown:Object(a.useCallback)(function(e,a,o){o.metaKey?t({x1:e,y1:a,x2:e,y2:a}):(s({x:e,y:a}),r([i.matrix[e][a]]),n.current=!0)},[s,t]),onMouseUp:c}}({setSelection:p,acted:g,setSelected:c,higherOrderSequencer:h,dragging:n,setDragging:t}),T=E.onMouseDown,A=E.onMouseUp,M=[32*v,32*m];M=[].concat(Object(o.a)(M),0===u?[32*v,32*(m+f),32*(v+f),32*(m+f)]:[32*(v+f),32*m,32*(v+f),32*(m+f)]);Object(a.useCallback)(function(e){l&&(l.module=e,e&&k(e.color))},[v,m,k,l]);P&&(w+=" context"),d&&(w+=" selected");h.sequencerEngine.subSequences;return i.a.createElement("polygon",{points:M,ref:b,onContextMenu:function(e){l&&(S(e),t(void 0))},onMouseDown:function(e){e.stopPropagation(),T(v,m,e)},onMouseUp:function(e){e.stopPropagation(),P||A(v,m)},style:{},className:w})}),pa=function(e){var t=e.x,n=e.higherOrderSequencer,r=e.dragging,o=e.setDragging,s=e.selected,c=e.setSelected,u=e.selection,l=e.setSelection,f=Object(a.useRef)(!1),h=Object(a.useCallback)(function(e,a){if(u)return c(n.getSelection(u)),l(void 0);r&&r.x===t&&r.y==e&&(f.current||a.metaKey||n.toggle(t,e)),o(void 0),f.current=!1},[t,c,o,r,u,l]),d=Object(a.useCallback)(function(e){if(u)l(Object(ot.a)({},u,{x2:t,y2:e}));else if(r){r.x,r.y;var a=Math.max(t-r.x,e-r.y);a>=0&&n.setStepSize(r.x,r.y,a+1)}},[r,o,u,l]),p=Object(a.useCallback)(function(e,r){r.metaKey?l({x1:t,y1:e,x2:t,y2:e}):(n.matrix[t][e]||(f.current=!0,n.toggle(t,e)),o({x:t,y:e}),c([n.matrix[t][e]]))},[l,u,o]),v=Object(a.useCallback)(function(e,n){var r="higher-step";if(n%2===0&&(r+=" even"),s&&s.includes(e)&&(r+=" selected"),u){var a=u.x1,i=u.y1,o=u.x2,c=u.y2;a<=t&&t<=o&&i<=n&&n<=c&&(r+=" selection")}return r},[s,u]);return i.a.createElement("div",{className:t%2==0?"higher-col even":"higher-col"},n.matrix[t].map(function(e,t){return i.a.createElement("div",{onMouseLeave:function(){return f.current=!1},onMouseOver:function(){return d(t)},onMouseDown:function(e){return p(t,e)},onMouseUp:function(e){return h(t,e)},className:v(e,t)})}))},va=(n(1811),Object(s.b)(function(e,t){return{matrix:e.higherOrder.matrix,selected:e.higherOrder.selectedSteps,show:e.higherOrder.show}},function(e){return{setShowHigherOrderSequencer:function(t){return e(Object(c.Rd)(t))},setSelected:function(t){return e(Object(c.Lb)(t))}}})(function(e){e.setShowHigherOrderSequencer;var t=e.sequencerEngine,n=e.selected,o=e.setSelected,s=t.higherOrderSequencer,c=s.matrix,u=Object(a.useState)(void 0),l=Object(r.a)(u,2),f=l[0],h=l[1],d=Object(a.useState)(void 0),p=Object(r.a)(d,2),v=p[0],m=p[1],y=Object(a.useState)(void 0),b=Object(r.a)(y,2),g=b[0],O=b[1];Object(a.useEffect)(function(){return window.addEventListener("mouseup",j),function(){window.removeEventListener("mouseup",j)}},[h]),Object(a.useEffect)(function(){return function(){return o(void 0)}},[]),function(e){var t=e.selected,n=e.setSelected,r=e.higherOrderSequencer;Object(a.useEffect)(function(){return window.addEventListener("keydown",i),function(){window.removeEventListener("keydown",i)}},[,t,n]);var i=Object(a.useCallback)(function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)if("Backspace"===e.key)e.preventDefault(),t&&t.length>0&&(r.deleteSteps(t),n(void 0));else{if(!t)return;var a=0,i=0;if("Enter"===e.key)return e.preventDefault(),void t.forEach(function(e){var t=e.x,n=e.y;return r.toggle(t,n)});"ArrowLeft"===e.key?(e.preventDefault(),a--):"ArrowUp"===e.key?(e.preventDefault(),i--):"ArrowRight"===e.key?(e.preventDefault(),a++):"ArrowDown"===e.key&&(e.preventDefault(),i++),t.forEach(function(e){return r.moveStepTo(e.x,e.y,e.x+a,e.y+i)})}},[t,n])}({higherOrderSequencer:s,setSelected:o,selected:n});var j=Object(a.useCallback)(function(){h(void 0),O(!1)},[h]),k=Object(a.useCallback)(function(){f&&O(!0)},[f,O]),w=v?"shape-container selection":"shape-container";return g&&(w+=" moving"),i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},onMouseMove:k,className:"higher-order-component"},i.a.createElement("div",{className:"higher-inner"},i.a.createElement(ha,{sequencerEngine:t}),c.map(function(e,t){return i.a.createElement(pa,{setSelection:m,selection:v,setSelected:o,selected:n,setDragging:h,dragging:f,x:t,higherOrderSequencer:s})}),i.a.createElement("svg",{className:w},s.steps.map(function(e){return i.a.createElement(da,{setSelected:o,setSelection:m,isSelected:n&&n.includes(e),dragging:f,x:e.x,y:e.y,orientation:e.orientation,isDragging:f&&f.x===e.x&&f.y===e.y,size:e.size,setDragging:h,color:e.module&&e.module.color,stepData:e,higherOrderSequencer:s})}),s.automationPaths&&i.a.createElement(lr,{automationPaths:s.automationPaths}))),i.a.createElement(fa,{higherOrderSequencer:s,selected:n}))})),ma=(n(1812),Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.zobject,n=t.effect;return i.a.createElement("div",{className:"composite-objects"},n.objects.map(function(e){return i.a.createElement(Rf,{composite:t,zobject:e})}))})),ya=(n(1813),Object(s.b)(function(e,t){return{_presets:t.zobject.effect.presets}},function(e){return{}})(function(e){var t=e._presets,n=e.zobject,s=Object(a.useState)(t),c=Object(r.a)(s,2),u=c[0],l=c[1],f=Object(a.useState)(void 0),h=Object(r.a)(f,2),d=h[0],p=h[1],v=Object(a.useState)(),m=Object(r.a)(v,2),y=m[0],b=m[1];Object(a.useEffect)(function(){l(t)},[l,t]);var g=Object(a.useCallback)(function(e,r){r.stopPropagation();var a=Object(o.a)(t),i=a[e];a[e]=a[y],a[y]=i,n.effect.presets=a,l(a),p(e)},[l,t,y,b,p]);return i.a.createElement("div",{onMouseLeave:function(){return b(void 0)},className:"z-preset"},u.map(function(e,t){return i.a.createElement("div",{onDrop:function(e){return g(t,e)},draggable:!0,onDragOver:function(e){return e.preventDefault()},onDragStart:function(){return b(t)},onClick:function(){t===d?(p(void 0),n.effect.current=void 0):(n.effect.loadPreset(t),p(t))},className:e?t===d?"z-preset-option selected":"z-preset-option":"z-preset-option empty"},e?t+1:"")}))})),ba=(n(1814),Object(s.b)(function(e,t){return{fxPreset:t.zobject.effect.fxPreset}},function(e){return{}})(function(e){e.zobject,e.fxPreset;return i.a.createElement("div",{className:"spore-editor"})})),ga=n(984),Oa=(n(1815),Object.keys(ga.a)),ja=Object(s.b)(function(e,t){return{_scale:t.zscale._scale}},function(e){return{}})(function(e){var t=e._scale,n=e.zscale,o=Object(a.useRef)(),s=Object(a.useState)(t),c=Object(r.a)(s,2),u=c[0],l=c[1],f=Object(a.useState)([]),h=Object(r.a)(f,2),d=h[0],p=h[1];Ze(o);var v=Object(a.useCallback)(function(e){n._scale=e,n.bang(),p([]),l(e)},[l,p]);Object(a.useEffect)(function(){t&&l(t)},[t,l]);var m=Object(a.useCallback)(function(e){var t=e.target.value;l(t),t=t.toLowerCase();var n=Oa.filter(function(e){return e.toLowerCase().includes(t)});p(n)},[l,p]);return i.a.createElement("div",{ref:o,className:"z-scale"},i.a.createElement("div",{className:"label"},"scale: "),i.a.createElement("input",{onClick:function(){return p(Oa)},className:"scale-input",value:u,onChange:m,type:"text"}),d.length>0&&i.a.createElement("div",{className:"auto-complete"},d.map(function(e){return i.a.createElement("div",{onClick:function(){return v(e)},className:"possibility"},e)})))}),ka=function(e){return Math.round(1e3*e)/1e3},wa=Object(s.b)(function(e,t){var n={isUniform:t.znumber.attributes["glsl uniform"],uxLocked:e.zobject.uxLocked};return t.isAttribute||(n.round=t.znumber.round,n.number=t.znumber._text),n},function(e){return{setSelectedZObject:function(t){return e(Object(c.Ed)(t))}}})(function(e){var t=e.znumber,n=e.unit,o=void 0===n?"":n,s=e.number,c=e.uxLocked,u=e.skipSelect,l=void 0!==u&&u,f=e.isSelectedZObject,h=e.setSelectedZObject,d=e.color,p=e.onChange,v=e.hideNumber,m=e.isUniform,y=Object(a.useRef)(void 0),b=Object(a.useState)(s),g=Object(r.a)(b,2),O=g[0],j=g[1],k=Object(a.useState)(!1),w=Object(r.a)(k,2),x=w[0],S=w[1];Object(a.useEffect)(function(){return window.addEventListener("mouseup",E),window.addEventListener("mousemove",P),function(){window.removeEventListener("mouseup",E),window.removeEventListener("mousemove",P)}},[S,x,j]),Object(a.useEffect)(function(){j(s)},[s,j]);var P=Object(a.useCallback)(function(e){if(x){var n=x.y,r=x.number,a=(n-e.pageY)/n*(t.max-t.min)+r;a=Math.max(t.min,Math.min(t.max,a)),t.round&&(a=Math.round(a)),a!==t._text&&(t.text=a,t.execute&&t.execute(),j(a),p&&p(a))}},[S,x,j,p]),E=Object(a.useCallback)(function(e){x&&S(!1)},[S,x]);return i.a.createElement("div",{style:{color:d},ref:y,onMouseDown:function(e){c&&S({number:s,y:e.pageY}),t.execute&&!l&&h(t)},className:m?"z-number is-uniform":"z-number"},i.a.createElement("div",{style:{borderLeftColor:t.attributes["secondary-color"]},onMouseDown:function(e){e.stopPropagation(),S({number:s,y:e.pageY}),t.execute&&!l&&h(t)},className:f?"selected arrow-right":"arrow-right"}),v?"":ka(O)," ",o)}),xa=n(138),Sa=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.error;t=t.text;for(var n=[],r=xa.j.map(function(e){return t.indexOf(e)}).filter(function(e){return e>-1}),a=function(){var e=Math.min.apply(Math,Object(o.a)(r)),a=t.slice(0,e);n.push({type:"regular",text:a});var i=t.slice(e),s=xa.j.find(function(e){return i.startsWith(e)});if(!s)return"break";n.push({type:"type",text:s}),t=i.slice(s.length),r=xa.j.map(function(e){return t.indexOf(e)}).filter(function(e){return e>-1})};r.length>0&&"break"!==a(););return n.push({type:"regular",text:t}),i.a.createElement("div",{className:"compilation-error-message"},i.a.createElement("span",{className:"error-label"},"Type Mismatch: "),n.map(function(e){return i.a.createElement("span",{className:"type"===e.type?"type":""},e.text)}))}),Pa=Object(s.b)(function(e,t){return{compilationError:t.object.compilationError,drawingEdge:t.object&&t.object.subSequence&&e.pads.drawingEdges[t.object.subSequence.id],movingEdge:e.pads.movingEdge}},function(e){return{setZObjectTooltip:function(t,n,r,a,i){return e(Object(c.jf)(t,n,r,a,i))},setSelectedPadEdge:function(t){return e(Object(c.wd)(t))}}})(function(e){var t=e.children,n=e.object,r=e.zobject,o=void 0===r?{object:n}:r,s=e.compilationError,c=e.inlet,u=e.movingEdge,l=e.drawingEdge,f=e.setZObjectTooltip,h=e.setSelectedPadEdge,d=Object(a.useRef)(),p=Object(a.useCallback)(function(){l&&l.type?Object(X.a)(Object($.d)(l.node,l.type,n,c)):u&&(jt(n,c,u),h(void 0))},[n,c,l,u]),v=Object(a.useCallback)(function(e){f(void 0)},[]),m=Object(a.useCallback)(function(e){if(o&&o.windowPosition){var t=o.windowPosition,r=t.x+d.current.offsetLeft+15,a=t.y+d.current.offsetTop,i=n.inlets[c].type;i.or&&(i=i.or),f(o.subSequence.id,{x:r,y:a},c,i)}},[]),y="inlet-field ",b=!1;return s&&s.inlet===c&&(y+=" compilation-error",b=!0),i.a.createElement("div",{ref:d,className:y},i.a.createElement("div",{onMouseOver:m,onMouseLeave:v,className:n.isInletConnected(c)?"inlet connected":"inlet",id:n.getFullType(c),onMouseUp:p}),t,b&&i.a.createElement(Sa,{error:s}))}),Ea=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.name,n=e.value,r=e.onChange,a=e.isEditable,o=void 0===a||a;return i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},onClick:function(e){return e.stopPropagation()},className:"toggle-switch"},i.a.createElement("div",{className:"label"},t),i.a.createElement("div",{onClick:function(e){e.stopPropagation(),o&&r(!n)},className:n?"switch on":"switch"},i.a.createElement("div",{className:"dot"})))}),Ta=function(e){var t=e.object,n=e.name,o=e.setter,s=e.color,c=e.editing,u=e.setEditing,l=e.zobject,f=Object(a.useState)(s),h=Object(r.a)(f,2),d=h[0],p=h[1],v=Object(a.useCallback)(function(e){o(e.hex),p(e.hex)},[p,o]);return i.a.createElement(Pa,{zobject:l,object:t,inlet:n},i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},className:"sdf-field color-field"},i.a.createElement("div",{className:"field-name"},n),i.a.createElement("div",{onClick:function(){return u(!c)},style:{backgroundColor:d},className:"color-btn"},s?"":"GL"),c&&i.a.createElement(It.a,{onChange:v,color:{hex:d}})))},Aa=function(e){var t=e.layer,n=e.name,r=e.number,a=e.zobject;return i.a.createElement(Pa,{object:t,inlet:n,zobject:a},i.a.createElement("div",{className:"sdf-field"},i.a.createElement("div",{className:"field-name"},n),t.glNumbers?t.glNumbers[n]?i.a.createElement("div",{className:"is-gl"},"GL"):r&&i.a.createElement(wa,{onChange:function(e){return t.updateNumber(n,e)},znumber:r}):""))},Ma=Object(s.b)(function(e,t){return{intersectPreviousLayer:t.layer.intersectPreviousLayer}},function(e){return{}})(function(e){var t=e.layer,n=e.number,o=e.deleteLayer,s=e.sdfLayers,c=e.setLayers,u=e.stopDragging,l=e.startDragging,f=e.dragging,h=e.setColorEditing,d=e.colorEditing,p=e.intersectPreviousLayer,v=Object(a.useState)(t.intersectPreviousLayer),m=Object(r.a)(v,2),y=m[0],b=m[1];Object(a.useEffect)(function(){b(p)},[b,p]);var g=Object(a.useCallback)(function(e){t.intersectPreviousLayer=e,b(t.intersectPreviousLayer)},[b]),O=Object(a.useState)(),j=Object(r.a)(O,2),k=j[0],w=j[1],x=Object(a.useState)(t.name||""),S=Object(r.a)(x,2),P=S[0],E=S[1],T=Object(a.useCallback)(function(){if(f)if(f!==t){var e=t.zObject.effect,n=f.zObject.effect;n.layers=n.layers.filter(function(e){return e!==f});var r=e.layers.indexOf(t);f.zObject=t.zObject,e.layers.splice(r,0,f),c(s.layers),s.compile(),u()}else u()},[f,u,c,t]),A=Object(a.useCallback)(function(){w(!0)},[w]),M=Object(a.useCallback)(function(e){"Enter"===e.key&&(t.name=P,w(!1))},[w,P]),R=et(A);return console.log("editing =",d),i.a.createElement("div",{onDrop:T,className:d?"layer editing":"layer"},k?i.a.createElement("input",{onKeyDown:M,value:P,onChange:function(e){return E(e.target.value)}}):i.a.createElement("div",{draggable:!0,onDragOver:function(e){return e.preventDefault()},onClick:R,onMouseDown:function(e){return e.stopPropagation()},onDragStart:l,className:"layer-name"},t.name||"Layer "+n,i.a.createElement("div",{onClick:o,className:"delete-layer"},"x")),i.a.createElement("div",{className:"fields"},i.a.createElement(Aa,{zobject:s.zObject,layer:t,name:"SDF"}),i.a.createElement(Ta,{zobject:s.zObject,editing:d===t.MAIN_COLOR,setEditing:function(e){return h(e&&t.MAIN_COLOR)},object:t,name:"color",setter:function(e){return t.setUXBackground(e)},color:t.background?void 0:t.uxColorHex}),i.a.createElement(Aa,{zobject:s.zObject,layer:t,name:"blur",number:t.numbers.blur}),i.a.createElement(Aa,{zobject:s.zObject,layer:t,name:"value",number:t.numbers.value}),y||Array.isArray(p)?i.a.createElement(Ta,{zobject:s.zObject,editing:d===t.INTERSECT_COLOR,setEditing:function(e){return h(e&&t.INTERSECT_COLOR)},object:t,name:"intersectColor",setter:function(e){return t.setUXIntersectColor(e)},color:t.intersectColor?void 0:t.intersectColorHex}):"",i.a.createElement(Pa,{object:t,inlet:"intersect",zobject:s.zobject},i.a.createElement(Ea,{name:"intersect",value:y,onChange:g}))))}),Ra=(n(1816),Object(s.b)(function(e,t){return{_layers:t.sdfLayers.layers,dragging:e.zobject.layerDragging}},function(e,t){return{setDragging:function(t){return e(Object(c.dc)(t))}}})(function(e){var t=e.sdfLayers,n=e._layers,s=e.dragging,c=e.setDragging,u=Object(a.useState)(t.layers),l=Object(r.a)(u,2),f=l[0],h=l[1],d=Object(a.useState)(void 0),p=Object(r.a)(d,2),v=p[0],m=p[1],y=Object(a.useCallback)(function(){t.newLayer(),h(Object(o.a)(t.layers))},[h]),b=Object(a.useCallback)(function(e){t.layers=t.layers.filter(function(t){return t!==e}),t.compile(),h(t.layers)},[h]);return Object(a.useEffect)(function(){h(n)},[n,h]),f?(console.log("colorediting=",v),i.a.createElement("div",{className:"sdf-layers"},t&&i.a.createElement(Aa,{name:"enable",layer:t}),i.a.createElement(Ta,{setEditing:function(e){return m(e?t:void 0)},editing:v===t,object:t,name:"color",color:t.background?void 0:t.uxColorHex,setter:function(e){return t.setUXBackground(e)}}),f.map(function(e,n){return i.a.createElement(Ma,{deleteLayer:function(){return b(e)},sdfLayers:t,setColorEditing:m,colorEditing:v,setLayers:h,stopDragging:function(){return c(void 0)},dragging:s,startDragging:function(){return c(e)},key:e.id,number:n+1,layer:e})}),i.a.createElement("div",{onClick:y,className:"new-layer pushable"},"+"))):""})),Ca=n(900),Na=(n(1817),Object(s.b)(function(e,t){return{_snapshots:t.snapshots.snapshots,len:t.snapshots.snapshots.length}},function(e){return{}})(function(e){var t=e.snapshots,n=e._snapshots,r=void 0===n?[]:n;return i.a.createElement("div",{className:"snapshots"},i.a.createElement("div",{onClick:function(){return t.takeSnapshot()},className:"pushable take-snapshot"},"Take Snapshot"),r.map(function(e,n){return i.a.createElement("div",{onClick:function(){return t.useSnapshot(e)},className:"snapshot-option pushable"},n+1)}),i.a.createElement("div",{onClick:function(){return t.snapshots.splice(-1)},className:"btn-x"},"x"))})),Ia=Object(s.b)(function(e,t){return{url:t.zobject.effect.url}},function(e){return{}})(function(e){var t=e.url;return i.a.createElement("img",{className:"z-icon-image",src:window.isNFT?t:"/"+t})}),qa=(n(1818),function(e){var t=e.probabilities,n=e.mouseDown,o=e.setMouseDown,s=e.type,c=e.jtypes,u=e.height,l=void 0===u?80:u,f=Object(a.useState)(c.probabilities[s]||0),h=Object(r.a)(f,2),d=h[0],p=h[1],v=Object(a.useRef)();Object(a.useEffect)(function(){p(t[s])},[p,t]);var m=Object(a.useCallback)(function(e){if(!n)return!1;var t=v.current.getBoundingClientRect(),r=(l-(e.clientY-t.top))/l;p(r),c.setProbability(s,r)},[p,n,l]);return i.a.createElement("div",{ref:v,className:"j-type"},i.a.createElement("div",{onMouseUp:function(){return o(!1)},onMouseDown:function(e){e.stopPropagation(),o(!0)},onMouseMove:m,className:"j-slider"},i.a.createElement("div",{style:{height:l*d},className:"j-slider-inner"})),i.a.createElement("div",{className:"cell"},i.a.createElement(Hn,{cell:{type:s}})))}),_a=Object(s.b)(function(e,t){return{probabilities:t.jtypes.probabilities}},function(e){return{}})(function(e){var t=e.jtypes,n=e.probabilities,o=Object(a.useState)(!1),s=Object(r.a)(o,2),c=s[0],u=s[1];Object(a.useEffect)(function(){return window.addEventListener("mouseup",l),function(){return window.removeEventListener("mouseup",l)}},[u]);var l=Object(a.useCallback)(function(){u(!1)},[u]);return t&&t.probabilities?i.a.createElement("div",{className:"jaki-grid j-types"},i.a.createElement(qa,{probabilities:n,mouseDown:c,setMouseDown:u,type:"rest",jtypes:t}),i.a.createElement(qa,{probabilities:n,mouseDown:c,setMouseDown:u,type:"pianissimo",jtypes:t}),i.a.createElement(qa,{probabilities:n,mouseDown:c,setMouseDown:u,type:"piano",jtypes:t}),i.a.createElement(qa,{probabilities:n,mouseDown:c,setMouseDown:u,type:"regular",jtypes:t}),i.a.createElement(qa,{probabilities:n,mouseDown:c,setMouseDown:u,type:"accent",jtypes:t}),i.a.createElement(qa,{probabilities:n,mouseDown:c,setMouseDown:u,type:"staccato",jtypes:t}),i.a.createElement(qa,{probabilities:n,mouseDown:c,setMouseDown:u,type:"legato",jtypes:t}),i.a.createElement(qa,{probabilities:n,mouseDown:c,setMouseDown:u,type:"double",jtypes:t}),i.a.createElement(qa,{probabilities:n,mouseDown:c,setMouseDown:u,type:"flam",jtypes:t})):""}),Da=(n(1819),Object(s.b)(function(e,t){return{width:t.zobject.width,height:t.zobject.height,attributes:t.zobject.attributes}},function(e){return{}})(function(e){var t=e.zobject,n=e.attributes,r={width:t.width-10,height:t.width-10,borderRadius:t.width-10,borderColor:n["secondary-color"],backgroundColor:n["button-color"]};return i.a.createElement("div",{style:r,onMouseLeave:function(){return t.effect.sendMessage("on released",gt.a)},onMouseDown:function(){return t.effect.sendMessage("on pressed",gt.a)},onMouseUp:function(){return t.effect.sendMessage("on released",gt.a)},className:"z-button-presser"})})),Fa=(n(903),Object(s.b)(function(e,t){var n=t.zobject;return n.effect?{width:n.width,height:n.height,x:n.effect.x,y:n.effect.y,attributes:n.attributes}:{}},function(e){return{}})(function(e){var t=e.zobject,n=e.attributes,o=e.width,s=e.height,c=e.x,u=e.y,l=Object(a.useRef)(void 0),f=Object(a.useState)({x:c,y:u}),h=Object(r.a)(f,2),d=h[0],p=h[1],v=Object(a.useState)(!1),m=Object(r.a)(v,2),y=m[0],b=m[1];Object(a.useEffect)(function(){p({x:c,y:u})},[c,u,p]);var g=Object(a.useCallback)(function(e,n){if(y||n){n&&b(!0);var r=l.current.getBoundingClientRect(),a=(e.clientX-r.left)/o,i=1-(e.clientY-r.top)/s;t.effect.setXY(a,i),p({x:a,y:i})}},[y,b,p,o,s]),O=n["secondary-color"]||"white",j={backgroundColor:n["primary-color"]||"black"};return i.a.createElement("svg",{style:j,ref:l,onMouseUp:function(e){return b(!1)},onMouseDown:function(e){return g(e,!0)},onMouseMove:g,width:o,height:s,className:"xy-interface"},i.a.createElement("circle",{fill:O,onMouseDown:function(e){e.stopPropagation(),b(!0)},cx:d.x*o,cy:(1-d.y)*s,r:10}))})),La=Object(s.b)(function(e,t){var n=t.zobject;return n.effect?{width:n.width,height:n.height,coordinates:n.effect.coordinates,attributes:n.attributes}:{}},function(e){return{}})(function(e){var t=e.zobject,n=e.attributes,s=e.width,c=e.height,u=(e.x,e.y,Object(a.useRef)(void 0)),l=Object(a.useState)(t.effect.coordinates),f=Object(r.a)(l,2),h=f[0],d=f[1],p=Object(a.useState)(!1),v=Object(r.a)(p,2),m=v[0],y=v[1],b=Object(a.useCallback)(function(e,n){if(void 0!==m||n){n&&y(!0);var r=u.current.getBoundingClientRect(),a=(e.clientX-r.left)/s,i=1-(e.clientY-r.top)/(c-40);t.effect.setXY(a,i,m),d(Object(o.a)(t.effect.coordinates))}},[m,y,d,s,c]),g={backgroundColor:n["primary-color"]||"black"};if(!h)return"";for(var O=[],j=[],k=0;k<t.effect.numberOfCoordinates;k++)O.push(t.attributes["coordinate-name-"+(k+1)]),j.push(t.attributes["coordinate-color-"+(k+1)]);var w=t.attributes["x-axis"],x=t.attributes["y-axis"];return i.a.createElement("div",{className:"multi-xy"},i.a.createElement("div",{className:"x-axis"},w),i.a.createElement("div",{className:"y-axis"},x),i.a.createElement("svg",{style:g,ref:u,onMouseUp:function(e){return y(void 0)},onMouseLeave:function(e){return y(void 0)},onMouseDown:function(e){return b(e,!0)},onMouseMove:b,width:s,height:c-40,className:"xy-interface"},h.map(function(e,t){return i.a.createElement("circle",{fill:n["coordinate-color-"+(t+1)],onMouseDown:function(e){e.stopPropagation(),y(t)},cx:e.x*s,cy:(1-e.y)*(c-40),r:10})})),i.a.createElement("div",{className:"legend"},O.map(function(e,t){return i.a.createElement("div",{className:"legend-type"},i.a.createElement("div",{style:{backgroundColor:j[t]},className:"dot"}),i.a.createElement("div",{className:"legend-name"},e))})))}),Ba=n(364),za=n(904),Ja=(n(1820),Object.keys(za.a).map(function(e){return{value:e,label:e[0].toUpperCase()+e.slice(1)}})),Va=function(e){var t=e.name,n=e.onChange,r=e.get,a=e.builder;return i.a.createElement(Pa,{object:a,inlet:t},i.a.createElement("div",{className:"sdf-field"},i.a.createElement("div",{className:"field-name"},t),i.a.createElement(wa,{onChange:n,znumber:r})))},Ha=Object(s.b)(function(e,t){return{xComponent:t.builder.x,_type:t.builder.type}},function(e){return{}})(function(e){var t=e._type,n=e.builder,o=Object(a.useState)(n.type),s=Object(r.a)(o,2),c=s[0],u=s[1];Object(a.useEffect)(function(){t&&u(t)},[t,u]);var l=Object(a.useCallback)(function(){n.sendObject()},[n]),f=Object(a.useCallback)(function(e){u(e.value),n.type=e.value,n.sendObject()},u,n),h=Object(Ba.g)(c);return n.x?i.a.createElement("div",{className:"sdf-builder"},i.a.createElement(or.a,{value:c,onChange:f,options:Ja}),i.a.createElement(Va,{builder:n,onChange:l,name:"x",get:n.x}),i.a.createElement(Va,{builder:n,onChange:l,name:"y",get:n.y}),h&&i.a.createElement(Va,{builder:n,onChange:l,name:"z",get:n.z}),i.a.createElement(Va,{builder:n,onChange:l,name:"width",get:n.w}),i.a.createElement(Va,{builder:n,onChange:l,name:"height",get:n.h}),h&&i.a.createElement(Va,{builder:n,onChange:l,name:"depth",get:n.d}),i.a.createElement(Va,{builder:n,onChange:l,name:"corner",get:n.c}),!h&&i.a.createElement(Va,{builder:n,onChange:l,name:"rotation",get:n.r}),h&&i.a.createElement(Va,{builder:n,onChange:l,name:"repeat x",get:n.repeatCountX}),h&&i.a.createElement(Va,{builder:n,onChange:l,name:"repeat y",get:n.repeatCountY}),h&&i.a.createElement(Va,{builder:n,onChange:l,name:"repeat z",get:n.repeatCountZ}),h&&i.a.createElement(Va,{builder:n,onChange:l,name:"repeat spread",get:n.repeatSpread})):""}),Ua=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.vec3,n=Object(a.useCallback)(function(){t.sendObject()},[t]);return i.a.createElement("div",{className:"sdf-builder"},i.a.createElement(Va,{builder:t,onChange:n,name:"x",get:t.x}),i.a.createElement(Va,{builder:t,onChange:n,name:"y",get:t.y}),i.a.createElement(Va,{builder:t,onChange:n,name:"z",get:t.z}))}),Ga=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.vec2,n=Object(a.useCallback)(function(){t.sendObject()},[t]);return i.a.createElement("div",{className:"sdf-builder vec-2"},i.a.createElement(Va,{builder:t,onChange:n,name:"x",get:t.x}),i.a.createElement(Va,{builder:t,onChange:n,name:"y",get:t.y}))}),Wa=new Ot.a,Ka=Object(s.b)(function(e,t){return{isMacroMapping:e.effects.isMacroMapping,isParameterToMap:t.parameter&&e.effects.parameterToMap===t.parameter}},function(e){return{setParameterToMap:function(t){return e(Object(c.Ic)(t))}}})(function(e){var t=e.parameter,n=e.isMacroMapping,r=e.isParameterToMap,a=e.setParameterToMap;if(n&&t){var o="macro-overlay";r&&(o+=" parameter-to-map"),t.hasMacro&&(o+=" mapped");var s={};t.hasMacro&&(s={backgroundColor:Wa.getColorForHash(t.hasMacro.id)});var c=t.hasMacro&&t.hasMacro.name;return i.a.createElement("div",{onClick:function(){return a(t)},className:o},i.a.createElement("div",{className:"overlay-main"}),i.a.createElement("div",{className:"overlay-detail",style:s},c))}return""}),Qa=Object(s.b)(function(e,t){return{value:t.parameter.get(),automations:t.parameter.automations&&t.parameter.automations.length>0}},function(e){return{setShowPianoRoll:function(t){return e(Object(c.Wd)(t))},setShowAutomation:function(t){return e(Object(c.Od)(t))},setTrackAutomationParameter:function(t,n){return e(Object(c.pe)(t,n))},setBottomMode:function(t){return e(Object(c.y)(t))}}})(function(e){var t=e.parameter,n=e.value,o=e.fullText,s=e.automations,c=e.setShowAutomation,u=e.setShowPianoRoll,l=e.setBottomMode,f=e.setTrackAutomationParameter,h=e.setParameter,d=e.selectedParameter,p=Object(a.useState)(!1),v=Object(r.a)(p,2),m=(v[0],v[1],t.name.toLowerCase().includes("attack")?o?"Atk":"A":t.name.toLowerCase().includes("decay")?o?"Dec":"D":t.name.toLowerCase().includes("sustain")?o?"Sus":"S":t.name.toLowerCase().includes("level")?"L":o?"Rel":"R"),y="env-param";return"Sustain"===t.name&&(y+=" sustain"),t===d&&(y+=" selected"),i.a.createElement("div",{onClick:function(){return h(t===d?void 0:t)},className:y},i.a.createElement(Ka,{parameter:t}),m,": ",i.a.createElement("span",{className:"param-val"},"Sustain"===t.name||"L"===m?Math.round(10*n)/10:Math.round(n)),s?i.a.createElement("img",{onClick:function(){if(c(!0),u(!0),l(Pe.b),t.track){var e=t.track.instrumentRack?t.track.instrumentRack:t.track;f(e.id,t)}},className:"automation-icon",src:"/automation-icon-disabled.png"}):"")}),Za=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.selectedParameter,n=e.setParameter,r=e.envelope,a=e.hasRelease,o=e.hasLevel,s=e.fullText,c=[r.attackParameter,r.decayParameter,r.sustainParameter];return a&&c.push(r.releaseParameter),o&&c.push(r.levelParameter),i.a.createElement("div",{className:"env-params"},c.map(function(e,r){return i.a.createElement(Qa,{key:"param-"+r,selectedParameter:t,setParameter:n,parameter:e,fullText:s})}))}),Ya=n(133),$a=n(176),Xa=Math.sqrt(8e3),ei=Math.sqrt(1e4),ti=function(e,t,n){return 5+.8*n*Math.sqrt(e)/Math.max(Xa,t)},ni=new Ot.a,ri=function(e,t,n,r,a){for(var o=[],s=function(s){var c=2===s?a?[t.attackParameter,t.levelParameter]:[t.attackParameter]:4===s?[t.decayParameter,t.sustainParameter]:6===s?[t.sustainParameter,t.releaseParameter]:[t.releaseParameter],u=e[s],l=e[s+1],f=(e[s+2],e[s+3],!1);n&&(f=n[0]===c[0]),o.push(i.a.createElement("circle",{key:s,onMouseDown:function(e){e.stopPropagation(),r(c)},cx:u,cy:l,r:3,className:f?"selected point":"point",fill:"#2fffec",strokeWidth:2}))},c=2;c<e.length-3;c+=2)s(c);return o},ai=function(e,t,n,r){for(var a=[],o=0;o<e.length-3;o+=2){var s=e[o],c=e[o+1],u=e[o+2],l=e[o+3];a.push(i.a.createElement("polygon",{key:"poly-"+o,points:[s,t,s,c,u,l,u,t],fill:r||"red",strokeWidth:1})),a.push(i.a.createElement("line",{key:"line-"+o,x1:s,y1:c,x2:u,y2:l,strokeWidth:2,stroke:n||"red"}))}return a},ii=Object(s.b)(function(e,t){var n=t.envelope;return{attack:n.attackParameter.get(),decay:n.decayParameter.get(),sustain:n.sustainParameter.get(),release:n.releaseParameter.get(),level:n.levelParameter&&n.levelParameter.get(),selectedParameter:e.effects.accumulatorParameterSelected}},function(e){return{setParameterSliderDown:function(t){return e(Object(c.Hc)(t))},setPullablePartDragging:function(t){return e(Object(c.cd)(t))}}})(function(e){var t=e.draggable,n=void 0===t||t,o=e.fullText,s=e.sequencerEngine,c=e.instrument,u=e.envelope,l=e.width,f=void 0===l?180:l,h=e.height,d=void 0===h?60:h,p=e.name,v=e.hasRelease,m=e.hasLevel,y=e.backgroundColor,b=e.fillColor,g=e.lineColor,O=e.selectedParameter,j=e.showLevel,k=e.setParameterSliderDown,w=e.setPullablePartDragging,x=Object(a.useState)(void 0),S=Object(r.a)(x,2),P=S[0],E=S[1],T=Object(a.useState)(void 0),A=Object(r.a)(T,2),M=A[0],R=A[1],C=Object(a.useRef)(void 0),N=function(e,t,n,r,a){t-=10;var i=e.attackParameter.get(),o=e.decayParameter.get(),s=e.sustainParameter.get(),c=e.releaseParameter.get(),u=Math.sqrt(i+o+c),l=ti(i,u,t),f=ti(o,u,t),h=r&&c>0?ti(c,u,t):0,d=Math.max(10,t-(l+f+h)),p=a?5+n-Math.sqrt((e.levelParameter.get()+1)/2)*n:5;p=Math.min(n-5,p);var v=Math.min(n-Math.sqrt(s)*n+5,n-5);return[5,a?n/2-5:n,l,p,l+f,v,l+f+d,v,l+f+d+h,n]}(u,f,d,v,m);Object(a.useEffect)(function(){O!==u.attackParameter&&O!==u.decayParameter&&O!==u.sustainParameter&&O!==u.releaseParameter||R(O)},[R,O,u]),Object(a.useEffect)(function(){k(P)},[P]);var I=Object(a.useCallback)(function(e){if(P){var t=C.current.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top;P.forEach(function(e){var t=function(e,t,n,r,a,i){var o=t.attackParameter.get(),s=t.decayParameter.get(),c=t.sustainParameter.get(),u=t.releaseParameter.get(),l=Math.sqrt(o+s+u);if(n<5)return e.get();var f=1;if(e.name.toLowerCase().includes("attack"))f=Math.min(ei,Math.max(Xa,l)*(n-5)/(.8*a));else if(e.name.toLowerCase().includes("decay"))s=Math.max(Xa,l)*(n-5)/(.8*a)-Math.sqrt(o),f=Math.min(ei,Math.max(0,s));else if(e.name.toLowerCase().includes("sustain"))c=(r=i-r)/i,f=Math.min(ei,Math.max(0,c));else{if(e.name.toLowerCase().includes("level")){var h=(r=i-r)/i;return 2*Math.pow(h,2)-1}e.name.toLowerCase().includes("release")&&(u=Math.max(Xa,l)*Math.max(0,a-n-5)/a,f=Math.min(ei,Math.max(0,u)))}return Math.pow(f,2)}(e,u,n,r,f,d);e.set(t,!1)})}},[P,f,d]),q={};return y&&(q.backgroundColor=y),b&&(b=ni.transparent(ni.saturate(b,1),.2)),i.a.createElement($a.a,{draggable:n,onDragOver:function(e){return e.preventDefault()},onDragStart:function(){return w(c?{type:"SYNTH_ENVELOPE",id:u.id,track:c.track,subType:p,instrument:c}:{type:"MODULE_ENVELOPE",id:u.id,subType:u.number,instrument:u})},element:Ya.F,arg:p,className:"graphical-envelope"},i.a.createElement("div",{className:"env-toolbar"},i.a.createElement("div",{style:q,className:"env-name"},p),i.a.createElement(Za,{fullText:o,setParameter:R,selectedParameter:M,envelope:u,hasLevel:m,hasRelease:v})),M?i.a.createElement(Ft.a,{name:M.name,isParameter:!0,lfoEnabled:!0,sequencerEngine:s,parameter:M,min:M.min,max:M.max,step:.001}):"",i.a.createElement("div",{draggable:!0,onDragStart:function(e){return e.preventDefault()},className:"graphics-container relative"},i.a.createElement("svg",{ref:C,style:q,onMouseMove:I,onMouseUp:function(){return E(void 0)},onMouseLeave:function(){return E(void 0)},width:f,height:d},ai(N,d,g,b),ri(N,u,P,E,m)),i.a.createElement("div",{className:"env-slider"}),j&&m&&i.a.createElement(Ft.a,{name:"Env Level",isParameter:!0,sequencerEngine:s,parameter:u.levelParameter,min:u.levelParameter.min,max:u.levelParameter.max,step:.001})))}),oi=Object(s.b)(function(e,t){return{envelope:t.zenvelope.envelope,width:t.zobject.width,height:t.zobject.height,lineColor:t.zobject.attributes["primary-color"],fillColor:t.zobject.attributes["primary-color"],backgroundColor:t.zobject.attributes["secondary-color"]}},function(e){return{}})(function(e){e.zobject;var t=e.height,n=e.width,r=e.zenvelope,a=e.lineColor,o=e.fillColor,s=e.backgroundColor;return r.envelope?i.a.createElement(ii,{fillColor:o,lineColor:a,width:n,height:t,backgroundColor:s,name:"Env",draggable:!1,hasRelease:!0,envelope:r.envelope}):""}),si=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.variable,n=e.pattr.getVariableContext(t);return""===n?"":i.a.createElement("div",{className:"variable-context"},n)}),ci=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.variable,n=e.pattr,r=t.getObjectType()!==te.d;return i.a.createElement("div",{className:"variable-name"},r?i.a.createElement("div",{style:{backgroundColor:t.attributes["secondary-color"]||"gray"},className:"v-color"}):i.a.createElement("img",{src:"/znumber-light.svg"}),i.a.createElement(si,{variable:t,pattr:n}))}),ui=Object(s.b)(function(e,t){return{value:t.variable.effect?t.variable.effect.value:t.variable.message}},function(e){return{}})(function(e){e.variable;var t=e.value;return i.a.createElement("div",{className:"variable-value"},t)}),li=(n(1821),function e(t){var n=t.pattr,s=t.planeMapping,u=Object(a.useRef)(),l=Object(a.useState)([]),f=Object(r.a)(l,2),h=f[0],d=f[1],p=Object(a.useState)(n.hiddenObjects),v=Object(r.a)(p,2),m=(v[0],v[1]);Object(a.useEffect)(function(){d(n.getOptionsAtLevel())},[d,n]);var y=!n.subpatch.zObject;Object(a.useEffect)(function(){if(u.current)return y&&u.current.addEventListener("mousewheel",j),function(){u.current&&u.current.removeEventListener("mousewheel",j)}},[y]);var b=Object(a.useCallback)(function(e){n.hideObject(e),m(Object(o.a)(n.hiddenObjects))},[m,n]),g=Object(a.useCallback)(function(){n.createParameters()},[n]),O=Object(a.useCallback)(function(){s&&(g(),n.parameters,s.randomlyMapParameters(n))},[n,s]),j=function(e){return e.stopPropagation()};return i.a.createElement("div",{ref:u,className:y?"varz base":"varz"},i.a.createElement("div",{onClick:O,className:s?"varz-level plane-mapping":"varz-level"},i.a.createElement("div",{className:"varz-name"},n.subpatch.zObject?n.subpatch.zObject.args[0]:""),i.a.createElement("div",{onClick:g,className:"create-parameters"},"Create Parameters")),i.a.createElement("div",{className:y?"varz-options base-level":"varz-options"},h.filter(function(e){return!n.hiddenObjects.includes(e)}).map(function(e){return i.a.createElement("div",{key:e.id,onClick:function(){return n.subpatch.dispatch(Object(c.Ed)(e))},className:"varz-option"},i.a.createElement(ci,{variable:e,pattr:n}),i.a.createElement(ui,{variable:e}),i.a.createElement("div",{onClick:function(t){return b(e)},className:"hide"},"Hide"))}),n.getNextLevels().filter(function(e){return e.getOptionsAtLevel().length>0||e.getNextLevels().length>0}).map(function(t){return i.a.createElement(e,{planeMapping:s,key:t.subpatch.id,pattr:t})})))}),fi=Object(s.b)(function(e,t){return{planeMapping:e.effects.planeMapping}},function(e){return{}})(function(e){var t=e.zobject,n=e.pattr,r=e.planeMapping,a=e.containerRef;return i.a.createElement(li,{planeMapping:r,zobject:t,pattr:n,containerRef:a})}),hi=n(570),di=n(122),pi=function(e){return new Promise(function(t,n){var r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){var e=Object(K.a)(W.a.mark(function e(n){return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout(Object(K.a)(W.a.mark(function e(){var n;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,di.a.addArrayBuffer(r.result);case 2:n=e.sent,t(n);case 4:case"end":return e.stop()}},e)})),1e3);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()})},vi=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.onDropCallback,n=e.imageHash,r=e.setImageHash,o=e.placeholder,s=void 0===o?"Drag thumbnail":o,c=Object(a.useCallback)(function(){var e=Object(K.a)(W.a.mark(function e(n){var a,i,o;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t(),n.dataTransfer){e.next=3;break}return e.abrupt("return");case 3:if(n.stopPropagation(),n.preventDefault(),n.dataTransfer.effectAllowed="none",n.dataTransfer.dropEffect="none",!n.dataTransfer.items){e.next=20;break}a=n.dataTransfer.items.length,i=0;case 10:if(!(i<a)){e.next=20;break}if("file"!==n.dataTransfer.items[i].kind){e.next=17;break}return e.next=14,pi(n.dataTransfer.items[i].getAsFile());case 14:return o=e.sent,r(o),e.abrupt("return");case 17:i++,e.next=10;break;case 20:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[r]),u="";return u=n?i.a.createElement("div",{className:"inner"},i.a.createElement("img",{src:di.a.getHashUrl(n)}),i.a.createElement("span",{className:"drag-placeholder"},s)):i.a.createElement("span",null,s),i.a.createElement("div",{className:"image-handler"},i.a.createElement("div",{onDragOver:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.effectAllowed="none"},onDragEnter:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none"},onDrop:c,className:n?"drop-here loaded":"drop-here"},u))}),mi=Object(s.b)(function(e,t){return{_imageHash:t.textureLoader.imageHash,loading:t.textureLoader.loading}},function(e){return{setUploadingFile:function(t){return e(Object(c.Se)(t))}}})(function(e){var t=e.setUploadingFile,n=e.textureLoader,o=e._imageHash,s=e.loading,c=Object(a.useState)(o),u=Object(r.a)(c,2),l=u[0],f=u[1];Object(a.useEffect)(function(){f(o)},[o,f]);return Object(a.useEffect)(function(){l&&n.loadImage(l).then(function(e){return t(!1)})},[l]),i.a.createElement("div",{className:"texture-loader"},s?i.a.createElement(hi.a,{width:200,text:"Loading"}):i.a.createElement(vi,{onDropCallback:function(){t(!0)},placeholder:"Drag new image here",imageHash:l,setImageHash:f}))}),yi=n(46);function bi(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var gi=function(e){Object(b.a)(n,e);var t=bi(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"onPlayMixClicked",value:function(e){this.props.setIsPlayingMix(!this.props.isPlaying),this.props.sequencerEngine.schedulePlay(),document.activeElement.blur()}},{key:"onClickRecordMixButton",value:function(){var e=this.props.isRecording||this.props.isRecordingMix;this.props.setIsRecordingMix(!e),this.props.sequencerEngine.recording(!e)}},{key:"onClickStop",value:function(){this.props.sequencerEngine.stop(),this.props.sequencerEngine.seekToTrackStep(0),this.props.setPianoRollCursor(void 0),this.props.setArrangementMouseX(void 0),this.props.setArrangementCursorStep(0)}},{key:"getPianoIcon",value:function(){return this.props.showPianoRoll&&this.props.bottomMode===Pe.b?"/piano-roll-on.svg":"/piano-roll-off.svg"}},{key:"getPianoClass",value:function(){return this.props.showPianoRoll&&(this.props.bottomMode,Pe.b),"piano-roll-button"}},{key:"onClickPianoRoll",value:function(){this.props.showPianoRoll&&this.props.bottomMode===Pe.c?this.props.setArrangementBottomMode(Pe.b):(this.props.setArrangementBottomMode(Pe.b),this.props.setShowPianoRoll(!this.props.showPianoRoll))}},{key:"render",value:function(){var e=this,t="playpause ";return this.props.playScheduled&&(t+=" flashit"),i.a.createElement("div",{className:"mix-buttons"},i.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp(Ya.B)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:t},i.a.createElement("input",{onChange:function(t){return e.onPlayMixClicked(t)},checked:!this.props.isPlaying,type:"checkbox",value:!this.props.isPlaying,id:"playpause",name:"check"}),i.a.createElement("label",{className:this.props.isPlaying&&this.props.isPlayingMix?"mix":"",htmlFor:"playpause",tabIndex:1})),i.a.createElement("div",{onClick:function(){return e.onClickStop()},className:"stop-button"}),i.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp(Ya.D)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickRecordMixButton()},className:this.props.isRecording||this.props.isRecordingMix?"record-btn recording-dot":"record-btn not-recording-dot"}),i.a.createElement("img",{onClick:function(){return e.onClickPianoRoll()},onMouseOver:function(){return e.props.setContextualHelp(Ya.J)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:this.getPianoClass(),src:this.getPianoIcon()}),i.a.createElement("img",{onMouseOver:function(){return e.props.setContextualHelp(Ya.a)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickLooping()},className:"loop-icon",src:this.getLoopIcon()}))}},{key:"getLoopIcon",value:function(){return this.props.looping?"/arrow-loop-looping.png":"/arrow-loop.png"}},{key:"onClickLooping",value:function(){this.props.sequencerEngine.restartAllMixes(!this.props.looping),this.props.setLooping(!this.props.looping)}},{key:"getLoopClass",value:function(){return this.props.looping?"loop-icon looping":"loop-icon"}},{key:"onClickAutomationMode",value:function(){this.props.automationMode===yi.a?this.props.setProjectAutomationMode(yi.b):this.props.automationMode===yi.b&&this.props.setProjectAutomationMode(yi.a)}},{key:"getAutomationIcon",value:function(){return this.props.automationMode===yi.b?"/automation-icon-enabled.png":"/automation-icon-disabled.png"}}]),n}(a.Component),Oi=Object(s.b)(function(e,t){var n=t.sequencerEngine.getSequenceId(),r=e.sequencer.isPlaying[n]||0;return{isRecordingMix:window.installation?e.sequencer.isRecording:e.mix.isRecordingMix,isRecording:e.sequencer.isRecording,isPlayingMix:e.mix.isPlayingMix,isPlaying:r,showPianoRoll:e.sequencer.showPianoRoll,automationMode:e.sequencer.automationMode,playScheduled:e.clock.playScheduled,looping:e.arrangement.looping,bottomMode:e.arrangement.bottomMode}},function(e){return{setShowPianoRoll:function(t){return e(Object(c.Wd)(t))},setIsPlayingMix:function(t){return e(Object(c.Pb)(t))},setIsRecordingMix:function(t){return e(Object(c.Sb)(t))},setProjectAutomationMode:function(t){return e(Object(c.bd)(t))},setContextualHelp:function(t){return e(Object(c.bb)(t))},setLooping:function(t){return e(Object(c.A)(t))},setArrangementMouseX:function(t){return e(Object(c.B)(t))},setArrangementBottomMode:function(t){return e(Object(c.y)(t))},setArrangementCursorStep:function(t){return e(Object(c.z)(t))},setPianoRollCursor:function(t){return e(Object(c.Nc)(t))}}})(gi),ji=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.zobject;return i.a.createElement(Oi,{sequencerEngine:t.sequencerEngine})}),ki=n(226),wi=n(280);function xi(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var Si=function(e){Object(b.a)(n,e);var t=xi(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"render",value:function(){var e="small_checkmark ";return this.props.className&&(e+=this.props.className),i.a.createElement(wi.a,{condition:this.props.condition},i.a.createElement("span",{className:e},i.a.createElement("div",{className:"small_checkmark_stem"}),i.a.createElement("div",{className:"small_checkmark_kick"})))}}]),n}(a.Component),Pi=n(579),Ei=n(162),Ti=n(157),Ai=n(142),Mi=n(824),Ri=n(119),Ci=n(149),Ni=n(153),Ii=function(){var e=Object(K.a)(W.a.mark(function e(t,n){var r,a,i,o=arguments;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:0,a=t.name,e.t0=Ni.b,e.next=5,di.a.addJson(t);case 5:e.t1=e.sent,i=(0,e.t0)(e.t1),new Ti.a(Ci.c,"newEffect",[i,Ei.a.utils.fromAscii(a),n,r]).execute();case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),qi=function(){var e=Object(K.a)(W.a.mark(function e(t){var n,r;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ai.a((new Mi.a).contractAddress).from(Ri.m).select("title").select("ipfsHash").select("effectType").select("user"),t&&n.where("effectType",t),e.next=4,n.executeQuery();case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();function _i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Di(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Di(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Di(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Fi=Object(s.b)(function(e,t){return{padFXMode:t.node&&e.pads.padFXMode[t.node.id]}},function(e){return{setBulkEffectsCollapsed:function(t){return e(Object(c.K)(t))},setShowingContextMenu:function(t){return e(Object(c.de)(t))},setWindowPositions:function(t){return e(Object(c.O)(t))}}})(function(e){var t=e.setWindowPositions,n=e.setBulkEffectsCollapsed,s=e.effect,c=e.initializeEffect,u=e.setShowingContextMenu,l=e.effectOptions,f=e.outputNumber,h=e.addToBack,d=void 0===h||h,p=e.isRoot,v=e.dropdownPosRef,m=e.node,y=e.sequencerEngine,b=void 0===y?m.sequencerEngine:y,g=e.dropdownPos,O=e.scale,j=e.setDropdownPos,k=e.allowSendsOnly,w=e.padFXMode,x=e.isMidi,S=Object(a.useState)([]),P=Object(r.a)(S,2),E=P[0],T=P[1];Object(a.useEffect)(function(){qi(x?"Midi Effect Rack":"Effect Rack").then(function(e){var t,n=[],r=_i(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push({label:a.title,value:a})}}catch(i){r.e(i)}finally{r.f()}T(n)})},[]);var A=Object(a.useCallback)(function(){m.padFXMode=w===Pi.b?Pi.a:Pi.b},[m,w]),M=Object(a.useCallback)(function(){var e=c("Midi Effect Rack",m);return m.midiEffects.addEffect(e),e},[m]),R=Object(a.useCallback)(function(e){var n=m.effectRack;p&&(v.current.x+=50,v.current.y-=50),x&&((n=m.midiEffects.effects.find(function(e){return"Midi Effect Rack"===e.name}))||(n=M()));var r=c(e,x?m:b);n.x||(n.x=v.current.x-150,n.y=v.current.y,n.outputNode.x=v.current.x+170,n.outputNode.y=v.current.y),p&&(v.current.x-=60),r.x=v.current.x,r.y=v.current.y;var a={};a[r.id]={x:r.x,y:r.y},a[n.id]={x:n.x,y:n.y},t(a),r.needsPlacement=!0,m.addRackEffect(r,d,s,f),j(void 0)},[m,g,j,p]),C=Object(a.useCallback)(function(e){var t=window.prompt("Preset name"),n=m.effectRack.getJson();Ii(n,t)},[m]),N=Object(a.useCallback)(function(){var e=Object(K.a)(W.a.mark(function e(t){var r,a,i,s,c;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=m.effectRack)||(r=M()),Object(o.a)(r.effects),r.clearRack(),a=t.effectHash,e.next=7,di.a.getJson(a);case 7:return i=e.sent,m.updateEffectRedux([]),e.next=11,r.fromJson(i,m.sequencerEngine.tracks,0,!0,!1);case 11:x||m.linkEffectRackContext(),s={},r.effects.forEach(function(e){return s[e.id]=!0}),r.x=v.current.x-350,r.y=v.current.y-100,n(s),c=Math.max.apply(Math,Object(o.a)(r.effects.map(function(e){return e.x}))),r.outputNode.x=c+100,r.outputNode.y=v.current.y,m.updateEffectRedux();case 21:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[m]);Object(a.useEffect)(function(){u(g)},[g]);var I="function"===typeof l?l():l;return i.a.createElement(Ge,{dropdownPos:g?{x:g.x/O,y:g.y/O}:void 0},k&&i.a.createElement(We,{onMouseDown:A},"Sends Only",i.a.createElement(Si,{condition:w===Pi.b})),i.a.createElement(Ke,{name:"Presets"},i.a.createElement(We,{className:"save-preset-item",onClick:C},i.a.createElement("div",null,"Save Preset"),i.a.createElement("img",{src:"/floppy-disk.svg",className:"save-preset-icon"})),E.map(function(e){var t=e.label,n=e.value;return i.a.createElement(We,{onMouseDown:function(){return N(n)}},t)})),x?i.a.createElement("div",null,i.a.createElement(Ke,{name:"Standard Midi FX"},i.a.createElement("div",null,ki.e.map(function(e){var t=e.label,n=e.value;return i.a.createElement(We,{onMouseDown:function(){return R(n)}},t)}))),i.a.createElement(Ke,{name:"Flow Midi FX"},i.a.createElement("div",null,ki.d.map(function(e){var t=e.label,n=e.value;return i.a.createElement(We,{onMouseDown:function(){return R(n)}},t)})))):i.a.createElement("div",{className:"fx-options"},I.map(function(e){var t=e.label,n=e.value;return i.a.createElement(We,{onMouseDown:function(){return R(n)}},t)})))}),Li=(n(1824),Object(s.b)(function(e,t){return{isCollapsed:e.effects.effectCollapsed[t.node.effectRack&&t.node.effectRack.id]}},function(e){return{setSelectedZObject:function(t){return e(Object(c.Ed)(t))},setIsCollapsed:function(t,n){return e(Object(c.vb)(t,n))},setDrawingPadEdge:function(t,n){return e(Object(c.pb)(t,n))}}})(function(e){var t=e.setDrawingPadEdge,n=e.containerRef,r=(e.addToBack,e.node),o=(e.sequencerEngine,e.scale),s=void 0===o?1:o,c=e.number,u=e.hideNumber,l=e.sequencerScale,f=void 0===l?1:l,h=e.isMidi,d=e.trackPositions,p=(e.setSelectedZObject,e.isRoot),v=e.useClick,m=e.setIsCollapsed,y=e.isCollapsed,b=Object(a.useRef)(void 0),g=Je({ref:b}),O=g.onContextMenu,j=g.dropdownPos,k=g.setDropdownPos,w=Object(a.useCallback)(function(e){e.stopPropagation();var t=r.effectRack;t&&m(t.id,!y)},[y]),x=et(w,250,function(e){v&&O(e)}),S=Object(a.useRef)({x:0,y:0}),P=Object(a.useCallback)(function(e){var a=e.pageX,i=e.pageY;if(S.current.x=h?a+100:a+250,S.current.y=i,h){e.stopPropagation(),r.trackNode&&r.sequencerEngine.selectTrack(r.trackNumber);var o=n.current.getBoundingClientRect(),s=e.clientX-o.left,c=e.clientY-o.top,u={effect:void 0,rack:r.effectRack,x1:s,y1:c,x2:s,y2:c};t(r.subSequence.id,u)}},[]),E="output-node-"+r.id;h&&r.effectRack&&(E="effect-output-0-"+r.effectRack.id);var T={};if(void 0!==c){var A=d[r.id];A&&A.current?(A=A.current,T.top=A.offsetTop+5,f&&(T.top*=f)):T.top=25*(c+1)*s}var M="output-node";return y&&(M+=" collapsed"),i.a.createElement($a.a,{element:p?Ya.u:void 0,style:T,id:E,onClick:x,onMouseDown:P,refObj:b,onContextMenu:O,className:M},y&&!u&&i.a.createElement("div",{className:"num-effects"},r.effectRack.effects.length),i.a.createElement(Fi,{isMidi:h,addToBack:!h,isRoot:p,effectOptions:h?ki.e:ki.a,initializeEffect:h?ki.c:ki.b,setDropdownPos:k,dropdownPosRef:S,dropdownPos:j,node:r.effect||r}))})),Bi=n(146),zi=n(164);function Ji(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Vi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vi(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Vi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Hi=Object(a.memo)(function(e){var t=e.contextState,n=e.isBackground,r=e.className,s=e.zobject,c=e.width,u=e.height;e.setZObjectDebug;if(n&&(u=window.innerHeight-80,c=window.innerWidth-40,console.log("is background")),s.attributes["fill subpatch"]){for(var l=s.subSequence;l.subSequence&&!l.subSequence.tracks;)l=l.subSequence;l.zObject&&(c=l.zObject.width,u=l.zObject.height)}var h=Object(a.useRef)(!1),d=Object(a.useRef)(void 0),p=(Object(a.useRef)(void 0),Object(a.useRef)(void 0)),v=(Object(a.useRef)(void 0),xt({containerRef:d,scale:1}).getXY);Object(a.useEffect)(function(){return d.current.addEventListener("touchmove",m,{passive:!1}),function(){d.current&&d.current.removeEventListener("touchmove",m,{passive:!1})}},[]);var m=function(e){return e.preventDefault()},y=Object(a.useCallback)(function(){var e=Object(K.a)(W.a.mark(function e(t){var n,r,a,i,o,c,u,l,f;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(h.current,t.changedTouches){[],"",n=Ji(t.changedTouches);try{for(n.s();!(r=n.n()).done;)a=r.value,i=v(a),o=i.x,c=i.y,s.effect.onMouseMove(o,c)}catch(d){n.e(d)}finally{n.f()}}else u=v(t),l=u.x,f=u.y,s.effect.onMouseMove(l,f);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[s]),b=Object(a.useCallback)(function(){s.sequencerEngine.playing&&h.current&&(h.current=!1,s.effect.onMouseUp())},[s]),g=Object(a.useCallback)(function(e){"suspended"===t&&(console.log("trying to revive suspended"),s.sequencerEngine.context._context.resume().then(function(e){s.sequencerEngine.playing=!1,s.sequencerEngine.play()}));var n=v(e),r=n.x,a=n.y;s.effect.onMouseClick(r,a)},[s,t]),O=Object(a.useCallback)(function(e){if(h.current=!0,!Bi.isMobile||e.touches)if(e.changedTouches){var t,n,r=[],a=Ji(e.changedTouches);try{for(a.s();!(n=a.n()).done;){var i=n.value,c=v(i),u=c.x,l=c.y;r=[].concat(Object(o.a)(r),[u,l])}}catch(m){a.e(m)}finally{a.f()}(t=s.effect).onMouseDown.apply(t,Object(o.a)(r))}else{var f=v(e),d=f.x,p=f.y;s.effect.onMouseDown(d,p)}},[s]),j=Object(a.useCallback)(function(e){if(!Bi.isMobile||e.touches)if(h.current=!1,e.touches){var t=e.changedTouches[0],n=v(t),r=n.x,a=n.y;s.effect.onMouseUp(r,a)}else{var i=v(e),o=i.x,c=i.y;s.effect.onMouseUp(o,c)}},[s]);return Object(a.useEffect)(function(){p.current&&(console.log("setting renderer size=",c,u),p.current.setSize(c,u),p.current.setPixelRatio(Math.ceil(2))),s.effect&&(Object(f.c)("canvas.size",[c,u]),s.effect.sendMessage("size",[c,u]))},[c,u,s]),Object(a.useEffect)(function(){if(!s.effect.ctxt)return p.current=new zi.fb({antialias:!0,preserveDrawingBuffer:!0}),p.current.setClearColor(0,0),s.effect.ctxt=p.current,s.effect.renderer=p.current,p.current.setSize(c,u),p.current.setPixelRatio(2),s.effect.canvas=p.current.domElement,d.current.appendChild(p.current.domElement),function(){return s.effect.ctxt=void 0}},[]),n&&(r+=" canvas-background"),"suspended"===t&&(r+=" suspended"),i.a.createElement("div",{className:r,onMouseMove:Bi.isMobile?function(){return 0}:y,onMouseDown:Bi.isMobile?function(){return 0}:O,onMouseLeave:b,onMouseUp:Bi.isMobile?function(){return 0}:j,onTouchMove:y,onTouchStart:O,onTouchEnd:j,onClick:g,style:{width:c,height:u},ref:d})}),Ui=function(e){for(var t=e.subSequence;t.subSequence&&!t.subSequence.tracks;)t=t.subSequence;return t},Gi=Object(s.b)(function(e,t){var n=Ui(t.zobject);return{contextState:t.zobject.sequencerEngine.context._context.state,isBackground:t.zobject.attributes["set as background"],outerWidth:n&&n.zObject&&n.zObject.width,outerHeight:t.zobject.subSequence.zObject&&t.zobject.subSequence.zObject.height,width:t.width||t.zobject.width,height:t.height||t.zobject.height}},function(e){return{setZObjectDebug:function(t){return e(Object(c.df)(t))}}})(Hi);function Wi(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ki(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ki(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ki(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Qi=function(e){var t=e.sampleDragging,n=e.slotNumber,r=e.slot,i=e.pad,o=e.sampleTagDragging,s=e.setSampleDragging,c=e.setSampleTagDragging,u=e.setTrackDragging,l=e.trackDragging;return{onDrop:Object(a.useCallback)(function(e){if(e.stopPropagation(),i.sequencerEngine.switchToSubSequence(i.subSequence.id),l)i.tracks.includes(l)?i.switch(n,i.tracks.indexOf(l)):i.addTrack(l,n);else if(t){var a=i.containsSample(t);if(a)i.switch(n,i.tracks.indexOf(a));else{var f,h=Wi(i.subSequence.tracks);try{for(h.s();!(f=h.n()).done;){var d=f.value;if(!d.isFrozen&&d.sample===t){var p=0===d.getEasyPattern().getAllSteps().length;return i.addTrack(d,n,p),void s(void 0)}}}catch(y){h.e(y)}finally{h.f()}i.slots[n]?t.audioBuffer?i.slots[n].useNewSound(t):t.load().then(function(e){return i.slots[n].useNewSound(t)}):i.newSample(t,n)}}else if(o){var v=i.sequencerEngine,m=v.state.selector.sampleTagDragging;Array.isArray(m)||(m=[m]),v.searchForSounds(m,r,r,void 0,!1).then(function(e){r||i.addTrack(e,n,!0)}),c(void 0)}u(void 0),s(void 0),u(void 0)},[t,r,n,i,o,l,u])}},Zi=new Ot.a,Yi=Object(s.b)(function(e,t){return{sampleDragging:e.selector.sampleDragging,sampleTagDragging:e.selector.sampleTagDragging,trackDragging:e.tracks.trackDragging}},function(e){return{setSampleDragging:function(t){return e(Object(c.kd)(t))},setTrackDragging:function(t){return e(Object(c.se)(t))},setSampleTagDragging:function(t){return e(Object(c.nd)(t))},setParameterSliderDown:function(t){return e(Object(c.Hc)(t))},setArrangementBottomMode:function(t){return e(Object(c.y)(t))},setShowPianoRoll:function(t){return e(Object(c.Wd)(t))},setContextualHelp:function(t){return e(Object(c.bb)(t))},setSelectedZObject:function(t){return e(Object(c.Ed)(t))}}})(function(e){var t=e.sampleDragging,n=e.slotNumber,r=e.pad,a=e.sampleTagDragging,o=e.setSampleDragging,s=e.setSampleTagDragging,c=e.slot,u=e.trackDragging,l=e.setTrackDragging,f=(e.setParameterSliderDown,e.setArrangementBottomMode,e.setShowPianoRoll,e.size),h=(e.setContextualHelp,e.setSelectedZObject),d=e.scale,p=e.attributes,v=Qi({sampleDragging:t,slotNumber:n,pad:r,sampleTagDragging:a,setSampleDragging:o,setSampleTagDragging:s,slot:c,trackDragging:u,setTrackDragging:l}).onDrop;return i.a.createElement("div",{style:{backgroundColor:p?p["slot-color"]&&Zi.transparent(Zi.saturate(p["slot-color"],1),p["slot-opacity"]||1):void 0,width:f,height:f,margin:3*d+"px"},onClick:function(e){e.stopPropagation(),h(void 0)},onDrop:v,className:"empty pad-slot"})}),$i=n(206),Xi=n(127);n(827);function eo(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return to(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return to(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function to(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var no=function(e,t){var n,r=[],a=[],i=eo(t.slotTracks);try{for(i.s();!(n=i.n()).done;){var s=n.value;s.sample?r.push(s.sample.getId()):s.preset&&s.preset.contentHash&&a.push(s.preset.contentHash)}}catch(c){i.e(c)}finally{i.f()}!function(e,t,n,r,a,i){new Promise(function(){var s=Object(K.a)(W.a.mark(function s(c){var u,l,f,h;return W.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return u=Object(ot.a)({samples:n,presets:r,description:t,title:e},i),s.next=3,di.a.addJson(u);case 3:if(l=s.sent,c(l),console.log("saving pack PREVIOUS HASH =",a),f=Ei.a.utils.padLeft("0x0",64),a&&(f=Object(Ni.b)(a)),"PAD"!==u.type){s.next=11;break}return s.next=11,Xi.a.xanadu.syncPadType(l,"PAD");case 11:h=[].concat(Object(o.a)(n),Object(o.a)(r)).filter(function(e){return e}),new Ti.a(Ci.m,"newPack",[Object(Ni.b)(l),f,h.map(Ni.b),Ei.a.utils.fromAscii(e)]).execute();case 13:case"end":return s.stop()}},s)}));return function(e){return s.apply(this,arguments)}}())}(e,"",r,a,void 0,{type:"PAD",pad:t.getJsonForPack(),fx:t.effectRack.getJson()})},ro=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.hide,n=e.pad,o=Object(a.useState)(""),s=Object(r.a)(o,2),c=s[0],u=s[1],l=Object(a.useCallback)(function(){no(c,n),t()},[c,t,n]);return i.a.createElement("div",{className:"pads save-pad"},i.a.createElement("div",{className:"pad-inner"},i.a.createElement("div",null,"Save as Pack"),i.a.createElement("input",{value:c,type:"text",className:"pack-name",onChange:function(e){return u(e.target.value)},placeholder:"Type name for pack"}),i.a.createElement("div",{className:"complete-buttons"},i.a.createElement("div",{onClick:l,className:"done-btn"},"Done"),i.a.createElement("div",{onClick:t,className:"cancel-btn"},"Cancel"))))}),ao=Object(s.b)(function(e,t){return{tracks:t.pad.tracks}},function(e){return{}})(function(e){var t=e.pad,n=Object(a.useState)(1),s=Object(r.a)(n,2),c=s[0],u=s[1],l=Object(a.useState)(!1),f=Object(r.a)(l,2),h=f[0],d=f[1],p=Math.max.apply(Math,Object(o.a)(t.tracks.filter(function(e){return e}).map(function(e){return e.pattern.length()})));p===-1/0&&(p=32);var v=p/32;ze({clear:function(){return d(!1)},selected:h});var m=Object(a.useCallback)(function(e){e.stopPropagation(),t.tracks.filter(function(e){return e}).forEach(function(e){return e.halfTrackLength()}),u(c/2)},[t,u,c]),y=Object(a.useCallback)(function(e){e.stopPropagation(),t.tracks.filter(function(e){return e}).forEach(function(e){return xe(e,void 0,t.sequencerEngine.resolution)}),u(2*c)},[t,u,c]),b="";return h&&(b=i.a.createElement("div",{className:"length-dropdown"},i.a.createElement("div",{onMouseDown:m,className:"length-btn"},"-"),i.a.createElement("div",{onMouseDown:y,className:"length-btn"},"+"))),i.a.createElement($a.a,{element:Ya.p,className:"pad-length"},b,"Length ",i.a.createElement("span",{onMouseDown:function(){return d(!0)},className:"bars"},v)," bars")}),io=function(e){var t=e.element,n=e.option,r=e.name,a=e.mode,o=e.setMode,s="pad-toolbar-btn";return n===a&&(s+=" selected"),i.a.createElement($a.a,{element:t,onClick:function(){return o(n===a?void 0:n)},className:s},r)},oo=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.pad,n=e.setMode,r=e.mode,o=Object(a.useCallback)(function(e){n("WAVEFORM"===r?void 0:"WAVEFORM")},[r,n]);return i.a.createElement("div",{className:"pad-toolbar"},i.a.createElement(io,{element:Ya.o,mode:r,setMode:n,option:"DELETE",name:"Delete"}),i.a.createElement(io,{element:Ya.q,mode:r,setMode:n,option:"MUTES",name:"Mutes"}),i.a.createElement($a.a,{element:Ya.t,onClick:o,className:"WAVEFORM"===r?"waveform-btn selected":"waveform-btn"},i.a.createElement("div",{className:"wave"}),i.a.createElement("div",{className:"wave"})),i.a.createElement(ao,{pad:t}))}),so=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.setDropdownPos,n=e.dropdownPos,r=e.track,o=Object(a.useCallback)(function(){r.sequencerEngine.duplicateTrack(r.trackNumber),t(void 0)},[r,t]),s=Object(a.useCallback)(function(){for(var e=0;e<r.patterns.length;e++)if(e!==r.currentPattern){var n=r.pattern.getCopy();r.patterns[e]=n,r.pattern.syncBuckets()}t(void 0)},[r,t]),c=Object(a.useCallback)(function(){Be(r),t(void 0)},[r,t]);return i.a.createElement(Ge,{dropdownPos:n,setDropdownPos:t},i.a.createElement(We,{onMouseDown:o},"Duplicate ",i.a.createElement("div",{className:"key-shortcut"},"\u2318D")),i.a.createElement(We,{onMouseDown:c},"Save Preset"),i.a.createElement(We,{onMouseDown:s},"Copy Steps to All Patterns"))}),co=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.slotNumber,n=e.pad,o=(e.sliderMaterial,e.style),s=Object(a.useState)(void 0),c=Object(r.a)(s,2),u=c[0],l=c[1];return Object(a.useEffect)(function(){return l(n.newSliderRenderer(t)),function(){n.freeSliderRenderer(t)}},[]),u?i.a.createElement(Gi,{className:"slider-canvas",width:o.width,height:o.height,zobject:u}):""}),uo=n(425);n(283);function lo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var fo=function(e){Object(b.a)(n,e);var t=lo(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={height:0,referenceHeight:r.fromDecibel(0)},r}return Object(y.a)(n,[{key:"fromDecibel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-80,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;return e<-80?0:(this.props.height||45)*Math.pow((e-t)/(n-t),2)}},{key:"componentDidMount",value:function(){var e=this;this.timer=setInterval(function(){var t=e.props.meter.getLevel();e.setState({isRed:t>0,height:Math.min(60,e.fromDecibel(t))})},100)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){var e={height:this.state.height},t={height:this.state.referenceHeight},n="track-meter-value";return this.state.isRed&&(n+=" is-red"),i.a.createElement("div",{className:"track-meter"},i.a.createElement("div",{className:n,style:e}),i.a.createElement("div",{className:"track-meter-reference",style:t}))}}]),n}(a.Component),ho=Object(s.b)(function(e,t){var n=t.track,r={};if(n){var a=e.tracks.triggers[n.trackNumber];if(a)for(var i in a)a[i]&&(r.playing=!0);r.playing||(r.playing=n.notesTriggered&&Object.keys(n.notesTriggered).length>0),r.isSelected=n&&e.mix.selectedTrack===n.trackNumber}return r},function(e){return{}})(function(e){var t=e.track,n=e.padRef,r=e.isSelected,i=e.playing;return Object(a.useEffect)(function(){if(!n.current)return"";if(i)n.current.className="pad-slot pressed";else{var e=n.current.className.split(" ").filter(function(e){return"pressed"!==e});n.current.className=e.join(" ")}if(r)n.current.className+=" selected";else{var a=n.current.className.split(" ").filter(function(e){return"selected"!==e});n.current.className=a.join(" ")}t.muted&&(n.current.className+=" muted")},[i,r]),""}),po=function(e,t,n,i,o,s,c){var u=Object(a.useRef)(0),l=Object(a.useState)(!1),f=Object(r.a)(l,2),h=f[0],d=f[1],p=Object(a.useRef)(!1),v=Object(a.useState)(void 0),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useState)(!1),O=Object(r.a)(g,2),j=O[0],k=O[1];Object(a.useEffect)(function(){p.current=h},[h]);var w=Object(a.useCallback)(function(){},[d,k]);Object(a.useEffect)(function(){return window.addEventListener("mousemove",x),window.addEventListener("mouseup",P),function(){return window.removeEventListener("mouseup",P)}},[k,t,i,d]);var x=Object(a.useCallback)(function(n){if(!n.metaKey&&"DELETE"!==i&&"MUTES"!==i&&p.current&&t){n.preventDefault(),n.stopPropagation();var r=n.clientY;n.touches&&(n.touches.length>0&&n.preventDefault(),r=function(e,t){var n=void 0;Array.isArray(t)||(t=[t]),t=t.map(function(e){return e.current});for(var r=0;r<e.touches.length;r++)if(t.includes(e.touches[r].target)){n=e.touches[r];break}return n}(n,s).clientY);var a=e.current.getBoundingClientRect(),o=e.current.offsetHeight,u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,r=arguments.length>3?arguments[3]:void 0,a=(e=Math.min(Math.max(0,e),r))/r,i=Math.pow(a,.5);return t+(n-t)*i}(o-(r-a.top),-65,6,o);c&&c.sendSliderLevels(),t.setVolume(u,!1,!1),k({x:n.clientX,y:n.clientY})}},[k,t,i]),S=Object(a.useCallback)(function(e){e.metaKey||e.ctrlKey||"DELETE"===i||"MUTES"===i||t&&(c&&c.mouseDown(c.slots.indexOf(t),!0),n(t.volumeParameter),d(!0),b({x:e.clientX,y:e.clientY}),u.current=(new Date).getTime())},[d,b,t,i]),P=Object(a.useCallback)(function(e){p.current&&(e.metaKey||(c.mouseDown(c.slots.indexOf(t),!1),k(void 0),d(!1),n(void 0)))},[k,d,j,y]);return{innerStyle:{height:t&&vo(void 0!==o?o:t.volumeParameter.get(),-65,6,e.current&&e.current.offsetHeight)},onMouseLeave:w,onMouseDown:S,onMouseUp:P,onMouseMove:x,mouseDown:h}};function vo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,r=arguments.length>3?arguments[3]:void 0,a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;return(e-t)/(n-t)}(e,t,n,r);return r*Math.pow(a,2)}n(937);var mo=n(938),yo=n(158),bo=(n(1825),new Ot.a),go=(new Set(["clap","tom","toms","clave","perc","snare","kick","hi-hat","rim","side-stick","breaks","sub","ride","piano","violin"]),Object(s.b)(function(e,t){var n=t.track;return n&&n.tracks&&n.tracks[0]&&(n=n.tracks[0].track),t.track&&t.track.subSequence?{id:void 0===n?0:void 0!==n.sample&&void 0!==n.sample.getId()?n.sample.getId():n.presetName||n.getName&&n.getName(),_videoId:n&&n.sample&&n.sample.videoId,_discogsId:n&&n.sample&&n.sample.coverArtHash,isCompactMode:e.sequencer.isCompactMode&&!t.isBig,showingWaveform:e.sequencer.showPianoRoll&&(e.arrangement.bottomMode===Pe.c||e.arrangement.bottomMode===Pe.a),isLoading:void 0!==t.track&&!!e.tracks.trackIsLoading[t.track.subSequence.id]&&!0===e.tracks.trackIsLoading[t.track.subSequence.id][t.track.trackNumber]}:{}},function(e){return{setSampleDragging:function(t){return e(Object(c.kd)(t))},setTrackDragging:function(t){return e(Object(c.se)(t))}}})(function(e){var t=e.isLoading,n=e.hasInner,r=e.track,a=(e.isSelectedTrack,e.onMouseDown),o=void 0===a?function(){return[]}:a,s=e.sample,c=e.isPad,u=e.draggable,l=void 0===u||u,f=e.onClickThumbnail,h=e.showingWaveform,p=e.className,v=e.showPresetName,m=e.setSampleDragging,y=e.setTrackDragging,b=e.children,g=e.hasBorder,O=e.scale;s=s||r.sample;var j={backgroundColor:r&&r.getTrackType?bo.getColorForTrack(r):s&&bo.getColorForHash(s.getId())};g&&(j.borderColor=j.backgroundColor);var k="";if(h&&r&&(k=" showing-waveform "),p&&(k+=p+" "),!r&&!s)return"";var w=Object(mo.a)(r,s);r&&r.getObjectType&&r.getObjectType()===te.c&&(r&&r.getTrackType()===Se.e&&(k+=" is-multi "),void 0!==w&&""!==w||v&&r&&(w=r.presetName||r.getName())),O&&(j.height=12*O+"px",j.lineHeight=12*O+"px",j.fontSize=6*O+"pt");var x=i.a.createElement("div",{draggable:l,onMouseDown:o,onClick:f,onDragStart:function(e){e.stopPropagation(),m(s),y(r)},onDragOver:function(e){return e.preventDefault()},className:"pushable sound-thumbnail "+k,style:j},w);if(s){var S=s.getThumbnail();S&&""!==S&&(x=i.a.createElement("img",{draggable:l,onMouseDown:o,onDragStart:function(e){e.stopPropagation(),y(r),m(s)},onDragOver:function(e){return e.preventDefault()},src:S,onClick:f,className:"pushable youtube-thumbnail "+k}))}return n&&r&&r.sample&&""!==r.sample.getThumbnail()&&r.sample.getThumbnail()&&(n=!1),c||(r.instrument&&r.instrument.getInstrumentType()===yo.f?x=i.a.createElement("img",{onDragStart:function(e){e.stopPropagation(),y(r),m(s)},onClick:f,className:"pushable synth-icon",src:"/synth-icon.svg"}):r.getTrackType&&r.getTrackType()===Se.a&&(x=i.a.createElement("img",{onDragStart:function(e){e.stopPropagation(),y(r),m(s)},className:"live-loop-icon",src:"/live-loop-icon.svg"}))),i.a.createElement($a.a,{element:void 0},i.a.createElement("div",{style:n&&j.backgroundColor?{backgroundColor:bo.transparent(bo.saturate(j.backgroundColor,1),.65)}:{},className:"youtube-info"},x,i.a.createElement(d.a,{className:"track-loading-spinner",sizeUnit:"px",size:10,color:"#123abc",loading:t}),b))})),Oo=new Ot.a,jo=Object(s.b)(function(e,t){var n=t.slot,r={sliderMaterial:t.pad.sliderMaterial,sampleId:n?void 0!==n.sample&&void 0!==n.sample.getId()?n.sample.getId():n.presetName||n.getName():0,sampleDragging:e.selector.sampleDragging,sampleTagDragging:e.selector.sampleTagDragging,isSelected:t.slot&&e.mix.selectedTrack===t.slot.trackNumber,trackDragging:e.tracks.trackDragging},a=t.slot;return a&&(r.isEnabled=a.isEnabled,r.muted=e.tracks.trackMutes[a.id],r.volume=e.tracks.trackVolumes[a.id]),r},function(e){return{setSampleDragging:function(t){return e(Object(c.kd)(t))},setTrackDragging:function(t){return e(Object(c.se)(t))},setSampleTagDragging:function(t){return e(Object(c.nd)(t))},setParameterSliderDown:function(t){return e(Object(c.Hc)(t))},setArrangementBottomMode:function(t){return e(Object(c.y)(t))},setShowPianoRoll:function(t){return e(Object(c.Wd)(t))},setContextualHelp:function(t){return e(Object(c.bb)(t))},setSelectedZObject:function(t){return e(Object(c.Ed)(t))},setShowEditorBottom:function(t){return e(Object(c.Pd)(t))}}})(function(e){var t=e.muted,n=e.showCanvas,o=e.minimized,s=e.attributes,c=e.setSelectedZObject,u=e.size,l=e.setShowEditorBottom,f=e.trackToShow,h=e.scale,d=e.setContextualHelp,p=(e.sampleId,e.setTrackToShow),v=(e.playing,e.setParameterSliderDown),m=(e.notesTriggered,e.slotNumber),y=e.slot,b=e.pad,g=e.sampleDragging,O=e.setSampleDragging,j=e.isSelected,k=e.sampleTagDragging,w=e.setSampleTagDragging,x=e.mode,S=(e.setArrangementBottomMode,e.setShowPianoRoll,e.isEnabled),P=e.volume,E=e.setTrackDragging,T=e.trackDragging,A=e.sliderMaterial,M=Object(a.useRef)(void 0),R=Object(a.useRef)(void 0),C=Je({ref:M,useTop:!0}),N=C.onContextMenu,I=C.dropdownPos,q=C.setDropdownPos,_=Object(a.useState)(!1),D=Object(r.a)(_,2),F=D[0],L=D[1],B=Object(a.useCallback)(function(e){e.stopPropagation(),y&&l(b.state.spatial.showEditorBottom===uo.b?void 0:uo.b)},[y]),z=et(B,250,function(e){return e.stopPropagation()});Object(a.useEffect)(function(){return window.addEventListener("keydown",J),window.addEventListener("keyup",V),function(){window.removeEventListener("keydown",J),window.removeEventListener("keyup",V)}},[L]),Object(a.useEffect)(function(){L(!1)},[T,y,L]);var J=Object(a.useCallback)(function(e){"Shift"===e.key&&L(!0)},[L]),V=Object(a.useCallback)(function(e){"Shift"===e.key&&L(!1)},[L]),H=po(M,y,v,x,P,[M,R],b),U=H.innerStyle,G=H.onMouseDown,W=H.onMouseMove,K=H.onMouseLeave,Q=H.mouseDown,Z=H.onMouseUp,Y=Qi({sampleDragging:g,slotNumber:m,pad:b,sampleTagDragging:k,setSampleDragging:O,setSampleTagDragging:w,slot:y,trackDragging:T,setTrackDragging:E}).onDrop,$=Object(a.useCallback)(function(e){e.stopPropagation(),y&&(b.sequencerEngine.selectTrack(y.trackNumber),G(e),"DELETE"===x?y.deleting=!0:"MUTES"===x&&y.mute(!t))},[F,x,y,G,f,p,t]);Object(a.useEffect)(function(){return window.addEventListener("mouseup",X),function(){return window.removeEventListener("mouseup",X)}},[x,y,Z]);var X=Object(a.useCallback)(function(e){Z(e)},[x,y,Z]),ee=Object(a.useCallback)(function(e){y&&(Z(e),"DELETE"===x&&(y.deleting=!1))},[x,y,Z]),te=(Object(a.useCallback)(function(e){e.stopPropagation(),y&&b.sequencerEngine.selectTrack(y.trackNumber),b.sequencerEngine.state.zobject.selectedZObject&&c(void 0)},[y,b]),Object(a.useCallback)(function(e){y&&(y.gated=!y.gated)},[y]),Object(a.useCallback)(function(e){e.stopPropagation(),y.toggleEnabled()},[S,y])),ne="pad-slot";y||(ne+=" empty"),j&&(ne+=" selected"),"DELETE"===x&&Q&&(ne+=" deleting"),t&&(ne+=" muted");var re=void 0;y&&(re=y.getKeyMapping()),F&&(ne+=" slot-draggable");var ae=!n&&y&&Oo.getColorForTrack(y);ae&&y.sample&&y.sample.getThumbnail()&&y.sample.getThumbnail(),s&&s["slot-color"]&&(ae=Oo.transparent(Oo.saturate(s["slot-color"],1),s["slot-opacity"]||1));var ie={backgroundColor:ae,width:u,height:u,margin:3*h+"px"};j&&(ie.boxShadow="0px 0px 4px 4px "+ae),Object(a.useEffect)(function(){return Bi.isMobile&&M.current.addEventListener("touchmove",W,{passive:!1}),function(){M.current&&Bi.isMobile&&M.current.removeEventListener("touchmove",W,{passive:!1})}},[y,x]);var oe=s&&!s["Show Track Names"];return i.a.createElement("div",{style:ie,onContextMenu:N,ref:M,onClick:z,onMouseMove:W,onMouseOver:function(){return d(y?Ya.r:Ya.s)},onTouchStart:G,onMouseUp:ee,onMouseLeave:function(e){d(void 0),K(e)},onDragEnter:function(e){e.dataTransfer.dropEffect="move"},onDragOver:function(e){e.dataTransfer.dropEffect="move",e.stopPropagation(),e.preventDefault()},onDrop:Y,onMouseDown:y?$:function(){return[]},className:ne},y&&i.a.createElement(so,{dropdownPos:I,setDropdownPos:q,track:y}),i.a.createElement(ho,{padRef:M,track:y}),i.a.createElement("div",{className:"inner-slot"},y&&!oe?i.a.createElement(go,{isPad:!0,scale:h,onMouseDown:function(e){e.metaKey||t||e.stopPropagation()},showPresetName:!0,track:y}):"",!o&&i.a.createElement("div",{ref:R,className:Q?"volume-indicator":"volume-indicator skinny",style:Object(ot.a)({},U,{width:Q?u:void 0})},A&&i.a.createElement(co,{pad:b,mouseDown:Q,slotNumber:m,sliderMaterial:A,style:Object(ot.a)({},U,{width:Q?u:8})})),!n&&y&&!o&&i.a.createElement(fo,{height:u,meter:y.trackMeter}),y&&!o&&i.a.createElement("div",{onMouseDown:te,className:S?"recording-dot enabled":"recording-dot"}),re&&i.a.createElement("div",{className:"pad-key-map"},re.toUpperCase())))}),ko=Object(s.b)(function(e,t){return{tracks:t.pad.tracks,selectedTrack:e.mix.selectedTrack,trackToShow:e.pads.padsExpand&&e.pads.padsExpand.pad===t.pad?e.pads.padsExpand:void 0,isSelected:e.windows.selectedElements[t.pad.id],showCanvas:t.pad.showCanvas,minimized:t.pad.zObject.attributes.minimized}},function(e){return{setShowPadSequencer:function(t){return e(Object(c.Ud)(t))},setTrackToShow:function(t){return e(Object(c.Bc)(t))}}})(function(e){var t=e.pad,n=(e.scrollContainer,e.selectedTrack),o=e.setShowPadSequencer,s=e.tracks,u=(e.setPadExpand,e.trackToShow),l=e.setTrackToShow,f=e.width,h=e.height,d=e.attributes,p=e.showCanvas,v=(e.zobject,e.isPulled,e.isSelected,e.minimized),m=Object(a.useRef)(void 0),y=Object(a.useRef)(void 0),b=Object(a.useRef)(void 0),g=et(function(e){}),O=Object(a.useState)(!1),j=Object(r.a)(O,2),k=j[0],w=j[1],x=Object(a.useState)(void 0),S=Object(r.a)(x,2),P=S[0],E=S[1];Object(a.useEffect)(function(){E(v?"MUTES":void 0)},[E,v]),Object(a.useEffect)(function(){var e=t.tracks.find(function(e,t){return e&&e.trackNumber===n});e&&void 0!==u&&l(e)},[u,n,l,t,s]);Object(a.useCallback)(function(){if(u)return l(void 0);if(void 0!==n){var e=t.sequencerEngine.tracks[n];if(t.tracks.some(function(t){return t===e}))return void l(e)}var r=t.tracks.filter(function(e){return e});0!==r.length&&l(r[0])},[n,u,t,l]),Object(a.useCallback)(function(){t.slotTracks.forEach(function(e){return e.pattern.clear()}),t.sequencerEngine.updateTracks()},[t]);var T="pads";if("DELETE"===P?T+=" delete-mode":"MUTES"===P&&(T+=" mute-mode"),k)return i.a.createElement(ro,{hide:function(){return w(!1)},pad:t});var A={},M={};d&&(M.backgroundColor=d["primary-color"],A.backgroundColor=d["secondary-color"]),v||(A.width=f,A.height=h),A.borderRadius=f/191*15,d&&d["border-radius"]?M.borderRadius=d["border-radius"]/1.2+"px":M.borderRadius=f/191*8;var R={borderRadius:f/191*8};p?(T+=" show-canvas",A.borderColor=d["secondary-color"]):T+=" no-canvas";var C=f/191*3,N=f-26,I=isNaN(d["Pads Per Row"])?3:d["Pads Per Row"],q=(N-2*I*C)/I;return v&&(q*=.4,T+=" minimized"),i.a.createElement("div",{ref:y,onClick:g,style:A,onMouseDown:function(){b.current=t.sequencerEngine.state.windows.windowPositions[t.id]},onMouseUp:function(){if(t.sequencerEngine.state.windows.windowPositions[t.id]){var e=t.sequencerEngine.state.windows.windowPositions[t.id],n=e.x;e.y,b.current&&n===b.current.x&&b.current.y}},onDrop:function(e){return e.stopPropagation()},className:T},i.a.createElement("div",{style:R,className:"pad-inner"},i.a.createElement("div",{style:M,className:"slots-and-track"},i.a.createElement("div",null,i.a.createElement($a.a,{element:Ya.k,onClick:function(){Object(c.Ed)(void 0),o(t)},className:"step-sequencer-btn"},i.a.createElement("div",{className:"pad-dot"}),i.a.createElement("div",{className:"pad-dot"}),i.a.createElement("div",{className:"pad-dot"})),p&&i.a.createElement(Gi,{className:"pad-canvas",width:f-13,height:h-18,zobject:t.canvas}),i.a.createElement(oo,{mode:P,setMode:E,pad:t}),i.a.createElement("div",{style:{width:v?void 0:N},className:"pad-slots"},t.tracks.map(function(e,n){return e?i.a.createElement(jo,{minimized:v,attributes:d,showCanvas:p,size:q,scale:f/191,setTrackToShow:l,trackToShow:u,key:n,slotNumber:n,pad:t,slot:e,mode:P}):i.a.createElement(Yi,{attributes:d,scale:f/191,size:q,pad:t,slotNumber:n})})))),i.a.createElement("div",{className:"pad-bottom",ref:m})))}),wo=Object(s.b)(function(e,t){return{pad:t.padWrapper.pad,styling:e.zobject.objectStylings[t.zobject.id],width:t.zobject.width,height:t.zobject.height}},function(e){return{}})(function(e){var t=e.scrollContainer,n=e.pad,r=e.zobject,a=(e.padWrapper,e.styling,e.width),o=e.height;return n?i.a.createElement("div",{className:"z-pad"},i.a.createElement(ko,{zobject:r,width:a-10,height:o,attributes:r.attributes,scrollContainer:t,isPulled:!0,pad:n}),i.a.createElement(wt,{subSequence:r.subSequence,effect:n}),i.a.createElement(Pt,{subSequence:r.subSequence,containerRef:t,effect:n}),i.a.createElement(Li,{isRoot:!0,useClick:!0,hideNumber:!0,sequencerEngine:n.sequencerEngine,node:n})):""}),xo=Object(s.b)(function(e,t){return{implements:t.instance&&t.instance.implements}},function(e){return{}})(function(e){var t=e.instance;if(!t)return"empty";var n=t.implements;if(!n)return"not found";var r=n.instances.indexOf(t)+1,a=n.zObject.args[0],o=Math.max(n.inletObjects.length,n.outletObjects.length),s={};return s.minWidth=26*o+"px",s.width=Math.max(120,26*o)+"px",i.a.createElement("div",{style:s,className:"instance-sub-patch"},i.a.createElement("span",{className:"implement-name"},a)," instance #",r)}),So=n(939),Po=n(59),Eo=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.effect,n=Object(a.useRef)(void 0),o=Object(a.useState)(t.messageText),s=Object(r.a)(o,2),c=s[0],u=s[1],l=Object(a.useState)(!1),f=Object(r.a)(l,2),h=f[0],d=f[1],p=et(function(){return d(!0)},250,function(){return t.execute()});Object(a.useEffect)(function(){h&&n.current.focus()},[h]);var v=Object(a.useCallback)(function(e){"Enter"===e.key&&(t.messageText=c,t.execute(),d(!1))},[d,c]);return i.a.createElement("div",{onMouseDown:function(e){h&&e.stopPropagation()},className:"message-button"},h?i.a.createElement("input",{ref:n,onKeyDown:v,value:c,onChange:function(e){return u(e.target.value)}}):i.a.createElement("div",{onClick:p,className:"message-content"},c))}),To=Object(s.b)(function(e,t){return{locked:t.effect.locked}},function(e){return{}})(function(e){var t=e.togglePresets,n=(e.setContextualHelp,e.showPresets),r=e.effect,o=e.locked,s=Object(a.useCallback)(function(){r.lock=!o},[r,o]);return i.a.createElement($a.a,{element:n?Ya.h:Ya.g,className:"bottom-effect-toolbar"},i.a.createElement("img",{onClick:s,src:o?"/closed-padlock.png":"/opened-padlock.png",className:"effect-lock"}),i.a.createElement("img",{onClick:t,src:"/floppy-disk.svg",className:n?"load-preset-button selected":"load-preset-button"}))}),Ao=(n(1826),function(e){if(!e)return"";e=e.trim();for(var t="",n=0;n<e.length;n++)e.charCodeAt(n)>=32&&(t+=e[n]);return t}),Mo=function(e){var t=e.effect,n=e.hide,o=e.sequencerEngine,s=(e.trackNumber,Object(a.useState)("")),u=Object(r.a)(s,2),l=u[0],f=u[1],h=Object(a.useState)([]),d=Object(r.a)(h,2),p=d[0],v=d[1],m=Object(a.useState)(!1),y=Object(r.a)(m,2),b=y[0],g=y[1],O=Object(a.useCallback)(function(){var e=t.getJson();Ii(e,l),n()},[l,n,t]),j=Object(a.useCallback)(function(){var e=Object(K.a)(W.a.mark(function e(r){var a,i,s,u,l;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g(r),a=t.id,i=t.x,s=t.y,e.next=4,di.a.getJson(r.effectHash);case 4:return u=e.sent,e.next=7,t.fromJson(u,!0);case 7:l=e.sent,t.id=a,t.x=i,t.y=s,t.track&&t.track.loadLostParameters&&t.track.loadLostParameters(),t.preset=r.effectHash,o.dispatch(Object(c.xb)(l)),g(void 0),n();case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[g,t]);Object(a.useEffect)(function(){qi(t.name).then(function(e){return v(e)})},[v,t]);var k="save-button";return""===l&&(k+=" disabled"),i.a.createElement("div",{className:"effect-presets"},i.a.createElement("div",{className:"presets-container"},p.map(function(e){return i.a.createElement(Ro,{id:e.effectHash,isLoading:e===b,isSelected:e.effectHash===t.preset,onClick:function(){return j(e)},preset:e})})),i.a.createElement("div",{className:"save-container"},i.a.createElement("input",{type:"text",className:"save-input",placeholder:"Type name to save",value:l,onChange:function(e){return f(e.target.value)}}),i.a.createElement("div",{onClick:O,className:k},"SAVE")))},Ro=function(e){var t=e.preset,n=e.onClick,o=e.isSelected,s=e.isLoading,c=Object(a.useState)(""),u=Object(r.a)(c,2),l=u[0],f=u[1];Object(a.useEffect)(function(){},[f]);var h="effect-preset";return o&&(h+=" selected"),s&&(h+=" loading"),i.a.createElement("div",{onClick:n,className:h},i.a.createElement("div",{className:"preset-title"},Ao(t.title)),i.a.createElement("div",{className:"preset-author"},l))};function Co(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var No=function(e){Object(b.a)(n,e);var t=Co(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={minValue:r.min,maxValue:r.max},r}return Object(y.a)(n,[{key:"parameter",get:function(){return this.props.parameterMod.parameter}},{key:"mod",get:function(){return this.props.parameterMod}},{key:"min",get:function(){return this.mod.scale.min}},{key:"max",get:function(){return this.mod.scale.max}},{key:"onChangeMin",value:function(e){(Object(Ae.a)(e)||"."===e||""===e||"-"===e)&&(this.setState({minValue:e}),Object(Ae.a)(e)?(console.log("returning because = "+e),this.mod.min=e):"."!==e&&""!==e&&"-"!==e||(this.mod.min=0))}},{key:"onChangeMax",value:function(e){Object(Ae.a)(e)||"."===e||""===e||"-"===e?(this.setState({maxValue:e}),Object(Ae.a)(e)?this.mod.max=e:"."!==e&&""!==e&&"-"!==e||(this.mod.max=0)):console.log("returning because = "+e)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"parameter-mod"},i.a.createElement("div",{className:"parameter-mod-pieces"},i.a.createElement("div",{className:"parameter-mod-modulator"},this.mod.type," ",this.mod.modulator.number," "),i.a.createElement("div",{className:"parameter-mod-text"},"mod"),i.a.createElement("div",{className:"parameter-mod-parameter"},this.parameter.name," ")),i.a.createElement("div",{className:"parameter-mod-min"},"Min:",i.a.createElement(Io,{placeholder:"Min",onChange:function(t){return e.onChangeMin(t)},number:this.state.minValue})),i.a.createElement("div",{className:"parameter-mod-max"},"Max:",i.a.createElement(Io,{placeholder:"Max",onChange:function(t){return e.onChangeMax(t)},number:this.state.maxValue})))}}]),n}(a.Component),Io=function(e){Object(b.a)(n,e);var t=Co(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"number-input-container"},i.a.createElement(Hr.b,Object(T.a)({onChange:function(t){return e.props.onChange(t.target.value)},value:this.props.number,className:"search-input",placeholder:this.props.placeholder},"className","number-input")))}}]),n}(a.Component),qo=No;function _o(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}a.Component;var Do=function(e){Object(b.a)(n,e);var t=_o(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={option:void 0},r}return Object(y.a)(n,[{key:"options",get:function(){return this.props.parameters.map(function(e){return{value:e,label:e.name}})}},{key:"onChooseParameter",value:function(e){this.setState({option:e})}},{key:"render",value:function(){var e=this;return i.a.createElement(or.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.options,onChange:function(t){return e.onChooseParameter(t)},value:this.state.option,placeholder:"Parameter"})}}]),n}(a.Component);function Fo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var Lo=function(e){Object(b.a)(n,e);var t=Fo(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"parameterMods",get:function(){var e=[];return this.props.parameters.forEach(function(t){return e=e.concat(t.parameterMods)}),e}},{key:"render",value:function(){return i.a.createElement("div",null,this.parameterMods.map(function(e,t){return i.a.createElement(qo,{key:"mod-"+t+"-"+e.parameter.id,parameterMod:e})}))}}]),n}(a.Component);n(1827);function Bo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var zo=new Ot.a,Jo=function(e){Object(b.a)(n,e);var t=Bo(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={showMods:!1,isCollapsed:e.isMixCollapsed||e.isCollapsed,isDraggable:void 0===e.isDraggable||e.isDraggable,showPresets:!1},r.togglePresets=r.togglePresets.bind(Object(Q.a)(r)),r}return Object(y.a)(n,[{key:"togglePresets",value:function(){this.setState({showPresets:!this.state.showPresets})}},{key:"shouldComponentUpdate",value:function(e){return e.isCollapsed!==this.props.isCollapsed&&(this.state.isCollapsed=e.isCollapsed),!0}},{key:"toggleCollapsed",value:function(){this.props.effect.isEnabled()&&this.props.setEffectCollapsed(this.props.effect.id,!this.state.isCollapsed)}},{key:"deleteEffect",value:function(){(!this.props.instrument&&!this.props.isPulled||this.props.effect.track&&this.props.effect.track.tracks)&&this.operationManager.dispatch(Object($.e)(this.props.effect,this.props.track,this.props.group,this.props.send)),this.props.onDeleteEffect&&this.props.onDeleteEffect(this.props.effect)}},{key:"handleToggle",value:function(){this.operationManager.dispatch(Object($.q)(this.props.effect,this.props.track,this.props.group,this.props.send)),this.props.onToggle()}},{key:"getTrackOrGroup",value:function(){return this.props.send||this.props.track||this.props.group}},{key:"operationManager",get:function(){return this.props.sequencerEngine.operationManager}},{key:"getContextNumber",value:function(){return void 0!==this.props.track?this.props.track.trackNumber:void 0!==this.props.group?this.props.group.groupNumber:1}},{key:"onDragStart",value:function(e){if(this.state.isDraggable&&!this.props.automation&&this.getTrackOrGroup()){var t=this.getTrackOrGroup().getEffectNumber(this.props.effect,this.props.isMidiEffect);this.props.isLiveEffect||this.props.isMidiEffect?(this.props.clearDragDrop(),this.props.dragMidiEffect({number:this.getContextNumber(),effectNumber:t,effect:this.props.effect})):(this.props.clearDragDrop(),this.props.dragEffect({number:this.getContextNumber(),effectNumber:t,effect:this.props.effect}))}}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"onDragOver",value:function(e){this.state.isDraggable&&e.preventDefault()}},{key:"onDrop",value:function(e){if(this.props.featured){var t=this.props.effectDragging||this.props.midiEffectDragging;if(!t)return;return function(e,t,n){if(e!==t){var r,a=n.state.effects.pulledEffects,i=n.state.effects.pulledEffects.indexOf(e),s=n.state.effects.pulledEffects.indexOf(t);s>i?(r=[].concat(Object(o.a)(a.slice(0,i)),[t],Object(o.a)(a.slice(i,s))),a.length>s+1&&(r=[].concat(Object(o.a)(r),Object(o.a)(a.slice(s+1))))):(r=[].concat(Object(o.a)(a.slice(0,s)),Object(o.a)(a.slice(s+1,i)),[e,t]),a.length>i+1&&(r=[].concat(Object(o.a)(r),Object(o.a)(a.slice(i+1))))),n.dispatch(Object(c.dd)(r))}}(this.props.effect,t.effect,this.props.sequencerEngine),this.props.dragEffect(void 0),void this.props.dragMidiEffect(void 0)}if(this.state.isDraggable&&!this.props.automation&&this.getTrackOrGroup()){if(void 0!==this.props.effectDragging){var n=this.getTrackOrGroup().getEffectNumber(this.props.effect,this.props.isMidiEffect);if(this.props.isMidiEffect)return void this.props.dragEffect(void 0);this.props.effectDragging.number===this.getContextNumber()&&this.operationManager.dispatch(Object($.k)(this.props.effectDragging.effectNumber,n,!1,this.props.track,this.props.group,this.props.send)),this.props.dragEffect(void 0)}else{if(void 0===this.props.midiEffectDragging)return;var r=this.getTrackOrGroup().getEffectNumber(this.props.effect,this.props.isMidiEffect);this.props.isMidiEffect&&this.props.midiEffectDragging.number===this.getContextNumber()&&this.operationManager.dispatch(Object($.k)(this.props.midiEffectDragging.effectNumber,r,!0,this.props.track,this.props.group,this.props.send)),this.props.dragMidiEffect(void 0),this.props.dragEffect(void 0)}this.props.onDeleteEffect()}}},{key:"getClassName",value:function(e){return this.props.effect.isEnabled()?e:e+" disabled"}},{key:"detachEffect",value:function(e){var t=this.props.sequencerEngine.state,n=[].concat(Object(o.a)(t.effects.pulledEffects),[this.props.effect]);this.props.setPulledEffects(n)}},{key:"selectEffect",value:function(e){if(e.stopPropagation(),this.props.linkingEffects)return this.props.linkingEffects.effect.linkedEffect=this.props.effect,void this.props.setLinkingEffects(void 0);this.props.planeMapping&&this.props.planeMapping!==this.props.effect&&(this.setState({isMapped:!0}),this.props.planeMapping.randomlyMapParameters(this.props.effect));var t=this.props.track?this.props.track.sequencerEngine:this.props.effect.sequencerEngine;t&&!this.props.noSelect&&t.selectEffect(this.props.effect),this.props.noSelect||this.props.setSelectedEffect(this.props.effect.id)}},{key:"render",value:function(){var e=this;if(!this.props.effect.name)return"";var t=this.props.isTall?"tall-effect effect":"effect";this.props.effectClass&&(t+=" "+this.props.effectClass);var n=void 0!==this.props.automation?"enabled "+t+" effect-automation":this.props.effect.isEnabled()?t+" enabled":"effect disabled";this.props.isSelectedZObject&&(n+=" selected-zobject");var r=!1;this.props.effect&&this.props.effect.track&&this.props.effect.track.tracks&&(r=!0),n+=" "+this.props.effect.name.split(" ").join("_")+" ",this.state.isCollapsed&&(n+=" collapsed"),this.props.isSelected&&(n+=" selected"),this.props.isMidiEffect&&(n+=" midi"),this.props.isLiveEffect&&(n+=" live"),"Midi Effect Rack"!==this.props.effect.name&&"Effect Rack"!==this.props.effect.name||(n+=" racked"),"Jaki"===this.props.effect.name&&(n+=" Jaki");var a="effect-header";if(this.props.hideBarButtons&&(a+=" hide-buttons"),this.props.planeMapping&&this.props.planeMapping!==this.props.effect&&(this.state.isMapped||(n+=" plane-mapping")),this.props.linkingEffects&&this.props.effect.name===this.props.linkingEffects.name&&(n+=" plane-mapping"),"Message"===this.props.effect.name)return i.a.createElement(Eo,{effect:this.props.effect});if(this.props.isPulled)return n+=" pulled",i.a.createElement("div",{onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onDrop:function(t){e.onDrop(t)},draggable:this.state.isDraggable,className:n},i.a.createElement("div",{className:"effect-header"},this.props.effect.name),i.a.createElement("div",{className:"effect-inner"},i.a.createElement("img",{src:"/detached.svg",className:"detached-icon"}),i.a.createElement("div",{className:"detached-label"},"Detached")));var o=function(){var t,n=e.props.effect,r=(t=n)&&t.getEffectType&&t.getEffectType()!==Po.a&&t.track?t.track:t.context?t.context.track:t.track;return r?i.a.createElement("div",{style:{backgroundColor:r.color||zo.getColorForTrack(r)},className:"effect-from"},r.envelopesTrack?r.name:r.getName()):""};return this.props.showStar&&(a+=" showing-star"),i.a.createElement("div",{onClick:function(t){return e.selectEffect(t)},onDrop:function(t){e.onDrop(t)},className:n},i.a.createElement("div",{onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},draggable:!this.props.hideIOs&&!this.props.noSelect&&this.state.isDraggable,className:a},i.a.createElement(wi.a,{condition:!this.props.hideBarButtons},i.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,Ya.i)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.handleToggle()},className:"effect-toggle"},i.a.createElement("div",{className:"toggle-icon"})),i.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,Ya.d)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.toggleCollapsed()},className:"collapse-toggle"},i.a.createElement(wi.a,{condition:this.state.isCollapsed},i.a.createElement("div",{className:"arrow-down"})),i.a.createElement(wi.a,{condition:!this.state.isCollapsed},i.a.createElement("div",{className:"arrow-right"})))),i.a.createElement(wi.a,{condition:this.props.effect.isEnabled()&&!this.state.isCollapsed},i.a.createElement("div",{className:"effect-name"},this.props.effect.name)),this.props.featured&&o(),this.props.featured?"":i.a.createElement("img",{onClick:function(){return e.detachEffect()},src:"/detached.svg",className:"detach-effect-icon"}),this.props.alternateButton||"",i.a.createElement(wi.a,{condition:!this.props.hideBarButtons&&void 0===this.props.automation&&!this.state.isCollapsed},this.props.showStar&&i.a.createElement("div",{onClick:function(){return e.props.setStarred(!e.props.isStarred)},className:this.props.isStarred?"starred star":"star"},i.a.createElement("span",null,"\u2606")),i.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,Ya.e)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"effect-delete-btn delete-button",onClick:function(){return e.deleteEffect()}},r||!this.props.featured||this.props.showDelete?"x":"-"))),i.a.createElement(wi.a,{condition:this.state.showPresets},i.a.createElement(Mo,{sequencerEngine:this.props.sequencerEngine,trackNumber:this.props.track&&this.props.track.trackNumber,hide:function(){return e.setState({showPresets:!1})},effect:this.props.effect})),i.a.createElement(wi.a,{condition:!this.state.showPresets},i.a.createElement("div",{className:"inner-effect"},i.a.createElement(wi.a,{condition:!this.props.effect.isEnabled()||this.state.isCollapsed},i.a.createElement("div",{className:"effect-name"},this.props.name||this.props.effect.name),o()),i.a.createElement("div",{className:"clear-fix"}),i.a.createElement(wi.a,{condition:this.state.showMods},i.a.createElement(Lo,{parameters:this.props.effect.parameters})),i.a.createElement(wi.a,{condition:!this.state.showMods&&!this.state.isCollapsed&&!this.state.showPresets},this.props.children),i.a.createElement("div",{className:"clear-fix"}))),!this.props.isLiveEffect&&i.a.createElement(To,{effect:this.props.effect,togglePresets:this.togglePresets,setContextualHelp:this.props.setContextualHelp,showPresets:this.state.showPresets}))}}]),n}(a.Component),Vo=Object(s.b)(function(e,t){return{planeMapping:e.effects.planeMapping,effectDragging:e.sequencer.effectDragging,midiEffectDragging:e.effects.midiEffectDragging,isCollapsed:e.effects.effectCollapsed[t.effect.id],isSelected:e.effects.selectedEffect===t.effect.id,isEnabled:t.effect.isEnabled(),linkingEffects:e.effects.linkingEffects,isStarred:e.effects.effectStarred[t.effect.id],isSelectedZObject:t.effect===e.zobject.selectedZObject,preset:t.effect.preset}},function(e,t){return{setContextualHelp:function(t){return e(Object(c.bb)(t))},dragEffect:function(t){return e(Object(c.g)(t))},dragMidiEffect:function(t){return e(Object(c.jc)(t))},setEffectCollapsed:function(t,n){return e(Object(c.vb)(t,n))},setSelectedEffect:function(t){return e(Object(c.rd)(t))},setPulledEffects:function(t){return e(Object(c.dd)(t))},setLinkingEffects:function(t){return e(Object(c.ec)(t))},setStarred:function(n){return e(Object(c.zb)(t.effect.id,n))},clearDragDrop:function(t){return e(Object(c.a)(t))}}})(Jo),Ho=n(182);function Uo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var Go=function(e){Object(b.a)(n,e);var t=Uo(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(y.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"handleModeChange",value:function(e){this.state.effect.mode=e.value,this.setState(this.state)}},{key:"handleFactorChange",value:function(e){this.state.effect.rollFactor=e.value,this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){var e,t=this;void 0!==this.props.automation||this.state.effect.isEnabled();return i.a.createElement("div",null,this.isEnabled()?i.a.createElement("div",null,i.a.createElement("div",{className:"lfo-rate-dropdown roll-factor"},i.a.createElement("div",{className:"lfo-rate-label"},"Mode:"),i.a.createElement(or.a,{className:"osc-type-dropdown roll-factor-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:Qo,onChange:function(e){return t.handleModeChange(e)},value:(e=this.state.effect.mode,Qo.filter(function(t){return t.value===e})[0]),placeholder:"Rate"}),i.a.createElement("div",{className:"clear-fix"})),i.a.createElement("div",{className:"lfo-rate-dropdown roll-factor"},i.a.createElement("div",{className:"lfo-rate-label"},"Roll Factor:"),i.a.createElement(or.a,{className:"osc-type-dropdown roll-factor-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:Wo,onChange:function(e){return t.handleFactorChange(e)},value:Ko(this.state.effect.rollFactor),placeholder:"Rate"}),i.a.createElement("div",{className:"clear-fix"}))):"")}}]),n}(a.Component),Wo=[{value:.125,label:"1/8"},{value:.25,label:"1/4"},{value:.5,label:"1/2"},{value:1,label:"1"},{value:2,label:"2"},{value:4,label:"4"},{value:8,label:"8"}];function Ko(e){return Wo.filter(function(t){return t.value===e})[0]}var Qo=[{value:Ho.g,label:"Sync"},{value:Ho.b,label:"On"},{value:Ho.a,label:"Off"}];var Zo=Go,Yo=n(313),$o=n.n(Yo),Xo=(Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.effect,n=Object(a.useState)(t.randomness),o=Object(r.a)(n,2),s=o[0],c=o[1],u=Object(a.useCallback)(function(e){var n=e.target.value;t.randomness=n,c(n)},[c]);return i.a.createElement("div",{className:"auto-map-settings"},i.a.createElement("div",{className:"randomness"},"Randomness: ",s),i.a.createElement($o.a,{value:s,change:u,step:.1,max:100,min:0,orientation:"horizontal",reversed:!1}))}),function(e){var t=e.subMacro,n=e.macro,o=t.parameter,s=o.context,c=s.subDevice,u=s.effect,l=s.liveEffect,f=s.midiEffect,h=s.instrument;c=c||u||l||f||h;var d=Object(a.useState)(t.min),p=Object(r.a)(d,2),v=p[0],m=p[1],y=Object(a.useState)(t.max),b=Object(r.a)(y,2),g=b[0],O=b[1],j=Object(a.useCallback)(function(){n.unmapParameter(o)},[n,o]),k=Object(a.useCallback)(function(e){var n=e.target.value;n=parseFloat(n),o.isValidValue(n)?(t.min=n,m(e.target.value)):""!==e.target.value&&"."!==e.target.value||m(e.target.value)},[m]),w=Object(a.useCallback)(function(e){var n=e.target.value;n=parseFloat(n),o.isValidValue(n)?(t.max=n,O(e.target.value)):""!==e.target.value&&"."!==e.target.value||O(e.target.value)},[O]);return i.a.createElement("div",{className:"sub-macro"},i.a.createElement("div",{className:"sub-field effect"},c?c.name:u?u.name:h?h.name:""),i.a.createElement("div",{className:"sub-field parameter"},o.name),i.a.createElement("div",{className:"sub-field"},i.a.createElement("input",{className:"min-field",onChange:k,value:v,type:"text"})),i.a.createElement("div",{className:"sub-field"},i.a.createElement("input",{className:"max-field",onChange:w,value:g,type:"text"})),i.a.createElement("div",{onClick:j,className:"unmap-button"},"x"))}),es=Object(s.b)(function(e,t){return{len:t.macro.subMacros.length}},function(e){return{}})(function(e){var t=e.macro,n=Object(a.useState)(t.name),o=Object(r.a)(n,2),s=o[0],c=o[1],u=Object(a.useState)(!1),l=Object(r.a)(u,2),f=l[0],h=l[1],d=Object(a.useCallback)(function(e){c(e.target.value),t.name=e.target.value},[c,t]),p=Object(a.useCallback)(function(e){"Enter"===e.key&&h(!1)},[h]);return i.a.createElement("div",{className:"macro-details"},f?i.a.createElement("input",{type:"text",value:s,onKeyUp:p,onChange:d}):i.a.createElement("div",{onClick:function(){return h(!0)},className:"macro-name"},t.name),t.subMacros.map(function(e){return i.a.createElement(Xo,{macro:t,subMacro:e})}))});function ts(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ns(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ns(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ns(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var rs=function(e){var t,n=e.effect,r=0,a=ts(n.macros);try{for(a.s();!(t=a.n()).done;){r+=t.value.subMacros.length}}catch(o){a.e(o)}finally{a.f()}return i.a.createElement("div",{className:"effect-details"},0===r?i.a.createElement("div",{className:"macros-details-title"},"Macros"):"",0===r?i.a.createElement("div",{className:"no-macros-text"},"You haven't set any macros yet."):"",n.macros.filter(function(e){return e.subMacros.length>0}).map(function(e){return i.a.createElement(es,{macro:e})}))};function as(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return is(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return is(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function is(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var os=function(e){var t=e.modulator,n=e.parameter,r=e.i,a=e.height,o=e.color,s=e.setSelectedEdge,c=e.selectedEdge,u=25+48*r,l="LFO"===t.getType()?0:4,f=15+33*(t.number-1)+33*l,h=a-18,d=c&&c.modulator===t&&c.parameter===n;return i.a.createElement("g",null,i.a.createElement("line",{onMouseDown:function(e){e.stopPropagation(),s({modulator:t,parameter:n})},x1:u,y1:2,x2:f,y2:h,strokeWidth:4,opacity:0,stroke:o}),i.a.createElement("line",{onMouseDown:function(e){e.stopPropagation(),s({modulator:t,parameter:n})},className:d?"mod-edge selected":c?"mod-edge hidden":"mod-edge",x1:u,y1:2,x2:f,y2:h,strokeWidth:2,stroke:o}))},ss=Object(s.b)(function(e,t){return t.parameter?{lfos:t.parameter.lfos.length,envelopes:t.parameter.envelopes.length}:{}},function(e){return{}})(function(e){var t=e.parameter;e.i,e.height,e.color,e.selectedEdge,e.setSelectedEdge;if(void 0===t)return[];var n,r=[],a=as(t.lfos);try{for(a.s();!(n=a.n()).done;){var o=n.value;r.push(i.a.createElement(os,Object.assign({},e,{modulator:o})))}}catch(l){a.e(l)}finally{a.f()}var s,c=as(t.envelopes);try{for(c.s();!(s=c.n()).done;){var u=s.value;r.push(i.a.createElement(os,Object.assign({},e,{modulator:u})))}}catch(l){c.e(l)}finally{c.f()}return r}),cs=n(17),us=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.modulator,n=e.i,r=(e.width,e.height),o=e.lineDragging,s=e.setLineDragging,c=e.el,u=2+33*n,l=r-15,f=Object(a.useCallback)(function(e){var n=c.current.getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top;s({x1:r,y1:a,x2:r,y2:a,modulator:t})},[s,c]),h=Object(a.useCallback)(function(e){if(o){var n=o.parameter;n.isAudioParamEnabled()||n.enableAudioParam(),"LFO"===t.getType()?n.connectToLFO(t):n.connectToEnvelope(t)}},[o,s,t]);return i.a.createElement("g",null,i.a.createElement("circle",{onMouseUp:h,onMouseDown:f,cx:u+14,cy:l-3,r:3}),i.a.createElement("rect",{x:u,y:l,width:30,height:15,fill:"gray"}),i.a.createElement("text",{x:u+2,y:l+14},t.name))}),ls=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.effect,n=e.sequencerEngine,s=e.parameters,c=e.width,u=void 0===c?260:c,l=e.height,f=void 0===l?40:l,h=e.color,d=Object(a.useState)(void 0),p=Object(r.a)(d,2),v=p[0],m=p[1],y=Object(a.useState)(void 0),b=Object(r.a)(y,2),g=b[0],O=b[1],j=Object(a.useRef)(void 0),k=an({ref:j,effect:t}).preventDragging;Object(a.useEffect)(function(){return window.addEventListener("keydown",w),function(){return window.removeEventListener("keydown",w)}},[g,O]);var w=Object(a.useCallback)(function(e){if("INPUT"!==e.target.tagName&&"Backspace"===e.key&&g){var t=g.modulator,n=g.parameter;t.getType()===cs.b?n.disconnectFromLFO(t):n.disconnectFromEnvelope(t),O(void 0)}},[g,O]),x=Object(a.useCallback)(function(e,t){if(v&&t){var n=v.modulator;t.isAudioParamEnabled()||t.enableAudioParam(),n.getType()===cs.b?t.connectToLFO(n):t.connectToEnvelope(n)}},[v,m]),S=Object(a.useCallback)(function(e){if(v){var t=j.current.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top,a=Object(ot.a)({},v,{x2:n,y2:r});m(a)}},[v,m]),P=function(e){return 25+48*s.indexOf(e)},E=Object(a.useCallback)(function(e,t){var n=j.current.getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top;m({x1:r,y1:a,x2:r,y2:a,parameter:t})},[m,j]),T=[].concat(Object(o.a)(n.lfos.map(function(e){return e.lfo})),Object(o.a)(n.envelopes));return i.a.createElement("div",{ref:j,className:"mod-routes"},i.a.createElement("svg",{onMouseDown:function(){k(!1),O(void 0)},onMouseUp:function(){k(!0),m(void 0)},onMouseMove:S,height:f,width:u},v?i.a.createElement("line",{x1:v.x1,y1:v.y1,x2:v.x2,y2:v.y2,stroke:"red",strokeWidth:1}):[],s.map(function(e,t){return i.a.createElement("g",{key:"fuck-yeah-"+t},i.a.createElement("circle",{key:"circle-yeah-"+t,onMouseDown:function(t){return E(t,e)},onMouseUp:function(t){return x(t,e)},cx:P(e),cy:2,r:3,fill:"black"}),i.a.createElement(ss,{key:t,selectedEdge:g,setSelectedEdge:O,i:t,color:h,parameter:e,height:f}))}),T.map(function(e,t){return i.a.createElement(us,{key:t,el:j,setLineDragging:m,lineDragging:v,i:t,width:u,height:f,modulator:e})})),g?i.a.createElement(qo,{parameterMod:g.parameter.parameterMods.find(function(e){return e.modulator===g.modulator})}):"")}),fs=function(e,t,n){return Math.max(e,Math.min(t,n))},hs=function(e,t){var n,r;return e.some(function(e){var a=Math.abs(t-e);if(a>=r)return!0;n=e,r=a}),n},ds=function(e){var t=e.min,n=e.max;return(e.value-t)/(n-t)},ps={37:-1,38:1,39:1,40:-1},vs=function(e){return function(t){return e(Object(ot.a)({},t,{type:"START"}))}},ms=function(e){return function(t){var n=ps[t.keyCode];n&&(t.preventDefault(),e({type:"STEPS",direction:n}))}},ys=function(e,t){return document.body.addEventListener(e,t)},bs=function(e,t){return document.body.removeEventListener(e,t)},gs=function(e){return Object(ot.a)({},e,{isActive:!0},function(e){var t=e.container,n=e.size,r=t.current.getBoundingClientRect();return{startX:Math.floor(r.left)+n/2,startY:Math.floor(r.top)+n/2}}(e))},Os=function(e){var t=e.state,n=e.action,r=(e.onChange,function(e){var t=e.startX,n=e.startY,r=(e.scrollContainer,e.size,e.pageX),a=e.pageY,i=e.angleOffset,o=e.angleRange,s=t-r,c=n-a,u=180*Math.atan2(-c,-s)/Math.PI+90-i,l=u<0?u+360:u%360;return l<=o?fs(0,1,l/o):+(l-o<(360-o)/2)}(Object(ot.a)({},t,n))),a=function(e){var t=e.min;return t+(e.max-t)*e.percentage}(Object(ot.a)({},t,{percentage:r}));return Object(ot.a)({},t,{percentage:r,value:a})},js=function(e){return function(t,n){switch(n.type){case"START":return gs(t);case"SCROLL_CONTAINER":return function(e,t){return Object(ot.a)({},e,{scrollContainer:t.scrollContainer})}(t,n);case"MOVE":return Os({state:t,action:n,onChange:e});case"STEPS":return function(e){var t=e.state,n=e.action,r=(e.onChange,fs(t.min,t.max,t.value+1*n.direction));return Object(ot.a)({},t,{value:r,percentage:ds(Object(ot.a)({},t,{value:r}))})}({state:t,action:n,onChange:e});default:return Object(ot.a)({},t,{isActive:!1,value:t.value})}}},ks=function(e){var t=e.min,n=e.max,i=e.initialValue,o=e.angleOffset,s=void 0===o?0:o,c=e.scrollContainer,u=e.angleRange,l=void 0===u?360:u,f=e.size,h=e.steps,d=(e.snap,e.onChange),p=Object(a.useRef)(),v=Object(a.useRef)(),m=Object(a.useReducer)(js(d),{isActive:!1,min:t,max:n,angleOffset:s,angleRange:l,percentage:void 0!==i?(i-t)/(n-t):0,value:i||0,svg:p,container:v,size:f}),y=Object(r.a)(m,2),b=y[0],g=b.percentage,O=b.value,j=b.angle,k=b.isActive,w=y[1];return Object(a.useEffect)(function(e){var t=e.dispatch,n=e.isActive;return function(){var e=function(e){var n=e.pageX,r=e.pageY;return t({pageX:n,pageY:r,type:"MOVE"})},r=function(){return t({type:"STOP"})};if(n)return ys("mousemove",e),ys("mouseup",r),function(){bs("mousemove",e),bs("mouseup",r)}}}({dispatch:w,isActive:k}),[k]),{dispatch:w,svg:p,container:v,percentage:h?hs(h,g):g,value:O,scrollContainer:c,angle:j,onStart:vs(w),onKeyDown:ms(w),onScroll:function(e){}}},ws=function(e,t,n){return{x:e+t*Math.cos(n),y:e+t*Math.sin(n)}},xs=function(e){return Math.PI*e/180},Ss=function(e){var t=e.percentage,n=e.angleOffset,r=e.angleRange,a=e.arcWidth,i=e.radius,o=e.center,s=r*t,c=n-90,u=i-a,l=xs(c),f=xs(c+s),h=s<180?0:1,d=ws(o,i,f),p=ws(o,i,l),v=ws(o,u,l),m=ws(o,u,f);return"M".concat(d.x,",").concat(d.y," A").concat(i,",").concat(i," 0 ").concat(h," 0 ").concat(p.x,",").concat(p.y,"L").concat(v.x,",").concat(v.y," A").concat(u,",").concat(u," 0 ").concat(h," 1 ").concat(m.x,",").concat(m.y," L").concat(d.x,",").concat(d.y)},Ps=function(e){var t=e.color,n=e.background,r=Object(kn.a)(e,["color","background"]);return i.a.createElement("g",null,n&&i.a.createElement("path",{d:Ss(Object(ot.a)({},r,{percentage:1})),style:{fill:n}}),i.a.createElement("path",{d:Ss(r),style:{fill:t}}))},Es=function(e){var t=e.children,n=e.width,r=e.height,a=void 0===r?n:r,o=e.angleOffset,s=e.angleRange,c=e.percentage,u=e.radius,l=e.center,f=e.type,h=e.color,d=e.className;return i.a.createElement("g",{transform:"\n        rotate(".concat(o+s*c," ").concat(l," ").concat(l,")\n        translate( ").concat(l-n/2," ").concat(l-u-a,")\n        ")},t&&i.a.Children.map(t,function(e){return i.a.cloneElement(e,{width:n,height:a,percentage:c})}),"rect"===f&&i.a.createElement("rect",{width:n,height:a,fill:h,className:d}),"circle"===f&&i.a.createElement("circle",{r:n,fill:h,className:d}))},Ts=function(e){var t=e.angleRange,n=e.steps,r=e.type,a=void 0===r?"rect":r,o=e.radius,s=e.tickWidth,c=e.tickHeight,u=e.angleOffset,l=e.center,f=e.color,h=e.activeColor,d=void 0===h?f:h,p=e.className,v=e.activeClassName,m=void 0===v?p:v,y=e.fn,b=e.percentage,g=t/n,O=n+(360===t?0:1),j=l-s/2,k=l-o,w=Math.round((O-1)*b),x="circle"===a?function(e){var t=e.tickWidth,n=e.translateX,r=e.translateY,a=e.angleOffset,o=e.stepSize,s=e.center,c=e.color,u=e.active,l=e.activeColor,f=e.activeClassName,h=e.className;return function(e,d){return i.a.createElement("circle",{r:t,key:d,className:d===u?f:h,fill:d===u?l:c,stroke:"none",transform:"\n        rotate(".concat(a+o*d," ").concat(s," ").concat(s,") \n        translate(").concat(n," ").concat(r,")\n        ")})}}({tickWidth:s,translateX:j,translateY:k,center:l,angleOffset:u,stepSize:g,color:f,active:w,activeColor:d,className:p,activeClassName:m}):"rect"!==a||y?function(e){var t=e.fn,n=Object(kn.a)(e,["fn"]);return function(e,r){return t(Object(ot.a)({},n,{i:r}))}}({fn:y,tickWidth:s,tickHeight:c,translateX:j,translateY:k,angleOffset:u,stepSize:g,center:l,color:f,active:w,activeColor:d,className:p,activeClassName:m}):function(e){var t=e.tickWidth,n=e.tickHeight,r=e.translateX,a=e.translateY,o=e.angleOffset,s=e.stepSize,c=e.center,u=e.color,l=e.active,f=e.activeColor,h=e.activeClassName,d=e.className;return function(e,p){return i.a.createElement("rect",{className:p===l?h:d,fill:p===l?f:u,stroke:"none",width:t,height:n,key:p,transform:"\n        rotate(".concat(o+s*p," ").concat(c," ").concat(c,") \n        translate(").concat(r," ").concat(a,")\n        ")})}}({tickWidth:s,tickHeight:c,translateX:j,translateY:k,angleOffset:u,stepSize:g,center:l,color:f,active:w,activeColor:d,className:p,activeClassName:m});return i.a.createElement("g",null,Array.from({length:O},x))},As=function(e,t){return e&&t?Array.from({length:e+1},function(t,n){return 1/e*n}):void 0},Ms=function(e){var t=e.type;return t===Ps||t===Es||t===Ts||t===function(e){var t=e.value,n=e.size,r=e.decimalPlace,a=void 0===r?0:r,o=e.className,s=e.marginBottom,c=void 0===s?0:s;return null==t?null:i.a.createElement("text",{style:{userSelect:"none"},x:"50%",textAnchor:"middle",className:o,y:n-c},t.toFixed(a))}},Rs=function(e){var t=e.min,n=e.max,r=e.value,o=e.angleOffset,s=void 0===o?0:o,c=e.angleRange,u=void 0===c?360:c,l=e.size,f=e.onChange,h=void 0===f?function(){}:f,d=e.children,p=e.scrollContainer,v=e.steps,m=e.snap,y=void 0!==m&&m,b=e.ariaValueText,g=e.ariaLabelledBy,O=e.className,j=ks({min:t,scrollContainer:p,max:n,initialValue:r,angleOffset:s,percentage:ds({initialValue:r,min:t,max:n}),angleRange:u,size:l,steps:As(v,y),onChange:h}),k=j.dispatch,w=j.onStart,x=j.svg,S=j.container,P=j.onKeyDown,E=j.onScroll,T=r,A=void 0!==r?(r-t)/(n-t):0;return Object(a.useEffect)(function(){h(j.value)},[j.value]),Object(a.useEffect)(function(){k({scrollContainer:p,type:"SCROLL_CONTAINER"})},[p]),i.a.createElement("div",{ref:S,tabIndex:"0",style:{outline:"none",width:l,height:l},"aria-valuemax":n,"aria-valuemin":t,"aria-valuenow":T,"aria-valuetext":b,"aria-labelledby":g,onKeyDown:P,onWheel:E,className:O},i.a.createElement("svg",{onMouseDown:function(e){e.preventDefault(),w(e)},width:l,height:l,ref:x},i.a.createElement("g",{className:"knob-group"},i.a.Children.map(d,function(e){return Ms(e)?i.a.cloneElement(e,Object(ot.a)({percentage:A,size:l,value:T,angleOffset:s,angleRange:u,radius:l/2,center:l/2,steps:v},e.props)):e}))))},Cs=Object(s.b)(function(e,t){return t.parameter?{value:t.parameter.get(),isMidiSelected:t.parameter.id===e.midi.parameterSelected,midiMapMode:e.midi.midiMapMode,isMacroMapping:e.effects.isMacroMapping}:{value:0}},function(e){return{setParameterToMap:function(t){return e(Object(c.Ic)(t))},setParameterSliderDown:function(t){return e(Object(c.Hc)(t))},setParameterMidiMapSelection:function(t){return e(Object(c.Dc)(t))}}})(function(e){var t=e.unit,n=e.size,o=void 0===n?30:n,s=e.name,c=e.parameter,u=e.setParameterSliderDown,l=e.value,f=e.color,h=e.min,d=void 0===h?c.min:h,p=e.max,v=void 0===p?c.max:p,m=e.step,y=e.scrollContainer,b=e.isMidiSelected,g=e.midiMapMode,O=e.setParameterMidiMapSelection,j=e.setParameterToMap,k=e.isMacroMapping,w=e.setSelectedParameter,x=Object(a.useState)(!1),S=Object(r.a)(x,2),P=S[0],E=S[1],T=d>=0;l<d&&(l=d);var A=Object(a.useCallback)(function(e){if(P){document.activeElement.blur();var t=T?Math.pow(e,2):e;t===d&&(t=c.min),c.set(t,!1),g===Me.b&&O(c.id)}else E(!0)},[c,T,P,E,g]),M=T?Math.sqrt(l):l,R=i.a.createElement(Rs,{scrollContainer:y,size:o,angleOffset:220,angleRange:280,value:M,initialValue:M,step:m||1,min:T?Math.sqrt(d):d,max:T?Math.sqrt(v):v,onChange:A},i.a.createElement(Ps,{arcWidth:2,color:f||"white",background:"#6c757a"}),i.a.createElement(Es,{width:2,height:o/3,radius:4,type:"rect",color:f||"white"})),C=Object(a.useCallback)(function(e){w&&w(c),k&&(c.isMapped||j(c)),e.stopPropagation(),u(c)},[k,c,w]),N=Object(a.useCallback)(function(){u(void 0),c.automation.smoothen(),c.mixAutomation.smoothen()},[c]),I="parameter-knob";return b&&g===Me.b&&(I+=" midi-selected"),k&&(I+=" plane-mapping"),s?i.a.createElement($a.a,{element:c,onMouseDown:C,onMouseUp:N,onContextMenu:function(e){e.stopPropagation(),e.preventDefault()},className:I},s,R,Math.round(100*l)/100," ",t):i.a.createElement($a.a,{onContextMenu:function(e){e.stopPropagation(),e.preventDefault()},onMouseDown:C,onMouseUp:N,className:I},R)}),Ns=new Ot.a,Is=Object(s.b)(function(e){return{isMacroMapping:e.effects.isMacroMapping,parameterToMap:e.effects.isMacroMapping&&e.effects.parameterToMap}},function(e){return{setIsMacroMapping:function(t){return e(Object(c.Nb)(t))}}})(function(e){var t=e.macro,n=e.parameterToMap,o=e.isMacroMapping,s=e.setIsMacroMapping,c=e.scrollContainer,u=t.macroParameter,l=t.name,f=Object(a.useState)(n&&t.isParameterMapped(n)),h=Object(r.a)(f,2),d=h[0],p=h[1];Object(a.useEffect)(function(){p(!!n&&t.isParameterMapped(n))},[n,p]);var v=Object(a.useCallback)(function(){o&&n&&(d?t.unmapParameter(n):t.addParameter(n),p(!d),s(!1),s(!0))},[n,p,d,o]);return i.a.createElement("div",{className:"macro-knob"},i.a.createElement("div",{className:"macro-name"},l),i.a.createElement(Cs,{scrollContainer:c,color:Ns.getColorForHash(t.id),parameter:u}),o?i.a.createElement("div",{onClick:v,className:d?"unmap map-button":"map-button"},d?"Unmap":"Map"):"")}),qs=(n(1828),Object(s.b)(function(e,t){return{isMacroMapping:e.effects.isMacroMapping}},function(e){return{}})(function(e){var t=e.effect,n=e.scrollContainer,o=e.isMacroMapping,s=Object(a.useState)(!1),c=Object(r.a)(s,2);c[0],c[1],Object(a.useCallback)(function(){t.generateMappings()},[t]);if(!t.isEnabled())return i.a.createElement("div",null);var u=t.macros.map(function(e){return e.macroParameter});return i.a.createElement("div",{className:"macros-effect"},i.a.createElement("div",{className:"macros-container"},t.macros.map(function(e){return i.a.createElement(Is,{key:e.id,scrollContainer:n,macro:e})})),i.a.createElement(ls,{effect:t,width:280,sequencerEngine:t.track.sequencerEngine,color:"red",parameters:u}),o?i.a.createElement(rs,{effect:t}):"")})),_s=n(367),Ds=Object(s.b)(function(e,t){return{direction:t.effect.direction}},function(e){return{}})(function(e){var t=e.effect,n=e.direction,r=e.sequencerEngine,o=[{label:"Forward",value:_s.b},{label:"Reverse",value:_s.d},{label:"Forward-Reverse",value:_s.c},{label:"Brownian",value:_s.a}],s=Object(a.useCallback)(function(e){t.directionParameter.set(e.value,void 0,void 0)},[t]);return i.a.createElement("div",null,i.a.createElement("div",{className:"direction-parameter"},i.a.createElement("div",{className:"parameter-label"},"Direction:"),i.a.createElement(or.a,{className:"osc-type-dropdown float-left",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:o,onChange:s,value:o.find(function(e){return e.value===n}),placeholder:"Direction"})),n!==_s.a?i.a.createElement("div",null,i.a.createElement(Ft.a,{name:"Speed",parameter:t.speedFactorParameter,onParameterChanged:function(){return[]},isParameter:!0,sequencerEngine:r,lfoEnabled:!0,unit:"x",step:.25,min:.25,max:window.isNFT?1:4}),i.a.createElement("div",{className:"offset-parameter"},i.a.createElement(Ft.a,{name:"Offset",parameter:t.offsetParameter,onParameterChanged:function(){return[]},isParameter:!0,sequencerEngine:r,lfoEnabled:!0,unit:"x",step:1,min:0,max:16}))):i.a.createElement(Ft.a,{name:"Walk",parameter:t.walkParameter,onParameterChanged:function(){return[]},isParameter:!0,sequencerEngine:r,lfoEnabled:!0,unit:"Steps (1/32th)",step:1,min:1,max:16}))}),Fs=function(e){if(e.context.effect)return e.context.effect.name+" - "+e.prettyName;if(e.context.midiEffect)return e.context.midiEffect.name+" - "+e.prettyName;if(e.context.macro)return e.context.macro.name;if(e.context.subDevice&&e.context.instrument){var t=e.context.instrument,n=t.getSubDeviceIndex(e.context.subDevice),r=t.getSubDevices();if(r[n])return r[n].label+" - "+e.prettyName}return e.prettyName},Ls=(Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.effect,n=e.palette,r=t.track.getAllParameters().filter(function(e){return n in e.paletteToValue});return i.a.createElement("div",{className:"palette-details"},r.map(function(e){return i.a.createElement(Ft.a,{key:e.id,name:Fs(e),min:e.min,max:e.max,sequencerEngine:t.track.sequencerEngine,step:.01,isParameter:!0,parameter:e})}))}),["#ff7759","#ffc782","#f5ff60","#59e800","#ff78ff","#ff2f8f"]),Bs=function(e){var t=e.selectedPalette,n=e.palette,r=e.onChoose,a=t===n?"selected palette-option":"palette-option",o={backgroundColor:Ls[n]};return i.a.createElement("div",{style:o,onClick:function(){return r(n)},className:a},n+1)},zs=Object(s.b)(function(e,t){var n=e.effects.sequencedPalettes[t.effect.track.id],r=e.effects.selectedPalettes[t.effect.track.id];return{selectedPalette:void 0!==r?r:n}},function(e){return{setSelectedPalette:function(t,n){return e(Object(c.xd)(t,n))}}})(function(e){var t=e.effect,n=e.selectedPalette,s=(e.setSelectedPalette,Object(a.useState)(Object(o.a)(t.palettes))),c=Object(r.a)(s,2),u=c[0],l=c[1],f=Object(a.useCallback)(function(){t.newPalette(),l(Object(o.a)(t.palettes))},[l]),h=Object(a.useCallback)(function(e){e===n&&(e=void 0),t.switchToPalette(e,n,void 0,!0)},[t,n]);return i.a.createElement("div",{className:"palettes-effect"},i.a.createElement("div",{className:"palettes-container"},u.map(function(e){return i.a.createElement(Bs,{onChoose:h,selectedPalette:n,palette:e})}),i.a.createElement("div",{onClick:f,className:"new-palette-btn"},"+")))});function Js(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var Vs=function(e){Object(b.a)(n,e);var t=Js(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={},r}return Object(y.a)(n,[{key:"getEffectChild",value:function(){switch(this.props.effect.effect){case Ho.f:return i.a.createElement(Zo,this.props);case Ho.c:return i.a.createElement(qs,this.props);case Ho.d:return i.a.createElement(zs,this.props);case Ho.e:return i.a.createElement(Ds,this.props);default:return""}}},{key:"getMacroMapButton",value:function(){return i.a.createElement(on,null)}},{key:"render",value:function(){var e=this;return i.a.createElement(Vo,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,effectClass:this.props.effect.name,sequencerEngine:this.props.sequencerEngine,isLiveEffect:!0,alternateButton:this.props.effect.effect===Ho.c?this.getMacroMapButton():void 0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),this.getEffectChild())}}]),n}(a.Component),Hs=(Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){return i.a.createElement("div",null,i.a.createElement(Ft.a,{effectNumber:e.effectNumber,name:"Flush",parameter:e.effect.flushParameter,automation:e.automation,onParameterChanged:e.onParameterChanged,isParameter:!0,sequencerEngine:e.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:32}))}),Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.effect,n=e.sequencerEngine,o=Object(a.useState)([]),s=Object(r.a)(o,2),c=s[0],u=s[1],l=Object(a.useState)(t.parameter),f=Object(r.a)(l,2),h=(f[0],f[1]);Object(a.useEffect)(function(){var e=t.getAvailableParameters();u(e.map(function(e){return{label:e.name,value:e}}))},[]);var d=Object(a.useCallback)(function(e){console.log("setting parameter=",e.value),t.parameter=e.value,h(e.value)},[t,h]),p=void 0;if(t.parameter){var v=c.filter(function(e){return e.value===t.parameter});p=v.length>0?v[0]:void 0}return i.a.createElement("div",null,i.a.createElement(or.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:c,onChange:function(e){return d(e)},value:p,placeholder:"Parameter"}),i.a.createElement(Ft.a,{name:"Max",sequencerEngine:n,root:4,lfoEnabled:!0,parameter:t.maxParameter,isParameter:!0,step:.01,max:1,min:0}))}));function Us(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var Gs=function(e){Object(b.a)(n,e);var t=Us(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={},r}return Object(y.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"getParameterOptions",value:function(){return this.props.effect.getAvailableParameters().map(function(e){return{label:e.name,value:e}})}},{key:"getParameterOption",value:function(e){if(void 0!==e){var t=this.getParameterOptions().filter(function(t){return t.value===e});return t.length>0?t[0]:void 0}}},{key:"handleParameterChange",value:function(e){this.props.effect.parameter=e.value,this.setState(this.state)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"deleteParameter",value:function(){this.props.deleteParameterizer(this.props.effect)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:this.props.isSimple?"parameterizer":""},i.a.createElement(wi.a,{condition:this.isEnabled()},i.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,Ya.v)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"parameter-dropdown-container"},i.a.createElement("div",{className:"lfo-rate-label"},"Parameter:"),i.a.createElement(or.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getParameterOptions(),onChange:function(t){return e.handleParameterChange(t)},value:this.getParameterOption(this.props.effect.parameter),placeholder:"Parameter"})),i.a.createElement("div",{className:"clear-fix"}),i.a.createElement(Ft.a,{effectNumber:this.props.effectNumber,contextualHelp:Ya.w,name:"Factor",automation:this.props.automation,parameter:this.props.effect.factorParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:.01,max:8}),i.a.createElement(Ft.a,{contextualHelp:Ya.x,effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Offset",root:1,parameter:this.props.effect.offsetParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.1,min:-12,max:12}),this.props.isSimple?"":i.a.createElement(Ft.a,{effectNumber:this.props.effectNumber,name:"Probability",contextualHelp:Ya.C,automation:this.props.automation,parameter:this.props.effect.probabilityParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:100})),this.props.isSimple?i.a.createElement("div",{onClick:function(){return e.deleteParameter()},className:"delete-btn"},"x"):"")}}]),n}(a.Component),Ws=Object(s.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(c.bb)(t))}}})(Gs),Ks=(new Ot.a,Object(s.b)(function(e,t){return{mem:t.effect.mem,trackStep:t.sequencerEngine.trackStep}},function(e){return{}})(function(e){var t=e.effect,n=e.mem,r=e.trackStep,a=e.trackMem,s=(void 0===a&&t.trackMem,e.WIDTH),c=void 0===s?300:s,u=e.HEIGHT,l=void 0===u?100:u,f=Object.keys(n).map(parseFloat),h=Object.values(n).map(parseFloat),d=Math.max.apply(Math,Object(o.a)(f)),p=n.maxTriggers||Math.max.apply(Math,Object(o.a)(h)),v=t.maxLength;d=32*(Math.floor(d/32)+1);var m=f.map(function(e){return{x:5+c*e/d,y:l-(5+l*n[e]/p)}}),y="";m.length>0&&(y="M "+m[0].x+" "+m[0].y+" L "+m.slice(1,d).map(function(e){return e.x+" "+e.y}).join(","));var b={width:c*(r%v/v)};n[r%v];return i.a.createElement("div",{className:"stats-effect"},i.a.createElement("div",{style:b,className:"stat-tick"}),i.a.createElement("svg",{className:"stats-drawer",width:c+10,height:l+10},m.length>1&&i.a.createElement("path",{className:"total-stat",d:y,stroke:"red",fill:"transparent"})))}));var Qs=Object(s.b)(function(e,t){return{value:t.parameter.get()}},null)(function(e){var t=Object(a.useCallback)(function(t){document.activeElement.blur(),e.parameter.set(!e.value)},[e.parameter,e.value]);return i.a.createElement($a.a,{element:e.parameter,className:"checkbox-parameter"},i.a.createElement("label",null,i.a.createElement("input",{type:"checkbox",value:"checked",checked:e.flipped?!e.value:e.value,onChange:t}),e.name))});function Zs(e){function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.parameter;if(void 0!==t)return{value:t,label:t}}var n=e.className?e.className+" tracks-dropdown-container":"tracks-dropdown-container";return i.a.createElement("div",{className:n},i.a.createElement(or.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:function(){var n=e.parameters.map(function(e){return t(e)});return[{label:"None",value:null}].concat(Object(o.a)(n))}(),onChange:function(t){return e.onSelectParameter(t.value)},value:t(),placeholder:e.placeholder}))}function Ys(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var $s=function(e){Object(b.a)(n,e);var t=Ys(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={},r}return Object(y.a)(n,[{key:"getTrackVariables",value:function(){var e=this,t=this.props.sequencerEngine.tracks;return this.props.effect.trackVariables.map(function(n){return i.a.createElement("div",null,i.a.createElement("div",null,"Track"),i.a.createElement(cr,{track:t[n.get()],onSelectTrack:function(e){return n.set(e&&e.trackNumber)},sequencerEngine:e.props.sequencerEngine}))})}},{key:"getCheckboxVariables",value:function(){return this.props.effect.checkboxVariables.map(function(e){return i.a.createElement(Qs,{name:e.name,parameter:e})})}},{key:"getParamVariables",value:function(){var e=this;return this.props.effect.parameterVariables.map(function(t){return i.a.createElement("div",{className:"parameter-dropdown"},i.a.createElement("div",{className:"parameter-dropdown-name"},t.name),i.a.createElement(Zs,{parameter:t.get(),parameters:["transpose","velocity","chop","duration"],onSelectParameter:function(e){return t.set(e)},placeholder:t.name,sequencerEngine:e.props.sequencerEngine}))})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,this.getTrackVariables(),this.getParamVariables(),this.getCheckboxVariables(),this.props.effect.variables.map(function(t){return i.a.createElement(Ft.a,{name:t.name,min:t.min,max:t.max,step:Math.abs(t.min-t.max)<=1?.01:1,parameter:t,lfoEnabled:!0,sequencerEngine:e.props.sequencerEngine,isParameter:!0,effectNumber:e.props.effectNumber})}))}}]),n}(a.Component),Xs=Object(s.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(c.bb)(t))}}})($s),ec=Object(a.memo)(function(e){var t=Object(a.useState)(!1),n=Object(r.a)(t,2),o=n[0],s=n[1],c=Object(a.useRef)(void 0),u=Object(a.useCallback)(function(){return"Parameterizer"===e.effect.name?i.a.createElement(Ws,{effectNumber:e.effectNumber,sequencerEngine:e.sequencerEngine,automation:e.automation,selectedParameter:e.selectedParameter,onEffectsChange:e.onEffectsChange,onParameterChanged:e.onParameterChanged,effect:e.effect}):"Max Parameter"===e.effect.name?i.a.createElement(Hs,{effectNumber:e.effectNumber,sequencerEngine:e.sequencerEngine,automation:e.automation,selectedParameter:e.selectedParameter,onEffectsChange:e.onEffectsChange,onParameterChanged:e.onParameterChanged,effect:e.effect}):"User Script"===e.effect.name?i.a.createElement(Xr,{isDraggable:e.isDraggable,setExpanded:s,expanded:o,effectNumber:e.effectNumber,sequencerEngine:e.sequencerEngine,automation:e.automation,selectedParameter:e.selectedParameter,doc:hr.a,onEffectsChange:e.onEffectsChange,onParameterChanged:e.onParameterChanged,effect:e.effect}):"Stats"===e.effect.name?i.a.createElement(Ks,Object.assign({effectNumber:e.effectNumber,sequencerEngine:e.sequencerEngine,automation:e.automation,selectedParameter:e.selectedParameter,onEffectsChange:e.onEffectsChange,onParameterChanged:e.onParameterChanged,effect:e.effect},e)):e.effect.isScript?i.a.createElement(Xs,{effectNumber:e.effectNumber,sequencerEngine:e.sequencerEngine,automation:e.automation,selectedParameter:e.selectedParameter,onEffectsChange:e.onEffectsChange,onParameterChanged:e.onParameterChanged,effect:e.effect}):[]},[o,s,e.effect]);return i.a.createElement($a.a,{refObj:c,className:"midi-effect-container",element:e.effect},i.a.createElement(Vo,Object.assign({},e,{onDeleteEffect:e.onDeleteEffect,isMidiEffect:!0,effectNumber:e.effectNumber,onToggle:function(){return[]},track:e.track,effect:e.effect,automation:e.automation}),u()))});function tc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return nc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nc(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function nc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var rc=Object(s.b)(function(e,t){return{effectStarred:e.effects.effectStarred}},function(e){return{}})(function(e){e.showPads;var t=e.effectStarred,n=e.subSequence,s=Object(a.useRef)(void 0),c=(Object(a.useRef)({}),n.midiEffects.shadowEffects),u=Object(a.useState)([]),l=Object(r.a)(u,2),f=l[0],h=l[1];Object(a.useEffect)(function(){var e,r=Object(o.a)(n.getAllEffects()),a=function(e){var t,n=[],r=tc(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a),a.effects&&(n=[].concat(Object(o.a)(n),Object(o.a)(a.effects)))}}catch(i){r.e(i)}finally{r.f()}return n},i=tc(n.tracks);try{for(i.s();!(e=i.n()).done;){var s=e.value;r=[].concat(Object(o.a)(r),Object(o.a)(a(s.effects)),Object(o.a)(a(s.midiEffects.effects)))}}catch(c){i.e(c)}finally{i.f()}r=[].concat(Object(o.a)(r),Object(o.a)(n.sequencers)),h(r.filter(function(e){return t[e.id]}))},[h,t]);var d=function(e){if(e.type===So.a);else if(e.getEffectType()!==Po.a)return i.a.createElement(ec,{showDelete:!1,isDraggable:!1,featured:!0,sequencerEngine:n.sequencerEngine,WIDTH:180,HEIGHT:95,track:e.track,compact:!0,instrument:!0,onDeleteEffect:function(){return[]},effect:e,send:void 0})};n.midiEffects.effects.find(function(e){return"User Script"===e.name});return i.a.createElement("div",{ref:s,className:"module-inner"},i.a.createElement("div",{className:"module-row"},i.a.createElement(Vs,{showDelete:!1,isDraggable:!1,featured:!0,sequencerEngine:n.sequencerEngine,track:n,compact:!0,instrument:!0,onDeleteEffect:function(){return[]},effect:n.playhead,send:void 0}),d(c[0])),i.a.createElement("div",{className:"module-row"},d(c[1]),i.a.createElement("div",{className:"module-col"},i.a.createElement("div",null,i.a.createElement("div",{className:"effect midi enabled transpose-container"},i.a.createElement("div",{className:"effect-inner"},i.a.createElement(Ft.a,{parameter:n.midiEffects.transposeParameter,name:"Transpose",min:-32,step:1,max:32,sequencerEngine:n.sequencerEngine}))),d(c[2])))),i.a.createElement("div",{className:"starred-effects"},f.map(function(e){return d(e)})))}),ac=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.zobject,n=t.subSequence.getRootSubSequence?t.subSequence.getRootSubSequence():t.subSequence;return i.a.createElement(rc,{subSequence:n})}),ic=(n(1829),n(580)),oc=["A","B","C","D","E","F","G","H","I","J","K","L","M","N"],sc=[{label:"Stay",value:ic.d},{label:"Forward",value:ic.b},{label:"Reverse",value:ic.c},{label:"Brownian",value:ic.a}],cc=function(e){var t=e.i,n=e.scene,o=e.subSequence,s=Object(a.useState)(n.durationPercentages[t]),c=Object(r.a)(s,2),u=(c[0],c[1]),l=Object(a.useState)(n.algorithmTypes[t]),f=Object(r.a)(l,2),h=f[0],d=f[1],p=Object(a.useState)(n.patterns[t]),v=Object(r.a)(p,2),m=v[0],y=v[1];Object(a.useEffect)(function(){y(n.patterns[t]),u(n.durationPercentages[t]),d(n.algorithmTypes[t])},[t,n,y,d,u]);var b=Object(a.useCallback)(function(e){n.algorithmTypes[t]=e.value,d(e.value)},[d,t,n]),g=(Object(a.useCallback)(function(e){n.durationPercentages[t]=e},[u,t,n]),Object(a.useCallback)(function(e){n.patterns[t]=e.value,y(e.value)},[y,t,n])),O=(o.tracks[0]?o.tracks[0].patterns:[]).map(function(e,t){return{label:"Pattern "+(t+1),value:t}}),j=oc[t];return i.a.createElement("div",{className:"sub-sequence-details"},i.a.createElement("div",{className:"sub-name"},j,":"),i.a.createElement(or.a,{controlClassName:"pattern-dropdown",options:O,onChange:g,value:O.find(function(e){return e.value===m}),placeholder:"Pattern"}),i.a.createElement(or.a,{options:sc,onChange:b,value:sc.find(function(e){return h===e.value}),placeholder:"Algo Type"}))},uc=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.currentScene,n=e.sequencerEngine;return t?i.a.createElement("div",{className:"scene-details"},n.subSequences.map(function(e,n){return i.a.createElement(cc,{i:n,subSequence:e,scene:t})})):[]}),lc=function(e){var t=e.scene,n=e.scenes,o=e.isCurrent,s=e.setSceneDragging,c=(e.sceneDragging,e.onDropScene),u=Object(a.useRef)(0),l=Object(a.useState)(!1),f=Object(r.a)(l,2),h=f[0],d=f[1],p=Object(a.useState)(t.name),v=Object(r.a)(p,2),m=v[0],y=v[1],b="scene-option";o&&(b+=" current");var g=Object(a.useCallback)(function(){var e=(new Date).getTime();e-u.current<=400&&d(!0),u.current=e,n.switchToScene(t)},[d]),O=Object(a.useCallback)(function(e){y(e.target.value)},[y]),j=Object(a.useCallback)(function(e){"Enter"===e.key&&(d(!1),t.name=m)},[d,m,t]);return i.a.createElement("div",{draggable:!0,onDragStart:function(){return s(t)},onDragOver:function(e){return e.preventDefault()},onDrop:function(){return c(t)},onClick:g,className:b},h?i.a.createElement("input",{onChange:O,onKeyDown:j,type:"text",value:m}):m,i.a.createElement("div",{className:"scene-info"},t.patterns.map(function(e){return e+1}).join(" - ")),i.a.createElement("div",{onClick:function(e){e.stopPropagation(),n.deleteScene(t)},className:o?"delete-btn":"hide delete-btn"},"x"))},fc=Object(s.b)(function(e,t){return{scenes:e.sequencer.scenes,currentScene:e.sequencer.currentScene}},function(e){return{}})(function(e){var t=e.currentScene,n=e.scenes,o=e.sequencerEngine,s=Object(a.useState)(void 0),c=Object(r.a)(s,2),u=c[0],l=c[1];console.log("rendering scenes = ",n);var f=Object(a.useCallback)(function(e){var t=n.indexOf(u),r=n.indexOf(e);o.scenes.moveScene(t,r)},[u,n]);return i.a.createElement("div",{className:"scenes-container"},i.a.createElement("div",{className:"scenes-component"},i.a.createElement("div",{className:"scenes-toolbar"},i.a.createElement("div",{className:"scenes-header"},"Scenes"),t?"":i.a.createElement("div",{onClick:function(){return o.scenes.newScene()},className:"new-scene-btn"},"+")),n.map(function(e){return i.a.createElement(lc,{key:e.id,onDropScene:f,setSceneDragging:l,sceneDragging:u,isCurrent:t===e,scenes:o.scenes,scene:e})})),i.a.createElement(uc,{sequencerEngine:o,currentScene:t}))});function hc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var dc=["A","B","C","D","E","F","G","H","I","J","K","L","M","N"],pc=function(e){Object(b.a)(n,e);var t=hc(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={},r}return Object(y.a)(n,[{key:"onChangeVolume",value:function(e){this.props.subSequence.fade=e,this.props.currentSubSequence!==this.props.subSequence.id&&this.props.sequencerEngine.switchToSubSequence(this.props.subSequence.id)}},{key:"onClickMute",value:function(){this.props.subSequence.mute=!this.props.muted}},{key:"patterns",get:function(){var e=this.props.subSequence.tracks[0];return void 0===e?[]:e.patterns}},{key:"render",value:function(){var e=this,t="sub-sequence-fader";return this.props.currentSubSequence===this.props.subSequence.id&&(t+=" selected"),i.a.createElement("div",{key:"sub-sequence-fader-"+this.props.subSequence.id,className:t},i.a.createElement("div",{className:"mix-patterns"},this.patterns.map(function(t,n){return i.a.createElement(vc,{key:"pattern-"+n,subSequence:e.props.subSequence,sequencerEngine:e.props.sequencerEngine,isCurrent:n===e.props.currentPattern,pattern:n})})),i.a.createElement("div",{className:"sub-sequence-fader-and-info"},i.a.createElement("div",{className:"sub-sequence-fader-empty"}),i.a.createElement("div",{className:"volume-slider-container"},i.a.createElement($o.a,{handle:"square",value:this.props.volume,change:function(t){return e.onChangeVolume(t.target.value)},step:.01,max:1,min:0,orientation:"vertical",reversed:!0})),i.a.createElement("div",{onClick:function(){return e.onClickMute()},className:this.props.muted?"sub-sequence-info muted":"sub-sequence-info"},dc[this.props.i])))}}]),n}(a.Component),vc=function(e){Object(b.a)(n,e);var t=hc(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"render",value:function(){var e=this,t="sub-sequence-pattern";return this.props.isCurrent&&(t+=" current"),i.a.createElement("div",{onClick:function(){return e.switchToPattern()},className:t},this.props.pattern+1)}},{key:"switchToPattern",value:function(){this.props.sequencerEngine.switchToPattern(this.props.pattern,!1,this.props.subSequence),this.props.sequencerEngine.switchToSubSequence(this.props.subSequence.id)}}]),n}(a.Component),mc=Object(s.b)(function(e,t){var n=e.mix.subSequenceFades[t.subSequence.id],r=t.sequencerEngine.engineId;return{volume:void 0===n?1:n,muted:e.mix.subSequenceMuted[t.subSequence.id],currentPattern:e.sequencer.currentPattern[t.subSequence.id]||0,currentSubSequence:e.sequencer.currentSubSequence[r]}},null)(pc);n(1830);function yc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return bc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bc(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function bc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var gc=new Ot.a,Oc=Object(a.memo)(function(e){e.note;var t=e.isPlayed,n=e.tracks,r=e.size,a=[],o=i.a.createElement("line",{x1:0,y1:0,x2:r,y2:0,className:t?"played mark":"mark"});if(n)for(var s=1*r/n.length,c=0;c<n.length;c++){var u=n[c];a.push(i.a.createElement("circle",{cx:c*s,cy:-20,r:3,stroke:gc.getColorForTrack(u)}))}return i.a.createElement("g",null,o," ",a)}),jc=function(e,t){return(e%t+t)%t},kc=Object(s.b)(function(e,t){return{trackStep:t.sequencerEngine.trackStep}},function(e){return{}})(function(e){var t,n=e.sequencerEngine,r=e.trackStep,a=void 0===r?0:r,o=e.size,s=void 0===o?100:o,c=new Set,u={},l=yc(n.subSequences);try{for(l.s();!(t=l.n()).done;){var f,h=yc(t.value.tracks);try{for(h.s();!(f=h.n()).done;){var d=f.value,p=d.notesTriggered||{};for(var v in p)v=jc(v,12),c.add(v),u[v]||(u[v]=[]),u[v].push(d)}}catch(y){h.e(y)}finally{h.f()}}}catch(y){l.e(y)}finally{l.f()}var m=(a%=32)/32*(2*s*Math.PI);return i.a.createElement("div",{className:"pitch-clock"},i.a.createElement("svg",null,i.a.createElement("circle",{strokeDasharray:[m,999],cx:s,cy:s,r:s,stroke:"white"}),i.a.createElement("g",{className:"marks"},[0,1,2,3,4,5,6,7,8,9,10,11].map(function(e){return i.a.createElement(Oc,{size:s,tracks:u[e],key:e,note:e,isPlayed:c.has(e)})}))))}),wc=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.sequencerEngine;return i.a.createElement("div",{className:"mix-modules"},i.a.createElement(kc,{sequencerEngine:t}))}),xc=function(e){return i.a.createElement("div",{className:"global-mix-container"},i.a.createElement("div",{className:"sub-sequences-mix-container"},e.sequencerEngine.subSequences.filter(function(e){return!e.isTrack}).map(function(t,n){return i.a.createElement(mc,{key:"sub-mix-"+n,sequencerEngine:e.sequencerEngine,i:n,subSequence:t})}),i.a.createElement(fc,{sequencerEngine:e.sequencerEngine}),i.a.createElement(wc,{sequencerEngine:e.sequencerEngine})))},Sc=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.zobject;return i.a.createElement(xc,{sequencerEngine:t.sequencerEngine})}),Pc=(n(940),Object(s.b)(function(e,t){return{updates:t.zobject.updates}},function(e){return{}})(function(e){var t=e.zobject,n=(e.updates,Object(a.useCallback)(function(e,n,r){r=0===r?1:0,t.onInputMessage(["set ".concat(e," ").concat(n," ").concat(r)])},[]));return i.a.createElement("div",{className:"z-matrix"},t.matrix.map(function(e,t){return i.a.createElement("div",{className:"z-row"},e.map(function(e,r){return i.a.createElement("div",{onClick:function(a){return n(r,t,e)},className:"z-value"},e)}))}))})),Ec=new me.a(4,!1),Tc=new me.a(8,!1),Ac=new me.a(16,!1),Mc=new me.a(32,!1),Rc=function(e){var t=e.color,n=e.resolution,o=e.sequencerEngine,s=e.isSequenceRolling,c=e.engine,u=Object(a.useRef)(void 0),l=Object(a.useState)(!1),f=Object(r.a)(l,2),h=f[0],d=f[1];Object(a.useEffect)(function(){d(s)},[s,d]);var p=Object(a.useCallback)(function(){var e=Object(ot.a)({},o.idToSequencerEngine,{"-1":o.samplerTrack}),t=c||e[Object.keys(e)[0]];if(void 0!==t){for(var r in t.resolution=n,t.trackRolling=!0,e)e[r]&&(e[r].sequenceRolling=!0);c&&(c.sequenceRolling=!0),d(!0)}},[d,c]),v=Object(a.useCallback)(function(){var e=Object(ot.a)({},o.idToSequencerEngine,{"-1":o.samplerTrack}),t=c||e[Object.keys(e)[0]];if(void 0!==t){for(var r in t.resolution=n,e)e[r]&&(e[r].sequenceRolling=!1);t.trackRolling=!1,c&&(c.sequenceRolling=!1),d(!1)}},[d]),m="explore-roll-button";return h&&(m+=" flash-it rolling"),i.a.createElement("div",{ref:u,style:{backgroundColor:t},onMouseDown:p,onMouseUp:v,onTouchStart:p,onTouchEnd:v,onTouchLeave:v,className:m},"1/",n.resolution)},Cc=Object(s.b)(function(e,t){return{resolution:e.sequencer.resolution,isRolling:e.sequencer.trackRolling&&t.sequencerEngine&&t.sequencerEngine.isSequenceRolling}},null)(function(e){var t=e.color,n=e.resolution,r=e.sequencerEngine,a=e.isRolling,o=e.engine;return i.a.createElement("div",{className:"roll-buttons"},i.a.createElement(Rc,{color:t,isSequenceRolling:a&&4===n.resolution,engine:o,sequencerEngine:r,resolution:Ec}),i.a.createElement(Rc,{color:t,isSequenceRolling:a&&8===n.resolution,engine:o,sequencerEngine:r,resolution:Tc}),i.a.createElement(Rc,{color:t,isSequenceRolling:a&&16===n.resolution,engine:o,sequencerEngine:r,resolution:Ac}),i.a.createElement(Rc,{color:t,isSequenceRolling:a&&32===n.resolution,engine:o,sequencerEngine:r,resolution:Mc}))}),Nc=(n(1831),Object(s.b)(function(e,t){return{secondaryColor:t.zobject.attributes["secondary-color"]}},function(e){return{}})(function(e){var t=e.zobject,n=(e.attributes,e.secondaryColor);return i.a.createElement("div",null,t.sequencerEngine&&i.a.createElement(Cc,{color:n,engine:t.sequencerEngine,sequencerEngine:t.sequencerEngine}))})),Ic=n(171),qc=n(33),_c=new Ot.a,Dc=new qc.a,Fc=function(e){var t=e.track,n=e.value,r=e.editing,o=e.data,s=e.isCursor,c=e.isCurrent,u=e.color,l=e.parameterToEdit,f=e.setParameterToEdit,h=o.stepData,d=o.stepNumber;h||(h=Dc);var p=Object(a.useCallback)(function(e){t.sequencerEngine.operationManager.dispatch(Object($.r)(t,2*d))},[d,t]),v=Object(a.useCallback)(function(e,n){f(n),r.current=!0,t.sequencerEngine.select(t.trackNumber,d)},[d,t]),m="tracker-step";return c&&(m+=" current"),s&&(m+=" cursor"),i.a.createElement("div",{onClick:h&&!h.on?p:function(){return[]},className:m},i.a.createElement("div",{className:"inner-step"},i.a.createElement("div",{onClick:p,className:d%8===0?"bar step-number":d%4===0?"half-bar step-number":"step-number"},d+1),h&&h.on?i.a.createElement("div",{className:"step-data"},i.a.createElement("div",{style:{color:u},onClick:function(e){return v(e,h.transposeParameter)},className:l===h.transposeParameter?"edit note-name":"note-name"},Ic.a.fromTranspose(h.transpose).toString()),i.a.createElement(Lc,{v:n,value:h.duration,parameter:h.durationParameter,parameterToEdit:l,setParameterToEdit:v}),i.a.createElement(Lc,{v:n,value:h.velocity,parameter:h.velocityParameter,parameterToEdit:l,setParameterToEdit:v})):""))},Lc=function(e){var t=e.value,n=e.parameter,r=e.setParameterToEdit,a=e.parameterToEdit;return i.a.createElement("div",{onClick:function(e){return r(e,n)},className:n===a?"edit tracker-parameter":"tracker-parameter"},t)},Bc=Object(s.b)(function(e,t){var n=t.track.sequencerEngine.cursor,r=e.mix.trackerParameterToEdit;return{trackSteps:e.tracks.trackSteps[t.track.id],stepBuckets:t.pattern.stepBuckets,parameterToEdit:r,isSelectedTrack:n.track===t.track.trackNumber}},function(e){return{setParameterToEdit:function(t){return e(Object(c.Le)(t))}}})(function(e){var t=e.track,n=e.pattern,o=e.currentStep,s=e.step,c=e.parameterToEdit,u=e.trackSteps,l=e.isSelectedTrack,f=e.cursorStep,h=e.editing,d=e.setParameterToEdit,p=Object(a.useState)(void 0),v=Object(r.a)(p,2),m=v[0],y=v[1],b=Object(a.useState)(c&&c.get()),g=Object(r.a)(b,2),O=g[0],j=g[1];Object(a.useEffect)(function(){c&&j(c.get())},[j,c]),Object(a.useEffect)(function(){y(_c.getColorForTrack(t))},[t,y]),Object(a.useEffect)(function(){return window.addEventListener("keydown",k),function(){return window.removeEventListener("keydown",k)}},[c,j,t]);var k=Object(a.useCallback)(function(e){if(c&&c.track===t){e.stopPropagation();var n=c.get()||t.trackData.parameters.find(function(e){return e.name===c.name}).get();if(Object(Ae.a)(e.key)){var r=parseInt(e.key);c.set(r),j(r)}else if(e.key>="a"&&e.key<="g"){if("Transpose"===c.name){var a=Ic.a.fromTranspose(c.get());a.note=e.key.toUpperCase(),c.set(a.getTranspose()),j(a.getTranspose())}}else"ArrowUp"===e.key?(c.set(n+1),j(n+1)):"ArrowDown"===e.key&&(c.set(n-1),j(n-1))}},[c,j,t]),w=n.length()/2,x=function(e,t){for(var n=e.length(),r=[],a=-7;a<=7;a++){var i=Object(xr.a)(2*(t+a),n),o=e.stepBuckets[i],s=o.getAnyOnStep()||o.steps[0];r.push({stepData:s,stepNumber:i/2})}return r}(n,(isNaN(s)?o:s)%w);return i.a.createElement("div",{className:"tracker"},i.a.createElement(go,{hasInner:!0,track:t}),x.map(function(e,n){return i.a.createElement(Fc,{parameterToEdit:c,setParameterToEdit:d,track:t,on:u&&u[e.stepNumber],value:O,key:n+"."+e.stepNumber,color:m,editing:h,isCursor:l&&e.stepNumber===f,isCurrent:e.stepNumber===o%w,data:e})}))}),zc=Object(s.b)(function(e,t){var n=Math.floor(t.group.sequencerEngine.lastTrackStep||0),r=t.group.sequencerEngine.cursor;return{currentStep:Math.floor(n/2),pattern:t.group.tracks[0]&&t.group.tracks[0].pattern,cursorStep:r.step/2,playing:t.group.sequencerEngine.playing,numTracks:t.group.tracks&&t.group.tracks.length}},function(e){return{setParameterToEdit:function(t){return e(Object(c.Le)(t))}}})(function(e){var t=e.group,n=e.currentStep,o=e.setParameterToEdit,s=e.cursorStep,c=e.playing,u=Object(a.useRef)(u),l=Object(a.useState)(void 0),f=Object(r.a)(l,2),h=f[0],d=f[1],p=Object(a.useState)(!1),v=Object(r.a)(p,2),m=v[0],y=v[1],b=Object(a.useRef)(!1);Object(a.useCallback)(function(){d(void 0)},[n,d,y]);Object(a.useEffect)(function(){d(void 0),b.current=!1,y(!1)},[c,d,y]);var g=Object(a.useCallback)(function(e){e.stopPropagation(),e.preventDefault();var r=Math.min(t.sequencerEngine.length,Math.max(0,(h||n)+e.deltaY/8));d(r),y(!0)},[d,h,n,y]);Object(a.useEffect)(function(){return u.current.addEventListener("mousewheel",g),function(){u.current&&u.current.removeEventListener("mousewheel",g)}},[d,h,n,y]);var O=Object(a.useCallback)(function(){d(void 0),o(void 0),y(!1),b.current=!1},[d,o]);Object(a.useEffect)(function(){b.current||(t.sequencerEngine.getSelectedTrack(),d(s))},[s,d]);var j=t.sequencerEngine.getSelectedTrack();return Object(a.useEffect)(function(){},[h,s,d,m,j]),i.a.createElement("div",{onMouseLeave:O,ref:u,className:"group-tracker"},t.tracks.map(function(e){return i.a.createElement(Bc,{pattern:e.pattern,editing:b,step:Math.floor(h),setIsScrolling:y,cursorStep:s,currentStep:n,key:e.id,track:e})}))}),Jc=(n(1832),Object(s.b)(function(e,t){return{}},function(e){return{setKeyboardContext:function(t){return e(Object(c.Yb)(t))}}})(function(e){var t=e.zobject,n=e.setKeyboardContext,r=t.subSequence;return r.getRootSubSequence&&(r=r.getRootSubSequence()),i.a.createElement("div",{onMouseEnter:function(){return n(t)},onClick:function(){return n(t)},className:"z-tracker"},i.a.createElement(zc,{group:r}))})),Vc=Object(s.b)(function(e,t){return{immutable:t.tidal.cycleParameter.immutable,cycle:t.tidal.cycle,currentLeaves:t.tidal.currentLeaves}},function(e){return{}})(function(e){var t=e.tidal,n=e.cycle,r=e.currentLeaves,a=e.immutable,o=Object(Un.d)(n,r,!0),s=o.spans,c=o.index,u=a?"immutable tidal-string":"tidal-string";return r&&r.some(function(e){return null!==e.transpose})&&(u+=" triggering"),i.a.createElement("div",{className:u},i.a.createElement("span",{className:"cycle-length"},t.cycleLength),i.a.createElement("div",{onClick:function(){return t.lockGroove(!a)},className:a?"immutable dot":"dot"}),s.map(function(e,t){return i.a.createElement("span",{keys:t,className:t===c?"str-part current":"str-part"},e)}))}),Hc=Object(s.b)(function(e,t){return{cycle:t.effect.cycle}},null)(function(e){var t=Object(a.useRef)(void 0),n=Object(a.useState)(e.effect.cycleString),o=Object(r.a)(n,2),s=o[0],c=o[1],u=Object(a.useState)(!1),l=Object(r.a)(u,2),f=l[0],h=l[1],d=Object(a.useState)(!1),p=Object(r.a)(d,2),v=p[0],m=p[1];Object(a.useEffect)(function(){c(Object(Un.e)(e.cycle))},[c,e.cycle]);var y=Object(a.useCallback)(function(e){"Enter"===e.key&&b()},[s,e.effect,m]),b=Object(a.useCallback)(function(){var t=Object(Un.g)(s);t&&t.length>0?e.sequencerEngine.operationManager.dispatch(Object($.s)(e.effect.cycleParameter,t)):(h(!0),setTimeout(function(){h(!1)},1e3)),m(!1)},[e.effect,h,s,m]),g=Object(a.useCallback)(function(t){t.target.value,document.activeElement.blur(),e.effect.cycleRetrigger=!e.effect.cycleRetrigger},[e.effect]);return i.a.createElement("div",{ref:t},i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},draggable:!0,onDragStart:function(e){return e.preventDefault()},className:"tidal-component"},!v&&i.a.createElement(Vc,{tidal:e.effect}),i.a.createElement(Hr.b,{value:s,onKeyDown:y,onChange:function(e){m(!0),c(e.target.value)},placeholder:"Output Note",className:"tidal-input"}),i.a.createElement("div",{className:"enter-button",onClick:b},"Enter")),i.a.createElement(wi.a,{condition:f},i.a.createElement("div",{className:"error-box"},"Syntax Error")),!e.noUI&&i.a.createElement(Fr,{effect:e.effect}),!e.noUI&&i.a.createElement("div",{className:"tidal-parameters"},i.a.createElement(Ft.a,{effectNumber:e.effectNumber,name:"Cycle Length",parameter:e.effect.cycleLengthParameter,automation:e.automation,onParameterChanged:e.onParameterChanged,isParameter:!0,sequencerEngine:e.sequencerEngine,lfoEnabled:!0,step:1,min:4,max:64}),i.a.createElement(Ft.a,{effectNumber:e.effectNumber,name:"Speed Factor",parameter:e.effect.lengthFactorParameter,automation:e.automation,onParameterChanged:e.onParameterChanged,isParameter:!0,sequencerEngine:e.sequencerEngine,lfoEnabled:!0,step:.5,min:.5,max:4}),i.a.createElement(Ft.a,{effectNumber:e.effectNumber,name:"Duration Factor",parameter:e.effect.durationFactorParameter,automation:e.automation,onParameterChanged:e.onParameterChanged,isParameter:!0,sequencerEngine:e.sequencerEngine,lfoEnabled:!0,step:.01,min:.1,max:4}),e.effect.variables.map(function(t){return i.a.createElement(Ft.a,{name:t.name,min:t.min,max:t.max,step:1,parameter:t,lfoEnabled:!0,sequencerEngine:e.sequencerEngine,isParameter:!0,effectNumber:e.effectNumber})})),!e.noUI&&i.a.createElement("div",{className:"refined-checkbox-preferences"},i.a.createElement("label",null,i.a.createElement("input",{type:"checkbox",value:"reversed",checked:e.effect.cycleRetrigger,onChange:g}),"Cycle Retrigger")))}),Uc=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.tidal,n=e.zobject;return t?i.a.createElement("div",{className:"z-tidal"},i.a.createElement(Hc,{noUI:!0,effect:t,sequencerEngine:n.sequencerEngine})):""}),Gc=(n(1833),Object(s.b)(function(e,t){return{_samples:t.sampleBank&&t.sampleBank.samples,sampleDragging:e.selector.sampleDragging,_lastSampleSent:t.sampleBank&&t.sampleBank.lastSampleSent}},function(e){return{}})(function(e){var t=e.sampleBank,n=e.sampleDragging,s=e._lastSampleSent,c=e._samples,u=Object(a.useState)(t.samples),l=Object(r.a)(u,2),f=l[0],h=l[1],d=Object(a.useState)(t.lastSampleSent),p=Object(r.a)(d,2),v=p[0],m=p[1];Object(a.useEffect)(function(){c&&h(c)},[c,h]),Object(a.useEffect)(function(){m(s)},[s,m]);var y=Object(a.useCallback)(function(e){e.stopPropagation(),n&&(t.addSample(n),h(Object(o.a)(t.samples)))},[t,n,h]),b=Object(a.useCallback)(function(e){t.deleteSample(e),h(Object(o.a)(t.samples))},[t,h]);return i.a.createElement("div",{onDrop:y,className:"sample-bank"},i.a.createElement("div",{className:"samples"},f&&f.map(function(e){return i.a.createElement("div",{onClick:function(){t.sendSample(e),m(e)},className:e===v?"current sample-option":"sample-option"},i.a.createElement("div",{className:"sample-name"},Ao(e.name)),e.tags.map(function(e){return i.a.createElement("div",{className:"sample-tag"},Ao(e))}),i.a.createElement("div",{onClick:function(){return b(e)},className:"delete-btn"},"x"))})),(!f||0===f.length)&&i.a.createElement("div",{className:"drop-here"},i.a.createElement("span",{className:"drop-text"},"Drop Samples Here")))})),Wc=Object(s.b)(function(e,t){return{uxLocked:e.zobject.uxLocked,width:t.toggle.zObject.width,height:t.toggle.zObject.height,_value:t.toggle.value}},function(e){return{setSelectedZObject:function(t){return e(Object(c.Ed)(t))}}})(function(e){var t=e.setSelectedZObject,n=e.uxLocked,o=e.toggle,s=e._value,c=(e.height,Object(a.useState)(s)),u=Object(r.a)(c,2),l=u[0],f=u[1];Object(a.useEffect)(function(){f(s)},[s]);var h="ztoggle ";l&&(h+=" toggled");var d=Object(a.useCallback)(function(){t(o.zObject),n&&f(o.toggle())},[o,f,n]);return i.a.createElement("div",{onClick:d,className:h},i.a.createElement("div",{className:"inner-x"}))}),Kc=Object(s.b)(function(e,t){e.sequencer.displayResolution;var n=t.track.sequencerEngine.trackStep;return{currentStep:t.track.getPatternStep(n)}},function(e){return{}})(function(e){var t=e.track,n=e.currentStep,r=void 0===n?0:n,a=Math.min(t.pattern.length(),32),o={left:5+r%a/a*530+"px"};return i.a.createElement("div",{style:o,className:"cirklon-playhead"})});var Qc=[{value:new me.a(4,!1),label:"1/4"},{value:new me.a(4,!0),label:"1/4t"},{value:new me.a(8,!1),label:"1/8"},{value:new me.a(8,!0),label:"1/8t"},{value:new me.a(16,!1),label:"1/16"},{value:new me.a(16,!0),label:"1/16t"},{value:new me.a(32,!1),label:"1/32"},{value:new me.a(32,!0),label:"1/32t"}];function Zc(e){for(var t=0;t<Qc.length;t++)if(Qc[t].value.resolution==e.resolution&&Qc[t].value.isTriplet==e.isTriplet)return Qc[t];return null}var Yc=Object(s.b)(function(e){return{resolution:e.sequencer.displayResolution}},function(e){return{setContextualHelp:function(t){return e(Object(c.bb)(t))},setDisplayResolution:function(t){return e(Object(c.ob)(t))}}})(function(e){return i.a.createElement("div",{onMouseOver:function(){return e.setContextualHelp(Ya.E)},onMouseLeave:function(){return e.setContextualHelp(void 0)}},i.a.createElement(or.a,{className:"resolution-dropdown",options:Qc,onChange:function(t){return n=t.value,e.sequencerEngine.resolution=n,e.setDisplayResolution(n),e.sequencerEngine.updateSteps(),void(e.sequencerEngine.tracks.length>0&&e.sequencerEngine.select(e.sequencerEngine.cursor.track,0));var n},value:Zc(e.resolution),placeholder:"Select a resolution"}))}),$c=n(581);n(1834);function Xc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var eu=function(e){Object(b.a)(n,e);var t=Xc(n);function n(e){return Object(m.a)(this,n),t.call(this,e)}return Object(y.a)(n,[{key:"getOptions",value:function(){var e=this.props.midiEngine,t=[{label:"All",value:{type:$c.a}},{label:"Computer Keyboard",value:{type:$c.b}}],n=e.getInputs().map(function(e){return{label:e.name,value:{type:$c.c,input:e}}});return t.concat(n)}},{key:"getSelectedOption",value:function(){var e=this.props.midiInputs;return this.getOptions().filter(function(t){return t.value.type===e.type&&(e.type!==$c.c||e.accepts(!1,t.value.input.name))})[0]}},{key:"onSelect",value:function(e){e.value.type===$c.c?this.props.midiInputs.addMidiInput(e.value.input):this.props.midiInputs.setType(e.value.type)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,Ya.I)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"midi-input-dropdown-container"},i.a.createElement(or.a,{className:"midi-input-dropdown",controlClassName:"midi-input-control-dropdown",arrowClassName:"audio-input-arrow-dropdown",options:this.getOptions(),onChange:function(t){return e.onSelect(t)},value:this.getSelectedOption(),placeholder:"Input"}))}}]),n}(a.Component),tu=(Object(s.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(c.bb)(t))}}})(eu),n(426)),nu=[{label:"None",value:tu.b},{label:"Randomize",value:tu.c},{label:"Accumulate",value:tu.a}],ru=[{label:"Transpose",value:"transpose"},{label:"Velocity",value:"velocity"},{label:"Duration",value:"duration"},{label:"Chop",value:"chop"},{label:"Panning",value:"panning"}],au=function(e){var t=e.track,n=e.parameter,o=e.name,s=e.limit,c=(e.mode,e.variableParameter),u=Object(a.useState)(n.get()),l=Object(r.a)(u,2),f=l[0],h=l[1],d=Object(a.useState)(c.get()),p=Object(r.a)(d,2),v=p[0],m=p[1],y=Object(a.useCallback)(function(e){var t=e.value;n.set(t),h(t)},[h,n]),b=Object(a.useCallback)(function(e){var t=e.value;c.set(t),m(t)},[m,n]);return i.a.createElement("div",{className:"aux-event-type"},i.a.createElement("div",{className:"event-type-label"},o),i.a.createElement(or.a,{options:nu,onChange:y,value:nu.find(function(e){return e.value===f})}),i.a.createElement(or.a,{options:ru,onChange:b,value:ru.find(function(e){return e.value===v})}),f===tu.a?i.a.createElement(iu,{type:f,track:t,limit:s,mode:s}):"")},iu=function(e){var t=e.limit,n=(e.mode,e.track,e.type,e.parameter);return i.a.createElement("div",{className:"accumulator-options"},i.a.createElement(Ft.a,{isParameter:!0,name:"Limit",min:0,step:"velocity"===n||"duration"===n?.1:1,max:"transpose"===n?32:"chop"===n?16:n=32,parameter:t}))};Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.track;return i.a.createElement("div",{className:"aux-events"},i.a.createElement(au,{parameter:t.auxEventATypeParameter,name:"Aux Event A",limit:t.auxEventALimitParameter,variableParameter:t.auxEventAVariableParameter,mode:t.auxEventAModeParameter,track:t}),i.a.createElement(au,{parameter:t.auxEventBTypeParameter,variableParameter:t.auxEventBVariableParameter,name:"Aux Event B",auxEvent:"B",limit:t.auxEventBLimitParameter,mode:t.auxEventBModeParameter,track:t}))});var ou=new me.a(32,!1),su=function(e){var t=e.bar,n=e.isSelected,r=e.onClick,a="bar";return n&&(a+=" selected"),e.isCurrent&&(a+=" current"),i.a.createElement("div",{onClick:r,className:a},i.a.createElement("div",{className:"bar-text"},t+1))},cu=Object(s.b)(function(e,t){var n=e.sequencer.displayResolution,r=t.track.sequencerEngine.trackStep;return{patternStep:Math.floor(n.transformStepAtResolution2(t.track.getPatternStep(r),ou))}},function(e){return{}})(function(e){var t=e.stepsRef,n=e.numberOfSteps,o=e.setSelectedBar,s=e.selectedBar,c=(e.resolution,e.isFollowing),u=e.setIsFollowing,l=e.patternStep,f=e.barLength,h=(e.cirklonRef,Object(a.useState)(0)),d=Object(r.a)(h,2),p=d[0],v=d[1],m=Math.floor(n/f);isNaN(m)&&(m=1);var y=Object(a.useRef)(void 0),b=Object(a.useRef)(void 0);Object(a.useEffect)(function(){return t.current.addEventListener("mousewheel",g,{passive:!1}),function(){t.current&&t.current.removeEventListener("mousewheel",g,{passive:!1})}},[s,o,u,m]);var g=Object(a.useCallback)(function(e){var t=(new Date).getTime();if(!(t-window.lastScrollTime<200)){e.stopPropagation(),e.preventDefault();var n=Math.abs(e.deltaX)<=Math.abs(b.current);if(b.current=e.deltaX,e.deltaX>0){if(t-y.current<200)return n||(y.current=t),!0;if(n)return!0;u(!1);var r=(s+1)%m;isNaN(s)||o(r),y.current=t}else if(e.deltaX<0){if(t-y.current<200)return n||(y.current=t),!0;if(n)return!0;u(!1);var a=Object(xr.a)(s-1,m);isNaN(a)||o(a),y.current=t}return!0}},[s,u,o,m]);Object(a.useEffect)(function(){(isNaN(s)||s>=m)&&o(0)},[m,s,o]);var O=Array(m).fill(1),j=f*s,k=f*(s+1);return Object(a.useEffect)(function(){if(v(Math.floor(l/f)),l>=j&&l<k);else if(!isNaN(l)&&c){var e=Math.floor(l/f);o(e)}},[l,j,k,o,f,c,v]),1===m?[]:i.a.createElement("div",{className:"bars"},i.a.createElement("div",{className:"bar-label"},"Bar:"),O.map(function(e,t){return i.a.createElement(su,{bar:t,isCurrent:p===t,isSelected:s===t,onClick:function(){o(t),u(!1)}})}),i.a.createElement("div",{onClick:function(){return u(!c)},className:c?"following follow-btn":"follow-btn"},"FOLLOW"))}),uu=(n(941),n(428)),lu={1:"/FORWARD_DIRECTION.png",2:"/REVERSE_DIRECTION.png",3:"/FORWARD_REVERSE_DIRECTION.png",4:"/BROWNIAN_DIRECTION.png"},fu=Object(s.b)(function(e,t){return{direction:(n=t.track,n.playheadEffect?n.playheadEffect.direction:_s.b)};var n},function(e){return{}})(function(e){var t=e.track,n=(e.isSelected,e.direction),r=(e.color,Object(a.useCallback)(function(){var e=t.liveEffects.effects.find(function(e){return e.effect===Ho.e});e||(e=new uu.a(t),t.liveEffects.addEffect(e));var r=n+1;r>4&&(r=1),e.directionParameter.set(r,void 0,void 0)},[t,n]));return i.a.createElement("div",{onClick:r,className:"pushable playhead-direction-btn"},i.a.createElement($a.a,{element:Ya.A},i.a.createElement("img",{className:"mt-1 h-full playhead-direction-icon",src:lu[n]})))}),hu=Object(s.b)(function(e,t){return{speed:(n=t.track,n.playheadEffect?n.playheadEffect.speedFactor:1)};var n},function(e){return{}})(function(e){var t=e.track,n=e.speed,r=Object(a.useCallback)(function(){if(!t.playheadEffect){var e=new uu.a(t);t.liveEffects.addEffect(e)}4===n?t.playheadEffect.speedFactorParameter.set(.25,!1):t.playheadEffect.speedFactorParameter.set(2*n,!1)},[n,t]);return i.a.createElement("div",{onClick:r,className:"track-speed-button pushable"},n,"x")}),du=new me.a(32,!1),pu=Object(s.b)(null,function(e,t){return{setTrackToFreeze:function(){return e(Object(c.He)(t.track.subSequence.id,t.track.trackNumber))}}})(function(e){var t=e.track,n=e.trackColor,r=e.trackLengthMode,o=e.setTrackLengthMode,s=e.resolution,c=e.isSelectedTrack,u=(e.setTrackToFreeze,e.children),l=t.sequencerEngine,f={};c&&(f={backgroundColor:n,color:"black"});var h="track-length-button";r&&(h+=" selected");var d=Object(a.useCallback)(function(){if(r){var e=du.transformStepAtResolution(t.sequencerEngine.state.tracks.trackLengthChoice,s);t.pattern.changeLength(e)}o(!r)},[r,t,s]);return i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:"track-footer-container"},i.a.createElement($a.a,{element:Ya.G},i.a.createElement("div",{style:f,onClick:function(){return l.doubleTrackLength(t.trackNumber)},className:"add-steps-button pushable"},"+")),i.a.createElement($a.a,{element:Ya.K},i.a.createElement("div",{style:f,onClick:function(){return l.halfTrackLength(t.trackNumber)},className:"remove-steps-button pushable"},"-")),i.a.createElement($a.a,{element:Ya.H},i.a.createElement("div",{style:f,onClick:d,className:h},"Len.")),u,i.a.createElement(fu,{isSelected:c,color:n,track:t}),i.a.createElement(hu,{isSelected:c,color:n,track:t}))}),vu=new Ot.a,mu=Object(s.b)(function(e,t){return t.stepData&&t.stepData.durationParameter&&t.stepData.trackData?{on:t.stepData.on,duration:t.stepData.duration,transpose:t.stepData.transpose,velocity:t.stepData.velocity,slice:t.stepData.slice,plocked:t.stepData.pLockedParameters.length}:{}},function(e){return{}})(function(e){e.plocked;var t=e.slice,n=e.on,r=e.color,a=e.transpose,o=(e.stepData,e.duration),s=e.velocity;if(!n)return"";var c={width:32.5*o,backgroundColor:r,opacity:s,top:-15-.25*a+"px"};if(t){var u=vu.getColor(t);c.backgroundColor=u}return i.a.createElement("div",{style:c,className:"duration-indicator"})});var yu=new me.a(32,!1),bu=new Ot.a,gu=Object(s.b)(function(e,t){var n=e.sequencer.displayResolution,r=t.track.sequencerEngine.trackStep,a=Math.floor(n.transformStepAtResolution2(t.track.getPatternStep(r),yu));return t.stepData&&t.stepData.trackData?{resolution:n,isCurrentStep:a===t.stepNumber,selectedPianoRollSteps:e.keyboard.selectedPianoRollSteps,cirklonMode:e.cirklon.cirklonMode[t.track.id],slice:t.stepData.slice,plocked:t.stepData.pLockedParameters.length}:{}},function(e){return{setSelectedSteps:function(t){return e(Object(c.yd)(t))},mouseDown:function(t){return e(Object(c.j)(t))}}})(function(e){var t=e.track,n=e.color,r=e.on,s=e.stepNumber,c=e.resolution,u=e.stepData,l=(e.trackStep,e.isCurrentStep),f=e.selectedPianoRollSteps,h=void 0===f?[]:f,d=e.setSelectedSteps,p=e.cirklonMode,v=e.mouseDown,m=e.plocked,y=e.isSelected,b=(Object(a.useRef)(0),Object(a.useCallback)(function(e){Bi.isMobile||t.sequencerEngine.state.keyboard.isMouseDown&&((e.ctrlKey||e.metaKey)&&r?j(u):e.metaKey||e.ctrlKey||O())},[y,t,p,r,c,s,h])),g=Object(a.useCallback)(function(e,t){!e&&Bi.isMobile||(v(!0),(t.metaKey||t.ctrlKey)&&r?(t.stopPropagation(),j(u)):t.metaKey||t.ctrlKey||(t.stopPropagation(),O()))},[s,u,t,p,h,y,r,c]),O=Object(a.useCallback)(function(){t.pattern.clearCache(),t.sequencerEngine.cursor.setStep(s,c),t.sequencerEngine.operationManager.dispatch(Object($.r)(t,s,c))},[t,s,c]),j=Object(a.useCallback)(function(e){if(y){var t=h.indexOf(u);h.splice(t,1),d(Object(o.a)(h))}else d([].concat(Object(o.a)(h),[u]))},[y,h,d,u]),k="step-toggle",w={},x={};r&&(k+=" on",w.backgroundColor=bu.transparent(bu.saturate(n,1),.7),x.backgroundColor=n);var S={};return y&&(w.backgroundColor=x.backgroundColor,x.color=x.backgroundColor,S.backgroundColor=x.backgroundColor,x.backgroundColor=null),l&&(k+=" current"),y&&(k+=" selected"),m&&(k+=" p-locked"),i.a.createElement("div",{"data-stepNumber":s,style:w,onContextMenu:function(e){e.preventDefault(),e.stopPropagation()},onMouseOver:b,onMouseDown:function(e){e.stopPropagation(),g(!1,e)},onTouchStart:function(e){return g(!0,e)},className:k},i.a.createElement("div",{style:x,className:"step-inner"},m?i.a.createElement("div",{className:"p-lock-indicator"},i.a.createElement("div",{className:"inner-indicator",style:y?w:x})):"",s+1,i.a.createElement("div",{style:S,className:"step-bottom-tick"})))});function Ou(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ju(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ju(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ju(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ku=function(e){var t=e.root,n=e.stepData,r=e.track,i=e.shouldRound,o=e.min,s=e.max,u=e.height,l=e.ref,f=e.setEffectParameterValue,h=e.setEffectParameterValues,d=e.parameter,p=e.selectedSteps,v=e.cirklonMode,m=function(){return d.id};Object(a.useEffect)(function(){return l.current.addEventListener("touchmove",b,{capture:!0}),l.current.addEventListener("touchstart",y,{capture:!0}),function(){l.current&&(l.current.removeEventListener("touchmove",b),l.current.removeEventListener("touchstart",y))}},[l,r,d]);Object(a.useCallback)(function(e){r.sequencerEngine.dispatch(Object(c.j)(!1))},[r]);var y=Object(a.useCallback)(function(e){if(e.stopPropagation(),l.current){var n=wu(e,m(),o,s,u,t,l.current);i&&(n=Math.round(n)),d.set(n,!0),f(d.id,n),r.sequencerEngine.dispatch(Object(c.j)(!0))}},[d,v,p,r,n]),b=Object(a.useCallback)(function(e){if(e.stopPropagation(),e.preventDefault(),r.sequencerEngine.state.keyboard.isMouseDown&&l.current){var a=wu(e,m(),o,s,u,t,l.current);if(i&&(a=Math.round(a)),"GANG"===v&&p.length>0){var c,y={},b=Ou(p);try{for(b.s();!(c=b.n()).done;){var g=c.value,O=Su(g.parameters,d).set(a,!0,!0),j=O.id,k=O.value;y[j]=k}}catch(K){b.e(K)}finally{b.f()}h(y)}else if("SLOPE"===v&&p.length>0){var w={},x=r.getEasyPattern();p.forEach(function(e){return w[e.id]=x.findStepNumber(e)}),p.sort(function(e,t){return w[e.id]-w[t.id]});var S,P=Su(r.trackData.parameters,d),E=Su(p[0].parameters,d),T=null===E.get()?P.get():E.get(),A=Su(p[p.length-1].parameters,d),M=null===A.get()?P.get():A.get(),R=0,C={},N=p.indexOf(n),I=a-T,q=M-a,_=Ou(p);try{for(_.s();!(S=_.n()).done;){var D=S.value,F=Su(D.parameters,d);if(R<N){var L=T+R/N*I,B=F.set(L,!0,!0),z=B.id,J=B.value;C[z]=J}else{var V=(R-N)/(p.length-1-N);isNaN(V)&&(V=0);var H=a+V*q,U=F.set(H,!0,!0),G=U.id,W=U.value;C[G]=W}R++}}catch(K){_.e(K)}finally{_.f()}h(C)}else d.set(a,!0),f(d.id,a)}},[d,v,p,r,n]);return{onMouseMove:b,onMouseDown:y}};function wu(e,t,n,r,a,i,o){var s=o.getBoundingClientRect(),c=e.clientY;e.touches&&(c=e.touches[0].clientY);var u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=(e=Math.min(Math.max(0,e),r))/r,o=Math.pow(i,a);return t+(n-t)*o}(a-(c-s.top),n,r,a,i);return isNaN(u)?-100:u}function xu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;return(e-t)/(n-t)}(e,t,n,r);return r*Math.pow(i,1/a)+4}var Su=function(e,t){return e.find(function(e){return e.name===t.name})},Pu=["Aux Event A","Aux Event B","Aux Event C","Aux Event D"],Eu=["Transpose","reverse"],Tu=Bi.isMobile?90:60,Au={Duration:4,Velocity:1.5,"Aux Event A":1.5,"Aux Event B":1.5,"Aux Event C":1.5,"Aux Event D":1.5},Mu=function(e,t){var n=Cu(e,t)&&t.getAuxVariable(e.name);return Eu.includes(e.name)||["transpose","chop","reverse"].includes(n)};var Ru=function(e,t){return Pu.includes(e.name)?0:e.min},Cu=function(e,t){switch(e.name){case"Aux Event A":return t.auxEventAType;case"Aux Event B":return t.auxEventBType;case"Aux Event C":return t.auxEventCType;case"Aux Event D":return t.auxEventDType}},Nu=function(e,t){if(!Pu.includes(e.name)){if("Slice"===e.name){var n=t.getSamplers()[0];return n&&n.slices.length-1||0}return e.max}Cu(e,t);switch(t.getAuxVariable(e.name)){case"transpose":return 32;case"duration":return 8;case"velocity":return 1;case"chop":return 16;case"panning":return 1}},Iu=Object(s.b)(function(e,t){return{value:null===t.parameter.get()?t.trackParameter.get():t.parameter.get(),v:e.effects.effectParameters[t.parameter.id],cirklonMode:e.cirklon.cirklonMode[t.track.id],selectedSteps:e.keyboard.selectedPianoRollSteps}},function(e){return{setEffectParameterValue:function(t,n){return e(Object(c.wb)(t,n))},setEffectParameterValues:function(t){return e(Object(c.xb)(t))}}})(function(e){var t,n=e.setEffectParameterValue,r=e.setEffectParameterValues,o=e.track,s=e.name,c=e.value,u=e.parameter,l=(e.id,e.color),f=e.shouldRound,h=void 0===f?Mu(u,o):f,d=e.stepData,p=e.min,v=void 0===p?Ru(u,o):p,m=e.max,y=void 0===m?Nu(u,o):m,b=e.height,g=void 0===b?Tu:b,O=(e.units,e.cirklonMode),j=e.selectedSteps,k=void 0===j?[]:j,w=e.root,x=void 0===w?Au[u.name]||1:w,S=Object(a.useRef)(void 0),P={height:xu(c,v,y,g,x),backgroundColor:l},E={bottom:xu(o.trackData.parameters.find(function(e){return e.name===u.name}).get(),v,y,g,x)},T=ku({root:x,shouldRound:h,min:v,max:y,height:g,ref:S,setEffectParameterValue:n,track:o,stepData:d,setEffectParameterValues:r,parameter:u,cirklonMode:O,selectedSteps:k}),A=T.onMouseDown,M=T.onMouseMove;return i.a.createElement("div",{className:"p-box"},i.a.createElement("div",{className:"p-name"},s),i.a.createElement("div",{ref:S,style:{height:g+6},id:u.id,onClick:function(e){return e.stopPropagation()},onMouseMove:M,onMouseDown:A,className:"volume-box"},i.a.createElement("div",{className:"rest"}),i.a.createElement("div",{style:P,className:"volume-indicator"}),i.a.createElement("div",{style:E,className:"helper-line"}),i.a.createElement("div",{className:"value"},(t=c,Math.round(100*t)/100))))}),qu=new qc.a,_u=Object(a.memo)(function(e){var t=e.track,n=e.resolution,r=e.parameter,a=e.stepData,o=void 0===a?qu:a,s=e.on,c=e.i,u=e.stepNumber,l=e.isCursor,f=e.isSelected,h=e.color;if(void 0===o)return[];var d="";u%function(e){return parseInt(e.numSteps())/4}(n)===0&&0!==c&&(d=i.a.createElement("div",{className:"bar-divider"}));var p=s?"cirklon-step on":"cirklon-step";return l&&(p+=" cursor"),[d,i.a.createElement("div",{"data-stepNumber":u,className:p},i.a.createElement(Iu,{color:h,trackParameter:t.trackData.parameters.find(function(e){return e.name===r})||t.trackData.velocityParameter,track:t,stepData:o,parameter:o.parameters.find(function(e){return e.name===r})||o.velocityParameter}),i.a.createElement(mu,{color:h,stepData:o}),i.a.createElement(gu,{color:h,isSelected:f,track:t,on:s,stepData:o,stepNumber:u}))]}),Du=(Object(s.b)(function(e,t){return{cirklonMode:e.cirklon.cirklonMode[t.track.id]}},function(e,t){return{setCirklonMode:function(n){return e(Object(c.R)(t.track.id,n))},setSelectedSteps:function(t){return e(Object(c.yd)(t))}}})(function(e){var t=e.mode,n=e.cirklonMode,r=e.setCirklonMode,o=(e.setSelectedSteps,"cirklon-mode-btn");t===n&&(o+=" selected");var s=Object(a.useCallback)(function(e){r(t===n?void 0:t)},[t,n]);return i.a.createElement("div",{onClick:s,className:o},t)}),function(e){return e.slice(0,1).toUpperCase()+e.slice(1)}),Fu=Object(s.b)(function(e,t){return{parameter:e.cirklon.cirklonParameterSelected[t.track.id],stepParameterSelected:e.cirklon.stepParameterSelected}},function(e,t){return{setParameter:function(n){return e(Object(c.S)(t.track.id,n))},setStepParameterSelected:function(t){return e(Object(c.he)(t))}}})(function(e){var t=e.color,n=e.parameter,s=e.setParameter,c=e.track,u=(e.stepDatas,e.setStepParameterSelected),l=e.stepParameterSelected,f=c.getStepDataParams(),h=Object(a.useState)(Object(o.a)(f)),d=Object(r.a)(h,2),p=d[0],v=d[1];f.map(function(e){return{label:e,value:e}});Object(a.useEffect)(function(){l&&s(l)},[l,s]);var m=Object(a.useCallback)(function(e){s(e.value),u(e.value)},[s,v,p]);Object(a.useEffect)(function(){return window.addEventListener("keydown",y),function(){return window.removeEventListener("keydown",y)}},[s]);var y=Object(a.useCallback)(function(e){"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&("D"===e.key?(s("Duration"),u("Duration")):"V"===e.key?(s("Velocity"),u("Velocity")):"S"===e.key?(s("Slice"),u("Slice")):"T"===e.key?(s("Transpose"),u("Transpose")):"C"===e.key?(s("Chop"),s("Chop")):"P"===e.key?s("Panning"):"R"===e.key&&s("reverse"))},[s]),b={backgroundColor:t};return Object(a.useEffect)(function(){n||s("Velocity")},[n]),i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},className:"cirklon-parameter-chooser"},p.map(function(e,t){return i.a.createElement("div",{key:t,style:n===e?b:{},onClick:function(){return m({value:e})},className:(n===e?"param-btn selected":"param-btn")+" "+e.split(" ").join("")},Du(e))}))}),Lu=(n(971),new Ot.a),Bu=Object(s.b)(function(e,t){e.sequencer.displayResolution;return{resolution:e.sequencer.displayResolution,stepIds:e.tracks.trackStepIds[t.track.id],steps:e.tracks.trackSteps[t.track.id],parameter:e.cirklon.cirklonParameterSelected[t.track.id],cursorStep:e.mix.selectedStep,isFrozen:t.track.isFrozen,selectedSteps:e.keyboard.selectedPianoRollSteps}},function(e){return{mouseDown:function(t){return e(Object(c.j)(t))},setSelectedZObject:function(t){return e(Object(c.Ed)(t))}}})(function(e){var t=e.isFrozen,n=e.mouseDown,o=e.stepIds,s=e.track,c=e.steps,u=e.parameter,l=e.resolution,f=e.color,h=e.cursorStep,d=e.selectedSteps,p=e.styling,v=e.setSelectedZObject,m=Object(a.useState)(0),y=Object(r.a)(m,2),b=y[0],g=y[1],O=Object(a.useState)(!0),j=Object(r.a)(O,2),k=j[0],w=j[1],x=Object(a.useState)(o),S=Object(r.a)(x,2),P=S[0],E=S[1],T=Object(a.useRef)(),A=Object(a.useRef)(),M=Object(a.useRef)(void 0),R=l.numSteps();32===l.resolution&&(R/=2);var C=R*b,N=R*(b+1);Object(a.useEffect)(function(){E(o)},[o,E]);var I=Object(a.useCallback)(function(){s.sequencerEngine.keyListener.legato()},[s]);c=c?c.slice(C,N):[];var q=Object(a.useCallback)(function(){if(s.sequencerEngine.state.selector.sampleTagDragging){var e=s.sequencerEngine,t=e.state.selector.sampleTagDragging;Array.isArray(t)||(t=[t]),e.searchForSounds(t,!0,s,void 0,!1)}},[s]),_=Object(a.useCallback)(function(e,t){var n=e.touches[0].clientX,r=e.touches[0].clientY,a=document.elementFromPoint(n,r);if(a&&void 0!==a.dataset.stepnumber){var i=parseInt(a.dataset.stepnumber);if(i===M.current)return;if(M.current=i,t)return;var o=a.className;(o.includes("step-toggle")||o.includes("cirklon-step"))&&(P[i],s.pattern.clearCache(),s.sequencerEngine.operationManager.dispatch(Object($.r)(s,i,l)))}},[P,l]);if(!c||!P)return"";var D="cirklon-editor";return t&&(D+=" frozen"),p&&p["secondary-color"]&&Lu.getBrightness(p["secondary-color"])>120&&(D+=" light-mode"),t?i.a.createElement("div",{style:{backgroundColor:p&&p["secondary-color"]},ref:T,onMouseDown:function(e){return n(!0)},onMouseUp:function(e){return n(!1)},className:D},"Frozen"):i.a.createElement("div",{style:{backgroundColor:p&&p["secondary-color"]},onDrop:q,ref:T,onMouseDown:function(e){return n(!0)},onMouseUp:function(e){return n(!1)},className:D},i.a.createElement("div",{ref:A,onClick:function(e){return e.stopPropagation()},onMouseDown:function(e){return e.stopPropagation()},onTouchStart:function(e){return _(e,!0)},onTouchEnd:function(){return M.current=void 0},onTouchMove:_,className:"cirklon-steps"},i.a.createElement(Kc,{track:s}),c.map(function(e,t){return i.a.createElement(_u,{color:f,isCursor:C+t===h,resolution:l,track:s,i:t,isSelected:d&&d.includes(P[C+t]),stepNumber:C+t,key:C+"."+t,stepData:P[C+t],parameter:u,on:e})})),i.a.createElement(Fu,{color:f,stepDatas:P,track:s}),i.a.createElement(pu,{track:s,isSelectedTrack:!0,trackColor:f},i.a.createElement(cu,{stepsRef:A,cirklonRef:T,track:s,isFollowing:k,setIsFollowing:w,numberOfSteps:P.length,barLength:R,resolution:l,setSelectedBar:g,selectedBar:b}),s&&i.a.createElement(Yc,{sequencerEngine:s.sequencerEngine}),i.a.createElement("div",{onClick:I,style:{backgroundColor:f},className:"legato-btn"},"Legato"),i.a.createElement(go,{onClickThumbnail:function(){return v(s)},track:s,hasInner:!0})),t&&i.a.createElement("div",{className:"frozen-overlay"},i.a.createElement("div",{className:"frozen-text"},"Frozen Track")))}),zu=new Ot.a,Ju=Object(s.b)(function(e,t){if(!t.object||!t.object.sequencerEngine)return{};var n=t.object.sequencerEngine.getSelectedTrack();return{styling:e.zobject.objectStylings[t.zobject.id],track:n,id:void 0===n?0:void 0!==n.sample&&void 0!==n.sample.getId()?n.sample.getId():n.presetName||n.getName()}},function(e){return{setKeyboardContext:function(t){return e(Object(c.Yb)(t))}}})(function(e){var t=e.track,n=(e.styling,e.zobject),r=e.setKeyboardContext;return i.a.createElement("div",{onMouseEnter:function(){return r(n)},onClick:function(){return r(n)}},t&&i.a.createElement(Bu,{styling:n.attributes,track:t,color:zu.getColorForTrack(t)}))}),Vu=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.dpad,n=Object(a.useCallback)(function(e,n){e.stopPropagation(),t.sendMessage(n,gt.a)},[t]);return i.a.createElement("div",{className:"dpad"},i.a.createElement("div",{className:"arrows-row"},i.a.createElement("div",{onClick:function(e){return n(e,"up")},className:"g-btn"},i.a.createElement("div",{className:"arrow-up"}))),i.a.createElement("div",{className:"arrows-row"},i.a.createElement("div",{onClick:function(e){return n(e,"left")},className:"g-btn"},i.a.createElement("div",{className:"arrow-left"})),i.a.createElement("div",{onClick:function(e){return n(e,"right")},className:"g-btn"},i.a.createElement("div",{className:"arrow-right"}))),i.a.createElement("div",{className:"arrows-row"},i.a.createElement("div",{onClick:function(e){return n(e,"down")},className:"g-btn"},i.a.createElement("div",{className:"arrow-down"}))))}),Hu=Object(s.b)(function(e,t){return{tidals:t.jrepl.tidals}},function(e){return{}})(function(e){var t=e.tidals;return t?i.a.createElement("div",{className:"jrepl"},t.map(function(e){return i.a.createElement(Vc,{key:e.id,tidal:e})})):i.a.createElement("div",{className:"jrepl"},"Not connnected to jaki...")}),Uu=Object(s.b)(function(e,t){return{number:t.macro?t.macro.value:0}},function(e){return{}})(function(e){var t=e.macro,n=e.number,o=e.styling,s=Object(a.useRef)(),c=Object(a.useRef)(),u=Object(a.useState)(n),l=Object(r.a)(u,2),f=l[0],h=l[1],d=Object(a.useState)(!1),p=Object(r.a)(d,2),v=p[0],m=p[1],y=xt({containerRef:s}).getXY;Object(a.useEffect)(function(){return window.addEventListener("mouseup",O),window.addEventListener("touchend",b),window.addEventListener("mousemove",g),function(){window.removeEventListener("mouseup",O),window.removeEventListener("mousemove",g),window.removeEventListener("touchend",b)}},[m,v,h]);var b=Object(a.useCallback)(function(e){(e.target===s.current||e.target===c.current)&&v&&m(!1)},[v,m]);Object(a.useEffect)(function(){h(n)},[n,h]);var g=Object(a.useCallback)(function(e){if(v){var n=v.y,r=v.number,a=(n-e.pageY)/n*(t.max-t.min)+r;if(a=Math.max(t.min,Math.min(t.max,a)),isNaN(a))return;a!==t.value&&(t.setValue(a),h(a))}},[m,v,h]),O=Object(a.useCallback)(function(e){v&&m(!1)},[m,v]),j=Object(a.useCallback)(function(e){if(v){e.stopPropagation();var n=y(e),r=(n.x,(120-n.y)/120);t.setValue(r),h(r),m({number:r,y:e.pageY})}},[v,h,m]),k=Object(a.useCallback)(function(e){if(v){e.stopPropagation();var n=function(e){for(var t=void 0,n=0;n<e.touches.length;n++)e.touches[n].target!==s.current&&e.touches[n].target!==c.current||(t=e.touches[n]);return t}(e);if(n){var r=y(n),a=(r.x,(120-r.y)/120);a=Math.min(1,Math.max(0,a)),t.setValue(a),h(a),m({number:a,y:e.pageY})}}},[v,h,m]);if(!t)return"";var w={height:Math.min(120,120*(f-t.min)/(t.max-t.min)),backgroundColor:o["secondary-color"]};return i.a.createElement("div",{style:{backgroundColor:o["primary-color"]},ref:s,onMouseMove:j,onTouchMove:k,onTouchStart:function(e){e.stopPropagation(),console.log("on touch start outter"),m({number:n,y:e.pageY})},onMouseDown:function(e){e.stopPropagation(),m({number:n,y:e.pageY})},className:"macro-slider"},i.a.createElement("div",{ref:c,onTouchMove:k,onTouchStart:function(e){console.log("on touch start inner"),e.stopPropagation(),m({number:n,y:e.pageY})},style:w,className:"slider-indicator"}))}),Gu=Object(s.b)(function(e,t){return{styling:e.zobject.objectStylings[t.zobject.id]}},function(e){return{}})(function(e){var t=e.macro,n=(e.styling,e.zobject),o=Object(a.useState)(!1),s=Object(r.a)(o,2),c=s[0],u=s[1];return t?i.a.createElement("div",{className:"zmacro"},i.a.createElement("div",null,i.a.createElement(Uu,{styling:n.attributes,macro:t}),i.a.createElement("div",{onClick:function(){return u(!c)},className:c?"more-info-btn show":"more-info-btn"},i.a.createElement("div",{className:"dot"}),i.a.createElement("div",{className:"dot"}),i.a.createElement("div",{className:"dot"}))),c&&i.a.createElement(ua,{isDraggable:!1,effect:t})):""});function Wu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var Ku=function(e){Object(b.a)(n,e);var t=Wu(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={start:0},r.operationManager=r.props.sequencerEngine.operationManager,r}return Object(y.a)(n,[{key:"componentDidUpdate",value:function(e){var t=this.props.currentPattern-this.props.currentPattern%10;t!==this.state.start&&(this.state.start=t,this.setState(this.state))}},{key:"prev",value:function(){this.props.sequencerEngine.switchToPattern(this.state.start-1)}},{key:"next",value:function(){this.props.sequencerEngine.switchToPattern(this.state.start+10)}},{key:"hasNext",value:function(){return this.state.start+10<this.numPatterns}},{key:"hasPrev",value:function(){return this.state.start>0}},{key:"onDragStart",value:function(e){this.props.dragPattern(e)}},{key:"deletePattern",value:function(){0!==this.props.sequencerEngine.tracks.length&&this.operationManager.dispatch(Object($.h)(this.props.sequencerEngine.tracks[0].currentPattern))}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDrop",value:function(e){this.props.sequencerEngine.movePatternTo(this.props.patternDragging,e),this.setState(this.state)}},{key:"clickPattern",value:function(e){this.props.sequencerEngine.store.getState();this.props.sequencerEngine.switchToPattern(e),this.setState(this.state)}},{key:"numPatterns",get:function(){return this.props.subSequence&&this.props.subSequence.tracks[0]?this.props.subSequence.tracks[0].patterns.length:this.props.sequencerEngine.numberOfPatterns()}},{key:"render",value:function(){var e=this;if(this.props.sequencerEngine.currentSubSequence.isTrack)return i.a.createElement("div",null);for(var t=[],n=0;n<this.numPatterns;n++)t.push(n);return t=t.slice(this.state.start,this.state.start+10),i.a.createElement("div",{className:"patterns-container"},this.hasPrev()?i.a.createElement("div",{onClick:function(){return e.prev()},className:"pag-btn"},"..."):"",t.map(function(t){return i.a.createElement(Qu,{key:t,setContextualHelp:function(t){return e.props.setContextualHelp(t)},patternNumber:t,currentPattern:e.props.currentPattern,patternColor:e.props.patternColors[t],patternToEditColor:e.props.patternToEditColor,secondaryColor:e.props.secondaryColor,primaryColor:e.props.primaryColor,onClickPattern:function(){return e.clickPattern(t)},onDragStart:function(n){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onDrop:function(n){e.onDrop(t)}})}),this.hasNext()?i.a.createElement("div",{onClick:function(){return e.next()},className:"pag-btn"},"..."):"",i.a.createElement("div",{style:{color:this.props.secondaryColor},onMouseOver:function(){return e.props.setContextualHelp(Ya.n)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"new-pattern-btn",onClick:function(){return e.props.sequencerEngine.newPattern(!0)}},"+"),i.a.createElement("div",{style:{color:this.props.secondaryColor},onMouseOver:function(){return e.props.setContextualHelp(Ya.c)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"delete-pattern-btn",onClick:function(){return e.deletePattern()}},"-"))}}]),n}(a.Component),Qu=function(e){Object(b.a)(n,e);var t=Wu(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"render",value:function(){var e=this,t="pattern-box",n={};this.props.currentPattern==this.props.patternNumber?(void 0!==this.props.patternColor?t+=" background-"+this.props.patternColor:t+=" current-pattern",n.backgroundColor=this.props.secondaryColor):(void 0!==this.props.patternColor&&(t+=" foreground-"+this.props.patternColor),n.color=this.props.secondaryColor),this.props.patternNumber==this.props.patternToEditColor&&(t+=" editing-color");var r=this.props.currentPattern===this.props.patternNumber?Ya.b:Ya.z;return i.a.createElement("div",{style:n,onMouseOver:function(){return e.props.setContextualHelp(r)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onDragStart:this.props.onDragStart,onDragOver:this.props.onDragOver,onMouseDown:function(e){return e.stopPropagation()},onDrop:this.props.onDrop,draggable:!0,className:t,onClick:this.props.onClickPattern},this.props.patternNumber+1)}}]),n}(a.Component),Zu=Object(s.b)(function(e,t){var n=t.sequencerEngine.engineId,r=t.subSequenceId||e.sequencer.currentSubSequence[n],a=e.sequencer.currentPattern[r]||0,i=e.sequencer.isPlaying[n]||0;return{midiMapMode:e.midi.midiMapMode,isCompactMode:e.sequencer.isCompactMode,resolution:e.sequencer.displayResolution,detailsView:e.sequencer.detailsView,decentralized:e.sequencer.decentralized,currentPattern:a,viewMode:e.sequencer.viewMode,numberOfPatterns:e.sequencer.numberOfPatterns[r]||1,samplePack:e.sequencer.samplePack,patternDragging:e.sequencer.patternDragging,isRecordingMix:e.mix.isRecordingMix,isPlayingMix:e.mix.isPlayingMix,isPlaying:i,patternToEditColor:e.toolbar.patternToEditColor,patternColors:e.toolbar.patternColors,trackRolling:e.sequencer.trackRolling,sequenceRolling:e.sequencer.sequenceRolling}},function(e){return{dragPattern:function(t){return e(Object(c.h)(t))},setContextualHelp:function(t){return e(Object(c.bb)(t))}}})(Ku),Yu=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.object,n=e.primaryColor,r=e.secondaryColor;return t.sequencerEngine?i.a.createElement("div",{style:{backgroundColor:n}},i.a.createElement(Zu,{secondaryColor:r,primaryColor:n,sequencerEngine:t.sequencerEngine})):""}),$u=Object(s.b)(function(e,t){var n=t.zobject.presentationMode||t.isInstrumentView;return{presentationMode:n,coords:n&&e.windows.presentationWindowPositions[t.zobject.id]||e.windows.windowPositions[t.zobject.id]}},function(e){return{}})(function(e){var t=e.windowRef,n=e.coords;e.isInstrumentView,e.presentationMode,e.zobject;return Object(a.useEffect)(function(){n&&(t.current.style.left=n.x+"px",t.current.style.top=n.y+"px")},[n]),""}),Xu=n(211),el=Object(s.b)(function(e,t){return{ioNumber:t.zmessage[t.field]}},function(e){return{}})(function(e){var t=e.zmessage,n=e.field,o=void 0===n?"inletNumber":n,s=e.icon,c=void 0===s?"inlet-icon":s,u=Object(a.useRef)(void 0),l=Object(a.useRef)(void 0),f=Je({ref:l}),h=f.onContextMenu,d=f.dropdownPos,p=f.setDropdownPos,v=Object(a.useState)(""),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useState)(!1),O=Object(r.a)(g,2),j=O[0],k=O[1],w=et(function(){return k(!0)});Object(a.useEffect)(function(){u.current&&j&&u.current.focus()},[j]);var x=Object(a.useCallback)(function(e){"Enter"===e.key&&(t._text=y,t.subSequence.propagate(Object(Xu.s)(t,y)),k(!1))},[k,y]),S="io-inner ";t.subSequence.instanceInlets&&t.subSequence.instanceInlets.includes(t)&&(S+=" instance-inlet");var P=Object(a.useCallback)(function(){t.subSequence.toggleInlet(t)},[!1,t]);return i.a.createElement("div",{ref:l,onContextMenu:"inletNumber"===o?h:function(){return[]},className:S,onClick:w},i.a.createElement(Ge,{dropdownPos:d,setDropdownPos:p},i.a.createElement(We,{onClick:P},"Convert to Instance Inlet")),j?i.a.createElement("div",{className:"io-number"},i.a.createElement("input",{onKeyDown:x,ref:u,value:y,type:"text",onChange:function(e){return b(e.target.value)}})):i.a.createElement("div",{className:"io-number"},t[o]," ",""!==t._text?". "+t._text:""),i.a.createElement("div",{className:c}))}),tl=n(109),nl=(n(604),Object(s.b)(function(e,t){var n=t.zmessage.presentationMode||t.isInstrumentView,r=!1;return n&&t.zmessage.attributes&&!t.zmessage.attributes["Include in Presentation"]&&(r=!0),{isUniform:t.zmessage.attributes["glsl uniform"],presentationMode:n,hidden:r,isSelected:e.windows.selectedElements[t.zmessage.id],isSelectedZObject:e.zobject.selectedZObject===t.zmessage,messageText:t.zmessage._text,uxLocked:e.zobject.uxLocked,isDeleted:t.zmessage.isDeleted,styling:e.zobject.objectStylings[t.zmessage.id],includeInPresentation:!n&&t.zmessage.attributes["Include in Presentation"]}},function(e){return{setSelectedZObject:function(t){return e(Object(c.Ed)(t))},setZObjectContextMenu:function(t,n,r){return e(Object(c.cf)(t,n,r))}}})(function(e){var t,n=e.zmessage,o=e.messageText,s=(e.coords,e.sequencerEngine),c=e.scale,u=e.customMode,l=e.sizeRef,f=e.containerRef,h=e.elements,d=e.setOrdering,p=e.isSelected,v=e.isUniform,m=e.forceShow,y=void 0!==m&&m,b=e.isSelectedZObject,g=e.ordering,O=e.size,j=e.presentationMode,k=e.isInstrumentView,w=e.hidden,x=e.includeInPresentation,S=e.setSize,P=e.setSelectedZObject,E=e.uxLocked,A=e.isDeleted,M=e.setZObjectContextMenu,R=Object(a.useRef)(void 0),C=Object(a.useRef)(void 0),N=Object(a.useState)(o),I=Object(r.a)(N,2),q=I[0],_=I[1],D=Object(a.useState)(!1),F=Object(r.a)(D,2),L=F[0],B=F[1],z=Object(a.useCallback)(function(e){n.attributes["read-only"]||(e.stopPropagation(),E||B(!0))},[E,B]),J=Object(a.useCallback)(function(e){e.stopPropagation(),E&&n.execute(),P(n)},[E,n,B]),V=et(z,250,J);Object(a.useEffect)(function(){_(o)},[_,o]),Object(a.useEffect)(function(){L&&!E&&C.current&&C.current.focus()},[L,E]),Object(a.useEffect)(function(){E&&B(!1)},[E,B]);var H=Object(a.useCallback)(function(e){var t=e.target.value;n.text=t,_(t)},[_]),U=mt({scale:c,ref:R,sequencerEngine:s,sizeRef:l,containerRef:f,size:O,setSize:S,elements:h,element:n,setOrdering:d,ordering:g,dragOnLoad:n.dragOnLoad}),G=U.style,W=(U.isDragging,U.onMouseDown),K=U.onMouseUp;U.setCoords;n.dragOnLoad=!1;var Q=Object(a.useCallback)(function(e){e.preventDefault(),e.stopPropagation();var t=f.current.getBoundingClientRect(),r=e.clientX-t.left,a=e.clientY-t.top;M(n.subSequence.id,{x:r,y:a},n)},[n]),Z=Object(ot.a)({},G),Y=(Object(a.useCallback)(function(){n.execute()},[n]),Object(a.useCallback)(function(e){"Enter"===e.key&&(n.text=q,n.execute(),B(!1))},[B,q])),$={};q&&q.length>0&&(n.isOutlet||n.isInlet||($.width=q.length+2+"ch")),Z=Object(ot.a)({},Z,$);var X="z-object z-message";p&&(X+=" selected"),n.attributes["read-only"]&&(X+=" read-only"),b&&(X+=" selected-object"),(n.isOutlet||n.isInlet)&&(X+=" io"),x&&(X+=" include-in-presentation"),n.type===bt.a&&(X+=" bang"),n.type===bt.c&&(X+=" number"),E&&(X+=" locked");var ee=n.state.windows,te=j&&ee.presentationWindowPositions[n.id]||ee.windowPositions[n.id];if("custom"===u){var ne=[n.subSequence.zObject.width,n.subSequence.zObject.height],re=ne[0],ae=ne[1],ie=te;if(ie&&(ie.x>re||ie.y>ae))return""}if(!y&&(A||w))return"";var oe=n.attributes,se={},ce={};return oe&&(Z.backgroundColor=oe["background-color"],ce.color=oe["primary-color"],se.borderColor=oe["primary-color"],se.backgroundColor=oe["secondary-color"],oe.width&&(Z.width=oe.width+"px",ce.width=oe.width+"px"),oe["align to center"]&&(ce["text-align"]="center")),te&&(Z.left=te,Z.top=te),v&&(X+=" znumber-uniform"),i.a.createElement("div",(t={onClick:function(e){e.stopPropagation(),n.type===bt.a&&(P(n),E&&n.execute())},style:ce,onMouseDown:"custom"===u?function(){return 0}:W,onContextMenu:Q,onMouseUp:K,ref:R},Object(T.a)(t,"style",Z),Object(T.a)(t,"className",X),t),i.a.createElement($u,{isInstrumentView:k,zobject:n,windowRef:R}),n.type===bt.c?i.a.createElement(wa,{color:oe&&oe["primary-color"],isSelectedZObject:b,number:o,znumber:n}):n.type===bt.a?i.a.createElement("div",{style:se,onClick:function(){},className:"bang-button"}):n.isInlet?i.a.createElement(el,{zmessage:n}):n.isOutlet?i.a.createElement(el,{field:"outletNumber",icon:"outlet-icon",zmessage:n}):!L||E?i.a.createElement("div",{style:ce,onClick:V,className:"message-content"},q):i.a.createElement("input",{spellcheck:"false",style:$,onKeyDown:Y,ref:C,onBlur:function(){return B(!1)},type:"text",className:"z-object-input",onChange:H,value:q}),v&&i.a.createElement("div",{className:"uniform-dot"}),!n.isInlet&&i.a.createElement(wt,{numInlets:n.numInlets,effect:n}),!n.isOutlet&&i.a.createElement(Pt,{numOutlets:n.numOutlets,subSequence:n.subSequence,containerRef:f,scale:c,effect:n}))})),rl=function(e){return{zobjects:e.zObjects.filter(function(e){return e.effect&&e.attributes["scripting name"]}),zmessages:e.zMessages.filter(function(e){return e.attributes["scripting name"]})}},al=Object(s.b)(function(e,t){return{messages:t.subpatch.zMessages,objects:t.subpatch.zObjects}},function(e){return{}})(function(e){var t=e.subpatch,n=rl(t),r=n.zobjects,a=n.zmessages;if(0===r.length&&0===a.length)return"";for(var s=0,c=0,u=[].concat(Object(o.a)(r),Object(o.a)(a));c<u.length;c++){var l=u[c],f=8*l.attributes["scripting name"].length;l.effect&&l.effect.width&&(f=Math.max(f,l.effect.width)),s+=Math.max(65,f)}console.log("total width=",s);var h={minWidth:Math.min(350,s)+"px"};return i.a.createElement("div",{style:h,className:"subpatch-variables"},r.map(function(e){return i.a.createElement("div",{className:"vari"},i.a.createElement("div",{className:"variable-name"},e.attributes["scripting name"]),i.a.createElement(Rf,{forceShow:!0,zobject:e}))}),a.map(function(e){return i.a.createElement("div",{className:"vari"},i.a.createElement("div",{className:"variable-name"},e.attributes["scripting name"]),i.a.createElement(nl,{forceShow:!0,zmessage:e}))}))}),il=Object(s.b)(function(e,t){return{attributes:t.subpatch.zObject.attributes,viewableSubPatches:e.zobject.viewableSubPatches,_name:t.subpatch.zObject.args[0]}},function(e){return{setViewableSubPatches:function(t){return e(Object(c.We)(t))},setWindowPosition:function(t,n){return e(Object(c.Ze)(t,n))},setSelectedZObject:function(t){return e(Object(c.Ed)(t))}}})(function(e){var t=e.subpatch,n=e.viewableSubPatches,s=e.setWindowPosition,u=e._name,l=e.setSelectedZObject,f=Object(a.useRef)(void 0),h=Object(a.useState)(t.zObject.args[0]||""),d=Object(r.a)(h,2),p=d[0],v=d[1],m=Object(a.useState)(!p||""===p),y=Object(r.a)(m,2),b=y[0],g=y[1],O=function(e){var t=e.zobject,n=e.text,r=0;if(n.length>0){var a=6;n.startsWith("subpatch")&&(n=n.replaceAll("subpatch","patc"),a=2);var i=n.length+a;r=n.length+a+"ch";var o=t.numInlets;t.effect&&t.effect.numInlets&&(o+=t.effect.numInlets);var s=t.numOutlets;t.effect&&t.effect.numOutlets&&(s+=t.effect.numOutlets);var c=Math.max(o,s);c*a>i&&(i=c*a,r=c*a+"ch")}return r}({zobject:t.zObject,text:t.zObject._text});Object(a.useEffect)(function(){v(u)},[v,u]),Object(a.useEffect)(function(){p!==t.zObject.args[0]&&(t.zObject.text="subpatch "+p)},[p]),Object(a.useEffect)(function(){b&&f.current&&f.current.focus()},[b]);var j=Object(a.useCallback)(function(){var e=t.zObject,n=e.sequencerEngine.state,r=e.subSequence;if(r.inletObjects){var a=n.windows.windowPositions[r.id];s(t.id,a)}var i=n.zobject.viewableSubPatches;Object(c.We)([].concat(Object(o.a)(i),[t]))},[t]),k=et(j),w=t.zObject.attributes["font-size"],x={fontSize:w+"pt"},S=Object(ot.a)({},x);x.height=15*w/10+"px",x.lineHeight=15*w/10+"px",b||(S.minWidth=O);var P="closed-subpatch";n.includes(t)&&(P+=" viewing");var E=rl(t),T=E.zobjects,A=E.zmessages;return i.a.createElement("div",{onMouseDown:function(e){return l(t.zObject)},style:S,onClick:k,className:P},0===T.length&&0===A.length&&i.a.createElement("div",{className:"subpatch-name-row"},"p ",b?i.a.createElement("input",{ref:f,placeholder:"type name",style:x,onBlur:function(e){return g(!1)},onChange:function(e){return v(e.target.value)},value:p,type:"text",className:"subpatch-name-input"}):i.a.createElement("div",{style:x,onClick:function(e){return g(!0)},className:"subpatch-name"},p)),i.a.createElement(al,{subpatch:t}))}),ol=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.zobject,n=t.width,r=t.height,o=Object(a.useRef)(void 0),s=Object(a.useRef)(void 0);return Object(a.useEffect)(function(){return s.current=o.current.getContext("2d"),t.effect.ctxt=s.current,function(){return t.effect.ctxt=void 0}},[]),Object(a.useEffect)(function(){s.current&&s.current.scale(window.devicePixelRatio,window.devicePixelRatio)},[n,r]),i.a.createElement("canvas",{height:r*window.devicePixelRatio,width:n*window.devicePixelRatio,style:{width:n,height:r},ref:o})}),sl=(n(1926),Object(s.b)(function(e,t){if(!t.track)return{};var n={showSequencer:t.zobject.attributes["show-sequencer"]},r=e.tracks.triggers[t.track.trackNumber];return n.playing=r&&Object.keys(r).some(function(e){return r[e]})||t.track.notesTriggered&&Object.keys(t.track.notesTriggered).length>0,n.notesTriggered=t.track.notesTriggered,n},function(e){return{}})(function(e){var t=e.track,n=e.playing,r=e.showSequencer,o=(e.containerRef,Object(a.useRef)()),s="ztrack-component";return n&&(s+=" playing"),t?i.a.createElement("div",{onClick:function(){return t.sequencerEngine.selectTrack(t.trackNumber)},ref:o,className:s},r?0:[i.a.createElement(go,{key:0,track:t,draggable:!1}),i.a.createElement("div",{key:1,className:"trigger-indicator"})]):""})),cl=(n(1927),Object(s.b)(function(e,t){return{_color:t.zcolor.color,show:e.zobject.colorPickerShowing===t.zcolor}},function(e){return{setSelectedZObject:function(t){return e(Object(c.Ed)(t))},setShow:function(t){return e(Object(c.V)(t))}}})(function(e){var t=e.zcolor,n=e._color,o=e.setSelectedZObject,s=e.setShow,c=e.show,u=Object(a.useState)({hex:t.color}),l=Object(r.a)(u,2),f=l[0],h=l[1];Object(a.useEffect)(function(){h(n)},[h,n]),Object(a.useEffect)(function(){return function(){return s(void 0)}},[]),Object(a.useEffect)(function(){t.zObject.height=c?300:30},[c]);var d=Object(a.useCallback)(function(e){t.color=e.hex,h(e)},[]),p="z-color";return c&&(p+=" showing"),i.a.createElement("div",{onMouseDown:function(e){e.stopPropagation()},className:p},i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},className:"picker-container"},i.a.createElement("div",{onClick:function(){o(t.zObject.composite||t.zObject),s(c?void 0:t)},style:{backgroundColor:t.color},className:"color-show-btn"}),c&&i.a.createElement(It.a,{disableAlpha:!0,color:f,onChange:d})))})),ul=Object(s.b)(function(e,t){return{width:t.zobject.width,height:t.zobject.height}},function(e){return{}})(function(e){var t=e.zobject,n=e.width,r=e.height;return i.a.createElement(Xr,{isDraggable:!0,setExpanded:function(){return[]},width:n-5,height:r-40,disableSyntaxHelper:!0,expanded:!1,doc:t.effect.doc,sequencerEngine:t.sequencerEngine,effect:t.effect})}),ll=(n(1928),function(e){return"number"===typeof e||"string"===typeof e?e:JSON.stringify(e)}),fl=Object(s.b)(function(e,t){return{fragmentShader:t.zobject.effect.fragmentShader,vertexShader:t.zobject.effect.vertexShader}},function(e){return{}})(function(e){var t=e.zobject,n=e.fragmentShader,o=e.vertexShader,s=Object(a.useState)(t.effect.uniforms),c=Object(r.a)(s,2),u=c[0],l=c[1],f=Object(a.useState)(!1),h=Object(r.a)(f,2),d=h[0],p=h[1],v=Object(a.useState)(""),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useState)(0),O=Object(r.a)(g,2),j=O[0],k=(O[1],Object.keys(u||{})),w=Object(a.useCallback)(function(){t.effect.createUniform(y,j),l(Object(ot.a)({},t.effect.uniforms)),p(!1)},[l,p,j,y,p]);return i.a.createElement("div",{className:"zshader-material"},d&&i.a.createElement("div",{className:"creating-uniform"},i.a.createElement("div",{className:"create-row"},i.a.createElement("div",{className:"label"},"Name"),i.a.createElement("input",{type:"text",value:y,onChange:function(e){return b(e.target.value)}})),i.a.createElement("div",{onClick:w,className:"done-btn"},"Done")),i.a.createElement("div",{className:"material-title"},"Shader Material"),i.a.createElement("div",{onClick:function(){return p(!0)},className:"new-uniform-button"},"New Uniform"),i.a.createElement("div",{className:"uniforms"},k.map(function(e){return i.a.createElement("div",{className:"uniform"},e,": ",ll(u[e].value))})),i.a.createElement("div",{className:"shaders"},i.a.createElement("div",{className:o?"enabled shader":"shader"},"Vertex ",i.a.createElement("div",{className:"dot"})),i.a.createElement("div",{className:n?"enabled shader":"shader"},"Fragment ",i.a.createElement("div",{className:"dot"}))))}),hl=new Ot.a,dl=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.seedHash,n=e.className,r=void 0===n?"token-icon":n,a={};if(t){var o=hl.saturate(hl.getColorForHash(t),1),s=[o,hl.compliment(o,1.1),hl.compliment(o,1.2),hl.compliment(o,1.3),hl.compliment(o,1.4),hl.compliment(o,1.5)];a={background:"radial-gradient(92% 75.29% at 2.96% 24.36%, ".concat(s[0]," 0.52%, ").concat(s[1]," 18.75%, ").concat(s[2]," 34.38%, ").concat(s[3]," 49.48%, ").concat(s[4]," 74.48%, ").concat(s[5]," 100%)")}}return i.a.createElement("div",{style:a,className:r})}),pl=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.zobject.sequencerEngine;return i.a.createElement("div",{className:"z-nft"},i.a.createElement(dl,{seedHash:t.seedHash}),"NFT")});function vl(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ml(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ml(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ml(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var yl=Object(s.b)(function(e,t){var n=[t.grid.getConnectedTidal(0),t.grid.getConnectedTidal(1),t.grid.getConnectedTidal(2),t.grid.getConnectedTidal(3),t.grid.getConnectedTidal(4),t.grid.getConnectedTidal(5)];return{currentCycles1:n[0]&&n[0].currentLeaves,currentCycles2:n[1]&&n[1].currentLeaves,currentCycles3:n[2]&&n[2].currentLeaves,currentCycles4:n[3]&&n[3].currentLeaves,currentCycles5:n[4]&&n[4].currentLeaves,currentCycles6:n[5]&&n[5].currentLeaves}},function(e){return{}})(function(e){var t=e.currentCycles1,n=e.currentCycles2,r=e.currentCycles3,a=e.currentCycles4,s=e.currentCycles5,c=e.currentCycles6,u=e.grid,l=[];return[t,n,r,a,s,c].filter(function(e){return e}).flatMap(function(e){return e}).forEach(function(e){var t,n=vl(e.rules);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(u.rules&&u.rules.includes(r)){var a=r.block;if(a&&"continue"===function(){var e=Math.min.apply(Math,Object(o.a)(a.map(function(e){return e.x}))),t=Math.min.apply(Math,Object(o.a)(a.map(function(e){return e.y}))),n=Math.max.apply(Math,Object(o.a)(a.map(function(e){return e.x}))),r=Math.max.apply(Math,Object(o.a)(a.map(function(e){return e.y})));if(l.some(function(n){return n.x===20*e&&n.y===20*t}))return"continue";l.push({x:20*e,y:20*t,w:20*(1+n-e),h:20*(1+r-t)})}())continue}}}catch(i){n.e(i)}finally{n.f()}}),i.a.createElement("svg",null,l.map(function(e){return i.a.createElement("rect",{x:e.x,y:e.y,width:e.w,height:e.h})}))}),bl=Object(s.b)(function(e,t){return{cell:t.grid.cells[t.y][t.x]}},function(e){return{}})(function(e){var t=e.mode,n=e.selected,o=e.cell,s=e.odd,c=e.x,u=e.y,l=e.grid,f=e.selection,h=e.setSelection,d=e.dragging,p=e.setDragging,v=Object(a.useState)(o),m=Object(r.a)(v,2),y=m[0],b=m[1],g=s?"cell odd":"cell";y&&(g+=" on"),Object(a.useEffect)(function(){b(o)},[o,b]);var O=Object(a.useCallback)(function(){var e=void 0;y?(e=!1,l.set(c,u,!1)):(e=t,l.set(c,u,t)),b(e)},[t,b,y,c,u]),j=Object(a.useCallback)(function(){y?p({x:c,y:u}):h({x1:c,y1:u,x2:c,y2:u})},[y,f,h,p]),k=Object(a.useCallback)(function(){d?l.drag(d.x,d.y,c,u)&&p({x:c,y:u}):f&&h(Object(ot.a)({},f,{x2:c,y2:u}))},[f,d,p,h]);return f&&c>=f.x1&&c<=f.x2&&u>=f.y1&&u<=f.y2&&(g+=" selection"),n&&(g+=" selected"),y===Jn.a&&(g+=" dash"),y===Jn.b&&(g+=" dot"),i.a.createElement("div",{onMouseUp:function(){return p(void 0)},onMouseDown:j,onMouseOver:k,onClick:O,className:g},y===Jn.a?i.a.createElement("div",{className:"dash-inner"},i.a.createElement(Hn,{cell:y})):i.a.createElement(Hn,{cell:y}))}),gl=(n(1929),Object(s.b)(function(e,t){return{mode:e.toolbar.jakiGridMode}},function(e){return{setMode:function(t){return e(Object(c.Wb)(t))}}})(function(e){var t=e.grid,n=e.mode,o=e.setMode,s=Object(a.useState)(void 0),c=Object(r.a)(s,2),u=c[0],l=c[1],f=Object(a.useState)(void 0),h=Object(r.a)(f,2),d=h[0],p=h[1],v=Object(a.useState)({}),m=Object(r.a)(v,2),y=m[0],b=m[1];Object(a.useEffect)(function(){return window.addEventListener("mouseup",O),window.addEventListener("keydown",g),function(){window.removeEventListener("mouseup",O),window.removeEventListener("keydown",g)}},[l,u,b,y]);var g=Object(a.useCallback)(function(e){if("Backspace"===e.key){for(var n in y){var a=n.split(",").map(function(e){return parseInt(e)}),i=Object(r.a)(a,2),o=i[0],s=i[1];t.set(o,s,!1)}b({})}},[y,b]),O=Object(a.useCallback)(function(){u&&(b(t.getSelected(u)),l(void 0)),d&&p(void 0)},[u,d,p,l,b]);return i.a.createElement("div",{className:"jaki-grid"},i.a.createElement(Qn,{setMode:o,mode:n}),i.a.createElement(yl,{grid:t}),t.cells.map(function(e,r){return i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},onMouseDown:function(e){return e.stopPropagation()},className:r%2===0?"jaki-row":"jaki-row odd"},e.map(function(e,a){return i.a.createElement(bl,{mode:n,setDragging:p,dragging:d,selected:y[a+","+r],setSelection:l,selection:u,x:a,y:r,grid:t,odd:a%2===1})}))}))})),Ol=Object(s.b)(function(e,t){return{figureLength:t.chosen&&t.chosen.figure.figureLength,figureType:t.chosen&&t.chosen.figure.figureType}},function(e){return{}})(function(e){var t=e.setChosen,n=e.effect,r=e.chosen;Object(a.useEffect)(function(){return window.addEventListener("keydown",o),function(){return window.removeEventListener("keydown",o)}},[r,n]);var o=Object(a.useCallback)(function(e){if("Backspace"===e.key&&r)n.figures.deleteFigure(r.figure),t(void 0);else if(Object(Ae.a)(e.key)){var a=parseInt(e.key);if(er.b[a]){var i=er.b[a][0];u(i)}}},[t,r,n]),s=r.figure,c=Object(a.useCallback)(function(){n.figures.deleteFigure(s),t(void 0)},[s,n,t]),u=Object(a.useCallback)(function(e){e=n.figures.updateFigure(s,e),t({type:"FIGURE",figure:e})},[t,s]),l=Object(a.useCallback)(function(e){var t=e.value,n=er.b[t][0];u(n)},[t,s]),f=er.b[Math.round(s.figureLength)];s.toString();return Object(a.useEffect)(function(){var e=f[s.figureType];t({type:"FIGURE",figure:s,newFigure:e})},[s.figureType,f,t]),i.a.createElement("div",{className:"figure-screen"},i.a.createElement("div",{onClick:function(e){e.stopPropagation(),c()},className:"delete-btn"},"x"),i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:"figure-header"},"Figure",i.a.createElement(or.a,{value:{label:s.figureLength,value:s.figureLength},onChange:l,options:Object.keys(er.b).map(function(e){return{label:e,value:e}})})),i.a.createElement("div",{className:"figure-options"},f.map(function(e,t){return i.a.createElement("div",{onClick:function(t){t.stopPropagation(),u(e)},className:t===s.figureType?"cycle-option selected":"cycle-option"},e)})))}),jl=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.track,n=e.effect.tidals[t-1];if(n)return i.a.createElement("div",null,i.a.createElement(Nr,{WIDTH:110,HEIGHT:110,tidals:[n],color:"#F6F6E9",backgroundColor:"#2D2D2E",fillColor:"#747474",dotColor:"#E8ECFF"}))}),kl=n(655),wl=function(e){var t=e.isSelected,n=e.rule,r=e.onClick;return i.a.createElement("div",{onClick:function(){return r(n)},className:t?"rule-part selected":"rule-part"},n.name," ",void 0!==n.value?n.value:"")},xl=function(e){var t=e.option,n=e.onClick,r=e.name;return i.a.createElement("div",{onClick:function(){return n(t())},className:"puzzle-option"},r)},Sl=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.track,n=e.effect,s=Object(a.useState)(void 0),c=Object(r.a)(s,2),u=c[0],l=c[1],f=Object(a.useState)(n.scaleRules[t-1]),h=Object(r.a)(f,2),d=h[0],p=h[1];Object(a.useEffect)(function(){p(n.scaleRules[t-1])},[n,t,p]);var v=Object(a.useCallback)(function(e){if(u){var r=d.indexOf(u);d[r]=e}else d.push(e);n.scaleRules[t-1]=Object(o.a)(d),p(n.scaleRules[t-1])},[u,d,n,t,p]),m=Object(a.useCallback)(function(e){var r=n.scaleRules[t-1].indexOf(e);n.scaleRules[t-1].splice(r,1),p(Object(o.a)(n.scaleRules[t-1]))},[n,t,p]),y=Object(a.useCallback)(function(e,r){void 0!==e.value&&(e.value=r,p(Object(o.a)(n.scaleRules[t-1])))},[n,t,p]),b=Object(a.useCallback)(function(e,r){var a=d.indexOf(e),i=Object(xr.a)(a+r,d.length),s=d[i];d[i]=e,d[a]=s,n.scaleRules[t-1]=Object(o.a)(d),p(Object(o.a)(d))},[n,d,t,p]);Object(a.useEffect)(function(){return window.addEventListener("keydown",g),function(){return window.removeEventListener("keydown",g)}},[n,t,p,u]);var g=Object(a.useCallback)(function(e){if(u)if("Backspace"===e.key)m(u);else if("ArrowLeft"===e.key)b(u,-1);else if("ArrowUp"===e.key)b(u,1);else if(Object(Ae.a)(e.key)){var t=parseInt(e.key);y(u,t)}},[n,d,t,p,u]);return i.a.createElement("div",{onClick:function(){return l(void 0)},className:"track-screen"},"Scale for Track: ",t,i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:"scale-rules"},d.map(function(e){return i.a.createElement(wl,{isSelected:u===e,rule:e,onClick:l})})),i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:"puzzle-options"},i.a.createElement(xl,{onClick:v,option:kl.g,name:"Play"}),i.a.createElement(xl,{onClick:v,option:kl.f,name:"Pause"}),i.a.createElement(xl,{onClick:v,option:kl.e,name:"Forward"}),i.a.createElement(xl,{onClick:v,option:kl.i,name:"Rewind"}),i.a.createElement(xl,{onClick:v,option:kl.h,name:"Restart"})),i.a.createElement(jl,{track:t,effect:n}))}),Pl=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.setChosen,n=e.effect,r=(e.track,e.sequencerEngine,e.chosen);return i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:"screen"},"FIGURE"===r.type&&i.a.createElement(Ol,{setChosen:t,effect:n,chosen:r}),"TRACK"===r.type&&i.a.createElement(Sl,{setChosen:t,effect:n,track:r.track}))}),El=Object(s.b)(function(e,t){return{_figures:t.effect&&t.effect.figures._figures}},function(e){return{}})(function(e){var t=e.effect,n=e.setOverflow,o=e._figures,s=Object(a.useState)(void 0),c=Object(r.a)(s,2),u=c[0],l=c[1],f=Object(a.useState)(o),h=Object(r.a)(f,2),d=h[0],p=h[1];Object(a.useEffect)(function(){return window.addEventListener("keydown",m),function(){return window.removeEventListener("keydown",m)}},[u,t,d]),Object(a.useEffect)(function(){return window.addEventListener("click",v),function(){return window.removeEventListener("click",v)}},[l,u]);var v=Object(a.useCallback)(function(){u&&(console.log("clearing chosen"),l(void 0))},[l,u]);Object(a.useEffect)(function(){u||n(void 0)},[u,n]);var m=Object(a.useCallback)(function(e){if(("ArrowRight"===e.key||"ArrowLeft"==e.key)&&u){var n="ArrowRight"===e.key?1:-1,r=u.figure,a=t.figures.figures.indexOf(r),i=Object(xr.a)(a+n,d.length);l(Object(ot.a)({},u,{figure:t.figures.figures[i]}))}},[l,u,t,d]),y=Object(a.useCallback)(function(){t.figures.newFigure(),p(t.figures._figures)},[t,p]),b=Object(a.useCallback)(function(){t.figures.doubleFigures(),p(t.figures._figures)},[t,p]),g=Object(a.useCallback)(function(){t.figures.halfFigures(),p(t.figures._figures)},[t,p]);return Object(a.useEffect)(function(){d&&o&&d.length!==o.length&&(l(void 0),n(void 0)),p(d)},[d,o,p]),t?i.a.createElement("div",{className:"core-jaki jaki"},i.a.createElement("div",{className:"name"},"Jaki"),i.a.createElement("div",{className:"core-figures"},t.figures.figures.map(function(e){return i.a.createElement("div",{onClick:function(t){t.stopPropagation(),u&&"FIGURE"===u.type&&u.figure===e?(n(!1),l(void 0)):(l({type:"FIGURE",figure:e}),n(!0))},className:u&&u.figure===e?"selected fig":"fig"},e.figureLength)}),i.a.createElement("div",{onClick:y,className:"fig add-fig pushable"},i.a.createElement("div",{className:"inner-btn"},"+")),i.a.createElement("div",{onClick:b,className:"fig add-fig pushable"},i.a.createElement("div",{className:"inner-btn"},"2x")),i.a.createElement("div",{onClick:g,className:"fig add-fig pushable"},i.a.createElement("div",{className:"inner-btn"},"1/2x"))),u&&i.a.createElement(Pl,{setChosen:l,chosen:u,effect:t})):0}),Tl=Object(s.b)(function(e,t){return t.param?{value:t.param.get()}:0},function(e){return{}})(function(e){var t=e.param,n=e.value,r=Object(a.useCallback)(function(e){e.stopPropagation();var r=(n+1)%3;t.set(r)},[n]),o=Math.pow(2,n);return i.a.createElement("div",{onClick:r,className:"halftime-control"},i.a.createElement("div",{className:"numerator"},"1"),i.a.createElement("div",{className:"slash"}),i.a.createElement("div",{className:"denominator"},o))}),Al=(n(1930),function(e){var t=e.value,n=e.onChange,r=e.currentType;return t?i.a.createElement("div",{onClick:function(){return n(void 0)},className:"cell on grid-option"},i.a.createElement(Hn,{cell:t.type||t})):i.a.createElement("div",{onClick:function(){return n(r)},className:"grid-option empty"})}),Ml=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){for(var t=e.parameter,n=e.show,s=e.setShow,c=Object(a.useState)(void 0),u=Object(r.a)(c,2),l=u[0],f=u[1],h=Object(a.useState)(t.get()),d=Object(r.a)(h,2),p=d[0],v=d[1],m=Object(a.useCallback)(function(e,n){var r=Object(o.a)(p);r[e]=n,t.set(r),v(r)},[v,p]),y=(Object(o.a)(p),p.length);y<9;y++)p.push(void 0);var b=i.a.createElement("img",{className:"routes-icon pushable",onClick:function(){return s(!n)},src:"/zpad-light.svg"});return n?i.a.createElement("div",{className:"routes-wrapper showing"},b,i.a.createElement("div",{className:"routes-editor"},i.a.createElement("div",{onClick:function(){return s(!1)},className:"close-btn"},"x"),i.a.createElement(Qn,{mode:l,setMode:f}),i.a.createElement("div",{className:"grid"},p.map(function(e,t){return i.a.createElement(Al,{currentType:l,value:e,onChange:function(e){return m(t,e)}})})))):i.a.createElement("div",{className:"routes-wrapper"},b)}),Rl=(n(1931),Object(s.b)(function(e,t){return{value:t.parameter.get()}},function(e){return{}})(function(e){var t=e.parameter,n=e.value,s=e.show,c=e.setShow,u=Object(a.useState)(n),l=Object(r.a)(u,2),f=l[0],h=l[1];Object(a.useEffect)(function(){h(n)},[n,h]);Object(a.useCallback)(function(e){var n=f.filter(function(t){return t!==e});t.set(n),h(n)},[f,h]);var d=Object(a.useCallback)(function(e){var n=[].concat(Object(o.a)(f),[e]);f.some(function(t){return t.type===e.type})&&(n=f.filter(function(t){return t.type!==e.type})),t.set(n),h(n)},[f,h]),p="rules-to-ignore";return s&&(p+=" show"),i.a.createElement("div",{className:p},s&&i.a.createElement("div",{className:"rules-dropdown"},i.a.createElement("div",{onClick:function(){return c(!1)},className:"close-btn"},"x"),Vn.l.map(function(e){return i.a.createElement("div",{onClick:function(){return d(e)},className:f.some(function(t){return t.type===e.type})?"rule-option selected":"rule-option"},e.type)})),i.a.createElement("div",{onClick:function(){return c(!s)},className:"toggle-btn dot"},"+"))}),n(582)),Cl=Object(s.b)(function(e,t){return{}},function(e){return{setPullablePartDragging:function(t){return e(Object(c.cd)(t))}}})(function(e){var t=Object(a.useCallback)(function(t){var n=e.effect,r=e.instrument,a={instrument:r,effect:n,id:e.id||(r||n).id,type:e.type};r&&r.track?a.track=r.track:n&&(a.track=n.track),e.setPullablePartDragging(a)},[]);return i.a.createElement("div",Object.assign({onMouseDown:function(t){e.isDraggable&&t.stopPropagation()},draggable:e.isDraggable?"true":"false",onDragStart:t,onDragOver:function(e){e.preventDefault()},className:e.className},e),e.skipDiv?e.children:i.a.createElement("div",null,e.children))}),Nl=Object(s.b)(function(e,t){return{value:t.parameter.get()}},function(e){return{}})(function(e){var t=e.parameter,n=e.value,r=new Array(5).fill(0).map(function(e,t){return{label:t+1,value:t}}).slice(1),s=Object(a.useCallback)(function(e){var n=e.value;console.log("setting value=",n),t.set(null===n?0:n),console.log("Parameter=",t)},[t]),c=r.find(function(e){return e.value===n});return r=[{label:"None",value:null}].concat(Object(o.a)(r)),i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},className:"track-shift track-rules"},i.a.createElement(or.a,{placeholder:"",options:r,value:c,onChange:s}))}),Il=Object(s.b)(function(e,t){var n=t.effect.getConnectedTidal(t.number-1);return{currentHand:n&&n.lastLeafStep&&n.lastLeafStep.hand}},function(e){return{}})(function(e){var t=e.currentHand;return i.a.createElement("div",{className:t?"hand-indicator left":"hand-indicator right"})}),ql=Object(s.b)(function(e,t){var n=t.effect["hand"+t.number+"Parameter"];if(!n)return{};var r={hand:n.get()};if(!t.effect.cachedTidal)return r;var a=t.effect.cachedTidal[t.number-1];if(!a)return r;var i=a.firstAccent-t.sequencerEngine.trackStep%8===0;return r.isPulse=i,r},null)(function(e){var t=e.hand,n=(e.track,e.number),r=e.effect,o=e.isPulse;t=Math.round(t);var s=r["hand"+n+"Parameter"],c=Object(a.useCallback)(function(){t===er.c?s.set(er.d):t===er.a?s.set(er.e):t===er.e?s.set(er.a):t===er.d&&s.set(er.c)},[t]),u=Object(a.useCallback)(function(){t===er.e?s.set(er.d):t===er.a?s.set(er.c):t===er.c?s.set(er.a):t===er.d&&s.set(er.e)},[t]),l=t===er.a||t===er.c?"left-circle toggled":"left-circle",f=t===er.a||t===er.e?"right-circle toggled":"right-circle";return i.a.createElement("div",{className:o?"drum-circle pulse":"drum-circle"},i.a.createElement(Il,{effect:r,number:n}),i.a.createElement("div",{onClick:c,className:l}),i.a.createElement("div",{className:"drum-divider"}),i.a.createElement("div",{onClick:u,className:f}))}),_l=(n(1932),function(e){var t=e.param,n=e.jakiParams,r=e.name,a=e.track,o=e.setRoutesToShow,s=e.effect,c=e.routesToShow;if(!t.show)return i.a.createElement("div",{className:"empty"});var u=n[t.name+a+"Parameter"];return"Rules"===r?i.a.createElement(Nl,{effect:s,parameter:u}):"Routes"===r?i.a.createElement(Ml,{setShow:function(e){return o(e?a:void 0)},show:a===c,parameter:n["routes"+a+"Parameter"]}):t.isCheckbox?i.a.createElement("div",{className:"check-wrapper"},i.a.createElement(Qs,{parameter:u})):i.a.createElement(en.a,{width:50,root:t.root,needsRound:void 0===t.needsRound||t.needsRound,parameter:u,min:u.min,max:u.max})}),Dl=Object(s.b)(function(e,t){var n=t.effect.jakiParams,r=n.jaki&&n.jaki.track.sequencerEngine;return{selectedTrack:r&&r.getSelectedTrack(),numTidals:n.jaki?n.numberInstances:1,minimized:n.zObject&&n.zObject.attributes.minimized}},function(e){return{}})(function(e){e.isDraggable;var t=e.effect,n=(e.jakiParams,e.selectedTrack),o=e.minimized,s=e.setChosen,c=e.chosen,u=e.sequencerEngine,l=void 0===u?t.track.sequencerEngine:u,f=e.numTidals,h=Object(a.useState)(f),d=Object(r.a)(h,2),p=d[0],v=d[1],m=Object(a.useState)(void 0),y=Object(r.a)(m,2),b=(y[0],y[1],Object(a.useState)(void 0)),g=Object(r.a)(b,2),O=g[0],j=g[1],k=n&&n.pad&&n.pad.slots.indexOf(n),w=Object(a.useState)({Rules:{name:"rule",show:!0},Shift:{name:"shift",show:!0},Truncate:{name:"truncate",show:!0},Nudge:{name:"nudge",show:!0,root:1},DynamicsRate:{name:"dampRate",show:!0},DynamicsAmount:{name:"dampAmount",show:!0},HalfRate:{name:"halveningRate",show:!0},Halvening:{name:"halveningDepth",needsRound:!1,show:!0},HalfFill:{name:"halveningFill",show:!0,isCheckbox:!0},PulseSrc:{name:"pulseSource",show:!0,isCheckbox:!0},PulseDest:{name:"pulseDest",show:!0,isCheckbox:!0},Routes:{name:"routes",show:!0}}),x=Object(r.a)(w,2),S=x[0],P=x[1];Object(a.useEffect)(function(){v(t.jakiParams.numberInstances)},[f,v]);var E=new Array(p).fill(0).map(function(e,t){return t+1}),T=Object(a.useCallback)(function(){var e=t.jakiParams;e.jaki&&(e.jaki.addSlot(),v(p+1))},[t,v,p]),A=Object(a.useState)([1,1,1,!1,!1,!1,!0,!0,!1,!1,!1,!0,!0,!0]),M=Object(r.a)(A,2),R=(M[0],M[1],Object(a.useCallback)(function(e){S[e].show=!S[e].show,P(Object(ot.a)({},S))},[P,S]));return t.jakiParams?i.a.createElement(Cl,{isDr:!0,effect:t,skipDiv:!0,instrument:t.jakiParams,type:Rl.a,className:"drum-router"},!o&&i.a.createElement("div",{className:"track-col labeler"},i.a.createElement("div",{className:"empty-thumb"}),i.a.createElement("div",{className:"track-btn"}),i.a.createElement("div",{className:"track-pattern"},"1"),Object.keys(S).map(function(e){return i.a.createElement("div",{className:S[e].show?"track-shift":"track-shift hide",onClick:function(){return R(e)}},e)})),E.map(function(e,n){return i.a.createElement("div",{className:k===n?"track-col selected":"track-col"},!o&&i.a.createElement("div",{className:"delete-btn",onClick:function(){return t.jakiParams.deleteSlot(n)}},"x"),l.tracks[e-1]?i.a.createElement(go,{onClickThumbnail:function(t){t.stopPropagation(),s&&s({type:"TRACK",track:e})},track:l.tracks[e-1]}):i.a.createElement("div",{className:"empty-thumb"}),i.a.createElement("div",{onClick:function(t){t.stopPropagation(),s&&s({type:"TRACK",track:e})},className:c&&c.track===e?"track-btn selected":"track-btn"},e),i.a.createElement(ql,{sequencerEngine:l,number:e,jaki:t,effect:t.jakiParams}),o&&i.a.createElement(Tl,{param:t.jakiParams[S.Halvening.name+e+"Parameter"]}),!o&&Object.keys(S).map(function(n){return i.a.createElement(_l,{setRoutesToShow:j,effect:t,routesToShow:O,track:e,name:n,jakiParams:t.jakiParams,param:S[n]})}))}),!o&&i.a.createElement("div",{onClick:T,className:"add-btn pushable"},"+")):""}),Fl=Object(s.b)(function(e,t){return{tooltip:e.zobject.tooltip[t.subSequence.id]}},function(e){return{}})(function(e){var t=e.tooltip;e.subSequence;return t?i.a.createElement("div",{style:{left:t.position.x,top:t.position.y},className:"zobject-tooltip"},i.a.createElement("div",{className:"dot"}),t.text,t.type&&i.a.createElement("div",{className:"types"},Array.isArray(t.type)?t.type.map(function(e){return i.a.createElement("span",{className:e===t.selectedType?"selected type":"type"},e)}):i.a.createElement("span",{className:t.type===t.selectedType?"selected type":"type"},t.type))):""}),Ll=n(591),Bl=n(972),zl=n(222);n(1933);function Jl(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Vl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vl(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Vl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Hl=Xi.a.presets,Ul=function(e){var t=e.name,n=e.setData,r=e.dep,a=e.source,o=Object.keys(r);return i.a.createElement("div",{className:"deps"},i.a.createElement("div",{className:"deps-type"},t),o.map(function(e){return i.a.createElement("div",{className:"sub-deps"},i.a.createElement("div",{className:"dep-type"},e),r[e].map(function(e){return i.a.createElement(Gl,{source:a,setData:n,dep:e})}))}))},Gl=function(e){e.setData;var t=e.dep,n=e.source,o=t.existingNode,s=t.name,c=t.type;n=n&&n.name;var u=Object(a.useState)(!o||"subpatch"!==n&&"pad"!==s?o?Ll.c:Ll.b:Ll.a),l=Object(r.a)(u,2),f=l[0],h=l[1];return"subpatch"===s?"":(Object(a.useEffect)(function(){t.action=f},[f]),i.a.createElement("div",{className:"dep"},i.a.createElement("div",{className:"obj-name"},s,".",c),o?i.a.createElement("div",{className:"actions"},i.a.createElement("div",{className:"action",onClick:function(){return h(Ll.b)}},"Create New",i.a.createElement("div",{className:f===Ll.b?"checkbox checked":"checkbox"})),i.a.createElement("div",{onClick:function(){return h(Ll.c)},className:"action"},"Replace existing",i.a.createElement("div",{className:f===Ll.c?"checkbox checked":"checkbox"})),i.a.createElement("div",{onClick:function(){return h(Ll.a)},className:"action"},"Connect to existing",i.a.createElement("div",{className:f===Ll.a?"checkbox checked":"checkbox"}))):i.a.createElement("div",{className:"actions"},i.a.createElement("div",{className:"default action"},"Create New",i.a.createElement("div",{className:f===Ll.b?"checkbox checked":"checkbox"})))))},Wl=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.preset,n=e.zobject,o=e.hide,s=e.setResolvedDependencies,c=Object(a.useState)(),u=Object(r.a)(c,2),l=u[0],f=u[1];Object(a.useEffect)(function(){var e=new zl.a(t.title,t.contentHash,t.user,t.blockNumber);Hl.getPresetData(e).then(function(e){var n=e.inbound,r=e.outbound,a={preset:t,inbound:n,outbound:r},i=!1;if(n||r){for(var o in n){var c=h(n[o]);i=i||c}for(var u in r){var l=h(r[u]);i=i||l}}i||s(a),f(a)})},[]);var h=Object(a.useCallback)(function(e){var t=!1;console.log("process deps called=",e);var r,a=Jl(e);try{for(a.s();!(r=a.n()).done;){var i=r.value,o=i.node,s=i.name;"zobject"===o&&(console.log("processing=",o,s),i.existingNode=Object(Ll.f)(n.subSequence,o,s),console.log("found existing?",i.existingNode),i.existingNode&&(t=!0))}}catch(c){a.e(c)}finally{a.f()}return t},[]);return l?i.a.createElement("div",null,i.a.createElement(Bl.a,{dialogClassName:"preset-modal",show:!0,onHide:o},i.a.createElement(Bl.a.Header,{closeButton:!0},i.a.createElement(Bl.a.Title,null,"Dependencies")),i.a.createElement(Bl.a.Body,null,i.a.createElement(Ul,{source:n,name:"Inbound",setData:f,dep:l.inbound}),i.a.createElement(Ul,{source:n,name:"Outbound",setData:f,dep:l.outbound})),i.a.createElement(Bl.a.Footer,null,i.a.createElement(Hr.a,{variant:"secondary",onClick:function(){return s(l)}},"Done"),i.a.createElement(Hr.a,{variant:"primary",onClick:o},"Cancel")))):""}),Kl=(n(1934),Object(s.b)(function(e,t){var n=e.zobject.contextMenu[t.subSequence.id];return{isLocked:n&&e.spatial.lockedObjects[n.zobject.id],contextMenu:n}},function(e,t){return Object(T.a)({clear:function(t){return e(Object(c.cf)(t))},setViewableSubPatches:function(t){return e(Object(c.We)(t))},setSelectedPulledElements:function(t){return e(Object(c.Ad)(t))},setSelectedZObject:function(t){return e(Object(c.Ed)(t))},setFullScreenZObject:function(t){return e(Object(c.Gb)(t))},setZObjectInputText:function(t){return e(Object(c.ff)(t))},setLocked:function(t,n){return e(Object(c.Pe)(t,n))},setPluginToSave:function(t){return e(Object(c.Wc)(t))},setZObjectBackground:function(t){return e(Object(c.bf)(t))},setZObjectsStack:function(t){return e(Object(c.mf)(t))}},"setSelectedPulledElements",function(t){return e(Object(c.Ad)(t))})})(function(e){e.setZObjectsStack,e.setZObjectBackground;var t=e.setPluginToSave,n=(e.setUXLockObject,e.setZObjectInputText,e.setFullScreenZObject),s=(e.setSelectedPulledElements,e.setSelectedZObject),u=e.contextMenu,l=e.setLocked,f=e.isLocked,h=e.setViewableSubPatches,d=e.clear,p=Object(a.useState)(),v=Object(r.a)(p,2),m=v[0],y=v[1],b=Object(a.useState)([{title:"yo"}]),g=Object(r.a)(b,2),O=g[0],j=g[1],k=Object(a.useState)(void 0),w=Object(r.a)(k,2),x=w[0],S=w[1],P=Object(a.useState)(void 0),E=Object(r.a)(P,2),T=E[0],A=E[1];Object(a.useEffect)(function(){if(u){var e="zobject."+u.zobject.name;Object(Qe.b)(void 0,e).then(function(e){j(e.slice(0,20))})}},[u,j]);var M=Object(a.useCallback)(function(e,t){if(u){var n=u.zobject;A(t),y(n)}},[u,A,y]),R=u||{},C=R.zobject,N=R.position;Object(a.useEffect)(function(){x&&(console.log("resolved dependencies =",x),m.loadPreset(x.preset,x),S(!1),A(!1))},[C,x,A,m]),Object(a.useEffect)(function(){u&&s(u.zobject)},[u]);(function(e){var t=e.zobject,n=e.setDropdownPos;return{mintToHic:Object(a.useCallback)(function(){var e=Object(K.a)(W.a.mark(function e(r){var a,i,s,u;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.stopPropagation(),n(void 0),(a=t.sequencerEngine).dispatch(Object(c.Qb)(!0)),e.next=6,a.save("export","PUBLIC",!1,void 0,t);case 6:i=e.sent,s=Object(Ve.d)(a),u={projectId:i,ipfsHashes:[i].concat(Object(o.a)(s))},fetch("/exportZip/",{method:"POST",body:JSON.stringify(u),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){a.dispatch(Object(c.Qb)(!1)),a.dispatch(Object(c.Jb)(e))}).catch(function(e){console.log(e)});case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[t,n])}})({zobject:C,setDropdownPos:d}).mintToHic;var I=Object(He.a)({zobject:C,setDropdownPos:d}).mintToZora,q=Object(a.useCallback)(function(){C.duplicate(),d()},[]),_=Object(a.useCallback)(function(){l(C.id,!f)},[C,f]),D=Object(a.useCallback)(function(){var e=C;C.pluginViewerFor&&(e=C.pluginViewerFor);var t=e.sequencerEngine.state.zobject.viewableSubPatches;if(e.subSequence&&e.subSequence.zObject){e.effect.width=e.subSequence.width,e.effect.height=e.subSequence.height;var n=C.sequencerEngine.state.windows.windowPositions[C.subSequence.id];C.sequencerEngine.dispatch(Object(c.Ze)(e.effect.id,n))}h([].concat(Object(o.a)(t),[e.effect]))},[C]),F=Object(a.useCallback)(function(){C.effect&&C.effect.disconnectFromGraph(),C.disconnectFromGraph()},[C]),L=Object(a.useCallback)(function(){var e,t=[];C.effect&&(t=C.effect.nameInlets(),e=C.effect.attributes["scripting name"]),t=C.nameInlets(),e=C.attributes["scripting name"];var n=C.windowPosition;C.subSequence.encapsulateObjects(n.x,n.y,t,e)},[C]),B=Object(a.useCallback)(function(){var e=!0===C.attributes["Include in Presentation"];C.setAttribute("Include in Presentation",!e)},[C]),z=Object(a.useCallback)(function(){n(C),s(void 0),d()},[C]),J=Object(a.useCallback)(function(){C.delete()},[C]),V=(Object(a.useCallback)(function(){t(C)},[C]),Object(a.useCallback)(function(){t(C.pluginViewerFor||C.plugin)},[C]),Object(a.useCallback)(function(){s(C),Be(C)},[C]));return u?[T&&i.a.createElement(Wl,{hide:function(){return A(void 0)},zobject:C,preset:T,setResolvedDependencies:S}),i.a.createElement(Ge,{className:"zobject-context-menu",dropdownPos:N,setDropdownPos:d},i.a.createElement(We,{onMouseDown:z},"Fullscreen",i.a.createElement("div",{className:"key-shortcut"},i.a.createElement("img",{src:"/expand-icon.svg"}))),i.a.createElement(We,{onMouseDown:B},C.attributes["Include in Presentation"]?"Remove from Presentation":"Include in Presentation"," ",i.a.createElement("div",{className:"key-shortcut"},i.a.createElement("img",{src:"/presentation-mode.svg"}))),("subpatch"===C.name||C.pluginViewerFor)&&i.a.createElement(We,{onMouseDown:D},"Open Subpatch Editor"),i.a.createElement(We,{onMouseDown:q},"Duplicate ",i.a.createElement("div",{className:"key-shortcut"},"\u2318D")),i.a.createElement(We,{onMouseDown:_},f?"Unlock":"Lock"),i.a.createElement("div",{className:"divider"}),i.a.createElement(We,{onMouseDown:F},"Disconnect from Graph"),C.attributes["scripting name"]&&i.a.createElement(We,{onMouseDown:L},"Encapsulate Inlets"),i.a.createElement(We,{onMouseDown:V},"Save as Preset"),i.a.createElement(Ke,{name:"Presets"},O.map(function(e){return i.a.createElement(We,{onMouseDown:function(t){return M(t,e)}},e.title)})),C.getObjectType()===te.e&&i.a.createElement(We,{onMouseDown:I},"Export as NFT"),i.a.createElement(We,{onMouseDown:J},"Delete"),i.a.createElement("div",{className:"divider"}),C.actions&&Object.keys(C.actions).map(function(e){return i.a.createElement(We,{onMouseDown:function(){C.executeAction(e),d()}},e)}))]:T&&i.a.createElement(Wl,{hide:function(){return A(void 0)},zobject:C,preset:T,setResolvedDependencies:S})})),Ql=n(603);function Zl(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Yl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Yl(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Yl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var $l=function(e){return Object.keys(e).map(function(t){return[t,e[t].x,e[t].y]})},Xl=function(e){return $l(e).sort(function(e,t){return e[1]-t[1]})},ef=function(e){return $l(e).sort(function(e,t){return e[2]-t[2]})},tf=function(e){var t=e.scrollRef,n=e.sequencerEngine,i=e.context,s=xt({containerRef:t}).getXY,u=Object(a.useRef)(),l=Object(a.useCallback)(function(e,t){var r=s(e),a=r.x,i=r.y,o=n.state.spatial.editorPadding;return t.zObject||(a-=Math.max(0,o.x),i-=Math.max(0,o.y)),{x:a,y:i}},[n]);Object(a.useEffect)(function(){return window.addEventListener("keydown",h),window.addEventListener("keyup",f),function(){window.removeEventListener("keydown",h),window.removeEventListener("keyup",f)}},[n,i,h,f]);var f=Object(a.useCallback)(function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)e.key,n.state.zobject.fullScreenZObject},[n,i]),h=Object(a.useCallback)(function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){n.state.zobject.fullScreenZObject;var t=e.key;if("Tab"!==t||e.shiftKey)if("e"===t&&(e.ctrlKey||e.metaKey)){if(d()!==i)return;n.dispatch(Object(c.Pd)(n.state.spatial.showEditorBottom===uo.a?void 0:uo.a))}else{if(n.state.spatial.showPadSequencer)return;if("N"===t){if(d()!==i)return;var a=l(u.current,d()),s=a.x,f=a.y;d().createZObject(s,f)}else if("C"===t){if(d()!==i)return;var h=l(u.current,d()),p=h.x,v=h.y;d().createZObject(p,v,"comment")}else if("O"===t){if(d()!==i)return;var m=l(u.current,d()),y=m.x,b=m.y;d().createZMessage(y,b,bt.a)}else if("M"===t){if(d()!==i)return;var g=l(u.current,d()),O=g.x,j=g.y;d().createZMessage(O,j)}else if("P"===t){var k=d();if(!k||k!==i)return;n.state.spatial.showPadSequencer||(k.presentationMode=!k.presentationMode)}else if("H"===t)!function(e){var t=e.state.windows.selectedElements,n=Object.keys(t),r=n[0]&&e.idToObject[n[0]].presentationMode,a=Object(Ql.b)(e),i=Math.min.apply(Math,Object(o.a)(Object.values(a).map(function(e){return e.y})));for(var s in t)a[s].y=i;Object(X.a)(Object($.p)(a,r))}(n);else if("U"===t)!function(e){var t=e.state.zobject.selectedZObject;t&&t.setupUniform&&(t.setAttribute("glsl uniform",!0),e.dispatch(Object(c.Ed)(void 0)),e.dispatch(Object(c.Ed)(t)))}(n);else if("V"===t)!function(e){var t=e.state.windows.selectedElements,n=Object.keys(t),r=n[0]&&e.idToObject[n[0]].presentationMode,a=Object(Ql.b)(e),i=Math.min.apply(Math,Object(o.a)(Object.values(a).map(function(e){return e.x})));for(var s in t)a[s].x=i;Object(X.a)(Object($.p)(a,r))}(n);else if("D"===t)!function(e){e.state.windows.selectedElements;var t=Object(Ql.b)(e),n=Object.keys(t),a=Object(Ql.a)(t),i=a.x,o=a.y,s=i.max-i.min,c=o.max-o.min;if(s>c){var u,l=s/(n.length-1),f=0,h=Zl(Xl(t));try{for(h.s();!(u=h.n()).done;){var d=u.value,p=Object(r.a)(d,3),v=p[0],m=(p[1],p[2]);t[v]={x:i.min+f*l,y:m},f++}}catch(P){h.e(P)}finally{h.f()}}else{var y,b=c/(n.length-1),g=0,O=Zl(ef(t));try{for(O.s();!(y=O.n()).done;){var j=y.value,k=Object(r.a)(j,3),w=k[0],x=k[1];k[2],t[w]={x:x,y:o.min+g*b},g++}}catch(P){O.e(P)}finally{O.f()}}if(n.length>0){var S=e.idToObject[n[0]].presentationMode;Object(X.a)(Object($.p)(t,S))}}(n);else if("F"===t){if(d()!==i)return;var w=l(u.current,d()),x=w.x,S=w.y;d().createZMessage(x,S,bt.c).max=1}else if("I"===t){if(d()!==i)return;var P=l(u.current,d()),E=P.x,T=P.y;d().createZMessage(E,T,bt.c).round=!0}else"Escape"===e.key&&(e.preventDefault(),n.dispatch(Object(c.We)([])),n.dispatch(Object(c.Xe)([])))}else{if(d()!==i)return;if(n.state.instruments.showFormantEffect)return;if(n.dispatch(Object(c.ed)("")),n.state.spatial.showTrackInstrument||n.state.sequencer.showLFOs||n.state.sequencer.showEnvelopes)return n.dispatch(Object(c.Td)(!1)),n.dispatch(Object(c.Qd)(!1)),void n.dispatch(Object(c.ce)(!1));n.getSelectedTrack()&&n.selectTrack(n.getSelectedTrack().trackNumber),n.dispatch(Object(c.ce)(!n.state.spatial.showTrackInstrument))}}},[n,i]),d=Object(a.useCallback)(function(){var e=n.state.zobject.viewableSubPatches;return e[e.length-1]||n.currentSubSequence},[n]);return{onMouseMove:function(e){u.current?(u.current.clientX=e.clientX,u.current.clientY=e.clientY):u.current={clientX:e.clientX,clientY:e.clientY}}}},nf=Object(s.b)(function(e,t){return{fill:t.subpatch.zObject.attributes["primary-color"]}},function(e){return{}})(function(e){var t=e.subpatch,n=e.fill,o=Object(a.useRef)(void 0),s=Object(a.useState)(!1),c=Object(r.a)(s,2),u=c[0],l=c[1],f=xt({containerRef:o}).getXY,h=t.zObject,d=Object(a.useState)(h.width>0?{width:h.width,height:h.height}:{width:300,height:200}),p=Object(r.a)(d,2),v=p[0],m=p[1];Object(a.useEffect)(function(){return window.addEventListener("mousemove",b),window.addEventListener("mouseup",y),function(){window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",y)}},[m,u,l]);var y=Object(a.useCallback)(function(){u&&l(!1)},[l,u]),b=Object(a.useCallback)(function(e){if(!u)return!1;var n=f(e),r=n.x,a=n.y;t.zObject.width=r,t.zObject.height=a,m({width:r,height:a})},[m,u]),g=Object(ot.a)({},v);return n&&(g.backgroundColor=n),i.a.createElement("div",{ref:o,style:g,className:"sub-patch-size"},i.a.createElement("div",{onMouseDown:function(e){l(!0)},className:"right-bottom-corner"}))}),rf=function(e){var t=e.ref,n=e.subSequence,r=e.setSelection,i=function(e){var t=Object(a.useCallback)(function(t,n){var r=e.createSequencer();r.x=t,r.y=n},[e]),n=Object(a.useCallback)(function(t,n,r){e.createZObject(t,n,r)},[e]),r=Object(a.useCallback)(function(t,n){e.createZMessage(t,n)},[e]),i=Object(a.useCallback)(function(t,n){e.createZMessage(t,n,bt.c)},[e]),o=Object(a.useCallback)(function(t,n){e.createZObject(t,n,"toggle")},[e]),s=Object(a.useCallback)(function(t,n){e.createZMessage(t,n,bt.a)},[e]);return{createPad:Object(a.useCallback)(function(t,n){var r=e.createPad();r.x=t,r.y=n,console.log("create pad=",t,n)},[e]),createSequencer:t,createButton:s,createToggle:o,createZNumber:i,createZMessage:r,createZObject:n}}(n),o=i.createPad,s=i.createSequencer,u=i.createButton,l=i.createZNumber,f=i.createZMessage,h=i.createToggle,d=i.createZObject,p=xt({containerRef:t}).getXY;return{onDrop:Object(a.useCallback)(function(e){var t=p(e),a=t.x,i=t.y,v=n.sequencerEngine,m=v.state.zobject,y=m.objectDragging,b=m.zobjectTypeDragging;if(y)n.moveObjectInto(y,a,i);else if(b){switch(b){case"zobject":d(a,i);break;case"zmessage":f(a,i);break;case"zpad":o(a,i);break;case"zbutton":u(a,i);break;case"ztoggle":h(a,i);break;case"znumber":l(a,i);break;case"sequencer":s(a,i);break;case"zcomment":d(a,i,"comment")}v.dispatch(Object(c.kf)(void 0)),r(void 0)}},[n])}},af=Object(s.b)(function(e,t){return{}},function(e){return{setMovingPadEdge:function(t){return e(Object(c.qc)(t))}}})(function(e){var t=e.pathPoints,n=e.setMovingPadEdge,r=e.edge,o=e.isHorizontal,s=t.slice(0,2);s[1]+=10;var c=t.slice(t.length-2,t.length);c[o?0:1]-=10;var u=Object(a.useCallback)(function(e,a){e.stopPropagation();var i="START"===a?t.slice(t.length-2):t.slice(0,2),o={x1:i[0],y1:i[1],x2:e.clientX,y2:e.clientY};n("START"===a?Object(ot.a)({edge:r},o,{destType:r.destType,destId:r.destId}):Object(ot.a)({edge:r},o,{sourceType:r.sourceType,sourceId:r.sourceId}))},[r]);return i.a.createElement("g",null,i.a.createElement("circle",{onMouseDown:function(e){return u(e,"START")},className:"edge-helper",cx:s[0],cy:s[1],r:5,fill:"white"}),i.a.createElement("circle",{onMouseDown:function(e){return u(e,"END")},className:"edge-helper",cx:c[0],cy:c[1],r:5,fill:"white"}))}),of=function(e,t,n,r,a){var i=40;return r<t&&(i=80),a?[e,t,e,t+i,n-40,r,n,r]:[e,t,e,t+i,n,r-40,n,r]},sf=function(e){for(var t=e.markerEnd,n=void 0===t?"url(#arrowhead)":t,r=e.points,a=e.onMouseOver,o=e.onMouseDown,s=e.className,c=void 0===s?"":s,u=e.onMouseLeave,l=(e.fill,e.opacity),f=(e.stroke,e.strokeWidth),h=(e.segmentation,function(e){return Math.floor(e)}),d="M "+h(r[0])+" "+h(r[1]),p="",v=2;v<r.length-1;v+=2)p+=h(r[v])+" "+h(r[v+1])+" ";var m=d+" C "+p;return i.a.createElement("path",{className:c,onMouseDown:o,onMouseOver:a,onMouseLeave:u,d:m,strokeWidth:f,opacity:l,markerEnd:n})},cf=(n(1935),Object(s.b)(function(e,t){if(!t.outlet)return{};var n=t.subSequence.sequencerEngine.idToObject,r=t.outlet.sourceWindowId,a=t.outlet.destWindowId,i=t.outlet.sourceId,o=t.outlet.destId,s=e.pads,c=s.movingEdge,u=(s.drawingEdge,s.selectedEdge),l=t.edge,f=n[r],h=n[a];return{fromWidth:f.width,toWidth:h.width,fromHeight:f.height,toHeight:h.height,isSourceCollapsed:e.effects.effectCollapsed[r],isDestCollapsed:e.effects.effectCollapsed[a],isSelected:u&&u.outlet===t.outlet&&u.inlet===t.inlet,isMoving:c&&c.edge.id===l.id,fromPosition:e.windows.windowPositions[r]||e.windows.windowPositions[i],toPosition:e.windows.windowPositions[a]||e.windows.windowPositions[o],segmentation:e.spatial.cableSegmentations[t.edge.id],edgesPadding:e.spatial.edgesPadding,presentationMode:e.spatial.presentationMode,movingEdge:c}},function(e){return{setSelectedPadEdge:function(t){return e(Object(c.wd)(t))},setSelectedSteps:function(t){return e(Object(c.yd)(t))},setCableSegmentation:function(t,n){return e(Object(c.P)(t,n))},setAdjustingSegmentation:function(t){return e(Object(c.q)(t))}}})(function(e){var t=e.subSequence,n=(e.setCableSegmentation,e.inlet),s=e.outlet,c=e.edge,u=e.fromWidth,l=e.toWidth,h=e.isMoving,d=(e.drawingEdge,e.edgesPadding),p=e.containerRef,v=(e.selection,e.isSelected),m=e.setSelectedPadEdge,y=e.setSelectedSteps,b=e.fromPosition,g=e.toPosition,O=e.isSourceCollapsed,j=e.isDestCollapsed,k=e.segmentation,w=e.edgesRef,x=e.fromHeight,S=e.setAdjustingSegmentation,P=e.toHeight,E=e.presentationMode,T=Object(a.useState)([]),A=Object(r.a)(T,2),M=A[0],R=A[1],C=Object(a.useState)(!1),N=Object(r.a)(C,2),I=N[0],q=N[1],_=Object(a.useRef)(void 0),D=Object(a.useRef)(void 0),F=Object(a.useState)(!1),L=Object(r.a)(F,2),B=L[0],z=L[1];Object(a.useEffect)(function(){if(s){var e=s.sourceEl;B?Object(f.e)(e,J):(Object(f.g)(e,J),q(void 0))}},[s,B,q]);var J=Object(a.useCallback)(function(e){if(s){var t=s.sourceType;try{t+="."+JSON.stringify(e)}catch(n){}q(t)}},[J,q]);Object(a.useEffect)(function(){V()},[R,u,l,x,P,n,s,b,g,O,j,d]);var V=Object(a.useCallback)(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(s&&p.current)if(_.current||(_.current=document.getElementById(s.destEl)),D.current||(D.current=document.getElementById(s.sourceEl)),!_.current||!D.current||_.current&&!_.current.isConnected||D.current&&!D.current.isConnected)R([]);else{var n=D.current.getBoundingClientRect(),r=_.current.getBoundingClientRect(),a=w.current.getBoundingClientRect(),i=a.top,o=a.left,u=[n.left-o,n.top-i,r.left-o,r.top-i],l=t.sequencerEngine.idToObject[c.destId];l&&l.hasInletFields&&(u[2]-=6),1!==window._scale&&(u=u.map(function(e){return e/(window._scale||1)})),0!==u.length||e?R(u):setTimeout(function(){V(!0)},160)}},[R,n,s,b,g,O,j]);if(Object(a.useEffect)(function(){setTimeout(function(){V()},300)},[R,E,n,s]),0===M.length)return[];var H=Object(r.a)(M,4),U=H[0],G=H[1],W=H[2],K=H[3],Q="pad-effect-edge message-edge ";v&&(Q+=" selected");var Z=(U+W)/2,Y=(G+K)/2,$=t.sequencerEngine.idToObject[c.destId],X=$&&$.hasInletFields,ee=t.tracks?d.y:0,te=k&&!0!==k?function(e,t,n,r,a,i){var o=.9*e+.1*n,s=.1*e+.9*n,c=i?n-15:n;e<n?Math.abs(n-e)>50&&(o=e+15,s=c-15):e>c&&Math.abs(n-e)>30&&(o=e-15,s=c+15);var u=[s,a,c,a,c,a,c,r];return i&&(u=[s,a,n,a,s,r,n,r]),[[e,t,e,a,e,a,o,a],[o,a,.5*e+.5*c,a,.5*e+.5*c,a,s,a],u]}(U+5,G,W+5,K,k-ee,X):function(e,t,n,r,a){var i=Math.abs(r-t),o=Math.max(20,Math.min(40,i)),s=Math.max(20,Math.min(40,i));r<t&&(o=40);var c=Math.abs(n-e),u=Math.max(5,Math.min(20,c)),l=Math.max(5,Math.min(20,c)),f=n-e<0?1:-1;return a?[e,t,e,t+o,n-s,r,n,r]:[e,t,e+-f*u,t+o,n+f*l,r-s,n,r]}(U+5,G+6,W+5,K,X);if(h)return[];var ne="message-edge-group";return v&&(ne+=" selected"),i.a.createElement("g",{className:ne},k?i.a.createElement("g",{className:"segmented-group"},te.map(function(e,t){return i.a.createElement(sf,{markerEnd:"",onMouseOver:function(){return z(!0)},onMouseLeave:function(){return z(!1)},segmentation:k,onMouseDown:function(e){e.stopPropagation(),1===t?(S(c),m({id:c.id,inlet:n,outlet:s})):(m({id:c.id,inlet:n,outlet:s}),y([]))},className:1===t?Q+" adjustable ":Q,points:e})})," "):i.a.createElement(sf,{markerEnd:"",onMouseOver:function(){return z(!0)},onMouseLeave:function(){return z(!1)},segmentation:k,onMouseDown:function(e){e.stopPropagation(),m({id:c.id,inlet:n,outlet:s}),y([])},className:Q,points:te}),v&&i.a.createElement(af,{isHorizontal:X,edge:c,pathPoints:k?[].concat(Object(o.a)(te[0].slice(0,2)),Object(o.a)(te[2].slice(6,8))):te}),I&&i.a.createElement("g",null,i.a.createElement("rect",{fill:"black",x:Z,y:Y,height:20,width:2+I.length+"ch"}),i.a.createElement("text",{fill:"white",x:Z+5,y:Y+12,fontSize:"8pt"},I)))})),uf=Object(s.b)(function(e,t){var n=e.pads.selectedEdge;return{presentationMode:t.subSequence.presentationMode,selectedEdge:n,inletConnections:e.windows.inletConnections[t.subSequence.id]}},function(e){return{}})(function(e){var t=e.selectedEdge,n=e.presentationMode,r=e.edgesRef,o=e.subSequence,s=e.inletConnections,c=e.containerRef,u=e.selection,l=Object(a.useRef)(!1);Object(a.useEffect)(function(){return window.addEventListener("mousedown",f),window.addEventListener("mouseup",h),function(){window.removeEventListener("mousedown",f),window.removeEventListener("mouseup",h)}},[]);var f=function(){return l.current=!0},h=function(){return l.current=!1};if(!s||n)return[];var d=Object.keys(s).map(function(e){return s[e].filter(function(n){return!t||t.outlet!==n||t.inlet!==e}).flatMap(function(t){return i.a.createElement(cf,{edge:t,edgesRef:r,key:t.id,isMouseDown:l,subSequence:o,selection:u,containerRef:c,inlet:e,outlet:t})})});if(t){var p=t.outlet,v=t.inlet;d.push(i.a.createElement(cf,{edge:p,edgesRef:r,key:t.id,isMouseDown:l,subSequence:o,selection:u,containerRef:c,inlet:v,outlet:p}))}return d}),lf=Object(s.b)(function(e,t){var n=t.fx&&t.fx.id,r=t.edge.effect.id;r=-1===r?t.pad.effectRack.id:r;var a=e.windows.windowPositions[t.fromWindow||t.fromId||n];return t.padZObject&&(a=e.windows.windowPositions[t.padZObject.id]),{fromPosition:a,isSourceCollapsed:e.effects.effectCollapsed[t.fx&&t.fx.id],isDestCollapsed:e.effects.effectCollapsed[r],isSelected:t.edge===e.pads.selectedEdge,toPosition:e.windows.windowPositions[r],hidden:e.spatial.hiddenObjects[t.pad.id],edgesPadding:e.spatial.edgesPadding}},function(e){return{setSelectedPadEdge:function(t){return e(Object(c.wd)(t))},setSelectedSteps:function(t){return e(Object(c.yd)(t))}}})(function(e){var t=e.scale,n=e.isSelected,o=e.outputPrefix,s=(e.fx,e.pad),c=e.edge,u=e.fromId,l=(e.containerRef,e.fromPosition),f=e.toPosition,h=e.isSourceCollapsed,d=e.isDestCollapsed,p=e.setSelectedPadEdge,v=e.setSelectedSteps,m=e.hidden,y=e.edgesPadding,b=e.sequencerEngine,g=e.edgesRef;o=o||"effect-output-";var O=Object(a.useState)([]),j=Object(r.a)(O,2),k=j[0],w=j[1];if(Object(a.useEffect)(function(){if("number"!==typeof c.effect){var e=c.effect.id;e=-1===e?s.effectRack.id:e;var t=void 0!==c.outputNumber?o+c.outputNumber+"-"+u:o+u,n=document.getElementById(t);e=c.effect===s.effectRack.outputNode?"effect-input-"+s.effectRack.id+"-speakers":"effect-input-"+e;var r=document.getElementById(e);if(n&&r){n=n.getBoundingClientRect(),r=r.getBoundingClientRect();var a=g.current.getBoundingClientRect(),i=a.top,l=a.left,f=[n.left-l,n.top-i,r.left-l,r.top-i];f=f.map(function(e){return e/(window._scale||1)}),w(f)}}},[t,y,l,f,w,d,h,b]),0===k.length)return[];var x=Object(r.a)(k,4),S=x[0],P=x[1],E=x[2],T=x[3],A="pad-effect-edge ";return n&&(A+=" selected"),m?"":i.a.createElement(sf,{onMouseDown:function(e){e.stopPropagation(),p(c),v([])},className:A,points:of(S+3,P,E+3,T)})}),ff=Object(s.b)(function(e,t){var n=t.pad.effectRack.adjacencyLists&&t.pad.effectRack.adjacencyLists[t.ffrom||t.fx.id];return{selectedEdge:e.pads.selectedEdge,numEdges:n&&n.length,effects:e.pads.padEffects[t.pad.id],midiEffects:e.pads.trackMidiEffects[t.pad.id]}},function(e){return{}})(function(e){var t=e.edgesRef,n=e.fromWindow,r=e.outputPrefix,a=e.scale,o=e.containerRef,s=e.fromId,c=(e.type,e.fx),u=e.pad,l=e.id,f=u.effectRack.adjacencyLists;if(!f)return[];var h=f[l||c.id];if(!h)return[];return h.map(function(e,l){return i.a.createElement(lf,{edgesRef:t,key:e.effect.id,sequencerEngine:u.sequencerEngine,containerRef:o,fromWindow:n,outputPrefix:r,scale:a,fromId:s||c.id,pad:u,edge:e,fx:c})})}),hf=Object(s.b)(function(e,t){if(!t.pad)return{};var n=t.pad.effectRack&&t.pad.effectRack.adjacencyLists&&t.pad.effectRack.adjacencyLists[-1];return{controlEdges:n&&n.length,isCollapsed:t.pad.effectRack&&e.effects.effectCollapsed[t.pad.effectRack.id]}},function(e){return{}})(function(e){e.setSelectedPadEdge,e.setDrawingPadEdge;var t=e.isCollapsed,n=e.pad,r=e.effects,a=void 0===r?[]:r,o=e.fromId,s=(e.controlEdges,e.isMidi),c=(e.drawingEdge,e.selectedElements,e.outputPrefix),u=void 0===c?"output-node-":c,l=e.edgesRef,f=Object(kn.a)(e,["setSelectedPadEdge","setDrawingPadEdge","isCollapsed","pad","effects","fromId","controlEdges","isMidi","drawingEdge","selectedElements","outputPrefix","edgesRef"]);return n&&n.effectRack&&n.effectRack.adjacencyLists?t?i.a.createElement(lf,Object.assign({scale:f.scale,sequencerEngine:n.sequencerEngine,fromId:n.id,edgesRef:l,test:!0,outputPrefix:"output-node-",padZObject:n.zObject,pad:n,edge:{effect:{id:-1}}},f)):i.a.createElement("g",{className:"all-edges"},i.a.createElement(ff,Object.assign({id:-1,pad:n,fromId:n.effectRack.id,outputPrefix:s&&u,ffrom:-1,edgesRef:l,fromWindow:o,sequencerEngine:n.sequencerEngine,fx:n.effectRack},f)),!s&&i.a.createElement(lf,Object.assign({scale:f.scale,fromId:n.id,sequencerEngine:n.sequencerEngine,fromWindow:o,edgesRef:l,test:!0,padZObject:n.zObject,outputPrefix:u,pad:n,edge:{effect:{id:-1}}},f)),a.map(function(e){return i.a.createElement(ff,Object.assign({key:e.id,edgesRef:l,pad:n,fx:e},f))})):[]}),df=(Object.values,Object.keys,function(e){e.subSequence,e.setWindowPositions;Object(a.useEffect)(function(){return window.addEventListener("keydown",t),function(){return window.removeEventListener("keydown",t)}},[]);var t=Object(a.useCallback)(function(e){"y"!==e.key||e.metaKey},[])}),pf=Object(a.memo)(function(e){var t,n,r,o,s=e.setMovingPadEdge,c=e.movingEdge,u=e.setCableSegmentation,l=e.edgesRef,f=e.effects,h=e.midiEffects,d=e.subSequence,p=e.drawingEdge,v=e.scale,m=e.setWindowPositions,y=e.setDrawingPadEdge,b=e.setAdjustingSegmentation,g=e.setSelectedPadEdge,O=Object(kn.a)(e,["setMovingPadEdge","movingEdge","setCableSegmentation","edgesRef","effects","midiEffects","subSequence","drawingEdge","scale","setWindowPositions","setDrawingPadEdge","setAdjustingSegmentation","setSelectedPadEdge"]);df({subSequence:d,setWindowPositions:m}),p&&(t=p.x1/(window._scale||1),r=p.y1/(window._scale||1),n=p.x2/(window._scale||1),o=p.y2/(window._scale||1)),function(e){var t=e.subSequence,n=e.setSelectedPadEdge;e.selectedElements;Object(a.useEffect)(function(){return window.addEventListener("keydown",r),function(){return window.removeEventListener("keydown",r)}},[t]);var r=Object(a.useCallback)(function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&"Backspace"===e.key){var r=t.sequencerEngine;if(r.noDeleteKey)return;var a=r.state.pads.selectedEdge,i=r.state.windows.selectedElements;for(var o in i){var s=t.sequencerEngine.findNodeById(o);s&&s.subSequence===t&&(s.isDeletable&&!s.isDeletable()||(s.delete?Object(X.a)(Object($.g)(s)):t.deleteNode(s)))}if(a){if(a.inlet){a.inlet;var c=a.outlet,u=t.sequencerEngine.findNodeById(c.destId),l=t.sequencerEngine.findNodeById(c.sourceId);u&&l&&Object(X.a)(Object($.f)(l,c.sourceType,u,c.destType))}else{var f=t.pads.find(function(e){return e.effectRack.effects.includes(a.effect)||e.effectRack.outputNode===a.effect});f||(f=t.tracks.find(function(e){return e.effectRack&&(e.effectRack.effects.includes(a.effect)||e.effectRack.outputNode===a.effect)})),f.effectRack.deleteEdge(a)}n(void 0)}}},[t])}({subSequence:d,setSelectedPadEdge:g}),Object(a.useEffect)(function(){return window.addEventListener("mousemove",j),window.addEventListener("mouseup",k),function(){window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",k)}},[d]);var j=Object(a.useCallback)(function(e){var t=d.sequencerEngine.state,n=t.pads,r=n.movingEdge,a=n.drawingEdges;if(r){O.containerRef.current.getBoundingClientRect();var i=e.clientX,o=e.clientY;s(Object(ot.a)({},r,{x2:i,y2:o}))}if(a[d.id]){O.containerRef.current.getBoundingClientRect();var c=e.clientX,u=e.clientY;t.spatial.editorPadding;y(d.id,Object(ot.a)({},a[d.id],{x2:c,y2:u}))}},[d]),k=Object(a.useCallback)(function(e){y(d.id,void 0),s(void 0),b(void 0)},[d]),w={transform:"scale("+1/v+")"};if(O.scrollable&&O.containerRef.current&&(w.width=O.containerRef.current.scrollWidth+"px",w.height=O.containerRef.current.scrollHeight+"px"),l.current){var x=l.current.getBoundingClientRect();t-=x.left,n-=x.left,r-=x.top,o-=x.top,c&&((c=Object(ot.a)({},c)).x2-=x.left,c.y2-=x.top)}var S=Object(a.useCallback)(function(e){var t=d.sequencerEngine,n=t.state.spatial.adjustingSegmentation;if(n){e.clientX;var r=e.clientY,a=(t.state.spatial.edgesPadding,O.containerRef.current.getBoundingClientRect()),i=d.tracks?t.state.spatial.editorPadding:{y:0};r-=a.top+i.y-O.containerRef.current.scrollTop,u(n.id,r)}},[]);return i.a.createElement("svg",{ref:l,onMouseMove:S,onMouseDown:function(e){return g(void 0)},style:w,className:"edges-drawer"},i.a.createElement("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"8",refX:"4",refY:"2",orient:"auto"},i.a.createElement("polygon",{points:"0 0, 5 2, 0 4"})),p&&i.a.createElement(sf,{className:"pad-effect-edge drawing-edge",points:of(t,r,n,o)}),c&&i.a.createElement(sf,{className:"pad-effect-edge drawing-edge",points:of(c.x1,c.y1,c.x2,c.y2)}),c&&i.a.createElement(af,{edge:c,pathPoints:of(c.x1,c.y1,c.x2,c.y2)}),i.a.createElement(uf,{selection:O.selection,containerRef:O.containerRef,edgesRef:l,subSequence:d}),d.tracks&&d.tracks.filter(function(e){return e.effectRack&&e.zObject&&"track"===e.zObject.name}).map(function(e){return i.a.createElement(hf,Object.assign({key:e.id,effects:h[e.id],scale:v,edgesRef:l,isMidi:!0,fromId:e.sequencer?e.sequencer.id:e.id,outputPrefix:"effect-output-",pad:e},O))}),d.zObjects.filter(function(e){return"pad"===e.name}).filter(function(e){return e.effect.pad}).map(function(e){return e.effect.pad}).map(function(e){return i.a.createElement(hf,Object.assign({key:e.id,edgesRef:l,effects:f[e.id],scale:v,pad:e},O))}))}),vf=Object(s.b)(function(e,t){return{drawingEdge:e.pads.drawingEdges[t.subSequence.id],movingEdge:e.pads.movingEdge,effects:e.pads.padEffects,midiEffects:e.pads.trackMidiEffects}},function(e){return{setSelectedPadEdge:function(t){return e(Object(c.wd)(t))},setDrawingPadEdge:function(t,n){return e(Object(c.pb)(t,n))},setMovingPadEdge:function(t){return e(Object(c.qc)(t))},setWindowPositions:function(t){return e(Object(c.O)(t))},setCableSegmentation:function(t,n){return e(Object(c.P)(t,n))},setAdjustingSegmentation:function(t){return e(Object(c.q)(t))}}})(pf);function mf(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return yf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yf(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function yf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var bf=Object(s.b)(function(e,t){return{}},function(e){return{setSelectedPulledElements:function(t){return e(Object(c.Ad)(t))}}})(function(e){e.hideColorPicker;var t=e.isSubPatch,n=e.setSelectedPulledElements,o=e.getSelection,s=e.editorRef,c=e.scale,u=e.onMouseMove,l=e.sequencerEngine,f=e.dropdownPos,h=e.setSelectedZObject,d=e.getXY,p=Object(a.useRef)(),v=Object(a.useState)(void 0),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useCallback)(function(e){if(u(e),y&&p.current){var t=d(e,!0),n=t.x,r=t.y;l.state.spatial.editorPadding,b(Object(ot.a)({},y,{x2:n,y2:r}))}},[y,b,c,l,d]),O=Object(a.useCallback)(function(e){if(3!==e.which&&("edges-drawer"===e.target.className.baseVal||e.target.className.includes&&(e.target.className.includes("pulled-background")||e.target.className.includes("grids-inner")))&&!l.state.spatial.showPadSequencer){var t=d(e,!0),n=t.x,r=t.y;l.state.spatial.editorPadding,b({x1:n,y1:r,x2:n,y2:r}),p.current=!0}},[b,l,d]),j=Object(a.useCallback)(function(e){if(!f&&!l.state.spatial.showPadSequencer){var r=l.state.spatial.editorPadding;if(y&&y.x2-y.x1>1){p.current=!1;var a,i=window._scale||1,s=t?y:{x1:(y.x1-Math.max(0,r.x))/i,y1:(y.y1-Math.max(0,r.y))/i,x2:(y.x2-Math.max(0,r.x))/i,y2:(y.y2-Math.max(0,r.y))/i},c=o(s),u={},d=l.state.zobjectBackground&&l.state.zobjectBackground.id,v=mf(c);try{for(v.s();!(a=v.n()).done;){var m=a.value.id;m!==d&&(u[m]=!0)}}catch(g){v.e(g)}finally{v.f()}return n(u),h(void 0),void b(void 0)}y&&(n({}),b(void 0),h(void 0),p.current=!1)}},[y,b,f,l,d]);return Object(a.useEffect)(function(){if(s.current)return s.current.addEventListener("mousedown",O),window.addEventListener("mouseup",j),s.current.addEventListener("mousemove",g),function(){s.current&&(s.current.removeEventListener("mousedown",O),window.removeEventListener("mouseup",j),s.current.removeEventListener("mousemove",g))}},[y,b,f,l,d]),i.a.createElement("div",{className:"pulled-background"},y&&y.x2-y.x1>0&&i.a.createElement("div",{style:{left:y.x1,top:y.y1,width:y.x2-y.x1,height:y.y2-y.y1},className:"selection"}))});function gf(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Of(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Of(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Of(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var jf=Object(a.memo)(function(e){e.len;var t=e.subpatch,n=e.setSize,o=e.setSelectedPulledElements,s=e.isInstrumentView,c=e.customMode,u=e.scrollRef,l=e.editLayout,f=e.presentationMode,h=e.isInsideWindow,d=e.setSelectedZObject,p=(e.setViewableSubPatches,t.zObjects),v=t.zMessages,m=Object(a.useRef)(),y=Object(a.useRef)({}),b=Le(),g=b.sizeRef,O=b.ordering,j=b.setOrdering,k=u,w=function(e){var t=e.elements;return{getSelection:function(e){var n=e.x1,r=e.y1,a=e.x2,i=e.y2;return Object.keys(t.current).map(function(e){return{element:t.current[e],id:e}}).filter(function(e){var t=e.element;return e.id,lt(t.current,n,r,a,i)})}}}({elements:y}).getSelection,x=Object(a.useState)(void 0),S=Object(r.a)(x,2),P=S[0],E=S[1],A=xt({containerRef:k,scale:1}).getXY,M=Object(a.useCallback)(function(e){if(!h){e.stopPropagation();var n=A(e),r=n.x,a=n.y;t.createZObject(r,a)}},[]),R=et(M,250,function(e){h||e.stopPropagation()}),C=tf({scrollRef:k,sequencerEngine:t.sequencerEngine,context:t}).onMouseMove,N=(Object(a.useCallback)(function(e){if("custom"===c&&d(t.zObject),k&&k.current){var n=A(e),r=n.x,a=n.y;E({x1:r,y1:a,x2:r,y2:a})}},[E,c]),Object(a.useCallback)(function(e){if(C(e),P){var t=A(e),n=t.x,r=t.y;E(Object(ot.a)({},P,{x2:n,y2:r}))}},[P,E]),Object(a.useCallback)(function(e){if(P&&P.x2-P.x1>1){var t,n={},r=gf(w(P));try{for(r.s();!(t=r.n()).done;){n[t.value.id]=!0}}catch(a){r.e(a)}finally{r.f()}o(n)}P&&E(void 0)},[P,E]),rf({ref:k,subSequence:t,setSelection:E}).onDrop),I="content-inner";return(f||l||s)&&(I+=" presentation-mode"),i.a.createElement("div",{onDrop:N,onClick:R,ref:u,className:I},"custom"!==c&&i.a.createElement(Fl,{subSequence:t}),"custom"!==c&&i.a.createElement(Kl,{subSequence:t}),"custom"!==c&&i.a.createElement(bf,{isSubPatch:!0,scale:1,sequencerEngine:t.sequencerEngine,getXY:A,setSelectedZObject:d,onMouseMove:C,getSelection:w,editorRef:u}),l&&!0===c&&i.a.createElement(nf,{scrollRef:k,subpatch:t}),p.map(function(e){return i.a.createElement(Rf,{key:e.id,scale:1,elements:y,sequencerEngine:t.sequencerEngine,ordering:O,isInstrumentView:s||l,setOrdering:j,customMode:"custom"===c?c:c&&l,setSize:n,sizeRef:g,containerRef:k,zobject:e})}),v.map(function(e){var r;return i.a.createElement(nl,(r={key:e.id,scale:1,sequencerEngine:t.sequencerEngine,isInstrumentView:s||l,setOrdering:j,ordering:O,customMode:"custom"===c?"custom":c&&l},Object(T.a)(r,"setOrdering",j),Object(T.a)(r,"setSize",n),Object(T.a)(r,"sizeRef",g),Object(T.a)(r,"elements",y),Object(T.a)(r,"containerRef",k),Object(T.a)(r,"zmessage",e),r))}),k&&k.current&&(!c||c&&!l)&&i.a.createElement(vf,{edgesRef:m,scrollable:!0,width:k.current&&k.current.scrollWidth,height:k.current&&k.current.scrollHeight,selection:P,containerRef:k,scale:1,subSequence:t}))}),kf=Object(s.b)(function(e,t){return{len:t.subpatch.zObjects.length,zobjects:e.zobject.zobjects[t.subpatch.id],zmessages:e.zobject.zmessages[t.subpatch.id],presentationMode:t.subpatch.presentationMode}},function(e,t){return{setSize:function(n){return e(Object(c.oc)(t.subpatch.id,n))},setSelectedPulledElements:function(t){return e(Object(c.Ad)(t))},setViewableSubPatches:function(t){return e(Object(c.We)(t))},setSelectedZObject:function(t){return e(Object(c.Ed)(t))}}})(jf),wf=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.subpatch,n=e.forceShow,r=Le(),o=r.sizeRef,s=r.ordering,c=r.setOrdering,u=Object(a.useRef)({});return i.a.createElement("div",{className:"custom-subpatch"},i.a.createElement(kf,{isInsideWindow:!0,sizeRef:o,elements:u,isInstrumentView:!0,forceShow:n,customMode:"custom",setOrdering:c,ordering:s,subpatch:t}))});n(1936);var xf=Object(s.b)(null,function(e,t){return{setAnnotationDragging:function(t){return e(Object(c.w)(t))}}})(function(e){var t=e.attributes,n=e.annotation,s=e.color,c=e.onDelete,u=e.setAnnotationDragging,l=e.elementRef,f=Object(a.useRef)(),h=Object(a.useState)(n.text),d=Object(r.a)(h,2),p=d[0],v=d[1],m=Object(a.useState)(!1),y=Object(r.a)(m,2),b=(y[0],y[1]),g=Object(a.useCallback)(function(e){e.stopPropagation(),n.text=e.target.value,v(e.target.value)},[v]),O=Object(a.useCallback)(function(){var e=t["font-size"],r=p.split("\n"),a=Math.max.apply(Math,Object(o.a)(r.map(function(e){return e.length}))),i=Math.max(96,6*a)*(e/10),s=22*r.length*(e/10);f.current.style.width=i+"px",n.width=i,l.current.style.width=i+"px",f.current.style.height=s+"px",n.height=s,l.current.style.height=s+"px",n.zObject.width=i,n.zObject.height=s},[p,t]),j={left:n.x,top:n.y,backgroundColor:s},k={backgroundColor:s,fontSize:t["font-size"]+"pt"};t&&t["secondary-color"]&&(k.color=t["secondary-color"]);var w=Object(a.useCallback)(function(e){u(n)},[u]);return i.a.createElement("div",{style:j,className:"annotation"},i.a.createElement("div",{onMouseDown:w,className:"draggable-header"},i.a.createElement("div",{className:"delete-button",onClick:c},"x")),i.a.createElement("textarea",{ref:f,onFocus:function(){return b(!0)},onBlur:function(){return b(!1)},onKeyUp:O,style:k,onChange:g,type:"textarea",value:p,placeholder:"Write a note",className:"annotation-text"}))}),Sf=Object(s.b)(function(e,t){return{_figures:t.effect.figures._figures}},function(e){return{setSelectedZObject:function(t){return e(Object(c.Ed)(t))}}})(function(e){e.isDraggable;var t=e.effect,n=e.zobject,o=e.setChosen,s=e.chosen,c=(e._figures,e.setSelectedZObject),u=Object(a.useState)(t.figures.figures),l=Object(r.a)(u,2),f=l[0],h=l[1];Object(a.useEffect)(function(){f!==t.figures.figures&&h(t.figures.figures)},[t.figures,h,f]);var d=Object(a.useCallback)(function(){t.figures.newFigure(),h(t.figures.figures)},[h]),p=Object(a.useCallback)(function(){t.figures.doubleFigures(),h(t.figures.figures)},[h]),v=Object(a.useCallback)(function(){t.figures.halfFigures(),h(t.figures.figures)},[h]);return i.a.createElement("div",{className:"figures-list"},f.map(function(e){return i.a.createElement("div",{className:s&&s.figure===e?"figure selected":"figure"},i.a.createElement("div",{onClick:function(t){console.log("zobject=",n),n&&c(n),t.stopPropagation(),o&&(s&&"FIGURE"===s.type&&s.figure===e?o(void 0):o({type:"FIGURE",figure:e}))},className:"figure-button"},Math.round(e.figureLength)),i.a.createElement("div",{className:"cycle-string"},e.toString()))}),i.a.createElement("dig",{className:"figure"},i.a.createElement("div",{onClick:d,className:"figure-button add"},"+"),i.a.createElement("div",{onClick:p,className:"figure-button add"},"2x"),i.a.createElement("div",{onClick:v,className:"figure-button add"},"1/2x")))}),Pf=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.zobject,n=e.effect,o=e.setOverflow,s=Object(a.useState)(void 0),c=Object(r.a)(s,2),u=c[0],l=c[1];return Object(a.useEffect)(function(){o(u)},[u,o]),i.a.createElement("div",{onClick:function(){return l(void 0)},className:"jaki jfigures"},i.a.createElement(Sf,{zobject:t,setChosen:l,chosen:u,effect:n}),u&&i.a.createElement(Pl,{setChosen:l,chosen:u,effect:n}))}),Ef=Object(s.b)(function(e,t){return{tidals:t.jgraphics&&t.jgraphics.tidals,color:t.jgraphics&&t.jgraphics.color,backgroundColor:t.jgraphics&&t.jgraphics.backgroundColor,fillColor:t.jgraphics&&t.jgraphics.fillColor,dotColor:t.jgraphics&&t.jgraphics.dotColor}},function(e){return{}})(function(e){var t=e.jgraphics,n=e.tidals,r=e.width,a=e.height;return n?(r<=0?(r=280,a=280):(r*=1,a*=1),i.a.createElement(Lr,{color:t.color,fillColor:t.fillColor,backgroundColor:t.backgroundColor,dotColor:t.dotColor,tidals:n,WIDTH:r,HEIGHT:a})):""}),Tf=Object(s.b)(function(e,t){return{snapshots:t.jsnapshot&&t.jsnapshot.snapshots}},function(e){return{}})(function(e){var t=e.jsnapshot;return t&&t.snapshots?i.a.createElement("div",{className:"jsnapshot"},i.a.createElement("div",{onClick:function(){return t.takeSnapshot()},className:"take-snapshot-btn"},"Save"),i.a.createElement("div",{className:"snapshots"},t.snapshots.map(function(e,n){return i.a.createElement("div",{onClick:function(){return t.useSnapshot(n)},className:"snapshot-option"},n+1)}))):""}),Af=Object(s.b)(function(e,t){return{_ipfsHash:t.zipfs&&t.zipfs._ipfsHash}},function(e){return{setUploadingFile:function(t){return e(Object(c.Se)(t))}}})(function(e){var t=e.zipfs,n=e._ipfsHash,o=e.setUploadingFile,s=Object(a.useState)(n),c=Object(r.a)(s,2),u=(c[0],c[1]),l=Object(a.useState)(t.hashMap),f=Object(r.a)(l,2),h=(f[0],f[1]),d=Object(a.useCallback)(function(){var e=Object(K.a)(W.a.mark(function e(n){var r,a,i,s,c;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.stopPropagation(),n.preventDefault(),n.dataTransfer.effectAllowed="none",n.dataTransfer.dropEffect="none",!n.dataTransfer.items){e.next=23;break}t.sequencerEngine.dispatch(o(!0)),a=n.dataTransfer.items.length,i=0;case 9:if(!(i<a)){e.next=18;break}if("file"!==n.dataTransfer.items[i].kind){e.next=15;break}return s=n.dataTransfer.items[i].getAsFile(),e.next=14,Object(Ca.b)(t.sequencerEngine,s);case 14:r=e.sent;case 15:i++,e.next=9;break;case 18:c=r.ipfsHash,t.ipfsHash=c,u(c),h(Object(ot.a)({},t.hashMap)),t.sequencerEngine.dispatch(o(!1));case 23:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[u,t,h]),p=Object(a.useCallback)(function(e,n){t.startOnsets[n]=parseFloat(e.target.value),h(Object(ot.a)({},t.hashMap))},[h]),v=Object(a.useCallback)(function(e,n){t.tempos[n]=parseFloat(e.target.value),h(Object(ot.a)({},t.hashMap))},[h]),m=Object(a.useCallback)(function(e){t.deleteId(e),h(Object(ot.a)({},t.hashMap))},[h]);return Object(a.useEffect)(function(){console.log("setting ipfsHash=",n),u(n)},[n,u]),i.a.createElement("div",{onDrop:d,className:"z-ipfs-drop"},i.a.createElement("div",{className:"ipfs-table"},Object.keys(t.hashMap).map(function(e){return i.a.createElement("div",{className:"track-row"},i.a.createElement("div",{className:"song-id"},e),i.a.createElement("div",{className:"song-hash"},t.hashMap[e].slice(0,4),"..."),i.a.createElement("div",{className:"tempo-input"},i.a.createElement("input",{value:t.tempos[t.hashMap[e]],onChange:function(n){return v(n,t.hashMap[e])},type:"text"})),i.a.createElement("div",{className:"onset-input"},i.a.createElement("input",{value:t.startOnsets[t.hashMap[e]],onChange:function(n){return p(n,t.hashMap[e])},type:"text"})),i.a.createElement("div",{onClick:function(){return m(e)},className:"delete-btn"},"x"))})),i.a.createElement("span",{className:"drop-file"},"Drop File"))}),Mf=(n(1937),Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.sequencerEngine,n=e.zobject,o=e.setText,s=e.text,c=e.setEditing,u=Object(a.useRef)();Ze(u);var l=Object(a.useState)([]),f=Object(r.a)(l,2),h=f[0],d=f[1];Object(a.useEffect)(function(){if(s){var e="";s.startsWith("subscribe")||s.startsWith("publish")?((e=s.split(" ")[1])||(e=""),console.log('text ="'.concat(e,'"')),void 0!==e?(console.log('trying to auto complete with = "%s"',e),d(Ye(e))):d([])):d([])}else d([])},[s,d]);var p=Object(a.useCallback)(function(e){var t;t=s.startsWith("subscribe")?"subscribe "+e:"publish "+e,n.text=t,o(t),c(!1)},[n,s,o,c]),v=h.filter(function(e){return!e.includes(".")||e.split(".").every(function(e){return!t.idToObject[e]})});return v.sort(),i.a.createElement("div",{ref:u,onClick:function(e){return e.stopPropagation()},className:0===v.length?"autocomplete-messages empty":"autocomplete-messages"},v.map(function(e){return i.a.createElement("div",{onClick:function(){return p(e)},className:"pub-option"},e)}))})),Rf=Object(s.b)(function(e,t){var n=t.zobject.presentationMode||t.isInstrumentView,r=e.spatial.hiddenObjects[t.zobject.id];return n&&!t.zobject.attributes["Include in Presentation"]&&(r=!0),{compilationError:t.zobject.compilationError,presentationMode:n,includeInPresentation:!n&&t.zobject.attributes["Include in Presentation"],outerWidth:t.zobject.subSequence.zObject&&t.zobject.subSequence.zObject.width,outerHeight:t.zobject.subSequence.zObject&&t.zobject.subSequence.zObject.height,function:t.zobject.function,name:t.zobject.name,isSelected:e.windows.selectedElements[t.zobject.id],isSelectedZObject:e.zobject.selectedZObject===t.zobject||e.zobject.selectedZObject&&t.zobject.effect===e.zobject.selectedZObject,text:t.zobject._text,width:t.zobject.width,height:t.zobject.height,fillColor:t.zobject.effect&&t.zobject.effect.fillColor,hidden:r,styling:e.zobject.objectStylings[t.zobject.id],flashTimestamp:e.zobject.zobjectsFlashing[t.zobject.id],isLocked:e.spatial.lockedObjects[t.zobject.id],isBackground:t.zobject.attributes["set as background"]}},function(e,t){return{setViewableSubPatches:function(t){return e(Object(c.We)(t))},setSelectedPulledElements:function(t){return e(Object(c.Ad)(t))},setSelectedZObject:function(t){return e(Object(c.Ed)(t))},setFullScreenZObject:function(t){return e(Object(c.Gb)(t))},setZObjectInputText:function(t){return e(Object(c.ff)(t))},setLocked:function(n){return e(Object(c.Pe)(t.zobject.id,n))},setPluginToSave:function(t){return e(Object(c.Wc)(t))},setZObjectBackground:function(t){return e(Object(c.bf)(t))},setZObjectsStack:function(t){return e(Object(c.mf)(t))},setZObjectContextMenu:function(t,n,r){return e(Object(c.cf)(t,n,r))}}})(function(e){var t=e.setZObjectContextMenu,n=e.setZObjectsStack,s=e.composite,u=e.presentationMode,l=e.isInstrumentView,f=e.isBackground,h=(e.setZObjectBackground,e.forceShow),d=(e.setPluginToSave,e.zobject),p=e.setLocked,v=e.flashTimestamp,m=e.isLocked,y=(e.coords,e.isMainNFT),b=e.isStatic,g=e.setSelectedZObject,O=e.sequencerEngine,j=(e.fillColor,e.customMode),k=e.isSelectedZObject,w=e.scale,x=e.planeMapping,S=e.sizeRef,P=e.containerRef,E=e.elements,T=e.setOrdering,A=e.isSelected,M=e.ordering,R=e.size,C=e.setSize,N=e.setViewableSubPatches,I=e.setSelectedPulledElements,q=e.setFullScreenZObject,_=e.includeInPresentation,D=e.hidden,F=e.setZObjectInputText,L=Object(a.useRef)(void 0),B=Object(a.useRef)(void 0),z=(Object(a.useRef)({}),Object(a.useCallback)(function(e){e.preventDefault(),e.stopPropagation();var n=P.current.getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top;t(d.subSequence.id,{x:r,y:a},d)},[d])),J=Object(a.useState)(!1),V=Object(r.a)(J,2),H=V[0],U=V[1],G=Object(a.useState)(!1),W=Object(r.a)(G,2),K=W[0],Q=W[1],Z=Object(a.useState)(d._text||""),Y=Object(r.a)(Z,2),$=Y[0],X=Y[1],ee=Object(a.useState)(!1),ne=Object(r.a)(ee,2),re=ne[0],ae=ne[1],ie=Object(a.useState)(!1),oe=Object(r.a)(ie,2),se=oe[0],ce=oe[1],ue=Object(a.useState)(!1),le=Object(r.a)(ue,2),fe=le[0],he=le[1],de=Object(a.useRef)(!1),pe=Object(a.useCallback)(function(){var e=d;d.pluginViewerFor&&(e=d.pluginViewerFor);var t=e.sequencerEngine.state.zobject.viewableSubPatches;if(e.subSequence&&e.subSequence.zObject){e.effect.width=e.subSequence.width,e.effect.height=e.subSequence.height;var n=d.sequencerEngine.state.windows.windowPositions[d.subSequence.id];d.sequencerEngine.dispatch(Object(c.Ze)(e.effect.id,n))}N([].concat(Object(o.a)(t.filter(function(t){return t!==e.subSequence})),[e.effect]))},[]),ve=Object(a.useRef)(j);Object(a.useEffect)(function(){ve.current=j},[j]);var me=Object(a.useCallback)(function(e){if(e.stopPropagation(),"subpatch"!==d.name||d.effect.isCustom)if(void 0!==d.attributes.minimized)d.setAttribute("minimized",!d.attributes.minimized);else{var t={};t[d.id]=!0,I(t)}else pe();g(s||d)},[j]),ye=Object(a.useState)(!1),be=Object(r.a)(ye,2),ge=be[0],Oe=be[1],je=Object(a.useRef)(0);Object(a.useEffect)(function(){je.current++;var e=je.current;if(de.current&&v&&(new Date).getTime()-v<1e3)return Oe(!1),void setTimeout(function(){Oe(!0),v&&(new Date).getTime()-v<1e3&&(Oe(!0),de.current=!0,setTimeout(function(){je.current===e&&(de.current=!1,Oe(!1))},1100))},10);v&&(new Date).getTime()-v<1e3&&(Oe(!0),de.current=!0,setTimeout(function(){je.current===e&&(de.current=!1,Oe(!1))},1100))},[v,Oe]);var ke=Object(a.useCallback)(function(e){if(e.stopPropagation(),!k){if(d.state.spatial.lockedObjects[d.id]||d.state.spatial.lockedObjects[d.effect&&d.effect.id])return;d.effect&&d.effect.getObjectType&&d.effect.getObjectType()===te.c?g(d.effect):"cirklon"===d.name?g(d.sequencerEngine.getSelectedTrack()):g(s||d)}},[k]),we=Object(a.useCallback)(function(e){},[d]),xe=et(me,250,we),Se=Object(a.useCallback)(function(){ae(!0),x.randomlyMapParameters(d.effect)},[ae,x]);Object(a.useEffect)(function(){!d._text&&B.current&&(U(!0),B.current.focus())},[]),Object(a.useEffect)(function(){d._text},[d._text,$,X,H]),Object(a.useEffect)(function(){},[H,$]);var Pe=Object(a.useCallback)(function(e){var t=e.target.value;X(t),F(t)},[X]),Ee=Et({code:$,skipMouse:!0,ref:B,timeout:40,onChange:Pe,doc:tl.a}),Te=Ee.possibilities,Ae=Ee.selectedChoice,Me=Ee.choosePossibility,Re=Ee.setPossibilities,Ce=mt({scale:w,ref:L,sequencerEngine:O,sizeRef:S,containerRef:P,size:R,setSize:C,elements:E,element:d,setOrdering:T,ordering:M}),Ne=Ce.zIndex,Ie=Ce.setWindowScale,qe=(Ce.isDragging,Ce.onMouseDown),_e=Ce.onMouseUp,De=(Ce.setCoords,Ce.startResizing),Fe=Ce.windowScale,Le=function(e,t,n,r,a,o){if(e.isComposite)return i.a.createElement(ma,{zobject:e});switch(e.name){case"ipfs.drop":return i.a.createElement(Af,{zipfs:e.effect});case"param":return i.a.createElement(Nt,{zobject:e});case"plane.group":return i.a.createElement(hn,{params:e.effect});case"plane.graphics":return i.a.createElement(zn,{graphics:e.effect});case"jparams":return i.a.createElement(Dl,{isDraggable:!1,sequencerEngine:e.sequencerEngine,effect:{jakiParams:e.effect}});case"gl.sdfBuilder":case"sdf.builder":return e.effect&&i.a.createElement(Ha,{sequencerEngine:e.sequencerEngine,builder:e.effect});case"h=0.sequencer":return e.effect&&i.a.createElement(va,{sequencerEngine:e.sequencerEngine});case"submix":return i.a.createElement(Sc,{zobject:e});case"tr.loopUI":return i.a.createElement(ur,{loopUI:e.effect});case"sdf.layers":return i.a.createElement(Ra,{sdfLayers:e.effect});case"mixbuttons":return i.a.createElement(ji,{zobject:e});case"spore.effects":return i.a.createElement(ba,{zobject:e});case"operations.snapshots":return i.a.createElement(Na,{snapshots:e.effect});case"icon":return i.a.createElement(Ia,{zobject:e});case"system5":return i.a.createElement(ac,{zobject:e});case"macro":return i.a.createElement(Gu,{zobject:e,macro:e.effect});case"jsnapshot":return i.a.createElement(Tf,{jsnapshot:e.effect});case"interface.xy":return i.a.createElement(Fa,{zobject:e});case"scale":return i.a.createElement(ja,{zscale:e.effect});case"preset":return i.a.createElement(ya,{zobject:e});case"interface.multiXY":return i.a.createElement(La,{zobject:e});case"buttonPresser":return i.a.createElement(Da,{zobject:e});case"spore.stems":return i.a.createElement(Ca.a,{sporeStems:e.effect});case"jtypes":return i.a.createElement(_a,{jtypes:e.effect,sequencerEngine:e.sequencerEngine,track:e.subSequence});case"envelope":return i.a.createElement(oi,{zobject:e,zenvelope:e.effect});case"vec3":return i.a.createElement(Ua,{zobject:e,vec3:e.effect});case"vec2":return i.a.createElement(Ga,{zobject:e,vec2:e.effect});case"jfigures":return i.a.createElement(Pf,{zobject:e,effect:Object(ot.a)({},e,{figures:e.effect}),setOverflow:a,sequencerEngine:e.sequencerEngine,track:e.subSequence});case"matrix":return i.a.createElement(Pc,{zobject:e});case"ztracker":return i.a.createElement(Jc,{zobject:e});case"roll":return i.a.createElement(Nc,{zobject:e});case"toggle":return i.a.createElement(Wc,{toggle:e.effect});case"jgraphics":return i.a.createElement(Ef,{height:n,width:t,jgraphics:e.effect,sequencerEngine:e.sequencerEngine,track:e.subSequence});case"comment":return i.a.createElement(xf,{elementRef:o,attributes:e.attributes,annotation:e.effect});case"sampleBank":return i.a.createElement(Gc,{sampleBank:e.effect});case"jgrid":return i.a.createElement(gl,{grid:e.effect});case"jrules.filter":return i.a.createElement(Zn,{jrules:e.effect});case"dpad":return i.a.createElement(Vu,{dpad:e.effect});case"jrepl":return i.a.createElement(Hu,{jrepl:e.effect});case"jdebug":return i.a.createElement(nr,{jdebug:e.effect});case"jaki":return i.a.createElement(El,{setOverflow:a,effect:e.effect});case"pad":return i.a.createElement(wo,{zobject:e,scrollContainer:r,padWrapper:e.effect});case"nft":return i.a.createElement(pl,{zobject:e});case"color":return i.a.createElement(cl,{zcolor:e.effect});case"canvas":return i.a.createElement(ol,{zobject:e});case"three.canvas":return i.a.createElement(Gi,{zobject:e});case"three.shaderMaterial":return i.a.createElement(fl,{zobject:e});case"script":return i.a.createElement(ul,{zobject:e});case"instancedSubpatch":return i.a.createElement(xo,{instance:e.effect});case"subpatch":if(e.effect&&e.effect.isCustom)return i.a.createElement(wf,{subpatch:e.effect});if(e.effect)return i.a.createElement(il,{subpatch:e.effect});break;case"track":return i.a.createElement(sl,{zobject:e,track:e.effect,containerRef:r});case"cirklon":return i.a.createElement(Ju,{zobject:e,object:e.effect,containerRef:r});case"three.textureLoader":return i.a.createElement(mi,{zobject:e,textureLoader:e.effect,containerRef:r});case"varz":return i.a.createElement(fi,{zobject:e,pattr:e.subSequence.pattr,containerRef:r});case"tidal":return i.a.createElement(Uc,{tidal:e.effect,zobject:e});case"patterns":return i.a.createElement(Yu,{object:e,containerRef:r,primaryColor:e.attributes["primary-color"],secondaryColor:e.attributes["secondary-color"]})}}(d,Fe&&Fe.x,Fe&&Fe.y,P,ce,L),Be=Object(a.useCallback)(function(){var e=d.state.zobject.fullScreenZObject;Array.isArray(e)||(e=[e]),q(e.filter(function(e){return e!==d}))},[d]);Object(a.useEffect)(function(){d.effect&&d.width&&Ie({x:d.width,y:d.height})},[d.effect,Ie,d.width,d.height]);var ze=Object(a.useCallback)(function(e){if("Enter"===e.key){d.text=$;var t=void 0===d.function;he(t),U(!1),Re([]),B.current&&B.current.blur()}},[U,$,he,Re]);Object(a.useEffect)(function(){return window.addEventListener("click",Je),function(){return window.removeEventListener("click",Je)}},[U,H,$,he,d,Re]);Object(a.useCallback)(function(){var e=!0===d.attributes["Include in Presentation"];d.setAttribute("Include in Presentation",!e)},[d]);var Je=Object(a.useCallback)(function(){d._text!==$&&H&&(d.text=$),Re([]),he(void 0===d.function),U(!1),B.current&&B.current.blur()},[U,H,$,he,d,Re]),Ve=(Object(a.useCallback)(function(){p(!m)},[m]),Object(a.useCallback)(function(e){e.stopPropagation(),ke(e),qe(e)},[k]));Object(a.useEffect)(function(){if(k){var e=d.state.zobject.zobjectsStack.filter(function(e){return e!==d});e.push(d),n(e)}},[k]);var He=function(e){var t=e.custom,n=e.hidden,r=e.forceShow,a=e.editing,i=e.windowScale,o=e.includeInPresentation,s=e.isMapped,c=e.overflow,u=e.isBackground,l=e.planeMapping,f=e.isSelected,h=e.isSelectedZObject,d=e.isMainNFT,p=e.presentationMode,v=e.customMode,m=e.flashing,y=e.zobject,b=(e.attributes,e.notExists),g=e.zIndex,O=e.text,j={zIndex:g},k=Object(ot.a)({},j),w={};if(O.length>0){var x=.9*O.length+1;y.attributes["min-width"]||(w.minWidth=x+"ch");var S=y.numInlets;y.effect&&y.effect.numInlets&&(S+=y.effect.numInlets);var P=y.numOutlets;y.effect&&y.effect.numOutlets&&(P+=y.effect.numOutlets);var E=Math.max(S,P);3.85*E>x&&(x=3.85*E,w.minWidth=x+"ch")}k=Object(ot.a)({},k,w),y.attributes["border-radius"]&&(k.borderRadius=y.attributes["border-radius"]+"px"),y.attributes.overflow&&(k.borderRadius=y.attributes.overflow);var T="z-object",A=!1;!f||"custom"===v&&y.subSequence.zObject||(T+=" resizable",A=!0),y.isComposite&&(T+=" composite-object"),m&&(T+=" flashing"),c&&(T+=" overflow");var M=!1;h&&(T+=" selected",Array.isArray(y.state.zobject.fullScreenZObject)&&y.state.zobject.fullScreenZObject.includes(y)&&(M=!0)),t&&(T+=" custom",delete k.width),d&&(T+=" main-nft"),t&&y.effect&&y.effect.zObjects&&!y.effect.isCustom&&(T+=" subpatch-zobject");var R=void 0;if(t&&y.effect&&y.effect.isCustom&&(T+=" custom-subpatch-container"),"subpatch"===y.name&&(R=y.args[0]),"pad"===y.name&&y.effect.pad&&(R=y.effect.pad.name),y.attributes["scripting name"]&&(R=y.attributes["scripting name"]),"comment"===y.name&&(T+=" comment"),"color"===y.name&&(T+=" color-object"),y.name&&y.name.includes("gl.")&&(T+=" gl_operation"),"gl.uniform"===y.name&&(T+=" gl_uniform"),"jdebug"===y.name&&(T+=" jdebug-object"),"script"===y.name&&(T+=" script"),"track"===y.name&&y.attributes["show-sequencer"]&&(T+=" showing-sequencer"),y.hasInletFields&&(T+=" has-inlet-fields"),"pad"===y.name&&(T+=" z-object-pad"),"sampleBank"===y.name&&(T+=" z-sample-bank"),"icon"===y.name&&(T+=" z-icon"),"cirklon"===y.name&&(T+=" zcirklon",y.attributes["secondary-color"]&&(k.backgroundColor=y.attributes["secondary-color"])),"ztracker"===y.name&&(T+=" ztracker-object"),"patterns"===y.name&&(T+=" zpatterns"),!y.attributes.minimized&&i&&i.x>0&&i.y>0&&(t?("subpatch"!==y.name||y.effect.isCustom)&&(k.width=i.x,k.height=i.y):k.width=i.x),y.attributes["fill subpatch"]){var C=y.subSequence;if(C.zObject){var N=C.zObject,I=N.width,q=N.height;k.width=I,k.height=q}}u&&(k.width=window.innerWidth-40,k.height=window.innerHeight-80),l&&y.effect&&(s||(T+=" plane-mapping")),y.effect&&y.effect.zObjects&&y.effect.isCustom&&(y.attributes&&(k.backgroundColor=y.attributes["primary-color"],y.attributes["secondary-color"]&&(k.borderColor=y.attributes["secondary-color"])),T+=" custom-fill"),y.attributes["primary-color"]&&(k.backgroundColor=y.attributes["primary-color"]),"macro"===y.name&&(k.backgroundColor=void 0),b&&(T+=" not-exists"),k.borderRadius=y.attributes["border-radius"]+"px";var _=y.state.windows,D=p&&_.presentationWindowPositions[y.id]||_.windowPositions[y.id];if(D&&(k.left=D.x,k.top=D.y),"custom"===v){var F=[y.subSequence.zObject.width,y.subSequence.zObject.height],L=F[0],B=F[1];if(D&&(D.x>L||D.y>B))return""}if("track"===y.name&&(T+=" z-track"),n&&!r)return"";var z={};return y.attributes["border-radius"]&&(z.borderRadius=y.attributes["border-radius"]-3+"px"),y.attributes.overflow&&(z.overflow=y.attributes.overflow),y.attributes.overflow&&(z.overflow=y.attributes.overflow),"tr.loopUI"===y.name&&(z.overflow="visible"),a||(T+=" not-editing"),u&&(T+=" is-background"),o&&(T+=" include-in-presentation"),y.compilationError&&(T+=" compilation-error"),y.attributes["min-width"]&&(j.minWidth=y.attributes["min-width"]+"px"),{_style:k,innerCustomStyle:z,style:j,className:T,textStyle:w,showRemoveFromScreen:M,subpatchName:R,isResizing:A}}({custom:Le,hidden:D,forceShow:h,editing:H,windowScale:Fe,includeInPresentation:_,isMapped:re,overflow:se,isBackground:f,planeMapping:x,isSelected:A,isSelectedZObject:k,isMainNFT:y,presentationMode:u,customMode:j,flashing:ge,zobject:d,notExists:fe,zIndex:Ne,text:$}),Ue=He._style,Ge=He.innerCustomStyle,We=(He.style,He.className),Ke=He.textStyle,Qe=He.showRemoveFromScreen,Ze=He.isResizing,Ye=He.subpatchName;return D?"":i.a.createElement("div",{onMouseDown:y||b||se||"custom"===j?function(e){return y?e.stopPropagation():0}:Ve,onContextMenu:function(e){d.subSequence.inletObjects&&!d.sequencerEngine.state.zobject.viewableSubPatches.includes(d.subSequence)||(e.stopPropagation(),z(e))},onClick:function(e){var t=d.state.zobject.fullScreenZObject;t?Array.isArray(t)||(t=[t]):t=[];var n=t.length;if(y&&"three.canvas"!==d.name&&n<=1)e.stopPropagation();else if(x)Se(e);else{if("custom"===j&&d.subSequence.zObject)return;xe(e)}},onMouseUp:function(e){_e(e)},ref:L,style:Ue,className:We},Qe&&i.a.createElement("div",{onClick:Be,className:"pushable remove-from-fullscreen"},"Remove From Screen"),Ye?i.a.createElement("div",{onClick:function(){return g(d)},className:"custom-subpatch-name"},Ye):Le&&"macro"!==d.name&&"comment"!==d.name?i.a.createElement("div",{onClick:function(){return g(d)},className:"custom-subpatch-name"},d.name):"",i.a.createElement("div",{style:Ge,className:"inner-custom"},Le),i.a.createElement("div",{className:Le?"hide-basic":"basic"},fe&&i.a.createElement("div",{className:"not-exists-icon"},"!"),i.a.createElement("input",{onMouseDown:function(e){var t=d.sequencerEngine.state.windows.windowPositions[d.id];H&&e.stopPropagation(),Q(t)},onClick:function(e){var t=d.sequencerEngine.state.windows.windowPositions[d.id];e.stopPropagation(),t===K&&U(!0)},spellcheck:"false",style:Ke,ref:B,onKeyUp:ze,readOnly:!H,type:"text",className:H?"z-object-input editing":"z-object-input no-select",onChange:Pe,value:$}),H&&i.a.createElement($e,{setText:X,zobject:d,setEditing:U,sequencerEngine:O,text:$}),H&&i.a.createElement(Mf,{setText:X,zobject:d,setEditing:U,sequencerEngine:O,text:$}),i.a.createElement($u,{isInstrumentView:l,windowRef:L,zobject:d}),H&&-1===$.indexOf(" ")&&i.a.createElement(it,{doc:tl.a,selectedChoice:Ae,choosePossibility:Me,scrollTop:0,input:B,setPossibilities:Re,possibilities:Te})),i.a.createElement(wt,{width:d.width,doc:tl.a,numInlets:d.numInlets,effect:d}),i.a.createElement(Pt,{width:d.width,numOutlets:d.numOutlets,doc:tl.a,subSequence:d.subSequence,containerRef:P,scale:w,effect:d}),d.compilationError&&i.a.createElement(Sa,{error:d.compilationError}),Ze&&[i.a.createElement("div",{onMouseDown:function(e){return De("NW",e)},className:"top-left-edge"}),i.a.createElement("div",{onMouseDown:function(e){return De("NE",e)},className:"top-right-edge"}),i.a.createElement("div",{onMouseDown:function(e){return De("SW",e)},className:"bottom-left-edge"}),i.a.createElement("div",{onMouseDown:function(e){return De("SE",e)},className:"bottom-right-edge"})])}),Cf=n(901),Nf=(n(902),Object(s.b)(function(e,t){var n=t.sequencerEngine,r=t.id;return{sampleDownloadProgress:e.sequencer.sampleDownloadProgress,loadingProgress:e.sequencer.sequenceLoadingProgress[r||n.sequenceId]||0}},null)(function(e){var t=e.loadingProgress,n=e.sampleDownloadProgress,o=e.width,s=void 0===o?190:o;n&&(t+=75*n.downloaded/n.total,n.downloaded===n.total&&(t-=75));var c=Object(a.useState)(t),u=Object(r.a)(c,2),l=u[0],f=u[1];Object(a.useEffect)(function(){var e=setInterval(function(){f(function(e){return(e+1)%100})},100);return function(){return clearInterval(e)}},[]),Object(a.useEffect)(function(){if(window.parent&&document.referrer){var e={type:"loading-progress",body:t+l},n=document.referrer;window.parent.postMessage(e,n)}},[l,t]);return i.a.createElement("div",{style:{width:s,height:s},className:"progress-bar circular-container"},i.a.createElement(Cf.a,{percentage:l+t,radius:s/2}))})),If=(n(943),n(916)),qf=n(159),_f=n(536);n(942);(new _f.a).contractAddress;function Df(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ff(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ff(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ff(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Lf=function(){var e=Object(K.a)(W.a.mark(function e(){var t,n,r,a,i,o,s;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.isNFT){e.next=2;break}return e.abrupt("return",[]);case 2:return t=(t=$i.a.getItem("sequences"))?JSON.parse(t).filter(function(e){return e.title&&""!==e.title}):[],n=new Set(t.map(function(e){return e.newSequence})),e.next=7,Bf(n);case 7:r=e.sent,a=[],i=Df(t);try{for(i.s();!(o=i.n()).done;)s=o.value,r.has(s.hash)||a.push(s)}catch(c){i.e(c)}finally{i.f()}$i.a.setItem("sequences",JSON.stringify(a));case 12:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),Bf=function(){var e=Object(K.a)(W.a.mark(function e(t){var n,r;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qf.a.getAccount();case 2:return n=e.sent,e.next=5,Xi.a.tokenizedSequences.getSequences(n,void 0,void 0);case 5:return r=e.sent,e.abrupt("return",new Set(r.map(function(e){return e.newSequence})));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),zf=n(1938),Jf=n(590),Vf=function(){function e(t,n,r,a,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;Object(m.a)(this,e),this.sliceNumber=0,this.recordedTriggers=n.map(function(e){return new Jf.a(e,0,r,a,i,o)}),this.transpose=t,this.tracks=n}return Object(y.a)(e,[{key:"record",value:function(e,t,n){var r=this;this.recordedTriggers.map(function(t,n){return t.record(e,r.tracks[n],r.transpose+r.tracks[n].trackData.transpose)})}}]),e}(),Hf={a:0,w:1,s:2,e:3,d:4,f:5,t:6,g:7,y:8,h:9,u:10,j:11,k:12,o:13,l:14},Uf=function(){function e(){Object(m.a)(this,e),this.octave=0}return Object(y.a)(e,[{key:"getTransposeForKey",value:function(e){var t=12*this.octave;return(e=e.toLowerCase())in Hf?t+Hf[e]:void 0}},{key:"upOctave",value:function(){this.octave<3&&this.octave++}},{key:"downOctave",value:function(){this.octave>-2&&this.octave--}}]),e}(),Gf=(n(596),new qc.a),Wf=function(){function e(t,n){Object(m.a)(this,e),this.keyMappings={},this.midiMappings={},this.sequencerEngine=t,this.recordedMidiTriggers={},this.computerKeyboard=new Uf,this.store=t.store}return Object(y.a)(e,[{key:"midi",get:function(){return this.sequencerEngine.midi}},{key:"hasKeyMapping",value:function(e){return e in this.keyMappings}},{key:"deleteKeyMapping",value:function(e){delete this.keyMappings[e],this.sequencerEngine.store.dispatch(Object(c.Xb)(this.keyMappings))}},{key:"deleteMidiMapping",value:function(e){delete this.padMappings[e];var t=Object.keys(this.midiMappings)[0];this.sequencerEngine.store.dispatch(Object(c.yc)(this.midiMappings[t]))}},{key:"deleteTrack",value:function(e){this.keyMappings=this.deleteHelper(this.keyMappings,e),this.midiMappings=this.deleteMidiHelper(this.midiMappings,e),this.sequencerEngine.store.dispatch(Object(c.Xb)(this.keyMappings));var t=Object.keys(this.midiMappings)[0];this.sequencerEngine.store.dispatch(Object(c.yc)(this.midiMappings[t]))}},{key:"deleteMidiHelper",value:function(e,t){var n={};for(var r in e)n[r]=this.deleteHelper(e[r],t);return n}},{key:"deleteHelper",value:function(e,t){var n={};for(var r in e){e[r].trackNumber===t&&delete e[r]}for(var a in e){var i=e[a];t>=i.trackNumber?n[a]=i:t<i.trackNumber&&(i.trackNumber--,n[a]=i)}return n}},{key:"hasMidiMappings",value:function(){return Object.keys(this.midiMappings).length>0}},{key:"onKeyDown",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;e=e.toLowerCase(),this.handleOctaves(e);var o=r?Ic.a.fromString(e).getTranspose():this.computerKeyboard.getTransposeForKey(e),s=o%12;s<0&&(s=12+s),this.store.dispatch(Object(c.cc)(o)),this.onNoteDown(e,o,t,n,a,r,i)}},{key:"onNoteDown",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;if(0!==this.sequencerEngine.tracks.length){var s=this.getToggledTracks(a,i);if(s.length>0){if(void 0===t)return;s.filter(function(e){return!e.rolling}).forEach(function(e){var n=Gf;n.copyFrom(e.trackData),n.slice=0,n.duration=void 0,n.transpose=t+e.trackData.transpose,n.velocity=null===o?e.trackData.velocity:o,e.instrument&&(n.release=null),e.midiEffects.liveInputTrigger(n)})}else if(e in this.keyMappings)this.keyMappings[e].trigger(this.sequencerEngine,n);else if(t in this.keyMappings)this.keyMappings[t].trigger(this.sequencerEngine,n);else if(a in this.midiMappings&&e.toUpperCase()in this.midiMappings[a])this.midiMappings[a][e.toUpperCase()].trigger(this.sequencerEngine,n,o,!0);else{var c=this.sequencerEngine.tracks[this.sequencerEngine.cursor.track];if(!c)return;var u=this.getSelectedSlice(c);void 0===a?this.alreadyMapped(c,u)||(this.map(e,this.sequencerEngine.cursor.track,this.getSelectedSlice(c)),this.onNoteDown(e,t,n,r,a,i,o)):this.alreadyMidiMapped(a,c,u)||(this.midiMap(a,e,this.sequencerEngine.cursor.track,u),this.onNoteDown(e,t,n,r,a,i,o))}}}},{key:"handleOctaves",value:function(e){"z"===e?this.computerKeyboard.downOctave():"x"===e&&this.computerKeyboard.upOctave()}},{key:"getToggledTracks",value:function(e,t){var n=this.sequencerEngine.subSequences.flatMap(function(e){return e.tracks}).filter(function(e){return e.isEnabled});return n=n.filter(function(n){return n.midiInputs.accepts(t,e)})}},{key:"recordHit",value:function(e,t,n,r,a,i){var o=this.getToggledTracks(a,t);if(!(o.length>0)){if(e in this.keyMappings){var s=this.keyMappings[e];return new Jf.a(s.track,s.sliceNumber,n,this.sequencerEngine,r)}if(a in this.midiMappings&&e in this.midiMappings[a]){s=this.midiMappings[a][e];return new Jf.a(s.track,s.sliceNumber,n,this.sequencerEngine,r,i)}return null}var c=t?Ic.a.fromString(e).getTranspose():this.computerKeyboard.getTransposeForKey(e);if(void 0!==c)return new Vf(c,o,n,this.sequencerEngine,r,i)}},{key:"getRecordedMidiTrigger",value:function(e,t,n){return new Jf.a(e.track,e.sliceNumber,t,this.sequencerEngine,n)}},{key:"padMappings",get:function(){var e=Object.keys(this.midiMappings);return 0===e.length?{}:this.midiMappings[e[0]]}},{key:"isMidiMapped",value:function(e){return void 0!==this.padMappings[e]}},{key:"alreadyMidiMapped",value:function(e,t,n){if(void 0===this.midiMappings[e])return!1;for(var r in this.midiMappings[e]){var a=this.midiMappings[e][r];if(a.track===t&&a.sliceNumber===n)return!0}return!1}},{key:"getSelectedSlice",value:function(e){return this.sequencerEngine.state.tracks.selectedTrackSlice[e.id]||0}},{key:"alreadyMapped",value:function(e,t){for(var n in this.keyMappings){var r=this.keyMappings[n];if(r.track===e&&r.sliceNumber===t)return!0}return!1}},{key:"map",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.sequencerEngine.keyListener.bindings[e]){var r=this.sequencerEngine.tracks[t];void 0!==r&&(this.keyMappings[e]=new Kf(e,r,n),this.sequencerEngine.store.dispatch(Object(c.Xb)(this.keyMappings)))}}},{key:"midiMap",value:function(e,t,n,r){var a=this.sequencerEngine.tracks[n];if(void 0!==a){t=t.toUpperCase();var i=new Kf(t,a,r);e in this.midiMappings||(this.midiMappings[e]={}),this.midiMappings[e][t]=i;var o={};for(var s in this.midiMappings){var u=this.midiMappings[s];for(var l in u)o[l]=u[l]}this.store.dispatch(Object(c.yc)(o)),this.store.dispatch(Object(c.bc)(t))}}},{key:"getMappings",value:function(){return this.keyMappings}},{key:"getMidiMappings",value:function(){return this.midiMappings}},{key:"deleteMappingsForTrack",value:function(e){for(var t in this.keyMappings)this.keyMappings[t].trackNumber===e&&delete this.keyMappings[t];for(var n in this.midiMappings){var r=this.midiMappings[n];for(var a in r)r[a].trackNumber==e&&delete r[a]}}}]),e}(),Kf=function(){function e(t,n,r){Object(m.a)(this,e),this.key=t,this.track=n,this.trackNumber=n.trackNumber,this.sliceNumber=r}return Object(y.a)(e,[{key:"trigger",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=(arguments.length>3&&arguments[3],this.track);if(!r.rolling){var a=Gf;a.copyFrom(r.trackData),a.slice=this.sliceNumber,a.velocity=n,a.duration=void 0,r.midiEffects.liveInputTrigger(a)}e.selectMidiTrack(this.trackNumber),e.dispatch(Object(c.Dd)(r.id,this.sliceNumber))}}]),e}(),Qf=Wf,Zf=n(977),Yf=n(435),$f=n(975),Xf=window.AudioContext||window.webkitAudioContext,eh=function(e,t){var n=e.location&&e.location.search;if(window.urlSearchParams=new URLSearchParams(e.location.search),n)for(var r=n.split("&"),a=0;a<r.length;a++){var i=r[a].split("=");if(i[0].includes(t))return i[1]}},th=(n(1942),n(1943),n(1944),n(1945),n(1946),n(1947),n(1948),n(1949),n(1950),n(1951),n(1952),n(1953),n(1954),n(1955),n(1956),n(1957),n(1958),n(1959),n(1960),n(1961),n(1962),n(1963),n(1964),n(1965),n(1966),n(1967),Object(s.b)(function(e){return{modal:e.zobject.modal}},function(e){return{setZObjectModal:function(t){return e(Object(c.gf)(t))}}})(function(e){var t=e.setZObjectModal,n=e.modal,r=Object(a.useCallback)(function(){n.zobject.sendMessage(n.zobject.outputByNumber(0),bt.a),t(void 0)},[n]),o=Object(a.useCallback)(function(){n.zobject.sendMessage(n.zobject.outputByNumber(1),bt.a),t(void 0)},[n]);if(!n)return"";n.zobject,n.text;var s=n.link,c=n.okButtonText,u=n.cancelButtonText;return i.a.createElement(Bl.a,{dialogClassName:"zobject-modal rack-modal",show:!0},i.a.createElement(Bl.a.Body,null,i.a.createElement("div",null,n.text),s&&i.a.createElement("div",{className:"modal-links"},Array.isArray(s)?s.map(function(e){return i.a.createElement("div",{className:"modal-link"},i.a.createElement("div",{className:"link-text"},e.text),i.a.createElement("a",{target:"_blank",href:e.url},"\u2197"))}):i.a.createElement("div",{className:"modal-link"},i.a.createElement("div",{className:"link-text"},s.text),i.a.createElement("a",{target:"_blank",href:s.url},"\u2197")))),i.a.createElement(Bl.a.Footer,null,i.a.createElement(Hr.a,{variant:"secondary",onClick:r},c||"Ok"),u&&i.a.createElement(Hr.a,{variant:"primary",onClick:o},u||"Cancel")))})),nh=Object(s.b)(function(e,t){return{progressbar:e.zobject.progressbar}},function(e){return{}})(function(e){var t=e.progressbar;return t?i.a.createElement(hi.a,{intervalPiece:1,width:200,intervalTime:100,text:t}):""});t.default=Object(s.b)(function(e,t){return{loadingSequence:e.sequencer.loadingSequence,loading:e.sequencer.loadingSequence[window.projectId],isPlaying:e.sequencer.isMainPlaying,progressbar:e.zobject.progressbar,debug:e.zobject.debug,playerUnlocked:e.nft.playerUnlocked,usePlayButton:e.nft.usePlayButton}},function(e){return{setFullScreenZObject:function(t){return e(Object(c.Gb)(t))},setIsPlayingMix:function(t){return e(Object(c.Pb)(t))}}})(function(e){var t=Object(a.useRef)(0),o=Object(a.useRef)(void 0),s=e.zObject?[void 0,e.sequencerEngine]:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=Object(a.useState)(new Zf.a(e.store)),s=Object(r.a)(o,2),c=s[0],u=(s[1],Object(a.useState)(void 0)),l=Object(r.a)(u,2),f=l[0],h=l[1],d=Object(a.useState)(void 0),p=Object(r.a)(d,2),v=p[0],m=p[1];return Object(a.useEffect)(function(){if(t){var r,a=document.getElementsByTagName("html")[0];i&&a.setAttribute("class","bad-scroll");var o=eh(e,"sampleRate");if(o)If.a.setSampleRate(parseInt(o));else if(!e.skipSampleRate){if(window.isNFT||!$i.a.getItem("sampleRate")&&!$i.a.getItem("latencyHint"))If.a.setSampleRate(44100);else{var s=$i.a.getItem("sampleRate"),u=$i.a.getItem("latencyHint")||"interactive",l=new Xf({sampleRate:s?parseFloat($i.a.getItem("sampleRate")):2e4,latencyHint:u});Y.a.setContext(l),window.context=l,r=u,If.a.updateBuffer()}window.isNFT||(qf.a.setStore(e.store),qf.a.setEthereum(Xi.a),qf.a.checkLogin().then(function(){Xi.a.guilds.initGuilds(),Xi.a.guilds.acceptAnyNewRequests(),qf.a.appear()}))}Lf(),Xi.a.cache=c,Xi.a.cache.loadIndex(),Xi.a.store=e.store,Xi.a.crypto.store=e.store,Promise.resolve().then(n.bind(null,1968)).then(function(t){var n=new t.default(e.store);n.latencyHint=r,n.setScripting(new $f.a(n)),n.connectToKeyboardEngine(new Qf(n)),n.ethereumCache=c,h(new Yf.a(c,n)),e.setSequencerEngine&&e.setSequencerEngine(n),m(n),window.addEventListener("beforeunload",function(e){return e.returnValue="Please dont leave",e});var a=void 0!==v?e.sequencerEngine.getSequenceId():e.match&&void 0!=e.match.params.sequenceId?e.match.params.sequenceId:null,i=e.location&&e.location.search;if(window.urlSearchParams=new URLSearchParams(e.location.search),i)for(var o=i.split("&"),s=0;s<o.length;s++){var u=o[s].split("=");if(u[0].includes("token")){var l=u[1];void 0!==l&&(n.tokenID=parseInt(l),console.log("parsed tokenID=",n.tokenID))}if(u[0].includes("songId")){var f=u[1];void 0!==f&&(n.songId=parseInt(f))}u[0].includes("gallery")&&(console.log("foudd gallery"),n.galleryView=!0)}window.projectId?n.loadSequence(window.projectId):null==a?n.loadNewSequence():window.isNFT?n.loadSequence(a):qf.a.checkLogin().then(function(){return n.loadSequence(a)}),Object(zf.a)(n)})}},[t]),[c,v,f]}(e),c=Object(r.a)(s,3),u=(c[0],c[1]),h=(c[2],Object(a.useRef)(void 0)),d=Object(a.useState)(!1),v=Object(r.a)(d,2),m=v[0],y=v[1];Object(a.useEffect)(function(){setTimeout(function(){e.zObject&&e.zObject.sequencerEngine&&e.zObject.sequencerEngine.refreshUniform()},10)},[e.zObject]);var b=Object(a.useRef)({}),g=Le(),O=g.sizeRef,j=g.ordering,k=g.setOrdering,w=Object(a.useRef)(void 0),x=Object.keys(e.loadingSequence).some(function(t){return e.loadingSequence[t]});!function(e){var t=Object(a.useState)(void 0),n=Object(r.a)(t,2),i=n[0],o=n[1];Object(a.useEffect)(function(){e.sequencerEngine&&o(new _e(e.sequencerEngine))},[e.sequencerEngine]),Object(a.useEffect)(function(){if(i)return window.addEventListener("keydown",i.onKeyDown),window.addEventListener("keyup",i.onKeyUp),function(){window.removeEventListener("keydown",i.onKeyDown),window.removeEventListener("keyup",i.onKeyUp)}},[i])}({sequencerEngine:e.sequencerEngine?void 0:u}),Object(a.useEffect)(function(){return o.current.addEventListener("mousewheel",E,{passive:!1}),window.addEventListener("mousewheel",E,{passive:!1}),function(){o.current&&o.current.removeEventListener("mousewheel",E,{passive:!1}),window.removeEventListener("mousewheel",E,{passive:!1})}},[]);var S,P,E=function(t){e.showClickToStart||t.preventDefault()},T=!1;e.zObject?P=e.zObject:!x&&u&&u.subSequences&&u.subSequences[0]&&(P=u.nftZObject||u.subSequences[0].zObjects.find(function(e){return"logos"===e.args[0]})||u.subSequences[0].zObjects.find(function(e){return"three.canvas"===e.name}),S=u.subSequences[0].zObjects.find(function(e){return"ui.hidePlayUntil"===e.name}),u.disablePlay&&(T=!0)),!x&&u&&u.subSequences&&u.subSequences[0]&&P&&"three.canvas"===P.name&&(w.current||(w.current={width:P.width,height:P.height}),P.attributes["fill full-screen"]&&(P.width=window.innerWidth,P.height=window.innerHeight,P.effect.sendMessage("size",[P.width,P.height]),Object(f.c)("canvas.size",[P.width,P.height]))),Object(a.useEffect)(function(){y(e.isPlaying),e.isPlaying&&(h.current=!0)},[e.isPlaying,y]),Object(a.useEffect)(function(){!e.sequencerEngine&&e.loadingSequence&&Object.keys(e.loadingSequence).length>0&&!x&&(Fe()(Y.a.Master.context,".editor"),e.screenshot&&u.play())},[x,e.loadingSequence,u]),Object(a.useEffect)(function(){return function(){e.zObject&&w.current&&(e.zObject.width=w.current.width,e.zObject.height=w.current.height)}},[]),console.log("ZPLHYER UNLOCKED=",S,e.playerUnlocked);var A=!S||e.playerUnlocked,M=Object(a.useCallback)(function(t){t&&t.stopPropagation(),A&&(e.sequencerEngine&&!e.showClickToStart||(e.setIsPlayingMix(!0),h.current?(u.play(),y(!m)):(setTimeout(function(){u.play(),y(!0)},150),h.current=!0)))},[A,u,y,m]);t.current++;var R=!e.sequencerEngine&&e.loadingSequence&&Object.keys(e.loadingSequence).length>0&&!x;return i.a.createElement(a.Suspense,{fallback:function(){return i.a.createElement("div",null,"Loading...")}},i.a.createElement("div",{onMouseDown:function(){return u.play()},className:"v3 nft-mode no-select"},e.debug&&i.a.createElement("div",{className:"z-debug"},e.debug),i.a.createElement(th,null),i.a.createElement(nh,null),i.a.createElement("div",{className:"editor"},!A||T||h.current&&!e.usePlayButton||e.screenshot||e.sequencerEngine&&!e.showClickToStart||e.isPlaying&&!e.usePlayButton?"":i.a.createElement("div",{onMouseDown:!e.progressbar&&!x||e.showClickToStart?M:function(){return[]},className:t.current<=1||x||e.progressbar?"click-to-start loading ":"click-to-start"+(h.current?" playing-nft":"")},i.a.createElement("div",{className:"image-wrapper"}),!x&&i.a.createElement("span",{className:"inner-start"},i.a.createElement("span",{className:"start-text"},i.a.createElement("div",{className:e.isPlaying?"play-button-start playing":"play-button-start"})))),i.a.createElement("div",{className:"nft-viewer",ref:o},!e.isMulti&&e.sequencerEngine&&i.a.createElement("img",{className:"expand-icon",onClick:function(){e.setFullScreenZObject(void 0)},src:"/expand-icon.svg"}),x?i.a.createElement(Nf,{sequencerEngine:u}):"",!e.sequencerEngine&&!e.usePlayButton&&i.a.createElement(U,{sequencerEngine:u}),P&&i.a.createElement(Rf,{scale:1,forceShow:!0,sequencerEngine:u,isMainNFT:!0,ordering:j,setOrdering:k,setSize:function(){return[]},sizeRef:O,elements:b,containerRef:o,zobject:P}),!window.isNFT&&i.a.createElement(l,{sequencerEngine:u}),R&&!u.galleryView&&i.a.createElement(p,{sequencerEngine:u})))))})}])]);
//# sourceMappingURL=3.54f3d3f6.chunk.js.map