(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{2456:function(e,t,n){},2457:function(e,t,n){},2458:function(e,t,n){},2459:function(e,t,n){},2460:function(e,t,n){},2461:function(e,t,n){},2462:function(e,t,n){},2463:function(e,t,n){},2464:function(e,t,n){},2465:function(e,t,n){},2466:function(e,t,n){},2467:function(e,t,n){},2468:function(e,t,n){},2469:function(e,t,n){},2470:function(e,t,n){},2471:function(e,t,n){},2472:function(e,t,n){},2473:function(e,t,n){},2474:function(e,t,n){},2475:function(e,t,n){},2476:function(e,t,n){},2477:function(e,t,n){},2478:function(e,t,n){},2479:function(e,t,n){},2483:function(e,t,n){},2639:function(e,t,n){"use strict";n.r(t);var i=n(110),s=n(3),r=n.n(s),c=n(23),a=n(11),o=n(55),u=(n(2456),Object(o.b)(function(e,t){return{minimizedSubPatches:e.zobject.minimizedSubPatches,viewableSubPatches:e.zobject.viewableSubPatches}},function(e){return{setViewableSubPatches:function(t){return e(Object(c.dg)(t))},setMinimizedSubPatches:function(t){return e(Object(c.Ic)(t))}}})(function(e){var t=e.minimizedSubPatches,n=e.viewableSubPatches,i=e.setViewableSubPatches,c=e.setMinimizedSubPatches,o=Object(s.useCallback)(function(e){if(n.includes(e))return t.includes(e)||c([].concat(Object(a.a)(t),[e])),void i(Object(a.a)(n.filter(function(t){return t!==e})));i([].concat(Object(a.a)(n),[e]))},[t,n]),u=[].concat(Object(a.a)(t),Object(a.a)(n.filter(function(e){return!t.includes(e)})));return r.a.createElement("div",{className:"minimized-subpatches"},u.map(function(e){return r.a.createElement("div",{onClick:function(){return o(e)},className:n.includes(e)?"subpatch-option viewing":"subpatch-option"},r.a.createElement("img",{src:"/subpatch-light.svg"}),e.name())}))})),l=Object(o.b)(function(e,t){return{minimizedSubPatches:e.zobject.minimizedSubPatches,viewableSubPatches:e.zobject.viewableSubPatches}},function(e){return{}})(function(e){var t=e.minimizedSubPatches,n=e.viewableSubPatches;return 0===t.length&&0===n.length?"":r.a.createElement("div",{onClick:function(e){return e.stopPropagation()},onMouseDown:function(e){return e.stopPropagation()},className:"subpatch-dock"},r.a.createElement(u,null))}),h=n(142),d=n(205),f=n.n(d),g=(n(2457),Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.sequencerEngine,n=Object(s.useState)(!1),c=Object(i.a)(n,2),a=c[0],o=c[1],u=Object(s.useState)(),l=Object(i.a)(u,2),h=l[0],d=l[1],g=Object(s.useState)(!1),p=Object(i.a)(g,2),y=p[0],b=p[1],m=Object(s.useState)(),v=Object(i.a)(m,2),k=v[0],S=v[1];Object(s.useEffect)(function(){window.addEventListener("click",w)},[o]);var w=Object(s.useCallback)(function(){o(!1)},[o]);Object(s.useEffect)(function(){if(t){var e=t.currentSubSequence.findNodeByName("spore.stems")[0];console.log("spore stems found=",e),e&&(d(e.effect),S(e.effect.playlist[0]))}},[t]);var j="spores-playlister";return a&&(j+=" showing"),h?r.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:j},a?r.a.createElement("div",{className:"spores-playlist"},r.a.createElement("div",{onClick:function(){return o(!1)},className:"arrow-down"}),r.a.createElement("div",{className:"artist-name"},"Keyon Christ"),h.playlist.map(function(e){return r.a.createElement("div",{onClick:function(n){k!==e?(t.stop(),t.seekToTrackStep(0),S(e),b(!0),h.loadSong(e).then(function(e){b(!1),setTimeout(function(){t.play()},150)})):o(!1)},className:e===k?"song-item current":"song-item"},r.a.createElement("div",{className:"song-title"},e.name),e===k&&y&&r.a.createElement(f.a,{sizeUnit:"px",className:"pulse-loader",size:6,color:"#aab7ba",loading:!0}))})):r.a.createElement("img",{onClick:function(){return o(!0)},className:"pushable spores-icon",src:(window.isNFT?"":"/")+"spores-icon-glow2.svg"})):""})),p=n(1388),y=n(26);n(2458),Object(o.b)(function(e,t){return{enableRollViewer:e.sequencer.enableRollViewer,viewMode:e.sequencer.viewMode,halftime:t.sequencerEngine&&t.sequencerEngine.keyListener&&t.sequencerEngine.keyListener.halftime,sequenceRolling:e.sequencer.trackRolling&&t.sequencerEngine&&t.sequencerEngine.isSequenceRolling,rollResolution:e.sequencer.resolution}},function(e){return{}})(function(e){var t=e.viewMode,n=e.sequenceRolling,i=e.enableRollViewer,s=e.sequencerEngine,c=e.halftime,a=e.rollResolution;return n||c?t===y.a?"":i?r.a.createElement("div",{className:"rolling-viewer"},r.a.createElement("div",{className:"roll-text"},n?r.a.createElement("span",null,"ROLLING ",a.toString()):r.a.createElement("span",null,"HALF-TIME"),r.a.createElement(p.a,{sequencerEngine:s}))):"":""});var b=function(e){return{type:"walk",value:e}},m=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20;return{depth:function(n){return e(t,n,i,s)},tension:function(s){return e(t,n,i,s)},start:function(t){return e(t,n,i,s)},end:function(i){return e(t,n,i,s)},mirror:function(){return e(t,-n,i,s)},type:"smooth",value:[t,n,i,s]}},v=(n(2459),n(559)),k=(n(2460),Object(o.b)(function(e,t){return{songPlaying:e.nft.sporesSongPlaying,playing:t.sequencerEngine.playing}},function(e){return{}})(function(e){var t=Object(s.useState)(!1),n=Object(i.a)(t,2),c=(n[0],n[1]);Object(s.useEffect)(function(){return Object(h.subscribe)("mouse-down",o),window.addEventListener("mouseup",u),function(){Object(h.unsubscribe)("mouse-down",o),window.removeEventListener("mouseup",u)}},[c]);var o=Object(s.useCallback)(function(){console.log("on mouse down"),c(!0)},[c]),u=Object(s.useCallback)(function(){console.log("on mouse up"),c(!1)},[c]),l=Object(s.useRef)(),d=Object(s.useState)(null),f=Object(i.a)(d,2),g=f[0],p=f[1],y=Object(s.useState)([]),k=Object(i.a)(y,2),S=k[0],w=k[1];Object(s.useEffect)(function(){Object(v.a)().then(function(t){var n=t.filter(function(e){return(19===e.songId||20===e.songId||e.songId>=25)&&(void 0===e.attributes["hide-song"]||!e.attributes["hide-song"])}),i=[47,48,42,40,46,26,31,41,30,37,49,28,29,44,25,43,39,27].map(function(e){return n.find(function(t){return t.songId===e})});if(n.filter(function(e){return!i.includes(e)}).forEach(function(e){i.push(e)}),i=i.filter(function(e){return e.songId>54||e.songId<=20}),n=i,console.log("songs =",t.map(function(e){return e.title})),e.sequencerEngine&&e.sequencerEngine.songId){var s=n.find(function(t){return t.songId===e.sequencerEngine.songId});if(s)return void w([s].concat(Object(a.a)(n.filter(function(t){return t.songId!==e.sequencerEngine.songId}))))}w(Object(a.a)(n))})},[]);var j=Object(s.useRef)(void 0),M=Object(s.useState)(!1),E=Object(i.a)(M,2),I=E[0],O=E[1],N=Object(s.useState)({14703:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMTAgMTEwIj48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9Imd6ciIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSg2Ni40NTc4IDI0LjM1NzUpIHNjYWxlKDc1LjI5MDgpIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgcj0iMSIgY3g9IjAiIGN5PSIwJSI+PHN0b3Agb2Zmc2V0PSIxNS42MiUiIHN0b3AtY29sb3I9ImhzbCgyMiwgNzMlLCA4NiUpIiAvPjxzdG9wIG9mZnNldD0iMzkuNTglIiBzdG9wLWNvbG9yPSJoc2woMjIsIDgxJSwgNzglKSIgLz48c3RvcCBvZmZzZXQ9IjcyLjkyJSIgc3RvcC1jb2xvcj0iaHNsKDY3LCA5MSUsIDYzJSkiIC8+PHN0b3Agb2Zmc2V0PSI5MC42MyUiIHN0b3AtY29sb3I9ImhzbCg3MSwgOTYlLCA1MSUpIiAvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iaHNsKDcxLCA5NiUsIDUwJSkiIC8+PC9yYWRpYWxHcmFkaWVudD48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNSw1KSI+PHBhdGggZD0iTTEwMCA1MEMxMDAgMjIuMzg1OCA3Ny42MTQyIDAgNTAgMEMyMi4zODU4IDAgMCAyMi4zODU4IDAgNTBDMCA3Ny42MTQyIDIyLjM4NTggMTAwIDUwIDEwMEM3Ny42MTQyIDEwMCAxMDAgNzcuNjE0MiAxMDAgNTBaIiBmaWxsPSJ1cmwoI2d6cikiIC8+PHBhdGggc3Ryb2tlPSJyZ2JhKDAsMCwwLDAuMDc1KSIgZmlsbD0idHJhbnNwYXJlbnQiIHN0cm9rZS13aWR0aD0iMSIgZD0iTTUwLDAuNWMyNy4zLDAsNDkuNSwyMi4yLDQ5LjUsNDkuNVM3Ny4zLDk5LjUsNTAsOTkuNVMwLjUsNzcuMywwLjUsNTBTMjIuNywwLjUsNTAsMC41eiIgLz48L2c+PC9zdmc+",10828:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMTAgMTEwIj48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9Imd6ciIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSg2Ni40NTc4IDI0LjM1NzUpIHNjYWxlKDc1LjI5MDgpIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgcj0iMSIgY3g9IjAiIGN5PSIwJSI+PHN0b3Agb2Zmc2V0PSIxNS42MiUiIHN0b3AtY29sb3I9ImhzbCgyMiwgNzMlLCA4NiUpIiAvPjxzdG9wIG9mZnNldD0iMzkuNTglIiBzdG9wLWNvbG9yPSJoc2woMjIsIDgxJSwgNzglKSIgLz48c3RvcCBvZmZzZXQ9IjcyLjkyJSIgc3RvcC1jb2xvcj0iaHNsKDY3LCA5MSUsIDYzJSkiIC8+PHN0b3Agb2Zmc2V0PSI5MC42MyUiIHN0b3AtY29sb3I9ImhzbCg3MSwgOTYlLCA1MSUpIiAvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iaHNsKDcxLCA5NiUsIDUwJSkiIC8+PC9yYWRpYWxHcmFkaWVudD48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNSw1KSI+PHBhdGggZD0iTTEwMCA1MEMxMDAgMjIuMzg1OCA3Ny42MTQyIDAgNTAgMEMyMi4zODU4IDAgMCAyMi4zODU4IDAgNTBDMCA3Ny42MTQyIDIyLjM4NTggMTAwIDUwIDEwMEM3Ny42MTQyIDEwMCAxMDAgNzcuNjE0MiAxMDAgNTBaIiBmaWxsPSJ1cmwoI2d6cikiIC8+PHBhdGggc3Ryb2tlPSJyZ2JhKDAsMCwwLDAuMDc1KSIgZmlsbD0idHJhbnNwYXJlbnQiIHN0cm9rZS13aWR0aD0iMSIgZD0iTTUwLDAuNWMyNy4zLDAsNDkuNSwyMi4yLDQ5LjUsNDkuNVM3Ny4zLDk5LjUsNTAsOTkuNVMwLjUsNzcuMywwLjUsNTBTMjIuNywwLjUsNTAsMC41eiIgLz48L2c+PC9zdmc+",31557:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMTAgMTEwIj48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9Imd6ciIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSg2Ni40NTc4IDI0LjM1NzUpIHNjYWxlKDc1LjI5MDgpIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgcj0iMSIgY3g9IjAiIGN5PSIwJSI+PHN0b3Agb2Zmc2V0PSIxNS42MiUiIHN0b3AtY29sb3I9ImhzbCgyMiwgNzMlLCA4NiUpIiAvPjxzdG9wIG9mZnNldD0iMzkuNTglIiBzdG9wLWNvbG9yPSJoc2woMjIsIDgxJSwgNzglKSIgLz48c3RvcCBvZmZzZXQ9IjcyLjkyJSIgc3RvcC1jb2xvcj0iaHNsKDY3LCA5MSUsIDYzJSkiIC8+PHN0b3Agb2Zmc2V0PSI5MC42MyUiIHN0b3AtY29sb3I9ImhzbCg3MSwgOTYlLCA1MSUpIiAvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iaHNsKDcxLCA5NiUsIDUwJSkiIC8+PC9yYWRpYWxHcmFkaWVudD48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNSw1KSI+PHBhdGggZD0iTTEwMCA1MEMxMDAgMjIuMzg1OCA3Ny42MTQyIDAgNTAgMEMyMi4zODU4IDAgMCAyMi4zODU4IDAgNTBDMCA3Ny42MTQyIDIyLjM4NTggMTAwIDUwIDEwMEM3Ny42MTQyIDEwMCAxMDAgNzcuNjE0MiAxMDAgNTBaIiBmaWxsPSJ1cmwoI2d6cikiIC8+PHBhdGggc3Ryb2tlPSJyZ2JhKDAsMCwwLDAuMDc1KSIgZmlsbD0idHJhbnNwYXJlbnQiIHN0cm9rZS13aWR0aD0iMSIgZD0iTTUwLDAuNWMyNy4zLDAsNDkuNSwyMi4yLDQ5LjUsNDkuNVM3Ny4zLDk5LjUsNTAsOTkuNVMwLjUsNzcuMywwLjUsNTBTMjIuNywwLjUsNTAsMC41eiIgLz48L2c+PC9zdmc+",2001:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMTAgMTEwIj48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9Imd6ciIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSg2Ni40NTc4IDI0LjM1NzUpIHNjYWxlKDc1LjI5MDgpIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgcj0iMSIgY3g9IjAiIGN5PSIwJSI+PHN0b3Agb2Zmc2V0PSIxNS42MiUiIHN0b3AtY29sb3I9ImhzbCgyMiwgNzMlLCA4NiUpIiAvPjxzdG9wIG9mZnNldD0iMzkuNTglIiBzdG9wLWNvbG9yPSJoc2woMjIsIDgxJSwgNzglKSIgLz48c3RvcCBvZmZzZXQ9IjcyLjkyJSIgc3RvcC1jb2xvcj0iaHNsKDY3LCA5MSUsIDYzJSkiIC8+PHN0b3Agb2Zmc2V0PSI5MC42MyUiIHN0b3AtY29sb3I9ImhzbCg3MSwgOTYlLCA1MSUpIiAvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iaHNsKDcxLCA5NiUsIDUwJSkiIC8+PC9yYWRpYWxHcmFkaWVudD48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNSw1KSI+PHBhdGggZD0iTTEwMCA1MEMxMDAgMjIuMzg1OCA3Ny42MTQyIDAgNTAgMEMyMi4zODU4IDAgMCAyMi4zODU4IDAgNTBDMCA3Ny42MTQyIDIyLjM4NTggMTAwIDUwIDEwMEM3Ny42MTQyIDEwMCAxMDAgNzcuNjE0MiAxMDAgNTBaIiBmaWxsPSJ1cmwoI2d6cikiIC8+PHBhdGggc3Ryb2tlPSJyZ2JhKDAsMCwwLDAuMDc1KSIgZmlsbD0idHJhbnNwYXJlbnQiIHN0cm9rZS13aWR0aD0iMSIgZD0iTTUwLDAuNWMyNy4zLDAsNDkuNSwyMi4yLDQ5LjUsNDkuNVM3Ny4zLDk5LjUsNTAsOTkuNVMwLjUsNzcuMywwLjUsNTBTMjIuNywwLjUsNTAsMC41eiIgLz48L2c+PC9zdmc+"}),D=Object(i.a)(N,2),T=D[0],A=D[1];Object(s.useCallback)(function(e,t){console.log("select"),e.stopPropagation(),j.current=!0;var n=document.referrer;window.parent&&n&&window.parent.postMessage({type:"lootbox-item-selected",body:t},n),O(!0)},[O]);Object(s.useEffect)(function(){window.addEventListener("message",P)},[A]),Object(s.useEffect)(function(){if(e.playing&&!j.current){var t=document.referrer;window.parent&&t&&window.parent.postMessage({type:"lootbox-item-selected",body:Object.keys(T)[0]},t),O(!0)}},[e.playing,T,O]),Object(s.useEffect)(function(){p(null)},[e.songPlaying]);var P=Object(s.useCallback)(function(e){"lootbox"===e.data.type&&A(e.data.body)},[A]),z=(b(5),m().start(8).end(19).tension(32).depth(40),m().start(10).end(19).tension(32).depth(-40),Object(s.useCallback)(function(t,n){if(n.songId===e.songPlaying)e.sequencerEngine.play();else if(n.songId!==e.songPlaying){t.stopPropagation(),p(n.songId),Object(h.publish)("switch-songs",n.songId);var i=document.referrer;window.parent&&i&&window.parent.postMessage({type:"song-selected",body:n.songId},i)}},[e.songPlaying])),q=Object(s.useCallback)(function(){var e=document.referrer;window.parent&&e&&window.parent.postMessage({type:"clip-song",body:!0},e)},[]);return r.a.createElement(r.a.Fragment,null,!I&&r.a.createElement("div",{onMouseUp:function(e){return e.stopPropagation()},onMouseMove:function(e){return e.stopPropagation()},onMouseDown:function(e){return e.stopPropagation()},onClick:function(){return e.sequencerEngine.play()},className:"main-play-container pushable"},r.a.createElement("img",{className:"main-play-button ",src:"/play-button.svg"})),r.a.createElement("div",{onMouseUp:function(e){return e.stopPropagation()},onMouseMove:function(e){return e.stopPropagation()},onMouseDown:function(e){return e.stopPropagation()},className:Object.keys(T).length>6?"bigger loot-box":"loot-box"},r.a.createElement("div",{className:"z-30 loot-inner flex"},r.a.createElement("div",{ref:l,className:"flex flex-1 songs-flex"},r.a.createElement("img",{onClick:q,className:"clip-btn pushable",src:"/clip-button.svg"}),S.map(function(t){return r.a.createElement("div",{onMouseDown:function(e){return z(e,t)},className:(t.songId===g?"loading-song ":t.songId===e.songPlaying?"current-playing ":"")+"song-option-container "},r.a.createElement("img",{style:{borderRadius:16},className:"pushable song-selector-opt md:h-16 md:w-16 rounded mx-1",src:"https://spores-coverart.s3.us-east-2.amazonaws.com/"+t.songId}),r.a.createElement("div",{className:"hover-over"},r.a.createElement("div",{className:"text-md song-name"},t.title),r.a.createElement("div",{className:"text-md artist-name"},t.artist)))})))))})),S=n(42),w=n.n(S),j=n(56),M=n(4),E=n(5),I=n(31),O=n(7),N=n(8),D=n(2),T=n(6),A=n.n(T),P=n(44),z=n(371),q=n(1271),C=n(196),L=n(1325),x=n(420),K=n(9);n(49),n(1378),n(1282);function R(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Z(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,s=function(){};return{s:s,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,c=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){a=!0,r=e},f:function(){try{c||null==n.return||n.return()}finally{if(a)throw r}}}}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function U(e,t){return t===K.g.id?e.mix:e.getSubSequence(t).mix}function H(e){for(var t in e)if(e[t].end>e[t].start)return!1;return!0}var G=function(e,t){var n,i=R(e.subSequences);try{for(i.s();!(n=i.n()).done;){var s=n.value.tracks.find(function(e){return e.id===t});if(s)return s}}catch(r){i.e(r)}finally{i.f()}},J=function(e){var t=e.state,n=t.arrangement.rowSelections;if(H(n)){var i=t.arrangement.selectedEvents,s=t.arrangement.selectedRows;if(void 0!==s&&0!==s.length){var r=s[0];for(var a in i){var o=parseInt(a),u=i[a];if(o!==K.a){var l=W(e,r);void 0!==u.parentEvent?l.dispatch(Object(x.a)(u.parentEvent,u)):l.dispatch(Object(x.b)(u,!0))}else V(e,u)}e.dispatch(Object(c.Wd)(void 0))}}else!function(e,t){for(var n in t)G(e,n)||U(e,n).dispatch(Object(x.c)(t[n]))}(e,n)},B=function(e,t){var n={};n[t.id]=t,e.dispatch(Object(c.Wd)(n)),e.state.arrangement.patternSelected&&e.dispatch(Object(c.F)(t)),e.dispatch(Object(c.C)(t.step))},F=function(e){var t=e.arrangement.selectedEvents;if(t&&0!==Object.keys(t).length)return t[Object.keys(t)[0]]},W=function(e,t){return t===K.g.id?e.mix:e.getSubSequence(t).mix},V=function(e,t){if(void 0===e.state.keyboard.selectedPianoRollSteps){var n=t.track,i=n.patterns.indexOf(t);n.deletePattern(i),e.switchToPattern(0),n.updateSteps(),e.dispatch(Object(c.H)([]))}},Y=n(302),Q=n(83),X=n(21);function $(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,s=function(){};return{s:s,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,c=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){a=!0,r=e},f:function(){try{c||null==n.return||n.return()}finally{if(a)throw r}}}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var ee=new X.a(32,!1),te=function(e,t){e.sequencerEngine.dispatch(Object(c.ge)(t))},ne=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ee;t=ee.transformStepAtResolution2(t,n);for(var i=e.pattern,s=i.stepBuckets,r=t+1;r<s.length;r++)if(s[r].anyOn())return n.transformStepAtResolution2(r,ee);return n.transformStepAtResolution2(i.stepBuckets.length,ee)},ie=n(1318),se=n(155),re=n(62),ce={2:new X.a(4,!1),3:new X.a(4,!0),4:new X.a(8,!1),5:new X.a(8,!0),6:new X.a(16,!1),7:new X.a(16,!0),8:new X.a(32,!1),9:new X.a(32,!0)},ae=n(51),oe=n(43),ue=n(45),le=n(596);function he(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,i=Object(D.a)(e);if(t){var s=Object(D.a)(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return Object(N.a)(this,n)}}function de(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return fe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fe(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,s=function(){};return{s:s,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,c=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){a=!0,r=e},f:function(){try{c||null==n.return||n.return()}finally{if(a)throw r}}}}function fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ge(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,i=Object(D.a)(e);if(t){var s=Object(D.a)(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return Object(N.a)(this,n)}}var pe=function(e){Object(O.a)(n,e);var t=ge(n);function n(e,i){var s;return Object(M.a)(this,n),(s=t.call(this)).sequencerEngine=e,s.disableTab=i,s.installation=i,s.store=e.store,s.onKeyDown=s.onKeyDown.bind(Object(I.a)(s)),s.onKeyUp=s.onKeyUp.bind(Object(I.a)(s)),s.keysDown={},s.effectToCopy=void 0,s.sequencerEngine.keyListener=Object(I.a)(s),s.checkMetaKey(),s.lastViewMode=void 0,s.halftime=void 0,s.bindings={},s}return Object(E.a)(n,[{key:"addBinding",value:function(e){this.bindings[e]=!0}},{key:"removeBinding",value:function(e){delete this.bindings[e]}},{key:"checkMetaKey",value:function(){var e=this;setInterval(function(){void 0!==e.lastMetaPressedTime&&((new Date).getTime()-e.lastMetaPressedTime>=5e3&&e.dispatch(Object(c.cb)(!1)))},1e3)}},{key:"onKeyUp",value:function(e){var t=this;this.keysDown[e.key&&e.key.toLowerCase()]=!1,Object(q.a)(e)||("Meta"===e.key||"Control"===e.key?(this.lastMetaPressedTime=void 0,this.dispatch(Object(c.cb)(!1))):"/"===e.key?this.dispatch(Object(c.Oe)(!this.state.spatial.showSearchWindow)):"~"===e.key||"`"===e.key?(void 0!==this.halftime&&(this.sequencerEngine.subSequences.forEach(function(e,n){return e.playhead.speedFactorParameter.set(t.halftime[n],!1)}),this.halftime=void 0),"`"===e.key&&(this.sequencerEngine.sequenceRolling=!1)):Object(oe.a)(e.key)||this.sequencerEngine.keyboardHelper.onKeyUp(e))}},{key:"onKeyDown",value:function(e){var t=this;if((!this.keysDown[e.key&&e.key.toLowerCase()]||e.ctrlKey||e.metaKey)&&(!Object(q.a)(e)||"d"===e.key&&e.metaKey)&&(this.keysDown[e.key&&e.key.toLowerCase()]=!0,!this.state.sequencer.loadingText&&(!this.bindings[e.key]||e.ctrlKey||e.metaKey||this.sequencerEngine.isAnyTrackEnabled()))){if(32==e.keyCode&&e.target==window.document.body){if(e.preventDefault(),(this.viewMode===y.a||this.state.arrangement.looping)&&(this.sequencerEngine.playing||this.dispatch(Object(c.lc)(!0))),window.synthz)return;return this.sequencerEngine.schedulePlay(),!1}var n=e.target===window.document.body;if(this.viMode&&!e.metaKey&&!e.ctrlKey&&!e.ctrlKey){if("Escape"===e.key)return void this.dispatch(Object(c.cg)(!1));if(this.scripting.viCommand(e.key),Object(oe.a)(e.key))return}if("Space"!==e.key){if(!this.viMode&&e.key>="a"&&e.key<="z"&&!e.metaKey&&!e.ctrlKey&&!e.ctrlKey)return this.sequencerEngine.keyboardHelper.onAlphabetKeyDown(e,this.cursor.track),!0;if(this.installation||"x"===e.key&&(e.metaKey||e.ctrlKey)&&this.state.commands.commandInput&&(this.state.commands.commandInput.focus(),this.dispatch(Object(c.db)("M-x"))),"m"===e.key&&(e.ctrlKey||e.metaKey))return e.preventDefault(),this.sequencerEngine.metronomeOn=!this.sequencerEngine.metronomeOn,!1;if("~"===e.key&&(this.halftime=this.sequencerEngine.subSequences.map(function(e){return e.playhead.speedFactorParameter.get()}),this.sequencerEngine.subSequences.forEach(function(e,n){return e.playhead.speedFactorParameter.set(t.halftime[n]/2,!1)})),"n"===e.key&&(e.ctrlKey||e.ctrlKey))return e.preventDefault(),this.selectedTrack.auditionNext(!0,!0),!1;if("R"===e.key){var i,s=de(this.sequencerEngine.subSequences);try{for(s.s();!(i=s.n()).done;){i.value.tracks.forEach(function(e){return e.setIsEnabled(!1)})}}catch(f){s.e(f)}finally{s.f()}}if("p"===e.key&&(e.ctrlKey||e.ctrlKey))return e.preventDefault(),this.selectedTrack.auditionPrevious(!0,!0),!1;if("i"===e.key&&(e.ctrlKey||e.metaKey)){e.preventDefault();var r=this.selectedTrack;!r||this.selectedEffect&&this.selectedEffect.name.includes("Effect Rack")||this.dispatch(Object(c.Kf)(r))}if("Escape"===e.key&&this.dispatch(Object(c.Yb)(void 0)),"g"===e.key&&e.metaKey)return e.preventDefault(),this.planarSelected||this.groupSteps(),!0;if("\\"===e.key&&e.metaKey&&this.dispatch(Object(c.Ze)(!this.state.spatial.sidebarsShowing)),"z"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),e.shiftKey?this.sequencerEngine.operationManager.redo():this.sequencerEngine.operationManager.undo(),!0;if("k"===e.key&&(e.metaKey||e.ctrlKey))return this.midiMapMode===ue.b?this.dispatch(Object(c.Hc)(ue.c)):this.dispatch(Object(c.Hc)(ue.b)),!0;if("y"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),Object(L.b)(this.sequencerEngine),!0;if("j"===e.key&&(e.metaKey||e.ctrlKey))return this.midiMapMode===ue.a?this.dispatch(Object(c.Hc)(ue.c)):this.dispatch(Object(c.Hc)(ue.a)),!0;if("d"===e.key&&(e.ctrlKey||e.metaKey)){if(void 0!==this.selectedEffect&&("Effect Rack"===this.selectedEffect.name||"Midi Effect Rack"===this.selectedEffect.name))return;return e.preventDefault(),e.stopPropagation(),this.selectedZObject&&this.selectedZObject.getObjectType()===C.c?this.sequencerEngine.duplicateTrack(this.sequencerEngine.cursor.track):this.selectedZObject&&this.selectedZObject.getObjectType()===C.e&&this.selectedZObject.duplicate(),!1}if("a"===e.key&&(e.metaKey||e.ctrlKey)){if(e.preventDefault(),this.planarSelected)return;return this.state.automation.show&&this.state.sequencer.showPianoRoll&&this.state.arrangement.bottomMode===re.b?this.selectAllTrackAutomationPoints():this.viewMode===y.a?this.state.arrangement.patternSelected?this.selectAllTrackSteps():this.selectAllTrackAutomationPoints():this.selectAllTrackSteps(),this.dispatch(Object(c.Zd)(void 0)),!1}if("E"===e.key)return e.preventDefault(),this.dispatch(Object(c.Yf)(!this.state.zobject.uxLocked)),!1;if("P"===e.key)return e.preventDefault(),this.state.spatial.showPadSequencer||this.dispatch(Object(c.Cd)(!this.state.spatial.presentationMode)),!1;if("w"===e.key&&(e.ctrlKey||e.ctrlKey))return e.preventDefault(),this.viewMode===y.c&&(this.dispatch(Object(c.Le)(!this.showPianoRoll)),this.dispatch(Object(c.B)(re.c))),!1;if("s"===e.key&&(e.ctrlKey||e.metaKey)){var a=this.selectedTrack.getSamplers()[0];a&&a.autoSlice(4)}else{if("p"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),this.dispatch(Object(c.ne)(void 0)),this.dispatch(Object(c.Le)(!this.showPianoRoll)),this.dispatch(Object(c.B)(re.b)),!1;if("s"===e.key&&(e.metaKey||e.ctrlKey)){if(e.preventDefault(),this.viewMode===y.c){var o=this.selectedTrack,u=this.state.cirklon.cirklonMode[o.id];this.dispatch(Object(c.X)(o.id,"SLOPE"===u?void 0:"SLOPE"))}return!1}if("g"===e.key&&(e.metaKey||e.ctrlKey)){if(e.preventDefault(),this.viewMode===y.c){var l=this.selectedTrack,h=this.state.cirklon.cirklonMode[l.id];this.dispatch(Object(c.X)(l.id,"GANG"===h?void 0:"GANG"))}return!1}}if(!Object(oe.a)(e.key)||this.viewMode===y.c&&this.selectedEffect&&"Plane Parameters"===this.selectedEffect.name)if("="===e.key)this.sequencerEngine.switchToNextPattern();else if("+"===e.key);else if("-"===e.key)this.sequencerEngine.switchToPreviousPattern();else if("]"===e.key)this.dispatch(Object(c.Pe)(!0));else if("c"===e.key&&(e.metaKey||e.ctrlKey))this.copy();else if("v"===e.key&&(e.metaKey||e.ctrlKey))this.paste();else if("b"===e.key&&(e.metaKey||e.ctrlKey))this.duplicateSteps();else{if("l"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),this.legato(),!1;if("r"===e.key&&e.ctrlKey)return e.preventDefault(),this.rollSteps(),!1;if("t"===e.key&&e.ctrlKey)return e.preventDefault(),this.toggleTriplets(),!1;if("Backspace"!=e.key||this.hasHigherOrderSteps())if("`"==e.key)this.sequencerEngine.isSequenceRolling||(this.sequencerEngine.sequenceRolling=!0);else{if("\\"==e.key||"h"==e.key&&e.ctrlKey)return e.preventDefault(),this.hide(),!1;if("o"===e.key&&e.metaKey)console.log("o and metakey"),e.preventDefault(),this.connectLastZObjects();else if("."==e.key)this.record();else if("Meta"===e.key||"Control"===e.key)this.onMetaKeyDown();else if("Tab"!==e.key||this.disableTab)if("'"===e.key)this.onClickRollingMode();else if("Shift"===e.key&&n)this.onShiftKeyDown();else if("ArrowRight"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;this.keyboardContext&&"ztracker"===this.keyboardContext.name?this.onArrowDown(e,!0):this.onArrowRight(e,!0)}else if("ArrowLeft"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;this.keyboardContext&&"ztracker"===this.keyboardContext.name?this.onArrowUp(e,!0):this.onArrowLeft(e,!0)}else{if("ArrowUp"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;return this.keyboardContext&&"ztracker"===this.keyboardContext.name?this.onArrowLeft(e,!0):this.onArrowUp(e)}if("ArrowDown"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;this.keyboardContext&&"ztracker"===this.keyboardContext.name?this.onArrowRight(e,!0):this.onArrowDown(e)}else if("Enter"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;this.onEnterKeyDown()}}else{if(e.preventDefault(),this.isShowingSoundsPane())return void this.hideSidebar();if(this.state.instruments.showingFormants)return;if(this.waveformShowing)return}}else{if(this.sequencerEngine.noDeleteKey)return;if(void 0!==this.selectedFreeze)return void this.deleteSelectedFreeze();if(this.pointsSelected.length>0&&(this.showPianoRoll&&this.state.automation.show||this.viewMode===y.a))this.deleteSelectedPoints();else if(this.viewMode===y.a){var d=this.getSelectedSteps();d&&d.length>0?this.deleteSelectedSteps():J(this.sequencerEngine)}else this.deleteSelectedSteps()}}else if(n)return void this.onNumberKeyDown(e)}}}},{key:"waveformShowing",get:function(){return this.state.sequencer.waveformShowing}},{key:"onNumberKeyDown",value:function(e){var t=parseInt(e.key);if(this.viewMode!==y.a||this.isPlayingMix)if(this.sequencerEngine.rolling&&!e.metaKey){if(t>=2&&t<=9){var n=ce[t];null!==n&&(this.sequencerEngine.resolution=n)}}else if(e.ctrlKey){e.preventDefault();var i=t-1;this.sequencerEngine.tracks[i]&&(this.sequencerEngine.selectTrack(i),this.sequencerEngine.tracks[i].toggleEnabled())}else{var s=t;this.sequencerEngine.switchToPattern(s-1)}}},{key:"onMetaKeyDown",value:function(){this.dispatch(Object(c.cb)(!0)),this.lastMetaPressedTime=(new Date).getTime()}},{key:"hide",value:function(){var e=this;if(this.state.tracks.tracksToHide.length>0)this.dispatch(Object(c.Qf)([]));else{if(!this.sequencerEngine.tracks.some(function(e){return e.isEffectsShowing()})){var t=this.sequencerEngine.tracks.filter(function(t){return t!==e.selectedTrack}),n=[].concat(Object(a.a)(this.state.tracks.tracksToHide.filter(function(t){return t!==e.selectedTrack})),Object(a.a)(t));this.dispatch(Object(c.Qf)(Array.from(new Set(n))))}this.hideSidebar(),this.dispatch(Object(c.k)(!1)),this.dispatch(Object(c.Le)(!1))}}},{key:"hideSidebar",value:function(){this.dispatch(Object(c.oe)(!1)),this.dispatch(Object(c.Ee)(!1)),this.dispatch(Object(c.Me)(!1)),this.dispatch(Object(c.Qe)(!1)),this.dispatch(Object(c.Ye)(ae.a))}},{key:"selectAllTrackAutomationPoints",value:function(){var e=this.sequencerEngine.tracks[this.cursor.track];if(void 0!==e){var t=this.state.automation.trackParameter[e.id];if(void 0!==t)if((this.state.automation.pointsSelected[e.id]||[]).length>0){var n,i=de(this.sequencerEngine.tracks);try{for(i.s();!(n=i.n()).done;){var s=n.value;this.dispatch(Object(c.K)(s.id,[]))}}catch(r){i.e(r)}finally{i.f()}}else this.viewMode===y.a?this.dispatch(Object(c.K)(e.id,Object(a.a)(t.mixAutomation.automations))):this.dispatch(Object(c.K)(e.id,Object(a.a)(t.automations)))}}},{key:"selectAllTrackSteps",value:function(){var e=this.sequencerEngine.tracks[this.cursor.track];if(!(void 0===e||this.viewMode===y.c&&e.isEffectsShowing())||this.state.sequencer.showPianoRoll&&this.state.arrangement.bottomMode===re.b){this.dispatch(Object(c.Rd)(!1));e.currentPattern;if(void 0===this.getSelectedSteps()){var t=e.getEasyPattern().getAllSteps();this.dispatch(Object(c.ge)(t))}else this.dispatch(Object(c.ge)(void 0))}}},{key:"copy",value:function(){this.copiedNodesForRack.length>0||(this.selectedEffect?(this.effectToCopy=this.selectedEffect,this.dispatch(Object(c.kf)(void 0))):this.copySteps())}},{key:"paste",value:function(){if(!(this.copiedNodesForRack.length>0))if(void 0===this.state.keyboard.stepsToCopy&&void 0!==this.effectToCopy&&void 0!==this.selectedTrack&&this.selectedTrack.isEffectsShowing()){var e=this.effectToCopy.isMidiEffect()?this.effectToCopy.getCopy(this.selectedTrack):this.effectToCopy.getEffectCopy(this.sequencerEngine);this.effectToCopy.isMidiEffect()?this.selectedTrack.midiEffects.addEffect(e):this.selectedTrack.effectsChain.addEffect(e),this.sequencerEngine.update()}else this.pasteSteps()}},{key:"copySteps",value:function(){var e=this.getSelectedSteps();if(void 0!==e){this.dispatch(Object(c.kf)(e));var t=this.selectedTrack;this.dispatch(Object(c.zb)(t.getEasyPattern()))}}},{key:"pasteSteps",value:function(){if(void 0!==this.state.keyboard.stepsToCopy){var e=this.cursor.getStep(this.resolution),t=this.sequencerEngine.tracks[this.cursor.track];if(t){var n=t.getEasyPattern().pasteSteps(this.state.keyboard.stepsToCopy,{stepNumber:e},this.state.keyboard.easyPatternToCopy,this.state.sequencer.displayResolution);t.updateSteps(),this.dispatch(Object(c.ge)(n)),this.dispatch(Object(c.ef)(e))}}}},{key:"record",value:function(){var e=!this.isRecording;this.dispatch(Object(c.nc)(e)),this.sequencerEngine.recording(e)}},{key:"getSelectedSteps",value:function(){var e=this.sequencerEngine.store.getState().keyboard.selectedPianoRollSteps;if(!e||0!==e.length)return e}},{key:"deleteSelectedPoints",value:function(){var e=this.state.automation.trackParameter[this.selectedTrack.id];void 0!==e&&this.selectedTrack&&(this.sequencerEngine.operationManager.dispatch(Object(P.q)(this.viewMode===y.a?e.mixAutomation:e.automation,this.pointsSelected)),this.dispatch(Object(c.K)(this.selectedTrack.id,[])))}},{key:"deleteSelectedSteps",value:function(){this.sequencerEngine.store.getState();var e=this.getSelectedSteps();void 0!==e&&(this.sequencerEngine.operationManager.dispatch(Object(P.k)(this.selectedTrack,e)),this.store.dispatch(Object(c.ge)(void 0)))}},{key:"onShiftKeyDown",value:function(){}},{key:"currentScene",get:function(){return this.state.sequencer.currentScene}},{key:"scenes",get:function(){return this.state.sequencer.scenes}},{key:"showingSoundList",get:function(){return this.state.selector.showingSoundList||this.state.packs.packSelected}},{key:"currentSoundInList",get:function(){return this.state.selector.currentSoundInList},set:function(e){this.dispatch(Object(c.pb)(e))}},{key:"currentTagInList",get:function(){return this.state.selector.currentTagInList},set:function(e){this.dispatch(Object(c.rb)(e))}},{key:"onClickRollingMode",value:function(){this.sequencerEngine.resolution=this.state.sequencer.displayResolution,this.dispatch(Object(c.Hf)(!this.trackRolling)),this.dispatch(Object(c.cg)(!1)),this.sequencerEngine.rollingManager.clear()}},{key:"onEnterKeyDown",value:function(){this.showingSoundList&&void 0!==this.currentSoundInList||this.cursor.track>=0&&this.cursor.track<this.sequencerEngine.tracks.length&&this.sequencerEngine.getSelectedStep()>=0&&this.onClickStep(this.cursor.track,this.sequencerEngine.getSelectedStep())}},{key:"onClickStep",value:function(e,t){void 0===this.getSelectedSteps()&&(this.sequencerEngine.tracks[e].pattern.clearCache(),this.sequencerEngine.operationManager.dispatch(Object(P.t)(this.sequencerEngine.tracks[e],t,this.resolution)),this.sequencerEngine.select(e,t),this.cursor.track=e)}},{key:"dispatch",value:function(e){this.store.dispatch(e)}},{key:"state",get:function(){return this.store.getState()}},{key:"selectedEffect",get:function(){if(this.state.zobject.selectedZObject&&this.state.zobject.selectedZObject.getObjectType()===C.a&&void 0!==this.state.effects.selectedEffect&&(!this.state.sequencer.showPianoRoll||this.state.arrangement.bottomMode!==re.b))return this.sequencerEngine.selectedEffect}},{key:"planarSelected",get:function(){return this.state.zobject.selectedZObject&&"Plane Parameters"===this.state.zobject.selectedZObject.name}},{key:"midiMapMode",get:function(){return this.state.midi.midiMapMode}},{key:"viewMode",get:function(){return this.state.sequencer.viewMode}},{key:"alternateViewMode",get:function(){return this.state.sequencer.alternateViewMode}},{key:"showGroups",get:function(){return this.state.sequencer.showGroups}},{key:"pointsSelected",get:function(){var e=this.selectedTrack;return e&&this.state.automation.pointsSelected[e.id]||[]}},{key:"isCompactMode",get:function(){return this.state.sequencer.isCompactMode}},{key:"cursor",get:function(){return this.sequencerEngine.cursor}},{key:"cursorStepData",get:function(){if(this.selectedTrack)return this.selectedTrack.pattern.stepBuckets[this.cursor.step].steps[0]}},{key:"resolution",get:function(){return this.state.sequencer.displayResolution}},{key:"sampleAuditioning",get:function(){return this.state.audition.sampleAuditioning}},{key:"trackRolling",get:function(){return this.state.sequencer.trackRolling}},{key:"isRecording",get:function(){return this.state.sequencer.isRecording}},{key:"selectedTrack",get:function(){return this.sequencerEngine.tracks[this.cursor.track]}},{key:"scripting",get:function(){return this.sequencerEngine.scripting}},{key:"viMode",get:function(){return this.viewMode===y.c&&this.state.commands.viMode}},{key:"trackFocused",get:function(){return this.state.sequencer.trackFocused}},{key:"isPlayingMix",get:function(){return this.state.mix.isPlayingMix}},{key:"onSelectTrack",value:function(e){this.sequencerEngine.cursor.track=e}},{key:"isShowingSoundsPane",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return!!this.state.spatial.showSearchWindow||!this.state.selector.sidebarCollapsed&&(this.state.sequencer.showSelectorMode||this.state.sequencer.sidebarViewMode!==ae.a)}},{key:"isShowingPianoRoll",get:function(){return this.showPianoRoll&&this.state.arrangement.bottomMode===re.b}},{key:"showPianoRoll",get:function(){return this.state.sequencer.showPianoRoll}},{key:"showSamples2D",get:function(){return this.state.selector.showSamples2D}},{key:"selectedFreeze",get:function(){return this.state.freeze.selectedFreeze}},{key:"deleteSelectedFreeze",value:function(){var e,t=this.selectedTrack,n=this.selectedFreeze,i=de(t.frozenColumns);try{for(i.s();!(e=i.n()).done;){var s=e.value,r=-1;for(var a in s.frozenSamples)s.frozenSamples[a].ipfsHash===n&&(r=parseInt(a));if(!(r<0)){s.frozenSettings.splice(r,1),s.frozenSamples.splice(r,1),s.frozenSamplers[r].gainNode.disconnect(),s.frozenSamplers.splice(r,1),s.updateRedux();break}}}catch(o){i.e(o)}finally{i.f()}t.frozenColumns.every(function(e){return 0===e.frozenSamplers.length})&&t.isFrozen&&t.unfreeze(),this.dispatch(Object(c.Zd)(void 0))}},{key:"copiedNodesForRack",get:function(){return this.state.effects.copiedNodesForRack}},{key:"trackerParameterToEdit",get:function(){return this.state.mix.trackerParameterToEdit}},{key:"newSlice",value:function(){var e=this.selectedTrack;if(e.getTrackType()===se.f){var t=e.getSamplers()[0];t.newSlice(),this.dispatch(Object(c.me)(e.id,t.slices.length-1))}}},{key:"moveSteps",value:function(e,t,n){var i={stepDifference:t,transposeDifference:n},s=e[0].track;this.sequencerEngine.operationManager.dispatch(Object(P.n)(s,e,i,0===t?void 0:this.resolution,!1,!1))}},{key:"duplicateSteps",value:function(){var e=this.selectedTrack,t=this.getSelectedSteps(),n=this.resolution;Object(ie.a)(e,t,n)}},{key:"duplicateAllSteps",value:function(){var e=this;this.sequencerEngine.tracks.forEach(function(t){Object(ie.a)(t,void 0,e.resolution)})}},{key:"legato",value:function(){var e=this.selectedTrack;if(e){var t=this.getTrackSelectedSteps();t&&0!==t.length||(t=e.getEasyPattern().getAllSteps()),function(e,t){for(var n=e.getEasyPattern().getStepNumbers(t,ee),s=e.sequencerEngine.operationManager,r=0;r<n.length;r++){var c=Object(i.a)(n[r],2),a=c[0],o=c[1],u=ne(e,o);if(void 0!==u){var l=(u-o)/2;s.dispatch(Object(P.w)(e,a,a.durationParameter,l))}}}(e,t)}}},{key:"getTrackSelectedSteps",value:function(){if(this.selectedTrack){var e=this.getSelectedSteps();return e&&0!==e.length||(e=[this.cursorStepData]),e}}},{key:"rollSteps",value:function(){var e=this.getTrackSelectedSteps();e&&function(e,t){for(var n=e.getEasyPattern(),s=n.getStepNumbers(t,ee),r=e.sequencerEngine.state.sequencer.displayResolution.getNumberOfStepsAtBaseResolution(),c=(e.sequencerEngine.operationManager,[]),o=0;o<s.length;o++){var u=Object(i.a)(s[o],2),l=u[0],h=u[1],d=ne(e,h);if(void 0!==d)for(var f=h+r;f<d;f+=r)c=[].concat(Object(a.a)(c),Object(a.a)(n.pasteSteps([l],{stepNumber:f},n,ee)))}te(e,[].concat(Object(a.a)(t),Object(a.a)(c))),e.updateSteps()}(this.selectedTrack,e)}},{key:"tripletSteps",value:function(){var e=this.selectedTrack,t=this.getSelectedSteps();e&&t&&0!==t.length&&function(e,t){var n=e.getEasyPattern(),s=e.sequencerEngine.state.sequencer.displayResolution,r=s.getCopy(),a=n.getStepNumbers(t,s);r.isTriplet=!r.isTriplet,e.sequencerEngine.dispatch(Object(c.Md)(r));var o=e.sequencerEngine.operationManager;o.dispatch(Object(P.k)(e,t));var u,l=$(a);try{for(l.s();!(u=l.n()).done;){var h=u.value,d=Object(i.a)(h,2),f=d[0],g=d[1],p=r.isTriplet?1.5:2/3;o.dispatch(Object(P.c)(e,f,Math.round(g*p),r))}}catch(y){l.e(y)}finally{l.f()}e.sequencerEngine.dispatch(Object(c.Md)(s)),e.updateSteps(!0,void 0,r.isTriplet)}(e,t)}},{key:"focusSearch",value:function(){var e=Object(j.a)(w.a.mark(function e(){var t;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.viewMode!==y.a&&this.viewMode!==y.b){e.next=4;break}return this.dispatch(Object(c.we)(!0)),e.next=4,Object(Q.a)(200);case 4:if((t=this.state.selector.searchInput)&&t.current&&t.current.focus){e.next=7;break}return e.abrupt("return");case 7:t.current.focus();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isEffectsShowing",value:function(){return!this.isShowingPianoRoll&&(this.selectedTrack&&this.selectedTrack.isEffectsShowing())}},{key:"toggleTriplets",value:function(){var e=this.state.sequencer.displayResolution,t=new X.a(e.resolution,!e.isTriplet);this.dispatch(Object(c.vb)(t)),this.sequencerEngine.updateSteps()}},{key:"groupSteps",value:function(){var e=this.selectedTrack;if(e){var t=this.getSelectedSteps();if(this.stepsGroupMode&&t&&t.every(function(e){return!e.group}));else if(this.stepsGroupMode||!t||0===t.length||t.every(function(e){return e.group}))return this.toggleStepsGroupMode(),void this.dispatch(Object(c.ge)(void 0));Object(Y.e)(t,e)}}},{key:"stepsGroupMode",get:function(){return this.state.groups.stepsGroupMode}},{key:"toggleStepsGroupMode",value:function(){this.dispatch(Object(c.if)(!this.stepsGroupMode)),this.sequencerEngine.updateSteps()}},{key:"sampleExplorerSelected",get:function(){return this.state.selector.sampleExplorerSelected}},{key:"hasHigherOrderSteps",value:function(){var e=this.state.higherOrder.selectedSteps;return e&&e.length>0}},{key:"selectedZObject",get:function(){return this.state.zobject.selectedZObject}},{key:"keyboardContext",get:function(){return this.state.keyboard.keyboardContext}},{key:"connectLastZObjects",value:function(){var e=this.state.zobject.selectedZObjectHistory,t=e.slice(e.length-2),n=Object(i.a)(t,2),s=n[0],r=n[1];s&&r&&Object(z.a)(Object(P.e)(s,"Output 1",r,"Input"))}}]),n}(function(e){Object(O.a)(n,e);var t=he(n);function n(){return Object(M.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"onArrowDown",value:function(e){if(e.preventDefault(),this.sampleExplorerSelected)this.state.zobject.selectedZObject?this.selectedTrack.auditionNext():this.sequencerEngine.auditionTrack.auditionNext();else if(this.isShowingSoundsPane(!1)){var t=e.ctrlKey||e.metaKey?10:1;this.showingSoundList?void 0===this.currentSoundInList?this.currentSoundInList=0:this.currentSoundInList+=t:void 0===this.currentTagInList?this.currentTagInList=0:this.currentTagInList+=t}else if(this.viewMode===y.b&&this.currentScene){var n=this.scenes.indexOf(this.currentScene),i=this.scenes[(n+1)%this.scenes.length];this.sequencerEngine.scenes.switchToScene(i)}else if(!this.showSamples2D||!this.isShowingSoundsPane()){if(this.sampleAuditioning)window.dispatchEvent(new Event(le.a));else{var s=this.getSelectedSteps();s&&s.length>0?this.moveSteps(s,0,e.ctrlKey||e.metaKey?-12:-1):(this.sequencerEngine.tracks.length,this.sequencerEngine.down(),this.onSelectTrack(this.cursor.track))}return!0}}},{key:"onArrowRight",value:function(e,t){if(this.isShowingSoundsPane(!1)){var n=e.ctrlKey||e.metaKey?10:1;this.showingSoundList||(void 0===this.currentTagInList?this.currentTagInList=0:this.currentTagInList+=n)}else if(!this.waveformShowing&&(e.preventDefault(),!this.showSamples2D||!this.isShowingSoundsPane())){if(this.viewMode===y.a)return function(e){var t=F(e.state);if(t){var n=t.subSequence.mix;if(n){var i=n.getNextEvent(t);return i?B(e,i):void 0}}}(this.sequencerEngine);if(this.cursor.track in this.sequencerEngine.tracks){var i=this.getSelectedSteps();i&&i.length>0?this.moveSteps(i,e.ctrlKey||e.metaKey?4:1,0):this.sequencerEngine.right(void 0,t)}}}},{key:"onArrowLeft",value:function(e,t){if(this.isShowingSoundsPane(!1)){var n=e.ctrlKey||e.metaKey?10:1;this.showingSoundList||(void 0===this.currentTagInList?this.currentTagInList=0:this.currentTagInList=Math.max(0,this.currentTagInList-n))}else if(!this.waveformShowing&&(e.preventDefault(),!this.showSamples2D||!this.isShowingSoundsPane())){if(this.viewMode===y.a)return function(e){var t=F(e.state);if(t){var n=t.subSequence.mix;if(n){var i=n.getPreviousEvent(t);return i?B(e,i):void 0}}}(this.sequencerEngine);var i=this.getSelectedSteps();i&&i.length>0?this.moveSteps(i,e.ctrlKey||e.metaKey?-4:-1,0):this.sequencerEngine.left(void 0,t)}}},{key:"onArrowUp",value:function(e){if(e.preventDefault(),this.sampleExplorerSelected)this.state.zobject.selectedZObject?this.selectedTrack.auditionPrevious():this.sequencerEngine.auditionTrack.auditionPrevious();else if(this.isShowingSoundsPane(!1)){var t=e.ctrlKey||e.metaKey?10:1;this.showingSoundList?void 0===this.currentSoundInList?this.currentSoundInList=0:this.currentSoundInList=Math.max(0,this.currentSoundInList-t):void 0===this.currentTagInList?this.currentTagInList=0:this.currentTagInList=Math.max(0,this.currentTagInList-t)}else if(this.viewMode===y.b&&this.currentScene){var n=this.scenes.indexOf(this.currentScene)-1,i=this.scenes[n<0?this.scenes.length-1:n];this.sequencerEngine.scenes.switchToScene(i)}else if(!this.showSamples2D||!this.isShowingSoundsPane()){if(this.sampleAuditioning)window.dispatchEvent(new Event(le.b));else{var s=this.getSelectedSteps();s&&s.length>0?this.moveSteps(s,0,e.ctrlKey||e.metaKey?12:1):(this.sequencerEngine.up(),this.onSelectTrack(this.cursor.track))}return!0}}}]),n}(function(){return function e(){Object(M.a)(this,e)}}())),ye=n(413),be=n.n(ye),me=n(614),ve=n(884),ke=n(758),Se=n(1383),we=(n(2461),n(2462),n(2463),n(2464),n(2465),n(2466),n(2467),n(2468),n(2469),n(2470),n(2471),n(2472),n(1305),n(2473),n(2474),n(2475),n(2476),n(2477),n(2478),n(1330),n(1332),n(2479),n(840),n(2480),n(2481),n(2482),n(218)),je=n(204),Me=n(145),Ee=(n(407),n(2483),Object(o.b)(function(e){return{modal:e.zobject.modal}},function(e){return{setZObjectModal:function(t){return e(Object(c.tg)(t))}}})(function(e){var t=e.setZObjectModal,n=e.modal,i=Object(s.useCallback)(function(){n.zobject.sendMessage(n.zobject.outputByNumber(0),je.a),t(void 0)},[n]),c=Object(s.useCallback)(function(){n.zobject.sendMessage(n.zobject.outputByNumber(1),je.a),t(void 0)},[n]);if(!n)return"";n.zobject,n.text;var a=n.link,o=n.okButtonText,u=n.cancelButtonText;return r.a.createElement(we.a,{dialogClassName:"zobject-modal rack-modal",show:!0},r.a.createElement(we.a.Body,null,r.a.createElement("div",null,n.text),a&&r.a.createElement("div",{className:"modal-links"},Array.isArray(a)?a.map(function(e){return r.a.createElement("div",{className:"modal-link"},r.a.createElement("div",{className:"link-text"},e.text),r.a.createElement("a",{target:"_blank",href:e.url},"\u2197"))}):r.a.createElement("div",{className:"modal-link"},r.a.createElement("div",{className:"link-text"},a.text),r.a.createElement("a",{target:"_blank",href:a.url},"\u2197")))),r.a.createElement(we.a.Footer,null,r.a.createElement(Me.b,{variant:"secondary",onClick:i},o||"Ok"),u&&r.a.createElement(Me.b,{variant:"primary",onClick:c},u||"Cancel")))})),Ie=n(260),Oe=Object(o.b)(function(e,t){return{progressbar:e.zobject.progressbar}},function(e){return{}})(function(e){var t=e.progressbar;return t?r.a.createElement(Ie.a,{intervalPiece:1,width:200,intervalTime:100,text:t}):""});t.default=Object(o.b)(function(e,t){return{loadingSequence:e.sequencer.loadingSequence,loading:e.sequencer.loadingSequence[window.projectId],isPlaying:e.sequencer.isMainPlaying,progressbar:e.zobject.progressbar,debug:e.zobject.debug,playerUnlocked:e.nft.playerUnlocked,usePlayButton:e.nft.usePlayButton}},function(e){return{setSporesSongPlaying:function(t){return e(Object(c.cf)(t))},setFullScreenZObject:function(t){return e(Object(c.Yb)(t))},setIsPlayingMix:function(t){return e(Object(c.lc)(t))}}})(function(e){var t=Object(s.useRef)(0),n=Object(s.useRef)(void 0),c=e.zObject?[void 0,e.sequencerEngine]:Object(Se.a)(e),a=Object(i.a)(c,3),o=(a[0],a[1]),u=(a[2],Object(s.useRef)(void 0)),d=Object(s.useState)(!1),f=Object(i.a)(d,2),p=f[0],y=f[1];Object(s.useEffect)(function(){setTimeout(function(){e.zObject&&e.zObject.sequencerEngine&&e.zObject.sequencerEngine.refreshUniform()},10)},[e.zObject]);var b=Object(s.useRef)({}),m=Object(me.a)({ref:n}),v=m.sizeRef,S=m.ordering,w=m.setOrdering,j=Object(s.useRef)(void 0);console.log("NFT VIEWER CALLED");var M=Object.keys(e.loadingSequence).some(function(t){return e.loadingSequence[t]});!function(e){var t=Object(s.useState)(void 0),n=Object(i.a)(t,2),r=n[0],c=n[1];Object(s.useEffect)(function(){e.sequencerEngine&&c(new pe(e.sequencerEngine))},[e.sequencerEngine]),Object(s.useEffect)(function(){if(r)return window.addEventListener("keydown",r.onKeyDown),window.addEventListener("keyup",r.onKeyUp),function(){window.removeEventListener("keydown",r.onKeyDown),window.removeEventListener("keyup",r.onKeyUp)}},[r])}({sequencerEngine:e.sequencerEngine?void 0:o}),Object(s.useEffect)(function(){return n.current.addEventListener("mousewheel",O,{passive:!1}),window.addEventListener("mousewheel",O,{passive:!1}),function(){n.current&&n.current.removeEventListener("mousewheel",O,{passive:!1}),window.removeEventListener("mousewheel",O,{passive:!1})}},[]);var E,I,O=function(t){e.showClickToStart||t.preventDefault()},N=!0;e.zObject?I=e.zObject:!M&&o&&o.subSequences&&o.subSequences[0]&&(I=o.nftZObject||o.subSequences[0].zObjects.find(function(e){return"logos"===e.args[0]})||o.subSequences[0].zObjects.find(function(e){return"three.canvas"===e.name}),E=o.subSequences[0].zObjects.find(function(e){return"ui.hidePlayUntil"===e.name}),N=!!o.disablePlay),!M&&o&&o.subSequences&&o.subSequences[0]&&I&&"three.canvas"===I.name&&(j.current||(j.current={width:I.width,height:I.height}),I.attributes["fill full-screen"]&&(I.width=window.innerWidth,I.height=window.innerHeight,I.effect.sendMessage("size",[I.width,I.height]),Object(h.publish)("canvas.size",[I.width,I.height]))),Object(s.useEffect)(function(){o&&e.setSporesSongPlaying(o.songId)},[o]),Object(s.useEffect)(function(){y(e.isPlaying),e.isPlaying&&(u.current=!0)},[e.isPlaying,y]),Object(s.useEffect)(function(){!e.sequencerEngine&&e.loadingSequence&&Object.keys(e.loadingSequence).length>0&&!M&&(be()(A.a.Master.context,".editor"),e.screenshot&&o.play())},[M,e.loadingSequence,o]),Object(s.useEffect)(function(){return function(){e.zObject&&j.current&&(e.zObject.width=j.current.width,e.zObject.height=j.current.height)}},[]),console.log("ZPLHYER UNLOCKED=",E,e.playerUnlocked);var D=!E||e.playerUnlocked,T=Object(s.useCallback)(function(t){t&&t.stopPropagation(),D&&(e.sequencerEngine&&!e.showClickToStart||(e.setIsPlayingMix(!0),u.current?(o.play(),y(!p)):(setTimeout(function(){o.play(),y(!0)},150),u.current=!0)))},[D,o,y,p]);t.current++;var P=!e.sequencerEngine&&e.loadingSequence&&Object.keys(e.loadingSequence).length>0&&!M;return r.a.createElement(s.Suspense,{fallback:function(){return r.a.createElement("div",null,"Loading...")}},r.a.createElement("div",{onMouseDown:function(){return o.play()},className:"v3 nft-mode no-select"},e.debug&&r.a.createElement("div",{className:"z-debug"},e.debug),r.a.createElement(Ee,null),r.a.createElement(Oe,null),r.a.createElement("div",{className:"editor"},!D||N||u.current&&!e.usePlayButton||e.screenshot||e.sequencerEngine&&!e.showClickToStart||e.isPlaying&&!e.usePlayButton?"":r.a.createElement("div",{onMouseDown:!e.progressbar&&!M||e.showClickToStart?T:function(){return[]},className:t.current<=1||M||e.progressbar?"click-to-start loading ":"click-to-start"+(u.current?" playing-nft":"")},r.a.createElement("div",{className:"image-wrapper"}),!M&&!N&&r.a.createElement("span",{className:"inner-start"},r.a.createElement("span",{className:"start-text"},r.a.createElement("div",{className:e.isPlaying?"play-button-start playing":"play-button-start"})))),r.a.createElement("div",{className:"nft-viewer",ref:n},!e.isMulti&&e.sequencerEngine&&r.a.createElement("img",{className:"expand-icon",onClick:function(){e.setFullScreenZObject(void 0)},src:"/expand-icon.svg"}),M?r.a.createElement(ke.a,{sequencerEngine:o}):"",!e.sequencerEngine&&!e.usePlayButton&&!N&&r.a.createElement(k,{sequencerEngine:o}),I&&r.a.createElement(ve.a,{scale:1,forceShow:!0,sequencerEngine:o,isMainNFT:!0,ordering:S,setOrdering:w,setSize:function(){return[]},sizeRef:v,elements:b,containerRef:n,zobject:I}),!window.isNFT&&r.a.createElement(l,{sequencerEngine:o}),P&&!o.galleryView&&r.a.createElement(g,{sequencerEngine:o})))))})}}]);