(window.webpackJsonp=window.webpackJsonp||[]).push([[3],Array(109).concat([function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(357),a=Object(r.a)()},,function(e,t,n){"use strict";n.d(t,"c",function(){return s}),n.d(t,"b",function(){return o}),n.d(t,"m",function(){return c}),n.d(t,"n",function(){return u}),n.d(t,"j",function(){return l}),n.d(t,"d",function(){return f}),n.d(t,"a",function(){return h}),n.d(t,"e",function(){return p}),n.d(t,"i",function(){return d}),n.d(t,"g",function(){return v}),n.d(t,"l",function(){return m}),n.d(t,"k",function(){return y}),n.d(t,"h",function(){return b}),n.d(t,"f",function(){return g}),n.d(t,"J",function(){return O}),n.d(t,"w",function(){return k}),n.d(t,"Q",function(){return j}),n.d(t,"C",function(){return w}),n.d(t,"E",function(){return x}),n.d(t,"O",function(){return S}),n.d(t,"K",function(){return P}),n.d(t,"x",function(){return E}),n.d(t,"L",function(){return A}),n.d(t,"A",function(){return M}),n.d(t,"y",function(){return R}),n.d(t,"z",function(){return C}),n.d(t,"o",function(){return N}),n.d(t,"q",function(){return q}),n.d(t,"N",function(){return I}),n.d(t,"I",function(){return _}),n.d(t,"B",function(){return D}),n.d(t,"F",function(){return F}),n.d(t,"H",function(){return L}),n.d(t,"P",function(){return B}),n.d(t,"M",function(){return z}),n.d(t,"r",function(){return J}),n.d(t,"R",function(){return V}),n.d(t,"p",function(){return H}),n.d(t,"s",function(){return U}),n.d(t,"t",function(){return G}),n.d(t,"u",function(){return W}),n.d(t,"v",function(){return K}),n.d(t,"G",function(){return Q}),n.d(t,"D",function(){return Z});var r=n(17),a=n(206),i=n(151),s="FILTER",o="COND",c="SWITCH_OUTPUT",u="TRIGGER",l="SET",f="GRAB",h="CHOKE",p="GRAB_TIME",d="SEQUENTIALLY",v="PARALLEL",m="SET_MODULATOR",y="SET_MACRO",b="PATTERN_SWITCH",g="ON";Object(i.a)("s",{"...args":"Arguments"},"Evaluates arguments sequentially");var O=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{axiom:d,sequence:t}};Object(i.a)("filter",{boolean:"True or false"},"Allows a trigger to pass, based on the argument passed");var k=function(e){return{axiom:s,value:e}},j=function(e){return{axiom:u,value:e}},w=function(e,t){return{axiom:g,value:{type:e,fn:t}}};Object(i.a)("patternSwitch",{patternNumber:"The pattern number to go to (zero indexed)"},"Switches the pattern of the track`'s sub-sequence");var x=function(e){return{axiom:b,value:e}};Object(i.a)("switchOutput",{outputNumber:"The output-number to send the trigger to (zero-indexed)"},"Midi Effects can have several outputs. This function lets you choose which one to send a trigger through.");var S=function(e){return{axiom:c,value:e}};Object(i.a)("set",{param:"The parameter name of a trigger to alter","...values":"The remaining arguments are values that are alternated. This param gets set with these values"},"Sets a trigger's parameter");var P=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return{axiom:l,param:e,value:1!==n.length||Array.isArray(n[0])||"function"===typeof n[0]?a.a.apply(void 0,n):n[0]}},E=function(e){return function(t){return t[e]}},T=function(e,t,n,r){return{axiom:m,modType:e,number:t,param:n,value:r}},A=function(e,t){return{axiom:y,name:e,value:t}},M=function(e){if(!e)return e;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a="function"===typeof e?e.apply(void 0,n):e;return"object"===typeof a&&"SEQUENTIALLY"===a.axiom?a.sequence[0]:a};Object(i.a)("grab",{trackNumber:"The track number we wish to grab parameter values from (zero-indexed)",fromParam:"The parameter in the target track we wish to grab",toParam:"The parameter in the current track we wish to set with the grabbed value",add:"True/false whether we add the grabbed value to the current value"},"Grab trigger-parameter values from other tracks");var R=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"transpose",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"transpose",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{axiom:f,trackNumber:M(e),toParam:M(n),fromParam:M(t),add:M(r)}};Object(i.a)("grabTime",{trackNumber:"The track number we wish to grab time values from (zero-indexed)"},"Grabs timing information from other tracks, if that track has any triggers occuring on this step.");var C=function(e){return{axiom:p,trackNumber:M(e)}};Object(i.a)("choke",{trackNumber:"The track-number we wish to choke"},"Prevents triggers from another track from occuring when this track triggers");var N=function(e){return{axiom:h,trackNumber:M(e)}};Object(i.a)("cond",{condition:"True/false whether we execute statement1 or statement2",statement1:"Triggered when the condition evalulates to true",statement2:"Triggered when the condition evalulates to false"},"Conditional control allows you to execute different functions depending on the condition");var q=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k(!0);return{axiom:o,condition:e,statement1:t,statement2:n}},I=function(e,t){return function(n,r,a){return k(n&&r>=M(e)&&r<=M(t))}};Object(i.a)("rolling",{},"Filter only passing when the sequence is in roll-mode");var _=function(){return function(e,t,n,r){return k(r.isRolling())}},D=function(e,t){return function(n,r,a){return k(n&&n.transpose>=e()&&n.transpose<=t())}};Object(i.a)("prob",{probability:"Percentage value of how often a trigger is passed through"},"Generates a random value from 0-100 and lets triggers pass when they are below the probability argument");var F=function(e){return function(t,n,r){return k(Math.random()<=M(e)/100)}};Object(i.a)("reverse",{"...values":"Values to be alternated (true/false)"},"Sets the reverse parameter of the trigger. If a sample is played, it will play reversed");var L=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return P.apply(void 0,["reverse"].concat(t))};Object(i.a)("transpose",{"...values":"Values to be alternated"},"Sets the transpose of the trigger to the value passed (which are alternated every trigger)");var B=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return void 0===t||0===t.length?E("transpose"):P.apply(void 0,["transpose"].concat(t))};Object(i.a)("start",{"...values":"Values to be alternated"},"Sets the start percentage (of sample) of the trigger to the value passed (which are alternated every trigger)");var z=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return void 0===t||0===t.length?E("start"):P.apply(void 0,["start"].concat(t))};Object(i.a)("dur",{"...values":"Values to be alternated"},"Sets the duration of the trigger to the value passed (which are alternated every trigger)");var J=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return void 0===t||0===t.length?E("duration"):P.apply(void 0,["duration"].concat(t))};Object(i.a)("vel",{"...values":"Values to be alternated"},"Sets the velocity of the trigger to the value passed (which are alternated every trigger)");var V=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return void 0===t||0===t.length?E("velocity"):P.apply(void 0,["velocity"].concat(t))};Object(i.a)("chop",{"...values":"Values to be alternated"},"Sets the chop of the trigger to the value passed (which are alternated every trigger)");var H=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return void 0===t||0===t.length?E("chop"):P.apply(void 0,["chop"].concat(t))},U=function(e,t){return T(r.a,0,e,t)},G=function(e,t){return T(r.a,1,e,t)},W=function(e,t){return T(r.a,2,e,t)},K=function(e,t){return T(r.a,3,e,t)};Object(i.a)("randomSelect",{options:"Options to be randomly chosen from"},"Randomly selects an option from the arguemnts. randomSelect(0,1,2,3) will randomly return 0,1,2, or 3 with uniform probability");var Q=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){return M(t[Math.floor(Math.random()*t.length)])}};Object(i.a)("knob",{name:"Name of the variable you wish to create"},"Create a variable that is controlled via a slider."),Object(i.a)("p",{"...args":"Arguments"},"Evaluates arguments in parallel");var Z=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{axiom:v,sequence:t}}},function(e,t,n){"use strict";n.d(t,"a",function(){return y}),n.d(t,"b",function(){return g}),n.d(t,"c",function(){return b});var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2),u=n(14),l=n(30),f=n(22),h=n(7),p=n.n(h),d=n(25),v=n(27);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var y=function(e){Object(s.a)(n,e);var t=m(n);function n(e,a,i){var s,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(r.a)(this,n),(s=t.call(this,e,a,i,o)).hasAudioParamSetter=!0,s.setAudioParam(a),s}return Object(a.a)(n,[{key:"fromJson",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.depth&&(this._depth=e.depth.unlockedValue);var a=this.id,i={},s=this.context&&this.context.subSequence?this.context.subSequence:void 0!==t?t.currentSubSequence||t.subSequences[0]:void 0;if(void 0===e.id||r||(this.id=e.id,this.sequencerEngine&&(this.sequencerEngine.idToParameter[this.id]=this)),void 0!==e.lfos&&e.lfos.length>0&&void 0!==s&&e.lfos.forEach(function(e){var t=n.availableLFOs[e]||s.lfos[e].lfo;n.lfos.includes(t)&&t.replaceParameterIds(a,n.id,n),n.connectToLFO(t)}),void 0!==e.envelopes&&e.envelopes.length>0&&void 0!==s&&e.envelopes.forEach(function(e){var t=n.availableEnvelopes[e]||s.envelopes[e];n.envelopes.includes(t)?t.replaceParameterIds(a,n.id,n):n.connectToEnvelope(t)}),void 0!==e.value&&(i=this.set(e.value,!0,!0)),e.keyScaling&&(this.keyScaling=new l.a(this,e.keyScaling.min,e.keyScaling.max)),this.unlockedValue=void 0!==e.unlockedValue?Object(d.b)(e.unlockedValue):this.value,void 0!==e.patternToValue&&(this.patternToValue=Object(d.a)(e.patternToValue)),this.isPatternLocked()&&void 0!==this.patternToValue[0]?i=this.set(this.patternToValue[0],!0,!0):void 0!==this.unlockedValue&&(i=this.set(this.unlockedValue,!0,!0)),void 0!==e.paletteToValue&&(this.paletteToValue=Object(d.a)(e.paletteToValue)),e.patternToAutomation)for(var o in e.patternToAutomation)this.patternToAutomation[o]=new v.a(this),this.patternToAutomation[o].fromJson(e.patternToAutomation[o]);e.unlockedAutomation&&this.unlockedAutomation.fromJson(e.unlockedAutomation),this.loadModsFromJson(e);var c={};return c[i.id]=i.value,void 0!==e.depth?(this.depthParameter||this.initDepth(),this.depthParameter.fromJson(e.depth,t,r)):void 0!==e._depth&&(this._depth=e._depth),e.mixAutomation&&this.mixAutomation.fromJson(e.mixAutomation,!1),void 0!==e.min&&(this.min=e.min),void 0!==e.max&&(this.max=e.max),e.stepToValue&&(this.stepToValue=e.stepToValue),c}},{key:"initDepth",value:function(){var e=void 0!==this._depth?this._depth:1;this.depthSignal=new p.a.Signal(0),this.depthParameter=new b("depth",this.depthSignal,{min:0,max:1,defaultValue:e,automationRate:f.a},.2),this.context&&this.depthParameter.setContext(this.context),this.depthParameter.setStore(this.store)}},{key:"connectToLFO",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(i.a)(Object(c.a)(n.prototype),"connectToLFO",this).call(this,e),t&&this.set(this.value,!0,!0)}},{key:"disconnectFromLFO",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;Object(i.a)(Object(c.a)(n.prototype),"disconnectFromLFO",this).call(this,e,!1,r),t&&this.set(this.value,!0,!0)}},{key:"connectToEnvelope",value:function(e){Object(i.a)(Object(c.a)(n.prototype),"connectToEnvelope",this).call(this,e),this.set(this.value,!0,!0)}},{key:"disconnectFromEnvelope",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;Object(i.a)(Object(c.a)(n.prototype),"disconnectFromEnvelope",this).call(this,e,!1,r),t&&this.set(this.value,!0,!0)}}]),n}(u.a),b=function(e){Object(s.a)(n,e);var t=m(n);function n(e,a){var i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;return Object(r.a)(this,n),(i=t.call(this,e,a,function(t,n,r){if(t&&!isNaN(n)&&(t.input||s.noInput)){var a=p.a.Master.context.isOffline?p.a.Master.context._currentTime:p.a.Master.context.currentTime;o>0&&"macro"!==e&&window.sequencerEngine&&window.sequencerEngine.playing?isNaN(n)||t.linearRampToValueAtTime(n,a+o):"harmonicity"!==e&&"octave"!==e?t.value=n:t.setValueAtTime(n,a)}},s)).hasAudioParamSetter=!1,i.automationRate=f.a,i}return n}(y),g=function(e){Object(s.a)(n,e);var t=m(n);function n(e,a){var i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Object(r.a)(this,n),s.unit="%",(i=t.call(this,e,a,s)).hasAudioParamSetter=!1,i}return n}(b)},,,,function(e,t,n){"use strict";var r=n(10),a=n(1),i=n(107),s=n(4),o=n(5),c=n(31),u=n(6),l=n(8),f=n(2),h=(n(3),n(7)),p=n.n(h),d=(n(303),n(14)),v=new(function(){function e(){Object(s.a)(this,e),this.nameToEffects={}}return Object(o.a)(e,[{key:"useEffect",value:function(e,t,n){return n.isOffline?t():e in this.nameToEffects&&this.nameToEffects[e].length>0?this.nameToEffects[e].pop():t()}},{key:"totalEffects",get:function(){var e=0;for(var t in this.nameToEffects)e+=this.nameToEffects[t].length;return e}},{key:"releaseEffect",value:function(e,t,n){if(n.isOffline)t.dispose();else{if(this.totalEffects>=12)for(var r in this.nameToEffects){var a=this.nameToEffects[r][0];if(a){this.nameToEffects[r]=this.nameToEffects[r].slice(1),a.dispose(!1);break}}this.nameToEffects[e]||(this.nameToEffects[e]=[]),t.disconnect(),this.nameToEffects[e].push(t)}}}]),e}()),m=n(112),y=n(23),b=n(421),g=n(129),O=n(165),k=n(141),j=n(119),w=(n(122),n(59)),x=n(20);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var P=function(e){Object(u.a)(n,e);var t=S(n);function n(e,r,a,i){var o;return Object(s.a)(this,n),(o=t.call(this)).sequencerEngine=a,o.initialBulkValues={},o.store=a.store,o.name=e,o.id=Object(x.uuid)(),o.sequencerEngine.idToObject[o.id]=Object(c.a)(o),o.parameters=[],o.effectFn=r,o.enabledParameter=new d.a("Enabled",Object(c.a)(o),function(e,t){o.toggle(t)},{min:0,max:1,unit:"boolean",defaultValue:!0}),o.effectNode=v.useEffect(o.name,r,a),o.initializeParameters(),o.numberOfOutputs=1,o.enabled=!1,o.toggledValue=0,o.value=0,o.connected=0,o.newInlet(g.m,function(){return o.swapMinMax()}),o.newInlet("set parameter",function(e){return o.paramSet(e)}),o.newInlet("enable",function(e){return o.onEnableMsg(e)}),o}return Object(o.a)(n,[{key:"onEnableMessage",value:function(e){Object(i.a)(e,1)[0]?this.enableParameter.set(!0):this.enableParameter.set(!1)}},{key:"initializeParameters",value:function(){this.wetParameter=void 0!==this.effectNode.wet?new m.b("Wet",this.effectNode.wet,{documentation:"Controls the amount of (wet) effected signal, vs. dry (un-effected) signal.",defaultValue:0}):void 0,this.registerParameter(this.wetParameter),this.track=void 0,this.group=void 0,this.setWet(0)}},{key:"getObjectType",value:function(){return O.a}},{key:"paramSet",value:function(e){var t=Object(i.a)(e,1)[0];if(t.split){var n=t.split(" ");if(2===n.length){var r=n[0].toLowerCase(),a=this.getParameters().filter(function(e){return e.name.toLowerCase().includes(r)}),s=parseFloat(n[1]);isNaN(s)&&(s=n[1]),a.forEach(function(e){return e.set(s)})}}}},{key:"swapMinMax",value:function(){this.getParameters().forEach(function(e){e.parameterMods.forEach(function(e){var t=e.min;e.min=e.max,e.max=t})})}},{key:"getEffectType",value:function(){return w.a}},{key:"updateInitialValues",value:function(){this.sequencerEngine.dispatch(Object(y.ub)(this.initialBulkValues))}},{key:"makePublicIfNeeded",value:function(){}},{key:"getParameters",value:function(){return this.parameters||[]}},{key:"isMidiEffect",value:function(){return!1}},{key:"wet",set:function(e){this.wetParameter&&this.wetParameter.set(e)}},{key:"registerContext",value:function(e,t){var n=this;this.context?this.context.combineWith(e):this.context=e.getCopy(),t?(this.context.forSubDevice(this),this.context.forEffect(t)):this.context.forEffect(this),this.parameters.forEach(function(e){return e.setContext(n.context)})}},{key:"registerMixSession",value:function(e){this.parameters.forEach(function(t){return t.setMixSession(e)})}},{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,this.initialBulkValues=Object(a.a)({},this.initialBulkValues,e.setStore(this.store)),this.parameters.push(e))}},{key:"finishRegistering",value:function(){}},{key:"connect",value:function(e){this.effectNode.connect(e)}},{key:"syncable",value:function(){return!1}},{key:"disconnect",value:function(e){this.effectNode.disconnect(e)}},{key:"isEnabled",value:function(){return this.enabledParameter.get()}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enabledParameter.set(e)}},{key:"toggleEnabled",value:function(){this.enabledParameter.set(!this.enabledParameter.get())}},{key:"toggle",value:function(e){}},{key:"setValue",value:function(e){this.value=e,this.effectNode.wet&&this.wetParameter.set(e)}},{key:"setWet",value:function(e){this.effectNode.wet&&this.wetParameter.set(e)}},{key:"getWet",value:function(){return this.wetParameter.value}},{key:"getName",value:function(){return this.name}},{key:"getEffect",value:function(){return this.effectNode}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=(!(arguments.length>1&&void 0!==arguments[1])||arguments[1],new n(this.name,this.effectFn,e));return this.wetParameter&&t.setWet(this.wetParameter.get()),t.enable(this.enabledParameter.get()),t}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];void 0===e.id||t&&"boolean"===typeof t||(this.id=e.id,this.sequencerEngine.idToObject[this.id]=this),this.x=e.x,this.y=e.y,void 0!==e.enabled&&this.enable(e.enabled);var n={};return void 0!==this.wetParameter&&(void 0!==e.wet&&(Object(j.a)(this.wetParameter,e.wet,n),this.effectNode.wet&&(this.effectNode.wet.value=e.wet)),n=Object(a.a)({},n,this.loadParameterFromJson(e,"wetParameter",this.wetParameter,t))),n}},{key:"saveParameterToJson",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(n.isConnectedToAnyModulator()||Object.keys(n.patternToValue).length>0||Object.keys(n.stepToValue).length>0||Object.keys(n.paletteToValue).length>0||n.mixAutomation.automations.length>0||n.automations.length>=0||n.isMapped||n.higherOrdered||n.depthParameter||n.hasMacro){var i=Object(a.a)({},e);return i[t]=n.getJson(r),i}return e}},{key:"loadParameterFromJson",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return r="boolean"===typeof r&&r,t in e?(this.handleModulators(e[t],n),n.fromJson(e[t],this.sequencerEngine,r)):(n.disconnectFromAllModulators(),{})}},{key:"handleModulators",value:function(e,t){e.lfos&&t.lfos.filter(function(t){return!e.lfos.includes(t.number-1)}).forEach(function(e){return t.disconnectFromLFO(e)});e.envelopes&&t.envelopes.filter(function(t){return!e.envelopes.includes(t.number-1)}).forEach(function(e){return t.disconnectFromEnvelope(e)});t.disableKeyScaling()}},{key:"getJson",value:function(){var e={name:this.name,enabled:this.enabledParameter.get(),id:this.id,x:this.x,y:this.y};return void 0!==this.wetParameter&&(e.wet=this.wetParameter.get(!0),e.value=this.wetParameter.get(!0),e=this.saveParameterToJson(e,"wetParameter",this.wetParameter)),e}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.sequencerEngine.isOffline||!e?(this.effectNode&&this.effectNode.dispose(),this.parameters.forEach(function(e){return e.dispose()})):(this.parameters.forEach(function(e){return e.dispose(!1)}),v.releaseEffect(this.name,this.effectNode,this.sequencerEngine)),this.effectNode=void 0,this.parameters=void 0,this.context=void 0,this.name=void 0}}]),n}(Object(k.a)(Object(b.a)(function(){return function e(){Object(s.a)(this,e)}}()))),E=function(e){Object(u.a)(n,e);var t=S(n);function n(e,r){var a;Object(s.a)(this,n),a=t.call(this,"Filter",function(){return new p.a.Filter(80,"lowpass",-24)},e);var i={min:0,max:1e4,unit:"HZ",defaultValue:80,documentation:["Controls the frequency at which filtering works at. ","Ex: For Lowpass filters, frequencies above this value will be cut."]};return r&&(i.automationRate=r),a.cutoffParameter=new m.c("Cutoff",a.effectNode.frequency,i),a.qParameter=new m.c("Q",a.effectNode.Q,{min:0,max:20,unit:"",defaultValue:1}),a.typeParameter=new d.a("type",Object(c.a)(a),function(e,t){return a.effectNode.type=t},{min:"lowpass",max:"highpass",unit:"",defaultValue:"lowpass"}),a.registerParameter(a.cutoffParameter),a.registerParameter(a.typeParameter),a.registerParameter(a.qParameter),a.updateInitialValues(),a}return Object(o.a)(n,[{key:"dispose",value:function(){Object(r.a)(Object(f.a)(n.prototype),"dispose",this).call(this,!1)}},{key:"connect",value:function(e){Object(r.a)(Object(f.a)(n.prototype),"connect",this).call(this,e)}},{key:"syncable",value:function(){return!1}},{key:"toggle",value:function(e){}},{key:"setValue",value:function(e){this.value=e,e=5e3*e+50,this.effectNode.frequency.value=e}},{key:"setFrequency",value:function(e){try{this.cutoffParameter.set(e)}catch(t){}}},{key:"cutoffFrequency",get:function(){return this.cutoffParameter.get()},set:function(e){this.cutoffParameter.set(e)}},{key:"Q",set:function(e){this.qParameter.set(e)}},{key:"setQ",value:function(e){this.qParameter.set(e)}},{key:"lowpass",value:function(){this.type="lowpass"}},{key:"hipass",value:function(){this.type="highpass"}},{key:"type",get:function(){return this.typeParameter.get()},set:function(e){this.typeParameter.set(e)}},{key:"getFrequency",value:function(){return this.effectNode.frequency.value}},{key:"getQ",value:function(){return this.effectNode.Q.value}},{key:"getJson",value:function(){var e=Object(a.a)({},Object(r.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),frequency:this.effectNode.frequency.value,q:this.effectNode.Q.value,type:this.effectNode.type});return e=this.saveParameterToJson(e,"cutoffParameter",this.cutoffParameter),e=this.saveParameterToJson(e,"qParameter",this.qParameter),e=this.saveParameterToJson(e,"typeParameter",this.typeParameter)}},{key:"fromJson",value:function(e,t){var i=Object(r.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t);return this.enable(e.enabled),Object(j.a)(this.qParameter,e.q,i),Object(j.a)(this.cutoffParameter,e.frequency,i),Object(j.a)(this.typeParameter,e.type,i),Object(a.a)({},i,this.loadParameterFromJson(e,"qParameter",this.qParameter,t),this.loadParameterFromJson(e,"cutoffParameter",this.cutoffParameter,t),this.loadParameterFromJson(e,"typeParameter",this.typeParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(P),T=function(e){Object(u.a)(n,e);var t=S(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Auto Filter",function(){return new p.a.AutoFilter(4*new p.a.Time("1m"))},e)).qParameter=new m.c("Q",r.effectNode.filter.Q,{min:0,max:20,unit:"",defaultValue:1}),r.registerParameter(r.qParameter),r.effectNode.start(),r.effectNode.wet.value=1,r.storedLFOTime=4*new p.a.Time("1m"),r.updateInitialValues(),r}return Object(o.a)(n,[{key:"syncable",value:function(){return!0}},{key:"start",value:function(){this.effectNode.start()}},{key:"stop",value:function(){this.effectNode.stop()}},{key:"toggle",value:function(e){}},{key:"getLFOTime",value:function(){return new p.a.Time(this.effectNode.frequency.value).toNotation()}},{key:"getStoredLFOTime",value:function(){return this.storedLFOTime}},{key:"setLFOTime",value:function(e){this.storedLFOTime=e,this.effectNode.frequency.value=e}},{key:"lowpass",value:function(){this.effectNode.filter.type="lowpass"}},{key:"hipass",value:function(){this.effectNode.filter.type="highpass"}},{key:"getFilterType",value:function(){return this.effectNode.filter.type}},{key:"getJson",value:function(){return Object(a.a)({},Object(r.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),frequency:this.effectNode.frequency.value,storedLFOTime:this.storedLFOTime,baseFrequency:this.effectNode.baseFrequency,octaves:this.effectNode.octaves,q:this.effectNode.filter.Q.value,filterType:this.effectNode.filter.type})}},{key:"fromJson",value:function(e,t){Object(r.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.enable(e.enabled),this.effectNode.filter.Q.value=e.q,this.effectNode.frequency.value=e.frequency,this.effectNode.baseFrequency=e.baseFrequency,this.effectNode.octaves=e.octaves,this.storedLFOTime="storedLFOTime"in e?e.storedLFOTime:e.frequency,this.effectNode.filter.type=e.filterType}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(P),A=function(e){Object(u.a)(n,e);var t=S(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Pan",function(){return new p.a.Panner},e)).panParameter=new d.a("Panning",r.effectNode.pan,function(e,t){return e.value=t},{min:-1,max:1,unit:"",defaultValue:0}),r.registerParameter(r.panParameter),r.updateInitialValues(),r}return Object(o.a)(n,[{key:"toggle",value:function(e){}},{key:"setValue",value:function(e){this.value=e,this.panParameter.normalizedSet(e)}},{key:"getJson",value:function(){return Object(a.a)({},Object(r.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),value:this.value})}},{key:"fromJson",value:function(e,t){Object(r.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t);var a=new n;return a.setValue(this.value),a}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEnginei,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(P),M={ReverbEffect:function(e){Object(u.a)(n,e);var t=S(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Reverb",function(){return new p.a.Freeverb},e)).roomSizeParameter=new m.b("Room Size",r.effectNode.roomSize),r.registerParameter(r.roomSizeParameter),r.dampeningParameter=new m.a("Dampening",r.effectNode.dampening,function(e,t){return e.value=t},{min:0,max:1e4}),r.registerParameter(r.dampeningParameter),r.updateInitialValues(),r}return Object(o.a)(n,[{key:"setRoomSize",value:function(e){this.roomSizeParameter.set(e)}},{key:"setDampening",value:function(e){this.dampening.set(e)}},{key:"getDampening",value:function(){return this.effectNode.dampening.value}},{key:"getRoomSize",value:function(){return this.effectNode.roomSize.value}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEnginei,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(){var e=Object(a.a)({},Object(r.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),roomSize:this.roomSizeParameter.get(),wet:this.wetParameter.get(),dampening:this.dampeningParameter.get()});return(this.roomSizeParameter.isConnectedToAnyModulator()||Object.keys(this.roomSizeParameter.patternToValue).length>0)&&(e.roomSizeParameter=this.roomSizeParameter.getJson()),(this.dampeningParameter.isConnectedToAnyModulator()||Object.keys(this.dampeningParameter.patternToValue).length>0)&&(e.dampeningParameter=this.dampeningParameter.getJson()),e}},{key:"fromJson",value:function(e,t){Object(r.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.name=e.name,this.enable(e.enabled),"roomSize"in e&&this.roomSizeParameter.set(e.roomSize),"wet"in e&&this.wetParameter.set(e.wet),"dampening"in e&&this.dampeningParameter.set(e.dampening),this.loadParameterFromJson(e,"roomSizeParameter",this.roomSizeParameter,t),this.loadParameterFromJson(e,"dampeningParameter",this.dampeningParameter,t)}}]),n}(P),FilterEffect:E,TremoloEffect:function(e){Object(u.a)(n,e);var t=S(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Tremolo",function(){return new p.a.Tremolo},e)).effectNode.start(),r.rateParameter=new m.a("Rate",r.effectNode.frequency,function(e,t){return e.value=t},{min:0,max:32,defaultValue:0}),r.spreadParameter=new m.a("Spread",r.effectNode,function(e,t){return e.spread=t},{min:0,max:360,defaultValue:180}),r.depthParameter=new m.b("Depth",r.effectNode.depth),r.registerParameter(r.depthParameter),r.registerParameter(r.rateParameter),r.registerParameter(r.spreadParameter),r.updateInitialValues(),r}return Object(o.a)(n,[{key:"setRate",value:function(e){this.effectNode.frequency.value=e}},{key:"setDepth",value:function(e){this.effectNode.depth.value=e}},{key:"getRate",value:function(){return this.effectNode.frequency.value}},{key:"getDepth",value:function(){return this.effectNode.depth.value}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEnginei,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(){var e=Object(a.a)({},Object(r.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),depth:this.depthParameter.get(),spread:this.spreadParameter.get(),rate:this.rateParameter.get()});return(this.depthParameter.isConnectedToAnyModulator()||Object.keys(this.depthParameter.patternToValue).length>0)&&(e.depthParameter=this.depthParameter.getJson()),(this.spreadParameter.isConnectedToAnyModulator()||Object.keys(this.spreadParameter.patternToValue).length>0)&&(e.spreadParameter=this.spreadParameter.getJson()),(this.rateParameter.isConnectedToAnyModulator()||Object.keys(this.rateParameter.patternToValue).length>0)&&(e.rateParameter=this.rateParameter.getJson()),e}},{key:"fromJson",value:function(e,t){Object(r.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.name=e.name,this.enable(e.enabled),this.depthParameter.set(void 0!==e.depth?e.depth:1),this.spreadParameter.set(void 0!==e.spread?e.spread:180),this.wetParameter.set(void 0!==e.wet?e.wet:1),this.rateParameter.set(void 0!==e.rate?e.rate:1),this.loadParameterFromJson(e,"depthParameter",this.depthParameter,t),this.loadParameterFromJson(e,"spreadParameter",this.spreadParameter,t),this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t)}}]),n}(P),AutoFilterEffect:T,ChorusEffect:function(e){Object(u.a)(n,e);var t=S(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Chorus",function(){return new p.a.Chorus},e)).rateParameter=new m.a("Rate",r.effectNode.frequency,function(e,t){e&&(e.value=t)},{min:0,max:32,defaultValue:.8}),r.registerParameter(r.rateParameter),r.depthParameter=new m.a("Depth",r.effectNode,function(e,t){return e.depth=t},{min:0,max:100,unit:"%",automatable:!1,defaultValue:.5}),r.registerParameter(r.depthParameter),r.updateInitialValues(),r}return Object(o.a)(n,[{key:"setRate",value:function(e){this.effectNode.frequency.value=e}},{key:"setDepth",value:function(e){this.effectNode.depth=e}},{key:"getRate",value:function(){return this.effectNode.frequency.value}},{key:"getDepth",value:function(){return this.effectNode.depth}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"dispose",value:function(){Object(r.a)(Object(f.a)(n.prototype),"dispose",this).call(this,!0)}},{key:"getJson",value:function(){var e=Object(a.a)({},Object(r.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(!0),depth:this.depthParameter.get(!0),rate:this.rateParameter.get(!0)});return e=this.saveParameterToJson(e,"depthParameter",this.depthParameter),e=this.saveParameterToJson(e,"rateParameter",this.rateParameter)}},{key:"fromJson",value:function(e,t){var i=Object(r.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t);return this.name=e.name,this.enable(e.enabled),Object(j.a)(this.wetParameter,e.wet,i),Object(j.a)(this.depthParameter,e.depth,i),Object(j.a)(this.rateParameter,e.rate,i),Object(a.a)({},i,this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t),this.loadParameterFromJson(e,"depthParameter",this.depthParameter,t))}}]),n}(P),PanEffect:A,Effect:P};t.a=M},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(4),a=n(5),i=n(31),s=n(6),o=n(8),c=n(2),u=n(141),l=n(20),f=n(524),h=n(525);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var d=function(e){Object(s.a)(n,e);var t=p(n);function n(e){var a,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(r.a)(this,n),(a=t.call(this)).id=Object(l.uuid)(),a.zObject=e,s&&(a.zObject.effect=Object(i.a)(a)),a.subSequence=e.subSequence,a.sequencerEngine=a.subSequence.sequencerEngine,a.sequencerEngine.idToObject[a.id]=Object(i.a)(a),a.zObject.newAttribute("fill subpatch",!1),a}return Object(a.a)(n,[{key:"getParameters",value:function(){return[]}},{key:"fromJson",value:function(e,t){t||(this.id=e.id,this.sequencerEngine.idToObject[this.id]=this)}},{key:"getJson",value:function(){return{id:this.id}}}]),n}(Object(h.a)(Object(f.a)(Object(u.a)(function(){return function e(){Object(r.a)(this,e)}}()))))},function(e,t,n){"use strict";var r=n(185),a=n(4),i=function e(t,n){Object(a.a)(this,e),this.event=t,this.topics=n;for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];this.data=i},s=n(5),o=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Object(a.a)(this,e),this.name=t,this.type=n,this.size=64*r}return Object(s.a)(e,[{key:"convertTo",value:function(e){if(void 0!==e&&null!==e)return this.type.convertTo(e)}},{key:"convertFrom",value:function(e){if(void 0!==e&&null!==e)return this.type.convertFrom(e)}}]),e}();n.d(t,"V",function(){return c}),n.d(t,"U",function(){return u}),n.d(t,"Y",function(){return l}),n.d(t,"Q",function(){return f}),n.d(t,"Z",function(){return h}),n.d(t,"ab",function(){return p}),n.d(t,"R",function(){return d}),n.d(t,"x",function(){return v}),n.d(t,"k",function(){return m}),n.d(t,"y",function(){return y}),n.d(t,"S",function(){return b}),n.d(t,"X",function(){return g}),n.d(t,"bb",function(){return O}),n.d(t,"cb",function(){return k}),n.d(t,"I",function(){return j}),n.d(t,"n",function(){return w}),n.d(t,"p",function(){return x}),n.d(t,"q",function(){return S}),n.d(t,"r",function(){return P}),n.d(t,"e",function(){return E}),n.d(t,"m",function(){return T}),n.d(t,"c",function(){return A}),n.d(t,"B",function(){return M}),n.d(t,"A",function(){return R}),n.d(t,"H",function(){return C}),n.d(t,"G",function(){return N}),n.d(t,"w",function(){return q}),n.d(t,"f",function(){return I}),n.d(t,"M",function(){return _}),n.d(t,"P",function(){return D}),n.d(t,"W",function(){return F}),n.d(t,"d",function(){return L}),n.d(t,"t",function(){return B}),n.d(t,"s",function(){return z}),n.d(t,"o",function(){return J}),n.d(t,"db",function(){return V}),n.d(t,"j",function(){return H}),n.d(t,"v",function(){return U}),n.d(t,"h",function(){return G}),n.d(t,"g",function(){return W}),n.d(t,"u",function(){return K}),n.d(t,"l",function(){return Q}),n.d(t,"N",function(){return Z}),n.d(t,"O",function(){return Y}),n.d(t,"b",function(){return X}),n.d(t,"T",function(){return $}),n.d(t,"z",function(){return ee}),n.d(t,"F",function(){return te}),n.d(t,"eb",function(){return ne}),n.d(t,"C",function(){return re}),n.d(t,"i",function(){return ae}),n.d(t,"E",function(){return ie}),n.d(t,"a",function(){return se}),n.d(t,"J",function(){return oe}),n.d(t,"L",function(){return ce}),n.d(t,"K",function(){return ue}),n.d(t,"D",function(){return le});var c=new i("SampleTagged(bytes32,bytes32,uint32)",[new o("ipfsHash",r.i),new o("tag",r.b),new o("guildId",r.g)]),u=new i("SampleStyle(bytes32,bytes32,uint32)",[new o("ipfsHash",r.i),new o("style",r.b),new o("guildId",r.g)]),l=new i("SampleYear(bytes32,int16,uint32)",[new o("ipfsHash",r.i),new o("year",r.f),new o("guildId",r.g)]),f=new i("SampleCountry(bytes32,bytes32,uint32)",[new o("ipfsHash",r.i),new o("country",r.b),new o("guildId",r.g)]),h=new i("SampledYoutube(bytes32,bytes32,uint32)",[new o("ipfsHash",r.i),new o("videoId",r.l),new o("guildId",r.g)]),p=new i("SequenceCreated(address,bytes32,string)",[new o("user",r.a),new o("ipfsHash",r.i)],new o("title",r.m)),d=new i("SampleCreated(address,bytes32,string,uint32)",[new o("user",r.a),new o("ipfsHash",r.i),new o("guildId",r.g)],new o("title",r.m)),v=new i("NewNoteSequence(bytes32,bytes32)",[new o("sampleHash",r.i),new o("noteSequenceHash",r.i)]),m=new i("NewDiscogsSample(bytes32,uint256,bytes32,uint32)",[new o("sampleHash",r.i),new o("coverArtHash",r.i),new o("guildId",r.g)],new o("discogsId",r.n)),y=new i("NewNotesAggregation(bytes32,bytes32,bytes32,uint32,uint32,bytes32)",[new o("sampleHash",r.i),new o("noteA",r.k),new o("noteB",r.k)],new o("startTime",r.g),new o("endTime",r.g),new o("remainingNotes",r.j)),b=new i("SampleFavorited(address,bytes32)",[new o("user",r.a),new o("sampleHash",r.i)]),g=new i("SampleUnfavorited(address,bytes32)",[new o("user",r.a),new o("sampleHash",r.i)]),O=new i("SequenceEdited(address,bytes32,bytes32,bytes32,string)",[new o("user",r.a),new o("previousSequence",r.i),new o("newSequence",r.i)],new o("diff",r.i),new o("title",r.m)),k=new i("SequenceEdited(address,bytes32,bytes32,string,uint32)",[new o("user",r.a),new o("previousSequence",r.i),new o("newSequence",r.i)],new o("title",r.m),new o("bpm",r.g)),j=new i("PresetTagged(address,bytes32,bytes32,uint32)",[new o("contentHash",r.i),new o("tag",r.b),new o("guildId",r.g)],new o("user",r.a)),w=new i("NewGuild(address,uint32,string)",[new o("user",r.a),new o("guildId",r.g)],new o("name",r.m)),x=new i("NewGuildMemberRequest(address,address,uint32)",[new o("requester",r.a),new o("newMember",r.a),new o("guildId",r.g)]),S=new i("NewGuildMemberRequestAccepted(address,uint32)",[new o("newMember",r.a),new o("guildId",r.g)]),P=new i("NewGuildMemberRequestRejected(address,uint32)",[new o("newMember",r.a),new o("guildId",r.g)]),E=new i("GuildKeyEncrypted(address,uint32,bytes32)",[new o("user",r.a),new o("guildId",r.g),new o("ipfsHash",r.i)]),T=new i("NewEncryptedContent(address,bytes32,bytes32,int8,bytes32,bytes32[9],bytes32[6])",[new o("user",r.a),new o("newContent",r.i),new o("contentType",r.h)],new o("previousContent",r.i),new o("encryptedName",r.d),new o("encryptedContentKey",Object(r.c)(9),9),new o("publicKey",Object(r.c)(6),6)),A=new i("EncryptedContentShared(address,address,bytes32,bytes32[9],bytes32[6])",[new o("sharedWith",r.a),new o("creator",r.a),new o("contentHash",r.i)],new o("encryptedContentKey",Object(r.c)(9),9),new o("publicKey",Object(r.c)(6),6)),M=new i("NewPublicKey(address,bytes32[6])",[new o("user",r.a)],new o("publicKey",Object(r.c)(6),6)),R=new i("NewPreset(address,bytes32,uint32,bytes32,bytes32[9],bytes32[6])",[new o("user",r.a),new o("contentHash",r.i),new o("guildId",r.g)],new o("encryptedName",r.d),new o("encryptedContentKey",Object(r.c)(9),9),new o("publicKey",Object(r.c)(6),6)),C=new i("PresetSample(bytes32,bytes32,uint32)",[new o("contentHash",r.i),new o("sampleHash",r.i),new o("guildId",r.g)]),N=new i("PresetInstrumentType(bytes32,bytes32,uint32)",[new o("contentHash",r.i),new o("instrumentType",r.e),new o("guildId",r.g)]),q=new i("NewMonthlyIndex(bytes32,uint32,uint64)",[new o("month",r.n),new o("year",r.n)],new o("hash",r.i)),I=new i("New2DMapping(bytes32)",[new o("ipfsHash",r.i)]),_=new i("PublicMessageSent(address,address,bytes32,bytes32)",[new o("fromUser",r.a),new o("toUser",r.a),new o("referenceHash",r.i)],new o("messageHash",r.i)),D=new i("SampleCopyStrike(address,bytes32,bytes32)",[new o("user",r.a),new o("sampleHash",r.i),new o("referenceHash",r.i)]),F=new i("SampleTakenDown(bytes32)",[new o("sampleHash",r.i)]),L=new i("FoldersUpdated(address,bytes32)",[new o("user",r.a),new o("foldersHash",r.i)]),B=new i("NewIndex(uint32,bytes32)",[new o("guildId",r.g)],new o("indexHash",r.i)),z=new i("NewGuildSequence(address,bytes32,uint32,bytes32,bytes32,bytes32[9],bytes32[6])",[new o("user",r.a),new o("contentHash",r.i),new o("guildId",r.g)],new o("previousHash",r.i),new o("encryptedName",r.d),new o("encryptedContentKey",Object(r.c)(9),9),new o("publicKey",Object(r.c)(6),6)),J=new i("NewGuildClassification(uint32,bytes32)",[new o("guildId",r.g),new o("contentHash",r.i)]),V=new i("Transfer(address,address,uint256)",[new o("fromUser",r.a),new o("toUser",r.a)],new o("amount",r.g)),H=(new i("SequenceTagged(bytes32,bytes32,uint32)",[new o("ipfsHash",r.i),new o("tag",r.b),new o("guildId",r.g)]),new i("SequenceFavorited(bytes32,address,uint32)",[new o("ipfsHash",r.i),new o("user",r.a),new o("guildId",r.g)]),new i("SequenceStarred(bytes32,address,uint32)",[new o("ipfsHash",r.i),new o("user",r.a),new o("guildId",r.g)]),new i("SequenceUnfavorited(bytes32,address,uint32)",[new o("ipfsHash",r.i),new o("user",r.a),new o("guildId",r.g)]),new i("SequenceUnstarred(bytes32,address,uint32)",[new o("ipfsHash",r.i),new o("user",r.a),new o("guildId",r.g)]),new i("NewDataType(bytes32,string)",[new o("dataType",r.b)],new o("description",r.m))),U=new i("NewLinkType(bytes32,string)",[new o("linkType",r.b)],new o("description",r.m)),G=new i("NewAnnotationType(bytes32,string)",[new o("annotationType",r.b)],new o("description",r.m)),W=new i("NewAnnotation(bytes32,bytes32,bytes32,address)",[new o("annotationType",r.b),new o("data",r.i),new o("address",r.a)],new o("annotationData",r.b)),K=new i("NewLink(bytes32,bytes32,bytes32,address)",[new o("linkType",r.b),new o("fromData",r.i),new o("toData",r.i)],new o("address",r.a)),Q=(new i("NewMix(address,bytes32,bytes32,string,uint32)",[new o("user",r.a),new o("mixHash",r.i),new o("previousHash",r.i)],new o("title",r.m),new o("guildId",r.g)),new i("NewEffect(address,bytes32,bytes32,string,uint32)",[new o("user",r.a),new o("effectHash",r.i),new o("effectType",r.b)],new o("title",r.m),new o("guildId",r.g))),Z=new i("ReleaseInfo(bytes32,uint32,string,bytes32,bytes32)",[new o("artistName",r.b),new o("releaseId",r.g)],new o("releaseName",r.m),new o("coverArtHash",r.i),new o("releaseType",r.b)),Y=new i("SampleByArtist(bytes32,bytes32)",[new o("artistName",r.b),new o("ipfsHash",r.i)]),X=new i("ArtistInfo(bytes32,bytes32,string)",[new o("artistName",r.b),new o("linkType",r.b)],new o("link",r.m)),$=(new i("MidiCCParameter(bytes32,uint32,bytes32,address)",[new o("deviceName",r.b),new o("ccNumber",r.g),new o("parameterName",r.b)],new o("user",r.a)),new i("SampleInSequence(bytes32,bytes32)",[new o("sequenceHash",r.i),new o("sampleHash",r.i)])),ee=(new i("ListEdited(bytes32,bytes32,address,bytes32,uint32)",[new o("newContent",r.i),new o("previousContent",r.i),new o("user",r.a)],new o("title",r.b),new o("guildId",r.g)),new i("ListHighlighted(bytes32,address)",[new o("contentHash",r.i)],new o("user",r.a)),new i("ListUnhighlighted(bytes32,address)",[new o("contentHash",r.i)],new o("user",r.a)),new i("ListFavorited(bytes32,address)",[new o("contentHash",r.i)],new o("user",r.a)),new i("ListUnfavorited(bytes32,address)",[new o("contentHash",r.i)],new o("user",r.a)),new i("ListDeleted(bytes32,address)",[new o("contentHash",r.i),new o("user",r.a)]),new i("NewWallpaper(address,bytes32,bytes32)",[new o("user",r.a),new o("wallpaperHash",r.i),new o("thumbnailHash",r.i)]),new i("DefaultWallpaper(address,bytes32)",[new o("user",r.a),new o("wallpaperHash",r.i)]),new i("NewPack(address,bytes32,bytes32,bytes32)",[new o("user",r.a),new o("packHash",r.i),new o("previousHash",r.i)],new o("title",r.b))),te=new i("PackHasContent(bytes32,bytes32)",[new o("packHash",r.i),new o("contentHash",r.i)]),ne=new i("UserLeftGuild(uint256,address)",[new o("guildId",r.g)],new o("user",r.a)),re=new i("NewScript(address,bytes32,bytes32,bytes32)",[new o("user",r.a),new o("scriptHash",r.i),new o("scriptType",r.b)],new o("title",r.b)),ae=new i("NewCreatorProject(address,uint256,bytes32,uint256,string)",[new o("creator",r.a),new o("projectId",r.n),new o("contentHash",r.i)],new o("maxInvocations",r.n),new o("title",r.m)),ie=new i("NewTokenSeed(uint256,uint256,bytes32)",[new o("projectId",r.n),new o("tokenId",r.n)],new o("seedHash",r.b)),se=(new i("ZoraProject(bytes32,uint256)",[new o("projectHash",r.i),new o("zoraId",r.n)]),new i("AccountAuthorized(address,address,string,uint8,bytes32,bytes32)",[new o("zequencerAddress",r.a),new o("walletAddress",r.a)],new o("message",r.m),new o("v",r.h),new o("r",r.d),new o("s",r.d))),oe=(new i("PluginCreated(uint256,address,string)",[new o("tokenId",r.n),new o("creator",r.a)],new o("name",r.m)),new i("NewPluginVersion(uint256,uint256,bytes32,string)",[new o("tokenId",r.n),new o("versionNumber",r.n)],new o("pluginContentHash",r.i),new o("pluginMetadataURI",r.m)),new i("ProjectHasArrangement(bytes32)",[],new o("projectHash",r.i))),ce=(new i("ProjectBPM(bytes32,int16)",[],new o("projectHash",r.i),new o("bpm",r.n)),new i("ProjectVisuals(bytes32,bytes32)",[],new o("projectHash",r.i),new o("thumbnailhash",r.i))),ue=new i("ProjectUsesPreset(bytes32,bytes32)",[],new o("projectHash",r.i),new o("presetHash",r.i)),le=(new i("ProjectPatternsCount(bytes32,int8)",[],new o("projectHash",r.i),new o("patterns",r.n)),new i("NewSporeCreated(uint256,uint256,address,address,bytes32,bytes32)",[],new o("sporeId",r.n),new o("tokenId",r.n),new o("proxy",r.a),new o("creator",r.a),new o("sporeHash",r.i),new o("dataHash",r.i)),new i("NewChainCreated(uint256,bytes32,address,address,bytes32)",[],new o("chainId",r.n),new o("name",r.b),new o("proxy",r.a),new o("creator",r.a),new o("chainHash",r.i)),new i("NewSkin(uint256,bytes32)",[],new o("skinId",r.n),new o("imageHash",r.i)))},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e,t,n,r,a){if(0===r||r/100<=Math.random())return n;if(!e)return n;var i=e.set(t,!0,!0);if(i){var s=i.id,o=i.value;n[s]=o}else n[e.id]=t;return n}},,,function(e,t,n){"use strict";(function(e){var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(946),u=n.n(c),l=n(494),f=n(392),h=(n(138),n(297)),p=(new XMLHttpRequest,"/ip4/3.17.26.249/tcp/4001/ipfs/QmeQRpfSrYcAaqkhNoArDyTUwyYiru2gJp4WY1WegQGjtR"),d=[85,110,105,118,101,114,115,97,108,32,83,101,113,101,117,110,99,101,115];window.httpV="http://www.zequencer.io:5001",window.httpsV="https://www.zequencer.io:5002";var v=new(function(){function t(){if(Object(s.a)(this,t),this.soundCache={},this.controllers=new Set,!window.isNFT){"http:"===window.location.protocol?(this.backupIpfs=new u.a("ipfs.infura.io","5001",{protocol:"https"}),window.isNFT?(this.centralIpfs=this.backupIpfs,this._centralIpfs=u()("www.zequencer.io","5001",{protocol:"http"})):(this.centralIpfs=u()("www.zequencer.io","5001",{protocol:"http"}),this._centralIpfs=this.centralIpfs)):window.isNFT?(this.centralIpfs=this.backupIpfs,this._centralIpfs=u()("www.zequencer.io","5002",{protocol:"https"})):(this.centralIpfs=u()("www.zequencer.io","5002",{protocol:"https"}),this._centralIpfs=this.centralIpfs),this.ipfs=this.centralIpfs;this.connectedLocally=!1,this.finishedTestingLocalConnection=!0}}return Object(o.a)(t,[{key:"restart",value:function(){}},{key:"getIPFSPrefix",value:function(){return this.connectedLocally?"http://localhost:5001":"http:"===window.location.protocol?window.httpV:"https:"===window.location.protocol?window.httpsV:void 0}},{key:"getHashUrl",value:function(e){return this.connectedLocally?"http://localhost:8080/ipfs/"+e:(window.location.protocol,"/ipfs/"+e)}},{key:"getPinnedHashes",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ipfs.refs.local();case 2:return t=e.sent,e.abrupt("return",t.map(function(e){return e.ref}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"findProvs",value:function(e){var t=this;return new Promise(function(n,r){t.ipfs.dht.findprovs(e,{maxNumProviders:1},function(e,t){n(t)})})}},{key:"connectToCentral",value:function(){try{this.ipfs.swarm.connect(p,function(e,t){}).catch(function(e){return console.log("error")})}catch(e){console.log("error connecting to ipfs")}}},{key:"keepSwarmConnectionAlive",value:function(){var e=this;try{this.ipfs.swarm.connect(p,function(e,t){}).catch(function(e){return console.log("error")})}catch(t){console.log("error connecting to ipfs")}setInterval(function(){if(window.sequencerEngine&&window.sequencerEngine.getSequenceId){var n=window.sequencerEngine.getSequenceId();if(window.sequencerEngine.store.getState().sequencer.isPlaying[n])return}try{e.ipfs.swarm.connect(p,function(e,t){}).catch(function(e){return console.log("error")})}catch(t){console.log("error connecting to ipfs")}},6e4)}},{key:"isConnectedLocally",value:function(){return this.connectedLocally}},{key:"addArrayBuffer",value:function(e,t){return this.addHelper(e,t)}},{key:"addArrayBufferAndSaveToDB",value:function(e,t){return this.addBlobAndSaveToDB(new Blob([new Uint8Array(e)]),t)}},{key:"addHelper",value:function(t){var n=this,r=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2?arguments[2]:void 0);void 0===r&&(r="hello");return new Promise(function(a,i){var s=n._centralIpfs||n.ipfs;s||(s="http:"===window.location.protocol?u()("www.zequencer.io","5001",{protocol:"http"}):u()("www.zequencer.io","5002",{protocol:"https"})),s.add({name:r,path:"hello",content:new e(t)},function(e,t){var n=t[0].hash;e?i(e):a(n)})})}},{key:"addBuffer",value:function(e){var t=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&arguments[2];return new Promise(function(n,r){var a=t.centralIpfs;a.add(e,function(e,t){if(e)r(e);else{var i=t[0].hash;a.pin.add(i),n(i)}})})}},{key:"addJson",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"LOCAL",a=arguments.length>2?arguments[2]:void 0;return new Promise(function(i,s){console.log("adding json noUTF=",a,t);var o=n._centralIpfs||n.ipfs;o||(o="http:"===window.location.protocol?u()("www.zequencer.io","5001",{protocol:"http"}):u()("www.zequencer.io","5002",{protocol:"https"})),o.add(e.from(JSON.stringify(t)),function(e,t){if(e)s(e);else{var n=t[0].hash;o.pin.add(n),i(n)}}),"LOCAL"===r&&(o!==n.centralIpfs&&n.addJson(t,"UNIVERSAL",a).then(function(e){return i(e)}),n.addJson(t,"INFURA",a).then(function(e){return i(e)}))})}},{key:"getJson",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.restart(),new Promise(function(c,u){if(s)t.ipfs.cat(e,function(e,t){c(JSON.parse(t.toString("utf8")))});else if(e){n?t.centralIpfs:t.ipfs;var l=new AbortController;t.controllers.add(l);var f=l.signal;setTimeout(function(){l.abort(),t.controllers.delete(l),u()},r);var h="GET",p="https://zequencer.io/ipfs/"+e;if(window.isNFT&&!o)return h="GET",p=e,void fetch(p+".mp3",{signal:f,method:h}).then(function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:n=e.sent,c(n);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());if(window.isNFT&&!o)return c({});(new Date).getTime();fetch(p,{signal:f,method:h}).then(function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:return n=e.sent,c(n),e.abrupt("return");case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}else c({})})}},{key:"addBytesArray",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Uint8Array(t.length+d.length)).set(t,0),n.set(d,t.length),e.next=5,this.addHelper(n.buffer);case 5:return r=e.sent,this.ipfs.pin.add(r),e.abrupt("return",r);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"pin",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ipfs.pin.add(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addBlob",value:function(e,t){var n=this;return this.restart(),new Promise(function(r,a){var i,s=new FileReader,o=n;s.onload=function(){var e=this;i=this.result,o.addHelper(i,void 0,t).then(function(t){e.connectedLocally&&o.ipfs.pin.add(t),o.centralIpfs.pin.add(t),r(t)}).catch(function(e){return a(e)})},s.readAsArrayBuffer(e)})}},{key:"addBlobAndSaveToDB",value:function(e,t){}},{key:"converttoarraybuffer",value:function(e){return new Promise(function(t,n){var r=new r;r.onload=function(){t(this.result)},r.readasarraybuffer(e)})}},{key:"readAllChunks",value:function(e){var t=e.getReader(),n=[];return function e(){return t.read().then(function(t){var r=t.value;return t.done?n:(n.push(r),e())})}()}},{key:"clearCache",value:function(){this.soundCache={}}},{key:"preloadSound",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4e4,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise(function(){var s=Object(i.a)(a.a.mark(function i(s,o){var c;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t.soundCache[e]){a.next=6;break}return a.next=3,t.getSound(e,n,r);case 3:c=a.sent,Object(l.b)(c,e).then(function(t){t.error?s(t):Object(f.a)(t,e).then(function(e){s(e)})}).catch(function(e){s({error:"fuck"})}),t.soundCache[e]=c;case 6:case"end":return a.stop()}},i)}));return function(e,t){return s.apply(this,arguments)}}())}},{key:"getSound",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4e4,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n||(n=4e4),new Promise(function(s,o){if(t.soundCache&&t.soundCache[e])s(t.soundCache[e]);else{var c=new AbortController;t.controllers.add(c);var u=c.signal;setTimeout(function(){c.abort(),t.controllers.delete(c),o()},n);var l="GET",f="https://zequencer.io/ipfs/"+e;if(window.isNFT&&(f=e+".mp3"),window.spores&&(f="https://zequencer.mypinata.cloud/ipfs/"+e),e.includes("http")&&(f=e),window.isNFT&&!r)return l="GET",f=e+".mp3",fetch(f,{signal:u,method:l}).then(function(){var n=Object(i.a)(a.a.mark(function n(r){var i,o;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.arrayBuffer();case 2:i=n.sent,o=new Uint8Array(i),t.soundCache[e]=o,s(o);case 6:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}());if(window.isNFT&&!r)return s([]);(new Date).getTime();fetch(f,{signal:u,method:l}).then(function(){var e=Object(i.a)(a.a.mark(function e(n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(new Date).getTime(),e.next=3,n.arrayBuffer();case 3:return r=e.sent,(new Date).getTime(),i=t.processArray(new Uint8Array(r)),s(i),e.abrupt("return");case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.log("aborted")})}})}},{key:"arrayToBuffer",value:function(e){var t=new ArrayBuffer(e.length);return e.map(function(e,n){t[n]=e}),t}},{key:"cancel",value:function(){console.log("cancelling = ",this.controllers),Array.from(this.controllers).forEach(function(e){return e.abort()})}},{key:"processArray",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]))return e;var t=e,n=this.findEnd(t,d);return-1!==n?t.slice(0,n):e.slice(0,e.length-1024)}},{key:"mergeArrays",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=0;for(var a in e)r+=e[a].length;var i=new Uint8Array(r-t),s=0;for(var o in e)0===s?(i.set(e[o].subarray(t),s),s+=e[o].length-t):(i.set(e[o],s),s+=e[o].length);if(!n)return i;var c=i,u=this.findEnd(c,d);return-1!==u?c.slice(0,u):i.slice(0,i.length-1024)}},{key:"findEnd",value:function(e,t){for(var n=e.length-1600,r=e.slice(n).values(),a=0,i=n;i<e.length;i++){if(r.next().value===t[a]){if(0==a&&(n=i),++a===t.length-1)return n}else a=0,n=i}return-1}},{key:"getAudioBuffer",value:function(e,t){var n=this;return this.restart(),new Promise(function(r,a){n.getSound(e).then(function(e){return t.decodeAudioData(h(e),function(e){r(e)},function(e,t,n){n&&a(n)})}).catch(function(e){a(e)})})}}]),t}());t.a=v}).call(this,n(108).Buffer)},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(136),o=function(){function e(){Object(a.a)(this,e)}return Object(i.a)(e,[{key:"getCopy",value:function(){var t=new e;return t.sequencerEngine=this.sequencerEngine,t.envelopesTrack=this.envelopesTrack,t.envelopeTrack=this.envelopeTrack,t.lfosTrack=this.lfosTrack,t.lfoTrack=this.lfoTrack,t.liveEffect=this.liveEffect,t.track=this.track,t.group=this.group,t.instrument=this.instrument,t.send=this.effect,t.effect=this.effect,t.midiEffect=this.midiEffect,t.subDevice=this.subDevice,t.macro=this.macro,t.formant=this.formant,t.oscillator=this.oscillator,t._subSequence=this._subSequence,t.zObject=this.zObject,t}},{key:"forZObject",value:function(e){return this.zObject=e,this}},{key:"forSequencerEngine",value:function(e){return this.sequencerEngine=e,this}},{key:"subSequence",get:function(){return this._subSequence?this._subSequence:void 0!==this.envelopesTrack?this.envelopesTrack.subSequence:void 0!==this.lfosTrack?this.lfosTrack.subSequence:void 0!==this.track?this.track.subSequence:void 0}},{key:"forEnvelopeTrack",value:function(e,t){return this.envelopeTrack=e,this.envelopesTrack=t,this}},{key:"forLFOTrack",value:function(e,t){return this.lfoTrack=e,this.lfosTrack=t,this}},{key:"forMacro",value:function(e){return this.macro=e,this}},{key:"forTrack",value:function(e){return this.track=e,this}},{key:"forGroup",value:function(e){return this.group=e,this}},{key:"forSend",value:function(e){return this.send=e,this}},{key:"forEffect",value:function(e){return this.effect=e,this}},{key:"forMidiEffect",value:function(e){return this.midiEffect=e,this}},{key:"forLiveEffect",value:function(e){return this.liveEffect=e,this}},{key:"forInstrument",value:function(e){return this.instrument=e,this}},{key:"forSubSequence",value:function(e){return this._subSequence=e,this}},{key:"forOscillator",value:function(e){return this.oscillator=e,this}},{key:"forSubDevice",value:function(e){return this.subDevice=e,this}},{key:"forFormant",value:function(e){return this.formant=e,this}},{key:"getEffectContext",value:function(){return void 0!==this.track?this.track:void 0!==this.group?this.group:void 0!==this.send?this.send:void 0}},{key:"getJson",value:function(){var e={},t=[];if(void 0!==this.track&&this.track.getTrackType&&this.track.getTrackType()===s.b&&(e=Object(r.a)({},e,{track:this.track.trackNumber,isInstrument:!0})),void 0!==this.track?(t=this.track.effects,e.track=this.track.trackNumber):void 0!==this.group?(t=this.group.effects,e.group=this.group.groupNumber):void 0!==this.send&&(t=this.send.effects,e.send=this.send.sendNumber),e.effect=-1,this.effect&&(t&&(e.effect=t.indexOf(this.effect),e.effectName=this.effect.name),this.subDevice&&this.effect.getSubDeviceIndex&&(e.subDevice=this.effect.getSubDeviceIndex(this.subDevice))),this.midiEffect&&this.track&&this.track.midiEffects&&(e.midiEffect=this.track.midiEffects.effects.indexOf(this.midiEffect),e.midiEffectName=this.midiEffect.name),this.liveEffect&&(e.liveEffect=this.track.liveEffects.effects.indexOf(this.liveEffect),e.liveEffectName=e.liveEffect.name),this.macro&&(e.macro=this.macro.id),this.instrument){e.isInstrument=!0;var n=void 0;this.subDevice&&(n=this.track.instrument.getSubDeviceIndex(this.subDevice)),e.subDevice=n,e.instrumentType=this.instrument.getInstrumentType&&this.instrument.getInstrumentType()}return e}},{key:"combineWith",value:function(e){return e.track&&(this.track=e.track),e.effect&&(this.effect=e.effect),e.subDevice&&(this.subDevice=e.subDevice),e.send&&(this.send=e.send),e._subSequence&&(this._subSequence=e._subSequence),this}}]),e}();t.a=o},,function(e,t,n){"use strict";(function(e){var r=n(1),a=n(11),i=n(42),s=n.n(i),o=n(56),c=n(4),u=n(5),l=n(158),f=n(1825),h=n(153),p=n(1578),d=n(1823),v=(n(1579),n(155)),m=n(146),y=n(1580),b=n(295),g=n(1581),O=n(1582),k=n(917),j=n(1583),w=n(1827),x=n(773),S=n(1584),P=n(1585),E=n(795),T=n(1586),A=n(1587),M=n(1588),R=n(139),C=(n(214),n(118)),N=n(918),q=n(1828),I=n(1589);function _(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var F=new b.a,L=new O.a,B=new x.a,z=new S.a,J=new P.a,V=new y.a,H=n(186);function U(e){for(var t=e.map(function(e){return W(e.ipfsHash)}),n=l.a.utils.padLeft("0x0",64),r=t.length;r<16;r++)t.push(n);for(var a=[],i=[],s=[],o=0;o<16;o++)if(void 0!==e[o]){var c=e[o].videoId;void 0===c||"0x00"===c||""===c?s.push(n):s.push(l.a.utils.padRight(l.a.utils.fromAscii(c),64));var u=e[o].coverArt;void 0===u?a.push(n):a.push(W(u)),void 0===e[o].discogsId?i.push(0):i.push(e[o].discogsId)}else a.push(n),i.push(0),s.push(n);for(var f=e.map(function(e){return l.a.utils.padRight(l.a.utils.fromAscii(e.title).slice(0,66),64)}),h=f.length;h<16;h++)f.push(n);for(var p=e.map(function(e){var t=e.tags.map(function(e){return l.a.utils.padRight(l.a.utils.fromAscii(e),64)});return Z(t)}),d=p.length;d<16;d++)p.push([n,n,n,n]);for(var v=e.map(function(e){var t=e.styles.map(function(e){return e?l.a.utils.padRight(l.a.utils.fromAscii(e),64):n});return Z(t)}),m=v.length;m<16;m++)v.push([n,n,n,n]);for(var y=e.map(function(e){return null===e.country||""===e.country?n:l.a.utils.padRight(l.a.utils.fromAscii(e.country),64)}),b=y.length;b<16;b++)y.push(n);for(var g=e.map(function(e){return null===e.year||void 0===e.year?0:e.year}),O=g.length;O<16;O++)g.push(0);return{sampleHashes:t,tags:p,titles:f,styles:v,years:g,countries:y,discogsIds:i,coverArts:a,videoIds:s}}function G(e){for(var t=l.a.utils.fromAscii(e),n=t.length;n<=65;n++)t+="0";return t}function W(e){var t=H.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}var K=new(function(){function e(){Object(c.a)(this,e),void 0!==l.a&&(this.web3=l.a,l.a.eth.net.isListening()&&(this.contract=new l.a.eth.Contract(F.abi,F.contractAddress),this.slicesContract=new l.a.eth.Contract(L.abi,L.contractAddress),this.favoritesContract=new l.a.eth.Contract(B.abi,B.contractAddress),this.slicesContractAddress=this.slicesContract.options.address,this.ethAddress=this.contract.options.address,this.favoritesContractAddress=this.favoritesContract.options.address,this.sequencesContract=new l.a.eth.Contract(J.abi,J.contractAddress),this.sequencesContractAddress=this.sequencesContract.options.address,this.indexContract=new l.a.eth.Contract(z.abi,z.contractAddress),this.indexContractAddress=this.indexContract.options.address,this.multiSamplesContract=V.getContract(l.a)),this.cachedTags=void 0,this.users=new E.a(l.a),this.crypto=new k.a(this),this.encryption=new j.a(l.a,this.crypto),this.guilds=new T.a(l.a,this.crypto,this.encryption),this.tokenizedSequences=new g.a(l.a),this.guildSequences=new M.a(l.a,this.guilds,this.encryption,this.crypto),this.samples2D=new f.a(l.a),this.messaging=new w.a(l.a),this.dmca=new q.a(l.a),this.folders=new p.a(l.a),this.resample=new I.a(l.a),this.presets=new N.a(l.a,this.crypto,this.guilds),this.xanadu=new d.a(l.a),this.guildSamples=new A.a(l.a))}return Object(u.a)(e,[{key:"postUserId",value:function(){var e=Object(o.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"guildId",get:function(){if(void 0===this.store)return 0;var e=this.store.getState().guilds.selectedGuild;return e?e.guildId:0}},{key:"isMetamaskInstalled",value:function(){return!1}},{key:"getUser",value:function(){var e=Object(o.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.getAccount();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getSoundsWithUserBlockNumber",value:function(){var e=Object(o.a)(s.a.mark(function e(t,n){var r,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new R.a(this.ethAddress).from(C.R).select("ipfsHash").where("user",t).fromBlock(n).toBlock(n).where("guildId",this.guildId),e.next=3,r.executeQuery(!0);case 3:return a=e.sent,e.abrupt("return",Array.from(new Set(a.map(function(e){return e.ipfsHash}))));case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSoundsWithDiscogs",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new R.a(this.ethAddress).from(C.k).select("sampleHash").where("discogsId",t).where("guildId",this.guildId),e.next=3,n.executeQuery(!0);case 3:return r=e.sent,e.abrupt("return",Array.from(new Set(r.map(function(e){return e.sampleHash}))));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCoverArtForDiscogs",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new R.a(this.ethAddress).from(C.k).select("coverArtHash").where("discogsId",t),e.next=3,n.executeQuery(!0);case 3:return r=e.sent,e.abrupt("return",r[0]);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCachedTags",value:function(e,t){return e>this.cachedTags.length?[]:e+t>this.cachedTags.length?this.cachedTags.slice(e):this.cachedTags.slice(e,e+t)}},{key:"searchTags",value:function(e){var t=this;return new Promise(function(n,r){void 0!==t.cachedTags?(e=e.toLowerCase(),n(t.cachedTags.filter(function(t){return t.toLowerCase().includes(e)}))):n([])})}},{key:"getTagsForSound",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(C.V).select("tag").where("ipfsHash",t).executeQuery(!0);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.tag}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getYearsForSound",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(C.Y).select("year").where("ipfsHash",t).executeQuery(!0);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.year}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getVideoIdForSound",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(C.Z).select("videoId").where("ipfsHash",t).executeQuery(!0);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.videoId})[0]);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTitleForSound",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(C.R).select("title").where("ipfsHash",t).executeQuery(!0);case 2:return n=(n=e.sent).filter(function(e){return""!==e.title})[0],e.abrupt("return",void 0!==n?n.title:void 0);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUserNameForSound",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(C.R).select("user").where("ipfsHash",t).executeQuery(!0);case 2:if(void 0===(n=(n=e.sent).map(function(e){return e.user})[0])){e.next=9;break}return console.log("user = "+n),e.next=8,this.users.getUserName(n);case 8:return e.abrupt("return",e.sent);case 9:return e.abrupt("return",void 0);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCoverArtForSound",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(C.k).select("coverArtHash").where("sampleHash",t).executeQuery(!0);case 2:return n=(n=e.sent).filter(function(e){return""!==e.coverArtHash})[0],e.abrupt("return",void 0!==n?n.coverArtHash:void 0);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getFavoritesForSound",value:function(e){var t=this;return new Promise(function(){var n=Object(o.a)(s.a.mark(function n(r,a){var i,o,c,u,l,f,p,d;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,h.a.getAccount();case 2:if(void 0!==(i=n.sent)){n.next=6;break}return r({userFavorited:[],othersFavorited:[]}),n.abrupt("return");case 6:return n.next=8,new R.a(t.favoritesContractAddress).from(C.S).select("user").where("sampleHash",e).executeQuery();case 8:return o=n.sent,n.next=11,new R.a(t.favoritesContractAddress).from(C.X).select("user").where("sampleHash",e).executeQuery();case 11:c=n.sent,u=i.toLowerCase(),l=o.filter(function(e){return e.user===u}),f=o.filter(function(e){return e.user!==u}),p=c.filter(function(e){return e.user===u}),d=c.filter(function(e){return e.user!==u}),r({userFavorited:l.length-p.length,othersFavorited:f.length-d.length});case 18:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getOverallVotedRankings",value:function(){var e=this;return new Promise(function(){var t=Object(o.a)(s.a.mark(function t(n,r){var a,i,o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new R.a(e.favoritesContractAddress).from(C.S).select("sampleHash").executeQuery();case 2:return a=t.sent,t.next=5,new R.a(e.favoritesContractAddress).from(C.X).select("sampleHash").executeQuery();case 5:i=t.sent,o={},a.forEach(function(e){var t=e.sampleHash;t in o?o[t]++:o[t]=1}),i.forEach(function(e){var t=e.sampleHash;t in o?o[t]--:o[t]=-1}),n(o);case 10:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getFavoritesForUser",value:function(){var e=this;return new Promise(function(){var t=Object(o.a)(s.a.mark(function t(n,r){var a,i,o,c,u,l,f,p,d,v,m,y,b;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.getAccount();case 2:if(void 0!==(a=t.sent)){t.next=6;break}return n([]),t.abrupt("return");case 6:return i=a.toLowerCase(),t.next=9,new R.a(e.favoritesContractAddress).from(C.S).select("sampleHash").where("user",i).executeQuery();case 9:return o=t.sent,t.next=12,new R.a(e.favoritesContractAddress).from(C.X).select("sampleHash").where("user",i).executeQuery();case 12:for(d in c=t.sent,u=o.map(function(e){return e.sampleHash}),l=c.map(function(e){return e.sampleHash}),f={},p={},u)u[d]in f?f[u[d]]++:f[u[d]]=1;for(v in l)l[v]in p?p[l[v]]++:p[l[v]]=1;for(y in m=[],f)b=f[y],y in p&&(b-=p[y]),b>0&&m.push(y);n(m);case 22:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getSoundsWithVideo",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(C.Z).select("ipfsHash").where("videoId",t).where("guildId",this.guildId).executeQuery();case 2:return n=e.sent,e.abrupt("return",Array.from(new Set(n.map(function(e){return e.ipfsHash}))));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithOrTags",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=new R.a(this.ethAddress).from(C.V).select("ipfsHash").whereIn("tag",t),e.next=3,this.getGuildsWithAccess();case 3:return e.t1=e.sent,n=e.t0.whereIn.call(e.t0,"guildId",e.t1),e.next=7,n.executeQuery();case 7:return r=e.sent,e.abrupt("return",r.map(function(e){return e.ipfsHash}));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithTag",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,r=void 0,this.cache.useMonth&&(n=this.cache.toBlock,r=this.cache.fromBlock),e.t0=Array,e.t1=Set,e.next=7,this.getSoundsWithField("tag",t,C.V,!1,r,n);case 7:return e.t2=e.sent,e.t3=new e.t1(e.t2),e.abrupt("return",e.t0.from.call(e.t0,e.t3));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithStyle",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,r=void 0,this.cache.useMonth&&(n=this.cache.toBlock,r=this.cache.fromBlock),e.abrupt("return",this.getSoundsWithField("style",t,C.U,!1,r,n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithCountry",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,r=void 0,this.cache.useMonth&&(n=this.cache.toBlock,r=this.cache.fromBlock),e.abrupt("return",this.getSoundsWithField("country",t,C.Q,!1,r,n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithYear",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,r=void 0,this.cache.useMonth&&(n=this.cache.toBlock,r=this.cache.fromBlock),e.abrupt("return",this.getSoundsWithField("year",t,C.Y,!1,r,n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithFieldParallel",value:function(){var e=Object(o.a)(s.a.mark(function e(t,n,r){var a,i,o,c,u,l,f,h,p,d,v,m=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=m.length>3&&void 0!==m[3]&&m[3],i=m.length>4?m[4]:void 0,o=m.length>5?m[5]:void 0,!(i+1>=o)){e.next=5;break}return e.abrupt("return",[]);case 5:for(8,c=o-i,u=[],l=1;l<=8;l++)f=i+Math.floor((l-1)*c/8),h=i+Math.floor(l*c/8),u.push(this.getSoundsWithField(t,n,r,a,f,h));return e.next=11,Promise.all(u);case 11:for(v in p=e.sent,d=[],p)d=d.concat(p[v]);return e.abrupt("return",Array.from(new Set(d)));case 15:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSoundsWithField",value:function(){var e=Object(o.a)(s.a.mark(function e(t,n,r){var a,i,o,c=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.length>3&&void 0!==c[3]&&c[3],i=c.length>4&&void 0!==c[4]?c[4]:37e5,o=c.length>5?c[5]:void 0,e.prev=3,e.next=6,this.getSoundsWithFieldHelper(t,n,r,a,i,o);case 6:return e.abrupt("return",e.sent);case 9:return e.prev=9,e.t0=e.catch(3),e.next=13,this.getSoundsWithFieldParallel(t,n,r,a,i,o);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}},e,this,[[3,9]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getGuildsWithAccess",value:function(){var e=Object(o.a)(s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((new Date).getTime(),0===this.guildId){e.next=3;break}return e.abrupt("return",[this.guildId]);case 3:return e.t0=a.a,e.next=6,this.guilds.getGuildsWithAccess();case 6:e.t1=e.sent,(t=(0,e.t0)(e.t1)).sort(),e.t2=s.a.keys(t);case 10:if((e.t3=e.t2()).done){e.next=18;break}if(!((n=e.t3.value)>=1)){e.next=14;break}return e.abrupt("break",18);case 14:return e.next=16,this.guilds.getGuildKey(t[n]);case 16:e.next=10;break;case 18:return t.length>0&&(t=[t[0]]),(new Date).getTime(),e.abrupt("return",[].concat(Object(a.a)(t),[0]));case 21:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSoundsWithFieldHelper",value:function(e,t,n){var r=this,a=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:37e5),i=arguments.length>5?arguments[5]:void 0;a&&l.a.utils.toHex(a);return i&&l.a.utils.toHex(i),new Promise(function(){var c=Object(o.a)(s.a.mark(function o(c,u){var l,f,h;return s.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,r.getGuildsWithAccess();case 2:return l=s.sent,f=new R.a(r.ethAddress).from(n).select("ipfsHash").where(e,t).whereIn("guildId",l),i&&f.toBlock(i),a&&f.fromBlock(a),s.next=8,f.executeQuery(!0);case 8:h=s.sent,c(h.map(function(e){return e.ipfsHash}));case 10:case"end":return s.stop()}},o)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"getSoundsFromBlock",value:function(e,t){var n=this;return new Promise(function(){var r=Object(o.a)(s.a.mark(function r(a,i){var o,c,u,l,f,h;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("getting guilds with access"),o=(new Date).getTime(),r.next=4,n.getGuildsWithAccess();case 4:return c=r.sent,u=(new Date).getTime(),l=u-o,console.log("getting guilds with access took %s ms",l),f=new R.a(n.ethAddress).from(C.R).select("ipfsHash").select("guildId").fromBlock(e).toBlock(t).limit(1e3).whereIn("guildId",window.installation?[0]:c),r.next=11,f.executeQuery(!0);case 11:h=r.sent,a(h.map(function(e){return e.ipfsHash}));case 13:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getBlockDate",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getting blockdate = ",t),e.next=3,l.a.eth.getBlock(t);case 3:if(null!==(n=e.sent)){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",new Date(1e3*n.timestamp));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getBlockNumberAtDate",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r,a,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.eth.getBlockNumber();case 2:return n=e.sent,r=500,e.next=6,l.a.eth.getBlock(n);case 6:a=e.sent,i=new Date(1e3*a.timestamp);case 8:if(!(t.getTime()<i.getTime())){e.next=16;break}return n-=r,e.next=12,l.a.eth.getBlock(n);case 12:a=e.sent,i=new Date(1e3*a.timestamp),e.next=8;break;case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllSounds",value:function(){var e=Object(o.a)(s.a.mark(function e(t,n){var r,a,i,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return 5e4,r=void 0,a=void 0,this.cache.useMonthly&&(r=this.cache.toBlock,a=this.cache.fromBlock),i=[],o=new Date,e.next=8,this.getSoundsFromBlock(a,r);case 8:return i=e.sent,c=new Date,c.getTime()-o.getTime(),e.abrupt("return",i);case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getOldSequence",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(r,a){var i,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new R.a(n.ethAddress).select("user").select("ipfsHash").select("title").where("ipfsHash",t).from(C.ab),e.next=3,i.executeQuery();case 3:o=e.sent,r(o.map(function(e){return{user:e.user,previousSequence:"0x0",newSequence:e.ipfsHash,diff:"0x0",title:e.title,blockNumber:e.blockNumber,edits:0}}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPrivateSequences",value:function(){var e=Object(o.a)(s.a.mark(function e(t,n){var r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.getAccount();case 2:if(void 0!==(r=e.sent)){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,this.encryption.getEncryptedSequenceIfAny(void 0,r,t,n);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNewSequence",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(a,i){var o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=new R.a(n.sequencesContractAddress).select("user").select("previousSequence").select("newSequence").select("diff").select("title").where("newSequence",t).from(C.bb),e.next=3,o.executeQuery();case 3:c=e.sent,a(c.map(function(e){return Object(r.a)({},e,{edits:0})}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTokenizedSequence",value:function(){var e=Object(o.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tokenizedSequences.getSequence(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSequence",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(r,a){var i,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getTokenizedSequence(t);case 2:if(!((i=e.sent).length>0)){e.next=6;break}return r(i[0]),e.abrupt("return");case 6:return e.next=8,n.getOldSequence(t);case 8:if(!((o=e.sent).length>0)){e.next=12;break}return r(o[0]),e.abrupt("return");case 12:return e.next=14,n.getNewSequence(t);case 14:if(!((c=e.sent).length>0)){e.next=18;break}return r(c[0]),e.abrupt("return");case 18:r("");case 19:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"favoriteSound",value:function(e){return new Promise(function(){var t=Object(o.a)(s.a.mark(function t(n,r){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.a.isLoggedIn()){t.next=3;break}return n(),t.abrupt("return");case 3:e=W(e),new v.a(m.e,"favoriteSample",[e]).execute().then(function(e){return n(e)});case 5:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"unfavoriteSound",value:function(e){return new Promise(function(){var t=Object(o.a)(s.a.mark(function t(n,r){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.a.isLoggedIn()){t.next=3;break}return n(),t.abrupt("return");case 3:e=W(e),new v.a(m.e,"unfavoriteSample",[e]).execute().then(function(e){return n(e)});case 5:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"saveNewSequence",value:function(e,t,n,r,a){var i=this;return new Promise(function(){var c=Object(o.a)(s.a.mark(function o(c,u){return s.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:i.tokenizedSequences.saveNewSequence(e,t,n,r,a);case 1:case"end":return s.stop()}},o)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"getNewSequences",value:function(e,t,n){var a=this;!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Promise(function(){var i=Object(o.a)(s.a.mark(function i(o,c){var u,l;return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return u=new R.a(a.sequencesContractAddress).select("user").select("previousSequence").select("newSequence").select("diff").select("title").fromBlock(t).toBlock(n).from(C.bb),void 0!==e&&u.where("user",e),i.prev=2,i.next=5,u.executeQuery();case 5:(l=i.sent).reverse(),l.sort(function(e,t){return t.blockNumber-e.blockNumber}),o(l.map(function(e){return Object(r.a)({},e,{edits:0})})),i.next=14;break;case 11:i.prev=11,i.t0=i.catch(2),o([]);case 14:case"end":return i.stop()}},i,null,[[2,11]])}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"getOldSequences",value:function(e,t,n){var r=this;return new Promise(function(){var a=Object(o.a)(s.a.mark(function a(i,o){var c,u;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=new R.a(r.ethAddress).select("user").select("ipfsHash").fromBlock(t).toBlock(n).select("title").from(C.ab),void 0!==e&&c.where("user",e),a.prev=2,a.next=5,c.executeQuery();case 5:(u=a.sent).reverse(),u=u.map(function(e){return{user:e.user,previousSequence:"0x0",newSequence:e.ipfsHash,diff:"0x0",title:e.title,blockNumber:e.blockNumber,edits:0}}),i(u),a.next=14;break;case 11:a.prev=11,a.t0=a.catch(2),i([]);case 14:case"end":return a.stop()}},a,null,[[2,11]])}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"getSequences",value:function(e,t,n){var r=this;return new Promise(function(){var t=Object(o.a)(s.a.mark(function t(n,a){var i,o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.tokenizedSequences.getSequences(e);case 2:return t.sent,t.next=5,r.getNewSequences(e);case 5:return i=t.sent,t.next=8,r.getOldSequences(e);case 8:o=t.sent,n(i.concat(o));case 10:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getHeadSequence",value:function(e,t){return t in e?this.getHeadSequence(e,e[t]):t}},{key:"collapseAllSequences",value:function(e){var t=this,n=new Set,a=[],i={};return e.forEach(function(s){if("0x0"!==s.previousSequence&&s.previousSequence!==s.newSequence&&(n.add(s.previousSequence),i[s.previousSequence]=s.newSequence),!n.has(s.newSequence)){var o=t.getEditsForSequence(s.newSequence,e);a.push(Object(r.a)({},s,{edits:o.length-1}))}}),a}},{key:"getEditsForSequence",value:function(e,t){for(var n=[],r=this.getPreviousSequence(e,t);void 0!==r;){n.push(r);var a=this.getPreviousSequence(r.previousSequence,t);if(void 0===a||a.newSequence===r.newSequence)break;r=a}return n}},{key:"getPreviousSequence",value:function(e,t){var n=void 0;for(var r in t)t[r].newSequence===e&&(n=t[r]);return n}},{key:"tagSample",value:function(){var e=Object(o.a)(s.a.mark(function e(t,n){var r,a=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:0,e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(a,i){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=W(t),n=G(n),new v.a(m.i,"setSampleTag",[t,n,r]).execute().then(function(){return a()});case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newSampleWithMetadata",value:function(){var e=Object(o.a)(s.a.mark(function e(t,n,r,a,i,c,u){var f,h=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f=h.length>7&&void 0!==h[7]?h[7]:this.guildId,e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(o,h){var p,d;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p=l.a.utils.padLeft("0x0",64),void 0===a&&(a=[]),a.length<4)for(d=a.length;d<4;d++)a.push(null);a=a.map(function(e){return null===e?p:l.a.utils.fromAscii(e)}),i=i.map(function(e){return null===e?p:l.a.utils.fromAscii(e)}),c=null===c?p:l.a.utils.fromAscii(c),r=null===r?p:l.a.utils.fromAscii(r),t=W(t),new v.a(m.i,"newSampleWithMetadata",[t,n,r,a,i,c,null===u?0:u,0,p,f]).execute().then(function(){return o()});case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,s,o){return e.apply(this,arguments)}}()},{key:"splitArray",value:function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}},{key:"newEncryptedSamples",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r,a=this,i=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:this.guildId,r=i.length>2?i[2]:void 0,e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(i,o){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("new encrypted samples"),a.splitArray(t,16).forEach(function(e){return a.newEncryptedSamples16(e,n,r)});case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newEncryptedSamples16",value:function(e,t,n){return new Promise(function(){var r=Object(o.a)(s.a.mark(function r(a,i){var o;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:o=U(e),console.log("arguments=",o),new v.a(m.i,"newEncryptedSamples",[o.sampleHashes,o.titles,o.videoIds,o.coverArts,o.discogsIds,o.tags,o.styles,o.countries,o.years,t,n.convertForEthereum(),n.getPublicKeyAsBytes32()]).execute().then(function(){return a()});case 3:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"newSamplesWithMetadata",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r=this,a=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:this.guildId,e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(a,i){var o,c,u,l,f;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=r.splitArray(t,16),c=0,u=_(o),e.prev=3,u.s();case 5:if((l=u.n()).done){e.next=12;break}return f=l.value,console.log("uploading samples chunk %s out of %s",c++,o.length),e.next=10,r.newSamplesWithMetadata16(f,n);case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),u.e(e.t0);case 17:return e.prev=17,u.f(),e.finish(17);case 20:case"end":return e.stop()}},e,null,[[3,14,17,20]])}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newSamplesWithMetadata16",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:this.guildId,e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(r,a){var i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=U(t),console.log("new samples with metadata",t,i),console.log("args =",i),new v.a(m.i,"newSamplesWithMetadata",[i.sampleHashes,i.titles,i.videoIds,i.coverArts,i.discogsIds,i.tags,i.styles,i.countries,i.years,n]).execute().then(function(){return r()});case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}());t.a=K;var Q=l.a.utils.padLeft("0x0",64),Z=function(e){for(;e.length<4;)e.push(Q);return e.slice(0,4)}}).call(this,n(108).Buffer)},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return o});var r=n(1),a=(n(20),n(23));function i(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n.depthParameter;if(s(n)){var i=Object(r.a)({},e);return i[t]=n.getJson(a),i}return e}var s=function(e,t){return e.isConnectedToAnyModulator()||Object.keys(e.patternToValue).length>0||Object.keys(e.paletteToValue).length>0||Object.keys(e.stepToValue).length>0||e.mixAutomation.automations.length>0||e.automations&&e.automations.length>0||e.hasMacro||e.depthParameter||e.isMapped||e.higherOrdered||t};function o(e,t,n,r,i){var s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6?arguments[6]:void 0;if(0===o||o/100<=Math.random())return e;if(t in e){c(e[t],n);var u=n.fromJson(e[t],r,i);if(s)return u;(r=r||n.sequencerEngine)&&r.store.dispatch(Object(a.ub)(u))}else n.disconnectFromAllModulators(),n.resetMinMax();return{}}var c=function(e,t){var n=t.lfos.filter(function(t){return!e.lfos||!e.lfos.includes(t.number-1)});e.lfos||(n=t.lfos),n.forEach(function(e){return t.disconnectFromLFO(e)});var r=t.envelopes.filter(function(t){return!e.envelopes||!e.envelopes.includes(t.number-1)});e.envelopes||(r=t.envelopes),r.forEach(function(e){return t.disconnectFromEnvelope(e)}),t.keyScaling&&!e.keyScaling&&t.disableKeyScaling()}},,,function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"i",function(){return a}),n.d(t,"q",function(){return i}),n.d(t,"g",function(){return s}),n.d(t,"b",function(){return o}),n.d(t,"j",function(){return c}),n.d(t,"r",function(){return u}),n.d(t,"n",function(){return l}),n.d(t,"l",function(){return f}),n.d(t,"k",function(){return h}),n.d(t,"p",function(){return p}),n.d(t,"h",function(){return d}),n.d(t,"c",function(){return v}),n.d(t,"f",function(){return m}),n.d(t,"o",function(){return y}),n.d(t,"d",function(){return b}),n.d(t,"m",function(){return g}),n.d(t,"e",function(){return O});var r="bang",a="scale",i="trigger-routing",s="reset",o="cycle-restart",c="snapshot-changed",u="use-snapshot",l="tick",f="stop",h="start",p="trigger",d="rules",v="figures",m="params",y="tidals",b="grid-operation",g="swap-min-max",O="nft"},function(e,t,n){"use strict";var r=n(107),a=n(4),i=n(5),s=n(136),o=["#29FFFF","#5429FF","#FF29D0","#0AFF6C","#FFBA7B","#FFE600","#8FFF00","#9EF3FF","#A48DFF","#FF9AE9","#FF8D8D","#FF7A00","#C8FF82"],c={},u={},l=function(){function e(){Object(a.a)(this,e)}return Object(i.a)(e,[{key:"getColorForTrack",value:function(e){if(void 0===e)return this.getColorForHash(void 0);if(e.envelopesTrack)return this.getColorForHash(e.presetName||e.id);e.getTrackType()===s.c&&(e=e.tracks[0]&&e.tracks[0].track||e);var t=void 0!==e.sample&&void 0!==e.sample.getId()?e.sample.getId():e.presetName||e.instrument&&e.instrument.defaultSampler&&e.instrument.defaultSampler.sample.getId()||e.getName();if(e.isAudioTrack&&(t=e.id),e.getTrackType()===s.e&&(t=e.presetName||"MULTI FREEZE"),t in u)return u[t];var n=this.getColorForHash(t),r=this.saturate(n,4,void 0,50);return u[t]=r,r}},{key:"transparent",value:function(e,t){return e.slice(0,e.length-1)+", "+t+")"}},{key:"getColor",value:function(e){return o[e%o.length]}},{key:"getColorForHash",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("Empty Patch"===e)return"#fb1515";if("Synth"===e)return"#ff0471";if("External Instrument"===e)return"#7effb3";if("Resampled"===e)return"#ff1e00";if("breaks"===e||"drums"===e)return"#11ff64";var t=this.intToRGB(this.hashCode(e)),n=f(this.getRGB(t)),r=n.h;n.s,n.l;return 100,60,this.rawHSLToHex({h:r,s:100,l:60})}},{key:"hashCode",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return t}},{key:"intToRGB",value:function(e){var t=(16777215&e).toString(16).toUpperCase();return"#"+"00000".substring(0,6-t.length)+t}},{key:"hueShift",value:function(e,t){var n=p(e);return h({h:n.h+t,s:n.s,l:n.l})}},{key:"warm",value:function(e){return h({h:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:141)-e,s:arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,l:50})}},{key:"compliment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=p(e),r=n.h;return 0===r&&r++,h({h:r+=10*t%255,s:n.s,l:n.l})}},{key:"saturate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0;if(e){if(e.startsWith("hsl")){var a=p(e),i=a.h,s=a.s,o=a.l;return o*=n,r&&(o=r),e=h({h:i,s:s=Math.min(s*t,100),l:o})}var c=f(this.getRGB(e)),u=c.h,l=c.s,d=c.l;return d*=n,r&&(d=r),e=h({h:u,s:l=Math.min(l*t,100),l:d})}}},{key:"brighten",value:function(e,t){if(e.startsWith("hsl")){var n=p(e);return h(n=function(e,t){var n=e.h,r=e.s,a=e.l;return{h:n,s:r,l:a*t}}(n,t))}var r=c[e+"."+t];if(r)return r;var a=Math.min(255,Math.floor(parseInt(e.slice(1,3),16)*t)),i=Math.min(255,Math.floor(parseInt(e.slice(3,5),16)*t)),s=Math.min(255,Math.floor(parseInt(e.slice(5),16)*t));a=a.toString(16),i=i.toString(16),s=s.toString(16),1===a.length&&(a="0"+a),1===i.length&&(i="0"+i),1===s.length&&(s="0"+s);var o="#"+a+i+s;return c[e+"."+t]=o,o}},{key:"getBrightness",value:function(e){var t=this.getRGB(e);return.299*t.r+.587*t.g+.114*t.b}},{key:"rawHSLToHex",value:function(e){return d(e.h,e.s,e.l)}},{key:"hslToHex",value:function(e){var t=p(e);return d(t.h,t.s,t.l)}},{key:"getRGB",value:function(e){return{r:Math.floor(parseInt(e.slice(1,3),16)),g:Math.floor(parseInt(e.slice(3,5),16)),b:Math.floor(parseInt(e.slice(5),16))}}}]),e}();function f(e){var t=e.r,n=e.g,r=e.b;t/=255,n/=255,r/=255;var a=Math.min(t,n,r),i=Math.max(t,n,r),s=i-a,o=0,c=0;return o=0==s?0:i==t?(n-r)/s%6:i==n?(r-t)/s+2:(t-n)/s+4,(o=Math.round(60*o))<0&&(o+=360),c=(i+a)/2,{h:o,s:+(100*(0==s?0:s/(1-Math.abs(2*c-1)))).toFixed(1),l:c=+(100*c).toFixed(1)}}function h(e){return"hsl("+e.h+","+e.s+"%,"+e.l+"%)"}function p(e){var t=(e=e.substring(4)).split(","),n=Object(r.a)(t,3),a=n[0],i=n[1],s=n[2],o=i.indexOf("%");return i=i.substring(0,o),o=s.indexOf("%"),s=s.substring(0,o),{h:parseFloat(a),s:parseFloat(i),l:parseFloat(s)}}function d(e,t,n){n/=100;var r=t*Math.min(n,1-n)/100,a=function(t){var a=(t+e/30)%12,i=n-r*Math.max(Math.min(a-3,9-a,1),-1);return Math.round(255*i).toString(16).padStart(2,"0")};return"#".concat(a(0)).concat(a(8)).concat(a(4))}t.a=l},,,function(e,t,n){"use strict";n.d(t,"e",function(){return u}),n.d(t,"d",function(){return l}),n.d(t,"b",function(){return f}),n.d(t,"c",function(){return h}),n.d(t,"a",function(){return p});var r=n(11),a=n(577);function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=[],c=function(){var e={},t=[],n={},s=function(e,t){n[e]&&n[e].forEach(function(e){return e(t)})},c=function(e,t){n[e]&&(n[e]=n[e].filter(function(e){return e!==t}))},u=function(t){return e[t]||o};return{notify:s,subscribe:function(e,a,i){return n[e]||(n[e]=[]),n[e]=[a].concat(Object(r.a)(n[e])),i&&t.push(a),function(){return c(e,a)}},publish:function(t,n){e[t]||(e[t]=[]),e[t].unshift(n),e[t].length>2&&e[t].pop(),s(t,n)},read:u,drain:function(t){var n=u(t);return e[t]&&(e[t].length=0),n},clearQueue:function(){Object(a.a)(e);var r,s=i(t);try{var o=function(){var e=r.value;for(var t in n)n[t]=n[t].filter(function(t){return t!==e})};for(s.s();!(r=s.n()).done;)o()}catch(c){s.e(c)}finally{s.f()}t.length=0},unsubscribe:c}}(),u=(c.notify,c.unsubscribe),l=c.subscribe,f=c.publish,h=c.read,p=(c.drain,c.clearQueue);window.subs=l},,function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(107),s=n(4),o=n(5),c=n(31),u=n(6),l=n(8),f=n(2),h=(n(14),n(141)),p=(n(73),n(165)),d=n(23),v=n(59),m=n(584),y=n(420),b=n(33),g=n(142),O=n(421);function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var j=function(e){Object(u.a)(n,e);var t=k(n);function n(e,r,a){var o;return Object(s.a)(this,n),(o=t.call(this,e,r)).track.sequencerEngine&&(o.track.sequencerEngine.idToObject[o.id]=Object(c.a)(o)),o.triggers=[],o.initCache(a),o.numberOfOutputs=1,o.newInlet("enable",function(e){var t=Object(i.a)(e,1)[0];return o.onEnableMessage(t)}),o.newInlet("bypass",function(e){var t=Object(i.a)(e,1)[0];return o.onBypass(t)}),o}return Object(o.a)(n,[{key:"onBypass",value:function(e){this.bypass=e}},{key:"onEnableMessage",value:function(e){this.enabledParameter&&this.enabledParameter.set(e)}},{key:"getObjectType",value:function(){return p.a}},{key:"getChordEffectType",value:function(){return null}},{key:"registerContext",value:function(e,t){var n=this;this.context?this.context.combineWith(e):this.context=e.getCopy(),t?(this.context.forSubDevice(this),this.context.forMidiEffect(t)):this.context.forMidiEffect(this),this.parameters.forEach(function(e){return e.setContext(n.context)})}},{key:"getText",value:function(){return this.getVisualizedParameters().map(function(e){return e.get(!0)}).map(function(e){return"number"===typeof e?Math.round(100*e)/100:e}).map(function(e){return e>0?"+"+e:e}).join(", ")}},{key:"getVisualizedParameters",value:function(){return this.parameters.filter(function(e){return e.isMapped})}},{key:"isRealTime",value:function(){return!0}},{key:"getEffectType",value:function(){return v.c}},{key:"isMidiEffect",value:function(){return!0}},{key:"needsStableLookAhead",value:function(){return!1}},{key:"onNewStep",value:function(){this.clear()}},{key:"stop",value:function(){}},{key:"clear",value:function(){this.triggers.length>0&&(this.triggers.length=0)}},{key:"input",value:function(e){e.outputNumber=0,this.triggers.push(e)}},{key:"output",value:function(){return this.triggers}},{key:"removeNote",value:function(){}},{key:"getCopy",value:function(e){return this}},{key:"addNote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.getStep(this.track.trackData,e,null,!1);r.velocity=this.track.trackData.velocity,r.duration=null,r.transpose=e,r.slice=t,this.input(new g.a(r,0,n),!0)}},{key:"copyTrigger",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(e.stepData.duration,e.stepData||new b.a);this.track&&!this._subSequence&&(n.track=this.track);var i=this.getStep(n,void 0,void 0,t),s=new g.a(i,e.time,e.stepNumber,e.outputNumber);return e.grabs&&(s.grabs=Object(a.a)(e.grabs)),e.chokes&&(s.chokes=Object(a.a)(e.chokes)),e.message&&(s.message=Object(r.a)({},e.message)),e.delays&&(s.message=Object(r.a)({},e.delays)),s}},{key:"dispose",value:function(){var e=this;this.name=void 0;var t=this.track.sequencerEngine.state.effects.pulledEffects;this.track.sequencerEngine.dispatch(Object(d.Vc)(t.filter(function(t){return t!==e})))}},{key:"getParameters",value:function(){return this.parameters}},{key:"isRolling",value:function(){return this.track.sequencerEngine.isSequenceRolling}}]),n}(Object(h.a)(Object(m.a)(Object(O.a)(y.a))));t.a=j},function(e,t,n){"use strict";n.d(t,"f",function(){return r}),n.d(t,"d",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"g",function(){return s}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return c}),n.d(t,"e",function(){return u});var r="SAMPLER",a="MIDI",i="AUDIO",s="Z4",o="INSTRUMENT",c="INSTRUMENT_RACK",u="MULTI_FREEZE"},,function(e,t,n){"use strict";var r=n(11),a=n(42),i=n.n(a),s=n(56),o=n(4),c=n(5),u=n(6),l=n(8),f=n(2),h=(n(261),n(494)),p=(n(411),n(153)),d=n(79),v=n(496),m=n(155),y=(n(118),n(785)),b=(n(139),n(158)),g=n(148),O=n(146);(new y.a).contractAddress;var k=function(){var e=Object(s.a)(i.a.mark(function e(t,n){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("newSampleByArtist(%s,%s)",t,n),e.next=3,new m.a(O.a,"newSampleByArtist",[b.a.utils.fromAscii(t),Object(g.b)(n)]).execute();case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),j=function(){var e=Object(s.a)(i.a.mark(function e(t,n,r,a){var s,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=o.length>4&&void 0!==o[4]?o[4]:"RECORD",console.log("newRelease(%s,%s,%s,%s,%s)",t,n,r,a,s),e.next=4,new m.a(O.a,"newRelease",[b.a.utils.fromAscii(t),n,r,Object(g.b)(a),b.a.utils.fromAscii(s)]).execute();case 4:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),w=n(340),x=n(569),S=n(792),P=n(290),E=n(514),T=(n(7),n(798)),A=n(125),M=n(122),R=(n(919),n(572)),C=n(43),N=(n(519),n(130));function q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}n(297);var I=new N.a;window.SAMPLES=[];var _=function(e){Object(u.a)(n,e);var t=q(n);function n(e,r,a){var i;return Object(o.a)(this,n),i=t.call(this),"number"==typeof e||Object(C.a)(e)?i.soundId=e:i.ipfsHash=e,i.guildId=a,i.downloadUrl=void 0,i.videoId=void 0,i.name=void 0,i.tags=void 0,i.slices=void 0,i.noteSequence=void 0,i.packs=[],i.isStems=!1,i.styles=[],i.guildId=void 0,r?i.encryptedIpfs=r:window.sequencerEngine&&(i.encryptedIpfs=new R.a(window.sequencerEngine.store,window.sequencerEngine.ethereum.guilds,window.sequencerEngine.ethereum.encryption,window.sequencerEngine.ethereum.crypto)),i.audioBuffer=void 0,i.addedToProject=!1,i.highlightedTags={},i.samplesUsed=[],i}return Object(c.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getTagsToSave",value:function(){var e=this;return Object.keys(this.highlightedTags).length>0?Object.keys(this.highlightedTags).filter(function(t){return e.highlightedTags[t]}):this.tags}},{key:"getId",value:function(){return void 0!==this.ipfsHash?this.ipfsHash:this.soundId}},{key:"fromJson",value:function(e){this.ipfsHash=e.id,this.name=e.name,this.videoId=e.videoId,this.tags=e.tags||[],this.slices=e.slices,this.coverArtHash=e.coverArtHash,this.discogsId=e.discogsId}},{key:"dispose",value:function(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.addedToProject||(this.audioBuffer=void 0,this.discogsId=void 0,this.videoId=void 0,this.coverArtHash=void 0,this.slices=void 0,this.packs=void 0)}},{key:"isLoaded",value:function(){return void 0!==this.audioBuffer}},{key:"getJson",value:function(){return{id:this.getId(),slices:this.slices,name:this.name,videoId:this.videoId,tags:this.tags,thumbnail:this.getThumbnail(),discogsId:this.discogsId,coverArtHash:this.coverArtHash}}},{key:"fetchMetadata",value:function(){var e=this;if(void 0!==this.ipfsHash)return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){var a,s,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,A.a.getTitleForSound(e.ipfsHash);case 2:return a=t.sent,t.next=5,A.a.getVideoIdForSound(e.ipfsHash);case 5:return s=t.sent,t.next=8,A.a.getCoverArtForSound(e.ipfsHash);case 8:o=t.sent,void 0!==a&&(e.name=a),void 0!==s&&(e.videoId=s),void 0!==o&&(e.coverArtHash=o),n(e);case 13:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"fetchTags",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e.soundId||void 0===e.ipfsHash){t.next=11;break}return t.t0=Set,t.next=4,A.a.getTagsForSound(e.ipfsHash);case 4:return t.t1=t.sent,a=new t.t0(t.t1),e.tags=Array.from(a)||[],n(e.tags||[]),t.abrupt("return");case 11:n([]);case 12:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"fetchSlices",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:A.a.getSlicesForSound(e.ipfsHash).then(function(t){e.slices=t,n(t)});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"fetchAudio",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(n,r){void 0!==e.ipfsHash&&e.fetchAudioFromIPFS(t).then(function(e){return n(e)}).catch(function(e){r("timed out")})})}},{key:"fetchAudioFromIPFS",value:function(e){var t=this;return new Promise(function(n,r){(new Date).getTime();window.SAMPLES.push(t),t.encryptedIpfs.getSound(t.ipfsHash,void 0,e).then(function(){var e=Object(s.a)(i.a.mark(function e(a){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Object(h.b)(a,t.ipfsHash).then(function(e){t.audioBuffer=e,n(t)}).catch(function(e){r(e)});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){r(e)})})}},{key:"fetchGuild",value:function(){var e=Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.a.guildSamples.getGuildIdForSound(this.getId());case 2:this.guildId=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"analyze",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if(void 0===this.tempo){var n=Object(T.a)(this.audioBuffer,e,t),r=n.tempo,a=n.onsets;this.tempo=r,this.onsets=a}}},{key:"fetchNoteSequence",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n(e.noteSequence);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getThumbnail",value:function(){return this.coverArtHash&&""!==this.coverArtHash?M.a.getHashUrl(this.coverArtHash):this.videoId&&""!==this.videoId?"https://img.youtube.com/vi/"+this.videoId+"/1.jpg":void 0}},{key:"load",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise(function(){var n=Object(s.a)(i.a.mark(function n(a,s){var o;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e.getId()&&e.getId()!==P.a){n.next=3;break}return a(),n.abrupt("return");case 3:if(!e.audioBuffer){n.next=5;break}return n.abrupt("return",a());case 5:if(n.prev=5,!t){n.next=9;break}return n.next=9,e.fetchAudio();case 9:if(!window.isNFT){n.next=20;break}if(window.samplesMetadata){n.next=12;break}return n.abrupt("return",a());case 12:if(o=window.samplesMetadata[e.getId()]){n.next=16;break}return e.name="",n.abrupt("return",a());case 16:return e.tags?e.tags=[].concat(Object(r.a)(e.tags),Object(r.a)(o.tags)):e.tags=o.tags,e.name=o.name,e.videoId=o.videoId,n.abrupt("return",a());case 20:return n.t0=fetch,n.t1=JSON,n.next=24,p.a.getAccount();case 24:n.t2=n.sent,n.t3=e.getId(),n.t4={user:n.t2,id:n.t3},n.t5=n.t1.stringify.call(n.t1,n.t4),n.t6={Accept:"application/json","Content-Type":"application/json"},n.t7={method:"POST",body:n.t5,headers:n.t6},(0,n.t0)("/querySample/",n.t7).then(function(e){return e.json()}).then(function(t){e.tags=Array.from(new Set(t.tags||[])),e.videoId=t.videoId,""===e.videoId&&(e.videoId=void 0),e.name=t.title,e.packs=t.packs,e.favorited=5===t.rating,e.artistName=t.artistName,e.releaseName=t.releaseName,e.sampledByUser=t.user,e.blockNumber=t.blockNumber,e.year=t.year,e.discogsId=t.discogsId,e.coverArtHash=""===t.coverArtHash?void 0:t.coverArtHash,e.guildId=t.guildId,a()}).catch(function(e){console.log(e)}),n.next=36;break;case 33:n.prev=33,n.t8=n.catch(5),s();case 36:case"end":return n.stop()}},n,null,[[5,33]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"color",get:function(){return I.getColorForHash(this.getId())}},{key:"getCopyWith",value:function(e,t){var a=new n(e);return a.videoId=this.videoId,a.discogsId=this.discogsId,a.coverArtHash=this.coverArtHash,a.name=this.name+"("+t+")",a.year=this.year,a.country=this.country,a.styles=this.styles,a.tags=[].concat(Object(r.a)(this.tags),[t]),a.packs=Object(r.a)(this.packs),a.isStems=!0,a}},{key:"getCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new n(this.getId());if(t.videoId=this.videoId,t.discogsId=this.discogsId,t.coverArtHash=this.coverArtHash,t.name=this.name,t.year=this.year,t.country=this.country,t.styles=this.styles,t.tags=this.tags?Object(r.a)(this.tags):[],e)t.audioBuffer=this.audioBuffer;else if(void 0!==this.audioBuffer){var a=new AudioBuffer({length:this.audioBuffer.length,numberOfChannels:this.audioBuffer.numberOfChannels,sampleRate:this.audioBuffer.sampleRate}),i=this.audioBuffer.getChannelData(0);a.copyToChannel(i,0),this.audioBuffer.numberOfChannels>1&&(i=this.audioBuffer.getChannelData(1),a.copyToChannel(i,1)),t.audioBuffer=a}return t}},{key:"newTag",value:function(e){this.tags.push(e),this.needsSave||A.a.tagSample(this.ipfsHash,e,this.guildId)}},{key:"getContentType",value:function(){return S.b}},{key:"uploadAudioToIPFS",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r,a,s,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:0,this.getId()!==P.a){e.next=20;break}return n=[this.audioBuffer.getChannelData(0)],this.audioBuffer.numberOfChannels>1&&n.push(this.audioBuffer.getChannelData(1)),e.next=6,Object(w.a)(n);case 6:if(r=e.sent,0!==t){e.next=14;break}return e.next=10,M.a.addArrayBuffer(r);case 10:a=e.sent,this.ipfsHash=a,e.next=20;break;case 14:return this.contentKey=new x.a,e.next=17,this.encryptedIpfs.addSound(r,v.a,t,this.contentKey);case 17:s=e.sent,this.ipfsHash=s,this.guildId=t;case 20:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"saveBuffer",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.mp3Data){e.next=7;break}return n=[this.audioBuffer.getChannelData(0)],this.audioBuffer.numberOfChannels>1&&n.push(this.audioBuffer.getChannelData(0)),e.next=6,Object(w.a)(n);case 6:t=e.sent;case 7:return e.next=9,M.a.addArrayBuffer(t);case 9:r=e.sent,this.ipfsHash=r;case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"uploadAudioBuffer",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r,a,s,o,c=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]?c[0]:0,n=void 0,this.getId()!==P.a){e.next=25;break}if(r=this.mp3Data){e.next=12;break}return a=[this.audioBuffer.getChannelData(0)],this.audioBuffer.numberOfChannels>1&&a.push(this.audioBuffer.getChannelData(0)),e.next=9,Object(w.a)(a);case 9:r=e.sent,e.next=12;break;case 12:if(0!==t){e.next=19;break}return e.next=15,M.a.addArrayBuffer(r);case 15:s=e.sent,this.ipfsHash=s,e.next=25;break;case 19:return n=new x.a,e.next=22,this.encryptedIpfs.addSound(r,v.a,t,n);case 22:o=e.sent,this.ipfsHash=o,this.guildId=t;case 25:return e.abrupt("return",n);case 26:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"saveSample",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,a,s,o,c,u,l=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:0,e.next=3,this.uploadAudioBuffer(t);case 3:for(n=e.sent,a=Object(r.a)(this.tags),s=a.length;s<4;s++)a.push("");for(o=this.styles?Object(r.a)(this.styles):[],c=o.length;c<4;c++)o.push("");return u={ipfsHash:this.ipfsHash,title:this.name,videoId:this.videoId,tags:a.slice(0,4),styles:o.slice(0,4),country:this.country||null,year:this.year||0,coverArt:this.coverArtHash,discogsId:this.discogsId},this.needsSave=!1,0===t?A.a.newSamplesWithMetadata([u],0):A.a.newEncryptedSamples([u],t,n),e.next=13,Object(d.a)(1e3);case 13:this.saveArtistInfo();case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"saveArtistInfo",value:function(){var e=Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.artistName){e.next=5;break}return j(this.artistName.slice(0,32),this.discogsId,this.releaseName,this.coverArtHash,this.releaseType),e.next=4,Object(d.a)(1e3);case 4:k(this.artistName.slice(0,32),this.ipfsHash);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(E.a);t.a=_},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(214),u=(n(118),n(42)),l=n.n(u),f=n(56);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var p=new(function(){function e(){Object(r.a)(this,e),this.runningQueries=new Set}return Object(a.a)(e,[{key:"submit",value:function(e){var t=this;return new Promise(function(){var n=Object(f.a)(l.a.mark(function n(r,a){var i;return l.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t.runningQueries.size>=4)){n.next=5;break}return n.next=3,t.sleep(20);case 3:n.next=0;break;case 5:t.runningQueries.add(e),i="/search",window.spores&&(i="https://zequencer.io"+i),fetch(i,{method:"POST",body:JSON.stringify(e),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(n){t.removeQuery(e),r(n||[])}).catch(function(n){console.log(n),t.removeQuery(e)});case 9:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"removeQuery",value:function(e){this.runningQueries.delete(e)}},{key:"sleep",value:function(e){return new Promise(function(t,n){setTimeout(t,e)})}}]),e}()),d=function(e){Object(i.a)(n,e);var t=h(n);function n(e){return Object(r.a)(this,n),t.call(this,e)}return Object(a.a)(n,[{key:"executeQuery",value:function(){var e=this;!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise(function(t,n){if(window.isNFT)return t([]);p.submit(e.getJson()).then(t)})}}]),n}(c.a);t.a=d},function(e,t,n){"use strict";n.d(t,"c",function(){return p}),n.d(t,"d",function(){return d}),n.d(t,"a",function(){return v}),n.d(t,"b",function(){return m});var r=n(1),a=n(107),i=n(109),s=n(156),o=n(233),c=n(400),u=n(169),l=n(162),f=n(157),h=(n(302),n(43),[s.a,s.c,s.d,s.e]);Object(i.a)("gl.abs",{x:""},"Creates GLSL expression calculating absolute value of inlet",function(){return 1},{inletTypes:["float"],type:"float",tags:"GLSL",inlets:1});Object(i.a)("gl.mix",{a:"",b:"","mix amt":""},"Creates GLSL expression calculating mix interpolation between inlets",function(){return 1},{inletTypes:[Object(s.j)("float","vec4"),Object(s.j)("float","vec4"),"float"],type:function(){return arguments.length<=0?void 0:arguments[0]},isHot:!0,tags:"GLSL",inlets:3});var p=function(e,t,n){return e.needsHotReload=!0,e.typed(Object(c.a)(Object(l.a)(function(r){var i=Object(u.a)(r,t,n).map(m),s=Object(a.a)(i,3),o=s[0],c=s[1],l=s[2];return e.flash(),"mix(".concat(o,", ").concat(c,", ").concat(l,")")},t,n),function(e,t,n){return n*e+(1-n)*t}))};Object(i.a)("gl.rainbow",{x:""},"Creates GLSL expression calculating rainbow value of inlet",function(){return 1},{tags:"GLSL",inlets:1});Object(i.a)("gl.exp",{x:""},"Creates GLSL expression calculating absolute value of inlet",function(){return 1},{inletTypes:["float"],type:"float",tags:"GLSL",inlets:1});Object(i.a)("gl.min",{},"Creates GLSL expression calculating min of inlets",function(){return 1},{inletTypes:["float","float"],type:"float",tags:"GLSL",isHot:!0,inlets:2});Object(i.a)("gl.max",{},"Creates GLSL expression calculating max of inlets",function(){return 1},{inletTypes:["float","float"],type:"float",isHot:!0,inlets:2});Object(i.a)("gl.mod",{},"Creates a GLSL expression calculating the modulo of inlets",function(){return 1},{inletTypes:[s.j.apply(void 0,h),"float"],type:o.d,tags:"GLSL",isHot:!0,inlets:2});Object(i.a)("gl.clamp",{a:"",b:""},"Creates GLSL expression clamping left-inlet number between 2nd and 3rd inlet",function(){return 1},{inletTypes:["float","float","float"],type:"float",isHot:!0,inlets:3,tags:"GLSL"});var d={"gl.abs":function(e){return e.needsHotReload=!0,e.typed(Object(c.a)(Object(l.a)(function(t){var n=Object(u.a)(t);return e.flash(),"abs("+m(n[0])+")"}),function(e){return Math.abs(e)}))},"gl.min":function(e,t){return e.needsHotReload=!0,e.typed(Object(c.a)(Object(l.a)(function(n){var r=Object(u.a)(n,t);return e.flash(),"min(".concat(r[0],", ").concat(r[1],")")},t),function(e,t){return Math.min(e,t)}))},"gl.max":function(e,t){return e.needsHotReload=!0,e.typed(Object(c.a)(Object(l.a)(function(n){var r=Object(u.a)(n,t);return e.flash(),"max(".concat(m(r[0]),", ").concat(m(r[1]),")")},t),function(e,t){return Math.max(e,t)}))},"gl.mod":function(e,t){return e.needsHotReload=!0,e.typed(Object(c.a)(Object(l.a)(function(n){var r=Object(u.a)(n,t);return e.flash(),"mod(".concat(m(r[0]),", ").concat(m(r[1]),")")},t),function(e,t){return Object(f.a)(e,t)}))},"gl.clamp":function(e,t,n){return e.needsHotReload=!0,e.typed(Object(l.a)(function(r){var a=Object(u.a)(r,t,n);return e.flash(),"clamp(".concat(m(a[0]),", ").concat(m(a[1]),", ").concat(m(a[2]),")")},t,n))},"gl.exp":function(e){return e.needsHotReload=!0,e.typed(Object(l.a)(function(t){var n=Object(u.a)(t);return e.flash(),"exp("+m(n[0])+")"}))},"gl.rainbow":function(e){return e.needsHotReload=!0,Object(l.a)(function(t){var n=Object(u.a)(t);return e.flash(),"rainbow("+m(n[0])+")"})},"gl.mix":p},v=function(){for(var e={},t={},n={},a=[],i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];for(var c=0,u=s;c<u.length;c++){var l=u[c];"function"===typeof l&&(l=l());var f=(l=void 0===l?{}:l).uniforms||{};e=Object(r.a)({},e,f);var h=l.functions||{};n=Object(r.a)({},n,h);var p=l.closure||{};t=Object(r.a)({},t,p),a.push(l.code||l||"0.0")}return{codes:a,uniforms:e,functions:n,closure:t}},m=function(e){return"object"===typeof e?"1.0":"bang"===e||void 0===e?"1.0":e.toFixed?e.toFixed(3):e}},function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(4),s=n(5),o=n(6),c=n(8),u=n(2),l=n(133),f=n(232),h=n(109),p=n(205),d=n(419);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=n(247),y=n(20);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var g=function(e){Object(o.a)(n,e);var t=b(n);function n(e,r,a,s,o){var c;return Object(i.a)(this,n),(c=t.call(this)).id=Object(y.uuid)(),c.sourceNode=r,c.destNode=s,c.sourceType=e,c.sourceId=r.id,c.destType=a,c.destId=s.id,c.action=o,c._sourceType=c.getFullType(e,c.sourceId),c.reader=Object(m.a)(c._sourceType),o&&Object(l.d)(c._sourceType,o),c.segmentation=void 0,c}return Object(s.a)(n,[{key:"segment",value:function(){this.segmentation=!0}},{key:"getJson",value:function(){return{id:this.id,sourceEl:this.getFullType(this.sourceType,this.sourceId),destEl:this.getFullType(this.destType,this.destId),sourceType:this.sourceType,sourceId:this.sourceId,destType:this.destType,destId:this.destId,sourceWindowId:this.sourceNode.zObject?this.sourceNode.zObject.id:this.sourceNode.id,destWindowId:this.destNode.zObject?this.destNode.zObject.id:this.destNode.id}}},{key:"dispose",value:function(){Object(l.e)(this._sourceType,this.action),this.reader(!0)}}]),n}(function(e){Object(o.a)(n,e);var t=v(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getFullType",value:function(e){return e+"."+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.id)}}]),n}(function(){return function e(){Object(i.a)(this,e)}}())),O=n(23);function k(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var x=[];window.bulkCalled=0,window.notBulkCalled=0;t.a=function(e){return function(e){Object(o.a)(n,e);var t=w(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).inlets={},e.outlets={},e.numInlets=0,e.numOutlets=0,e.messageSubscribers={},e}return Object(s.a)(n,[{key:"newInlet",value:function(e,t,n){this.inlets[e]={action:Object(f.b)(t,e,n,this),type:n,connections:[]},this.numInlets++,this.subSequence&&this.subSequence.hasInstances&&this.subSequence.onChange()}},{key:"newOutlet",value:function(e,t){this.outlets[e]={connections:[],type:t,actions:[]},this.numOutlets++,this.subSequence&&this.subSequence.hasInstances&&this.subSequence.onChange()}},{key:"bang",value:function(){}},{key:"isInletConnected",value:function(e){return!!this.inlets[e]&&this.inlets[e].connections.length>0}},{key:"isOutletConnected",value:function(e){for(var t in this.getConnectedOutlets(e))return!0;return!1}},{key:"getConnectedInlets",value:function(e){return this.inlets[e]?this.inlets[e].connections:x}},{key:"getConnectedOutlets",value:function(e){return this.outlets[e]?this.outlets[e].connections:x}},{key:"connectInlet",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!t.outlets[n]&&(n=Object.keys(t.outlets)[0],!t.outlets[n]))return{};if(!this.inlets[e])return{};var i=new g(n,t,e,this,this.inlets[e].action);if(r&&(i.id=r),this.inlets[e].connections.some(function(r){return r.sourceNode===t&&r.sourceType===n&&r.destType===e}))return{};this.inlets[e].connections.push(i),t.outlets[n].connections.push(i),t.needsStart;var s="gl.uniform"===t.name||t.attributes&&t.attributes["glsl uniform"];return this.needsHotReload&&(s||this.sequencerEngine&&!this.sequencerEngine.isLoading)&&(this.args&&(this.previousArgs=void 0),t.args,Object(d.a)(this),t.args),this.subSequence.propagate(Object(p.l)(t,this,n,e)),this.updateMessagingRedux(a)}},{key:"deleteConnection",value:function(e){var t=e.destType,n=e.sourceType,r=e.sourceNode;if(this.inlets&&this.inlets[t]&&(this.inlets[t].connections=this.inlets[t].connections.filter(function(t){return t!==e})),r.outlets&&r.outlets[n]&&(r.outlets[n].connections=r.outlets[n].connections.filter(function(t){return t!==e}),r.outlets[n].connections=r.outlets[n].connections),e.dispose(),this.updateMessagingRedux(),this.needsHotReload&&(this.args&&this.previousArgs&&(this.args=this.previousArgs),Object(d.a)(this)),r.needsHotReload&&Object(d.a)(r),this.dispatch&&this.dispatch(Object(O.pd)(void 0)),this.needsDisconnect&&r.function){var a=parseFloat(t);isNaN(a)?this.onInputMessage(["disconnect",r.function(["node"])]):this.onArg(a,[["disconnect",r.function(["node"])]])}}},{key:"disconnectInlet",value:function(e,t,n){var r=this.inlets[e].connections.find(function(r){return r.sourceNode===t&&r.destType===e&&r.sourceType===n});this.deleteConnection(r),this.subSequence.propagate(Object(p.m)(r.sourceNode,r.destNode,r.sourceType,r.destType))}},{key:"updateMessagingRedux",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e={};for(var t in this.inlets){this.inlets[t].readers;e[this.getFullType(t)]=this.inlets[t].connections.map(function(e){return e.getJson()})}window.notBulkCalled++;var n=this.subSequence;if(this.track&&this.track.subSequence&&(n=this.track.subSequence),this.sequencerEngine&&this.sequencerEngine.isLoading)this.sequencerEngine.bulkConnections[n.id]=Object(a.a)({},this.sequencerEngine.bulkConnections[n.id],e);else if(n){var r=n.state.windows.inletConnections[n.id]||{};n.dispatch(Object(O.Hb)(n.id,Object(a.a)({},r,e)))}}},{key:"clearMessagingRedux",value:function(){var e=[];for(var t in this.inlets){var n=this.getFullType(t);e.push(n)}var r=this.subSequence;if(this.track&&this.track.subSequence&&(r=this.track.subSequence),r){var i=r.state.windows.inletConnections[r.id]||{};i=Object(a.a)({},i);var s,o=k(e);try{for(o.s();!(s=o.n()).done;){delete i[s.value]}}catch(c){o.e(c)}finally{o.f()}r.dispatch(Object(O.Hb)(r.id,i))}}},{key:"getFullType",value:function(e){return e+"."+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.id)}},{key:"sendMessage",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=this.outlets[e];if(a){a.actions&&a.actions.forEach(function(e){return e.apply(void 0,n)});var i,s=k(a.connections);try{for(s.s();!(i=s.n()).done;){var o=i.value,c=(o.destNode,o.action);c&&c(n)}}catch(u){s.e(u)}finally{s.f()}}}},{key:"receiveMessage",value:function(e){if(!this.inlets[e])return x;var t,n=this.inlets[e].connections,a=x,i=k(n);try{for(i.s();!(t=i.n()).done;){var s=t.value.reader();s.length>0&&(a=a===x?s:[].concat(Object(r.a)(a),Object(r.a)(s)))}}catch(o){i.e(o)}finally{i.f()}return a}},{key:"disposeMessaging",value:function(){for(var e in this.inlets)this.deleteInlet(e,!1);for(var t in this.outlets)this.deleteOutlet(t,!1);this.updateMessagingRedux(),this.inlets=void 0,this.outlets=void 0}},{key:"deleteInlet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.inlets[e]&&(this.disconnectFromInlet(e),delete this.inlets[e],this.numInlets--,t&&this.updateMessagingRedux())}},{key:"disconnectFromInlet",value:function(e){var t=this;this.inlets[e]&&(this.inlets[e].connections.forEach(function(e){return t.deleteConnection(e)}),this.subSequence&&this.subSequence.hasInstances&&this.subSequence.onChange())}},{key:"disconnectFromOutlet",value:function(e){this.outlets[e]&&(this.outlets[e].connections.forEach(function(e){e.sourceNode.deleteConnection(e)}),this.outlets[e].connections=[],this.subSequence&&this.subSequence.hasInstances&&this.subSequence.onChange())}},{key:"deleteOutlet",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=k(this.outlets[e].connections);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.destNode.deleteConnection(a)}}catch(i){r.e(i)}finally{r.f()}delete this.outlets[e],this.numOutlets--,n&&this.updateMessagingRedux(),this.subSequence&&this.subSequence.hasInstances&&this.subSequence.onChange()}},{key:"getOutboundNodes",value:function(){return this.getAdjacentNodes(this.outlets,"destNode","destType")}},{key:"getAdjacentNodes",value:function(e,t,n){var r={};for(var a in e){var i=e[a].connections.map(function(e){return{node:e[t],type:e[n]}});i.length>0&&(r[a]=i)}return r}},{key:"getInboundNodes",value:function(){return this.getAdjacentNodes(this.inlets,"sourceNode","sourceType")}},{key:"searchForNode",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.outlets;if(n){var r=Object.keys(n),a=t?n[t]:n[r[0]];if(this.linkedOutlet&&(a=this.linkedOutlet),a){var i,s=k(a.connections);try{for(s.s();!(i=s.n()).done;){var o=i.value.destNode;if(o.name===e)return o;if(o.effect&&o.effect.name===e)return o;var c=o.searchForNode(e,void 0);if(c)return c}}catch(u){s.e(u)}finally{s.f()}}}}},{key:"nameInlets",value:function(){var e,t=[this],n=0,a=Object.keys(this.inlets),i=k(a=["Input"].concat(Object(r.a)(a.filter(function(e){return"Input"!==e}))));try{for(i.s();!(e=i.n()).done;){var s,o=e.value,c=this.inlets[o].connections,u=Object(h.a)(this.name),l=k(c);try{for(l.s();!(s=l.n()).done;){var f=s.value,p=f.sourceNode,d=f.destNode,v=(f.sourceType,f.destType,Object.keys(u.params)[n]);p.attributes["scripting name"]=d.attributes["scripting name"]+"."+v,t.includes(p)||t.push(p)}}catch(m){l.e(m)}finally{l.f()}n++}}catch(m){i.e(m)}finally{i.f()}return t}},{key:"disconnectFromGraph",value:function(){for(var e in this.inlets){var t,n=k(this.inlets[e].connections);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=r.sourceNode,i=r.destNode,s=r.sourceType,o=r.destType;i.disconnectInlet(o,a,s)}}catch(m){n.e(m)}finally{n.f()}}for(var c in this.outlets){var u,l=k(this.outlets[c].connections);try{for(l.s();!(u=l.n()).done;){var f=u.value,h=f.sourceNode,p=f.destNode,d=f.sourceType,v=f.destType;p.disconnectInlet(v,h,d)}}catch(m){l.e(m)}finally{l.f()}}}},{key:"windowPosition",get:function(){return this.sequencerEngine.state.windows.windowPositions[this.id]},set:function(e){var t=e.x,n=e.y;this.dispatch(Object(O.Pe)(this.id,{x:t,y:n}))}},{key:"presentationMode",get:function(){return this.subSequence.presentationMode}}]),n}(e)}},function(e,t,n){"use strict";var r=n(4);t.a=function e(t,n,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0;Object(r.a)(this,e),this.stepData=t,this.time=n,this.stepNumber=a,this.grabs=[],this.chokes=[],this.outputNumber=i,this.warpedSteps=s}},,,,function(e,t,n){"use strict";n(262);var r=n(773),a=n(774),i=n(775),s=n(776),o=n(777),c=n(295),u=n(512),l=n(778),f=n(513),h=n(779),p=n(780),d=n(781),v=n(782),m=n(4),y=n(5),b=function(){function e(){Object(m.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceFavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceStarred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"tag",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceTagged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceUnfavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceUnstarred",type:"event"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"favoriteSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"starSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"bytes32",name:"tag",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"tagSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"unfavoriteSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"unstarSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x03172e863dbF7EEb3994AF5a6608c470eB6E79fC"}return Object(y.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),g=n(783),O=n(296),k=function(){function e(){Object(m.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"mixHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"sequenceHash",type:"bytes32"}],name:"MixUsedSequence",type:"event"},{inputs:[{internalType:"bytes32",name:"mixHash",type:"bytes32"},{internalType:"bytes32",name:"previousHash",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"bytes32[]",name:"sequencesUsed",type:"bytes32[]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newMix",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"mixHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"previousHash",type:"bytes32"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!1,internalType:"uint32",name:"guildId",type:"uint32"}],name:"NewMix",type:"event"}],this.contractAddress="0xCAD33f311E1223095FC94E89453888Df04f7BbBF"}return Object(y.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),j=n(784),w=n(785),x=n(786),S=function(){function e(){Object(m.a)(this,e),this.abi=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"deviceName",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"ccNumber",type:"uint32"},{indexed:!0,internalType:"bytes32",name:"parameterName",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"MidiCCParameter",type:"event"},{inputs:[{internalType:"bytes32",name:"deviceName",type:"bytes32"},{internalType:"uint32",name:"ccNumber",type:"uint32"},{internalType:"bytes32",name:"parameterName",type:"bytes32"}],name:"newMidiCCParameter",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x9c2607b1f1444AC1349aE79Bffa4000965d6936E"}return Object(y.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),P=function(){function e(){Object(m.a)(this,e),this.abi=[{inputs:[{internalType:"bytes32[]",name:"newContents",type:"bytes32[]"},{internalType:"bytes32[]",name:"previousContents",type:"bytes32[]"},{internalType:"bytes32[]",name:"titles",type:"bytes32[]"},{internalType:"uint32[]",name:"guildIds",type:"uint32[]"}],name:"bulkEdit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"deleteList",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"newContent",type:"bytes32"},{internalType:"bytes32",name:"previousContent",type:"bytes32"},{internalType:"bytes32",name:"title",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"editList",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"favoriteList",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"highlightList",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"}],name:"ListDeleted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"newContent",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"previousContent",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!1,internalType:"bytes32",name:"title",type:"bytes32"},{indexed:!1,internalType:"uint32",name:"guildId",type:"uint32"}],name:"ListEdited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"ListFavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"ListHighlighted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"ListUnfavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"ListUnhighlighted",type:"event"},{inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"unfavoritedList",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"unhighlightList",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0xCD76d04Ab1CeCb1F72dDc7b8dd798dD162db7684"}return Object(y.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),E=function(){function e(){Object(m.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"wallpaperHash",type:"bytes32"}],name:"DefaultWallpaper",type:"event"},{inputs:[{internalType:"bytes32",name:"wallpaperHash",type:"bytes32"},{internalType:"bytes32",name:"thumbnailHash",type:"bytes32"}],name:"newWallpaper",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"wallpaperHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"thumbnailHash",type:"bytes32"}],name:"NewWallpaper",type:"event"},{inputs:[{internalType:"bytes32",name:"wallpaperHash",type:"bytes32"}],name:"setDefaultWallpaper",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x21e424dB64f6597B60E179AAA7C819E616F801A0"}return Object(y.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),T=n(787),A=n(788),M=n(789),R=function(){function e(){Object(m.a)(this,e),this.abi=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"},{indexed:!0,internalType:"uint256",name:"versionNumber",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!1,internalType:"string",name:"metadataURI",type:"string"}],name:"NewPluginVersion",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"},{indexed:!0,internalType:"address",name:"creator",type:"address"},{indexed:!1,internalType:"string",name:"name",type:"string"}],name:"PluginCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"activeTokens",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"pluginURI",type:"string"},{internalType:"string",name:"pluginMetadata",type:"string"},{internalType:"bytes32",name:"pluginContentHash",type:"bytes32"},{internalType:"uint8[3]",name:"profitSplit",type:"uint8[3]"}],name:"createPlugin",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getProfitSplit",outputs:[{components:[{internalType:"uint8",name:"creatorShare",type:"uint8"},{internalType:"uint8",name:"ownerShare",type:"uint8"},{internalType:"uint8",name:"minterShare",type:"uint8"}],internalType:"struct ISplit.ProfitSplit",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"pluginTokens",outputs:[{internalType:"string",name:"name",type:"string"},{components:[{internalType:"uint8",name:"creatorShare",type:"uint8"},{internalType:"uint8",name:"ownerShare",type:"uint8"},{internalType:"uint8",name:"minterShare",type:"uint8"}],internalType:"struct ISplit.ProfitSplit",name:"profitSplit",type:"tuple"},{components:[{internalType:"uint256",name:"_value",type:"uint256"}],internalType:"struct Counters.Counter",name:"versionsCounter",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes",name:"_data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"tokenCreators",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenMetadataURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"string",name:"pluginURI",type:"string"},{internalType:"string",name:"pluginMetadataURI",type:"string"},{internalType:"bytes32",name:"pluginContentHash",type:"bytes32"}],name:"updatePlugin",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x922005bb5715BD7a584b53b9B377Bf5d426723c9"}return Object(y.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),C=n(790),N=n(158);n.d(t,"b",function(){return q}),n.d(t,"i",function(){return I}),n.d(t,"e",function(){return _}),n.d(t,"j",function(){return D}),n.d(t,"h",function(){return F}),n.d(t,"g",function(){return L}),n.d(t,"d",function(){return B}),n.d(t,"f",function(){return z}),n.d(t,"l",function(){return J}),n.d(t,"o",function(){return V}),n.d(t,"q",function(){return H}),n.d(t,"c",function(){return U}),n.d(t,"a",function(){return G}),n.d(t,"k",function(){return W}),n.d(t,"m",function(){return K}),n.d(t,"p",function(){return Q}),n.d(t,"r",function(){return Z}),n.d(t,"n",function(){return Y}),n.d(t,"s",function(){return X});var q="AUTHORIZER",I="GUILD_SAMPLES",_="FAVORITES",D="GUILD_SEQUENCES",F="GUILD_PRESETS",L="GUILDS",B="ENCRYPTION",z="FOLDERS",J="MESSAGING",V="RESAMPLE",H="XANADU",U="EFFECTS",G="ARTISTS",W="GUILD_SETTINGS",K="PACKS",Q="SCRIPTS",Z="ZPROJECTS",Y="PROJECT_METADATA",X={USERS:(new o.a).getContract(N.a),FAVORITES:(new r.a).getContract(N.a),GUILDS:(new h.a).getContract(N.a),PLUGINS:(new R).getContract(N.a),GUILD_SAMPLES:(new c.a).getContract(N.a),TOKENIZED_SEQUENCES:(new u.a).getContract(N.a),GUILD_SEQUENCES:(new l.a).getContract(N.a),GUILD_PRESETS:(new f.a).getContract(N.a),ENCRYPTION:(new p.a).getContract(N.a),FOLDERS:(new d.a).getContract(N.a),MESSAGING:(new v.a).getContract(N.a),SEQUENCE_METADATA:(new b).getContract(N.a),RESAMPLE:(new g.a).getContract(N.a),XANADU:(new O.a).getContract(N.a),MIX:(new k).getContract(N.a),EFFECTS:(new j.a).getContract(N.a),ARTISTS:(new w.a).getContract(N.a),GUILD_SETTINGS:(new x.a).getContract(N.a),MIDI_CC:(new S).getContract(N.a),EXPLORE_LISTS:(new P).getContract(N.a),WALLPAPER:(new E).getContract(N.a),PACKS:(new T.a).getContract(N.a),SCRIPTS:(new A.a).getContract(N.a),NFT:(new s.a).getContract(N.a),ZPROJECTS:(new M.a).getContract(N.a),AUTHORIZER:(new a.a).getContract(N.a),PROJECT_METADATA:(new i.a).getContract(N.a),SKINS:(new C.a).getContract(N.a)}},function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"g",function(){return h}),n.d(t,"d",function(){return d}),n.d(t,"e",function(){return v}),n.d(t,"f",function(){return m}),n.d(t,"c",function(){return b}),n.d(t,"b",function(){return g});var r=n(11),a=n(20),i=(n(3),n(63));function s(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c="%",u=function(e){return{type:i.c,name:e}},l=function(){return{cycle:void 0,transpose:"",operand:"",operator:void 0,id:Object(a.uuid)()}},f=function(e){return""===e.transpose},h=function(e){e=" "+e+" ";for(var t=[],n=[t],r=l(),a=0;a<e.length;a++){var s=e.charAt(a);switch(s){case"*":""===r.transpose&&(r.cycle=t.pop()),r.operator="*";break;case c:""===r.transpose&&(r.cycle=t.pop()),r.operator=c;break;case"^":""===r.transpose&&(r.cycle=t.pop()),r.operator="^";break;case"/":""===r.transpose&&(r.cycle=t.pop()),r.operator="/";break;case"~":r.transpose=null;break;case"'":r.accent=!0;break;case",":r.legato=!0;break;case" ":case"\n":p(r,t),r=l();break;case"[":p(r,t),t=[],n.push(t),r=l();break;case"]":p(r,t);var o=n.pop();(t=n[n.length-1]||[]).push(o),r=l();break;default:"."!==s||f(r)?s===i.b&&f(r)?(r.type=b(),r.transpose="0"):s===i.a&&f(r)?(r.type=g(0),r.transpose="0",p(r,t),(r=l()).type=g(1),r.transpose="0"):r.operator?r.operand+=s:r.transpose+=s:r.staccato=!0}}return n[0]};function p(e,t){if(e.cycle)isNaN(parseInt(e.operand))?e.operand=u(e.operand):e.operand=parseInt(e.operand),t.push(e);else if(void 0!==e.transpose&&""!==e.transpose){var n=null;null!=e.transpose&&(n=parseFloat(e.transpose),isNaN(n)?e.transpose=u(e.transpose):e.transpose=n),isNaN(parseInt(e.operand))?e.operand&&""!==e.operand&&(e.operand=u(e.operand)):e.operand=parseInt(e.operand),t.push(e)}}var d=function e(t,n,a){for(var i=[],o="",c=void 0,u=function(a){if(Array.isArray(t[a])){o+="[";var s=e(t[a],n,!0),u=s.spans;if(void 0!==s.index&&(c=i.length+s.index),o+=u[0],u.length>=1){if(i.push("["!==o[o.length-1]&&"["!==o.trim()?o.trim()+" ":o.trim()),(i=[].concat(Object(r.a)(i),Object(r.a)(u.slice(1))))[i.length-1]=i[i.length-1].trim(),i[i.length-2]){var l=i[i.length-2].trim();"]"===l[l.length-1]&&(i[i.length-2]=l)}i[i.length-1]+="] ",o=""}else o=o.trim(),i[i.length-1]=i[i.length-1].trim(),o+="] "}else{var f=!1;n&&n.some(function(e){return e.id===t[a].id})&&(f=!0,0===i.length?i.push(o):i[i.length-1]+=o,o=""),o+=m(t[a]),a<t.length-1&&" "!==o[o.length-1]&&(o+=" "),f&&(c=i.length,i.push(o),o=" ")}},l=0;l<t.length;l++)u(l);var f,h=[].concat(Object(r.a)(i),[o]);""===h[1]&&(h.splice(1,1),c--);var p,d=[],v=s(h);try{for(v.s();!(p=v.n()).done;){var y=p.value;f&&"]"===f[f.length-1]&&(" "!==y[0]&&"]"!==y&&"["!==y&&(y=" "+y),"]"===y.trim()[0]&&(y=y.trim())),d.push(y),f=y}}catch(b){v.e(b)}finally{v.f()}return a?{spans:d,index:c}:d},v=function e(t){for(var n="",r=0;r<t.length;r++){if(Array.isArray(t[r]))n+="["+e(t[r]).trim()+"] ";else n+=m(t[r]),r<t.length-1&&" "!==n[n.length-1]&&(n+=" ")}return n},m=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.cycle)return"["+v(e.cycle).trim()+"]"+e.operator+y(e.operand);var n="";if(e.operator){var r=e.transpose;r=null==r?"~":"object"===typeof e.transpose?e.transpose.name:e.transpose,n=t?r:r+e.operator+y(e.operand)}else if("object"===typeof e.transpose)n=null===e.transpose?"~":e.transpose.name;else if(e.type){var a=e.type,s=a.type,o=a.value;n=s===i.b?".":s===i.a&&0===o?"-":""}else n=e.transpose;return e.accent?n+="'":e.staccato?n+=".":e.legato&&(n+=","),n},y=function(e){if(""!==e)return"object"===typeof e?e.name:e},b=function(){return{type:i.b}},g=function(e){return{type:i.a,value:e}}},function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return a}),n.d(t,"a",function(){return i});n(158);var r=n(186);function a(e){var t=r.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}function i(t){var n=new e(t.replace(/^0x/,"1220"),"hex");return r.encode(n)}}).call(this,n(108).Buffer)},,,function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(357),a=Object(r.a)()},,function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(1371),u=n.n(c),l=n(23),f=new(function(){function e(){Object(s.a)(this,e)}return Object(o.a)(e,[{key:"setEthereum",value:function(e){this.ethereum=e}},{key:"setStore",value:function(e){this.store=e}},{key:"isMetamaskInstalled",value:function(){return!1}},{key:"appear",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAccount();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:fetch("/appear/"+t,{method:"POST",headers:{Accept:"text/html","Content-Type":"text/html"}});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isLoggedIn",value:function(){return this.store&&void 0!==this.store.getState().sequencer.userToken}},{key:"getToken",value:function(){var e=this.store.getState().sequencer.userToken;return e?e.token:void 0}},{key:"checkLogin",value:function(){var e=this;return new Promise(function(t){if(window.isNFT)t();else{var n=u.a.load("token");""!==n&&void 0!==n?fetch("/checkToken/"+n,{method:"POST",headers:{Accept:"text/html","Content-Type":"text/html"}}).then(function(){var n=Object(i.a)(a.a.mark(function n(r){var i,s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(401!==r.status){n.next=4;break}t(!1),n.next=10;break;case 4:return n.next=6,r.text();case 6:i=n.sent,s=u.a.load("token"),e.store.dispatch(Object(l.Ke)(i,s)),t(!0);case 10:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()):t(!1)}})}},{key:"logout",value:function(){this.store.dispatch(Object(l.Ke)(void 0)),this.account=void 0,u.a.remove("token",{path:"/"})}},{key:"signUp",value:function(e,t){var n=this;fetch("/signUp/"+e+"/"+t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(r){var a=u.a.load("token");n.store.dispatch(Object(l.Ke)(e,a)),n.ethereum.crypto.password=t})}},{key:"relogin",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.login(this._userName,this._password);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"login",value:function(e,t){var n=this;return new Promise(function(r,a){fetch("/login/"+e+"/"+t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(a){if(401===a.status)r(!1);else{n._userName=e,n._password=t;var i=u.a.load("token");n.store.dispatch(Object(l.Ke)(e,i)),n.ethereum.crypto.password=t,n.ethereum.guilds.onUserChanged(),n.account=void 0,n.appear(),r(!0)}})})}},{key:"getAccount",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){var s;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.account){t.next=4;break}return s=e.account,n(s),t.abrupt("return");case 4:if(e.isLoggedIn()){t.next=7;break}return n(void 0),t.abrupt("return");case 7:fetch("/getAccount/",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include"}).then(function(){var t=Object(i.a)(a.a.mark(function t(r){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(401!==r.status&&404!==r.status){t.next=4;break}n(void 0),t.next=8;break;case 4:return t.next=6,r.text();case 6:e.account=t.sent,n(e.account);case 8:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 8:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getUserName",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMetamaskInstalled()){e.next=10;break}return e.next=3,this.ethereum.getUser();case 3:return t=e.sent,e.next=6,this.ethereum.users.getUserName(t);case 6:return n=e.sent,e.abrupt("return",n);case 10:if(!this.isLoggedIn()){e.next=14;break}return e.abrupt("return",this.store.getState().sequencer.userToken.userName);case 14:return e.abrupt("return","Not Logged In");case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}());window._accounts=f,t.a=f},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"function"===typeof e?e.apply(void 0,n):e}},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(11),s=n(56),o=n(4),c=n(5),u=n(153);function l(e,t){return f.apply(this,arguments)}function f(){return(f=Object(s.a)(a.a.mark(function e(t,n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.eth.getTransaction(t);case 3:return r=e.sent,e.next=6,n.eth.getBlockNumber();case 6:return i=e.sent,e.abrupt("return",r&&null!==r.blockNumber?i-r.blockNumber:0);case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}},e,null,[[0,10]])}))).apply(this,arguments)}var h=n(23),p=n(146),d={AUTHORIZER:{authorize:p.s.AUTHORIZER.methods.authorize,revoke:p.s.AUTHORIZER.methods.revoke},USERS:{setName:p.s.USERS.methods.setName,setProfileHash:p.s.USERS.methods.setProfileHash},TOKENIZED_SEQUENCES:{editSequence:p.s.TOKENIZED_SEQUENCES.methods.editSequence,buyTokens:p.s.TOKENIZED_SEQUENCES.methods.buyTokens},GUILD_SEQUENCES:{editSequence:p.s.GUILD_SEQUENCES.methods.editSequence},GUILD_PRESETS:{newPreset:p.s.GUILD_PRESETS.methods.newPreset,tagPreset:p.s.GUILD_PRESETS.methods.tagPreset},GUILDS:{newGuild:p.s.GUILDS.methods.newGuild,requestToAddMember:p.s.GUILDS.methods.requestToAddMember,leaveGuild:p.s.GUILDS.methods.leaveGuild,acceptRequestToAddToGuild:p.s.GUILDS.methods.acceptRequestToAddToGuild,rejectRequestToAddToGuild:p.s.GUILDS.methods.requestRequestToAddToGuild},GUILD_SAMPLES:{newSamplesWithMetadata:p.s.GUILD_SAMPLES.methods.newSamplesWithMetadata,newSampleWithMetadata:p.s.GUILD_SAMPLES.methods.newSampleWithMetadata,newEncryptedSamples:p.s.GUILD_SAMPLES.methods.newEncryptedSamples},ENCRYPTION:{setPublicKey:p.s.ENCRYPTION.methods.setPublicKey,newEncryptedContent:p.s.ENCRYPTION.methods.newEncryptedContent,shareEncryptedContentWith:p.s.ENCRYPTION.methods.newEncryptedContent},FOLDERS:{foldersUpdated:p.s.FOLDERS.methods.foldersUpdated},MESSAGING:{sendPublicMessage:p.s.MESSAGING.methods.sendPublicMessage},SEQUENCE_METADATA:{tagSequence:p.s.SEQUENCE_METADATA.methods.tagSequence,starSequence:p.s.SEQUENCE_METADATA.methods.starSequence,favoriteSequence:p.s.SEQUENCE_METADATA.methods.favoriteSequence,unfavoriteSequence:p.s.SEQUENCE_METADATA.methods.unfavoriteSequence,unstarSequence:p.s.SEQUENCE_METADATA.methods.unstarSequence},RESAMPLE:{newResample:p.s.RESAMPLE.methods.newResample},XANADU:{newDataType:p.s.XANADU.methods.newDataType,newLinkType:p.s.XANADU.methods.newLinkType,newAnnotationType:p.s.XANADU.methods.newAnnotationType,newLink:p.s.XANADU.methods.newLink,newLinks:p.s.XANADU.methods.newLinks,newAnnotation:p.s.XANADU.methods.newAnnotation},MIX:{newMix:p.s.MIX.methods.newMix},EFFECTS:{newEffect:p.s.EFFECTS.methods.newEffect},FAVORITES:{favoriteSample:p.s.FAVORITES.methods.favoriteSample,unfavoriteSample:p.s.FAVORITES.methods.unfavoriteSample},ARTISTS:{newRelease:p.s.ARTISTS.methods.newRelease,newArtistInfo:p.s.ARTISTS.methods.newArtistInfo,newSampleByArtist:p.s.ARTISTS.methods.newSampleByArtist},GUILD_SETTINGS:{leaveGuild:p.s.GUILD_SETTINGS.methods.guildSettings,userChoseDefaultGuild:p.s.GUILD_SETTINGS.methods.userChoseDefaultGuild,createGuildWithPeople:p.s.GUILD_SETTINGS.methods.createGuildWithPeople},MIDI_CC:{newMidiCCParameter:p.s.MIDI_CC.methods.newMidiCCParameter},EXPLORE_LISTS:{editList:p.s.EXPLORE_LISTS.methods.editList,bulkEdit:p.s.EXPLORE_LISTS.methods.bulkEdit,deleteList:p.s.EXPLORE_LISTS.methods.deleteList,highlightList:p.s.EXPLORE_LISTS.methods.highlightList,unhighlightList:p.s.EXPLORE_LISTS.methods.unhighlightList,favoriteList:p.s.EXPLORE_LISTS.methods.favoriteList,unfavoriteList:p.s.EXPLORE_LISTS.methods.unfavoriteList},WALLPAPER:{newWallpaper:p.s.WALLPAPER.methods.newWallpaper,setDefaultWallpaper:p.s.WALLPAPER.methods.setDefaultWallpaper},PACKS:{newPack:p.s.PACKS.methods.newPack},SCRIPTS:{newScript:p.s.SCRIPTS.methods.newScript},NFT:{newProject:p.s.NFT.methods.newProject,mint:p.s.NFT.methods.mint},ZPROJECTS:{editSequence:p.s.ZPROJECTS.methods.editSequence,zoraProject:p.s.ZPROJECTS.methods.zoraProject},PLUGINS:{createPlugin:p.s.PLUGINS.methods.createPlugin,updatePlugin:p.s.PLUGINS.methods.updatePlugin},PROJECT_METADATA:{newProjectMetadata:p.s.PROJECT_METADATA.methods.newProjectMetadata},SKINS:{newSkins:p.s.SKINS.methods.newSkins}},v=n(125),m=function(){function e(t,n,r,a){Object(o.a)(this,e),this.contract=t,this.method=n,this.arguments=r,this.value=a}return Object(c.a)(e,[{key:"execute",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(a.a.mark(function t(n,r){var o,c,l;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.getAccount();case 2:if(void 0!==(o=t.sent)){t.next=6;break}return r(),t.abrupt("return");case 6:v.a.isMetamaskInstalled()?(l={from:o},e.value&&(l.value=e.value),(c=d[e.contract])[e.method].apply(c,Object(i.a)(e.arguments)).send(l,function(e,t){e?r(e):n()})):(console.log("runnign transaction"),fetch("/transaction/",{method:"POST",body:JSON.stringify(e.getJson()),headers:{Accept:"application/json","Content-Type":"application/json"},withCredentials:!0}).then(function(){var t=Object(s.a)(a.a.mark(function t(r){var i,s;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("returned ="),t.next=3,r.json();case 3:i=t.sent,s=i.transactionHash,console.log("transaction hash = "+s),e.newPendingTransaction(s),e.waitForConfirmation(s),n();case 9:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()));case 7:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"transactions",get:function(){return v.a.store.getState().transactions.pendingTransactions},set:function(e){v.a.store.dispatch(Object(h.Hc)(e))}},{key:"newPendingTransaction",value:function(e){this.transactions=[].concat(Object(i.a)(this.transactions),[e])}},{key:"waitForConfirmation",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;setTimeout(Object(s.a)(a.a.mark(function r(){return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,l(e,v.a.web3);case 2:if(!(r.sent>=n)){r.next=6;break}return t.onConfirm(e),r.abrupt("return");case 6:return r.abrupt("return",t.waitForConfirmation(e,n));case 7:case"end":return r.stop()}},r)})),3e4)}},{key:"onConfirm",value:function(e){var t=Object(i.a)(this.transactions),n=t.indexOf(e);n>-1&&(t.splice(n,1),this.transactions=t)}},{key:"getJson",value:function(){return{contract:this.contract,method:this.method,arguments:this.arguments,token:u.a.getToken(),value:this.value}}}]),e}();t.a=m},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"d",function(){return i}),n.d(t,"e",function(){return s}),n.d(t,"b",function(){return o}),n.d(t,"g",function(){return c}),n.d(t,"f",function(){return u}),n.d(t,"h",function(){return l}),n.d(t,"i",function(){return f}),n.d(t,"j",function(){return h}),n.d(t,"k",function(){return p});var r="float",a="vec2",i="vec3",s="vec4",o="sampler2D",c="number",u="list",l="SDF Manager",f=[r,a,a,i,s,o,c,"string",u,l],h=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{or:t}},p=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{repeat:t}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e,t){return(e%t+t)%t}},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return s});var r=n(262),a=n.n(r),i=new a.a(new a.a.providers.HttpProvider("https://goerli.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),s=new a.a(new a.a.providers.WebsocketProvider("wss://goerli.infura.io/ws/v3/2f3dce2af1044e88b4851c3d73c3d00c"))},,function(e,t,n){"use strict";n.d(t,"g",function(){return r}),n.d(t,"h",function(){return a}),n.d(t,"f",function(){return i}),n.d(t,"c",function(){return s}),n.d(t,"e",function(){return o}),n.d(t,"b",function(){return c}),n.d(t,"a",function(){return u}),n.d(t,"d",function(){return l});var r="SAMPLED_INSTRUMENT",a="SYNTH",i="MULTI_SYNTH",s="FM_SYNTH",o="METAL_SYNTH",c="EXTERNAL_INSTRUMENT",u="EFFECTS",l={SAMPLER:"Sampler",SYNTH:"Synth",MULTI_SYNTH:"Synth",FM_SYNTH:"FM Synth",EXTERNAL_INSTRUMENT:"External Instrument",SAMPLED_INSTRUMENT:"Sampled Instrument",INSTRUMENT_RACK:"Instrument Rack",METAL_SYNTH:"Metal Synth",EFFECTS:"FX"}},,function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(1),a=n(107),i=(n(140),n(216)),s=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];var v=void 0,m=void 0,y=void 0,b=o(),g=void 0,O=void 0;return function(t){var s=Object(a.a)(t,1)[0],o=b.apply(void 0,[s].concat(n)),k=c.apply(void 0,[s].concat(n)),j=l.apply(void 0,[s].concat(n)),w=u.apply(void 0,[s].concat(n)),x="object"===typeof s?s.frames:void 0,S=n.map(function(e){return e()});if(f(y,s)&&h(m,S)&&p(o,g)&&d(k,O))return v.uniforms=o,v.variables=k,v.functions=j,v.closure=w,v.args=S,v.frames=x,v.input=s,m=S,y=s,v;g=Object.keys(o),O=Object(r.a)({},k);var P=e(s);return m=S,y=s,v={code:P,hashCode:Object(i.a)(P),uniforms:o,variables:k,functions:j,closure:w,args:S,frames:x,input:s}}},o=function(){var e={};return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var s=i[a];if("function"===typeof s&&(s=s()),s&&s.uniforms)for(var o in s.uniforms)e[o]=s.uniforms[o]}return e}},c=function(){for(var e={},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var s=i[a];if("function"===typeof s&&(s=s()),s&&s.variables)for(var o in s.variables)e[o]=s.variables[o]}return e},u=function(){for(var e={},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var s=i[a];if("function"===typeof s&&(s=s()),s&&s.closure)for(var o in s.closure)e[o]=s.closure[o]}return e},l=function(){for(var e={},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var s=i[a];if("function"===typeof s&&(s=s()),s&&s.functions)for(var o in s.functions)e[o]=s.functions[o]}return e},f=function(e,t){return Array.isArray(e)?h(e,t):e&&t?e.hashCode&&t.hashCode?e.hashCode===t.hashCode:e===t:!e&&!t},h=function(e,t){if(!e)return!e&&!t;for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(void 0===r||void 0===a){if(void 0===r&&void 0===a)continue;return!1}if(!(r.hashCode&&a.hashCode===r.hashCode||r.code&&a.code&&r.code===a.code||r===a))return!1}return!0},p=function(e,t){var n=0;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e){if(!e[r].update||t[r]&&!t[r].update)return!1;if(t[n]!==r)return!1;n++}return!0},d=function(e,t){if(!t)return!1;for(var n in e)if(e[n]!==t[n])return!1;return!0}},function(e,t,n){"use strict";var r=n(11),a=n(17),i=n(33),s=n(111);n(133);function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=new i.a,l=function e(t,n,a){var i=t;void 0===t.axiom&&(i=t(n.stepData,n.stepNumber,n.time,a,n.graphics,n.delays));var c,l,d,v;switch(i.axiom){case s.c:return Object(s.A)(i.value,n.stepData,n.stepNumber,n.time,a)?[n]:[];case s.j:(c=a.copyTrigger(n,!0)).stepData.slide=n.stepData.slide;var m=Object(s.A)(i.value,n.stepData,n.stepNumber,n.time,a);Array.isArray(m)&&(m=m[0]);var y=void 0!==m[i.param]?m[i.param]:"function"===typeof m?Object(s.A)(m,n.stepData,n.stepNumber,n.time,a):m;"object"===typeof y&&y.sequence&&(y=y.sequence[0]);var b=c.stepData[i.param+"Parameter"];return b&&b.set(y),[c];case s.m:return(c=a.copyTrigger(n,!0)).outputNumber=Object(s.A)(i.value),[c];case s.d:return(c=a.copyTrigger(n,!0)).grabs=[].concat(Object(r.a)(c.grabs),[{trackNumber:i.trackNumber,fromParam:i.fromParam,toParam:i.toParam,add:i.add}]),[c];case s.a:return(c=a.copyTrigger(n,!0)).chokes=[].concat(Object(r.a)(c.chokes),[{trackNumber:i.trackNumber}]),[c];case s.e:return(c=a.copyTrigger(n,!0)).grabs=[].concat(Object(r.a)(c.grabs),[{trackNumber:i.trackNumber,isTime:!0}]),[c];case s.i:var g,O=o(i.sequence);try{for(O.s();!(g=O.n()).done;){var k=g.value,j=n,w=j.time,x=j.stepNumber;Array.isArray(n)&&(w=n[0].time,x=n[0].stepNumber);var S=f(k,Array.isArray(n)?n:[n],x,w,a);if(0===S.length)return[];n=S}}catch(N){O.e(N)}finally{O.f()}return Array.isArray(n)?n:[n];case s.g:var P,E=[],T=o(i.sequence);try{for(T.s();!(P=T.n()).done;){var A=e(P.value,n,a);0!==A.length&&(E=[].concat(Object(r.a)(E),Object(r.a)(A)))}}catch(N){T.e(N)}finally{T.f()}return E;case s.l:return h(i,a.track.sequencerEngine),[n];case s.k:return p(i,a.track),[n];case s.h:return l=i.value,d=a.sequencerEngine||a.track.sequencerEngine,v=a.track,d.switchToPattern(Math.round(Object(s.A)(l)),!0,v.subSequence,void 0,void 0,!0),[n];case s.n:var M=[];if(Array.isArray(i.value))return i.value;if(0===(M=[i.value]).length){var R=a.getStep(u);R.track=a.track,M=[{stepData:R,time:n.time,stepNumber:n.stepNumber}]}return M;case s.b:var C=Object(s.A)(i.condition,n.stepData,n.stepNumber,n.time,a);return e(("object"===typeof C?C.value:C)?i.statement1:i.statement2,n,a);case s.f:return n.message&&n.message.type===i.value.type?e(i.value.fn(n.message.value),n,a):Array.isArray(n)?n:[n]}return[]},f=function e(t,n,a,i,c){var f=[];if(n.length>0){var h,p=o(n);try{for(p.s();!(h=p.n()).done;){var d=h.value;f=[].concat(Object(r.a)(f),Object(r.a)(l(t,d,c)))}}catch(g){p.e(g)}finally{p.f()}}else{if("function"!==typeof t){var v=t;t=function(){return v}}var m=t(void 0,a,i,c),y=m.axiom,b=m.value;if(y===s.n||y===s.g||y==s.i)if(m.sequence&&(f=y===s.g?[].concat(Object(r.a)(f),Object(r.a)(m.sequence.map(function(t){return e(t,n,a,i,c)}).reduce(function(e,t){return[].concat(Object(r.a)(e),Object(r.a)(t))},[]))):[].concat(Object(r.a)(f),Object(r.a)(m.sequence.reduce(function(t,n){return e(n,t,a,i,c)},n)))),Array.isArray(b)?f=[].concat(Object(r.a)(f),Object(r.a)(b)):void 0!==b&&f.push(b),y===s.n&&0===f.length)c.getStep(u).track=c.track,f.push({stepData:c.getStep(u),time:i,stepNumber:a})}return f},h=function(e,t){var n=e.number,r=e.modType,i=e.param,o=e.value;if(r===a.a){var c=t.envelopes[n][i+"Parameter"];c&&c.set(Object(s.A)(o))}else{var u=t.lfos[n].lfo[i+"Parameter"];u&&u.set(Object(s.A)(o))}},p=function(e,t){var n=e.name,r=e.value,a=t.liveEffects.effects.find(function(e){return"Macros"===e.name});if(a){var i=a.macros.find(function(e){return e.name===n});if(i){var o=Math.max(0,Math.min(1,Object(s.A)(r)));i.macroParameter.set(o)}}};n.d(t,"a",function(){return d});var d=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n,r,a){return t.reduce(function(e,t){return f(t,e,n,r,a)},e)}}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=(n(7),n(135)),u=(n(123),n(14),n(430)),l=n(11),f=n(276);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var d=function(e){Object(i.a)(n,e);var t=p(n);function n(e,a){var i;return Object(r.a)(this,n),(i=t.call(this,e,a)).myScript=function(){return[]},i.isScript=!0,i}return Object(a.a)(n,[{key:"onNewStep",value:function(){this.triggers.length>0&&(this.triggers.length=0)}},{key:"currentStep",get:function(){return this.track.sequencerEngine.trackStep%this.track.length}},{key:"output",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentStep,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.currentStep;try{if(this.currentTime=e,this.actualStepNumber=r,e||this.triggers.forEach(function(e){return e.stepNumber=r}),void 0===this.myScript)return this.triggers;var a=this.script(this.triggers,n,e,this);return this.graphics=[],a.forEach(function(e){var n=e.stepData,r=e.graphics;n&&(t._subSequence||(n.track=t.track)),r&&t.graphics.push(r)}),a}catch(i){return console.log("error w script=",i),[]}}},{key:"script",get:function(){return this.myScript}},{key:"isRealTime",value:function(){return!1}}]),n}(function(e){Object(i.a)(n,e);var t=h(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).tidals=[],e}return Object(a.a)(n,[{key:"useTidal",value:function(){var e=this.tidals.find(function(e){return!e.inUse});return e?(e.inUse=!0,e):((e=new f.a(this.track,this)).inUse=!0,this.tidals=[].concat(Object(l.a)(this.tidals),[e]),e)}},{key:"freeTidals",value:function(){this.tidals.forEach(function(e){e.inUse?e.lastUsed=0:e.lastUsed=(e.lastUsed||0)+1,e.inUse=!1})}},{key:"getTidalsInUse",value:function(){return this.tidals.filter(function(e){return e.inUse})}}]),n}(Object(u.a)(c.a)));t.a=d},function(e,t,n){"use strict";n.d(t,"e",function(){return r}),n.d(t,"d",function(){return a}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return s}),n.d(t,"a",function(){return o});var r="zobject",a="zmessage",i="pad",s="track",o="effect"},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(9),s=n(582),o=n(354),c=function(){function e(t,n){Object(r.a)(this,e),this.mix=t,this.type=n}return Object(a.a)(e,[{key:"mixByType",get:function(){var e=Object(i.s)(this.type)?this.mix.deterministicMixesByType:this.mix.mixesByType;return this.type in e||(Object(i.s)(this.type)?e[this.type]=new s.a(this.type):e[this.type]=new o.a(this.type)),e[this.type]}},{key:"events",get:function(){return this.mixByType.events},set:function(e){this.mixByType.events=e}},{key:"execute",value:function(){}},{key:"getDuration",value:function(e){for(var t=0;t<this.events.length;t++){var n=this.events[t];if(void 0===e)return n.step-e.step}return 0}},{key:"calculateDurations",value:function(){for(var e=[],t=void 0,n=0;n<this.events.length;n++){var r=this.events[n];void 0!==t&&r.isEquivalent(t)||e.push(r),t=r}this.events=e,t=void 0;for(var a=0;a<this.events.length;a++){var i=this.events[a];void 0!==t&&(t.duration=i.step-t.step),t=i}}}]),e}();t.a=c},,,function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){for(var e=[],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var s=i[a];"function"===typeof s&&(s=s()),s=void 0===s?{}:s,e.push(s.code||s||"0.0")}return e}},,function(e,t,n){"use strict";var r=n(4),a=n(5),i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],s={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11},o={"C#":!0,"D#":!0,"F#":!0,"G#":!0,"A#":!0},c={},u=function(){function e(t,n){Object(r.a)(this,e),void 0===t&&(t="C"),this.note=t.toUpperCase(),this.octave=n}return Object(a.a)(e,[{key:"isBlackNote",value:function(){return o[this.note]}},{key:"transpose",value:function(t){this.note;var n=Math.floor(f(t,12)),r=Math.floor(t/12);return new e(i[n],this.octave+r)}},{key:"addTranspose",value:function(t){var n=s[this.note],r=Math.floor(f(t+n,12)),a=Math.floor((t+n)/12);return new e(i[r],this.octave+a)}},{key:"toString",value:function(){return this.note+this.octave}},{key:"getTranspose",value:function(){this.noteIndex();return 12*(this.octave-l.octave)+(this.noteIndex()-l.noteIndex())}},{key:"noteIndex",value:function(){return s[this.note]}},{key:"getCopy",value:function(){return new e(this.note,this.octave)}},{key:"equal",value:function(e){return this.note===e.note&&this.octave===e.octave}}]),e}(),l=new u("C",3);function f(e,t){return(e%t+t)%t}function h(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t&&c[e])return c[e];var n=void 0;return n="#"===e.substring(1,2)?new u(e.substring(0,2),parseInt(e.substring(2))):new u(e.substring(0,1),parseInt(e.substring(1))),t&&(c[e]=n),n}for(var p=i.map(function(e){return new u(e,3)}),d=0;d<16;d++)for(var v in i){h(i[v]+d)}t.a={Note:u,middleC:l,fromString:h,fromTranspose:function(e){return l.getCopy().transpose(e)},NOTES:p,baseNotes:i}},,,function(e,t,n){"use strict";var r=n(1),a=n(42),i=n.n(a),s=n(56),o=n(11),c=n(107),u=n(4),l=n(5),f=n(31),h=n(10),p=n(6),d=n(8),v=n(2),m=n(7),y=n.n(m),b=n(138),g=n(23),O=n(304),k=(n(116),new(function(){function e(){Object(u.a)(this,e),this.tracks=[],this.sends=[]}return Object(l.a)(e,[{key:"useSend",value:function(){return 0!==this.sends.length&&window.explore?this.sends.pop():new y.a.Volume(-100)}},{key:"releaseSend",value:function(e){window.explore?(e.disconnect(),e.volume.value=-100,this.sends.push(e)):e.dispose()}},{key:"useTrack",value:function(){return 0!==this.tracks.length&&window.explore?this.tracks.pop():{gainNode:new y.a.PanVol,volumeNode:new y.a.Volume,muteableNode:new y.a.Volume,trackNode:new y.a.Solo,trackMeter:new y.a.Meter(.9),faderNode:new y.a.Gain}}},{key:"releaseTrack",value:function(e){for(var t in e){var n=e[t];window.explore?n.disconnect():n.dispose()}this.tracks.push(e)}}]),e}())),j=n(242),w=n(896),x=n(412),S=n(141),P=n(165),E=n(290),T=n(20),A=n(44),M=function(e,t,n,r){var a,i=e.state;if(t.isMapped){var s=t.isMapped.getInitialValueForParameter(t);void 0!==t.patternToValue[n]?t.patternToValue[n]=s:t.unlockedValue=s}(t.automatable&&(i.mix.isRecordingMix?R(i,t)||(a=t.updateRedux(!0,r)):i.mix.isPlayingMix&&t.mixAutomation.hasEventsAfterStep(e.trackStep)||(a=t.updateRedux(!0,r))),t.isMapped)&&t.isMapped.clearParameter(t);return a},R=function(e,t){return e.automation.parameterSliderDown.includes(t)},C=n(897),N=(n(404),n(227)),q=n(898),I=(n(269),n(123)),_=n(402),D=n(899),F=(n(66),n(126)),L=n(112),B=n(14),z=function(){function e(t){Object(u.a)(this,e),this.track=t,this.choke=void 0,this.transposeMatch=void 0,this.chokingDuration=0,this.isLiveTriggering=!1}return Object(l.a)(e,[{key:"onStep",value:function(){this.chokingDuration=Math.max(this.chokingDuration-1,0)}},{key:"newChoke",value:function(e,t){this.chokingDuration=e,this.track.releaseAll(t)}},{key:"isChoked",value:function(){return this.isLiveTriggering||this.chokingDuration>0}},{key:"liveTrigger",value:function(){this.choke&&(this.choke.chokes.isLiveTriggering=!0,this.choke.releaseAll())}},{key:"liveRelease",value:function(){this.choke&&(this.choke.chokes.isLiveTriggering=!1)}},{key:"getJson",value:function(){return{choke:void 0===this.choke?void 0:this.choke.trackNumber}}},{key:"fromJson",value:function(e,t){void 0!==e.choke&&(this.choke=t[e.choke])}}]),e}(),J=n(306),V=n(122),H=n(545),U=n(197),G=n(424),W=n(129),K=n(270),Q=n(900),Z=n(548),Y=function(){function e(){Object(u.a)(this,e),this.type=Z.a,this.nameToMidiInput={}}return Object(l.a)(e,[{key:"addMidiInput",value:function(e){this.nameToMidiInput[e.name]=e,this.type=Z.c}},{key:"deleteMidiInput",value:function(e){e.name in this.nameToMidiInput&&(delete this.nameToMidiInput[e.name],0===Object.keys(this.nameToMidiInput).length&&(this.type=Z.a))}},{key:"setType",value:function(e){e!==Z.a&&e!==Z.b||(this.nameToMidiInput={}),this.type=e}},{key:"accepts",value:function(e,t){return this.type===Z.a||(e?t in this.nameToMidiInput:this.type===Z.b)}},{key:"getMidiInputs",value:function(){return Object.values(this.nameToMidiInput)}},{key:"getMidiInputNames",value:function(){return Object.keys(this.nameToMidiInput)}}]),e}(),X=(n(68),n(67)),$=(n(69),n(246)),ee=(n(70),n(43),n(136)),te=n(46),ne=(n(261),n(243)),re=n(929),ae=n(33),ie=n(231),se=n(21),oe=(n(234),n(35)),ce=n(180),ue=function(){function e(t,n){Object(u.a)(this,e),this.envelope=t,this.mode=n}return Object(l.a)(e,[{key:"equals",value:function(e){return this.envelope===e.envelope&&this.mode===e.mode}},{key:"getJson",value:function(){return{envelope:this.envelope.number-1,mode:this.mode}}}]),e}(),le=n(552),fe=n(125),he=n(901);function pe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var a=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(d.a)(this,n)}}var de=n(902);function ve(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var a=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(d.a)(this,n)}}var me=new(n(130).a);function ye(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return be(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ge(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var a=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(d.a)(this,n)}}var Oe=fe.a.presets,ke=new se.a(32,!1),je=new se.a(16,!1),we=function(e){Object(p.a)(n,e);var t=ge(n);function n(e,r,a,i,s,o){var l;Object(u.a)(this,n),(l=t.call(this)).subSequence=o,l.id=Object(T.uuid)(),l.trackNumber=e,l.gated=!0,l.sequencerEngine=r,l.sequencerEngine.idToObject[l.id]=Object(f.a)(l),l.store=r.store,l.parameters=[],l.update=s;var h=k.useTrack(),p=h.gainNode,d=h.volumeNode,v=h.muteableNode,m=h.trackNode,y=h.trackMeter,b=h.faderNode;l.gainNode=p,l.volumeNode=d,l.muteableNode=v,l.trackNode=m,l.trackMeter=y,l.faderNode=b,l.volumeParameter=new L.c("volume",l.volumeNode.volume,{defaultValue:0,prettyName:"Track Volume",min:-60,max:6,isDb:!0,onChange:function(e){l.pad&&l.pad.sendSliderLevels()}},.1),l.registerParameter(l.volumeParameter),l.trackNode.connect(l.volumeNode),l.volumeNode.connect(l.faderNode),l.faderNode.connect(l.muteableNode),l.muteableNode.connect(l.trackMeter),l.muted=!1,l.sendNodes=[],l.sendNodeVolumeParameters=[],l.patternNumberLocked=void 0,l.pattern=new ne.a(l.sequencerEngine,Object(f.a)(l)),l.patterns=[l.pattern];for(var g=1;g<i;g++)l.patterns.push(new ne.a(l.sequencerEngine,Object(f.a)(l)));return l.currentPattern=l.getInitialPattern(),l.soundIds=[],l.auditionedSounds=[],l.toAudition=[],l.trackData=new ae.a(void 0,l.mix,(new I.a).forTrack(Object(f.a)(l))),l.trackData.loadDefaults(),l.on=!1,l.samplers={},l.group=null,l.selectedStep=void 0,l.name=void 0,l.videoId="",l.resampler=void 0,l.masterResampler=new D.a(l.sequencerEngine,l.volumeNode),l.effectsChains=[new j.a(l.gainNode,l.trackNode,(new I.a).forTrack(Object(f.a)(l)),l.sequencerEngine)],l.effectsChains[0].initDefault(),l.midiEffects=new x.a(Object(f.a)(l)),l.liveEffects=new C.a(Object(f.a)(l)),l.midiInputs=new Y,l.samples=[],l.connectedEnvelopes=[],l.frozenSamplesToSave=[],l.chokes=new z(Object(f.a)(l)),l.outputTypeConfigured=H.a,l.outputTypeParameter=new B.a("outputType",Object(f.a)(l),function(e,t){return l.changeOutputType(t)},{defaultValue:H.a,automatable:!1}),l.registerParameter(l.outputTypeParameter),l.skipMidiMasterParameter=new B.a("skipMidiMaster",Object(f.a)(l),function(e,t){return[]},{defaultValue:!1,automatable:!1}),l.registerParameter(l.skipMidiMasterParameter),l.newFrozenColumn(),l.disabled=!1,l.stepGroups=[],l.newInlet("trigger ",function(e){var t=Object(c.a)(e,1)[0];return l.onTrigger(t)}),l.newInlet("audition sample",function(e){var t=Object(c.a)(e,1)[0];return l.loadAndUseNewSound(t)}),l.newInlet("restart",function(e){var t=Object(c.a)(e,1)[0];return l.onRestart(t)}),l.newOutlet(W.p),l.newOutlet("levels data"),l.newOutlet("pattern progress"),l.preset=new N.a,l.preset.track=Object(f.a)(l),l}return Object(l.a)(n,[{key:"onTrigger",value:function(e){var t="bang"===e;"bang"!==e&&void 0!==e.transpose||(e=this.trackData);var n=e.time,r=this.sequencerEngine.stepNumber;(e=this.midiEffects.getStep(e)).transpose+=this.trackData.transpose,e.velocity*=this.trackData.velocity,e.duration*=this.trackData.duration,e.track=this,t?this.liveTrigger(e,0,y.a.Master.context.currentTime+.001):this.midiEffects.receivedTriggers.push({time:n,stepNumber:r,stepData:e})}},{key:"getObjectType",value:function(){return P.c}},{key:"skipMidiMaster",get:function(){return this.skipMidiMasterParameter.get()}},{key:"changeOutputType",value:function(e){this.outputTypeConfigured!==e&&(this.outputTypeConfigured=e,e===H.b?(this.muteableNode.disconnect(),this.reconnectAll()):this.addToGroup(this.group))}},{key:"registerParameter",value:function(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.parameters.push(e),e.setStore(this.store),e.setContext((new I.a).forTrack(this))}},{key:"newEffectsChain",value:function(){var e=new j.a(this.gainNode,this.trackNode,(new I.a).forTrack(this),this.sequencerEngine);e.initDefault(),this.effectsChains.push(e),this.store.dispatch(Object(g.xb)(this.subSequence.id,this.trackNumber,this.effectsChains.length-1))}},{key:"deleteEffectsChain",value:function(){var e=this.effectsChains[this.chainNumber];void 0!==e&&(e.dispose(),this.effectsChains.splice(this.chainNumber,1),this.store.dispatch(Object(g.xb)(this.subSequence.id,this.trackNumber,this.effectsChains.length-1)))}},{key:"getEffects",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chainNumber;return this.effectsChains[e].effects}},{key:"connectToEnvelope",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:le.a;for(var n in this.sequencerEngine.tracks){var r=this.sequencerEngine.tracks[n];r.isConnectedToEnvelope(e)&&r.disconnectFromEnvelope(e)}this.connectedEnvelopes.push(new ue(e,t)),this.store.dispatch(Object(g.ke)(this.id,Object(o.a)(this.connectedEnvelopes)))}},{key:"disconnectFromEnvelope",value:function(e){for(var t=0;t<this.connectedEnvelopes.length;t++)if(this.connectedEnvelopes[t].envelope===e)return this.connectedEnvelopes.splice(t,1),void this.store.dispatch(Object(g.ke)(this.id,Object(o.a)(this.connectedEnvelopes)))}},{key:"getEnvelopeMode",value:function(e){return this.connectedEnvelopes.filter(function(t){return t.envelope===e}).map(function(e){return e.mode})[0]}},{key:"setEnvelopeMode",value:function(e,t){return this.connectedEnvelopes.filter(function(t){return t.envelope===e}).forEach(function(e){return e.mode=t})}},{key:"isConnectedToEnvelope",value:function(e){return this.connectedEnvelopes.some(function(t){return t.envelope===e})}},{key:"rolling",get:function(){var e=this.liveEffects.getEffect(ce.f);if(!e)return this.sequencerEngine.rolling;switch(e.mode){case ce.b:return!0;case ce.a:return!1;default:return this.sequencerEngine.rolling}}},{key:"start",value:function(){if(this.restartedAtStepNumber=void 0,this.lastPatternStep=void 0,this.effectsChains.forEach(function(e){return e.start()}),this.midiEffects.clear(),this.liveEffects.clear(),this.getTrackType()===ee.b){var e=this.getInstrument();e&&e.hasLFO()&&(e.stop(),e.start())}this.notesTriggered={},this.accumulators={},this.patterns.forEach(function(e){return e.isRecording=!1}),this.scheduleTrackPatternChangeIfAny();var t,n=ye(this.stepGroups);try{for(n.s();!(t=n.n()).done;){t.value.transformations.forEach(function(e){return e.loopCounter=-1})}}catch(r){n.e(r)}finally{n.f()}}},{key:"getGroupForId",value:function(e){return this.stepGroups.find(function(t){return t.id===e})}},{key:"patternLocked",get:function(){var e=this.store.getState().tracks.trackPatternLocks[this.subSequence.id];return void 0!==e&&((e[this.trackNumber]||{})[this.currentPattern]||!1)}},{key:"linearRampFade",value:function(e,t,n){this.faderNode.gain.linearRampTo(e,.001,y.a.Master.context.currentTime+.001),this.faderNode.gain.linearRampTo(t,n,y.a.Master.context.currentTime+.003)}},{key:"fade",set:function(e){var t=Object(K.a)(e,0,1,1,0);this.faderNode.gain.setValueAtTime(t,1e-4)}},{key:"patternLocks",set:function(e){for(var t in e)this.store.dispatch(Object(g.re)(this.subSequence.id,this.trackNumber,t,e[t]));this.getAllPatternLockedParameters().forEach(function(e){return e.updateRedux()})}},{key:"deletePatternLocks",value:function(){this.getAllParameters().forEach(function(e){return e.deleteLocks()}),this.store.dispatch(Object(g.se)(this.subSequence.id,this.trackNumber,{}))}},{key:"deleteAutomations",value:function(){this.getAllPatternLockedParameters().forEach(function(e){return e.deleteAutomations()})}},{key:"togglePatternLock",value:function(){this.store.dispatch(Object(g.re)(this.subSequence.id,this.trackNumber,this.currentPattern,!this.patternLocked)),this.getAllPatternLockedParameters().forEach(function(e){return e.updateRedux()})}},{key:"getName",value:function(e){return void 0!==e?this.samples[e].name:void 0===this.sample?"":this.sample.name}},{key:"isRecordable",value:function(){return!1}},{key:"setSequencerEngine",value:function(e){this.sequencerEngine=e}},{key:"resolution",get:function(){return this.sequencerEngine.resolution}},{key:"getFactoredResolution",value:function(){var e=this.sequencerEngine.rollingResolution,t=this.liveEffects.getEffect(ce.f);return t&&((e=e.getCopy()).resolution*=t.rollFactor),e}},{key:"solo",value:function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.trackNode.solo=e,t&&this.store.dispatch(Object(g.we)(this.id,e))}},{key:"getSolo",value:function(){return this.trackNode.solo}},{key:"mix",get:function(){return this.state.sequencer.isRecording&&this.state.sequencer.automationMode===te.b?this.pattern.mix:this.subSequence.mix}},{key:"dispose",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.levelsInterval&&clearInterval(this.levelsInterval),this.sequencerEngine.dispatch(Object(g.Uc)(void 0));var n=[];this.midiEffects.dispose(),t&&(n=this.getAllParameters()).forEach(function(e){return e.isMapped&&e.isMapped.unmap(e)});var r=n.filter(function(e){return e.automations&&e.automations.length>0});this.sequencerEngine.store.dispatch(Object(g.c)(r)),k.releaseTrack({gainNode:this.gainNode,volumeNode:this.volumeNode,muteableNode:this.muteableNode,trackNode:this.trackNode,trackMeter:this.trackMeter,faderNode:this.faderNode}),this.sendNodes.forEach(function(e){return k.releaseSend(e)}),this.effectsChains.forEach(function(e){return e.dispose()}),this.isFrozen?this.disposeFreezes():this.getSamplers().filter(function(e){return void 0!==e}).forEach(function(e){return e.dispose()}),this.faderNode=void 0,this.gainNode=void 0,this.muteableNode=void 0,this.trackNode=void 0,this.trackMeter=void 0,this.sendNodes=void 0,this.pattern=void 0,this.patterns.forEach(function(e){return e.dispose()}),this.patterns=void 0,this.soundIds=void 0,this.auditionedSounds=void 0,this.trackData=void 0,this.samplerConnectedToMaster=!1,this.samplers=void 0,this.group=null,this.selectedStep=void 0,this.name=void 0,this.videoId=void 0,this.sample&&this.sample.dispose(!0),this.presetId=void 0,this.samplesStream&&(this.samplesStream.dispose(),this.samplesStream=void 0),t&&n.filter(function(t){return t!==e.volumeParameter}).filter(function(t){return!e.sendNodeVolumeParameters.includes(t)}).forEach(function(e){return e.dispose()}),this.parameters=void 0}},{key:"getTrackType",value:function(){return ee.f}},{key:"addToGroup",value:function(e){this.outputTypeParameter.get()===H.a&&this.muteableNode.connect(e.inputNode),this.group=e}},{key:"disconnectFromGroup",value:function(){this.muteableNode.disconnect(),this.reconnectAll(),this.group=void 0}},{key:"getLoadedSampleIfAny",value:function(e){return this.sequencerEngine.loadedSamples[e]}},{key:"addSound",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n,r){var a,s,o=this,c=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((a=!(c.length>3&&void 0!==c[3])||c[3])&&this.store.dispatch(Object(g.ne)(this.subSequence.id,this.trackNumber,!0)),"string"!==typeof t&&"number"!==typeof t){e.next=23;break}if(s=t,this.soundIds.push(s),void 0===this.getLoadedSampleIfAny(s)){e.next=10;break}t=this.getLoadedSampleIfAny(s),void 0===this.sample&&(this.sample=t),e.next=21;break;case 10:if(t=new b.a(s),void 0===this.sample&&(this.sample=t),e.prev=12,t.getId()===E.a){e.next=16;break}return e.next=16,t.load();case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(12),console.log("error sample ",e.t0);case 21:e.next=35;break;case 23:if(void 0===this.sample&&(this.sample=t),this.sample.isLoaded()||t.getId()===E.a){e.next=34;break}return e.prev=25,e.next=28,this.sample.load();case 28:e.next=34;break;case 30:return e.prev=30,e.t1=e.catch(25),console.log("error in track load"),e.abrupt("return");case 34:this.soundIds.push(t.getId());case 35:if(t.isLoaded()){e.next=37;break}return e.abrupt("return");case 37:this.samples.push(t),r=r||!1,this.loadTrackInfo(r,t,n,a),this.samplesStream=new O.a(t,this.sequencerEngine),setTimeout(function(){o.samplesStream.sounds&&0!==o.samplesStream.sounds.length||window.isNFT||o.samplesStream.search()},300),a&&this.store.dispatch(Object(g.ne)(this.subSequence.id,this.trackNumber,!1)),this.addSoundToBrowsedSamples(t);case 44:case"end":return e.stop()}},e,this,[[12,18],[25,30]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"trackIsLoading",get:function(){return this.sequencerEngine.state.tracks.trackIsLoading[this.subSequence.id]&&this.sequencerEngine.state.tracks.trackIsLoading[this.subSequence.id][this.trackNumber]},set:function(e){this.sequencerEngine.isOffline||this.store.dispatch(Object(g.ne)(this.subSequence.id,this.trackNumber,e))}},{key:"loadTrackInfo",value:function(e,t,n){var r=this,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];void 0===n&&(n={slices:void 0,offset:0,transpose:0,volume:0}),e=e||!0;var i=this;this.store.dispatch(Object(g.Zc)(t.getId(),t.getJson())),e?(this.videoId=t.videoId,this.sample=t,void 0===this.videoId&&"MIDI"!==this.getTrackType()&&(this.name=t.name),this.update()):(this.name=t.name,this.update());var s=n.slices;this.samplers[t.getId()]=new ie.a(this,t,function(e){return r.onNewSampler(i,e)},s,n),this.samplers[t.getId()].init(),this.samplers[t.getId()].sliceFirstOnset(!1),t.addedToProject=!0,a&&this.store.dispatch(Object(g.ne)(this.subSequence.id,this.trackNumber,!1))}},{key:"chainNumber",get:function(){return(this.store.getState().effects.effectsChainToShow[this.subSequence.id]||{})[this.trackNumber]||0}},{key:"effectsChain",get:function(){return this.effectsChains[this.chainNumber]}},{key:"effects",get:function(){return void 0===this.effectsChains[this.chainNumber]?[]:this.effectsChains[this.chainNumber].effects}},{key:"updateEffects",value:function(e){void 0===e&&(e=this.effects),this.effectsChains[this.chainNumber].updateEffects(e)}},{key:"onNewSampler",value:function(e,t){for(var n in this.samplers)if(t===this.samplers[n]&&this.toAudition.indexOf(n)>-1&&this.isWarped()){var r=this.toAudition.indexOf(n);this.toAudition.splice(r,1),t.sliceFirstOnset();break}t.gainNode.connect(this.gainNode),e.switchToPattern(e.currentPattern),e.setVolume(e.getVolume(),!0,!0),e.setPanning(e.getPanning(),void 0,!0)}},{key:"setSends",value:function(e){var t=this;this.sends=e,this.sends.getSends().map(function(e){return t.newSend(e)})}},{key:"setSendVolume",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.sendNodeVolumeParameters[e].set(t,n),this.store.dispatch(Object(g.ve)(this.trackNumber,e,t))}},{key:"setupEffects",value:function(){var e=this.effectsChains[this.chainNumber];e&&e.setupEffects()}},{key:"newSend",value:function(e){var t=k.useSend();this.muteableNode.connect(t),e.connectToTrack(t),this.sendNodes.push(t);var n=new L.c("send volume",t.volume,{defaultValue:-90,prettyName:"Send "+e.name,min:-90,max:0,isDb:!0});this.registerParameter(n),this.sendNodeVolumeParameters.push(n)}},{key:"reconnectAll",value:function(){var e=this;this.sendNodes.forEach(function(t){return e.muteableNode.connect(t)}),this.muteableNode.connect(this.trackMeter)}},{key:"toggleEnabled",value:function(){this.setIsEnabled(!this.isEnabled)}},{key:"setIsEnabled",value:function(e){this.isEnabled=e,this.isEnabled&&this.store.dispatch(Object(g.Le)(!1)),this.store.dispatch(Object(g.me)(this.subSequence.id,this.id,this.isEnabled))}},{key:"getSendNodes",value:function(){return this.sendNodes}},{key:"getSampler",value:function(e){return this.isFrozen?this.frozenColumns[0].frozenSamplers[0]:(e=e||0,void 0!==this.samplers&&void 0!==this.soundIds?this.samplers[this.soundIds[e]]:void 0)}},{key:"getSamplers",value:function(){var e=this;return this.isFrozen?this.frozenColumns.map(function(e){return e.frozenSamplers[e.playing]}).filter(function(e){return void 0!==e}):this.soundIds.map(function(t){return e.samplers[t]})}},{key:"deleteSound",value:function(e){var t=this.soundIds.indexOf(e);t>-1&&(this.soundIds.splice(t,1),delete this.samplers[e],this.soundId=this.soundIds[0])}},{key:"getVolume",value:function(){return this.pattern?this.pattern.volume:0}},{key:"getMuted",value:function(){return!!this.pattern&&this.pattern.isMuted}},{key:"newPattern",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(new Date).getTime(),(t=void 0!==t&&t)?(n=this.pattern.getCopy(),this.patterns.push(n),(new Date).getTime(),this.patterns.length-1,this.getAllPatternLockedParameters().forEach(function(e){return e.newPattern(r.currentPattern,r.patterns.length-1)}),(new Date).getTime(),this.patternLocked&&this.store.dispatch(Object(g.re)(this.subSequence.id,this.trackNumber,this.patterns.length-1,this.patternLocked))):this.patterns.push(new ne.a(this.sequencerEngine,this)),(new Date).getTime();case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"switchToPattern",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.001;this.presetName||this.getName();if(e>=0&&e<this.patterns.length){var n=this.patterns[e],r=n.volume,a=n.muted,i=this.pattern;this.pattern=n,this.currentPattern=e;var s=this.patterns.indexOf(i),o=!this.attributes||void 0!==this.attributes["volume pattern-locked"]&&!this.attributes["volume pattern-locked"]?function(e,t,n,r){var a=e.sequencerEngine,i=a.state,s=e.volumeParameter;if(!e.patterns[t])return e.setVolume(n,!0,!0);var o;e.patterns[t].volume;return i.mix.isRecordingMix?R(i,s)||(o=e.setVolume(n,!0,!0,r)):i.mix.isPlayingMix&&(R(i,s)||s.mixAutomation.hasEventsAfterStep(a.trackStep))||(o=e.setVolume(n,!0,!0,r)),o}(this,s,r,t):{},c=this.mute(a,!0,!0),u=this.getAllPatternLockedParameters(this.patterns.indexOf(i),e),l={},f=new Set;for(var h in u){var p=u[h];if(!f.has(p.id)){f.add(p.id);var d=M(this.sequencerEngine,p,s,t);d&&(l[d.id]=d.value)}}var v=this.setPanning(this.pattern.panning,void 0,!0);return{bulkUpdate:l,panning:{id:this.id,panning:v},volume:{id:this.id,volume:o},mute:{id:this.id,mute:c}}}return{bulkUpdate:{},mute:{},volume:{},panning:{}}}},{key:"getAllParameters",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=[].concat(Object(o.a)(this.parameters),[this.outputTypeParameter]),r=ye(this.stepGroups);try{for(r.s();!(e=r.n()).done;){var a,i=ye(e.value.transformations);try{for(i.s();!(a=i.n()).done;){var s=a.value;n.push(s.thenValue),n.push(s.whenValue)}}catch(u){i.e(u)}finally{i.f()}}}catch(u){r.e(u)}finally{r.f()}for(var c in this.trackData&&(n=[].concat(Object(o.a)(n),Object(o.a)(this.trackData.parameters))),this.effectsChains)n=[].concat(Object(o.a)(n),Object(o.a)(this.effectsChains[c].getAllParameters()));return this.isFrozen&&(n=[].concat(Object(o.a)(n),Object(o.a)(this.frozenColumns.map(function(e){return e.gainParameter})),Object(o.a)(this.frozenColumns.map(function(e){return e.playingParameter})))),t&&(n=[].concat(Object(o.a)(n),Object(o.a)(this.midiEffects.getAllParameters()),Object(o.a)(this.liveEffects.getAllParameters()))),this.getSamplers()[0]&&(n=[].concat(Object(o.a)(n),Object(o.a)(this.getSamplers()[0].parameters))),n=[].concat(Object(o.a)(n),Object(o.a)(n.filter(function(e){return e.depthParameter}).map(function(e){return e.depthParameter})))}},{key:"getAllPatternLockedParameters",value:function(e,t){return this.getAllParameters().filter(function(n){return n.hasPatternLockedValues(e,t)})}},{key:"deletePattern",value:function(e){if(this.patterns.splice(e,1),this.getAllPatternLockedParameters().forEach(function(t){return t.deletePattern(e)}),void 0!==this.store.getState().tracks.trackPatternLocks[this.subSequence.id]){var t=Object(r.a)({},this.store.getState().tracks.trackPatternLocks[this.subSequence.id][this.trackNumber]);this.store.dispatch(Object(g.se)(this.subSequence.id,this.trackNumber,Object(oe.a)(e,t)))}}},{key:"movePatternTo",value:function(e,t){if(e!=t){var n=[];if(e>t?(n=this.patterns.slice(0,t).concat([this.patterns[e]]).concat(this.patterns.slice(t,e)),this.patterns.length>e+1&&(n=n.concat(this.patterns.slice(e+1)))):(n=this.patterns.slice(0,e).concat(this.patterns.slice(e+1,t)).concat([this.patterns[t],this.patterns[e]]),this.patterns.length>t+1&&(n=n.concat(this.patterns.slice(t+1)))),this.patterns=n,this.getAllPatternLockedParameters().forEach(function(n){return n.movePatternTo(e,t)}),this.store.getState().tracks.trackPatternLocks[this.subSequence.id]){var a=Object(r.a)({},this.store.getState().tracks.trackPatternLocks[this.subSequence.id][this.trackNumber]);this.store.dispatch(Object(g.se)(this.subSequence.id,this.trackNumber,Object(oe.b)(e,t,a)))}}}},{key:"getStepAtResolution",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.resolution,n=this.getStepsAtResolution(t);return n[Math.floor(e)%n.length]}},{key:"getStepsAtResolution",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke,t=this.getEasyPattern().pattern;return t.getStepsAtResolution(e).slice(0,t.length(e))}},{key:"getBucketsAtResolution",value:function(e){return this.pattern.getBucketsAtResolution(e)}},{key:"getFillsAtResolution",value:function(e){return this.pattern.getFillsAtResolution(e)}},{key:"getStepDataForStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.getCopy(!1,!1,!0,!0,t),r=n.getPolyphony();for(var a in r){var i=r[a];i.duration=null==i.durationParameter.value?this.trackData.duration:i.duration,i.transpose=null==i.transposeParameter.value?this.trackData.transpose:i.transpose,i.velocity=null==i.velocityParameter.value?this.trackData.velocity:i.velocity,i.start=null==i.startParameter.value?this.trackData.start:i.start,i.chop=null==i.chopParameter.value?this.trackData.chop:i.chop,i.chopDuration=null==i.chopDurationParameter.value?this.trackData.chopDuration:i.chopDuration,i.attack=null==i.attackParameter.value?this.trackData.attack:i.attack,this.getTrackType()!==ee.b?i.release=null==i.releaseParameter.value?this.trackData.release:i.release:i.release=null==i.releaseParameter.value?null:i.release,i.slice=null==i.sliceParameter.value?this.trackData.slice:i.slice,i.panning=i.panningParameter.value,i.pitchAttack=null==i.pitchAttackParameter.value?this.trackData.pitchAttack:i.pitchAttack,i.pitchDecay=null==i.pitchDecayParameter.value?this.trackData.pitchDecay:i.pitchDecay,i.pitchSustain=null==i.pitchSustainParameter.value?this.trackData.pitchSustain:i.pitchSustain,i.pitchRelease=null==i.pitchReleaseParameter.value?this.trackData.pitchRelease:i.pitchRelease,i.monophonic=null==i.monophonicParameter.value?this.trackData.monophonic:i.monophonic,i.reverse=null==i.reverse?this.trackData.reverse:i.reverse,i.palette=null==i.palette?this.trackData.palette:i.palette,i.mutate=null==i.mutateParameter.value?this.trackData.mutate:i.mutate,i.auxEventA=null==i.auxEventA?this.trackData.auxEventA:i.auxEventA,i.auxEventB=null==i.auxEventA?this.trackData.auxEventB:i.auxEventB,i.auxEventC=null==i.auxEventA?this.trackData.auxEventC:i.auxEventC,i.auxEventD=null==i.auxEventA?this.trackData.auxEventD:i.auxEventD,i.effectAutomations=i.effectAutomations}return n}},{key:"getMainSoundId",value:function(){return this.soundIds[0]}},{key:"calculateFills",value:function(){this.pattern.calculateFills(this.trackData)}},{key:"updateStepDuration",value:function(e,t,n){n=n||ke;var r=this.getBucketsAtResolution(n);for(var a in r[e].steps){var i=r[e].getStep(a);i.on&&(i.duration=t)}this.pattern.calculateFills(this.trackData),this.updateSteps()}},{key:"doubleTrackLength",value:function(){var e=this.getEasyPattern().pattern;e.doubleTrackLength(),e.calculateFills(this.trackData),this.updateSteps(!0)}},{key:"length",get:function(){return void 0===this.pattern?16:this.pattern.length()}},{key:"halfTrackLength",value:function(){var e=this.getEasyPattern().pattern;e.halfTrackLength(),e.calculateFills(this.trackData),this.updateSteps(!0)}},{key:"getJson",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.soundIds)return{};for(var t={},n=0;n<this.soundIds.length;n++){var a=this.samplers[this.soundIds[n]];a&&(t[this.soundIds[n]]=a.getJson())}var i=this.store.getState().tracks.trackPatternLocks[this.trackNumber]||{},s=[];for(var o in this.sendNodeVolumeParameters){var c=this.sendNodeVolumeParameters[o],u={volume:c.get()};u=Object(F.b)(u,"volumeParameter",c,!0),s.push(u)}var l=Object(F.b)({},"outputTypeParameter",this.outputTypeParameter);l=Object(F.b)(l,"skipMidiMasterParameter",this.skipMidiMasterParameter);var f=this.instrumentRack?this.instrumentRack.isFrozen:this.isFrozen;return l=Object(F.b)(l,"volumeParameter",this.volumeParameter,!0),this.lfosTrack&&(l.lfos=this.lfosTrack.lfos.map(function(e){return e.getJson()}),l.envelopes=this.envelopesTrack.envelopes.map(function(e){return e.getJson()})),Object(r.a)({},l,{id:this.id,color:this._color,skipMidiMaster:this.skipMidiMasterParameter.get(),outputType:this.outputTypeParameter.get(),annotations:this.annotations.map(function(e){return e.getJson()}),isMuted:this.pattern.isMuted,sends:s,isNewVolume:!0,volume:this.pattern.volume,samplers:t,gated:this.gated,type:this.getTrackType(),patternLocks:i,envelopeConnections:this.connectedEnvelopes.filter(function(e){return e&&e.envelope}).map(function(e){return e.getJson()}),isFrozen:f,isFrozenPlaying:this.isFrozenPlaying,freeze:e?void 0:this.getFreezeJson(),chokes:this.chokes.getJson(),rawVolume:this.volumeNode.volume.value,presetName:this.presetName,stepGroups:this.stepGroups.map(function(e){return Object($.d)(e)})},this.getAuxJson())}},{key:"setPanning",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0!==t){var r=y.a.Master.context.isOffline?y.a.Master.context._currentTime:y.a.Master.context.currentTime;this.gainNode.pan.linearRampToValueAtTime(e,r+t-.001)}else this.gainNode.pan.value=e;return this.gainNode.pan.value=e,this.pattern.panning=e,n||this.store.dispatch(Object(g.qe)(this.id,e)),e}},{key:"getPanning",value:function(){return this.pattern.panning}},{key:"setVolume",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;return t||this.state.mix.isRecordingMix||(this.pattern.volume=e),t||this.state.mix.isRecordingMix||(t=!0),e>6&&(e=Math.max(4,Object(K.b)(e,0,128))),this.volumeParameter.set(e,t,!0,r),n||this.store.dispatch(Object(g.Ae)(this.id,e)),e}},{key:"setRawVolume",value:function(e){this.volumeParameter.set(e,!0,!0),this.pattern.volume=e+15}},{key:"mute",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e=void 0===e||e,this.addEvent(new X.a(this,e),t),this.muted=e,this.muteableNode.mute=e,this.pattern.muted=e,n||this.store.dispatch(Object(g.pe)(this.id,e)),e}},{key:"moveEffectTo",value:function(e,t){this.effectsChains[this.chainNumber].moveEffectTo(e,t)}},{key:"moveMidiEffectTo",value:function(e,t){this.midiEffects.moveEffectTo(e,t)}},{key:"onBPMUpdated",value:function(){this.effectsChains.forEach(function(e){return e.onBPMUpdated()})}},{key:"getEffectNumber",value:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.midiEffects.getEffectNumber(e):this.effectsChains[this.chainNumber].getEffectNumber(e)}},{key:"deleteEffect",value:function(e){this.effectsChains[this.chainNumber].deleteEffect(e)}},{key:"numberOfSlices",value:function(){var e=0;for(var t in this.samplers)this.samplers[t].slices.length>e&&(e=this.samplers[t].slices.length);return e}},{key:"isLoaded",value:function(){return this.soundIds.length>0&&void 0!==this.getSampler(0)&&this.getSampler(0).isLoaded()}},{key:"updateStepData",value:function(e,t,n){var r=ke.transformStepAtResolution(t,n),a=Math.floor(r),i=this.pattern.stepBuckets[a];for(var s in i.steps){if(i.getStep(s).on){i.setStep(s,e,!0),this.pattern.syncBuckets();break}}this.updateSteps()}},{key:"stepSelected",value:function(e){this.selectedStep=e}},{key:"stepUnselected",value:function(e){this.selectedStep=void 0}},{key:"isReversed",value:function(){return this.getSamplers().filter(function(e){return void 0!==e}).some(function(e){return e.isReversed()})}},{key:"reverse",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.getSamplers().forEach(function(t){return t.reverse(e)})}},{key:"addEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0!==this.mix){this.store.getState();!t&&this.isRecordingAutomations()&&this.mix.addEvent(e)}}},{key:"isRecordingAutomations",value:function(){return this.state.sequencer.automationMode===te.b&&this.state.sequencer.isRecording||this.state.mix.isRecordingMix}},{key:"setKeyboardEngine",value:function(e){this.keyboardEngine=e}},{key:"updateSteps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.pattern;if(this.state.arrangement.patternSelected&&((r=this.patterns[this.state.arrangement.patternSelected.patternNumber])||(r=this.pattern)),!this.multiSequencerEngine&&!this.sequencerEngine.context.isOffline)if(this.instrumentRack)this.instrumentRack.updateSteps(e,t);else{t||this.store.dispatch(Object(g.me)(this.subSequence.id,this.id,this.isEnabled));(new Date).getTime();var a=r.getUpdateStepsAction(e,n),i=((new Date).getTime(),void 0);if(this.subSequence.isTrack)for(var s in i={},this.patterns)i[s]=this.patterns[s].getTrackStepsAction();this.store.dispatch(Object(g.u)(a.id,a.steps,a.pianoRollSteps,a.trackFills,a.stepToId,a.pianoRollPositions,a.pianoRollDurations,i,a.groups))}}},{key:"getUpdateStepsAction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine.resolution.isTriplet;return this.pattern.getUpdateStepsAction(e,t)}},{key:"patternSelected",get:function(){return this.state.arrangement.patternSelected}},{key:"getEasyPattern",value:function(){var e=this.patternSelected?this.patterns[this.patternSelected.patternNumber]:this.pattern;return new re.a(e||this.pattern,this.trackData)}},{key:"deleteMidiInput",value:function(e){this.midiInputs.deleteMidiInput(e)}},{key:"addMidiInput",value:function(e){this.midiInputs.addMidiInput(e)}},{key:"getInstrumentType",value:function(){return ee.f}},{key:"state",get:function(){return this.store.getState()}},{key:"dispatch",value:function(e){this.sequencerEngine.dispatch(e)}},{key:"fromJson",value:function(e,t){var n=this;this.cachedPlayhead=void 0,e.id&&(this.sequencerEngine.trackIDExists(e.id,this)||(this.id=e.id,this.sequencerEngine.idToObject[this.id]=this)),void 0!==e.isFrozen&&(this.isFrozen=e.isFrozen),e.freeze&&this.loadFreezeJson(e.freeze),e.outputType&&this.outputTypeParameter.set(e.outputType,void 0,!0),e.color&&(this.color=e.color),e.skipMidiMaster&&this.skipMidiMasterParameter.set(e.skipMidiMaster,void 0,!0),void 0===e.skipMidiMaster&&e.isFrozen&&this.skipMidiMasterParameter.set(!1),e.skipMidiMasterParameter&&Object(F.a)(e,"skipMidiMasterParameter",this.skipMidiMasterParameter),e.stepGroups&&(this.stepGroups=e.stepGroups.map(function(e){return Object($.c)(e,n)})),Object(F.a)(e,"outputTypeParameter",this.outputTypeParameter),void 0!==e.isFrozenPlaying&&(this.isFrozenPlaying=e.isFrozenPlaying),this.frozenJson=e.frozenJson,this.currentPattern=this.getInitialPattern();var a={};if(t||(a=Object(F.a)(e,"volumeParameter",this.volumeParameter)),e.sends)for(var i in e.sends)this.sendNodeVolumeParameters[i]&&(this.sendNodeVolumeParameters[i].set(e.sends[i].volume),a=Object(r.a)({},a,Object(F.a)(e.sends[i],"volumeParameter",this.sendNodeVolumeParameters[i])));this.store.dispatch(Object(g.ub)(a)),this.presetName=e.presetName,e.auxEventATypeParameter&&this.fromAuxJson(e),e.lfos&&this.lfosTrack&&(this.lfosTrack.lfos.map(function(t,n){return t.lfo.fromJson(e.lfos[n])}),this.envelopesTrack.envelopes.map(function(t,n){return t.envelope.fromJson(e.envelopes[n])}))}},{key:"tempo",get:function(){return void 0===this.getSamplers()[0]?void 0:this.getSamplers()[0].tempo}},{key:"warp",value:function(){var e=this.midiEffects.effects.filter(function(e){return"Warp"===e.name})[0];e?this.operationManager.dispatch(Object(A.q)(e,this)):this.operationManager.dispatch(Object(A.b)(new J.a(this),this)),this.getSamplers()[0]&&this.getSamplers()[0].sliceFirstOnset()}},{key:"isWarped",value:function(){return this.midiEffects.effects.filter(function(e){return"Warp"===e.name}).filter(function(e){return e.enabled}).length>0}},{key:"mateWithPreset",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r,a,s,o,c,u=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:.5,r=u.length>2?u[2]:void 0,e.next=4,Oe.getPresetData(t.contentHash);case 4:for(s in(a=e.sent).lfos)this.sequencerEngine.lfos[s].lfo.mateJson(a.lfos[s],n);if(this.instrument.mateJson(a.trackParameters.instrument,n),!r){e.next=14;break}return e.next=10,this.sequencerEngine.getEffectsPreset(a,this);case 10:for(o=e.sent,this.effectsChains[0].mate(o.effectsChains[0],n),c=1;c<o.effectsChains.length;c++)o.effectsChains[c].dispose();o.midiEffects&&this.midiEffects.mate(o.midiEffects,n);case 14:return this.sequencerEngine.update(),e.abrupt("return");case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"extractStems",value:function(){var e=this;return new Promise(function(t){var n=e.sample.audioBuffer,r=[n.getChannelData(0),n.getChannelData(1)];e.sequencerEngine.dispatch(Object(g.bc)("Extracting stems (might take a few)")),new U.a(2).exportToWAV(r,function(){var n=Object(s.a)(i.a.mark(function n(r){var a;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,V.a.addBytesArray(r);case 2:a=n.sent,fetch("/splitStems/"+a,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(){var n=Object(s.a)(i.a.mark(function n(r){var a,s,o,c,u;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=r.drums?e.sample.getCopyWith(r.drums,"drums"):void 0,s=r.vocals?e.sample.getCopyWith(r.vocals,"vocals"):void 0,o=r.bass?e.sample.getCopyWith(r.bass,"bass"):void 0,c=r.other?e.sample.getCopyWith(r.other,"other"):void 0,u=[a,s,o,c].filter(function(e){return void 0!==e}).map(function(e){return e.fetchAudio()}),n.next=7,Promise.all(u);case 7:e.sequencerEngine.dispatch(Object(g.bc)(void 0)),a&&(e.sequencerEngine.addSound(a),e.sequencerEngine.addSampleToSync(a)),s&&(e.sequencerEngine.addSound(s),e.sequencerEngine.addSampleToSync(s)),o&&(e.sequencerEngine.addSound(o),e.sequencerEngine.addSampleToSync(o)),c&&(e.sequencerEngine.addSound(c),e.sequencerEngine.addSampleToSync(c)),t();case 13:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}());case 4:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}())})}},{key:"extractGroove",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r,a,s,o,c,u,l,f,h,p;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSamplers()[0],n=t.onsets,r=t.tempo,a=t.slices[0].startTime,n=n.filter(function(e){return e/1e3>=a}),s=Object(Q.b)(n,r,this.sequencerEngine.bpm),"QmRHeFU644J9LFZoPzd93M4WqF8tyhydDYL2EZWS6dmbF8",e.next=9,this.sequencerEngine.addSound("QmRHeFU644J9LFZoPzd93M4WqF8tyhydDYL2EZWS6dmbF8");case 9:for(u in o=e.sent,c=o.getEasyPattern(),s.steps.forEach(function(e){return c.addStep(o.getNewStep(),e.stepNumber,ke,e.offset,!1,!0)}),s.timings)l=s.timings[u].resolution,f=s.timings[u].odd,h=s.timings[u].even,(p=new G.a(o)).oddOffset=f,p.evenOffset=h,p.resolution=32/l,o.midiEffects.addEffect(p);c.update(!1),o.updateSteps();case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getNewStep",value:function(){var e=new ae.a(this.sequencerEngine,void 0,void 0,this);return e.on=!0,e}},{key:"showEffects",value:function(e){this.store.dispatch(Object(g.Sd)(this.trackNumber,e))}},{key:"isEffectsShowing",value:function(){return this.state.spatial.showEditorBottom===_.a}},{key:"isHidden",value:function(){return this.state.tracks.tracksToHide.indexOf(this)>-1}},{key:"restart",value:function(){}},{key:"onStepEnded",value:function(){}},{key:"onNewStep",value:function(e){this.midiEffects.onNewStep()}},{key:"getInitialPattern",value:function(){if(!this.subSequence.isTrack)return 0}},{key:"scheduleTrackPatternChangeIfAny",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine.trackStep;arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.subSequence.isTrack&&!this.patterns.some(function(e){return e.isRecording})){for(var t in this.patterns){t=parseInt(t);var n=this.patterns[t],r=n.startStep;if(void 0!==r&&(e>=r&&e<r+n.length()))return void(t!==this.currentPattern&&this.switchToPattern(t))}this.currentPattern=void 0,this.pattern=this.patterns[0]}}},{key:"getGuildIds",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sample){e.next=2;break}return e.abrupt("return",[0]);case 2:return e.next=4,fe.a.guildSamples.getGuildIdForSound(this.sample.getId());case 4:return t=e.sent,e.abrupt("return",void 0===t?[0]:[t]);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"makePublicIfNeeded",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getGuildIds();case 2:if(0===e.sent[0]||!this.sample){e.next=8;break}return e.next=6,fe.a.guildSamples.saveSample(this.sample);case 6:t=e.sent,this.replaceSoundId(this.sample.getId(),t);case 8:e.t0=i.a.keys(this.effectsChains);case 9:if((e.t1=e.t0()).done){e.next=15;break}return n=e.t1.value,e.next=13,this.effectsChains[n].makePublicIfNeeded();case 13:e.next=9;break;case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"replaceSoundId",value:function(e,t){var n=this.soundIds.indexOf(e);if(-1!==n){this.soundIds[n]=t;var r=this.samplers[this.sample.getId()];this.samplers[t]=r,this.sample.ipfsHash=t,delete this.samplers[e]}}},{key:"operationManager",get:function(){return this.sequencerEngine.operationManager}},{key:"deleteAtStep",value:function(e){this.pattern.deleteStepNumber(e)}},{key:"isMonophonic",value:function(){return!1}},{key:"getIdentifier",value:function(){var e=this;return this&&this.tracks&&this.tracks[0]&&(e=this.tracks[0].track),e.presetName?e.presetName:void 0!==e.sample&&void 0!==e.sample.getId()?e.sample.getId():e.getName()}},{key:"addRackEffect",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(h.a)(Object(v.a)(n.prototype),"addRackEffect",this)).call.apply(e,[this].concat(r)),this.updateMidiEffectsRedux()}},{key:"updateEffectRedux",value:function(e){this.updateMidiEffectsRedux()}},{key:"updateMidiEffectsRedux",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.effectRack&&this.effectRack.effects;this.effectRack&&this.dispatch(Object(g.oe)(this.id,Object(o.a)(e)))}},{key:"effectRack",get:function(){return this.midiEffects.effects.find(function(e){return"Midi Effect Rack"===e.name})}},{key:"getParameters",value:function(){return[]}},{key:"sendLevels",value:function(e){var t=this;this.levelsInterval&&clearInterval(this.levelsInterval),e&&(this.levelsInterval=setInterval(function(){if(!t.sequencerEngine.isLoading)if(t.sequencerEngine.playing){var e=t.trackMeter.getLevel();t.sendMessage("levels data",e<-80?0:Math.pow((e+80)/86,2))}else t.sendMessage("levels data",.01)},20))}},{key:"saveNewSample",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sample.saveBuffer();case 2:t=this.sample.ipfsHash,n=this.samplers.NOT_UPLOADED_YET,this.soundIds=[t],this.samplers[t]=n;case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"scheduleAnyRecording",value:function(e){}}]),n}(Object(q.a)(Object(S.a)(Object(w.a)(Object(de.a)(function(e){return function(e){Object(p.a)(n,e);var t=pe(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"getKeyMapping",value:function(e){var t=this.sequencerEngine.keyboardEngine;if(t){var n=t.keyMappings;for(var r in n){var a=n[r],i=a.trackNumber,s=a.sliceNumber;if(i===this.trackNumber&&(void 0===e||e==s))return r}}}},{key:"mapToKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.sequencerEngine.keyboardEngine.map(e,this.trackNumber,t)}},{key:"getPadMapping",value:function(){}}]),n}(e)}(function(e){Object(p.a)(n,e);var t=ve(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"color",get:function(){return this._color?this._color:me.getColorForTrack(this)},set:function(e){this._color=e}}]),n}(Object(he.a)(function(){return function e(){Object(u.a)(this,e)}}()))))))));t.a={Track:we,baseResolution:ke,oldDefaultResolution:je}},,function(e,t,n){"use strict";n.d(t,"q",function(){return o}),n.d(t,"p",function(){return u}),n.d(t,"r",function(){return l}),n.d(t,"o",function(){return f}),n.d(t,"l",function(){return h}),n.d(t,"m",function(){return p}),n.d(t,"b",function(){return d}),n.d(t,"a",function(){return v}),n.d(t,"d",function(){return m}),n.d(t,"h",function(){return y}),n.d(t,"e",function(){return b}),n.d(t,"j",function(){return g}),n.d(t,"f",function(){return O}),n.d(t,"g",function(){return k}),n.d(t,"i",function(){return j}),n.d(t,"c",function(){return w}),n.d(t,"k",function(){return x}),n.d(t,"n",function(){return P});var r=n(1),a=n(111);n(613);function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=void 0;return function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];var o,c=[],u=!1,l=0,f=i(t=t.map(function(e){return a.A.apply(void 0,[e].concat(n))}).flat(4));try{for(f.s();!(o=f.n()).done;){var h=o.value,p={};for(var d in h)p[d]=a.A.apply(void 0,[h[d]].concat(n)),"counter"!==d&&r&&r[l]&&r[l][d]&&"object"!==typeof p[d]&&r[l][d]!==p[d]&&(u=!0);c.push(p),l++}}catch(v){f.e(v)}finally{f.f()}return!u&&r?r:(r=c,c)}},c=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a={decide:function(e){return Object(r.a)({},t,{decide:e})},always:function(e){return Object(r.a)({},t,{always:e})},alt:function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return Object(r.a)({},t,{alt:n})},series:function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return Object(r.a)({},t,{series:n})},never:function(e){return Object(r.a)({},t,{never:e})}};return n<=3&&(a.later=function(a){return e(Object(r.a)({},t,{delay:a}),n++)},a.first=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e(Object(r.a)({},t,{firstOffset:a}),n++)},a.last=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e(Object(r.a)({},t,{lastOffset:a}),n++)},a.figure=function(a,i){return e(Object(r.a)({},t,{figureFrom:a,figureTo:i}),n++)},a.every=function(a){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e(Object(r.a)({},t,{every:a,offset:i}),n++)},a.max=function(a){return e(Object(r.a)({},t,{max:a}),n++)},a.skip=function(a){return e(Object(r.a)({},t,{skip:a}),n++)}),a},u=function(){var e={otherwise:!0,every:1,offset:0,counter:0};return Object(r.a)({},e,c(e))},l=function(e){var t={when:e,every:1,offset:0,counter:0};return Object(r.a)({},t,c(t))},f=function(e){var t={before:e,every:1,offset:0,counter:0};return Object(r.a)({},t,c(t))},h=function(e){var t={after:e,every:1,offset:0,counter:0};return Object(r.a)({},t,c(t))},p=function(e,t,n,a,s,o){var c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!t)return[];var u,l=[],f=[],h=[],p=i(t);try{for(p.s();!(u=p.n()).done;){var d=u.value;if(S(e,d)){var v=d.firstOffset,m=d.lastOffset,y=d.delay,b=d.every,g=d.offset,O=(d.max,d.skip,d.figureFrom),k=d.figureTo;if(void 0!==O){if(void 0===k&&O!==a)continue;if(void 0!==k&&(O>a||a>k))continue}if(void 0!==v&&s!==v&&v>=0)continue;if(void 0!==m&&o-s-1!==m&&m>=0)continue;if(c||d.counter++,d.max&&d.counter>d.max)continue;if(void 0!==d.skip&&d.counter<=d.skip)continue;if((d.counter-1)%b!==g)continue;if(h.push(d),d.decide)n()&&(y?f.push(Object(r.a)({delay:y},d.decide)):l.push(d.decide));else if(d.always)y?f.push(Object(r.a)({delay:y},d.always)):Array.isArray(d.always)?d.always.forEach(function(e){return l.push(e)}):l.push(d.always);else if(d.alt){var j=d.alt;y?f.push(Object(r.a)({delay:y},j[(d.counter-1)%j.length])):l.push(j[(d.counter-1)%j.length])}else d.series?d.series.forEach(function(e,t){(Array.isArray(e)?e:[e]).forEach(function(e){0===t?l.push(e):f.push(Object(r.a)({delay:t},e))})}):d.never}}}catch(w){p.e(w)}finally{p.f()}return{actions:l,delayedActions:f,matchedRules:h}},d={type:"any",value:""},v={type:"accent",value:""},m={type:"flam",value:""},y={type:"regular",value:""},b={type:"legato",value:""},g={type:"staccato",value:""},O={type:"pianissimo",value:""},k={type:"piano",value:""},j={type:"rest",value:""},w={type:"double",value:""},x={type:"times",value:""},S=function(e,t){return e.when&&t.when?e.when.type===t.when.type&&e.when.value===t.when.value:e.before&&t.before?e.before.type===t.before.type&&e.before.value===t.before.value:e.after&&t.after?e.after.type===t.after.type&&e.after.value===t.after.value:!(!e.otherwise||!t.otherwise)},P=function(e,t){if(Array.isArray(e))return"regular"===t.type?e[0]:e;switch(e=Object(r.a)({},e),t.type){case"flam":e.flam=!0;break;case"regular":e.staccato=!1,e.transpose=0,e.accent=!1,e.flam=!1,e.piano=!1,e.pianissimo=!1;break;case"staccato":e.staccato=!0,e.transpose=0;break;case"legato":e.legato=!0,e.staccato=!1,e.transpose=0;break;case"accent":e.accent=!0,e.pianissimo=!1,e.piano=!1,e.transpose=0;break;case"rest":e.transpose=null,e.accent=!1;break;case"pianissimo":e.pianissimo=!0,e.accent=!1,e.transpose=0;break;case"piano":e.piano=!0,e.accent=!1,e.transpose=0;break;case"double":null===e.transpose&&(e.transpose=0),e=[e,e];break;case"times":e=new Array(t.value).fill(e)}return e}},,,function(e,t,n){"use strict";n.d(t,"d",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"b",function(){return i}),n.d(t,"a",function(){return s});var r=1,a=2,i=3,s="bang"},function(e,t,n){"use strict";n.d(t,"f",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"d",function(){return i}),n.d(t,"e",function(){return s}),n.d(t,"a",function(){return o}),n.d(t,"g",function(){return c}),n.d(t,"b",function(){return u});var r=1,a=2,i=3,s=4,o=1,c=2,u=3},function(e,t,n){"use strict";n.d(t,"d",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"e",function(){return i}),n.d(t,"a",function(){return s}),n.d(t,"f",function(){return o}),n.d(t,"b",function(){return c});var r="TAG",a="STYLE",i="YEAR",s="COUNTRY",o="YOUTUBE",c="DISCOGS"},,,,function(e,t,n){"use strict";(function(e){n.d(t,"i",function(){return f}),n.d(t,"h",function(){return h}),n.d(t,"f",function(){return p}),n.d(t,"g",function(){return d}),n.d(t,"n",function(){return v}),n.d(t,"b",function(){return m}),n.d(t,"e",function(){return y}),n.d(t,"d",function(){return b}),n.d(t,"l",function(){return g}),n.d(t,"j",function(){return O}),n.d(t,"k",function(){return k}),n.d(t,"a",function(){return j}),n.d(t,"m",function(){return w}),n.d(t,"c",function(){return x});var r=n(4),a=n(5),i=(n(262),n(339)),s=n(158),o=n(186),c=(window.web3,s.a.utils.padLeft("0x0",64)),u=function(){function e(t,n){Object(r.a)(this,e),this.toConversion=t,this.fromConversion=n}return Object(a.a)(e,[{key:"convertTo",value:function(e){return this.toConversion(e)}},{key:"convertFrom",value:function(e){return e===c?null:this.fromConversion(e)}}]),e}();function l(e){var t="";for(var n in e)0!=e.charCodeAt(n)&&(t+=e.charAt(n));return t}var f=new u(function(e){return function(e){var t=o.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}(e)},function(t){return function(t){var n=new e(t.replace(/^0x/,"1220"),"hex");return o.encode(n)}(t)}),h=new u(function(e){return s.a.utils.padLeft(s.a.utils.numberToHex(e),64)},function(e){return s.a.utils.hexToNumber(e)}),p=new u(function(e){return s.a.utils.padLeft(s.a.utils.numberToHex(e),64)},function(e){return l(s.a.utils.toAscii(e))}),d=new u(function(e){return s.a.utils.padLeft(s.a.utils.numberToHex(e),64)},function(e){return s.a.utils.hexToNumber(e)}),v=new u(function(e){return s.a.utils.padLeft(s.a.utils.numberToHex(parseInt(e)),64)},function(e){return s.a.utils.hexToNumber(e)}),m=new u(function(e){return s.a.utils.padRight(s.a.utils.fromAscii(e),64)},function(e){return l(s.a.utils.toAscii(e))}),y=new u(function(e){return s.a.utils.padLeft(s.a.utils.fromAscii(e),64)},function(e){return l(s.a.utils.toAscii(e))}),b=new u(function(e){return s.a.utils.padLeft(s.a.utils.toHex(e),64)},function(e){return function(e){for(var t=0;t<e.length;t++)if("0"!==e.slice(t,t+1))return e.slice(t);return e}(e.slice(2))});var g=new u(function(e){return s.a.utils.padRight(s.a.utils.toHex(e),64)},function(e){return l(s.a.utils.toAscii(e))}),O=new u(function(e){return s.a.utils.padRight(e,64)},function(e){return l(s.a.utils.toAscii(e)).split("").map(function(e){return i.a[e]})}),k=new u(function(e){return s.a.utils.padRight(e,64)},function(e){return i.a[l(s.a.utils.toAscii(e))]}),j=new u(function(e){return s.a.utils.padLeft(e,64)},function(e){return function(e){return"0x"+e.slice(e.length-40)}(e)}),w=new u(function(e){return s.a.utils.padLeft(e[0],64)},function(e){return l(s.a.utils.toAscii(e))}),x=function(e){return new u(function(e){return e},function(t){return t.slice(2,2+64*e)})}}).call(this,n(108).Buffer)},,,,,function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2),u=n(112),l=n(7),f=n.n(l);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var p=function(e){Object(s.a)(n,e);var t=h(n);function n(e,a){var i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;return Object(r.a)(this,n),i=t.call(this,e,new f.a.Signal(0),s,o),a&&i.setAudioParams(a),i}return Object(a.a)(n,[{key:"set",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.04,o=Object(i.a)(Object(c.a)(n.prototype),"set",this).call(this,e,t,r,a,s);return!this._audioParams||!this.keyScaling&&t||this._audioParams.filter(function(e){return e.input}).forEach(function(e){return e.value=0}),o}},{key:"disableKeyScaling",value:function(){this.set(this.get(!0),!0,!0),this.keyScaling=void 0,this._audioParams.filter(function(e){return e.input}).forEach(function(e){return e.value=0})}},{key:"setAudioParams",value:function(e){var t=this;(e=e.filter(function(e){return e})).filter(function(e){return!t._audioParams||!t._audioParams.includes(e)}).forEach(function(e){return t.audioParam.connect(e)}),this._audioParams=e}},{key:"removeAudioParams",value:function(e){var t=this;e.forEach(function(e){return t.removeAudioParam(e)})}},{key:"removeAudioParam",value:function(e){e&&this._audioParams.includes(e)?(this._audioParams=this._audioParams.filter(function(t){return t!==e}),e.input&&this.audioParam&&(this.audioParam.disconnect(e),e.value=0)):console.log("Failed to remove audio param for %s",this.name,e,this._audioParams)}}]),n}(u.c);window.findBadPoly=function(){return window.sequencerEngine.tracks[0].getAllParameters().filter(function(e){return!e.name.includes("Formant")}).filter(function(e){return e._audioParams}).filter(function(e){return e._audioParams.some(function(e){return!e.input||0!==e.value})}).map(function(e){return[e.name,e._audioParams.map(function(e){return e.input&&e.value})]})},t.a=p},function(e,t,n){"use strict";n.d(t,"e",function(){return f}),n.d(t,"f",function(){return h}),n.d(t,"d",function(){return p}),n.d(t,"c",function(){return d}),n.d(t,"a",function(){return v}),n.d(t,"b",function(){return m});n(276);var r=n(278),a=n(249),i=n(151),s=n(612),o=n(207),c=n(111),u=n(142),l=n(147);Object(i.a)("tidal",{pattern:"",cycleLength:"",accentFactor:"",cycleRetrigger:""},"Plays a tidal pattern");var f=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=void 0,i=void 0,s=void 0;return function(){for(var o=arguments.length,f=new Array(o),h=0;h<o;h++)f[h]=arguments[h];var p=f[0],d=f[1],v=f[2],m=f[3];a||(a=m.useTidal());var y=c.A.apply(void 0,[e].concat(f))||[];if(y!==i){if("string"===typeof y){var b=Object(l.g)(e);a.cycleParameter.set(b,!0,!0)}else Array.isArray(y)&&(s&&s===Object(l.e)(y)||a.cycle!==y&&a.cycleParameter.set(y,!0,!0));i=y,s=Object(l.e)(i)}var g=c.A.apply(void 0,[t].concat(f));void 0===g&&(g=32),g!==a.cycleLength&&a.cycleLengthParameter.set(g,!0,!0);var O=c.A.apply(void 0,[n].concat(f));O!==a.accentFactor&&a.accentFactorParameter.set(O,!0,!0);var k=c.A.apply(void 0,[r].concat(f));if(k!==a.cycleRetrigger&&(a.cycleRetrigger=k),p){var j=new u.a(p,v,d);a.input(j)}var w=a.output(v,d,d);return 0===w.length?Object(c.w)(!1):Object(c.J)(Object(c.Q)(w))}},h=function(e){var t=void 0,n=void 0;return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];var s=c.A.apply(void 0,[e].concat(a));return s===t?n:(n=Object(l.g)(s),t=s,n)}},p=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=c.A.apply(void 0,[e].concat(n));return Object(s.a)(Object(l.e)(a)).apply(void 0,n)}},d=function(e,t,n){return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];var s=c.A.apply(void 0,[e].concat(a)),o=c.A.apply(void 0,[t].concat(a)),u=c.A.apply(void 0,[n].concat(a));return"object"===typeof s&&(s=s.value),s?o:u}};Object(i.a)("hand",{handType:""},"Filters triggers generated by tidal by hand (left=false right=true)");var v=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[0];n[1];if(n[3].zObject.sequencerEngine.isSequenceRolling)return Object(c.w)(!0);if(!i)return Object(c.w)(!1);if(i.isDouble)return Object(c.w)(!0);var s=i.hand?1:0,o=Math.round(c.A.apply(void 0,[e].concat(n)));return o===a.a?Object(c.w)(!0):o===a.d?Object(c.w)(!1):Object(c.w)(s===o)}},m=function(e,t,n){return f(d(Object(r.b)(n,!0),y(e),e),Object(o.l)(e,t,n))},y=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=c.A.apply(void 0,[e].concat(n));return a.slice(0,Math.floor(3*a.length/4))}}},,,,,,function(e,t,n){"use strict";(function(e){var r=n(4),a=n(5),i=(n(261),n(7)),s=n.n(i),o=n(122),c=(n(125),function(){function t(e,n){Object(r.a)(this,t),this.onSoundUploaded=n,this.numChannels=e,this.soundIdCounter=0}return Object(a.a)(t,[{key:"exportToWAV",value:function(t,n){new FormData;var r=new Worker(window.isNFT?"recorderWorker.js":"/recorderWorker.js");r.postMessage({command:"init",config:{sampleRate:s.a.context.sampleRate,numChannels:this.numChannels}}),r.onmessage=function(t){var r,a=t.data,i=new FileReader;i.onload=function(){r=this.result,n(new e(r))},i.readAsArrayBuffer(a)},r.postMessage({command:"record",buffer:t}),r.postMessage({command:"exportWAV",type:"audio/wav"})}},{key:"uploadBufferToIpfs",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;return new Promise(function(i,c){new FormData;var u=t,l=new Worker(window.isNFT?"recorderWorker.js":"/recorderWorker.js");l.postMessage({command:"init",config:{sampleRate:s.a.context.sampleRate,numChannels:t.numChannels}});new Date;if(l.onmessage=function(e){var t=this,s=e.data;o.a.addBlob(s,a).then(function(e){n&&u.onSoundUploaded(t.soundIdCounter++,e,r),i(e)})},n)l.postMessage({command:"record",buffer:e});else{for(var f=[],h=0;h<e.numberOfChannels;h++)f.push(e.getChannelData(h));l.postMessage({command:"record",buffer:f})}l.postMessage({command:"exportWAV",type:"audio/wav"})})}},{key:"uploadVideoBlob",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=(new FormData,this),u=new Worker(window.isNFT?"recorderWorker.js":"/recorderWorker.js");u.postMessage({command:"init",config:{sampleRate:s.a.context.sampleRate,numChannels:this.numChannels}});new Date;u.onmessage=function(e){var t=e.data;o.a.addBlob(t).then(function(e){i?c.onSoundUploaded(void 0,e,a):c.onSoundUploaded(a,e,a)})},u.postMessage({command:"record",buffer:e}),u.postMessage({command:"exportWAV",type:"audio/wav"})}}]),t}());t.a=c}).call(this,n(108).Buffer)},function(e,t,n){"use strict";n.d(t,"e",function(){return r}),n.d(t,"f",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"b",function(){return s}),n.d(t,"d",function(){return o}),n.d(t,"c",function(){return c});Math.sqrt;var r=function(e){if(0===e.length)return{x:0,y:0,diameter:1};var t=new Uint32Array(e.map(function(e){var t=e.x;e.y;return isNaN(t)?0:t})),n=new Uint32Array(e.map(function(e){e.x;var t=e.y;return isNaN(t)?0:t})),r=window.api.create_geometry_buffer(e.length),a=window.api.create_geometry_buffer(e.length),i=window.api.create_geometry_buffer(3);window.Module.HEAP32.set(t,r/t.BYTES_PER_ELEMENT),window.Module.HEAP32.set(n,a/n.BYTES_PER_ELEMENT),window.api.getGeometry(r,a,e.length,i);var s=new Uint32Array(window.Module.HEAP32.buffer,i,3),o=s[0],c=s[1],u=s[2];return window.api.destroy_buffer(i),window.api.destroy_buffer(r),window.api.destroy_buffer(a),{x:o,y:c,diameter:u}},a=function(e){if(0===e.length)return{x:0,y:0,diameter:1};var t=e;if(e.some(function(e){return isNaN(e)}))return{x:0,y:0,diameter:1};var n=window.api.create_geometry_buffer(e.length),r=window.api.create_geometry_buffer(3);window.Module.HEAPF32.set(t,n/t.BYTES_PER_ELEMENT),window.api.getGeometryFlat(n,e.length,r);var a=new Uint32Array(window.Module.HEAP32.buffer,r,3),i=a[0],s=a[1],o=a[2];return window.api.destroy_buffer(r),window.api.destroy_buffer(n),{x:i,y:s,diameter:o}},i=function(e){return r(e)},s=function(e){return r(e).diameter},o=function(){return function(e){var t=Object.keys(e).map(function(t){return e[t]}).filter(function(e){return e});return 0===t.length?0:s(t)}},c=function(){return function(e){var t=Object.keys(e).map(function(t){return e[t]}).filter(function(e){return e});return 0===t.length?0:i(t)}}},,,,,,function(e,t,n){"use strict";function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;return Math.random()<e}function a(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;if(void 0!==n&&r(i)){var s=t+"Parameter";s in n?(a.disconnectFromAllModulators(),a.fromJson(n[s],e),a.set(n[t])):t in n&&a.set(n[t])}}n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a})},function(e,t,n){"use strict";n.d(t,"i",function(){return r}),n.d(t,"f",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"e",function(){return s}),n.d(t,"a",function(){return o}),n.d(t,"b",function(){return c}),n.d(t,"k",function(){return u}),n.d(t,"h",function(){return l}),n.d(t,"d",function(){return f}),n.d(t,"j",function(){return h}),n.d(t,"g",function(){return p}),n.d(t,"t",function(){return d}),n.d(t,"q",function(){return v}),n.d(t,"n",function(){return m}),n.d(t,"p",function(){return y}),n.d(t,"l",function(){return b}),n.d(t,"m",function(){return g}),n.d(t,"v",function(){return O}),n.d(t,"s",function(){return k}),n.d(t,"o",function(){return j}),n.d(t,"u",function(){return w}),n.d(t,"r",function(){return x});var r=1,a=2,i=3,s=4,o=7,c=8,u=9,l=10,f=11,h=12,p=13,d=function(e){return{type:r,zobject:e}},v=function(e){return{type:a,zmessage:e}},m=function(e,t){return{type:i,inlet:e,isInstanceInlet:t}},y=function(e){return{type:s,outlet:e}},b=function(e,t,n,r){return{type:o,sourceType:n,destType:r,destNode:t,sourceNode:e}},g=function(e,t,n,r){return{type:c,sourceType:n,destType:r,destNode:t,sourceNode:e}},O=function(e,t){return{type:u,zobject:e,text:t}},k=function(e,t){return{type:l,zmessage:e,text:t}},j=function(e){return{type:f,inletNumber:e}},w=function(e){return{type:h,zobject:e}},x=function(e){return{type:p,zmessage:e}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"d",function(){return s}),n.d(t,"b",function(){return o}),n.d(t,"f",function(){return c}),n.d(t,"e",function(){return u}),n.d(t,"c",function(){return l});var r=n(111),a=n(151);Object(a.a)("alt",{arg1:"",arg2:"",argN:""},"Alternates between the arguments with every trigger received by this function");var i=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=0;return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var s=n[0];n[1],n[2];if(void 0===s)return Object(r.w)(!1);var o=t;if(1===t.length){var c=r.A.apply(void 0,[t[0]].concat(n));Array.isArray(c)&&(o=c)}var u=a++%o.length;return r.A.apply(void 0,[Object(r.J)(o[u])].concat(n))}},s=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=0,i=void 0,s=void 0;return function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];var c=n[0],u=n[1];n[2];if(s===u)return i;if(s=u,void 0===c)return void 0===i?t[0]:i;var l=t;if(1===t.length){var f=r.A.apply(void 0,[t[0]].concat(n));Array.isArray(f)&&(l=f)}var h=a++%l.length;return i=r.A.apply(void 0,[Object(r.J)(l[h])].concat(n))}};Object(a.a)("altn",{n:"How many triggers it takes to increment the output conditional",arg1:"Output conditional",arg2:"Output conditional",argN:"Output conditional (will loop back to arg1 after this this)"},"Alternates between the arguments every n-many triggers received by this function");var o=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var i=0,s=0;return function(t,a,o,c){var u="number"===typeof e?e:e();if(++i%u===0&&s++,void 0===t)return Object(r.w)(!1);var l=n[s%n.length];return Object(r.A)(l,t,a,o,c)}},c=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var i=0,s=0;return function(t,a,o,c){var u="number"===typeof e?e:e();++i%u===0&&s++;var l=n[s%n.length];return Object(r.A)(l,t,a,o,c)}},u=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=0;return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n[0],n[1],n[2];if(1===t.length){var s=r.A.apply(void 0,[t[0]].concat(n));Array.isArray(s)&&(t=s)}var o=a++%t.length;return r.A.apply(void 0,[Object(r.J)(t[o])].concat(n))}};Object(a.a)("every",{n:"",action:""},"Trigger a given action every n-many triggers");var l=function(e,t,n){var a=0;return function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];var c=r.A.apply(void 0,[e].concat(s));if(s[0]&&++a%c===0)return r.A.apply(void 0,[t].concat(s));return n?r.A.apply(void 0,[n].concat(s)):Object(r.w)(!0)}}},function(e,t,n){"use strict";n.d(t,"o",function(){return l}),n.d(t,"p",function(){return f}),n.d(t,"k",function(){return h}),n.d(t,"b",function(){return p}),n.d(t,"c",function(){return d}),n.d(t,"a",function(){return v}),n.d(t,"d",function(){return m}),n.d(t,"t",function(){return y}),n.d(t,"q",function(){return b}),n.d(t,"g",function(){return g}),n.d(t,"h",function(){return O}),n.d(t,"i",function(){return k}),n.d(t,"m",function(){return j}),n.d(t,"f",function(){return w}),n.d(t,"r",function(){return x}),n.d(t,"u",function(){return S}),n.d(t,"n",function(){return P}),n.d(t,"v",function(){return E}),n.d(t,"e",function(){return T}),n.d(t,"s",function(){return A}),n.d(t,"j",function(){return M}),n.d(t,"l",function(){return R}),n.d(t,"w",function(){return C});var r=n(107),a=n(1),i=n(11),s=n(111),o=(n(248),n(314),n(191));function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=function(e,t,n){return function(){for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];var u=s.A.apply(void 0,[t].concat(o)),l=Object(i.a)(s.A.apply(void 0,[e].concat(o))),f=s.A.apply(void 0,[n].concat(o))(l[u]);return f=Array.isArray(f)?Object(i.a)(f):Object(a.a)({},f),l[u]=f,l}},f=function(e,t,n){return function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];var c=s.A.apply(void 0,[t].concat(i)),u=s.A.apply(void 0,[e].concat(i));if(n){var l=Object(a.a)({},s.A.apply(void 0,[n].concat(i)));return l.operator=u,l.operand=c,l}return function(e){return e.operator=u,e.operand=c,e}}},h=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=s.A.apply(void 0,[e].concat(r)),o=s.A.apply(void 0,[t].concat(r)),u=i.flat(16);return function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!Array.isArray(t))return{p:t,count:r};var a,i=c(t);try{for(i.s();!(a=i.n()).done;){var s=a.value,o=e(s,n,r);if(o.count===n&&o.p)return o;Array.isArray(s)?r=o.count:r++}}catch(u){i.e(u)}finally{i.f()}return{count:r}}(i,o%u.length).p}},p=function(e){return!Array.isArray(e)},d=function(e){return null===e.transpose},v=function(e){return e.accent},m=function(e){return e.staccato},y=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var c=void 0;return function(){for(var t=arguments.length,i=new Array(t),u=0;u<t;u++)i[u]=arguments[u];var l=s.A.apply(void 0,[e].concat(i));return void 0===l?c:c=function e(t){var c=n.map(function(e){var t=Object(r.a)(e,2),n=t[0],a=t[1];return[s.A.apply(void 0,[n].concat(i)),s.A.apply(void 0,[a].concat(i))]});if(p(t)){var u=c.find(function(e){var n=Object(r.a)(e,2),a=n[0];return n[1],a===t.transpose});if(u){var l=u[1];return Array.isArray(l)?l:"string"===typeof l?Object(o.f)(l).apply(void 0,i):Object(a.a)({},t,{transpose:l})}return t}return t.map(function(t){return e(t)})}(l)}},b=function(e,t,n){return function(){for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];var l=s.A.apply(void 0,[e].concat(a)),f=Object(i.a)(l[0]),h=s.A.apply(void 0,[t].concat(a)).map(function(e){return s.A.apply(void 0,[e].concat(a))}),p=s.A.apply(void 0,[n].concat(a));Array.isArray(p)||(p=null===p?Object(o.f)("~").apply(void 0,a):Object(o.f)(p).apply(void 0,a));var d,v=c(h);try{for(v.s();!(d=v.n()).done;){f[d.value%f.length]=p}}catch(m){v.e(m)}finally{v.f()}return[f]}},g=function(e,t,n){return function(){for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];var u=s.A.apply(void 0,[e].concat(a));u=Object(i.a)(u[0]);var l=s.A.apply(void 0,[n].concat(a)),f=s.A.apply(void 0,[t].concat(a));return Array.isArray(l)?u.splice(f,0,l):u.splice(f,0,Object(o.f)(new String(l))()),[u]}},O=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var c=s.A.apply(void 0,[e].concat(r));c=Object(i.a)(c[0]);var u=n.map(function(e){return s.A.apply(void 0,[e].concat(r))}),l=u.length;return[c.flatMap(function(e,t){return[e,Array.isArray(u[t%l])?u[t%l]:Object(o.f)(new String(u[t%l]))()]})]}},k=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var c=s.A.apply(void 0,[e].concat(r));c=Object(i.a)(c[0]);var u=n.map(function(e){return s.A.apply(void 0,[e].concat(r))}),l=u.length;return[c.flatMap(function(e,t){return[Array.isArray(u[t%l])?u[t%l]:Object(o.f)(new String(u[t%l]))(),e]})]}},j=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var o=s.A.apply(void 0,[e].concat(r));return[(o=Object(i.a)(o[0])).map(function(e,n){return s.A.apply(void 0,[t(e,n)].concat(r))})]}},w=function(e,t,n){return function(){for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];var u=s.A.apply(void 0,[e].concat(a));u=Object(i.a)(u[0]);var l=s.A.apply(void 0,[n].concat(a)),f=s.A.apply(void 0,[t].concat(a))%u.length,h=u[f];return Array.isArray(h)||(h=[h]),Array.isArray(l)||(l=Object(o.f)(new String(l))()),u[f]=[].concat(Object(i.a)(h),[l]),[u]}},x=function(e,t,n){return function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];var c=s.A.apply(void 0,[e].concat(a));c=Object(i.a)(c[0]);var u=s.A.apply(void 0,[t].concat(a)),l=s.A.apply(void 0,[n].concat(a));return c.splice(u,l),[c]}},S=function(e,t,n){return function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];var c=s.A.apply(void 0,[e].concat(a));c=Object(i.a)(c[0]);var u=s.A.apply(void 0,[t].concat(a)),l=s.A.apply(void 0,[n(c[u])].concat(a));return c[u]=l,[c]}},P=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var o=s.A.apply(void 0,[e].concat(r));Array.isArray(o)||(o=[o]);for(var c=s.A.apply(void 0,[t].concat(r)),u=[],l=0;l<c;l++)u=[].concat(Object(i.a)(u),Object(i.a)(o));return[u]}},E=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0;return function(){for(var o=arguments.length,u=new Array(o),l=0;l<o;l++)u[l]=arguments[l];var f=s.A.apply(void 0,[e].concat(u)),h=function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;if(!Array.isArray(t))return i===r?{pattern:s.A.apply(void 0,[n(t,o,l)].concat(u)),count:i}:{pattern:t,count:i};var f,h=[],p=0,d=c(t);try{for(d.s();!(f=d.n()).done;){var v=f.value,m=e(v,r,i,t,p++);h.push(m.pattern),Array.isArray(v)?i=m.count:a&&null!==v.transpose&&i++}}catch(y){d.e(y)}finally{d.f()}return{pattern:h,count:i}}(f=!r&&Array.isArray(f[0])?Object(i.a)(f[0]):Object(i.a)(f),s.A.apply(void 0,[t].concat(u)));return r?h.pattern:[h.pattern]}},T=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return Object(a.a)({},s.A.apply(void 0,[e].concat(r)),{accent:s.A.apply(void 0,[t].concat(r))})}},A=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return Object(a.a)({},s.A.apply(void 0,[e].concat(r)),{staccato:s.A.apply(void 0,[t].concat(r))})}},M=function(e,t){var n,r,a;return function(){for(var i=arguments.length,u=new Array(i),l=0;l<i;l++)u[l]=arguments[l];var f=s.A.apply(void 0,[e].concat(u)),h=s.A.apply(void 0,[t].concat(u));if(r===f&&h===a)return n;r=f,a=h;return n=[function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(p(t))return n.includes(r)?{pattern:t,count:r}:{pattern:Object(o.f)("~")(),count:r};var a,i=[],s=c(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,l=e(u,n,r);p(u)?r++:r=l.count,i.push(l.pattern)}}catch(f){s.e(f)}finally{s.f()}return{count:r,pattern:i}}(f,h).pattern]}},R=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];for(var o=s.A.apply(void 0,[t].concat(a)),c=s.A.apply(void 0,[e].concat(a)),u=0,l=0;l<c.length;l++){var f=c[l];f.cycleLength?u+=f.cycleLength:u++}return s.A.apply(void 0,[n].concat(a)),2*o*u}},C=function(e,t){var n,r,a;return function(){for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];var u=s.A.apply(void 0,[t].concat(o)),l=s.A.apply(void 0,[e].concat(o));if(0===u)return l;if(u===r&&n===l)return a;r=u,n=l;for(var f=void 0,h=0,p=l.length-1;p>=0;p--){var d=l[p];if(Array.isArray(d)&&(d=d[0]),f!==d.figureId&&(f=d.figureId,p!==l.length-1&&h++,h===u))break}var v=0;for(v=0;v<l.length&&l[v].lastFigure===f;v++);var m=l.slice(v,p+1);return a=m}}},,,,,,,function(e,t,n){"use strict";var r=n(11),a=n(42),i=n.n(a),s=n(56),o=n(4),c=n(5),u=(n(118),n(158)),l=n(185),f="undefined"!==typeof window.web3,h=function(){function e(t){Object(o.a)(this,e),this.address=t,this.distinct=!1,this.selectStatements=[],this.whereClauses=[],this.groupBy=[],this.joinClauses=[],this.limitSize=void 0,this.fromBlockNumber="0x2",this.toBlockNumber=void 0}return Object(c.a)(e,[{key:"from",value:function(e){return this.eventLog=e,this}},{key:"select",value:function(e){return this.selectStatements.push(e),this}},{key:"distinct",value:function(){return this.distinct=!0,this}},{key:"groupBy",value:function(e){return this.groupBy.push(e),this}},{key:"where",value:function(e,t){return this.whereClauses.push(new p(e,t)),this}},{key:"whereIn",value:function(e,t){return this.whereClauses.push(new p(e,void 0,t)),this}},{key:"join",value:function(e,t){this.joinClauses.push(new d(e,t))}},{key:"fromBlock",value:function(e){return this.fromBlockNumber=u.a.utils.toHex(e),this}},{key:"toBlock",value:function(e){return this.toBlockNumber=u.a.utils.toHex(e),this}},{key:"limit",value:function(e){return this.limitSize=e,this}},{key:"getTopics",value:function(){var e=[u.a.utils.sha3(this.eventLog.event)];for(var t in this.eventLog.topics){var n=this.eventLog.topics[parseInt(t)],r=null;for(var a in this.whereClauses){var i=this.whereClauses[parseInt(a)];if(i.name===n.name){var s=void 0!==i.value?i.value:i.valueList[0];r=n.convertTo(s)}}e.push(r)}return e}},{key:"executeQuery",value:function(){var e=this;return new Promise(function(t,n){u.a.eth.getPastLogs({address:e.address,topics:e.getTopics(),toBlock:e.toBlockNumber,fromBlock:e.fromBlockNumber},function(r,a){if(r)n(r);else{var i=[];a.reverse();for(var s=Math.min(a.length,e.limitSize||a.length),o=0;o<s;o++)i.push(e.parseResult(a[o]));t(i)}})})}},{key:"watchQuery",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 3:n=e.sent,(f?u.a:u.b).eth.subscribe("logs",{address:this.address,topics:this.getTopics(),fromBlock:u.a.utils.toHex(n)},function(e,n){e&&(console.log("error watching "),console.log(e));var a=r.parseResult(n);console.log("watch query got "),console.log(a),t(a)});case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"parseResult",value:function(e){if(void 0!==e&&null!==e){var t={};for(var n in this.selectStatements){var r=this.selectStatements[parseInt(n)];for(var a in this.eventLog.topics){var i=e.topics[1+parseInt(a)],s=this.eventLog.topics[parseInt(a)];s.name===r&&(t[r]=s.type.convertFrom(i))}var o=0;for(var c in this.eventLog.data){c=parseInt(c);var u=this.eventLog.data[c];if(void 0!==u&&r==u.name){var f=e.data.slice(2+o,2+o+u.size);f="0x"+f,u.type==l.m&&(f="0x"+e.data.slice(130+64*c)),t[r]=u.convertFrom(f)}o+=u.size}}return t.blockNumber=e.blockNumber,t}}},{key:"getCopy",value:function(){var t=new e(this.address);return t.eventLog=this.eventLog,t.selectStatements=Object(r.a)(this.selectStatements),t.joinClauses=Object(r.a)(this.joinClauses),t.groupBy=Object(r.a)(this.groupBy),t.fromBlockNumber=this.fromBlockNumber,t.toBlockNumber=this.toBlockNumber,t.limitSize=this.limitSize,t}},{key:"getJson",value:function(){return{address:this.address,eventLog:this.eventLog.event,selectStatements:Object(r.a)(this.selectStatements),whereClauses:Object(r.a)(this.whereClauses),joinClauses:Object(r.a)(this.joinClauses),groupBy:Object(r.a)(this.groupBy),fromBlockNumber:u.a.utils.hexToNumber(this.fromBlockNumber),toBlockNumber:void 0===this.toBlockNumber?void 0:u.a.utils.hexToNumber(this.toBlockNumber),limitSize:this.limitSize,distinct:this.distinct}}}]),e}(),p=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Object(o.a)(this,e),this.name=t,this.value=n,this.valueList=r},d=function e(t,n){Object(o.a)(this,e),this.event=t,this.field=n};t.a=h},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(4),a=n(5),i=new(function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,[{key:"setItem",value:function(e,t){if(!window.isNFT)return window.localStorage.setItem(e,t)}},{key:"removeItem",value:function(e){window.isNFT||window.localStorage.removeItem(e)}},{key:"getItem",value:function(e){return window.isNFT?null:window.localStorage.getItem(e)}}]),e}())},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){var t,n=0;if(!e||0===e.length)return n;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n}},function(e,t,n){"use strict";n.d(t,"b",function(){return q}),n.d(t,"a",function(){return I});var r=n(116),a=n(845),i=(n(846),n(847)),s=n(926),o=n(844),c=(n(848),n(849),n(850),n(851)),u=n(852),l=n(854),f=n(927),h=n(540),p=n(269),d=n(345),v=n(856),m=n(857),y=n(858),b=n(859),g=n(860),O=n(861),k=(n(862),n(863),n(864),n(352)),j=n(123),w=n(541),x=n(865),S=n(542),P=n(868),E=n(869),T=n(870),A=n(928),M=n(871),R=n(872),C=n(873),N=n(874),q={Filter:function(e){return new r.a.FilterEffect(e)},"Faust WaveFolder":function(e){return new A.a(e)},"Wave Folder":function(e){return new T.a(e)},Delay:function(e){return new p.a(e)},Reverb:function(e){return new r.a.ReverbEffect(e)},"Convolver Reverb":function(e){return new d.a(e)},Chorus:function(e){return new r.a.ChorusEffect(e)},"Multiband Compressor":function(e){return new f.a(e)},Distortion:function(e){return new b.a(e)},Compressor:function(e){return new y.a(e)},"Bit Crusher":function(e){return new m.a(e)},"Ultra Phaser":function(e){return new h.a(e)},"Pitch Shift":function(e){return new g.a(e)},Panner:function(e){return new O.a(e)},Gain:function(e){return new a.a(e)},EQ8:function(e){return new k.a(e)},Chebyshev:function(e){return new v.a(e)},"Stereo Widener":function(e){return new c.a(e)},"Tape Delay":function(e){return new x.a(e)},Saturator:function(e){return new w.a(e)},"Stereo Delay":function(e){return new P.a(e)},Oscilloscope:function(e){return new l.a(e)},"Effect Rack":function(e){return new S.a(e)},"Multi Filter":function(e){return new o.a(e)},"Freak Shifter":function(e){return new s.a(e)},"Guitar Amp":function(e){return new E.a(e)},"Ring Modulator":function(e){return new u.a(e)},Vocoder:function(e){return new M.a(e)},Follower:function(e){return new R.a(e)},"Frequency Shifter":function(e){return new C.a(e)},"Transient Shaper":function(e){return new N.a(e)},"Soft Clipper":function(e){return new i.a(e)}};function I(e,t,n,r,i){if(!e)return{effect:new a.a(n),bulk:{}};var s=e.name,o=q[s](n);if(void 0!==r){var c=(new j.a).forTrack(t[r]);o.registerContext(c)}else i&&o.registerContext(i);var u=o.fromJson(e,t,r);return{effect:o,bulk:u}}},function(e,t,n){"use strict";var r=n(116),a=n(844),i=n(928),s=n(845),o=n(42),c=n.n(o),u=n(56),l=n(4),f=n(5),h=n(10),p=n(6),d=n(8),v=n(2),m=n(167),y=n(119),b=n(7),g=n.n(b),O=n(32),k=n(31),j=n(570);function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var a=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(d.a)(this,n)}}"undefined"===typeof AudioWorkletNode&&alert("AudioWorklet is not supported in this browser !");var x=function(e){Object(p.a)(n,e);var t=w(n);function n(e,r,a){var i;Object(l.a)(this,n),(i=t.call(this,e,"whetstone",a)).baseURL=r,i.json=a.processorOptions.json,i.json_object=JSON.parse(i.json),i.parse_ui=function(e,t){for(var n=0;n<e.length;n++)this.parse_group(e[n],t)},i.parse_group=function(e,t){e.items&&this.parse_items(e.items,t)},i.parse_items=function(e,t){for(var n=0;n<e.length;n++)this.parse_item(e[n],t)},i.parse_item=function(e,t){if("vgroup"===e.type||"hgroup"===e.type||"tgroup"===e.type)this.parse_items(e.items,t);else if("hbargraph"===e.type||"vbargraph"===e.type)t.outputs_items.push(e.address);else if("vslider"===e.type||"hslider"===e.type||"button"===e.type||"checkbox"===e.type||"nentry"===e.type){if(t.inputs_items.push(e.address),t.descriptor.push(e),void 0!==e.meta)for(var n=0;n<e.meta.length;n++)void 0!==e.meta[n].midi&&("pitchwheel"===e.meta[n].midi.trim()?t.fPitchwheelLabel.push({path:e.address,min:parseFloat(e.min),max:parseFloat(e.max)}):"ctrl"===e.meta[n].midi.trim().split(" ")[0]&&t.fCtrlLabel[parseInt(e.meta[n].midi.trim().split(" ")[1])].push({path:e.address,min:parseFloat(e.min),max:parseFloat(e.max)}));var r="set"+e.address,a="get"+e.address;r=r.replace(/\/./g,function(e){return e.substr(1,1).toUpperCase()}),a=a.replace(/\/./g,function(e){return e.substr(1,1).toUpperCase()}),t[r]=function(n){t.setParamValue(e.address,n)},t[a]=function(){return t.getParamValue(e.address)}}},i.output_handler=null,i.inputs_items=[],i.outputs_items=[],i.descriptor=[],i.fPitchwheelLabel=[],i.fCtrlLabel=new Array(128);for(var s=0;s<i.fCtrlLabel.length;s++)i.fCtrlLabel[s]=[];i.parse_ui(i.json_object.ui,Object(k.a)(i)),i.port.onmessage=i.handleMessage.bind(Object(k.a)(i));try{i.parameters&&i.parameters.forEach(function(e){return e.automationRate="k-rate"})}catch(o){}return i}return Object(f.a)(n,[{key:"handleMessage",value:function(e){var t=e.data;this.output_handler&&this.output_handler(t.path,t.value)}},{key:"destroy",value:function(){this.port.postMessage({type:"destroy"}),this.port.close()}},{key:"getJSON",value:function(){return this.json}},{key:"getMetadata",value:function(){var e=Object(u.a)(c.a.mark(function e(){var t=this;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){var n=""===t.baseURL?"main.json":t.baseURL+"/main.json";fetch(n).then(function(e){return e.json()}).then(function(t){e(t)})}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"setParamValue",value:function(e,t){this.parameters.get(e).setValueAtTime(t,0)}},{key:"setParam",value:function(e,t){this.parameters.get(e).setValueAtTime(t,0)}},{key:"getParamValue",value:function(e){return this.parameters.get(e).value}},{key:"getParam",value:function(e){return this.parameters.get(e).value}},{key:"setOutputParamHandler",value:function(e){this.output_handler=e}},{key:"getOutputParamHandler",value:function(){return this.output_handler}},{key:"getNumInputs",value:function(){return parseInt(this.json_object.inputs)}},{key:"getNumOutputs",value:function(){return parseInt(this.json_object.outputs)}},{key:"inputChannelCount",value:function(){return parseInt(this.json_object.inputs)}},{key:"outputChannelCount",value:function(){return parseInt(this.json_object.outputs)}},{key:"getParams",value:function(){return this.inputs_items}},{key:"getDescriptor",value:function(){var e={};for(var t in this.descriptor)this.descriptor.hasOwnProperty(t)&&"bypass"!=this.descriptor[t].label&&(e=Object.assign(Object(O.a)({},this.descriptor[t].label,{minValue:this.descriptor[t].min,maxValue:this.descriptor[t].max,defaultValue:this.descriptor[t].init}),e));return e}},{key:"ctrlChange",value:function(e,t,r){if(this.fCtrlLabel[t]!==[])for(var a=0;a<this.fCtrlLabel[t].length;a++){var i=this.fCtrlLabel[t][a].path;this.setParamValue(i,n.remap(r,0,127,this.fCtrlLabel[t][a].min,this.fCtrlLabel[t][a].max)),this.output_handler&&this.output_handler(i,this.getParamValue(i))}}},{key:"pitchWheel",value:function(e,t){for(var r=0;r<this.fPitchwheelLabel.length;r++){var a=this.fPitchwheelLabel[r];this.setParamValue(a.path,n.remap(t,0,16383,a.min,a.max)),this.output_handler&&this.output_handler(a.path,this.getParamValue(a.path))}}},{key:"midiMessage",value:function(e){var t=e[0]>>4,n=15&e[0],r=e[1],a=e[2];9!==n&&(11===t?this.ctrlChange(n,r,a):14===t&&this.pitchWheel(n,128*a+r))}},{key:"onMidi",value:function(e){}},{key:"getState",value:function(){var e=Object(u.a)(c.a.mark(function e(){var t,n;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=new Object,n=0;n<this.getParams().length;n++)Object.assign(t,Object(O.a)({},this.getParams()[n],"".concat(this.getParam(this.getParams()[n]))));return e.abrupt("return",new Promise(function(e){e(t)}));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setState",value:function(){var e=Object(u.a)(c.a.mark(function e(t){var n=this;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){for(var r in t)t.hasOwnProperty(r)&&n.setParam(r,t[r]);try{n.gui.setAttribute("state",JSON.stringify(t))}catch(a){console.warn("Plugin without gui or GUI not defined",a)}e(t)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"setPatch",value:function(e){this.setState(this.presets[e])}}],[{key:"remap",value:function(e,t,n,r,a){return 1*(e-t)/(n-t)*(a-r)+r}}]),n}(Object(j.a)(AudioWorkletNode)),S=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Object(l.a)(this,e),console.log("baseLatency "+t.baseLatency),console.log("outputLatency "+t.outputLatency),console.log("sampleRate "+t.sampleRate),this.context=t,this.baseURL=n,this.pathTable=[],this.fWorkletProcessors=this.fWorkletProcessors||[]}return Object(f.a)(e,[{key:"heap2Str",value:function(e){for(var t="",n=0;0!==e[n];)t+=String.fromCharCode(e[n++]);return t}},{key:"load",value:function(){var e=Object(u.a)(c.a.mark(function e(){var t,n,r,a,i,s,o,u,l,f,h,p,d;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={env:{memoryBase:0,tableBase:0,_abs:Math.abs,_acosf:Math.acos,_asinf:Math.asin,_atanf:Math.atan,_atan2f:Math.atan2,_ceilf:Math.ceil,_cosf:Math.cos,_expf:Math.exp,_floorf:Math.floor,_fmodf:function(e,t){return e%t},_logf:Math.log,_log10f:Math.log10,_max_f:Math.max,_min_f:Math.min,_remainderf:function(e,t){return e-Math.round(e/t)*t},_powf:Math.pow,_roundf:Math.fround,_sinf:Math.sin,_sqrtf:Math.sqrt,_tanf:Math.tan,_acoshf:Math.acosh,_asinhf:Math.asinh,_atanhf:Math.atanh,_coshf:Math.cosh,_sinhf:Math.sinh,_tanhf:Math.tanh,_isnanf:Number.isNaN,_isinff:function(e){return!isFinite(e)},_copysignf:function(e,t){return Math.sign(e)===Math.sign(t)?e:-e},_acos:Math.acos,_asin:Math.asin,_atan:Math.atan,_atan2:Math.atan2,_ceil:Math.ceil,_cos:Math.cos,_exp:Math.exp,_floor:Math.floor,_fmod:function(e,t){return e%t},_log:Math.log,_log10:Math.log10,_max_:Math.max,_min_:Math.min,_remainder:function(e,t){return e-Math.round(e/t)*t},_pow:Math.pow,_round:Math.fround,_sin:Math.sin,_sqrt:Math.sqrt,_tan:Math.tan,_acosh:Math.acosh,_asinh:Math.asinh,_atanh:Math.atanh,_cosh:Math.cosh,_sinh:Math.sinh,_tanh:Math.tanh,_isnan:Number.isNaN,_isinf:function(e){return!isFinite(e)},_copysign:function(e,t){return Math.sign(e)===Math.sign(t)?e:-e},table:new WebAssembly.Table({initial:0,element:"anyfunc"})}},n=""===this.baseURL?"whetstone.wasm":this.baseURL+"/whetstone.wasm",e.next=5,fetch(n);case 5:return r=e.sent,e.next=8,r.arrayBuffer();case 8:return a=e.sent,e.next=11,WebAssembly.compile(a);case 11:return i=e.sent,e.next=14,WebAssembly.instantiate(i,t);case 14:if(s=e.sent,o=new Uint8Array(s.exports.memory.buffer),u=this.heap2Str(o),l=JSON.parse(u),f={wasm_module:i,json:u},-1!==this.fWorkletProcessors.indexOf("whetstone")){e.next=35;break}return e.prev=20,h=/JSON_STR/g,p=P.replace(h,u),d=window.URL.createObjectURL(new Blob([p],{type:"text/javascript"})),e.next=26,this.context.audioWorklet.addModule(d);case 26:console.log("Keep the DSP name"),this.fWorkletProcessors.push("whetstone"),e.next=35;break;case 30:return e.prev=30,e.t0=e.catch(20),console.error(e.t0),console.error("Faust "+this.name+" cannot be loaded or compiled"),e.abrupt("return",null);case 35:return this.node=new x(this.context,this.baseURL,{numberOfInputs:parseInt(l.inputs)>0?1:0,numberOfOutputs:parseInt(l.outputs)>0?1:0,channelCount:Math.max(1,parseInt(l.inputs)),outputChannelCount:[parseInt(l.outputs)],channelCountMode:"explicit",channelInterpretation:"speakers",processorOptions:f}),this.node.onprocessorerror=function(){console.log("An error from whetstone-processor was detected.")},e.abrupt("return",this.node);case 40:return e.prev=40,e.t1=e.catch(0),console.error(e.t1),console.error("Faust "+this.name+" cannot be loaded or compiled"),e.abrupt("return",null);case 45:case"end":return e.stop()}},e,this,[[0,40],[20,30]])}));return function(){return e.apply(this,arguments)}}()},{key:"loadGui",value:function(){var e=Object(u.a)(c.a.mark(function e(){var t=this;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){try{var r=""===t.baseURL?"main.html":t.baseURL+"/main.html";if(!t.linkExists(r)){var a=document.createElement("link");a.rel="import",a.href=r,document.head.appendChild(a),a.onload=function(e){}}}catch(i){console.log(i),n(i)}}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"linkExists",value:function(e){return document.querySelectorAll('link[href="'.concat(e,'"]')).length>0}}]),e}(),P='\n\n    \'use strict\';\n\n    // Monophonic Faust DSP\n    class whetstoneProcessor extends AudioWorkletProcessor {\n        \n        // JSON parsing functions\n        static parse_ui(ui, obj, callback)\n        {\n            for (var i = 0; i < ui.length; i++) {\n                whetstoneProcessor.parse_group(ui[i], obj, callback);\n            }\n        }\n        \n        static parse_group(group, obj, callback)\n        {\n            if (group.items) {\n                whetstoneProcessor.parse_items(group.items, obj, callback);\n            }\n        }\n        \n        static parse_items(items, obj, callback)\n        {\n            for (var i = 0; i < items.length; i++) {\n                callback(items[i], obj, callback);\n            }\n        }\n        \n        static parse_item1(item, obj, callback)\n        {\n            if (item.type === "vgroup"\n                || item.type === "hgroup"\n                || item.type === "tgroup") {\n                whetstoneProcessor.parse_items(item.items, obj, callback);\n            } else if (item.type === "hbargraph"\n                       || item.type === "vbargraph") {\n                // Nothing\n            } else if (item.type === "vslider"\n                       || item.type === "hslider"\n                       || item.type === "button"\n                       || item.type === "checkbox"\n                       || item.type === "nentry") {\n                obj.push({ name: item.address,\n                         defaultValue: item.init,\n                         minValue: item.min,\n                         maxValue: item.max });\n            }\n        }\n        \n        static parse_item2(item, obj, callback)\n        {\n            if (item.type === "vgroup"\n                || item.type === "hgroup"\n                || item.type === "tgroup") {\n                whetstoneProcessor.parse_items(item.items, obj, callback);\n            } else if (item.type === "hbargraph"\n                       || item.type === "vbargraph") {\n                // Keep bargraph adresses\n                obj.outputs_items.push(item.address);\n                obj.pathTable[item.address] = parseInt(item.index);\n            } else if (item.type === "vslider"\n                       || item.type === "hslider"\n                       || item.type === "button"\n                       || item.type === "checkbox"\n                       || item.type === "nentry") {\n                // Keep inputs adresses\n                obj.inputs_items.push(item.address);\n                obj.pathTable[item.address] = parseInt(item.index);\n            }\n        }\n     \n        static get parameterDescriptors() \n        {\n            // Analyse JSON to generate AudioParam parameters\n            var params = [];\n            whetstoneProcessor.parse_ui(JSON.parse(`JSON_STR`).ui, params, whetstoneProcessor.parse_item1);\n            return params;\n        }\n       \n        constructor(options)\n        {\n            super(options);\n            this.running = true;\n            \n            const importObject = {\n                    env: {\n                        memoryBase: 0,\n                        tableBase: 0,\n\n                        // Integer version\n                        _abs: Math.abs,\n\n                        // Float version\n                        _acosf: Math.acos,\n                        _asinf: Math.asin,\n                        _atanf: Math.atan,\n                        _atan2f: Math.atan2,\n                        _ceilf: Math.ceil,\n                        _cosf: Math.cos,\n                        _expf: Math.exp,\n                        _floorf: Math.floor,\n                        _fmodf: function(x, y) { return x % y; },\n                        _logf: Math.log,\n                        _log10f: Math.log10,\n                        _max_f: Math.max,\n                        _min_f: Math.min,\n                        _remainderf: function(x, y) { return x - Math.round(x/y) * y; },\n                        _powf: Math.pow,\n                        _roundf: Math.fround,\n                        _sinf: Math.sin,\n                        _sqrtf: Math.sqrt,\n                        _tanf: Math.tan,\n                        _acoshf: Math.acosh,\n                        _asinhf: Math.asinh,\n                        _atanhf: Math.atanh,\n                        _coshf: Math.cosh,\n                        _sinhf: Math.sinh,\n                        _tanhf: Math.tanh,\n\n                        // Double version\n                        _acos: Math.acos,\n                        _asin: Math.asin,\n                        _atan: Math.atan,\n                        _atan2: Math.atan2,\n                        _ceil: Math.ceil,\n                        _cos: Math.cos,\n                        _exp: Math.exp,\n                        _floor: Math.floor,\n                        _fmod: function(x, y) { return x % y; },\n                        _log: Math.log,\n                        _log10: Math.log10,\n                        _max_: Math.max,\n                        _min_: Math.min,\n                        _remainder:function(x, y) { return x - Math.round(x/y) * y; },\n                        _pow: Math.pow,\n                        _round: Math.fround,\n                        _sin: Math.sin,\n                        _sqrt: Math.sqrt,\n                        _tan: Math.tan,\n                        _acosh: Math.acosh,\n                        _asinh: Math.asinh,\n                        _atanh: Math.atanh,\n                        _cosh: Math.cosh,\n                        _sinh: Math.sinh,\n                        _tanh: Math.tanh,\n\n                        table: new WebAssembly.Table({ initial: 0, element: \'anyfunc\' })\n                    }\n            };\n            \n            this.whetstone_instance = new WebAssembly.Instance(options.processorOptions.wasm_module, importObject);\n            this.json_object = JSON.parse(options.processorOptions.json);\n         \n            this.output_handler = function(path, value) { this.port.postMessage({ path: path, value: value }); };\n            \n            this.ins = null;\n            this.outs = null;\n\n            this.dspInChannnels = [];\n            this.dspOutChannnels = [];\n\n            this.numIn = parseInt(this.json_object.inputs);\n            this.numOut = parseInt(this.json_object.outputs);\n\n            // Memory allocator\n            this.ptr_size = 4;\n            this.sample_size = 4;\n            this.integer_size = 4;\n            \n            this.factory = this.whetstone_instance.exports;\n            this.HEAP = this.whetstone_instance.exports.memory.buffer;\n            this.HEAP32 = new Int32Array(this.HEAP);\n            this.HEAPF32 = new Float32Array(this.HEAP);\n\n            // Warning: keeps a ref on HEAP in Chrome and prevent proper GC\n            //console.log(this.HEAP);\n            //console.log(this.HEAP32);\n            //console.log(this.HEAPF32);\n\n            // bargraph\n            this.outputs_timer = 5;\n            this.outputs_items = [];\n\n            // input items\n            this.inputs_items = [];\n        \n            // Start of HEAP index\n\n            // DSP is placed first with index 0. Audio buffer start at the end of DSP.\n            this.audio_heap_ptr = parseInt(this.json_object.size);\n\n            // Setup pointers offset\n            this.audio_heap_ptr_inputs = this.audio_heap_ptr;\n            this.audio_heap_ptr_outputs = this.audio_heap_ptr_inputs + (this.numIn * this.ptr_size);\n\n            // Setup buffer offset\n            this.audio_heap_inputs = this.audio_heap_ptr_outputs + (this.numOut * this.ptr_size);\n            this.audio_heap_outputs = this.audio_heap_inputs + (this.numIn * NUM_FRAMES * this.sample_size);\n            \n            // Start of DSP memory : DSP is placed first with index 0\n            this.dsp = 0;\n\n            this.pathTable = [];\n         \n            // Send output values to the AudioNode\n            this.update_outputs = function ()\n            {\n                if (this.outputs_items.length > 0 && this.output_handler && this.outputs_timer-- === 0) {\n                    this.outputs_timer = 5;\n                    for (var i = 0; i < this.outputs_items.length; i++) {\n                        this.output_handler(this.outputs_items[i], this.HEAPF32[this.pathTable[this.outputs_items[i]] >> 2]);\n                    }\n                }\n            }\n            \n            this.initAux = function ()\n            {\n                var i;\n                \n                if (this.numIn > 0) {\n                    this.ins = this.audio_heap_ptr_inputs;\n                    for (i = 0; i < this.numIn; i++) {\n                        this.HEAP32[(this.ins >> 2) + i] = this.audio_heap_inputs + ((NUM_FRAMES * this.sample_size) * i);\n                    }\n                    \n                    // Prepare Ins buffer tables\n                    var dspInChans = this.HEAP32.subarray(this.ins >> 2, (this.ins + this.numIn * this.ptr_size) >> 2);\n                    for (i = 0; i < this.numIn; i++) {\n                        this.dspInChannnels[i] = this.HEAPF32.subarray(dspInChans[i] >> 2, (dspInChans[i] + NUM_FRAMES * this.sample_size) >> 2);\n                    }\n                }\n                \n                if (this.numOut > 0) {\n                    this.outs = this.audio_heap_ptr_outputs;\n                    for (i = 0; i < this.numOut; i++) {\n                        this.HEAP32[(this.outs >> 2) + i] = this.audio_heap_outputs + ((NUM_FRAMES * this.sample_size) * i);\n                    }\n                    \n                    // Prepare Out buffer tables\n                    var dspOutChans = this.HEAP32.subarray(this.outs >> 2, (this.outs + this.numOut * this.ptr_size) >> 2);\n                    for (i = 0; i < this.numOut; i++) {\n                        this.dspOutChannnels[i] = this.HEAPF32.subarray(dspOutChans[i] >> 2, (dspOutChans[i] + NUM_FRAMES * this.sample_size) >> 2);\n                    }\n                }\n                \n                // Parse UI\n                whetstoneProcessor.parse_ui(this.json_object.ui, this, whetstoneProcessor.parse_item2);\n                \n                // Init DSP\n                this.factory.init(this.dsp, sampleRate); // \'sampleRate\' is defined in AudioWorkletGlobalScope  \n            }\n\n            this.setParamValue = function (path, val)\n            {\n                this.HEAPF32[this.pathTable[path] >> 2] = val;\n            }\n\n            this.getParamValue = function (path)\n            {\n                return this.HEAPF32[this.pathTable[path] >> 2];\n            }\n\n            // Init resulting DSP\n            this.initAux();\n        }\n        \n        process(inputs, outputs, parameters) \n        {\n            var input = inputs[0];\n            var output = outputs[0];\n            \n            // Check inputs\n            if (this.numIn > 0 && (!input || !input[0] || input[0].length === 0)) {\n                //console.log("Process input error");\n                return true;\n            }\n            // Check outputs\n            if (this.numOut > 0 && (!output || !output[0] || output[0].length === 0)) {\n                //console.log("Process output error");\n                return true;\n            }\n            \n            // Copy inputs\n            if (input !== undefined) {\n                for (var chan = 0; chan < Math.min(this.numIn, input.length); ++chan) {\n                    var dspInput = this.dspInChannnels[chan];\n                    dspInput.set(input[chan]);\n                }\n            }\n            \n            /*\n            TODO: sample accurate control change is not yet handled\n            When no automation occurs, params[i][1] has a length of 1,\n            otherwise params[i][1] has a length of NUM_FRAMES with possible control change each sample\n            */\n            \n            // Update controls\n            for (const path in parameters) {\n                const paramArray = parameters[path];\n                this.setParamValue(path, paramArray[0]);\n            }\n        \n          \t// Compute\n            try {\n                this.factory.compute(this.dsp, NUM_FRAMES, this.ins, this.outs);\n            } catch(e) {\n                console.log("ERROR in compute (" + e + ")");\n            }\n            \n            // Update bargraph\n            this.update_outputs();\n            \n            // Copy outputs\n            if (output !== undefined) {\n                for (var chan = 0; chan < Math.min(this.numOut, output.length); ++chan) {\n                    var dspOutput = this.dspOutChannnels[chan];\n                    output[chan].set(dspOutput);\n                }\n            }\n            \n            return this.running;\n    \t}\n        \n        handleMessage(event)\n        {\n            var msg = event.data;\n            switch (msg.type) {\n                case "destroy": this.running = false; break;\n            }\n        }\n    }\n\n    // Globals\n    const NUM_FRAMES = 128;\n    try {\n        registerProcessor(\'whetstone\', whetstoneProcessor);\n    } catch (error) {\n        console.warn(error);\n    }\n',E=S,T=n(14);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var a=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(d.a)(this,n)}}var M=function(e){Object(p.a)(n,e);var t=A(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,"Faust Reverb",function(){return new g.a.Gain(1)},e,!0)).outputNode=new g.a.Gain(1),r.faustParameters=[],r.loadedValue=1,r.initializeWorklets(),r.updateInitialValues(),r}return Object(f.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"initializeWorklets",value:function(){var e=Object(u.a)(c.a.mark(function e(){var t=this;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.sequencerEngine.isOffline?this.effectNode.connect(this.outputNode):(this.plugin=new E(g.a.Master.context._context,"."),this.plugin.load().then(function(e){console.log("LOADED reverb",e),t.effectNode.connect(e),t.faustNode=e,e.parameters.forEach(function(e){console.log("X PARAMETR=",e);var n=new T.a("fuck",t,function(t,n){return e.value=n},{min:e.minValue,max:e.maxValue,defaultValue:e.minValue});t.faustParameters.push(n),t.registerParameter(n)}),e.connect(t.outputNode)})),this.updateInitialValues();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getJson",value:function(e){var t=Object(h.a)(Object(v.a)(n.prototype),"getJson",this).call(this);return t.fold=this.foldParameter.get(),t}},{key:"fromJson",value:function(e,t){var r=Object(h.a)(Object(v.a)(n.prototype),"fromJson",this).call(this,e,t);if(e.amount){this.loadedValue=e.fold;var a=this.foldParameter.set(e.amount,!1,!1),i=a.id,s=a.value;r[i]=s}return r}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(r.a.Effect),R=n(847),C=n(846),N=n(926),q=n(848),I=n(872),_=n(1),D=n(521),F=n(112);n(344);function L(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return B(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var a=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(d.a)(this,n)}}new Float32Array(65536);var J=function(e){Object(p.a)(n,e);var t=z(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,"Genetic WaveShaper",function(){return new g.a.Gain(1)},e)).counter=0,r.waveShaperNode=new g.a.WaveShaper([-1,1]),r.effectNode.connect(r.waveShaperNode),r.postGain=new g.a.Gain(1),r.waveShaperNode.connect(r.postGain),r.overSampleParameter=new T.a("oversample",Object(k.a)(r),function(e,t){return r.waveShaperNode.oversample=t?"4x":"none"},{min:.01,max:32,unit:"",defaultValue:!1,constantAutomationRate:!0}),r.driveParameter=new F.a("drive",r.effectNode.gain,function(e,t){r.effectNode.gain.value=t,r.postGain.gain.value=Math.pow(1/t,.6)},{documention:"Controls the level of saturation.",min:.01,max:32,unit:"",defaultValue:1,constantAutomationRate:!0}),r.registerParameter(r.driveParameter),r.recomputeCurve(),r}return Object(f.a)(n,[{key:"stages",get:function(){return 6}},{key:"smoothness",get:function(){return 6}},{key:"recomputeCurve",value:function(){var e=Math.pow(2,this.smoothness+1)*(2*this.stages+1)+1;console.log("points = ",e);for(var t=new Float32Array(e),n=0;n<e;n++){var r=(2*this.stages+1)*Math.PI*(n/(e-1)-.5);t[n]=Math.sin(r)}this.waveShaperNode.curve=t}},{key:"documentation",get:function(){return"Saturates the sound, making it more distorted."}},{key:"dispose",value:function(){Object(h.a)(Object(v.a)(n.prototype),"dispose",this).call(this),this.postGain.dispose(),this.waveShaperNode.dispose()}},{key:"connect",value:function(e){this.postGain.connect(e)}},{key:"disconnect",value:function(e){this.postGain.disconnect(e)}},{key:"getJson",value:function(){var e=Object(_.a)({},Object(h.a)(Object(v.a)(n.prototype),"getJson",this).call(this),{drive:this.driveParameter.get()});return e=this.saveParameterToJson(e,"driveParameter",this.driveParameter)}},{key:"fromJson",value:function(e,t){var r=Object(h.a)(Object(v.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(y.a)(this.driveParameter,e.drive,r),Object(_.a)({},r,this.loadParameterFromJson(e,"driveParameter",this.driveParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"generateVariation",value:function(e,t){console.log("generate dregree=",t);var n,r=[],a=L(this.waveShaperNode.curve);try{for(a.s();!(n=a.n()).done;){var i=n.value,s=Math.min(1,i+t*Math.random());Math.random()<t&&(s=0),r.push(s)}}catch(o){a.e(o)}finally{a.f()}return Float32Array.from(r)}},{key:"breed",value:function(e,t){for(var n=[],r=0;r<this.waveShaperNode.curve.length;r++){Math.random()<.6?n.push(e[r]):n.push(t[r])}return Float32Array.from(n)}},{key:"selectVariation",value:function(e,t,n){var r=this.variations[e];console.log("selected variation = ",r),this.waveShaperNode.curve=r,this.selectedVariation=e}},{key:"firstReproduction",value:function(){this.variations=this.generateVariations(this.waveShaperNode.curve)}},{key:"getBestCopy",value:function(){return this.bestSolutions}}]),n}(Object(D.a)(r.a.Effect)),V=n(871),H=n(540),U=n(567),G=n(852),W=(n(268),n(345)),K=n(927),Q=n(854),Z=n(269),Y=n(851),X=n(352),$=n(306),ee=n(589),te=n(803),ne=(n(850),n(858)),re=n(859),ae=n(849),ie=n(857),se=n(862),oe=n(874),ce=n(597),ue=n(863),le=n(864),fe=n(860),he=n(861),pe=n(418),de=n(856),ve=n(541),me=n(865),ye=n(868),be=n(542),ge=n(869),Oe=n(870);function ke(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var a=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(d.a)(this,n)}}r.a.Effect;var je=n(873),we=n(601),xe=n(429),Se=n(600),Pe=n(423),Ee=n(424),Te=n(593),Ae=n(426),Me=n(591),Re=n(427),Ce=(n(544),n(875),n(359)),Ne=n(923),qe=n(276),Ie=n(598),_e=n(599),De=n(604),Fe=n(609),Le=n(812),Be=n(808),ze=n(809),Je=n(602),Ve=n(603),He=n(568),Ue=n(610),Ge=n(605),We=n(606),Ke=n(607),Qe=n(608),Ze=n(810),Ye=n(596),Xe=n(807),$e=n(811),et=n(588),tt=n(813),nt=n(573),rt=n(915),at=n(925),it=n(924),st=n(585),ot=n(587),ct=n(522);n.d(t,"a",function(){return ut}),n.d(t,"b",function(){return lt}),n.d(t,"e",function(){return ft}),n.d(t,"d",function(){return ht}),n.d(t,"c",function(){return pt});var ut=[{value:"Bit Crusher",label:"Bit Crusher"},{value:"Chorus",label:"Chorus"},{value:"Compressor",label:"Compressor"},{value:"Convolver Reverb",label:"Convolver Reverb"},{value:"Delay",label:"Delay"},{value:"Distortion",label:"Distortion"},{value:"Effect Rack",label:"Effect Rack"},{value:"EQ8",label:"EQ 8"},{value:"Filter",label:"Filter"},{value:"Freak Shifter",label:"Freak Shifter"},{value:"Frequency Shifter",label:"Frequency Shifter"},{value:"Faust WaveFolder",label:"FWaveFolder"},{value:"Faust Reverb",label:"FReverb"},{value:"Gain",label:"Gain"},{value:"Guitar Amp",label:"Guitar Amp"},{value:"Multi Filter",label:"Multi Filter"},{value:"Oscilloscope",label:"Oscilloscope"},{value:"Panner",label:"Panner"},{value:"Pitch Shift",label:"Pitch Shift"},{value:"Phaser",label:"Phaser"},{value:"Saturator",label:"Saturator"},{value:"Soft Clipper",label:"Soft Clipper"},{value:"Tape Delay",label:"Tape Delay"},{value:"Transient Shaper",label:"Transient Shaper"},{value:"Wave Folder",label:"Wave Folder"}];function lt(e,t){var n=null;return"Filter"===e?n=new r.a.FilterEffect(t):"Reverb"===e?n=new r.a.ReverbEffect(t):"Convolver Reverb"===e?n=new W.a(t):"Delay"===e?n=new Z.a(t):"Faust Reverb"===e?n=new M(t):"Chorus"===e?n=new r.a.ChorusEffect(t):"Faust WaveFolder"===e?n=new i.a(t):"Gain"===e?n=new s.a(t):"Genetic WaveShaper"===e?n=new J(t):"Tremolo"===e?n=new r.a.TremoloEffect(t):"Auto Filter"===e?n=new r.a.AutoFilterEffect(t):"Compressor"===e?n=new ne.a(t):"Multi Filter"===e?n=new a.a(t):"Multiband Compressor"===e?n=new K.a(t):"Distortion"===e?n=new re.a(t):"Bit Crusher"===e?n=new ie.a(t):"Guitar Amp"===e?n=new ge.a(t):"Granular"===e?n=new ae.a(t):"EQ 3"===e||("EQ 3"===e?n=new se.a(t):"EQ 10"===e?n=new ue.a(t):"Freak Shifter"===e?n=new N.a(t):"Phaser"===e?n=new H.a(t):"Auto Wah"===e?n=new q.a(t):"Gate"===e?n=new le.a(t):"Pitch Shift"===e?n=new fe.a(t):"Panner"===e?n=new he.a(t):"EQ8"===e?n=new X.a(t):"Chebyshev"===e?n=new de.a(t):"Stereo Widener"===e?n=new Y.a(t):"Saturator"===e?n=new ve.a(t):"Soft Clipper"===e?n=new R.a(t):"Tape Delay"===e?n=new me.a(t):"Stereo Delay"===e?n=new ye.a(t):"Oscilloscope"===e?n=new Q.a(t):"Effect Rack"===e?n=new be.a(t):"Wave Folder"===e?n=new Oe.a(t):"Granulator"===e?n=new C.a(t):"Ring Modulator"===e?n=new G.a(t):"Follower"===e?n=new I.a(t):"Vocoder"===e?n=new V.a(t):"Frequency Shifter"===e?n=new je.a(t):"Transient Shaper"===e&&(n=new oe.a(t))),n.toggle(),n}var ft=[{value:"Accumulator Effect",label:"Accumulator Effect"},{value:"Arpeggiator",label:"Arpeggiator"},{value:"Chord Rhythm",label:"Chord Rhythm"},{value:"Conditional Parameters",label:"Conditional Parameters"},{value:"Control Parameters",label:"Control Parameters"},{value:"Midi Delay",label:"Delay"},{value:"Every",label:"Every"},{value:"Gate",label:"Gate"},{value:"Generative Chords",label:"Generative Chords"},{value:"Grab",label:"Grab"},{value:"Grab Time",label:"Grab Time"},{value:"Harmony",label:"Harmony"},{value:"Jaki",label:"Jaki"},{value:"Linked Tidal",label:"Linked Tidal"},{value:"Midi CC",label:"Midi CC"},{value:"Midi Effect Rack",label:"Midi Effect Rack"},{value:"Note Display",label:"Note Display"},{value:"Plane Parameters",label:"Plane Parameters"},{value:"Parametizer",label:"Parametizer"},{value:"Scale",label:"Scale"},{value:"User Script",label:"Script"},{value:"Sparse",label:"Sparse"},{value:"Stats",label:"Stats"},{value:"Tidal",label:"Tidal"},{value:"Timing",label:"Timing"},{value:"Warp",label:"Warp"}],ht=[{value:"Alternate",label:"Alternate"},{value:"Alternate N",label:"Alternate N"},{value:"Limit",label:"Limit"},{value:"Midi Outputter",label:"Midi Outputter"},{value:"Pattern Switch",label:"Pattern Switch"},{value:"Roll",label:"Rolling"}];var pt=function(e,t){var n=null;return"Arpeggiator"===e?n=new pe.a(t):"Parametizer"===e?n=new Pe.a(t):"Harmony"===e?n=new xe.a(t):"Every"===e?n=new Se.a(t):"Timing"===e?n=new Ee.a(t):"Midi Outputter"===e?n=new Ne.a(t):"Midi Interface"===e?n=new Re.a(t):"Alternate Tuning"===e?n=new ce.a(t):"Warp"===e?n=new $.a(t):"Midi Delay"===e?n=new Te.a(t):"Chord Rhythm"===e?n=new Ae.a(t):"Chord Sculptor"===e?n=new Me.a(t):"Tidal"===e?n=new qe.a(t):"Flush"===e?n=new st.a(t):"Message"===e?n=new ot.a(t):"Midi Effect Rack"===e?n=new Ce.a(t):"Limit"===e?n=new _e.a(t):"Beat Repeat"===e?n=new De.a(t):"Steps"===e?n=new Je.a(t):"Notes"===e?n=new Ve.a(t):"User Script"===e?n=new He.a(t):"Grab"===e?n=new Ge.a(t):"Gate"===e?n=new Le.a(t):"Roll"===e?n=new $e.a(t):"Grab Time"===e?n=new We.a(t):"Alternate"===e?n=new Ke.a(t):"Alternate N"===e?n=new Qe.a(t):"Density"===e?n=new Ze.a(t):"Threshold"===e?n=new Ue.a(t):"Midi CC"===e?n=new we.a(t):"Accumulator Effect"===e?n=new ee.a(t):"Control Parameters"===e?n=new te.a(t):"Conditional Parameters"===e?n=new it.a(t):"Plane Parameters"===e?n=new U.a(t):"Micro Tuning"===e?n=new Ye.a(t):"Scale"===e?n=new Xe.a(t):"Beat"===e?n=new Fe.a(t):"Pattern Switch"===e?n=new Be.a(t):"Poly"===e?n=new ze.a(t):"Linked Tidal"===e?n=new Ie.a(t):"Note Display"===e?n=new et.a(t):"Sparse"===e?n=new tt.a(t):"Stats"===e?n=new at.a(t):"Jaki"===e?n=new nt.a(t):"Accent"===e?n=new ct.a(t):"Regular"===e?n=new ct.r(t):"Staccato"===e?n=new ct.u(t):"Rest"===e?n=new ct.s(t):"Piano"===e?n=new ct.p(t):"Pianissimo"===e?n=new ct.o(t):"Dot"===e?n=new ct.e(t):"Dash 1"===e?n=new ct.c(t):"Dash 2"===e?n=new ct.d(t):"Max"===e?n=new ct.m(t):"Figure"===e?n=new ct.g(t):"First"===e?n=new ct.h(t):"R.Every"===e?n=new ct.q(t):"Last"===e?n=new ct.j(t):"Legato"===e?n=new ct.l(t):"Double"===e?n=new ct.f(t):"Later"===e?n=new ct.k(t):"Skip"===e?n=new ct.t(t):"Generative Chords"===e&&(n=new rt.a(t)),n}},,,,,,,,,function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(6),u=n(8),l=n(2),f=n(125),h=n(153),p=n(158),d=n(792);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var m=function(e){Object(c.a)(n,e);var t=v(n);function n(e,r,a,i){var o;return Object(s.a)(this,n),(o=t.call(this)).name=e,o.contentHash=r,o.user=a,o.blockNumber=i,o.tags=[],o}return Object(o.a)(n,[{key:"getJson",value:function(){return{name:this.name,contentHash:this.contentHash,user:this.user,blockNumber:this.blockNumber,hasEdits:this.hasEdits}}},{key:"fromJson",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!e.name&&t||(e.contentHash&&(this.contentHash=e.contentHash),this.user=e.user,this.blockNumber=e.blockNumber,this.hasEdits=e.hasEdits,t&&this.load()),this}},{key:"load",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.contentHash){e.next=4;break}return e.next=3,f.a.presets.getTags(this.contentHash);case 3:this.tags=e.sent;case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getContentType",value:function(){return d.a}},{key:"title",get:function(){return this.name}},{key:"ipfsHash",get:function(){return this.contentHash}},{key:"getName",value:function(){return this.name}},{key:"getId",value:function(){return this.contentHash}},{key:"newTag",value:function(e){this.isCreated()&&(this.tags.push(e),f.a.presets.tagPreset(this.contentHash,[e],0))}},{key:"save",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.track.trackNumber,this.name=t,e.next=4,h.a.getAccount();case 4:return this.user=e.sent,this.hasEdits=!1,e.next=8,p.a.eth.getBlockNumber();case 8:return this.blockNumber=e.sent,e.next=11,this.track.sequencerEngine.saveTrackPreset(n,t,!1,0,this.contentHash);case 11:this.contentHash=e.sent;case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),n}(n(514).a);t.a=m},function(e,t,n){"use strict";n.d(t,"d",function(){return r}),n.d(t,"e",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"a",function(){return s}),n.d(t,"b",function(){return o});var r="SEQUENCE_USED_SOUND",a="SAMPLE_RATED",i="SEQUENCE_BPM",s="PACK_TYPE",o="PRESET_RESAMPLED"},function(e,t,n){"use strict";n.d(t,"e",function(){return a}),n.d(t,"d",function(){return i}),n.d(t,"b",function(){return s}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return c}),n.d(t,"f",function(){return u});var r=n(133),a=function(e,t){var n=e.trackNumber+1+e.subSequence.name.toLowerCase()+".trigger";Object(r.b)(n,t.stepData)},i=function(e,t,n){Object(r.b)("roll",{rolling:e,resolution:t,isTriplet:n})},s=function(e,t){var n="pattern-switch."+e.name;Object(r.b)(n,t+1),n="pattern-switch",Object(r.b)(n,t+1)},o=function(e){Object(r.b)("planar-bounce",e)},c=function(e){Object(r.b)("notes-down",e)},u=function(e){Object(r.b)("trigger-count",e)}},,function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(31),u=n(6),l=n(8),f=n(2),h=n(7),p=n.n(h);function d(){if(!(this instanceof d))return arguments.length>1||"number"!==typeof arguments[0]?d.apply(new d(arguments.length),arguments):new d(arguments[0]);if(0===arguments.length)throw new Error("Missing Argument: You must pass a valid buffer length");return this.size=this.start=0,this.overflow=null,arguments.length>1||"number"!==typeof arguments[0]?(this.data=new Array(arguments.length),this.end=(this.length=arguments.length)-1,this.push.apply(this,arguments)):(this.data=new Array(arguments[0]),this.end=(this.length=arguments[0])-1),this}function v(e,t){return e==t?0:e>t?1:-1}d.prototype={constructor:d,pop:function(){var e;if(0!==this.size)return e=this.data[this.end],delete this.data[this.end],this.end=(this.end-1+this.length)%this.length,this.size--,e},push:function(){var e=0;if(this.overflow&&this.size+arguments.length>this.length)for(;e<this.size+arguments.length-this.length;e++)this.overflow(this.data[(this.end+e+1)%this.length],this);for(e=0;e<arguments.length;e++)this.data[(this.end+e+1)%this.length]=arguments[e];return this.size<this.length&&(this.size+e>this.length?this.size=this.length:this.size+=e),this.end=(this.end+e)%this.length,this.start=(this.length+this.end-this.size+1)%this.length,this.size},reverse:function(){for(var e,t=0;t<~~(this.size/2);t++)e=this.data[(this.start+t)%this.length],this.data[(this.start+t)%this.length]=this.data[(this.start+(this.size-t-1))%this.length],this.data[(this.start+(this.size-t-1))%this.length]=e;return this},rotateLeft:function(e){if("undefined"===typeof e&&(e=1),"number"!==typeof e)throw new Error("Argument must be a number");for(;--e>=0;)this.push(this.shift());return this},rotateRight:function(e){if("undefined"===typeof e&&(e=1),"number"!==typeof e)throw new Error("Argument must be a number");for(;--e>=0;)this.unshift(this.pop());return this},shift:function(){var e;if(0!==this.size)return e=this.data[this.start],this.start=(this.start+1)%this.length,this.size--,e},sort:function(e){return this.data.sort(e||v),this.start=0,this.end=this.size-1,this},unshift:function(){var e=0;if(this.overflow&&this.size+arguments.length>this.length)for(;e<this.size+arguments.length-this.length;e++)this.overflow(this.data[this.end-e%this.length],this);for(e=0;e<arguments.length;e++)this.data[(this.length+this.start-e%this.length-1)%this.length]=arguments[e];return this.length-this.size-e<0&&(this.end+=this.length-this.size-e,this.end<0&&(this.end=this.length+this.end%this.length)),this.size<this.length&&(this.size+e>this.length?this.size=this.length:this.size+=e),this.start-=arguments.length,this.start<0&&(this.start=this.length+this.start%this.length),this.size},indexOf:function(e,t){for(t||(t=0);t<this.size;t++)if(this.data[(this.start+t)%this.length]===e)return t;return-1},lastIndexOf:function(e,t){for(t||(t=this.size-1);t>=0;t--)if(this.data[(this.start+t)%this.length]===e)return t;return-1},sortedIndex:function(e,t,n){t=t||v;var r=this.start,a=this.size-1;for(r&&t.call(n,e,this.data[a])>0&&(r=0,a=this.end);r<a;){var i=r+a>>>1;t.call(n,e,this.data[i])>0?r=i+1:a=i}return((r-this.start)%this.size+this.size)%this.size},every:function(e,t){for(var n=0;n<this.size;n++)if(!e.call(t,this.data[(this.start+n)%this.length],n,this))return!1;return!0},forEach:function(e,t){for(var n=0;n<this.size;n++)e.call(t,this.data[(this.start+n)%this.length],n,this)},some:function(e,t){for(var n=0;n<this.size;n++)if(e.call(t,this.data[(this.start+n)%this.length],n,this))return!0;return!1},avg:function(){return 0==this.size?0:this.sum()/this.size},sum:function(){for(var e=this.size,t=0;e--;)t+=this.data[e];return t},median:function(){if(0===this.size)return 0;var e=this.slice().sort(v),t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},empty:function(){return this.size=this.start=0,this.end=this.length-1,this},fill:function(e){var t=0;if("function"===typeof e)for(;this.data[t]=e(),++t<this.length;);else for(;this.data[t]=e,++t<this.length;);return this.start=0,this.end=this.length-1,this.size=this.length,this},first:function(){return this.data[this.start]},last:function(){return this.data[this.end]},get:function(e){return this.data[(this.start+e)%this.length]},isFull:function(e){return this.length===this.size},set:function(e,t){return this.data[(this.start+e)%this.length]=t},toArray:function(){return this.slice()},slice:function(e,t){var n=this.size;if((e=+e||0)<0){if(e>=t)return[];e=-e>n?0:n+e}null==t||t>n?t=n:t<0?t+=n:t=+t||0,n=e<t?t-e:0;for(var r=Array(n),a=0;a<n;a++)r[a]=this.data[(this.start+e+a)%this.length];return r}};var m=d;var y=function(e,t){this.timestretch=function(e){for(var t=e.getChannelData(0),n=e.getChannelData(1),r=[],a=[],i=0;i<100;i++)this.process(t[i],r),this.process(n[i],a);t=new Float32Array(r),n=new Float32Array(a),e.set(p.a.Buffer.fromArray([t,n]))},this.process=function(e,t){var n=function(e){for(var t=new Float32Array(e.length),n=0;n<e.length;n++)t[n]=i[n]*e[n];return t}(e);return function(e,t,n,r,a,i,s){for(var o,c=0,u=0;u<e;u++)o=a.shift()||0,c=r.shift()||0,s.push(c/(o<.01?1:o)),r.push(0),a.push(0);for(var u=0;u<i;u++)c=r.shift(),r.push(t[u]+c),o=a.shift(),a.push(n[u]+o)}(a,n,s,h,d,c,t),y=!1,a},this.beta_fn=function(e){return n<=1?2:n<=1.2?2:n<=1.4?2:n<=1.8?2.5:3},this.overlap_fn=function(e){return e<1.25?e+.15:e>=1.25&&e<1.5?e+.2:e>=1.5&&e<1.8?e+.6:e>=1.8&&e<2?e+.9:e+2.2},this.get_hs=function(){return a},this.get_ha=function(){return r},this.get_alpha=function(){return n},this.get_real_alpha=function(){return a/r},this.get_overlap_factor=function(){return l},this.clear_buffers=function(){h=new m(c),d=new m(c),y=!0},this.set_window_type=function(e){f=o[e]?e:f},this.set_alpha=function(e,t,i){n=e,void 0==i?this.set_beta(this.beta_fn(n)):this.set_beta(i),l=void 0==t?this.overlap_fn(n):t,r=Math.round(c/l),a=Math.round(n*r)},this.set_beta=function(e){i=function(e,t,n){for(var r=new Float32Array(e),a=0;a<e;a++)r[a]=o[n](e,a,t);return r}(c,u=e,f),s=new Float32Array(i.length);for(var t=0;t<s.length;t++)s[t]=Math.pow(i[t],1)};var n,r,a,i,s,o={Lanczos:function(e,t,n){var r=2*t/(e-1)-1;return Math.pow(Math.sin(Math.PI*r)/(Math.PI*r),n)},Triangular:function(e,t,n){return Math.pow(2/e*(e/2-Math.abs(t-(e-1)/2)),n)},Bartlett:function(e,t,n){return Math.pow(2/(e-1)*((e-1)/2-Math.abs(t-(e-1)/2)),n)},BartlettHann:function(e,t,n){return Math.pow(.62-.48*Math.abs(t/(e-1)-.5)-.38*Math.cos(2*Math.PI*t/(e-1)),n)},Blackman:function(e,t,n){var r=n/2;return(1-n)/2-.5*Math.cos(2*Math.PI*t/(e-1))+r*Math.cos(4*Math.PI*t/(e-1))},Cosine:function(e,t,n){return Math.pow(Math.cos(Math.PI*t/(e-1)-Math.PI/2),n)},Gauss:function(e,t,n){return Math.pow(Math.E,-.5*Math.pow((t-(e-1)/2)/(n*(e-1)/2),2))},Hamming:function(e,t,n){return Math.pow(.54-.46*Math.cos(2*Math.PI*t/(e-1)),n)},Hann:function(e,t,n){return Math.pow(.5*(1-Math.cos(2*Math.PI*t/(e-1))),n)},Rectangular:function(e,t,n){return n},SinBeta:function(e,t,n){return Math.pow(Math.sin(Math.PI*t/e),n)},Trapezoidal:function(e,t,n){var r=Math.round(e/4),a=r-1,i=9*r-1;return t<=a?Math.pow(t/a,n):t>=i?Math.pow(i/t,n):1}},c=e,u=1,l=1.1,f="Lanczos";this.set_alpha(1),this.set_beta(u);for(var h=new m(c),d=new m(c),v=0;v<c;v++)h.push(0),d.push(0);var y=!0;this.is_clean=function(){return y}};var b=function(e){var t,n=e||4096,r=new y(n),a=new y(n),i=0,s=1,o=new m(Math.round(1.2*n)),c=new m(Math.round(1.2*n)),u=new Float32Array(e);this.process=function(e){if(t){for(var l=0,f=t.getChannelData(0),h=t.getChannelData(1),p=e.getChannelData(0),d=e.getChannelData(1);c.size>0&&l<e.length;)p[y=l++]=o.shift(),d[y]=c.shift();if(l!=e.length)do{var v=f.subarray(i,i+n),m=h.subarray(i,i+n);void 0!=s&&s!=r.get_alpha()&&(r.set_alpha(s),a.set_alpha(s),s=void 0),v.length<n?(u.set(0,v),r.process(u,o),u.set(0,m),a.process(u,c),u.fill(0)):(r.process(v,o),a.process(m,c));for(var y=l;o.size>0&&y<e.length;y++)p[y]=o.shift(),d[y]=c.shift();l+=r.get_hs(),i+=r.get_ha()}while(l<e.length)}},this.set_audio_buffer=function(e){t=e},Object.defineProperties(this,{position:{get:function(){return i},set:function(e){i=new Number(e)}},alpha:{get:function(){return r.get_alpha()},set:function(e){s=new Number(e)}}})},g=n(819),O=(n(799),n(167)),k=n(23),j=n(798),w=n(26),x=n(554),S=(n(61),n(14)),P=n(22),E=n(123),T=n(112);n(392),n(555),n(408);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var M=8,R=new p.a.Time("16n"),C=new p.a.Time("32n"),N=p.a.Frequency("C3");window.initSamplers=0,window.rollConstant=.15;var q=0,I=function(e){Object(u.a)(n,e);var t=A(n);function n(e,r,a,i,o){var u,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];Object(s.a)(this,n),(u=t.call(this)).id=q++,u.isChosen=!0,window.initSamplers++,u.store=e.store,u.parameters=[],u.counter=0,u.baseTranspose=0,u.sample=r,u.tempo=r.tempo||o.tempo,u.samplerData=o,u.onsets=r.onsets||[],u.sliceData=i,u.track=e,u.note=null,u.slices=[],u.transposeParameter=new S.a("transpose",Object(c.a)(u),function(e,t){return[]},{defaultValue:0,min:-32,max:32}),u.registerParameter(u.transposeParameter),l||(u.gainNode=new p.a.Volume,u.volumeParameter=new T.c("volume",u.gainNode.volume,{min:-100,max:0,unit:"db",defaultValue:0}),u.registerParameter(u.volumeParameter)),u.alpha=1,u.tempoSynced=!1,u.audioBuffer=r.audioBuffer,u.offset=o.offset,u.transpose=o.transpose,u.onNewSampler=a,u.baseBuffer=new p.a.Buffer(r.audioBuffer),i=void 0===i?[{startTime:0,endTime:u.getDuration()}]:i,u.sliceData=i,u.pitchEnvelopes=[];for(var f=l?1:M,h=0;h<f;h++){var d=new p.a.ScaledEnvelope({attack:.01,decay:.01,min:0,max:1,sustain:1,release:.01,curve:"linear"});d._releaseCurve="linear",d._decayCurve="linear",u.pitchEnvelopes.push(d)}return u.pitchEnvelopeIndex=0,u.detuneSignal=new p.a.Signal(0),u.detuneParameter=new T.c("detune",u.detuneSignal,{min:-5e3,max:5e3,automationRate:P.a}),u.registerParameter(u.detuneParameter),o.detuneId&&(u.detuneParameter.id=o.detuneId),u.setupSlide(),u}return Object(o.a)(n,[{key:"replaceBuffer",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.release(),this._buffer=e,this.sample.audioBuffer=e,this.baseBuffer=new p.a.Buffer(e),this.slices.slice(1).map(function(e){return e.dispose()}),this.slices=[this.slices[0]],t&&(this.tempo=this.analyze()),this.slice(0,void 0,void 0,void 0,void 0,!0),t&&this.sliceFirstOnset()}},{key:"sequencerEngine",get:function(){return this.track.sequencerEngine}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setContext((new E.a).forInstrument(this).forTrack(this.track)),this.parameters.push(e)}},{key:"transpose",get:function(){return this.transposeParameter.get()},set:function(e){this.transposeParameter.set(e)}},{key:"init",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.samplerData;var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sliceData,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return void 0!==this.tempo||t||(this.tempo=this.analyze()),0==this.slices.length&&this.loadSlices(e),this}},{key:"sleep",value:function(e){return new Promise(function(t,n){setTimeout(function(){return t()},e)})}},{key:"analyze",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.baseBuffer,t=arguments.length>1?arguments[1]:void 0;if(!window.isNFT||t){(new Date).getTime();var n=this.track.sequencerEngine.aubio,r=this.state.waveform.onsetThreshold,a=Object(j.a)(e,n,r,.33),i=a.tempo,s=a.onsets,o=a.onsetToPitch;this.onsets=s,this.onsetToPitch=o;(new Date).getTime();return i}}},{key:"loadSlices",value:function(e){var t=this;e.map(function(e){return t.newSlice(e.startTime,window.isNFT?t.getDuration():e.endTime)})}},{key:"getVolume",value:function(){return this.volumeParameter.get()}},{key:"volume",get:function(){return this.volumeParameter.get()},set:function(e){this.volumeParameter.set(e,!0,!0)}},{key:"setVolume",value:function(e){void 0!==this.volumeParameter&&this.volumeParameter.set(e,!0,!0)}},{key:"getJson",value:function(){return{slices:this.slices.map(function(e){return e.getJson()}),tempoSynced:this.tempoSynced,detuneId:this.detuneParameter.id,tempo:this.tempo,transpose:this.transpose,alpha:this.alpha,offset:this.offset,reversed:this.isReversed(),sampleId:this.sample.getId()}}},{key:"release",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=this.get(e),r=p.a.Master.context.currentTime,a=void 0!==t?this.getNoteFromTranspose(t):this.lastNote;n.triggerRelease(a,r),this.triggerReleaseWaveformAnimation()}},{key:"getNoteFromTranspose",value:function(e){return e+=this.track.sequencerEngine.transpose,e+=this.baseTranspose,N.transpose(e).transpose(this.transpose)}},{key:"releaseAll",value:function(e){var t=this;this.slices.map(function(n){n.sampler.triggerRelease(t.lastNote,e)}),e||(this.clearSlide(),this.releaseSlide(),this.detuneSignal.value=this.detuneParameter.get(!0),this.lastTranspose=0)}},{key:"trigger",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var r,i,s,o,c,u,l,f,h,d,v,m,y,b,g,k;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.getDefaultTriggerConfig(t),this.track.sequencerEngine.isSequenceRolling&&(t.gated=!1),r=t.stepData,i=t.time,void 0===t.transpose&&(t.transpose=t.stepData.transpose||0),s=t.noDuration?null:t.stepData.duration,o=this.getSlice(t.sliceNumber),void 0!==(c=o&&o.sampler)&&null!==c&&c.loaded){e.next=10;break}return e.abrupt("return");case 10:if(u=null,null==s?(this.liveNote=t.transpose+o.transpose,this.release(t.sliceNumber,this.liveNote)):"number"===typeof s?(u=R*s,void 0!==this.liveNote&&this.release(t.sliceNumber,this.liveNote),this.liveNote=void 0):(u=new p.a.Time(s),void 0!==this.liveNote&&this.release(t.sliceNumber,this.liveNote),this.liveNote=void 0),(l=this.getNoteFromTranspose(t.transpose+o.transpose))._val=Math.min(31608,l._val),window.isNFT&&!O.isMobile&&(l*=44100/p.a.Master.context.sampleRate),f=t.velocity||r.velocity,h=r.chop,d=(null==u?R:u)/h,i=i||p.a.Master.context.currentTime,i=C*this.offset+i,v=i,this.track.sequencerEngine.isSequenceRolling&&this.track.sequencerEngine.resolution.isTriplet?(c.attack=new p.a.Time(window.rollConstant+r.attack/1e3),c.release=new p.a.Time(.1*window.rollConstant+r.release/1e3)):(c.attack=new p.a.Time(r.attack/1e3),c.release=new p.a.Time(r.release/1e3)),(m=r.reverse||this.sequencerEngine.reverse)!==this.isReversed(t.sliceNumber)&&this.reverse(m,t.sliceNumber),(void 0!==this.lastSlideTranspose||this.hasSlide)&&this.releaseSlide(i),!u||!r.slide){e.next=31;break}return this.triggerSlide(t.transpose,i,u),e.abrupt("return");case 31:void 0!==this.lastSlideTranspose&&(this.triggerSlide(t.transpose,i,s,!1),this.hasSlide=!0);case 32:for(i&&(y=this.detuneParameter.get(!0),this.detuneSignal.setValueAtTime(y,Math.max(0,i-.001))),this.lastSlideTranspose=void 0,this.lastSlideMax=void 0,this.track.isWarped()&&(t.gated=!0),b=v,this.track.lastTriggeredStart=t.start||r.start,g=0;g<h;g++)t.gated||null==this.lastNote||(this.wasUngated=!0,this.releaseAll(v),this.triggerReleaseWaveformAnimation(v)),k=this.getPitchEnvelope(c,l,i,f,r),t.gated&&u?(this.wasUngated&&this.releaseAll(v),this.wasUngated=!1,this.triggerAttackRelease(c,l,u,v,f,[k],this.convertToStartTime(t.sliceNumber,t.start||r.start))):this.triggerAttack(c,l,Math.max(v,p.a.Master.context.currentTime),f,[k],this.convertToStartTime(t.sliceNumber,t.start||r.start)),v+=d;this.lastNote=l,this.lastTranspose=t.transpose,this.triggerWaveformAnimation(t.skipRelease?void 0:b,t.gated&&!t.skipRelease?u:void 0,t.sliceNumber,t.transpose,this.convertToStartTime(t.sliceNumber,r.start));case 42:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"convertToStartTime",value:function(e){var t=0,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)/100;this.track&&this.track.isAudioTrack&&(n=n*(this.track.getMaxDuration()/this.getDuration())%1);var r=n*this.getSlice(e).buffer.duration;return D(t+r)}},{key:"getPitchEnvelope",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.a.Master.context.currentTime,r=(arguments.length>3&&arguments[3],arguments.length>4?arguments[4]:void 0),a=(p.a.Frequency(t).toMidi(),this.pitchEnvelopes[this.pitchEnvelopeIndex]);a.cancel(Math.max(0,n-.001)),this.pitchEnvelopeIndex=(this.pitchEnvelopeIndex+1)%this.pitchEnvelopes.length;var i=null===r.pitchSustain?1:r.pitchSustain;return a.attack=null==r.pitchAttack?0:r.pitchAttack/1e3,a.attack+=.001,a.decay=null==r.pitchDecay?0:r.pitchDecay/1e3,a.decay+=.001,a.min=0,a.max=6*i*100,a.sustain=i,a.sustain+=.001,a.release=null==r.pitchRelease?0:r.pitchRelease/1e3,a.release+=.001,a}},{key:"triggerAttack",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.get(0),n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0;return new Promise(function(){var l=Object(i.a)(a.a.mark(function i(l,f){var h,d;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:h=function(t){e.triggerReleaseWaveformAnimation(),setTimeout(function(){void 0===t||void 0===t._source||e.sequencerEngine.context.isOffline||e.isDisposed()||(e.detuneSignal.disconnect(t._source.detune),o.forEach(function(e){return e.disconnect(t._source.detune)}))},4e3),l()};try{void 0!==(d=t.triggerAttack(n,r+1/p.a.Master.context.sampleRate,s,c,h,u))&&void 0!==d._source&&(o.forEach(function(e){return e.connect(d._source.detune)}),e.detuneSignal.connect(d._source.detune),o.forEach(function(t){return t.triggerAttack(e.isSimple?void 0:r)}))}catch(i){console.log(i)}e.lastNote=n;case 3:case"end":return a.stop()}},i)}));return function(e,t){return l.apply(this,arguments)}}())}},{key:"triggerAttackRelease",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.get(0),n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0;return new Promise(function(){var f=Object(i.a)(a.a.mark(function i(f,h){var p,d;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:p=1===c.length?function(){return f()}:function(t){setTimeout(function(){void 0===t||void 0===t._source||e.sequencerEngine.context.isOffline||e.isDisposed()||(e.detuneSignal.disconnect(t._source.detune),c.forEach(function(e){return e.disconnect(t._source.detune)}))},4e3),f()};try{s<0&&(s=0),void 0!==(d=t.triggerAttackRelease(n,r,s,o,u,p,l))&&void 0!==d._source&&(c.forEach(function(e){return e.connect(d._source.detune)}),e.detuneSignal.connect(d._source.detune),c.length>1?c.forEach(function(e){0===e.release?e.triggerAttack(s):e.triggerAttackRelease(r,s)}):c[0]&&c[0].triggerAttackRelease(r,s))}catch(i){console.log(i)}e.lastNote=n;case 3:case"end":return a.stop()}},i)}));return function(e,t){return f.apply(this,arguments)}}())}},{key:"getDuration",value:function(){return this.baseBuffer?this.baseBuffer.duration:1}},{key:"sliceFirstOnset",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!(void 0===this.onsets||0===this.onsets.length||this.slices.length>1)){var e=this.getSlice(0);if(0===e.startTime){var t=this.onsets[0]/1e3;t<e.endTime&&this.slice(0,t,e.endTime,!0)}}}},{key:"autoSlice",value:function(e){for(var t=void 0,n=this.slices[this.slices.length-1],r=1,a=0;a<this.onsets.length;a++)if(this.onsets[a]/1e3>n.endTime){r=a;break}for(var i=Math.max(1,Math.floor(this.onsets.length/8)),s=0;s<Math.min(e,this.onsets.length);s++){var o=this.onsets[r+s*i]/1e3,c=this.onsets[r+(s+1)*i];if(void 0===t||o-t>=.1){var u=this.getDuration();c&&(u=c/1e3),o<u&&this.newSlice(o,u),t=o}}}},{key:"slice",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=(arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5]),s=this.getSlice(e);r=void 0==r?this.getDuration():r,s.startTime=n,s.endTime=r,this.slices.filter(function(e){return e.buffer}).forEach(function(e){return e.buffer.originalCopy=void 0}),this.slices.filter(function(e){return e.buffer}).forEach(function(e){return e.buffer.reversedCopy=void 0});this.alpha;var o=++this.counter;if(p.a.Master.context.isOffline||i){if(this.baseBuffer){var c=window.isNFT?this.baseBuffer:this.baseBuffer.slice(n,r);s.buffer?s.buffer.set(c):s.buffer=c,window.isNFT&&(this.slices[0].sampler._buffers._buffers[48]=this.baseBuffer),s.refreshReverse(),this.onNewSampler(this)}}else setTimeout(function(){if((o===t.counter||a)&&t.baseBuffer){if(window.isNFT)s.buffer=t.baseBuffer;else{var e=t.baseBuffer.slice(n,r);s.buffer.set(e),s.refreshReverse()}t.onNewSampler(t)}},50);this.sliceData[e]={startTime:n,endTime:r},this.updateSlicesState()}},{key:"state",get:function(){return this.store.getState()}},{key:"updateSlicesState",value:function(){this.store.dispatch(Object(k.ed)(this.id,this.slices.map(function(e){return e.getJson()})))}},{key:"syncTempo",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null!=this.tempo&&(t?(this.alpha=this.tempo/e,this.timestretch()):this.baseTranspose=12*(e/this.tempo-1)),this.tempoSynced=!0}},{key:"unsyncTempo",value:function(){this.alpha=1,this.tempoSynced=!1,this.baseTranspose=0}},{key:"timestretch",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!=this.alpha){e.next=3;break}return this.unsyncTempo(),e.abrupt("return");case 3:t=this.getDuration(),n=new b(4096),r=this.alpha,n.alpha=r,i=t*r*p.a.context.sampleRate-4096*this.alpha,s=p.a.context.createBuffer(2,i,p.a.context.sampleRate),n.set_audio_buffer(this.baseBuffer.get()),n.process(s);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"reverse",value:function(e,t){void 0===t?(this.baseBuffer.reverse=e,this.slices.forEach(function(t){return t.sampler._buffers.isReversed=e})):this.slices[t%this.slices.length].sampler._buffers.isReversed=e}},{key:"isReversed",value:function(e){return void 0===e?void 0!==this.baseBuffer&&this.baseBuffer.reverse:this.slices[e%this.slices.length].sampler._buffers.isReversed}},{key:"deleteSlice",value:function(e){1!==this.slices.length&&(this.slices.splice(e,1),this.sliceData.splice(e,1),this.updateSlicesState())}},{key:"newSlice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.slices[0]&&this.slices[0].startTime,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.slices[0]&&this.slices[0].endTime;if(void 0!==e||void 0!==t){var n;t=t||this.getDuration(),n=window.isNFT?t===this.getDuration()&&0===e?this.baseBuffer:this.baseBuffer.slice(e,this.getDuration()):this.baseBuffer.slice(e,t);var r=new p.a.Sampler({C3:n},{curve:"linear"}),a=new _(n,r,e,t);return a.sampler.connect(this.gainNode),this.slices.push(a),this.sliceData.push({startTime:e,endTime:t}),this.slice(this.slices.length-1,e,t,!0),this.slices[this.slices.length-1]}}},{key:"getStartTime",value:function(e){return this.slices[e].startTime}},{key:"getEndTime",value:function(e){return null==this.slices[e].endTime&&(this.slices[e].endTime=this.slices[0].buffer._buffer.duration),this.slices[e].endTime}},{key:"getNumberOfSlices",value:function(){return this.slices.length}},{key:"dispose",value:function(){this.audioBuffer=void 0,this.isCopied||(this.baseBuffer.dispose(),this.slices.forEach(function(e){return e.dispose()})),this.gainNode.dispose(),this.pitchEnvelopes.forEach(function(e){return e.dispose()}),this.baseBuffer=void 0,this.slices=void 0,this.gainNode=void 0,this.pitchEnvelopes=void 0}},{key:"get",value:function(e){return this.slices[e%this.slices.length].sampler}},{key:"getSlice",value:function(e){return this.slices[e%this.slices.length]}},{key:"isLoaded",value:function(){return this.slices.length>0&&this.slices[0].sampler.loaded}},{key:"triggerWaveformAnimation",value:function(e,t,n,r,a){if(this.showWaveformAnimation()){var i=this.getSlice(n),s=i.startTime+a,o=new Event(g.d);o.trackNumber=this.track.trackNumber,o.subSequenceId=this.track.subSequence.id,o.startTime=s,o.duration=t||0,o.soundId=this.sample.getId(),o.sliceStartTime=a,o.sliceDuration=i.getDuration(),o.sliceNumber=n,o.transpose=r,o.time=Math.max(0,void 0===e?0:this.track.sequencerEngine.getMilliseconds(e)),window.dispatchEvent(o)}}},{key:"triggerReleaseWaveformAnimation",value:function(e){if(this.showWaveformAnimation()){var t=new Event(g.c);t.trackNumber=this.track.trackNumber,t.subSequenceId=this.track.subSequence.id,t.soundId=this.sample.getId(),t.time=Math.max(0,void 0===e?0:this.track.sequencerEngine.getMilliseconds(e)),window.dispatchEvent(t)}}},{key:"showWaveformAnimation",value:function(){return this.track.sequencerEngine.isSampler||this.isMixViewShown()||this.isWaveformShown()}},{key:"isMixViewShown",value:function(){var e=this.track.subSequence.id;return this.track.sequencerEngine.currentSubSequence.id===e&&this.state.sequencer.viewMode===w.b}},{key:"isWaveformShown",value:function(){return!!this.showingPrettyWaveform||this.track.subSequence.id===this.track.sequencerEngine.currentSubSequence.id&&this.state.sequencer.waveformShowing&&this.track.sequencerEngine.cursor.track===this.track.trackNumber}},{key:"getCopy",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.track,a={volume:this.volume,offset:this.offset,transpose:this.transpose,reversed:this.isReversed()},i=new n(r,this.sample,e,this.sliceData,a);return i.tempo=this.tempo,i.onsets=this.onsets,i.init(),this.isCopied=!0,i.slices.forEach(function(e,n){t.slices[n]&&(e.buffer.originalCopy=t.slices[n].buffer.originalCopy,e.buffer.reversedCopy=t.slices[n].buffer.reversedCopy)}),i}},{key:"isDisposed",value:function(){return void 0===this.audioBuffer}}],[{key:"getDefaultTriggerConfig",value:function(e){return void 0===e.gated&&(e.gated=!0),void 0===e.sliceNumber&&(e.sliceNumber=0),void 0===e.skipRelease&&(e.skipRelease=!1),e}}]),n}(Object(x.a)(function(){return function e(){Object(s.a)(this,e)}}())),_=function(){function e(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Object(s.a)(this,e),this.buffer=t,this.transpose=i,this.sampler=n,this.startTime=void 0==r?0:r,this.endTime=a,this.slice=void 0}return Object(o.a)(e,[{key:"getDuration",value:function(){return this.endTime-this.startTime}},{key:"dispose",value:function(){this.buffer.dispose(),this.sampler.dispose(),this.buffer=void 0,this.sampler=void 0,this.startTime=void 0,this.endTime=void 0}},{key:"getJson",value:function(){return{startTime:this.startTime,endTime:this.endTime,transpose:this.transpose}}},{key:"getCopy",value:function(){return new e(this.buffer,this.sampler,this.startTime,this.endTime,this.transpose)}},{key:"refreshReverse",value:function(){if(!window.isNFT){var e=this.sampler._buffers;e.isReversed=!1,e._reversedBuffers[48]=e.getReversed(e._buffers[48])}}}]),e}();t.a=I;var D=function(e){return!window.isNFT||O.isMobile?e:e*(44100/p.a.Master.context.sampleRate)}},function(e,t,n){"use strict";n.d(t,"a",function(){return u}),n.d(t,"b",function(){return f});var r=n(11),a=n(107),i=n(233),s=n(156);function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=function(e,t){for(var n=arguments.length,s=new Array(n>2?n-2:0),o=2;o<n;o++)s[o-2]=arguments[o];return function(n,o){var c=Object(a.a)(n,1)[0];if(void 0===c)return e([c],o);var u=s.filter(function(e){return void 0!==e()}).map(function(e){return e()}),f=[c].concat(Object(r.a)(u)).map(function(e){return e.type||Object(i.c)(e)}),h=l(t,f);t.compilationError=h;var p=e([c],o);if(p){if(t.determineType&&!t.type){var d=t.determineType.apply(t,Object(r.a)(f));Array.isArray(d)&&(d=d[0]),p.type=d}return p}}},l=function(e,t){var n=e.inletTypes;if(n)if(Array.isArray(n))for(var r=0;r<n.length;r++){var a=n[r];if("object"===typeof a){if(a.or&&!a.or.includes(t[r]))return{text:"Received type ".concat(t[r]," when expecting types [").concat(a.or.join(" | "),"] (for inlet #").concat(r+1,")"),inlet:r}}else if(n[r]!==t[r])return{text:"Received type ".concat(t[r]," when expecting type ").concat(n[r]," (for inlet #").concat(r+1,")"),inlet:r}}else if("object"===typeof n&&n.repeat){var i,s=0,c=o(t);try{for(c.s();!(i=c.n()).done;){var u=i.value,l=n.repeat;if(l.or){if(!l.or.includes(u))return{text:"Received type ".concat(u," when expecting types ").concat(l.or.join(" | ")," (for inlet #").concat(s+1,")"),inlet:s}}else{var f,h=o(l);try{for(h.s();!(f=h.n()).done;){var p=f.value;if(p.or){if(!p.or.includes(u))return{text:"Received type ".concat(u," when expecting types: [").concat(p.or.join(" | "),"] (for inlet #").concat(s+1,")"),inlet:s}}else if(p!==u)return{text:"Received type ".concat(u," when expecting type: ").concat(p," (for inlet #").concat(s+1,")"),inlet:s}}}catch(d){h.e(d)}finally{h.f()}}s++}}catch(d){c.e(d)}finally{c.f()}}},f=function(e,t,n,r){if(!n)return e;var a=function(e){var a=n.or||[n];r.compilationError={text:"Received type ".concat(e," when expecting types [").concat(a.join(" | "),"] (for inlet ").concat(t,")"),inlet:t}};return function(t){var i=t[0],o=i.type?i.type:"number"===typeof i?s.g:"string"===typeof i?"string":Array.isArray(i)?"list":"object";if(n.or){if(!n.or.includes(o))return void a(o)}else if(n!==o)return void a(o);return r.compilationError=void 0,e(t)}}},function(e,t,n){"use strict";n.d(t,"c",function(){return i}),n.d(t,"d",function(){return o}),n.d(t,"a",function(){return c}),n.d(t,"b",function(){return u});var r=n(11),a=n(156),i=function(e){if("number"===typeof e)return a.a;if(Array.isArray(e)){if(2===e.length)return a.c;if(3===e.length)return a.d;if(4===e.length)return a.e}return"number"===typeof e?a.g:"string"===typeof e?"string":Array.isArray(e)?"list":a.b},s=[a.a,a.c,a.d,a.e],o=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=Math.max.apply(Math,Object(r.a)(t.map(function(e){return s.indexOf(e)})));return s[a]},c=function(e,t){var n=e.inletTypes;if(n){if(!Array.isArray(n)&&n.repeat){var r=n.repeat;return Array.isArray(r)&&(r=r[0]),r.or?r.or:r}var a=n[t];return a?a.or?a.or:a:"float"}},u=function(e,t){var n=e.type;if("string"===typeof n)return n;if("function"===typeof n){for(var a=c(e,0),i=Array.isArray(a)?a.length:1,s=[],o=function(a){var i=new Array(3).fill(0).map(function(t,r){var i=c(e,r);return Array.isArray(i)?i[a]:n}),o=n.apply(void 0,Object(r.a)(i));Array.isArray(o)?s.includes(o[t])||s.push(o[t]):s.includes(o)||s.push(o)},u=0;u<i;u++)o(u);return s}}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(7),a=n.n(r),i=new(n(21).a)(32,!1),s={};function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=s[e];if(void 0!==r){var o=r[t.toString()];if(void 0!==o)return o}else s[e]={};var c=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.transformStepAtResolution2(e,i),s=t.transformStepAtResolution2(e+1,i),o=new Set;Math.floor(r)==r?o.add(r):s-r>1&&o.add(Math.ceil(r));n?Math.floor(s)>=Math.floor(r)&&Math.floor(s)!=s&&o.add(Math.floor(s)):Math.floor(s)>Math.floor(r)&&Math.floor(s)!=s&&o.add(Math.floor(s));o=Array.from(o);for(var c=[],u=0;u<o.length;u++){var l=o[u],f=i.transformStepAtResolution2(l,t),h=f-e;c.push({step:l,time:new a.a.Time("32n")*h})}return c}(e,t,n);return s[e][t.toString()]=c,c}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2),u=n(14),l=n(25);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(s.a)(n,e);var t=f(n);function n(e,a,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(r.a)(this,n),t.call(this,e,a,i,s)}return Object(a.a)(n,[{key:"options",get:function(){return this.config.options}},{key:"getOptionFromNumber",value:function(e){if((e=parseFloat(e))in this.fromCache)return this.fromCache[e];var t=1e4,n=void 0;for(var r in this.options){var a=Math.abs(e-parseFloat(r));a<t&&(t=a,n=this.options[r])}return this.fromCache[e]=n,n}},{key:"getNumberFromOption",value:function(e){if(void 0!==e){if(e.toString()in this.toCache)return this.toCache[e.toString()];for(var t in this.options)if(e.equals&&e.equals(this.options[t])||this.options[t]===e)return this.toCache[e.toString()]=parseFloat(t),parseFloat(t)}}},{key:"convertValue",value:function(e){Object(l.b)(e);return this.getOptionFromNumber(e)}},{key:"set",value:function(e,t,r,a){if(null===e||void 0===e)return Object(i.a)(Object(c.a)(n.prototype),"set",this).call(this,void 0,t,r);var s=a?e:this.config.isNumber||"number"!==typeof e?this.getNumberFromOption(e):e;return void 0===s&&(s=Object.values(this.options)[0]),Object(i.a)(Object(c.a)(n.prototype),"set",this).call(this,s,t,r)}},{key:"getNumber",value:function(e){return Object(i.a)(Object(c.a)(n.prototype),"get",this).call(this,e)}},{key:"get",value:function(e){var t=Object(i.a)(Object(c.a)(n.prototype),"get",this).call(this,e);return t in this.options?this.options[t]:this.getOptionFromNumber(t)}},{key:"updateRedux",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];arguments.length>1&&arguments[1];for(var t in this.patternToAutomation)this.patternToAutomation[t].clear();if(this.unlockedAutomation.clear(),this.automation.clear(),this.automation.store=this.store,this.mixAutomation.store=this.store,this.automation.updateRedux(),null!==this.value&&void 0!==this.value)return this.set(this.value,!0,e,!0)}}]),n}(u.a);t.a=h},function(e,t,n){"use strict";function r(e){for(var t,n,r=e.length;0!==r;)n=Math.floor(Math.random()*r),t=e[r-=1],e[r]=e[n],e[n]=t;return e}n.d(t,"a",function(){return r})},,,,,,function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(42),s=n.n(i),o=n(56),c=n(4),u=n(5),l=n(404),f=(n(571),n(542)),h=n(23),p=n(217),d=n(204),v=n(7),m=n.n(v),y=n(123);function b(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var O=function(){function e(t,n,r,a){Object(c.a)(this,e),this.inputNode=t,this.effectsInputNode=new m.a.Gain,this.inputNode.connect(this.effectsInputNode),this.outputNode=n,this.mixSession=a.mixSession,this.parameterContext=r,this.sequencerEngine=a,this.effects=[],this.samplerConnectedToMaster=!1}return Object(u.a)(e,[{key:"initDefault",value:function(){this.effects=Object(l.a)(this.sequencerEngine),this.updateEffects()}},{key:"setupEffects",value:function(){this.connectEffects(this.effectsInputNode,this.effects)}},{key:"updateEffects",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.effects;this.effects=t,this.effects.map(function(t){return t.track=e}),this.connectEffects(this.effectsInputNode,t)}},{key:"disconnectAll",value:function(){this.effects.map(function(e){return e.disconnect()})}},{key:"makePublicIfNeeded",value:function(){var e=Object(o.a)(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=s.a.keys(this.effects);case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,this.effects[t].makePublicIfNeeded();case 5:e.next=1;break;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"connectEffects",value:function(e,t){e.disconnect(),this.effects.map(function(e){return e.disconnect()});for(var n=e,r=0;r<t.length;r++){var a=t[r].getEffect();t[r].isEnabled()&&(n.connect(a),n=t[r])}n.connect(this.outputNode),this.linkEffectParameters()}},{key:"linkEffectParameters",value:function(){var e=this;this.effects.forEach(function(t){t.registerContext(e.parameterContext),t.registerMixSession(e.mixSession)})}},{key:"dispose",value:function(){this.effectsInputNode.disconnect(),this.effectsInputNode.dispose(),this.effects.forEach(function(e){return e.disconnect()}),this.effects.forEach(function(e){return e.dispose()}),this.effects=void 0,this.effectsInputNode=void 0}},{key:"clear",value:function(){this.effects.forEach(function(e){return e.disconnect()}),this.effects.forEach(function(e){return e.dispose()}),this.effects=[]}},{key:"start",value:function(){this.effects.filter(function(e){return e.syncable()}).forEach(function(e){return e.start()}),this.effects.forEach(function(e){return e.parameters.filter(function(e){return e.isConnectedToAnyModulator()}).forEach(function(e){return e.refresh()})})}},{key:"getAllParameters",value:function(){var e=[];return void 0===this.effects?e:(this.effects.forEach(function(t){return t.getParameters().forEach(function(t){return e.push(t)})}),e)}},{key:"getAllPatternLockedParameters",value:function(){return this.getAllParameters().filter(function(e){return e.hasPatternLockedValues()})}},{key:"moveEffectTo",value:function(e,t){if(e!=t){this.effectsInputNode.disconnect(this.effects[0]),this.effects.forEach(function(e){return e.disconnect()});var n=[];e>t?(n=this.effects.slice(0,t).concat([this.effects[e]]).concat(this.effects.slice(t,e)),this.effects.length>e+1&&(n=n.concat(this.effects.slice(e+1)))):(n=this.effects.slice(0,e).concat(this.effects.slice(e+1,t)).concat([this.effects[t],this.effects[e]]),this.effects.length>t+1&&(n=n.concat(this.effects.slice(t+1)))),this.updateEffects(n)}}},{key:"onBPMUpdated",value:function(){for(var e in this.effects)this.effects[e].onBPMUpdated&&this.effects[e].onBPMUpdated()}},{key:"getEffectNumber",value:function(e){var t=e.id;return this.effects.map(function(e){return e.id}).indexOf(t)}},{key:"getEffectById",value:function(e){return this.effects.find(function(t){return t.id===e})}},{key:"addEffect",value:function(e){this.effects=[].concat(Object(a.a)(this.effects),[e]),this.updateEffects()}},{key:"deleteEffect",value:function(e){var t=this.getEffectNumber(e);t<0||(e.disconnect(),t>0&&this.effects[t-1].disconnect(),this.effects.splice(t,1),this.effects=Object(a.a)(this.effects),this.updateEffects(this.effects),e.dispose())}},{key:"getCopy",value:function(t,n,r){var a=new e(t.gainNode,t.trackNode,(new y.a).forTrack(t),this.sequencerEngine);return a.effects=this.effects.map(function(e){return e.getEffectCopy(n,r)}),a.linkEffectParameters(),a}},{key:"getJson",value:function(e){return this.effects.map(function(t){return t.getJson(e)})}},{key:"mate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=Math.max(e.effects.length,this.effects.length),r=[];e.disconnectAll();for(var a=[],i=0;i<n;i++){var s=this.effects[i],o=e.effects[i];Object(d.a)(t)?(o&&r.push(o.getEffectCopy(this.track)),s&&a.push(s)):s&&r.push(s)}this.updateEffects(r),a.forEach(function(e){return e.dispose()}),e.effectsInputNode.disconnect(),e.effectsInputNode.dispose()}},{key:"addEffectJson",value:function(e,t,n){var r=Object(p.a)(e,t,this.sequencerEngine,n);return this.addEffect(r.effect),r}},{key:"fromJson",value:function(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var a={};for(var i in e){var s=e[i],o=Object(p.a)(s,t,this.sequencerEngine,n);this.addEffect(o.effect),a=Object(r.a)({},a,o.bulk)}this.sequencerEngine.store.dispatch(Object(h.ub)(a))}},{key:"convertToRack",value:function(){var e=this.effects.map(function(e){return e.getEffectCopy()}),t=new f.a(this.sequencerEngine);e.forEach(function(e){return t.addEffect(e,!1)});var n,r=50,a=100,i=b(e);try{for(i.s();!(n=i.n()).done;){var s=n.value;s.x=r,s.y=a,(r+=50)>300&&(r=50,a+=50)}}catch(c){i.e(c)}finally{i.f()}t.connectNodes(void 0,e[0]);for(var o=0;o<e.length;o++)t.connectNodes(e[o],e[o+1]);this.clear(),this.addEffect(t)}}]),e}();t.a=O},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),s=n(6),o=n(8),c=n(2),u=(n(7),n(929)),l=n(410),f=n(21),h=n(33),p=n(60),d=n(523);n(1);var v=function(e,t){for(var n in e){var r=e[n];if(r)for(var a in r.steps){if(r.steps[a].hasStep(t))return{stepNumber:parseInt(n),position:a}}}return{stepNumber:void 0,position:void 0}};function m(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var O=function(e,t,n){var a=Object(r.a)(e.steps),i=function(e,t){var n=e.steps.map(function(e){return v(t,e)});return Math.min.apply(Math,Object(r.a)(n.map(function(e){return e.stepNumber})))}(e,t);a.reverse();var s,o=b(a);try{for(o.s();!(s=o.n()).done;){var c=s.value,u=v(t,c),l=u.stepNumber,f=(u.position,l-i),h=Math.floor(i+f*n);if(t[l]){var d=t[l].steps,m=t[l].track;h!==l&&(t[l]=new p.a(m),t[h]=new p.a(m),t[h].steps=d)}}}catch(y){o.e(y)}finally{o.f()}return t};function k(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var w=n(246);n(49);function x(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var E=function(e,t,n){switch(n.thenType){case d.a:return function(e,t,n){var a=Object(r.a)(e.steps);a.reverse();var i,s=Object(r.a)(t),o=m(a);try{for(o.s();!(i=o.n()).done;){var c=i.value,u=v(s,c),l=u.stepNumber,f=(u.position,Math.round((l+n)%t.length));if(s[l]){var h=s[l].steps,d=t[l].track;t[l]=new p.a(d),t[f]=new p.a(d),t[f].steps=h}}}catch(y){o.e(y)}finally{o.f()}return t}(t,e,n.thenValue.get());case d.d:return O(t,e,n.thenValue.get());case d.l:return function(e,t){var n,a=Object(r.a)(e.steps),i=k(a.slice(0,a.length-1));try{for(i.s();!(n=i.n()).done;)for(var s=n.value,o=v(t,s).stepNumber,c=t[o],u=o+2;u<t.length&&!t[u].anyOn();u+=2)t[u]=c}catch(l){i.e(l)}finally{i.f()}return t}(t,e);case d.f:return function(e,t){for(var n=Object(r.a)(e.steps),a=0;a<n.length-1;a++){var i=n[a],s=n[a+1],o=v(t,i),c=v(t,s),u=t[o.stepNumber],l=new p.a(u.track);for(var f in u.steps){var h=u.steps[f].getCopy(),d=(c.stepNumber-o.stepNumber)/2;h.duration=d,l.steps[f]=h}t[o.stepNumber]=l}return t}(t,e)}return e},T=function(){function e(t){Object(a.a)(this,e),this.children=t}return Object(i.a)(e,[{key:"getAllLeaves",value:function(){if(void 0===this.children)return[this];var e=[];for(var t in this.children)e=e.concat(this.children[t].getAllLeaves());return e}},{key:"getLeftMostLeaf",value:function(){var e=this.getAllLeaves();if(e.length>0)return e[0]}}]),e}();n(20);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var M=function(e){Object(s.a)(n,e);var t=A(n);function n(e,r,i,s){var o;return Object(a.a)(this,n),(o=t.call(this,s)).pattern=e,o.stepNumber=r,o.resolution=i,o}return Object(i.a)(n,[{key:"track",get:function(){return this.pattern.track}},{key:"state",get:function(){return this.track.sequencerEngine.state}},{key:"stepBuckets",get:function(){return this.resolution.isTriplet?this.pattern.tripletStepBuckets:this.pattern.stepBuckets}},{key:"search",value:function(e,t){if(void 0!==this.stepNumber){void 0===this.resolution||this.resolution.toString();if(this.stepNumber===e&&t.equals(this.resolution))return this;if(void 0!==this.children)for(var n in this.children){var r=this.children[n].search(e,t);if(void 0!==r)return r}}else for(var a in this.children){var i=this.children[a].search(e,t);if(void 0!==i)return i}}},{key:"toggle",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this.on){var n=this.getAllLeaves().filter(function(e){return e.on}),r=[];for(var a in n){var i=n[a];r.push({stepBucket:this.stepBuckets[i.stepNumber],stepNumber:i.stepNumber});var s=function(t){var n=e.stepBuckets[i.stepNumber];n.group&&(n.group.steps=n.group.steps.filter(function(e){return e!=n}))};for(var o in this.stepBuckets[i.stepNumber])s();var c=t||this.stepBuckets[i.stepNumber].getAllOnSteps()[0].id;this.stepBuckets[i.stepNumber]=new p.a(this.pattern.track,this.resolution.isTriplet),this.stepBuckets[i.stepNumber].steps[0]=new h.a(void 0,void 0,void 0,this.track),this.stepBuckets[i.stepNumber].steps[0].id=c}return r}var u=this.getLeftMostLeaf();this.on=!0,this.stepBuckets[u.stepNumber].steps[0]||(this.stepBuckets[u.stepNumber].steps[0]=new h.a(void 0,void 0,void 0,this.track)),t=t||this.stepBuckets[u.stepNumber].steps[0].id,this.getLeftMostBucket().steps[0].id=t;var l=new p.a(this.pattern.track,this.resolution.isTriplet);return l.steps[0]=new h.a(void 0,void 0,void 0,this.track),l.steps[0].id=t,[{stepBucket:l,stepNumber:u.stepNumber}]}},{key:"on",get:function(){return void 0===this.children?this.stepBuckets[this.stepNumber].anyOn():this.getAllLeaves().some(function(e){return e.on})},set:function(e){var t=this.getLeftMostBucket();if(!t.steps[0]){var n=new h.a;n.track=this.pattern.track,t.steps[0]=n}t.steps[0].on=e;var r=this.state.effects.selectedPalettes[this.track.id];void 0!==r&&(t.steps[0].palette=r)}},{key:"getLeftMostBucket",value:function(){var e=this.getLeftMostLeaf();return this.stepBuckets[e.stepNumber]}},{key:"getJson",value:function(){return void 0===this.children?{stepNumber:this.stepNumber,resolution:this.resolution}:{stepNumber:this.stepNumber,resolution:this.resolution,children:this.children.map(function(e){return e.getJson()})}}}]),n}(T);function R(e,t){for(var n=new f.a(1,t),r=e.length(n),a=[],i=0;i<r;i++){var s=new M(e,i,n,void 0);a.push(C(s,e,t))}return new M(e,void 0,void 0,a)}function C(e,t,n){var r=e.resolution;if(32===r.resolution)return e;var a=new f.a(2*r.resolution,r.isTriplet);if(n){var i=new M(t,3*e.stepNumber,a,void 0),s=new M(t,3*e.stepNumber+1,a,void 0),o=new M(t,3*e.stepNumber+2,a,void 0);e.children=[C(i,t),C(s,t),C(o,t)]}else{var c=new M(t,2*e.stepNumber,a,void 0),u=new M(t,2*e.stepNumber+1,a,void 0);e.children=[C(c,t),C(u,t)]}return e}var N=n(23);function q(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var D=new f.a(32,!1),F=new f.a(32,!0),L=(new f.a(16,!1),0),B=function(e){Object(s.a)(n,e);var t=_(n);function n(e,r){var i;return Object(a.a)(this,n),(i=t.call(this)).steps=[],i.id=L++,i.sequencerEngine=e,i.store=e.store,i.track=r,i.frozenPatternPlaying=void 0,i.mix=new l.a(e),i.stepBuckets=[],i.tripletStepBuckets=[],i.stepBucketsMatrix={},i.tripletStepBucketsMatrix={},i.transformBucketsIntoStepsCache={},i.stepFills=[],i.tripletStepFills=[],i.volume=0,i.panning=0,i.muted=!1,i.initBlankPattern(),i.color=void 0,i.loopsPlaying={},i.sequencerEngine.multiSequencerEngine||i.updateStepResolutionTree(),i.needsSync=!1,i._startStep=void 0,i.repeats=void 0,i}return Object(i.a)(n,[{key:"startStep",get:function(){return this._startStep},set:function(e){e<0||(this._startStep=e,void 0!==e&&this.sequencerEngine.store.dispatch(Object(N.C)(this.track.subSequence.id,this.id,e)))}},{key:"step",get:function(){return this._startStep}},{key:"duration",get:function(){return this.length()}},{key:"endStep",get:function(){return this._startStep+this.length()}},{key:"updateStepResolutionTree",value:function(){this.stepResolutionTree=R(this,!1),this.tripletStepResolutionTree=R(this,!0)}},{key:"getStepResolutionTree",value:function(e){return e?this.tripletStepResolutionTree:this.stepResolutionTree}},{key:"getBucketsForStepAtResolution",value:function(e,t){for(var n=this.getRangeOfStepsAtResolution(t),r=t.isTriplet?this.tripletStepBuckets:this.stepBuckets,a=t.isTriplet?F.transformStepAtResolution(e,t):D.transformStepAtResolution(e,t),i=[],s=a=Math.floor(a);s<n+a;s++)i.push(r[s%r.length]);return i}},{key:"deleteStepNumber",value:function(e){this.stepBuckets[e]=new p.a(this.track)}},{key:"getRangeOfStepsAtResolution",value:function(e){return e.isTriplet?F.numSteps()/e.numSteps():D.numSteps()/e.numSteps()}},{key:"getAllOnStepAtResolutionBeforePosition",value:function(e,t,n){return this.getBucketsForStepAtResolution(e,t)[0].getAllOnStepsBefore(n)}},{key:"getAllOnStepAtResolutionAtAnyPosition",value:function(e,t,n){this.getRangeOfStepsAtResolution(t);var r=this.getBucketsForStepAtResolution(e,t),a=[];for(var i in r)a=a.concat(r[i].getAllOnSteps(n));return a}},{key:"getStepAtResolution",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=this.getBucketsForStepAtResolution(e,t);for(var i in a)if(void 0!==a[i]){var s=a[i].getStep(r);if(s&&s.getPolyphony().some(function(e){return e.on&&n(e)}))return s}a.length}},{key:"getPolyphonicStepsAtResolution",value:function(e,t){var n=t.isTriplet?F.numSteps()/t.numSteps():D.numSteps()/t.numSteps(),r=[];if(t.isTriplet){var a=F.transformStepAtResolution(e,t);this.tripletStepBuckets[a%this.tripletStepBuckets.length];for(var i=a;i<n+a;i++){var s=this.tripletStepBuckets[i%this.tripletStepBuckets.length].steps,o=function(e){var t=s[e].getPolyphony().filter(function(e){return e.on}).map(function(t){return{position:e,step:t}});r=r.concat(t)};for(var c in s)o(c)}}else{var u=D.transformStepAtResolution(e,t);this.stepBuckets[u%this.stepBuckets.length];for(var l=u;l<n+u;l++){var f=this.stepBuckets[l%this.stepBuckets.length].steps,h=function(e){var t=f[e].getPolyphony().filter(function(e){return e.on}).map(function(t){return{position:parseFloat(e),step:t}});r=r.concat(t)};for(var p in f)h(p)}}return r}},{key:"setStepAtResolution",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(void 0===t||isNaN(t))&&(t=0),(void 0===r||isNaN(r))&&(r=0),t=n.isTriplet?F.transformStepAtResolution2(t,n):D.transformStepAtResolution2(t,n);var a=Math.floor(t);if((r+=t-a)>=1){var i=Math.floor(r);a+=i,r-=i}n.isTriplet?this.tripletStepBuckets[a%this.tripletStepBuckets.length].setStepAtPosition(e,r):this.stepBuckets[a%this.stepBuckets.length].setStepAtPosition(e,r)}},{key:"addNote",value:function(e,t,n){var r=new h.a;r.on=!0,r.duration=t,r.transpose=n,r.stepNumber=e,this.stepBuckets[e].setStep(0,r)}},{key:"clearCache",value:function(){this.transformBucketsIntoStepsCache={}}},{key:"loadStepBuckets",value:function(e){e&&(this.stepBuckets=e),this.tripletStepBuckets=F.transformBucketsAtResolution(this.stepBuckets,D),this.updateStepResolutionTree(),this.transformBucketsIntoStepsCache={},this.syncMatrix()}},{key:"syncBuckets",value:function(e){(e=void 0!==e&&e)?this.stepBuckets=D.transformBucketsAtResolution(this.tripletStepBuckets,F):this.tripletStepBuckets=F.transformBucketsAtResolution(this.stepBuckets,D),this.syncMatrix()}},{key:"syncBucketsAtStep",value:function(e,t){var n=this.getRangeOfStepsAtResolution(t),r=t.isTriplet?F.transformStepAtResolution(e,t):D.transformStepAtResolution(e,t),a=(r=Math.floor(r))+n;t.isTriplet?this.stepBuckets=D.transformBucketsAtResolution(this.tripletStepBuckets,F,r,a,this.stepBuckets):this.tripletStepBuckets=F.transformBucketsAtResolution(this.stepBuckets,D,r,a,this.tripletStepBuckets),this.syncMatrix()}},{key:"syncMatrixBySteps",value:function(e,t){this.needsSync=!1;var n=t.isTriplet?this.tripletStepBuckets:this.stepBuckets,r=t.isTriplet?this.tripletStepBucketsMatrix:this.stepBucketsMatrix;for(var a in e){var i=e[a];a=D.transformStepAtResolution(a,t),i=D.transformStepAtResolution(i,t);var s=n[a],o=n[i];s&&s.anyOn()?r[a]=s:delete r[a],o&&o.anyOn()?r[i]=o:delete r[i]}}},{key:"syncMatrix",value:function(){this.stepBucketsMatrix={},this.tripletStepBucketsMatrix={};for(var e=0;e<this.stepBuckets.length;e++){var t=this.stepBuckets[e];t.anyOn()&&(this.stepBucketsMatrix[e]=t)}for(var n=0;n<this.tripletStepBuckets.length;n++){var r=this.tripletStepBuckets[n];r.anyOn()&&(this.tripletStepBucketsMatrix[n]=r)}this.needsSync=!1}},{key:"getBucket",value:function(e,t){e=(t=t||D).isTriplet?F.transformStepAtResolution2(e,t):D.transformStepAtResolution2(e,t);var n=this.isTransformed?this.transformedStepBuckets:this.stepBuckets;return t.isTriplet?this.tripletStepBuckets[e]:n[e]}},{key:"clear",value:function(){this.stepBuckets.map(function(e){return e.clear()}),this.syncBuckets(),this.clearCache()}},{key:"changeLength",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e=Math.ceil(e),this.stepBuckets=this.stepBuckets.slice(0,e);for(var n=this.stepBuckets.length;n<e;n++)this.stepBuckets.push(new p.a(this.track));this.updateStepResolutionTree(),this.clearCache(),t&&this.syncBuckets()}},{key:"length",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D;if(e===D)return e.isTriplet?this.tripletStepBuckets.length:this.stepBuckets.length;var t=e.isTriplet?this.tripletStepBuckets.length:this.stepBuckets.length;return e.isTriplet?Math.ceil(e.transformStepAtResolution2(t,F)):Math.ceil(e.transformStepAtResolution2(t,D))}},{key:"initBlankPattern",value:function(){for(var e=0;e<D.numSteps();e++)this.stepBuckets.push(new p.a(this.track)),this.stepFills.push(!1);if(!this.sequencerEngine.multiSequencerEngine)for(e=0;e<F.numSteps();e++)this.tripletStepBuckets.push(new p.a(this.track,!0)),this.tripletStepFills.push(!1)}},{key:"getFillsAtResolution",value:function(e){return e.isTriplet?e.transformList(this.tripletStepFills):e.transformList(this.stepFills)}},{key:"getStepsAtResolution",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=e.isTriplet?this.tripletStepBuckets:this.stepBuckets;if(!(e in this.transformBucketsIntoStepsCache)){var n=e.transformBucketsIntoSteps(t);return this.transformBucketsIntoStepsCache[e]=n,n}return this.transformBucketsIntoStepsCache[e]}},{key:"getAnyStep",value:function(e){for(var t in this.stepBuckets[e].steps){var n=this.stepBuckets[e].steps[t];if(n.on)return n}return this.stepBuckets[e].steps[0]}},{key:"getBucketsAtResolution",value:function(e){var t=e.isTriplet?this.tripletStepBuckets:this.stepBuckets;return e.transformList(t)}},{key:"setLength",value:function(e){this.stepBuckets=[];for(var t=0;t<e;t++)this.stepBuckets.push(new p.a(this.track));this.syncBuckets(!1)}},{key:"doubleTrackLength",value:function(){for(var e=this.stepBuckets.length,t=0;t<e;t++)this.stepBuckets.push(new p.a(this.track)),this.stepFills.push(!1);e=this.tripletStepBuckets.length;for(var n=0;n<e;n++)this.tripletStepBuckets.push(new p.a(this.track,!0)),this.tripletStepFills.push(!1);this.clearCache(),this.updateStepResolutionTree()}},{key:"halfTrackLength",value:function(){var e=this.length()/2;e<=1||(this.stepBuckets=this.stepBuckets.slice(0,e),this.stepFills=this.stepFills.slice(0,e),e=this.tripletStepBuckets.length/2,this.tripletStepBuckets=this.tripletStepBuckets.slice(0,e),this.tripletStepFills=this.tripletStepFills.slice(0,e),this.clearCache(),this.updateStepResolutionTree())}},{key:"loadFromJson",value:function(e){if(void 0===e.newVolume){var t=e.volume+40;this.volume=128*t/60}else this.volume=e.volume;this.panning="panning"in e?e.panning:0,this.muted=e.muted,this.loopsPlaying="loopsPlaying"in e?e.loopsPlaying:{},"startStep"in e&&(this.startStep=e.startStep),"repeats"in e&&(this.repeats=e.repeats),this.frozenPatternPlaying=e.frozenPatternPlaying}},{key:"calculateFillsHelper",value:function(e,t,n){n.isTriplet?this.tripletStepFills.fill(!1):this.stepFills.fill(!1);for(var r=t.length,a=0;a<r;a++){var i=-16;for(var s in t[a].steps){var o=t[a].getStep(s);if(o.on){var c=null==o.duration?e.duration:o.duration;i<(c=2*Math.floor(c))&&(i=c)}}if(!(i<1))for(var u=0;u<i;u++){var l=(a+u)%r;n.isTriplet?this.tripletStepFills[l]=!0:this.stepFills[l]=!0}}}},{key:"calculateFills",value:function(e){this.calculateFillsHelper(e,this.stepBuckets,D),this.calculateFillsHelper(e,this.tripletStepBuckets,F)}},{key:"getJson",value:function(){return{newVolume:!0,automations:this.mix.getJson(),volume:this.volume,panning:this.panning,muted:this.muted,loopsPlaying:this.loopsPlaying,startStep:this.startStep,repeats:this.repeats,frozenPatternPlaying:this.frozenPatternPlaying}}},{key:"getCopy",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.stepBuckets.length,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.track,i=new n(this.sequencerEngine,a);i.frozenPatternPlaying=this.frozenPatternPlaying,i.stepBuckets=[],i.mix=this.mix,i.tripletStepBuckets=[],i.volume=this.volume,i.panning=this.panning,i.muted=this.muted,i.steps=[],i.loopsPlaying={},Object.keys(this.loopsPlaying).map(function(t){return i.loopsPlaying[t]=e.loopsPlaying[t]});for(var s=this.getAllGroups(),o=t;o<r;o++){var c=this.stepBuckets[o].getCopy(a);i.stepBuckets.push(c),i.stepFills.push(this.stepFills[o])}var u,l=i.getAllSteps(),f=q(s);try{var h=function(){var t=u.value,n=l.filter(function(e){return e.group===t}),r=Object(w.e)(n,e.track,!0);Object(w.a)(t,r,a)};for(f.s();!(u=f.n()).done;)h()}catch(p){f.e(p)}finally{f.f()}return i.startStep=void 0===this.startStep?void 0:this.startStep+t,i.syncBuckets(),i.updateStepResolutionTree(),i}},{key:"chooseColor",value:function(e){this.color=e}},{key:"getUpdateStepsAction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.store.getState().sequencer.displayResolution,r=this.length(n),a=new Array(r).fill(!1),i={},s={},o={},c={},u={},l=new Array(r),h=this.getEasyPattern();e&&h.update(t);var p=n.isTriplet?this.tripletStepBucketsMatrix:this.stepBucketsMatrix;n.isTriplet?this.tripletStepBuckets:this.stepBuckets;if(this.track.sequencerEngine.state.groups.stepsGroupMode&&this.isTransformed)for(var d in p={},this.transformedStepBuckets){var v=this.transformedStepBuckets[d];if(v.anyOn()){var m=v.getAllOnSteps().find(function(e){return e.group});if(m&&Object(w.g)(m))continue;p[d]=v}}var y=n.isTriplet?new f.a(32,!0):new f.a(32,!1);for(var b in p){var g=Math.floor(n.transformStepAtResolution2(b,y));a[g]=!0;var O=y.resolution/n.resolution,k=(b-g*O)/O,j=[];if(void 0!==p[b]){for(var x in p[b].steps){var S=p[b].steps[x].getPolyphony();for(var P in S){var E=S[P];if(E.on){var T=Math.round(E.transpose),A=parseFloat(x)/O+k,M=new f.a(16,!1),R=n.transformStepAtResolution2(E.duration,M);T in i||(i[T]={},s[T]={},o[T]={}),j.push(E);var C=parseInt(g)+A;i[T][C]=!0,s[T][C]=0,o[T][C]=R}}}var N=p[b].getAllOnSteps()[0];for(var q in l[g]=N,u[g]=N&&N.group?N.group.id:void 0,j){var I=j[q];if(I.on){var _=I.transpose;null==_&&(_=this.trackData.transpose);for(var D=n.transformStepAtResolution2(I.duration,new f.a(16,!1)),F=0;F<D;F++){var L=(parseInt(g)+parseInt(F))%r;c[parseInt(L)]=!0}}}}}return this.sequencerEngine.midi&&this.sequencerEngine.cursor.track===this.trackNumber&&this.sequencerEngine.midi.updateSteps(a),{id:this.subSequence.isTrack?this.subSequence.id:this.track.id,trackNumber:this.subSequence.isTrack?this.subSequence.id:this.trackNumber,steps:a,pianoRollSteps:i,trackFills:c,stepToId:l,pianoRollPositions:s,pianoRollDurations:o,muted:this.track.muted,groups:u}}},{key:"getTrackStepsAction",value:function(){var e=this.store.getState().sequencer.displayResolution,t=this.length(e),n=new Array(t).fill(!1),r=e.isTriplet?this.tripletStepBucketsMatrix:this.stepBucketsMatrix,a=e.isTriplet?new f.a(32,!0):new f.a(32,!1);for(var i in r){n[Math.floor(e.transformStepAtResolution2(i,a))]=!0}return n}},{key:"trackPatternSteps",get:function(){var e=this.subSequence.isTrack?this.subSequence.id:this.trackNumber;return this.sequencerEngine.state.tracks.trackPatternSteps[e]||{}}},{key:"subSequence",get:function(){return this.track.subSequence}},{key:"trackNumber",get:function(){return this.track.trackNumber}},{key:"trackData",get:function(){return this.track.trackData}},{key:"getEasyPattern",value:function(){return new u.a(this,this.trackData)}},{key:"split",value:function(e){var t=e-this.startStep,r=(this.length(),new n(this.sequencerEngine,this.track));return r.stepBuckets=this.stepBuckets.slice(t),this.stepBuckets=this.stepBuckets.slice(0,t),r.startStep=e,this.syncBuckets(),r.syncBuckets(),r}},{key:"overlapsStep",value:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e>=this.startStep&&e<=this.startStep+this.length():e>=this.startStep&&e<this.startStep+this.length()}},{key:"addToStart",value:function(e){for(var t=[],n=0;n<e;n++)t.push(new p.a(this.track));this.stepBuckets=[].concat(t,Object(r.a)(this.stepBuckets)),this.syncBuckets()}},{key:"cutFromStart",value:function(e){this.stepBuckets=this.stepBuckets.slice(e),this.syncBuckets()}},{key:"dispose",value:function(){this.stepBuckets=void 0,this.tripletStepBuckets=void 0,this.stepBucketsMatrix=void 0,this.tripletStepBucketsMatrix=void 0,this.stepFills=void 0,this.tripletStepFills=void 0,this.mix=void 0,this.track=void 0}},{key:"getAllSteps",value:function(){var e=[],t=this.stepBuckets;for(var n in t){var r=t[n];for(var a in r.steps){var i=r.steps[a];e=e.concat(i.getPolyphony().filter(function(e){return e.on}))}}return e}}]),n}(function(e){Object(s.a)(n,e);var t=P(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).transformedStepBuckets=[],e.isTransformed=!1,e}return Object(i.a)(n,[{key:"stepGroups",get:function(){return this.track.stepGroups}},{key:"transform",value:function(){this.isTransformed=!0;var e,t=Object(r.a)(this.stepBuckets),n=x(this.getAllGroups());try{for(n.s();!(e=n.n()).done;){var a,i=e.value,s=x(i.transformations);try{for(s.s();!(a=s.n()).done;){var o=a.value;Object(w.h)(o)&&(t=E(t,i,o))}}catch(c){s.e(c)}finally{s.f()}}}catch(c){n.e(c)}finally{n.f()}this.transformedStepBuckets=t}},{key:"getAllGroups",value:function(){return Array.from(new Set(this.getAllSteps().map(function(e){return e.group}))).filter(function(e){return e})}}]),n}(function(){return function e(){Object(a.a)(this,e)}}()));t.a=B},,function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(166),u=n(355),l=n(414);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e,a,i){var s;return Object(r.a)(this,n),(s=t.call(this,e,a.getType())).event=a,s.duration=i,s}return Object(a.a)(n,[{key:"addEvent",value:function(e,t,n){e.isDeterministic()?new l.a(this.mix,e,t,n).execute():new u.a(this.mix,e,t,n).execute()}},{key:"execute",value:function(){if(!isNaN(this.event.step)){for(var e in this.events){var t=this.events[e];if(!t.isPrunable()&&void 0!==t.duration&&t.step<this.event.step&&t.step+t.duration>this.duration+this.event.step){var n=t.getCopy(this.mix.sequencerEngine);return n.step=this.event.step,void this.addEvent(n,0,n.step)}}this.addEvent(this.event,0,this.event.step)}}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";n.d(t,"e",function(){return m}),n.d(t,"f",function(){return g}),n.d(t,"h",function(){return O}),n.d(t,"i",function(){return k}),n.d(t,"d",function(){return P}),n.d(t,"c",function(){return E}),n.d(t,"a",function(){return T}),n.d(t,"b",function(){return A}),n.d(t,"g",function(){return M});var r=n(1),a=n(11),i=n(20),s=n(272),o=n(142),c=n(123),u=n(14),l=n(523),f=(n(7),n(23));function h(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d=0,v={},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(arguments.length>2?arguments[2]:void 0);else{if(e.every(function(e){return e.group}))return;if(e.some(function(e){return e.group})){var n,r=e.find(function(e){return e.group}).group,a=h(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;i.group!==r&&(r.steps.push(i),i.group=r)}}catch(o){a.e(o)}finally{a.f()}return t.sequencerEngine.dispatch(Object(f.m)(r)),r}}var s=y(e);return e.forEach(function(e){return e.group=s}),t.stepGroups.push(s),t.sequencerEngine.dispatch(Object(f.m)(s)),s},y=function(e,t){var n={id:Object(i.uuid)(),name:"Group "+ ++d,steps:e,transformations:[]};return b(n,t),n},b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.steps[0].track,n=S("Conditional ",t,0,100),r=S("Action Amount",t,-32,32),a=S("Aux Value",t,0,100,100),s={id:Object(i.uuid)(),whenType:l.j,whenValue:n,thenType:void 0,thenValue:r,probabilityBit:!0,loopCounter:-1,auxValue:a,auxProbabilityBit:!0,midiEffect:void 0};return v[s.id]=s,e.transformations.push(s),s},g=function(e){var t,n=h(e.transformations);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=r.whenType,i=r.whenValue,s=r.auxValue;if(r.loopCounter++,r.previousProbabilityBit=r.probabilityBit,r.previousAuxBit=r.auxBit,a===l.j){var o=Math.random()<i.get()/100;r.probabilityBit=o}else if(a===l.g||a===l.h){var c=Math.random()<Math.abs(s.get())/100;r.auxProbabilityBit=c}}}catch(u){n.e(u)}finally{n.f()}},O=function e(t){if(!t)return!1;var n=t.whenValue.get();if(t.whenType===l.j)return t.probabilityBit;if(t.whenType===l.c)return t.loopCounter%n===n-1;if(t.whenType===l.g){var r=v[n];return t.auxValue.get()>=0?t.auxProbabilityBit&&e(r):t.auxProbabilityBit&&!e(r)}return!1},k=function(e,t,n,r){if(t.transformations.every(function(e){return!O(e)}))return{step:e,time:n};var i=Object(a.a)(t.transformations);i.sort(function(e,t){return l.i.indexOf(e.thenType)-l.i.indexOf(t.thenType)});var s,c=h(i);try{for(c.s();!(s=c.n()).done;){var u=s.value;if(O(u))if(u.thenType===l.k)e=j(e,t);else if(u.thenType===l.n)e=w(e,u.thenValue.get());else if(u.thenType===l.b)e=x(e,u.thenValue.get());else if(u.thenType===l.m){u.midiEffect.onNewStep(),u.midiEffect.input(new o.a(e,n,r));var f=u.midiEffect.output(n,r,r);return 0===f.length?{time:n,step:e}:{time:f[0].time,step:f[0].stepData}}}}catch(p){c.e(p)}finally{c.f()}return{time:n,step:e}},j=function(e,t){var n=t.steps.indexOf(e),r=Object(a.a)(t.steps);return r.reverse(),r[n]},w=function(e,t){return(e=e.getCopy()).transpose+=t,e},x=function(e,t){return(e=e.getCopy()).duration*=t,e},S=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=new u.a(e,t,function(){return 0},{defaultValue:a,min:n,max:r,doNotDispose:!0});return i.setContext((new c.a).forTrack(t)),i},P=function(e){var t,n=Object(r.a)({},e,{transformations:[],steps:void 0}),a=h(e.transformations);try{for(a.s();!(t=a.n()).done;){var i=t.value,s=Object(r.a)({},i,{copiedFrom:void 0,copiedTo:void 0});s.whenValue=i.whenValue.getJson(),s.thenValue=i.thenValue.getJson(),s.auxValue=i.auxValue.getJson(),i.midiEffect&&(s.midiEffect=i.midiEffect.getJson()),n.transformations.push(s)}}catch(o){a.e(o)}finally{a.f()}return n},E=function(e,t){var n=y([],t);n.name=e.name,n.id=e.id;var r,a=0,i=h(e.transformations);try{for(i.s();!(r=i.n()).done;){var o=r.value;n.transformations[a].id=o.id,n.transformations[a].whenType=o.whenType,n.transformations[a].thenType=o.thenType,n.transformations[a].whenValue.fromJson(o.whenValue),n.transformations[a].thenValue.fromJson(o.thenValue),o.auxValue&&n.transformations[a].auxValue.fromJson(o.auxValue),o.midiEffect&&(n.transformations[a].midiEffect=Object(s.a)(o.midiEffect,t),n.transformations[a].midiEffect.fromJson(o.midiEffect)),v[o.id]=n.transformations[a],a<e.transformations.length-1&&b(n,t),a++}}catch(c){i.e(c)}finally{i.f()}return n},T=function(e,t,n){for(var r=0;r<e.transformations.length;r++){var a=e.transformations[r],i=t.transformations[r];i.whenType=a.whenType,i.thenType=a.thenType,i.whenValue.copyFrom(a.whenValue),i.thenValue.copyFrom(a.thenValue),a.midiEffect&&(i.midiEffect=a.midiEffect.getCopy(n,!0)),a.copiedTo=i,i.copiedFrom=a;var s=a.whenValue.get();if(a.whenType===l.g&&s){var o=v[s];o&&o.copiedTo&&i.whenValue.set(o.copiedTo.id)}r<e.transformations.length-1&&b(t,n)}},A=function(e){e.group&&(e.group.steps=e.group.steps.filter(function(t){return t!==e}),e.group=void 0)},M=function(e){if(e.group){var t=e.group.transformations.find(function(e){return e.thenType===l.e});return!!t&&O(t)}return!1}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(11),a=n(133),i=n(20),s=[],o=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(a.c)(e).slice(0,1),o=(Object(i.uuid)(),function(e){n=[e].concat(Object(r.a)(n))});return Object(a.d)(e,o,t),function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])return Object(a.e)(e,o);if(0===n.length)return s;var t=Object(r.a)(n);return n=[],t}}},function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"l",function(){return u}),n.d(t,"o",function(){return l}),n.d(t,"g",function(){return f}),n.d(t,"i",function(){return h}),n.d(t,"j",function(){return p}),n.d(t,"d",function(){return d}),n.d(t,"c",function(){return v}),n.d(t,"f",function(){return m}),n.d(t,"e",function(){return y}),n.d(t,"k",function(){return b}),n.d(t,"m",function(){return g}),n.d(t,"h",function(){return O}),n.d(t,"n",function(){return k}),n.d(t,"a",function(){return j});var r=n(11),a=n(111),i=n(20);function s(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var s=a.A.apply(void 0,[e].concat(r)),o=a.A.apply(void 0,[t].concat(r));return s.push(o),Object(a.w)(!0)}},u=function(e,t,n){return function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];var o=a.A.apply(void 0,[e].concat(i));if(o){var c=a.A.apply(void 0,[t].concat(i)),u=void 0;return n&&(u=a.A.apply(void 0,[n].concat(i))),o.slice(c,Math.max(1,u%(o.length+1)))}return 0}},l=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=t;return 1===t.length&&(i=Array.isArray(t[0])?t[0]:a.A.apply(void 0,[t[0]].concat(n))),i.reduce(function(e,t){return a.A.apply(void 0,[t].concat(n)).map(function(t,n){return t+e[n%e.length]})},[0])}},f=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=a.A.apply(void 0,[e].concat(n));return i?i.length:0}},h=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var s=a.A.apply(void 0,[e].concat(r)),o=t;return s.map(o)}},p=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];if(!r[0])return t[0];var s=a.A.apply(void 0,[t].concat(r));return s[a.A.apply(void 0,[e].concat(r))%s.length]}},d=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=a.A.apply(void 0,[e].concat(n));return i?i.slice(1):[]}},v=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=a.A.apply(void 0,[e].concat(n));if(i)return i[0]}},m=function(e){var t=void 0,n=void 0;return function(){for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];var l=a.A.apply(void 0,[e].concat(c));if(l===n)return t;var f,h=[],p=s(l);try{for(p.s();!(f=p.n()).done;){var d=f.value;d=a.A.apply(void 0,[d].concat(c)),Array.isArray(d)?h=[].concat(Object(r.a)(h),Object(r.a)(d)):d&&(d.id&&(d.id=Object(i.uuid)()),h=[].concat(Object(r.a)(h),[d]))}}catch(v){p.e(v)}finally{p.f()}return t=h,n=l,h}},y=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=void 0,c=void 0;return function(){var e=[];if(o===t)return c;o=t;for(var n=arguments.length,u=new Array(n),l=0;l<n;l++)u[l]=arguments[l];var f,h=s(t);try{for(h.s();!(f=h.n()).done;){var p=f.value;p=a.A.apply(void 0,[p].concat(u)),Array.isArray(p)?e=[].concat(Object(r.a)(e),Object(r.a)(p)):(p.id&&(p.id=Object(i.uuid)()),e=[].concat(Object(r.a)(e),[p]))}}catch(d){h.e(d)}finally{h.f()}return c=e}},b=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=void 0,c=void 0;return function(){for(var e=arguments.length,n=new Array(e),u=0;u<e;u++)n[u]=arguments[u];var l=t.map(function(e){return a.A.apply(void 0,[e].concat(n))});if(o&&o.every(function(e,t){return e===l[t]}))return c;o=l;var f,h=[],p=s(l);try{for(p.s();!(f=p.n()).done;){var d=f.value;Array.isArray(d)?h=[].concat(Object(r.a)(h),Object(r.a)(d)):d&&(d.id&&(d.id=Object(i.uuid)()),h=[].concat(Object(r.a)(h),[d]))}}catch(v){p.e(v)}finally{p.f()}return c=h}},g=function(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var s=a.A.apply(void 0,[e].concat(n));return(s=Object(r.a)(s[0])).reverse(),[s]}},O=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=[],n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];var u,l=s(t);try{for(l.s();!(u=l.n()).done;){var f=u.value;(f=a.A.apply(void 0,[f].concat(o))).id&&(f.id=Object(i.uuid)()),e=[].concat(Object(r.a)(e),[f])}}catch(h){l.e(h)}finally{l.f()}return e}},k=function(e,t,n){return function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];var o=a.A.apply(void 0,[e].concat(i));if(o){var c=a.A.apply(void 0,[t].concat(i)),u=void 0;return n&&(u=a.A.apply(void 0,[n].concat(i))),[o[0].slice(c,Math.max(1,u%(o[0].length+1)))]}return 0}},j=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];for(var o=a.A.apply(void 0,[e].concat(i)),c=(a.A.apply(void 0,[t].concat(i)),a.A.apply(void 0,[n].concat(i))),u=[o[0]],l=1;l<o.length;l++)l%t===c&&u.push(o[l]);return u}}},function(e,t,n){"use strict";n.d(t,"e",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"d",function(){return s}),n.d(t,"b",function(){return o});var r=0,a=1,i=2,s=3,o={3:[". -","- ."],4:[". . -",". - .","- . .","- -"],5:[". . . -",". . - .","- - .",". - -"]}},,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(3),u=n.n(c);function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var f=function(e){Object(i.a)(n,e);var t=l(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){return this.props.condition?this.props.children:u.a.createElement("div",null)}}]),n}(c.Component);t.a=f},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(116),f=n(119),h=n(7),p=n.n(h),d=n(112);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(o.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Delay",function(){return new p.a.FeedbackDelay(new p.a.Time("16n"),.5)},e)).delayTime="16n",r.rateParameter=new d.a("Delay Rate",r.effectNode.delayTime,function(e,t){r.rawDelayRate=t,"number"===typeof t&&(t/=1e3),t._val&&(t="object"==typeof t._val?new p.a.Time(t._val._val):new p.a.Time(t._val)),r.effectNode.delayTime.linearRampToValueAtTime(new p.a.Time(t),.001)},{documentation:"The time between each individual echo",min:1e-4,max:1,unit:"",defaultValue:new p.a.Time("8n")}),r.rawDelayRate="8n",r.isSynced=!0,r.registerParameter(r.rateParameter),r.feedbackParameter=new d.b("Feedback",r.effectNode.feedback),r.registerParameter(r.feedbackParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"documentation",get:function(){return"A basic echo effect."}},{key:"rate",get:function(){return this.rateParameter.get(!0)},set:function(e){this.rateParameter.set(e)}},{key:"setFeedback",value:function(e){this.feedbackParameter.set(e)}},{key:"getFeedback",value:function(){return this.effectNode?this.effectNode.feedback.value:0}},{key:"onBPMUpdated",value:function(){this.isSynced&&this.rateParameter.set(this.rawDelayRate,!0)}},{key:"getDelayTime",value:function(){return this.delayTime}},{key:"getJson",value:function(){var e=this.rate;"object"===typeof e&&e.toSeconds&&(e=this.rate.toSeconds());var t=Object(r.a)({},Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),feedback:this.effectNode.feedback.value,isSynced:this.isSynced,rate:e,rawDelayRate:this.rawDelayRate});return t=this.saveParameterToJson(t,"feedbackParameter",this.feedbackParameter),t=this.saveParameterToJson(t,"rateParameter",this.rateParameter)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return"feedback"in e&&Object(f.a)(this.feedbackParameter,e.feedback,a),"delayTime"in e&&Object(f.a)(this.rateParameter,e.delayTime,a),"rate"in e&&Object(f.a)(this.rateParameter,e.rate,a),"rawDelayRate"in e&&(this.rawDelayRate=e.rawDelayRate),"isSynced"in e&&(this.isSynced=e.isSynced),Object(r.a)({},a,this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter,t),this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t))}}]),n}(l.a.Effect);t.a=m},function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return i});var r=12;function a(e){return Math.exp(1-1/Math.pow(e,1.01))}function i(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-200,s=e/n;if(s>=.75){var o=a*(1-Math.log(.75)/Math.log(.6));return o+=(a-o)*(s-.75)/.25}var c=a*(1-Math.log(s)/Math.log(.6));return isNaN(c)?i:c}window.q=.5,window.maxVolume=6},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(7),o=n.n(s),c=n(274),u=n(34),l=n(23),f=(n(125),n(340)),h=n(1821),p=(n(556),n(912)),d=n(197);n(138);function v(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"b",function(){return b}),n.d(t,"c",function(){return g}),n.d(t,"a",function(){return O}),n.d(t,"d",function(){return x});var y=["A","B","C","D"],b=function(e,t){return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return 48,n.t0=r,n.next=4,k({sequencerEngine:e,lenInBars:48,track:t,numPatterns:t.patterns.length,bounceType:"BOUNCE_INSTRUMENT",download:!1});case 4:n.t1=n.sent,(0,n.t0)(n.t1),e.subSequences.forEach(function(e){return e.mix.updateAllTypeRedux()});case 7:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())},g=function(e,t){return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,o;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:for(o in s=0,t.patterns)s+=x(e,parseInt(o),[t])/32;return s*=e.state.freeze.loops,n.t0=r,n.next=6,k({sequencerEngine:e,lenInBars:s,track:t,numPatterns:t.patterns.length,bounceType:"BOUNCE_PATTERNS",download:!1});case 6:n.t1=n.sent,(0,n.t0)(n.t1),e.subSequences.forEach(function(e){return e.mix.updateAllTypeRedux()});case 9:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())},O=function(e,t){return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,o,c;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:for(c in s=0,o=t.slots.filter(function(e){return e}),console.log("bouncepad tracks = ",o),o[0].patterns)s+=x(e,parseInt(c),o)/32;return s*=e.state.freeze.loops,n.t0=r,n.next=8,k({sequencerEngine:e,lenInBars:s,pad:t.id,numPatterns:o[0].patterns.length,subSequence:e.currentSubSequence,bounceType:"BOUNCE_PATTERNS",download:!1,includeSends:!0,tracks:o});case 8:n.t1=n.sent,(0,n.t0)(n.t1),e.subSequences.forEach(function(e){return e.mix.updateAllTypeRedux()});case 11:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())},k=function(e){var t=e.title,n=e.sequencerEngine,r=e.lenInBars,s=void 0===r?4:r,c=e.subSequence,u=e.group,m=e.pad,b=e.numPatterns,g=e.send,O=e.download,k=void 0===O||O,x=e.track,T=e.bounceType,A=e.includeSends,M=void 0!==A&&A,R=e.tracks,C=e.uploadToIpfs;return new Promise(function(e){var r,O=s*new o.a.Time("1n").toMilliseconds()/1e3;n.stop(),o.a.Offline(function(e){(r=new h.default(n.store,!0,e,n.aubio,!0,!0)).isOffline=!0,console.log("offline",r),n.store.dispatch(Object(l.pc)(r)),window.sequencerEngine=r,n.store.dispatch(Object(l.Kb)(!0));var t=new p.a(r);for(var a in T||(r.mix=n.mix),r.setScripting(t),r.bpm=n.bpm,r.bpmParameter.id=n.bpmParameter.id,r.bpmParameter.min=n.bpmParameter.min,r.bpmParameter.max=n.bpmParameter.max,r.sends.copyFrom(n.sends),T||r.channelMixer.masterChannel.copyFrom(n.channelMixer.masterChannel),void 0!==g&&r.sends.sends.filter(function(e,t){return t!==g}).forEach(function(e){e.outputVolume.disconnect()}),void 0===u&&void 0===x||M||r.sends.sends.forEach(function(e){return e.outputVolume.disconnect()}),n.switchToSubSequence(n.subSequences[0].id),r.subSequences[0].id=n.subSequences[0].id,n.subSequences)if((!c||c.id===n.subSequences[a].id)&&(!x||n.subSequences[a].tracks.some(function(e){return e.id===x.id}))){if(a>0){var i=r.newSubSequence();i.id=n.subSequences[a].id,r.switchToSubSequence(i.id),n.switchToSubSequence(i.id)}r.currentSubSequence.midiEffects.fromJson(n.currentSubSequence.midiEffects.getJson()),r.lfos.forEach(function(e,t){return e.lfo.fromJson(n.lfos[t].lfo.getJson())}),r.envelopes.forEach(function(e,t){return e.fromJson(n.envelopes[t].getJson())}),"BOUNCE_PATTERNS"===T?S(n,b,r.currentSubSequence.mix,u||m?R:[x]):"BOUNCE_INSTRUMENT"===T?E(n,b,r.currentSubSequence.mix,u?R:[x]):r.currentSubSequence.mix=n.currentSubSequence.mix;var s=n.groups;for(var o in s.groups){var f=s.groups[o];if(void 0!==g&&f.tracks.every(function(e){return e.sendNodeVolumeParameters[g].get()<=-80&&Object.values(e.sendNodeVolumeParameters[g]).every(function(e){return e<=-80})}),void 0===u||o===u||!f.tracks.every(function(e){return 0===e.connectedEnvelopes.length})){var d=r.groups.newGroup();if(d.setVolume(f.volume),d.setPanning(f.panning),void 0===x||f===x.group||!f.tracks.every(function(e){return 0===e.connectedEnvelopes.length})){var y=f.effectsChain.effects.map(function(e){return e.getEffectCopy(r,!1)});for(var O in d.effectsChain.updateEffects(y),f.tracks){var k=f.tracks[O].getCopy(void 0,r,!1);!m||f.tracks[O].pad&&f.tracks[O].pad.id===m?x&&f.tracks[O]!==x&&0==f.tracks[O].connectedEnvelopes.length||(console.log("ADDING TRACK TO BOUNCE ENGINE =",k),r.setupNewTrack(k,void 0,void 0,!1,!0),k.setupEffects(),d.addTrack(k),k.trackNumber=f.tracks[O].trackNumber,x&&f.tracks[O]!==x&&k.gainNode.disconnect(),"BOUNCE_INSTRUMENT"===T&&P(k)):(console.log("BOUNCE PAD NOT MATCH"),console.log("track.pad=",f.tracks[O].pad,m))}void 0!==g&&d.outputNode.disconnect(),void 0!==u&&(r.currentSubSequence.id===c.id&&u===o||d.outputNode.disconnect())}}}r.tracks.sort(function(e,t){return e.trackNumber-t.trackNumber}),r.currentSubSequence.loadPadsJson(n.currentSubSequence.getPadsJson())}r.loadInletConnections(n.state.windows.inletConnections),r.higherOrderSequencer.fromJson(n.higherOrderSequencer.getJson());var j,w=v(r.subSequences);try{for(w.s();!(j=w.n()).done;){j.value.loadLostParameters(!0)}}catch(A){w.e(A)}finally{w.f()}console.log("PLAYING"),r.loadNewSequence(),r.play()},O).then(function(){var s=Object(i.a)(a.a.mark(function i(s){var o,h;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(new d.a(2,function(t,n,a){e(r),window.open("http://zequencer.io:8080/ipfs/"+n,"_blank")}),o="Exported Song.wav",void 0!==g&&(o="Send "+y[g]+".wav"),void 0!==u&&(o="Group "+(parseInt(u)+1)+" ("+c.name+").wav"),t&&(o=t+" "+o),!C){a.next=10;break}return a.next=8,w(s);case 8:a.next=16;break;case 10:if(!k){a.next=16;break}return h=[s.getChannelData(0),s.getChannelData(1)],a.next=14,Object(f.a)(h);case 14:h=a.sent,j(h,o);case 16:n.store.dispatch(Object(l.Kb)(!1)),r.stop(),window.sequencerEngine=n,n.store.dispatch(Object(l.pc)(void 0)),r.dispose(),n.updateSteps(),e(s);case 23:case"end":return a.stop()}},i)}));return function(e){return s.apply(this,arguments)}}())})},j=function(){var e=document.createElement("a");return document.body.appendChild(e),e.style="display: none",function(t,n){var r=new Blob([t],{type:"audio/wav"}),a=window.URL.createObjectURL(r);e.href=a,e.download=n,e.click(),window.URL.revokeObjectURL(a)}}(),w=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new d.a(2,function(e,t,n){return[]}),e.next=3,n.uploadBufferToIpfs(t);case 3:r=e.sent,window.exportIpfsHash=r;case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),x=function(e,t,n){var r,a=-10,i=v(n);try{for(i.s();!(r=i.n()).done;){var s,o=v(r.value.patterns);try{for(o.s();!(s=o.n()).done;){var c=s.value.length();c>a&&(a=c)}}catch(u){o.e(u)}finally{o.f()}}}catch(u){i.e(u)}finally{i.f()}return a},S=function(e,t,n,r){for(var a=e.state.freeze.loops,i=0,s=0;s<t;s++){var o=x(e,s,r)*a,l=new u.a(s);l.step=i,n.dispatch(Object(c.f)(l,o)),i+=o}},P=function(e){var t=e.pattern;t.doubleTrackLength(),e.patterns=[];for(var n=0;n<24;n++){var r=t.getCopy();r.clear(),r.addNote(0,16,3*n-12),e.patterns.push(r)}e.pattern=e.patterns[0]},E=function(e,t,n,r){e.state.freeze.loops;for(var a=0,i=0;i<32;i++){var s=new u.a(i);s.step=a,n.dispatch(Object(c.f)(s,64)),a+=64}}},function(e,t,n){"use strict";var r=n(418),a=n(423),i=n(424),s=n(585),o=n(587),c=n(588),u=n(589),l=n(923),f=n(426),h=n(591),p=n(427),d=n(593),v=n(359),m=n(429),y=n(596),b=n(597),g=n(306),O=n(276),k=n(598),j=n(599),w=n(600),x=n(601),S=n(602),P=n(603),E=n(604),T=n(605),A=n(606),M=n(607),R=n(608),C=n(609),N=n(610),q=n(568),I=n(803),_=n(924),D=n(567),F=n(807),L=n(808),B=n(809),z=n(810),J=n(811),V=n(812),H=n(925),U=n(813),G=n(573),W=n(915),K=n(307),Q=n(1),Z=n(4),Y=n(5),X=n(10),$=n(6),ee=n(8),te=n(2),ne=n(135),re=n(7);function ae(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ie(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function se(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(te.a)(e);if(t){var a=Object(te.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(ee.a)(this,n)}}var oe=new(n.n(re).a.Time)("32n"),ce=function(e){Object($.a)(n,e);var t=se(n);function n(e){var r;return Object(Z.a)(this,n),(r=t.call(this,"Split",e)).numberOfOutputs=2,r}return Object(Y.a)(n,[{key:"value",get:function(){return this.numberOfOutputs},set:function(e){e>0&&(this.numberOfOutputs=e)}},{key:"getText",value:function(){return this.numberOfOutputs}},{key:"getJson",value:function(){return Object(Q.a)({},Object(X.a)(Object(te.a)(n.prototype),"getJson",this).call(this),{numberOfOutputs:this.numberOfOutputs})}},{key:"fromJson",value:function(e){Object(X.a)(Object(te.a)(n.prototype),"fromJson",this).call(this,e),e.numberOfOutputs&&(this.numberOfOutputs=e.numberOfOutputs)}},{key:"output",value:function(e,t){var n,r=[],a=ae(this.triggers);try{for(a.s();!(n=a.n()).done;){var i=n.value,s=i.stepData,o=i.time,c=s.duration;s.duration=c/this.numberOfOutputs,r.push(i);for(var u=1;u<this.numberOfOutputs;u++){var l=this.copyTrigger(i);o+=oe*(c/(this.numberOfOutputs/2)),l.time=o,l.outputNumber=u,r.push(l)}}}catch(f){a.e(f)}finally{a.f()}return r}}]),n}(ne.a),ue=function(e){Object($.a)(n,e);var t=se(n);function n(e){var r;return Object(Z.a)(this,n),(r=t.call(this,"Flat",e)).value=1,r}return Object(Y.a)(n,[{key:"output",value:function(){var e=this,t=this.triggers||[];this.active=t.length>0;var n,r=ae(t);try{for(r.s();!(n=r.n()).done;){n.value.stepData.voices.forEach(function(t){return t.flat=e.value})}}catch(a){r.e(a)}finally{r.f()}return t}}]),n}(K.g),le=function(e){Object($.a)(n,e);var t=se(n);function n(e){var r;return Object(Z.a)(this,n),(r=t.call(this,"Thick",e)).value=1,r}return Object(Y.a)(n,[{key:"output",value:function(){var e=this,t=this.triggers||[];this.active=t.length>0;var n,r=ae(t);try{for(r.s();!(n=r.n()).done;){n.value.stepData.voices.forEach(function(t){return t.thick=e.value})}}catch(a){r.e(a)}finally{r.f()}return t}}]),n}(K.g),fe=n(522);n.d(t,"b",function(){return he}),n.d(t,"a",function(){return pe});var he={Accumulator:function(e){return new u.a(e)},Arpeggiator:function(e){return new r.a(e)},Beat:function(e){return new C.a(e)},"Control Parameters":function(e){return new I.a(e)},"Conditional Parameters":function(e){return new _.a(e)},"Plane Parameters":function(e){return new D.a(e)},Every:function(e){return new w.a(e)},Limit:function(e){return new j.a(e)},Parameterizer:function(e){return new a.a(e)},Timing:function(e){return new i.a(e)},"Midi Outputter":function(e){return new l.a(e)},"Midi CC":function(e){return new x.a(e)},"Midi Interface":function(e){return new p.a(e)},Harmony:function(e){return new m.a(e)},"Alternate Tuning":function(e){return new b.a(e)},"Micro Tuning":function(e){return new y.a(e)},"Midi Delay":function(e){return new d.a(e)},"Chord Rhythm":function(e){return new f.a(e)},"Chord Sculptor":function(e){return new h.a(e)},Warp:function(e){return new g.a(e)},Tidal:function(e){return new O.a(e)},"Linked Tidal":function(e){return new k.a(e)},"Midi Effect Rack":function(e){return new v.a(e)},"Beat Repeat":function(e){return new E.a(e)},"Pattern Switch":function(e){return new L.a(e)},Steps:function(e){return new S.a(e)},Notes:function(e){return new P.a(e)},Grab:function(e){return new T.a(e)},"Grab Time":function(e){return new A.a(e)},Alternate:function(e){return new M.a(e)},Scale:function(e){return new F.a(e)},Flush:function(e){return new s.a(e)},Message:function(e){return new o.a(e)},"User Script":function(e){return new q.a(e)},Threshold:function(e){return new N.a(e)},Roll:function(e){return new J.a(e)},"Alternate N":function(e){return new R.a(e)},Density:function(e){return new z.a(e)},Poly:function(e){return new B.a(e)},"Note Display":function(e){return new c.a(e)},Sparse:function(e){return new U.a(e)},"Midi Gate":function(e){return new V.a(e)},Stats:function(e){return new H.a(e)},Jaki:function(e){return new G.a(e)},Figure:function(e){return new fe.g(e)},Max:function(e){return new fe.m(e)},First:function(e){return new fe.h(e)},Last:function(e){return new fe.j(e)},"Dash 1":function(e){return new fe.c(e)},"Dash 2":function(e){return new fe.d(e)},Dot:function(e){return new fe.e(e)},Accent:function(e){return new fe.a(e)},Staccato:function(e){return new fe.u(e)},Piano:function(e){return new fe.p(e)},Pianissimo:function(e){return new fe.o(e)},Rest:function(e){return new fe.s(e)},Otherwise:function(e){return new fe.n(e)},Legato:function(e){return new fe.l(e)},"R.Every":function(e){return new fe.q(e)},Double:function(e){return new fe.f(e)},Later:function(e){return new fe.k(e)},Skip:function(e){return new fe.t(e)},Any:function(e){return new fe.b(e)},Times:function(e){return new fe.v(e)},Flam:function(e){return new fe.i(e)},Regular:function(e){return new fe.r(e)},"Chord Type":function(e){return new K.b(e)},"Generative Chords":function(e){return new W.a(e)},Voice:function(e){return new K.f(e)},Octave:function(e){return new K.c(e)},Split:function(e){return new ce(e)},Flat:function(e){return new ue(e)},Thick:function(e){return new le(e)}};function pe(e,t){if(e.name in he)return he[e.name](t)}},,function(e,t,n){"use strict";n.d(t,"f",function(){return a}),n.d(t,"b",function(){return i}),n.d(t,"a",function(){return s}),n.d(t,"h",function(){return o}),n.d(t,"c",function(){return c}),n.d(t,"e",function(){return u}),n.d(t,"g",function(){return l}),n.d(t,"d",function(){return f});var r=n(581),a=function(e,t){return{type:r.h,payload:{event:e,duration:t}}},i=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:r.b,payload:{event:e,inPlace:t}}},s=function(e,t){return{type:r.a,payload:{event:e,subEvent:t}}},o=function(e,t,n,a){return{type:r.m,payload:{step:e,selection:t,eventType:n,track:a}}},c=function(e){return{type:r.c,payload:{selection:e}}},u=function(e,t){return{type:r.e,payload:{selection:e,eventType:t}}},l=function(e,t,n){return{type:r.l,payload:{track:e,pattern:t,step:n}}},f=function(e,t){return{type:r.d,payload:{track:e,pattern:t}}}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(14);function u(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=f(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"initDisabledParameters",value:function(){var e=this;this.parametersDisabledParameter=new c.a("parametersDisabled",this,function(t,n){return e.parametersDisabledChanged(n)},{defaultValue:[]}),this.registerParameter(this.parametersDisabledParameter)}},{key:"parametersDisabled",get:function(){return this.parametersDisabledParameter.get(!0)}},{key:"parametersDisabledChanged",value:function(e){var t,n={},r=u(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=this.initialParameterValues[a];if(void 0!==i&&this._parameters[a])n[this._parameters[a].set(i,!0,!0,void 0,this.rampTime/1e3).id]=i}}catch(s){r.e(s)}finally{r.f()}this.setEffectParameterValues(n)}}]),n}(e)}},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(31),o=n(10),c=n(6),u=n(8),l=n(2),f=(n(135),n(157)),h=n(129),p=n(63),d=n(430),v=n(21),m=n(141),y=n(431),b=n(147),g=n(14),O=n(142),k=n(306),j=n(7),w=n.n(j);function x(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}window.tidalTimes=[],window.lazyTidals=0,window.nolazyTidals=0;new w.a.Time("16n");var E=new w.a.Time("32n"),T=function(e){Object(c.a)(n,e);var t=P(n);function n(e,r,i){var o;return Object(a.a)(this,n),(o=t.call(this,e,!1,5)).zObject=i,o.tidalCache={},o.scriptEffect=r,o.name="Tidal",o.cycleParameter=new g.a("cycle",Object(s.a)(o),function(e,t){if(t){var n=e.clearVariables();e.handleVariables(t,n),o.tidalCache={},o.needsUpdate=!0}},{defaultValue:void 0,min:!1,max:!0,unit:"",automatable:!1}),o.registerParameter(o.cycleParameter),o.warpLengthParameter.automatable=!1,o.warpFactorParameter.automatable=!1,o.loopLengthParameter.automatable=!1,o.resolutionParameter.automatable=!1,o.resolutionParameter.hide=!0,o.warpLengthParameter.hide=!0,o.warpFactorParameter.hide=!0,o.loopLengthParameter.hide=!0,o.durationFactorParameter.hide=!0,o.smoothnessParameter.hide=!0,o.cycleLengthParameter=new g.a("cycleLength",Object(s.a)(o),function(e,t){o.tidalCache={}},{documentation:"The number of 1/32th steps per cycle",prettyName:"Cycle Length",defaultValue:32,min:4,max:64,unit:""}),o.registerParameter(o.cycleLengthParameter),o.lengthFactorParameter=new g.a("lengthFactor",Object(s.a)(o),function(e,t){return[]},{documentation:"Multiplies the speed of the cycle",defaultValue:1,prettyName:"Speed Factor",min:.25,max:8,unit:""}),o.registerParameter(o.lengthFactorParameter),o.accentParameter="velocity",o.accentFactorParameter=new g.a("accentFactor",Object(s.a)(o),function(e,t){return[]},{documentation:"Multiplies the speed of the cycle",defaultValue:2,prettyName:"Accent Factor",min:0,max:2,unit:""}),o.registerParameter(o.accentFactorParameter),o.staccatoFactorParameter=new g.a("staccatoFactor",Object(s.a)(o),function(e,t){return[]},{documentation:"Multiplies the speed of the cycle",defaultValue:.2,prettyName:"Staccato Factor",min:0,max:2,unit:""}),o.registerParameter(o.staccatoFactorParameter),o.cycleRetrigger=!0,o.resolution=new v.a(32,!1),o.cycle=Object(b.g)("[0 12 ~ 12]"),o.numberOfOutputs=2,o.lastLeaf=void 0,o.newInlet("cycle length",function(e){return o.onCycleLength(e[0])}),o.newInlet("set variable",function(e){return o.onVariableSet(e[0])}),o.newOutlet(h.b),o}return Object(i.a)(n,[{key:"lockGroove",value:function(e){this.cycleParameter.immutable=e,this.cycleLengthParameter.immutable=e}},{key:"onCycleLength",value:function(e){isNaN(e)||this.cycleLengthParameter.set(e)}},{key:"onVariableSet",value:function(e){e=e.split(" ").map(function(e){return e.trim()});var t=parseFloat(e[1]);if(!isNaN(t)){var n=e[0];this[n+"Parameter"]&&(n=this[n+"Parameter"]).set(t)}}},{key:"clear",value:function(){Object(o.a)(Object(l.a)(n.prototype),"clear",this).call(this),this.lastLeaf=void 0,this.lastLeafStep=void 0,this.stepNumberTriggered=void 0}},{key:"output",value:function(e,t,r){return this.scriptEffect&&(r=this.scriptEffect.actualStepNumber),Object(o.a)(Object(l.a)(n.prototype),"output",this).call(this,e,t,r)}},{key:"accentFactor",get:function(){return this.accentFactorParameter.get()},set:function(e){this.accentFactorParameter.set(e)}},{key:"staccatoFactor",get:function(){return this.staccatoFactorParameter.get()},set:function(e){this.staccatoFactorParameter.set(e)}},{key:"documentation",get:function(){return["A tidal-cycles inspired scripting effect. Write expressions for cyclic beats using tidal notation.","Type or press enter to execute"]}},{key:"isRealTime",value:function(){return!1}},{key:"cycleLength",get:function(){return this.cycleLengthParameter.get()},set:function(e){return this.cycleLengthParameter.set(e)}},{key:"lengthFactor",get:function(){return this.lengthFactorParameter.get()},set:function(e){return this.lengthFactorParameter.set(e)}},{key:"cycle",get:function(){return this.cycleParameter.get()},set:function(e){return this.cycleParameter.set(e,!0,!0)}},{key:"removeNote",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.gated;Object(o.a)(Object(l.a)(n.prototype),"removeNote",this).call(this,e,t,r)}},{key:"handleVariables",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=x(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;Array.isArray(a)?this.handleVariables(a):(a.cycle&&this.handleVariables(a.cycle),a.transpose&&"object"===typeof a.transpose&&this.newVar(a.transpose.name,0,-32,32),a.operand&&"object"===typeof a.operand&&this.newVar(a.operand.name,2,1,16))}}catch(c){r.e(c)}finally{r.f()}var i=this.scriptEffect||this;for(var s in n){var o=i[s+"Parameter"];o&&(o.copyFrom(n[s],this.track.sequencerEngine),o.isMapped&&o.isMapped.replaceParameter(o))}i.updateVariablesRedux()}},{key:"cycleString",get:function(){return Object(b.e)(this.cycle)}},{key:"getText",value:function(){return this.cycleString}},{key:"replaceOperandVariables",value:function(e){var t=[];if(t.cycleLength=e.cycleLength,!e)return t;for(var n=0;n<e.length;n++){var a=e[n];if(Array.isArray(a))t.push(this.replaceOperandVariables(a));else{var i=Object(r.a)({},a);i.cycle&&(i.cycle=this.replaceOperandVariables(a.cycle)),a.operand&&"object"===typeof a.operand&&(this.newVar(a.operand.name,2,1,16),i.operand=this.var(a.operand.name)()),t.push(i)}}return t}},{key:"getTrigger",value:function(e,t,n,r,a,i){var s=(new Date).getTime();if(this.cycleRetrigger||(r=this.sequencerEngine.isSequenceRolling?r:this.track.sequencerEngine.trackStep),void 0===this.stepNumberTriggered&&(this.gated||this.sliceRetrigger||this.isNothingPlaying())&&(this.stepNumberTriggered=r),void 0!==this.cycle){var o=this.stepNumberTriggered;if(this.track&&this.track.length){var c=this.track.sequencerEngine.stepNumberOffset||0;c%=this.track.length,o=Object(f.a)(o-c,this.track.length)}var u=r-o;u<0&&(u+=this.track.length);var l=u%this.cycleLength;if(this.scriptEffect)this.scriptEffect.tidals.indexOf(this);if(0===l)if(this.scriptEffect&&this.scriptEffect.isOutletConnected&&this.scriptEffect.isOutletConnected(h.b)){var d=this.scriptEffect.tidals.indexOf(this);this.scriptEffect.sendMessage(h.b,d)}else this.sendMessage(h.b,h.a);var v,m=this.replaceOperandVariables(this.cycle),b=Math.floor(this.cycleLength/this.lengthFactor);0===this.variables.length&&this.tidalCache[l]?v=this.tidalCache[l]:(v=Object(y.c)({cycle:m,stepNumber:u,length:b}),this.tidalCache[l]=v),v.length>0&&(this.currentLeaves=v.filter(function(e){return e.cycle}),this.currentCycles=v.filter(function(e){return e.cycle}).reduce(function(e,t){return e[t.cycle]=!0,e},{}));var g=[];for(var k in v){var j=v[k],w=j.accent,x=j.pianissimo,S=j.staccato,P=j.legato,T=j.factor,A=j.outputNumber,M=j.transpose,R=j.offset,C=j.duration,N=j.flam,q=j.piano,I=!1;if(j.rules&&j.rules.some(function(e){return e.always&&(Array.isArray(e.always)?e.always.some(function(e){return"double"===e.type}):"double"===e.always.type)||e.series&&e.series.some(function(e){return"double"===e.type})})&&(I=!0),null!==M&&"object"===typeof M&&(M=this.var(M.name)()),(e=this.getStep(e,t,1,!0)).slice=i,e.transpose=parseFloat(e.transpose)+parseFloat(M),e.duration=C*this.durationFactor,u%this.cycleLength===0&&(e.isNewCycle=!0),null!==M){if(e.isDouble=I,this.lastLeaf){if(j.figureId!==this.lastLeaf.figureId){var _=this.scriptEffect.tidals.indexOf(this);this.scriptEffect.sendMessage("figure-change",_)}if(j.type){var D=j.type,F=D.type,L=D.value;if(F===p.b){if(this.lastLeaf.type&&this.lastLeaf.type.type===p.b){var B=this.lastLeafStep.velocity;this.isSequenceRolling&&(B=Math.min(2,B)),e.velocity=.7*B}e.hand=!this.lastLeafStep.hand}else F===p.a&&(0===L?e.hand=!this.lastLeafStep.hand:1===L&&(e.hand=this.lastLeafStep.hand))}}w&&(e.velocity*=this.accentFactor),T&&(e.velocity*=Math.pow(T,2)),x?e.velocity*=.05:q&&(e.velocity*=.45),S&&(e.duration*=this.staccatoFactor,e.release=5,e.attack=3),P&&(e.duration=Object(y.b)(m,j.leaf,b)),e.on=!0,e.leafNumber=Object(y.a)(m,j.leaf,b);var z=new O.a(e,E*R+n,a,A);if(z.offsetTime=E*R,g.push(z),this.lastLeaf=j,this.lastLeafStep=e,e.velocity=Math.min(2,e.velocity),N){var J=this.getStep(e);J.velocity*=.8,J.duration*=.6;var V=new O.a(J,z.time+-.4*E,a,A);g.push(V)}}else this.lastLeafStep&&(e.hand=!this.lastLeafStep.hand),this.lastLeaf=j,this.lastLeafStep=e}var H=(new Date).getTime();return window.tidalTimes.push(H-s),g}}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(e){return Object(r.a)({},Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this,e),{cycleRetrigger:this.cycleRetrigger})}},{key:"fromJson",value:function(e,t){this.cycleParameter.set(e.cycle);var r=Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return void 0!==e.cycleRetrigger&&(this.cycleRetrigger=e.cycleRetrigger),r}},{key:"hasAccent",value:function(){var e,t=x(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cycle);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(Array.isArray(n)){if(this.hasAccent(n))return!0}else{if(n.cycle&&this.hasAccent(n.cycle))return!0;if(n.accent)return!0}}}catch(r){t.e(r)}finally{t.f()}return!1}}]),n}(Object(m.a)(Object(d.a)(k.a)));t.a=T},function(e,t,n){"use strict";n.d(t,"c",function(){return u}),n.d(t,"a",function(){return l}),n.d(t,"b",function(){return f}),n.d(t,"d",function(){return h});var r=n(11),a=n(1),i=n(111),s=n(151),o=function(e){return e.length},c=function(e){return e[o(e)-1]},u=function(e,t){var n=[];return function(s,u,l){if(function(e,t,n){return c(e)&&t-c(e).stepNumber===Math.floor(n)}(n,u,Object(i.A)(t))){var f=void 0===s?Object(a.a)({},c(n),{stepNumber:u,time:l}):{stepData:s,stepNumber:u,time:l},h=void 0===s?Object(i.Q)(f):Object(i.w)(!0);return n=void 0!==s?[f]:[].concat(Object(r.a)(n),[f]),o(n)>Object(i.A)(e)&&(n=[]),h}return void 0!==s?(n=[{stepData:s,stepNumber:u,time:l}],Object(i.w)(!0)):Object(i.w)(!1)}};Object(s.a)("beat",{step:"The step within the beat at which this executes the ifCond condition",beat:"The total number of steps within which we determine if the step has occured",ifCond:"The condition that is executed when the step is reached",elseCond:"The condition that is executed otherwise"},"Conditions on a certain step within a beat. For example, beat(0,32,a,b) executes a on the 1st beat of every bar, and executes b on every other step");var l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return function(a,s,o){var c=[a,s,o];return s%i.A.apply(void 0,[t].concat(c))===i.A.apply(void 0,[e].concat(c))?i.A.apply(void 0,[n].concat(c)):r?i.A.apply(void 0,[r].concat(c)):Object(i.w)(!0)}};Object(s.a)("gate",{stepsLists:"An array where each element is a number from 0-1 determing the probability that we allow a trigger occuring at that step to pass through"},"Control which steps are triggered within a beat, probabilistically. gate([1, 1]) allows every trigger to occur.");var f=function(e){return function(t,n,r){var a=Object(i.A)(e,t,n,r);"number"===typeof a&&(a=p(a));var s=Object(i.A)(a[Math.floor(n/2)%a.length],t,n,r);return Math.random()<s?Object(i.w)(!0):Object(i.w)(!1)}};Object(s.a)("shift",{list:"The list that we wish to shift",shiftNumber:"The number of indices to shift by"},"Shifts a list by a number of indices, on each trigger");var h=function(e){var t,n,a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(){for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];c[0],c[1],c[2];var l=i.A.apply(void 0,[s].concat(c)),f=i.A.apply(void 0,[e].concat(c));if(void 0!==l&&"FILTER"!==l.axiom||(l=0),t===f&&n===l)return a;t=f,n=l,l=Math.round(l);if(0===f.length)return f;f=Object(r.a)(f);for(var h=0;h<l;h++){var p=f.shift();f.push(p)}return a=f}},p=function(e){for(var t=[];e>0;)t.push(e%2),e=Math.floor(e/2);for(;t.length<16;)t.push(0);return t}},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return s}),n.d(t,"c",function(){return o}),n.d(t,"d",function(){return c});var r=n(111),a=n(151);Object(a.a)("and",{a:"Argument 1",b:"Argument 2"},"Returns true if a && b");var i=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var s=r.A.apply(void 0,[e].concat(a)),o=r.A.apply(void 0,[t].concat(a));return Object(r.w)(s&&o)}};Object(a.a)("eq",{a:"Argument 1",b:"Argument 2"},"Returns true if a >= b");var s=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var s=r.A.apply(void 0,[e].concat(a)),o=r.A.apply(void 0,[t].concat(a));return Object(r.w)(s===o)}};Object(a.a)("gte",{a:"Argument 1",b:"Argument 2"},"Returns true if a >= b");var o=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var s=r.A.apply(void 0,[e].concat(a)),o=r.A.apply(void 0,[t].concat(a));return Object(r.w)(s>=o)}};Object(a.a)("lte",{a:"Argument 1",b:"Argument 2"},"Returns true if a <= b");var c=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return Object(r.w)(r.A.apply(void 0,[e].concat(a))<=r.A.apply(void 0,[t].concat(a)))}}},function(e,t,n){"use strict";n.d(t,"d",function(){return d}),n.d(t,"c",function(){return v}),n.d(t,"b",function(){return y}),n.d(t,"a",function(){return b});var r=n(42),a=n.n(r),i=n(56),s=n(122),o=n(158),c=n(148),u=n(146),l=n(155),f=n(118),h=n(788),p=n(139),d=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.addJson(t);case 2:return i=e.sent,e.next=5,new l.a(u.p,"newScript",[Object(c.b)(i),o.a.utils.fromAscii(n),o.a.utils.fromAscii(r)]).execute();case 5:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),v=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new p.a((new h.a).contractAddress).select("scriptHash").select("scriptType").select("title").where("scriptType",t).from(f.C),e.next=3,n.executeQuery();case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),m={},y=function(e){return e in m?m[e]:(b(e),"")},b=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in m)){e.next=2;break}return e.abrupt("return",m[t]);case 2:return n=new p.a((new h.a).contractAddress).select("scriptHash").from(f.C).where("title",t),e.next=5,n.executeQuery();case 5:if(!(r=e.sent)[0]){e.next=12;break}return e.next=9,s.a.getJson(r[0].scriptHash);case 9:return i=e.sent,m[t]=i,e.abrupt("return",i);case 12:return e.abrupt("return",void 0);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();window.getScripts=v,window.getScriptForTitle=b},,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r="NOT_UPLOADED_YET"},,,,,function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32[16]",name:"sampleHashes",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"titles",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"youtubeVideoIds",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"coverArtHashes",type:"bytes32[16]"},{internalType:"uint256[16]",name:"discogIds",type:"uint256[16]"},{internalType:"bytes32[4][16]",name:"tagsToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[4][16]",name:"stylesToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[16]",name:"countries",type:"bytes32[16]"},{internalType:"int16[16]",name:"sampleYears",type:"int16[16]"},{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"newEncryptedSamples",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32[16]",name:"sampleHashes",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"titles",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"youtubeVideoIds",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"coverArtHashes",type:"bytes32[16]"},{internalType:"uint256[16]",name:"discogIds",type:"uint256[16]"},{internalType:"bytes32[4][16]",name:"tagsToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[4][16]",name:"stylesToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[16]",name:"countries",type:"bytes32[16]"},{internalType:"int16[16]",name:"sampleYears",type:"int16[16]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newSamplesWithMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"bytes32",name:"youtubeVideoId",type:"bytes32"},{internalType:"bytes32[4]",name:"tagsToAdd",type:"bytes32[4]"},{internalType:"bytes32[4]",name:"stylesToAdd",type:"bytes32[4]"},{internalType:"bytes32",name:"country",type:"bytes32"},{internalType:"int16",name:"year",type:"int16"},{internalType:"uint256",name:"discogsId",type:"uint256"},{internalType:"bytes32",name:"coverArtHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newSampleWithMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"country",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleCountry",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32[4]",name:"stylesToAdd",type:"bytes32[4]"},{internalType:"bytes32",name:"country",type:"bytes32"},{internalType:"int16",name:"year",type:"int16"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleDiscogsMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"style",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleStyle",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"tag",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleTag",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32[4]",name:"tagsToAdd",type:"bytes32[4]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleTags",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"int16",name:"year",type:"int16"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleYear",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"youtubeVideoId",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleYoutubeVideoId",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"},{internalType:"address",name:"encryptionAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"youtubeVideoId",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampledYoutube",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"tag",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleTagged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"style",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleStyle",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"int16",name:"year",type:"int16"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleYear",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"country",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleCountry",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"discogsId",type:"uint256"},{indexed:!0,internalType:"bytes32",name:"coverArtHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"NewDiscogsSample",type:"event"}],this.contractAddress="0xc77d4e72dF7D0Bf96488eF543253af537fEb8737"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"bytes32",name:"annotationType",type:"bytes32"},{internalType:"bytes32",name:"data",type:"bytes32"},{internalType:"bytes32",name:"annotationData",type:"bytes32"}],name:"newAnnotation",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"annotationType",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"data",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"annotationData",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"}],name:"NewAnnotation",type:"event"},{inputs:[{internalType:"bytes32",name:"annotationType",type:"bytes32"},{internalType:"bytes32",name:"data",type:"bytes32"},{internalType:"bytes32[]",name:"annotationData",type:"bytes32[]"}],name:"newAnnotations",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"annotationType",type:"bytes32"},{internalType:"string",name:"description",type:"string"}],name:"newAnnotationType",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"annotationType",type:"bytes32"},{indexed:!1,internalType:"string",name:"description",type:"string"}],name:"NewAnnotationType",type:"event"},{inputs:[{internalType:"bytes32",name:"dataType",type:"bytes32"},{internalType:"string",name:"description",type:"string"}],name:"newDataType",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"dataType",type:"bytes32"},{indexed:!1,internalType:"string",name:"description",type:"string"}],name:"NewDataType",type:"event"},{inputs:[{internalType:"bytes32",name:"linkType",type:"bytes32"},{internalType:"bytes32",name:"fromData",type:"bytes32"},{internalType:"bytes32",name:"toData",type:"bytes32"}],name:"newLink",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"linkType",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"fromData",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"toData",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"NewLink",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"linkType",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"fromData",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"NewLinkRoot",type:"event"},{inputs:[{internalType:"bytes32",name:"linkType",type:"bytes32"},{internalType:"bytes32",name:"fromData",type:"bytes32"},{internalType:"bytes32[]",name:"toData",type:"bytes32[]"}],name:"newLinks",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"linkType",type:"bytes32"},{internalType:"string",name:"description",type:"string"}],name:"newLinkType",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"linkType",type:"bytes32"},{indexed:!1,internalType:"string",name:"description",type:"string"}],name:"NewLinkType",type:"event"}],this.contractAddress="0x305306F68D9C230B59d5B6869AEd1723365C9290"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},,function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return u});n(11);var r=Math.pow(2,-32),a=32557,i=new Uint16Array(4),s=new DataView(i.buffer),o=function(){var e=i[0],t=i[1],n=i[2],s=i[3],o=33103+a*e|0,c=63335+a*t+(19605*e+(o>>>16))|0,u=31614+a*n+19605*t+(62509*e+(c>>>16))|0,l=5125+a*s+(19605*n+62509*t)+(22609*e+(u>>>16));i[0]=o,i[1]=c,i[2]=u,i[3]=l;var f=(s<<21)+((s>>2^n)<<5)+((n>>2^t)>>11);return r*((f>>>(s>>11)|f<<(31&-(s>>11)))>>>0)},c=function(e){for(var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=16,a=1540483477,i=e.length,s=n^i,o=0;i>=4;)t=(65535&(t=255&e[o]|(255&e[++o])<<8|(255&e[++o])<<16|(255&e[++o])<<24))*a+(((t>>>r)*a&65535)<<r),s=(65535&s)*a+(((s>>>r)*a&65535)<<r)^(t=(65535&(t^=t>>>24))*a+(((t>>>r)*a&65535)<<r)),i-=4,++o;switch(i){case 3:s^=(255&e[o+2])<<r;case 2:s^=(255&e[o+1])<<8;case 1:s=(65535&(s^=255&e[o]))*a+(((s>>>r)*a&65535)<<r)}return s=(65535&(s^=s>>>13))*a+(((s>>>r)*a&65535)<<r),(s^=s>>>15)>>>0},u=function(e){!1,null;for(var t=~~((e.length-2)/2),n=[],r=0;r<t;r++){var a=2+2*r;n.push(parseInt(e.slice(a,a+2),16))}var i=c(n,1690382925),o=c(n,72970470);s.setUint32(0,i),s.setUint32(4,o)}},function(e,t,n){"use strict";n.d(t,"c",function(){return s}),n.d(t,"a",function(){return o}),n.d(t,"b",function(){return c});var r=n(11),a=n(198),i=function(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))},s=function(e,t){return i(e.x,e.y,t.x,t.y)},o=function(e){var t=Object(a.f)(e);return e.sort(u),function(e,t,n){if(e.length<=3)return e;var a=window.api.create_geometry_buffer(e.length),i=window.api.create_geometry_buffer(e.length);window.Module.HEAPF32.set(e,a/e.BYTES_PER_ELEMENT),window.api.getConvexHullFlat(a,e.length,i,t.x,t.y,n);for(var s=new Uint32Array(window.Module.HEAP32.buffer,i,3*e.length+1),o=s[0],c=[],u=0;u<o;u++){var l=s[2*u+1],f=s[2*u+2];c.push({x:l,y:f})}window.api.destroy_buffer(i),window.api.destroy_buffer(a);var h=c.slice(1,c.length);return h.reverse(),[c[0]].concat(Object(r.a)(h)).flatMap(function(e){return[e.x,e.y]})}(e,t,12)};function c(e,t,n){var a=e.slice();a.sort(u);var i=function(e,t,n){if(e.length<=3)return e;var a=window.api.create_geometry_buffer(e.length),i=window.api.create_geometry_buffer(e.length),s=window.api.create_geometry_buffer(3*e.length+1),o=new Uint32Array(e.map(function(e){var t=e.x;e.y;return t})),c=new Uint32Array(e.map(function(e){e.x;var t=e.y;return t}));window.Module.HEAP32.set(o,a/o.BYTES_PER_ELEMENT),window.Module.HEAP32.set(c,i/c.BYTES_PER_ELEMENT),window.api.getConvexHull(a,i,e.length,s,t.x,t.y,n);for(var u=new Uint32Array(window.Module.HEAP32.buffer,s,3*e.length+1),l=u[0],f=[],h=0;h<l;h++){var p=u[2*h+1],d=u[2*h+2];f.push({x:p,y:d})}window.api.destroy_buffer(s),window.api.destroy_buffer(a),window.api.destroy_buffer(i);var v=f.slice(1,f.length);return v.reverse(),[f[0]].concat(Object(r.a)(v))}(a,t,n);return i}function u(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}},,function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){var e;return function(t){return e?e.dispatch(t):(e=t,0)}}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){return{code:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",uniforms:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},variables:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},functions:arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},closure:arguments.length>4&&void 0!==arguments[4]?arguments[4]:{}}}},,function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(11),o=n(4),c=n(5),u=n(138),l=n(125),f=(n(236),n(894)),h=n(409),p=n(20),d=function(){function e(t,n){Object(o.a)(this,e),this.id=Object(p.uuid)(),this.sample=t,this.sequencerEngine=n,this.searcher=new h.a(n.ethereumCache,n),this.nextSounds=[],this.previousSounds=[],this.counter=0,this._tagSounds=void 0,this.filterFavorites=!1}return Object(c.a)(e,[{key:"length",get:function(){return this._sounds&&this._sounds.length}},{key:"sounds",get:function(){return this._tagSounds||this._sounds},set:function(e){this._sounds=e}},{key:"tagSounds",set:function(e){this.nextSounds=[],this.previousSounds=[],this._tagSounds=e}},{key:"getCopy",value:function(){var t=new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sample,this.sequencerEngine);return t.searcher=this.searcher,this.sounds&&(t.sounds=Object(s.a)(this.sounds)),t.tags=this.tags,t.initBuffers(),t}},{key:"fetch",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sample&&this.sample.tags){e.next=2;break}return e.abrupt("return");case 2:return t=this.sample.tags,e.next=5,l.a.getGuildsWithAccess();case 5:return n=e.sent,e.next=8,Object(f.a)(t,n);case 8:r=e.sent,this.sounds=r,this.tags=t;case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"hasNext",value:function(){return void 0===this.sounds||this.nextSounds.length>0}},{key:"hasPrevious",value:function(){return void 0===this.sounds||this.previousSounds.length>0}},{key:"dispose",value:function(){this.nextSounds&&this.nextSounds.forEach(function(e){return e.dispose(!0)}),this.previousSounds&&this.previousSounds.forEach(function(e){return e.dispose(!0)}),this.sounds=void 0,this.nextSounds=void 0,this.previousSounds=void 0,this.sample&&(this.sample.dispose(!0),this.sample=void 0),this.searcher=void 0}},{key:"search",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.sample.tags,this.tags=t,this.searcher.selectedTags=t,e.next=5,Object(f.a)(t);case 5:this.sounds=e.sent.slice(1),this.counter=0,this.initBuffers();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"initBuffers",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sounds&&void 0!==this.nextSounds){e.next=2;break}return e.abrupt("return");case 2:this.loading=!0,this.sounds.length,t=0;case 5:if(!(this.nextSounds.length<1)){e.next=25;break}return e.prev=6,e.next=9,this.loadNextForInitialBuffer(t);case 9:n=e.sent,r=n.next,i=n.previous,this.nextSounds.push(r),this.previousSounds.push(i),e.next=20;break;case 16:if(e.prev=16,e.t0=e.catch(6),!(t>=12)){e.next=20;break}return e.abrupt("break",25);case 20:if(t++,void 0!==this.nextSounds){e.next=23;break}return e.abrupt("break",25);case 23:e.next=5;break;case 25:this.loading=!1;case 26:case"end":return e.stop()}},e,this,[[6,16]])}));return function(){return e.apply(this,arguments)}}()},{key:"loadNextForInitialBuffer",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,o,c,l,f;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return setTimeout(function(){i()},7e3),n.prev=1,s=t.sounds.length,o=(t.counter+e)%s,c=t.sounds[o],l=new u.a(c),n.next=8,l.load();case 8:return o=((t.counter-e-1)%s+s)%s,c=t.sounds[o],f=new u.a(c),n.next=13,f.load().catch(i);case 13:r({next:l,previous:f}),n.next=19;break;case 16:n.prev=16,n.t0=n.catch(1),i();case 19:case"end":return n.stop()}},n,null,[[1,16]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){return n()},e);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getNext",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sounds){e.next=3;break}return e.next=3,this.search();case 3:if(!this.loading){e.next=8;break}return e.next=6,this.sleep(50);case 6:e.next=3;break;case 8:return t=this.nextSounds.shift(),setTimeout(function(){n.loadNext(t)},100),e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPrevious",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sounds){e.next=3;break}return e.next=3,this.search();case 3:if(!this.loading){e.next=8;break}return e.next=6,this.sleep(50);case 6:e.next=3;break;case 8:return t=this.previousSounds.shift(),this.loadPrevious(t),e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"seek",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.counter=t,e.next=3,this.loadNextAvailableSample();case 3:return n=e.sent,this.nextSounds=[n],e.next=7,this.getNext();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadNext",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,c=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!1,setTimeout(function(){n||(c.loading=!1)},7e3),this.loading=!0,(r=this.previousSounds.pop())&&r.dispose(!0),this.previousSounds=[this.sample].concat(Object(s.a)(this.previousSounds)),this.sample=t,!0,i=void 0,o=0;case 10:if(void 0!==i){e.next=26;break}return e.prev=11,e.next=14,this.loadNextAvailableSample();case 14:i=e.sent,e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(11),!(o>=12)){e.next=23;break}return this.loading=!1,n=!0,e.abrupt("return");case 23:o++,e.next=10;break;case 26:this.nextSounds.push(i),this.loading=!1,n=!0;case 29:case"end":return e.stop()}},e,this,[[11,17]])}));return function(t){return e.apply(this,arguments)}}()},{key:"loadNextAvailableSample",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){var i,s,o;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.counter=(e.counter+1)%e.sounds.length,i=(e.counter+1)%e.sounds.length,s=e.sounds[i],o=new u.a(s),setTimeout(function(){r()},7e3),t.prev=5,t.next=8,o.load();case 8:n(o),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),r();case 14:case"end":return t.stop()}},t,null,[[5,11]])}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"loadPrevious",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,(n=this.nextSounds.pop())&&n.dispose(!0),this.nextSounds=[this.sample].concat(Object(s.a)(this.nextSounds)),this.sample=t,this.counter=this.mod(this.counter-1,this.sounds.length),r=this.mod(this.counter-1,this.sounds.length),i=this.sounds[r],o=new u.a(i),e.next=11,o.load();case 11:this.previousSounds.push(o),this.loading=!1;case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mod",value:function(e,t){return(e%t+t)%t}}]),e}();t.a=d},function(e,t,n){"use strict";function r(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=r.createBuffer(e.numberOfChannels,a+n-t+1,r.sampleRate),s=i.getChannelData(0),o=e.getChannelData(0).subarray(t,n);if(s.set(o,a),e.numberOfChannels>1){var c=i.getChannelData(1),u=e.getChannelData(1).subarray(t,n);c.set(u,a)}return i}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),s=n(31),o=n(10),c=n(6),u=n(8),l=n(2),f=n(135),h=n(119),p=n(234),d=n(23),v=n(7),m=n.n(v);function y(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}var b=n(21),g=n(142),O=n(14),k=n(235);function j(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var S=function(e){Object(c.a)(n,e);var t=x(n);function n(e){var r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2?arguments[2]:void 0;return Object(a.a)(this,n),(r=t.call(this,"Warp",e,o)).stepsWhileInReverse=0,window.warp=Object(s.a)(r),r.lastForwardPercentage=0,i&&(r.enabledParameter=new O.a("enabled",Object(s.a)(r),function(e,t){return r.onEnable(t)},{min:!1,max:!0,unit:"",defaultValue:!0,automatable:!1}),r.registerParameter(r.enabledParameter)),r.warpLengthParameter=new O.a("warpLength",Object(s.a)(r),function(e,t){return[]},{documentation:"Controls the tempo of the sample in proportion to the project tempo. A higher number makes the sample slower, and more time-stretched.",defaultValue:1,min:.05,max:16,unit:"bars",prettyName:"Warp Length"}),r.registerParameter(r.warpLengthParameter),r.warpFactorParameter=new O.a("warpFactor",Object(s.a)(r),function(e,t){return[]},{documentation:"Multiples the Warp Speed by this whole number. A quick way to double or half the sample tempo",defaultValue:2,min:1,max:8,unit:"",prettyName:"Warp Factor"}),r.registerParameter(r.warpFactorParameter),r.glideParameter=new O.a("glide",Object(s.a)(r),function(e,t){return[]},{defaultValue:1,min:0,max:4,unit:"",automatable:!1}),r.registerParameter(r.glideParameter),r.resolutionParameter=new k.a("resolution",Object(s.a)(r),function(e,t){return t},{documentation:"The rate at which we trigger each warped grain.",min:0,max:1,unit:"",prettyName:"Rate",options:{0:new b.a(4,!1),.1:new b.a(4,!0),.2:new b.a(8,!1),.3:new b.a(8,!0),.4:new b.a(16,!1),.5:new b.a(16,!0),.6:new b.a(32,!1),.7:new b.a(32,!0)},defaultValue:new b.a(16,!1)}),r.registerParameter(r.resolutionParameter),r.loopLengthParameter=new O.a("loopLength",Object(s.a)(r),function(e,t){return[]},{documentation:"The % of the sample-loop we will go through before looping back.",defaultValue:100,min:0,max:100,unit:"%",prettyName:"Loop Length"}),r.registerParameter(r.loopLengthParameter),r.durationFactorParameter=new O.a("durationFactor",Object(s.a)(r),function(e,t){return[]},{documentation:"The duration of each grain to be triggered (according to the warp-rate).",defaultValue:1,min:0,max:2,unit:"",prettyName:"Grain Size"}),r.registerParameter(r.durationFactorParameter),r.smoothnessParameter=new O.a("smoothness",Object(s.a)(r),function(e,t){return[]},{documentation:"Controls the attack/release of each grain, smoothing them out. Higher numbers mean smoother transitions (higher attack/release)",defaultValue:1,min:.1,max:20,unit:"",prettyName:"Smoothness"}),r.registerParameter(r.smoothnessParameter),r.sliceRetriggerParameter=new O.a("sliceRetrigger",Object(s.a)(r),function(e,t){return[]},{defaultValue:!0,min:!1,max:!0,unit:"",automatable:!1}),r.registerParameter(r.sliceRetriggerParameter),r.noteToDuration={},r.noteToOriginalDuration={},r.noteToTrigger={},r.stepNumberTriggered=0,r.notes={},r.times=[],r}return Object(i.a)(n,[{key:"documentation",get:function(){return["Syncs a sample to the project tempo, dividing the \nsample into many pieces (according to the warp-rate), and triggering them at this rate.","Track needs to be playing to work."]}},{key:"getVisualizedParameters",value:function(){return[this.resolutionParameter].concat(Object(r.a)(Object(o.a)(Object(l.a)(n.prototype),"getVisualizedParameters",this).call(this)))}},{key:"getText",value:function(){return this.resolutionParameter.get().toString()}},{key:"onEnable",value:function(e){(this.track.sequencerEngine.store.getState().tracks.trackWarps[this.track.subSequence.id]||{})[this.track.trackNumber]!==e&&this.track.sequencerEngine.store.dispatch(Object(d.Be)(this.track.subSequence.id,this.track.trackNumber,e))}},{key:"releaseAll",value:function(e){this.notes={},this.noteToTrigger={},this.noteToDuration={}}},{key:"isNothingPlaying",value:function(){return y(this.noteToTrigger)&&y(this.notes)}},{key:"input",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(o.a)(Object(l.a)(n.prototype),"input",this).call(this,e,t);var r=e.stepNumber,a=r;e.warpedSteps&&(r=e.warpedSteps.stepNumber,this.warpedFirst=r);var i=e.stepData.transpose,s=e.stepData.slice,c=e.time;if(this.isNothingPlaying()&&this.sliceRetrigger&&(this.stepNumberTriggered=void 0,this.lastLeaf=void 0,this.lastLeafStep=void 0),t)if(this.gated){var u=this.notes[i]||[];u.push({slice:s,time:c}),this.notes[i]=u}else(this.isNothingPlaying()||0==r||this.sliceRetrigger)&&(this.stepNumberTriggered=a,this.stepsWhileInReverse=0),this.releaseAll(),this.notes[i]=[{slice:s,time:c}];else{var f=2*e.stepData.duration;(!this.gated||this.track.rolling&&this.sequencerEngine.isSequenceRolling)&&(this.clear(!1),(this.sliceRetrigger||0===r)&&(this.track.rolling&&this.sequencerEngine.isSequenceRolling||(this.stepNumberTriggered=a,this.stepsWhileInReverse=0))),void 0===this.noteToDuration[i]&&(this.noteToDuration[i]=0),this.noteToDuration[i]=f,this.noteToOriginalDuration[i]=f,this.noteToTrigger[i]=e}}},{key:"getLastTime",value:function(e){for(var t=this.times.length-1;t>=0;t--){var n=this.times[t];if(n<e)return n}return this.times[this.times.length-1]}},{key:"getDurationElapsed",value:function(e){var t=e-(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.stepNumberTriggered);return t<0&&(t+=this.track.length),t}},{key:"output",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.a.Master.context.currentTime,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,s=[];a||this.times.push(t),void 0!==this.warpedFirst&&(n=this.warpedFirst,this.warpedFirst=void 0),this.currentStep=n;var o=this.getDurationElapsed(n);o=isNaN(o)?0:o;var c=Object(p.a)(o,this.resolution);for(var u in this.noteToTrigger){var l=this.noteToTrigger[u];for(var f in void 0===l.offset&&(l.offset=l.time-t),c)this.getTrigger(l.stepData,u,t+c[f].time+l.offset,n,r,l.stepData.slice).forEach(function(e){s.push(e)})}var h=function(o){var u=e.notes[o],l=function(l){var f=u[l],h=f.slice,d=f.offset;if(void 0===d){var v=e.getLastTime(t);d=t-v,u[l].offset=d}if(a){var y,b=j(i);try{var g=function(){var r=y.value,a=r-n,i=Object(p.a)(a,e.resolution),c=a*(new m.a.Time("32n").toMilliseconds()/1e3);i.forEach(function(n){return e.getTrigger(e.track.trackData,o,0===a?void 0:t+c+n.time,r,r,h).forEach(function(t){e.sampler&&0===a&&!e.gated&&e.sampler.releaseAll(m.a.Master.context.currentTime),e.lastTriggerTime=t.time,s.push(t)})})};for(b.s();!(y=b.n()).done;)g()}catch(k){b.e(k)}finally{b.f()}}else for(var O in c)e.getTrigger(e.track.trackData,o,t+c[O].time+d,n,r,h).forEach(function(t){t.time,e.lastTriggerTime;e.lastTriggerTime=t.time,t.stepData.track=e.track,s.push(t)})};for(var f in u)l(f)};for(var d in this.notes)h(d);for(var v in this.noteToDuration)this.gated&&(this.noteToDuration[v]=Math.max(0,this.noteToDuration[v]-1),this.noteToDuration[v]<=0&&(this.track.rolling&&this.sequencerEngine.isSequenceRolling||delete this.noteToTrigger[v]));return s}},{key:"addNote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,a=this.getStep(this.track.trackData,e,null,!1);a.velocity=this.track.trackData.velocity,a.duration=null,a.transpose=e,a.slice=t,this.input(new g.a(a,r,n+1),!0)}},{key:"removeNote",value:function(e,t){if(!(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.gated)&&void 0!==this.notes[e]){var n=this.notes[e];this.notes[e].map(function(e){return e.slice}).indexOf(t);n=n.filter(function(e){return e.slice!==t}),this.notes[e]=n,0===this.notes[e].length&&delete this.notes[e]}}},{key:"getStepPercentage",value:function(e,t,n){return 100*this.getDurationElapsed(e,n)/(32*this.getSliceWarpLength(t))/(this.warpLength*this.warpFactor)}},{key:"getSliceWarpLength",value:function(){var e=this.track.tempo,t=this.track.sequencerEngine.bpm;return void 0===e||null===e||0===e?1:e/t}},{key:"getStartTimeLoop",value:function(e,t){var n=this.getStepPercentage(e,0,t),r=this.getSliceLoopLength(0,0);this.getSliceWarpLength();return(0+n/100*r)%this.loopLength}},{key:"getSliceLoopLength",value:function(e,t){var n=void 0;if(this.track.isFrozen||this.track.isAudioTrack){var r,a=j(this.track.frozenColumns);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.frozenSamplers[i.playing]&&(n=i.frozenSamplers[i.playing])}}catch(u){a.e(u)}finally{a.f()}}else if(this.track.instrument&&this.track.instrument.getSampler){var s=this.track.instrument.getSampler(e);s.samplers&&(n=s.samplers[0])}else n=this.track.getSamplers()[0];if(void 0===n)return 8;var o=n.getSlice(t),c=o.endTime-o.startTime;return 100*this.getBarInSeconds()/c}},{key:"getBarInSeconds",value:function(){return 64*new m.a.Time("32n").toMilliseconds()/1e3}},{key:"isLoop",value:function(){return this.track&&this.track.pattern.length()<=128}},{key:"getTrigger",value:function(e,t,n,r,a,i){if(this.track){var s=this.track.sequencerEngine.stepNumberOffset||0;if(r+=s,a+=s,this.isLoop()){var o=this.track.pattern.length();r%=o,a%=o}}var c;void 0===this.stepNumberTriggered&&(this.gated||this.sliceRetrigger||this.isNothingPlaying())&&(this.stepNumberTriggered=r,this.stepsWhileInReverse=0),t=parseFloat(t);var u=this.gated&&e.duration<1?e.duration:1,l=this.getStep(e,t,u,!0);if(this.track.sequencerEngine.reverse){var f=this.getSliceLoopLength(t,i);c=this.getStepPercentage(r,i,this.lastForwardStepNumber);var h=100-this.lastForwardStart,p=(this.getSliceWarpLength(),h+c/100*f);l.start=p%this.loopLength,this.lastReverseStart=l.start,this.stepsWhileInReverse+=2}else{if(c=this.getStepPercentage(r,i),this.stepsWhileInReverse>0)c-=2*this.getStepPercentage(this.stepsWhileInReverse,i);this.getSliceLoopLength(t,i);this.lastForwardStepNumber=r,l.start=c*this.getSliceLoopLength(t,i)/100%this.loopLength,this.lastForwardStart=l.start}return l.slice=i,l.duration*=this.durationFactor,l.attack+=8*this.smoothness,0===c?l.attack/=2:l.attack*=2,void 0===this.track.instrument&&(l.release+=2*this.smoothness),[new g.a(l,n,a)]}},{key:"sampler",get:function(){return this.track.getSamplers()[0]}},{key:"gated",get:function(){return!this.track.isFrozen&&!this.track.isAudioTrack&&this.track.gated}},{key:"isRealTime",value:function(){return!0}},{key:"onNewStep",value:function(){}},{key:"clear",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.noteToDuration={},this.noteToTrigger={},e&&(this.stepNumberTriggered=void 0,this.stepsWhileInReverse=0),this.notes={},this.times=[]}},{key:"durationFactor",get:function(){return this.durationFactorParameter.get()},set:function(e){return this.durationFactorParameter.set(e)}},{key:"glide",get:function(){return this.glideParameter.get()},set:function(e){return this.glideParameter.set(e)}},{key:"warpFactor",get:function(){return this.warpFactorParameter.get()},set:function(e){return this.warpFactorParameter.set(e)}},{key:"warpLength",get:function(){return this.warpLengthParameter.get()},set:function(e){return this.warpLengthParameter.set(e)}},{key:"loopLength",get:function(){return this.loopLengthParameter.get()},set:function(e){return this.loopLengthParameter.set(e)}},{key:"smoothness",get:function(){return this.smoothnessParameter.get()},set:function(e){return this.smoothnessParameter.set(e)}},{key:"resolution",get:function(){return(new b.a).fromJson(this.resolutionParameter.get())},set:function(e){return this.resolutionParameter.set(e)}},{key:"sliceRetrigger",get:function(){return this.sliceRetriggerParameter.get()},set:function(e){return this.sliceRetriggerParameter.set(e)}},{key:"getNextTriggerStep",value:function(e){var t=32/this.resolution.resolution;return e+(t-e%t)}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"fromJson",value:function(e,t){var r=Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(h.a)(this.resolutionParameter,new b.a(16,!1).fromJson(e.resolution),r),r}}]),n}(f.a);t.a=S},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(135),f=n(14),h=n(126),p=n(119);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var v=function(e){return function(e){Object(o.a)(n,e);var t=d(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"initValueParameter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:13,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.valueParameter=new f.b("value",this,function(){return 0},{min:e,max:t,defaultValue:n}),this.registerParameter(this.valueParameter)}},{key:"value",get:function(){return this.valueParameter.get()},set:function(e){this.valueParameter.set(e,!1,!1)}},{key:"fromValueJson",value:function(e){var t={};return Object(p.a)(this.valueParameter,e.value,t),Object(r.a)({},t,Object(h.a)(e,"valueParameter",this.valueParameter))}},{key:"getValueJson",value:function(){var e={value:this.value};return e=Object(h.b)(e,"valueParameter",this.valueParameter)}}]),n}(e)};function m(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}n.d(t,"a",function(){return g}),n.d(t,"d",function(){return O}),n.d(t,"e",function(){return k}),n.d(t,"b",function(){return j}),n.d(t,"f",function(){return w}),n.d(t,"g",function(){return x}),n.d(t,"c",function(){return S});var g=1,O=2,k=3,j=function(e){Object(o.a)(n,e);var t=b(n);function n(e,r){var i;return Object(a.a)(this,n),(i=t.call(this,"Chord Type",e,1)).numeral=r,i.nextChords={},i}return Object(i.a)(n,[{key:"onNewStep",value:function(){this.active=!1,Object(s.a)(Object(u.a)(n.prototype),"onNewStep",this).call(this)}},{key:"output",value:function(){return this.active=this.triggers.length>0,this.triggers||[]}},{key:"getChordEffectType",value:function(){return g}},{key:"getJson",value:function(){return Object(r.a)({},Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{numeral:this.numeral})}},{key:"fromJson",value:function(e){Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e),this.numeral=e.numeral}},{key:"prettyName",get:function(){switch(this.numeral){case 1:return"I";case 2:return"II";case 3:return"III";case 4:return"IV";case 5:return"V";case 6:return"VI";case 7:return"VII";default:return"All Chords"}}}]),n}(l.a),w=function(e){Object(o.a)(n,e);var t=b(n);function n(e,r){var i;return Object(a.a)(this,n),(i=t.call(this,"Voice",e,2)).initValueParameter(0,13,r),i}return Object(i.a)(n,[{key:"degree",get:function(){return this.value},set:function(e){return this.value=e}},{key:"getText",value:function(){return""}},{key:"onNewStep",value:function(){this.active=!1,Object(s.a)(Object(u.a)(n.prototype),"onNewStep",this).call(this)}},{key:"output",value:function(){var e=this.triggers||[];this.active=e.length>0;var t,n=m(e);try{for(n.s();!(t=n.n()).done;){var r,a=t.value,i=m(a.stepData.voices);try{for(i.s();!(r=i.n()).done;){var s=r.value;void 0===s.voice&&(s.voice=this.degree)}}catch(o){i.e(o)}finally{i.f()}a.stepData.voices.push({voice:this.degree})}}catch(o){n.e(o)}finally{n.f()}return e}},{key:"getJson",value:function(){return Object(r.a)({},Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this),Object(s.a)(Object(u.a)(n.prototype),"getValueJson",this).call(this))}},{key:"fromJson",value:function(e){Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e),e.value=e.degree,this.fromValueJson(e)}},{key:"getChordEffectType",value:function(){return O}},{key:"prettyName",get:function(){switch(this.degree){case 1:return"1st";case 2:return"2nd";case 3:return"3rd";default:return this.degree+"th"}}}]),n}(v(l.a)),x=function(e){Object(o.a)(n,e);var t=b(n);function n(e,r,i,s,o){var c;return Object(a.a)(this,n),(c=t.call(this,e,r,1)).initValueParameter(i,s,o),c}return Object(i.a)(n,[{key:"onNewStep",value:function(){this.active=!1,Object(s.a)(Object(u.a)(n.prototype),"onNewStep",this).call(this)}},{key:"getText",value:function(){return void 0!==this.value?this.value:""}},{key:"transform",value:function(e){return e}},{key:"getChordEffectType",value:function(){return k}},{key:"fromJson",value:function(e){Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e),this.fromValueJson(e)}},{key:"getJson",value:function(){return Object(r.a)({},Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this),Object(s.a)(Object(u.a)(n.prototype),"getValueJson",this).call(this))}}]),n}(v(l.a)),S=function(e){Object(o.a)(n,e);var t=b(n);function n(e){return Object(a.a)(this,n),t.call(this,"Octave",e,-4,4,-1)}return Object(i.a)(n,[{key:"output",value:function(){var e=this,t=this.triggers||[];this.active=t.length>0;var n,r=m(t);try{for(r.s();!(n=r.n()).done;){var a=n.value,i=a.stepData.voices.filter(function(e){return void 0===e.octave});if(i.length>0)i.forEach(function(t){return t.octave=e.value});else{var s=a.stepData.voices[0]||{voice:1};s.octave=this.value,a.stepData.voices.push(s)}}}catch(o){r.e(o)}finally{r.f()}return t}},{key:"transform",value:function(e){return e+12*this.value}}]),n}(x)},,,function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(4),s=n(5),o=n(10),c=n(6),u=n(8),l=n(2),f=n(14),h=n(129),p=n(590),d=n(236),v=n(358),m=n(23);function y(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}t.a=function(e){return function(e){Object(c.a)(n,e);var t=g(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a)))._parameters=[],e.initialParameterValues=[],e.initialParameterDepths=[],e.depthParameters=[],e}return Object(s.a)(n,[{key:"setupNodeMessaging",value:function(){var e=this;this.newInlet(h.g,function(){e.stop(),e.clear()})}},{key:"newDepthParameter",value:function(e){var t=new f.a("depth",this,function(e,t){return t},{units:"%",min:0,max:100,defaultValue:100});return this.context&&t.setContext(this.context),this.registerParameter(t),t}},{key:"getDepth",value:function(e){return this.depthParameters[e]?this.depthParameters[e].get():0}},{key:"setupRampParameters",value:function(){this.rampTimeParameter=new f.a("rampTime",this,function(e,t){return t},{documentation:"Time it takes (in ms) to reach the value its adding",min:0,max:1e4,defaultValue:80}),this.registerParameter(this.rampTimeParameter),this.resetAtZeroParameter=new f.a("resetAtZero",this,function(e,t){return t},{documentation:"Should the accumulator reset to 0 upon reaching step 1 in the pattern",min:0,max:1,defaultValue:!1}),this.registerParameter(this.resetAtZeroParameter),this.initDisabledParameters()}},{key:"getInitialValueForParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._parameters.indexOf(e);return this.initialParameterValues[t]}},{key:"setInitialValueForParameter",value:function(e,t){var n=this._parameters.indexOf(e);this.initialParameterValues[n]=t}},{key:"shouldSkipParameter",value:function(e){return!1}},{key:"resetValues",value:function(){var e={};for(var t in this._parameters)if(!this.shouldSkipParameter(t)){var n=this._parameters[t];if(void 0!==this.initialParameterValues[t]){var r=this.initialParameterValues[t];if((r<n.min||r>n.max)&&(r=(n.min+n.max)/2),n._wasDisposed)continue;var a=n.set(r,!0,!0);if(e[a.id]=a.value,n.depthParameter){var i=n.depthParameter,s=this.initialParameterDepths[t];if(void 0===s)continue;(s<i.min||s>i.max)&&(s=(i.min+i.max)/2),e[(a=i.set(s,!0,!0)).id]=a.value}else n.depth=this.initialParameterDepths[t]}}this.setEffectParameterValues(e)}},{key:"setEffectParameterValues",value:function(e){this.track.sequencerEngine.dispatch(Object(m.ub)(e))}},{key:"stop",value:function(){this.resetValues()}},{key:"unmap",value:function(e){var t=this._parameters.indexOf(e);this.unmapParameter(t)}},{key:"unmapParameter",value:function(e){var t=this._parameters[e];if(t){t.locked=void 0,this._parameters.splice(e,1);var n=this.depthParameters[e];this.depthParameters.splice(e,1);var r=this.parameters.indexOf(n);this.parameters.splice(r,1),this.onParameterUnmapped(t);var a=this.initialParameterValues[e];return this.initialParameterValues.splice(e,1),void 0!==a&&t.set(a,!0,!1),t[this.key]=void 0,t}}},{key:"onParameterUnmapped",value:function(){}},{key:"key",get:function(){return"isMapped"}},{key:"setParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._parameters.length;this._parameters[t]=e,this.initialParameterValues[t]=e.get(!0),this.depthParameters[t]||(this.depthParameters[t]=this.newDepthParameter(e)),e[this.key]=this}},{key:"_clear",value:function(){for(var e in this.initialParameterValues=[],this._parameters)if(!this.shouldSkipParameter(e)){var t=this._parameters[e];this.clearParameter(t)}}},{key:"clearParameter",value:function(e,t){this._clearParameter(e,t)}},{key:"_clearParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._parameters.indexOf(e);if(e){var n=e.get(!0);if(n>=e.max?e.max=n:n<=e.min&&(e.min=n),this.initialParameterValues[t]=n,e.depthParameter){var r=e.depthParameter.get(!0);isNaN(r)?this.initialParameterDepths[t]=1:this.initialParameterDepths[t]=r}else this.initialParameterDepths[t]=e.depth}}},{key:"resetAtZero",get:function(){return this.resetAtZeroParameter.get()}},{key:"rampTime",get:function(){return this.rampTimeParameter.get()}},{key:"onNewStep",value:function(){this.triggers.length>0&&(this.triggers.length=0)}},{key:"clear",value:function(){Object(o.a)(Object(l.a)(n.prototype),"clear",this).call(this),this._clear()}},{key:"getParameterValueToSet",value:function(e){return 0}},{key:"setParameterValues",value:function(e){var t={};for(var n in this._parameters)if(n=parseInt(n),!this.parametersDisabled.includes(n)){var r=this.getParameterValueToSet(n),i=this._parameters[n];if(!isNaN(r)&&i.get(!0)!==r){var s=i.max,o=i.min,c=i.set(Math.min(s,Math.max(o,r)),!0,!0,e,this.rampTime/1e3),u=c.id,l=c.value;t[u]=l}}this.track.sequencerEngine.parametersToUpdate=Object(a.a)({},this.track.sequencerEngine.parametersToUpdate,t)}},{key:"loadParameters",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a={},i=this.track&&this.track.subSequence;if(!e||this.subSequence&&!this.subSequence.tracks){if(!this.subSequence.getRootSubSequence)return{lostParameters:[],newMappings:a};i=this.subSequence.getRootSubSequence()}var s,o=this.track.sequencerEngine,c=[],u=y(e);try{var l=function(){var e=s.value,u="object"===typeof e?e.id:e,l=void 0;"BPM"===e.name&&(l=o.bpmParameter);var f=o.parameters.find(function(e){return e.id===u});f&&(l=f);var h,d=y(t.track.getAllParameters?[t.track].concat(Object(r.a)(i.tracks.filter(function(e){return e!==t.track}))):i.tracks);try{var v=function(){var e=h.value.getAllParameters(),t=[];e.forEach(function(e){t.push(e),e.depthParameter&&t.push(e.depthParameter)});var n=t.find(function(e){return u===e.id});if(n)return l=n,"break"};for(d.s();!(h=d.n()).done;){if("break"===v())break}}catch(Z){d.e(Z)}finally{d.f()}var m=i.pattr.getNestedParameters().find(function(e){return e.id===u});m&&(l=m);for(var b=0,g=[].concat(Object(r.a)(i.zObjects),Object(r.a)(i.zMessages));b<g.length;b++){var O=g[b].getAllParameters().find(function(e){return u===e.id});if(O){l=O;break}}if(!l){var k,j=y(i.lfos);try{for(j.s();!(k=j.n()).done;){var w=k.value,x=(w=w.lfo).parameters.find(function(e){return u===e.id});if(x){l=x;break}}}catch(Z){j.e(Z)}finally{j.f()}if(!l){var S,P=y(i.tracks);try{for(P.s();!(S=P.n()).done;){var E=S.value;if(E.lfosTrack){var T,A=y(E.lfosTrack.lfos);try{for(A.s();!(T=A.n()).done;){var M=T.value,R=(M=M.lfo).parameters.find(function(e){return u===e.id});if(R){l=R;break}}}catch(Z){A.e(Z)}finally{A.f()}}}}catch(Z){P.e(Z)}finally{P.f()}}}if(!l){var C,N=y(t.track.sequencerEngine.subSequences);try{for(N.s();!(C=N.n()).done;){var q=C.value,I=[].concat(Object(r.a)(q.midiEffects.shadowEffects),Object(r.a)(q.midiEffects.effects),[q.playhead]),_=[].concat(Object(r.a)(q.pads.flatMap(function(e){return e.getParameters().flatMap(function(e){return e.depthParameter?[e,e.depthParameter]:e})})),Object(r.a)(I.flatMap(function(e){return e.getParameters()})),[q.midiEffects.transposeParameter],Object(r.a)(q.pads.filter(function(e){return e.fxMacro}).map(function(e){return e.fxMacro.macroParameter})));if(l=_.find(function(e){return u===e.id}))break}}catch(Z){N.e(Z)}finally{N.f()}}if(!l){var D=o.sends.sends.flatMap(function(e){return e.effects}).flatMap(function(e){return e.getParameters()});l=D.find(function(e){return u===e.id})}if(!l){var F,L=y(i.envelopes);try{for(L.s();!(F=L.n()).done;){var B=F.value.parameters.find(function(e){return u===e.id});if(B){l=B;break}}}catch(Z){L.e(Z)}finally{L.f()}var z,J=y(i.tracks);try{for(J.s();!(z=J.n()).done;){var V=z.value;if(V.envelopesTrack){var H,U=y(V.envelopesTrack.envelopes);try{for(U.s();!(H=U.n()).done;){var G=H.value,W=(G=G.envelope).parameters.find(function(e){return u===e.id});if(W){l=W;break}}}catch(Z){U.e(Z)}finally{U.f()}}}}catch(Z){J.e(Z)}finally{J.f()}}if(!l){var K=o.channelMixer.masterChannel.effectsChain.effects.flatMap(function(e){return e.getParameters().flatMap(function(e){return e.depthParameter?[e,e.depthParameter]:e})}).find(function(e){return u===e.id});K&&(l=K)}if(!l&&!n&&"object"===typeof e&&(l=Object(p.a)(e,t.track,t.track.sequencerEngine))){a[u]=l;var Q=e.coordinates;Q.x,Q.y}if(l&&l.name.includes("Phase"))return"continue";l?t.setParameter(l):c.push(e)};for(u.s();!(s=u.n()).done;)l()}catch(f){u.e(f)}finally{u.f()}return this.sortParameters(),this.zObject&&"debug"===this.zObject.attributes["scripting name"]&&console.log("parameters lost=",c),{lostParameters:c,newMappings:a}}},{key:"sortParameters",value:function(){var e=this;if(this.parametersJson){var t=this.parametersJson.map(function(t,n){var r=t.id;return e._parameters.find(function(e){return e&&e.id===r})}).filter(function(e){return e});this._parameters=t}}},{key:"loadDepthJson",value:function(e,t){if(e.depthParameters){var n,r=0,a=y(e.depthParameters);try{for(a.s();!(n=a.n()).done;){var i=n.value,s=this.newDepthParameter();s.fromJson(i,this.track.sequencerEngine,t),this.depthParameters[r++]=s}}catch(o){a.e(o)}finally{a.f()}}}},{key:"getMappableJson",value:function(e){return{parameters:this._parameters.map(function(t){return{id:t.id,context:e?t.context&&t.context.getJson():void 0,name:e?t.name:void 0,coordinates:t.getCoordinates()}}),depthParameters:this.depthParameters.map(function(e){return e.getJson()})}}},{key:"getJson",value:function(e){return Object(a.a)({},Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this,e),this.getMappableJson(e))}},{key:"fromJson",value:function(e,t){if(!e.parameters)return{};delete e.depth,this.parametersJson=e.parameters;var r=Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return this.lostParameters=this.loadParameters(e.parameters,!0).lostParameters,this.loadDepthJson(e,t),r}},{key:"randomlyMapParameters",value:function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,a=[],i=y(arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(v.c)(e,this));try{for(i.s();!(t=i.n()).done;){var s=t.value;if(s.context&&s.context.formant)if(!s.context.formant.enabledParameter.get())continue;a.push(s)}}catch(o){i.e(o)}finally{i.f()}return Object(d.a)(a),(a=(a=Array.from(new Set(a))).slice(0,r)).forEach(function(e){return n.setParameter(e)}),a}},{key:"dispose",value:function(){for(;this._parameters.length>0;)this.unmapParameter(0);Object(o.a)(Object(l.a)(n.prototype),"dispose",this)&&Object(o.a)(Object(l.a)(n.prototype),"dispose",this).call(this)}},{key:"replaceParameter",value:function(e){for(var t in this._parameters)if(this._parameters[t].id===e.id)return void(this._parameters[t]=e)}},{key:"shouldOutputSkip",value:function(e,t){return 0===t&&this.resetAtZero?(this.stop(),this.clear(),!0):0===this.triggers.length}}]),n}(e)}},function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(4),s=n(5),o=n(10),c=n(6),u=n(8),l=n(2),f=n(17),h=n(571),p=n(126),d=n(123),v=n(360);function m(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}t.a=function(e){return function(e){Object(c.a)(n,e);var t=b(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).effects=[],e.adjacencyLists={},e.inputNode={id:-1,x:0,y:200},e.outputNode={id:-2,x:600,y:200},e}return Object(s.a)(n,[{key:"nodes",get:function(){return this.effects}},{key:"getSubDevices",value:function(){return this.effects.map(function(e){return{value:e,label:e.name}})}},{key:"getSubDeviceIndex",value:function(e){return this.effects.indexOf(e)}},{key:"getSubDevice",value:function(e){return this.effects[e]}},{key:"getParameters",value:function(){if(!this.parameters)return[];var e=Object(a.a)(this.parameters);for(var t in this.effects)e=[].concat(Object(a.a)(e),Object(a.a)(this.effects[t].getParameters()));return e}},{key:"lfoAdjacencyLists",get:function(){return this.getModAdjacencyLists(f.b)}},{key:"envelopeAdjacencyLists",get:function(){return this.getModAdjacencyLists(f.a)}},{key:"getModAdjacencyLists",value:function(e){var t=this,n=[].concat(Object(a.a)(this.sequencerEngine.lfos.map(function(e){return e.lfo})),Object(a.a)(this.sequencerEngine.envelopes)).filter(function(t){return t.getType()===e}),r={},i=function(a){var i=n[a],s=t.getParameters().filter(function(e){return e.lfos&&e.envelopes}).filter(function(t){return e===f.b?t.lfos.indexOf(i)>-1:t.envelopes.indexOf(i)>-1});if(0===s.length)return"continue";r[i.number]=s};for(var s in n)i(s);return r}},{key:"registerContext",value:function(e){var t=this;Object(o.a)(Object(l.a)(n.prototype),"registerContext",this).call(this,e),this.effects.forEach(function(n){return n.registerContext(e,t)})}},{key:"modulators",get:function(){return[].concat(Object(a.a)(this.sequencerEngine.lfos.map(function(e){return e.lfo})),Object(a.a)(this.sequencerEngine.envelopes))}},{key:"setSize",value:function(e,t,n,r){this.inputNode.x=0,this.inputNode.y=t/2-r/2,this.outputNode.x=e-n,this.outputNode.y=t/2-r/2}},{key:"addEffect",value:function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.x||(e.x=200,e.y=200);var t=(this.context||new d.a).getCopy();t.forEffect(this),e.registerContext(t,this),this.effects=[].concat(Object(a.a)(this.effects),[e]),e.rack=this}},{key:"deleteEffect",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.adjacencyLists[e.id]||[];for(var i in Object(a.a)(r).forEach(function(e){return t.deleteEdge(e)}),delete this.adjacencyLists[e.id],this.adjacencyLists)(r=this.adjacencyLists[i].filter(function(t){return t.effect===e})).forEach(function(e){return t.deleteEdge(e)});for(var s in this.lfoAdjacencyLists)void 0!==this.lfoAdjacencyLists[s]&&(r=this.lfoAdjacencyLists[s].filter(function(t){return e.parameters.indexOf(t)>-1})).forEach(function(e){return t.deleteEdge(e)});for(var o in this.envelopeAdjacencyLists)void 0!==this.envelopeAdjacencyLists[o]&&(r=this.envelopeAdjacencyLists[o].filter(function(t){return e.parameters.indexOf(t)>-1})).forEach(function(e){return t.deleteEdge(e)});n&&e.dispose(),this.effects.splice(this.effects.indexOf(e),1)}},{key:"deleteEdge",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.macro){var n=e.parameter;e.macro.unmapParameter(n,!1)}else if(e.modulator){var r=e.edge,a=e.modulator;a.getType()===f.b?r.disconnectFromLFO(a):r.disconnectFromEnvelope(a)}else for(var i in this.adjacencyLists){var s=this.adjacencyLists[i],o=s.indexOf(e);o>-1&&s.splice(o,1)}e.dispose&&t&&e.dispose()}},{key:"getLFO",value:function(e){return this.modulators.filter(function(e){return e.getType()===f.b}).find(function(t){return t.number===e})}},{key:"getEnvelope",value:function(e){return this.modulators.filter(function(e){return e.getType()===f.a}).find(function(t){return t.number===e})}},{key:"connectEdge",value:function(e,t){var n=void 0;return t.fromNode=e,n=e.effectNode||e.track?e.id:-1,void 0===this.adjacencyLists[n]&&(this.adjacencyLists[n]=[]),this.adjacencyLists[n].push(t),t}},{key:"connectNodes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inputNode,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.outputNode,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.isMacro(e))this.connectNodeToMacro(t,e);else if(e.getType)t.isAudioParamEnabled&&!t.isAudioParamEnabled()&&t.enableAudioParam(),e.getType()===f.b&&t.connectToLFO?t.connectToLFO(e):t.connectToEnvelope&&t.connectToEnvelope(e);else if(!t.isAudioParamEnabled){if(this.adjacencyLists[e.id]&&this.adjacencyLists[e.id].some(function(e){return e.effect===t}))return;var r=this.newEdge(t,n);return this.connectEdge(e,r),r}}},{key:"newEdge",value:function(e,t){return new v.a(e,this.sequencerEngine,t)}},{key:"getRackJson",value:function(){var e=this,t={},a=function(n){var r=e.adjacencyLists[n].map(function(t){return t.getJson(e)});if(-1===parseInt(n))t[n]=r;else{var a=e.effects.find(function(e){return e.id===n});t[e.effects.indexOf(a)]=r}};for(var i in this.adjacencyLists)a(i);this.saveCurrentConfiguration();var s=Object(r.a)({},Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this),s,{configurations:this.getConfigurationJson(),outputPosition:{x:this.outputNode.x,y:this.outputNode.y},currentConfiguration:this.currentConfiguration,macros:this.macros.map(function(e){return e.getJson()}),adjacencyLists:t,effects:this.effects.map(function(e){return Object(r.a)({},e.getJson(),{_x:e.x,_y:e.y})})});return s=Object(p.b)(s,"configurationParameter",this.configurationParameter)}},{key:"fromRackJson",value:function(e,t){this.loaded=!1,e.outputPosition&&(this.outputNode.x=e.outputPosition.x,this.outputNode.y=e.outputPosition.y),e.configurations&&this.loadConfigurationJson(e.configurations);var n=e.adjacencyLists;for(var r in n){var a=this.effects[r];for(var i in a||(a=this.inputNode),n[r]){var s=this.newEdge(void 0);s.fromJson(n[r][i],this),this.connectEdge(a,s)}}if(void 0!==e.currentConfiguration&&(this.currentConfiguration=e.currentConfiguration),this.loadParameterFromJson(e,"configurationParameter",this.configurationParameter,t),e.macros){var o=this.getParameters();for(var c in e.macros){var u=this.context||new d.a;this.newMacro(u.getCopy().forEffect(this)).fromJson(e.macros[c],o)}}this.loaded=!0}},{key:"pasteNodes",value:function(e){var t,n=e.map(function(e){return e.getEffectCopy()}),r=m(n);try{for(r.s();!(t=r.n()).done;){var a=t.value;this.addEffect(a);var i=Object(h.a)(e[0].x,e[0].y,this),s=i.x,o=i.y;a.x=s,a.y=o}}catch(y){r.e(y)}finally{r.f()}for(var c in e){var u=this.adjacencyLists[e[c].id];if(u){var l,f=n[c],p=m(u);try{for(p.s();!(l=p.n()).done;){var d=l.value,v=e.indexOf(d.effect);v>-1?this.connectNodes(f,n[v]):this.connectNodes(f,d.effect)}}catch(y){p.e(y)}finally{p.f()}}}}},{key:"connectNodesInSeries",value:function(e){e.sort(function(e,t){return e.x-t.x});var t,n=void 0,r=m(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n&&this.connectNodes(n,a),n=a}}catch(i){r.e(i)}finally{r.f()}}},{key:"clearRack",value:function(){var e=this;this.effects.forEach(function(t){return e.deleteEffect(t,!1)})}}]),n}(e)}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(361);function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=u(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).macros=[],e}return Object(a.a)(n,[{key:"connectNodeToMacro",value:function(e,t){e&&e.isParameter&&t.addParameter(e)}},{key:"isMacro",value:function(e){return this.macros.indexOf(e)>-1}},{key:"deleteMacro",value:function(e){var t=this.macros.indexOf(e);this.macros.splice(t,1),e.dispose()}},{key:"newMacro",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.context,t="Macro "+(this.macros.length+1),n=new c.a(t,this.sequencerEngine,e);return this.macros.push(n),n}},{key:"macroAdjacencyLists",get:function(){var e={};for(var t in this.macros){var n=this.macros[t],r=n.subMacros;e[n.id]=r}return e}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return s});var r=n(107),a=n(111),i=function(e){var t=Object(r.a)(e,3),n=t[0],i=t[1],s=t[2];return Object(a.Q)({stepData:n,stepNumber:i,time:s})},s=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.duration,r=arguments.length>3?arguments[3]:void 0;return function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];s[0];var c=s[1],u=s[2],l=s[3];r&&(u=r);var f=l.getStep(e);return f.transpose=a.A.apply(void 0,[t].concat(s)),f.duration=a.A.apply(void 0,[n].concat(s)),Object(a.Q)({stepData:f,time:u,stepNumber:c})}}},function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"b",function(){return s});var r=n(111),a=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t.reduce(function(e,t){return r.A.apply(void 0,[t].concat(n))+e},0)}},i=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t.reduce(function(e,t){return r.A.apply(void 0,[t].concat(n))*e},1)}},s=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var s=r.A.apply(void 0,[e].concat(a)),o=r.A.apply(void 0,[t].concat(a));return(s%o+o)%o}}},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return u});n(262);var r=n(158),a={A:"a","A#":"A",B:"b",C:"c","C#":"C",D:"d","D#":"D",E:"e",F:"f","F#":"F",G:"g","G#":"G"},i={A:r.a.utils.asciiToHex("a"),"A#":r.a.utils.asciiToHex("A"),B:r.a.utils.asciiToHex("b"),C:r.a.utils.asciiToHex("c"),"C#":r.a.utils.asciiToHex("C"),D:r.a.utils.asciiToHex("d"),"D#":r.a.utils.asciiToHex("D"),E:r.a.utils.asciiToHex("e"),F:r.a.utils.asciiToHex("f"),"F#":r.a.utils.asciiToHex("F"),G:r.a.utils.asciiToHex("g"),"G#":r.a.utils.asciiToHex("G")},s={};for(var o in i)s[i[o]]=o;for(var c in s={},a)s[a[c]]=c;var u=s},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return i});var r=n(7),a=n.n(r),i=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.a.Master.context.sampleRate,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise(function(a,i){new FormData;var s=new Worker(window.isNFT?"recorderWorker.js":"/recorderWorker.js");s.postMessage({command:"init",config:{sampleRate:n,numChannels:t.length}}),s.onmessage=function(t){var n,i=t.data,s=new FileReader;s.onload=function(){n=this.result,a(r?n:new e(n))},s.readAsArrayBuffer(i)},s.postMessage({command:"record",buffer:t}),s.postMessage({command:"exportWAV",type:"audio/wav"})})}}).call(this,n(108).Buffer)},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(6),o=n(8),c=n(2),u=n(119),l=n(126);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(s.a)(n,e);var t=f(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).parameters=[],e}return Object(i.a)(n,[{key:"registerParameter",value:function(e){this.store&&e.setStore(this.store),this.parameters.push(e)}},{key:"getParameters",value:function(){return this.parameters.filter(function(e){return e})}},{key:"getJson",value:function(){var e={name:this.name,id:this.id,x:this.x,y:this.y};for(var t in this.parameters){var n=this.parameters[t];if(n){e[n.name]=n.get();var r=n.name+"Parameter";e=Object(l.b)(e,r,n,this.sequencerEngine)}}return e}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];void 0===e.id||t||(this.id=e.id),void 0!==e.x&&(this.x=e.x,this.y=e.y);var n={};for(var a in this.parameters){var i=this.parameters[a];if(i){var s=e[i.name];void 0!==s&&null!==s&&Object(u.a)(i,s,n),n=Object(r.a)({},n,Object(l.a)(e,i.name+"Parameter",i,this.sequencerEngine,t))}}return n}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"d",function(){return l}),n.d(t,"a",function(){return f}),n.d(t,"b",function(){return p}),n.d(t,"e",function(){return d}),n.d(t,"c",function(){return v});var r=n(42),a=n.n(r),i=n(56),s=n(11);function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=function e(t){var n=[];if(t.tracks&&Array.isArray(t.tracks)&&(n=[].concat(Object(s.a)(n),Object(s.a)(t.tracks.map(function(t){return e(t.track)})))),t.samplers&&(n=[].concat(Object(s.a)(n),Object(s.a)(Object.keys(t.samplers)))),t.instrument&&t.instrument.getSamples){var r=t.instrument.getSamples().map(function(e){return e.getId()});n=[].concat(Object(s.a)(n),Object(s.a)(r))}if(t.frozenColumns){var a,i=o(t.frozenColumns);try{for(i.s();!(a=i.n()).done;){var c=a.value;n=[].concat(Object(s.a)(n),Object(s.a)(c.frozenSamples.map(function(e){return e.getId()})))}}catch(h){i.e(h)}finally{i.f()}}var u,l=o(t.effects);try{for(l.s();!(u=l.n()).done;){var f=u.value;"Convolver Reverb"===f.name&&n.push(f.convolverSample)}}catch(h){l.e(h)}finally{l.f()}return n},l=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,c,l,f,h,p,d,v,m,y,b,g,O,k,j,w,x,S,P,E,T,A,M,R,C,N,q;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=o(t.subSequences);try{for(r.s();!(i=r.n()).done;){c=i.value,l=o(c.tracks);try{for(l.s();!(f=l.n()).done;)h=f.value,n=[].concat(Object(s.a)(n),Object(s.a)(u(h)))}catch(a){l.e(a)}finally{l.f()}}}catch(a){r.e(a)}finally{r.f()}n=[].concat(Object(s.a)(n),Object(s.a)(u(t.metronome))),p=o(t.sends.sends);try{for(p.s();!(d=p.n()).done;){v=d.value,m=o(v.effects);try{for(m.s();!(y=m.n()).done;)"Convolver Reverb"===(b=y.value).name&&n.push(b.convolverSample)}catch(a){m.e(a)}finally{m.f()}}}catch(a){p.e(a)}finally{p.f()}g=o(t.channelMixer.masterChannel.effectsChain.effects);try{for(g.s();!(O=g.n()).done;)"Convolver Reverb"===(k=O.value).name&&n.push(k.convolverSample)}catch(a){g.e(a)}finally{g.f()}j=t.currentSubSequence.findNodeByName("spore.stems"),w=o(j);try{for(w.s();!(x=w.n()).done;)S=x.value,n=[].concat(Object(s.a)(n),Object(s.a)(S.effect.playlist.flatMap(function(e){return e.samples.map(function(e){return e.ipfsHash})})))}catch(a){w.e(a)}finally{w.f()}P=t.currentSubSequence.findNodeByName("ipfs.drop"),E=o(P);try{for(E.s();!(T=E.n()).done;)A=T.value,M=Object.values(A.effect.hashMap),console.log("IPFS.DROP SAMPLES TO SAVE=",M),n=[].concat(Object(s.a)(n),Object(s.a)(M))}catch(a){E.e(a)}finally{E.f()}R=t.currentSubSequence.findNodeByName("samples.tag"),C=o(R);try{for(C.s();!(N=C.n()).done;)q=N.value,n=[].concat(Object(s.a)(n),Object(s.a)(q.effect.samples))}catch(a){C.e(a)}finally{C.f()}return e.abrupt("return",n);case 18:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,c,u,l,f,h,p,d;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=o(t.sends.sends),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=27;break}i=r.value,s=o(i.effects),e.prev=6,s.s();case 8:if((c=s.n()).done){e.next=17;break}if("Convolver Reverb"!==(u=c.value).name){e.next=15;break}return e.next=13,u.getBouncedSample();case 13:l=e.sent,u.convolverSample=l;case 15:e.next=8;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(6),s.e(e.t0);case 22:return e.prev=22,s.f(),e.finish(22);case 25:e.next=3;break;case 27:e.next=32;break;case 29:e.prev=29,e.t1=e.catch(1),n.e(e.t1);case 32:return e.prev=32,n.f(),e.finish(32);case 35:f=o(t.channelMixer.masterChannel.effectsChain.effects),e.prev=36,f.s();case 38:if((h=f.n()).done){e.next=47;break}if("Convolver Reverb"!==(p=h.value).name){e.next=45;break}return e.next=43,p.getBouncedSample();case 43:d=e.sent,p.convolverSample=d;case 45:e.next=38;break;case 47:e.next=52;break;case 49:e.prev=49,e.t2=e.catch(36),f.e(e.t2);case 52:return e.prev=52,f.f(),e.finish(52);case 55:case"end":return e.stop()}},e,null,[[1,29,32,35],[6,19,22,25],[36,49,52,55]])}));return function(t){return e.apply(this,arguments)}}(),h=function e(t){var n=[];if(t.tracks)return t.tracks.flatMap(function(t){return e(t)});if(t.samplers)for(var r in t.samplers)n.push(t.samplers[r].sample);if(t.instrument&&t.instrument.getSamples){var a=t.instrument.getSamples();n=[].concat(Object(s.a)(n),Object(s.a)(a))}return n},p=function(e){var t,n=[],r=o(e.subSequences);try{for(r.s();!(t=r.n()).done;){var a,i=o(t.value.tracks);try{for(i.s();!(a=i.n()).done;){var c=a.value;n=[].concat(Object(s.a)(n),Object(s.a)(h(c)))}}catch(l){i.e(l)}finally{i.f()}}}catch(l){r.e(l)}finally{r.f()}var u={};return n.forEach(function(e){return u[e.getId()]=e.getJson()}),u},d=function(e){var t,n={},r=o(e.subSequences);try{for(r.s();!(t=r.n()).done;){var a,i=o(t.value.tracks);try{for(i.s();!(a=i.n()).done;){var s=a.value;n[s.id]=h(s)}}catch(c){i.e(c)}finally{i.f()}}}catch(c){r.e(c)}finally{r.f()}return n},v=function(e){return e.subSequences.flatMap(function(e){return m(e)})},m=function e(t){var n,r=t.zObjects.filter(function(e){return"three.textureLoader"===e.name}).map(function(e){return e.effect.imageHash}).filter(function(e){return e}),a=o(t.zObjects);try{for(a.s();!(n=a.n()).done;){var i=n.value;"preset"===i.name&&(r=[].concat(Object(s.a)(r),Object(s.a)(i.effect.getImageHashes()))),"subpatch"===i.name&&(r=[].concat(Object(s.a)(r),Object(s.a)(e(i.effect))))}}catch(c){a.e(c)}finally{a.f()}return r}},function(e,t,n){"use strict";n.d(t,"g",function(){return a}),n.d(t,"f",function(){return i}),n.d(t,"a",function(){return s}),n.d(t,"d",function(){return o}),n.d(t,"e",function(){return c}),n.d(t,"c",function(){return u}),n.d(t,"b",function(){return l});var r=n(161),a=function(e){return"hexagon"!==e&&"circle"!==e},i=function(e){return"circle"!==e&&"rect"!==e&&"hexagon"!==e},s=function(e){var t=Object(r.a)(e),n=t[0],a=t.slice(1);return i(n)?a[6]:a[4]},o=function(e){var t=Object(r.a)(e),n=t[0],a=t.slice(1);return i(n)?a[8]||0:a[6]||0},c=function(e){var t=Object(r.a)(e),n=t[0],a=t.slice(1);return i(n)?a[7]||0:a[5]||0},u=function(e){var t=Object(r.a)(e),n=t[0],a=t.slice(1);return i(n)?[a[0],a[1],a[2]]:[a[0],a[1]]},l=function(e){var t=Object(r.a)(e),n=t[0],a=t.slice(1);return i(n)?[a[3],a[4],a[5]]:[a[2],a[3]]}},function(e,t,n){"use strict";function r(e){return Math.pow(10,.05*e)}function a(e){return 20*Math.log(e)/Math.LN10}n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a})},function(e,t,n){"use strict";var r=n(1),a=n(42),i=n.n(a),s=n(56),o=n(4),c=n(5),u=n(31),l=n(10),f=n(6),h=n(8),p=n(2),d=n(116),v=n(340),m=n(119),y=n(138),b=n(125),g=n(855),O=(n(300),n(7)),k=n.n(O),j=n(572),w=n(14),x=n(122);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}k.a.Frequency("C3");var P={Hangar:"/convolverHangar.wav","Giant Cave":"/convolver/GiantCave.wav","Airport Terminal":"/convolver/AirportTerminal.wav","Outdoor Blastoff":"/convolver/OutdoorBlastOff.wav","Outdoor Stadium":"/convolver/OutdoorStadium.wav","Plate Large":"/convolver/PlateLarge.wav","Plate Medium":"/convolver/PlateMedium.wav","Plate Small":"/convolver/PlateSmall.wav","Plate Super Dry":"/convolver/PlateSuperDry.wav","Prime Long":"/convolver/PrimeLong.wav","Prime Medium":"/convolver/PrimeMed.wav","Prime Short":"/convolver/PrimeShort.wav","Prime Extra Long":"/convolver/PrimeXtraLong.wav","Room Concert Hall":"/convolver/RoomConcertHall.wav","Room Huge":"/convolver/RoomHuge.wav","Room Large":"/convolver/RoomLarge.wav","Room Medium":"/convolver/RoomMedium.wav","Room Pool":"/convolver/RoomPool.wav"},E=function(e){Object(f.a)(n,e);var t=S(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.a.DEFAULT_BUFFER;return Object(o.a)(this,n),(r=t.call(this,"Convolver Reverb",function(){return new k.a.Convolver(a)},e)).rawBuffer=new k.a.Buffer(a),r.convolverSample="QmcdpaZe62u6p47s2Nmi7jYLpgTbmz6MxVnwvndNFi53Sf",r.startParameter=new w.a("start",Object(u.a)(r),function(e,t){return r.start=t},{defaultValue:0,documentation:"Change the start point of the impulse",automatable:!1}),r.pitchParameter=new w.a("Pitch",Object(u.a)(r),function(e,t){return r.pitch=t},{documentation:"Change the pitch of the impulse",automatable:!1}),r.durationParameter=new w.a("duration",Object(u.a)(r),function(e,t){return r.release=t},{defaultValue:100,documentation:"Change the length of the impulse",automatable:!1}),r.attackParameter=new w.a("attack",Object(u.a)(r),function(e,t){return r.attack=t},{defaultValue:0,documentation:"Change the attack, or fade-in, of the impulse",automatable:!1}),r.registerParameter(r.attackParameter),r.registerParameter(r.startParameter),r.registerParameter(r.pitchParameter),r.registerParameter(r.durationParameter),r.updateInitialValues(),r}return Object(c.a)(n,[{key:"documentation",get:function(){return["Uses an impulse sample to create a realistic reverb.","Drag any sample into this effect to change the impulse sample."]}},{key:"start",get:function(){return this.startParameter.get(!0)},set:function(e){100!==e&&this.renderBuffer()}},{key:"release",set:function(e){100!==e&&e>.01&&this.renderBuffer()}},{key:"attack",get:function(){return this.attackParameter.get(!0)},set:function(e){0!==e&&this.renderBuffer()}},{key:"pitch",get:function(){return this.pitchParameter.get(!0)},set:function(e){0!==e?this.renderBuffer():this.effectNode&&(this.effectNode.buffer=this.rawBuffer)}},{key:"getBouncedSample",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.renderedBuffer,n=[t.getChannelData(0)],t.numberOfChannels>1&&n.push(t.getChannelData(1)),e.next=5,Object(v.a)(n);case 5:return r=e.sent,e.next=8,x.a.addArrayBuffer(r);case 8:return a=e.sent,e.abrupt("return",a);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"duration",get:function(){return this.durationParameter.get(!0)}},{key:"renderBuffer",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r,a,s,o,c,u,l,f,h,p;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.rawBuffer&&null!==this.rawBuffer){e.next=2;break}return e.abrupt("return");case 2:if(void 0!==this.startParameter&&void 0!==this.durationParameter&&void 0!==this.pitchParameter){e.next=4;break}return e.abrupt("return");case 4:if(0!==this.startParameter.get()||100!==this.durationParameter.get()||0!==this.pitchParameter.get()){e.next=8;break}return this.effectNode.buffer=this.rawBuffer,this.renderedBuffer=this.rawBuffer,e.abrupt("return");case 8:if(this.effectNode){e.next=10;break}return e.abrupt("return");case 10:if(t=new k.a.Buffer(this.rawBuffer),this.effectNode){e.next=13;break}return e.abrupt("return");case 13:if(!window.isNFT){e.next=17;break}return this.renderedBuffer=t,this.effectNode.buffer=t,e.abrupt("return");case 17:if(n=t.duration*this.start/100,r=t.duration-n,this.effectNode){e.next=21;break}return e.abrupt("return");case 21:if(a=r*this.duration/100,s=a*this.attack/100,this.effectNode){e.next=25;break}return e.abrupt("return");case 25:if(this.sequencerEngine.hasConvolver=!0,this.effectNode){e.next=28;break}return e.abrupt("return");case 28:return o=k.a.Master.context.sampleRate,c=new OfflineAudioContext(2,o*a*2,o),u=c.createBufferSource(),(l=c.createGain(1)).connect(c.destination),s>0&&(l.gain.value=0,l.gain.linearRampToValueAtTime(1,s)),l.gain.linearRampToValueAtTime(0,a),u.connect(l),f=k.a.intervalToFrequencyRatio(this.pitch),u.playbackRate.value=f,u.buffer=t._buffer,u.start(0,n),e.next=42,c.startRendering();case 42:h=e.sent,p=0;case 44:if(void 0!==this.effectNode){e.next=52;break}return e.next=47,this.sleep(100);case 47:if(!(++p>10)){e.next=50;break}return e.abrupt("return");case 50:e.next=44;break;case 52:this.renderedBuffer=new k.a.Buffer(h),this.effectNode.buffer=new k.a.Buffer(h);case 54:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sleep",value:function(e){return new Promise(function(t,n){setTimeout(function(){return t()},e)})}},{key:"setConvolverSample",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===this.encryptedIpfs&&(this.encryptedIpfs=new j.a(this.sequencerEngine.store,this.sequencerEngine.ethereum.guilds,this.sequencerEngine.ethereum.encryption,this.sequencerEngine.ethereum.crypto)),e.next=3,this.encryptedIpfs.getSound(t);case 3:if(void 0!==(n=e.sent)){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,k.a.Master.context.decodeAudioData(n.buffer);case 8:if(r=e.sent,this.effectNode){e.next=11;break}return e.abrupt("return");case 11:return this.convolverType=void 0,this.convolverSample=t,this.rawBuffer=r,e.next=16,this.renderBuffer();case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setConvolverType",value:function(e){var t=this;return new Promise(function(n,r){if(e in P){var a=window.installation?"/public"+P[e]:P[e];t.effectNode.load(a,Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.rawBuffer=new k.a.Buffer(t.effectNode.buffer),e.next=3,t.renderBuffer();case 3:n();case 4:case"end":return e.stop()}},e)}))),t.samplePitch=0,t.convolverType=e,t.convolverSample=void 0}})}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t){var r=new n(e);return r.fromJson(this.getJson()),r}var a=new n(e,new k.a.Buffer(this.effectNode.buffer));return a.wetParameter.fromJson(this.wetParameter.getJson(),e),t||(a.id=this.id,a.wetParameter.id=this.wetParameter.id),a}},{key:"makePublicIfNeeded",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.convolverSample){e.next=12;break}return e.next=3,b.a.guildSamples.getGuildIdForSound(this.convolverSample);case 3:if(void 0===(t=e.sent)||0===t){e.next=12;break}return n=new y.a(this.convolverSample),e.next=8,n.load();case 8:return e.next=10,b.a.guildSamples.saveSample(n);case 10:r=e.sent,this.convolverSample=r;case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getJson",value:function(e){var t=Object(r.a)({},Object(l.a)(Object(p.a)(n.prototype),"getJson",this).call(this,e),{name:this.name,enabled:this.enabledParameter.get(!0),convolverType:this.convolverType,convolverSample:this.convolverSample,start:this.start,pitch:this.pitch,attack:this.attack,duration:this.duration});return t=this.saveParameterToJson(t,"wetParameter",this.wetParameter)}},{key:"fromJson",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var a,s,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>1&&void 0!==o[1]&&o[1],e.next=3,this.sleep(50);case 3:if(s=Object(l.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,t,a),void 0===t.convolverType){e.next=10;break}if("Prime Extra Long"===t.convolverType){e.next=8;break}return e.next=8,this.setConvolverType(t.convolverType);case 8:e.next=15;break;case 10:if(void 0===t.convolverSample){e.next=15;break}return e.next=13,this.sleep(150);case 13:return e.next=15,this.setConvolverSample(t.convolverSample,t);case 15:if(!("pitch"in t)){e.next=20;break}if(Object(m.a)(this.pitchParameter,t.pitch,s),0===t.pitch){e.next=20;break}return e.next=20,this.sleep(50);case 20:if(!("duration"in t)){e.next=25;break}if(Object(m.a)(this.durationParameter,t.duration,s),100===t.duration){e.next=25;break}return e.next=25,this.sleep(50);case 25:return"attack"in t&&Object(m.a)(this.attackParameter,t.attack,s),"start"in t&&Object(m.a)(this.startParameter,t.start,s),e.abrupt("return",Object(r.a)({},s));case 28:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){Object(l.a)(Object(p.a)(n.prototype),"dispose",this).call(this,!1),this.rawBuffer&&this.rawBuffer.dispose&&this.rawBuffer.dispose(),this.rawBuffer=void 0,this.attackParameter=void 0,this.pitchParameter=void 0,this.durationParameter=void 0}}]),n}(d.a.Effect);t.a=E},function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"d",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"a",function(){return s});var r=1,a=2,i=3,s=4},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(11);function a(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw s}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.state,s=Object(r.a)(t.zMessages);if(t.tracks){s=[].concat(Object(r.a)(s),Object(r.a)(t.midiEffects.effects));var o,c=a(t.tracks);try{for(c.s();!(o=c.n()).done;){var u=o.value;s=[].concat(Object(r.a)(s),Object(r.a)(u.midiEffects.effects)),s=[].concat(Object(r.a)(s),Object(r.a)(u.effects))}}catch(d){c.e(d)}finally{c.f()}}var l,f=a(t.zObjects);try{for(f.s();!(l=f.n()).done;){var h=l.value;if(!n||!i.spatial.hiddenObjects[h.id]){s.push(h);var p=h.effect;p&&(s.push(p),p.zObjects&&(s=[].concat(Object(r.a)(s),Object(r.a)(e(p)))))}}}catch(d){f.e(d)}finally{f.f()}return s}},,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(7),a=n.n(r);function i(e){return new a.a.Time(e).toMilliseconds()-new a.a.Time(a.a.Master.context.currentTime).toMilliseconds()}},,function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(4),s=n(5),o=n(10),c=n(6),u=n(8),l=n(2),f=n(7),h=n.n(f),p=n(20),d=new(function(){function e(){Object(i.a)(this,e),this.lfos=[]}return Object(s.a)(e,[{key:"useLFO",value:function(){return 0!==this.lfos.length&&window.explore?this.lfos.pop():new h.a.LFO(0,-100,100)}},{key:"releaseLFO",value:function(e){window.explore?(e.disconnect(),this.lfos.push(e)):e.dispose()}}]),e}()),v=new(function(){function e(){Object(i.a)(this,e),this.chains=[],this.totalCreated=0,window.lfoChainFactory=this}return Object(s.a)(e,[{key:"useChain",value:function(e,t){var n=void 0;this.chains.length>0&&!t.isOffline?n=this.chains.pop():(this.totalCreated++,n=[new h.a.Normalize(-100,100),new h.a.Scale(e.min,e.max),new h.a.Gain(1)]);return n[1].min=e.min,n[1].max=e.max,n}},{key:"disposeChain",value:function(e){e.forEach(function(e){return e.dispose()})}},{key:"releaseChain",value:function(e,t){if(t.isOffline)this.disposeChain(e);else{if(this.chains.length>=50){var n=this.chains[0];this.disposeChain(n),this.chains=this.chains.slice(1)}this.chains.push(e)}}}]),e}()),m=n(126),y=n(119),b=n(22),g=n(204),O=n(112);function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var j=[{value:"1n",label:"1"},{value:"2n",label:"1/2"},{value:"4n",label:"1/4"},{value:"4t",label:"1/4t"},{value:"8n",label:"1/8"},{value:"8n.",label:"1/8."},{value:"8t",label:"1/8t"},{value:"16n",label:"1/16"},{value:"16t",label:"1/16t"},{value:"32n",label:"1/32"}],w=function(e){Object(c.a)(n,e);var t=k(n);function n(e,r,a){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(i.a)(this,n),t.call(this,e,r,a,s)}return Object(s.a)(n,[{key:"toSeconds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new h.a.Time(this.get(t,e)).toSeconds()}},{key:"toFrequency",value:function(){return new h.a.Time(this.get()).toFrequency()}},{key:"toString",value:function(){return new h.a.Time(this.get()).toString()}},{key:"quantize",value:function(e){e=new h.a.Frequency(e);var t=1e5,n=void 0;for(var r in j){var a=new h.a.Time(j[r].value),i=Math.abs(a.toFrequency()-e.toFrequency());i<t&&(t=i,n=a)}return n}}]),n}(O.a),x=n(866),S=n(14);function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var E=n(43),T=n(867),A=n(23);function M(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var N=function(e){Object(c.a)(n,e);var t=C(n);function n(e,r,a,s){var o;return Object(i.a)(this,n),(o=t.call(this,e,r,a,s)).id=Object(p.uuid)(),o.lastValue=void 0,o.lastStep=void 0,o.number=s,o.rawLFORate=void 0,o.mixSession=r,o.lfo=d.useLFO(),o.setupLFOParameters(),o.isSynced=!0,o.state="stopped",e.dispatch(Object(A.ub)(o.initialBulkValues)),o}return Object(s.a)(n,[{key:"getType",value:function(){return"LFO"}},{key:"dispose",value:function(){if(this.lfo){for(var e in d.releaseLFO(this.lfo),this.parameterIdToVoiceToNode){var t=this.parameterIdToVoiceToNode[e];for(var n in t){var r=t[n];r.slice(0,r.length-1).filter(function(e){return e.dispose&&e.input}).forEach(function(e){e.dispose()})}}this.parameterIdToVoiceToNode=void 0,this.lfo=void 0,this.lfoRateParameter=void 0,this.lfoMinParameter=void 0,this.lfoMaxParameter=void 0,this.lfoPhaseParameter=void 0,this.lfoAmpParameter=void 0}}},{key:"getDepthFromChain",value:function(e){return e[2]}},{key:"getScaleFromChain",value:function(e){return e[1]}},{key:"startTime",get:function(){return this._startTime},set:function(e){this._startTime=e}},{key:"start",value:function(e){this.stop(void 0===e?0:Math.max(0,e-.1)),h.a.Master.context.isOffline?void 0!==e?this.lfo.start(h.a.Master.context._currentTime+e+1e-5):this.lfo.start(h.a.Master.context._currentTime+1e-5):this.lfo.start(h.a.Master.context.isOffline?h.a.Master.context._currentTime+e:e),this.state="started",this.lfo.lfoType=this.lfoType,this.startTime=e||h.a.Master.context.currentTime,this.stoppedTime=void 0}},{key:"stop",value:function(e){this.lfo.stop(e),this.state="stopped",this.stoppedTime=h.a.Master.context.isOffline?h.a.Master.context._currentTime:h.a.Master.context.currentTime}},{key:"getModulator",value:function(){return this.lfo}},{key:"getChain",value:function(e,t){return[].concat(Object(a.a)(v.useChain(e,this.sequencerEngine)),[t])}},{key:"releaseChain",value:function(e){v.releaseChain(e.slice(0,e.length-1),this.sequencerEngine)}},{key:"connect",value:function(e,t,r){if(void 0!==e){var a=e;e.input&&!Array.isArray(e.input)&&(a=e.input);Object(o.a)(Object(l.a)(n.prototype),"connect",this).call(this,a,t,r);"stopped"===this.state&&this.start()}else{var i=new x.a(t.min,t.max);this.parameterToScaler[t.id]=i}}},{key:"setupLFOParameters",value:function(){var e=this;this.lfoTypeParameter=new S.a("LFO Type",this,function(t,n){e.stop(),e.lfo.type=n||"sine",e.start()},{min:0,max:1,defaultValue:"sine",automatable:!1}),this.registerParameter(this.lfoTypeParameter);this.number;this.lfoRateParameter=new w("LFO Rate",this.lfo.frequency,function(t,n){e.lfo.frequency.input&&(e.lfo.frequency.value=new h.a.Frequency(n))},{min:0,max:800,unit:"",defaultValue:Math.pow(2,5-this.number)+"n"}),this.registerParameter(this.lfoRateParameter),this.lfoMinParameter=new O.a("LFO Min",this.lfo._scaler._add,function(t,n){e.lfo._scaler._add.input&&(e.lfo.min=n)},{min:-100,max:100,unit:"",defaultValue:-100}),this.registerParameter(this.lfoMinParameter),this.lfoMaxParameter=new O.a("LFO Max",this.lfo._scaler._scale,function(t,n){e.lfo._scaler._scale.input&&(e.lfo.max=n)},{min:-100,max:100,unit:"",defaultValue:100}),this.registerParameter(this.lfoMaxParameter),this.lfoAmpParameter=new O.a("LFO Amplitude",this.lfo.amplitude,function(t,n){e.lfo.amplitude.input&&(e.lfo.amplitude.value=n)},{min:0,max:1,unit:"",defaultValue:1,automationRate:b.a}),this.registerParameter(this.lfoAmpParameter),this.lfoPhaseParameter=new S.a("LFO Phase",this,function(t,n){e.lfo.frequency.input&&(e.lfo.phase=n)},{min:0,max:360,unit:"",defaultValue:0}),this.registerParameter(this.lfoPhaseParameter)}},{key:"registerParameter",value:function(e){this.initialBulkValues=Object(r.a)({},this.initialBulkValues,e.setStore(this.store)),e.setMixSession(this.mixSession),e.setContext(this.context),this.parameters.push(e)}},{key:"name",get:function(){return"LFO "+this.number}},{key:"lfoType",get:function(){return void 0===this.lfoTypeParameter?"sine":this.lfoTypeParameter.get()},set:function(e){this.lfoTypeParameter.set(e,!1)}},{key:"lfoRate",get:function(){return this.lfoRateParameter.get(!0)},set:function(e){this.lfoRateParameter.set(e,!1),this.rawLFORate=e}},{key:"lfoMin",get:function(){return this.lfoMinParameter.get()},set:function(e){this.lfoMinParameter.set(e)}},{key:"parameterHasCycle",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(a>6)return!0;if(t){if(e.lfos.includes(this)||e.lfos.includes(n))return!0}else t=e;var i,s=M(e.lfos);try{var o=function(){var e=i.value;if(e.parameters.some(function(n){return r.parameterHasCycle(n,t,e,a++)}))return{v:!0}};for(s.s();!(i=s.n()).done;){var c=o();if("object"===typeof c)return c.v}}catch(u){s.e(u)}finally{s.f()}return!1}},{key:"lfoMax",get:function(){return this.lfoMaxParameter.get()},set:function(e){this.lfoMaxParameter.set(e)}},{key:"lfoPhase",get:function(){return this.lfoPhaseParameter.get()},set:function(e){this.lfoPhaseParameter.set(e)}},{key:"onBPMUpdated",value:function(){var e=this.lfoRateParameter.get(!0);this.lfoRateParameter.set(e,!0,!0)}},{key:"getJson",value:function(e){var t=this.lfoRate;return"number"!==typeof t&&void 0!==this.rawLFORate&&(t=this.rawLFORate),{id:this.id,lfoRateParameter:this.lfoRateParameter.getJson(e),lfoRate:t,lfoMinParameter:this.lfoMinParameter.getJson(e),lfoMaxParameter:this.lfoMaxParameter.getJson(e),lfoTypeParameter:this.lfoTypeParameter.getJson(e),lfoAmpParameter:this.lfoAmpParameter.getJson(e),lfoPhaseParameter:this.lfoPhaseParameter.getJson(e),isSynced:this.isSynced}}},{key:"fromJson",value:function(e,t){var n="started"===this.lfo.state;n&&this.stop(),!t&&e.id&&(this.id=e.id);var a=Object(r.a)({},Object(m.a)(e,"lfoRateParameter",this.lfoRateParameter,this.sequencerEngine,t));return"isSynced"in e&&(this.isSynced=e.isSynced),"lfoRate"in e&&(Object(E.a)(e.lfoRate)&&this.isSynced?Object(y.a)(this.lfoRateParameter,new h.a.Time(1/e.lfoRate).toNotation(),a):Object(y.a)(this.lfoRateParameter,e.lfoRate,a)),"lfoMinParameter"in e&&(a=Object(r.a)({},a,Object(m.a)(e,"lfoMinParameter",this.lfoMinParameter,this.sequencerEngine,t))),"lfoMin"in e&&Object(y.a)(this.lfoMinParameter,e.lfoMin,a),"lfoMaxParameter"in e&&(a=Object(r.a)({},a,Object(m.a)(e,"lfoMaxParameter",this.lfoMaxParameter,this.sequencerEngine,t))),"lfoMax"in e&&Object(y.a)(this.lfoMaxParameter,e.lfoMax,a),a=Object(r.a)({},a,Object(m.a)(e,"lfoTypeParameter",this.lfoTypeParameter,this.sequencerEngine,t),Object(m.a)(e,"lfoAmpParameter",this.lfoAmpParameter,this.sequencerEngine,t)),"lfoType"in e&&Object(y.a)(this.lfoTypeParameter,e.lfoType,a),"lfoPhaseParameter"in e&&(a=Object(r.a)({},a,Object(m.a)(e,"lfoPhaseParameter",this.lfoPhaseParameter,this.sequencerEngine,t))),"lfoPhase"in e&&Object(y.a)(this.lfoPhaseParameter,e.lfoPhase,a),n&&this.start(),a}},{key:"copyFrom",value:function(e){this.lfoType=e.lfoType,this.lfoRate=e.lfoRate,this.lfoMin=e.lfoMin,this.lfoMax=e.lfoMax,this.lfoPhase=e.lfoPhase,this.isSynced=e.isSynced}},{key:"mateJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;Object(g.a)(t)&&(this.lfoTypeParameter.disconnectFromAllModulators(),this.lfoTypeParameter.fromJson(e.lfoTypeParameter,this.sequencerEngine)),Object(g.a)(t)&&(this.lfoRateParameter.disconnectFromAllModulators(),this.lfoRate=e.lfoRate,this.lfoRateParameter.fromJson(e.lfoRateParameter,this.sequencerEngine)),Object(g.a)(t)&&(this.lfoMinParameter.disconnectFromAllModulators(),this.lfoMinParameter.fromJson(e.lfoMinParameter,this.sequencerEngine)),Object(g.a)(t)&&(this.lfoMaxParameter.disconnectFromAllModulators(),this.lfoMaxParameter.fromJson(e.lfoMaxParameter,this.sequencerEngine)),Object(g.a)(t)&&(this.lfoPhaseParameter.disconnectFromAllModulators(),this.lfoPhaseParameter.fromJson(e.lfoPhaseParameter,this.sequencerEngine))}},{key:"getCopy",value:function(){var e=new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,this.mixSession,this.context,this.number);return e.fromJson(this.getJson()),e}}]),n}(function(e){Object(c.a)(n,e);var t=P(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getValue",value:function(e){var t=this.lfoRateParameter.toSeconds(e+1),n=this.sequencerEngine.nextTimeScheduled;if(this.stoppedTime)return 0;var r=t*(this.lfoPhaseParameter.get(!1,e+1)/360),a=((n-=this.startTime)-r)/t,i=this.lfoMaxParameter.get(!1,e+1),s=this.lfoMinParameter.get(!1,e+1),o=(i-s)/2,c=(i+s)/2,u=0;switch(this.lfoType){case"sine":u=this.getSineValue(a,o,c);break;case"square":u=this.getSquareValue(a);break;case"triangle":u=this.getTriangleValue(a,o,c);break;case"sawtooth":u=this.getSawtoothValue(a,o,c)}return isNaN(u)?0:u}},{key:"getSineValue",value:function(e,t,n){return t*Math.sin(e*(2*Math.PI))+n}},{key:"getTriangleValue",value:function(e,t,n){return n+t*Math.asin(Math.sin(e*(Math.PI/2)*Math.PI))}},{key:"getSawtoothValue",value:function(e,t,n){return this.lfoMin+t*(.5*function(e){return Math.PI/2-Math.atan(e)}((r=e*Math.PI,1/Math.tan(r))));var r}},{key:"getSquareValue",value:function(e){return Math.sin(e*(2*Math.PI))<=0?this.lfoMin:this.lfoMax}}]),n}(T.a));t.a=N},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),s=n(31),o=n(10),c=n(6),u=n(8),l=n(2),f=n(7),h=n.n(f),p=n(116),d=n(14),v=n(112),m=n(126),y=180;function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var g="peaking",O=function(e){Object(c.a)(n,e);var t=b(n);function n(e){var r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var o in Object(a.a)(this,n),(r=t.call(this,"EQ8",function(){return new h.a.Gain(1)},e)).store=e.store,r.equalizerPoints=[new k(e,Object(s.a)(r),80,0,1,1,!0,"lowshelf"),new k(e,Object(s.a)(r),300,0,1,2,!1),new k(e,Object(s.a)(r),500,0,1,3,!1),new k(e,Object(s.a)(r),800,0,1,4,!1),new k(e,Object(s.a)(r),1e3,0,1,5),new k(e,Object(s.a)(r),2e3,0,1,6,!1),new k(e,Object(s.a)(r),4e3,0,1,7),new k(e,Object(s.a)(r),8e3,0,1,8,!0,"highshelf")],r.updateRate=y,i&&(r.analyser=new h.a.Analyser("fft",256)),r.outputNode=new h.a.Gain(1),r.setupEqualizer(),r.equalizerPoints)r.parameters=r.parameters.concat(r.equalizerPoints[o].parameters);return r.updateInitialValues(),r}return Object(i.a)(n,[{key:"dispose",value:function(){Object(o.a)(Object(l.a)(n.prototype),"dispose",this).call(this),this.analyser&&(this.analyser.dispose(),this.analyser=void 0),this.equalizerPoints.forEach(function(e){return e.dispose()}),this.equalizerPoints=void 0,this.outputNode.dispose(),this.outputNode=void 0}},{key:"disconnectAllFilters",value:function(){this.effectNode.disconnect(),this.equalizerPoints.filter(function(e){return e.enabled}).forEach(function(e){return e.filter.disconnect()})}},{key:"setupEqualizer",value:function(){var e,t=this.equalizerPoints.filter(function(e){return e.enabled}).map(function(e){return e.filter});t.push(this.outputNode),(e=this.effectNode).chain.apply(e,Object(r.a)(t))}},{key:"getSpectrum",value:function(){return this.analyser.getValue()}},{key:"connect",value:function(e){this.outputNode.connect(e),this.analyser&&this.outputNode.connect(this.analyser)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e),this.analyser&&this.analyser.disconnect()}},{key:"getJson",value:function(){var e=Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this);return e.updateRate=this.updateRate,e.equalizerPoints=this.equalizerPoints.map(function(e){return e.getJson()}),e}},{key:"fromJson",value:function(e,t){for(var r in Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t),"updateRate"in e&&(this.updateRate=e.updateRate),this.equalizerPoints)this.equalizerPoints[r].fromJson(e.equalizerPoints[r]);return this}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(p.a.Effect),k=function(){function e(t,n,r,i,s,o){var c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:g;Object(a.a)(this,e),this.eq=n,this.name="EQ Frequency "+o,this.number=o,this.type=u,this.sequencerEngine=t,this.store=t.store,this.filter=new h.a.Filter(r,u),this.filter.Q.value=s,this.filter.gain.value=i,this.frequencyParameter=new v.c(this.name+" frequency",this.filter.frequency,{min:0,max:1e4,unit:"hz",defaultValue:r}),this.gainParameter=new v.c(this.name+" gain",this.filter.gain,{min:-16,max:16,unit:"db",defaultValue:i}),this.qParameter=new v.c(this.name+" q",this.filter.Q,{min:0,max:16,unit:"Q",defaultValue:s}),this.enabledParameter=new d.a(this.name+" enabled",this,function(e,t){},{min:0,max:1,unit:"boolean",defaultValue:c}),this.parameters=[],this.registerParameter(this.enabledParameter),this.registerParameter(this.frequencyParameter),this.registerParameter(this.gainParameter),this.registerParameter(this.qParameter)}return Object(i.a)(e,[{key:"dispose",value:function(){this.filter._param&&this.filter.dispose(),this.filter=void 0,this.parameters.forEach(function(e){return e.dispose()}),this.gainParameter=void 0,this.frequencyParameter=void 0,this.qParameter=void 0,this.sequencerEngine=void 0,this.eq=void 0,this.name=void 0,this.store=void 0,this.parameters=void 0,this.type=void 0}},{key:"getJson",value:function(){var e={number:this.number,frequency:this.frequency,gain:this.gain,q:this.q,enabled:this.enabled};return e=Object(m.b)(e,"frequencyParameter",this.frequencyParameter),e=Object(m.b)(e,"qParameter",this.qParameter),e=Object(m.b)(e,"gainParameter",this.gainParameter),e=Object(m.b)(e,"enabledParameter",this.enabledParameter)}},{key:"fromJson",value:function(e){this.enabled=e.enabled,this.frequency=e.frequency,this.frequencyParameter.unlockedValue=e.frequency,this.q=e.q,this.qParameter.unlockedValue=e.q,this.gain=e.gain,this.gainParameter.unlockedValue=e.gain,Object(m.a)(e,"frequencyParameter",this.frequencyParameter,this.sequencerEngine),Object(m.a)(e,"qParameter",this.qParameter,this.sequencerEngine),Object(m.a)(e,"gainParameter",this.gainParameter,this.sequencerEngine),Object(m.a)(e,"enabledParameter",this.enabledParameter)}},{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"enabled",get:function(){return this.enabledParameter.get()},set:function(e){return this.enabledParameter.set(e)}},{key:"frequency",get:function(){return this.frequencyParameter.get()},set:function(e){this.frequencyParameter.set(e)}},{key:"gain",get:function(){return this.gainParameter.get()},set:function(e){this.gainParameter.set(e)}},{key:"q",get:function(){return this.qParameter.get()},set:function(e){this.qParameter.set(e)}},{key:"frequencyToGain",value:function(e){return"peaking"===this.type?this.frequencyToGainPeaking(e):"highshelf"===this.type?this.frequencyToGainHighShelf(e):this.frequencyToGainLowShelf(e)}},{key:"frequencyToGainPeaking",value:function(e){var t=200/this.q,n=e-t/2,r=e+t/2;return e<=n||e>=r?0:e<this.frequency?this.gain*((e-n)/(this.frequency-n)):this.gain*((r-e)/(r-this.frequency))}},{key:"frequencyToGainHighShelf",value:function(e){var t=e-100;return(e+=100)<=t?0:e>=this.frequency?this.gain:this.gain*((e-t)/(this.frequency-t))}},{key:"frequencyToGainLowShelf",value:function(e){var t=e+100;return e>=t?0:e<=this.frequency?this.gain:this.gain*((e-t)/(this.frequency-t))}}]),e}();t.a=O},function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(4),s=n(5),o=n(6),c=n(8),u=n(2),l=n(360),f=n(14);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}t.a=function(e){return function(e){Object(o.a)(n,e);var t=h(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).configurations=[],e}return Object(s.a)(n,[{key:"currentConfiguration",get:function(){return this.configurationParameter.get()},set:function(e){this.configurationParameter.set(e)}},{key:"initializeConfigurations",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.loaded=!0,this.oldConfiguration=0,this.configurations=[],this.configurations[0]=e,n&&(this.configurationParameter=new f.a("Configuration",this,function(e,n){t.switchToConfiguration(n)},{documentation:"",defaultValue:0,uxAutomatable:!1}),this.registerParameter(this.configurationParameter))}},{key:"saveCurrentConfiguration",value:function(){var e=void 0===this.currentConfiguration?1:this.currentConfiguration;return this.configurations[e]=Object(a.a)({},this.adjacencyLists),e}},{key:"newConfiguration",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.currentConfiguration,r=e?this.copyAdjacencyLists(this.adjacencyLists):{};return this.configurations.push(r),this.currentConfiguration=this.configurations.length-1,t&&(this.adjacencyLists=r),n}},{key:"switchToConfiguration",value:function(e){if(void 0!==this.configurationParameter&&this.oldConfiguration!==e){this.clearConfiguration(this.oldConfiguration);var t=this.configurations[e];this.loadConfig(t),this.oldConfiguration=this.currentConfiguration}}},{key:"configNames",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.adjacencyLists,n={},r=0,a=function(a){var i=e.effects.find(function(e){return e.id===a});n[i.name+"-"+r]=t[a],r++};for(var i in t)a(i);return n}},{key:"loadConfig",value:function(e){var t=this;this.adjacencyLists={};var n=function(n){for(var r in e[n]){var a=-1===parseInt(n)?t.inputNode:t.effects.find(function(e){return e.id===n}),i=e[n][r];void 0!==a&&t.connectEdge(a,i)}};for(var r in e)n(r)}},{key:"clearConfiguration",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.oldConfiguration,n=this.copyAdjacencyLists(this.adjacencyLists,!0),a=function(t){e.effects.find(function(e){return e.id===t});Object(r.a)(e.adjacencyLists[t]).forEach(function(t){e.deleteEdge(t)})};for(var i in this.adjacencyLists)a(i);this.loaded&&(this.configurations[t]=n)}},{key:"copyAdjacencyLists",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.adjacencyLists,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};for(var a in e)n[a]=t?Object(r.a)(e[a]):e[a].map(function(e){return e.getCopy()});return n}},{key:"getConfigurationJson",value:function(){var e=this,t=[];for(var n in this.configurations){var r=this.configurations[n],a={};for(var i in r)a[i]=r[i].map(function(t){return t.getJson(e)});t.push(a)}return t}},{key:"loadConfigurationJson",value:function(e){var t=[];for(var n in e){var r=e[n],a={};for(var i in r){var s=[];for(var o in r[i]){var c=new l.a(void 0,this.sequencerEngine);c.fromJson(r[i][o],this),s.push(c)}a[i]=s}t.push(a)}this.configurations=t}}]),n}(e)}},function(e,t,n){"use strict";var r=n(11),a=n(42),i=n.n(a),s=n(56),o=n(4),c=n(5),u=(n(7),n(9)),l=n(23),f=(n(21),n(34),n(66),n(64),n(67),n(65),n(47),n(68),n(69),n(70),n(36),n(38),n(51)),h=function(){function e(t,n){Object(o.a)(this,e),this.type=t,this.events=[],this.counter=0,this.subSequence=n}return Object(c.a)(e,[{key:"getMixType",value:function(){return u.b}},{key:"seekToTrackStep",value:function(e){this.events.length>0&&this.events[this.events.length-1].step<e||this.restart()}},{key:"restart",value:function(){this.counter=0,this.events.forEach(function(e){return e.restart()})}},{key:"scheduleNext",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n,r){var a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:0==t&&this.restart(),a=this.counter,s=this.events;case 3:if(!(a<s.length)){e.next=19;break}if(t!==s[a].step){e.next=8;break}s[a].scheduleEvent(n,r,s[a+1]),e.next=16;break;case 8:if(!(t>s[a].step)||s[a].isSkippable()){e.next=12;break}s[a].scheduleEvent(0-s[a].time,r,s[a+1]),e.next=16;break;case 12:if(!(t<s[a].step)){e.next=16;break}return e.abrupt("break",19);case 16:a++,e.next=3;break;case 19:this.counter=a;case 20:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"eraseEventsAtStep",value:function(e){this.events=this.events.filter(function(t){return t.step!=e})}},{key:"schedule",value:function(){this.events.forEach(function(e){return e.scheduleEvent()})}},{key:"getJson",value:function(){return{type:this.type,events:this.events.map(function(e){return e.getJson()}).filter(function(e){return void 0!==e})}}},{key:"getCopy",value:function(){var t=new e(this.type);return t.events=this.events,t}},{key:"loadFromJson",value:function(e,t,n){for(var r in e.events){var a=e.events[r],i=Object(f.a)(a,this.type,t,n);void 0!==i&&(this.events.length>0&&i.step<this.events[this.events.length-1].step&&e.length-r>=500&&(this.events=[]),this.events.push(i))}}},{key:"calculateDurations",value:function(){var e=void 0,t=[];for(var n in this.events){var r=this.events[n];void 0===r||r.isEmpty()||(void 0===e||e.rolling||r.rolling)&&(t.push(r),void 0!==e&&(e.duration=this.events[n].step-e.step),e=this.events[n])}this.events=t}},{key:"clear",value:function(){this.events=[],this.counter=0}},{key:"getNextEvent",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.counter:0;t<this.events.length;t++)if(e.step<this.events[t].step)return this.events[t]}},{key:"getPreviousEvent",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=void 0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?Math.max(0,this.counter-1):0;r<this.events.length;r++){if(t&&e.step<=this.events[r].step)return n;if(!t&&e.step<this.events[r].step)return n;n=this.events[r]}return n}},{key:"updateRedux",value:function(e,t){t.store.dispatch(Object(l.ic)(e.id,this.type,Object(r.a)(this.events)))}},{key:"prune",value:function(){this.events.every(function(e){return e.isPrunable()})&&(this.events=[]);var e=void 0,t=[];for(var n in this.events){var r=this.events[n];void 0!==e&&r.isPrunable()&&e.isPrunable()||(void 0===e&&r.isPrunable()||(t.push(r),e=r))}this.events=t}},{key:"getEventsBetween",value:function(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this.events.filter(function(n){return n.step>=e&&n.step<=t}):this.events.filter(function(n){return n.step>=e&&n.step<t})}}]),e}();t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var u=function(e){Object(i.a)(n,e);var t=c(n);function n(e,a,i,s){var o;return Object(r.a)(this,n),(o=t.call(this,e,a.getType())).event=a,o.time=i,o.trackStep=s,o}return Object(a.a)(n,[{key:"events",get:function(){return this.mixByType.events},set:function(e){this.mixByType.events=e}},{key:"counter",get:function(){return this.mixByType.counter},set:function(e){this.mixByType.counter=e}},{key:"execute",value:function(){if(this.event.setTime(this.time,this.trackStep),0==this.events.length||this.events[this.events.length-1].step<=this.trackStep)this.events.push(this.event);else{for(var e=0,t=this.events.length-1,n=void 0;e<=t;){if(n=Math.floor((e+t)/2),this.events[n].step<this.trackStep)e=n+1;else{if(!(this.events[n].step>this.trackStep))break;t=n-1}if(n>=1&&this.events[n-1].step<=this.trackStep&&this.events[n].step>=this.trackStep)break}this.events[n].step===this.trackStep?this.events[n]=this.event:this.events=this.events.slice(0,n).concat([this.event]).concat(this.events.slice(n)),this.counter=n,this.event.subSequence=this.mix.subSequence}}}]),n}(n(166).a);t.a=u},function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"b",function(){return s});var r=n(21),a=140,i="RIGHT",s="LEFT";new r.a(16,!1)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(1),a=function(){var e={},t={};return function(n,a,i,s){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(void 0===n)return Object.keys(e);if(1===n)return t;var c=[n];o.altName&&c.push(o.altName);for(var u=function(){var n=f[l];if(n in e)return{v:e[n]};o.tags&&(Array.isArray(o.tags)?o.tags.forEach(function(e){t[e]||(t[e]=[]),t[e].push(n)}):(t[o.tags]||(t[o.tags]=[]),t[o.tags].push(n))),e[n]=Object(r.a)({params:a,description:i,outlets:s},o)},l=0,f=c;l<f.length;l++){var h=u();if("object"===typeof h)return h.v}}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i});var r=["EQ Frequency 1 gain","type","EQ Frequency 5 gain","EQ Frequency 8 gain","Pulse Width","algorithm","Chop","Velocity","Slice","Chop Duration","Duration","Transpose","width","speed","Configuration","Feedback","list","Drive","enabled","parametersDisabled","Enabled","blur","pitchBend","Polyphony","phase","stages","smoothness","Custom Oscillator Type","lengthFactor","Curve","Release Curve","Decay Curve","Attack Curve","triplet1","triplet2","triplet3","triplet4","triplet5","triplet6","scale1","scale2","scale3","scale4","scale5","scale6","rule1","rule2","rule3","rule4","rule5","rule6","Oscillator Type","resolution","rolloff","Level","curve","Filter Cutoff (hi-pass)","Filter Q (hi-pass)","Partial Count","LFO Type"],a=["Sustain","Partials","Harmonics","steps","Resolution","Probability","Rate","lengthFactor","resolution","probability","Decay","Attack","Release"],i=function(e,t){return(e.getAllParameters?e.getAllParameters(!1):e.getParameters?e.getParameters():e.parameters).filter(function(e){return e.automatable&&!e.config.isDb}).filter(function(e){return!e.hasMacro}).filter(function(e){return!e.isMapped}).filter(function(e){return!r.includes(e.name)})}},function(e,t,n){"use strict";var r=n(1),a=(n(11),n(4)),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(135),f=n(311),h=n(353),p=n(312),d=n(272),v=n(595);function m(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var g=function(e){Object(o.a)(n,e);var t=b(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Midi Effect Rack",e)).initializeConfigurations(r.adjacencyLists),r.initCache(128),r}return Object(i.a)(n,[{key:"stop",value:function(){this.effects.forEach(function(e){return e.stop()})}},{key:"output",value:function(e,t,n){return this.runFlow(e,t,n,this.inputNode,this.triggers,this.adjacencyLists)}},{key:"documentation",get:function(){return["Patch Midi Effects together in non-linear ways. ","The edges control the probability that a trigger is passed through to the next effect."]}},{key:"onNewStep",value:function(){this.triggers.length>0&&(this.triggers.length=0),this.effects.forEach(function(e){return e.onNewStep()})}},{key:"clear",value:function(){this.counter=0,this.effects.forEach(function(e){return e.clear()}),this.triggers=[]}},{key:"isRack",get:function(){return!0}},{key:"isRealTime",value:function(){return void 0===this.adjacencyLists[-1]||!this.adjacencyLists[-1].some(function(e){return e.effect&&e.effect.isRealTime&&!e.effect.isRealTime()})}},{key:"addNote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.adjacencyLists[-1].filter(function(e){return e.effect&&e.effect.isRealTime&&!e.effect.isRealTime()}).forEach(function(r){return r.effect.addNote(e,t,n)})}},{key:"removeNote",value:function(e,t){this.effects.filter(function(e){return e.isRealTime&&!e.isRealTime()}).forEach(function(n){return n.removeNote(e,t)})}},{key:"getJson",value:function(){return this.getRackJson()}},{key:"fromJson",value:function(e,t,a,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t;this.adjacencyLists={},this.initializeConfigurations(this.adjacencyLists,!1),this.effects=[],this.loaded=!1;var c=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t),l=e.effects;for(var f in l){var h=l[f],p=Object(d.a)(h,this.track);if(c=Object(r.a)({},c,p.fromJson(h,o)),p.id!==h.id){var v,y=m(e.configurations);try{for(y.s();!(v=y.n()).done;){var b=v.value,g=b[h.id];b[p.id]=g,delete b[h.id]}}catch(O){y.e(O)}finally{y.f()}}this.addEffect(p,!1),p.x=h._x||h.x,p.y=h._y||h.y}return this.fromRackJson(e,t),this.loaded=!0,c}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"deleteEdge",value:function(e){Object(s.a)(Object(u.a)(n.prototype),"deleteEdge",this).call(this,e,!1)}}]),n}(Object(v.a)(Object(f.a)(Object(h.a)(Object(p.a)(l.a)))));t.a=g},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),s=n.n(i),o=n(130),c=n(59),u=n(112),l=n(14),f=n(126),h=(new o.a,function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(r.a)(this,e),this.parameters=[],this.effect=t,this.sequencerEngine=n,this.store=n.store,this.gain=new s.a.Gain(1),this.gainParameter=new u.c("Gain",this.gain.gain,{min:0,max:1,unit:"db",defaultValue:1}),this.registerParameter(this.gainParameter),this.probabilityParameter=new l.a("Probability",this,function(){return[]},{min:0,max:100,unit:"%",defaultValue:100}),this.registerParameter(this.probabilityParameter),t&&t.connect&&(t.effectNode?this.gain.connect(t.effectNode):this.gain.connect(t)),this.outputNumber=a}return Object(a.a)(e,[{key:"getWeight",value:function(e,t){return e.getEffectType()===c.c?this.probability/100:this.gainParameter.get()}},{key:"probability",get:function(){return this.probabilityParameter.get()}},{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"getCopy",value:function(){var t=new e(this.effect,this.sequencerEngine);return t.gainParameter.set(t.gainParameter.get()),t.outputNumber=this.outputNumber,t}},{key:"getJson",value:function(e){var t={effect:e.effects.indexOf(this.effect),gain:this.gainParameter?this.gainParameter.get():1,probability:this.probability,outputNumber:this.outputNumber};return this.gainParameter&&(t=Object(f.b)(t,"gainParameter",this.gainParameter)),t=Object(f.b)(t,"probabilityParameter",this.probabilityParameter)}},{key:"fromJson",value:function(e,t){this.gainParameter.set(e.gain),void 0!==e.probability&&this.probabilityParameter.set(e.probability),Object(f.a)(e,"gainParameter",this.gainParameter),Object(f.a)(e,"probabilityParameter",this.probabilityParameter),this.effect=t.effects[e.effect],this.outputNumber=void 0===e.outputNumber?0:e.outputNumber,this.effect||(this.effect=t.outputNode),void 0!==this.effect.connect&&(this.effect.effectNode?this.gain.connect(this.effect.effectNode):this.gain&&this.gain.connect(this.effect))}},{key:"dispose",value:function(){this.gainParameter&&(this.gainParameter.dispose(),this.gainParameter=void 0),this._disposed=!0}}]),e}());t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=(n(14),n(594)),s=n(23),o=n(123),c=n(126),u=n(112),l=n(22),f=n(7),h=n.n(f),p=n(20),d=function(){function e(t,n,a){var i=this,c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Object(r.a)(this,e),this.id=Object(p.uuid)(),this.context=a?a.getCopy().forMacro(this):(new o.a).forMacro(this),this.sequencerEngine=n,this.name=t,this.subMacros=[],this.x=100,this.y=110,this.signal=new h.a.Signal(0),this.macroParameter=new u.a("macro",this.signal,function(e,t){i.signal.value=t;var n={};for(var r in i.subMacros){var a=i.subMacros[r],o=a.updateRedux(t,c);n[a.parameter.id]=o.value}i.sequencerEngine.store.dispatch(Object(s.ub)(n))},{min:0,max:1,defaultValue:f,automationRate:l.a}),this.macroParameter.enableAudioParam(),this.parameters=[],this.registerParameter(this.macroParameter)}return Object(a.a)(e,[{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.setStore(this.sequencerEngine.store),e.setContext(this.context),this.parameters.push(e))}},{key:"addParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.min,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.max,r=new i.a(e,t,n,this);(e.audioParam||e.audioParams)&&this.signal.connect(r.scaler),this.subMacros.push(r),this.macroParameter.set(this.macroParameter.get(!0)),e.hasMacro=this}},{key:"unmapAllParameters",value:function(){var e=this;this.subMacros.map(function(e){return e.parameter}).forEach(function(t){return e.unmapParameter(t)})}},{key:"ripMods",value:function(){this.macroParameter.disconnectFromAllModulators()}},{key:"isParameterMapped",value:function(e){return this.subMacros.some(function(t){return t.parameter===e})}},{key:"normalizeParameterValue",value:function(e,t){return this.subMacros.find(function(t){return t.parameter===e}).normalizeValue(t)}},{key:"unmapParameter",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.subMacros.find(function(t){return t.parameter===e});if(void 0!==n){e.hasMacro=void 0,(n.parameter.audioParam||n.parameter.audioParams)&&this.signal.disconnect(n.scaler);var r=this.subMacros.indexOf(n);t&&n.dispose(),this.subMacros.splice(r,1),e.set(e.get(),!0,!0)}}},{key:"dispose",value:function(){this.unmapAllParameters(),this.subMacros=void 0,this.macroParameter.dispose(),this.signal=void 0,this.macroParameter=void 0}},{key:"getJson",value:function(){var e={id:this.id,x:this.x,y:this.y,name:this.name,subMacros:this.subMacros.map(function(e){return e.getJson()}),macroValue:this.macroParameter.get(!0)};return e=Object(c.b)(e,"macroParameter",this.macroParameter,!0)}},{key:"getParameters",value:function(){return this.parameters}},{key:"fromJson",value:function(e,t){var n=this;e.id&&(this.id=e.id),this.name=e.name,this.x=e.x,this.y=e.y;var r=function(r){var a=e.subMacros[r],i=a.parameter,s=a.min,o=a.max;if(void 0===(i=t.find(function(e){return e.id===i})))return"continue";n.addParameter(i,s,o)};for(var a in e.subMacros)r(a);this.macroParameter.set(e.macroValue),Object(c.a)(e,"macroParameter",this.macroParameter,this.sequencerEngine)}}]),e}();t.a=d},function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return f});var r=n(1),a=n(11),i=n(111),s=n(207),o=n(20);function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=function(e){return function(){for(var t=arguments.length,n=new Array(t),c=0;c<t;c++)n[c]=arguments[c];for(var u=Object(s.l)(e,.5).apply(void 0,n),l=Object(a.a)(i.A.apply(void 0,[e].concat(n))),f=Object(o.uuid)(),h=0;h<l.length;h++)l[h]=Object(r.a)({},l[h],{figure:u,nth:h,figureId:f});return l}},f=function(e,t,n){return function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];var u,l=i.A.apply(void 0,[e].concat(s)),f=i.A.apply(void 0,[t].concat(s)),h=void 0,p=[],d=[],v=0,m=c(l);try{for(m.s();!(u=m.n()).done;){var y=u.value;if(v===f?d.push(y):p.push(y),h&&y.figureId!==h.figureId){if(v===f){var b=n(d);"function"===typeof b&&(b=b.apply(void 0,s)),p=[].concat(Object(a.a)(p),Object(a.a)(b)),d=[]}v++}h=y}}catch(O){m.e(O)}finally{m.f()}if(d.length>0){var g=n(d);"function"===typeof g&&(g=g.apply(void 0,s)),p=[].concat(Object(a.a)(p),Object(a.a)(g))}return p}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return f}),n.d(t,"b",function(){return h});var r=n(42),a=n.n(r),i=n(56),s=n(138),o=(n(167),n(23));function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=1;function f(e){var t=[];if("subSequences"in e)for(var n in e.subSequences){var r=e.subSequences[n];for(var a in r.tracksData){var i=r.tracksData[a];t=t.concat(Object.keys(i.samplers))}}else for(var s in e.tracksData){var o=e.tracksData[s];t=t.concat(Object.keys(o.samplers))}return Array.from(new Set(t))}function h(e,t,n,r){return p.apply(this,arguments)}function p(){return(p=Object(i.a)(a.a.mark(function e(t,n,r,i){var s,u,f,h,p,m,y,b,g,O,k,j,w,x,S,P;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s={},(new Date).getTime(),i.dispatch(Object(o.bd)(0,t.length)),e.next=24;break;case 7:if((f=u.n()).done){e.next=14;break}return h=f.value,e.next=11,v(n,h,i);case 11:s[h]=e.sent;case 12:e.next=7;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),u.e(e.t0);case 19:return e.prev=19,u.f(),e.finish(19);case 22:e.next=50;break;case 24:p=[],m=(new Date).getTime(),y=c(d(t,l)),e.prev=27,y.s();case 29:if((b=y.n()).done){e.next=39;break}return b.value,g=t.slice(0,l).map(function(e){return v(n,e,i)}),e.t1=p,e.next=35,Promise.all(g);case 35:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 37:e.next=29;break;case 39:e.next=44;break;case 41:e.prev=41,e.t3=e.catch(27),y.e(e.t3);case 44:return e.prev=44,y.f(),e.finish(44);case 47:for(O=(new Date).getTime(),console.log("decoding mp3s took %s ms",O-m),k=0,j=p;k<j.length;k++){w=j[k],x=c(w);try{for(x.s();!(S=x.n()).done;)P=S.value,s[P.ipfsHash]=P}catch(r){x.e(r)}finally{x.f()}}case 50:return e.abrupt("return",s);case 51:case"end":return e.stop()}},e,null,[[5,16,19,22],[27,41,44,47]])}))).apply(this,arguments)}var d=function(e,t){for(var n=[],r=0;r<e.length;r+=3)n.push(e.slice(r,r+3));return n};function v(e,t,n){return new Promise(function(){var r=Object(i.a)(a.a.mark(function r(i,c){var u,l,f,h,p,d;return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return u=new s.a(t,e),r.prev=1,n.state.sequencer.sampleDownloadProgress.downloaded,r.next=5,u.load();case 5:l=n.state.sequencer.sampleDownloadProgress,f=l.downloaded,h=l.total,console.log("LOADED SAMPLE=",t),window.parent&&document.referrer&&(p=document.referrer,d="stem loaded "+(f+1),window.parent.postMessage(d,p)),n.dispatch(Object(o.bd)(f+1,h)),i(u),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(1),c();case 15:case"end":return r.stop()}},r,null,[[1,12]])}));return function(e,t){return r.apply(this,arguments)}}())}},function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"b",function(){return u});var r=n(42),a=n.n(r),i=n(56),s=n(408),o={},c=function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!o[n]){e.next=2;break}return e.abrupt("return",o[n]);case 2:return r=void 0,e.prev=3,console.log("guessing"),e.next=7,Object(s.a)(t);case 7:r=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),r={onset:0,tempo:120,bpm:120,error:e.t0};case 13:return o[n]=r,e.abrupt("return",r);case 15:case"end":return e.stop()}},e,null,[[3,10]])}));return function(t,n){return e.apply(this,arguments)}}(),u=function(){}},,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(11),a=function(e,t){return function(n){var a=e(n),i=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];n=n.filter(function(e){return void 0!==e});for(var i=[],s=function(){var e=c[o];if(e.model){var t=e.model;i.push(t)}else i.push(function(){return e})},o=0,c=[e].concat(Object(r.a)(n));o<c.length;o++)s();return i}.apply(void 0,[a.input].concat(Object(r.a)(a.args)));return a.model=function(e){var n=i.map(function(t){return t(e)});return t.apply(void 0,Object(r.a)(n))},a}}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2),u=n(420),l=n(59),f=n(421);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var p=function(e){Object(s.a)(n,e);var t=h(n);function n(e,a,i){var s;return Object(r.a)(this,n),(s=t.call(this,e,i)).effect=a,s}return Object(a.a)(n,[{key:"subSequence",get:function(){return this.track.tracks?this.track:this.track.subSequence}},{key:"isMidiEffect",value:function(){return!1}},{key:"dispose",value:function(){}},{key:"getParameters",value:function(){return[]}},{key:"getEffectType",value:function(){return l.b}},{key:"getJson",value:function(){var e=Object(i.a)(Object(c.a)(n.prototype),"getJson",this).call(this);return e.effect=this.effect,e}}]),n}(Object(f.a)(u.a));t.a=p},function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return a});var r="PIANO_ROLL",a="EFFECTS"},function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"a",function(){return a}),n.d(t,"b",function(){return i});var r="RANDOMIZE",a="ACCUMULATE",i="NONE"},function(e,t,n){"use strict";n.d(t,"a",function(){return r});n(269),n(116);function r(e){return[]}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),s=n(10),o=n(6),c=n(8),u=n(2),l=n(401),f=n(346),h=n(180),p=n(235),d=n(14);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(o.a)(n,e);var t=v(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Playhead",h.e,e)).system5Objects=[],a.directionParameter=new p.a("direction",Object(i.a)(a),function(e,t){return t},{min:0,max:1,isNumber:!0,unit:"",options:{.1:f.b,.25:f.d,.5:f.c,.75:f.a},defaultValue:f.b}),a.registerParameter(a.directionParameter),a.speedFactorParameter=new d.a("speedFactor",Object(i.a)(a),function(e,t){return t},{min:0,max:16,unit:"x",defaultValue:1,onChange:function(e){return a.system5Objects.forEach(function(e){return e.sendSpeeds()})}}),a.registerParameter(a.speedFactorParameter),a.offsetParameter=new d.a("offset",Object(i.a)(a),function(e,t){return t},{min:0,max:32,unit:"x",defaultValue:0}),a.registerParameter(a.offsetParameter),a.walkParameter=new d.a("walk",Object(i.a)(a),function(e,t){return t},{min:1,max:16,defaultValue:8}),a.registerParameter(a.walkParameter),a}return Object(a.a)(n,[{key:"getParameters",value:function(){return this.parameters}},{key:"offset",get:function(){return this.offsetParameter.get()}},{key:"direction",get:function(){return this.directionParameter.get()}},{key:"speedFactor",get:function(){return this.speedFactorParameter.get()}},{key:"walk",get:function(){return Math.round(this.walkParameter.get())}},{key:"fromJson",value:function(e,t){return Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t)}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson()),t}}]),n}(l.a);t.a=m},,,,function(e,t,n){"use strict";var r=n(11),a=n(42),i=n.n(a),s=n(56),o=n(4),c=n(5),u=n(6),l=n(8),f=n(2),h=n(125),p=n(261),d=n.n(p),v=function(){function e(){Object(o.a)(this,e),this.selectedTags=[],this.selectedOrTags=[],this.selectedStyles=[],this.selectedCountries=[],this.selectedVideos=[],this.selectedDiscogs=[],this.filterFavorites=!1,this.year=void 0,this.chord=void 0}return Object(c.a)(e,[{key:"toString",value:function(){console.log("selectedTags = "+this.selectedTags.join(",")),console.log("selectedOrTags = "+this.selectedOrTags.join(",")),console.log("selectedStyles= "+this.selectedStyles.join(",")),console.log("selectedCountries = = "+this.selectedCountries.join(","))}},{key:"empty",value:function(){return 0==this.selectedTags.length&&0==this.selectedStyles.length&&0==this.selectedOrTags.length&&0==this.selectedCountries.length&&void 0===this.chord&&void 0==this.year}},{key:"getSearchQueryParameters",value:function(){var e="?tags="+this.selectedTags.join(",")+"&styles="+this.selectedStyles.join(",")+"&countries="+this.selectedCountries.join(",");return void 0!==this.year&&(e+="&year="+this.year),e}},{key:"getTopTags",value:function(){return this.getTopFields("/getTags")}},{key:"getTopStyles",value:function(){return this.getTopFields("/getStyles")}},{key:"getTopCountries",value:function(){return this.getTopFields("/getCountries")}},{key:"getTopFields",value:function(e){var t=this;return new Promise(function(n,r){var a=t.getSearchQueryParameters();e+=a,d.a.get(e).then(function(e){var t=e.data.data,r=[];for(var a in t)r.push(a);n(r)}).catch(function(e){r(e)})})}},{key:"getSounds",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="/filterSearch/"+t+"/"+n+this.getSearchQueryParameters(),e.next=3,d.a.get(r);case 3:return a=e.sent,e.abrupt("return",this.searchCallback(a));case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"searchCallback",value:function(e){for(var t=e.data.data,n=[],r=0;r<t.length;r++)n.push(t[r].id);return{sounds:n,total:e.data.total}}}]),e}(),m=n(153),y=n(158),b=function(){function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32",name:"hash",type:"bytes32"}],name:"newGuildClassification",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!0,internalType:"bytes32",name:"hash",type:"bytes32"}],name:"NewGuildClassification",type:"event"}],this.contractAddress="0x3831959eF022C226F3bdfF6481f4666901428f90"}return Object(c.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),g=n(118),O=n(139),k=n(122),j=n(895),w=new b,x={},S=function(){function e(){Object(o.a)(this,e),void 0!==y.a&&y.a.eth.net.isListening()&&(this.contract=new y.a.eth.Contract(w.abi,w.contractAddress),this.ethAddress=this.contract.options.address)}return Object(c.a)(e,[{key:"saveClassifications",value:function(e,t){var n=this;return new Promise(function(){var r=Object(s.a)(i.a.mark(function r(a,s){var o;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,k.a.addJson(t);case 2:return o=r.sent,r.t0=n.contract.methods.newGuildClassification(e,Object(j.a)(o)),r.next=6,m.a.getAccount();case 6:r.t1=r.sent,r.t2={from:r.t1},r.t3=function(e,t){e?s(e):a(o)},r.t0.send.call(r.t0,r.t2,r.t3);case 10:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getClassificationsHash",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r,a=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:0,n=new O.a(w.contractAddress).from(g.o).select("contentHash").where("guildId",t),e.next=4,n.executeQuery();case 4:if(0!==(r=e.sent).length){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.abrupt("return",r[0].contentHash);case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getClassifications",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(){var n=Object(s.a)(i.a.mark(function n(r,a){var s,o;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return");case 3:return n.next=5,e.getClassificationsHash(t);case 5:if(void 0!==(s=n.sent)){n.next=10;break}r({}),n.next=15;break;case 10:return n.next=12,k.a.getJson(s);case 12:o=n.sent,x[t]=o,r(o);case 15:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}}]),e}(),P=n(236),E=new S,T=function(){function e(){Object(o.a)(this,e),this.tagToLevel={},this.tagToParent={},this.tagToChildren={},this.loadHierarchy()}return Object(c.a)(e,[{key:"loadHierarchy",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r,a,s,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.getClassifications();case 2:for(r in t=e.sent,console.log("LOADED HIERARCHY",t),n={},t)for(a in n[r]=this.getParentOfTag(r,t),t[r])s=t[r][a],n[s]=r;for(o in this.tagToChildren=t,this.tagToParent=n,this.tagToLevel={},n)this.tagToLevel[o]=this.getLevel(o,n);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getAllChildren",value:function(e){var t=this.tagToChildren[e],n=[];for(var r in t)n=n.concat(this.getAllChildren(t[r]));return n.concat(t)}},{key:"reduce",value:function(e,t){if(e.length<=20)return e;var n=1,r=0===t.length,a=!0,i=[];for(var s in t){var o=t[s];i=i.concat(this.getAllChildren(o)),void 0===this.tagToLevel[o]?r=!0:a=!1,this.tagToLevel[o]>=n&&(n=this.tagToLevel[o])}return r&&(n+=2),a?this.filterReduction(e,2,i,r):this.filterReduction(e,n,i,r)}},{key:"filterReduction",value:function(e,t,n,r){var a=this;return e.filter(function(e){return n.indexOf(e.value)>-1||a.tagToLevel[e.value]<=t||r&&void 0===a.tagToLevel[e.value]})}},{key:"getLevel",value:function(e,t){return void 0===t[e]?0:t[e]===e?0:1+this.getLevel(t[e],t)}},{key:"getParentOfTag",value:function(e,t){for(var n in t){if(t[n].indexOf(e)>-1)return n}return null}}]),e}(),A="OR",M="AND",R=n(181);function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function N(e){e=e.map(function(t){return{value:t.value,rank:Math.pow(.9,8*t.rank/e.length)}});var t=Math.max.apply(Math,e.map(function(e){return e.rank}));return e.map(function(e){return{value:e.value,rank:e.rank/t}})}function q(e,t){var n={};for(var r in e)r in t&&(n[r]=e[r].rank+t[r].rank);return n}var I=function(e){Object(u.a)(n,e);var t=C(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this)).cache=e,r.varietyReducer=new T,r}return Object(c.a)(n,[{key:"freeTextSearch",value:function(e){var t=this;return new Promise(function(n,r){n({TAG:N(t.cache.freeTextSearch(R.d,e)),STYLE:N(t.cache.freeTextSearch(R.c,e)),COUNTRY:N(t.cache.freeTextSearch(R.a,e)),YEAR:N(t.cache.freeTextSearch(R.e,e))})})}},{key:"getTopVideos",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.empty()){e.next=4;break}return e.abrupt("return",this.cache.getAllForField(R.f,0,1e7));case 4:return r=this.selectedOrTags.length>0?A:M,e.abrupt("return",this.getTopFields(0,1e7,R.f,r));case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTopDiscogs",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.empty()){e.next=4;break}return e.abrupt("return",this.cache.getAllForField(R.b,0,1e7));case 4:return r=this.selectedOrTags.length>0?A:M,e.abrupt("return",this.getTopFields(0,1e7,R.b,r));case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTopTags",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n,r){var a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0===r?this.selectedTags:r,!this.filterFavorites){e.next=6;break}return e.next=4,h.a.getFavoritesForUser();case 4:return a=e.sent,e.abrupt("return",this.getTagsForSounds(a));case 6:return e.next=8,this.getTopFields(t,n,R.d);case 8:return s=e.sent,e.abrupt("return",this.varietyReducer.reduce(s,r));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getTopStyles",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.selectedOrTags.length>0?A:M,e.abrupt("return",this.getTopFields(void 0,void 0,R.c,t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTopCountries",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.selectedOrTags.length>0?A:M,e.abrupt("return",this.getTopFields(void 0,void 0,R.a,t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getVideoInfo",value:function(e){var t=Array.from(this.cache.getFieldsForField(R.d,R.f,e)),n=Array.from(this.cache.getFieldsForField(R.c,R.f,e)),r=Array.from(this.cache.getFieldsForField(R.e,R.f,e));return{tags:t.map(function(e){return e.value}),styles:n.map(function(e){return e.value}),year:r.map(function(e){return e.value})[0]}}},{key:"getTopFields",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n,r){var a,s,o,c,u,l,f=this,h=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=h.length>3&&void 0!==h[3]?h[3]:M,s=this.getSelectedFields(a),!this.empty()){e.next=4;break}return e.abrupt("return",N(this.cache.getAllForField(r,t,n)));case 4:for(u in o=[],c=function(e){s[e].forEach(function(t){o.push(f.cache.getFieldsForField(r,e,t))})},s)c(u);return l=[],l=a==A?Array.from(this.unionAll(o)):Array.from(this.intersectAll(o)),e.abrupt("return",N(l));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSelectedFields",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=void 0===this.year?[]:[this.year];return{TAG:e==A?this.selectedOrTags:this.selectedTags,STYLE:this.selectedStyles,COUNTRY:this.selectedCountries,YEAR:t}}},{key:"getTagsForSounds",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r,a,s,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a in n={},r=[],t)r.push(h.a.getTagsForSound(t[a]));return e.next=5,Promise.all(r);case 5:for(o in s=e.sent)s[o].forEach(function(e){return n[e]=!0});return e.abrupt("return",Object.keys(n));case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"unionAll",value:function(e){if(void 0===e||0==e.length)return[];var t={};return e.forEach(function(e){return e.forEach(function(e){e.value in t||(t[e.value]=0),t[e.value]+=e.rank})}),t}},{key:"intersectAll",value:function(e){if(void 0===e||0==e.length)return[];var t=[],n=function(n){a=e[n];var r={};a.forEach(function(e){return r[e.value]=e.rank}),t.push(r)};for(var r in e){var a;n(r)}for(var i=t[0],s=1;s<t.length;s++)i=q(i,t[s]);var o=new Set;for(var c in i)o.add({value:c,rank:i[c]/t.length});return o}}]),n}(v),_=n(74);function D(e,t){var n=new Set(e),r=new Set(t);return Array.from(n).every(function(e){return r.has(e)})&&Array.from(r).every(function(e){return n.has(e)})}var F=function(){function e(t){Object(o.a)(this,e),this.store=t,this.selectedTags=[],this.selectedOrTags=[],this.selectedStyles=[],this.selectedCountries=[],this.selectedVideos=[],this.filterFavorites=!1,this.chord=!1,this.year=void 0,this.unsortedResults=[],this.canceled=!1,this.mostRecentResults=void 0,this.mostPopularResults=void 0,this.shuffledResults=void 0}return Object(c.a)(e,[{key:"sortBy",get:function(){return this.store.getState().selector.sortBy}},{key:"addLazyResults",value:function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.linkedPromiseList=t;case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getNext",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.linkedPromiseList&&!this.canceled){e.next=3;break}return this.canceled||this.setFinalResults(this.unsortedResults),e.abrupt("return",void 0);case 3:return e.next=5,this.linkedPromiseList.getCurrent();case 5:if(t=e.sent,(t=Array.from(new Set(t))).forEach(function(e){n.unsortedResults.push(e)}),this.setFinalResults(this.unsortedResults),void 0!==this.linkedPromiseList){e.next=11;break}return e.abrupt("return",void 0);case 11:return e.next=13,this.linkedPromiseList.getNext();case 13:return this.linkedPromiseList=e.sent,e.abrupt("return",this.linkedPromiseList);case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addUnsortedResults",value:function(e){this.unsortedResults=e}},{key:"sort",value:function(){this.setFinalResults(this.unsortedResults)}},{key:"setFinalResults",value:function(e){this.unsortedResults=e,this.sortBy===_.a?this.mostPopularResults?this.results=this.mostPopularResults:(this.results=this.sortByRanking(Object(r.a)(this.unsortedResults)),this.mostPopularResults=this.results):this.sortBy===_.c?void 0===this.shuffledResults?(this.results=Object(P.a)(Object(r.a)(this.unsortedResults)),this.shuffledResults=this.results):this.results=this.shuffledResults:this.mostRecentResults?this.results=this.mostRecentResults:(this.results=this.unsortedResults,this.mostRecentResults=this.results)}},{key:"sortByRanking",value:function(e){var t=this;return void 0===this.sampleToRanking?e:(e.sort(function(e,n){var r=e in t.sampleToRanking?t.sampleToRanking[e]:0;return(n in t.sampleToRanking?t.sampleToRanking[n]:0)-r}),e)}},{key:"getAllSounds",value:function(){var e=this,t=void 0===this.favorites||void 0===this.results?this.results:this.results.filter(function(t){return e.favorites.indexOf(t)>-1});return Array.from(new Set(t))}},{key:"getResults",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,r=this.getAllSounds();return void 0!==r&&(void 0!==this.stylesSounds&&(r=r.filter(function(t){return e.stylesSounds.has(t)})),void 0!==this.yearSounds&&(r=r.filter(function(t){return e.yearSounds.has(t)})),void 0!==this.chordSounds&&(r=r.filter(function(t){return e.chordSounds.has(t)})),void 0!==this.videosSounds&&(r=r.filter(function(t){return e.videosSounds.has(t)}))),void 0===r?{sounds:[],total:0}:void 0!==t&&void 0!==n?t>=r.length?{sounds:[],total:0}:t+n>=r.length?{sounds:r.slice(t),total:r.length}:{sounds:r.slice(t,t+n),total:r.length}:{sounds:r,total:r.length}}},{key:"cancel",value:function(){this.canceled=!0}},{key:"empty",value:function(){return 0===this.selectedTags.length&&0===this.selectedStyles.length&&0===this.selectedOrTags.length&&-0==this.selectedCountries.length&&0===this.selectedVideos.length&&void 0===this.chord&&void 0===this.year}},{key:"equals",value:function(e){var t=!1;return this.chord===e.chord?t=!0:void 0===this.chord||void 0===e.chord?t=!1:this.chord.join(",")===e.chord.join(",")&&(t=!0),D(this.selectedTags,e.selectedTags)&&D(this.selectedOrTags,e.selectedOrTags)&&D(this.selectedStyles,e.selectedStyles)&&D(this.selectedVideos,e.selectedVideos)&&D(this.selectedDiscogs,e.selectedDiscogs)&&D(this.selectedCountries,e.selectedCountries)&&function(e,t){if(void 0!==e&&void 0===t)return!1;if(void 0!==t&&void 0===e)return!1;if(void 0===e&&void 0===t)return!0;e=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),t=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());var n=Math.abs(e-t);if(0===Math.floor(n/1e3/60/60/24))return!0;return!1}(this.fromDate,e.fromDate)&&this.filterFavorites===e.filterFavorites&&t&&this.year===e.year}}]),e}(),L=n(793),B=n(919);function z(e,t){return new Set(Object(r.a)(e).filter(function(e){return t.has(e)}))}function J(e,t){return V.apply(this,arguments)}function V(){return(V=Object(s.a)(i.a.mark(function e(t,n){var r,a,s,o,c,u,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a in r=[],t)s=t[a],r.push(n(s));return e.next=4,Promise.all(r);case 4:o=e.sent,c=new Set(o[0]),e.t0=i.a.keys(o);case 7:if((e.t1=e.t0()).done){e.next=15;break}if(0!=(u=e.t1.value)){e.next=11;break}return e.abrupt("continue",7);case 11:l=new Set(o[u]),c=z(c,l),e.next=7;break;case 15:return e.abrupt("return",Array.from(c));case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function H(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var U=new(function(){function e(){Object(o.a)(this,e),this.recentQueries=[],this.guildId=0}return Object(c.a)(e,[{key:"setStore",value:function(e){var t=this;void 0===this.store&&e&&(this.store=e,this.store.subscribe(function(){return t.onChange()}))}},{key:"onChange",value:function(){var e=this.store.getState().guilds.selectedGuild,t=e?e.guildId:0;t!==this.guildId&&(console.log("guild changed to guildId = "+t),this.guildId=t,this.clear())}},{key:"clear",value:function(){this.recentQueries=[]}},{key:"createSearchQuery",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new F(this.store);return n.selectedTags=e.selectedTags,n.selectedOrTags=e.selectedOrTags,n.selectedStyles=e.selectedStyles,n.selectedVideos=e.selectedVideos,n.selectedDiscogs=e.selectedDiscogs,n.selectedCountries=e.selectedCountries,n.filterFavorites=e.filterFavorites,n.fromDate=e.fromDate,n.chord=void 0===e.chord?void 0:Object(r.a)(e.chord),n.year=e.year,t||(n.sampleToRanking=e.sampleToRanking),n}},{key:"getSearchQueryIfExists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.createSearchQuery(e),r=this.recentQueries.filter(function(e){return n.equals(e)&&!n.canceled});return void 0===(r=0==r.length?void 0:r[0])||t||(r.sampleToRanking=e.sampleToRanking,r.canceled=!1),void 0!==r&&r.sort(),r}},{key:"addNewQuery",value:function(e){this.recentQueries.push(e),this.recentQueries.length>25&&this.recentQueries.splice(0,1)}}]),e}()),G={},W=function(e){Object(u.a)(n,e);var t=H(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this,e)).store=r?r.store:void 0,a.cache=e,a.updateSoundRankings(),U.setStore(a.store),a}return Object(c.a)(n,[{key:"getNewIndex",value:function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.loadNewIndex(t);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"clearCache",value:function(){U.clear(),G={}}},{key:"filterByMonth",value:function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.filterByMonth(t.getMonth(),t.getFullYear());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"clearFilterByMonth",value:function(){this.cache.clearFilter()}},{key:"sortBy",get:function(){return U.sortBy},set:function(e){U.sortBy=e}},{key:"getAllSounds",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s,o,c,u,l,f;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(r=U.getSearchQueryIfExists(this,!0))){e.next=3;break}return e.abrupt("return",r);case 3:return r=U.createSearchQuery(this,!0),e.next=6,this.getSoundsWithVideos(this.selectedVideos);case 6:return a=e.sent,e.next=9,this.getSoundsWithDiscogs(this.selectedDiscogs);case 9:if(s=e.sent,r.videosSounds=K(a,s),o=[],!this.filterFavorites){e.next=18;break}return e.next=15,h.a.getFavoritesForUser();case 15:o=e.sent,e.next=32;break;case 18:if(c=void 0,void 0===a&&void 0===s){e.next=23;break}c=r.videosSounds,e.next=31;break;case 23:return(u=new Date(this.fromDate)).setDate(this.fromDate.getDate()+31),l=(new Date).getTime(),e.next=28,h.a.getAllSounds(this.fromDate,u);case 28:c=e.sent,f=(new Date).getTime(),f-l;case 31:c.forEach(function(e){-1==o.indexOf(e)&&o.push(e)});case 32:return r.setFinalResults(o),U.addNewQuery(r),e.abrupt("return",r);case 35:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSounds",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var a,s,o,c,u,l,f,p,d,v,m,y;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(a=U.getSearchQueryIfExists(this))){e.next=3;break}return e.abrupt("return",a);case 3:return a=U.createSearchQuery(this),(new Date).getTime(),e.next=7,this.getSoundsWithTags(this.selectedTags);case 7:return s=e.sent,e.next=10,this.getSoundsWithVideos(this.selectedVideos);case 10:return o=e.sent,e.next=13,this.getSoundsWithDiscogs(this.selectedDiscogs);case 13:return c=e.sent,e.next=16,this.getSoundsWithOrTags(this.sortTagsByPopularity(this.selectedOrTags));case 16:return u=e.sent,e.next=19,this.getSoundsWithStyles(this.selectedStyles);case 19:return l=e.sent,e.next=22,this.getSoundsWithCountries(this.selectedCountries);case 22:return f=e.sent,e.next=25,this.getSoundsWithYear(this.year);case 25:return p=e.sent,e.next=28,this.getSoundsWithChord(this.chord);case 28:if(d=e.sent,(new Date).getTime(),v=[d,s,l,f,p],m=this.intersectResultsForFilters(v),!this.filterFavorites){e.next=38;break}return e.next=35,h.a.getFavoritesForUser();case 35:e.t0=e.sent,e.next=39;break;case 38:e.t0=void 0;case 39:return y=e.t0,m=[].concat(Object(r.a)(m),Object(r.a)(u)),a.videosSounds=K(o,c),a.favorites=y,a.countriesSounds=f,a.stylesSounds=l,a.yearSounds=p,a.chordSounds=d,a.addUnsortedResults(m),U.addNewQuery(a),e.abrupt("return",a);case 50:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSoundsWithTags",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.t0=Set,e.next=5,J(t,function(e){return n.getSoundsWithTag(e)});case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithTag",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in G)){e.next=2;break}return e.abrupt("return",G[t]);case 2:return e.next=4,h.a.getSoundsWithTag(t);case 4:return n=e.sent,G[t]=n,e.abrupt("return",n);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithVideos",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r,a,s,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:for(r in n=[],t)n.push(h.a.getSoundsWithVideo(t[r]));return e.next=6,Promise.all(n);case 6:for(o in a=e.sent,s=[],a)s=s.concat(a[o]);return e.abrupt("return",new Set(s));case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithDiscogs",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r,a,s,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:for(r in n=[],t)n.push(h.a.getSoundsWithDiscogs(t[r]));return e.next=6,Promise.all(n);case 6:for(o in a=e.sent,s=[],a)s=s.concat(a[o]);return e.abrupt("return",new Set(s));case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithOrTags",value:function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,h.a.getSoundsWithOrTags(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"recursivelySearchOrTags",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=t.length){e.next=2;break}return e.abrupt("return",new Promise(function(e,t){return e(void 0)}));case 2:return n=t[0],e.abrupt("return",new L.a(function(){return h.a.getSoundsWithTag(n)},this.recursivelySearchOrTags(t.slice(1))));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithStyles",value:function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.next=5,J(t,function(e){return h.a.getSoundsWithStyle(e)});case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithCountries",value:function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.next=5,J(t,function(e){return h.a.getSoundsWithCountry(e)});case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithYear",value:function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.next=5,h.a.getSoundsWithYear(this.year);case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithChord",value:function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.t1=Object,e.next=6,(new B.a).searchRankedNotes(this.chord);case 6:return e.t2=e.sent,e.t3=e.t1.keys.call(e.t1,e.t2),e.abrupt("return",new e.t0(e.t3));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"intersectResultsForFilters",value:function(e){if(this.selectedOrTags.length>0)return[];var t=!1,n=new Set([]);for(var r in e){var a=e[r];if(void 0!==a)if(n.size>0){if(!(a.size>0))continue;n=z(n,a),t=!0}else!t&&a.size>0&&(n=a)}return Array.from(n)}},{key:"sortTagsByPopularity",value:function(e){var t=this.cache.getAllForField(R.d,0,2e3);return e.sort(function(e,n){return t.indexOf(e)-t.indexOf(n)}),e}},{key:"updateSoundRankings",value:function(){var e=Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.getOverallVotedRankings();case 2:this.sampleToRanking=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(I);function K(e,t){if(void 0!==e||void 0!==t){var n=new Set;return e&&e.forEach(function(e){return n.add(e)}),t&&t.forEach(function(e){return n.add(e)}),n}}t.a=W},function(e,t,n){"use strict";var r=n(11),a=n(42),i=n.n(a),s=n(56),o=n(4),c=n(5),u=n(6),l=n(8),f=n(2),h=n(7),p=n.n(h),d=n(9),v=n(34),m=(n(66),n(64),n(67),n(65),n(47),n(68),n(69),n(70),n(354)),y=n(10);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var g=function(e){Object(u.a)(n,e);var t=b(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e)).sequencerEngine=r,i.subSequence=a,i}return Object(c.a)(n,[{key:"getMixType",value:function(){return d.f}},{key:"getValueAtStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=this.getNextEvent({step:e},!0),r=this.getPreviousEvent({step:e},!1,!0);if(void 0===r){if(void 0===n)return t;var a=e/n.step;return t*(1-a)+n.value*a}if(void 0===n)return r.volume;var i=(e-r.step)/(n.step-r.step);return r.volume*(1-i)+n.volume*i}},{key:"deleteEvent",value:function(e){var t=this.events.indexOf(e);t>-1&&this.events.splice(t,1),this.updateRedux(this.subSequence,this.sequencerEngine)}},{key:"loadFromJson",value:function(e,t,r){Object(y.a)(Object(f.a)(n.prototype),"loadFromJson",this).call(this,e,t,r),this.updateRedux(r,t)}}]),n}(m.a),O=n(582),k=n(38),j=n(36),w=n(21),x=n(910),S=n(355),P=n(415),E=n(416),T=n(414),A=n(245),M=n(166);function R(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var C=function(e){Object(u.a)(n,e);var t=R(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this,e,r.getType())).event=r,s.difference=a,s.inPlace=i,s}return Object(c.a)(n,[{key:"execute",value:function(){this.event.duration=this.getDuration(this.event);this.events.map(function(e){return e.step});if(0!==this.differeence){for(var e=void 0,t=0;t<this.events.length;t++){var n=this.events[t];if(n.step>this.event.step){n.step+=this.difference;var r=this.events[t+1];if(r&&r.step<=n.step&&(e=t),this.inPlace)break}}void 0!==e&&this.events.splice(e,1),this.events.map(function(e){return e.step}),this.calculateDurations()}}}]),n}(M.a);function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var q=function(e){Object(u.a)(n,e);var t=N(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e,r[0].getType())).eventsToPaste=r,i.stepNumber=a,i}return Object(c.a)(n,[{key:"insertEvent",value:function(e,t){new A.a(this.mix,e,t).execute()}},{key:"execute",value:function(){var e=this.eventsToPaste[0].step;for(var t in this.eventsToPaste){var n=this.eventsToPaste[t];n.step=n.step-e+this.stepNumber,this.insertEvent(n,n.duration)}}}]),n}(M.a);function I(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var _=function(e){Object(u.a)(n,e);var t=I(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,void 0,d.j)).sequenceRollEvent=e,i.event=r,i.difference=a,i}return Object(c.a)(n,[{key:"events",get:function(){return this.sequenceRollEvent.events},set:function(e){this.sequenceRollEvent.events=e}},{key:"execute",value:function(){for(var e=void 0,t=0;t<this.events.length;t++){var n=this.events[t];if(n.step>this.event.step){n.step+=this.difference;var r=this.events[t+1];r&&r.step<=n.step&&(e=t),n.duration+this.difference<0&&(e=t);break}}void 0!==e&&this.sequenceRollEvent.subEvents.splice(e-1,1),this.sequenceRollEvent.calculateDurations()}}]),n}(M.a);function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var F="LEFT",L=function(e){Object(u.a)(n,e);var t=D(n);function n(e,r,a,i,s){var c;return Object(o.a)(this,n),(c=t.call(this,e,r.getType())).sequenceRollEvent=r,c.resolutionChangeEvent=a,i===F?c.newStart=s:c.difference=s,c.direction=i,c}return Object(c.a)(n,[{key:"execute",value:function(){this.direction===F?this.resizeLeftSide():this.resizeRightSide()}},{key:"resizeLeftSide",value:function(){0===this.sequenceRollEvent.getSubEvents().indexOf(this.resolutionChangeEvent)&&(this.sequenceRollEvent.step=this.newStart),this.resolutionChangeEvent.step=this.newStart,this.sequenceRollEvent.calculateDurations()}},{key:"resizeRightSide",value:function(){this.sequenceRollEvent.step,this.sequenceRollEvent.duration;var e=this.sequenceRollEvent.getSubEvents(),t=-1;for(var n in e)e[n].step===this.resolutionChangeEvent.step&&(t=parseInt(n));t===e.length-1?new C(this.mix,this.sequenceRollEvent,this.difference,!0).execute():new _(this.sequenceRollEvent,this.resolutionChangeEvent,this.difference).execute()}},{key:"getResolutionDuration",value:function(e){var t=e.step+e.duration,n=this.mix.getValuesBetweenSteps(d.k,e.step,t);for(var r in n)if(!n[r].value)return n[r].step-e.step;return e.duration}}]),n}(M.a),B=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.subSequence=void 0===n?d.g:n}return Object(c.a)(e,[{key:"getTimeForEventToAdd",value:function(e){if(this.sequencerEngine.playing){var t=new p.a.Time(p.a.Master.currentTime).toMilliseconds()-new p.a.Time(this.sequencerEngine.automationTime).toMilliseconds(),n=this.sequencerEngine.automationStep||0;return e.isDeterministic()||n--,{time:t,step:n}}}},{key:"seekToTrackStep",value:function(e){}},{key:"resizeEvent",value:function(e,t,n){}},{key:"deleteEvent",value:function(e,t){}},{key:"deleteCompoundEvent",value:function(e,t){}},{key:"insertEvent",value:function(e,t){}},{key:"pasteEvents",value:function(e,t){}},{key:"restart",value:function(){}},{key:"addEvent",value:function(e){}},{key:"holdEvent",value:function(e){}},{key:"scheduleNext",value:function(e,t){}},{key:"schedule",value:function(){}},{key:"getValue",value:function(e,t){}},{key:"getEvent",value:function(e,t){}}]),e}();var z=n(23);n(40);function J(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var V=function(e){Object(u.a)(n,e);var t=J(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this,e,r)).mixesByType={},a.mixesByType[d.l]=new g(d.l,e,r),a.deterministicMixesByType={},a.deterministicMixesByType[d.j]=new O.a(d.j,new k.a(new w.a),a.subSequence),a.deterministicMixesByType[d.k]=new O.a(d.k,new j.a(!1,new w.a),a.subSequence),a.deterministicMixesByType[d.i]=new O.a(d.i,new v.a(0),a.subSequence),r&&a.updateAllTypeRedux(),a}return Object(c.a)(n,[{key:"getValue",value:function(e,t){var n=this.deterministicMixesByType[e];if(void 0!==n)return n.getValue(t,!0)}},{key:"getEvent",value:function(e,t){var n=this.deterministicMixesByType[e];if(void 0!==n)return n.getEvent(t)}},{key:"getValuesBetweenSteps",value:function(e,t,n){var r=this.deterministicMixesByType[e];if(void 0!==r)return r.getValuesBetweenSteps(t,n)}},{key:"holdEvent",value:function(e){if(e.isDeterministic()){var t=e.getType();!t in this.deterministicMixesByType&&(this.deterministicMixesByType[t]=new O.a),this.deterministicMixesByType[t].holdEvent(e)}}},{key:"dispatch",value:function(e){Object(x.a)(this,e)}},{key:"addEvent",value:function(e){var t=this.getTimeForEventToAdd(e);if(void 0!==t){e.subSequence=this.subSequence;e.cancel(),e.isDeterministic()?new T.a(this,e,t.time,t.step).execute():new S.a(this,e,t.time,t.step).execute(),setTimeout(function(){e.canceled=!1},5e3),e.isDeterministic()&&this.updateAllTypeRedux()}}},{key:"getNextEvent",value:function(e){var t=e.getType();return this.deterministicMixesByType[t].getNextEvent(e)}},{key:"getPreviousEvent",value:function(e){var t=e.getType();return this.deterministicMixesByType[t].getPreviousEvent(e)}},{key:"resizeEvent",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];new C(this,e,t,n).execute(),this.updateAllTypeRedux()}},{key:"resizeSequenceRoll",value:function(e,t,n,r){new L(this,e,t,n,r).execute(),this.updateAllTypeRedux()}},{key:"insertEvent",value:function(e,t){new A.a(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"pasteEvents",value:function(e,t){new q(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"deleteEvent",value:function(e,t){new P.a(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"deleteCompoundEvent",value:function(e,t){new E.a(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"seekToTrackStep",value:function(e){for(var t in this.mixesByType)this.mixesByType[t].seekToTrackStep(e);for(var n in this.deterministicMixesByType)this.deterministicMixesByType[n].seekToTrackStep(e)}},{key:"restart",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t in this.mixesByType)this.mixesByType[t].restart(e);for(var n in this.deterministicMixesByType)this.deterministicMixesByType[n].restart(e)}},{key:"scheduleNext",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(s in r=new p.a.Time(p.a.Master.context.currentTime).toMilliseconds(),a=new p.a.Time(n).toMilliseconds()-r,this.mixesByType)this.mixesByType[s].scheduleNext(t,a,this.sequencerEngine);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"eraseEventsAtStep",value:function(e){for(var t in this.mixesByType)this.mixesByType[t].eraseEventsAtStep(e)}},{key:"schedule",value:function(){for(var e in this.mixesByType)this.mixesByType[e].schedule()}},{key:"getJson",value:function(){var e={};for(var t in this.mixesByType)e[t]=this.mixesByType[t].getJson();var n={};for(var r in this.deterministicMixesByType)n[r]=this.deterministicMixesByType[r].getJson();return{name:this.name,mixesByType:e,deterministicMixesByType:n}}},{key:"getCopy",value:function(){var e=new n(this.name);return e.mixesByType=this.mixesByType,e.deterministicMixesByType=this.deterministicMixesByType,e}},{key:"getFirstEvent",value:function(e){return this.deterministicMixesByType[e].defaultValue}},{key:"loadFromJson",value:function(e,t){if(void 0!==e){for(var n in t=this.sequencerEngine,e.mixesByType)this.mixesByType[n]=new g(parseInt(n),t,this.subSequence),this.mixesByType[n].loadFromJson(e.mixesByType[n],t,this.subSequence);for(var r in e.deterministicMixesByType){var a=void 0;(r=parseInt(r))===d.i?a=new v.a(0):r===d.k?a=new j.a(!1,new w.a):r===d.j&&(a=new k.a(new w.a)),this.deterministicMixesByType[r]=new O.a(parseInt(r),a),this.deterministicMixesByType[r].loadFromJson(e.deterministicMixesByType[r],t)}this.updateAllTypeRedux()}}},{key:"updateTypeRedux",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.ic,n=this.deterministicMixesByType[e],r=[],a=this.getFirstEvent(e);a.subSequence=this.subSequence,a.step=0;for(var i=0;i<n.events.length;i++)a.subSequence=this.subSequence,a.duration=n.events[i].step-a.step,r.push(a),a=n.events[i];var s=n.events[n.events.length-1]||a;s&&(s.duration=void 0,s.subSequence=this.subSequence,r.push(s)),this.sequencerEngine.store.dispatch(t(this.subSequence.id,e,r))}},{key:"updateAllTypeRedux",value:function(){for(var e in this.mixesByType)this.mixesByType[e].updateRedux(this.subSequence,this.sequencerEngine);this.updateTypeRedux(d.i,z.ic),this.updateTypeRedux(d.k,z.ic),this.sequencerEngine.dispatch(Object(z.fe)(function(e){var t=Math.max(30,Math.max.apply(Math,Object(r.a)(e.mixes.map(function(e){return e.length/32+16}))));return Math.floor(2*t)}(this.sequencerEngine)))}},{key:"clear",value:function(){for(var e in this.deterministicMixesByType)this.deterministicMixesByType[e].clear();for(var t in this.mixesByType)this.mixesByType[t].clear();this.updateAllTypeRedux()}},{key:"length",get:function(){var e=[];for(var t in this.deterministicMixesByType){var n=this.deterministicMixesByType[t];e=[].concat(Object(r.a)(e),Object(r.a)(n.events.map(function(e){return e.step})))}for(var a in this.mixesByType){var i=this.mixesByType[a];e=[].concat(Object(r.a)(e),Object(r.a)(i.events.map(function(e){return e.step})))}var s=Math.max.apply(Math,Object(r.a)(e.filter(function(e){return void 0!==e&&!isNaN(e)})));return s===-1/0?0:s}},{key:"prune",value:function(e){e in this.deterministicMixesByType&&this.deterministicMixesByType[e].prune(),e in this.mixesByType&&this.deterministicMixesByType[e].prune()}}]),n}(B);t.a=V},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5);var c=function(){function e(t,n){Object(s.a)(this,e),this.wasm=t,this.wasm.decoder_init(),this.wasm.decoder_set_mp3_data_size(n.byteLength),new Uint8Array(this.wasm.memory.buffer,this.wasm.decoder_mp3_data_offset(),this.wasm.decoder_mp3_data_size()).set(n),this.duration=this.seek(-1),this.seek(0)}return Object(o.a)(e,[{key:"setData",value:function(e){this.wasm.decoder_set_mp3_data_size(e.byteLength),new Uint8Array(this.wasm.memory.buffer,this.wasm.decoder_mp3_data_offset(),this.wasm.decoder_mp3_data_size()).set(e),this.duration=this.seek(-1),this.seek(0)}},{key:"seek",value:function(e){return this.wasm.decoder_seek(e),this.currentTime()}},{key:"decode",value:function(e){var t=this.currentTime();this.wasm.decoder_decode(e);var n=new Int16Array(this.wasm.memory.buffer,this.wasm.decoder_pcm_data_offset(),this.wasm.decoder_pcm_data_size()/2),r=this.wasm.decode_results_sampling_rate(),a=this.wasm.decode_results_num_channels(),i=this.wasm.decode_results_num_samples();return{pcm:n,startTime:t,duration:i/a/r,samplingRate:r,numChannels:a,numSamples:i}}},{key:"currentTime",value:function(){return this.wasm.decoder_current_time()}}]),e}();function u(e,t){return l.apply(this,arguments)}function l(){return(l=Object(i.a)(a.a.mark(function e(t,n){var r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||"decoder.opt.wasm",e.next=3,fetch(n);case 3:return r=e.sent,e.next=6,r.arrayBuffer();case 6:return i=e.sent,e.next=9,WebAssembly.instantiate(i,{});case 9:return s=e.sent,e.abrupt("return",new c(s.instance.exports,t));case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}var f=null,h=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=window.isNFT?"decoder.opt.wasm":"/decoder.opt.wasm",f){e.next=7;break}return e.next=4,u(t,n);case 4:f=e.sent,e.next=8;break;case 7:f.setData(t);case 8:return r=new Uint16Array(6*t.length),i=0,f.seek(0),0,o=f.decode(300),s=o.samplingRate,r.set(o.pcm,i),i+=o.pcm.length,e.abrupt("return",{decoded:r,sampleRate:s,position:i});case 17:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),p=function(e){return new Promise(function(t){var n=e.id,r=e.mp3Data,a=e.isNFT;h(r,a).then(function(e){var r=e.decoded,a=e.sampleRate,i=e.position;t({decoded:r,sampleRate:a,position:i,id:n})})})},d=n(79),v=n(167),m=(n(290),n(138),n(7)),y=n.n(m);n.d(t,"a",function(){return j});var b,g=0,O={},k=function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("decode called"),!window.isNFT||window.urlSearchParams.get("gallery")){e.next=6;break}return e.next=4,p({mp3Data:t,isNFT:window.isNFT,id:n});case 4:return r=e.sent,e.abrupt("return",r);case 6:b||((b=new Worker(window.isNFT?"mp3Worker.js":"/mp3Worker.js")).onmessage=function(e){O[e.data.id]=e.data}),b.postMessage({mp3Data:t,isNFT:window.isNFT,id:n});case 8:if(O[n]){e.next=13;break}return e.next=11,Object(d.a)(100);case 11:e.next=8;break;case 13:return e.abrupt("return",O[n]);case 14:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),j=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f,h,p,d;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(t,g++);case 2:for(n=e.sent,r=n.decoded,i=n.sampleRate,s=n.position,o=y.a.Master.context,v.isMobile,c=2,u=o.createBuffer(c,s/2,i),l=u.getChannelData(0),f=2===c?u.getChannelData(1):null,h=0;h<r.length;h+=2)p=r[h],d=r[h+1],l[h/2]=p>=32768?-(65536-p)/32768:p/32767,2===c&&(f[h/2]=d>=32768?-(65536-d)/32768:d/32767);return e.abrupt("return",u);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(4),s=n(5),o=n(6),c=n(8),u=n(2),l=n(142),f=n(567),h=n(204),p=n(23),d=n(123),v=(n(418),n(429),n(7)),m=n.n(v),y=n(402),b=n(272),g=n(552),O=(n(306),n(133)),k=n(33);function j(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var S=n(358),P=n(359),E=n(584);function T(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function M(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var R=function(e){Object(o.a)(n,e);var t=M(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this)).track=e,r.initCache(),r.receivedTriggers=[],r.effects=[],r.inputedTriggers=[],r.noteToTriggers={},r.stepNumber=0,r.times=[],r.setupMessageReader(),r}return Object(s.a)(n,[{key:"addEffect",value:function(e){e&&(this.effects=[].concat(Object(a.a)(this.effects),[e]),this.linkEffectParameters(),e.track=this.track||this._subSequence,e._subSequence=this._subSequence)}},{key:"getEffectById",value:function(e){return this.effects.find(function(t){return t.id===e})}},{key:"getCopy",value:function(e,t){var r=new n(e);return r.effects=this.effects.map(function(n){return n.getCopy(e,t)}),r.linkEffectParameters(),r}},{key:"linkEffectParameters",value:function(){var e=this;this.effects.forEach(function(t){t.registerContext((new d.a).forTrack(e.track)),t.registerMixSession(e.track.mixSession),t.registerTrack(e.track)});var t,n={},a=T(this.effects);try{for(a.s();!(t=a.n()).done;){var i,s=T(t.value.getParameters());try{for(s.s();!(i=s.n()).done;){var o=i.value;n=Object(r.a)({},n,o.setStore(this.track.store))}}catch(c){s.e(c)}finally{s.f()}}}catch(c){a.e(c)}finally{a.f()}this.track.store.dispatch(Object(p.ub)(n))}},{key:"deleteEffect",value:function(e){var t=this.effects.map(function(e){return e.id}).indexOf(e.id);this.effects.splice(t,1),this.effects=Object(a.a)(this.effects),e.dispose()}},{key:"moveEffectTo",value:function(e,t){if(e!=t){var n=[];e>t?(n=this.effects.slice(0,t).concat([this.effects[e]]).concat(this.effects.slice(t,e)),this.effects.length>e+1&&(n=n.concat(this.effects.slice(e+1)))):(n=this.effects.slice(0,e).concat(this.effects.slice(e+1,t)).concat([this.effects[t],this.effects[e]]),this.effects.length>t+1&&(n=n.concat(this.effects.slice(t+1)))),this.effects=n}}},{key:"needsStableLookAhead",value:function(){return this.effects.some(function(e){return e.needsStableLookAhead()})}},{key:"input",value:function(e,t,n,r){this.inputedTriggers.push(new l.a(e,t,n,0,r))}},{key:"output",value:function(e,t,n){var r=this;this.times.push(e),this.stepNumber=t;var i=[].concat(Object(a.a)(this.inputedTriggers),Object(a.a)(this.receivedTriggers));for(var s in this.receivedTriggers.length=0,i.forEach(function(t){return r.triggerAttackReleasePreFXEnvelopes(e,t)}),this.setNotesDown(i),this.effects){var o=this.effects[s];if(o.isEnabled()){for(var c in i){var u=i[c];o.input(u)}i=o.output(e,t,n)}}return this.triggerAttackReleasePostFXEnvelopes(i),i}},{key:"getDuration",value:function(e){return new m.a.Time("16n")*e}},{key:"subSequence",get:function(){return this.track.subSequence}},{key:"state",get:function(){return this.track.sequencerEngine.state}},{key:"dispatch",value:function(e){this.track.sequencerEngine.dispatch(e)}},{key:"onNewStep",value:function(){this.inputedTriggers=[],this.effects.forEach(function(e){return e.onNewStep()})}},{key:"clear",value:function(){this.effects.forEach(function(e){return e.clear()}),this.receivedTriggers.length=0}},{key:"addEffectJson",value:function(e){var t={},n=Object(b.a)(e,this.track||{sequencerEngine:this.sequencerEngine});if(n)return this.addEffect(n),t=Object(r.a)({},t,n.fromJson(e)),{effect:n,bulk:t}}},{key:"fromJson",value:function(e){var t={};for(var n in e){var a=Object(b.a)(e[n],this.track||{sequencerEngine:this.sequencerEngine});a&&(this.addEffect(a),t=Object(r.a)({},t,a.fromJson(e[n])))}return t}},{key:"getEffectNumber",value:function(e){return this.effects.indexOf(e)}},{key:"getJson",value:function(){return this.effects.map(function(e){return e.getJson()})}},{key:"getAllParameters",value:function(){var e=[];return this.effects.forEach(function(t){return t.getParameters().forEach(function(t){return e.push(t)})}),e}},{key:"getAllPatternLockedParameters",value:function(){return this.getAllParameters().filter(function(e){return e.hasPatternLockedValues()})}},{key:"mate",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=Math.max(e.effects.length,this.effects.length),r=[],a=0;a<n;a++){var i=this.effects[a],s=e.effects[a];Object(h.a)(t)?s&&r.push(s.getCopy(this.track)):i&&r.push(i)}this.effects=r,this.linkEffectParameters()}},{key:"addNoteDown",value:function(e){var t=this.state.keyboard.notesDown||[];this.dispatch(Object(p.mc)([].concat(Object(a.a)(t),[e])))}},{key:"notesDown",get:function(){return this.state.keyboard.notesDown||[]}},{key:"removeNoteDown",value:function(e){var t=this.state.keyboard.notesDown||[],n=(t=Object(a.a)(t)).indexOf(e);t.splice(n,1),this.dispatch(Object(p.mc)(t))}},{key:"setNotesDown",value:function(e){var t=this;if(0!==e.length&&!m.a.Master.context.isOffline&&this.track.sequencerEngine.getSelectedTrack()===this.track&&(this.state.sequencer.showPianoRoll||this.state.spatial.showEditorBottom===y.b)){var n=e.map(function(e){return e.stepData.transpose}),r=this.state.keyboard.notesDown||[];this.dispatch(Object(p.mc)([].concat(Object(a.a)(r),Object(a.a)(n)))),e.forEach(function(e){return setTimeout(function(){e.stepData.trackData&&t.removeNoteDown(e.stepData.transpose)},e.stepData.duration*m.a.Time("16n").toSeconds()*1e3)})}}},{key:"stop",value:function(){this.times=[],this.effects.forEach(function(e){return e.stop()})}},{key:"dispose",value:function(){this._disposed||(this.effects.forEach(function(e){return e.dispose()}),this._disposed=!0)}},{key:"convertToRack",value:function(){var e=this.effects.map(function(e){return e.getEffectCopy()}),t=new P.a(this.track);e.forEach(function(e){return t.addEffect(e,!1)});var n,r=50,a=100,i=T(e);try{for(i.s();!(n=i.n()).done;){var s=n.value;s.x=r,s.y=a,(r+=50)>300&&(r=50,a+=50)}}catch(c){i.e(c)}finally{i.f()}t.connectNodes(void 0,e[0]);for(var o=0;o<e.length;o++)t.connectNodes(e[o],e[o+1]);this.effects=[],this.addEffect(t)}},{key:"makePlanar",value:function(){var e=new f.a(this.track),t=this.track.effects.flatMap(function(e){return e.getParameters()});this.track.instrument&&(t=[].concat(Object(a.a)(t),Object(a.a)(this.track.instrument.getParameters()))),this.addEffect(e),t.filter(function(e){return!S.a.some(function(t){return e.name.toLowerCase().includes(t.toLowerCase())})}).filter(function(e){return!e.isMapped}).forEach(function(t){return e.setParameter(t)})}}]),n}(Object(E.a)(function(e){Object(o.a)(n,e);var t=x(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"liveInputTrigger",value:function(e,t,n){this.triggerAttackPreFXEnvelopes(void 0,e),this.addNoteDown(e.transpose),this.effects[0]&&this.effects[0].isRack?(this.liveInputTriggerRealTime(e,t,n),this.addNote(e,void 0,n)):this.isRealTime()?this.liveInputTriggerRealTime(e,t,n):this.addNote(e,void 0,n)}},{key:"liveInputTriggerRealTime",value:function(e,t,n){for(var r=this,i=e.transpose,s=this.stepNumber,o=new Set,c=n||m.a.Master.context.currentTime,u=this.times.length-1;u>=0&&c<this.times[u];u--)o.add(Math.max(0,s)),s--;s=Math.max(0,s),o.add(s),(o=Array.from(o)).reverse();var f=[new l.a(e,n,s)];for(var h in this.effects)if(this.effects[h].onNewStep(),this.effects[h].isEnabled()){for(var p in f)this.effects[h].input(f[p],!0);f=this.effects[h].output(n,s,void 0,!0,o)}this.triggerAttackPostFXEnvelopes(f),f.forEach(function(e){e.stepData&&(e.stepData.track=r.track,t?t.liveTrigger(e.stepData,e.stepData.slice,e.time):r.track.skipMidiMaster?r.track.liveTrigger(e.stepData,e.stepData.slice,e.time):r.subSequence.midiEffects.liveInputTrigger(e.stepData,r.track,e.time))});var d=this.noteToTriggers;f.forEach(function(e){e.stepData&&(e.transpose=e.stepData.transpose,e.slice=e.stepData.slice)}),t&&(d=this.noteToTriggers[t.trackNumber]||{},this.noteToTriggers[t.trackNumber]=d),void 0!==d[i]?d[i]=[].concat(Object(a.a)(d[i]),Object(a.a)(f)):d[i]=Object(a.a)(f)}},{key:"liveInputRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this.removeNoteDown(e),this.effects[0]&&this.effects[0].isRack?(this.liveInputReleaseRealTime(e,t,n),this.removeNote(e,t)):this.isRealTime()?(this.liveInputReleaseRealTime(e,t,n),this.removeNote(e,t)):this.removeNote(e,t),0===this.notesDown.length&&(this.triggerReleasePreFXEnvelopes(),this.triggerReleasePostFXEnvelopes())}},{key:"liveInputReleaseRealTime",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=this.noteToTriggers;n&&(r=this.noteToTriggers[n.trackNumber]||{},this.noteToTriggers[n.trackNumber]=r);var i=r[e];if(void 0===i){var s=Object.keys(r);i=r[s[0]]||[],e=s[0]}for(var o=0,c=Object(a.a)(i);o<c.length;o++){var u=c[o];if(u.stepData&&u.stepData.delays){var l,f=j(u.stepData.delays);try{for(f.s();!(l=f.n()).done;){var h=l.value;this.track&&this.track.liveTriggerRelease(h.reference.transpose,0)}}catch(v){f.e(v)}finally{f.f()}}}var p=[];for(var d in i)i[d].slice===t?n?n.liveTriggerRelease(i[d].transpose,i[d].slice):this.track.skipMidiMaster?this.track.liveTriggerRelease(i[d].transpose,i[d].slice):this.subSequence.midiEffects.liveInputRelease(i[d].transpose,i[d].slice,this.track):p.push(i[d]);void 0!==e&&(r[e]=p,0===r[e].length&&delete r[e])}},{key:"addNote",value:function(e,t){var n=[new l.a(e,t)],r=void 0;for(var a in this.effects){if(!(r=this.effects[a]).isRealTime())break;for(var i in this.effects[a].onNewStep(),n)r.input(n[i]);n=this.effects[a].output()}r.addNote(n[0].stepData.transpose,n[0].stepData.slice,this.stepNumber,t)}},{key:"removeNote",value:function(e,t){this.effects.forEach(function(n){return n.removeNote(e,t)})}},{key:"isRealTime",value:function(){return this.effects.filter(function(e){return e.isEnabled()}).every(function(e){return e.isRealTime()})}},{key:"isLiveRealTime",value:function(){return!!this.track.isEnabled&&this.effects.some(function(e){return"Arpeggiator"===e.name})}},{key:"setupMessageReader",value:function(){var e=this;if(this.track&&this.track.subSequence.name){var t=this.track.trackNumber+1+this.track.subSequence.name.toLowerCase(),n=t+".triggerAttack",r=t+".triggerAttackRelease",a=t+".triggerRelease",i=new k.a;i.slice=0,i.duration=null,this.triggerAttackReader&&this.triggerAttackReader(),this.triggerAttackReader=Object(O.d)(n,function(t){var n=void 0;if("object"===typeof t){var r=t.transpose,a=t.time,s=t.velocity;i.velocity=s,i.transpose=r,n=a}else i.transpose=t;e.liveInputTrigger(i,void 0,n)}),this.triggerReleaseReader&&this.triggerReleaseReader(),this.triggerReleaseReader=Object(O.d)(a,function(t){var n="object"===t?t.transpose:t;e.liveInputRelease(n)}),this.triggerAttackReleaseReader&&this.triggerAttackReleaseReader(),this.triggerAttackReleaseReader=Object(O.d)(r,function(t){var n=t.stepData,r=t.time,a=t.stepNumber;(n=e.getStep(n)).track=e.track,e.input(n,r,a),e.receivedTriggers=e.inputedTriggers})}}},{key:"getConnectedEnvelopes",value:function(e){return this.track.envelopesTrack?e===g.b?[]:this.track.envelopesTrack.envelopes.map(function(e){return e.envelope}):this.track.connectedEnvelopes.filter(function(t){return t.mode===e}).map(function(e){return e.envelope})}},{key:"triggerReleasePreFXEnvelopes",value:function(e){this.getConnectedEnvelopes(g.b).forEach(function(t){return t.triggerRelease(e)})}},{key:"triggerReleasePostFXEnvelopes",value:function(e){this.getConnectedEnvelopes(g.a).forEach(function(t){return t.triggerRelease(e)})}},{key:"triggerAttackPreFXEnvelopes",value:function(e,t){this.getConnectedEnvelopes(g.b).forEach(function(n){return n.triggerAttack(e,t.velocity)})}},{key:"triggerAttackReleasePreFXEnvelopes",value:function(e,t){var n=this,r=t.stepData;this.getConnectedEnvelopes(g.b).forEach(function(t){return t.triggerAttackRelease(n.getDuration(r.duration),e,r.velocity)})}},{key:"triggerAttackPostFXEnvelopes",value:function(e){var t=this;e.forEach(function(e){t.getConnectedEnvelopes(g.a).forEach(function(t){return t.triggerAttack(isNaN(e.time)?void 0:e.time,e.stepData?e.stepData.velocity:1)})})}},{key:"triggerAttackReleasePostFXEnvelopes",value:function(e){var t=this;e.filter(function(e){return e&&e.stepData}).forEach(function(e){t.getConnectedEnvelopes(g.a).forEach(function(n){return n.triggerAttackRelease(t.getDuration(e.stepData.duration),e.time,e.stepData.velocity)})})}}]),n}(function(){return function e(){Object(i.a)(this,e)}}())));t.a=R},,function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2);n(166);function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var l=function(e){Object(s.a)(n,e);var t=u(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"currentEvent",set:function(e){this.mixByType.currentEvent=e}},{key:"execute",value:function(){Object(i.a)(Object(c.a)(n.prototype),"execute",this).call(this),this.currentEvent=this.event}}]),n}(n(355).a);t.a=l},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var u=function(e){Object(i.a)(n,e);var t=c(n);function n(e,a){var i,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(r.a)(this,n),(i=t.call(this,e,a.getType())).event=a,i.inPlace=s,i}return Object(a.a)(n,[{key:"execute",value:function(){var e=this.events.indexOf(this.event);if(e>-1&&this.events.splice(e,1),!this.inPlace){var t=this.event.duration;for(var n in this.events)if(this.events[n].step>this.event.step&&(this.events[n].step-=t,this.inPlace))return}this.mix.restart()}}]),n}(n(166).a);t.a=u},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var u=function(e){Object(i.a)(n,e);var t=c(n);function n(e,a,i){var s;return Object(r.a)(this,n),(s=t.call(this,e,a.getType())).event=a,s.subEvent=i,s}return Object(a.a)(n,[{key:"execute",value:function(){var e=this.subEvent.step,t=this.subEvent.duration,n=this.event.deleteSubEvent(this.subEvent);if(!(n<0)){if(this.event.isEmpty())return n=this.mixByType.events.indexOf(this.event),this.mixByType.events.splice(n,1),this.mixByType.calculateDurations(),void this.mix.updateAllTypeRedux();var r=this.event.subEvents;for(var a in r)if(r[a].step>e){r[a].step-=t;break}this.mix.restart(),this.event.calculateDurations(),this.mixByType.calculateDurations(),this.mix.updateAllTypeRedux()}}}]),n}(n(166).a);t.a=u},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=100;function a(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1)*(t.resolution/8)*e/32*r}},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(31),o=n(10),c=n(6),u=n(8),l=n(2),f=n(135),h=n(119),p=(n(33),n(142)),d=n(234),v=n(14),m=n(21),y=n(235),b=n(422);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var O=function(e){Object(c.a)(n,e);var t=g(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Arpeggiator",e)).notesToRemove=[],r.arpRateParameter=new y.a("arpRate",Object(s.a)(r),function(e,t){return t},{documentation:"The rate or speed of the arpeggiation, synced to the project tempo.",min:0,prettyName:"Rate",max:1,unit:"",options:{0:new m.a(4,!1),.1:new m.a(4,!0),.2:new m.a(8,!1),.3:new m.a(8,!0),.4:new m.a(16,!1),.5:new m.a(16,!0),.6:new m.a(32,!1),.7:new m.a(32,!0)},defaultValue:new m.a(16,!1)}),r.registerParameter(r.arpRateParameter),r.arpOctavesParameter=new v.a("arpOctaves",Object(s.a)(r),function(e,t){return t},{documentation:"The number of octaves to cycle through.",prettyName:"Octaves",min:0,max:8,unit:"",defaultValue:1}),r.registerParameter(r.arpOctavesParameter),r.arpDirectionParameter=new v.a("arpDirection",Object(s.a)(r),function(e,t){return t},{min:b.a,documentation:"The direction we play notes in.",prettyName:"Direction",max:b.b,unit:"",defaultValue:b.a}),r.registerParameter(r.arpDirectionParameter),r.arpDurationFactorParameter=new v.a("arpDurationFactor",Object(s.a)(r),function(e,t){return t},{documentation:"Multiples the duration of each trigger by this number.",min:1e-4,prettyName:"Duration Factor",max:8,unit:"x",defaultValue:1}),r.registerParameter(r.arpDurationFactorParameter),r.arpRepeatParameter=new v.a("arpRepeatFactor",Object(s.a)(r),function(e,t){return t},{documentation:"The number of triggers per note in the cycle.",min:1,max:8,unit:"x",prettyName:"Repeats",defaultValue:1}),r.registerParameter(r.arpRepeatParameter),r.noteToDuration={},r.notes=[],r.index=0,r.repeatIndex=0,r.currentOctave=0,r}return Object(i.a)(n,[{key:"getVisualizedParameters",value:function(){return[this.arpRateParameter]}},{key:"getText",value:function(){return this.arpRateParameter.get().toString()}},{key:"documentation",get:function(){return"Cycle through notes in a chord at a rate set by the rate parameter."}},{key:"isRealTime",value:function(){return!1}},{key:"arpRate",get:function(){return this.arpRateParameter.get()},set:function(e){this.arpRateParameter.set(e)}},{key:"arpOctaves",get:function(){return this.arpOctavesParameter.get()}},{key:"arpDirection",get:function(){return this.arpDirectionParameter.get()}},{key:"arpDurationFactor",get:function(){return this.arpDurationFactorParameter.get()}},{key:"arpRepeat",get:function(){return this.arpRepeatParameter.get()}},{key:"onNewStep",value:function(){}},{key:"clear",value:function(){this.noteToDuration={},this.notesToRemove=[],this.notes=[],this.repeatIndex=0,this.index=0,this.arpDirection,b.a}},{key:"input",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.stepData.duration,r=e.stepData.transpose;t||(r in this.noteToDuration?this.noteToDuration[r]=this.noteToDuration[r]+2*n:this.noteToDuration[r]=2*n),this.getIndexOfTrigger(e)<0&&(e.stepData=this.getStep(e.stepData,r,n,!1),this.notes.push(e),this.notes=this.notes.sort(function(e,t){return e.stepData.transpose-t.stepData.transpose}),this.arpDirection===b.a&&this.notes.reverse())}},{key:"output",value:function(e,t,n){var r=this,a=this.getNextTriggers(t).map(function(t){return t.time+=e,t.stepNumber=n,t});return this.notesToRemove.forEach(function(e){return r.actuallyRemoveNote(e)}),this.notesToRemove=[],a}},{key:"getIndexOfTrigger",value:function(e){for(var t in this.notes)if(this.notes[t].stepData.transpose===e.stepData.transpose)return t;return-1}},{key:"actuallyRemoveNote",value:function(e){var t=-1;for(var n in this.notes)if(e===this.notes[n].stepData.transpose){t=n;break}t>-1&&this.notes.splice(t,1),this.index>=this.notes.length&&(this.index=0),0===this.notes.length&&this.clear()}},{key:"removeNote",value:function(e){this.notesToRemove.push(e)}},{key:"nextNote",value:function(e){if(0!=this.notes.length){var t=this.notes[this.index],n=t.stepData.transpose;n+=12*this.currentOctave,console.log("note =%s currentOctave=%s octaves=%s",n,this.currentOctave,e),this.repeatIndex++,this.repeatIndex>=this.arpRepeat&&(this.repeatIndex=0,this.index++),this.index>=this.notes.length&&(this.index=0,this.arpDirection===b.b?this.currentOctave=(this.currentOctave+1)%(e+1):this.arpDirection===b.a&&(this.currentOctave=(this.currentOctave-1)%(e+1),this.currentOctave<0&&(this.currentOctave=e)));var r=this.getStep(t.stepData,n,this.track.trackData.duration*this.arpDurationFactor);return new p.a(r,t.time,t.stepNumber)}}},{key:"getNextTriggers",value:function(e){var t=this,n=Object(d.a)(e,this.arpRate).map(function(e){var n=t.nextNote(t.arpOctaves);return void 0!==n&&(n.time=e.time),n}).filter(function(e){return void 0!==e});for(var r in void 0===window.timeB&&(window.timeB=0,window.timeBCount=0),this.noteToDuration)this.noteToDuration[r]-=1,this.noteToDuration[r]<=0&&(delete this.noteToDuration[r],this.removeNote(parseInt(r)));return 0===Object.keys(this.noteToDuration).length&&0===this.notes.length&&this.clear(),n}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}},{key:"getJson",value:function(){return Object(r.a)({},Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{arpRate:this.arpRate.getJson()})}},{key:"fromJson",value:function(e,t){var r=Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(h.a)(this.arpRateParameter,new m.a(16,!1).fromJson(e.arpRate),r),r}}]),n}(f.a);t.a=O},function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return c});var r=n(11),a=n(165);function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;if(!window.noReload)return e.previousArgs&&void 0!==e.lastMessageReceived?(e.args=e.previousArgs,void e.refresh()):void 0},c=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;if(!window.noReload)if(t.skipHotReload)t.hotReload&&t.hotReload();else{var s=t.zObject&&"subpatch"===t.zObject.name;if(!n.has(t)){var o=[];if(s){n.add(t);var c,u=i(t.outletObjects);try{for(u.s();!(c=u.n()).done;){var l=c.value;e(l,n)}}catch(b){u.e(b)}finally{u.f()}}else{if(t.isInlet){var f=t.subSequence,h="Input "+t.inletNumber;if(f.inlets[h]){var p=f.inlets[h].connections;o=[].concat(Object(r.a)(o),Object(r.a)(p.map(function(e){return e.sourceNode}))),p.length}}else for(var d in t.inlets){var v=t.inlets[d].connections,m=Object(r.a)(v.map(function(e){return e.sourceNode}));o=[].concat(Object(r.a)(o),Object(r.a)(m)),v.length}var y=t.getObjectType&&t.getObjectType();(n.size>0||0===Object.keys(t.inlets).length)&&(y===a.d?!t.lastSentMessage||t.isOutlet||t.isInlet||t.refresh():y===a.e?(t.lastMessageReceived||0===Object.keys(t.inlets).length)&&t.refresh():t.refresh&&t.refresh(),n.size>1)||(n.add(t),o.forEach(function(t){return e(t,n)}))}}}}},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(14),o=n(165),c=n(119),u=n(126),l=n(20),f=function(){function e(t,n){Object(a.a)(this,e),this.id=Object(l.uuid)(),this.track=n,this.sequencerEngine=n.sequencerEngine,this.store=this.sequencerEngine.store,this.name=t,this.parameters=[],this.enabledParameter=new s.a("enabled",this,function(e,t){return[]},{min:!1,max:!0,unit:"",defaultValue:!0}),this.registerParameter(this.enabledParameter),this.numberOfOutputs=1}return Object(i.a)(e,[{key:"getObjectType",value:function(){return o.a}},{key:"enabled",get:function(){return this.enabledParameter.get()},set:function(e){this.enabledParameter.set(e)}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"isEnabled",value:function(){return this.enabled}},{key:"getJson",value:function(){var e={name:this.name,enabled:this.enabled,id:this.id,x:this.x,y:this.y};for(var t in e=this.saveParameterToJson(e,"enabledParameter",this.enabledParameter),this.parameters){var n=this.parameters[t];e[n.name]=n.get();var r=n.name+"Parameter";e=this.saveParameterToJson(e,r,n)}return e}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];void 0===e.id||t||(this.id=e.id,this.track.sequencerEngine&&(this.track.sequencerEngine.idToObject[this.id]=this)),void 0!==e.x&&(this.x=e.x,this.y=e.y);var n={};for(var a in Object(c.a)(this.enabledParameter,e.enabled,n),n=Object(r.a)({},n,this.loadParameterFromJson(e,"enabledParameter",this.enabledParameter)),this.parameters){var i=this.parameters[a],s=e[i.name];void 0!==s&&null!==s&&Object(c.a)(i,s,n),n=Object(r.a)({},n,this.loadParameterFromJson(e,i.name+"Parameter",i,t))}return n}},{key:"registerContext",value:function(e){e=e.forEffect(this),this.parameters.forEach(function(t){return t.setContext(e)})}},{key:"registerMixSession",value:function(e){this.parameters.forEach(function(t){return t.setMixSession(e)})}},{key:"registerTrack",value:function(e){this.parameters.forEach(function(t){return t.setTrack(e)})}},{key:"registerParameter",value:function(e){void 0!==e&&(e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"saveParameterToJson",value:function(e,t,n){return Object(u.b)(e,t,n)}},{key:"loadParameterFromJson",value:function(e,t,n,r){return Object(u.a)(e,t,n,this.track.sequencerEngine,r)}},{key:"getEffectCopy",value:function(){return this.getCopy(this.track)}}]),e}();t.a=f},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(6),o=n(8),c=n(2),u=n(23);function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(s.a)(n,e);var t=l(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"subSequence",get:function(){if(this._subSequence)return this._subSequence;if(this.context){if(this.context.subSequence)return this.context.subSequence;var e=this.track||this.context.track||this.context.group;return e&&e.subSequence}},set:function(e){this._subSequence=e}},{key:"dispatch",value:function(e){(this.sequencerEngine||this.track.sequencerEngine).dispatch(e)}},{key:"state",get:function(){var e=this.sequencerEngine||this.track;return e&&e.state}},{key:"currentPattern",get:function(){return this.state&&this.subSequence&&this.subSequence.tracks&&this.subSequence.tracks[0]?this.subSequence.tracks[0].currentPattern:0}},{key:"patternLocks",get:function(){return this.state&&this.state.effects.effectPatternLocks[this.id]||{}}},{key:"locked",get:function(){return this.patternLocks[this.currentPattern]}},{key:"lock",set:function(e){console.log("setting lock for current pattern = ",this.currentPattern),console.log(this),this.lockPattern(this.currentPattern,e)}},{key:"lockPattern",value:function(e,t){var n=Object(r.a)({},this.patternLocks);n[e]=t,this.dispatch(Object(u.vb)(this.id,n))}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var r="DOWN",a="UP"},function(e,t,n){"use strict";var r=n(1),a=n(107),i=n(4),s=n(5),o=n(31),c=n(10),u=n(6),l=n(8),f=n(2),h=n(135),p=n(14),d=n(142),v=n(141);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var y=function(e){Object(u.a)(n,e);var t=m(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,"Parameterizer",e)).parameter=void 0,r.factorParameter=new p.a("factor",Object(o.a)(r),function(e,t){return t},{documentation:"Multiplies the current value of the parameter by this number",min:0,max:1,unit:"",defaultValue:1}),r.registerParameter(r.factorParameter),r.offsetParameter=new p.a("offset",Object(o.a)(r),function(e,t){return t},{documentation:"Adds the current value of the parameter with this number",min:-100,max:100,unit:"",defaultValue:0}),r.registerParameter(r.offsetParameter),r.probabilityParameter=new p.a("probability",Object(o.a)(r),function(e,t){return t},{documentation:"The probability that a parameter change will occur on a given trigger.",min:0,max:100,unit:"",defaultValue:100}),r.registerParameter(r.probabilityParameter),r.newInlet("offset",function(e){var t=Object(a.a)(e,1)[0];isNaN(t)||r.offsetParameter.set(t)}),r}return Object(s.a)(n,[{key:"documentation",get:function(){return["Alters the step parameters for triggers that pass through this effect. "]}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getVisualizedParameters",value:function(){return[this.offsetParameter]}},{key:"getText",value:function(){var e=Math.round(100*this.offsetParameter.get(!0))/100;return e>0&&(e="+"+e),this.parameter?this.parameter.name+" "+e:e}},{key:"getAvailableParameters",value:function(){return[this.track.trackData.durationParameter,this.track.trackData.chopParameter,this.track.trackData.velocityParameter,this.track.trackData.transposeParameter,this.track.trackData.paletteParameter,this.track.trackData.startParameter,this.track.trackData.attackParameter,this.track.trackData.releaseParameter,this.track.trackData.pitchAttackParameter,this.track.trackData.pitchDecayParameter,this.track.trackData.pitchSustainParameter,this.track.trackData.pitchReleaseParameter]}},{key:"factor",get:function(){return this.factorParameter.get()},set:function(e){this.factorParameter.set(e)}},{key:"offset",get:function(){return this.offsetParameter.get()},set:function(e){this.offsetParameter.set(e)}},{key:"probability",get:function(){return this.probabilityParameter.get()},set:function(e){this.probabilityParameter.set(e)}},{key:"output",value:function(){var e=this;if(void 0===this.parameter)return this.triggers;var t=[],n=function(n){var r=e.triggers[n],a=e.getStep(r.stepData,void 0,void 0,!0),i=a.parameters.filter(function(t){return t.name===e.parameter.name});if(i.length>0){var s=i[0].get();if(null===s)s=e.track.trackData.parameters.find(function(e){return e.name===i[0].name}).get();Math.random()<e.probability/100&&i[0].set(s*e.factor+e.offset)}r=new d.a(a,r.time,r.stepNumber),t.push(r)};for(var r in this.triggers)n(r);return t}},{key:"getJson",value:function(){return Object(r.a)({},Object(c.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{parameter:void 0===this.parameter?void 0:this.parameter.name})}},{key:"fromJson",value:function(e,t){var r=Object(c.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),a=this.getAvailableParameters();if(void 0!==e.parameter)return this.parameter=a.filter(function(t){return t.name===e.parameter})[0],r}}]),n}(Object(v.a)(h.a));t.a=y},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),s=n(6),o=n(8),c=n(2),u=n(135),l=n(14),f=n(7),h=n.n(f);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var d=function(e){Object(s.a)(n,e);var t=p(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Timing",e)).oddOffsetParameter=new l.a("oddTiming",Object(i.a)(a),function(e,t){return t},{documentation:"The delay amount (in 1/32th notes) for even-triggers (according to the resolution)",min:0,max:4,unit:"1/32th",defaultValue:0}),a.registerParameter(a.oddOffsetParameter),a.evenOffsetParameter=new l.a("evenTiming",Object(i.a)(a),function(e,t){return t},{documentation:"The delay amount (in 1/32th notes) for odd-triggers (according to the resolution)",min:0,max:4,unit:"1/32th",defaultValue:0}),a.registerParameter(a.evenOffsetParameter),a.probabilityParameter=new l.a("probability",Object(i.a)(a),function(e,t){return t},{documentation:"The probability that this effect will occur on a given trigger.",min:0,max:100,unit:"",defaultValue:100}),a.registerParameter(a.probabilityParameter),a.resolutionParameter=new l.a("resolution",Object(i.a)(a),function(e,t){return t},{min:1,max:32,unit:"",defaultValue:2}),a.registerParameter(a.resolutionParameter),a}return Object(a.a)(n,[{key:"getVisualizedParameters",value:function(){return[this.oddOffsetParameter,this.evenOffsetParameter]}},{key:"getText",value:function(){return this.resolution.toString()+" "+this.evenOffset+", "+this.oddOffset}},{key:"documentation",get:function(){return"Controls the swing of a track by dividing triggers by a resolution and delaying them seperately"}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"needsStableLookAhead",value:function(){return!0}},{key:"oddOffset",get:function(){return this.oddOffsetParameter.get()},set:function(e){this.oddOffsetParameter.set(e)}},{key:"evenOffset",get:function(){return this.evenOffsetParameter.get()},set:function(e){this.evenOffsetParameter.set(e)}},{key:"probability",get:function(){return this.probabilityParameter.get()},set:function(e){this.probabilityParameter.set(e)}},{key:"resolution",get:function(){return this.resolutionParameter.get()},set:function(e){return this.resolutionParameter.set(e)}},{key:"output",value:function(){for(var e in this.triggers){var t=this.triggers[e],n=t.time;if(Math.random()<=this.probability/100){var r=Math.floor(t.stepNumber/this.resolution)%2==0?this.evenOffset:this.oddOffset;t.time=n+r*new h.a.Time("32n").toMilliseconds()/1e3}}return this.triggers}}]),n}(u.a);t.a=d},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i});var r=1,a=2,i=3},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),s=n(31),o=n(10),c=n(6),u=n(8),l=n(2),f=n(135),h=(n(33),n(142)),p=(n(234),n(14)),d=(n(21),n(422),n(7));function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var m=new(n.n(d).a.Time)("32n"),y=function(e){Object(c.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Chord Rhythm",e)).durationFactorParameter=new p.a("durationFactor",Object(s.a)(r),function(e,t){return[]},{defaultValue:1,min:0,max:2,unit:""}),r.registerParameter(r.durationFactorParameter),r.oddDelayTimeParameter=new p.a("oddDelayTime",Object(s.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:16,unit:""}),r.registerParameter(r.oddDelayTimeParameter),r.evenDelayTimeParameter=new p.a("evenDelayTime",Object(s.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:16,unit:""}),r.registerParameter(r.evenDelayTimeParameter),r.delayTimeFactorParameter=new p.a("delayTimeFactor",Object(s.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:4,unit:""}),r.registerParameter(r.delayTimeFactorParameter),r.evenVelocityParameter=new p.a("evenVelocity",Object(s.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:1,unit:""}),r.registerParameter(r.evenVelocityParameter),r.oddVelocityParameter=new p.a("oddVelocity",Object(s.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:1,unit:""}),r.registerParameter(r.oddVelocityParameter),r.repeatsParameter=new p.a("repeats",Object(s.a)(r),function(e,t){return[]},{defaultValue:1,min:1,max:8,unit:""}),r.registerParameter(r.repeatsParameter),r.syncedParameter=new p.a("synced",Object(s.a)(r),function(e,t){return[]},{defaultValue:!0,min:!1,max:!0,unit:""}),r.registerParameter(r.syncedParameter),r.velocitySpreadParameter=new p.a("velocitySpread",Object(s.a)(r),function(e,t){return[]},{defaultValue:50,min:0,max:100,unit:""}),r.registerParameter(r.velocitySpreadParameter),r.velocityParameter=new p.a("velocity",Object(s.a)(r),function(e,t){return[]},{defaultValue:1,min:0,max:1,unit:""}),r.registerParameter(r.velocityParameter),r.delays=[],r.liveTriggers=[],r}return Object(i.a)(n,[{key:"onNewStep",value:function(){this.triggers=[]}},{key:"removeNote",value:function(e,t){arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.gated;this.delays=this.delays.filter(function(t){return t.trigger.stepData.transpose!==e})}},{key:"input",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.liveTriggers.push(e):Object(o.a)(Object(l.a)(n.prototype),"input",this).call(this,e)}},{key:"clear",value:function(){this.triggers=[],this.delays=[]}},{key:"oddDelayTime",get:function(){return this.oddDelayTimeParameter.get()}},{key:"synced",get:function(){return this.syncedParameter.get()}},{key:"repeats",get:function(){return this.repeatsParameter.get()}},{key:"evenDelayTime",get:function(){return this.evenDelayTimeParameter.get()}},{key:"durationFactor",get:function(){return this.durationFactorParameter.get()}},{key:"delayTimeFactor",get:function(){return this.delayTimeFactorParameter.get()}},{key:"velocitySpread",get:function(){return this.velocitySpreadParameter.get()/100}},{key:"oddVelocity",get:function(){return Math.max(0,Math.sqrt(this.velocitySpread)-.2)}},{key:"velocity",get:function(){return this.velocityParameter.get()}},{key:"evenVelocity",get:function(){var e=1-this.velocitySpread;return Math.max(0,Math.sqrt(e)-.2)}},{key:"getDelayTrigger",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=(e.time-t)/m;return r=n?0:r,{stepNumber:e.stepNumber,stepOffset:r,trigger:this.copyTrigger(e),duration:n?void 0:e.stepData.duration,repeats:1,elapsed:0,even:!0}}},{key:"copyTrigger",value:function(e){var t=this.getStep(e.stepData,void 0,void 0,!1);return new h.a(t,e.time,e.stepNumber,e.outputNumber)}},{key:"output",value:function(e,t,n){var a=this;for(var i in this.triggers){var s=this.triggers[i];this.delays.push(this.getDelayTrigger(s,e))}for(var o in this.liveTriggers){var c=this.liveTriggers[o];c.stepNumber=t,this.delays.push(this.getDelayTrigger(c,e,!0))}var u=[],l=void 0,f=void 0,h=function(n){var i=a.delays[n],s=i.repeats/a.repeats%2==0,o=s?a.evenDelayTime:a.oddDelayTime;o*=a.delayTimeFactor;var c=s?a.evenVelocity:a.oddVelocity;if(c*=a.velocity,0===i.elapsed||a.shouldPlayDelay(i,t,i.isEven?a.evenDelayTime:a.oddDelayTime)){var h=a.getTimesToPlay(i,e,o),p=h.map(function(e){return a.getTriggerToPlay(i.trigger,e.timeToPlay,t,c,o)});u=[].concat(Object(r.a)(u),Object(r.a)(p)),l=t,f=h[h.length-1].offset,i.isEven=s,i.stepNumber=t,i.stepOffset=f,i.repeats++}i.elapsed++};for(var p in this.delays)h(p);return this.synced&&void 0!==l&&this.delays.forEach(function(e){e.stepNumber=l,e.stepOffset=f}),this.delays=this.delays.filter(function(e){return void 0===e.duration||e.elapsed<2*e.duration}),this.liveTriggers=[],u}},{key:"getTriggerToPlay",value:function(e,t,n,r,a){var i=this.copyTrigger(e);return i.time=t,i.stepData.duration=this.durationFactor*(a/2),i.stepNumber=n,i.stepData.velocity*=r,i}},{key:"shouldPlayDelay",value:function(e,t,n){var r=t,a=t+1,i=((e.stepNumber+e.stepOffset)%this.patternLength+n)%this.patternLength;return r<=i&&i<a}},{key:"getTimesToPlay",value:function(e,t,n){for(var r=((e.stepNumber+e.stepOffset)%this.patternLength+n)%this.patternLength,a=r-Math.floor(r),i=[];a<1;a+=n)i.push({timeToPlay:t+a*m,offset:a});return i}},{key:"patternLength",get:function(){return this.track.length}},{key:"isRealTime",value:function(){return!1}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(f.a);t.a=y},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2),u=n(135),l=n(592);n(428);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(s.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Midi Interface",e)).ccParameters=[],a.midiOutput=void 0,a}return Object(a.a)(n,[{key:"setConfig",value:function(e,t){if(this.midiOutput=e,this.midiCC=this.track.sequencerEngine.midi.deviceToMidiCC[e.name],this.midiDeviceName=e.name,void 0!==this.midiCC)for(var n in t){var r=t[n],a={};for(var i in r){var s=r[i];for(var o in a[i]={},s){var c=s[o],u=new l.a(o,c,this.midiCC);this.registerParameter(u),a[i][o]=u}}this.ccParameters.push(a)}}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"output",value:function(e,t,n){return this.triggers}},{key:"getJson",value:function(){var e=Object(i.a)(Object(c.a)(n.prototype),"getJson",this).call(this);e.midiOutput=this.midiOutput.name;var t=[];for(var r in this.ccParameters){var a=this.ccParameters[r],s={};for(var o in a){var u=a[o],l={};for(var f in u){var h=u[f];l[h.name]=h.getJson()}s[o]=l}t.push(s)}return e.config=t,e}},{key:"fromJson",value:function(e,t){Object(i.a)(Object(c.a)(n.prototype),"fromJson",this).call(this,e,t);var r=this.track.sequencerEngine.midi;if(void 0!==r){var a=r.controllerOutputs.filter(function(t){return t.name===e.midiOutput})[0];if(void 0!==a){for(var s in this.midiOutput=a,this.track.addMidiOutput(a,!0),this.midiCC=this.track.sequencerEngine.midi.deviceToMidiCC[a.name],e.config){var o=e.config[s];for(var u in o){var f=o[u];for(var h in f){var p=f[h],d=new l.a(h,p.ccNumber,this.midiCC);d.fromJson(p,this.track.sequencerEngine),this.registerParameter(d),f[h]=d}}}this.ccParameters=e.config}}}}]),n}(u.a);t.a=h},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r={"MIDI Mix":{note:{0:{PATTERN_SWITCH:1,SEQUENCE_ROLL:3,PREVIOUS_PATTERN:25,NEXT_PATTERN:26},1:{PATTERN_SWITCH:4,SEQUENCE_ROLL:6},2:{PATTERN_SWITCH:7,SEQUENCE_ROLL:9},3:{PATTERN_SWITCH:10,SEQUENCE_ROLL:12},4:{PATTERN_SWITCH:13,SEQUENCE_ROLL:15},5:{PATTERN_SWITCH:16,SEQUENCE_ROLL:18},6:{PATTERN_SWITCH:19,SEQUENCE_ROLL:21},7:{PATTERN_SWITCH:22,SEQUENCE_ROLL:24}},cc:{0:{KNOB_1:16,KNOB_2:17,KNOB_3:18,VOLUME:19},1:{KNOB_1:20,KNOB_2:21,KNOB_3:22,VOLUME:23},2:{KNOB_1:24,KNOB_2:25,KNOB_3:26,VOLUME:27},3:{KNOB_1:28,KNOB_2:29,KNOB_3:30,VOLUME:31},4:{KNOB_1:46,KNOB_2:47,KNOB_3:48,VOLUME:49},5:{KNOB_1:50,KNOB_2:51,KNOB_3:52,VOLUME:53},6:{KNOB_1:54,KNOB_2:55,KNOB_3:56,VOLUME:57},7:{KNOB_1:58,KNOB_2:59,KNOB_3:60,VOLUME:61},MASTER:62}},"Komplete Kontrol M DAW":{actions:{PLAY:94,RECORD:95,CLEAR:93},ccActions:{CHANGE_SELECTED_TRACK:15,BROWSE_SOUNDS:19,CHANGE_START_SLICE:19,CHANGE_END_SLICE:20,CHANGE_TRANSPOSE:18,CHANGE_VOLUME:14}},"KOMPLETE KONTROL M32":{ccActions:{CHANGE_SELECTED_TRACK:19,BROWSE_SOUNDS:15,CHANGE_START_SLICE:17,CHANGE_END_SLICE:18,CHANGE_TRANSPOSE:16,CHANGE_VOLUME:14}},"MPD218 Port A":{ccActions:{CHANGE_SELECTED_TRACK:3,BROWSE_SOUNDS:9,CHANGE_START_SLICE:12,CHANGE_END_SLICE:13,CHANGE_TRANSPOSE:15,CHANGE_VOLUME:14}}}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),s=n(6),o=n(8),c=n(2),u=n(135),l=n(142),f=n(14),h=n(7),p=n.n(h);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var v=function(e){Object(s.a)(n,e);var t=d(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Harmony",e)).pitchParameter=new f.a("pitch",Object(i.a)(a),function(e,t){return t},{min:-32,documentation:"Gets added to the transpose of the trigger to be harmonized with",max:32,unit:"",defaultValue:5}),a.registerParameter(a.pitchParameter),a.timingOffsetParameter=new f.a("timingOffset",Object(i.a)(a),function(e,t){return t},{min:0,documentation:"The harmonizing trigger gets delayed by this amount of time (measured in 1/32th notes)",max:4,unit:"",defaultValue:0}),a.registerParameter(a.timingOffsetParameter),a.velocityParameter=new f.a("velocity",Object(i.a)(a),function(e,t){return t},{min:0,documentation:"The velocity of the harmonizing trigger",max:1,unit:"",defaultValue:1}),a.registerParameter(a.velocityParameter),a.probabilityParameter=new f.a("probability",Object(i.a)(a),function(e,t){return t},{min:0,documentation:"The probability that a harmonizing trigger will be created. This gets calculated for every trigger.",max:100,unit:"",defaultValue:100}),a.registerParameter(a.probabilityParameter),a}return Object(a.a)(n,[{key:"getVisualizedParameters",value:function(){return[this.pitchParameter]}},{key:"getText",value:function(){var e=Math.round(100*this.pitch)/100;return e>=0?"+"+e:e}},{key:"documentation",get:function(){return"Harmonizes by adding an additional trigger offsetted by pitch, for every trigger."}},{key:"pitch",get:function(){return this.pitchParameter.get()}},{key:"velocity",get:function(){return this.velocityParameter.get()}},{key:"timingOffset",get:function(){return this.timingOffsetParameter.get()}},{key:"probability",get:function(){return this.probabilityParameter.get()}},{key:"output",value:function(){var e=[];for(var t in this.triggers){var n=this.triggers[t];if(e.push(n),this.probability/100>=Math.random()){var r=n.stepData.getCopy(!0,!1,!0,!0,!1);r.transpose+=this.pitch,r.velocity=this.velocity;var a=n.time+this.timingOffset*new p.a.Time("32n").toMilliseconds()/1e3;e.push(new l.a(r,a,n.stepNumber))}}return e}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(u.a);t.a=v},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),s=n(6),o=n(8),c=n(2),u=n(123),l=n(23),f=n(14);function h(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(s.a)(n,e);var t=d(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).parameterVariables=[],e.checkboxVariables=[],e.trackVariables=[],e.variables=[],e}return Object(i.a)(n,[{key:"var",value:function(e){var t=this;return this.scriptEffect?this.scriptEffect.var(e):function(){var n=t[e+"Parameter"];return n?n.get():0}}},{key:"newParamVar",value:function(e){var t=new f.a(e,this,function(e,t){return t},{min:0,max:16,unit:"",defaultValue:""});this[e+"Parameter"]=t,this.registerParameter(t),this.parameterVariables.push(t)}},{key:"newTrackVar",value:function(e){var t=new f.a(e,this,function(e,t){return t},{min:0,max:16,unit:"",defaultValue:0});this[e+"Parameter"]=t,this.registerParameter(t),this.trackVariables.push(t)}},{key:"newCheckboxVar",value:function(e,t){var n=new f.a(e,this,function(e,t){return t},{min:0,max:1,unit:"",defaultValue:t});this[e+"Parameter"]=n,this.registerParameter(n),this.checkboxVariables.push(n)}},{key:"newVar",value:function(e,t,n,r,a,i,s){if(this.scriptEffect)return this.scriptEffect.newVar(e,t,n,r,a,i);if(this[e+"Parameter"])return this.variables=this.variables.filter(function(t){return t.name!==e}),this.variables.push(this[e+"Parameter"]),this[e+"Parameter"];if(this.oldVariables){var o=this.oldVariables.find(function(t){return t.name===e});if(o)return this.variables=this.variables.filter(function(t){return t.name!==e}),this.variables.push(o),this[e+"Parameter"]=o,this.registerParameter(o),o}var c=new f.a(e,this,function(e,t){return t},{min:n,max:r,unit:"",defaultValue:t,documentation:a,hide:i,onChange:s});return this[e+"Parameter"]=c,this.registerParameter(c),void 0===this.context&&(this.context=(new u.a).forMidiEffect(this).forTrack(this.track)),c.setContext(this.context),this.variables.push(c),this.track.sequencerEngine.dispatch(Object(l.tb)(c.i,t)),c}},{key:"updateVariablesRedux",value:function(){var e=this.track&&this.track.sequencerEngine||this.sequencerEngine;e&&e.dispatch(Object(l.id)(this.id,Object(r.a)(this.variables)))}},{key:"clearVariables",value:function(){var e=this,t={};if(this.scriptEffect)return t;var n,a=h(this.variables);try{var i=function(){var r=n.value;t[r.name]=r,delete e[r.name+"Parameter"],e.parameters=e.parameters.filter(function(e){return e.name!==r.name})};for(a.s();!(n=a.n()).done;)i()}catch(s){a.e(s)}finally{a.f()}return this.oldVariables=[].concat(Object(r.a)(this.oldVariables||[]),Object(r.a)(this.variables)),this.variables=[],t}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"c",function(){return u}),n.d(t,"a",function(){return h}),n.d(t,"b",function(){return p});var r=n(11),a=n(1),i=n(147),s=function e(t,n,r){for(var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=r/function(e){e.cycleLength;for(var t=0,n=0;n<e.length;n++){var r=e[n];Array.isArray(r)&&void 0!==r.cycleLength?t+=r.cycleLength:t++}return t}(t),l=0,f=[];l<t.length;l++){var h=u*(t[l].cycleLength||1);if(null!==t[l]&&Array.isArray(t[l]))n>=Math.floor(s)&&n<s+h&&e(t[l],n,h,s,o).forEach(function(e){return f.push(e)});else if(t[l]&&t[l].cycle){if(n>=s&&n<s+h){var p=!0;if("/"===t[l].operator&&(p=o%t[l].operand===0),p){var d="^"===t[l].operator?t[l].operand:0;e(t[l].cycle,n,h,s,o,d).forEach(function(e){return f.push(e)})}}}else if(n==Math.floor(s)){var v=!0;"/"===t[l].operator&&(v=o%t[l].operand===0),v&&f.push(Object(a.a)({},t[l],{outputNumber:t[l].operator===i.a?t[l].operand:c,offset:s-Math.floor(s),duration:h/2,cycle:t[l].id,leaf:t[l]}))}t[l].cycleLength;s+=h}return f},o=function(e){return e.stepNumber},c=function(e){return e.length},u=function(e){return s(l(e.cycle),o(e)%c(e),c(e),0,Math.floor(o(e)/c(e)))},l=function e(t){for(var n=[],a=t.cycleLength,i=0;i<t.length;i++)Array.isArray(t[i])?n.push(e(t[i])):n=[].concat(Object(r.a)(n),Object(r.a)(f(t[i])));return n.cycleLength=a,n},f=function(e){var t=void 0,n=e.operator,r=e.operand,i=(e.transpose,e.cycle);if(t=i?l(i):e,"*"===n){for(var s=[],o=0;o<r;o++)s.push(t);return s}if("^"===n){for(var c=[],u=0;u<r;u++)c.push(Object(a.a)({},t,{factor:(u+1)/(r+1)}));return c}return[e]},h=function(e,t,n){for(var r=e.flat(16),a=0;a<r.length;a++){if(r[a].id===t.id)return a}return-1},p=function(e,t,n){for(var r=e.flat(16),a=-1,i=-1,s=-1,o=0;o<r.length;o++){var c=r[o];if(-1===s&&null!==t.transpose&&(s=o),c.id!==t.id){if(null!==c.transpose&&-1!==a){i=o;break}}else a=o}return-1===i?s+r.length-a:(i-a)*(n/e.length/2)}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(111),a=n(314),i=n(206),s=function(e){var t=Object(i.a)(e);return function(){if(!(arguments.length<=0?void 0:arguments[0]))return Object(r.w)(!1);var e=t.apply(void 0,arguments);return Object(r.P)(Object(a.a)(e,Object(r.P)()))}}},function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"b",function(){return u}),n.d(t,"c",function(){return l}),n.d(t,"d",function(){return f});var r=n(1),a=n(111),i=(n(176),n(147),n(191)),s=n(248),o=n(207),c=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=a.A.apply(void 0,[e].concat(n)),s=(Math.round(i)>>>0).toString(2).split("").map(function(e){return parseInt(e)}),o=0,c=function(){return s[o++%s.length]};return{decide:c,decideNum:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e;n>t;n--)if(c())return n;return t},decideUnique:function(e,t){t=Math.min(e,t);for(var n=new Array(t).fill(0).map(function(e,t){return t}),r=[];r.length<e;)for(var a=0;a<n.length;a++)if(c()){r.push(n[a]),n.splice(a,1);break}return r}}}},u=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,u=arguments.length,l=new Array(u>4?u-4:0),f=4;f<u;f++)l[f-4]=arguments[f];var h=void 0,p=void 0,d=void 0;return function(){for(var u=arguments.length,f=new Array(u),v=0;v<u;v++)f[v]=arguments[v];var m=a.A.apply(void 0,[e].concat(f)),y=a.A.apply(void 0,[t].concat(f)),b=a.A.apply(void 0,[r].concat(f)),g=a.A.apply(void 0,[n].concat(f)),O=l.map(function(e){return a.A.apply(void 0,[e||2].concat(f))});if(m===h&&p===y)return d;h=m,p=y;var k=c(y).apply(void 0,f),j=k.decideNum,w=k.decide,x=12;return d=Object(o.m)(e,function(e,t){return function(e,t){var n=[e];w()?n=[Object(i.f)("~")()[0]]:w()&&(e.accent=!0);for(var r=b*j(O[t%O.length]||2,1),a=1;a<r;a++)n.push(Object(i.f)("~")()[0]);var o=j(r-1,1);x=w()?g:0;var c=w()?new String(x):new String(x)+"'";return n[o]=Object(i.f)(c)()[0],Object(s.e)(n)()}(e,t)}).apply(void 0,f)}},l=function(e,t){var n=void 0,r=void 0,s=void 0;return function(){for(var c=arguments.length,u=new Array(c),l=0;l<c;l++)u[l]=arguments[l];var f=a.A.apply(void 0,[e].concat(u)),p=a.A.apply(void 0,[t].concat(u));if(f===n&&r===p)return s||[];if(n=f,r=p,100===p)return f||[];p=100-p;for(var d=f.flat(10).filter(function(e){return null!==e.transpose}).length,v=d*p/100,m=0,y=0;m<=v&&y<=d;)f=Object(o.v)(f,h(d-m,y),function(e,t,n){return m++,Object(i.f)("~")()[0]},void 0,!0).apply(void 0,u),y++;return s=f[0]}},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=void 0,s=void 0,u=void 0;return function(){for(var l=arguments.length,f=new Array(l),h=0;h<l;h++)f[h]=arguments[h];var p=a.A.apply(void 0,[e].concat(f)),d=a.A.apply(void 0,[t].concat(f));if(s===d&&p===n)return u;s=d,n=p;var v=c(t).apply(void 0,f),m=v.decide,y=v.decideNum,b=v.decideUnique,g=function(e,t){if(m()&&m())return function(e){var t=y(4),n=b(t,4),a=0,s=0;return n.forEach(function(t){t%=e.length;var n=e[t];if(!Array.isArray(n)){var o=Object(r.a)({},n);!m()&&a++<1?null===o.transpose&&m()&&s++<1?o=Object(i.f)("0'")():o.accent=!0:null===o.transpose&&m()&&s++<1?o=Object(i.f)("0.")():o.staccato=!0,e[t]=o}}),e}(Object(o.t)(e,[null,Object(i.f)("0.")]));Array.isArray(e)||(e=Object(r.a)({},e));var n=e;n=Array.isArray(e)?[e[y(e.length-1)]]:[e];var a=Object(i.f)("~").apply(void 0,f)[0];null===e.transpose&&(e.transpose=0);var s=Array.isArray(e)?e[0]:e;if(m())n=[a,s];else{n=[a,s,s,s];var c=[m(),m()&&m(),m(),m()&&m()],u=c[0],l=c[1],h=c[2],p=c[3];u&&(n[0]=s),l&&(n[1]=a),l&&(n[2]=a),h&&(n[3]=a),u||l||h||p||(n[y(3)]=s);var d=y(4),v=b(d,4),g=0,O=0;v.forEach(function(e){var t=n[e];if(!Array.isArray(t)){var a=Object(r.a)({},t);!m()&&g++<1?null===a.transpose&&m()&&O++<1?a=Object(i.f)("0'")():a.accent=!0:null===a.transpose&&m()&&O++<1?a=Object(i.f)("0.")():a.staccato=!0,n[e]=a}})}return n};return u=Object(o.m)(e,function(e,t){return g(e)}).apply(void 0,f)}},h=function(e,t){var n=Math.ceil(e/2);e%2===0&&n++;var r=(t+1)%n;return t%2===0?r:(n+r)%e}},function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"c",function(){return u}),n.d(t,"d",function(){return l}),n.d(t,"b",function(){return f});var r=n(11),a=n(111),i=(n(207),n(191));function s(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=function(){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Object(a.w)(!t[0]||t[0].isNewCycle)}},u=function(e,t,n){var r=0;return function(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];var o=a.A.apply(void 0,[e].concat(i));return i[0]&&i[0].isNewCycle&&++r%o===0?a.A.apply(void 0,[t].concat(i)):Object(a.w)(!0)}},l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return function(){for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];var u,l=a.A.apply(void 0,[e].concat(o)),f=(a.A.apply(void 0,[t].concat(o)),a.A.apply(void 0,[n].concat(o)),[]),h=[],p=void 0,d=s(l);try{for(d.s();!(u=d.n()).done;){var v=u.value;p&&v.figureId!==p.figureId&&(f.push(h),h=[]),h.push(v),p=v}}catch(b){d.e(b)}finally{d.f()}f.push(h);var m=f.length,y=f[m-n];return f[m-n]=f[m-t],f[m-t]=y,f.reduce(function(e,t){return[].concat(Object(r.a)(e),Object(r.a)(t))},[])}},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||function(e){return function(){return e}};return{pattern:function(){return n(e())()},player:Object(a.J)(Object(i.b)(function(){return n(e())()},r),u(t,function(){return e=l(e),Object(a.w)(!0)}))}}},function(e,t,n){"use strict";n.d(t,"e",function(){return h}),n.d(t,"f",function(){return p}),n.d(t,"a",function(){return d}),n.d(t,"c",function(){return v}),n.d(t,"d",function(){return m}),n.d(t,"b",function(){return y});var r=n(11),a=n(1),i=n(111),s=(n(171),n(313)),o=(n(248),n(436),n(157)),c=n(207),u=n(615);function l(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}window.scaleLazies=0,window.scaleNoLazies=0;var h=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return function(){for(var s=Object(i.A)(r),o=Object(i.A)(a),c=arguments.length,u=new Array(c),f=0;f<c;f++)u[f]=arguments[f];var h=i.A.apply(void 0,[e].concat(u));if(h===n)return t;n=h;var p,d=0,v=[d],m=l(h.flat(16));try{for(m.s();!(p=m.n()).done;){var y=p.value;if(v.length>=7)break;if(y.type){var b=y.type,g=b.type,O=b.value;if("-"===g&&0===O)d+=o;else{if("."!==g)continue;d+=s}v.push(d)}}}catch(k){m.e(k)}finally{m.f()}return t=v}},p=function(e,t,n){var r,s,l,f;return function(){for(var h=arguments.length,p=new Array(h),d=0;d<h;d++)p[d]=arguments[d];var v=i.A.apply(void 0,[e].concat(p)),m=i.A.apply(void 0,[t].concat(p)),y=i.A.apply(void 0,[n].concat(p));if(v===f&&m===s&&l===y)return window.scaleLazies++,r;window.scaleNoLazies++,l=y,s=m,f=v;for(var b=v.flat(16).length,g=0,O=function(e){v=Object(c.v)(v,e,function(t){if(null!==(t=Object(a.a)({},t)).transpose){if(y&&y[e]){var n=y[e],r=n.type,i=n.value;switch(r){case u.d:g=Object(o.a)(g-i,m.length);break;case u.a:g=Object(o.a)(g+i,m.length);break;case u.c:g=0}}t.transpose=m[g%m.length],y&&y[e]&&y[e].type===u.b||g++}return t},!0).apply(void 0,p)},k=0;k<b;k++)O(k);return r=v}},d=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return function(){for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];var o,c=i.A.apply(void 0,[e].concat(a)),u=i.A.apply(void 0,[t].concat(a)),f=i.A.apply(void 0,[n].concat(a)),h=[],p=0,d=void 0,v=l(u);try{for(v.s();!(o=v.n()).done;){var m=o.value;m=i.A.apply(void 0,[m].concat(a)),m--;var y=f[p%f.length];void 0!==y?y*=12:y=0,(m>c.length||void 0!==d&&d>c[m])&&(y+=12,m%=c.length);var b=c[m]+y;d=b,h.push(b),p++}}catch(g){v.e(g)}finally{v.f()}return h}},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(){for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];for(var c=Object(r.a)(i.A.apply(void 0,[e].concat(s))),u=[],l=0;l<t;l++)u.push(c.shift()+12);return[].concat(Object(r.a)(c.map(function(e){return e+12*n})),u)}},m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var s=i.A.apply(void 0,[e].concat(r)),o=i.A.apply(void 0,[t].concat(r)),c=0;return o>=s.length&&(c=12,o%=s.length),s[o]+c}},y=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(){for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];var u,f=o[0],h=i.A.apply(void 0,[e].concat(o)),p=i.A.apply(void 0,[n].concat(o)),d=[],v=l(i.A.apply(void 0,[t].concat(o)));try{for(v.s();!(u=v.n()).done;){var m=u.value,y=i.A.apply(void 0,[m].concat(o)),b=y.thick,g=y.flat,O=y.time,k=y.voice,j=y.octave,w=k-1,x=j;void 0!==x?x*=12:x=0,w>=h.length&&(x+=12);var S=h[w%h.length]+x+p;if(g&&(S-=g),S,d.push({note:S,time:O}),void 0!==b)for(var P=1;P<=b;P++)d.push({note:S-12*P,time:O});0}}catch(E){v.e(E)}finally{v.f()}return i.D.apply(void 0,Object(r.a)(d.map(function(e){var t=e.note,n=e.time;return Object(s.a)(f,t,f.duration,n)})))}}},function(e,t,n){"use strict";n.d(t,"b",function(){return l}),n.d(t,"a",function(){return f}),n.d(t,"c",function(){return h});var r=n(111),a=n(151),i=n(7),s=n.n(i),o=n(142);n(313);function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(a.a)("harmonize",{"...harmonies":"Transposes to harmonize"},"Harmonizes with the given transposees");var l=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];var i=t.flat().map(function(e){return r.A.apply(void 0,[e].concat(n))}).flat(),s=n[0],u=n[1],l=n[2],f=n[3];if(!s)return Object(r.w)(!1);var h,p=[],d=new o.a(s,l,u),v=c(i);try{for(v.s();!(h=v.n()).done;){var m=h.value,y=f.copyTrigger(d,!0).stepData;y.transpose+=m,p.push({stepData:y,stepNumber:u,time:l})}}catch(b){v.e(b)}finally{v.f()}return Object(r.Q)([{stepData:s,time:l,stepNumber:u}].concat(p))}},f=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];var i=t.flat().map(function(e){return r.A.apply(void 0,[e].concat(n))}).flat(),s=n[0],u=n[1],l=n[2],f=n[3];if(!s)return Object(r.w)(!1);var h,p=[],d=new o.a(s,l,u),v=c(i);try{for(v.s();!(h=v.n()).done;){var m=h.value,y=f.copyTrigger(d,!0).stepData;y.transpose=m,p.push({stepData:y,stepNumber:u,time:l})}}catch(b){v.e(b)}finally{v.f()}return Object(r.Q)(p)}};Object(a.a)("strum",{spread:"Number from 1-10"},"Spreads out triggers on same step, so they strum");var h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=void 0,n=0,a=void 0;return function(){for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];var u=o[0],l=o[1],f=o[2];if(!f&&!a)return a=s.a.Master.context.currentTime+.05,n=1,t=l,Object(r.w)(!0);if(!u||t!==l)return n=1,t=l,a=void 0,Object(r.w)(!0);!f&&a&&(f=a),t=l;var h=r.A.apply(void 0,[e].concat(o)),p={stepData:u,stepNumber:l,time:f+n*h*.01};return n++,Object(r.Q)(p)}}},function(e,t,n){"use strict";n.d(t,"b",function(){return f}),n.d(t,"d",function(){return h}),n.d(t,"c",function(){return p}),n.d(t,"a",function(){return d});var r=n(133),a=n(278),i=n(151),s=n(111),o=n(191),c=n(207);function u(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(i.a)("triggerAttack",{trackNumber:"",transpose:"",velocity:""},"Triggers an attack (note on) for a given tracks instrument");var f=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return function(){for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];var c=i[0],u=(i[1],i[2]),l=i[3].track.subSequence.name.toLowerCase(),f=s.A.apply(void 0,[e].concat(i)),h=s.A.apply(void 0,[n].concat(i)),p=f+l+".triggerAttack";if(c){var d=void 0;d=void 0===t?c.transpose:s.A.apply(void 0,[t].concat(i)),Object(r.b)(p,{trackNumber:e,time:u,transpose:d,velocity:h})}return Object(s.w)(!0)}};Object(i.a)("triggerRelease",{trackNumber:"",transpose:""},"Triggers a release (note off) for a given tracks instrument");var h=function(e,t){return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var o=a[0],c=(a[1],a[2]),u=a[3].track.subSequence.name.toLowerCase(),l=e+u+".triggerRelease";if(o){var f=0;void 0===t&&(f=o.transpose),Object(r.b)(l,{trackNumber:e,time:c,transpose:f})}return Object(s.w)(!0)}};Object(i.a)("triggerAttackRelease",{trackNumber:""},"Triggers an attack release for a differennt track");var p=function(e){return function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];var i=n[0],o=n[1],c=n[2],l=n[3],f=l.track.subSequence.name.toLowerCase(),h=s.A.apply(void 0,[e].concat(n));if(Array.isArray(h)){var p,d=u(h);try{for(d.s();!(p=d.n()).done;){var v=p.value,m=v+f+".triggerAttackRelease";i&&l.track.trackNumber+1!==v&&Object(r.b)(m,{trackNumber:e,time:c,stepData:i,stepNumber:o})}}catch(b){d.e(b)}finally{d.f()}}else{var y=h+f+".triggerAttackRelease";i&&h!==l.track.trackNumber+1&&Object(r.b)(y,{trackNumber:e,time:c,stepData:i,stepNumber:o})}return Object(s.w)(!0)}},d=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return Object(o.e)(e,Object(c.l)(e),6,!1)},i=arguments.length>3?arguments[3]:void 0;return Object(s.J)(r(e),Object(s.q)(Object(a.b)(function(e,t,n,r){return r.track.trackNumber+1},t),Object(s.w)(!0),Object(s.J)(Object(s.q)((n=i,function(){return Object(s.w)(void 0===n)}),Object(s.J)(p(t),Object(s.w)(!1)),Object(s.O)(t)))))}},,,,,,,,,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"b",function(){return f}),n.d(t,"a",function(){return h});var r=n(42),a=n.n(r),i=n(56),s=n(411),o=n(7),c=n.n(o),u=n(297),l={},f=function(e,t){return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var o,f;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!l[t]){n.next=2;break}return n.abrupt("return",r(l[t]));case 2:if(void 0!==e){n.next=5;break}return i(),n.abrupt("return");case 5:if(n.prev=5,n.prev=6,"RIFF"!==(new TextDecoder).decode(e.slice(0,4))){n.next=16;break}return n.next=11,c.a.Master.context.decodeAudioData(u(e));case 11:o=n.sent,t&&(l[t]=o),r(o),n.next=21;break;case 16:return n.next=18,Object(s.a)(e);case 18:f=n.sent,t&&(l[t]=f),r(f);case 21:n.next=26;break;case 23:n.prev=23,n.t0=n.catch(6),i(n.t0);case 26:n.next=31;break;case 28:n.prev=28,n.t1=n.catch(5),i(n.t1);case 31:case"end":return n.stop()}},n,null,[[5,28],[6,23]])}));return function(e,t){return n.apply(this,arguments)}}())},h=function(){l={}}},,function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"a",function(){return i});var r="PUBLIC",a="PRIVATE",i="GUILD"},,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"delegate",type:"address"},{name:"numTokens",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"contentHash",type:"bytes32"},{name:"user",type:"address"}],name:"approveContentOwner",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"numTokens",type:"uint256"}],name:"buyTokens",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"contentHash",type:"bytes32"}],name:"claimContentBalance",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"previousSequence",type:"bytes32"},{name:"newSequence",type:"bytes32"},{name:"title",type:"string"},{name:"samples",type:"bytes32[]"}],name:"editSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"newPrice",type:"uint256"}],name:"setPrice",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"receiver",type:"address"},{name:"numTokens",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"user",type:"address"},{name:"buyer",type:"address"},{name:"numTokens",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"total",type:"uint256"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"tokenOwner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"tokens",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"tokens",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"previousSequence",type:"bytes32"},{indexed:!0,name:"newSequence",type:"bytes32"},{indexed:!1,name:"title",type:"string"}],name:"SequenceEdited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sequenceHash",type:"bytes32"},{indexed:!0,name:"sampleHash",type:"bytes32"}],name:"SampleInSequence",type:"event"},{constant:!0,inputs:[{name:"user",type:"address"},{name:"delegate",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"tokenOwner",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"contentHash",type:"bytes32"}],name:"getContentBalance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getPrice",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"}],this.contractAddress="0x606f760c228cd5f11c6f79de64d3b299b11f1ed1"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"favoritePreset",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"},{internalType:"bytes32",name:"title",type:"bytes32"},{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"instrumentType",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"newPreset",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"},{internalType:"bytes32[4]",name:"tags",type:"bytes32[4]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"tagPreset",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsContractAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!1,internalType:"bytes32",name:"title",type:"bytes32"},{indexed:!1,internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{indexed:!1,internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"NewPreset",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"PresetSample",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"tag",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"PresetTagged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"PresetFavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"instrumentType",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"PresetInstrumentType",type:"event"}],this.contractAddress="0x62595809ACbf880Db1817720604eCdaEF21cb1a6"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,[{key:"isCreated",value:function(){return void 0!==this.ipfsHash||void 0!==this.name}},{key:"getName",value:function(){}},{key:"getId",value:function(){}}]),e}();t.a=i},,function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(125);function a(e){e=function(e){return 0===e.indexOf("0x")?e.slice(2):e}(e);for(var t=[],n=0;n<e.length;n+=64)e.length<n+64?t.push(i("0x"+e.slice(n))):t.push(i("0x"+e.slice(n,n+64)));return t}function i(e){return r.a.web3.utils.padRight(e,64)}},,function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var r=1,a=4},function(e,t,n){"use strict";n.d(t,"a",function(){return r});n(42),n(56),n(186);function r(e){}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(111),a=n(151);Object(a.a)("density",{windowSize:"The number of steps that we look back from to calculate the density"},"Calculates the number of triggers received in the last windowSize-many steps");var i=function(e){var t=[],n=void 0;return function(a,i,s){for(var o=n+2;o<i;o+=2)t.shift();var c=Object(r.A)(e,a,i,s);if(i!==n)for(;t.length>c;)t.shift();var u=t.filter(function(e){return e}).map(function(e){return e.chop}).reduce(function(e,t){return e+t},0);return t.push(a),n=i,u}}},function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(4),s=n(5),o=n(6),c=n(8),u=n(2),l=n(16),f=n(804),h=n(23),p=n(298);n(236);function d(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}t.a=function(e){return function(e){Object(o.a)(n,e);var t=m(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).variations=[],e.generation=0,e._bestSolutions=[],e}return Object(s.a)(n,[{key:"firstReproduction",value:function(e){var t=[];this._parameters.forEach(function(e){return t[e.id]=e.getCoordinates()}),this.variations=this.generateVariations(t,e)}},{key:"clearGenetic",value:function(){this.generation=0,this.variations=[],this.categories=void 0,this._bestSolutions=[],this.selectedVariation=void 0}},{key:"getBestCopy",value:function(){return this.bestSolutions.map(function(e){return Object(a.a)({},e)})}},{key:"reproduceSnapshots",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=Object(r.a)(this.effect.snapshots).slice(0,16),a=[],i=d(n);try{var s=function(){var t=e.value,n={};t.forEach(function(e){var t=e.parameter,r=e.coordinates;return n[t.id]=r}),a.push(n)};for(i.s();!(e=i.n()).done;)s()}catch(u){i.e(u)}finally{i.f()}var o=[];this._parameters.forEach(function(e){return o[e.id]=e.getCoordinates()});var c=this.generateVariations(o,t-a.length);this.variations=[].concat(a,Object(r.a)(c)),this.generation++,this._bestSolutions=[]}},{key:"unsupervised",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,n=this.effect.snapshots.length||8,a=0;a<t;a++){if(0==a){if(this.effect.snapshots.length>0){this.reproduceSnapshots();for(var i=0;i<n;i++)this.selectBest(i);continue}this.reproduce(void 0,64,8)}else this.reproduce(void 0,64,8);Math.floor(n*Object(p.b)());for(var s=0;s<n;s++)this.selectBest(s);var o=n+Math.floor(53*Object(p.b)());this.selectBest(o),this.selectedVariation=o;var c=[],u=function(t){var n=e.variations[o][t],r=e._parameters.find(function(e){return e.id===t});c.push({parameter:r,coordinates:n,min:r.min,max:r.max})};for(var l in this.variations[o])u(l);this.effect.snapshots.push(c)}this.effect.snapshots=Object(r.a)(this.effect.snapshots),this.currentSnapshotParameter.set(this.snapshots.length-1),this.clearGenetic()}},{key:"reproduce",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.8125,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;if(0===this.generation)this.firstReproduction(t);else{var a=this.getBestCopy();if(0===a.length)return;for(var i=Object(r.a)(a),s=Object(r.a)(this.nonBestSolutions),o=[],c=i.length;c<s.length-n;c++){var u=y(a),l=y(s),f=this.breed(u,l);o.push(f),i.push(f)}for(var h=[],p=0;p<n;p++){var d=y(a),v=this.generateVariation(d,e);h.push(v),i.push(v)}this.categories={elite:a,children:o,mutations:h},this.variations=i}this.generation++,this._bestSolutions=[],1==this.generation&&(this.selectBest(0),this.reproduce())}},{key:"selectBest",value:function(e){this._bestSolutions.includes(e)?this._bestSolutions=this._bestSolutions.filter(function(t){return t!==e}):this._bestSolutions.push(e)}},{key:"selectVariation",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=this.variations[e],i={},s=function(e){var s=n._parameters.find(function(t){return t.id===e});if(!s)return"continue";var o=a[e],c=o.x,u=o.y,l=s.setCoordinates(c,u,t,r,!0),f=l.id,h=l.value;n.effect.clearParameter(s,void 0,!0),i[f]=h};for(var o in a)s(o);this.track.sequencerEngine.dispatch(Object(h.ub)(i)),this.selectedVariation=e}},{key:"breed",value:function(e,t){var n,r={},i=d(this._parameters);try{for(i.s();!(n=i.n()).done;){var s=n.value.id,o=Object(p.b)();r[s]=o<.6?Object(a.a)({},e[s]):Object(a.a)({},t[s])}}catch(c){i.e(c)}finally{i.f()}return r}},{key:"bestSolutions",get:function(){var e=this;return this._bestSolutions.map(function(t){return e.variations[t]})}},{key:"nonBestSolutions",get:function(){var e=[];for(var t in this.variations)this.bestSolutions.includes(t)||e.push(this.variations[t]);return e}},{key:"generateVariations",value:function(e,t){for(var n=1/8,r=[e],a=1;a<t;a++){var i=this.generateVariation(e,n);r.push(i),n+=1/32}return r}},{key:"generateVariation",value:function(e,t){var n,r={},a=d(this._parameters);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(e[i.id]){var s=e[i.id],o=s.x,c=s.y;r[i.id]={x:Object(f.a)(o,0,l.c,t),y:Object(f.a)(c,0,l.a,t)}}}}catch(u){a.e(u)}finally{a.f()}return r}}]),n}(e)};var y=function(e){return e[Math.floor(Object(p.b)()*e.length)]}},function(e,t,n){"use strict";n.d(t,"a",function(){return O}),n.d(t,"i",function(){return k}),n.d(t,"r",function(){return j}),n.d(t,"f",function(){return w}),n.d(t,"v",function(){return x}),n.d(t,"l",function(){return S}),n.d(t,"u",function(){return P}),n.d(t,"b",function(){return E}),n.d(t,"s",function(){return T}),n.d(t,"p",function(){return A}),n.d(t,"o",function(){return M}),n.d(t,"e",function(){return R}),n.d(t,"c",function(){return C}),n.d(t,"d",function(){return N}),n.d(t,"n",function(){return q}),n.d(t,"m",function(){return I}),n.d(t,"g",function(){return _}),n.d(t,"k",function(){return D}),n.d(t,"t",function(){return F}),n.d(t,"q",function(){return L}),n.d(t,"h",function(){return B}),n.d(t,"j",function(){return z});var r=n(1),a=n(31),i=n(10),s=n(4),o=n(5),c=n(6),u=n(8),l=n(2),f=n(135),h=n(14),p=n(119),d=n(126),v=n(147),m=n(176);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var b=function(e){Object(c.a)(n,e);var t=y(n);function n(e,r,a,i,o){var c;return Object(s.a)(this,n),(c=t.call(this,e,r,0)).numberOfOutputs=3,c.predicate=a,c.action=i,c.aux=o,c}return Object(o.a)(n,[{key:"getText",value:function(){return void 0!==this.value?this.value:""}}]),n}(f.a),g=function(e){Object(c.a)(n,e);var t=y(n);function n(e,r,i){var o;return Object(s.a)(this,n),(o=t.call(this,e,r,void 0,void 0,i)).numberOfOutputs=1,o.valueParameter=new h.b("value",Object(a.a)(o),function(e,t){e.rack&&e.rack.updateRules()},{defaultValue:void 0,min:-1,max:16,exactAutomation:!0}),o.registerParameter(o.valueParameter),o}return Object(o.a)(n,[{key:"getJson",value:function(){var e=Object(r.a)({},Object(i.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{value:this.value});return e=Object(d.b)(e,"valueParameter",this.valueParameter)}},{key:"fromJson",value:function(e){var t=Object(i.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e);return Object(p.a)(this.valueParameter,e.value,t),Object(r.a)({},t,Object(d.a)(e,"valueParameter",this.valueParameter))}},{key:"value",get:function(){return Math.round(this.valueParameter.get())},set:function(e){this.valueParameter.set(e,!1,!1)}}]),n}(b),O=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(s.a)(this,n),t.call(this,"Accent",e,void 0,m.a)}return n}(b),k=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(s.a)(this,n),t.call(this,"Flam",e,void 0,m.d)}return n}(b),j=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(s.a)(this,n),t.call(this,"Regular",e,void 0,m.h)}return n}(b),w=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(s.a)(this,n),t.call(this,"Double",e,void 0,m.c)}return n}(b),x=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var i;return Object(s.a)(this,n),(i=t.call(this,"Times",e,void 0,m.k)).valueParameter=new h.b("value",Object(a.a)(i),function(e,t){i.action=Object(r.a)({},m.k,{value:t}),e.rack&&e.rack.updateRules()},{defaultValue:3,min:1,max:16,exactAutomation:!0}),i.registerParameter(i.valueParameter),i}return Object(o.a)(n,[{key:"value",get:function(){return Math.round(this.valueParameter.get())},set:function(e){this.valueParameter.set(e,!1,!1)}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(i.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{value:this.value});return e=Object(d.b)(e,"valueParameter",this.valueParameter)}},{key:"fromJson",value:function(e){var t=Object(i.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e);return Object(p.a)(this.valueParameter,e.value,t),Object(r.a)({},t,Object(d.a)(e,"valueParameter",this.valueParameter))}}]),n}(b),S=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(s.a)(this,n),t.call(this,"Legato",e,void 0,m.e)}return n}(b),P=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(s.a)(this,n),t.call(this,"Staccato",e,void 0,m.j)}return n}(b),E=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(s.a)(this,n),t.call(this,"Any",e,m.b)}return n}(b),T=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(s.a)(this,n),t.call(this,"Rest",e,void 0,m.i)}return n}(b),A=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(s.a)(this,n),t.call(this,"Piano",e,void 0,m.g)}return n}(b),M=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(s.a)(this,n),t.call(this,"Pianissimo",e,void 0,m.f)}return n}(b),R=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(s.a)(this,n),t.call(this,"Dot",e,Object(v.c)())}return n}(b),C=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(s.a)(this,n),t.call(this,"Dash 1",e,Object(v.b)(0))}return n}(b),N=function(e){Object(c.a)(n,e);var t=y(n);function n(e){return Object(s.a)(this,n),t.call(this,"Dash 2",e,Object(v.b)(1))}return n}(b),q=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Otherwise",e,Object(m.p)())).numberOfOutputs=1,r}return n}(b),I=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Max",e,function(e,t){return e.max(t)})).value=1,r}return n}(g),_=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Figure",e,function(e,t){return e.figure(t)})).value=0,r}return n}(g),D=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Later",e,function(e,t){return e.later(t)})).value=2,r}return n}(g),F=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Skip",e,function(e,t){return e.skip(t)})).value=2,r}return n}(g),L=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"R.Every",e,function(e,t){return e.every(t)})).value=2,r}return n}(g),B=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"First",e,function(e,t){return e.first(t)})).value=0,r}return n}(g),z=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Last",e,function(e,t){return e.last(t)})).value=0,r}return n}(g)},function(e,t,n){"use strict";n.d(t,"j",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"g",function(){return i}),n.d(t,"h",function(){return s}),n.d(t,"e",function(){return o}),n.d(t,"k",function(){return c}),n.d(t,"f",function(){return u}),n.d(t,"a",function(){return l}),n.d(t,"n",function(){return f}),n.d(t,"b",function(){return h}),n.d(t,"d",function(){return p}),n.d(t,"l",function(){return d}),n.d(t,"m",function(){return v}),n.d(t,"i",function(){return m});var r="PROBABILITY",a="EVERY",i="MARKOV",s="MARKOV_PREVIOUS",o="GATE_MASK",c="REVERSE",u="LEGATO",l="DELAY",f="TRANSPOSE",h="DURATION",p="EXPAND",d="ROLL",v="SCRIPT",m=[c,f,h,o,l,p,d,u]},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=c(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"registerPresetManager",value:function(e){this.presetManager=e}},{key:"onValueChange",value:function(e){this.presetManager&&this.attributes["scripting name"]&&this.presetManager.onValueChange(this,e)}},{key:"presetManager",get:function(){return this.subSequence.presetManager?this.subSequence.presetManager:this.sequencerEngine.presetManager}},{key:"getValueJson",value:function(){var e;return this.effect?{effect:(e=this.effect).getValueJson.apply(e,arguments)}:this.getJson.apply(this,arguments)}},{key:"fromValueJson",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.effect?this.effect.fromJson(t[0].effect,!1,!0):this.fromJson.apply(this,t)}},{key:"interpolate",value:function(e,t,n){}}]),n}(e)}},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),s=n(6),o=n(8),c=n(2),u=n(109),l=n(232);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(s.a)(n,e);var t=f(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"typed",value:function(e){var t=this;if(!this.args)return e;var n=new Array(16).fill(0).map(function(e,n){return function(){return t.args[n]}});return l.a.apply(void 0,[e,this].concat(Object(r.a)(n)))}},{key:"registerTypes",value:function(e){var t=Object(u.a)(e),n=t.type,r=t.inletTypes;t.outlets,t.isHot,t.inlets;this.determineType="function"===typeof n?n:function(){return n},this.inletTypes=r}},{key:"storeOutputType",value:function(e){e&&(Array.isArray(e)||(e=[e]),this.outputtedTypes=e.map(function(e){return e&&e.type}))}}]),n}(e)}},,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(107),a=n(3),i=n.n(a),s=n(55),o=(n(308),n(840));t.a=Object(s.b)(function(e,t){return{}},null)(function(e){e.text;var t=e.className,n=void 0===t?"":t,s=e.width,c=void 0===s?390:s,u=e.intervalTime,l=void 0===u?100:u,f=e.intervalPiece,h=void 0===f?10:f,p=Object(a.useState)(0),d=Object(r.a)(p,2),v=d[0],m=d[1];return Object(a.useEffect)(function(){var e=setInterval(function(){m(function(e){return(e+h)%100})},l);return function(){return clearInterval(e)}},[]),Object(a.useEffect)(function(){if(window.parent&&document.referrer){var e={type:"loading-progress",body:v},t=document.referrer;window.parent.postMessage(e,t)}},[v]),i.a.createElement("div",{style:{width:c,height:c},className:"circular-container progress-bar "+n},i.a.createElement(o.a,{percentage:v,radius:c/2}))})},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(116),f=n(119),h=n(7),p=n.n(h),d=n(112);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(o.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Ultra Phaser",function(){return new p.a.Gain(1)},e)).poles=8,r.generateAllPassFilters(),r.rateParameter=new d.c("Rate",r.lfo.frequency,{documentation:"The speed of the sweeping.",defaultValue:.25,min:0,max:16}),r.registerParameter(r.rateParameter),r.feedbackParameter=new d.c("Feedback",r.feedbackNode.gain,{documentation:"The amount of signal that is fed back into the effect.",defaultValue:.1,min:0,max:1}),r.registerParameter(r.feedbackParameter),r.wetParameter=new d.c("Wet",r.crossFade.fade,{documentation:"Controls the amount of (wet) effected signal, vs. dry (un-effected) signal.",defaultValue:.5,min:0,max:1}),r.registerParameter(r.wetParameter),r.depthParameter=new d.a("Depth",r.lfo._scaler._scale,function(e,t){r.lfo.max=t},{documentation:"The depth of the modulation, controlling how much it sweeps on each cycle.",min:0,max:1,unit:"",defaultValue:.5,automatable:!1}),r.registerParameter(r.depthParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"dispose",value:function(){Object(s.a)(Object(u.a)(n.prototype),"dispose",this).call(this),this.filters.forEach(function(e){return e.dispose()}),this.scalers.forEach(function(e){return e.dispose()}),this.crossFade.dispose(),this.lfo.dispose(),this.feedbackNode.dispose(),this.outputNode.dispose(),this.filters=void 0,this.scalers=void 0,this.crossFade=void 0,this.lfo=void 0,this.feedbackNode=void 0,this.outputNode=void 0,this.feedbackParameter=void 0,this.depthParameter=void 0,this.wetParameter=void 0,this.rateParameter=void 0}},{key:"generateAllPassFilters",value:function(){var e=this;this.filters=[],this.scalers=[];for(var t=100,n=0;n<this.poles;n++){var r=new p.a.Filter(t,"allpass");this.filters.push(r);var a=new p.a.Scale(t,t+4e3);a.connect(r.frequency),this.scalers.push(a),t+=1e3}this.outputNode=new p.a.Gain(1),this.lfo=new p.a.LFO("1n",0,1),this.filters.forEach(function(t,n){return e.lfo.connect(e.scalers[n])});var i=this.effectNode;for(var s in this.filters)i.connect(this.filters[s]),i=this.filters[s];this.lfo.start(),this.crossFade=new p.a.CrossFade(0),this.crossFade.connect(this.outputNode),this.effectNode.connect(this.crossFade,0,0),i.connect(this.crossFade,0,1),this.feedbackNode=new p.a.Gain(.2),i.connect(this.feedbackNode),this.feedbackNode.connect(this.filters[0])}},{key:"documentation",value:function(){return"Sweeping effect where signal is filtered, and the position of peaks and troughs are modulated and varying."}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{rate:this.rateParameter.get(),feedback:this.feedbackParameter.get(),wet:this.wetParameter.get(),depth:this.depthParameter.get()});return e=this.saveParameterToJson(e,"rateParameter",this.rateParameter),e=this.saveParameterToJson(e,"feedbackParameter",this.feedbackParameter),e=this.saveParameterToJson(e,"wetParameter",this.wetParameter),e=this.saveParameterToJson(e,"depthParameter",this.depthParameter)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return!isNaN(e.rate)&&e.rate&&Object(f.a)(this.rateParameter,e.rate,a),Object(f.a)(this.feedbackParameter,e.feedback,a),Object(f.a)(this.wetParameter,e.wet,a),Object(f.a)(this.depthParameter,e.depth,a),Object(r.a)({},a,this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t),this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter,t),this.loadParameterFromJson(e,"wetParameter",this.wetParameter,t),this.loadParameterFromJson(e,"depthParameter",this.depthParameter,t))}}]),n}(l.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(116),f=n(119),h=n(7),p=n.n(h),d=(n(14),n(112)),v=n(344);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var y=new Float32Array(65536),b=function(e){Object(o.a)(n,e);var t=m(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Saturator",function(){return new p.a.Gain(1)},e)).waveShaperNode=new p.a.WaveShaper([-1,1]),r.effectNode.connect(r.waveShaperNode),r.postGain=new p.a.Gain(1),r.waveShaperNode.connect(r.postGain),r.params=r.getParams(-10,20,30,6),r.driveParameter=new d.a("Drive",r.effectNode.gain,function(e,t){r.effectNode.gain.value=t,r.postGain.gain.value=Math.pow(1/t,.6)},{documention:"Controls the level of saturation.",min:.01,max:32,unit:"",defaultValue:1,constantAutomationRate:!0}),r.registerParameter(r.driveParameter),r.waveShaperNode.curve=r.generateCurve(),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"documentation",get:function(){return"Saturates the sound, making it more distorted."}},{key:"dispose",value:function(){this.driveParameter.dispose(!1),Object(s.a)(Object(u.a)(n.prototype),"dispose",this).call(this),this.postGain.dispose(),this.waveShaperNode.dispose(),this.postGain=void 0,this.waveShaperNode=void 0,this.driveParameter=void 0}},{key:"connect",value:function(e){this.postGain.connect(e)}},{key:"disconnect",value:function(e){this.postGain.disconnect(e)}},{key:"getParams",value:function(e,t,n,r){var a=Object(v.a)(e),i=(Object(v.a)(t),1/n),s=this.kAtSlope(1/n,e,t,a),o=e+t,c=Object(v.a)(o);return{linearThreshold:a,thresholdDb:e,kneeDb:t,ykneeThresholdDb:Object(v.b)(this.saturateBasic(c,s,a)),kneeThreshold:c,kneeThresholdDb:o,k:s,ratio:n,slope:i}}},{key:"slopeAt",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.params.linearThreshold;if(e<n)return 1;var r=1.001*e,a=Object(v.b)(e),i=Object(v.b)(r),s=Object(v.b)(this.saturateBasic(e,t,n));return(Object(v.b)(this.saturateBasic(r,t,n))-s)/(i-a)}},{key:"kAtSlope",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.params.thresholdDb,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.params.kneeDb,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.params.linearThreshold,a=t+n,i=Object(v.a)(a),s=.1,o=1e4,c=5,u=0;u<15;++u){this.slopeAt(i,c,r)<e?(o=c,c=Math.sqrt(s*o)):(s=c,c=Math.sqrt(s*o))}return c}},{key:"saturateBasic",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.params.linearThreshold;return e<n?e:n+(1-Math.exp(-t*(e-n)))/t}},{key:"saturate",value:function(e){var t;if(e<this.params.kneeThreshold)t=this.saturateBasic(e,this.params.k);else{var n=Object(v.b)(e),r=this.params.ykneeThresholdDb+this.params.slope*(n-this.params.kneeThresholdDb);t=Object(v.a)(r)}return t}},{key:"generateCurve",value:function(){for(var e=32768,t=0,n=0;n<e;++n)t=n/e,t=this.saturate(t),y[e+n]=t,y[e-n-1]=-t;return y}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{drive:this.driveParameter.get()});return e=this.saveParameterToJson(e,"driveParameter",this.driveParameter)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(f.a)(this.driveParameter,e.drive,a),Object(r.a)({},a,this.loadParameterFromJson(e,"driveParameter",this.driveParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(l.a.Effect);t.a=b},function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(4),s=n(5),o=n(10),c=n(6),u=n(8),l=n(2),f=n(116),h=(n(123),n(79),n(17),n(20),n(7)),p=n.n(h),d=(n(360),n(112),n(126),n(217)),v=(n(351),n(312)),m=n(353),y=n(311);function b(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var k=function(e){Object(c.a)(n,e);var t=O(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,"Effect Rack",function(){return new p.a.Gain(1)},e)).inputNode=r.effectNode,r.inputNode.x=0,r.inputNode.y=200,r.outputNode=new p.a.Gain(1),r.outputNode.id="speakers-"+r.id,r.outputNode.x=400,r.outputNode.y=200,r.initializeConfigurations(r.adjacencyLists),r}return Object(s.a)(n,[{key:"onBPMUpdated",value:function(){for(var e in this.effects)this.effects[e].onBPMUpdated&&this.effects[e].onBPMUpdated()}},{key:"getParameters",value:function(){var e=Object(o.a)(Object(l.a)(n.prototype),"getParameters",this).call(this);for(var t in this.macros)e=[].concat(Object(a.a)(e),Object(a.a)(this.macros[t].parameters));return e}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(){this.outputNode.disconnect()}},{key:"addEffect",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(o.a)(Object(l.a)(n.prototype),"addEffect",this).call(this,e,t),t&&e.enable(!0),t&&e.wetParameter&&e.wetParameter.set(1)}},{key:"dispose",value:function(){for(var e in this.macros.forEach(function(e){return e.dispose()}),this.macros=[],this.effects.forEach(function(e){return e.dispose()}),this.adjacencyLists)this.adjacencyLists[e]&&this.adjacencyLists[e].forEach(function(e){return e.dispose()});this.adjacencyLists=void 0,Object(o.a)(Object(l.a)(n.prototype),"dispose",this).call(this),this.outputNode.dispose(),this.outputNode=void 0,this.effects=void 0,this.macros=void 0}},{key:"deleteEdge",value:function(e){var t=this;if(!e.modulator){var r=function(n){if(t.adjacencyLists[n].indexOf(e)>-1)if(-1===parseInt(n))t.inputNode.disconnect(e.gain);else{var r=t.effects.find(function(e){return e.id===n});r&&r.disconnect(e.gain)}};for(var a in this.adjacencyLists)r(a)}Object(o.a)(Object(l.a)(n.prototype),"deleteEdge",this).call(this,e)}},{key:"connectEdge",value:function(e,t){return Object(o.a)(Object(l.a)(n.prototype),"connectEdge",this).call(this,e,t),e.connect(t.gain),t}},{key:"getJson",value:function(){return Object(r.a)({},this.getRackJson(),{isCollapsed:this.isCollapsed})}},{key:"muteRack",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.inputNode.gain.value=e?0:1,this.outputNode.gain.value=e?0:1}},{key:"fromJson",value:function(e,t,a,i){this.muteRack(!0),Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,i),this.isCollapsed=e.isCollapsed,this.adjacencyLists={},this.configurations=[],this.effects.forEach(function(e){return e.dispose()}),this.effects=[];var s=e.effects,c={};for(var u in s){var f=s[u],h=Object(d.a)(f,t,this.sequencerEngine,a),p=h.effect;this.addEffect(p,!1),p.id=f.id,p.x=f._x||f.x,p.y=f._y||f.y,c=Object(r.a)({},c,h.bulk)}return this.fromRackJson(e,i),this.muteRack(!1),this.outputNode.id="speakers-"+this.id,c}},{key:"fromJsonSync",value:function(e,t,r,a,i,s){Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,!0),this.adjacencyLists={},this.configurations=[],this.effects.forEach(function(e){return e.dispose()}),this.effects=[];for(var c in a){var u=a[c].getEffectCopy(i,s);this.addEffect(u,!1),u.x=e.effects[c].x,u.y=e.effects[c].y;var f=a[c];if(u.id!==f.id){var h,p=b(e.configurations);try{for(p.s();!(h=p.n()).done;){var d=h.value,v=d[f.id];d[u.id]=v,delete d[f.id]}}catch(m){p.e(m)}finally{p.f()}}}return this.fromRackJson(e,!0),{}}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e),a=this.context.track;return r.fromJsonSync(this.getJson(),this.sequencerEngine.tracks,void 0!==a?a.trackNumber:0,this.effects,e,t),r}}]),n}(Object(y.a)(Object(m.a)(Object(v.a)(f.a.Effect))));t.a=k},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(14);function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=u(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"setupTrackParameter",value:function(){var e=this;this.trackParameter=new c.b("track",this,function(t,n){e.onChangeTrack(n)},{defaultValue:-1,min:0,max:10,isAutomatable:!1}),this._track=void 0}},{key:"onChangeTrack",value:function(e){this._track=-1!==e?this.sequencerEngine.tracks[e]:void 0}},{key:"getTrack",value:function(){var e=this.trackParameter.get();if(-1!==e)return this.sequencerEngine.tracks[e]}}]),n}(e)}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),s=n(10),o=n(6),c=n(8),u=n(2),l=n(401),f=n(14),h=n(180);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var d=function(e){Object(o.a)(n,e);var t=p(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Roll Effect",h.f,e)).rollFactorParameter=new f.a("Roll Factor",Object(i.a)(a),function(e,t){return t},{min:.125,max:8,unit:"x",defaultValue:1}),a.registerParameter(a.rollFactorParameter),a.modeParameter=new f.b("Mode",Object(i.a)(a),function(e,t){return t},{min:h.a,max:h.b,unit:"",defaultValue:h.g}),a.registerParameter(a.modeParameter),a}return Object(a.a)(n,[{key:"mode",get:function(){return this.modeParameter.get()},set:function(e){this.modeParameter.set(e)}},{key:"rollFactor",get:function(){return this.rollFactorParameter.get()},set:function(e){this.rollFactorParameter.set(e)}},{key:"getJson",value:function(){var e=Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return e.rollFactor=this.rollFactor,e.mode=this.mode,e=this.saveParameterToJson(e,"rollFactorParameter",this.rollFactorParameter),e=this.saveParameterToJson(e,"modeParameter",this.modeParameter)}},{key:"fromJson",value:function(e){Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e),this.mode=e.mode,this.rollFactor=e.rollFactor,this.loadParameterFromJson(e,"rollFactorParameter",this.rollFactorParameter),this.loadParameterFromJson(e,"modeParameter",this.modeParameter)}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson()),t}}]),n}(l.a);t.a=d},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var r="MASTER",a="SENDS_ONLY"},function(e,t,n){"use strict";function r(e,t,n,r){var a=e.x,i=e.y,s=t.x,o=t.y,c=n.x,u=n.y,l=r.x,f=r.y;if(a===s&&i===o||c===l&&u===f)return!1;var h=(f-u)*(s-a)-(l-c)*(o-i);if(0===h)return!1;var p=((l-c)*(i-u)-(f-u)*(a-c))/h,d=((s-a)*(i-u)-(o-i)*(a-c))/h;return!(p<0||p>1||d<0||d>1)&&{x:a+p*(s-a),y:i+p*(o-i)}}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";n.d(t,"d",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"a",function(){return s});var r=1,a=2,i=3,s=5},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i});var r="ALL",a="COMPUTER_KEYBOARD",i="CUSTOM"},,,function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"d",function(){return s});var r="LFO",a="PLANAR_SHAPSHOTS",i="JAKI_PARAMS",s={JAKI_PARAMS:"jakiParamsComponent",PLANAR_SNAPSHOTS:"snapshotComponent",JAKI_FIGURES:"figuresComponent"}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var r="POST_FX",a="PRE_FX"},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56);!function(e){var t=e.isNFT?"recorderWorker.js":"../recorderWorker.js",n=function(e,n){var r=n||{},s=r.bufferLen||256,o=r.numChannels||2;this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,s,o,o);var c=new Worker(r.workerPath||t);c.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:o}});var u,l,f=!1,h=!0,p=null,d=0;this.node.onaudioprocess=function(e){if(f){var t=0;if(null!=l){if(h){var n=l-d;if(d=this.context.currentTime,(t=Math.floor(n*this.context.sampleRate)-120)<0||t>s)return}l=null}if(null!==p)this.context.currentTime-p>=0&&(p=null,f=!1);for(var r=[],a=0;a<o;a++){var i=e.inputBuffer.getChannelData(a);t>0&&(i=i.subarray(t)),r.push(i)}c.postMessage({command:"record",buffer:r})}},this.terminate=function(){c.terminate()},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])},this.record=function(e){void 0!==e?(l=e,h=!0):(l=this.context.currentTime,h=!1),f=!0,p=void 0},this.stop=function(e){p=void 0!==e?e:(new Date).getTime()},this.clear=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(new Date).getTime();l=e,c.postMessage({command:"clear"})},this.getBuffer=function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,u=function(e){n=e},e.abrupt("return",new Promise(function(e){c.postMessage({command:"getBuffer"});var t=setInterval(function(){n&&(e(n),clearInterval(t))},100)}));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),this.exportWAV=function(e,t){if(u=e||r.callback,t=t||r.type||"audio/wav",!u)throw new Error("Callback not set");c.postMessage({command:"exportWAV",type:t})},c.onmessage=function(e){var t=e.data;u(t)},e.connect(this.node);var v=this.context.createGain();v.gain.value=0,this.node.connect(v),v.connect(this.context.destination)};n.forceDownload=function(t,n){var r=(e.URL||e.webkitURL).createObjectURL(t),a=e.document.createElement("a");a.href=r,a.download=n||"output.wav";var i=document.createEvent("Event");i.initEvent("click",!0,!0),a.dispatchEvent(i)},e.Recorder=n}(window)},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(7),u=n.n(c);function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}new u.a.Time("16n");t.a=function(e){return function(e){Object(i.a)(n,e);var t=l(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"setupSlide",value:function(){this.slideEnvelope=new u.a.ScaledEnvelope({attack:.1,decay:1e-4,sustain:1,release:1e-5,curve:"linear"}),this.slideEnvelope._releaseCurve="linear",this.slideEnvelope.connect(this.detuneSignal)}},{key:"triggerSlide",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=0,i=0,s=void 0!==this.lastTranspose?this.lastTranspose:e;r&&(void 0!==this.lastSlideTranspose?(a=this.lastSlideMax,i=100*(e-s)):i=100*(e-s)),this.slideEnvelope.min=a,this.slideEnvelope.max=i;var o=n;this.slideEnvelope.attack=o,t&&!isNaN(t)&&this.slideEnvelope.triggerAttack(t),r&&(this.lastSlideMax=i,this.lastSlideTranspose=e)}},{key:"releaseSlide",value:function(e){this.slideEnvelope.min=0,this.slideEnvelope.triggerRelease(e?Math.max(0,e-1e-4):void 0)}},{key:"clearSlide",value:function(){this.lastSlideTranspose=void 0,this.lastSlideMax=void 0,this.releaseSlide(u.a.Master.context.currentTime+.01)}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(1750),a=n.n(r),i=(new(window.AudioContext||window.webkitAudioContext),function(e){try{return a()(e)}catch(t){return console.log("error detecting bpm"),128}})},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(351),s=(n(7),n(123)),o=function(){function e(t,n,a,o,c){Object(r.a)(this,e),this.store=t.store,this.sequencerEngine=t,this.context=(c||new s.a).forLFOTrack(this,n).forSubSequence(n.subSequence),this.number=o,this.lfo=new i.a(t,a,(new s.a).forLFOTrack(this,n),o),this.lfo.lfoMin=-100,this.lfo.lfoMax=100}return Object(a.a)(e,[{key:"id",get:function(){return this.lfo.id}},{key:"start",value:function(e){this.lfo.start(e)}},{key:"stop",value:function(){this.lfo.stop()}},{key:"getName",value:function(){return"LFO "+this.number}},{key:"getJson",value:function(){return this.lfo.getJson()}}]),e}();t.a=o},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),s=n.n(i),o=n(174),c=n(180),u=new s.a.Time("16n"),l=function(){function e(t,n,a,i,o){var c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;Object(r.a)(this,e),this.sequencerEngine=i,this.track=t,this._velocity=c,this.startTime=s.a.Master.context.currentTime,this.currentStep=i.getCurrentStep(a,t),this.currentGlobalStep=i.lastTrackStep,this.currentStepUnquantized=i.trackStepReal,this.ogCurrentStepUnquantized=this.currentStepUnquantized,this.currentStepTime=i.currentStepTime||s.a.Master.context.currentTime,t.subSequence.isTrack||(this.currentStepUnquantized=this.track.getPatternStep(this.currentStepUnquantized)),this.currentStep=this.track.getPatternStep(this.currentStep),this.currentGlobalStep=this.track.getPatternStep(this.currentGlobalStep),this.quantized=o,this.trackNumber=t?t.trackNumber:0,this.sliceNumber=n,this.resolution=a,this.rolling=!!t&&t.rolling}return Object(a.a)(e,[{key:"velocity",get:function(){return null===this._velocity?this.track.trackData.velocity:this._velocity}},{key:"getDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.quantized,t=s.a.Master.context.currentTime,n=void 0,r=void 0,a=u.toMilliseconds()/1e3;if((void 0===this.currentStepTime||Math.abs(this.currentStepTime-this.startTime)>a)&&e){var i=Math.max(this.currentGlobalStep,0);n=(r=(this.sequencerEngine.lastTrackStep-i)/2)*u.toMilliseconds()}else r=(n=new s.a.Time(t).toMilliseconds()-new s.a.Time(e?this.currentStepTime:this.startTime).toMilliseconds())/u.toMilliseconds();return{duration:n,durationSixteenths:r}}},{key:"record",value:function(e,t,n){t=t||this.track,n=n||t.trackData.transpose,e=e||t.sequencerEngine;var r=this.getDuration(),a=r.duration,i=r.durationSixteenths,c=(new s.a.Time(this.startTime).toMilliseconds()-new s.a.Time(this.currentStepTime).toMilliseconds())/new s.a.Time("32n").toMilliseconds();if(this.quantized){c=Math.max(0,c);var u=this.currentStepUnquantized+c;u=this.resolution.transformStepAtResolution2(u,o.a.baseResolution),u=Math.round(u),t.subSequence.isTrack||(u%=this.track.pattern.length(this.resolution)),isNaN(u)&&(u=0),t.recordHit(u,this.resolution,this.sliceNumber,i,n,this.velocity,this.release)}else{new s.a.Time(this.startTime).toMilliseconds(),new s.a.Time(this.currentStepTime).toMilliseconds(),new s.a.Time("32n").toMilliseconds();if(this.rolling)for(var l=this.getNumberOfRollsForDuration(a,t),f=32/this.resolution.numSteps(),h=this.getDurationOfRollTime(t),p=this.currentStepUnquantized+c;p<=this.currentStepUnquantized+f*l;p+=f){var d=Math.floor(p),v=p-d;t.recordUnquantizedHit(d,this.sliceNumber,h,v,n,this.velocity)}else t.recordUnquantizedHit(this.ogCurrentStepUnquantized,this.sliceNumber,i,c,n,this.velocity,this.release)}}},{key:"getDurationOfRollTime",value:function(e){return this.resolution.getTimeInStep().toMilliseconds()/u.toMilliseconds()}},{key:"getStepsInRollTime",value:function(e){var t=this.resolution,n=t.numSteps()/t.baseResolution,r=t.numSteps();return 32===r?n:48===r?n:16===r?2*n:24==r?2*n:8===r?4*n:12===r?4*n:4===r?8*n:6==r?8*n:null}},{key:"getRollResolution",value:function(e){var t=e.liveEffects.getEffect(c.f),n=this.resolution;return t&&((n=n.getCopy()).resolution*=t.rollFactor),n}},{key:"getNumberOfRollsForDuration",value:function(e,t){return e/this.resolution.getTimeInStep().toMilliseconds()}}]),e}();t.a=l},,,,,function(e,t,n){"use strict";n.d(t,"i",function(){return r}),n.d(t,"h",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"e",function(){return s}),n.d(t,"f",function(){return o}),n.d(t,"b",function(){return c}),n.d(t,"d",function(){return u}),n.d(t,"g",function(){return l}),n.d(t,"a",function(){return f});var r="PADS",a="KEYBOARD",i=118,s=119,o=117,c=116,u=115,l=64,f=1},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return s});var r=n(11),a=n(1),i=function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.state.spatial.presentationMode;var t=e.state.windows.selectedElements,n=e.state.windows,r=n.windowPositions,i=n.presentationWindowPositions,s={};for(var o in t){var c=e.idToObject[o].presentationMode&&i[o]||r[o];s[o]=Object(a.a)({},c)}return s},s=function(e){var t=Math.min.apply(Math,Object(r.a)(Object.values(e).map(function(e){return e.y})));Math.max.apply(Math,Object(r.a)(Object.values(e).map(function(e){return e.y})));return{x:{min:Math.min.apply(Math,Object(r.a)(Object.values(e).map(function(e){return e.x}))),max:Math.max.apply(Math,Object(r.a)(Object.values(e).map(function(e){return e.x})))},y:{min:t,max:t}}}},function(e,t,n){},,,function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(107),s=n(4),o=n(5),c=n(31),u=n(10),l=n(6),f=n(8),h=n(2),p=n(135),d=n(161),v={rotateForce:function(e){},forceStart:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n[0],i=n[1],s=n[2],o=Object.keys(e.groups[0].forces)[a],c=e.groups[0].forces[o];c[0].set(i),c[1].set(s)},forceDirection:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n[0],i=n[1],s=n[2],o=Object.keys(e.groups[0].forces)[a],c=e.groups[0].forces[o];c[2].set(i),c[3].set(s)}};function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}function y(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var O=n(521),k=n(16),j=n(198),w=n(141),x=function(){var e={};return function(t,n,r){return void 0===t?Object.keys(e):t in e?e[t]:void(e[t]={params:n,description:r})}}(),S=n(247),P=function(e,t,n){return e(t,n[4],n[5],n[3])},E=function(){0;var e=0,t=Object(S.a)("planarReset");return function(n,a,i,s){t().some(function(e){return e===i.id})&&(e=0),e++;var o=Object.keys(s[0]),c=Math.round(a*o.length),u=e*c%o.length,l=o.slice(u,u+c);l.length<c&&(c-l.length,l=[].concat(Object(r.a)(l),Object(r.a)(o.slice(0,c-l.length))));var f={};return l.forEach(function(e){n[e]&&(f[e]=n[e])}),f}},T=n(154),A=n(804);function M(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}x("random",{amount:"The degree of randomness"},"Randomizes the parameter values by ratio passed as an argument (0-1)");var C=function(e){var t=E();return function(n){for(var r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];n=P(t,n,a);var s={},o=T.a.apply(void 0,[e].concat(a));for(var c in n)if(n[c]){var u=n[c],l=u.x,f=u.y;s[c]={x:Object(A.a)(l,0,k.c,o),y:Object(A.a)(f,0,k.a,o),density:1}}return s}};x("part",{"...list":"List of functions that will each get a partition"},"Partitions the parameters, and executes different functions (the passed args) on each part");var N=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=q(e,t.length),r={},i=0,s=arguments.length,o=new Array(s>1?s-1:0),c=1;c<s;c++)o[c-1]=arguments[c];var u,l=M(n);try{for(l.s();!(u=l.n()).done;){var f=u.value;r=Object(a.a)({},r,t[i].apply(t,[f].concat(o))),i++}}catch(h){l.e(h)}finally{l.f()}return r}},q=function(e,t){for(var n=Object.keys(e),r=Math.floor(n.length/t),a=[],i=function(t){var i=n.slice(t*r,(t+1)*r),s={};i.forEach(function(t){return s[t]=e[t]}),a.push(s)},s=0;s<t;s++)i(s);return a};x("s",{"...list":"List of functions to execute"},"Executes the arguments sequentially, passing the transformed parameter values to each subsequent call");var I=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var i,s=M(t);try{for(s.s();!(i=s.n()).done;){e=i.value.apply(void 0,[e].concat(r))}}catch(o){s.e(o)}finally{s.f()}return e}};x("p",{"...list":"List of functions to execute in parallel"},"Executes the arguments in parallel, passing the transformed parameter values to each subsequent call");var _=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n={},r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];var o,c=M(t);try{for(c.s();!(o=c.n()).done;){var u=o.value;n=Object(a.a)({},n,u.apply(void 0,[e].concat(i)))}}catch(l){c.e(l)}finally{c.f()}return n}},D=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.length,r=new Float32Array(e.map(function(e){return e.toSeconds?e.toSeconds(!0):e.getNumber(!0)})),a=new Float32Array(e.map(function(e){return e.depth})),i=new Float32Array(e.map(function(e){return e.min})),s=new Float32Array(e.map(function(e){return e.max})),o=new Float32Array(e.map(function(e){return e.depthParameter?e.depthParameter.min:0})),c=new Float32Array(e.map(function(e){return e.depthParameter?e.depthParameter.max:1})),u=window.api.create_buffer(n),l=window.api.create_buffer(n),f=window.api.create_buffer(n),h=window.api.create_buffer(n),p=window.api.create_buffer(n),d=window.api.create_buffer(n);window.Module.HEAPF32.set(r,u>>2),window.Module.HEAPF32.set(a,l>>2),window.Module.HEAPF32.set(o,f>>2),window.Module.HEAPF32.set(c,h>>2),window.Module.HEAPF32.set(i,p>>2),window.Module.HEAPF32.set(s,d>>2);var v=window.api.create_geometry_buffer(n),m=window.api.create_geometry_buffer(n);window.api.getCoordinates(u,l,p,d,f,h,k.c,k.a,k.b,1,n,v,m);var y,b=new Uint32Array(window.Module.HEAP32.buffer,v,n),g=new Uint32Array(window.Module.HEAP32.buffer,m,n);if(t){y=new Float32Array(2*n);for(var O=0;O<n;O++)y[2*O]=b[O],y[2*O+1]=g[O]}else{y=[];for(var j=0;j<n;j++)y.push({x:b[j],y:g[j]})}return window.api.destroy_buffer(u),window.api.destroy_buffer(l),window.api.destroy_buffer(f),window.api.destroy_buffer(h),window.api.destroy_buffer(p),window.api.destroy_buffer(d),window.api.destroy_buffer(m),window.api.destroy_buffer(v),y},F=n(229),L=function(e){return e*(Math.PI/180)};function B(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return z(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var J="NAVIER",V="NONE",H=(Math.sqrt,Math.pow,Object.keys),U=Object.values,G=function(e){return function(t,n,r){return(r.density||1)*e[5].getViscosity(t,n)}};x("swap",{},"Swaps the parameter values cyclicly");var W=function(){var e=E();return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];t=P(e,t,r);var i,s={},o=H(t),c=t[o[0]],u=0,l=B(o);try{for(l.s();!(i=l.n()).done;){var f=i.value,h=void 0;h=u===o.length-1?c:t[o[u+1]],s[f]={x:h.x,y:h.y,density:h.density},u++}}catch(p){l.e(p)}finally{l.f()}return s}},K=function(e,t,n){var r=Object(j.a)(U(e)),a={};for(var i in e){var s=e[i],o=s.x,c=s.y,u=n?n(o,c,e[i]):10,l=o+(o-r.x)*t*10/u,f=c+(c-r.y)*t*10/u;a[i]={x:l,y:f,density:u}}return a};x("expand",{minWidth:"Minimum width of the expansion",maxWidth:"Maximum width of the expansion"},"Expands the values to maxWidth (ratio of initial width 0-1) and then contracts to minWidth (ratio of initial width)");var Q=function(e,t){var n=E(),r=!0,a=void 0;return function(i){var s=Object(j.b)(i);a||(a=s);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];var l=P(n,i,c),f=T.a.apply(void 0,[e].concat(c))*a,h=T.a.apply(void 0,[t].concat(c))*a,p=c[0];return r&&(s>=h||s>=k.c)?r=!1:!r&&s<=f&&(r=!0),K(l,r?p/5:-p/5,G(c))}};x("life",{},"Expands/contracts and randomizes");var Z=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=E(),n=!1,r=0,i=Object(S.a)("planarReset");return function(s){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];s=P(t,s,c);var l=c[0],f=c[1],h=c[5];i().some(function(e){return e===h.id})&&(n=!1,r=0),++r%f===0&&(n=!n);var p={};if(e)for(var d in s){var v=Math.random(),m=s[d],y=m.x,b=m.y;v<.2||(v<.4?y--:v<.6?y++:v<.8?b++:b--,p[d]={x:y,y:b})}else p=Object(a.a)({},s);var g=n?Math.random()*l/5:-Math.random()*l/5;return e||(g=n?l/10:-l/10),K(p,g,G(c))}};x("rotate",{degrees:"The degrees of rotation"},"Rotates the parameter values by the center, according to the degrees (0-90)");var Y=function(e){var t=E();return function(n){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length,i=new Array(a>2?a-2:0),s=2;s<a;s++)i[s-2]=arguments[s];n=P(t,n,[r].concat(i));var o=T.a.apply(void 0,[e,r].concat(i)),c=Object(j.a)(U(n)),u=c.x,l=c.y,f=X(n,-u,-l),h=L(o)*r,p={};return H(f).forEach(function(e){var t=f[e],n=t.x,a=t.y,s=G([r].concat(i))(n,a,f[e]),o=10*h/s;p[e]={x:n*Math.cos(o)-a*Math.sin(o),y:a*Math.cos(o)+n*Math.sin(o),density:s}}),X(p,u,l)}},X=function(e,t,n){var r={};return H(e).forEach(function(i){return r[i]=Object(a.a)({},e[i],{x:e[i].x+t,y:e[i].y+n})}),r},$=function(e){return{coords:e[0],speed:e[1],width:e[2],stepNumber:e[3],history:e[4],effect:e[6],group:e[7]}};function ee(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return te(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return te(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ne=j.c,re=Math.cos,ae=Math.sin,ie=void 0,se=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];for(var s=r[0],o=T.a.apply(void 0,[t].concat(r)),c=ne().apply(void 0,r),u=c.x,l=c.y,f=c.diameter,h={},p=Math.PI,d=f/2*T.a.apply(void 0,[e].concat(r)),v=Object.keys(s).length,m=Object.keys(s).map(function(e){return Object(a.a)({},s[e],{id:e})}),y=function(e){var t,n,r,a=2*p*(e/v),i={x:u+d*re(a),y:l+d*ae(a)},c=m.sort(function(e,t){return se(e,i)-se(t,i)}),f=c[0].id;h[f]=(t=i,n=s[f],{x:(r=o)*t.x+(1-r)*n.x,y:r*t.y+(1-r)*n.y}),m=c.slice(1)},b=1;b<=v;b++)y(b);return h}},ce=function(e,t){return function(){var n=arguments.length<=6?void 0:arguments[6];if(!ie){var r=document.createElement("canvas");r.width=k.c,r.height=k.a,ie=r.getContext("2d")}var i=n.macros.find(function(t){return t.number===e}),s=n.macros.find(function(e){return e.number===t});if(!i||!s)return arguments.length<=0?void 0:arguments[0];var o,c=new Path2D(i.getEasyBlob()),u=(new Path2D(s.getEasyBlob()),s.parameters.map(function(e){return e.id})),l=Object(a.a)({},arguments.length<=0?void 0:arguments[0]),f=ee(u);try{for(f.s();!(o=f.n()).done;){var h=o.value,p=l[h];if(p){for(var d=p.x,v=p.y,m=0;ie.isPointInPath(c,d,v)&&m++<25;)d=(d+5)%k.c,v=(v+5)%k.a;l[h]=Object(a.a)({},l[h],{x:d,y:v})}}}catch(y){f.e(y)}finally{f.f()}return l}};function ue(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return le(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var fe=function(e,t,n){return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];a[0];for(var s=T.a.apply(void 0,[e].concat(a)),o=T.a.apply(void 0,[t].concat(a)),c=n?T.a.apply(void 0,[n].concat(a)):o+1,u={},l=Object.keys(s),f=o;f<c;f++){var h=f%l.length;u[l[h]]=s[l[h]]}return u}},he=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var s,o=n.map(function(e){return T.a.apply(void 0,[e].concat(r))}),c=T.a.apply(void 0,[e].concat(r)),u=Object(a.a)({},r[0]),l=ue(o);try{var f=function(){var e=s.value,t=o[0];if(t===e)return"continue";var n=Object.keys(e),r=Object.keys(t);n.forEach(function(e,n){u[e]=Object(a.a)({},t[r[n%r.length]]),u[e].x=c*(u[e].x-k.b)+k.b,u[e].y=c*(u[e].y-k.b)+k.b})};for(l.s();!(s=l.n()).done;)f()}catch(h){l.e(h)}finally{l.f()}return u}},pe=function(){return function(){return{}}},de=n(279),ve=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=T.a.apply(void 0,[e].concat(n)),i={},s=0;for(var o in n[0]){var c=n[0][o];c&&(i[o]={x:(c.x+s*a)%k.c,y:(c.y+s*a)%k.a},s++)}return i}};function me(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ye(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ye(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}x("navierStokes",{parameters:"",forceEmitters:"",diffusionParam:"",root:""},"Navier stokes simulationn. force=array of force parameters");var be=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:64,s=void 0,o=.1*i,c=i/k.c,u=i/k.a,l=i+2,f=(i+2)*(i+2),h=new Float32Array(f),p=new Float32Array(f),d=new Float32Array(f),v=new Float32Array(f),m=new Float32Array(f),y=new Float32Array(f),b=new Float32Array(f),g=-.5/i*1,O=.5*i,j=i+.5,w=new Array(l),x=0;x<l;x++){w[x]=new Array(l);for(var S=0;S<l;S++)w[x][S]=x+S*l}for(x=0;x<f;x++)y[x]=v[x]=m[x]=d[x]=h[x]=p[x]=b[x]=0;var A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p;e.set(b),t.set(b),n.set(b)},M=function(e,t,n,r,a){var i;C(e,n,a),C(t,r,a),i=n,n=e,N(1,e=i,n,a),i=r,r=t,N(2,t=i,r,a),q(e,t,n,r),i=n,n=e,e=i,i=r,r=t,t=i,I(1,e,n,n,r,a),I(2,t,r,n,r,a),q(e,t,n,r)},R=function(e,t,n,r,a){C(e,t,a),N(0,t,e,a),I(0,e,t,n,r,a)},C=function(e,t,n){for(var r=0;r<f;r++)e[r]+=n*t[r]},N=function(e,t,n,r){for(var a=1;a<f;a++)t[a]=n[a]*s;_(e,t)},q=function(e,t,n,r){for(var a,s,o,c,u,l,f,h,p=1;p<=i;p++){a=w[0][p-1],o=w[0][p],c=w[0][p+1],f=o-1,u=i+(h=o+1);for(var d=h;d<u;d++)n[d]=0,r[d]=(e[++h]-e[++f]+t[++c]-t[++a])*g}_(0,r),_(0,n);for(var v=0;v<6;v++){for(var m=1;m<=i;m++)for(l=w[0][m-1],o=w[0][m],c=w[0][m+1],s=n[o],o++,x=1;x<=i;x++)n[o]=s=.25*(r[o]+n[++l]+n[++o]+n[++c]+s);_(0,n)}for(var y=1;y<=i;y++)for(l=w[0][y-1],o=w[0][y],c=w[0][y+1],f=o-1,h=o+1,x=1;x<=i;x++)e[++o]-=O*(n[++h]-n[++f]),t[o]-=O*(n[++c]-n[++l]);_(1,e),_(2,t)},I=function(e,t,n,r,a,s){for(var c=1;c<=i;c++)for(var u=c*l,f=1;f<=i;f++){var h=f-o*r[++u],p=c-o*a[u];h<.5&&(h=.5),h>j&&(h=j);var d=0|h,v=d+1;p<.5&&(p=.5),p>j&&(p=j);var m=0|p,y=m+1,b=h-d,g=1-b,O=p-m,k=1-O,x=w[0][m],S=w[0][y];t[u]=g*(k*n[d+x]+O*n[d+S])+b*(k*n[v+x]+O*n[v+S])}_(e,t)},_=function(e,t){var n;switch(e){case 1:for(n=1;n<=i;n++)t[n]=t[n+l],t[w[n][i+1]]=t[w[n][i]],t[w[0][n]]=-t[w[1][n]],t[w[i+1][n]]=-t[w[i][n]];break;case 2:for(n=1;n<=i;n++)t[n]=-t[n+l],t[w[n][i+1]]=-t[w[n][i]],t[w[0][n]]=t[w[1][n]],t[w[i+1][n]]=t[w[i][n]];break;default:for(n=1;n<=i;n++)t[n]=t[n+l],t[w[n][i+1]]=t[w[n][i]],t[w[0][n]]=t[w[1][n]],t[w[i+1][n]]=t[w[i][n]]}var r=w[0][i+1];t[0]=(t[1]+t[l])/2,t[r]=(t[1+r]+t[w[i][0]])/2,t[i+1]=(t[i]+t[i+1+l])/2,t[i+1+r]=t[i+r]+t[w[i+1][i]]},D=void 0,F=E();return function(){for(var o=arguments.length,l=new Array(o),f=0;f<o;f++)l[f]=arguments[f];var b=l[0],g=l[1];s=T.a.apply(void 0,[n].concat(l)),b=P(F,b,l.slice(1));var O=l[6];O.smokeResolution=i,O.D=d,O.IX=w;var j=e&&T.a.apply(void 0,[e].concat(l));if(j&&0!==Object.keys(j).length){var S=Object.keys(j).map(function(e){return j[e]}).filter(function(e){return e});if(S[0]){var E=S[0],C=E.x,N=E.y;D||(D=[C,N]),A(y,v,m);var q=D[0]-C,I=D[1]-N,_=0|Math.pow(q*q+I*I,T.a.apply(void 0,[r].concat(l)));for(_=_<1?1:_,x=0;x<_;x++){var L=(D[0]-x/_*q)*c|0,B=(D[1]-x/_*I)*u|0;G=w[L][B],h[G]=-q/6,p[G]=-I/6,d[G]=50}D[0]=C,D[1]=N}}else D=void 0;var z,J=me(T.a.apply(void 0,[t].concat(l)));try{for(J.s();!(z=J.n()).done;){var V=z.value,H=T.a.apply(void 0,[V[0]].concat(l))*c|0,U=T.a.apply(void 0,[V[1]].concat(l))*u|0,G=w[H][i-U];h[G]=T.a.apply(void 0,[V[2]].concat(l)),p[G]=-1*T.a.apply(void 0,[V[3]].concat(l))}}catch(re){J.e(re)}finally{J.f()}M(h,p,v,m,.1),R(d,y,h,p,.1);var W={};for(var K in b){var Q=b[K],Z=Q.x,Y=Q.y;if(!isNaN(Z)&&!isNaN(Y)){var X=Math.floor(Z*i/(k.c-k.b)),$=Math.floor(Y*i/(k.a-k.b)),ee=(G=w[Math.min(X,i)][Math.min($,i)],h[G]),te=p[G],ne=b[K].density||1;W[K]=Object(a.a)({},Q,{x:Z+g/ne*10*ee,y:Y+g/ne*10*te})}}return W}};function ge(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Oe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Oe(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ke=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=n[0],i=n[6],s={},o=function(e){var r,o=!1,c=ge(t);try{var u=function(){var t=r.value;return t=T.a.apply(void 0,[t].concat(n)),(t=i.macros.find(function(e){return e.number===t}))?t.parameters.some(function(t){return t.id===e})?(o=!0,"break"):void 0:"continue"};for(c.s();!(r=c.n()).done;){var l=u();if("continue"!==l&&"break"===l)break}}catch(f){c.e(f)}finally{c.f()}o&&(s[e]=a[e])};for(var c in a)o(c);return s}},je=function(e,t,n){return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return T.a.apply(void 0,[e].concat(a))?T.a.apply(void 0,[t].concat(a)):void 0===n?a[0]:T.a.apply(void 0,[n].concat(a))}},we=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=T.a.apply(void 0,[e].concat(r));T.a.apply(void 0,[t].concat(r));return i<=t}},xe=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=T.a.apply(void 0,[e].concat(r));T.a.apply(void 0,[t].concat(r));return i>=t}},Se=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=T.a.apply(void 0,[e].concat(r));T.a.apply(void 0,[t].concat(r));return i===t}},Pe=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=T.a.apply(void 0,[e].concat(r));T.a.apply(void 0,[t].concat(r));return i!==t}},Ee=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=T.a.apply(void 0,[e].concat(r));T.a.apply(void 0,[t].concat(r));return i&&t}},Te=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=T.a.apply(void 0,[e].concat(r));T.a.apply(void 0,[t].concat(r));return i||t}},Ae=function(){var e=void 0;return function(){var t=arguments.length<=0?void 0:arguments[0],n=Object.keys(t).map(function(e){return t[e]}).filter(function(e){return e});if(0===n.length)return e||0;var r=Object(j.e)(n),a=r.x,i=r.y;if(e){var s=Math.sqrt(Math.pow(a-e.x,2)+Math.pow(i-e.y,2));return e={x:a,y:i},s}return e={x:a,y:i},0}};x("source",{x:"",y:""},"Transforms parameter to (x,y) coordinate");var Me=function(e,t){return function(n){for(var r={},i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];var c=T.a.apply(void 0,[e,n].concat(s)),u=T.a.apply(void 0,[t,n].concat(s));for(var l in n)r[l]=Object(a.a)({},n[l],{x:c,y:u});return r}},Re=n(133);x("rewind",{distance:"how many triggers to rewind by"},"Rewinds the parameter values to distance-many triggers ago");var Ce=function(e){return function(t,n,r,a,i){var s=i[i.length-e];return s||t}};x("reset",{},"Resets the parameter state to the initial values");var Ne=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function(t,n,r,a,i,s,o){if(i[0]){if(e){var c={};return Object.keys(t).forEach(function(e){return c[e]=i[0][e]}),c}return o&&Object(Re.b)("planarReset",o.id),i[0]}return t}},qe=function(e){var t=void 0,n=0;return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];var s=$(a),o=s.coords,c=(s.stepNumber,s.history);void 0===t&&(t=c.length-1);var u=t-T.a.apply(void 0,[e].concat(a));if(u<0)return t=void 0,o;var l=c.slice(u,t);return l[++n%l.length]}};function Ie(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return _e(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _e(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function _e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}x("snapshot",{snapNumber:""},"Go to snapshot given in argument");var De=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=$(n).effect,i=T.a.apply(void 0,[e].concat(n));return a.currentSnapshotParameter.set(i),{}}};x("nextSnapshot",{},"Go to next snapshot-- looping back to first snapshot if at the end.");var Fe=function(){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=$(t).effect,a=r.currentSnapshotParameter.get()||0;return r.currentSnapshotParameter.set((a+1)%r.snapshots.length),{}}};x("interpolateSnapshot",{snapshotNumber:"",percentage:"how much of the snapshot to use"},"Go to next snapshot-- looping back to first snapshot if at the end.");var Le=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var s=$(r),o=s.coords,c=s.effect,u=T.a.apply(void 0,[e].concat(r)),l=T.a.apply(void 0,[t].concat(r)),f=c.snapshots[u%c.snapshots.length];if(!f)return o;var h,p=Ve(f,o).slice(0,Math.floor(f.length*(l/50))),d=Object(a.a)({},o),v=Ie(p);try{for(v.s();!(h=v.n()).done;){var m=h.value,y=m.parameter,b=m.coordinates,g=m.min,O=m.max;y.id in o&&(void 0!==g&&void 0!==O&&(y.min=g,y.max=O),d[y.id]=b)}}catch(k){v.e(k)}finally{v.f()}return d}},Be=function(e){return e*e},ze=Math.sqrt,Je=function(e,t){return ze(Be(e.x-t.x)+Be(e.y-t.y))},Ve=function(e,t){return(e=Object(r.a)(e)).filter(function(e){return e.parameter.id in t}).sort(function(e,n){return Je(n.coordinates,t[n.parameter.id])-Je(e.coordinates,t[e.parameter.id])})};function He(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ue(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ue(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ge=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=E();return function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];var o=$(n).effect,c=($(n).history,$(n).coords);c=P(i,c,n.slice(1));var u={};for(var l in c){var f=We(l,o);if(f){var h=f.context,p=h.subDevice||h.subDevice||h.device||h.track||h.lfoTrack;if(p){var d=p.id||p.name||p.number;d&&(u[d]||(u[d]={}),u[d][l]=c[l])}}}var v={};for(var m in u)v=Object(a.a)({},v,t[0%t.length].apply(t,[u[m]].concat(Object(r.a)(n.slice(1)))));return v}},We=function(e,t){var n,r=He(t.groups);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(e in a.idToParameter)return a.idToParameter[e]}}catch(i){r.e(i)}finally{r.f()}},Ke=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=$(n).coords,i=T.a.apply(void 0,[e].concat(n)),s={};for(var o in a)o in i||(s[o]=a[o]);return s}},Qe=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a={};return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var s=$(n).effect,o=$(n).history,c=$(n).coords;o.length<1&&(a={});var u,l=[],f=He(t);try{for(f.s();!(u=f.n()).done;){var h=u.value;h in a||(a[h]=s._parameters.filter(Ze(h))),l=[].concat(Object(r.a)(l),Object(r.a)(a[h]))}}catch(v){f.e(v)}finally{f.f()}var p=new Set(l.map(function(e){return e.id})),d={};return p.forEach(function(e){return d[e]=c[e]}),d}},Ze=function(e){return function(t){return e=e.toLowerCase(),Ye(t).some(function(t){return t.includes(e)})}},Ye=function(e){var t=[];return e.context&&(e.context.subDevice&&e.context.subDevice.name&&t.push(e.context.subDevice.name.toLowerCase()),e.context.effect&&e.context.effect.name&&t.push(e.context.effect.name.toLowerCase()),e.context.midiEffect&&e.context.midiEffect.name&&t.push(e.context.midiEffect.name.toLowerCase())),e.name&&t.push(e.name.toLowerCase()),t};x("send",{type:"",value:""},"Publishes a message of a given type with a value");var Xe=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=T.a.apply(void 0,[e].concat(r)),s=T.a.apply(void 0,[t].concat(r));return Object(Re.b)(i,s),r[0]}};x("receive",{type:"",function:"","skipEmpty=true":""},"Receives a message and calls a function when it does");var $e=function(e,t){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n=Object(S.a)(e);return function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];var i=n();return t&&i.map(function(e){return"function"===typeof t?T.a.apply(void 0,[t].concat(r)):t})[0]||r[0]}};x("translate",{x:"",y:""},"Translate parameters by (x,y) amount");var et=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var s=T.a.apply(void 0,[e].concat(r)),o=T.a.apply(void 0,[t].concat(r)),c=r[0],u={};for(var l in c)if(c[l]){var f=s/(c[l].density||1),h=o/(c[l].density||1);u[l]=Object(a.a)({},c[l],{x:(c[l].x+f)%k.c,y:(c[l].y+h)%k.a})}return u}},tt=n(175),nt=Object.keys,rt=Object.values;x("bounce",{degrees:"The direction that the bounce goes by"},"Moves the parameters by direction of the degrees, and bounces off any walls");var at=function(e){var t=E(),n=1,i=1,s=Object(S.a)("planarReset");return function(o){for(var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,u=arguments.length,l=new Array(u>2?u-2:0),f=2;f<u;f++)l[f-2]=arguments[f];var h=l[4];s().some(function(e){return e===h.id})&&(n=1,i=1);var p=-1*(T.a.apply(void 0,[e,c].concat(l))-90),d=L(360-p),v=Math.tan(d),m=-1*i,y=n*v*m;90===p?(y=n,m=0):-90===p?(y=-1*n,m=0):0==p&&(m=-1*i,y=0);var b=G([c].concat(l)),g=!1,O=!1;if(function(e,t,n,a){var i=Math.min.apply(Math,Object(r.a)(e.map(function(e){var r=e.x,i=e.y,s=e.density;return r+t*n*10/a(r,i,{density:s})}))),s=Math.max.apply(Math,Object(r.a)(e.map(function(e){var r=e.x,i=e.y,s=e.density;return r+t*n*10/a(r,i,{density:s})})));return t>0?Math.ceil(s)>=k.c-k.b:Math.floor(i)<=k.b}(rt(o),y,c,b)&&(n*=-1,y*=-1,g=!0),function(e,t,n,a){var i=Math.min.apply(Math,Object(r.a)(e.map(function(e){var r=e.x,i=e.y,s=Object(tt.a)(e,["x","y"]);return i+t*n*10/a(r,i,s)}))),s=Math.max.apply(Math,Object(r.a)(e.map(function(e){var r=e.x,i=e.y,s=Object(tt.a)(e,["x","y"]);return i+t*n*10/a(r,i,s)})));return t>0?Math.ceil(s)>=k.a-k.b:Math.floor(i)<=k.b}(rt(o),m,c,b)&&(i*=-1,m*=-1,g||(n*=-1),O=!0),g||O)Object(F.c)(g);else{var j=P(t,o,[c].concat(l));o=j}return nt(o).map(function(e){var t=o[e],n=b(t.x,t.y,t),r=t.x+y*c*10/n,a=t.y+m*c*10/n,i={};return i[e]={x:r,y:a,density:n},i}).reduce(function(e,t){return Object(a.a)({},e,t)},{})}};x("vectorField",{"x-function":"(x,y) => x*y","y-function":"(x,y) => y*y-x*x","boundary-function":""},"Runs the x and y component functions on every parameter, to generate the new position. Ex: vectorField((x,y) => x*y, (x,y) => y*y-x*x, reset())");var it=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ne(!0),i=E();return function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];var u=$(o),l=u.coords,f=(u.history,u.speed);l=P(i,l,o.slice(1));var h=f/80,p=G(o.slice(1)),d={},v={};for(var m in l){var y=l[m],b=y.x,g=y.y,O=p(b,g,l[m]),j=ot(st([b,g],-k.c/2,-k.a/2),.1),w=ht(e,t,j),x=ut(w,j),S=st(ot(x,10),k.c/2,k.a/2),E=ut([b,g],ot(ft(S,[b,g]),h/O));ct(S=E)?v[m]={x:S[0],y:S[1]}:d[m]={x:S[0],y:S[1],density:O}}return Object.keys(v).length>0&&Object(F.c)(!0),Object(a.a)({},d,n.apply(void 0,[v].concat(Object(r.a)(o.slice(1)))))}},st=function(e,t,n){return ut(e,[t,n])},ot=function(e,t){return lt(t,e)},ct=function(e){var t=Object(i.a)(e,2),n=t[0],r=t[1];return n<=k.b||n>=k.c-k.b||r<=k.b||r>=k.a-k.b},ut=function(e,t){return e.map(function(e,n){return e+t[n]})},lt=function(e,t){return t.map(function(t){return t*e})},ft=function(e,t){return e.map(function(e,n){return e-t[n]})},ht=function(e,t,n){var r=Object(i.a)(n,2),a=r[0],s=r[1];return[e(a,s),t(a,s)]};x("alt",{arg1:"",arg2:"",argN:""},"Alternates between the arguments with every trigger received by this function");var pt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=0;return function(){for(var e=r++%t.length,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return T.a.apply(void 0,[t[e]].concat(a))}};x("every",{n:"",fn:"",elseFn:""},"Every n-many triggers do something, otherwise do something else. The else is optional.");var dt=function(e,t,n){var r=0;return function(){for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];var o=T.a.apply(void 0,[e].concat(i));return 0===++r%o?t.apply(void 0,i):n?n.apply(void 0,i):i[0]}};x("altn",{n:"How many triggers it takes to increment the output conditional",arg1:"Output conditional",arg2:"Output conditional",argN:"Output conditional (will loop back to arg1 after this this)"},"Alternates between the arguments every n-many triggers received by this function");var vt=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=0,i=0;return function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];var o=T.a.apply(void 0,[e].concat(r));++a%o===0&&i++;var c=n[i%n.length];return T.a.apply(void 0,[c].concat(r))}},mt=Math.sin,yt=function(){var e=E();return function(){console.log("fluid called");for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];console.log(n),n[0]=P(e,n[0],n.slice(1));var a=$(n).group,i=I(_(I(fe(0,1),it(function(e,t){return e*t-mt(e)},function(e,t){return t/e},Ne(!0))),be(vt(8,fe(0),function(){return{}},fe(1,2),fe(25,26),function(){return{}}),[a.force(1),a.force(2),a.force(3)],.92,.6)),dt(8,je(we(I(fe(0,1),Object(j.d)()),10),I(fe(0,1),ve(10))))).apply(void 0,n);return console.log("ret =",i),i}},bt=function(e){return I(_(I(fe(function(e){return e},0),it(function(e,t){return e*t-mt(e)},function(e,t){return t/e},Ne(!0))),be(vt(8,fe(function(e){return e},0),function(){return{}},fe(function(e){return e},1),fe(function(e){return e},25),function(){return{}}),[e.force(1),e.force(2),e.force(3)],e.knob("diffyx",.92,.9,1),e.knob("rootxy",.6,.01,.8))),dt(8,je(we(I(fe(0,1),Object(j.d)()),10),I(fe(0,1),ve(10)))))},gt=n(126),Ot=n(23);function kt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var jt=n(14),wt=n(123),xt=n(20),St=function(e){return function(t){for(var n={},r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];var o=T.a.apply(void 0,[e].concat(i));for(var c in t)n[c]=Object(a.a)({},t[c],{density:o*(t[c].density||1)});return n}},Pt=function(){return function(e){return{}}};x("beat",{step:"The step within the beat at which this executes the ifCond condition",beat:"The total number of steps within which we determine if the step has occured",ifCond:"The condition that is executed when the step is reached",elseCond:"The condition that is executed otherwise"},"Conditions on a certain step within a beat. For example, beat(0,32,a,b) executes a on the 1st beat of every bar, and executes b on every other step");var Et=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return function(a,i,s,o,c,u){return o%t===e?Object(T.a)(n,a,i,s,o,c,u):r?Object(T.a)(r,a,i,s,o,c,u):a}};function Tt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var At=n(430),Mt=n(62),Rt=n(420);function Ct(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Nt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nt(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var It=function(e){Object(l.a)(n,e);var t=qt(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V,i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;return Object(s.a)(this,n),(e=t.call(this,"Plane Group",o)).initialBulkValues={},e.effect=u,e.id=Object(xt.uuid)(),e._parameters=r,e.track=o,e.context=i||(new wt.a).forTrack(o),e.parameterIds=[],e.counter=0,e.parameters=[],e.algorithmParameter=new jt.a("width",Object(c.a)(e),function(t,n){n===J&&(e.navier||(e.navier=bt(Object(c.a)(e))))},{defaultValue:a,min:0,max:1}),e.widthParameter=new jt.a("width",Object(c.a)(e),function(){return[]},{defaultValue:12,min:4,max:30}),e.speedParameter=new jt.a("speed",Object(c.a)(e),function(){return[]},{defaultValue:1,min:.1,max:8}),e.registerParameter(e.algorithmParameter),e.registerParameter(e.widthParameter),e.registerParameter(e.speedParameter),e.bounce=at(45),e.life=Z(),e.swap=W(),e.rotate=Y(3),e.history=[],e.updateIdToParameter(),e.track.sequencerEngine.dispatch(Object(Ot.ub)(e.initialBulkValues)),e}return Object(o.a)(n,[{key:"registerParameter",value:function(e){this.context&&e.setContext(this.context),this.initialBulkValues=Object(a.a)({},this.initialBulkValues,e.setStore(this.track.store)),this.parameters.push(e)}},{key:"ungroupParameter",value:function(e){var t=this._parameters.indexOf(e);this._parameters.splice(t,1);e.hasGroup;e.hasGroup=void 0;var n,r=Ct(this.variations);try{for(r.s();!(n=r.n()).done;){var a=n.value;Object.keys(a).includes(e.id)&&delete a[e.id]}}catch(i){r.e(i)}finally{r.f()}}},{key:"updateIdToParameter",value:function(){var e=this;this.idToParameter={},this._parameters.forEach(function(t){return e.idToParameter[t.id]=t})}},{key:"width",get:function(){return this.widthParameter.get()},set:function(e){this.widthParameter.set(e)}},{key:"speed",get:function(){return this.speedParameter.get()},set:function(e){this.speedParameter.set(e)}},{key:"algorithm",get:function(){return this.algorithmParameter.get()},set:function(e){this.algorithmParameter.set(e)}},{key:"getAllParameterCoords",value:function(){var e=this,t={};return D(this._parameters).forEach(function(n,r){return t[e._parameters[r].id]=n}),t}},{key:"onTrigger",value:function(e,t,n,r){var a=this.sequenceStep(e,t,n);if(a)return a;this.counter++;var i=this._parameters,s={};i.forEach(function(e){s[e.id]=e.getCoordinates()}),this.history.length<5&&this.history.push(s);var o=[this.speed,this.width,e,this.history,r,this.effect,this],c={};if(0===i.length)return{};if(this.algorithm===J)c=this.navier.apply(this,[s].concat(o));else if("LIFE"===this.algorithm)c=this.life.apply(this,[s].concat(o));else if("ROTATE"===this.algorithm)c=this.swap.apply(this,[s].concat(o));else if("BOUNCE"===this.algorithm){var u=this.bounce.apply(this,[s].concat(o));c=this.life(u,this.speed/8,this.width,e,this.history,r,this.effect)}else if("BOUNCE_2"===this.algorithm){var l=this.bounce(s,this.speed,this.width,e,this.history,r,this.effect);c=this.swap.apply(this,[l].concat(o))}else if("ROTATE_ANGLE"===this.algorithm)c=this.rotate.apply(this,[s].concat(o));else if("SPIRAL"===this.algorithm){var f=this.life.apply(this,[s].concat(o));c=this.rotate.apply(this,[f].concat(o))}else"SCRIPT"===this.algorithm&&this.script&&(c=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return e.apply(void 0,[t].concat(r))}.apply(void 0,[this.script,s].concat(o)));if(0===Object.keys(c).length)return{};var h={};for(var p in c)try{var d=c[p].density||1,v=this.idToParameter[p];if(v){var m=v.setCoordinates(c[p].x,c[p].y,t,d*n/1e3,!0),y=m.id,b=m.value;h[y]=b}}catch(g){console.log("ERROR = ",g)}return h}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.code&&(this.code=e.code),this.restartScript(),e.id&&(this.id=e.id),this.algorithm=e.algorithm,Object(gt.a)(e,"algorithmParameter",this.algorithmParameter),Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,e,t),e.id&&(this.id=e.id),this.algorithm=e.algorithm,Object(gt.a)(e,"algorithmParameter",this.algorithmParameter),this.speed=e.speed,this.width=e.width,this.parameterIds=e.parameters,e.stepToState&&(this.stepToState=e.stepToState),e.variations&&(this.variations=e.variations,this.generation=e.generation)}},{key:"loadParameters",value:function(e,t){var n,r=this.parameterIds.map(function(e){return t[e]?t[e].id:e}),a=Ct(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;r.includes(i.id)&&!this._parameters.includes(i)&&(this._parameters.push(i),i.hasGroup=this)}}catch(s){a.e(s)}finally{a.f()}}},{key:"getJson",value:function(){var e=Object(a.a)({},Object(u.a)(Object(h.a)(n.prototype),"getJson",this).call(this),{id:this.id,parameters:this._parameters.map(function(e){return e.id}),algorithm:this.algorithm,width:this.width,code:this.code,speed:this.speed,stepToState:this.stepToState,generation:this.generation});return e=Object(gt.b)(e,"algorithmParameter",this.algorithmParameter)}},{key:"updateParameter",value:function(e){if(void 0!==this.selectedVariation){var t=this.variations[this.selectedVariation];t&&(t[e.id]=e.getCoordinates())}var n=e.getCoordinates();if(void 0!==this.stepSelected){var r=this.stepToState[this.stepSelected]||{};r[e.id]=n,this.stepToState[this.stepSelected]=Object(a.a)({},r)}this.history&&this.history[0]&&(this.history[0][e.id]=n)}},{key:"stop",value:function(){this.restartScript(),this.updateIdToParameter(),this.history=[]}},{key:"replaceParameter",value:function(e){for(var t in this._parameters)if(this._parameters[t].id===e.id)return this._parameters[t]=e,this.updateIdToParameter(),void(e.hasGroup=this)}}]),n}(Object(Mt.a)(function(e){return function(e){Object(l.a)(n,e);var t=Tt(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).code="",e.script=void 0,e.forces={},e}return Object(o.a)(n,[{key:"eval",value:function(e){var t=this.clearVariables();for(var n in this.code=e,this.script=this.evalWithContext(e),t)this[n+"Parameter"]&&this[n+"Parameter"].copyFrom(t[n],this.track.sequencerEngine);this.updateVariablesRedux()}},{key:"hasSyntaxError",value:function(e){return void 0===this.evalWithContext(e)}},{key:"restartScript",value:function(){""!==this.code&&this.eval(this.code)}},{key:"evalWithContext",value:function(e){var t=this;try{var n=e.split(";"),r=n[n.length-1],i=n.slice(0,n.length-1).join(";"),s=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return t.newVar(e,n,r,a,void 0,i),function(){return t[e+"Parameter"].get()}};return new Function("with(this) { "+i+"; return s("+r+")}").call({rotate:Y,translate:et,s:I,random:C,fluid:yt,circle:oe,every:dt,none:pe,altn:vt,loop:qe,snapshot:De,byDevice:Ge,spread:ve,life:Z,send:Xe,rewind:Ce,lazy:T.a,proportion:he,slice:fe,preventIntersect:ce,gte:xe,lte:we,eq:Se,neq:Pe,diameter:j.d,geometry:j.c,diff:Ae,and:Ee,or:Te,reset:Ne,alt:pt,slow:St,clear:Pt,navierStokes:be,swap:W,beat:Et,bounce:at,vectorField:it,expand:Q,search:Qe,p:_,part:N,interpolateSnapshot:Le,nextSnapshot:Fe,load:function(e){return t.loadScript(e)},receive:$e,sin:Math.sin,cos:Math.cos,tan:Math.tan,source:Me,cond:je,mac:ke,not:Ke,WIDTH:k.c,HEIGHT:k.a,knob:s,force:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.variables.length,n=[s("force.x ".concat(e),10*e,0,k.c,!0),s("force.y (".concat(e,")"),10*e,0,k.a,!0),s("force.dx (".concat(e,")"),100,-k.c,k.c,!0),s("force.dy (".concat(e,")"),100,-k.a,k.a,!0)];return t.forces=Object(a.a)({},t.forces),t.forces[e]=t.variables.slice(t.variables.length-4),n},diffusion:function(){return s("diffusion",.75,.7,1.2)}})}catch(o){return void console.log("error = ",o)}}},{key:"knob",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.newVar(e,t,r,a,void 0,i),function(){return n[e+"Parameter"].get()}}},{key:"force",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.variables.length,n=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return e.newVar(t,n,r,a,void 0,i),function(){return e[t+"Parameter"].get()}},r=[n("force.x ".concat(t),10*t,0,k.c,!0),n("force.y (".concat(t,")"),10*t,0,k.a,!0),n("force.dx (".concat(t,")"),100,-k.c,k.c,!0),n("force.dy (".concat(t,")"),100,-k.a,k.a,!0)];return this.forces=Object(a.a)({},this.forces),this.forces[t]=this.variables.slice(this.variables.length-4),r}},{key:"loadScript",value:function(e){var t=Object(de.b)(e),n=this.evalWithContext(t,!1);return function(){return n}}}]),n}(e)},At.a,O.a,function(e){return function(e){Object(l.a)(n,e);var t=kt(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).stepToState={},e.sequencerEnabled=!0,e.stepSelected=void 0,e}return Object(o.a)(n,[{key:"deleteStateAtStep",value:function(e){delete this.stepToState[e],this.effect.resetValues()}},{key:"selectStep",value:function(e){var t=this.applySequencedState(this.stepToState[e],void 0,.001);this.stepSelected=e,t&&this.track.sequencerEngine.dispatch(Object(Ot.ub)(t))}},{key:"unselectStep",value:function(){this.stepSelected=void 0}},{key:"recordStateAtStep",value:function(e){var t={};this._parameters.forEach(function(e){return t[e.id]=e.getCoordinates()}),this.stepToState[e]=t,this.stepSelected=void 0}},{key:"sequenceStep",value:function(e,t,n){if(!this.sequencerEnabled)return!1;e=Math.floor(e/2);var r=this.stepToState[e];return this.applySequencedState(r,t,n)}},{key:"applySequencedState",value:function(e,t,n){var r=this;if(e){var a={},i=function(i){var s=r._parameters.find(function(e){return e.id===i});if(!s)return"continue";var o=s.setCoordinates(e[i].x,e[i].y,t,n/1e3,!0),c=(o.id,o.value);a[i]=c};for(var s in e)i(s);return a}}}]),n}(e)})(Rt.a)),_t=n(7),Dt=n.n(_t),Ft=n(76);function Lt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}Math.abs,Math.pow,Math.sqrt;function Bt(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return zt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zt(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Jt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var Vt=Math.sqrt,Ht=function(e){return Math.pow(e,2)},Ut=function(e,t,n,r){return Vt(Ht(n-e)+Ht(r-t))},Gt=(n(358),n(310)),Wt=n(275),Kt=n(42),Qt=n.n(Kt),Zt=n(56),Yt=n(129),Xt=(n(79),n(122));function $t(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return en(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return en(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function en(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function tn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var nn=n(1600),rn=n(805),an=n(806);window.tanDiff=20;var sn=function(e,t,n){var r=cn((on(n/e)-1)/(1-on(t/e))+on(t)),a=t+r,i=t-r;return{x1:2*e-a*e/t,y1:a,x2:2*e-i*e/t,y2:i}},on=function(e){return Math.pow(e,2)},cn=Math.sqrt,un=n(299),ln=n(594),fn=n(112);function hn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return pn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function pn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function dn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var vn=function(e){Object(l.a)(n,e);var t=dn(n);function n(e,r,a,i){var o;return Object(s.a)(this,n),(o=t.call(this)).id=Object(xt.uuid)(),o.name=e,o.number=a,o.parameters=r,o.effect=i,o.signal=new Dt.a.Signal(0),o.signalParameter=new fn.a("macro",o.signal,function(){},{min:0,defaultValue:0,max:1,useInstrumentModulators:!0}),o.signalParameter.setContext((new wt.a).forTrack(o.effect.track)),o.subMacros={},o.initColor(),o}return Object(o.a)(n,[{key:"dispose",value:function(){var e=this;this.lastHull=void 0,this.lastCentroid=void 0;var t=this.effect.track.sequencerEngine.lfos.map(function(e){return e.lfo}),n=function(n){var r=t.find(function(e){return e.number===parseInt(n)});e.disconnectFromLFO(r)};for(var r in this.subMacros)n(r);this.parameters.forEach(function(e){return e.planeMacro=void 0}),this.signalParameter.dispose(),this.signal.dispose(),this.signalParameter=void 0,this.subMacros=void 0,this._disposed=!0}},{key:"disposeSubMacro",value:function(e){var t=e.parameter;this.signal.disconnect(e.scaler),e.dispose(),t.set(t.get(!0),!0,!0)}},{key:"disconnectFromLFO",value:function(e){var t=this,n=this.subMacros[e.number];n.forEach(function(e){t.disposeSubMacro(e)}),delete n[e.number],this.signalParameter.disconnectFromLFO(e)}},{key:"connectToLFO",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this.parameters.filter(function(n){return!t.subMacros[e.number]||!t.subMacros[e.number].some(function(e){return e.parameter===n})}).filter(function(t){return t.context&&(!t.context.lfoTrack||t.context.lfoTrack.lfo!==e)}).filter(function(e){return"LFO Max"!==e.name&&"LFO Phase"!==e.name}).filter(function(e){return e.audioParam||e.audioParams}),i=(this.subMacros[e.number],this.subMacros[e.number]||[]);this.subMacros[e.number]=[].concat(Object(r.a)(i),Object(r.a)(a.map(function(e){var n=new ln.a(e,e.min,e.max);return n.withSignal(t.signal),e.set(e.get(!0),!0,!0),n}))),n&&!this.lfos.includes(e)&&this.signalParameter.connectToLFO(e)}},{key:"fromJson",value:function(e,t){this.name=e.name,this.id=e.id,this.number=e.number,this.parameterIds=e.parameters,this.signalParameterJson=e.signalParameter,this.isCopy=t,e.color?this.color=e.color:this.initColor()}},{key:"loadParameters",value:function(e,t){var n,r=this.parameterIds.map(function(e){return t[e]?t[e].id:e}),a=hn(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;r.includes(i.id)&&!this.parameters.includes(i)&&(this.parameters.push(i),i.planeMacro=this)}}catch(u){a.e(u)}finally{a.f()}if(this.signalParameterJson){this._loadedSignalParameter||(this.signalParameter.fromJson(this.signalParameterJson,this.effect.track.sequencerEngine,this.isCopy),this._loadedSignalParameter=!0);var s,o=hn(this.signalParameter.lfos);try{for(o.s();!(s=o.n()).done;){var c=s.value;this.connectToLFO(c,!1)}}catch(u){o.e(u)}finally{o.f()}}}},{key:"lfos",get:function(){return this.signalParameter.lfos}},{key:"free",value:function(){var e=this;this.parameters.forEach(function(t){return e.removeParameter(t)})}},{key:"getJson",value:function(){return{name:this.name,color:this.color,id:this.id,number:this.number,parameters:this.parameters.map(function(e){return e.id}),signalParameter:this.signalParameter.getJson()}}},{key:"removeParameter",value:function(e){var t=this;if(this.lastHull=void 0,this.lastCentroid=void 0,!this._disposed){this.parameters=this.parameters.filter(function(t){return t!==e}),e.planeMacro=void 0;var n=Object.values(this.subMacros).flat().filter(function(t){return t&&t.parameter===e});for(var r in n.forEach(function(e){return t.disposeSubMacro(e)}),this.subMacros)this.subMacros[r]=this.subMacros[r].filter(function(e){return!n.includes(e)})}}},{key:"isPlaneMacro",get:function(){return!0}},{key:"isEmpty",value:function(){return 0===this.parameters.length}},{key:"getCoordinates",value:function(){return this.coordinates}},{key:"coordinates",get:function(){if(0===this.parameters.length)return 0;var e=this.parameters.map(function(e){return e.getCoordinates()});return this._coordinates=Object(j.a)(e),this._coordinates}},{key:"diameter",get:function(){return Object(j.b)(this.parameters.map(function(e){return e.getCoordinates()}))}},{key:"getAllCoordinates",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return D(this.parameters,e)}},{key:"getGeometry",value:function(){if(0===this.parameters.length)return{x:0,y:0,diameter:0};var e=this.getAllCoordinates();return e?Object(a.a)({},Object(j.e)(e),{coordinates:e}):{x:0,y:0,coordinates:void 0}}},{key:"setCoordinates",value:function(e,t){var n=this._coordinates,r=e-n.x,a=t-n.y;this.moveCoordinates(r,a)}},{key:"moveCoordinates",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=this.parameters.map(function(e){return e.moveCoordinates.apply(e,t)});this.effect.setEffectParameterValues(r.reduce(function(e,t,n){var r=t.id,a=t.value;return Object(nn.a)(n),e[r]=a,e}))}},{key:"getBlob",value:function(e,t,n,r){var a=this.getAllCoordinates(),i=Object(un.b)(a,{x:e,y:t},8);return r&&i.push(i[0]),this.lastHull=i,Object(an.a)(i,window.spline||1.1,void 0,r)}},{key:"getEasyBlob",value:function(){var e,t=this.getGeometry(),n=t.x,r=t.y,a=t.diameter,i=t.coordinates;return this.lastHull&&mn(n,r,this.lastCentroid.x,this.lastCentroid.y)<5?e=this.lastHull.map(function(e){return i[e]}):i&&(e=Object(un.b)(i,{x:n,y:r},8),this.lastHull=e.map(function(e){var t=e.x,n=e.y,r=i.find(function(e){return e.x===t&&e.y===n});return i.indexOf(r)}),this.lastCentroid={x:n,y:r}),{x:n,y:r,diameter:a,coordinates:i,hull:e,d:e&&Object(an.a)(e,this.effect.splineTension)}}},{key:"getConvexHull",value:function(e,t,n){var r=this.getAllCoordinates();return Object(un.b)(r,Object(j.a)(r),n)}},{key:"getTans",value:function(e,t){var n,r=[],a=hn(this.parameters);try{for(a.s();!(n=a.n()).done;){var i=n.value.getCoordinates();r.push(i)}}catch(o){a.e(o)}finally{a.f()}var s=Object(un.b)(r);return s[0]?function(e,t,n){for(var r=[],a=0;a<e.length;a++){var i=e[a],s=e[(a+1)%e.length],o=i.x-t,c=i.y-n,u=s.x-t,l=s.y-n,f=sn(o,c,window.tanDiff);f={x:f.x1+t,y:f.y1+n};var h=sn(u,l,window.tanDiff);h={x:h.x1+t,y:h.y1+n},0===a?r.push([f,h,s]):r.push([i,h,s])}return r}(s,e,t):""}}]),n}(Object(rn.a)(function(){return function e(){Object(s.a)(this,e)}}())),mn=function(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))};function yn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}function bn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return gn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function gn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function On(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var kn=function(e){Object(l.a)(n,e);var t=On(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Plane Parameters",e)).track.sequencerEngine&&(r.track.sequencerEngine.idToObject[r.id]=Object(c.a)(r)),r.newInlet("operation",function(e){return r.onOperation(e)}),r.newInlet("speed",function(e){return r.onSpeed(e)}),r.setupRampParameters(),r.setupPlanarParameters(),r.setupSnapshots(),r.setupDrawable(),r.setupPlayable(),r.groups=[],r.counter=-1,r.effect=Object(c.a)(r),r.smokeResolution=64,r.dispatch(Object(Ot.Jc)(r.track.id,Object(c.a)(r))),r.newOutlet("macros"),r.newOutlet("smoke"),r}return Object(o.a)(n,[{key:"onSpeed",value:function(e){var t=Object(i.a)(e,1)[0];this.groups.filter(function(e){return e.speedParameter.set(t)})}},{key:"setupPlanarParameters",value:function(){this.maxParametersParameter=new jt.a("maxParameters",this,function(e,t){return[]},{defaultValue:24,min:16,max:64}),this.registerParameter(this.maxParametersParameter),this.blurParameter=new jt.a("blur",this,function(e,t){return[]},{defaultValue:0,min:0,max:40}),this.registerParameter(this.blurParameter),this.splineTensionParameter=new jt.a("splineTension",this,function(e,t){return[]},{defaultValue:1.8,min:.5,max:400}),this.registerParameter(this.splineTensionParameter),this.updateRateParameter=new jt.a("updateRate",this,function(e,t){return[]},{defaultValue:0,min:0,max:40}),this.registerParameter(this.updateRateParameter),this.setupNodeMessaging()}},{key:"splineTension",get:function(){return this.splineTensionParameter.get()}},{key:"maxParametersPerIter",get:function(){return this.maxParametersParameter.get()}},{key:"updateRate",get:function(){return this.updateRateParameter.get()}},{key:"randomlyMapParameters",value:function(e,t,r){var a,i=bn(r=Object(u.a)(Object(h.a)(n.prototype),"randomlyMapParameters",this).call(this,e,t,r));try{for(i.s();!(a=i.n()).done;)a.value}catch(s){i.e(s)}finally{i.f()}}},{key:"getForces",value:function(){var e=this.groups.flatMap(function(e){return e.variables.filter(function(e){return e.name.startsWith("force.x")})}),t=this.groups.flatMap(function(e){return e.variables.filter(function(e){return e.name.startsWith("force.y")})}),n=this.groups.flatMap(function(e){return e.variables.filter(function(e){return e.name.startsWith("force.dx")})}),r=this.groups.flatMap(function(e){return e.variables.filter(function(e){return e.name.startsWith("force.dy")})}),a=[];for(var i in e)a.push([e[i],t[i],n[i],r[i]]);return a}},{key:"checkForces",value:function(){var e,t=bn(this.getForces());try{for(t.s();!(e=t.n()).done;){var n=e.value,r=Object(i.a)(n,4),a=r[0],s=r[1],o=r[2],c=r[3];(a.get()>=k.c||a.get()+.25*o.get()>=k.c)&&(a.set(15),o.set(15)),(s.get()>=k.a||s.get()+.25*c.get()>=k.a)&&(s.set(15),c.set(15))}}catch(u){t.e(u)}finally{t.f()}}},{key:"stop",value:function(){this.checkForces(),Object(u.a)(Object(h.a)(n.prototype),"stop",this).call(this),this.counter=-1,this.stopDrawing(),this.groups.forEach(function(e){return e.stop()}),delete this.D}},{key:"clear",value:function(){Object(u.a)(Object(h.a)(n.prototype),"clear",this).call(this),this.counter=-1}},{key:"output",value:function(e,t,n){if(this.currentSnapshotParameter.refresh(!1),!this.track.sequencerEngine.playing)return this.triggers;var r=this.groups.length>0?this.groups.map(function(e){return e._parameters.length}).reduce(function(e,t){return e+t}):1,i=Math.min(1,this.maxParametersPerIter/r);if(this.applyPencilAutomations(t),this.currentPath){var s=this.applyPath(i,t);return this.track.sequencerEngine.parametersToUpdate=Object(a.a)({},this.track.sequencerEngine.parametersToUpdate,s),this.triggers}var o=t%this.updateRate===0;if(0===this.triggers.length&&!o)return this.triggers;if(!this.playing)return this.triggers;var c,u={},l=bn(this.groups);try{for(l.s();!(c=l.n()).done;){var f=c.value;u=Object(a.a)({},u,f.onTrigger(n,e,this.rampTime,i))}}catch(h){l.e(h)}finally{l.f()}return this.track.sequencerEngine.parametersToUpdate=Object(a.a)({},this.track.sequencerEngine.parametersToUpdate,u),this.sendMacroMessages(),this.sendMessage("smoke",this.D),this.triggers}},{key:"getParameters",value:function(){var e,t=Object(u.a)(Object(h.a)(n.prototype),"getParameters",this).call(this),a=bn(this.groups);try{for(a.s();!(e=a.n()).done;){var i=e.value;t=[].concat(Object(r.a)(t),Object(r.a)(i.parameters))}}catch(s){a.e(s)}finally{a.f()}return t}},{key:"getParameterValueToSet",value:function(e){}},{key:"groupParameters",value:function(e){var t=new It(e,void 0,this.context,this.track,this);this.groups=[].concat(Object(r.a)(this.groups),[t]),e.forEach(function(e){return e.hasGroup=t})}},{key:"ungroup",value:function(e){var t=this.groups.indexOf(e);e._parameters.forEach(function(e){return e.hasGroup=void 0}),this.groups.splice(t,1)}},{key:"ungroupParameters",value:function(e){var t=e.map(function(e){return e.hasGroup});e.filter(function(e){return e.hasGroup}).forEach(function(e){return e.hasGroup.ungroupParameter(e)});var n,r=bn(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;a&&0===a._parameters.length&&this.ungroup(a)}}catch(i){r.e(i)}finally{r.f()}}},{key:"getGroupForParameter",value:function(e){return this.groups.find(function(t){return t._parameters.includes(e)})}},{key:"mergeIntoGroup",value:function(e,t){this.ungroupParameters(t),t.forEach(function(t){e._parameters.push(t),t.hasGroup=e});var n=this.groups.filter(function(e){return 0===e._parameters.length});this.groups=this.groups.filter(function(e){return!n.includes(e)}),this.groups.push(e)}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"gradientColor",get:function(){return this.track.sequencerEngine.state.plane.gradientColors[this.id]},set:function(e){this.track.sequencerEngine.dispatch(Object(Ot.Kc)(this.id,e))}},{key:"getJson",value:function(e){return Object(a.a)({},Object(u.a)(Object(h.a)(n.prototype),"getJson",this).call(this,e),{gradientColor:this.gradientColor,densities:this.getDensityJson(),splineTension:this.splineTension,width:k.c,height:k.a,hideUI:this.hideUI,scriptExpanded:this.scriptExpanded&&this.scriptExpanded.id,macros:this.getMacrosJson(),snapshots:this.snapshots.map(function(e){return e.map(function(e){var t=e.parameter,n=e.coordinates;return{parameter:t.id,coordinates:n}})}),snapshotComponent:this.snapshotComponent,groups:this.groups.map(function(e){return e.getJson()})})}},{key:"getMappableJson",value:function(e){return{parameters:this._parameters.map(function(t){return{id:t.id,context:e?t.context&&t.context.getJson():void 0,name:e?t.name:void 0,coordinates:t.getCoordinates()}}),depthParameters:[]}}},{key:"unmapParameter",value:function(e){var t=Object(u.a)(Object(h.a)(n.prototype),"unmapParameter",this).call(this,e);if(t&&t.hasGroup&&t.hasGroup.ungroupParameter(t),t&&t.planeMacro){var r=t.planeMacro;r.removeParameter(t),r.isEmpty()&&this.deleteMacro(r)}}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t||(this.id=e.id,this.track.sequencerEngine&&(this.track.sequencerEngine.idToObject[this.id]=this)),this.jsonSnapshots=e.snapshots,e.gradientColor&&(this.gradientColor=e.gradientColor),e.splineTension&&this.splineTensionParameter.set(e.splineTension),this.hideUI=e.hideUI,e.width&&Object(k.d)(e.width,e.height),e.snapshotComponent&&(this.snapshotComponent=e.snapshotComponent),e.groups){var r,a=bn(e.groups);try{for(a.s();!(r=a.n()).done;){var i=r.value,s=new It(void 0,void 0,this.context,this.track,this);s.fromJson(i),this.groups.push(s)}}catch(o){a.e(o)}finally{a.f()}}return this.fromMacrosJson(e.macros),e.scriptExpanded&&(this.scriptExpanded=this.groups.find(function(t){return t.id===e.scriptExpanded})),e.densities&&this.fromDensityJson(e.densities),Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,e,t)}},{key:"loadParameters",value:function(e,t){var r=this,a=Object(u.a)(Object(h.a)(n.prototype),"loadParameters",this).call(this,e,t),i=a.lostParameters,s=a.newMappings;if(this.groups.forEach(function(e){return e.loadParameters(r._parameters,s)}),this.macros.forEach(function(e){return e.loadParameters(r._parameters,s)}),this.snapshots=[],this.jsonSnapshots){var o,c=bn(this.jsonSnapshots);try{for(c.s();!(o=c.n()).done;){var l,f=o.value,p=[],d=bn(f);try{var v=function(){var e=l.value,t=e.parameter,n=e.coordinates,a=r._parameters.find(function(e){return e.id===t});a&&p.push({parameter:a,coordinates:n})};for(d.s();!(l=d.n()).done;)v()}catch(m){d.e(m)}finally{d.f()}this.snapshots.push(p)}}catch(m){c.e(m)}finally{c.f()}}return this.clear(),this.stop(),{lostParameters:i,newMappings:s}}},{key:"clearParameter",value:function(e,t,r){if(Object(u.a)(Object(h.a)(n.prototype),"clearParameter",this).call(this,e,t),this.macros.forEach(function(e){e.lastHull=void 0,e.lastCentroid=void 0}),r||this.groups.forEach(function(t){return t.updateParameter(e)}),void 0!==this.selectedVariation&&!r){var a=this.variations[this.selectedVariation],i=e.id;a&&(a[i]=e.getCoordinates())}this.setting||this.currentSnapshotParameter.set(null,!0)}},{key:"replaceParameter",value:function(e){Object(u.a)(Object(h.a)(n.prototype),"replaceParameter",this).call(this,e),this.groups.forEach(function(t){return t.replaceParameter(e)})}},{key:"dispose",value:function(){this.macros.forEach(function(e){return e.dispose()}),this.dispatch(Object(Ot.Jc)(this.track.id,void 0)),Object(u.a)(Object(h.a)(n.prototype),"dispose",this).call(this)}},{key:"onParameterUnmapped",value:function(e){this.macros.filter(function(t){return t.parameters.includes(e)}).forEach(function(t){return t.removeParameter(e)})}},{key:"sortParameters",value:function(){}},{key:"shouldOutputSkip",value:function(e,t){return 0===this.triggers.length}}]),n}(Object(Mt.a)(w.a,function(e){return function(e){Object(l.a)(n,e);var t=Jt(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).regions=[],e.densityCache={},e}return Object(o.a)(n,[{key:"newRegion",value:function(e,t){var n={x:e,y:t,radius:arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,viscosity:10};return this.regions=[].concat(Object(r.a)(this.regions),[n]),n}},{key:"deleteDensity",value:function(e){var t=this.regions.indexOf(e);t>-1&&(this.regions.splice(t,1),this.regions=Object(r.a)(this.regions))}},{key:"getViscosity",value:function(e,t){var n=0,r=e+","+t;if(this.densityCache[r])return this.densityCache[r];var a,i=Bt(this.regions);try{for(i.s();!(a=i.n()).done;){var s=a.value;Ut(e,t,s.x,s.y)<=s.radius&&(n+=s.viscosity)}}catch(c){i.e(c)}finally{i.f()}var o=0===n?1:n;return this.densityCache[r]=o,o}},{key:"expandRegion",value:function(e,t){this.cache={};var n=this.regions.indexOf(e);this.regions[n]=Object(a.a)({},e,{radius:e.radius*t}),this.regions=Object(r.a)(this.regions)}},{key:"expandViscosity",value:function(e,t){this.cache={};var n=this.regions.indexOf(e);this.regions[n]=Object(a.a)({},e,{viscosity:e.viscosity*t}),this.regions=Object(r.a)(this.regions)}},{key:"expandDensitySize",value:function(e,t){return this.cache={},e.radius=e.radius*t,this.regions=Object(r.a)(this.regions),e}},{key:"getDensityJson",value:function(){return this.regions}},{key:"fromDensityJson",value:function(e){this.regions=e}}]),n}(e)},function(e){return function(e){Object(l.a)(n,e);var t=m(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"onOperation",value:function(e){var t=Object(d.a)(e),n=t[0],a=(t.slice(1),n.split(" ").filter(function(e){return""!=e&&" "!==e})),i=a[0],s=a.slice(1).map(function(e){return parseFloat(e)}),o=v[i];o&&o.apply(void 0,[this].concat(Object(r.a)(s)))}}]),n}(e)},Wt.a,function(e){return function(e){Object(l.a)(n,e);var t=g(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getModulatedParameters",value:function(){var e,t=[],n=y(this._parameters);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.lfos.length+r.envelopes.length>0&&t.push(r)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"getStats",value:function(){var e,t=0,n=y(this._parameters);try{for(n.s();!(e=n.n()).done;){var r=e.value;t+=r.lfos.length+r.envelopes.length}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"simplifyPatch",value:function(e){for(var t=this.getModulatedParameters(),n=Math.floor(t.length*e/100),r=0;r<n;r++)t[r].disconnectFromAllModulators()}}]),n}(e)},Gt.a,function(e){return function(e){Object(l.a)(n,e);var t=tn(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).snapshots=[],e.currentSnapshot=void 0,e.snapshotComponent={id:Object(xt.uuid)()},e}return Object(o.a)(n,[{key:"setupSnapshots",value:function(){var e=this;this.newInlet(Yt.r,function(t){return e.onSnapshotMessage(t)}),this.newOutlet(Yt.j),this.currentSnapshotParameter=new jt.b("currentSnapshot",this,function(t,n,r,a){return n<0||null===n?e.currentSnapshot=void 0:e.setting=!0,n>=0?e._useSnapshot(e.snapshots[n],a,r,n):-1},{min:0,max:100,defaultValue:null,stepAutomation:!0}),this.registerParameter(this.currentSnapshotParameter)}},{key:"takeSnapshot",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=[],a=$t(this._parameters);try{for(a.s();!(e=a.n()).done;){var i=e.value;n.push({parameter:i,coordinates:i.getCoordinates(),min:i.min,max:i.max})}}catch(s){a.e(s)}finally{a.f()}this.snapshots=[].concat(Object(r.a)(this.snapshots),[n]),t&&this.currentSnapshotParameter.set(this.snapshots.length-1)}},{key:"deleteAllSnapshots",value:function(){this.snapshots=[],this.currentSnapshot=void 0}},{key:"deleteSnapshot",value:function(e){this.snapshots=this.snapshots.filter(function(t){return t!==e}),this.currentSnapshot=void 0}},{key:"_useSnapshot",value:function(e,t,n,r){var a=this;if(e&&e!==this.currentSnapshot){var i,s={},o={},c=new Set(this._parameters),u=$t(e);try{var l=function(){var e=i.value,t=e.parameter,n=e.coordinates,r=e.min,u=e.max;if(!c.has(t))return"continue";void 0!==r&&void 0!==u&&(t.min=r,t.max=u),s[t.id]={min:r,max:u};var l=a.groups.map(function(e){return e.history[e.history.length-1]&&e.history[e.history.length-1][t.id]}).find(function(e){return e});if(l&&l.x===n.x&&l.y===n.y)return"continue";var f=Dt.a.Master.context.isOffline?Dt.a.Master.context._currentTime:Dt.a.Master.context.currentTime+.1,h=t.setCoordinates(n.x,n.y,f+.001,a.rampTime/1e3,!0),p=h.id,d=h.value;o[p]=d};for(u.s();!(i=u.n()).done;)l()}catch(m){u.e(m)}finally{u.f()}this.setEffectParameterValues(o),this.setParameterMinMax(s),this._clear(),this.currentSnapshot=e;var f,h=$t(this.groups);try{for(h.s();!(f=h.n()).done;){var p=f.value;if(p.history&&p.history[0]){var d=function(t){var n=e.find(function(e){return e.parameter.id===t});n&&(p.history[0][t]=n.coordinates)};for(var v in p.history[0])d(v)}}}catch(m){h.e(m)}finally{h.f()}this.isOutletConnected(Yt.j)&&this.sendMessage(Yt.j,r+1),this.setting=!1}}},{key:"setParameterMinMax",value:function(e){this.track.sequencerEngine.dispatch(Object(Ot.Ac)(e))}},{key:"dropPreset",value:function(){var e=Object(Zt.a)(Qt.a.mark(function e(t){var n,r,a,i,s;return Qt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xt.a.getJson(t.contentHash);case 2:return n=e.sent,r=n.trackParameters.instrument,e.next=6,this.track.instrument.fromJson(r,!0);case 6:this.takeSnapshot(),a=$t(this._parameters);try{for(a.s();!(i=a.n()).done;)(s=i.value).name&&!s._wasDisposed||this.unmap(s)}catch(o){a.e(o)}finally{a.f()}case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onSnapshotMessage",value:function(e){var t=Object(i.a)(e,1)[0];try{t=parseFloat(t),this.currentSnapshotParameter.set(t-1,!0)}catch(n){}}}]),n}(e)},function(e){return function(e){Object(l.a)(n,e);var t=yn(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"setupPlayable",value:function(){this.playingParameter=new jt.a("playing",this,function(){return[]},{defaultValue:1,min:0,max:1}),this.registerParameter(this.playingParameter)}},{key:"playing",get:function(){return this.playingParameter.get()}}]),n}(e)},function(e){return function(e){Object(l.a)(n,e);var t=dn(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).macros=[],e}return Object(o.a)(n,[{key:"deleteMacro",value:function(e){this.macros=this.macros.filter(function(t){return t!==e}),this.updateMacroRedux(),e.dispose()}},{key:"createMacro",value:function(e){var t="Macro "+(this.macros.length+1),n=new vn(t,e,this.macros.length+1,this);e.forEach(function(e){return e.planeMacro=n}),this.addMacro(n)}},{key:"freeMacro",value:function(e){e.free(),this.deleteMacro(e)}},{key:"updateMacroRedux",value:function(){this.track.sequencerEngine.dispatch(Object(Ot.Lc)(this.id,this.macros))}},{key:"addMacro",value:function(e){this.macros=[].concat(Object(r.a)(this.macros),[e]),e.number=this.macros.length,this.updateMacroRedux()}},{key:"sendMacroMessages",value:function(){(new Date).getTime();for(var e=[],t=1;t<=this.macros.length;t++)if(this.isOutletConnected("macros")){var n=this.macros[t-1].getAllCoordinates(!0);e.push(n)}(new Date).getTime(),this.sendMessage("macros",e)}},{key:"getMacrosJson",value:function(){return this.macros.map(function(e){return e.getJson()})}},{key:"fromMacrosJson",value:function(e){if(e){var t,n=hn(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=new vn("macro",[],0,this);a.fromJson(r),this.addMacro(a)}}catch(i){n.e(i)}finally{n.f()}}}}]),n}(e)},O.a,function(e){return function(e){Object(l.a)(n,e);var t=Lt(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).currentPath=void 0,e.currentPosition=1,e}return Object(o.a)(n,[{key:"stopDrawing",value:function(){this.currentPath=void 0,this.currentPosition=1,this.pencilDown=!1}},{key:"setupDrawable",value:function(){this.pencilXParameter=new jt.a("pencilX",this,function(e,t){return[]},{defaultValue:null,min:0,max:k.c,exactAutomation:!0}),this.registerParameter(this.pencilXParameter),this.pencilYParameter=new jt.a("pencilY",this,function(e,t){return[]},{defaultValue:null,min:0,max:k.a,exactAutomation:!0}),this.registerParameter(this.pencilYParameter)}},{key:"applyPencilAutomations",value:function(){if(!this.pencilXParameter.isRecordingMix&&!this.pencilXParameter.isRecording&&this.pencilXParameter.isPlayingMix&&null===this.pencilXParameter.get(!0)&&null===this.pencilYParameter.get(!0)){var e=this.pencilXParameter.currentStep,t=Object(Ft.a)(e,this.pencilXParameter.mixAutomation),n=Object(Ft.a)(e,this.pencilYParameter.mixAutomation),r=this.pencilDown;for(var a in t)void 0!==t[a]&&(r=null!==t[a],this.calculatePath(t[a],n[a],e));this.pencilDown=r}}},{key:"setPencil",value:function(e,t){this.pencilDown=void 0!==e&&null!==e,this.pencilXParameter.set(e,!1),this.pencilYParameter.set(t,!1),this.calculatePath(e,t),this.lastX=void 0,this.lastY=void 0}},{key:"pencilX",get:function(){return this.pencilXParameter&&this.pencilXParameter.get()}},{key:"pencilY",get:function(){return this.pencilYParameter&&this.pencilYParameter.get()}},{key:"calculatePath",value:function(e,t,n){e&&t&&(this.currentPath||(this.currentPath=[]),this.currentPath=[].concat(Object(r.a)(this.currentPath),[{x:e,y:t,stepNumber:n}]))}},{key:"isRecordingMix",get:function(){return this.pencilXParameter.isRecordingMix}},{key:"applyPath",value:function(e,t){var n=this.currentPath[this.currentPosition],r=this.currentPath[this.currentPosition-1];return void 0===n||void 0===r?(this.pencilDown||(this.currentPath=void 0,this.currentPosition=1),{}):(n.x,r.x,n.y,r.y,this.currentPosition++,{})}}]),n}(e)})(p.a));t.a=kn},function(e,t,n){"use strict";var r=n(1),a=n(32),i=n(4),s=n(5),o=n(10),c=n(6),u=n(8),l=n(2),f=n(164),h=n(313),p=n(362),d=n(613),v=n(432),m=n(111),y=function(e,t){return(e%t+t)%t},b=function(){var e=[],t=void 0;return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=r[0],s=r[1],o=r[2],c=r[3];if(!i)return Object(m.w)(!0);t!==s&&(e=[]),t=s;var u=i.transpose,l=u;if(e.includes(y(u-1))&&(l=u-1),e.includes(y(u+1,12))&&(l=u+1),e.push(y(l,12)),u===l)return Object(m.w)(!0);var f=c.getStep(i);return f.transpose=l,Object(m.Q)({stepData:f,time:o,stepNumber:s})}},g=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=r[0],s=r[1],o=r[2],c=r[3];if(!i)return Object(m.w)(!1);var u=c.getStep(i);return u.slide=!0,u.transpose=i.transpose+m.A.apply(void 0,[e].concat(r)),void 0!==t&&(u.duration=m.A.apply(void 0,[t].concat(r))),Object(m.Q)([{stepData:i,stepNumber:s,time:o},{stepData:u,stepNumber:s,time:o}])}},O=n(147),k=n(11),j=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=m.A.apply(void 0,[e].concat(n));if(!n[3])return[0];var i=n[3].track.subSequence,s=i.tracks[a%i.tracks.length].pattern,o=[];for(var c in s.stepBucketsMatrix){var u=s.stepBucketsMatrix[c];for(var l in u.steps)o=[].concat(Object(k.a)(o),Object(k.a)(u.steps[l].getPolyphony().map(function(e){return e.transpose})))}return o}},w=n(614),x=n(433),S=n(176),P=n(434),E=n(207),T=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return m.A.apply(void 0,[e].concat(r))||m.A.apply(void 0,[t].concat(r))}},A=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return m.A.apply(void 0,[e].concat(r))&&m.A.apply(void 0,[t].concat(r))}},M=n(151);Object(M.a)("invert",{octaves:""},"inverts notes by an octave (high notes go down/low notes up)");var R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=0,n=0;return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];var s=a[0];if(!s)return Object(m.w)(!1);t+=s.transpose,n++;var o=m.A.apply(void 0,[e].concat(a));return s.transpose<=t/n?Object(v.a)(12*o).apply(void 0,a):Object(v.a)(-12*o).apply(void 0,a)}},C=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var i=r[0],s=r[1],o=r[2];if(!i)return Object(m.w)(!1);var c=m.A.apply(void 0,[e].concat(r)),u=n.map(function(e){return m.A.apply(void 0,[e].concat(r))});return Object(m.Q)({stepData:i,stepNumber:s,time:o,graphics:{type:c,arg:u}})}},N=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return C.apply(void 0,["DRAW"].concat(t))},q=function(e){return C("ERASE",e)};function I(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(M.a)("augment",{delayTime:"",transpose:"",everyTime:"",scriptFunction:"optional",hold:""},"augmentation to theme");var D=function(e,t,n,r,a){var i=[],s=0,o=void 0;return function(){for(var c=arguments.length,u=new Array(c),l=0;l<c;l++)u[l]=arguments[l];var f=u[0],h=u[1],p=u[2],d=u[3];0!==o&&0===h&&(o=void 0);var v=[];if(f&&(o!==h&&void 0!==o&&s++,o=h,void 0===n||s%m.A.apply(void 0,[n].concat(u))===0)){var y=m.A.apply(void 0,[e].concat(u))+1,b={stepData:f,time:p-d.currentTime,delay:y,reference:{}};v.push(b),i.push(b)}var g,O=[],j=[],w=I(i);try{for(w.s();!(g=w.n()).done;){var x=g.value;if(x.delay--,x.delay<=0){var S=d.getStep(x.stepData);if(m.A.apply(void 0,[a].concat(u))?S.duration=1/0:S.duration*=2,void 0!==t){var P=m.A.apply(void 0,[t,S].concat(Object(k.a)(u.slice(1))));S.transpose+=P}var E={stepData:S,time:x.time+d.currentTime,stepNumber:h,reference:x.reference};x.reference.transpose=S.transpose,r?O.push(Object(m.J)(Object(m.Q)(E),r)):O.push(Object(m.Q)(E))}else j.push(x)}}catch(T){w.e(T)}finally{w.f()}return i=j,f&&(f.delays=v),O.push(Object(m.Q)({stepData:f,time:p,stepNumber:h})),m.D.apply(void 0,O)}},F=n(435),L=n(248);Object(M.a)("search",{name:"tag or name to search for"},'Filters out triggers to only tracks of given tag or name (ex: search("kick") returns only kick triggers');var B=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=m.A.apply(void 0,[e].concat(n)),i=n[0];n[1],n[2],n[3];if(i&&i.track){var s=i.track;if(s.instrument){if(s.getName().toLowerCase().includes(a.toLowerCase()))return Object(m.w)(!0)}else if(s.sample.tags.some(function(e){return e.toLowerCase().includes(a.toLowerCase())}))return Object(m.w)(!0)}return Object(m.w)(!1)}};Object(M.a)("loop",{length:"how long to loop",mode:"mode from 0-1"},"Loops triggers at a loop-size. Modes are 0=off 0.5=record 1=play");var z=function(e,t){var n=[],a=0;return function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];var c=s[2],u=s[1],l=s[3].currentTime,f=Math.round(m.A.apply(void 0,[e].concat(s)));switch(function(e){return e<.33?0:e<.66?.5:1}(m.A.apply(void 0,[t].concat(s)))){case.5:return function(e,t,r){n.push({stepData:e,time:t})}(s[0],c-l),Object(m.w)(!0);case 1:var h=n.length-f,p=a++%f,d=n[h+p];return d.stepData?Object(m.Q)(Object(r.a)({},d,{stepNumber:u,time:c+d.time})):Object(m.w)(!1);default:return Object(m.w)(!0)}}},J=n(616),V=n(7),H=n.n(V),U=n(206),G=new H.a.Time("32n"),W=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r in t)Array.isArray(t[r])&&(t[r]=U.a.apply(void 0,Object(k.a)(t[r])));var a=U.a.apply(void 0,t);return t[0]&&Array.isArray(t[0])&&(a=U.a.apply(void 0,Object(k.a)(t[0]))),function(e,t,n,r){var i=r.currentTime;return i+=G*Object(m.A)(a,e,t,n,r),Object(m.Q)({stepData:e,stepNumber:t,time:i})}},K=function(e){return function(t,n,r,a){return n%(32/e)===0?Object(m.w)(!0):Object(m.w)(!1)}},Q=n(437),Z=n(279),Y=n(314),X=n(612);Object(M.a)("once",{fn:"Function to run once",when:"When to run"},"Runs the function once, after a certain number of triggers (default of 0)");var $=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return a[0]&&n++===m.A.apply(void 0,[t].concat(a))?m.A.apply(void 0,[e].concat(a)):Object(h.b)(a)}},ee=function(){var e=0;return function(){return e++}},te=n(436),ne=new H.a.Time("32n").toSeconds();Object(M.a)("stretch",{amount:"Amount we wish to stretch notes"},"Streches patterns so they take longer to complete");var re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t={};return function(n,a,i,s){s.track.length;var o=Object(m.A)(e,n,a,i,s);if(1===o)return Object(m.Q)({stepData:n,stepNumber:a,time:i});var c=a*o,u=i-s.currentTime;if(n){var l=(c-Math.floor(c))*ne;t[Math.floor(c)]={stepData:n,time:u+l}}if(t[a]){var f=Object(m.Q)(Object(r.a)({},t[a],{stepNumber:a,time:i+t[a].time}));return delete t[a],f}return Object(m.Q)({stepNumber:a,time:i})}},ae=(n(23),n(163)),ie=n(247),se=n(191),oe=n(133),ce=new(n(33).a),ue=function(e,t){var n=void 0;return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];a[0],a[1],a[2];var s=m.A.apply(void 0,[t].concat(a));if(!n||s!==n){var o=m.A.apply(void 0,[e].concat(a)),c=m.A.apply(void 0,[t].concat(a));Object(oe.b)(o,c),n=c}return Object(m.w)(!0)}},le=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];var s=a[0];a[1],a[2];if(s||!n){var o=m.A.apply(void 0,[e].concat(a)),c=m.A.apply(void 0,[t].concat(a));Object(oe.b)(o,c)}return Object(m.w)(!0)}};Object(M.a)("receive",{type:"",fn:"",skipEmpty:""},"Reads messages of given type returning the values");var fe=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=Object(ie.a)(e,!0),i=void 0;return function(){for(var e=arguments.length,s=new Array(e),o=0;o<e;o++)s[o]=arguments[o];var c=s[0]&&s[0].track?s[0]:void 0;if(c||!n){var u=a();if(t){if(u.length>0&&void 0===c&&r){var l=s[3],f=l.getStep(ce);f.track=l.track,s=[f].concat(Object(k.a)(s.slice(1)))}return u.map(function(e){return"function"===typeof t?m.A.apply(void 0,[t(e)].concat(Object(k.a)(s))):t})[0]||Object(h.b)(s)}var p=0===u.length?i:u;return u.length>0&&(i=u),p[0]}}},he=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(se.f)("[0]"),n=Object(ie.a)(e,!0),r=void 0;return function(){for(var e=n(),a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];var o=(0===e.length?r:e[0])||m.A.apply(void 0,[t].concat(i));return e.length>0&&(r=e[0]),o}},pe=n(611);function de(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ve(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ve(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(M.a)("delay",{rate:"The rate in 1/32th notes that it repeats",repeats:"Number of times it repeats"},"Simple midi delay function");var me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[];return function(r,a,i){var s,o=r&&{stepData:r,stepNumber:a,time:i,repeats:Object(m.A)(t,r,a,i)},c=Object(m.A)(e,r||n[0],a,i),u=[],l=[],f=de(n);try{for(f.s();!(s=f.n()).done;){var h=s.value;Math.abs(a-h.stepNumber)%c===0&&(h.repeats--,u.push({stepData:h.stepData,time:i,stepNumber:a})),h.repeats>0&&l.push(h)}}catch(p){f.e(p)}finally{f.f()}return n=l,o&&n.push(o),o||0!==u.length?(o&&(u=[].concat(Object(k.a)(u),[o])),u.length>0?Object(m.Q)(u):Object(m.w)(!1)):Object(m.w)(!1)}};Object(M.a)("range",{len:"The length of the list to be generated",min:"The min value to be used as the first element in the list",max:"The max value to be used as the last element in the list"},"Returns a list of a certain length rising from min to max");var ye=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];var s=m.A.apply(void 0,[t].concat(a)),o=m.A.apply(void 0,[n].concat(a)),c=m.A.apply(void 0,[e].concat(a));return Array(e).fill(0).map(function(e,n){return s+n*(o-t)/c})}},be=n(801),ge=n(278),Oe=n(520),ke=n(802),je=n(142),we=function(e){return function(t,n,r,a){if(!t)return Object(m.w)(!0);var i=a.copyTrigger(new je.a(t,r,n),!0),s=Object(m.A)(e,t,n,r,a),o=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:262,r=arguments.length>3?arguments[3]:void 0;n=new H.a.Frequency(n);var a=Math.floor(e/12),i=e<0?(12-Math.abs(e)%12)%12:e%12,s=r(t[Math.floor(t.length*i/12)]),o=n.transpose(12*a)._val;return Object(ke.a)(o*s)}(t.transpose,s,void 0,function(e){return Object(m.A)(e,t,n,r,a)});return i.stepData.transpose=o,Object(m.Q)({stepData:i.stepData,stepNumber:n,time:r})}},xe=n(277);Object(M.a)("acc",{parameterName:"The parameter to accumulate",value:"The value added to the accumulator on each trigger",limit:"The value at which the accumulator will reset to 0"},"Adds an accumulated value to a parameter every trigger, adding the passed-value to the accumulated value. When it reaches the limit, the accumulator resets to 0.");var Se=function(e,t,n){var r=0;return function(a,i,s){if(void 0===a)return Object(m.w)(!1);var o=Object(m.A)(e,a,i,s),c=a[o];return(r+=Object(m.A)(t,a,i,s))>Object(m.A)(n,a,i,s)&&(r=0),Object(m.K)(o,c+r)}};function Pe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var Ee=n(1599).Parser,Te=function(e){Object(c.a)(n,e);var t=Pe(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,"User Script",e)).logs=[],r.code="",r.clear(),r.numberOfOutputs=2,r}return Object(s.a)(n,[{key:"isRealTime",value:function(){return!0}},{key:"documentation",get:function(){return["Write scripts for transforming triggers, and create your own custom midi-effects."]}},{key:"getContext",value:function(){var e,t=this;return e={setMacro:m.L,env1:m.s,search:B,sparse:J.a,once:$,time:W,and:A,or:T,resolution:K,env2:m.t,engine:this.track.sequencerEngine,env3:m.u,hand:se.a,rules:S.q,env4:m.v,doc:M.a,choke:m.o,noDissonance:b,alt:U.a,r_alt:U.d,invert_chord:F.c,degree_chord:F.a,scale_degree:F.d,t_operator:E.p,dot:O.c,dash:O.b,when:S.r,before:S.o,otherwise:S.p,t_syncopate:x.d,t_leaf:E.k,t_transform_leaf:E.v,t_nth:E.o,t_swap:E.t,t_replace:E.q,t_accent:E.e,t_staccato:E.s,t_every:P.c,scl:F.e,t_put_scale:F.f,isLeaf:E.b,t_map:E.m,t_generate:x.b,t_append:E.f,t_cond:se.c,t_splice:E.r,t_transform:E.u,t_multiply:E.n,t_keep_leaves:E.j,isRest:E.c,isStaccato:E.d,isAccent:E.a,jaki_accent:w.b,altn:U.b,t_reverse:L.m,t_variation:P.d,play_and_vary:P.b,tidal:se.e,j_tidal:se.b,tparse:se.f,density:Oe.a,decisions:x.a,augment:D,atranspose:v.a,gte:ge.c,lte:ge.d,every:U.c,lazy:m.A,nth:L.j,scale:we,t_insert:E.g,t_interleave:E.h,t_interleave_before:E.i,car:L.c,t_send:ue,t_receive:he,cdr:L.d,loop:z,len:L.g,t_len:E.l},Object(a.a)(e,"t_every",P.c),Object(a.a)(e,"t_double",d.a),Object(a.a)(e,"isNewCycle",P.a),Object(a.a)(e,"sublist",L.l),Object(a.a)(e,"t_sublist",L.n),Object(a.a)(e,"t_print",se.d),Object(a.a)(e,"slide",g),Object(a.a)(e,"concat",L.e),Object(a.a)(e,"apply_rules",w.a),Object(a.a)(e,"cat",L.e),Object(a.a)(e,"t_altn",U.f),Object(a.a)(e,"t_alt",U.e),Object(a.a)(e,"list",L.h),Object(a.a)(e,"l",L.h),Object(a.a)(e,"vectorAdd",L.o),Object(a.a)(e,"append",L.b),Object(a.a)(e,"map",L.i),Object(a.a)(e,"stretch",re),Object(a.a)(e,"floor",Math.floor),Object(a.a)(e,"round",Math.round),Object(a.a)(e,"draw",N),Object(a.a)(e,"erase",q),Object(a.a)(e,"random",Math.random),Object(a.a)(e,"print",X.a),Object(a.a)(e,"acc",Se),Object(a.a)(e,"reverse",m.H),Object(a.a)(e,"s",m.J),Object(a.a)(e,"pipe",ae.a),Object(a.a)(e,"set",m.K),Object(a.a)(e,"filter",m.w),Object(a.a)(e,"trigger",m.Q),Object(a.a)(e,"r_trig",h.a),Object(a.a)(e,"harmonize",te.b),Object(a.a)(e,"chord",te.a),Object(a.a)(e,"rconcat",L.k),Object(a.a)(e,"multiply",Y.c),Object(a.a)(e,"add",Y.a),Object(a.a)(e,"mod",Y.b),Object(a.a)(e,"t_simplify",x.c),Object(a.a)(e,"counter",ee),Object(a.a)(e,"start",m.M),Object(a.a)(e,"fetchMelody",j),Object(a.a)(e,"poly",be.a),Object(a.a)(e,"receive",fe),Object(a.a)(e,"grab",m.y),Object(a.a)(e,"on",m.C),Object(a.a)(e,"patternSwitch",m.E),Object(a.a)(e,"send",le),Object(a.a)(e,"grabTime",m.z),Object(a.a)(e,"steps",m.N),Object(a.a)(e,"gate",xe.b),Object(a.a)(e,"range",ye),Object(a.a)(e,"shift",xe.d),Object(a.a)(e,"beat",xe.a),Object(a.a)(e,"notes",m.B),Object(a.a)(e,"rolling",m.I),Object(a.a)(e,"invert",R),Object(a.a)(e,"cond",m.q),Object(a.a)(e,"get",m.x),Object(a.a)(e,"repeat",xe.c),Object(a.a)(e,"prob",m.F),Object(a.a)(e,"randomSelect",m.G),Object(a.a)(e,"threshold",pe.a),Object(a.a)(e,"transpose",m.P),Object(a.a)(e,"strum",te.c),Object(a.a)(e,"t_trigger",Q.a),Object(a.a)(e,"triggerAttack",Q.b),Object(a.a)(e,"triggerRelease",Q.d),Object(a.a)(e,"triggerAttackRelease",Q.c),Object(a.a)(e,"load",function(e){return t.loadScript(e)}),Object(a.a)(e,"library",function(e){return t.loadScript(e,"")}),Object(a.a)(e,"p",m.D),Object(a.a)(e,"switchOutput",m.O),Object(a.a)(e,"vel",m.R),Object(a.a)(e,"delay",me),Object(a.a)(e,"dur",m.r),Object(a.a)(e,"chop",m.p),Object(a.a)(e,"altList",L.a),Object(a.a)(e,"f3",Object(se.f)(". -")),Object(a.a)(e,"f4",Object(se.f)(". . -")),Object(a.a)(e,"f5a",Object(se.f)(". . . -")),Object(a.a)(e,"f5b",Object(se.f)("- . -")),Object(a.a)(e,"f5c",Object(se.f)(". - -")),Object(a.a)(e,"fig",p.a),Object(a.a)(e,"t_transform_fig",p.b),Object(a.a)(e,"before",S.o),Object(a.a)(e,"when",S.r),Object(a.a)(e,"after",S.l),Object(a.a)(e,"FLAM",S.d),Object(a.a)(e,"LEGATO",S.e),Object(a.a)(e,"ACCENT",S.a),Object(a.a)(e,"STACCATO",S.j),Object(a.a)(e,"PIANISSIMO",S.f),Object(a.a)(e,"REST",S.i),Object(a.a)(e,"PIANO",S.g),Object(a.a)(e,"DOUBLE",S.c),Object(a.a)(e,"knob",function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16;t.newVar(e,n,r,a);return function(){return t[e+"Parameter"].get()}}),e}},{key:"evalWithContext",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pipe",n="";try{var r=e.split(";"),a=r[r.length-1],i=r.slice(0,r.length-1).join(";");return n=i+";\n\n\n "+t+"("+a+")",new Function("with(this) { "+i+"; return "+t+"("+a+")}").call(this.getContext())}catch(u){var s=u.stack.indexOf("<anonymous>:"),o=u.stack.slice(s+"<anonymous>:".length).split(":")[0],c=parseInt(o);if(isNaN(c))try{Ee.parse(n)}catch(l){this.syntaxErrorLine=l.loc.line}else this.syntaxErrorLine=c-2;return}}},{key:"loadScript",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"s",n=Object(Z.b)(e),r=this.evalWithContext(n,t);return""===t?r:function(){return r}}},{key:"hasSyntaxError",value:function(e){return void 0===this.evalWithContext(e)}},{key:"eval",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t&&this.freeTidals();var r=this.clearVariables(),a=this.evalWithContext(e);for(var i in void 0===a?this.hasError=!0:(this.myScript=a,this.output(),this.myScript=this.evalWithContext(e),this.hasError=!1,this.code=e),r)this[i+"Parameter"]&&this[i+"Parameter"].copyFrom(r[i],this.track.sequencerEngine);n&&this.freeTidals(),this.updateVariablesRedux()}},{key:"clear",value:function(){this.tidals&&this.tidals.forEach(function(e){return e.clear()}),this.freeTidals()}},{key:"stop",value:function(){Object(o.a)(Object(l.a)(n.prototype),"stop",this).call(this),""!==this.code&&(this.eval(this.code),this.freeTidals())}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(){return Object(r.a)({},Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{expanded:this.expanded,code:this.code})}},{key:"fromJson",value:function(e,t){this.code=e.code,this.expanded=e.expanded,""!==this.code&&(this.eval(this.code),this.freeTidals(),Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t))}}]),n}(f.a);t.a=Te},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(11),s=n(56),o=n(4),c=n(5),u=n(515),l=n.n(u),f=n(517),h=n.n(f),p=16384,d=256,v={name:"AES-CTR",counter:new h.a.Counter(5)._counter,length:64};function m(e,t){return y.apply(this,arguments)}function y(){return(y=Object(s.a)(a.a.mark(function e(t,n){var r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length<p)){e.next=4;break}return e.next=3,O(t,n);case 3:return e.abrupt("return",e.sent);case 4:return r=g(t),e.next=7,O(r,n);case 7:return i=e.sent,s=b(t,new Uint8Array(i)),e.abrupt("return",s);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function b(e,t){for(var n=Math.ceil(p/d),r=Math.floor(e.length/d),a=0;a<d;a++){var i=a*r,s=a*n;e.set(t.subarray(s,s+n),i)}return e}function g(e){for(var t=Math.ceil(p/d),n=Math.floor(e.length/d),r=new Uint8Array(p),a=0;a<d;a++){var i=a*n;r.set(e.subarray(i,i+t),a*t)}return r}function O(e,t){return k.apply(this,arguments)}function k(){return(k=Object(s.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("raw",new Uint8Array(n).buffer,{name:"AES-CTR"},!1,["encrypt","decrypt"]);case 2:return r=e.sent,e.next=5,window.crypto.subtle.encrypt(v,r,new Uint8Array(t));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function j(e,t){return w.apply(this,arguments)}function w(){return(w=Object(s.a)(a.a.mark(function e(t,n){var r,i,s,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length<p)){e.next=5;break}return e.next=3,x(t,n);case 3:return r=e.sent,e.abrupt("return",new Uint8Array(r));case 5:return i=g(t),e.t0=Uint8Array,e.next=9,x(i,n);case 9:return e.t1=e.sent,s=new e.t0(e.t1),o=b(t,s),e.abrupt("return",o);case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function x(e,t){return S.apply(this,arguments)}function S(){return(S=Object(s.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("raw",new Uint8Array(n).buffer,{name:"AES-CTR"},!1,["decrypt"]);case 2:return r=e.sent,e.next=5,window.crypto.subtle.decrypt(v,r,t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}var P=n(125);function E(e,t){console.log("sound shuffle content=",e);for(var n=Math.ceil(e.length/256),r=Object(i.a)(t),a=void 0,s=0;s<256;s++){var o=s*n,c=(s+r[s%r.length])%256*n,u=e.subarray(o,o+n);a=Object(i.a)(e.subarray(c,c+n)),c+n>e.length||o+n>e.length||(e.set(u,c),e.set(a,o))}return e}function T(e,t){for(var n=Math.ceil(e.length/256),r=Object(i.a)(t),a=void 0,s=255;s>=0;s--){var o=s*n,c=(s+r[s%r.length])%256*n;if(!(o+n>e.length||c+n>e.length)){var u=e.subarray(o,o+n);a=new Uint8Array(e.subarray(c,c+n)),e.set(u,c),e.set(a,o)}}return e}var A=n(516),M=(new h.a.Counter(5)._counter,function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.a.generateAESKey();Object(o.a)(this,e),this.contentKey="string"===typeof t?h.a.utils.hex.toBytes(t):t,this.publicKey=void 0}return Object(c.a)(e,[{key:"encryptKey",value:function(e){this.publicKey=e;var t=h.a.utils.hex.fromBytes(this.contentKey),n=l.a.encrypt(t,e).cipher,r=P.a.web3.utils.toHex(n);this.encryptedContentKey=r,this.eck=n}},{key:"convertForEthereum",value:function(){return Object(A.a)(this.encryptedContentKey)}},{key:"encryptContent",value:function(){var e=Object(s.a)(a.a.mark(function e(t){var n,r,s,o,c,u,l,f=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f.length>1&&void 0!==f[1]&&f[1],void 0!==t){e.next=3;break}return e.abrupt("return","");case 3:if(r=new Uint8Array(this.contentKey).buffer,console.log("encrypt content= ",t),s=n?t:h.a.utils.utf8.toBytes(t),o=n?E(s,new Uint8Array(this.contentKey)):s,!n){e.next=14;break}return e.next=10,m(o,r);case 10:return c=e.sent,e.abrupt("return",c);case 14:return e.next=16,O(s,this.contentKey);case 16:return u=e.sent,l=h.a.utils.hex.fromBytes(Object(i.a)(new Uint8Array(u))),e.abrupt("return",l);case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"decryptContent",value:function(e){var t=this;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?new Promise(function(){var n=Object(s.a)(a.a.mark(function n(r,i){var s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,j(e,t.contentKey);case 2:s=T(s=n.sent,new Uint8Array(t.contentKey)),r(s);case 5:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}()):new Promise(function(){var n=Object(s.a)(a.a.mark(function n(r,s){var o,c,u;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,o="string"===typeof e?h.a.utils.hex.toBytes(e):e,n.next=4,x(new Uint8Array(o),t.contentKey);case 4:c=n.sent,u=h.a.utils.utf8.fromBytes(Object(i.a)(new Uint8Array(c))),r(u),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(0),console.log("error=",n.t0),r("");case 13:case"end":return n.stop()}},n,null,[[0,9]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getPublicKeyAsBytes32",value:function(){var e=P.a.web3.utils.toHex(this.publicKey);return Object(A.a)(e)}}]),e}());t.a=M},,function(e,t,n){"use strict";var r=20,a=40,i=600,s=400;function o(e,t,n){for(var o=0;c(e,t,n)&&o<40;)(e+=a)>=i-a&&(e=a,(t=t+r+20)>=s-r&&(t=r+40)),o++;return{x:e,y:t}}function c(e,t,n){for(var i in n.effects){var s=n.effects[i],o=s.x,c=s.y;if(e>=o&&t>=c&&e<=o+a&&t<=c+r)return!0}return!1}n.d(t,"a",function(){return o})},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(122),u=n(518),l=(n(7),n(297),function(){function e(t,n,r,a){Object(s.a)(this,e),this.store=t,this.guilds=n,this.encryption=r,this.crypto=a}return Object(o.a)(e,[{key:"addJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,u,l,f,h=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=h.length>1&&void 0!==h[1]?h[1]:110,r=h.length>2?h[2]:void 0,i=h.length>3&&void 0!==h[3]?h[3]:1,s=h.length>4?h[4]:void 0,3!==i){e.next=8;break}return e.next=7,c.a.addJson(t);case 7:return e.abrupt("return",e.sent);case 8:return e.next=10,this.guilds.getGuildKey(s);case 10:return o=e.sent,u=o.rawPublicKey,e.next=14,this.crypto.encryptRawContent(JSON.stringify(t),r,u);case 14:return l=e.sent,e.next=17,c.a.addJson(l.encryptedContent);case 17:return f=e.sent,this.encryption.newEncryptedContent(f,l.encryptedName,l.encryptedContentKey,n,o.publicKey),e.abrupt("return",f);case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,u,l=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:1,r=l.length>2?l[2]:void 0,i=l.length>3?l[3]:void 0,3!==n){e.next=7;break}return e.next=6,c.a.addBlob(t);case 6:return e.abrupt("return",e.sent);case 7:return e.next=9,this.guilds.getGuildKey(r);case 9:return s=e.sent,o=s.rawPublicKey,i.encryptKey(o),e.next=14,this.crypto.encryptRawContent(t,"",o,!0,i);case 14:return u=e.sent,e.next=17,c.a.addBytesArray(u.encryptedContent);case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addBlob",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,l=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:1,l.length>2?l[2]:void 0,3!==n){e.next=6;break}return e.next=5,c.a.addBlob(t);case 5:return e.abrupt("return",e.sent);case 6:return e.next=8,this.guilds.getGuildKey();case 8:return r=e.sent,i=r.rawPublicKey,e.next=12,this.crypto.encryptRawContent(t,"",i,!0);case 12:return s=e.sent,e.next=15,c.a.addJson(s.encryptedContent);case 15:return o=e.sent,this.encryption.newEncryptedContent(o,s.encryptedName,s.encryptedContentKey,u.b,r.publicKey),e.abrupt("return",o);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getEncryptedContentMetadata",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,s,o,c,u,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(new Date).getTime(),void 0!==r){e.next=5;break}return e.next=4,this.guilds.getContentGuildId(t,n);case 4:r=e.sent;case 5:if(0!==r){e.next=7;break}return e.abrupt("return",1);case 7:return e.next=9,this.guilds.hasAccessTo(r);case 9:if(e.sent){e.next=12;break}return e.abrupt("return",2);case 12:return s=(new Date).getTime(),s-i,e.next=16,this.guilds.getGuildKey(r);case 16:if(o=e.sent,c=(new Date).getTime(),c-s,u=void 0,!o){e.next=24;break}return e.next=23,this.encryption.getEncryptedContent(t,o.privateKey);case 23:u=e.sent;case 24:if(void 0!==u){e.next=28;break}return e.next=27,this.encryption.getEncryptedContent(t);case 27:u=e.sent;case 28:return l=(new Date).getTime(),l-c,e.abrupt("return",u);case 31:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getJson",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s,o=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:"QmcfgECwvezrtmVGMywi6epaRMa8NE748V6UiGaBRALeQW",n=o.length>1?o[1]:void 0,r=o.length>2?o[2]:void 0,e.next=5,this.getEncryptedContentMetadata(t,n);case 5:if(1!==(i=e.sent)&&void 0!==i){e.next=12;break}return e.next=9,c.a.getJson(t,r);case 9:return e.abrupt("return",e.sent);case 12:if(2!==i){e.next=14;break}return e.abrupt("return",{});case 14:return e.next=16,this.crypto.fetchAndDecrypt(t,i,void 0,r);case 16:return s=e.sent,e.abrupt("return",JSON.parse(s));case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSound",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s,o,l,f,h=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>0&&void 0!==h[0]?h[0]:"QmYPK9KSRnm5LRvZZkrhLD9HJNVoQpbPBkokF1gt8FwZv8",n=h.length>1?h[1]:void 0,r=h.length>2?h[2]:void 0,i=new Date,e.next=6,this.getEncryptedContentMetadata(t,u.b,n);case 6:if(s=e.sent,o=new Date,o.getTime()-i.getTime(),1!==s&&void 0!==s){e.next=15;break}return e.next=12,c.a.getSound(t,void 0,r);case 12:return e.abrupt("return",e.sent);case 15:if(2!==s){e.next=17;break}return e.abrupt("return",void 0);case 17:return e.next=19,this.crypto.fetchAndDecrypt(t,s,!0);case 19:return l=e.sent,f=new Date,f.getTime()-i.getTime(),e.abrupt("return",l);case 23:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"guildId",get:function(){var e=this.store.getState().guilds.selectedGuild;return e?e.guildId:0}}]),e}());t.a=l},function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(4),s=n(5),o=n(31),c=n(10),u=n(6),l=n(8),f=n(2),h=n(164),p=(n(814),n(141)),d=n(129),v=n(207),m=(n(434),n(433),n(314),n(435)),y=n(278),b=n(614),g=n(248),O=n(277),k=n(437),j=(n(176),n(249),n(815)),w=n(817),x=n(163),S=n(111),P=n(191),E=n(7),T=new(n.n(E).a.Time)("32n"),A=(n(147),n(362),n(818));function M(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var R=function(e){Object(u.a)(n,e);var t=M(n);function n(e,r){var a;Object(i.a)(this,n),(a=t.call(this,"Jaki",e)).zObject=r,a.rules=[new w.a(e,Object(o.a)(a)),new w.a(e,Object(o.a)(a)),new w.a(e,Object(o.a)(a)),new w.a(e,Object(o.a)(a))],a.scaleRules=[[],[],[],[],[],[]];for(var s=0;s<6;s++)a.useTidal();return a.freeTidals(),a.jakiParams=new j.a(a.track.subSequence),a.figures=new A.a(a.track.subSequence),a.clear(),a.numberOfOutputs=1,a.newOutlet(d.i),a.newOutlet(d.b),a.newOutlet(d.o),a.newOutlet("figure-change"),a}return Object(s.a)(n,[{key:"clear",value:function(){var e=this;this.tidals&&this.tidals.forEach(function(e){return e.clear()}),this.freeTidals();var t=Object(g.f)(function(){return e.figures._figures});t=Object(O.d)(t,function(){return e.jakiParams.shift1Parameter.get()});var n=Object(b.b)(t,0,function(){return e.rules[0].rules});console.log("pl_ruled",n);var r,a,i=[],s=Object(m.e)(t),o=[0],c=function(e,t,n,r){return Object(P.c)(Object(y.b)(t,!0),Object(m.f)(e,s,n,r),Object(m.f)(e,o,void 0,r))},u=function(t,n){return Object(k.a)(c(function(t,n,r){return Object(P.c)(Object(y.a)(function(){return 0===Math.round(n())},function(){return null===r()}),t,Object(b.b)(Object(O.d)(t,function(){return Math.round(n())}),function(){return 0},function(){return null===r()?i:e.rules[Math.round(r())%e.rules.length].rules}))}(Object(v.w)(t,e.getParam("truncate",n,Math.round)),e.getParam("shift",n,Math.round),e.getParam("rule",n,Math.round)),e.getParam("scale",n),function(){return e.scaleRules[n-1]}),function(){return e.getTrackToRoute(n)},function(t){return Object(S.J)(Object(P.b)(t,e.getParam("tempo",n,function(e){return.25*Math.pow(2,Math.round(e))}),e.getParam("triplet",n)),e.swing(n),e.offset(n),e.handleHand(n))},e.zObject)};this.myScript=Object(x.a)(Object(S.D)(function(){var t=s();return t!==e._scale&&(e._scale=t,e.sendMessage(d.i,t)),e.currentScale=s(),e.sendMessage(d.o,e.tidals),Object(S.w)(!1)},(r=Object(v.w)(c(n,this.scale1Parameter,function(){return e.scaleRules[0]},!0),this.getParam("truncate",1,Math.round)),a=1,Object(k.a)(c(r,e.getParam("scale",a),function(){return e.scaleRules[a-1]}),function(){return e.getTrackToRoute(a)},function(t){return Object(S.J)(Object(P.b)(t,e.getParam("tempo",a,function(e){return.25*Math.pow(2,e)}),e.getParam("triplet",a)),e.swing(a),e.offset(a),e.handleHand(a))},e.zObject)),u(n,2),u(n,3),u(n,4),u(n,5),u(n,6)))}},{key:"getTrackToRoute",value:function(e){return e}},{key:"getParam",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e};return function(){return r(n.jakiParams[e+t+"Parameter"].get())}}},{key:"pName",value:function(e,t){return this.jakiParams[e+t+"Parameter"]}},{key:"swing",value:function(e){var t,n=this;return t=function(){return n.pName("swing",e).get()},function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=n[0],i=n[1],s=n[2];if(!a)return Object(S.w)(!0);var o=S.A.apply(void 0,[t].concat(n));return Math.floor(i/2)%2!==0?Object(S.Q)({stepData:a,time:s+T*(o-50)/50,stepNumber:i}):Object(S.w)(!0)}}},{key:"offset",value:function(e){var t,n=this;return t=function(){return n.pName("offset",e).get()},function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=n[0],i=n[1],s=n[2];if(!a)return Object(S.w)(!0);var o=S.A.apply(void 0,[t].concat(n));return Object(S.Q)({stepData:a,time:s+T*o/100,stepNumber:i})}}},{key:"handleHand",value:function(e){var t=this;return Object(P.a)(function(){return t.pName("hand",e).get()})}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"stop",value:function(){Object(c.a)(Object(f.a)(n.prototype),"stop",this).call(this),this.freeTidals()}},{key:"getJson",value:function(){return Object(a.a)({},Object(c.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{jakiParams:this.jakiParams.getJson(),figures:this.figures.getJson(),rules:this.rules.map(function(e){return e.getJson()}),scaleRules:this.scaleRules})}},{key:"registerContext",value:function(e){e=e.forEffect(this),this.getParameters().forEach(function(t){return t.setContext(e)})}},{key:"getParameters",value:function(){return[].concat(Object(r.a)(this.parameters),Object(r.a)(this.jakiParams.parameters),Object(r.a)(this.figures.figures.flatMap(function(e){return e.parameters})),Object(r.a)(this.rules.flatMap(function(e){return e.getParameters()}))).filter(function(e){return e})}},{key:"fromJson",value:function(e){var t=Object(c.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e);return e.jakiParams?this.jakiParams.fromJson(e.jakiParams):this.jakiParams.fromJson(e),e.figures&&(Array.isArray(e.figures)?this.figures.fromJson({id:this.figures.id,figures:e.figures}):this.figures.fromJson(e.figures)),e.rules&&this.rules.forEach(function(t,n){e.rules[n]&&(t.effects=[],t.fromJson(e.rules[n]))}),e.scaleRules&&(this.scaleRules=e.scaleRules),t}}]),n}(Object(p.a)(h.a));t.a=R},,,,function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){for(var t=Object.getOwnPropertyNames(e),n=0;n<t.length;n++)delete e[t[n]];return e}},,,function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){return"INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName}},function(e,t,n){"use strict";n.d(t,"i",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"g",function(){return s}),n.d(t,"f",function(){return o}),n.d(t,"h",function(){return c}),n.d(t,"k",function(){return u}),n.d(t,"m",function(){return l}),n.d(t,"c",function(){return f}),n.d(t,"e",function(){return h}),n.d(t,"j",function(){return p}),n.d(t,"o",function(){return d}),n.d(t,"l",function(){return v}),n.d(t,"d",function(){return m}),n.d(t,"n",function(){return y});var r=2,a=3,i=4,s=5,o=6,c=7,u=8,l=9,f=10,h=11,p=12,d=13,v=14,m=15,y=16},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2),u=n(354),l=n(9);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(s.a)(n,e);var t=f(n);function n(e,a,i){var s;return Object(r.a)(this,n),(s=t.call(this,e,i)).defaultValue=a,s.heldEvent=void 0,s.currentEvent=a,s.cache={},s}return Object(a.a)(n,[{key:"getMixType",value:function(){return l.c}},{key:"restart",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(i.a)(Object(c.a)(n.prototype),"restart",this).call(this),this.cache={},e||(this.heldEvent=void 0),this.currentEvent=this.defaultValue}},{key:"clear",value:function(){Object(i.a)(Object(c.a)(n.prototype),"clear",this).call(this),this.cache={}}},{key:"holdEvent",value:function(e,t){this.heldEvent=e}},{key:"getPreviousEvent",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(i.a)(Object(c.a)(n.prototype),"getPreviousEvent",this).call(this,e,t,r)||this.defaultValue}},{key:"getValuesBetweenSteps",value:function(e,t){for(var n=[],r=void 0,a=e;a<t;a++){var i=this.getValue(a,!1,!1),s=i.getValue();this.type===l.j?void 0!==r&&s.equals(r)||n.push({step:a,value:s,event:i}):s!==r&&n.push({step:a,value:s,event:i}),r=s}for(var o=0;o<n.length;o++)void 0===n[o+1]?n[o].duration=t-n[o].step:n[o].duration=n[o+1].step-n[o].step,n[o].event.duration=n[o].duration;return n}},{key:"getValue",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getEvent(e,t).getValue()}},{key:"getEvent",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.heldEvent)return this.heldEvent;if(e in this.cache)return this.cache[e];0==e&&t&&this.restart();for(var n=t?this.counter:0,r=void 0;n<this.events.length&&!(this.events[n].step>e);n++)void 0!==this.heldEvent&&this.events[n].step!==e||(r=this.events[n]);return t&&(this.counter=Math.max(0,n-1)),void 0===r?(this.cache[e]=this.currentEvent,this.currentEvent):(this.currentEvent=r,this.heldEvent=void 0,this.cache[e]=r,r)}}]),n}(u.a);t.a=h},function(e,t,n){"use strict";n(417),n(356)},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),s=n(6),o=n(8),c=n(2),u=n(33);n(73);function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(s.a)(n,e);var t=l(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).cacheSize=8,e}return Object(i.a)(n,[{key:"initCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cacheSize;this.cachedSteps=[];for(var t=0;t<e;t++){var n=new u.a(void 0,void 0,void 0,this.track);n.loadDefaults(),this.cachedSteps.push(n)}this.cacheIndex=0}},{key:"getStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transpose,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.durationParameter.get(),a=void 0;return!(arguments.length>3&&void 0!==arguments[3])||arguments[3]?(a=this.cachedSteps[this.cacheIndex],this.cacheIndex=(this.cacheIndex+1)%this.cachedSteps.length):a=new u.a(void 0,void 0,void 0,this.track),a.transpose=t,a.velocity=e.velocity,a.on=e.on,a.leafNumber=e.leafNumber,a.duration=n,e.voices&&(a.voices=Object(r.a)(e.voices)),a.attack=e.attack,a.delays=e.delays,e.track&&(a.track=e.track),(e.track?e.track.instrument:this.track.instrument)?a.release=null:a.release=e.release,a.start=e.start,a.hand=e.hand,a.isNewCycle=e.isNewCycle,a.chop=e.chop,a.pitchAttack=e.pitchAttack,a.pitchSustain=e.pitchSustain,a.pitchRelease=e.pitchRelease,a.pitchDecay=e.pitchDecay,a.slice=e.slice,a.reverse=e.reverse,a.panning=e.panning,a.selectedRecording=e.selectedRecording,a.palette=e.palette,a.auxEventA=e.auxEventA,a.auxEventB=e.auxEventB,a.auxEventC=e.auxEventC,a.auxEventD=e.auxEventD,a}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(4),a=n(5),i=n(31),s=n(10),o=n(6),c=n(8),u=n(2),l=n(586),f=n(14);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var p=function(e){Object(o.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Flush",e)).flushParameter=new f.a("flush",Object(i.a)(a),function(){return 0},{defaultValue:4,min:0,max:64}),a.registerParameter(a.flushParameter),a.newInlet("to flush"),a.newInlet("control flush"),a.newOutlet("send messages"),a}return Object(a.a)(n,[{key:"dispose",value:function(){Object(s.a)(Object(u.a)(n.prototype),"dispose",this).call(this),this.disposeMessaging()}},{key:"flush",get:function(){return this.flushParameter.get()}},{key:"processMessages",value:function(){var e=this,t=this.queuedMessages["control flush"];t&&t.length>=this.flush&&(this.queuedMessages["to flush"].forEach(function(t){return e.sendMessage("send messages",t)}),this.clearMessages())}}]),n}(l.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2),u=n(141),l=n(135);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(s.a)(n,e);var t=f(n);function n(e,a){var i;return Object(r.a)(this,n),(i=t.call(this,e,a)).queuedMessages={},i}return Object(a.a)(n,[{key:"newInlet",value:function(e){var t=this;Object(i.a)(Object(c.a)(n.prototype),"newInlet",this).call(this,e,function(n){return t.onMessage(e,n)})}},{key:"onMessage",value:function(e,t){this.queuedMessages[e]||(this.queuedMessages[e]=[]),this.queuedMessages[e].push(t),this.processMessages()}},{key:"processMessages",value:function(){this.clearMessages()}},{key:"getInletByNumber",value:function(e){var t=0;for(var n in this.inlets)if(t++===e)return n}},{key:"clearMessages",value:function(){for(var e in this.queuedMessages)this.queuedMessages[e].length=0}}]),n}(Object(u.a)(l.a))},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r=n(4),a=n(5),i=n(31),s=n(6),o=n(8),c=n(2),u=n(586),l=n(14);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(s.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Message",e)).newInlet(1),a.newOutlet("output"),a.messageTextParameter=new l.a("messageText",Object(i.a)(a),function(){return 0},{defaultValue:""}),a.registerParameter(a.messageTextParameter),a._messageText=void 0,a}return Object(a.a)(n,[{key:"messageText",get:function(){return this.messageTextParameter.get()},set:function(e){this.messageTextParameter.set(e,!1)}},{key:"processMessages",value:function(){for(var e in this.queuedMessages){var t=this.queuedMessages[e][0],n=this.messageText.replaceAll("$"+e,t[0]);this.sendMessage("output",n),this._messageText=n}this.clearMessages()}},{key:"execute",value:function(){this.sendMessage("output",this._messageText||this.messageText)}}]),n}(u.a)},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(135),u=n(157),l=n(141);n(142),n(14),n(7);function f(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var d=function(e){Object(i.a)(n,e);var t=p(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Note Display",e)).notes={},a.timeOn={},a.durations={},a.velocities={},a.newOutlet("notes on"),a.newOutlet("note durations"),a}return Object(a.a)(n,[{key:"removeNote",value:function(e,t){arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.gated;delete this.notes[e]}},{key:"output",value:function(e){for(var t in this.notes)this.notes[t]--,this.notes[t]<=0&&delete this.notes[t];var n,r=f(this.triggers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.stepData){var i=a.stepData,s=i.transpose,o=i.duration,c=i.velocity;this.notes[s]=2*o,this.durations[s]=o,this.velocities[s]=c,this.timeOn[s]=e}}}catch(y){r.e(y)}finally{r.f()}this.sendMessage("notes on",Object.keys(this.notes));var l=new Array(12).fill(0);for(var h in this.notes){var p=Object(u.a)(parseInt(h),12);l[p]=this.notes[h];var d=this.durations[h],v=this.velocities[h];l[p]=3*v*this.notes[h]/d;var m=this.timeOn[h];Math.pow(e-m,3)<l[p]&&(l[p]=Math.pow(e-m,3))}return this.sendMessage("note durations",l),this.triggers}},{key:"stop",value:function(){this.notes={}}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(Object(l.a)(c.a));t.a=d},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),s=n(31),o=n(10),c=n(6),u=n(8),l=n(2),f=n(135),h=n(310),p=n(14),d=(n(23),n(425)),v=n(275),m=n(141);function y(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var O=function(e){Object(c.a)(n,e);var t=g(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Accumulator",e)).storedAccumulator=0,r.accumulatorValueParameter=new p.a("accumulatorValue",Object(s.a)(r),function(e,t){return t},{documentation:"Adds this value to the accumulator on each trigger",min:-64,max:64,unit:"",defaultValue:1}),r.registerParameter(r.accumulatorValueParameter),r.limitParameter=new p.a("limit",Object(s.a)(r),function(e,t){return t},{documentation:"Accumulates until limit before resettig",min:-64,max:64,unit:"",defaultValue:64}),r.registerParameter(r.limitParameter),r.syncedParameter=new p.a("synced",Object(s.a)(r),function(e,t){return t},{documentation:"Takes the trigger parameter and adds it to the accumulator value",min:0,max:1,defaultValue:null}),r.registerParameter(r.syncedParameter),r.setupRampParameters(),r.modeParameter=new p.a("mode",Object(s.a)(r),function(e,t){return t},{documentation:"How accumulator should act once it reaches the limit",min:0,max:1,defaultValue:d.a}),r.registerParameter(r.modeParameter),r.directionFactor=1,r.setupNodeMessaging(),r}return Object(i.a)(n,[{key:"getVisualizedParameters",value:function(){return[this.accumulatorValueParameter]}},{key:"getText",value:function(){var e=this.accumulatorValue;return e>0?"+"+e:e}},{key:"clear",value:function(){this.directionFactor=1,this.storedAccumulator=0,this._clear()}},{key:"clearParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._parameters.indexOf(e);this.directionFactor=1,this.storedAccumulator=0,this._clearParameter(e,t)}},{key:"accumulatorValue",get:function(){return this.accumulatorValueParameter.get()}},{key:"mode",get:function(){return this.modeParameter.get()}},{key:"limit",get:function(){return this.limitParameter.get()}},{key:"output",value:function(e,t){var n=Object(r.a)(this.triggers);if(!this.track.sequencerEngine.playing||this.shouldOutputSkip(e,t))return n;var a=this.triggers[0],i=this.accumulatorValue;this.syncedParameter.get()&&(i*=a.stepData[this.syncedParameter.get()]);return this.storedAccumulator=this.storedAccumulator+i*this.directionFactor,this.storedAccumulator>=this.limit?this.mode===d.a?this.storedAccumulator=this.storedAccumulator%this.limit:this.mode===d.b?(this.storedAccumulator=this.limit,this.directionFactor*=-1):this.mode===d.c&&(this.storedAccumulator=this.limit):Math.abs(this.storedAccumulator)>=this.limit?this.mode===d.a?this.storedAccumulator=(this.storedAccumulator%this.limit+this.limit)%this.limit:this.mode===d.b?(this.storedAccumulator=-1*this.limit,this.directionFactor*=-1):this.mode===d.c&&(this.storedAccumulator=this.accumulatorValue<0?-1*this.limit:this.limit):Math.abs(this.storedAccumulator)<Math.abs(this.accumulatorValue)&&-1===this.directionFactor&&this.mode===d.b&&(this.storedAccumulator=0,this.directionFactor*=-1),this.setParameterValues(e),this.triggers}},{key:"getParameterValueToSet",value:function(e){return this.initialParameterValues[e]+this.storedAccumulator*(this.getDepth(e)/100)}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"randomlyMapParameters",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15,r=Object(o.a)(Object(l.a)(n.prototype),"randomlyMapParameters",this).call(this,t),a=-4,i=y(r);try{for(i.s();!(e=i.n()).done;){var s=e.value;s.max>=a&&(a=s.max)}}catch(p){i.e(p)}finally{i.f()}this.accumulatorValueParameter.set(Math.random()*a/10),this.limitParameter.set(a);var c,u=0,f=y(r);try{for(f.s();!(c=f.n()).done;){var h=100*c.value.max/a;h*=Math.random(),this.depthParameters[u].set(h),u++}}catch(p){f.e(p)}finally{f.f()}}}]),n}(Object(v.a)(Object(h.a)(Object(m.a)(f.a))));t.a=O},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(11),a=n(160);function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=function(e,t,n){var s=e.context,o=e.name,c=(e.id,n?n.subSequences.flatMap(function(e){return e.tracks}):[]);if(s){if("BPM"===o)return n.bpmParameter;if(s.instrumentType!==a.f){if(void 0!==s.effect){var u,l=i(c);try{for(l.s();!(u=l.n()).done;){var f=u.value,h=[].concat(Object(r.a)(f.effects),Object(r.a)(f.midiEffects.effects),Object(r.a)(f.liveEffects.effects)).find(function(e){return e.name===s.effectName});if(h)return h.getParameters().find(function(e){return e.name===o})}}catch(k){l.e(k)}finally{l.f()}var p,d=i(t.sequencerEngine.subSequences);try{for(d.s();!(p=d.n()).done;){var v=p.value,m=[].concat(Object(r.a)(v.midiEffects.effects),[v.playhead]).find(function(e){return e.name===s.effectName});if(m)return m.getParameters().find(function(e){return e.name===o})}}catch(k){d.e(k)}finally{d.f()}}}else{var y=void 0;if(!(y=t&&t.instrument&&t.instrument.getInstrumentType()===a.f?t:c.find(function(e){return e.instrument&&e.instrument===a.f&&!e.isFrozens})))return;var b=y.instrument.getSubDevice(s.subDevice);if(b){var g=(b.getParameters?b.getParameters():b.parameters).find(function(e){return e.name===o});if(g&&g.context&&g.context.formant){var O=g.context.formant;O.enabledParameter.get()||O.enabledParameter.set(!0,!0,!0)}return g}}}}},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),s=n(31),o=n(6),c=n(8),u=n(2),l=n(135),f=(n(33),n(142),n(234),n(14)),h=(n(21),n(422),n(426)),p=n(7);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}new(n.n(p).a.Time)("32n");var v=function(e){Object(o.a)(n,e);var t=d(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Chord Sculptor",e)).liveTriggers=[],r.linesParameter=new f.a("lines",Object(s.a)(r),function(e,t){return r.lines=t},{defaultValue:[],min:[],max:[],unit:""}),r.registerParameter(r.linesParameter),r.effects=[],r.rawLines=[],r}return Object(i.a)(n,[{key:"clear",value:function(){this.effects.forEach(function(e){return e.clear()})}},{key:"onNewStep",value:function(){this.effects.forEach(function(e){return e.onNewStep()})}},{key:"removeNote",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.gated;this.effects.forEach(function(r){return r.removeNote(e,t,n)})}},{key:"isRealTime",value:function(){return!1}},{key:"lines",set:function(e){this.rawLines=e;var t=[];for(var n in e){var r=e[n],a=r.x1,i=r.y1,s=r.x2,o=r.y2,c=r.brightness,u=Math.abs(Math.ceil(16*(s-a))),l=8*i,f=8*o,p=4*(a+s)/2,d=c||1,v=new h.a(this.track);v.evenDelayTimeParameter.set(l),v.oddDelayTimeParameter.set(f),v.repeatsParameter.set(u),v.durationFactorParameter.set(p),v.velocityParameter.set(d),t.push(v)}this.effects=t}},{key:"input",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.effects.forEach(function(n){return n.input(e,t)})}},{key:"output",value:function(e,t,n){var a=[];for(var i in this.effects)a=[].concat(Object(r.a)(a),Object(r.a)(this.effects[i].output(e,t,n)));return a}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(l.a);t.a=v},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2);function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var l=function(e){Object(s.a)(n,e);var t=u(n);function n(e,a,i){var s;Object(r.a)(this,n);var o=!0;return(s=t.call(this,e,i,function(e,t){o||e.send(a,t),o=!1},{min:0,max:127,defaultValue:1})).ccNumber=a,i.setCallback(a,function(e){s.set(e)}),s}return Object(a.a)(n,[{key:"getJson",value:function(){var e=Object(i.a)(Object(c.a)(n.prototype),"getJson",this).call(this);return e.ccNumber=this.ccNumber,e}}]),n}(n(14).a);t.a=l},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),s=n(6),o=n(8),c=n(2),u=(n(3),n(142)),l=n(135),f=n(14);n(21);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var p=function(e){Object(s.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Midi Delay",e)).delayTimeParameter=new f.a("delayTime",Object(i.a)(a),function(e,t){return t},{documentation:"The size of the delay in 1/32th notes.",min:1,max:64,unit:"",defaultValue:1}),a.registerParameter(a.delayTimeParameter),a.repeatsParameter=new f.a("repeats",Object(i.a)(a),function(e,t){return[]},{documentation:"The number of additional repeats that will be triggered for each trigger.",defaultValue:1,min:1,max:32,unit:"bars"}),a.registerParameter(a.repeatsParameter),a.wetParameter=new f.a("wet",Object(i.a)(a),function(e,t){return t},{documentation:"Controls the velocity of the delayed triggers vs. the original triggers.",min:0,max:1,unit:"",defaultValue:.5}),a.registerParameter(a.wetParameter),a.delays=[],a}return Object(a.a)(n,[{key:"getVisualizedParameters",value:function(){return[this.delayTimeParameter,this.repeatsParameter]}},{key:"getText",value:function(){return this.delayTime+", "+this.repeats}},{key:"documentation",get:function(){return"A delay-style midi effect that triggers the track at the given delayed rate."}},{key:"onNewStep",value:function(){this.triggers=[]}},{key:"clear",value:function(){this.triggers=[],this.delays=[]}},{key:"wet",get:function(){return this.wetParameter.get()}},{key:"repeats",get:function(){return this.repeatsParameter.get()}},{key:"delayTime",get:function(){return this.delayTimeParameter.get()},set:function(e){this.delayTimeParameter.set(e)}},{key:"input",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.delays.length>8&&(this.delays=this.delays.slice(this.delays.length-8)),this.delays.push({stepNumber:e.stepNumber,trigger:this.copyTrigger(e),repeats:0,elapsed:0}),this.triggers.push(this.copyTrigger(e))}},{key:"output",value:function(e,t,n){var r=[],a=[];for(var i in this.delays){var s=this.delays[i];if(s.elapsed++,this.shouldPlayDelay(t,s)){var o=this.getStep(s.trigger.stepData,void 0,void 0,!1);o.velocity=o.velocity*(this.repeats-s.repeats)/this.repeats,o.velocity*=this.wet;var c=new u.a(o,e,t);if(o.velocity>0&&r.push(c),s.repeats++,s.repeats>=this.repeats)continue}a.push(s)}var l=this.triggers;for(var f in l){var h=this.getStep(l[f].stepData,void 0,void 0,!0);h.velocity*=1-this.wet,l[f].stepData=h}return r=r.concat(l),this.delays=a,r}},{key:"shouldPlayDelay",value:function(e,t){var n=t.elapsed-1;return 0!==n&&n%Math.floor(this.delayTime)===0}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(l.a);t.a=p},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(4),a=n(5),i=n(7),s=n.n(i),o=n(22),c=function(){function e(t,n,a,i){Object(r.a)(this,e),this.macro=i,this.parameter=t,this._min=n,this._max=a;var c=Math.abs(Math.min(this._min,this._max));if(this.scaler=new s.a.Scale(this._min+c,this._max+c),this.subtract=new s.a.Subtract(this._min<0||this._max<0?0:c),this.scaler.connect(this.subtract),this.parameter.audioParam)this.subtract.connect(this.parameter.audioParam);else if(this.parameter.audioParams)for(var u in this.parameter.audioParams){var l=this.parameter.audioParams[u].input||this.parameter.audioParams[u];Array.isArray(l)&&(l=l[0]),this.subtract.connect(l)}this.parameter.automationRate=o.a}return Object(a.a)(e,[{key:"withSignal",value:function(e){e.connect(this.scaler)}},{key:"dispose",value:function(){this._disposed||(this.scaler.disconnect(),this.scaler.dispose(),this.subtract.disconnect(),this.subtract.dispose(),this._disposed=!0)}},{key:"normalizeValue",value:function(e){return this.min+(this.max-this.min)*e}},{key:"updateRedux",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e=this.normalizeValue(e),t&&this.parameter.set(e,void 0,!0,void 0,!0),{id:this.parameter.id,value:e}}},{key:"min",get:function(){return this._min},set:function(e){this._min=e;var t=Math.abs(Math.min(this._min,this._max));this.scaler.min=e+t,this.scaler.max=this._max+t,this.subtract.value=this._min<0||this._max<0?0:t}},{key:"max",get:function(){return this._max},set:function(e){this._max=e;var t=Math.abs(Math.min(this._min,this._max));this.scaler.max=e+t,this.scaler.min=this._min+t,this.subtract.value=this._min<0||this._max<0?0:t}},{key:"getJson",value:function(){return{parameter:this.parameter.id,min:this.min,max:this.max}}}]),e}()},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),s=n(6),o=n(8),c=n(2);function u(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}window.outputTimes=[],window.outputCounters=[],window.copyTimes=[],window.triggerInputs={},t.a=function(e){return function(e){Object(s.a)(n,e);var t=f(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"runFlow",value:function(e,t,n){var a=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.inputNode,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.triggers,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.adjacencyLists,c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];window.triggerInputs[e]=0;var l=[],f=[];f.push(i);for(var h=0,p=function(){var i=f.shift();h++;var p=(new Date).getTime(),d=i.output?i.output(e,t,n):Object(r.a)(s),v=(new Date).getTime();if(window.outputTimes.push({time:v-p,name:i.name}),void 0===o[i.id])return"continue";var m,y=u(o[i.id]);try{var b=function(){var t=m.value,n=t.effect,s=t.probability;if(t.triggerCount=0,Math.random()>=s/100)return"continue";if(n.input){var u=(new Date).getTime();d.filter(function(e){return void 0===e.outputNumber&&0===t.outputNumber||e.outputNumber===t.outputNumber}).forEach(function(r){t.triggerCount++,o[i.id].length>1&&(r=a.copyTrigger(r,c)),window.triggerInputs[e]++,n.input(r,void 0===r.time)});var h=(new Date).getTime();window.copyTimes.push(h-u)}else{var p=d.filter(function(e){return void 0===e.outputNumber&&0===t.outputNumber||e.outputNumber===t.outputNumber});t.triggerCountc+=p.length,l=[].concat(Object(r.a)(l),Object(r.a)(p))}n.parent=i,f.includes(n)||f.push(n)};for(y.s();!(m=y.n()).done;)b()}catch(g){y.e(g)}finally{y.f()}};f.length>0;)p();return window.outputCounters.push(h),l}}]),n}(e)}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return MicroTuningEffect});var _Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(31),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_get__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(10),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(6),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(8),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(2),_MidiEffect_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(135),utils_IsNumber_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(43),parameters_AbstractParameter_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(14);function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(e);if(t){var a=Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_6__.a)(this,n)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MicroTuningEffect=function(_MidiEffect){Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_5__.a)(MicroTuningEffect,_MidiEffect);var _super=_createSuper(MicroTuningEffect);function MicroTuningEffect(e){var t;return Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__.a)(this,MicroTuningEffect),(t=_super.call(this,"Micro Tuning",e)).scriptParameter=new parameters_AbstractParameter_js__WEBPACK_IMPORTED_MODULE_10__.a("script",Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_3__.a)(t),function(e,n){return t.executeScript(n)},{defaultValue:"(x) => x"}),t.offsets={},t.algo=function(e){return e},t}return Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_2__.a)(MicroTuningEffect,[{key:"executeScript",value:function executeScript(script){var isTest=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var algo=eval(script);return!!Object(utils_IsNumber_js__WEBPACK_IMPORTED_MODULE_9__.a)(algo(5))&&(isTest||(this.algo=algo),!0)}catch(e){return!1}}},{key:"newNoteOffset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new parameters_AbstractParameter_js__WEBPACK_IMPORTED_MODULE_10__.a("noteOffset",this,function(){return[]},{defaultValue:t,min:-1,max:1});return this.registerParameter(n),this.context&&n.setContext(this.context),this.offsets[e]=n,n}},{key:"output",value:function(){for(var e in this.triggers){var t=this.triggers[e].stepData.duration,n=this.getTranspose(this.triggers[e].stepData.transpose),r=this.getStep(this.triggers[e].stepData,n,this.triggers[e].stepData.duration,!1);r.duration=null===t?void 0:t,this.triggers[e].stepData=r}return this.triggers}},{key:"getTranspose",value:function(e){var t=Math.round(e),n=t in this.offsets?this.offsets[t].get():0,r=this.algo(e)+n;return Math.max(Math.min(42,r),-42)}},{key:"getJson",value:function(e){var t={};for(var n in this.offsets)t[n]=this.offsets[n].get();return Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__.a)({},Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_get__WEBPACK_IMPORTED_MODULE_4__.a)(Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(MicroTuningEffect.prototype),"getJson",this).call(this,e),{script:this.scriptParameter.get(),offsets:t})}},{key:"fromJson",value:function(e,t){for(var n in Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_get__WEBPACK_IMPORTED_MODULE_4__.a)(Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(MicroTuningEffect.prototype),"fromJson",this).call(this,e,t),e.offsets)this.newNoteOffset(parseFloat(n),e.offsets[n]);this.scriptParameter.set(e.script)}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=new MicroTuningEffect(e);return n.fromJson(this.getJson(),t),n}}]),MicroTuningEffect}(_MidiEffect_js__WEBPACK_IMPORTED_MODULE_8__.a)},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(135);n(14);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var h=function(e){Object(o.a)(n,e);var t=f(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Alternate Tuning",e)).tuningMappings={0:.1,1:.5,2:.8,3:.9,4:1.2,5:1.5,6:2.3,7:2.9,8:3.3,9:4.2,10:5.1,11:7},r}return Object(i.a)(n,[{key:"documentation",get:function(){return"Maps each note (i.e. the transpose) to a different note. "}},{key:"output",value:function(){for(var e in this.triggers){var t=this.triggers[e].stepData.duration,n=this.getStep(this.triggers[e].stepData,this.getTranspose(this.triggers[e].stepData.transpose),this.triggers[e].stepData.duration,!1);n.duration=null===t?void 0:t,this.triggers[e].stepData=n}return this.triggers}},{key:"getTranspose",value:function(e){var t=12*Math.floor(e/12);return(e%=12)<0&&(e=12+e),e in this.tuningMappings?t+this.tuningMappings[e]:e}},{key:"getJson",value:function(){return Object(r.a)({},Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{tuningMappings:this.tuningMappings})}},{key:"fromJson",value:function(e,t){Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t),this.tuningMappings=e.tuningMappings}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(l.a);t.a=h},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r=n(1),a=n(4),i=n(5),s=n(31),o=n(10),c=n(6),u=n(8),l=n(2),f=n(276),h=n(14);function p(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var m=function(e){Object(c.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,e)).name="Linked Tidal",r.cycleFactorParameter=new h.a("cycleFactor",Object(s.a)(r),function(e,t){},{defaultValue:1,min:0,max:16,unit:""}),r.registerParameter(r.cycleFactorParameter),r.linkedEffect=void 0,r}return Object(i.a)(n,[{key:"cycle",get:function(){return this.linkedEffect?this.linkedEffect.cycle:this._cycle},set:function(e){this._cycle=e}},{key:"cycleFactor",get:function(){return this.cycleFactorParameter.get()}},{key:"cycleLength",get:function(){return this.linkedEffect?this.linkedEffect.cycleLength*this.cycleFactor:Object(o.a)(Object(l.a)(n.prototype),"cycleLength",this)}},{key:"var",value:function(e){return this.linkedEffect?this.linkedEffect.var(e):Object(o.a)(Object(l.a)(n.prototype),"var",this).call(this,e)}},{key:"durationFactor",get:function(){return this.linkedEffect?this.linkedEffect.durationFactor:Object(o.a)(Object(l.a)(n.prototype),"durationFactor",this)}},{key:"lengthFactor",get:function(){return this.linkedEffect?this.linkedEffect.lengthFactor:Object(o.a)(Object(l.a)(n.prototype),"lengthFactor",this)}},{key:"replaceOperandVariables",value:function(e){return this.linkedEffect?this.linkedEffect.replaceOperandVariables(e):Object(o.a)(Object(l.a)(n.prototype),"replaceOperandVariables",this).call(this,e)}},{key:"getJson",value:function(){return Object(r.a)({},Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{linkedEffect:this.linkedEffect.id})}},{key:"fromJson",value:function(e){var t=Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e),r=e.linkedEffect;return r&&(this.lostParameters=this.loadParameters([r])),t}},{key:"loadParameters",value:function(e){var t,n=e[0],r=p(this.track.sequencerEngine.tracks);try{for(r.s();!(t=r.n()).done;){var a=t.value.midiEffects.effects.find(function(e){return e.id===n});if(a)return void(this.linkedEffect=a)}}catch(i){r.e(i)}finally{r.f()}return[n]}}]),n}(f.a)},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),s=n(6),o=n(8),c=n(2),u=n(135),l=n(14);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(s.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Limit",e)).limitParameter=new l.a("limit",Object(i.a)(a),function(e,t){return t},{documentation:"The maximum number of notes that can be triggered on a given step.",min:0,max:16,unit:"",defaultValue:1}),a.registerParameter(a.limitParameter),a}return Object(a.a)(n,[{key:"getVisualizedParameters",value:function(){return[this.limitParameter]}},{key:"getText",value:function(){return this.limitParameter.get()}},{key:"documentation",get:function(){return"Limits the number of notes that can be triggered on a given step."}},{key:"limit",get:function(){return this.limitParameter.get()}},{key:"output",value:function(){return this.triggers.slice(0,this.limit)}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(u.a);t.a=h},function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(4),s=n(5),o=n(31),c=n(10),u=n(6),l=n(8),f=n(2),h=n(135),p=n(129),d=n(123),v=n(423),m=(n(142),n(14)),y=n(141);function b(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var k=function(e){Object(u.a)(n,e);var t=O(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,"Every",e)).everyParameter=new m.a("every",Object(o.a)(r),function(e,t){return t},{documentation:"The size of the cycle in triggers.",min:1,max:32,unit:"",defaultValue:2}),r.registerParameter(r.everyParameter),r.offsetParameter=new m.a("offset",Object(o.a)(r),function(e,t){return t},{documentation:"The number of triggers within a cycle before applying the parameter change",min:0,max:8,unit:"",defaultValue:0}),r.registerParameter(r.offsetParameter),r.gateParameter=new m.a("gate",Object(o.a)(r),function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),r.registerParameter(r.gateParameter),r.gateProbabilityParameter=new m.a("gateProbability",Object(o.a)(r),function(e,t){return t},{min:0,max:100,unit:"",defaultValue:100}),r.registerParameter(r.gateProbabilityParameter),r.parameterEffects=[],r.counter=0,r.newInlet(p.g,function(){return r.onReset()}),r.newOutlet(p.b),r}return Object(s.a)(n,[{key:"onReset",value:function(){this.counter=0}},{key:"getVisualizedParameters",value:function(){return[this.everyParameter]}},{key:"getText",value:function(){return this.everyParameter.get()}},{key:"documentation",get:function(){return"Alters a parameter every x many triggers."}},{key:"deleteParameterizer",value:function(e){var t=this.parameterEffects.indexOf(e);this.parameterEffects.splice(t,1)}},{key:"newParameter",value:function(){var e=new v.a(this.track);return this.parameterEffects.push(e),e.registerContext((new d.a).forTrack(this.track)),e.registerMixSession(this.track.mixSession),e.registerTrack(this.track),e}},{key:"getParameters",value:function(){var e,t=Object(c.a)(Object(f.a)(n.prototype),"getParameters",this).call(this),r=b(this.parameterEffects);try{for(r.s();!(e=r.n()).done;){var i=e.value;t=[].concat(Object(a.a)(t),Object(a.a)(i.getParameters()))}}catch(s){r.e(s)}finally{r.f()}return t}},{key:"every",get:function(){return Math.round(this.everyParameter.get())},set:function(e){this.everyParameter.set(e)}},{key:"offset",get:function(){return Math.round(this.offsetParameter.get())},set:function(e){this.offsetParameter.set(e)}},{key:"gate",get:function(){return Math.round(this.gateParameter.get())}},{key:"gateProbability",get:function(){return this.gateProbabilityParameter.get()}},{key:"onNewStep",value:function(){this.triggers=[],this.parameterEffects.forEach(function(e){return e.onNewStep()})}},{key:"clear",value:function(){this.counter=0,this.triggers=[],this.parameterEffects.forEach(function(e){return e.clear()})}},{key:"output",value:function(){var e=this;if(0===this.triggers.length)return this.triggers;if(this.counter++%this.every!==this.offset)return this.triggers;if(!(this.gate&&100*Math.random()<=this.gateProbability))return[];this.sendMessage(p.b,0);var t=this.triggers,n=function(n){var r=e.parameterEffects[n];t.forEach(function(e){return r.input(e)}),t=r.output()};for(var r in this.parameterEffects)n(r);return t}},{key:"getJson",value:function(){return Object(r.a)({},Object(c.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{parameterEffects:this.parameterEffects.map(function(e){return e.getJson()})})}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=Object(c.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t);for(var i in e.parameterEffects){var s=new v.a(this.track);a=Object(r.a)({},a,s.fromJson(e.parameterEffects[i],t)),this.parameterEffects.push(s),s.registerContext((new d.a).forTrack(this.track)),s.registerMixSession(this.track.mixSession),s.registerTrack(this.track)}return a}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(Object(y.a)(h.a));t.a=k},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),s=n(6),o=n(8),c=n(2),u=n(135),l=n(14);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(e){Object(s.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Midi CC",e)).deviceNameParameter=new l.a("deviceName",Object(i.a)(a),function(e,t){return[]},{defaultValue:null,unit:"",automatable:!1}),a.registerParameter(a.deviceNameParameter),a.midiCCNumberParameter=new l.b("midiCCNumber",Object(i.a)(a),function(e,t){return[]},{documentation:"The Midi CC number that will be sent on each trigger.",defaultValue:0,min:0,max:119,unit:""}),a.registerParameter(a.midiCCNumberParameter),a.midiCCValueParameter=new l.b("midiCCValueParameter",Object(i.a)(a),function(e,t){return[]},{documentation:"The value that will be sent to a given Midi CC on a each trigger",defaultValue:0,min:0,max:128,unit:""}),a.registerParameter(a.midiCCValueParameter),a}return Object(a.a)(n,[{key:"documentation",get:function(){return"Sends a MIDI CC message on each trigger, with the CC number and value being configurable."}},{key:"output",value:function(){for(var e in this.triggers){if(void 0==this.midiCC)break;this.midiCC.send(this.midiCCNumber,this.midiCCValue)}return this.triggers}},{key:"midiCCNumber",get:function(){return this.midiCCNumberParameter.get()}},{key:"midiCCValue",get:function(){return this.midiCCValueParameter.get()}},{key:"midiCC",get:function(){return this.midi.deviceToMidiCC[this.deviceName]}},{key:"deviceName",get:function(){return this.deviceNameParameter.get()}},{key:"midi",get:function(){return this.track.sequencerEngine.midi}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(u.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(163),l=n(111);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Steps",e)).newVar("fromStep",0,0,64),a.newVar("toStep",16,0,64),a.clear(),a}return Object(a.a)(n,[{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.N)(this.var("fromStep"),this.var("toStep")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(111),l=n(163);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Notes",e)).newVar("fromNote",0,-32,32),a.newVar("toNote",16,-32,32),a.clear(),a}return Object(a.a)(n,[{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(l.a)(Object(u.B)(this.var("fromNote"),this.var("toNote")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.track,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(163),l=(n(111),n(277));function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Beat Repeat",e)).newVar("repeats",1,0,16),a.newVar("rate",2,0,16),a.clear(),a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Repeats any triggers"]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.c)(this.var("repeats"),this.var("rate")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(163),l=n(111);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Grab",e)).newTrackVar("trackNumber",null,0,64),a.newParamVar("fromParam","",0,64),a.newParamVar("toParam","",0,64),a.newCheckboxVar("add",!1),a.clear(),a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Sets a parameter for this track to a value grabbed from a different track.","If there are no triggers at a given step, then the original value will play."]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.y)(this.var("trackNumber"),this.var("fromParam"),this.var("toParam"),this.var("add")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.track,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(163),l=n(111);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Grab Time",e)).newTrackVar("trackNumber",null,0,64),a.clear(),a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Sets a parameter for this track to a value grabbed from a different track.","If there are no triggers at a given step, then the original value will play."]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.z)(this.var("trackNumber")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.track,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(163),l=n(206),f=n(111);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var p=function(e){Object(i.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Alternate",e)).clear(),a.numberOfOutputs=2,a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Alternates the 2 outputs every other trigger."]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.a)(Object(f.O)(0),Object(f.O)(1)))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=p},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(163),l=n(206),f=n(111);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var p=function(e){Object(i.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Alternate N",e)).newVar("steps",16,1,64),a.newVar("outputs",2,1,8),a.clear(),a}return Object(a.a)(n,[{key:"value",get:function(){return this.outputsParameter.get()},set:function(e){this.outputsParameter.set(e)}},{key:"documentation",get:function(){return["Alternates between the outputs of this effect every few steps."]}},{key:"numberOfOutputs",get:function(){if(this.outputsParameter){var e=Math.floor(this.var("outputs")());return isNaN(e)?2:e}return 2},set:function(e){}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){for(var e=[],t=0;t<this.numberOfOutputs;t++)e.push(Object(f.O)(t));this.myScript=Object(u.a)(l.b.apply(void 0,[this.var("steps")].concat(e)))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=p},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(163),l=n(111),f=n(277);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var p=function(e){Object(i.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Beat",e)).newVar("step",0,0,32),a.newVar("steps",16,0,64),a.numberOfOutputs=2,a.clear(),a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Sends triggers to output 1 on a specific step of the beat.","All other triggers go to output 2."]}},{key:"getVisualizedParameters",value:function(){return[this.stepParameter,this.stepsParameter]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(f.a)(this.var("step"),this.var("steps"),Object(l.O)(0),Object(l.O)(1)))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=p},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(163),l=(n(206),n(111),n(611));function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Threshold",e)).clear(),a.newVar("threshold",4,1,64),a.newVar("time",4,1,64),a.numberOfOutputs=2,a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Switches the output of the effect once a threshold of triggers is reached and remains switched until an amount of time has passed."]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.a)(function(e){return e.velocity},this.var("threshold"),this.var("time")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(111),a=function(e,t,n){var a=0,i=!1,s=0;return function(o,c,u){return void 0===o?Object(r.w)(!1):(i||(a+=e(o,c,u))>=Object(r.A)(t)&&(a=0,i=!0,s=0),i?(++s>=Object(r.A)(n)&&(i=!1),Object(r.O)(1)):Object(r.O)(0))}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(111);function a(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw s}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var s,o=n[3],c="",u=a(t);try{for(u.s();!(s=u.n()).done;){var l=s.value,f=r.A.apply(void 0,[l].concat(n));if(f)try{c+="string"===typeof l?l+" ":JSON.stringify(f)+" "}catch(h){}}}catch(p){u.e(p)}finally{u.f()}return""!==c&&o.logs.push(c),Object(r.w)(!0)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(1),a=n(111),i=n(147),s=function(e,t){return Object(r.a)({},e,{transpose:0,type:t})},o=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var o=a.A.apply(void 0,[e].concat(n)),c=[],u=0;u<o.length;u++){var l=o[u],f=l.type,h=f.type;f.value;if("."===h)c.push([s(l,Object(i.b)(0)),s(l,Object(i.b)(1))]);else{var p=[s(l,Object(i.c)()),s(l,Object(i.c)()),s(l,Object(i.b)(0)),s(l,Object(i.b)(1))];p.cycleLength=2,c.push(p),u++}}return c}}},function(e,t,n){"use strict";n.d(t,"a",function(){return u}),n.d(t,"b",function(){return l});var r=n(11),a=n(111),i=n(433),s=n(176),o=n(147),c=(n(191),n(248),n(207),[]);window.lazies=0,window.nolazies=0;var u=function(e,t,n,r){return l(e,1,t,n,r)},l=function(e){var t,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0,d=void 0,v=void 0,m=void 0,y=void 0;return function(){for(var b=arguments.length,g=new Array(b),O=0;O<b;O++)g[O]=arguments[O];var k=a.A.apply(void 0,[e].concat(g)),j=a.A.apply(void 0,[l].concat(g)),w=a.A.apply(void 0,[o].concat(g)),x=a.A.apply(void 0,[u].concat(g)),S=a.A.apply(void 0,[p].concat(g));if(x.forEach(function(e){return e.counter=0}),S&&S.forEach(function(e){return e.counter=0}),k===d&&v===w&&m===x&&t===S&&n===j)return window.lazies++,y;if(d=k,v=w,n=j,t=S,m=x,j=j&&j.flat(16),void 0===d)return c;for(var P=Object(i.a)(w).apply(void 0,g).decide,E=void 0,T=[],A=0,M=[],R=function(){return j&&j[(A-1)%j.length]},C=function(){return j&&j[A%j.length]},N=function(e){return T[T.length-1]=e},q=void 0,I=0,_=!1,D=0,F=h(k),L=function(e){if(Array.isArray(e))return J(e);e.figureId!==q&&(I=0,q=e.figureId,0!==A&&D++),e.rules=[],_=!1,e=B(e);var t=f(e,s.r);if(e=t.reduce(function(e,t){return z(t,e,x,I)},e),E){e=f(E,s.l).reduce(function(e,t){return z(t,e,x,I)},e),e=(t=f(e,s.r)).reduce(function(e,t){return z(t,e,x,I,!1,!0)},e),T.push(e);var n=f(e,s.o);T[T.length-2]=n.reduce(function(e,t){return z(t,e,x,I,s.o)},E),e.accent&&N(z(Object(s.r)(s.a),e,x,I))}else T.push(e);if(j&&C()){var r=C(),a=f(r,s.r);e=a.reduce(function(e,t){return z(t,e,S,I)},e),R()&&(e=(a=f(R(),s.l)).reduce(function(e,t){return z(t,e,S)},e)),N(e)}_||(e=[Object(s.p)()].reduce(function(e,t){return z(t,e,x,I)},e),N(e));return E=e,A++,I++,e},B=function(e){M.forEach(function(e){return e.delay--});var t=M.filter(function(e){return 0===e.delay});return t.length>0&&(_=!0,e=t.reduce(function(e,t){return Object(s.n)(e,t)},e)),e},z=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x,a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,c=Object(s.m)(e,n,P,a,D,F,o),u=c.actions,l=c.delayedActions,f=c.matchedRules;M=[].concat(Object(r.a)(M),Object(r.a)(l)),(u.filter(function(e){return e.type&&"NOTHING"!==e.type}).length>0||l.length>0)&&(i||(_=!0));var h=u.reduce(function(e,t){return Object(s.n)(e,t)},t);return h.rules||(h.rules=[]),Array.isArray(h)&&h.filter(function(e){return!e.rules}).forEach(function(e){return e.rules=[]}),f.forEach(function(e){return Array.isArray(h)?h.map(function(t){return t.rules.push(e)}):h.rules.push(e)}),h},J=function(e){for(var t=function(){var e=T;return T=[],e}(),n=0;n<e.length;n++){var r=e[n];L(r)}T.cycleLength=e.cycleLength,t.push(T),function(e){T=e}(t)},V=0;V<k.length;V++)L(k[V]);return y=T,window.nolazies++,y}},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.r;if(Array.isArray(e))return[t(s.c)];var n=[t(s.b)];switch(e.type.type){case".":n.push(t(Object(o.c)()));break;case"-":n.push(t(Object(o.b)(e.type.value)))}return e.accent&&n.push(t(s.a)),e.staccato&&n.push(t(s.j)),e.legato&&n.push(t(s.e)),e.pianissimo&&n.push(t(s.f)),e.flam&&n.push(t(s.d)),e.piano&&n.push(t(s.g)),null===e.transpose&&n.push(t(s.i)),n},h=function(e){for(var t=void 0,n=0,r=0;r<e.length;r++){var a=e[r];a.figureId!==t&&(t=a.figureId,n++)}return n}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"d",function(){return a}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return s}),n.d(t,"e",function(){return o}),n.d(t,"i",function(){return c}),n.d(t,"f",function(){return u}),n.d(t,"h",function(){return l}),n.d(t,"g",function(){return f});var r="FORWARD",a="REWIND",i="PAUSE",s="RESTART",o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return{name:"Forward",type:r,value:e}},c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return{name:"Rewind",type:a,value:e}},u=function(){return{name:"Pause",type:i}},l=function(){return{name:"Restart",type:s}},f=function(){return{name:"Play",type:"PLAY"}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(11),a=n(111),i=n(151);Object(i.a)("sparse",{sparseness:"how dense the output should be (0-1)"},"Controls density of triggers by filtering out triggers. sparseness: 0-1 ");var s=function(e,t){var n=void 0,i={},s=void 0,o=function(e){(function(e){var t=0===e&&s!==e;return s=e,t})(e)&&(n=i,i={},0),i[e]||(i[e]=0),i[e]++};return function(){for(var t=arguments.length,s=new Array(t),c=0;c<t;c++)s[c]=arguments[c];var u=s[0],l=s[1],f=(s[2],s[3]),h=a.A.apply(void 0,[e].concat(s));if(l=function(e,t){if(function(e){return void 0!==e.track.envelopesTrack}(t)){var n=t.track,a=Math.max.apply(Math,Object(r.a)(n.tracks.map(function(e){return e.pattern.length()})));return n.sequencerEngine.trackStep%a}return e}(l,f),f.track.sequencerEngine.isLooping)return Object(a.w)(!0);if(!u)return Object(a.w)(!1);if(o(l),1===h||u.slide)return Object(a.w)(!0);var p=function(e,t){var n={};for(var r in e)n[r]=e[r]*t;var a=0;for(var i in n){var s=a+n[i];n[i]=Math.floor(s),a=s-Math.floor(s)}return n}(n||i,h);return i[l]>p[l]?Object(a.w)(!1):(0,Object(a.w)(!0))}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"}],name:"favoriteSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"}],name:"unfavoriteSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"sampleHash",type:"bytes32"}],name:"SampleFavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"sampleHash",type:"bytes32"}],name:"SampleUnfavorited",type:"event"}],this.contractAddress="0xcddbc9238e5ba4f6f4c0c8e0ef4231e1be4943fc"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"zequencerAddress",type:"address"},{indexed:!0,internalType:"address",name:"walletAddress",type:"address"},{indexed:!1,internalType:"string",name:"message",type:"string"},{indexed:!1,internalType:"uint8",name:"v",type:"uint8"},{indexed:!1,internalType:"bytes32",name:"r",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"s",type:"bytes32"}],name:"AccountAuthorized",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"zequencerAddress",type:"address"},{indexed:!0,internalType:"address",name:"walletAddress",type:"address"},{indexed:!1,internalType:"string",name:"message",type:"string"},{indexed:!1,internalType:"uint8",name:"v",type:"uint8"},{indexed:!1,internalType:"bytes32",name:"r",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"s",type:"bytes32"}],name:"AccountRevoked",type:"event"},{inputs:[{internalType:"address",name:"walletAddress",type:"address"},{internalType:"string",name:"message",type:"string"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"authorize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"walletAddress",type:"address"},{internalType:"string",name:"message",type:"string"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"revoke",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0xCB1a18e5e9cB53453f78fd5A2E378A3B81cBd4Ff"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"bytes32",name:"projectHash",type:"bytes32"},{internalType:"int16",name:"bpm",type:"int16"},{internalType:"bytes32",name:"thumbnail",type:"bytes32"},{internalType:"bytes32[]",name:"presetHash",type:"bytes32[]"},{internalType:"int8",name:"patterns",type:"int8"},{internalType:"bool",name:"hasArrangement",type:"bool"}],name:"newProjectMetadata",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"projectHash",type:"bytes32"},{indexed:!1,internalType:"int16",name:"bpm",type:"int16"}],name:"ProjectBPM",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"projectHash",type:"bytes32"}],name:"ProjectHasArrangement",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"projectHash",type:"bytes32"},{indexed:!1,internalType:"int8",name:"patterns",type:"int8"}],name:"ProjectPatternsCount",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"projectHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"presetHash",type:"bytes32"}],name:"ProjectUsesPreset",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"projectHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"thumbnailHash",type:"bytes32"}],name:"ProjectVisuals",type:"event"}],this.contractAddress="0xD3d9ee5d5467c1C9e4Ae3dA5e225882F46Bd45aA"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"creator",type:"address"},{indexed:!0,internalType:"uint256",name:"projectId",type:"uint256"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"maxInvocations",type:"uint256"},{indexed:!1,internalType:"string",name:"title",type:"string"}],name:"NewCreatorProject",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"projectId",type:"uint256"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"seedHash",type:"bytes32"}],name:"NewTokenSeed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"projectId",type:"uint256"},{internalType:"uint256",name:"n",type:"uint256"}],name:"getProjectTokenId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"idToProject",outputs:[{internalType:"address payable",name:"creator",type:"address"},{internalType:"bytes32",name:"contentHash",type:"bytes32"},{internalType:"uint256",name:"maxInvocations",type:"uint256"},{internalType:"uint256",name:"pricePerTokenInWei",type:"uint256"},{internalType:"uint256",name:"fromTokenId",type:"uint256"},{internalType:"uint256",name:"toTokenId",type:"uint256"},{internalType:"uint256",name:"invocations",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"projectId",type:"uint256"}],name:"mint",outputs:[],stateMutability:"payable",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"uint16",name:"maxInvocations",type:"uint16"},{internalType:"bool",name:"shouldMint",type:"bool"},{internalType:"uint256",name:"pricePerTokenInWei",type:"uint256"}],name:"newProject",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes",name:"_data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"index",type:"uint256"}],name:"tokenByIndex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"tokenIdToHash",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint256",name:"index",type:"uint256"}],name:"tokenOfOwnerByIndex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"_base",type:"string"}],name:"updateBaseTokenURI",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"percentage",type:"uint256"}],name:"updateFoundationPercentage",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"projectId",type:"uint256"},{internalType:"uint256",name:"price",type:"uint256"}],name:"updateProjectPrice",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x12DB0cE2da04E449550194587bC350aB8b3189d9"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!0,inputs:[{name:"user",type:"address"}],name:"getNumberOfFollowers",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"userB",type:"address"}],name:"unfollow",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"name",type:"string"}],name:"isUserNameAvailable",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"}],name:"getUserProfilePicture",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"profile",type:"bytes32"}],name:"setProfileHash",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"userB",type:"address"}],name:"follow",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"},{name:"index",type:"uint256"}],name:"getFollower",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"profilePicture",type:"bytes32"}],name:"setProfilePicture",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"name",type:"string"}],name:"getUserAddressFromName",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"}],name:"getUserProfile",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"name",type:"string"}],name:"setName",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"}],name:"getUserName",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"userAddress",type:"address"},{indexed:!0,name:"ipfsAddress",type:"bytes32"}],name:"ProfileIpfsHashUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"userAddress",type:"address"},{indexed:!0,name:"ipfsAddress",type:"bytes32"}],name:"ProfilePictureIpfsHashUpdated",type:"event"}],this.contractAddress="0xd0fb239ceb867bdcf68ae8331e911a9d4ec80632"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"previousHash",type:"bytes32"},{internalType:"bytes32",name:"newHash",type:"bytes32"},{internalType:"bytes32",name:"encryptedTitle",type:"bytes32"},{internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"editSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"},{internalType:"address",name:"encryptionAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"sequenceHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!1,internalType:"bytes32",name:"previousHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"encryptedTitle",type:"bytes32"},{indexed:!1,internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{indexed:!1,internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"NewGuildSequence",type:"event"}],this.contractAddress="0x15Da2ef01D9F881f694Be962Db28b76110fa195C"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!0,inputs:[{internalType:"uint32",name:"i",type:"uint32"}],name:"getGuildForSelf",outputs:[{internalType:"uint32",name:"",type:"uint32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"user",type:"address"}],name:"getTotalGuildsForUser",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"bytes32[6]",name:"guildPublicKey",type:"bytes32[6]"},{internalType:"string",name:"name",type:"string"},{internalType:"bytes32",name:"encryptedKeyIpfsHash",type:"bytes32"},{internalType:"bytes32[9]",name:"contentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"userPublicKey",type:"bytes32[6]"}],name:"newGuild",outputs:[{internalType:"uint32",name:"",type:"uint32"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"rejectRequestToAddToGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"setPublicKeyForGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"address",name:"member",type:"address"}],name:"isGuildMember",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"address",name:"potentialMember",type:"address"},{internalType:"bytes32",name:"encryptedKeyIpfsHash",type:"bytes32"},{internalType:"bytes32[9]",name:"contentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"requestToAddMember",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"getTotalGuildsForSelf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"acceptRequestToAddToGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"user",type:"address"},{internalType:"uint32",name:"i",type:"uint32"}],name:"getGuildForUser",outputs:[{internalType:"uint32",name:"",type:"uint32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"getTotalGuildUsers",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"getGuildName",outputs:[{internalType:"string",name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"string",name:"name",type:"string"}],name:"setNameForGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guild",type:"uint32"},{internalType:"uint32",name:"i",type:"uint32"}],name:"getUserFromGuild",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"encryptionContractAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"},{indexed:!1,internalType:"string",name:"name",type:"string"}],name:"NewGuild",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMember",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMemberRequest",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMemberRequestAccepted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMemberRequestRejected",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"GuildMemberLeft",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"",type:"uint32"},{indexed:!0,internalType:"bytes32[6]",name:"",type:"bytes32[6]"}],name:"GuildPublicKeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"},{indexed:!0,internalType:"bytes32",name:"",type:"bytes32"}],name:"GuildKeyEncrypted",type:"event"}],this.contractAddress="0x70548646c2A475ebfE46F19637651e76a38324d4"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sharedWith",type:"address"},{name:"contentHash",type:"bytes32"},{name:"encryptedContentKey",type:"bytes32[9]"},{name:"publicKey",type:"bytes32[6]"}],name:"shareEncryptedContentWith",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"publicKey",type:"bytes32[6]"}],name:"setPublicKey",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"previousContentHash",type:"bytes32"},{name:"newContentHash",type:"bytes32"},{name:"encryptedName",type:"bytes32"},{name:"contentType",type:"int8"},{name:"encryptedContentKey",type:"bytes32[9]"},{name:"publicKey",type:"bytes32[6]"}],name:"newEncryptedContent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"hasPublicKey",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!1,name:"publicKey",type:"bytes32[6]"}],name:"NewPublicKey",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!1,name:"previousContent",type:"bytes32"},{indexed:!0,name:"newContent",type:"bytes32"},{indexed:!0,name:"contentType",type:"int8"},{indexed:!1,name:"encryptedName",type:"bytes32"},{indexed:!1,name:"contentKey",type:"bytes32[9]"},{indexed:!1,name:"publicKey",type:"bytes32[6]"}],name:"NewEncryptedContent",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sharedWith",type:"address"},{indexed:!0,name:"creator",type:"address"},{indexed:!0,name:"contentHash",type:"bytes32"},{indexed:!1,name:"contentKey",type:"bytes32[9]"},{indexed:!1,name:"publicKey",type:"bytes32[6]"}],name:"EncryptedContentShared",type:"event"}],this.contractAddress="0xbe559f9f38c5f36186b364972cb8b4ebd7174043"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"foldersHash",type:"bytes32"}],name:"foldersUpdated",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"foldersHash",type:"bytes32"}],name:"FoldersUpdated",type:"event"}],this.contractAddress="0x20039b89449aC0bAB5B4114Bf66aCff1b3043988"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"address",name:"toUser",type:"address"},{internalType:"bytes32",name:"referenceHash",type:"bytes32"},{internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"sendPublicMessage",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"deleteMessage",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"fromUser",type:"address"},{indexed:!0,internalType:"address",name:"toUser",type:"address"},{indexed:!0,internalType:"bytes32",name:"referencedHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"PublicMessageSent",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"PublicMessageDeleted",type:"event"}],this.contractAddress="0xb407EFd2254583C8BF99c578c7b891313AC1933E"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"address",name:"samplesAddress",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"resampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"sampleUsed",type:"bytes32"}],name:"NewResample",type:"event"},{inputs:[{internalType:"bytes32",name:"resampleHash",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"bytes32[4]",name:"tags",type:"bytes32[4]"},{internalType:"bytes32[]",name:"samplesUsedHashes",type:"bytes32[]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newResample",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0xD914528749Fcfc2945148551d0F61AfDFe429962"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"address",name:"guildsAddress",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"effectHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"effectType",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"tag",type:"bytes32"}],name:"EffectTagged",type:"event"},{inputs:[{internalType:"bytes32",name:"effectHash",type:"bytes32"},{internalType:"bytes32",name:"effectType",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newEffect",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"effectHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"effectType",type:"bytes32"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!1,internalType:"uint32",name:"guildId",type:"uint32"}],name:"NewEffect",type:"event"},{inputs:[{internalType:"bytes32",name:"effectHash",type:"bytes32"},{internalType:"bytes32",name:"effectType",type:"bytes32"},{internalType:"bytes32",name:"tag",type:"bytes32"}],name:"tagEffect",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x133F927E9d1b94e6f274eAa4eEE21d29c65782B4"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"name",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"linkType",type:"bytes32"},{indexed:!1,internalType:"string",name:"link",type:"string"}],name:"ArtistInfo",type:"event"},{inputs:[{internalType:"bytes32",name:"artistName",type:"bytes32"},{internalType:"address",name:"user",type:"address"}],name:"claimArtist",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"}],name:"deleteSampleByArtist",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"artistName",type:"bytes32"},{internalType:"bytes32",name:"linkType",type:"bytes32"},{internalType:"string",name:"link",type:"string"}],name:"newArtistInfo",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"artistName",type:"bytes32"},{internalType:"uint32",name:"releaseId",type:"uint32"},{internalType:"string",name:"releaseName",type:"string"},{internalType:"bytes32",name:"coverArtHash",type:"bytes32"},{internalType:"bytes32",name:"releaseType",type:"bytes32"}],name:"newRelease",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"artistName",type:"bytes32"},{internalType:"bytes32",name:"ipfsHash",type:"bytes32"}],name:"newSampleByArtist",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"artistName",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"releaseId",type:"uint32"},{indexed:!1,internalType:"string",name:"releaseName",type:"string"},{indexed:!1,internalType:"bytes32",name:"coverArtHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"releaseType",type:"bytes32"}],name:"ReleaseInfo",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"artistName",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"}],name:"SampleByArtist",type:"event"},{inputs:[{internalType:"bytes32",name:"artistName",type:"bytes32"}],name:"unclaimArtist",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x0C8aB6a2ED347F076ed69f9eBf05967a8A889400"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"address",name:"guildContractAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"guildId",type:"uint256"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"UserChoseDefaultGuild",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"guildId",type:"uint256"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"UserLeftGuild",type:"event"},{constant:!1,inputs:[{internalType:"bytes32[6]",name:"guildPublicKey",type:"bytes32[6]"},{internalType:"string",name:"guildName",type:"string"},{internalType:"bytes32",name:"encryptedKeyIpfsHash",type:"bytes32"},{internalType:"bytes32[9]",name:"contentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"userPublicKey",type:"bytes32[6]"}],name:"createGuildWithPeople",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint256",name:"guildId",type:"uint256"}],name:"leaveGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint256",name:"guildId",type:"uint256"}],name:"userChoseDefaultGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x1775E7d49D41b01c2D5811ED51ee2d22c9706f86"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"bytes32",name:"packHash",type:"bytes32"},{internalType:"bytes32",name:"previousHash",type:"bytes32"},{internalType:"bytes32[]",name:"contentHashes",type:"bytes32[]"},{internalType:"bytes32",name:"title",type:"bytes32"}],name:"newPack",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"packHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"previousHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"title",type:"bytes32"}],name:"NewPack",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"packHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"PackHasContent",type:"event"}],this.contractAddress="0xF7bd2ada59c4ab5AD0f6BFbE94EB4f8eCa18eEDd"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"bytes32",name:"scriptHash",type:"bytes32"},{internalType:"bytes32",name:"scriptType",type:"bytes32"},{internalType:"bytes32",name:"title",type:"bytes32"}],name:"newScript",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"scriptHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"scriptType",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"title",type:"bytes32"}],name:"NewScript",type:"event"}],this.contractAddress="0xA6FF112D42c50FEE6c212B775721185f82285844"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}()},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sequenceHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"}],name:"SampleInSequence",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"previousSequence",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"newSequence",type:"bytes32"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!1,internalType:"uint32",name:"bpm",type:"uint32"}],name:"SequenceEdited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"projectHash",type:"bytes32"},{indexed:!0,internalType:"uint256",name:"zoraTokenId",type:"uint256"}],name:"ZoraProject",type:"event"},{inputs:[{internalType:"bytes32",name:"previousSequence",type:"bytes32"},{internalType:"bytes32",name:"newSequence",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"bytes32[]",name:"samples",type:"bytes32[]"},{internalType:"uint32",name:"bpm",type:"uint32"}],name:"editSequence",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"projectHash",type:"bytes32"},{internalType:"uint256",name:"zoraTokenId",type:"uint256"}],name:"zoraProject",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x27Fd050dF7c0c603A407f1BC4fd0ED634824270E"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"skinId",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"imageHash",type:"bytes32"}],name:"NewSkin",type:"event"},{inputs:[{internalType:"bytes32[]",name:"skinImages",type:"bytes32[]"}],name:"newSkins",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x723B26f588C57b393C8f6793796A82F479010C85"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),s=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(a.a)(this,e),this.name=t,this.parent=n,this.subFolders=[],this.items=[],this.depth=r}return Object(i.a)(e,[{key:"isDynamic",value:function(){return!1}},{key:"isRoot",value:function(){return void 0===this.parent}},{key:"addItem",value:function(e){e.parent=this,this.items.push(e)}},{key:"deleteItem",value:function(e){var t=this.items.indexOf(e);if(t>-1)return e.parent=void 0,this.items.splice(t,1),e}},{key:"deleteFolder",value:function(e){var t=this.subFolders.indexOf(e);if(t>-1)return this.subFolders.splice(t,1),e}},{key:"delete",value:function(){void 0!==this.parent&&this.parent.deleteFolder(this)}},{key:"newFolder",value:function(t){var n=new e(t,this,this.depth+1);return this.subFolders.push(n),n}},{key:"addFolder",value:function(e){e.depth=this.depth+1,this.subFolders.push(e)}},{key:"getJson",value:function(){return{name:this.name,subFolders:this.subFolders.map(function(e){return e.getJson()}),items:this.items.map(function(e){return e.getJson()})}}},{key:"fromJson",value:function(t,n){var r=this;return this.name=t.name,this.items=t.items.map(function(e){return n(e)}),this.items.forEach(function(e){return e.parent=r}),this.subFolders=t.subFolders.map(function(t){return new e(void 0,r,r.depth+1).fromJson(t,n)}),this}},{key:"getAllItems",value:function(){var e=Object(r.a)(this.items);for(var t in this.subFolders)e=e.concat(this.subFolders[t].getAllItems());return e}}]),e}();t.a=s},function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return a});var r=1,a=2},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=function(){function e(t,n){Object(s.a)(this,e),this.currentPromise=t,this.nextPromise=n}return Object(o.a)(e,[{key:"getCurrent",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.currentPromise();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getNext",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.nextPromise;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=c},function(e,t,n){"use strict";var r=n(11),a=n(42),i=n.n(a),s=n(56),o=n(4),c=n(5),u=n(6),l=n(8),f=n(2),h=n(261),p=n.n(h),d=n(215),v=n(158),m=n(122),y=n(125);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var g=function(e){Object(u.a)(n,e);var t=b(n);function n(e,r,a,i,s){var c;return Object(o.a)(this,n),(c=t.call(this)).decentralized=e,c.ipfsHash=a,c.sequenceId=r,c.data=i,c.title=s,c}return Object(c.a)(n,[{key:"getName",value:function(){return this.title}},{key:"getId",value:function(){return this.ipfsHash}},{key:"save",value:function(e,t,n,r,a,o,c){var u=this;return new Promise(function(){var n=Object(s.a)(i.a.mark(function n(r,a){var s,c;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,m.a.addJson(t,void 0,o);case 2:s=n.sent,c=void 0;case 4:if(c){n.next=21;break}return n.prev=5,n.next=8,m.a.getJson();case 8:if(!(c=n.sent)){n.next=11;break}return n.abrupt("break",21);case 11:return n.next=13,m.a.addJson(t,void 0,o);case 13:s=n.sent,n.next=19;break;case 16:n.prev=16,n.t0=n.catch(5),c=void 0;case 19:n.next=4;break;case 21:r({ipfsHash:s}),"export"!==e&&u.saveToLocalStorage(e,s);case 24:case"end":return n.stop()}},n,null,[[5,16]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"saveToLocalStorage",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&""!==t){e.next=2;break}return e.abrupt("return");case 2:return a=(a=d.a.getItem("sequences"))?JSON.parse(a):[],e.next=6,v.a.eth.getBlockNumber();case 6:s=e.sent,a=[{title:t,hash:n,blockNumber:s}].concat(Object(r.a)(a)),d.a.setItem("sequences",JSON.stringify(a));case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadTitle",value:function(){var e=this;return new Promise(function(t,n){y.a.tokenizedSequences.getSequence(e.ipfsHash).then(function(e){return t(e[0]&&e[0].title)})})}},{key:"load",value:function(){var e=this;return new Promise(function(t,n){e.data?t(JSON.parse(e.data)):e.decentralized&&void 0!==e.ipfsHash?m.a.getJson(e.ipfsHash).then(function(e){return t(e)}):p.a.get("/sequence/"+e.sequenceId).then(function(e){return t(e.data.data)})})}}]),n}(n(514).a);t.a=g},function(e,t,n){"use strict";(function(e){var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(777),u=n(215),l=n(153),f=n(122),h=new c.a,p=n(186),d=function(){function e(t){Object(s.a)(this,e),this.web3=t,this.cachedUserNames={}}return Object(o.a)(e,[{key:"isUserNameAvailable",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,o;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.a.getAccount();case 2:return n.sent,s=h.getContract(t.web3),n.prev=4,n.next=7,s.methods.isUserNameAvailable(e).call();case 7:o=n.sent,r(o),n.next=15;break;case 11:n.prev=11,n.t0=n.catch(4),console.log(n.t0),i(n.t0);case 15:case"end":return n.stop()}},n,null,[[4,11]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getUserId",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,o;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.a.getAccount();case 2:return n.sent,s=h.getContract(t.web3),n.prev=4,n.next=7,s.methods.getUserAddressFromName(e).call();case 7:o=n.sent,r(o),n.next=15;break;case 11:n.prev=11,n.t0=n.catch(4),console.log(n.t0),i(n.t0);case 15:case"end":return n.stop()}},n,null,[[4,11]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"setUserName",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=h.getContract(t.web3),n.t0=s.methods.setName(e),n.next=4,l.a.getAccount();case 4:n.t1=n.sent,n.t2={from:n.t1},n.t3=function(e,t){e?i(e):r()},n.t0.send.call(n.t0,n.t2,n.t3);case 8:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"setProfile",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,o;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.getACCOUNT();case 2:return s=n.sent,n.next=5,f.a.addJson(e);case 5:o=v(o=n.sent),h.getContract(t.web3).methods.setProfileHash(o).send({from:s[0]},function(e,t){e?i(e):r()});case 9:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getUserName",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,o,c;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(s=u.a,!t.cachedUserNames[e]){n.next=4;break}return r(t.cachedUserNames[e]),n.abrupt("return");case 4:if(window.isNFT||!s.getItem("username:"+e)){n.next=7;break}return r(s.getItem("username:"+e)),n.abrupt("return");case 7:if(void 0!==e&&""!==e){n.next=11;break}return n.next=10,l.a.getAccount();case 10:e=n.sent;case 11:if(void 0!==e){n.next=14;break}return r(void 0),n.abrupt("return");case 14:if(!(e in t.cachedUserNames)){n.next=17;break}return r(t.cachedUserNames[e]),n.abrupt("return");case 17:return o=h.getContract(t.web3),n.prev=18,n.next=21,o.methods.getUserName(e).call();case 21:if(c=n.sent,s.setItem("username:"+e,c),""!==c){n.next=26;break}return r(void 0),n.abrupt("return");case 26:t.cachedUserNames[e]=c,r(c),n.next=33;break;case 30:n.prev=30,n.t0=n.catch(18),i(n.t0);case 33:case"end":return n.stop()}},n,null,[[18,30]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getProfile",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,o,c,u;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==e){n.next=8;break}return n.next=3,l.a.getAccount();case 3:if(void 0!==(s=n.sent)){n.next=7;break}return i("no ethereum"),n.abrupt("return");case 7:e=s;case 8:return o=h.getContract(t.web3),n.next=11,o.methods.getUserProfile(e).call();case 11:if(c=n.sent,n.prev=12,0!==t.web3.utils.hexToNumber(c)){n.next=16;break}return r("no profile"),n.abrupt("return");case 16:n.next=21;break;case 18:n.prev=18,n.t0=n.catch(12),console.log("had error while trying to get profile");case 21:return c=m(c),n.next=24,f.a.getJson(c);case 24:u=n.sent,r(u);case 26:case"end":return n.stop()}},n,null,[[12,18]])}));return function(e,t){return n.apply(this,arguments)}}())}}]),e}();function v(e){var t=p.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}function m(t){var n=new e(t.replace(/^0x/,"1220"),"hex");return p.encode(n)}t.a=d}).call(this,n(108).Buffer)},function(e,t,n){"use strict";function r(e){for(var t=e.length-1;t>=0;t--)if("0"!==e.slice(t,t+1))return e.slice(0,t+1)}function a(e){for(var t=0;t<e.length;t++)if("0"!==e.slice(t,t+1))return e.slice(t)}n.d(t,"b",function(){return r}),n.d(t,"a",function(){return a})},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(1),s=n(56),o=n(4),c=n(5),u=n(796),l=function(){function e(t){Object(o.a)(this,e),this.crypto=t}return Object(c.a)(e,[{key:"decryptQueryResult",value:function(){var e=Object(s.a)(a.a.mark(function e(t,n){var r,s,o,c,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("query decryptor"),r=Object(u.b)(t.encryptedContentKey),e.next=4,this.crypto.decryptName(t.encryptedName,r,n);case 4:return s=e.sent,o=t.user,e.next=8,this.crypto.decryptContentKey(r,n);case 8:return c=e.sent,l=Object(i.a)({},t,{title:Object(u.b)(s),encryptedTitle:t.encryptedName,user:"0x"+Object(u.a)(o.slice(2)),contentKey:c?c.contentKey:void 0,publicKey:Object(u.b)(t.publicKey)}),e.abrupt("return",l);case 11:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.a=l},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(7),a=n.n(r),i=n(799),s=.75;function o(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=(new Date).getTime(),u=e.getChannelData(0),l=u.length,f=1e3*l/a.a.context.sampleRate;if(l/a.a.context.sampleRate<s)return{onsets:[],tempo:0};var h=t.asm._initTempo(1024,256,a.a.context.sampleRate,n,-45),p=t._newBuffer(256),d=[],v=new Set,m=u.length/256-1,y=l/256-1;m=Math.floor(r*m);for(var b=0;b<m;b++){var g=u.subarray(256*b,256*(b+1));t.HEAPF32.set(g,p>>2);var O=t.asm._processTempo(h,p),k=t.asm._getOnset(h);0===b&&(O=c(g)?1:0);var j=t.asm._getTempo(h);d.push(j),0!=O&&b<y&&k<.8*f&&v.add(k)}v=Array.from(v),t._destroyBuffer(p),t.asm._dispose(h);var w=Object(i.a)(d.filter(function(e){return 0!=e}))||0;w>180&&(w/=2);(new Date).getTime();return{tempo:w,onsets:v,onsetToPitch:{}}}function c(e){return Math.sqrt(e.reduce(function(e,t){return e+Math.pow(t,2)})/e.length)>.1}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(11);function a(e){return(e=Object(r.a)(e)).sort(),e[Math.floor(e.length/2)]}},,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(111),a=n(151);Object(a.a)("poly",{args:"Arguments to be evaluated"},"Splits a chord among the arguments passed. poly(switchOutput(0), switchOutput(1)) will send half the notes in a chord to output 0 and the others to output 1");var i=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=void 0,i=void 0;return function(e,n,s){return i!==n&&(a=-1),a++,i=n,Object(r.A)(t[a%t.length],e,n,s)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(7),a=n.n(r),i=function(e){return 69+12*Math.log2(e/a.a.Frequency.A4)-60}},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),s=n(31),o=n(10),c=n(6),u=n(8),l=n(2),f=n(135),h=n(7),p=n.n(h),d=n(310),v=n(275),m=n(14),y=(n(23),n(425),n(141));function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var g=function(e){Object(c.a)(n,e);var t=b(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Control Parameters",e)).setupRampParameters(),r.counter=-1,r.listParameter=new m.a("list",Object(s.a)(r),function(){return[]},{defaultValue:[0],min:0,max:1}),r.registerParameter(r.listParameter),r.setupNodeMessaging(),r.newInlet("list",function(e){return r.onListMessage(e)}),r.newOutlet("value"),r}return Object(i.a)(n,[{key:"onListMessage",value:function(e){this.listParameter.set(e[0])}},{key:"getText",value:function(){return""}},{key:"valueList",get:function(){return this.listParameter.get()},set:function(e){this.listParameter.set(Object(r.a)(e))}},{key:"stop",value:function(){Object(o.a)(Object(l.a)(n.prototype),"stop",this).call(this),this.counter=-1}},{key:"clear",value:function(){Object(o.a)(Object(l.a)(n.prototype),"clear",this).call(this),this.counter=-1}},{key:"output",value:function(e,t){var n=this;if(!this.track.sequencerEngine.playing)return this.triggers;if(0===t&&this.resetAtZero&&0!==this.counter&&(this.stop(),this._clear()),0===this.triggers.length)return this.triggers;this.counter++;var r=this.valueList[this.counter%this.valueList.length];return setTimeout(function(){n.sendMessage("value",r)},1e3*(e-p.a.Master.context.currentTime)),this.setParameterValues(e),this.triggers}},{key:"getParameterValueToSet",value:function(e){var t=this.valueList[this.counter%this.valueList.length];return this.initialParameterValues[e]+t*(this.getDepth(e)/100)}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(Object(v.a)(Object(d.a)(Object(y.a)(f.a))));t.a=g},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(298),a=function(e,t,n,a){return Object(r.b)()<e/n?e-.75*Object(r.b)()*(e-t)*a:e+.75*(n-e)*a*Object(r.b)()}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var u=new(n(130).a);t.a=function(e){return function(e){Object(i.a)(n,e);var t=c(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).color="#ffffff",e}return Object(a.a)(n,[{key:"initColor",value:function(){this.color=u.getColorForHash(this.id)}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(11);function a(e,t){if(e=Object(r.a)(e),Array.isArray(e[0])||(e=e.map(function(e){return[e.x,e.y]})),t){var n=e[e.length-1],a=e[e.length-2],i=e[0],s=e[1];e.unshift(n),e.unshift(a),e.push(i),e.push(s)}return e.flat()}function i(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=(e=a(e,n)).length,s=i-4,o=n?e[2]:e[0],c=n?e[3]:e[1],u=[[o,c]],l="M"+[o,c],f=n?i-4:i-2,h=n?2:0;h<f;h+=2){var p=h?e[h-2]:e[0],d=h?e[h-1]:e[1],v=e[h+0],m=e[h+1],y=e[h+2],b=e[h+3],g=v+(y-p)/6*t,O=m+(b-d)/6*t,k=y-((h!==s?e[h+4]:y)-v)/6*t,j=b-((h!==s?e[h+5]:b)-m)/6*t;l+="C"+[g,O,k,j,y,b],u.push([g,O,k,j,y,b])}return r?u:l}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return ScaleEffect});var _Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(31),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_get__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(10),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(6),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(8),_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(2),_MidiEffect_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(135),tone__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(7),tone__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(tone__WEBPACK_IMPORTED_MODULE_9__),utils_IsNumber_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(43),parameters_AbstractParameter_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(14),parameters_parameterJsonFunctions_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(126),_utils_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(802),_scales_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(1601);function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(e);if(t){var a=Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_6__.a)(this,n)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DEFAULT_NOTE=tone__WEBPACK_IMPORTED_MODULE_9___default.a.Frequency("C4"),ScaleEffect=function(_MidiEffect){Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_5__.a)(ScaleEffect,_MidiEffect);var _super=_createSuper(ScaleEffect);function ScaleEffect(e){var t;return Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__.a)(this,ScaleEffect),(t=_super.call(this,"Scale",e)).scaleParameter=new parameters_AbstractParameter_js__WEBPACK_IMPORTED_MODULE_11__.a("scale",Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_3__.a)(t),function(e,t){return[]},{defaultValue:_scales_js__WEBPACK_IMPORTED_MODULE_14__.a}),t.registerParameter(t.scaleParameter),t.referencePitchParameter=new parameters_AbstractParameter_js__WEBPACK_IMPORTED_MODULE_11__.a("referencePitch",Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_3__.a)(t),function(e,t){return[]},{defaultValue:195.99771799087463}),t.registerParameter(t.referencePitchParameter),t.subsetParameter=new parameters_AbstractParameter_js__WEBPACK_IMPORTED_MODULE_11__.a("subset",Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_3__.a)(t),function(e,t){return[]},{defaultValue:[!0,!0,!0,!0,!0,!0,!0]}),t.registerParameter(t.subsetParameter),t}return Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_2__.a)(ScaleEffect,[{key:"documentation",get:function(){return["Forces the notes to a scale. The scale can be defined using ratios where 1 is the base note, and 2 is the octave.","Can drag and drop a scala file with custom micro-tunings."]}},{key:"subset",get:function(){return this.subsetParameter.get()},set:function(e){this.subsetParameter.set(e)}},{key:"scale",get:function(){return this.scaleParameter.get()},set:function(e){var t=[];for(var n in e)t[n]=!0;this.subset=t,this.scaleParameter.set(e)}},{key:"referencePitch",get:function(){return tone__WEBPACK_IMPORTED_MODULE_9___default.a.Frequency(this.referencePitchParameter.get())}},{key:"output",value:function(){for(var e in this.triggers)if(this.triggers[e].stepData){var t=this.triggers[e].stepData.duration,n=this.getTranspose(this.triggers[e].stepData.transpose),r=this.getStep(this.triggers[e].stepData,n,this.triggers[e].stepData.duration,!0);r.duration=null===t?void 0:t,this.triggers[e].stepData=r}return this.triggers}},{key:"getTranspose",value:function getTranspose(t){var _this2=this,scale=this.scale.filter(function(e,t){return _this2.subset[t]}),octave=Math.floor(t/12),offset=t<0?(12-Math.abs(t)%12)%12:t%12,scaleNote=scale[Math.floor(scale.length*offset/12)];try{scaleNote=eval(scaleNote)}catch(e){return t}var octavedNote=this.referencePitch.transpose(12*octave)._val,transpose=Object(_utils_js__WEBPACK_IMPORTED_MODULE_13__.a)(octavedNote*scaleNote);return transpose}},{key:"getJson",value:function(){var e=Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__.a)({},Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_get__WEBPACK_IMPORTED_MODULE_4__.a)(Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(ScaleEffect.prototype),"getJson",this).call(this),{annotation:this.annotation});return e=this.saveParameterToJson(e,"scaleParameter",this.scaleParameter),e=this.saveParameterToJson(e,"subsetParameter",this.subsetParameter)}},{key:"fromJson",value:function(e,t){Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_get__WEBPACK_IMPORTED_MODULE_4__.a)(Object(_Users_alecresende_code_visual_sampler_sequencer_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__.a)(ScaleEffect.prototype),"fromJson",this).call(this,e,t),this.scale=e.scale,e.subset&&(this.subset=e.subset),this.loadParameterFromJson(e,"scaleParameter",this.scaleParameter),this.loadParameterFromJson(e,"subsetParameter",this.subsetParameter),this.annotation=e.annotation}},{key:"getCopy",value:function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var t=new ScaleEffect(e);return t.fromJson(this.getJson(),!0),t}}]),ScaleEffect}(_MidiEffect_js__WEBPACK_IMPORTED_MODULE_8__.a)},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(163),l=n(111);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Pattern Switch",e)).newVar("patternNumber",0,0,16),a.clear(),a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Switches the pattern when a trigger is received."]}},{key:"getVisualizedParameters",value:function(){return[this.patternNumberParameter]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.E)(this.var("patternNumber")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=(n(151),n(163)),l=n(111),f=n(801);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var p=function(e){Object(i.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Poly",e)).newVar("outputs",2,1,8,"Number of outputs to split notes among."),a.clear(),a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Splits any polyphony chords among the outputs of this effect."]}},{key:"numberOfOutputs",get:function(){if(this.outputsParameter){var e=Math.floor(this.var("outputs")());return isNaN(e)?2:e}return 2},set:function(e){}},{key:"getVisualizedParameters",value:function(){return[this.outputsParameter]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){for(var e=[],t=0;t<this.numberOfOutputs;t++)e.push(Object(l.O)(t));this.myScript=Object(u.a)(f.a.apply(void 0,e))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=p},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(163),l=(n(206),n(520)),f=n(278),h=n(111);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var d=function(e){Object(i.a)(n,e);var t=p(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Density",e)).clear(),a.newVar("limit",4,1,32),a.newVar("windowSize",4,1,32),a.numberOfOutputs=2,a}return Object(a.a)(n,[{key:"isRealTime",value:function(){return!1}},{key:"documentation",get:function(){return["Sends triggers to output 2 when the number of triggers of the last few steps exceeds a certain threshold.","All other triggers go to output 1."]}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(h.q)(Object(f.c)(this.var("limit"),Object(l.a)(this.var("windowSize"))),Object(h.O)(1),Object(h.O)(0)))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=d},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(163),l=(n(206),n(111));function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Roll",e)).clear(),a.numberOfOutputs=2,a}return Object(a.a)(n,[{key:"documentation",get:function(){return["Sends triggers to output 1 when the sequence is rolling.","All other triggers go to output 2."]}},{key:"isRealTime",value:function(){return!1}},{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.q)(Object(l.I)(),Object(l.O)(0),Object(l.O)(1)))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(163),l=n(277);n(111);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Midi Gate",e)).clear(),a.numberOfOutputs=2,a.newVar("steps",new Array(16).fill(1),0,65536),a}return Object(a.a)(n,[{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.b)(this.var("steps")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(163),l=n(616);n(111);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var h=function(e){Object(i.a)(n,e);var t=f(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Sparse",e)).clear(),a.numberOfOutputs=2,a.system5Objects=[],a.newVar("density",1,0,1,void 0,void 0,function(e){return a.system5Objects.forEach(function(e){return e.sendDensities()})}),a}return Object(a.a)(n,[{key:"clear",value:function(){this.myScript=Object(u.a)(Object(l.a)(this.var("density")))}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=h},function(e,t,n){"use strict";n.d(t,"a",function(){return O});var r=n(1),a=n(4),i=n(5),s=n(31),o=n(6),c=n(8),u=n(2),l=n(14),f=n(123),h=n(119),p=n(126),d=n(362),v=n(191),m=n(341),y=n(249),b=n(147);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var O=function(e){Object(o.a)(n,e);var t=g(n);function n(e,r){var i;return Object(a.a)(this,n),(i=t.call(this)).effect=r,i.sequencerEngine=r.sequencerEngine,i.figure=e,i._initialType=0,i._initialLength=e().flat(3).length,i.figureLengthParameter=new l.a("figureLength",Object(s.a)(i),function(e,t){return i.onLengthChanged(t)},{defaultValue:i._initialLength,min:3,max:5}),i.registerParameter(i.figureLengthParameter),i.figureTypeParameter=new l.a("figureType",Object(s.a)(i),function(e,t){return i.onTypeChanged(t)},{defaultValue:i._initialType,min:0,max:7}),i.registerParameter(i.figureTypeParameter),i.registerContext(),i}return Object(i.a)(n,[{key:"registerContext",value:function(){var e=this,t=this.parameters,n=(new f.a).forMidiEffect(this.effect);t.forEach(function(t){t.setContext(n),t.setStore(e.sequencerEngine.store)})}},{key:"updateFigure",value:function(e){var t=(e=e()).flat(3).length,n=y.b[t],r=Object(b.e)(e),a=n.indexOf(r.trim());this.figureLengthParameter.set(t),this.figureTypeParameter.set(a)}},{key:"figureLength",get:function(){return this.figureLengthParameter?this.figureLengthParameter.get():this._initialLength}},{key:"figureType",get:function(){return this.figureTypeParameter?this.figureTypeParameter.get():this._initialType}},{key:"onTypeChanged",value:function(e){e=Math.round(e);var t=Math.min(5,Math.max(3,Math.round(this.figureLength))),n=y.b[t],r=n[e%n.length];this.figure=Object(d.a)(Object(v.f)(r))(),this.effect.onFiguresChanged()}},{key:"onLengthChanged",value:function(e){e=Math.min(5,Math.max(3,Math.round(e)));var t=y.b[e],n=t[Math.round(this.figureType)%t.length];this.figure=Object(d.a)(Object(v.f)(n))(),this.effect.onFiguresChanged()}},{key:"toString",value:function(){return Object(b.e)(this.figure)}},{key:"getJson",value:function(){var e={figureLength:this.figureLength,figureType:this.figureType};return e=Object(p.b)(e,"figureLengthParameter",this.figureLengthParameter),e=Object(p.b)(e,"figureTypeParameter",this.figureTypeParameter)}},{key:"fromJson",value:function(e){var t={};return Object(h.a)(this.figureLengthParameter,e.figureLength,t),Object(h.a)(this.figureTypeParameter,e.figureType,t),Object(r.a)({},t,Object(p.a)(e,"figureLengthParameter",this.figureLengthParameter),Object(p.a)(e,"figureTypeParameter",this.figureTypeParameter))}}]),n}(Object(m.a)(function(){return function e(){Object(a.a)(this,e)}}()))},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2),u=n(14),l=n(816),f=n(341),h=n(20),p=n(141),d=n(249);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var m=function(e){Object(s.a)(n,e);var t=v(n);function n(e,a){var i;return Object(r.a)(this,n),(i=t.call(this)).subSequence=e,i.zObject=a,i.sequencerEngine=e.sequencerEngine,i.id=Object(h.uuid)(),i.setupShiftParameters(),i}return Object(a.a)(n,[{key:"getConnectedTidal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.zObject&&this.zObject.outlets;return Object(i.a)(Object(c.a)(n.prototype),"getConnectedTidal",this).call(this,e,"params",t)}},{key:"setupShiftParameters",value:function(){var e=this;this.seedParameter=new u.b("seed",this,function(e){return[]},{defaultValue:1,min:1,max:64e3}),this.registerParameter(this.seedParameted),this.shift1Parameter=this.newShiftParameter(1),this.shift2Parameter=this.newShiftParameter(2),this.shift3Parameter=this.newShiftParameter(3),this.shift4Parameter=this.newShiftParameter(4),this.shift5Parameter=this.newShiftParameter(5),this.shift6Parameter=this.newShiftParameter(6),this.hand1Parameter=this.newHandParameter(1),this.hand2Parameter=this.newHandParameter(2),this.hand3Parameter=this.newHandParameter(3),this.hand4Parameter=this.newHandParameter(4),this.hand5Parameter=this.newHandParameter(5),this.hand6Parameter=this.newHandParameter(6),this.scale1Parameter=this.newScaleParameter(1),this.scale2Parameter=this.newScaleParameter(2),this.scale3Parameter=this.newScaleParameter(3),this.scale4Parameter=this.newScaleParameter(4),this.scale5Parameter=this.newScaleParameter(5),this.scale6Parameter=this.newScaleParameter(6),this.truncate1Parameter=this.newTruncateParameter(1),this.truncate2Parameter=this.newTruncateParameter(2),this.truncate3Parameter=this.newTruncateParameter(3),this.truncate4Parameter=this.newTruncateParameter(4),this.truncate5Parameter=this.newTruncateParameter(5),this.truncate6Parameter=this.newTruncateParameter(6),this.tempo1Parameter=this.newTempoParameter(1),this.tempo2Parameter=this.newTempoParameter(2),this.tempo3Parameter=this.newTempoParameter(3),this.tempo4Parameter=this.newTempoParameter(4),this.tempo5Parameter=this.newTempoParameter(5),this.tempo6Parameter=this.newTempoParameter(6),this.rule1Parameter=this.newRuleParameter(1),this.rule2Parameter=this.newRuleParameter(2),this.rule3Parameter=this.newRuleParameter(3),this.rule4Parameter=this.newRuleParameter(4),this.rule5Parameter=this.newRuleParameter(5),this.rule6Parameter=this.newRuleParameter(6),this.swing1Parameter=this.newSwingParameter(1),this.swing2Parameter=this.newSwingParameter(2),this.swing3Parameter=this.newSwingParameter(3),this.swing4Parameter=this.newSwingParameter(4),this.swing5Parameter=this.newSwingParameter(5),this.swing6Parameter=this.newSwingParameter(6),this.offset1Parameter=this.newOffsetParameter(1),this.offset2Parameter=this.newOffsetParameter(2),this.offset3Parameter=this.newOffsetParameter(3),this.offset4Parameter=this.newOffsetParameter(4),this.offset5Parameter=this.newOffsetParameter(5),this.offset6Parameter=this.newOffsetParameter(6),this.triplet1Parameter=this.newTripletParameter(1),this.triplet2Parameter=this.newTripletParameter(2),this.triplet3Parameter=this.newTripletParameter(3),this.triplet4Parameter=this.newTripletParameter(4),this.triplet5Parameter=this.newTripletParameter(5),this.triplet6Parameter=this.newTripletParameter(6),this.newInlet("shift",function(t){return e.onMsg("shift",t)}),this.newInlet("truncate",function(t){return e.onMsg("truncate",t)}),this.newInlet("tempo",function(t){return e.onMsg("tempo",t)}),this.newInlet("hand",function(t){return e.onMsg("hand",t)}),this.newInlet("swing",function(t){return e.onMsg("swing",t)}),this.newInlet("offset",function(t){return e.onMsg("offset",t)})}},{key:"onMsg",value:function(e,t){var n=this,r=[1,2,3,4,5,6].map(function(t){return n[e+t+"Parameter"]});t=t[0],Array.isArray(t)?r.forEach(function(e,n){return e.set(t[n%t.length])}):r.forEach(function(e){return e.set(t)})}},{key:"newRuleParameter",value:function(e){var t=new u.b("rule"+e,this,function(){return 0},{defaultValue:null,min:0,max:12});return this.registerParameter(t),t}},{key:"newShiftParameter",value:function(e){var t=new u.b("shift"+e,this,function(){return 0},{defaultValue:0,min:0,max:16});return this.registerParameter(t),t}},{key:"newScaleParameter",value:function(e){var t=new u.a("scale"+e,this,function(){return 0},{defaultValue:!1});return this.registerParameter(t),t}},{key:"newHandParameter",value:function(e){var t=new u.b("hand"+e,this,function(){return 0},{defaultValue:d.a,min:0,max:3});return this.registerParameter(t),t}},{key:"newTruncateParameter",value:function(e){var t=new u.b("truncate"+e,this,function(){return 0},{defaultValue:0,min:0,max:5});return this.registerParameter(t),t}},{key:"newTempoParameter",value:function(e){var t=new u.b("tempo"+e,this,function(){return 0},{defaultValue:2,min:1,max:5});return this.registerParameter(t),t}},{key:"newSwingParameter",value:function(e){var t=new u.b("swing"+e,this,function(){return 0},{defaultValue:50,min:50,max:100});return this.registerParameter(t),t}},{key:"newOffsetParameter",value:function(e){var t=new u.b("offset"+e,this,function(){return 0},{defaultValue:0,min:0,max:100});return this.registerParameter(t),t}},{key:"newTripletParameter",value:function(e){var t=new u.a("triplet"+e,this,function(){return 0},{defaultValue:!1});return this.registerParameter(t),t}}]),n}(Object(l.a)(Object(p.a)(Object(f.a)(function(){return function e(){Object(r.a)(this,e)}}()))))},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=c(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).cachedTidal={},e}return Object(a.a)(n,[{key:"getConnectedTidal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.outlets;if(this.cachedTidal[e])return this.cachedTidal[e];var r=this.searchForNode("jaki",t,n);return r&&(this.cachedTidal[e]=r.effect.tidals[e]),this.cachedTidal[e]}}]),n}(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return w});var r=n(1),a=n(11),i=n(4),s=n(5),o=n(10),c=n(6),u=n(8),l=n(2),f=n(135),h=n(272),p=n(311),d=n(353),v=n(312),m=n(176),y=n(522),b=n(141),g=n(129);function O(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var w=function(e){Object(c.a)(n,e);var t=j(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,"Rules Rack",e)).zObject=r,a.initializeConfigurations(a.adjacencyLists),a.addInitialRules(),a.newOutlet(g.h),a}return Object(s.a)(n,[{key:"addInitialRules",value:function(){this.loaded=!1,this.addEffect(new y.e(this)),this.addEffect(new y.c(this)),this.addEffect(new y.d(this)),this.addEffect(new y.n(this)),this.addEffect(new y.s(this)),this.addEffect(new y.o(this)),this.addEffect(new y.p(this)),this.addEffect(new y.u(this)),this.addEffect(new y.a(this)),this.addEffect(new y.l(this)),this.addEffect(new y.f(this)),this.addEffect(new y.i(this)),this.addEffect(new y.r(this)),this.addEffect(new y.b(this)),this.addEffect(new y.v(this)),this.loaded=!0,this.updateRules(),this.coord(0,36,10),this.coord(1,92,10),this.coord(2,144,10),this.coord(3,203,10),this.coord(4,11,72),this.coord(5,60,72),this.coord(6,130,72),this.coord(7,177,72),this.coord(8,236,72),this.coord(9,199,129),this.coord(10,12,129),this.coord(11,63,129),this.coord(12,128,129),this.coord(12,200,129),this.coord(12,230,129)}},{key:"coord",value:function(e,t,n){this.effects[e].x=t,this.effects[e].y=n}},{key:"isRack",get:function(){return!0}},{key:"addEffect",value:function(e){Object(o.a)(Object(l.a)(n.prototype),"addEffect",this).call(this,e),e.rack=this,this.updateRules()}},{key:"updateRules",value:function(){var e=this;if(this.loaded){var t=[];t=[],["Dot","Dash 1","Dash 2","Accent","Any","Times","Double","Staccato","Legato","Piano","Rest","Pianissimo","Otherwise"].forEach(function(n){t=[].concat(Object(a.a)(t),Object(a.a)(e.generateRules(e.effects.find(function(e){return e.name===n}))))}),this.rules=t,this.publishRules()}}},{key:"publishRules",value:function(){this.sendMessage(g.h,this.rules)}},{key:"connectNodes",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(o.a)(Object(l.a)(n.prototype),"connectNodes",this)).call.apply(e,[this].concat(r)),this.updateRules()}},{key:"deleteEdge",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(o.a)(Object(l.a)(n.prototype),"deleteEdge",this)).call.apply(e,[this].concat(r)),this.updateRules()}},{key:"deleteEffect",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(o.a)(Object(l.a)(n.prototype),"deleteEffect",this)).call.apply(e,[this].concat(r)),this.updateRules()}},{key:"generateRules",value:function(e,t){if(!e)return[];var n=this.adjacencyLists[e.id];if(!n)return[];var r,i=[],s=O(n);try{for(s.s();!(r=s.n()).done;){var o=r.value,c=o.effect,u=o.outputNumber,l=t;t||(l="Otherwise"===e.name?Object(m.p)():x(u)(e.predicate||e.action)),c.aux?(l=c.aux(l,c.value),i=[].concat(Object(a.a)(i),Object(a.a)(this.generateRules(c,l)))):(c.action&&(l=l.always(c.action)),i.push(l))}}catch(f){s.e(f)}finally{s.f()}return i}},{key:"dot",get:function(){return this.effects.find(function(e){return"Dot"===e.name})}},{key:"dash1",get:function(){return this.effects.find(function(e){return"Dash 1"===e.name})}},{key:"dash2",get:function(){return this.effects.find(function(e){return"Dash 2"===e.name})}},{key:"getJson",value:function(){return this.getRackJson()}},{key:"fromJson",value:function(e,t,a,i){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t;this.adjacencyLists={},this.initializeConfigurations(this.adjacencyLists,!1),this.effects=[],this.loaded=!1;var c=Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t),u=e.effects;for(var f in u){var p=u[f],d=Object(h.a)(p,this.track);if(c=Object(r.a)({},c,d.fromJson(p,s)),d.id!==p.id){var v,m=O(e.configurations);try{for(m.s();!(v=m.n()).done;){var y=v.value,b=y[p.id];y[d.id]=b,delete y[p.id]}}catch(g){m.e(g)}finally{m.f()}}this.addEffect(d,!1),d.x=p._x||p.x,d.y=p._y||p.y}return this.fromRackJson(e,t),this.loaded=!0,this.updateRules(),c}}]),n}(Object(b.a)(Object(p.a)(Object(d.a)(Object(v.a)(f.a))))),x=function(e){switch(e){case 0:return m.o;case 1:return m.r;default:return m.l}}},function(e,t,n){"use strict";n.d(t,"a",function(){return w});var r=n(1),a=n(11),i=n(107),s=n(4),o=n(5),c=n(31),u=n(6),l=n(8),f=n(2),h=n(341),p=n(249),d=n(20),v=n(191),m=n(362),y=n(814),b=n(141);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var O=Object(m.a)(Object(v.f)(". -")),k=Object(m.a)(Object(v.f)(". . -")),j=Object(m.a)(Object(v.f)(". . . -")),w=function(e){Object(u.a)(n,e);var t=g(n);function n(e,r){var a;return Object(s.a)(this,n),(a=t.call(this)).subSequence=e,a.zObject=r,a.sequencerEngine=e.sequencerEngine,a.id=Object(d.uuid)(),a.figures=[new y.a(O,Object(c.a)(a)),new y.a(k,Object(c.a)(a)),new y.a(j,Object(c.a)(a)),new y.a(k,Object(c.a)(a))],a.newInlet("swap",function(e){return a.onSwap(e)}),a.onFiguresChanged(),a}return Object(o.a)(n,[{key:"onSwap",value:function(e){var t=Object(i.a)(e[0],2),n=t[0],r=t[1];if(console.log("on swap = ",n,r),n%=this.figures.length,r%=this.figures.length,!isNaN(n)&&!isNaN(r)){var a=this.figures[n];this.figures[n]=this.figures[r],this.figures[r]=a,console.log("swapping",this.figures[n],this.figures[r]),this.onFiguresChanged()}}},{key:"updateFigure",value:function(e,t){for(var n=-1,r=0;r<this.figures.length;r++)if(e===this.figures[r]){n=r;break}return t=Object(m.a)(Object(v.f)(t)),this.figures[n].updateFigure(t),this.figures=Object(a.a)(this.figures),this.onFiguresChanged(),this.figures[n]}},{key:"onFiguresChanged",value:function(){var e=this;if(this.figures){this._figures=this.figures.map(function(e){return e.figure});for(var t=function(t){var n=e.getFigureInletName(t);e.inlets[n]||e.newInlet(n,function(){return e.onFigureTypeChange(t)})},n=0;n<this._figures.length;n++)t(n)}}},{key:"onFigureTypeChange",value:function(e){var t=this.figures[e];if(t){var n=p.b[t.figureLength],r=(t.figureType+1)%n.length;t.figureTypeParameter.set(r)}}},{key:"newFigure",value:function(){this.figures=[].concat(Object(a.a)(this.figures),[new y.a(O,this)]),this.onFiguresChanged()}},{key:"getFigureInletName",value:function(e){return"figure-type-"+(e+1)}},{key:"deleteFigure",value:function(e){this.figures.indexOf(e);this.deleteInlet(this.getFigureInletName(e)),this.figures=this.figures.filter(function(t){return t!==e}),this.onFiguresChanged()}},{key:"fromJson",value:function(e){var t=e.figures,n=e.id,a={};if(this.id=n,!t)return a;for(var i=0;i<t.length;i++){var s=t[i];"string"===typeof s?(this.figures[i]=new y.a(Object(m.a)(Object(v.f)(s)),this),this.updateFigure(this.figures[i],s)):(this.figures[i]||this.newFigure(),a=Object(r.a)({},a,this.figures[i].fromJson(s)))}return this.figures=this.figures.slice(0,t.length),this.onFiguresChanged(),a}},{key:"getJson",value:function(){return{id:this.id,figures:this.figures.map(function(e){return e.getJson()})}}}]),n}(Object(b.a)(Object(h.a)(function(){return function e(){Object(s.a)(this,e)}}())))},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"d",function(){return i}),n.d(t,"c",function(){return s});var r="AUDITION_NEXT_SAMPLE",a="AUDITION_PREVIOUS_SAMPLE",i="TRIGGER_SAMPLE",s="RELEASE_SAMPLE"},,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return b});var r=n(42),a=n.n(r),i=n(56),s=n(107),o=n(3),c=n.n(o),u=(n(539),n(130)),l=n(122),f=n(411),h=n(7),p=n.n(h),d=n(290),v=n(138),m=n(23),y=n(55),b=(new u.a,function(t,n){return new Promise(function(t){var r=new FileReader;n.name.includes(".wav")||n.name.includes(".flac")||n.name.includes(".mp3")?(r.readAsArrayBuffer(n),r.onloadend=Object(i.a)(a.a.mark(function i(){var s,o,c,u;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return s=r.result,Int8Array.from(s),a.next=4,l.a.addArrayBuffer(s);case 4:if(o=a.sent,u=new v.a(d.a),!n.name.includes("mp3")){a.next=13;break}return a.next=9,Object(f.a)(new Int8Array(s));case 9:c=a.sent,u.mp3Data=new e(s),a.next=16;break;case 13:return a.next=15,p.a.Master.context.decodeAudioData(s);case 15:c=a.sent;case 16:u.ipfsHash=o,u.audioBuffer=c,u.name=n.name,t(u);case 20:case"end":return a.stop()}},i)}))):window.alert("Only accepts .wav, .mp3, & .flac files for now")})});t.a=Object(y.b)(function(e,t){return{playlist:t.sporeStems.playlist,currentStems:t.sporeStems.stems}},function(e){return{}})(function(e){var t=e.sporeStems,n=(e.playlist,e.currentStems,Object(o.useState)(!1)),r=Object(s.a)(n,2),u=(r[0],r[1],Object(o.useState)()),l=Object(s.a)(u,2),f=l[0],h=l[1],p=Object(o.useState)(""),d=Object(s.a)(p,2),v=d[0],y=d[1],g=Object(o.useState)(!1),O=Object(s.a)(g,2),k=O[0],j=O[1],w=Object(o.useRef)(),x=(Object(o.useCallback)(function(){var e=Object(i.a)(a.a.mark(function e(n){var r,i,s,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.stopPropagation(),n.preventDefault(),n.dataTransfer.effectAllowed="none",n.dataTransfer.dropEffect="none",!n.dataTransfer.items){e.next=15;break}for(t.sequencerEngine.dispatch(Object(m.Je)(!0)),r=[],i=n.dataTransfer.items.length,s=0;s<i;s++)"file"===n.dataTransfer.items[s].kind&&r.push(b(t.sequencerEngine,n.dataTransfer.items[s].getAsFile()));return e.next=11,Promise.all(r);case 11:o=e.sent,w.current=o,t.sequencerEngine.dispatch(Object(m.Je)(!1)),j(!0);case 15:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[f,j]),Object(o.useCallback)(function(e){var t=parseFloat(e.target.value);isNaN(t)||h(t)},[h])),S=Object(o.useCallback)(function(e){var t=e.target.value;y(t)},[y]),P=Object(o.useCallback)(function(){t.newStems(w.current,v,f),j(!1),y("")},[f,v,j,y]);return k?c.a.createElement("div",{className:"spore-stems-container"},c.a.createElement("div",{className:"field-container"},c.a.createElement("div",{className:"field-label"},"Name"),c.a.createElement("input",{onChange:S,text:v,placeholder:"Enter Name"})),c.a.createElement("div",{className:"field-container"},c.a.createElement("div",{className:"field-label"},"BPM"),c.a.createElement("input",{onChange:x,text:f,placeholder:"Enter BPM"})),c.a.createElement("div",{onClick:P,className:"save-stem-btn"},"Add To Playlist")):c.a.createElement("div",{className:"spore-stems-container"},c.a.createElement("img",{draggable:"false",src:"/white-zequencer-logo.svg",className:"stems-logo"}))})}).call(this,n(108).Buffer)},function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(55);n(841);t.a=Object(i.b)(function(e,t){return{}},function(e){return{}})(function(e){for(var t=e.percentage,n=e.radius,r=2*(n-32)*Math.PI,i=(100-t)/100*r,s={},o=[],c=0;c<16;c++)o.push(t/32/100*r),o.push(t/32/100*r);return o.pop(),o.push(i),a.a.createElement("svg",{className:"circular-progress",width:2*n+"px",height:2*n+"px"},a.a.createElement("defs",null,a.a.createElement("linearGradient",{id:"linear",x1:"0%",y1:"0%",x2:"100%",y2:"0%"},a.a.createElement("stop",{offset:"0%","stop-color":"#fbe433"}),a.a.createElement("stop",{offset:"50%","stop-color":"#eae92c"}),a.a.createElement("stop",{offset:"100%","stop-color":"#28ff5d"}))),a.a.createElement("circle",{className:"outter-circle",strokeWidth:16,style:s,cx:n+16,cy:n+16,r:n-32}),t>0&&a.a.createElement("circle",{className:"inner-circle",strokeDashoffset:n+4,strokeWidth:16,strokeDasharray:o.join(","),stroke:"url(#linear)",style:s,cx:n+16,cy:n+16,r:n-32}))})},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(107),a=n(140),i=function(e){return"object"===typeof e&&0===Object.keys(e).length?"p":"p - ".concat(Object(a.b)(e),".x *\n    clamp(\n        round(p/").concat(Object(a.b)(e),".x), \n        -vec3(").concat(Object(a.b)(e),".y, ").concat(Object(a.b)(e),".z, ").concat(Object(a.b)(e),".w), \n        vec3(").concat(Object(a.b)(e),".y, ").concat(Object(a.b)(e),".z, ").concat(Object(a.b)(e),".w))")},s={cappedCylinder:function(e){var t=Object(r.a)(e,8),n=t[0],s=(t[1],t[2]),o=(t[3],t[4]),c=(t[5],t[6]),u=t[7];return{args:{p:"vec3"},returnType:"vec2",body:"\n   p = (p - ".concat(n,")*").concat(o,"  + (").concat(n,")*(").concat(o," - identity);\n   p = ").concat(i(u),";\n   float h = ").concat(Object(a.b)(s),".x;\n   float r = ").concat(Object(a.b)(s),".y;\n  vec2 d = abs(vec2(length(p.xz),p.y)) - vec2(h,r);\n  return vec2(min(max(d.x,d.y),0.0) + length(max(d,0.0)), ").concat(Object(a.b)(c),");\n")}},rect:function(e){var t=Object(r.a)(e,6),n=t[0],i=(t[1],t[2]),s=t[3],o=t[4],c=t[5];return{args:{p:"vec2"},returnType:"vec2",body:"\n    return vec2(sdRoundBoxCoord(\n        p, \n        ".concat(Object(a.b)(n),", \n        (").concat(Object(a.b)(i),"), \n        ").concat(Object(a.b)(s),",\n        identity,\n        ").concat(Object(a.b)(o),"), ").concat(Object(a.b)(c),");\n")}},box:function(e){var t=Object(r.a)(e,8),n=t[0],s=(t[1],t[2]),o=t[3],c=t[4],u=t[5],l=t[6],f=t[7];return{args:{p:"vec3"},returnType:"vec2",body:"\n\n  p = (p - ".concat(n,")*").concat(c,"  + (").concat(n,")*(").concat(c," - identity);\n  vec3 q = ").concat(i(f),";\n  return vec2(sdRoundBox3DCoord(\n        q, \n        ").concat(Object(a.b)(n),", \n        (").concat(Object(a.b)(s),"), \n        ").concat(Object(a.b)(o),", \n        ").concat(Object(a.b)(c||"identity"),", \n        ").concat(Object(a.b)(u),"), ").concat(Object(a.b)(l),");\n")}},circle:function(e){var t=Object(r.a)(e,6),n=t[0],i=(t[1],t[2]),s=(t[3],t[4],t[5]);return{args:{p:"vec2"},returnType:"vec2",body:"\n\nreturn vec2(length(p - ".concat(Object(a.b)(n),") - ").concat(Object(a.b)(i),".x, ").concat(Object(a.b)(s),");\n")}},sphere:function(e){var t=Object(r.a)(e,7),n=t[0],i=(t[1],t[2]),s=(t[3],t[4],t[5],t[6]);return{args:{p:"vec3"},returnType:"vec2",body:"\nreturn vec2(length(p - ".concat(Object(a.b)(n),") - ").concat(Object(a.b)(i),".x, ").concat(Object(a.b)(s),");\n")}},torus:function(e){var t=Object(r.a)(e,7),n=t[0],i=(t[1],t[2]),s=(t[3],t[4]),o=(t[5],t[6]);return{args:{p:"vec3"},returnType:"vec2",body:"\n    p = (p - ".concat(n,")*").concat(s,"  + (").concat(n,")*(").concat(s," - identity);\n    vec3 r = ").concat(i,";\n    float x = length(p.xz)-r.x;\n    return vec2(\n        length(vec2(x, p.y)) - r.y, \n        ").concat(Object(a.b)(o),");\n")}},plane:function(e){var t=Object(r.a)(e,7),n=t[0],i=(t[1],t[2]),s=(t[3],t[4],t[5],t[6]);return{args:{p:"vec3"},returnType:"vec2",body:"\n    return vec2(\n        dot(p, ".concat(i,") + ").concat(n,".x,\n        ").concat(Object(a.b)(s),");\n")}},hexagon:function(e){var t=Object(r.a)(e,6),n=t[0],i=(t[1],t[2]),s=(t[3],t[4]),o=t[5];return{args:{p:"vec2"},returnType:"vec2",body:"\n    p -= ".concat(Object(a.b)(n),";\n    if (").concat(Object(a.b)(s)," != 0.0) {\n    p *= rotate2D(").concat(Object(a.b)(s),");\n    }\n    float r = ").concat(Object(a.b)(i),".x;\n    const vec3 k = vec3(-0.866025404,0.5,0.577350269);\n    p = abs(p);\n     p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n    p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n    return vec2(length(p)*sign(p.y), ").concat(Object(a.b)(o),");\n\n")}}}},function(e,t,n){"use strict";n.d(t,"a",function(){return O});var r=n(1),a=n(4),i=n(5),s=n(31),o=n(10),c=n(6),u=n(8),l=n(2),f=n(116),h=n(227),p=n(119),d=n(112),v=n(123),m=n(7),y=n.n(m),b=n(916);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var O=function(e){Object(c.a)(n,e);var t=g(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Multi Filter",function(){return new y.a.Gain(1)},e)).context=(new v.a).forEffect(Object(s.a)(r)),r.preset=new h.a,r.setupFormants(),r.track={sequencerEngine:e},r.crossFade=new y.a.CrossFade(1),r.wetParameter=new d.c("Wet",r.crossFade.fade,{documentation:"Controls the amount of (wet) effected signal, vs. dry (un-effected) signal.",defaultValue:.5,min:0,max:1}),r.registerParameter(r.wetParameter),r.gainParameter=new d.c("Output Gain",r.formantsManager.output.gain,{defaultValue:1,min:0,max:4}),r.registerParameter(r.gainParameter),r.effectNode.connect(r.formantsManager.input),r.outputNode=new y.a.Gain(1),r.effectNode.connect(r.crossFade,0,0),r.formantsManager.output.connect(r.crossFade,0,1),r.crossFade.connect(r.outputNode),r}return Object(i.a)(n,[{key:"getJson",value:function(){for(var e,t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];var s=Object(r.a)({},(e=Object(o.a)(Object(l.a)(n.prototype),"getJson",this)).call.apply(e,[this].concat(a)),{gain:this.gainParameter.get(!0),multiFilter:this.getFormantsJson()});return s=this.saveParameterToJson(s,"gainParameter",this.gainParameter)}},{key:"fromJson",value:function(e,t,a,i){var s=Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,i);return"gain"in e&&Object(p.a)(this.gainParameter,e.gain,s),Object(r.a)({},s,this.loadFormantsJson(e.multiFilter,i),this.loadParameterFromJson(e,"gainParameter",this.gainParameter,i))}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(){this.outputNode.disconnect()}}]),n}(Object(b.a)(f.a.Effect))},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(116),f=n(119),h=n(7),p=n.n(h),d=n(112);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(o.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Gain",function(){return new p.a.Gain(1)},e)).effectNode.gain.value=1,r.gainParameter=new d.c("Gain",r.effectNode.gain,{documentation:"Controls the gain (or loudness) of the signal before it hits the compressor",min:0,max:6,unit:"db",defaultValue:1}),r.registerParameter(r.gainParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getJson",value:function(e){var t=Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return t.gain=this.gainParameter.get(),t=this.saveParameterToJson(t,"gainParameter",this.gainParameter)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return"gain"in e&&Object(f.a)(this.gainParameter,e.gain,a),Object(r.a)({},a,this.loadParameterFromJson(e,"gainParameter",this.gainParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(l.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(10),u=n(6),l=n(8),f=n(2),h=n(116),p=n(167),d=(n(119),n(7)),v=n.n(d);n(14);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var y=function(e){Object(u.a)(n,e);var t=m(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Granulator",function(){return new v.a.Gain(1)},e,!0)).outputNode=new v.a.Gain(1),r.loadedValue=1,r.initializeWorklets(),r.updateInitialValues(),r}return Object(o.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"initializeWorklets",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!p.isMobile&&!this.sequencerEngine.isOffline){e.next=4;break}this.effectNode.connect(this.outputNode),e.next=9;break;case 4:return e.next=6,this.sequencerEngine.initAudioWorklets();case 6:this.granulator=new AudioWorkletNode(v.a.Master.context._context,"granulator-node"),this.effectNode.connect(this.granulator),this.granulator.connect(this.outputNode);case 9:this.updateInitialValues();case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getJson",value:function(e){return Object(c.a)(Object(f.a)(n.prototype),"getJson",this).call(this)}},{key:"fromJson",value:function(e,t){return Object(c.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(h.a.Effect);t.a=y},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(31),u=n(10),l=n(6),f=n(8),h=n(2),p=n(116),d=n(167),v=(n(119),n(7)),m=n.n(v),y=n(14);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var g=function(e){Object(l.a)(n,e);var t=b(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Soft Clipper",function(){return new m.a.Gain(1)},e,!0)).outputNode=new m.a.Gain(1),r.amountParameter=new y.a("Amount",Object(c.a)(r),function(e,t){return r.softClipper?r.softClipper.parameters.get("amount").value=t:r.effectNode.gain.value=t},{documentation:"Controls the amount of soft clipping",min:0,max:8,defaultValue:1}),r.registerParameter(r.amountParameter),r.loadedValue=1,r.initializeWorklets(),r.updateInitialValues(),r}return Object(o.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"initializeWorklets",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!d.isMobile&&!this.sequencerEngine.isOffline){e.next=4;break}this.effectNode.connect(this.outputNode),e.next=10;break;case 4:return e.next=6,this.sequencerEngine.initAudioWorklets();case 6:this.softClipper=new AudioWorkletNode(m.a.Master.context._context,"soft-clipper-node"),this.amountParameter.set(this.loadedValue,!1,!1),this.effectNode.connect(this.softClipper),this.softClipper.connect(this.outputNode);case 10:this.updateInitialValues();case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getJson",value:function(e){var t=Object(u.a)(Object(h.a)(n.prototype),"getJson",this).call(this);return t.amount=this.amountParameter.get(),t}},{key:"fromJson",value:function(e,t){var r=Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,e,t);if(e.amount){this.loadedValue=e.amount;var a=this.amountParameter.set(e.amount,!1,!1),i=a.id,s=a.value;r[i]=s}return r}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(p.a.Effect);t.a=g},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2),u=n(116),l=n(7),f=n.n(l),h=n(14);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var d=function(e){Object(s.a)(n,e);var t=p(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Auto Wah",function(){return new f.a.AutoWah(50,6,-30)},e)).effectNode.gain.value=6,a.baseFrequencyParameter=new h.a("Base Frequency",a.effectNode,function(e,t){return e.baseFrequency=t},{min:0,max:1e4,unit:"hz",defaultValue:400}),a.registerParameter(a.baseFrequencyParameter),a.octaveParameter=new h.a("Octaves",a.effectNode,function(e,t){return e.octaves=t},{min:0,max:10,unit:"",defaultValue:1}),a.registerParameter(a.octaveParameter),a.qParameter=new h.c("Q",a.effectNode.Q,{min:0,max:10,unit:"",defaultValue:0}),a.registerParameter(a.qParameter),a.sensitivityParameter=new h.a("Sensitivity",a.effectNode,function(e,t){return e.sensitivity=t},{min:-12,max:6,unit:"db",defaultValue:0}),a.registerParameter(a.sensitivityParameter),a.attackParameter=new h.a("Attack",a.effectNode,function(e,t){return e.follower.attack=t},{min:0,max:2,unit:"",defaultValue:0}),a.registerParameter(a.attackParameter),a.releaseParameter=new h.a("Release",a.effectNode,function(e,t){return e.follower.release=t},{min:0,max:2,unit:"",defaultValue:0}),a.registerParameter(a.releaseParameter),a}return Object(a.a)(n,[{key:"getJson",value:function(){var e=Object(i.a)(Object(c.a)(n.prototype),"getJson",this).call(this);return e.name=this.name,e.baseFrequency=this.baseFrequencyParameter.get(),e.octave=this.octaveParameter.get(),e.q=this.qParameter.get(),e.sensitivity=this.sensitivityParameter.get(),e.attack=this.attackParameter.get(),e.release=this.releaseParameter.get(),e.wet=this.wetParameter.get(),e}},{key:"fromJson",value:function(e,t){Object(i.a)(Object(c.a)(n.prototype),"fromJson",this).call(this,e,t),"baseFrequency"in e&&this.baseFrequencyParameter.set(e.baseFrequency),"octave"in e&&this.octaveParameter.set(e.octave),"sensitivity"in e&&this.sensitivityParameter.set(e.sensitivity),"q"in e&&this.qParameter.set(e.q),"attack"in e&&this.attackParameter.set(e.attack),"release"in e&&this.releaseParameter.set(e.release),e.enabled&&this.enable(!0),"wet"in e&&this.setValue(e.wet)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(u.a.Effect);t.a=d},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(10),u=n(6),l=n(8),f=n(2),h=n(116),p=(n(119),n(7)),d=n.n(p);n(112);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var m=function(e){Object(u.a)(n,e);var t=v(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Granular",function(){return new d.a.Gain(1)},e)).effectNode.gain.value=1,r.outputNode=new d.a.Gain(1),r.initWorklet(),r.updateInitialValues(),r}return Object(o.a)(n,[{key:"initWorklet",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.a.Master.context._context,e.next=3,t.audioWorklet.addModule("/granular-processor.js");case 3:this.granularNode=new AudioWorkletNode(t,"granular-processor"),this.effectNode.connect(this.granularNode),this.granularNode.connect(this.outputNode);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"connect",value:function(e){this.connectedNode=e,this.outputNode.connect(e)}},{key:"disconnect",value:function(e){void 0!=this.connectedNode&&(this.outputNode.disconnect(e),this.connectedNode=void 0)}},{key:"getJson",value:function(e){return Object(c.a)(Object(f.a)(n.prototype),"getJson",this).call(this)}},{key:"fromJson",value:function(e,t){Object(c.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(h.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2),u=n(116),l=n(7),f=n.n(l),h=n(14);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}u.a.Effect},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2),u=n(116),l=n(7),f=n.n(l),h=n(112);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var d=function(e){Object(s.a)(n,e);var t=p(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Stereo Widener",function(){return new f.a.StereoWidener(.5)},e)).widthParameter=new h.c("Width",a.effectNode.width,{min:0,max:1,defaultValue:.5}),a.registerParameter(a.widthParameter),a.updateInitialValues(),a}return Object(a.a)(n,[{key:"getJson",value:function(){var e=Object(i.a)(Object(c.a)(n.prototype),"getJson",this).call(this);return e.width=this.widthParameter.get(),e=this.saveParameterToJson(e,"widthParameter",this.widthParameter)}},{key:"fromJson",value:function(e,t){Object(i.a)(Object(c.a)(n.prototype),"fromJson",this).call(this,e,t),this.widthParameter.set(e.width),this.loadParameterFromJson(e,"widthParameter",this.widthParameter,t)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(u.a.Effect);t.a=d},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(31),o=n(10),c=n(6),u=n(8),l=n(2),f=n(119),h=n(7),p=n.n(h),d=n(116),v=n(112),m=n(14),y=n(853);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var g=function(e){Object(c.a)(n,e);var t=b(n);function n(e){var r;Object(a.a)(this,n),r=t.call(this,"Ring Modulator",function(){return new p.a.Gain(.5)},e);var i=p.a.Master.context;return r.dryIn=r.effectNode,r.wetIn=new p.a.Gain(.5),r.dryIn.connect(r.wetIn),r.cross=new p.a.CrossFade(.5),r.dryIn.connect(r.cross,0,0),r.outGain=new p.a.Gain(1),r.outGain.connect(r.cross,0,1),r.wetParameter=new v.c("Wet",r.cross.fade,{documentation:"Controls the amount of (wet) effected signal, vs. dry (un-effected) signal.",defaultValue:.5,min:0,max:1}),r.registerParameter(r.wetParameter),r.cross.connect(r.outGain),r.vInGain=new p.a.Gain(.5),r.vIn=i.createOscillator(),r.vIn.frequency.value=30,r.vIn.start(0),r.vInInverter1=new p.a.Gain(-1),r.vInInverter2=new p.a.Gain(-1),r.vInInverter3=new p.a.Gain(-1),r.vInDiode1=new y.a(e),r.vInDiode2=new y.a(e),r.vcInverter1=i.createGain(),r.vcInverter1.gain.value=-1,r.vcDiode3=new y.a(e),r.vcDiode4=new y.a(e),r.compressor=new p.a.Compressor(-12,3),r.vIn.connect(r.vInGain),r.wetIn.connect(r.vcInverter1),r.wetIn.connect(r.vcDiode4.effectNode),r.vcInverter1.connect(r.vcDiode3.effectNode),r.vInGain.connect(r.vInInverter1),r.vInGain.connect(r.vcInverter1),r.vInGain.connect(r.vcDiode4.effectNode),r.vInInverter1.connect(r.vInInverter2),r.vInInverter1.connect(r.vInDiode2.effectNode),r.vInInverter2.connect(r.vInDiode1.effectNode),r.vInDiode1.connect(r.vInInverter3),r.vInDiode2.connect(r.vInInverter3),r.vInInverter3.connect(r.compressor),r.vcDiode3.connect(r.compressor),r.vcDiode4.connect(r.compressor),r.compressor.connect(r.outGain),r.frequencyParameter=new v.c("Frequency",r.vIn.frequency,{min:1,max:3e3,unit:"",defaultValue:30}),r.registerParameter(r.frequencyParameter),r.distortionParameter=new m.a("distortion",Object(s.a)(r),function(e,t){r.vInDiode1.distortionParameter.set(t),r.vInDiode2.distortionParameter.set(t),r.vcDiode3.distortionParameter.set(t),r.vcDiode4.distortionParameter.set(t)},{documention:"Controls the level of saturation.",min:2,max:10,unit:"",defaultValue:.3,constantAutomationRate:!0}),r.registerParameter(r.distortionParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"connect",value:function(e){this.cross.connect(e)}},{key:"disconnect",value:function(e){this.cross.disconnect()}},{key:"getJson",value:function(e){var t=Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this);return t.frequency=this.frequencyParameter.get(),t.distortion=this.distortionParameter.get(),t=this.saveParameterToJson(t,"frequencyParameter",this.frequencyParameter,e),t=this.saveParameterToJson(t,"distortionParameter",this.distortionParameter,e)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(f.a)(this.frequencyParameter,e.frequency,a),Object(f.a)(this.distortionParameter,e.distortion,a),Object(r.a)({},a,this.loadParameterFromJson(e,"frequencyParameter",this.frequencyParameter,t),this.loadParameterFromJson(e,"distortionParameter",this.distortionParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(d.a.Effect);t.a=g},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(31),o=n(10),c=n(6),u=n(8),l=n(2),f=n(116),h=n(119),p=n(7),d=n.n(p),v=n(14);n(112),n(344);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}new Float32Array(65536);var y=function(e){Object(c.a)(n,e);var t=m(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Diode",function(){return new d.a.WaveShaper([-1,1])},e)).vb=.2,r.vl=.4,r.distortionParameter=new v.a("distortion",Object(s.a)(r),function(e,t){r.recomputeCurve()},{documention:"Controls the level of saturation.",min:2,max:10,unit:"",defaultValue:.1,constantAutomationRate:!0}),r.registerParameter(r.distortionParameter),r}return Object(i.a)(n,[{key:"distortion",get:function(){return this.distortionParameter?this.distortionParameter.get():1}},{key:"recomputeCurve",value:function(){for(var e=new Float32Array(1024),t=0;t<1024;t++){var n=(t-512)/512,r=0;r=(n=Math.abs(n))<=this.vb?0:this.vb<n&&n<=this.vl?this.distortion*(Math.pow(n-this.vb,2)/(2*this.vl-2*this.vb)):this.distortion*n-this.distortion*this.vl+this.distortion*(Math.pow(this.vl-this.vb,2)/(2*this.vl-2*this.vb)),e[t]=r}this.effectNode.curve=e}},{key:"documentation",get:function(){return"Saturates the sound, making it more distorted."}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{distortionParameter:this.distortionParameter.get()});return e=this.saveParameterToJson(e,"distortion",this.distortionParameter)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(h.a)(this.distortionParameter,e.distortion,a),Object(r.a)({},a,this.loadParameterFromJson(e,"distortionParameter",this.distortionParamet,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(f.a.Effect);t.a=y},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2),u=n(116),l=n(7),f=n.n(l);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var p=1024,d=function(e){Object(s.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Oscilloscope",function(){return new f.a.Analyser({type:"waveform",size:p})},e)).size=p,a.newOutlet("Waveform Data"),a.newInlet("Start",function(){return a.onStart()}),a}return Object(a.a)(n,[{key:"dispose",value:function(){this.interval&&clearInterval(this.interval),Object(i.a)(Object(c.a)(n.prototype),"dispose",this).call(this)}},{key:"onStart",value:function(){var e=this;this.interval=setInterval(function(){e.sendMessage("Waveform Data",e.getValue())},64)}},{key:"getValue",value:function(){return this.effectNode.getValue()}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine;!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new n(e)}}]),n}(u.a.Effect);t.a=d},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(7),s=n.n(i),o="QmcdpaZe62u6p47s2Nmi7jYLpgTbmz6MxVnwvndNFi53Sf",c=new(function(){function e(){Object(r.a)(this,e),this.DEFAULT_BUFFER=new s.a.Buffer(window.isNFT?o:"/ipfs/"+o)}return Object(a.a)(e,[{key:"updateBuffer",value:function(){this.DEFAULT_BUFFER=new s.a.Buffer(window.isNFT?o:"/ipfs/"+o)}},{key:"setSampleRate",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];e!==s.a.context.sampleRate&&(s.a.setContext(new AudioContext({sampleRate:e,latencyHint:"playback"})),console.log("CHOOSING SAMPLE RATE=",e),window.context=s.a.Master.context,this.DEFAULT_BUFFER=new s.a.Buffer(window.isNFT?o:"/ipfs/"+o))}}]),e}());t.a=c},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(7),f=n.n(l),h=n(119),p=n(116),d=n(112);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(o.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Chebyshev",function(){return new f.a.Chebyshev(1)},e)).effectNode.oversampling="none",r.orderParameter=new d.a("Order",r.effectNode,function(e,t){return e.order=t},{min:1,max:100,unit:"",defaultValue:1}),r.registerParameter(r.orderParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"getJson",value:function(e){var t=Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return t.order=this.effectNode.order,t.enabled=this.enabledParameter.get(),t.wet=this.effectNode.wet.value,t.name=this.name,t=this.saveParameterToJson(t,"orderParameter",this.orderParameter,e)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(h.a)(this.orderParameter,e.order,a),e.enabled&&this.enable(!0),this.setValue(e.value),Object(r.a)({},a,this.loadParameterFromJson(e,"orderParameter",this.orderParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(p.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(7),f=n.n(l),h=n(116),p=n(112);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var v=function(e){Object(o.a)(n,e);var t=d(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Bit Crusher",function(){return new f.a.BitCrusher(8)},e)).bitsParameter=new p.a("Bits",r.effectNode,function(e,t){return e.bits=t},{min:1,max:8,unit:"",defaultValue:8}),r.registerParameter(r.bitsParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"getJson",value:function(e){var t=Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return t.bits=this.bitsParameter.get(),t.name=this.name,this.saveParameterToJson(t,"bitsParameter",this.bitsParameter,e)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return this.effectNode.bits=e.bits,this.effectNode.wet.value=e.wet,e.enabled&&this.enable(!0),Object(r.a)({},a,this.loadParameterFromJson(e,"bitsParameter",this.bitsParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(h.a.Effect);t.a=v},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(116),f=n(119),h=n(7),p=n.n(h),d=n(112);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(o.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Compressor",function(){return new p.a.Gain(1)},e)).effectNode.gain.value=1,r.compressorNode=new p.a.Compressor(-24,3),r.effectNode.connect(r.compressorNode),r.gainParameter=new d.c("Gain",r.effectNode.gain,{documentation:"Controls the gain (or loudness) of the signal before it hits the compressor",min:0,max:1,unit:"db",defaultValue:1}),r.registerParameter(r.gainParameter),r.thresholdParameter=new d.c("Threshold",r.compressorNode.threshold,{documentation:"The threshold of volume at which the compressor begins to compress.",min:-80,max:0,unit:"",defaultValue:-4,constantAutomationRate:!0,automatable:!1}),r.registerParameter(r.thresholdParameter),r.ratioParameter=new d.c("Ratio",r.compressorNode.ratio,{documentation:"The amount of compression that occurs once the signal passes the threshold.",min:1,max:24,unit:"",defaultValue:3,constantAutomationRate:!0}),r.registerParameter(r.ratioParameter),r.attackParameter=new d.b("Attack",r.compressorNode.attack,{constantAutomationRate:!0}),r.registerParameter(r.attackParameter),r.releaseParameter=new d.b("Release",r.compressorNode.release,{constantAutomationRate:!0}),r.registerParameter(r.releaseParameter),r.releaseParameter.set(.15),r.kneeParameter=new d.c("Knee",r.compressorNode.knee,{min:0,max:40,unit:"db",defaultValue:1,constantAutomationRate:!0}),r.registerParameter(r.kneeParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"dispose",value:function(){Object(s.a)(Object(u.a)(n.prototype),"dispose",this).call(this),this.compressorNode.dispose(),this.compressorNode=void 0}},{key:"connect",value:function(e){this.connectedNode=e,this.compressorNode.connect(e)}},{key:"disconnect",value:function(e){null!=this.connectedNode&&(this.compressorNode.disconnect(e),this.connectedNode=null)}},{key:"getJson",value:function(e){var t=Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return t.name=this.name,t.gain=this.gainParameter.get(),t.threshold=this.thresholdParameter.get(),t.ratio=this.ratioParameter.get(),t.release=this.releaseParameter.get(),t.attack=this.attackParameter.get(),t.knee=this.kneeParameter.get(),t.enabled=this.enabledParameter.get(),t=this.saveParameterToJson(t,"gainParameter",this.gainParameter),(this.thresholdParameter.isConnectedToAnyModulator()||Object.keys(this.thresholdParameter.patternToValue).length>0)&&(t.thresholdParameter=this.thresholdParameter.getJson()),(this.ratioParameter.isConnectedToAnyModulator()||Object.keys(this.ratioParameter.patternToValue).length>0)&&(t.ratioParameter=this.ratioParameter.getJson()),(this.releaseParameter.isConnectedToAnyModulator()||Object.keys(this.releaseParameter.patternToValue).length>0)&&(t.releaseParameter=this.releaseParameter.getJson()),(this.attackParameter.isConnectedToAnyModulator()||Object.keys(this.attackParameter.patternToValue).length>0)&&(t.attackParameter=this.attackParameter.getJson()),this.kneeParameter.isConnectedToAnyModulator()|Object.keys(this.kneeParameter.patternToValue).length>0&&(t.kneeParameter=this.kneeParameter.getJson()),t}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return"gain"in e&&Object(f.a)(this.gainParameter,e.gain,a),"threshold"in e&&Object(f.a)(this.thresholdParameter,e.threshold,a),"ratio"in e&&Object(f.a)(this.ratioParameter,e.ratio,a),"release"in e&&Object(f.a)(this.releaseParameter,e.release,a),"attack"in e&&Object(f.a)(this.attackParameter,e.attack,a),"knee"in e&&Object(f.a)(this.kneeParameter,e.knee,a),e.enabled&&this.enable(!0),Object(r.a)({},a,this.loadParameterFromJson(e,"gainParameter",this.gainParameter,t),this.loadParameterFromJson(e,"thresholdParameter",this.thresholdParameter,t),this.loadParameterFromJson(e,"ratioParameter",this.ratioParameter,t),this.loadParameterFromJson(e,"releaseParameter",this.releaseParameter,t),this.loadParameterFromJson(e,"attackParameter",this.attackParameter,t),this.loadParameterFromJson(e,"kneeParameter",this.kneeParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(l.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(7),f=n.n(l),h=n(119),p=n(116),d=n(112);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(o.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Distortion",function(){return new f.a.Distortion(.4)},e)).effectNode.oversampling="4x",r.distortionParameter=new d.a("Distortion",r.effectNode,function(e,t){return e.distortion=t},{min:0,max:1,unit:"%",defaultValue:.1}),r.registerParameter(r.distortionParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"getJson",value:function(){var e=Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return e.distortion=this.effectNode.distortion,e.enabled=this.enabledParameter.get(),e.wet=this.effectNode.wet.value,e.name=this.name,(this.distortionParameter.isConnectedToAnyModulator()||Object.keys(this.distortionParameter.patternToValue).length>0)&&(e.distortionParameter=this.distortionParameter.getJson()),e}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(h.a)(this.distortionParameter,e.distortion,a),e.enabled&&this.enable(!0),this.setValue(e.value),Object(r.a)({},a,this.loadParameterFromJson(e,"distortionParameter",this.distortionParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(p.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(7),f=n.n(l),h=n(119),p=n(116),d=(n(112),n(14));function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(o.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Pitch Shift",function(){return new f.a.PitchShift(0)},e)).pitchParameter=new d.a("Pitch",r.effectNode,function(e,t){e&&e._delayA&&(e.pitch=t)},{min:-24,max:24,unit:"",defaultValue:12}),r.registerParameter(r.pitchParameter),r.windowSizeParameter=new d.a("Window Size",r.effectNode,function(e,t){e&&(e.windowSize=t)},{min:.01,max:.5,unit:"",defaultValue:.03}),r.registerParameter(r.windowSizeParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"getJson",value:function(){var e=Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return e.pitch=this.pitchParameter.get(!0),e.windowSize=this.windowSizeParameter.get(!0),e.enabled=this.enabledParameter.get(!0),e.wet=this.effectNode.wet.value,e.name=this.name,e=this.saveParameterToJson(e,"pitchParameter",this.pitchParameter),e=this.saveParameterToJson(e,"windowSizeParameter",this.windowSizeParameter)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(h.a)(this.pitchParameter,e.pitch,a),Object(h.a)(this.windowSizeParameter,e.windowSize,a),e.enabled&&this.enable(!0),this.setValue(e.value),Object(r.a)({},a,this.loadParameterFromJson(e,"pitchParameter",this.pitchParameter,t),this.loadParameterFromJson(e,"windowSizeParameter",this.windowSizeParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(p.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(7),f=n.n(l),h=(n(23),n(22)),p=n(119),d=n(116),v=n(112);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var y=function(e){Object(o.a)(n,e);var t=m(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Panner",function(){return new f.a.Panner(0)},e)).panningParameter=new v.c("Panning",r.effectNode._panner.pan,{min:-1,log:!0,max:1,unit:"",defaultValue:0,automationRate:h.a,noInput:!0}),r.registerParameter(r.panningParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"getJson",value:function(){var e=Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return e.panning=this.panningParameter.get(!0),e.enabled=this.enabledParameter.get(!0),e.name=this.name,e=this.saveParameterToJson(e,"panningParameter",this.panningParameter)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(p.a)(this.panningParameter,e.panning,a),e.enabled&&this.enable(!0),Object(r.a)({},a,this.loadParameterFromJson(e,"panningParameter",this.panningParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(d.a.Effect);t.a=y},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(7),f=n.n(l),h=n(116),p=n(14);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var v=function(e){Object(o.a)(n,e);var t=d(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"EQ 3",function(){return new f.a.EQ3},e)).lowParameter=new p.a("Low",r.effectNode.low,function(e,t){return e.value=t},{min:-10,max:10,unit:"db",defaultValue:0}),r.lowFrequencyParameter=new p.a("Low Frequency",r.effectNode.lowFrequency,function(e,t){return e.value=t},{min:0,max:400,unit:"hz",defaultValue:0}),r.midParameter=new p.a("Mid",r.effectNode.mid,function(e,t){return e.value=t},{min:-10,max:10,unit:"db",defaultValue:0}),r.highParameter=new p.a("High",r.effectNode.high,function(e,t){return e.value=t},{min:-10,max:10,unit:"db",defaultValue:0}),r.highFrequencyParameter=new p.a("High Frequency",r.effectNode.highFrequency,function(e,t){return e.value=t},{min:1e3,max:1e4,unit:"hz",defaultValue:2e3}),r.registerParameter(r.lowParameter),r.registerParameter(r.midParameter),r.registerParameter(r.highParameter),r.registerParameter(r.lowFrequencyParameter),r.registerParameter(r.highFrequencyParameter),r}return Object(i.a)(n,[{key:"getJson",value:function(){return Object(r.a)({},Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{low:this.lowParameter.get(),mid:this.midParameter.get(),high:this.highParameter.get(),lowFrequency:this.lowFrequencyParameter.get(),highFrequency:this.highFrequencyParameter.get(),enabled:this.enabledParameter.get(),name:this.name})}},{key:"fromJson",value:function(e,t){Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t),this.lowParameter.set(e.low),this.midParameter.set(e.mid),this.highParameter.set(e.high),this.lowFrequencyParameter.set(e.lowFrequency),this.highFrequencyParameter.set(e.highFrequency),this.enable(e.enabled)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(h.a.Effect);t.a=v},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(7),f=n.n(l),h=n(116),p=(n(14),n(112));function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var v="peaking",m=function(e){Object(o.a)(n,e);var t=d(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"EQ 10",function(){return new f.a.Gain(1)},e)).filter31=new f.a.Filter(31,v),r.filter31.Q.value=.71,r.filter63=new f.a.Filter(63,v),r.filter63.Q.value=.71,r.filter125=new f.a.Filter(125,v),r.filter125.Q.value=.71,r.filter250=new f.a.Filter(250,v),r.filter250.Q.value=.71,r.filter500=new f.a.Filter(500,v),r.filter500.Q.value=.71,r.filter1k=new f.a.Filter(1e3,v),r.filter1k.Q.value=.71,r.filter2k=new f.a.Filter(2e3,v),r.filter2k.Q.value=.71,r.filter4k=new f.a.Filter(4e3,v),r.filter4k.Q.value=.71,r.filter8k=new f.a.Filter(8e3,v),r.filter8k.Q.value=.71,r.filter16k=new f.a.Filter(16e3,v),r.filter16k.Q.value=.71,r.outputNode=new f.a.Gain(1),r.effectNode.chain(r.filter31,r.filter63,r.filter125,r.filter250,r.filter500,r.filter1k,r.filter2k,r.filter4k,r.filter8k,r.filter16k,r.outputNode),r.gain31Parameter=new p.c("Gain 31",r.filter31.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain31Parameter),r.gain63Parameter=new p.c("Gain 63",r.filter63.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain63Parameter),r.gain125Parameter=new p.c("Gain 125",r.filter125.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain125Parameter),r.gain125Parameter=new p.c("Gain 125",r.filter125.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain125Parameter),r.gain250Parameter=new p.c("Gain 250",r.filter250.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain250Parameter),r.gain500Parameter=new p.c("Gain 500",r.filter500.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain500Parameter),r.gain1kParameter=new p.c("Gain 1k",r.filter1k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain1kParameter),r.gain2kParameter=new p.c("Gain 2k",r.filter2k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain2kParameter),r.gain4kParameter=new p.c("Gain 4k",r.filter4k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain4kParameter),r.gain8kParameter=new p.c("Gain 8k",r.filter8k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain8kParameter),r.gain16kParameter=new p.c("Gain 16k",r.filter16k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain16kParameter),r}return Object(i.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(){this.outputNode.disconnect()}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{gain63:this.gain63Parameter.get(),gain125:this.gain125Parameter.get(),gain250:this.gain250Parameter.get(),gain500:this.gain500Parameter.get(),gain1k:this.gain1kParameter.get(),gain2k:this.gain2kParameter.get(),gain4k:this.gain4kParameter.get(),gain8k:this.gain8kParameter.get(),gain16k:this.gain16kParameter.get()});return e=this.saveParameterToJson(e,"gain31Parameter",this.gain31Parameter),e=this.saveParameterToJson(e,"gain63Parameter",this.gain63Parameter),e=this.saveParameterToJson(e,"gain125Parameter",this.gain125Parameter),e=this.saveParameterToJson(e,"gain250Parameter",this.gain250Parameter),e=this.saveParameterToJson(e,"gain500Parameter",this.gain500Parameter),e=this.saveParameterToJson(e,"gain1kParameter",this.gain1kParameter),e=this.saveParameterToJson(e,"gain2kParameter",this.gain2kParameter),e=this.saveParameterToJson(e,"gain4kParameter",this.gain4kParameter),e=this.saveParameterToJson(e,"gain8kParameter",this.gain8kParameter),e=this.saveParameterToJson(e,"gain16kParameter",this.gain16kParameter)}},{key:"fromJson",value:function(e,t){Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t),this.gain63Parameter.set(e.gain63),this.gain125Parameter.set(e.gain125),this.gain250Parameter.set(e.gain250),this.gain500Parameter.set(e.gain500),this.gain1kParameter.set(e.gain1k),this.gain2kParameter.set(e.gain2k),this.gain4kParameter.set(e.gain4k),this.gain8kParameter.set(e.gain8k),this.gain16kParameter.set(e.gain16k),this.loadParameterFromJson(e,"gain31Parameter",this.gain31Parameter,t),this.loadParameterFromJson(e,"gain63Parameter",this.gain63Parameter,t),this.loadParameterFromJson(e,"gain125Parameter",this.gain125Parameter,t),this.loadParameterFromJson(e,"gain250Parameter",this.gain250Parameter,t),this.loadParameterFromJson(e,"gain500Parameter",this.gain500Parameter,t),this.loadParameterFromJson(e,"gain1kParameter",this.gain1kParameter,t),this.loadParameterFromJson(e,"gain2kParameter",this.gain2kParameter,t),this.loadParameterFromJson(e,"gain4kParameter",this.gain4kParameter,t),this.loadParameterFromJson(e,"gain8kParameter",this.gain8kParameter,t),this.loadParameterFromJson(e,"gain16kParameter",this.gain16kParameter,t),this.enable(e.enabled)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(h.a.Effect);t.a=m},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),s=n(10),o=n(6),c=n(8),u=n(2),l=n(116),f=n(7),h=n.n(f),p=n(14);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var v=function(e){Object(o.a)(n,e);var t=d(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Gate",function(){return new h.a.Gain(2)},e)).connectedTrack=void 0,a.follower=new h.a.Follower(.012,.1),a.multiplier=new h.a.Gain(100),a.gate=new h.a.Gate(-30,.001,.2),a.smoothingParameter=new p.a("Smoothing",Object(i.a)(a),function(e,t){return a.gate.smoothing=t},{min:1e-5,max:2,unit:"ms",defaultValue:.012}),a.thresholdParameter=new p.a("Threshold",Object(i.a)(a),function(e,t){return a.gate.threshold=t},{min:-30,max:6,unit:"db",defaultValue:0}),a.registerParameter(a.smoothingParameter),a.registerParameter(a.thresholdParameter),a.effectNode.connect(a.gate),a.updateInitialValues(),a}return Object(a.a)(n,[{key:"connect",value:function(e){this.gate.connect(e)}},{key:"disconnect",value:function(e){this.gate.disconnect(e)}},{key:"smoothing",get:function(){return this.smoothingParameter.get()},set:function(e){return this.smoothingParameter.set(e)}},{key:"threshold",get:function(){return this.thresholdParameter.get()},set:function(e){return this.thresholdParameter.set(e)}},{key:"setSideChainedTrack",value:function(e,t){void 0!==this.connectedTrack&&this.connectedTrack.volumeNode.disconnect(this.multiplier),e.volumeNode.chain(this.multiplier,this.follower),this.follower.connect(this.effectNode.gain),this.connectedTrack=e,this.trackNumber=t}},{key:"getJson",value:function(){var e=Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this);return e.trackNumber=this.trackNumber,e.threshold=this.threshold,e.smoothing=this.smoothing,e=this.saveParameterToJson(e,"smoothingParameter",this.smoothingParameter),e=this.saveParameterToJson(e,"thresholdParameter",this.thresholdParameter)}},{key:"fromJson",value:function(e,t,r){Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,r),e.enabled&&this.enable(!0),this.threshold=e.threshold,this.smoothing=e.smoothing,this.setSideChainedTrack(t[e.trackNumber],e.trackNumber),this.loadParameterFromJson(e,"thresholdParameter",this.thresholdParameter),this.loadParameterFromJson(e,"smoothingParameter",this.smoothingParameter)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),this.sequencerEngine.tracks,t),r}}]),n}(l.a.Effect);t.a=v},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(116),f=n(119),h=n(7),p=n.n(h),d=n(541),v=n(352),m=n(112);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var b=function(e){Object(o.a)(n,e);var t=y(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Tape Delay",function(){return new p.a.Gain(1)},e)).initComponents(),r.rateParameter=new m.c("Rate",r.delayNode.delayTime,{documentation:"The amount of time (in seconds) between echos.",defaultValue:.6,min:0,max:1},.07),r.registerParameter(r.rateParameter),r.feedbackParameter=new m.c("Feedback",r.feedbackNode.gain,{documentation:["The amount of delayed signal that is fed back into the effect","Be careful, past 50%-- depending on the saturation-- it can get unruly."],defaultValue:.1,min:0,max:1}),r.registerParameter(r.feedbackParameter),r.wetParameter=new m.c("Wet",r.crossFade.fade,{documentation:"Controls the amount of (wet) effected signal, vs. dry (un-effected) signal.",defaultValue:.5,min:0,max:1}),r.registerParameter(r.wetParameter),r.updateInitialValues(),r.isSaturated=!0,r}return Object(i.a)(n,[{key:"isSaturated",set:function(e){void 0!==this._isSaturated&&e!==this._isSaturated&&(e?(this.inputNode.disconnect(this.fakeSat),this.fakeSat.disconnect(this.eqNode.effectNode),this.feedbackNode.disconnect(this.fakeSat),this.inputNode.connect(this.saturatorNode.effectNode),this.saturatorNode.connect(this.eqNode.effectNode),this.feedbackNode.connect(this.saturatorNode.effectNode)):(this.inputNode.connect(this.fakeSat),this.fakeSat.connect(this.eqNode.effectNode),this.feedbackNode.connect(this.fakeSat),this.inputNode.disconnect(this.saturatorNode.effectNode),this.saturatorNode.disconnect(this.eqNode.effectNode),this.feedbackNode.disconnect(this.saturatorNode.effectNode))),this._isSaturated=e}},{key:"documentation",get:function(){return"Emulates a tape echo effect, where the signal is fed back into the effect, and saturated."}},{key:"driveParameter",get:function(){return this.saturatorNode&&this.saturatorNode.driveParameter}},{key:"lowEQParameter",get:function(){return this.eqNode&&this.eqNode.equalizerPoints[0].gainParameter}},{key:"midEQParameter",get:function(){return this.eqNode&&this.eqNode.equalizerPoints[4].gainParameter}},{key:"highEQParameter",get:function(){return this.eqNode&&this.eqNode.equalizerPoints[7].gainParameter}},{key:"initComponents",value:function(){this.inputNode=this.effectNode,this.crossFade=new p.a.CrossFade(.5),this.feedbackNode=new p.a.Gain(.35),this.saturatorNode=new d.a(this.sequencerEngine),this.saturatorNode.driveParameter.set(.95),this.registerParameter(this.driveParameter),this.delayNode=new p.a.FeedbackDelay(.1,.1),this.eqNode=new v.a(this.sequencerEngine,!1),this.fakeSat=new p.a.Gain(1),this.eqNode.equalizerPoints[0].frequencyParameter.set(300),this.eqNode.equalizerPoints[4].qParameter.set(.7),this.eqNode.equalizerPoints[7].frequencyParameter.set(4e3),this.registerParameter(this.lowEQParameter),this.registerParameter(this.midEQParameter),this.registerParameter(this.highEQParameter),this.delayNode.wet.value=1,this.inputNode.connect(this.saturatorNode.effectNode),this.saturatorNode.connect(this.eqNode.effectNode),this.eqNode.connect(this.delayNode),this.inputNode.connect(this.crossFade,0,0),this.delayNode.connect(this.crossFade,0,1),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.saturatorNode.effectNode),this.outputNode=new p.a.Gain(1),this.crossFade.connect(this.outputNode)}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"dispose",value:function(){Object(s.a)(Object(u.a)(n.prototype),"dispose",this).call(this),this.delayNode.dispose(),this.eqNode.dispose(),this.saturatorNode.dispose(),this.feedbackNode.dispose(),this.crossFade.dispose(),this.outputNode.dispose(),this.fakeSat.dispose(),this.fakeSat=void 0,this.rateParameter=void 0,this.wetParameter=void 0,this.track=void 0,this.inputNode=void 0,this.feedbackParameter=void 0,this.delayNode=void 0,this.eqNode=void 0,this.saturatorNode=void 0,this.feedbackNode=void 0,this.crossFadeNode=void 0,this.outputNode=void 0,this.parameters=void 0,this.rateParameter=void 0,this.feedbackParameter=void 0,this.wetParameter=void 0,this.sequencerEngine=void 0}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{lowEQ:this.lowEQParameter.get(!0),midEQ:this.midEQParameter.get(!0),drive:this.driveParameter.get(!0),highEQ:this.highEQParameter.get(!0),feedback:this.feedbackParameter.get(!0),wet:this.wetParameter.get(!0),rate:this.rateParameter.get(!0),isSaturated:this._isSaturated});return e=this.saveParameterToJson(e,"driveParameter",this.driveParameter),e=this.saveParameterToJson(e,"lowEQParameter",this.lowEQParameter),e=this.saveParameterToJson(e,"midEQParameter",this.midEQParameter),e=this.saveParameterToJson(e,"highEQParameter",this.highEQParameter),e=this.saveParameterToJson(e,"feedbackParameter",this.feedbackParameter),e=this.saveParameterToJson(e,"rateParameter",this.rateParameter),e=this.saveParameterToJson(e,"wetParameter",this.wetParameter)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(f.a)(this.lowEQParameter,e.lowEQ,a),Object(f.a)(this.midEQParameter,e.midEQ,a),Object(f.a)(this.highEQParameter,e.highEQ,a),Object(f.a)(this.feedbackParameter,e.feedback,a),Object(f.a)(this.wetParameter,e.wet,a),Object(f.a)(this.rateParameter,e.rate,a),e.drive&&Object(f.a)(this.driveParameter,e.drive,a),void 0!==e.isSaturated&&(this.isSaturated=e.isSaturated),Object(r.a)({},a,this.loadParameterFromJson(e,"lowEQParameter",this.lowEQParameter,t),this.loadParameterFromJson(e,"driveParameter",this.driveParameter,t),this.loadParameterFromJson(e,"midEQParameter",this.midEQParameter,t),this.loadParameterFromJson(e,"highEQParameter",this.highEQParameter,t),this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter,t),this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t),this.loadParameterFromJson(e,"wetParameter",this.wetParameter,t))}}]),n}(l.a.Effect);t.a=b},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(t,n){Object(r.a)(this,e),this.minValue=t,this.maxValue=t,this.min=t,this.max=n}return Object(a.a)(e,[{key:"min",get:function(){return this.minValue},set:function(e){this.minValue="-"===e?-0:parseFloat(e)}},{key:"max",get:function(){return this.maxValue},set:function(e){this.maxValue="-"===e?-0:parseFloat(e)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(866),s=(n(7),function(){function e(t,n,a,i){Object(r.a)(this,e),this.initialBulkValues={},this.sequencerEngine=t,this.store=t.store,this.context=a,this.number=i,this.idToParameter={},this.parameterToScaler={},this.parameterIdToVoiceToNode={},this.parameters=[]}return Object(a.a)(e,[{key:"getType",value:function(){}},{key:"connect",value:function(e,t,n){if(void 0!==e){this.idToParameter[t.id]=t;var r=this.getChain(t,e);this.getModulator().connect(r[0]);for(var a=0;a<r.length-1;a++)r[a].connect(r[a+1]);return void 0===this.parameterIdToVoiceToNode[t.id]&&(this.parameterIdToVoiceToNode[t.id]={}),this.parameterIdToVoiceToNode[t.id][n]=r,r}var s=new i.a(t.min,t.max);this.parameterToScaler[t.id]=s}},{key:"replaceParameterIds",value:function(e,t,n){if(e!==t){var r=this.parameterIdToVoiceToNode[e];this.parameterIdToVoiceToNode[t]=r;var a=this.parameterToScaler[e];a&&(this.parameterToScaler[t]=a),this.idToParameter[t]=n,delete this.parameterIdToVoiceToNode[e],delete this.parameterToScaler[e],delete this.idToParameter[e]}}},{key:"disconnect",value:function(e,t,n){if(this.parameterIdToVoiceToNode&&void 0!==this.parameterIdToVoiceToNode[t.id]){delete this.idToParameter[t.id];var r=this.parameterIdToVoiceToNode[t.id][n];delete this.parameterIdToVoiceToNode[t.id][n],0===Object.keys(this.parameterIdToVoiceToNode[t.id]).length&&delete this.parameterIdToVoiceToNode[t.id],void 0!==this.parameterToScaler[t.id]&&delete this.parameterToScaler[t.id];var a=this.getModulator();if(void 0!==r&&a){var i=this.getScaleFromChain(r);i.min=0,i.max=0,a.output._add.input&&a.disconnect(r[0]);for(var s=0;s<r.length-1;s++)r[s].disconnect(r[s+1]);this.releaseChain(r)}}}},{key:"disposeParameters",value:function(){this.parameters.forEach(function(e){return e.dispose(!1)})}},{key:"disconnectAllModulators",value:function(){this.parameters.forEach(function(e){return e.disconnectFromAllModulators()})}},{key:"getScaleForParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.parameterToScaler[e.id])return this.parameterToScaler[e.id];if(this.parameterIdToVoiceToNode){var n=this.parameterIdToVoiceToNode[e.id];if(void 0!==n){var r=n[t];return this.getScaleFromChain(r)}}}},{key:"getDepthForParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.parameterIdToVoiceToNode[e.id];if(void 0!==n){var r=n[t];return this.getDepthFromChain(r)}}}]),e}());t.a=s},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(31),o=n(10),c=n(6),u=n(8),l=n(2),f=n(116),h=n(7),p=n.n(h),d=n(14),v=(n(112),n(344),n(269));function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var y=function(e){Object(c.a)(n,e);var t=m(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Stereo Delay",function(){return new p.a.Gain(1)},e)).initComponents(),r.isSynced=!0,r.wetParameter=new d.a("Wet",Object(s.a)(r),function(e,t){r.leftDelay.wetParameter.set(t),r.rightDelay.wetParameter.set(t)},{min:0,max:1,unit:"",defaultValue:0,constantAutomationRate:!0}),r.registerParameter(r.wetParameter),r.feedbackParameter=new d.a("Feedback",Object(s.a)(r),function(e,t){r.leftDelay.feedbackParameter.set(t),r.rightDelay.feedbackParameter.set(t)},{min:0,max:1,unit:"",defaultValue:0,constantAutomationRate:!0}),r.registerParameter(r.feedbackParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"initComponents",value:function(){this.leftDelay=new v.a(this.sequencerEngine),this.rightDelay=new v.a(this.sequencerEngine),this.effectNode.connect(this.leftDelay.effectNode),this.effectNode.connect(this.rightDelay.effectNode),this.merger=new p.a.Merge,this.leftDelay.connect(this.merger.left),this.rightDelay.connect(this.merger.right),this.outputNode=new p.a.Gain(1),this.merger.connect(this.outputNode)}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{leftDelay:this.leftDelay.getJson(),rightDelay:this.rightDelay.getJson(),wet:this.wetParameter.get(),feedback:this.feedbackParameter.get(),isSynced:this.isSynced});return e=this.saveParameterToJson(e,"wetParameter",this.wetParameter),e=this.saveParameterToJson(e,"feedbackParameter",this.feedbackParameter)}},{key:"fromJson",value:function(e,t){Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t),this.isSynced=e.isSynced,this.wetParameter.set(e.wet),this.feedbackParameter.set(e.feedback),this.leftDelay.fromJson(e.leftDelay),this.rightDelay.fromJson(e.rightDelay),this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter,t),this.loadParameterFromJson(e,"wetParameter",this.wetParameter,t)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(f.a.Effect);t.a=y},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(1),o=n(4),c=n(5),u=n(10),l=n(6),f=n(8),h=n(2),p=n(345),d=n(7),v=n.n(d),m=n(116);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var b="QmQjRkKxSgAYtuepTdHp8inhYp8QYc18KUL5fYSprqKAEt",g=function(e){Object(l.a)(n,e);var t=y(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this,"Guitar Amp",function(){return new v.a.Gain(1)},e)).convolver=r||new p.a(e),r||a.convolver.setConvolverSample(b),a.convolver.wetParameter.set(1),a.effectNode.connect(a.convolver.effectNode),a.updateInitialValues(),a}return Object(c.a)(n,[{key:"dispose",value:function(){Object(u.a)(Object(h.a)(n.prototype),"dispose",this).call(this),this.convolver.dispose()}},{key:"disconnect",value:function(e){this.convolver.disconnect(e)}},{key:"connect",value:function(e){this.convolver.connect(e)}},{key:"getJson",value:function(){return Object(s.a)({},Object(u.a)(Object(h.a)(n.prototype),"getJson",this).call(this),{convolver:this.convolver.getJson()})}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,t,r),e.next=3,this.convolver.fromJson(t.convolver,r);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];console.log("get effect copy guitar amp");var r=new n(e,this.convolver.getEffectCopy(e,t));return t||(r.id=this.id),r}}]),n}(m.a.Effect);t.a=g},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(31),o=n(10),c=n(6),u=n(8),l=n(2),f=n(116),h=n(119),p=n(7),d=n.n(p),v=n(14),m=n(112);n(344);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}new Float32Array(65536);var b=function(e){Object(c.a)(n,e);var t=y(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Wave Folder",function(){return new d.a.Gain(1)},e)).crossFade=new d.a.CrossFade(0),r.wetParameter=new m.c("Wet",r.crossFade.fade,{documentation:"Controls the amount of (wet) effected signal, vs. dry (un-effected) signal.",defaultValue:.5,min:0,max:1}),r.registerParameter(r.wetParameter),r.counter=0,r.waveShaperNode=new d.a.WaveShaper([-1,1]),r.effectNode.connect(r.waveShaperNode),r.postGain=new d.a.Gain(1),r.waveShaperNode.connect(r.postGain),r.effectNode.connect(r.crossFade,0,0),r.postGain.connect(r.crossFade,0,1),r.overSampleParameter=new v.a("oversample",Object(s.a)(r),function(e,t){return r.waveShaperNode.oversample=t?"4x":"none"},{min:.01,max:32,unit:"",defaultValue:!1,constantAutomationRate:!0}),r.driveParameter=new m.a("drive",r.effectNode.gain,function(e,t){r.effectNode.gain.value=t,r.postGain.gain.value=Math.pow(1/t,.6)},{documention:"Controls the level of saturation.",min:.01,max:32,unit:"",defaultValue:1,constantAutomationRate:!0}),r.registerParameter(r.driveParameter),r.stagesParameter=new v.a("stages",Object(s.a)(r),function(e,t){r.recomputeCurve()},{documention:"Controls the level of saturation.",min:2,max:10,unit:"",defaultValue:4,constantAutomationRate:!0,automatable:!1}),r.registerParameter(r.stagesParameter),r.smoothnessParameter=new v.a("smoothness",Object(s.a)(r),function(e,t){r.recomputeCurve()},{documention:"Controls the level of saturation.",min:1,max:32,unit:"",defaultValue:6,constantAutomationRate:!0,automatable:!1}),r.registerParameter(r.smoothnessParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"stages",get:function(){return this.stagesParameter?this.stagesParameter.get():4}},{key:"smoothness",get:function(){return this.smoothnessParameter?this.smoothnessParameter.get():6}},{key:"recomputeCurve",value:function(){var e=this,t=++this.counter;setTimeout(function(){if(t===e.counter){for(var n=Math.pow(2,e.smoothness+1)*(2*e.stages+1)+1,r=new Float32Array(n),a=0;a<n;a++){var i=(2*e.stages+1)*Math.PI*(a/(n-1)-.5);r[a]=Math.sin(i)}e.waveShaperNode.curve=r}},100)}},{key:"documentation",get:function(){return"Saturates the sound, making it more distorted."}},{key:"dispose",value:function(){Object(o.a)(Object(l.a)(n.prototype),"dispose",this).call(this),this.postGain.dispose(),this.waveShaperNode.dispose()}},{key:"connect",value:function(e){this.crossFade.connect(e)}},{key:"disconnect",value:function(e){this.crossFade.disconnect(e)}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{oversample:this.overSampleParameter.get(),smoothness:this.smoothnessParameter.get(),stages:this.stagesParameter.get(),drive:this.driveParameter.get()});return e=this.saveParameterToJson(e,"oversampleParameter",this.overSampleParameter),e=this.saveParameterToJson(e,"driveParameter",this.driveParameter),e=this.saveParameterToJson(e,"smoothnessParameter",this.smoothnessParameter),e=this.saveParameterToJson(e,"stagesParameter",this.stagesParameter)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(h.a)(this.driveParameter,e.drive,a),Object(h.a)(this.overSampleParameter,e.overSample,a),Object(h.a)(this.smoothnessParameter,e.smoothness,a),Object(h.a)(this.stagesParameter,e.stages,a),Object(r.a)({},a,this.loadParameterFromJson(e,"driveParameter",this.driveParameter,t),this.loadParameterFromJson(e,"overSampleParameter",this.overSampleParameter,t),this.loadParameterFromJson(e,"smoothnessParameter",this.smoothnessParameter,t),this.loadParameterFromJson(e,"stagesParameter",this.stagesParameter,t))}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(f.a.Effect);t.a=b},function(e,t,n){"use strict";n.d(t,"a",function(){return j});var r=n(1),a=n(11),i=n(4),s=n(5),o=n(10),c=n(6),u=n(8),l=n(2),f=n(116),h=n(190),p=n(119),d=n(7),v=n.n(d),m=(n(112),n(543));function y(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var O=10,k=[90,250,400,1250,1950,2350,2750,5500,6900,8600],j=function(e){Object(c.a)(n,e);var t=g(n);function n(e){var r;Object(i.a)(this,n),(r=t.call(this,"Vocoder",function(){return new v.a.Gain(4)},e)).components=[],r.outGain=new v.a.Gain(16);for(var s=0;s<O;s++){var o=k[s],c=new v.a.Filter(o,"bandpass"),u=new v.a.Filter(o,"bandpass"),l=new v.a.Gain(1);c.Q.value=50,u.Q.value=50;var f=new v.a.Follower(.01);c.chain(f,l.gain),r.effectNode.chain(l,u,r.outGain),r.components.push({filterIn:c,filterOut:u,follower:f})}return r.setupTrackParameter(),r.qParameter=new h.a("q",[].concat(Object(a.a)(r.components.map(function(e){return e.filterIn.Q})),Object(a.a)(r.components.map(function(e){return e.filterOut.Q}))),{defaultValue:50,min:.1,max:100}),r.registerParameter(r.qParameter),r.roughnessParameter=new h.a("roughness",r.components.map(function(e){return e.follower._filter.frequency}),{defaultValue:20,min:.1,max:100}),r.registerParameter(r.roughnessParameter),r.frequencyParameter=new h.a("frequency",[].concat(Object(a.a)(r.components.map(function(e){return e.filterIn.frequency})),Object(a.a)(r.components.map(function(e){return e.filterOut.frequency}))),{defaultValue:0,min:0,max:4e3}),r.registerParameter(r.frequencyParameter),r.components.forEach(function(e,t){var n=e.filterIn,r=e.filterOut;n.frequency.value=k[t],r.frequency.value=k[t]}),r.updateInitialValues(),r}return Object(s.a)(n,[{key:"dispose",value:function(){Object(o.a)(Object(l.a)(n.prototype),"dispose",this).call(this),this.components.forEach(function(e){var t=e.filterIn,n=e.filterOut,r=e.follower;t.dispose(),n.dispose(),r.dispose()}),this.outGain.dispose()}},{key:"connect",value:function(e){this.outGain.connect(e)}},{key:"disconnect",value:function(e){this.outGain.disconnect()}},{key:"onChangeTrack",value:function(e){-1!==e?(e=this.sequencerEngine.tracks[e],this._track&&this.disconnectFromTrack(this._track),this.connectToTrack(e),Object(o.a)(Object(l.a)(n.prototype),"onChangeTrack",this).call(this,e)):this._track=void 0}},{key:"disconnectFromTrack",value:function(e){var t,n=y(this.components);try{for(n.s();!(t=n.n()).done;){var r=t.value.filterIn;e.trackNode.disconnect(r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"connectToTrack",value:function(e){var t,n=y(this.components);try{for(n.s();!(t=n.n()).done;){var r=t.value.filterIn;e.trackNode.connect(r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"getJson",value:function(e){var t=Object(r.a)({},Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this,e),{q:this.qParameter.get(!0),roughness:this.roughnessParameter.get(!0),frequency:this.frequencyParameter.get(!0),track:this.trackParameter.get(!0)});return t=this.saveParameterToJson(t,"frequencyParameter",this.frequencyParameter),t=this.saveParameterToJson(t,"qParameter",this.qParameter),t=this.saveParameterToJson(t,"roughnessParameter",this.roughnessParameter)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(p.a)(this.qParameter,e.q,a),Object(p.a)(this.roughnessParameter,e.roughness,a),Object(p.a)(this.frequencyParameter,e.frequency,a),Object(p.a)(this.trackParameter,e.track,a),Object(r.a)({},a,this.loadParameterFromJson(e,"frequencyParameter",this.frequencyParameter),this.loadParameterFromJson(e,"qParameter",this.qParameter),this.loadParameterFromJson(e,"roughnessParameter",this.roughnessParameter))}},{key:"getEffectCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new n(e).fromJson(this.getJson(),t),!0}}]),n}(Object(m.a)(f.a.Effect))},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(116),f=n(119),h=n(7),p=n.n(h),d=n(112),v=n(543);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var y=function(e){Object(o.a)(n,e);var t=m(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Follower",function(){return new p.a.Gain(1)},e)).follower=new p.a.Follower,r.follower.connect(r.effectNode.gain),r.roughnessParameter=new d.c("roughness",r.follower._filter.frequency,{defaultValue:10,min:.1,max:100}),r.setupTrackParameter(),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"onChangeTrack",value:function(e){-1!==e?(e=this.sequencerEngine.tracks[e],this._track&&this._track.volumeNode.disconect(this.follower),e.volumeNode.connect(this.follower),Object(s.a)(Object(u.a)(n.prototype),"onChangeTrack",this).call(this,e)):this._track=void 0}},{key:"getJson",value:function(e){var t=Object(r.a)({},Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this,e),{roughness:this.roughnessParameter.get(!0),track:this.trackParameter.get(!0)});return t=this.saveParameterToJson(t,"roughnessParameter",this.roughnessParameter)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(f.a)(this.roughnessParameter,e.roughness,a),Object(f.a)(this.trackParameter,e.track,a),Object(r.a)({},a,this.loadParameterFromJson(e,"roughnessParameter",this.roughnessParameter))}},{key:"getEffectCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new n(e).fromJson(this.getJson(),t),!0}}]),n}(Object(v.a)(l.a.Effect))},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(31),o=n(10),c=n(6),u=n(8),l=n(2),f=n(116),h=n(853),p=n(119),d=n(7),v=n.n(d),m=n(112),y=n(14),b=n(190);function g(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var j=function(e){Object(c.a)(n,e);var t=k(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Frequency Shifter",function(){return new v.a.Gain(.5)},e)).nodeCounter=0,r._numBanks=4,r.outputNode=new v.a.Merge(1),r.wetIn=new v.a.Gain(.5),r.delaySpread=new v.a.Signal(0),r.effectNode.connect(r.wetIn),r.vInGains=[],r.delays=[[],[]],r.createGraph(),r.delaySpreadParameter=new m.c("delaySpread",r.delaySpread,{defaultValue:0,min:0,max:1,automationRate:"A_RATE"},.07),r.registerParameter(r.delaySpreadParameter),r.frequencyParameter=new b.a("frequency",[r.sineA.frequency,r.sineB.frequency],{defaultValue:30,min:1,max:1e4}),r.registerParameter(r.frequencyParameter),r.delayDirectionParameter=new y.a("delayDirection",Object(s.a)(r),function(e,t){return e.setDelayDirection(t)},{defaultValue:!0}),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"incr",value:function(){this.nodeCounter++}},{key:"createGraph",value:function(){this.sineA=new v.a.Oscillator(0,"sine"),this.incr(),this.sineA.phase=0,this.sineB=new v.a.Oscillator(0,"sine"),this.sineB.phase=90,this.incr(),this.sineA.start(0),this.sineB.start(0),this.createHilbertTransformer()}},{key:"ring",value:function(e,t,n){var r=new v.a.Compressor(-12,3);this.incr();var a=new v.a.Gain(.5);this.incr(),this.vInGains.push(a);var i=new v.a.Gain(-1);this.incr();var s=new v.a.Gain(-1);this.incr();var o=new v.a.Gain(-1);this.incr();var c=new v.a.Gain(-1);this.incr();var u=new h.a(this.sequencerEngine).effectNode;this.incr();var l=new h.a(this.sequencerEngine).effectNode;this.incr();var f=new h.a(this.sequencerEngine).effectNode;this.incr();var p=new h.a(this.sequencerEngine).effectNode;return this.incr(),e.connect(a),a.connect(i),i.connect(s),i.connect(l),s.connect(u),u.connect(o),l.connect(o),o.connect(r),a.connect(p),a.connect(c),c.connect(f),f.connect(r),p.connect(r),t.connect(c),t.connect(p),{output:r,dispose:function(){a.dispose(),r.dispose(),u.dispose(),l.dispose(),f.dispose(),p.dispose(),i.dispose(),s.dispose(),o.dispose(),c.dispose()}}}},{key:"createHilbertTransformer",value:function(){var e=this,t=new v.a.Split;this.incr(),this.wetIn.connect(t);var n=this.ring(this.sineA,t.left),r=this.ring(this.sineB,t.left),a=this.ring(this.sineA,t.right,!0),i=this.ring(this.sineB,t.right,!0),s=[n.dispose,r.dispose,a.dispose,i.dispose,function(){return t.dispose()}];n=n.output,r=r.output,a=a.output,i=i.output;for(var o=0;o<2;o++)for(var c=50,u=function(t){var u=e.numBanks/8*((t+1)/4),l=e.delayDirection?e.numBanks-t:t,f=l/1e3,h=new v.a.Filter(c,"bandpass",-24);e.incr(),h.Q.value=u;var p=new v.a.Filter(c,"allpass");e.incr(),p.Q.value=u,c+=1e4/e.numBanks;var d=new v.a.Delay(f);e.incr(),d.delayTime.input.automationRate="A_RATE";var m=new v.a.Gain(l/e.numBanks);e.incr(),e.delaySpread.chain(m,d.delayTime),d.delayTime.value=f,0===o?(h.chain(p,d,e.outputNode.left),n.connect(h),r.connect(h)):(h.chain(p,d,e.outputNode.right),a.connect(h),i.connect(h)),e.delays[o].push({delay:d,delayBlunter:m}),s.push(function(){h.dispose(),p.dispose(),d.dispose(),m.dispose()})},l=0;l<this.numBanks;l++)u(l);this.disposeList=s}},{key:"numBanks",get:function(){return this._numBanks},set:function(e){this._numBanks=e,this.disposeList&&(this.disposeList.forEach(function(e){e()}),this.disposeList=void 0),this.vInGains=[],this.delays=[[],[]],this.wetIn.disconnect(),this.nodeCounter=0,this.createHilbertTransformer()}},{key:"dispose",value:function(){Object(o.a)(Object(l.a)(n.prototype),"dispose",this).call(this),this.disposeList.forEach(function(e){return e()}),this.sineA.dispose(),this.sineB.dispose()}},{key:"randomizeDelays",value:function(){for(var e in this.delays){var t,n=g(this.delays[e]);try{for(n.s();!(t=n.n()).done;){t.value.delay.delayTime.value=Math.random()/2}}catch(r){n.e(r)}finally{n.f()}}}},{key:"clearRandom",value:function(){this.delayDirectionParameter.refresh()}},{key:"delayDirection",get:function(){return!this.delayDirectionParameter||this.delayDirectionParameter.get()}},{key:"setDelayDirection",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(var t in this.delays)for(var n in this.delays[t]){var r=e?this.numBanks-n:n,a=this.delays[t][n],i=a.delay,s=a.delayBlunter;i.delayTime.value=r/1e3,s.gain.value=r/this.numBanks}}},{key:"connect",value:function(e){this.connectedNode=e,this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{frequency:this.frequencyParameter.get(!0),delaySpread:this.delaySpreadParameter.get(!0),delayDirection:this.delayDirectionParameter.get(!0),numBanks:this.numBanks});return e=this.saveParameterToJson(e,"delaySpreadParameter",this.delaySpreadParameter),e=this.saveParameterToJson(e,"delayDirectionParameter",this.delayDirectionParameter),e=this.saveParameterToJson(e,"frequencyParameter",this.frequencyParameter)}},{key:"fromJson",value:function(e,t){var a=Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(p.a)(this.frequencyParameter,e.frequency,a),Object(p.a)(this.delaySpreadParameter,e.delaySpread,a),Object(p.a)(this.delayDirectionParameter,e.delayDirection,a),e.numBanks&&e.numBanks!==this.numBanks&&(this.numBanks=e.numBanks),a=Object(r.a)({},a,this.loadParameterFromJson(e,"frequencyParameter",this.frequencyParameter,t),this.loadParameterFromJson(e,"delaySpreadParameter",this.delaySpreadParameter,t),this.loadParameterFromJson(e,"delayDirectionParameter",this.delayDirectionParameter,t))}}]),n}(f.a.Effect);t.a=j},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(116),f=n(119),h=n(7),p=n.n(h),d=n(112);n(543);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(o.a)(n,e);var t=v(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,"Transient Shaper",function(){return new p.a.Gain(1)},e)).effectNode.gain.value=1,r.follower1=new p.a.Follower,r.follower2=new p.a.Follower,r.filter=new p.a.Filter(100,"highpass"),r.effectNode.connect(r.filter),r.filter.connect(r.follower1),r.filter.connect(r.follower2),r.roughness1Parameter=new d.c("roughness1",r.follower1._filter.frequency,{defaultValue:63.8,min:.01,max:100,noInput:!0}),r.roughness2Parameter=new d.c("roughness2",r.follower2._filter.frequency,{defaultValue:2.4,min:.01,max:100,noInput:!0}),r.registerParameter(r.roughness1Parameter),r.registerParameter(r.roughness2Parameter),r.controlVoltage=new p.a.Subtract,r.follower1.connect(r.controlVoltage,0,0),r.follower2.connect(r.controlVoltage,0,1),r.input=r.effectNode,r.outputNode=new p.a.Gain(1),r.sustainNode=new p.a.Gain(1),r.effectNode.connect(r.sustainNode),r.sustainNode.connect(r.outputNode),r.controlVoltage.connect(r.sustainNode.gain),r.attackParameter=new d.c("attack",r.controlVoltage.output.gain,{defaultValue:1,min:-4,max:4,automationRate:"A_RATE"}),r.registerParameter(r.attackParameter),r.outputGainParameter=new d.c("outputGain",r.outputNode.gain,{defaultValue:1,min:0,max:2,automationRate:"A_RATE"}),r.registerParameter(r.outputGainParameter),r.sustainParameter=new d.c("sustain",r.sustainNode.gain,{defaultValue:0,min:0,max:.5,automationRate:"A_RATE"}),r.registerParameter(r.sustainParameter),r.updateInitialValues(),r}return Object(i.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e),this.connectedNode=e}},{key:"disconnect",value:function(e){this.outputNode.disconnect(),this.connectedNode=null}},{key:"getJson",value:function(e){var t=Object(r.a)({},Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this,e),{attack:this.attackParameter.get(!0),outputGain:this.outputGainParameter.get(!0),sustain:this.sustainParameter.get(!0)});return t=this.saveParameterToJson(t,"attackParameter",this.attackParameter),t=this.saveParameterToJson(t,"outputGainParameter",this.outputGainParameter),t=this.saveParameterToJson(t,"sustainParameter",this.sustainParameter)}},{key:"fromJson",value:function(e,t){var a=this,i=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return p.a.Master.context.isOffline?(Object(f.a)(this.attackParameter,e.attack,i),Object(f.a)(this.sustainParameter,e.sustain,i),Object(f.a)(this.outputGainParameter,e.outputGain,i)):setTimeout(function(){Object(f.a)(a.attackParameter,e.attack,i),Object(f.a)(a.sustainParameter,e.sustain,i),Object(f.a)(a.outputGainParameter,e.outputGain,i)},1e3),Object(r.a)({},i,this.loadParameterFromJson(e,"attackParameter",this.attackParameter,t),this.loadParameterFromJson(e,"sustainParameter",this.sustainParameter,t),this.loadParameterFromJson(e,"outputGainParameter",this.outputGainParameter,t))}},{key:"getEffectCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(l.a.Effect)},function(e,t,n){"use strict";var r=n(1),a=n(11),i=n(4),s=n(5),o=n(10),c=n(6),u=n(8),l=n(2),f=n(401),h=n(23),p=(n(43),n(123),n(180));function d(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var y=function(e){Object(c.a)(n,e);var t=m(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,"Palettes",p.d,e)).palettes=[0,1],r}return Object(s.a)(n,[{key:"newPalette",value:function(){this.palettes=[].concat(Object(a.a)(this.palettes),[this.palettes.length])}},{key:"selectedPalette",get:function(){return this.track.sequencerEngine.state.effects.selectedPalettes[this.track.id]}},{key:"sequencedPalette",get:function(){return this.track.sequencerEngine.state.effects.sequencedPalettes[this.track.id]}},{key:"switchToPalette",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencedPalette,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={};e=null===e?void 0:e,r&&this.track.store.dispatch(Object(h.qd)(this.track.id,e)),this.track.store.dispatch(Object(h.Cd)(this.track.id,e));var i,s=d(this.track.getAllParameters().filter(function(n){return void 0===e&&void 0!==n.paletteToValue[t]||void 0===t&&void 0!==n.paletteToValue[e]||n.paletteToValue[e]!==n.paletteToValue[t]}));try{for(s.s();!(i=s.n()).done;){var o=i.value,c=o.set(o.getPaletteValue(e),!0,!0,n);c&&(a[c.id]=c.value)}}catch(u){s.e(u)}finally{s.f()}this.track.store.dispatch(Object(h.ub)(a))}},{key:"getJson",value:function(){return Object(r.a)({},Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this),{palettes:this.palettes})}},{key:"fromJson",value:function(e){Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e),this.palettes=e.palettes}},{key:"getCopy",value:function(){var e=new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.track);return e.fromJson(this.getJson()),e}}]),n}(f.a);t.a=y},function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(136),s=n(55);function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=new(n(130).a);t.a=Object(s.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.track;if(void 0===t.frozenTracks)return[];var n,r=[],s=o(t.frozenTracks);try{for(s.s();!(n=s.n()).done;){var c=n.value.trackData;if(c){var l=c.type,f=c.samplers,h="white";l===i.f?h=Object.keys(f)[0]:l===i.b&&(h=c.presetName||"instrument");var p=u.getColorForHash(h);r.push(a.a.createElement("div",{style:{backgroundColor:p},className:"multi-freeze-part"}))}}}catch(d){s.e(d)}finally{s.f()}return a.a.createElement("div",{className:"multi-freeze-thumbnails"},r)})},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(136),a=n(165),i=n(3),s=n.n(i),o=n(160),c=n(876),u=new Set(["clap","tom","toms","clave","perc","snare","kick","hi-hat","rim","side-stick","breaks","sub","ride"]),l=function(e,t){if(!e||e.subSequence===e)return"";if(!e.getObjectType||e.getObjectType()!==a.c)return"";var n="";e&&e.tracks&&e.tracks[0]&&e.tracks[0].track&&(e=e.tracks[0].track);var i=t||e.sample;if(i&&i.tags&&((n=i.tags.find(function(e){return u.has(e)}))||(n=i.tags[0])),e&&e.getInstrumentType()==o.f&&(n="Synth"),e&&e.getTrackType()===r.e&&(n=s.a.createElement(c.a,{track:e})),e&&e.getInstrumentType()===o.g){var l=e.instrument.getSamples();l[0]&&l[0].tags&&(n=l[0].tags.find(function(e){return u.has(e)}))}return n}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r="SEQUENCER"},function(e,t,n){"use strict";n.d(t,"a",function(){return u}),n.d(t,"b",function(){return l});var r=n(107),a=n(11),i=n(880),s=n(881);function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}window.rasterTimes=[];var u=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,i=[],c=-1,u=o(l(e,n,r));try{for(u.s();!(t=u.n()).done;){var f=t.value;f.x=Math.round(f.x),f.y=Math.round(f.y);var h=((0).noise2D(f.x,f.y)+1)/2;f.dist=h,Math.random()<1&&(h=Math.min(f.distX,f.distY)/n,f.dist=h),h>c&&(c=h),i.push(f)}}catch(b){u.e(b)}finally{u.f()}for(var p=Object(s.c)(i,n),d=[],v=[],m=2;m<Math.max(8,c);m+=1){var y=Object(s.a)(p,m);d=[].concat(Object(a.a)(d),Object(a.a)(y)),v=[].concat(Object(a.a)(v),Object(a.a)(Object(s.b)(y)))}return{triangles:p,points:i,segments:d,contours:d}},l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,s=((new Date).getTime(),e=Object(i.a)(e)),o=Object(r.a)(s,6),c=o[0],u=o[1],l=o[2],d=o[3],y=o[4],b=o[5];if(d===b)return h(e,t,n);if(u===d)return p(e,t,n);var g=Math.round(c+(d-u)/(b-u)*(y-c)),O=Math.round(d),k=[l,d,g,O,y,b];k=Object(i.a)(k);var j=p(k,t,!0,u),w=j[j.length-1],x=f(c,u,l,d,g,O,w),S=Object(r.a)(x,2),P=[c,u,l=S[0],d=w,g=S[1],O=w];P=Object(i.a)(P);var E=v(j,w);return[].concat(Object(a.a)(m(j,w)),Object(a.a)(h(P,t,E,b)))},f=function(e,t,n,r,a,i,s){return[e-(t-s)/((t-r)/(e-n)),e-(t-s)/((t-i)/(e-a))]},h=function(e,t,n,i){var s=Object(r.a)(e,6),o=s[0],c=s[1],u=s[2],l=s[3],f=s[4],h=(u-o)/(l-c),p=(f-o)/(s[5]-c),v=u,m=f,b=0,g=[];n=y(n||v,t),i=y(i||l);for(var O=l;O>c;O--){Math.abs(c-O),Math.abs(O-l);if(b%t===0){var k=d(v,O,m,O,t,n,i);g=[].concat(Object(a.a)(g),Object(a.a)(k))}if(v-=h,m-=p,++b>1e4)break}return g},p=function(e,t){for(var n=Object(r.a)(e,6),i=n[0],s=n[1],o=n[2],c=n[3],u=n[4],l=n[5],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3?arguments[3]:void 0,p=(u-i)/(l-s),v=(u-o)/(l-c),m=u,b=u,g=[],O=0,k=y(m,t),j=y(l,t),w=y(l,t),x=!0;x;w--){Math.abs(h-w),Math.abs(l-w);if(O%t===0){if(w<=s){if(!f)break;x=!1}var S=d(m,w,b,w,t,k,j);g=[].concat(Object(a.a)(g),Object(a.a)(S))}if(m-=p,b-=v,++O>1e4)break}return g},d=function(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,i=arguments.length>5?arguments[5]:void 0,s=(arguments.length>6&&arguments[6],e);i>e;)i-=a;e=Math.round(i),t=Math.round(t),n=Math.round(n),r=Math.round(r);for(var o=Math.abs(n-e),c=Math.abs(r-t),u=e<n?1:-1,l=t<r?1:-1,f=o-c,h=[],p=0;e!=n||t!=r;){if(p%a===0&&e>s){Math.abs(e-i),Math.abs(n-e);h.push(e),h.push(t)}var d=2*f;if(d>-c&&(f-=c,e+=u),d<o&&(f+=o,t+=l),++p>1e4)break}return h},v=function(e,t){for(var n=1e4,r=0;r<e.length;r+=2)e[r+1]===t&&e[r]<n&&(n=e[r]);return n},m=function(e,t){for(var n=[],r=0;r<e.length;r+=2)e[r+1]!==t&&(n.push(e[r]),n.push(e[r+1]));return n},y=function(e,t){return e-e%t}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){var t=[0,1,2],n=function(t){return e[2*t]},r=function(t){return e[2*t+1]};t.sort(function(e,t){return r(e)===r(t)?n(e)-n(t):r(e)-r(t)});var a=[];return t.forEach(function(e){a.push(n(e)),a.push(r(e))}),a}},function(e,t,n){"use strict";n.d(t,"c",function(){return o}),n.d(t,"a",function(){return l}),n.d(t,"b",function(){return f});var r=n(107),a=n(11);function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=function(e,t){if(0===e.length)return[];var n={},r=(Math.max.apply(Math,Object(a.a)(e.map(function(e){return e.y}))),Math.min.apply(Math,Object(a.a)(e.map(function(e){return e.y}))));e.forEach(function(e){e.x;var t=e.y;n[t]||(n[t]=[]),n[t].push(e)});for(var i=[],s=n[r],o=r;;){var l=s,f=c(n,o),h=n[f];if(o=f,s=h,!l||!h)break;i=[].concat(Object(a.a)(i),Object(a.a)(u(l,h)))}return i},c=function(e,t){var n,r=i(Object.keys(e).map(function(e){return parseInt(e)}));try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a>t)return a}}catch(s){r.e(s)}finally{r.f()}},u=function(e,t){for(var n=[],r=function(r){var a=e[r],i=e[r+1],s=t.find(function(e){return e.x===a.x}),o=t.find(function(e){return e.x===i.x});s&&i&&n.push([a,s,i]),o&&i&&s&&n.push([s,o,i])},a=0;a<e.length-1;a++)r(a);return n},l=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=[],a=i(e);try{for(a.s();!(t=a.n()).done;){var s=t.value,o=s.filter(function(e){return e.dist>=n}),c=s.filter(function(e){return e.dist<n});if(0!==c.length&&0!==o.length){for(var u=o.length<c.length?o:c,l=o.length>c.length?o:c,f=[],h=[[u[0],l[0]],[u[0],l[1]]],p=0,d=h;p<d.length;p++){var v=d[p],m=[v[0],v[1]],y=m[0],b=m[1],g=(n-b.dist)/(y.dist-b.dist),O={x:g*y.x+(1-g)*b.x,y:g*y.y+(1-g)*b.y};f.push(O)}f[0].x===f[1].x&&f[0].y===f[1].y||r.push([f[0],f[1]])}}}catch(k){a.e(k)}finally{a.f()}return r},f=function(e){var t,n=Object(a.a)(e),s={},o=i(e);try{for(o.s();!(t=o.n()).done;){var c=t.value,u=Object(r.a)(c,2),l=u[0],f=u[1];l=d(l),f=d(f),s[l]||(s[l]=[]),s[f]||(s[f]=[]),s[l].push(c),s[f].push(c)}}catch(g){o.e(g)}finally{o.f()}for(var v=[];n.length>0;)for(var m=n.shift();;){var y=p(s[d(h(m))],n);y.length>0&&function(){var e=y.pop();e[1].x===h(m).x&&e[1].y===h(m).y?m.push(e[0]):m.push(e[1]),n=n.filter(function(t){return t!==e})}();var b=p(s[d(m[0])],n);if(b.length>0&&function(){var e=b.pop();m.unshift(e[1].x===m[0].x&&e[1].y===m[0].y?e[0]:e[1]),n=n.filter(function(t){return t!==e})}(),0===b.length&&0===y.length){v.push(m);break}}return v},h=function(e){return e[e.length-1]},p=function(e,t){return e||[]},d=function(e){return e.x+","+e.y}},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var r=n(42),a=n.n(r),i=n(56),s=n(271),o=n(171),c=n(79),u=n(197),l=n(138),f=n(23),h=n(305),p=n(7),d=n.n(p);function v(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var y=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,u,l,h,p,d,m,y;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getSelectedTrack(),r=n.presetName||n.getName(),t.store.dispatch(Object(f.bc)("Freezing instrument")),e.next=5,Object(c.a)(250);case 5:return e.next=7,Object(s.b)(t,n);case 7:return i=e.sent,e.next=10,b(t,i,r);case 10:o=e.sent,(u=t.addSampledInstrumentTrack()).resampledFrom=n.preset,l=0,h=[],p=v(o);try{for(p.s();!(d=p.n()).done;)m=d.value,t.recordingsToSave.push(m),h.push(u.instrument.newSample(3*l-12,m)),l++}catch(a){p.e(a)}finally{p.f()}return e.next=19,Promise.all(h);case 19:y=n.instrument?n.instrument.ampEnvelope.release:2e3,u.instrument.releaseParameter.set(y),t.store.dispatch(Object(f.bc)(void 0)),n.preset;case 23:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var s,c,f,p,v;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for([],s=0,c=new u.a(2,function(e,t,n){return[]}),t.state.freeze.loops,64,f=[],24,p=function(e){var u=s,p=u+64*d.a.Master.context.sampleRate*new d.a.Time("32n").toMilliseconds()/1e3,v=Object(h.a)(n,u,p,d.a.Master.context);s=p,f.push(new Promise(function(){var n=Object(i.a)(a.a.mark(function n(i){var s,u;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c.uploadBufferToIpfs(v);case 2:s=n.sent,(u=new l.a(s)).audioBuffer=v,u.tempo=t.tempo,u.name=r+": "+o.a.fromTranspose(-12+e).toString(),u.tags=["Resampled",r],i(u);case 9:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()))},v=0;v<24;v++)p(v);return e.next=11,Promise.all(f);case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()},function(e,t,n){"use strict";(function(e){n.d(t,"c",function(){return O}),n.d(t,"a",function(){return k}),n.d(t,"b",function(){return j});var r=n(42),a=n.n(r),i=n(56),s=n(148),o=n(139),c=(n(79),n(789)),u=n(118),l=n(775),f=n(146),h=n(158),p=n(155),d=n(122);function v(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var y=new l.a,b=h.a.utils.padLeft("0x0",64),g=function(e){return e?Object(s.b)(e):b},O=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,c,u,l,d,v,m;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.projectHash,r=t.bpm,i=t.title,o=t.hasArrangement,c=t.thumbnail,u=t.presetsList,l=t.patterns,d=t.previousHash,v=t.samples,console.log(t),console.log("generated project metata=",c,n,r,o,u,l),m=h.a.utils.padLeft("0x0",64),c=c?Object(s.b)(c):m,u=u.map(function(e){return Object(s.b)(e)}),new p.a(f.n,"newProjectMetadata",[g(n),g(d),i,r,c,u,v.map(g),l,o]).execute();case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),k=function(){var t=Object(i.a)(a.a.mark(function t(n,r){var i,s,o,c,u,l,f,h;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.subSequences.flatMap(function(e){return e.tracks.filter(function(e){return e.preset&&e.preset.contentHash}).map(function(e){return e.preset.contentHash})}),s=n.tracks[0]?n.tracks[0].patterns.length:0,o=n.subSequences[0].mix&&n.subSequences[0].mix.length>0,c=n.bpm,u=void 0,!(l=n.subSequences[0].findNodeByName("three.canvas").find(function(e){return!e.isUI&&(!e.subSequence.zObject||!e.subSequence.zObject.isUI)}))||!l.effect.renderer){t.next=13;break}return console.log("generating thumbnail with canvas=",l),f=l.effect.renderer.domElement.toDataURL().slice(22),h=e.from(f,"base64"),t.next=12,d.a.addBuffer(h);case 12:u=t.sent;case 13:return t.abrupt("return",{bpm:c,thumbnail:u,projectHash:r,hasArrangement:o,patterns:s,presetsList:i});case 14:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}(),j=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,l,f,h,p,d,m,b,g,O,k,j,w,x,S,P,E,T,A,M,R,C,N,q,I,_,D=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(D.length>1&&void 0!==D[1])||D[1],r=new o.a(y.contractAddress).from(u.L).select("projectHash").select("thumbnailhash").whereIn("projectHash",t),e.next=4,r.executeQuery();case 4:return i=e.sent,s=new o.a(y.contractAddress).from(u.K).select("projectHash").select("presetHash").whereIn("projectHash",t),e.next=8,s.executeQuery();case 8:return l=e.sent,f=new o.a(y.contractAddress).from(u.J).select("projectHash").whereIn("projectHash",t),e.next=12,f.executeQuery();case 12:if(h=e.sent,p={},!n){e.next=21;break}return d=new o.a((new c.a).contractAddress).from(u.T).select("sequenceHash").select("sampleHash").whereIn("sequencehash",t),e.next=18,d.executeQuery();case 18:m=e.sent,b=v(m);try{for(b.s();!(g=b.n()).done;)O=g.value,k=O.sequenceHash,j=O.sampleHash,p[k]||(p[k]={}),p[k].samples||(p[k].samples=[]),p[k].samples.push(j)}catch(a){b.e(a)}finally{b.f()}case 21:w=v(i);try{for(w.s();!(x=w.n()).done;)S=x.value,P=S.projectHash,E=S.thumbnailhash,p[P]||(p[P]={}),p[P].thumbnail=E}catch(a){w.e(a)}finally{w.f()}T=v(l);try{for(T.s();!(A=T.n()).done;)M=A.value,R=M.projectHash,C=M.presetHash,p[R]||(p[R]={}),p[R].presets||(p[R].presets=[]),p[R].presets.push(C)}catch(a){T.e(a)}finally{T.f()}N=v(h);try{for(N.s();!(q=N.n()).done;)I=q.value,_=I.projectHash,p[_]||(p[_]={}),p[_].hasArrangement=!0}catch(a){N.e(a)}finally{N.f()}return console.log("RESULTS=",p),e.abrupt("return",p);case 29:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}).call(this,n(108).Buffer)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});n(1);var r=n(42),a=n.n(r),i=n(56),s=(n(155),n(139)),o=(n(23),n(298)),c=n(118),u=(n(566),n(148),n(146),n(776)),l=(n(496),function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,l,f;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("loaded minted project =",n,r),n=parseInt(n),r=parseInt(r),e.next=5,new s.a((new u.a).contractAddress).from(c.i).select("contentHash").where("projectId",n).executeQuery();case 5:return i=e.sent,e.next=8,new s.a((new u.a).contractAddress).from(c.E).select("seedHash").where("tokenId",r).where("projectId",n).executeQuery();case 8:if(0!==(l=e.sent).length&&0!==i.length){e.next=11;break}return e.abrupt("return");case 11:for(l=l[0],i=i[0],t.tokenId=r,t.projectId=n,t.seedHash=l.seedHash,t.loadSequence(i.contentHash),Object(o.a)(l.seedHash),f=0;f<100;f++)console.log(Object(o.b)());console.log("found the project+token pair",i,l);case 20:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}())},,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(42),a=n.n(r),i=n(56),s=n(153),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4?arguments[4]:void 0;return new Promise(function(){var c=Object(i.a)(a.a.mark(function i(c,u){var l,f;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!window.isNFT){a.next=3;break}return c([]),a.abrupt("return");case 3:return a.next=5,s.a.getAccount();case 5:l=a.sent,f={andTags:e,guildIds:t,isFavorited:n,user:l,byDate:r},o&&(f.startYear=o.start,f.endYear=o.end),fetch("/samplesStream/",{method:"POST",body:JSON.stringify(f),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){c(e.ids)});case 9:case"end":return a.stop()}},i)}));return function(e,t){return c.apply(this,arguments)}}())}},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return a});var r=n(186);function a(e){var t=r.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}}).call(this,n(108).Buffer)},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(347);function u(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=f(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"loadLostParameters",value:function(e){var t,n=u(this.midiEffects.effects);try{for(n.s();!(t=n.n()).done;){var r=t.value;(r.effects||[r]).filter(function(e){return e.lostParameters&&e.lostParameters.length>0}).forEach(function(e){e.lostParameters=e.loadParameters(e.lostParameters)})}}catch(a){n.e(a)}finally{n.f()}(this.tracks&&this.tracks.forEach(function(t){return e?t.loadLostParameters():t.track?t.track.loadLostParameters():0}),e)&&Object(c.a)(this).filter(function(e){return e.effect&&e.effect.lostParameters&&e.effect.lostParameters.length>0}).forEach(function(e){return e.effect.lostParameters=e.effect.loadParameters(e.effect.lostParameters)})}}]),n}(e)}},function(e,t,n){"use strict";var r=n(11),a=n(4),i=n(5),s=(n(544),n(922)),o=n(123),c=function(){function e(t){Object(a.a)(this,e),this.track=t,this.effects=[]}return Object(i.a)(e,[{key:"addEffect",value:function(e){this.effects=[].concat(Object(r.a)(this.effects),[e]),this.linkEffectParameters()}},{key:"clear",value:function(){}},{key:"clearEffects",value:function(){this.effects.forEach(function(e){return e.dispose()}),this.effects=[]}},{key:"linkEffectParameters",value:function(){var e=this;this.effects.forEach(function(t){t.registerContext((new o.a).forTrack(e.track)),t.registerMixSession(e.track.mixSession),t.registerTrack(e.track)})}},{key:"deleteEffect",value:function(e){var t=this.effects.indexOf(e);this.effects.splice(t,1)}},{key:"getAllParameters",value:function(){var e=[];for(var t in this.effects)e=[].concat(Object(r.a)(e),Object(r.a)(this.effects[t].getParameters()));return e}},{key:"getEffect",value:function(e){var t=this.effects.filter(function(t){return t.effect==e&&t.isEnabled()});return t.length>0?t[0]:void 0}},{key:"getJson",value:function(){return this.effects.map(function(e){return e.getJson()})}},{key:"fromJson",value:function(e){for(var t in e)this.addEffect(Object(s.a)(e[t],this.track)),this.effects[this.effects.length-1].fromJson(e[t])}},{key:"getCopy",value:function(t,n){var r=new e(t);return console.log("live effects =",this.effects),r.effects=this.effects.map(function(e){return e.getCopy(t,n)}),r.linkEffectParameters(),r}}]),e}();t.a=c},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=c(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"updatePatternRollStepNumber",value:function(e){if(void 0!==this.patternRollStepNumber){var t=e.getNumberOfStepsAtBaseResolution();this.patternRollStepNumber-=this.patternRollStepNumber%t}}},{key:"initPatternBuffer",value:function(e){if(this.pattern){var t=this.pattern.stepBuckets.length;this.patternRollStepNumber=e%t,this.patternRollStepNumber%2===1&&this.patternRollStepNumber++}else this.patternRollStepNumber=e}}]),n}(e)}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=(n(553),n(7)),s=n.n(i),o=n(171),c=n(349),u=n(23),l=n(197),f=n(138);function h(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d=function(){function e(t,n){var a=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(r.a)(this,e),this.sequencerEngine=t,this.input=n,this.soundUploader=new l.a(2,function(e,t,n){return a.onSoundUploaded(t)}),this.isMaster=i,this.resampleCount=0}return Object(a.a)(e,[{key:"getRecorder",value:function(){return new window.Recorder(this.input,{numChannels:2,bufferLen:1024})}},{key:"start",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.track=t,this.freeze=n,this.sequencerEngine.store.dispatch(Object(u.Ob)(void 0===t||t.trackNumber)),this.resamplingDurationElapsed=0,this.recorder.record(e)}},{key:"stop",value:function(e){var t=this,n=Object(c.a)(e)+400;this.autoResampleMode||(e+=.2),this.recorder.stop(e),setTimeout(function(){t.recorder.getBuffer(function(e){return t.saveBuffer(e)}),t.sequencerEngine.store.dispatch(Object(u.Ob)(void 0))},n+500)}},{key:"saveBuffer",value:function(e){if(0===e[0].length)return console.log("frame count for blob is 0 so redoing the damn shit!"),void this.redoResample();this.audioBuffer=this.getAudioBuffer(e),this.soundUploader.uploadBufferToIpfs(e,!0,0)}},{key:"getAudioBuffer",value:function(e){var t=e[0].length,n=s.a.Master.context.createBuffer(2,t,s.a.Master.context.sampleRate);return n.copyToChannel(e[0],0,0),n.copyToChannel(e[1],1,0),n}},{key:"autoResampleTrack",get:function(){return this.sequencerEngine.tracks[0]}},{key:"autoResampleTrackNote",get:function(){return this.autoResampleTrack.pattern.stepBuckets[0].steps[0].transpose}},{key:"incrementNotes",value:function(e){var t,n=h(this.autoResampleTrack.pattern.stepBuckets);try{for(n.s();!(t=n.n()).done;){var r=t.value;for(var a in r.steps)r.steps[a].getPolyphony().forEach(function(t){return t.transpose+=e})}}catch(i){n.e(i)}finally{n.f()}}},{key:"autoResampleMode",get:function(){return this.sequencerEngine.autoResampleMode}},{key:"samplesPerNote",get:function(){return this.sequencerEngine.resampleConfig.samplesPerNote}},{key:"onSoundUploaded",value:function(e){var t=new f.a(e);if(t.audioBuffer=this.audioBuffer,t.name="Resampled Recording",t.tags=["Resampled"],this.autoResampleMode){t.name=o.a.fromTranspose(this.autoResampleTrackNote).toString();var n=this.autoResampleTrack;n.midiOutputs&&t.tags.push(Array.from(n.midiOutputs)[0].name)}if(t.isResampled=!0,t.samplesUsed=[],this.isMaster){var r=this.sequencerEngine.tracks.filter(function(e){return!e.muted&&e.sample}).map(function(e){return e.sample});t.samplesUsed=r.map(function(e){return e.getId()})}void 0===t.samplesUsed&&(t.samplesUsed=[]),this.freeze?this.track.freeze(t):(void 0===this.sampledInstrument&&(this.sampledInstrument=this.sequencerEngine.addSampledInstrumentTrack(),this.autoResampleMode&&this.matchLengths(this.sampledInstrument)),this.sampledInstrument.instrument.newSample(void 0,t),this.sequencerEngine.recordingsToSave.push(t)),this.autoResampleMode&&(console.log("AUTO RESAMPLE MMODEE PREPARE"),this.prepare(),this.resampleCount%this.samplesPerNote===0&&this.incrementNotes(2),this.resampleCount++,this.sequencerEngine.store.dispatch(Object(u.Xc)(!0)))}},{key:"prepare",value:function(){void 0===this.recorder?this.recorder=this.getRecorder():this.recorder.clear()}},{key:"matchLengths",value:function(e){for(;e.length>this.autoResampleTrack.length;)e.halfTrackLength()}},{key:"dispatch",value:function(e){this.sequencerEngine.store.dispatch(e)}},{key:"redoResample",value:function(){this.isMaster?this.dispatch(Object(u.Xc)(!0)):this.dispatch(Object(u.ye)(this.track.subSequence.id,this.track.trackNumber))}}]),e}();t.a=d},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return c});var r=n(7),a=new(n.n(r).a.Time)("32n");function i(e,t,n){var r=e[0],a=e.map(function(e){return c(e-r,t,n)}),i=o(a,32),u=s(a,32,i),l=o(u,16),f=o(u=s(u,16,l),8),h=o(u=s(u,8,f),4),p=o(u=s(u,4,h),2),d=o(u=s(u,2,p),1);return u=s(u,1,d),console.log("timing 1 = "),console.log(d),{steps:u,unquantizedSteps:a,timings:[d,p,h,f,l,i].filter(function(e){return!(0===(t=e).even&&0===t.odd);var t})}}function s(e,t,n){var r=32/t;return e.map(function(e){return{stepNumber:e.stepNumber,offset:Math.max(0,Math.floor(e.stepNumber/r)%2===0?e.offset-n.even:e.offset-n.odd)}})}function o(e,t){var n=32/t,r=void 0,a=void 0;for(var i in e){var s=e[i],o=s.stepNumber,c=s.offset;Math.floor(o/n)%2===0?(1===t&&console.log("even for 1 offset = "+c),(void 0===a||a>c)&&(a=c)):(1===t&&console.log("odd for 1 offset = "+c),(void 0===r||r>c)&&(r=c))}return{resolution:t,even:a||0,odd:r||0}}function c(e,t,n){var r=e*t/n/a.toMilliseconds(),i=r-Math.floor(r);return{stepNumber:Math.floor(r),offset:i}}},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(6),o=n(8),c=n(2),u=n(7),l=n.n(u),f=(n(349),n(23)),h=n(129);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}t.a=function(e){return function(e){Object(s.a)(n,e);var t=p(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).currentStepDatas=[],e}return Object(i.a)(n,[{key:"releaseAll",value:function(e){this.getSamplers().filter(function(e){return e&&e.isLoaded()}).map(function(t){return t.releaseAll(e)}),this.instrument&&this.instrument.releaseAll(e)}},{key:"liveTriggerRelease",value:function(e,t){this.gated&&(this.triggerRelease(e,t),this.chokes.liveRelease())}},{key:"resetAnyPLockedParameters",value:function(e,t){if(this.previousPLocks&&this.previousPLocks.length>0){var n=Array.from(new Set(this.previousPLocks)).filter(function(e){return e.savedUnlockedValue}).filter(function(t){return!e||!e.pLockedParameters.includes(t)}).map(function(e){if(void 0===e.savedUnlockedValue)return{id:-1,value:-1};var n=e.set(e.savedUnlockedValue,!0,!0,t);return e.savedUnlockedValue=void 0,n}).reduce(function(e,t){var n=t.id,a=t.value;return Object(r.a)({},e,function(e,t){var n={};return n[e]=t,n}(n,a))},{});this.store.dispatch(Object(f.ub)(n))}}},{key:"handlePLockedAutomations",value:function(e,t){var n=this;if(!this.isMetronome){var r=this.store.getState().keyboard.selectedPianoRollSteps;r&&r.some(function(e){return e.track===n})||(this.resetAnyPLockedParameters(e,t),this.previousPLocks=e.triggerAutomations(t,this))}}},{key:"storeStepData",value:function(e,t){var n=this;if(!this.isMetronome){e.time=t;var r=t-l.a.Master.context.currentTime;setTimeout(function(){n.sendMessage(h.p,e)},1e3*r),this.lastPlayedStepData=e,void 0===e.stepNumber||this.currentStepDatas[0]&&this.currentStepDatas[0].stepNumber===e.stepNumber||(this.currentStepDatas=[]),void 0===e.stepNumber&&(e=e.getCopy(!0,!1,!0,!1,!1)),this.currentStepDatas.push(e)}}},{key:"trigger",value:function(e,t){var n=this;t=t||l.a.Master.context.currentTime,this.storeStepData(e,t),this.getSamplers().filter(function(e){return e&&e.isLoaded()}).filter(function(e){return e&&e.isChosen}).map(function(r){r.trigger({gated:!!n.isWarped()||!n.isFrozen&&!n.isAudioTrack&&n.gated,stepData:e,time:t,sliceNumber:e.slice})})}},{key:"triggerSamples",value:function(e,t,n){var r=this;this.soundIds.filter(function(e){return r.isRecordingPlaying(e)}).map(function(e){return r.samplers[e]}).filter(function(e){return e&&e.isLoaded()}).map(function(n){return n.trigger({gated:!1,stepData:e,time:t})})}},{key:"triggerSlice",value:function(e){var t=this.trackData.transpose;this.triggerSample(e,t)}},{key:"triggerSample",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0;this.getSamplers().filter(function(e){return e&&e.isLoaded()}).forEach(function(u){return u.trigger({gated:!!n.isWarped()||n.gated,sliceNumber:e,stepData:c||n.trackData,start:o,noDuration:s,velocity:a,transpose:t,skipRelease:r,time:i})})}},{key:"triggerRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.getSamplers().filter(function(e){return e&&e.isLoaded()}).forEach(function(n){n.release(t,e)}),this.currentStepDatas&&(this.currentStepDatas=this.currentStepDatas.filter(function(t){return t.transpose!==e}))}},{key:"triggerMidiNoteOn",value:function(e,t){this.triggerSample(0,!1,this.resolution.getTimeInStep(),e+this.trackData.transpose,!0)}},{key:"triggerMidiNoteOff",value:function(e){}},{key:"liveTrigger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.trackData,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this.triggerSample(t,e.transpose,!0,e.velocity,n,void 0===e.duration,e.start,e.track&&e),e.track=this,this.sendMessage(h.p,e),this.storeStepData(e,n),this.chokes.liveTrigger()}}]),n}(e)}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(359);function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}t.a=function(e){return function(e){Object(i.a)(n,e);var t=u(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"addRackEffect",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=this.effectRack;a||(a=new c.a(this),this.midiEffects.addEffect(a));var i=a.adjacencyLists;if(a.addEffect(e),n){var s=i[n.id]&&i[n.id].filter(function(e){return e.outputNumber===r})||[],o=s.map(function(e){return e.effect});s.forEach(function(e){return a.deleteEdge(e)}),o.forEach(function(t){return a.connectNodes(e,t)}),a.connectNodes(n,e,r)}else if(t){if(a.effects.length>1){var u,l=void 0,f=function(e){var t=i[e].find(function(e){return e.effect===a.outputNode});if(t)return l=a.effects.find(function(t){return t.id===e}),u=t,"break"};for(var h in i){if("break"===f(h))break}a.deleteEdge(u),a.connectNodes(l,e)}else a.connectNodes(void 0,e);a.connectNodes(e)}else{var p=a.adjacencyLists[-1];if(a.effects.length>1&&p.length>0){var d=p[0].effect;a.deleteEdge(p[0]),a.connectNodes(e,d)}else a.connectNodes(e);a.connectNodes(void 0,e)}}}]),n}(e)}},,,,,,,function(e,t,n){},function(e,t,n){"use strict";var r=n(581),a=n(4),i=n(5),s=n(6),o=n(8),c=n(2),u=n(166),l=(n(355),n(414)),f=n(36);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var p=function(e){Object(s.a)(n,e);var t=h(n);function n(e,r,i){var s;return Object(a.a)(this,n),(s=t.call(this,e,r.getType())).event=r,s.duration=i,s}return Object(i.a)(n,[{key:"addEvent",value:function(e,t,n){new l.a(this.mix,e,t,n).execute()}},{key:"execute",value:function(){for(var e in this.events){var t=this.events[e];if(!t.isPrunable()){if(this.event.step===t.step||this.event.step===t.step+t.duration)return;if(this.event.step>t.step&&this.event.step<t.step+t.duration){var n=this.event.initialSubEvent;return n.step=this.event.step,void t.addSubEvent(n)}}}this.addEvent(this.event,0,this.event.step);var r=new f.a(!1,this.event.initialSubEvent.resolution);r.step=this.event.step+this.duration,this.addEvent(r,0,r.step)}}]),n}(u.a),d=n(245),v=n(415),m=n(416);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var b=function(e){Object(s.a)(n,e);var t=y(n);function n(e,r,i){var s;return Object(a.a)(this,n),(s=t.call(this,e,r.getType())).event=r,s.resolution=i,s}return Object(i.a)(n,[{key:"execute",value:function(){void 0!==this.resolution&&(this.event.resolution=this.resolution)}}]),n}(u.a);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var O=function(e){Object(s.a)(n,e);var t=g(n);function n(e,r,i){var s;return Object(a.a)(this,n),(s=t.call(this,e,r.getType())).event=r,s.patternNumber=i,s}return Object(i.a)(n,[{key:"execute",value:function(){this.event.patternNumber=this.patternNumber}}]),n}(u.a);function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var j=function(e){Object(s.a)(n,e);var t=k(n);function n(e,r,i){var s;return Object(a.a)(this,n),(s=t.call(this,e,r.getType())).event=r,s.xTransform=i-s.event.step,s}return Object(i.a)(n,[{key:"execute",value:function(){var e=this,t=this.mixByType.getNextEvent(this.event);if(void 0!==t){var n=this.mixByType.getNextEvent(t);(void 0===n||t.step+this.xTransform<=n.step)&&(this.event.step+=this.xTransform,t.step+=this.xTransform,this.event.initialSubEvent.step+=this.xTransform,this.event.subEvents.forEach(function(t){return t.step+=e.xTransform}),t.initialSubEvent.step+=this.xTransform,t.subEvents.forEach(function(t){return t.step+=e.xTransform}))}}}]),n}(u.a),w=n(42),x=n.n(w),S=n(11),P=n(56);function E(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var A=function(e){if(!e.tracks)return[];var t=[];return e.tracks.forEach(function(e){t=[].concat(Object(S.a)(t),Object(S.a)(e.getAllParameters().filter(function(e){return e.mixAutomation.automations.length>0})))}),t},M=n(9),R=n(23),C=function(){function e(t,n,r){Object(a.a)(this,e),this.track=t,this.pattern=n,this.step=r}return Object(i.a)(e,[{key:"execute",value:function(){var e=this.pattern.split(this.step);this.track.patterns.push(e),this.track.updateSteps(!0);var t={};t[M.a]=e,this.track.sequencerEngine.store.dispatch(Object(R.jd)(t))}}]),e}();function N(e,t,n){q(e.patterns.find(function(e){return e.overlapsStep(t)&&e.startStep<t}),t),q(e.patterns.find(function(e){return e.overlapsStep(n)&&e.startStep<n}),n);var r=e.patterns.filter(function(e){var r=e.startStep,a=e.startStep+e.length();return!(r>=t&&r<n||a>t&&a<=n)});e.patterns=r,e.updateSteps(!0)}function q(e,t){void 0!==e&&new C(e.track,e,t).execute()}function I(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var _=function(e){Object(s.a)(n,e);var t=I(n);function n(e,r){var i;return Object(a.a)(this,n),(i=t.call(this,e,void 0)).selection=r,i.start=i.selection.start,i.end=i.selection.end,i}return Object(i.a)(n,[{key:"execute",value:function(){if(void 0!==this.mix.subSequence){for(var e in this.mix.mixesByType){var t=this.mix.mixesByType[e];this.deleteByType(parseInt(e),t)}for(var n in this.mix.deterministicMixesByType){var r=this.mix.deterministicMixesByType[n];this.deleteByType(parseInt(n),r)}var a,i,s;this.mix.subSequence.isTrack&&this.executeForTrack(this.mix.subSequence.tracks[0]),a=this.mix.subSequence,i=this.start,s=this.end,A(a).forEach(function(e){var t=e.mixAutomation.automations.filter(function(e){return e.step<i||e.step>s});for(var n in t){var r=t[n];r.step>s&&(r.step-=s-i,t[n]=r.getCopy())}e.mixAutomation.automations=t,e.mixAutomation.schedule(),e.mixAutomation.clearCache(),e.mixAutomation.updateRedux(!0)})}else{var o=this.mix.deterministicMixesByType[M.k];this.deleteByType(M.k,o)}}},{key:"deleteByType",value:function(e,t,n){var r=t.getEventsBetween(this.start,this.end,!0).filter(function(e){return!e.isPrunable()});for(var a in r){var i=r[a];if(void 0!==i.initialSubEvent){var s=Object(S.a)(i.subEvents);for(var o in s)new m.a(this.mix,i,s[o]).execute();new m.a(this.mix,i,i.initialSubEvent).execute()}else new v.a(this.mix,i,!0).execute()}if("LINEAR"===t.getMixType()){var c=Object(M.r)(e);if(void 0!==c){var u=t.getValueAtStep(this.start),l=Object(M.r)(e);c.step=this.start,l.step=this.end-1,c.setValue(u),l.setValue(u),c.subSequence=this.mix.subSequence,l.subSequence=this.mix.subSequence,new d.a(this.mix,c,1).execute(),new d.a(this.mix,l,1).execute()}}}},{key:"executeForTrack",value:function(e){N(e,this.start,this.end)}}]),n}(u.a);function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var F=function(e){Object(s.a)(n,e);var t=D(n);function n(e,r,i,s){var o;return Object(a.a)(this,n),(o=t.call(this,e,void 0)).step=r,o.selection=i,o.start=o.selection.start,o.end=o.selection.end,o.mixType=s,o}return Object(i.a)(n,[{key:"execute",value:function(){if(this.mix.subSequence.id===M.g.id&&(this.mixType=M.k),void 0===this.mixType){for(var e in this.mix.mixesByType){var t=this.mix.mixesByType[e];this.executeByType(parseInt(e),t)}for(var n in this.mix.deterministicMixesByType){var r=this.mix.deterministicMixesByType[n];this.executeByType(parseInt(n),r)}this.mix.subSequence.isTrack&&this.executeForTrack(this.mix.subSequence.tracks[0])}else this.mix.mixesByType[this.mixType]?this.executeByType(this.mixType,this.mix.mixesByType[this.mixType]):this.mix.deterministicMixesByType[this.mixType]&&this.executeByType(this.mixType,this.mix.deterministicMixesByType[this.mixType])}},{key:"executeByType",value:function(e,t,n){}},{key:"executeForTrack",value:function(){}},{key:"splitIntersectingPatterns",value:function(e){var t=this,n=e.patterns.find(function(e){return e.overlapsStep(t.start)&&e.startStep<t.start});this.splitPattern(n,this.start);var r=e.patterns.find(function(e){return e.overlapsStep(t.end)&&e.startStep<t.end});this.splitPattern(r,this.end)}},{key:"splitPattern",value:function(e,t){void 0!==e&&new C(e.track,e,t).execute()}}]),n}(u.a);function L(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var B=function(e){Object(s.a)(n,e);var t=L(n);function n(e,r,i,s,o){var c;return Object(a.a)(this,n),(c=t.call(this,e,r,i,s)).track=o,c}return Object(i.a)(n,[{key:"executeByType",value:function(e,t,n){var r=this,a=t.getEventsBetween(this.start,this.end,!0).filter(function(e){return!e.isPrunable()}).map(function(e){var t=e.getCopy(r.mix.sequencerEngine);return t.setTime(void 0,r.step+e.step-r.start),t.subEvents&&t.subEvents.forEach(function(e){return e.step=r.step+e.step-r.start}),t.duration=e.duration,t.subSequence=r.mix.subSequence,t});if("DETERMINISTIC"===t.getMixType()){var i=t.getEvent(this.start,!1).getCopy(this.mix.sequencerEngine);i.isPrunable()||(i.setTime(void 0,this.step),a.push(i))}if("LINEAR"===t.getMixType()){var s=Object(M.r)(e);if(void 0!==s){var o=t.getValueAtStep(this.start),c=t.getValueAtStep(this.end-1);s.setValue(o),s.setTime(void 0,this.step),s.subSequence=this.mix.subSequence;var u=Object(M.r)(e);u.setValue(c),u.setTime(void 0,this.step+this.end-this.start-1),u.subSequence=this.mix.subSequence;var l=Object(M.r)(e);l.setValue(c),l.setTime(void 0,this.step-1),l.subSequence=this.mix.subSequence,a.push(s),a.push(u),a.push(l)}}for(var f in a){var h=a[f];e===M.k?new p(this.mix,h,h.duration).execute():new d.a(this.mix,h,h.duration).execute()}}},{key:"executeForTrack",value:function(){var e=Object(P.a)(x.a.mark(function e(t){var n,r,a,i,s,o,c,u;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=1/0,a=-1/0,e.t0=x.a.keys(t.patterns);case 4:if((e.t1=e.t0()).done){e.next=33;break}if(i=e.t1.value,!((s=t.patterns[i]).startStep>=this.start&&s.startStep<this.end||s.endStep>=this.start&&s.endStep<this.end)){e.next=31;break}if(o=void 0,!(s.startStep<this.start)){e.next=16;break}return c=this.start-s.startStep,e.next=13,s.getCopy(c,c+s.endStep-this.start);case 13:o=e.sent,e.next=25;break;case 16:if(!(s.endStep>this.end)){e.next=22;break}return e.next=19,s.getCopy(0,this.end-s.startStep);case 19:o=e.sent,e.next=25;break;case 22:return e.next=24,s.getCopy();case 24:o=e.sent;case 25:o.startStep<r&&(r=o.startStep),o.endStep>a&&(a=o.endStep),o.track=this.track,u=o.startStep-this.start,o.startStep=this.step+u,n.push(o);case 31:e.next=4;break;case 33:r!==1/0&&a!==-1/0&&N(this.track,this.step+r-this.start,this.step+a-this.start),this.track.patterns=[].concat(Object(S.a)(this.track.patterns),n),this.track.updateSteps();case 36:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),n}(F),z=n(10);function J(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var V=function(e){Object(s.a)(n,e);var t=J(n);function n(e,r,i,s){return Object(a.a)(this,n),t.call(this,e,r,i,s)}return Object(i.a)(n,[{key:"getEventsAfter",value:function(e,t){return e.events.filter(function(e){return e.step>=t})}},{key:"executeByType",value:function(e,t,n){var r=this.getEventsAfter(t,this.start);for(var a in r){var i=r[a],s=(i.step,this.step-this.start);if(i.setTime(void 0,i.step+s),i.subEvents)for(var o in i.subEvents){i.subEvents[o].step+=s}}}}]),n}(F);function H(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var U=function(e){Object(s.a)(n,e);var t=H(n);function n(e,r,i){var s;return Object(a.a)(this,n),(s=t.call(this,e,void 0,r,i)).step=s.end,s}return Object(i.a)(n,[{key:"duration",get:function(){return this.end-this.start}},{key:"execute",value:function(){var e,t,r,a={start:this.end};new V(this.mix,this.end+this.duration,a).execute(),Object(z.a)(Object(c.a)(n.prototype),"execute",this).call(this),e=this.mix.subSequence,t=this.start,r=this.end,console.log("DUPLICATE START=%s END=%s",t,r),A(e).forEach(function(e){var n=Object(S.a)(e.mixAutomation.automations),a=n.filter(function(e){return e.step>=t&&e.step<r});for(var i in n){var s=n[i];s.step>r&&(n[i]=s.getCopy(),n[i].step+=r-t)}var o,c=E(a);try{for(c.s();!(o=c.n()).done;){var u=o.value.getCopy(!1);u.step+=r-t,n.push(u)}}catch(l){c.e(l)}finally{c.f()}n.sort(function(e,t){return e.step-t.step}),e.mixAutomation.automations=n,e.mixAutomation.schedule(),e.mixAutomation.clearCache(),e.mixAutomation.updateRedux(!0)})}},{key:"executeForTrack",value:function(){var e=Object(P.a)(x.a.mark(function e(){var t,n,r,a,i,s,o=this;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.mix.subSequence.tracks[0],this.splitIntersectingPatterns(t),n=this.end-this.start,t.patterns.filter(function(e){return e.startStep>=o.end}).forEach(function(e){return e.startStep+=n}),e.t0=x.a.keys(t.patterns);case 5:if((e.t1=e.t0()).done){e.next=17;break}if(r=e.t1.value,!((a=t.patterns[r]).startStep>=this.start&&a.startStep<this.end)){e.next=15;break}return i=a.startStep-this.start,e.next=12,a.getCopy();case 12:(s=e.sent).startStep=this.end+i,t.patterns.push(s);case 15:e.next=5;break;case 17:t.updateSteps();case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(B),G=function(){function e(t,n,r){Object(a.a)(this,e),this.track=t,this.pattern=n,this.startStep=r}return Object(i.a)(e,[{key:"execute",value:function(){this.pattern.startStep=this.startStep}}]),e}(),W=(n(21),n(417),n(356)),K=function(){function e(t,n,r){Object(a.a)(this,e),this.pattern=n,this.step=r,this.track=t}return Object(i.a)(e,[{key:"execute",value:function(){var e=Object(P.a)(x.a.mark(function e(){var t,n,r;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return N(this.track,this.step,this.step+this.pattern.length()),e.next=3,this.pattern.getCopy();case 3:(t=e.sent).track=this.track,t.startStep=this.step,this.track.patterns.push(t),this.track.updateSteps(!0),(n={})[M.a]=t,this.track.sequencerEngine.store.dispatch(Object(R.jd)(n)),r=this.step+t.length(),this.track.sequencerEngine.store.dispatch(Object(R.y)(r));case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"xScale",get:function(){return this.track.sequencerEngine.state.arrangement.xScale}}]),e}(),Q=function(){function e(t,n){Object(a.a)(this,e),this.pattern=n,this.track=t}return Object(i.a)(e,[{key:"execute",value:function(){var e=Object(P.a)(x.a.mark(function e(){var t,n,r;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return N(this.track,this.pattern.endStep,this.pattern.endStep+this.pattern.length()),e.next=3,this.pattern.getCopy();case 3:(t=e.sent).track=this.track,t.startStep=this.pattern.startStep+this.pattern.length(),this.track.patterns.push(t),this.track.updateSteps(!0),(n={})[M.a]=t,this.track.sequencerEngine.store.dispatch(Object(R.jd)(n)),r=t.startStep,this.track.sequencerEngine.store.dispatch(Object(R.y)(r));case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"xScale",get:function(){return this.track.sequencerEngine.state.arrangement.xScale}}]),e}(),Z=function(){function e(t,n,r){Object(a.a)(this,e),this.pattern=t,this.direction=n,this.resizedStep=r}return Object(i.a)(e,[{key:"findOverlappingPattern",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.resizedStep;return this.pattern.track.patterns.filter(function(t){return t!==e.pattern}).find(function(e){return e.overlapsStep(t)})}},{key:"cutOverlappingPattern",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.resizedStep;if(void 0!==e)if(this.direction===W.b){var n=t-e.startStep;if(n<=0)return void this.deletePattern(e);e.changeLength(n)}else{var r=t-e.startStep;if(e.cutFromStart(r),e.startStep=t,0===e.length())return void this.deletePattern(e)}}},{key:"deletePattern",value:function(e){var t=e.track;t.patterns=t.patterns.filter(function(t){return t!==e})}},{key:"execute",value:function(){if(this.direction===W.c){var e=this.resizedStep-this.pattern.startStep;if(e<=0)return;e>this.pattern.length()&&this.cutOverlappingPattern(this.findOverlappingPattern()),this.pattern.changeLength(e,!1)}else this.resizedStep<this.pattern.startStep?(this.cutOverlappingPattern(this.findOverlappingPattern()),this.pattern.addToStart(this.pattern.startStep-this.resizedStep)):(this.pattern.cutFromStart(this.resizedStep-this.pattern.startStep),0===this.pattern.length()&&this.deletePattern(this.pattern)),this.pattern.startStep=this.resizedStep;this.pattern.track.updateSteps(!0)}}]),e}();function Y(e,t){void 0===t&&(t=e);var n=t.payload,a=void 0;switch(t.type){case r.i:(a=new p(e,n.event,n.duration)).execute();break;case r.h:(a=new d.a(e,n.event,n.duration)).execute();break;case r.b:(a=new v.a(e,n.event,n.inPlace)).execute();break;case r.a:(a=new m.a(e,n.event,n.subEvent)).execute();break;case r.g:(a=new b(e,n.event,n.resolution)).execute();break;case r.f:(a=new O(e,n.event,n.pattern)).execute();break;case r.k:(a=new j(e,n.event,n.newStep)).execute();break;case r.m:(a=new B(e,n.step,n.selection,n.eventType,n.track)).execute();break;case r.c:(a=new _(e,n.selection)).execute();break;case r.e:(a=new U(e,n.selection,n.eventType)).execute();break;case r.j:return(a=new G(n.track,n.pattern,n.startStep)).execute(),a;case r.o:return(a=new C(n.track,n.pattern,n.step)).execute(),a;case r.l:return(a=new K(n.track,n.pattern,n.step)).execute(),a;case r.d:return(a=new Q(n.track,n.pattern)).execute(),a;case r.n:return(a=new Z(n.pattern,n.direction,n.resizedStep)).execute(),a;default:return}return n.event?n.event.parentEvent?(e.updateTypeRedux(n.event.parentEvent.getType()),e.prune(n.event.parentEvent.getType())):(e.updateTypeRedux(n.event.getType()),e.prune(n.event.getType())):e.updateAllTypeRedux(),a}n.d(t,"a",function(){return Y})},,function(e,t,n){"use strict";var r=n(6),a=n(8),i=n(2),s=n(4),o=n(5),c=function(){function e(t,n){Object(s.a)(this,e),this.sampler=t,this.sliceNumber=n}return Object(o.a)(e,[{key:"start",get:function(){return this.sampler.getStartTime(this.sliceNumber)},set:function(e){this.sampler.slice(this.sliceNumber,e,this.end)}},{key:"end",get:function(){return this.sampler.getEndTime(this.sliceNumber)},set:function(e){this.sampler.slice(this.sliceNumber,this.start,e)}}]),e}(),u=n(42),l=n.n(u),f=n(56);function h(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.cursor.step;return e.getSelectedTrack().getEasyPattern().getStepsAtStepNumber(e.cursor.step).map(function(e){return e.step})}var p=n(43),d=n(174);function v(e,t){var n=t.split("=");if(2!=n.length)return!1;var r=n[0],a=n[1];if(!Object(p.a)(a))return!1;if(a=parseFloat(a),"length"===r)return function(e,t){t=d.a.baseResolution.transformStepAtResolution2(t,e.resolution);var n=e.getSelectedTrack();n.pattern.changeLength(t),n.updateSteps()}(e,a),!0;var i=h(e);for(var s in i){var o=i[s];if(!(r in o))return!1;o[r]=a}return e.getSelectedTrack().updateSteps(),!0}var m=n(23),y=n(884),b=function(){function e(t){Object(s.a)(this,e),this.sequencerEngine=t}return Object(o.a)(e,[{key:"run",value:function(e){return"run"!==e&&(e.indexOf("=")>-1?v(this.sequencerEngine,e):e in this&&(this[e](),!0))}},{key:"warp",value:function(){this.track&&(this.track.warp(),this.sequencerEngine.update())}},{key:"gate",value:function(){this.track&&(this.track.gated=!0)}},{key:"ungate",value:function(){this.track&&(this.track.gated=!1)}},{key:"sampleSynth",value:function(){this.sequencerEngine.autoResampleMode=!0,this.sequencerEngine.masterResampler.prepare(),this.sequencerEngine.store.dispatch(Object(m.Xc)(!0))}},{key:"freezeInstrument",value:function(){Object(y.a)(this.sequencerEngine)}},{key:"makeInstrument",value:function(){var e=Object(f.a)(l.a.mark(function e(){var t,n,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.sequencerEngine.addSampledInstrumentTrack(),e.t0=l.a.keys(this.sequencerEngine.tracks);case 2:if((e.t1=e.t0()).done){e.next=10;break}if(n=e.t1.value,!(r=this.sequencerEngine.tracks[n].sample)){e.next=8;break}return e.next=8,t.instrument.newSample(void 0,r);case 8:e.next=2;break;case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"pack",value:function(){this.sequencerEngine.dispatch(Object(m.ab)(!0))}},{key:"track",get:function(){return this.sequencerEngine.getSelectedTrack()}}]),e}(),g=n(11),O=n(44),k=500;function j(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;t.cursor.step;w(t)&&function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.getSelectedStepData(),r=new Set;for(;n.on;)if(r.add(n.id),t?e.right(!1):e.left(!1),n=e.getSelectedStepData(),r.has(n.id))return void e.cursor.updateRedux();e.cursor.updateRedux()}(t,e),x(t,e)}function w(e){var t=e.cursor.getStep(e.resolution);return e.getSelectedTrack().getEasyPattern().getStepsAtStepNumber(t,e.resolution).map(function(e){return e.step}).some(function(e){return e.on})}function x(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.getSelectedStepData(),r=new Set,a=0;!n.on;)if(a++,r.add(n.id),t?e.right(!1):e.left(!1),n=e.getSelectedStepData(),r.has(n.id)||a>k)return void e.cursor.updateRedux();e.cursor.updateRedux()}var S=n(1);function P(e){for(var t=e.getSelectedStep()%e.resolution.numSteps(),n=0;n<t;n++)e.left(!1);e.cursor.updateRedux()}function E(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.resolution.numSteps(),r=0;r<n;r++)e.right(!1);t&&e.cursor.updateRedux()}function T(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.resolution.numSteps(),r=0;r<n;r++)e.left(!1);e.cursor.updateRedux(),t&&e.cursor.updateRedux()}var A=500;function M(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];w(e)||x(e);for(var n=e.getSelectedTrack(),r=n.getEasyPattern(),a=[],i=new Set,s=0;w(e);){s++;var o=e.getSelectedStepData();if(i.has(o)||s>A)return;i.add(o);var c=e.cursor.getStep(e.resolution),u=r.getStepsAtStepNumber(c,e.resolution).map(function(t){return Object(S.a)({},t,{stepNumber:e.cursor.step})});a=[].concat(Object(g.a)(a),Object(g.a)(u)),e.right()}var l=C(a);return t&&e.operationManager.dispatch(Object(O.j)(n,a.map(function(e){return e.step}))),l}function R(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];P(e);for(var n=e.resolution.numSteps(),r=e.resolution.getNumberOfStepsAtBaseResolution(),a=[],i=e.getSelectedTrack(),s=i.getEasyPattern(),o=e.cursor.step,c=0;c<n;c++){var u=s.getStepsAtStepNumber(o).map(function(e){return Object(S.a)({},e,{stepNumber:o})});a=[].concat(Object(g.a)(a),Object(g.a)(u)),o+=r}var l=C(a);return t&&e.operationManager.dispatch(Object(O.j)(i,a.map(function(e){return e.step}))),l}function C(e){var t=[];for(var n in e)t.push(Object(S.a)({},e[n],{step:e[n].step.getCopy(!0,!1,!0,!1,!1)}));return t}var N=function(){function e(t){var n=this;Object(s.a)(this,e),this.sequencerEngine=t,this.cursor=t.cursor,this.currentCommand=void 0,this.number=void 0,this.killRing=[],this[0]=function(){n.zero()}}return Object(o.a)(e,[{key:"run",value:function(e){e in this&&(this.currentCommand&&this.number?(this[e](parseInt(this.number)),this.number=void 0,this.currentCommand=void 0):(this[e](),this.currentCommand=e)),Object(p.a)(e)&&(void 0===this.number&&(this.number=""),this.number+=e)}},{key:"d",value:function(e){if(e=void 0===e?1:e,"d"==this.currentCommand){this.killRing=[];for(var t=0;t<e;t++)this.killRing=[].concat(Object(g.a)(this.killRing),Object(g.a)(R(this.sequencerEngine))),E(this.sequencerEngine,!1);for(var n=0;n<e;n++)T(this.sequencerEngine,!1);this.updateRedux(),this.currentCommand=void 0}}},{key:"x",value:function(){this.killRing=function(e){var t=e.getSelectedTrack();if(w(e)){var n=e.getSelectedStepData(),r=e.cursor.step,a=C([{stepNumber:r,step:n}]);return e.operationManager.dispatch(Object(O.i)(t,r)),a}return[]}(this.sequencerEngine)}},{key:"w",value:function(e){if("d"!=this.currentCommand)if("y"!=this.currentCommand){e=void 0===e?1:e-1;for(var t=0;t<e;t++)j(!0,this.sequencerEngine)}else{e=void 0===e?1:e,this.killRing=[];for(var n=0;n<e;n++)this.killRing=[].concat(Object(g.a)(this.killRing),Object(g.a)(M(this.sequencerEngine,!1)));this.currentCommand=void 0}else{e=void 0===e?1:e,this.killRing=[];for(var r=0;r<e;r++)this.killRing=[].concat(Object(g.a)(this.killRing),Object(g.a)(M(this.sequencerEngine)));this.currentCommand=void 0}}},{key:"b",value:function(e){e=void 0===e?1:e-1;for(var t=0;t<e;t++)j(!1,this.sequencerEngine)}},{key:"h",value:function(){this.sequencerEngine.left()}},{key:"l",value:function(){this.sequencerEngine.right()}},{key:"j",value:function(){E(this.sequencerEngine)}},{key:"k",value:function(){T(this.sequencerEngine)}},{key:"t",value:function(){this.dispatch(Object(O.r)(this.track,this.stepNumber,this.resolution))}},{key:"e",value:function(){this.cursor.show=!this.cursor.show}},{key:"zero",value:function(){P(this.sequencerEngine)}},{key:"a",value:function(){this.track.doubleTrackLength()}},{key:"s",value:function(){this.track.halfTrackLength()}},{key:"o",value:function(){!function(e){var t=h(e,e.cursor.step);for(var n in t){var r=t[n].duration||1;t[n].duration=r+1}e.getSelectedTrack().updateSteps()}(this.sequencerEngine)}},{key:"i",value:function(){!function(e){var t=h(e,e.cursor.step);for(var n in t){var r=t[n].duration||1;t[n].duration=Math.max(1,r-1)}e.getSelectedTrack().updateSteps()}(this.sequencerEngine)}},{key:"y",value:function(e){if(e=void 0===e?1:e,"y"==this.currentCommand){this.killRing=[];for(var t=0;t<e;t++)this.killRing=[].concat(Object(g.a)(this.killRing),Object(g.a)(R(this.sequencerEngine,!1))),E(this.sequencerEngine,!1);for(var n=0;n<e;n++)T(this.sequencerEngine,!1);this.updateRedux(),this.currentCommand=void 0}}},{key:"p",value:function(){!function(e,t){var n=e.getSelectedTrack(),r=e.cursor.step,a=Math.min.apply(Math,Object(g.a)(t.map(function(e){return e.stepNumber})));t=t.map(function(e){return Object(S.a)({},e,{stepNumber:r+e.stepNumber-a})});var i=e.operationManager;t.forEach(function(e){return i.dispatch(Object(O.c)(n,e.step.getCopy(!0,!1,!0,!1,!1),e.stepNumber))}),n.updateSteps()}(this.sequencerEngine,Object(g.a)(this.killRing))}},{key:"stepNumber",get:function(){return this.sequencerEngine.getSelectedStep()}},{key:"track",get:function(){return this.sequencerEngine.getSelectedTrack()}},{key:"op",get:function(){return this.sequencerEngine.operationManager}},{key:"dispatch",value:function(e){this.op.dispatch(e)}},{key:"resolution",get:function(){return this.sequencerEngine.resolution}},{key:"updateRedux",value:function(){this.cursor.updateRedux()}}]),e}(),q=n(217),I=n(571),_=n(272),D=n(922);function F(){return(F=Object(f.a)(l.a.mark(function e(t,n,r){var a,i,s,o,c,u,f,h,p,d,v,y,b,g,O,k,j=arguments;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=j.length>3&&void 0!==j[3]?j[3]:t.getSelectedTrack(),i=j.length>4?j[4]:void 0,void 0!==a){e.next=4;break}return e.abrupt("return");case 4:if(s=L(n),o=s.effectName,c=s.parameters,!(o in q.b)){e.next=15;break}return e.next=8,q.b[o](t);case 8:return u=e.sent,f=r||z(t),!i&&f&&"Effect Rack"===f.name?(f.addEffect(u),h=Object(I.a)(200,200,f),p=h.x,d=h.y,u.x=p,u.y=d):(a.effects.push(u),t.selectEffect(u)),u.enable(!0),a.updateEffects(),B(u,c),e.abrupt("return",u);case 15:if(!(o in _.b)){e.next=22;break}return v=_.b[o](a),(y=r||z(t))&&"Midi Effect Rack"===y.name?(b=Object(I.a)(200,200,y),g=b.x,O=b.y,y.addEffect(v),v.x=g,v.y=O):(a.midiEffects.addEffect(v),t.selectEffect(v)),v.enabled=!0,B(v,c),e.abrupt("return",v);case 22:if(!(o in D.b)){e.next=29;break}return k=D.b[o](a),a.liveEffects.addEffect(k),k.enabled=!0,t.store.dispatch(Object(m.kd)(k.id)),B(k,c),e.abrupt("return",k);case 29:case"end":return e.stop()}},e)}))).apply(this,arguments)}function L(e){return e.includes("[")?{effectName:e.slice(0,e.indexOf("[")),parameters:function(e){for(var t=[],n="",r="",a=!0,i=!1,s=0;s<e.length;s++){var o=e.charAt(s);if("="!=o){if(a)n+=o;else if(i){if(" "==o){t.push({parameter:n,value:r}),i=!1,a=!0,n="",r="";continue}r+=o}}else a=!1,i=!0}""!==n&&t.push({parameter:n,value:r});return t}(e=e.includes("]")?e.slice(e.indexOf("[")+1,e.indexOf("]")):e.slice(e.indexOf("[")+1))}:{effectName:e,parameters:[]}}function B(e,t){var n=function(n){var r=t[n],a=r.parameter,i=r.value,s=a.split(" ").join(""),o=e.parameters.find(function(e){return e.name.toLowerCase()===a.toLowerCase()||e.name.toLowerCase()===s.toLowerCase()});if(void 0===o)return"continue";if(i.includes("%")){i=parseFloat(i.slice(0,i.indexOf("%")));var c=o.max-o.min;o.set(c*(i/100))}else i=parseFloat(i),o.set(i)};for(var r in t)n(r)}var z=function(e){if(void 0!==e.state.effects.selectedEffect)return e.selectedEffect};function J(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var s=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return Object(a.a)(this,n)}}var V=function(){function e(t){Object(s.a)(this,e),this.sequencerEngine=t,this.emacsScripting=new b(this.sequencerEngine),this.viScripting=new N(this.sequencerEngine),this.cursor=t.cursor,this.clipboard=[],this.cmd={},this.stepFunctions={},this.stepTimes={},this.commandHistory=[],this.historyCounter=0,this.futureCalls=[]}return Object(o.a)(e,[{key:"viCommand",value:function(e){var t=void 0!==this.viScripting.currentCommand;return this.viScripting.run(e),t}},{key:"emacsCommand",value:function(e){this.emacsScripting.run(e)}},{key:"isEmacsCommand",value:function(){return"M-x"===this.sequencerEngine.state.commands.commandPrefix}},{key:"runScript",value:function(e){if(this.isEmacsCommand())return this.emacsScripting.run(e),!0;try{if(this.commandHistory.push({cursor:this.cursor.getJson(),command:e,enabled:!0}),e.startsWith("/"))this.search(e.slice(1));else if(e.startsWith("+"))this.addCommand(e.slice(1));else{if(e.startsWith(":"))return this.emacsScripting.run(e.slice(1));t=this,new Function("with(this) { "+e+"}").call(t)}return this.historyCounter=0,!0}catch(n){return void 0!==this.onFlashInfo&&this.onFlashInfo(n.message),!1}var t}},{key:"runEmacsCommand",value:function(e){}},{key:"search",value:function(e){var t=e.endsWith("/");t&&(e=e.slice(0,e.length-1));var n=e.split("+");this.sequencerEngine.searchForSounds(n,t)}},{key:"addCommand",value:function(e){!function(e,t,n){F.apply(this,arguments)}(this.sequencerEngine,e)}},{key:"getJson",value:function(){return{commandHistory:this.commandHistory.filter(function(e){return e.enabled})}}},{key:"fromJson",value:function(e){for(var t=e.commandHistory,n=0;n<t.length;n++){var r=null;if("string"===typeof t[n])this.cursor.step=0,this.cursor.track=0,r=t[n];else if("cursor"in t[n]){var a=t[n].cursor;this.cursor.step=a.step,this.cursor.track=a.track,r=t[n].command}this.runScript(r)}}},{key:"recordMix",value:function(e){this.sequencerEngine.recordingMix=e}},{key:"slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.sequencerEngine.getSelectedTrack().getSamplers()[0];return new c(t,e)}},{key:"midiFX",value:function(){var e=this;this.sequencerEngine.getSelectedTrack(),this.sequencrerEngine.midiEffects;return function(){e.sequencerEngine.getSelectedTrack()}}},{key:"left",value:function(){this.sequencerEngine.left()}},{key:"right",value:function(){this.sequencerEngine.right()}},{key:"up",value:function(){this.sequencerEngine.up()}},{key:"down",value:function(){this.sequencerEngine.down()}},{key:"arp",value:function(e){this.sequencerEngine.getSelectedTrack().trackData.arpOn=e}},{key:"arpRate",value:function(e,t){this.sequencerEngine.getSelectedTrack()}},{key:"arpOctaves",value:function(e){this.sequencerEngine.getSelectedTrack().trackData.arpOctaves=e}},{key:"steps",value:function(e){var t=this.sequencerEngine.getSelectedTrack(),n=t.getStepsAtResolution(this.sequencerEngine.resolution);void 0===e&&(e=n.length),e+this.sequencerEngine.getSelectedStep()>=n.length&&(e-=e+this.sequencerEngine.getSelectedStep()-n.length);var r=this.sequencerEngine.getSelectedStep();return new H(this.sequencerEngine,t,n.slice(r,r+e),r)}},{key:"copy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.clipboard=this.steps(e).map(function(e){return e.getCopy()}),this.clipboard[0]}},{key:"paste",value:function(){for(var e=this.steps(this.clipboard.length).stepDataList,t=0;t<e.length;t++)e[t].copyFrom(this.clipboard[t]);this.sequencerEngine.getSelectedTrack().syncBuckets(this.sequencerEngine.resolution),this.sequencerEngine.getSelectedTrack().updateSteps()}},{key:"rand",value:function(){return Math.random()}},{key:"onStepReached",value:function(e){if(e in this.stepFunctions){try{this.stepFunctions[e].map(function(e){return e()})}catch(t){void 0!==this.onFlashInfo&&this.onFlashInfo(t.message)}this.stepTimes[e]++}}},{key:"stepFunction",value:function(e){var t=this,n=this.steps().get(0),r=(this.sequencerEngine.getSelectedTrack(),this.cursor.step),a=function(){e(n,t.stepTimes[r])};r in this.stepFunctions?this.stepFunctions[r].push(a):(this.stepFunctions[r]=[a],this.stepTimes[r]=0)}},{key:"volume",value:function(e){this.sequencerEngine.getSelectedTrack().setRawVolume(e)}},{key:"start",value:function(){this.cursor.step=0}},{key:"end",value:function(){var e=this.sequencerEngine.getTrackLength();this.cursor.setStep(e-1,this.sequencerEngine.resolution)}},{key:"line",value:function(e){var t=this;this.steps(e).map(function(){t.right()})}},{key:"clearStepFunctions",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=0;t<e;t++){var n=this.cursor.step+t;delete this.stepFunctions[n]}}},{key:"pattern",value:function(e){this.sequencerEngine.switchToPattern(e)}},{key:"clearSequence",value:function(){this.sequencerEngine.clearSequence()}},{key:"clear",value:function(){this.sequencerEngine.getSelectedTrack().pattern.clear()}},{key:"upHistory",value:function(){var e=this.commandHistory.length-this.historyCounter-1,t=this.commandHistory[e];return this.historyCounter=Math.min(this.historyCounter+1,this.commandHistory.length),void 0===t?"":t.command}},{key:"downHistory",value:function(){return this.historyCounter--,this.historyCounter<=0?(this.historyCounter=0,""):this.commandHistory[this.commandHistory.length-this.historyCounter].command}},{key:"deleteHistoryForTrack",value:function(e){for(var t=[],n=0;n<this.commandHistory.length;n++)this.commandHistory[n].cursor.track!=e&&t.push(this.commandHistory[n]);this.commandHistory=t}},{key:"currentStep",get:function(){return this.sequencerEngine.trackStep}},{key:"map",value:function(e){this.sequencerEngine.stepNumberScript=e}},{key:"phi",get:function(){return 1.61803398875}},{key:"com",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=e,r=t.length-1;r>=0;r--)n=t[r](n);return n}}}]),e}();var H=function(e){Object(r.a)(n,e);var t=J(n);function n(e,r,a,i){var o,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return Object(s.a)(this,n),(o=t.call(this,e)).stepDataList=a,o.step=i,o.stepOffset=c,o.track=r,o}return Object(o.a)(n,[{key:"filter",value:function(e){return new n(this.sequencerEngine,this.track,this.stepDataList.filter(e),this.step)}},{key:"isOn",value:function(){return this.filter(function(e){return e.on})}},{key:"sync",value:function(){this.sequencerEngine.getSelectedTrack().syncBuckets(this.sequencerEngine.resolution),this.track.updateSteps()}},{key:"get",value:function(e){return this.stepDataList[e]}},{key:"even",value:function(){for(var e=[],t=0;t<this.stepDataList.length;t+=2)e.push(this.stepDataList[t]);return new n(this.sequencerEngine,this.track,e,this.step,2*this.stepOffset)}},{key:"odd",value:function(){for(var e=[],t=1;t<this.stepDataList.length;t+=2)e.push(this.stepDataList[t]);var r=this.sequencerEngine.resolution.transformStepAtBaseResolution(1);return new n(this.sequencerEngine,this.track,e,this.step+r,2*this.stepOffset)}},{key:"stepFunction",value:function(e){var t=this;this.do(function(){return t.sequencerEngine.scripting.stepFunction(e)})}},{key:"do",value:function(e){var t=this.sequencerEngine.cursor,n=t.step,r=this.step;for(var a in this.stepDataList)t.step=r,e(),r+=this.sequencerEngine.resolution.transformStepAtBaseResolution(this.stepOffset);t.step=n}},{key:"on",get:function(){return this.map(function(e){return e.on})},set:function(e){this.map(function(t,n){return t.on="function"===typeof e?e(n):e}),this.sync()}},{key:"duration",get:function(){return this.map(function(e){return e.duration})},set:function(e){this.map(function(t,n){return t.duration="function"===typeof e?e(n):e}),this.sync()}},{key:"chop",get:function(){return this.map(function(e){return e.chop})},set:function(e){this.map(function(t,n){return t.chop="function"===typeof e?e(n):e}),this.sync()}},{key:"velocity",get:function(){return this.map(function(e){return e.velocity})},set:function(e){this.map(function(t,n){return t.velocity="function"===typeof e?e(n):e}),this.sync()}},{key:"transpose",get:function(){return this.map(function(e){return e.transpose})},set:function(e){this.map(function(t,n){return t.transpose="function"===typeof e?e(n):e}),this.sync()}},{key:"attack",get:function(){return this.map(function(e){return e.attack})},set:function(e){this.map(function(t,n){return t.transpose="function"===typeof e?e(n):e}),this.sync()}},{key:"release",get:function(){return this.map(function(e){return e.release})},set:function(e){this.map(function(t,n){return t.transpose="function"===typeof e?e(n):e}),this.sync()}},{key:"map",value:function(e){var t=this.stepDataList.map(e);return this.sync(),t}}]),n}(V);t.a=V},,function(e,t,n){"use strict";var r=n(11),a=n(42),i=n.n(a),s=n(56),o=n(4),c=n(5),u=(n(125),n(409),n(153)),l=function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"month",type:"uint32"},{name:"year",type:"uint32"}],name:"newMonthlyIndex",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"month",type:"uint32"},{indexed:!0,name:"year",type:"uint64"}],name:"NewMonthlyIndex",type:"event"}],this.contractAddress="0xfaa21e766f988524d3f38b9c46c22aca11d76dd5"},f=n(214),h=n(158),p=n(118),d=n(122),v=new l,m=function(){function e(){Object(o.a)(this,e),this.indexContract=new h.a.eth.Contract(v.abi,v.contractAddress),this.indexContractAddress=this.indexContract.options.address}return Object(c.a)(e,[{key:"getIndexForMonth",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new f.a(this.indexContractAddress).from(p.w).select("hash").where("month",t).where("year",n).executeQuery();case 2:if(r=e.sent,console.log("got the results for monthly = "),console.log(r),void 0!==r&&0!==r.length){e.next=7;break}return e.abrupt("return");case 7:return a=r[0].hash,e.next=10,d.a.getJson(a);case 10:return s=e.sent,e.abrupt("return",s);case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function y(e){var t=void 0;for(var n in e){var r=e[n];void 0!==r&&(t=void 0!==t?b(t,r):r)}return t}function b(e,t){var n={};for(var r in e){var a=e[r],i=t[r];for(var s in n[r]={},a){var o=a[s],c=i[s];n[r][s]=g(o,c)}}return n}function g(e,t){var n=O(e),a=O(t),i={};for(var s in n)i[s]=s in a?[].concat(Object(r.a)(n[s]),Object(r.a)(a[s])):n[s];for(var o in a)o in n||(i[o]=n[o]);return function(e){return Object.keys(e).map(function(t){return{dimension:t,values:e[t]}})}(i)}function O(e){var t={};for(var n in e){var r=e[n];t[r.dimension]=r.values}return t}var k=n(139),j=function(){function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32",name:"ipfsHash",type:"bytes32"}],name:"newIndex",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!1,internalType:"bytes32",name:"indexHash",type:"bytes32"}],name:"NewIndex",type:"event"}],this.contractAddress="0xefBe8bf3720fE3aD117B1397DD95c77240Fe8837"}return Object(c.a)(e,[{key:"getContract",value:function(e){return console.log("getting contract w address = "+this.contractAddress),new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),w=(n(181),new j),x=new m,S={},P=function(){function e(t){var n=this;Object(o.a)(this,e),this.fullIndex=void 0,this.guildId=0,this.useMonth=!1,this.monthlyIndices=[],this.monthlyFilter=void 0,this.store=t,t&&this.store.subscribe(function(){return n.onStateUpdate()})}return Object(c.a)(e,[{key:"onStateUpdate",value:function(){var e=this.store.getState(),t=e.guilds.selectedGuild?e.guilds.selectedGuild.guildId:0;t!==this.guildId&&(this.guildId=t,this.loadIndex())}},{key:"loadNewIndex",value:function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.guildId=t,e.next=3,this.loadIndex();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"index",get:function(){return this.useMonth?void 0===this.monthlyIndex?this.fullIndex:this.monthlyIndex.index:this.fullIndex}},{key:"toBlock",get:function(){return this.monthlyIndex.toBlock}},{key:"fromBlock",get:function(){return this.monthlyIndex.fromBlock}},{key:"filterByMonth",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.monthlyFilter&&this.monthlyFilter.month===t&&this.monthlyFilter.year===n){e.next=4;break}return e.next=3,x.getIndexForMonth(t,n);case 3:this.monthlyIndex=e.sent;case 4:return this.useMonth=!0,this.monthlyFilter={month:t,year:n},e.abrupt("return",!0);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearFilter",value:function(){this.useMonth=!1}},{key:"loadIndex",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=n.length>0&&void 0!==n[0]?n[0]:this.guildId)||!u.a.isLoggedIn()){e.next=6;break}return e.next=4,this.fetchAndMergeIndices();case 4:return this.fullIndex=e.sent,e.abrupt("return");case 6:return e.next=8,this.fetchIndex(t);case 8:this.fullIndex=e.sent;case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchAndMergeIndices",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r,a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[0],n=Array.from(new Set(t.map(function(e){return e.guildId}))),r=[],e.t0=i.a.keys(n);case 4:if((e.t1=e.t0()).done){e.next=14;break}return a=e.t1.value,s=n[a],e.t2=r,e.next=10,this.fetchIndex(s);case 10:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=4;break;case 14:return e.abrupt("return",y(r));case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchIndex",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:this.guildId,e.next=3,this.getIndexHash(t);case 3:if(void 0!==(n=e.sent)){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.next=9,d.a.getJson(n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getAllForField",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(void 0===this.index)return[];var r=this.index[e][e].map(function(e,t){return{value:e.dimension,rank:t}});return this.sort(r),r.length<t+n?r.slice(t):r.slice(t,t+n)}},{key:"getFieldsForField",value:function(e,t,n){if(void 0===this.index)return new Set([]);var a=this.index[t][e].filter(function(e){return e.dimension==n});if(0==a.length)return new Set([]);if(void 0===a[0].values)return new Set;var i=Object(r.a)(a[0].values).map(function(e,t){return{value:e,rank:t}});return this.sort(i),new Set(i)}},{key:"freeTextSearch",value:function(e,t){var n=this.getAllForField(e,0,5e3);return n=n.filter(function(e){return e.value.toString().toLowerCase().includes(t.toLowerCase())}).map(function(e,t){return{value:e.value,rank:e.rank}})}},{key:"sort",value:function(e){return e.sort(function(e,t){return e=e.value,t=t.value,void 0===e[0]?1:void 0===t[0]?-1:e[0]===e[0].toLocaleLowerCase()&&t[0]===t[0].toLocaleLowerCase()||e[0]===e[0].toLocaleUpperCase()&&t[0]===t[0].toLocaleUpperCase()?e.localeCompare(t):e[0]===e[0].toLocaleLowerCase()?-1:1})}},{key:"getIndexHash",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in S)){e.next=4;break}return e.next=3,S[t];case 3:return e.abrupt("return",e.sent);case 4:return n=new Promise(function(){var e=Object(s.a)(i.a.mark(function e(n,r){var a,s,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new k.a(w.contractAddress).from(p.t).select("indexHash").where("guildId",t).limit(1),e.next=3,a.executeQuery();case 3:if(0!==(s=e.sent).length){e.next=7;break}return n(void 0),e.abrupt("return");case 7:o=s[0].indexHash,n(o);case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),S[t]=n,e.next=8,n;case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}();t.a=P},function(e,t,n){"use strict";var r=n(1),a=n(107),i=n(11),s=n(4),o=n(5),c=n(31),u=n(10),l=n(6),f=n(8),h=n(2),p=n(164),d=n(141),v=n(129),m=n(126),y=n(119),b=(n(235),1),g={1:[0,2,4,5,7,9,11],2:[0,2,3,5,7,8,10],3:[0,2,3,5,7,8,11]},O=n(157),k=(n(432),n(14)),j=n(135),w=n(595),x=n(272),S=n(311),P=n(353),E=n(312),T=n(307);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var M=n(360),R=n(142);function C(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return N(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}window.voicingTimes=[],window.flowTimes=[],window.networkBuildTimes=[];function I(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var F=function(e){Object(l.a)(n,e);var t=D(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Chords Rack",e,8)).initializeConfigurations(r.adjacencyLists),r.addChords(),r.initializeChordParameters(),r}return Object(o.a)(n,[{key:"addChords",value:function(){this.addEffect(new T.b(this,1)),this.addEffect(new T.b(this,2)),this.addEffect(new T.b(this,3)),this.addEffect(new T.b(this,4)),this.addEffect(new T.b(this,5)),this.addEffect(new T.b(this,6)),this.addEffect(new T.b(this,7)),this.addEffect(new T.b(this,0)),this.addEffect(new T.f(this,1)),this.addEffect(new T.f(this,3)),this.addEffect(new T.f(this,5)),this.effects[0].x=40,this.effects[0].y=47,this.effects[1].x=120,this.effects[1].y=18,this.effects[2].x=220,this.effects[2].y=16,this.effects[3].x=303,this.effects[3].y=43,this.effects[4].x=244,this.effects[4].y=76,this.effects[5].x=167,this.effects[5].y=99,this.effects[6].x=91,this.effects[6].y=86,this.effects[7].x=21,this.effects[7].y=145,this.effects[8].x=6,this.effects[8].y=200,this.effects[9].x=61,this.effects[9].y=200,this.effects[10].x=125,this.effects[10].y=200,this.connectNodes(this.effects[7],this.effects[8]),this.connectNodes(this.effects[7],this.effects[9]),this.connectNodes(this.effects[7],this.effects[10])}},{key:"clear",value:function(){this.counter=0,this.effects.forEach(function(e){return e.clear()}),this.triggers=[]}},{key:"isRack",get:function(){return!0}},{key:"clearCaching",value:function(){this.effects.forEach(function(e){e.subGraph=void 0,e.effects=void 0})}},{key:"addEffect",value:function(e){Object(u.a)(Object(h.a)(n.prototype),"addEffect",this).call(this,e),this.clearCaching(),e.rack=this}},{key:"connectNodes",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(u.a)(Object(h.a)(n.prototype),"connectNodes",this)).call.apply(e,[this].concat(r)),this.clearCaching()}},{key:"deleteEdge",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(u.a)(Object(h.a)(n.prototype),"deleteEdge",this)).call.apply(e,[this].concat(r)),this.clearCaching()}},{key:"deleteEffect",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(u.a)(Object(h.a)(n.prototype),"deleteEffect",this)).call.apply(e,[this].concat(r)),this.clearCaching()}},{key:"getJson",value:function(){return this.getRackJson()}},{key:"fromJson",value:function(e,t,a,i){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t;this.adjacencyLists={},this.initializeConfigurations(this.adjacencyLists,!1),this.effects=[],this.loaded=!1;var o=Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,e,t),c=e.effects;for(var l in c){var f=c[l],p=Object(x.a)(f,this.track);if(o=Object(r.a)({},o,p.fromJson(f,s)),p.id!==f.id){var d,v=I(e.configurations);try{for(v.s();!(d=v.n()).done;){var m=d.value,y=m[f.id];m[p.id]=y,delete m[f.id]}}catch(b){v.e(b)}finally{v.f()}}this.addEffect(p,!1),p.x=f._x||f.x,p.y=f._y||f.y}return this.fromRackJson(e,t),this.loaded=!0,o}}]),n}(Object(w.a)(function(e){return function(e){Object(l.a)(n,e);var t=q(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getAdjacentTransforms",value:function(e){return(this.adjacencyLists[e.id]||[]).map(function(e){return e.effect}).filter(function(e){return e.getChordEffectType()===T.e})}},{key:"getAdjacentVoices",value:function(e){var t=this.getChord(0),n=this.getChord(e),r=this.adjacencyLists[t.id]||[],a=this.adjacencyLists[n.id]||[];return[].concat(Object(i.a)(r),Object(i.a)(a)).map(function(e){return e.effect}).filter(function(e){return e.getChordEffectType()===T.d})}},{key:"getChordElements",value:function(e){return this.getAdjacentVoices(e).map(function(e){return e.degree})}},{key:"getChordVoicing",value:function(e){var t,n=[],r=C(this.getAdjacentVoices(e));try{for(r.s();!(t=r.n()).done;){var a=t.value,i=this.getAdjacentTransforms(a);0===i.length?n.push(0):n.push(i[0].value)}}catch(s){r.e(s)}finally{r.f()}return n}},{key:"getFlowChordVoicing",value:function(e){var t=this;return function(n,r,a){if(!n)return[];var s,o,c=(new Date).getTime(),u=e(),l=t.getChord(u);if(l.subGraph)s=l.subGraph,o=l.effects;else{s={},o=[];var f=function(e){var n=t.effects.find(function(t){return t.id===e}),r=e;if(n.getChordEffectType()===T.a&&0===n.numeral)r=l.id;else if(n.getChordEffectType()===T.a&&n!==l)return"continue";var a=t.adjacencyLists[e].filter(function(e){return e.effect.getChordEffectType()!==T.a});s[r]?s[r]=[].concat(Object(i.a)(s[r]),Object(i.a)(a)):s[r]=a,o=[].concat(Object(i.a)(o),[n],Object(i.a)(a.map(function(e){return e.effect})))};for(var h in t.adjacencyLists)f(h);var p,d=C(o);try{for(d.s();!(p=d.n()).done;){var v=p.value;s[v.id]&&0!==s[v.id].length||(s[v.id]=[new M.a(t.outputNode,t.track.sequencerEngine)])}}catch(W){d.e(W)}finally{d.f()}l.subGraph=s,l.effects=o}t.effects.forEach(function(e){return e.active=!1});var m=l;n.voices=[];var y=new R.a(n,a,r);t.effects.forEach(function(e){e.onNewStep(),e.triggers.length=0}),window.networkBuildTimes.push((new Date).getTime()-c),l.input(y);var b=(new Date).getTime(),g=t.runFlow(a,r,r,m,[y],s),O=(new Date).getTime();window.flowTimes.push(O-b);var k,j={},w=C(g);try{for(w.s();!(k=w.n()).done;){var x,S=k.value,P=S.time,E=C(S.stepData.voices);try{for(E.s();!(x=E.n()).done;){var A=x.value,N=A.voice,q=A.octave,I=A.flat,_=A.thick,D=N+P;I&&(D+="+flat"+I),_&&(D+="+thick"+_),isNaN(q)||(D+="+"+q),j[D]={octave:q,time:P,voice:N,flat:I,thick:_}}}catch(W){E.e(W)}finally{E.f()}}}catch(W){w.e(W)}finally{w.f()}var F=[];for(var L in j){var B=j[L],z=B.time,J=B.octave,V=B.voice,H=B.flat,U=B.thick;F.push({voice:V,octave:J,time:z,flat:H,thick:U})}F.sort(function(e,t){return e.voice-t.voice});var G=(new Date).getTime();return window.voicingTimes.push(G-c),F}}},{key:"getStep",value:function(e){var t=this.cachedSteps[this.cacheIndex];return this.cacheIndex=(this.cacheIndex+1)%this.cachedSteps.length,t.voices=Object(i.a)(e.voices),t}}]),n}(e)}(function(e){Object(l.a)(n,e);var t=A(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"initializeChordParameters",value:function(){this.progressionStartParameter=new k.b("progressionStart",this,function(){return 0},{defaultValue:1,min:1,max:7}),this.registerParameter(this.progressionStartParameter)}},{key:"getChord",value:function(e){return this.effects.find(function(t){return t.numeral===e})}},{key:"getStartingChord",value:function(){return this.progressionStartParameter.get()}},{key:"getPossibleNextEffects",value:function(e){var t=this.getChord(e);return(this.adjacencyLists[t.id]||[]).map(function(e){return e.effect}).filter(function(e){return e.getChordEffectType()===T.a})}},{key:"getPossibleNextChords",value:function(e){return this.getPossibleNextEffects(e).map(function(e){return e.numeral})}},{key:"getNextChordEffect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.getPossibleNextEffects(e),r=this.getChord(e);return void 0!==r.nextChords[t]?r.nextChords[t]:n[0]||this.getChord(1)}},{key:"getNextChord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getNextChordEffect(e,t).numeral}}]),n}(Object(S.a)(Object(P.a)(Object(E.a)(j.a))))))),L=(n(207),n(434),n(314),n(435)),B=(n(436),n(248)),z=n(277),J=(n(437),n(176),n(163)),V=n(111),H=n(191);n(147);function U(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}n.d(t,"a",function(){return G}),window.chordTimes=[];Object(B.h)(Object(H.f)("- - . -"),Object(H.f)("- . - -"),Object(H.f)(". - - -"),Object(H.f)("- - - .")),Object(B.h)(Object(H.f)("- - ."),Object(H.f)("- . -"),Object(H.f)(". - -"));var G=function(e){Object(l.a)(n,e);var t=U(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Generative Chords",e)).chordProgression=new F(e,Object(c.a)(r)),r.progressionLengthParameter=new k.b("progressionLength",Object(c.a)(r),function(){return[]},{defaultValue:4,min:1,max:16}),r.registerParameter(r.progressionLengthParameter),r.currentChord=1,r.tidalString=". - . -",r.expressionSeries=[13,11,9,7],r.scaleParameter=new k.b("scale",Object(c.a)(r),function(){return[]},{defaultValue:b,min:1,max:3}),r.registerParameter(r.scaleParameter),r.connectedJakiEffect=void 0,r.newInlet(v.i),r.newInlet(v.g,function(){return r.reset()}),r.newOutlet(v.b),r}return Object(o.a)(n,[{key:"reset",value:function(){this.position=void 0}},{key:"getParameters",value:function(){return[].concat(Object(i.a)(this.parameters),Object(i.a)(this.chordProgression.getParameters()))}},{key:"tidalString",get:function(){return this._tidalString},set:function(e){this.tidalPattern=Object(H.f)(e)(),this._tidalString=e}},{key:"getNoteDegree",value:function(e){e=Object(O.a)(e,12);var t=this.shifted_scale().indexOf(e);return t%2===0?t+1:t+8}},{key:"getCurrentChordNotes",value:function(){return[]}},{key:"scale",get:function(){return this.scaleParameter.get()},set:function(e){this.scaleParameter.set(e,!1)}},{key:"progressionLength",get:function(){return this.progressionLengthParameter.get()}},{key:"getPossibleNextChords",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentChord;return this.chordProgression.getPossibleNextChords(e)}},{key:"getNextChord",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentChord,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.position;return this.chordProgression.getNextChord(e,t)}},{key:"chordElements",get:function(){var e=this;return this.chordProgression.getFlowChordVoicing(function(){return e.currentChord})}},{key:"output",value:function(){for(var e,t=(new Date).getTime(),r=this.triggers.length>0,a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];var o=(e=Object(u.a)(Object(h.a)(n.prototype),"output",this)).call.apply(e,[this].concat(i)),c=(new Date).getTime();return r&&window.chordTimes.push(c-t),o}},{key:"clear",value:function(){var e=this;this.tidals&&this.tidals.forEach(function(e){return e.clear()}),this.freeTidals(),this.chordProgression.clear(),this.position=void 0;this.shifted_scale=Object(z.d)(function(){if(e.isInletConnected(v.i)){var t=e.receiveMessage(v.i);if(t[0]){var n=Object(a.a)(t[0],1)[0];return e._scale=n,n}if(e._scale)return e._scale}return g[e.scale]},function(){return e.currentChord-1});var t=0;this.myScript=Object(J.a)(function(e){return e&&(t=e.transpose),Object(V.w)(!0)},function(){return(arguments.length<=0?void 0:arguments[0])&&(void 0===e.position?(e.position=0,e.currentChord=e.chordProgression.getStartingChord(),e.sendMessage(v.b)):(e.position++,e.position>=e.progressionLength?(e.position=0,e.currentChord=e.chordProgression.getStartingChord(),e.sendMessage(v.b)):e.currentChord=e.getNextChord())),Object(V.w)(!0)},Object(L.b)(this.shifted_scale,this.chordElements,function(){return t}))}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}},{key:"fromJson",value:function(e){var t=Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,e);return Object(y.a)(this.scaleParameter,e.scale,t),t=Object(r.a)({},t,Object(m.a)(e,"scaleParameter",this.scaleParameter)),Object(y.a)(this.progressionLengthParameter,e.progressionLength,t),t=Object(r.a)({},t,Object(m.a)(e,"progressionLengthParameter",this.progressionLengthParameter)),e.chordProgression&&(this.chordProgression.effects=[],t=Object(r.a)({},t,this.chordProgression.fromJson(e.chordProgression))),t}},{key:"getJson",value:function(){return Object(r.a)({},Object(u.a)(Object(h.a)(n.prototype),"getJson",this).call(this),{chordProgression:this.chordProgression.getJson()})}}]),n}(Object(d.a)(p.a))},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(1),s=n(56),o=n(4),c=n(5),u=n(6),l=n(8),f=n(2),h=n(7),p=n.n(h),d=n(122),v=n(79),m=n(227),y=n(11),b=n(31),g=(n(112),n(23)),O=n(217);function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var j=n(190),w=n(119),x=n(126),S=n(14);function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var E=function(e){Object(u.a)(n,e);var t=P(n);function n(e,r){var a;Object(o.a)(this,n),(a=t.call(this)).initialBulkValues={},a.formants=e,a.oscillator=e.oscillator;var i=a.oscillator.context.getCopy();return i.forFormant(Object(b.a)(a)),i.forSubDevice(Object(b.a)(a)),i.forTrack(a.oscillator.track),a.context=i,a.number=r,a.parameters=[],a.name="Formant "+r,a.enabled=!1,a.setup(),a.sequencerEngine.dispatch(Object(g.ub)(a.initialBulkValues)),a}return Object(c.a)(n,[{key:"sequencerEngine",get:function(){return this.oscillator.sequencerEngine}},{key:"registerParameter",value:function(e,t){this.initialBulkValues=Object(i.a)({},this.initialBulkValues,e.setStore(this.oscillator.store)),e.setMixSession(this.oscillator.mixSession);var n=this.oscillator.context.getCopy();n.forFormant(this),n.forSubDevice(this),n.forTrack(this.oscillator.track),this.context=n,e.setContext(n),e.setTrack(this.oscillator.context.track),this.parameters.push(e),this.oscillator.parameters.push(e)}},{key:"input",get:function(){return this.formants.input}},{key:"output",get:function(){return this.formants.output}},{key:"initialize",value:function(){this.formantFilter||this.formantGain||(this.formantFilter=new p.a.Filter(this.formantFrequencyParameter.get(!0),this.formantType,this.rolloff),this.formantGain=this.formantFilter.output,this.setAudioParams()),this.input.chain(this.formantFilter,this.output),this.enabled=!0}},{key:"isEnabled",get:function(){return this.enabledParameter.get()}},{key:"bypass",value:function(){this.enabled&&(this.formantFilter&&this.formantGain&&(this.input.disconnect(this.formantFilter),this.formantGain.disconnect()),this.enabled=!1)}},{key:"setup",value:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(this.enabledParameter=new S.a("Formant "+(this.number+1)+" Enabled",this,function(t,n){e.enable(n)},{documentation:["When enabled, a formant filter is applied to the operator"],min:0,max:1,defaultValue:!1,automatable:!1}),this.registerParameter(this.enabledParameter),this.formantFrequencyParameter=new j.a("Formant Frequency "+(this.number+1),void 0,{min:16,max:2e4,unit:"",defaultValue:1e3*(this.number+1)}),this.registerParameter(this.formantFrequencyParameter),this.formantQParameter=new j.a("Formant Q "+(this.number+1),void 0,{min:0,documentation:["Ratio between this operator`'s frequency, and the frequency of the inputed note.","Ex: A ratio of 2 is an octave above the inputed note"],max:80,unit:"",defaultValue:20}),this.registerParameter(this.formantQParameter),this.formantGainParameter=new j.a("Formant Gain "+(this.number+1),void 0,{min:0,documentation:["Ratio between this operator`'s frequency, and the frequency of the inputed note.","Ex: A ratio of 2 is an octave above the inputed note"],max:4,unit:"",defaultValue:.5}),this.registerParameter(this.formantGainParameter),this.formantRolloffParameter=new S.a("Formant Rolloff "+(this.number+1),this,function(t,n){return e.rolloff=n},{defaultValue:-12,min:-48,max:-12,automatable:!1}),this.registerParameter(this.formantRolloffParameter),this.formantTypeParameter=new S.a("Formant Type "+(this.number+1),this,function(t,n){return e.formantType=n},{defaultValue:"bandpass",min:-48,max:-12,automatable:!1}),this.registerParameter(this.formantTypeParameter))}},{key:"formantType",get:function(){return this.formantTypeParameter?this.formantTypeParameter.get():"bandpass"},set:function(e){this.formantFilter&&(this.formantQParameter.max="lowpass"===e?12:this.formantQParameter.originalMax,this.formantFilter.type=e)}},{key:"rolloff",get:function(){return this.formantRolloffParameter?this.formantRolloffParameter.get():-12},set:function(e){this.formantFilter&&(this.formantFilter.rolloff=e)}},{key:"enable",value:function(e){e&&!this.formants.anyFormantsOn()?this.formants.enableFormants():1===this.formants.numFormants()&&!e&&this.enabled&&this.formants.disableFormants(),e?this.initialize():this.bypass()}},{key:"refreshParameters",value:function(){this.formantFrequencyParameter.set(this.formantFrequencyParameter.get(!0)),this.formantGainParameter.set(this.formantGainParameter.get(!0)),this.formantQParameter.set(this.formantQParameter.get(!0))}},{key:"setAudioParams",value:function(){this.formantQParameter.setAudioParams([this.formantFilter.Q]),this.formantFrequencyParameter.setAudioParams([this.formantFilter.frequency]),this.formantGainParameter.setAudioParams([this.formantGain.gain])}},{key:"removeAudioParams",value:function(e,t){this.formantQParameter.removeAudioParams([this.formantFilter.Q]),this.formantFrequencyParameter.removeAudioParams([this.formantFilter.frequency]),this.formantGainParameter.removeAudioParams([this.formantGain.gain]),this.formantQParameter.disableKeyScaling(),this.formantFrequencyParameter.disableKeyScaling(),this.formantGainParameter.disableKeyScaling()}},{key:"getJson",value:function(e){var t={enabled:this.enabledParameter.get(!0),frequency:this.formantFrequencyParameter.get(!0),q:this.formantQParameter.get(!0),gain:this.formantGainParameter.get(!0),effect:this.effect&&this.effect.getJson(),rolloff:this.rolloff,formantType:this.formantType};return t=Object(x.b)(t,"enabledParameter",this.enabledParameter,void 0,e),t=Object(x.b)(t,"formantFrequencyParameter",this.formantFrequencyParameter,void 0,e),t=Object(x.b)(t,"formantQParameter",this.formantQParameter,void 0,e),t=Object(x.b)(t,"formantGainParameter",this.formantGainParameter,void 0,e),t=Object(x.b)(t,"formantTypeParameter",this.formantTypeParameter,void 0,e)}},{key:"fromJson",value:function(e,t){var n={};if(e.rolloff&&Object(w.a)(this.formantRolloffParameter,e.rolloff,n),this.formantFilter&&(this.formantFilter.rolloff=this.rolloff),Object(w.a)(this.enabledParameter,e.enabled,n),this.enabledParameter.get(!0)){Object(w.a)(this.formantFrequencyParameter,e.frequency,n),Object(w.a)(this.formantQParameter,e.q,n),Object(w.a)(this.formantGainParameter,e.gain,n),e.formantType?Object(w.a)(this.formantTypeParameter,e.formantType,n):Object(w.a)(this.formantTypeParameter,"bandpass",n);(new Date).getTime();e.effect?this.loadEffectFromJson(e.effect):this.bypassEffect();(new Date).getTime();return n=Object(i.a)({},n,Object(x.a)(e,"formantFrequencyParameter",this.formantFrequencyParameter,this.sequencerEngine,t,!0)),n=Object(i.a)({},n,Object(x.a)(e,"formantQParameter",this.formantQParameter,this.sequencerEngine,t,!0)),n=Object(i.a)({},n,Object(x.a)(e,"formantTypeParameter",this.formantTypeParameter,this.sequencerEngine,t,!0)),n=Object(i.a)({},n,Object(x.a)(e,"formantGainParameter",this.formantGainParameter,this.sequencerEngine,t,!0))}this.bypassEffect()}},{key:"disconnectParameters",value:function(){}},{key:"ripMods",value:function(){}},{key:"isConnectedToAnyModulator",value:function(){return this.formantGainParameter.isConnectedToAnyModulator()||this.formantFrequencyParameter.isConnectedToAnyModulator()||this.formantQParameter.isConnectedToAnyModulator()}},{key:"dispose",value:function(){this.formantFilter&&this.formantGain&&(this.parameters.forEach(function(e){return e.dispose(!0)}),this.formantFilter.dispose(),this.formantFilter=void 0),this.effect&&(this.effect.dispose(),this.effect=void 0)}},{key:"getParameters",value:function(){var e=Object(y.a)(this.parameters);return this.effect&&(e=[].concat(Object(y.a)(e),Object(y.a)(this.effect.getParameters()))),e}}]),n}(function(e){Object(u.a)(n,e);var t=k(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).effect=void 0,e}return Object(c.a)(n,[{key:"useEffect",value:function(e){this.effect&&this.effect.dispose(),this.effect=e,this.effect.registerContext(this.context),this.formantGain.disconnect(),this.formantGain.connect(this.effect.effectNode),this.effect.connect(this.output)}},{key:"bypassEffect",value:function(){this.effect&&(this.effect.parameters,this.effect.dispose(),this.effect=void 0,this.formantGain.disconnect(),this.formantGain.connect(this.output))}},{key:"loadEffectFromJson",value:function(){var e=Object(s.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.effect||t.name!==this.effect.name){e.next=4;break}this.effect.fromJson(t,[],0),e.next=9;break;case 4:return this.effect&&this.bypassEffect(),e.next=7,Object(O.a)(t,[],this.sequencerEngine,void 0,this.context);case 7:n=e.sent,this.useEffect(n.effect);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),n}(function(){return function e(){Object(o.a)(this,e)}}())),T=8,A=function(){function e(t){Object(o.a)(this,e),this.oscillator=t,this.input=new p.a.Gain(.3),this.output=new p.a.Gain(1),this.analyser=new p.a.Analyser("fft",256),this.input.connect(this.output),this.output.connect(this.analyser),this.bypassConnected=!0,this.formants=[];for(var n=0;n<T;n++)this.formants.push(new E(this,n))}return Object(c.a)(e,[{key:"dispose",value:function(){this.formants.forEach(function(e){return e.dispose()}),this.input.dispose(),this.output.dispose(),this.analyser.dispose(),this.input=void 0,this.output=void 0,this.analyser=void 0}},{key:"anyFormantsOn",value:function(){return this.formants.some(function(e){return e.enabled})}},{key:"numFormants",value:function(){return this.formants.filter(function(e){return e.enabled}).length}},{key:"enableFormants",value:function(){this.bypassConnected&&(this.input.disconnect(this.output),this.bypassConnected=!1)}},{key:"disableFormants",value:function(){this.bypassConnected||(this.input.connect(this.output),this.bypassConnected=!0)}}]),e}();function M(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var N=n(125).a.presets;t.a=function(e){return function(e){Object(u.a)(n,e);var t=C(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"loadFormantsPreset",value:function(){var e=Object(s.a)(a.a.mark(function e(t){var n,r,s,o,c,u,l,f,h,p,y,b,O,k,j,w,x,S,P;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.contentHash,e.next=3,d.a.getJson(n);case 3:if(r=e.sent,Array.isArray(r)&&(r={formants:r}),this.preset=new m.a,this.preset.contentHash=n,!(s=this.instrument)){e.next=16;break}return o=s.ampEnvelope.release,s.ampEnvelope.release=100,s.clearVoiceData(),s.loaded=!1,s.track.trackIsLoading=!0,e.next=16,Object(v.a)(100);case 16:if(c={},u=s?s.track.lfosTrack:this.sequencerEngine.currentSubSequence.lfosTrack,l=s?s.track.envelopesTrack:this.sequencerEngine.currentSubSequence.envelopesTrack,r.lfos){f=0,h=M(u.lfos);try{for(h.s();!(p=h.n()).done;)y=p.value,b=y.lfo,c=Object(i.a)({},c,b.fromJson(r.lfos[f++],!0))}catch(a){h.e(a)}finally{h.f()}}if(!r.envelopes){e.next=41;break}O=0,k=M(l.envelopes),e.prev=23,k.s();case 25:if((j=k.n()).done){e.next=33;break}if(w=j.value,x=w.envelope,!window.sporeEditor||0!==O){e.next=30;break}return e.abrupt("continue",31);case 30:c=Object(i.a)({},c,x.fromJson(r.envelopes[O++],!0));case 31:e.next=25;break;case 33:e.next=38;break;case 35:e.prev=35,e.t0=e.catch(23),k.e(e.t0);case 38:return e.prev=38,k.f(),e.finish(38);case 41:for(S=0;S<this.formants.length;S++)P=this.formants[S],c=Object(i.a)({},c,P.fromJson(r.formants[S],!0));(s?s.track:this.track).sequencerEngine.dispatch(Object(g.ub)(c)),s&&(s.loaded=!0,s.track.trackIsLoading=!1,s.ampEnvelope.release=o);case 45:case"end":return e.stop()}},e,this,[[23,35,38,41]])}));return function(t){return e.apply(this,arguments)}}()},{key:"saveFormantsAsPreset",value:function(e){var t=this,n={envelopes:this.instrument.track.envelopesTrack.envelopes.map(function(e){return e.getJson()}),lfos:this.instrument.track.lfosTrack.lfos.map(function(e){return e.getJson()}),formants:this.formantsManager.formants.map(function(e){return e.getJson(!0)})};N.newPreset(n,e,void 0,"formants",0).then(function(n){t.preset=new m.a,t.preset.contentHash=n,t.preset.name=e})}},{key:"formants",get:function(){return this.formantsManager.formants}},{key:"setupFormants",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.formantsManager=new A(this)}},{key:"initializeFormants",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.voices}},{key:"copyFormants",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},{key:"voiceHasFormant",value:function(e){return void 0!==e.formantFilters}},{key:"destroyFormants",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],!(arguments.length>1&&void 0!==arguments[1])||arguments[1],!(arguments.length>2&&void 0!==arguments[2])||arguments[2]}},{key:"getFormantsJson",value:function(e){return this.formants.map(function(t){return t.getJson(e)})}},{key:"loadFormantsJson",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;if(this.formants.forEach(function(e){return e.ripMods()}),p.a.Master.context.isOffline){var r={};for(var a in e)r=Object(i.a)({},r,this.formants[a].fromJson(e[a],t));return r}var s={},o=[];for(var c in e)o.push(this.formants[c]),n/100>=Math.random()&&(s=Object(i.a)({},s,this.formants[c].fromJson(e[c],t)));return this.formants.filter(function(e){return!o.includes(e)}).forEach(function(e){e.bypassEffect(),e.bypass()}),s}}]),n}(e)}},function(e,t,n){"use strict";var r=n(1),a=n(42),i=n.n(a),s=n(56),o=n(4),c=n(5),u=n(515),l=n.n(u),f=n(215),h=n(153),p=n(23),d=n(516),v=n(125),m=function(){function e(t){Object(o.a)(this,e),this.store=t,this.masterKey=void 0,this.masterPublicKey=void 0,this.promptingPassword=!1}return Object(c.a)(e,[{key:"needsPassword",value:function(){return void 0===this.masterPublicKey}},{key:"password",set:function(e){void 0!==e&&(this.masterKey=l.a.generateRSAKey(e,1024),this.masterPublicKey=l.a.publicKeyString(this.masterKey),h.a.getAccount().then(function(t){window.isNFT||f.a.setItem("user_password."+t,e)}))}},{key:"isCorrectPassword",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r,a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.encryption.getPublicKey();case 2:if(void 0!==(n=e.sent)){e.next=5;break}return e.abrupt("return",!0);case 5:return r=l.a.generateRSAKey(t,1024),a=l.a.publicKeyString(r),s=n===a,e.abrupt("return",s);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"syncPassword",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.masterPublicKey){e.next=4;break}return e.next=3,this.getPassword();case 3:this.password=e.sent;case 4:t=this.getPublicKeyAsBytes32(),v.a.encryption.newPublicKey(t);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPublicKeyAsBytes32",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.masterPublicKey,t=v.a.web3.utils.toHex(e);return Object(d.a)(t)}},{key:"sleep",value:function(e){return new Promise(function(e,t){e()},e)}},{key:"getPassword",value:function(){var e=this;return this.passwordPromise?this.passwordPromise:(this.passwordPromise=new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){var a,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===e.masterPublicKey){t.next=3;break}return n(void 0),t.abrupt("return");case 3:return t.next=5,h.a.getAccount();case 5:if(a=t.sent,window.isNFT||null===f.a.getItem("user_password."+a)){t.next=12;break}if(s=f.a.getItem("user_password."+a),!e.isCorrectPassword(s)){t.next=12;break}return e.password=s,n(s),t.abrupt("return");case 12:e.store.dispatch(Object(p.Fc)(function(t){void 0!==t?(e.password=t,n(t)):e.passwordPromise=void 0})),e.store.dispatch(Object(p.Md)(!0));case 14:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()),this.passwordPromise)}},{key:"getPublicKeyIfNeeded",value:function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=6;break}if(void 0!==this.masterPublicKey){e.next=5;break}return e.next=4,this.getPassword();case 4:this.password=e.sent;case 5:t=this.masterPublicKey;case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPrivateKeyIfNeeded",value:function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=6;break}if(void 0!==this.masterKey){e.next=5;break}return e.next=4,this.getPassword();case 4:this.password=e.sent;case 5:t=this.masterKey;case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),y=n(569),b=n(517),g=n.n(b),O=n(122),k=function(){function e(t,n){Object(o.a)(this,e),this.ethereum=t,this.web3=this.ethereum.web3,this.passwordManager=new m(n),this.store=n}return Object(c.a)(e,[{key:"store",set:function(e){this.passwordManager.store=e}},{key:"needsPassword",value:function(){return this.passwordManager.needsPassword()}},{key:"password",set:function(e){this.passwordManager.password=e}},{key:"syncPassword",value:function(){var e=Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.passwordManager.syncPassword();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isCorrectPassword",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.passwordManager.isCorrectPassword(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPassword",value:function(){var e=Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.passwordManager.getPassword();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"masterPublicKey",get:function(){return this.passwordManager.masterPublicKey},set:function(e){this.passwordManager.masterPublicKey=e}},{key:"masterKey",get:function(){return this.passwordManager.masterKey}},{key:"parseGuildKey",value:function(e){var t=e.privateKey,n=l.a.RSAKey.parse(JSON.stringify(t));return Object(r.a)({},e,{privateKey:n})}},{key:"generateGuildKey",value:function(e){var t=l.a.generateRSAKey(e,1024),n=l.a.publicKeyString(t),r=this.ethereum.web3.utils.toHex(n);return{publicKey:Object(d.a)(r),rawPublicKey:n,privateKey:t,passphrase:e}}},{key:"encryptAndSave",value:function(e,t,n){var r=this;!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Promise(function(){var a=Object(s.a)(i.a.mark(function a(o,c){var u,l,f;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,r.passwordManager.getPublicKeyIfNeeded(r.masterPublicKey);case 2:if(a.sent,(u=new y.a).encryptKey(r.masterPublicKey),!n){a.next=10;break}return a.next=8,r.ethereum.encryption.getEncryptedSequenceIfAny(n);case 8:void 0!==(l=a.sent)&&l[0].contentKey&&(u=new y.a(g.a.utils.hex.toBytes(u)));case 10:return a.next=12,u.encryptContent(JSON.stringify(t));case 12:f=a.sent,O.a.addJson(f).then(function(){var t=Object(s.a)(i.a.mark(function t(a){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=r.ethereum.encryption,t.t1=n,t.t2=a,t.next=5,u.encryptContent(e);case 5:t.t3=t.sent,t.t4=u.convertForEthereum(),t.t5=r.passwordManager.getPublicKeyAsBytes32(),t.t0.newEncryptedSequence.call(t.t0,t.t1,t.t2,t.t3,t.t4,t.t5),o(a);case 10:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 14:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"encryptRawContent",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:this.masterPublicKey,a=o.length>3&&void 0!==o[3]&&o[3],s=o.length>4?o[4]:void 0,e.next=5,this.passwordManager.getPublicKeyIfNeeded(r);case 5:return r=e.sent,void 0===s&&(s=new y.a),s.encryptKey(r),e.t0=this.passwordManager.getPublicKeyAsBytes32(r),e.t1=s.convertForEthereum(),e.t2=s,e.next=13,s.encryptContent(t,a);case 13:return e.t3=e.sent,e.next=16,s.encryptContent(n);case 16:return e.t4=e.sent,e.t5=s.encryptedContentKey,e.abrupt("return",{publicKey:e.t0,encryptedContentKey:e.t1,contentKey:e.t2,encryptedContent:e.t3,encryptedName:e.t4,eCk:e.t5});case 19:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"encryptAndUploadJSON",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.masterPublicKey;return new Promise(function(){var r=Object(s.a)(i.a.mark(function r(a,s){var o;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.encryptRawContent(JSON.stringify(e),"",n);case 2:o=r.sent,O.a.addJson(o.encryptedContent).then(function(e){return a({publicKey:o.publicKey,encryptedContentKey:o.encryptedContentKey,encryptedContentIpfsHash:e,contentKey:o.contentKey})});case 4:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"decryptName",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n,r){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t&&void 0!==t){e.next=2;break}return e.abrupt("return","");case 2:return e.next=4,this.passwordManager.getPrivateKeyIfNeeded(r);case 4:return r=e.sent,g.a.utils.hex.toBytes(t),e.next=8,this.decryptContentKey(n,r);case 8:if(void 0!==(a=e.sent)){e.next=11;break}return e.abrupt("return","");case 11:return e.next=13,a.decryptContent(t);case 13:return t=e.sent,e.abrupt("return",t);case 15:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"decryptContentKey",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.passwordManager.getPrivateKeyIfNeeded(n);case 2:if(n=e.sent,r=this.web3.utils.toAscii("0x"+t),"failure"!==(a=l.a.decrypt(r,n)).status){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.abrupt("return",new y.a(a.plaintext));case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchAndDecrypt",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s,o,c,u,l=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>2&&void 0!==l[2]&&l[2],a=l.length>3?l[3]:void 0,new Date,void 0!==n.length&&(n=n[0]),s=n.contentKey,!r){e.next=11;break}return e.next=8,O.a.getSound(t);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,O.a.getJson(t,void 0,a,!0);case 13:e.t0=e.sent;case 14:return o=e.t0,e.next=17,this.passwordManager.getPrivateKeyIfNeeded();case 17:return c=new y.a(s),e.next=20,c.decryptContent(o,r);case 20:return u=e.sent,e.abrupt("return",u);case 22:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"stripHexPrefix",value:function(e){return 0===e.indexOf("0x")?e.slice(2):e}},{key:"strip",value:function(e,t){return e.slice(0,e.length-t)}},{key:"getPublicKeyFromBytes32",value:function(e){var t="0x";for(var n in e)t+=this.stripHexPrefix(e[n]);return t=this.strip(t,38),this.ethereum.web3.utils.toAscii(t)}},{key:"shareSequence",value:function(e,t){var n=this;return new Promise(function(){var r=Object(s.a)(i.a.mark(function r(a,s){var o,c;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.ethereum.encryption.getPublicKey(t);case 2:if(void 0!==(o=r.sent)){r.next=6;break}return s("User has no public key"),r.abrupt("return");case 6:c=l.a.encrypt(e.contentKey,o).cipher,c=n.web3.utils.toHex(c),n.ethereum.encryption.shareEncryptedContent(t,e.id,Object(d.a)(c),n.passwordManager.getPublicKeyAsBytes32()),a();case 10:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}}]),e}();t.a=k},function(e,t,n){"use strict";var r=n(1),a=n(42),i=n.n(a),s=n(56),o=n(4),c=n(5),u=n(513),l=n(920),f=n(797),h=(n(262),n(155)),p=n(146),d=n(122),v=n(148);function m(e,t){var n=new Set,r=Array.from(e);for(var a in r)t.has(r[a])&&n.add(r[a]);return n}var y=n(139),b=n(118),g=n(158),O=(window.web3,new u.a),k=g.a.utils.padLeft("0x0",64),j=function(){function e(t,n,r){Object(o.a)(this,e),this.web3=t,this.contract=new t.eth.Contract(O.abi,O.contractAddress),this.crypto=n,this.guilds=r,this.queryDecryptor=new f.a(this.crypto)}return Object(c.a)(e,[{key:"getPresetData",value:function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=4;break}return e.next=3,d.a.getJson(t);case 3:return e.abrupt("return",e.sent);case 4:if(0!==t.guildId&&null!==t.guildId&&void 0!==t.guildId){e.next=8;break}return e.next=7,d.a.getJson(t.contentHash);case 7:return e.abrupt("return",e.sent);case 8:return e.t0=JSON,e.next=11,this.crypto.fetchAndDecrypt(t.contentHash,t);case 11:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPresetTitle",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new y.a(this.contract.options.address).from(b.A).select("encryptedName").where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(r=e.sent).length){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",this.web3.utils.toAscii("0x"+r[0].encryptedName));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newPreset",value:function(e,t,n,r,a){var o=this;O.getContract(g.a);return Object(l.a)(),new Promise(function(){var c=Object(s.a)(i.a.mark(function s(c,u){var l,f,m,y,b;return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(l=void 0,f=new Array(9).fill(k),m=new Array(6).fill(k),0===a){i.next=18;break}return i.next=6,o.guilds.getGuildKey(a);case 6:return y=i.sent,i.next=9,o.crypto.encryptRawContent(JSON.stringify(e),t,y.rawPublicKey);case 9:return b=i.sent,i.next=12,d.a.addJson(b.encryptedContent);case 12:l=i.sent,t=o.web3.utils.padLeft("0x"+b.encryptedName,64),f=b.encryptedContentKey,m=y.publicKey,i.next=22;break;case 18:return t=o.web3.utils.fromAscii(t),i.next=21,d.a.addJson(e);case 21:l=i.sent;case 22:n=void 0===n?k:Object(v.b)(n),r=void 0===r?k:g.a.utils.fromAscii(r),console.log("newPreset guildId =",a),new h.a(p.h,"newPreset",[Object(v.b)(l),t,n,r,a,f,m]).execute(),c(l);case 27:case"end":return i.stop()}},s)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"tagPreset",value:function(e,t,n){null!==n&&void 0!==n||(n=0);O.getContract(g.a);return new Promise(function(){var r=Object(s.a)(i.a.mark(function r(a,s){var o;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:for(o=t.map(function(e){return g.a.utils.padRight(g.a.utils.fromAscii(e),64)});o.length<4;)o.push(k);o.length>4&&(o=o.slice(0,4)),new h.a(p.h,"tagPreset",[Object(v.b)(e),o,n]).execute().then(function(){return a()});case 4:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getTotalPresets",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new y.a(this.contract.options.address).from(b.A).select("user").select("title").select("contentHash"),e.next=3,t.executeQuery();case 3:return n=e.sent,e.abrupt("return",n.length);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPresets",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPaginatedPresets(0,t,1e3,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPaginatedPresets",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var a,s,o,c,u,l,f,h=this,p=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=p.length>2&&void 0!==p[2]?p[2]:10,s=p.length>3&&void 0!==p[3]?p[3]:0,o=new y.a(this.contract.options.address).from(b.A).select("user").select("encryptedName").select("contentHash").select("encryptedContentKey").select("publicKey").select("guildId").where("guildId",s),e.next=5,o.executeQuery();case 5:if(c=e.sent,this.isFilterEmpty(n)){e.next=10;break}return e.next=9,this.filterPresets(c,n);case 9:c=e.sent;case 10:if(0===s){e.next=28;break}return e.next=13,this.guilds.getGuildKey(s);case 13:u=e.sent,l=[],e.t0=i.a.keys(c);case 16:if((e.t1=e.t0()).done){e.next=25;break}return f=e.t1.value,e.t2=l,e.next=21,this.queryDecryptor.decryptQueryResult(c[f],u.privateKey);case 21:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=16;break;case 25:c=l,e.next=29;break;case 28:c=c.map(function(e){return Object(r.a)({},e,{title:h.web3.utils.toAscii("0x"+e.encryptedName)})});case 29:if(!(c.length<=t+a)){e.next=31;break}return e.abrupt("return",c.slice(t));case 31:return e.abrupt("return",c.slice(t,t+a));case 32:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"isFilterEmpty",value:function(e){for(var t in e.instrumentTypes)if(e.instrumentTypes[t])return!1;for(var n in e.tags)if(e.tags[n])return!1;return!0}},{key:"getPresetSampleHash",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new y.a(this.contract.options.address).from(b.H).select("sampleHash").where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(r=e.sent).length){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",r[0].sampleHash);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPresetInstrumentType",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new y.a(this.contract.options.address).from(b.G).select("instrumentType").where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(r=e.sent).length){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",r[0].instrumentType);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllTags",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r,a,s,o,c=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:0,!this.isFilterEmpty(t)){e.next=5;break}return e.next=4,this.getFilteredTags(void 0,void 0,n);case 4:return e.abrupt("return",e.sent);case 5:return e.next=7,this.getPresets(t,n);case 7:r=e.sent,a=[],e.t0=i.a.keys(r);case 10:if((e.t1=e.t0()).done){e.next=18;break}return s=e.t1.value,e.next=14,this.getTags(r[s].contentHash);case 14:(o=e.sent)&&(a=a.concat(o)),e.next=10;break;case 18:return e.abrupt("return",Array.from(new Set(a)));case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getFilteredTags",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:0,a=new y.a(this.contract.address).from(b.I).where("guildId",r).select("tag"),void 0!==n&&a.where(t,n),e.next=5,a.executeQuery();case 5:return s=(s=e.sent).map(function(e){return e.tag}).filter(function(e){return""!==e}),e.abrupt("return",Array.from(new Set(s)));case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTags",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new y.a(this.contract.address).from(b.I).select("tag").where("contentHash",t),e.next=3,n.executeQuery();case 3:return(r=(r=e.sent).map(function(e){return e.tag}).filter(function(e){return""!==e})).sort(),e.abrupt("return",Array.from(new Set(r)));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"filterPresets",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s,o,c,u,l,f,h,p,d,v,g,O,k;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new Set,a=new Set,!n.instrumentTypes){e.next=15;break}e.t0=i.a.keys(n.instrumentTypes);case 4:if((e.t1=e.t0()).done){e.next=15;break}if(s=e.t1.value,n.instrumentTypes[s]){e.next=8;break}return e.abrupt("continue",4);case 8:return o=new y.a(this.contract.address).from(b.G).select("contentHash").where("instrumentType",s),e.next=11,o.executeQuery();case 11:for(u in c=e.sent)for(f in l=c[u].contentHash,t)t[f].contentHash===l&&r.add(t[f].contentHash);e.next=4;break;case 15:if(!n.tags){e.next=28;break}e.t2=i.a.keys(n.tags);case 17:if((e.t3=e.t2()).done){e.next=28;break}if(h=e.t3.value,n.tags[h]){e.next=21;break}return e.abrupt("continue",17);case 21:return p=new y.a(this.contract.address).from(b.I).select("contentHash").where("tag",h),e.next=24,p.executeQuery();case 24:for(v in d=e.sent)for(O in g=d[v].contentHash,t)t[O].contentHash===g&&a.add(t[O].contentHash);e.next=17;break;case 28:if(0!==r.size){e.next=32;break}return e.abrupt("return",this.convertToPresets(Array.from(a),t));case 32:if(0!==a.size){e.next=34;break}return e.abrupt("return",this.convertToPresets(Array.from(r),t));case 34:return k=Array.from(m(r,a)),e.abrupt("return",this.convertToPresets(k,t));case 36:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"convertToPresets",value:function(e,t){var n=[];for(var r in e)for(var a in t)t[a].contentHash===e[r]&&n.push(t[a]);return n}},{key:"getAllUserAddresses",value:function(){var e=Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=j},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(1),o=n(11),c=n(4),u=n(5),l=function e(){Object(c.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sampleIpfs",type:"bytes32"},{name:"notes",type:"bytes32[32]"},{name:"startTime",type:"uint32"},{name:"endTime",type:"uint32"},{name:"noteSequenceIpfs",type:"bytes32"}],name:"newNoteSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleIpfs",type:"bytes32"},{name:"notes",type:"bytes32[256]"},{name:"startTimes",type:"uint32[8]"},{name:"endTimes",type:"uint32[8]"},{name:"noteSequenceIpfs",type:"bytes32"}],name:"newNoteSequenceLarge",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"noteSequenceIpfs",type:"bytes32"}],name:"NewNoteSequence",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"noteA",type:"bytes32"},{indexed:!0,name:"noteB",type:"bytes32"},{indexed:!1,name:"startTime",type:"uint32"},{indexed:!1,name:"endTime",type:"uint32"},{indexed:!1,name:"remainingNotes",type:"bytes32"}],name:"NewNotesAggregation",type:"event"}],this.contractAddress="0x3edab21966363a5c9d69ba0ed78abc5b9c6007c5"},f=n(214),h=n(339),p=n(122),d=n(118),v=n(171),m=new l,y=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"convertToNotes",value:function(e){return e=e.filter(function(e){return void 0!==e}).filter(function(e){return void 0!==e.pitch}).map(function(e){return{note:v.a.fromTranspose(e.pitch-60).note,startTime:e.startTime,endTime:e.endTime}})}},{key:"getChordsFromSequence",value:function(e,t){var n=this;e.sort(function(e,t){return e.startTime-t.startTime}),e=this.convertToNotes(e);for(var r=[],a=0;a<e.length;a++){var i=e[a],c=Object(o.a)(t),u=[];if(i.note===c[0]){for(var l=a;l<e.length&&0!=c.length;l++){var f=c[0];if(f===e[l].note){c=c.slice(1),u.push(e[l]);for(var h=l,p=l+1;p<e.length&&f==e[p].note;p++)u.push(e[p]),h=p;l=h}else u.push(null)}0==c.length&&r.push(u)}}var d=(r=r.map(function(e){return n.pruneTrailingNulls(e)})).filter(function(e){return e.filter(function(e){return null===e}).length<=.5*e.length}).filter(function(e){return e.length>0}).map(function(e){return{startTime:e[0].startTime,endTime:e[e.length-1].endTime}}).map(function(t){return Object(s.a)({},t,{density:n.calculateDensityForSlice(t,e)})}),v=[],m=function(e){var t=d[e];d.filter(function(e){return t.startTime>e.startTime&&t.endTime<=e.endTime}).length>0||v.push(t)};for(var y in d)m(y);return v}},{key:"calculateDensityForSlice",value:function(e,t){var n=t.filter(function(t){return t.startTime>=e.startTime&&t.startTime<=e.endTime||t.endTime>=e.startTime&&t.endTime<=e.endTime}),r=e.endTime-e.startTime;return n.length/r}},{key:"pruneTrailingNulls",value:function(e){var t=[];for(var n in e){if(e.slice(n).every(function(e){return null===e}))break;t.push(e[n])}return t}},{key:"getNoteSequence",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(new f.a).from(d.x).select("noteSequenceHash").where("sampleHash",t).executeQuery();case 2:if(0!=(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return r=n[0].noteSequenceHash,e.next=8,p.a.getJson(r);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchRankedNotes",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f,h,p,d,v,m,y,b,g,O,k,j,w,x;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.searchNotes(t);case 2:n=e.sent,r=[],e.t0=a.a.keys(n);case 5:if((e.t1=e.t0()).done){e.next=20;break}for(u in i=e.t1.value,s=n[i],o=s.remainingNotes,c=100,t)l=t[u],f=o.slice(u),-1==(h=f.indexOf(l))?c-=1/t.length*200:h>0&&(c-=5*h);if(p=o.length,d=s.startTime/1e3,v=s.endTime/1e3,m=p/(v-d),!(c<80)){e.next=17;break}return e.abrupt("continue",5);case 17:r.push({score:c,density:m,result:s}),e.next=5;break;case 20:r.sort(function(e,t){return e.density-t.density}),y={},e.t2=a.a.keys(r);case 23:if((e.t3=e.t2()).done){e.next=36;break}if(b=e.t3.value,!(r[b].score<=80)){e.next=27;break}return e.abrupt("continue",23);case 27:g=r[b].result,O=g.sampleHash,k=g.remainingNotes,j=g.startTime,w=g.endTime,x={startTime:j,endTime:w,remainingNotes:k},O in y?y[O].push(x):y[O]=[x],e.next=23;break;case 36:return e.abrupt("return",y);case 37:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getStartTimesForSample",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){new f.a(m.contractAddress).from(d.y).select("startTime").where("sampleHash",t).executeQuery().then(function(t){return e(t)})}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchNotes",value:function(e){return new Promise(function(t,n){if(0!=e.length){var r=e.map(function(e){return h.b[e]}),a=new f.a(m.contractAddress).from(d.y).select("sampleHash").select("noteA").select("noteB").select("remainingNotes").select("startTime").select("endTime").where("noteA",r[0]);e.length>1&&(a=a.where("noteB",r[1])),a.executeQuery().then(function(e){return t(e)})}else t()})}}]),e}();t.a=y},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(139),o=n(153),c=n(125),u=n(1),l=n(797),f=n(158),h=function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new l.a(c.a.crypto),0===n){e.next=19;break}return e.next=4,c.a.guilds.getGuildKey(n);case 4:i=e.sent,s=[],e.t0=a.a.keys(t);case 7:if((e.t1=e.t0()).done){e.next=16;break}return o=e.t1.value,e.t2=s,e.next=12,r.decryptQueryResult(t[o],i.privateKey);case 12:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=7;break;case 16:t=s,e.next=20;break;case 19:t=t.map(function(e){return Object(u.a)({},e,{title:f.a.utils.toAscii("0x"+e.encryptedName)})});case 20:return e.abrupt("return",t);case 21:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),p=n(513),d=n(118);function v(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"b",function(){return g}),n.d(t,"a",function(){return j});var y=new p.a,b={},g=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var c,u,l,f,p,m,g,j,w,x,S,P,E,T,A,M,R,C=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=C.length>3&&void 0!==C[3]?C[3]:0,u=C.length>4?C[4]:void 0,l=C.length>5?C[5]:void 0,f=C.length>6?C[6]:void 0,p=C.length>7?C[7]:void 0,m=n+"."+c+"."+l+f,console.log("FROM BLOC=",u),e.abrupt("return",new Promise(function(){var e=Object(i.a)(a.a.mark(function e(t){var r,s,d;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.getAccount();case 2:r=e.sent,s={instrumentType:n,guildId:c,contentHashes:f,user:r,filterFavorites:l,fromBlockNumber:u},p&&(s.searchTerm=p),d=window.spores?"https://zequencer.io/presetSearch":"/presetSearch",console.log("BODY=",s),fetch(d,{method:"POST",body:JSON.stringify(s),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(){var e=Object(i.a)(a.a.mark(function e(n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0==c){e.next=4;break}return e.next=3,h(n,c);case 3:n=e.sent;case 4:t(n);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 13:if(g=e.sent,console.log("preset raw ins results=",g),j=g.map(function(e){return e.contentHash}),f&&(j=j.filter(function(e){return f.includes(e)})),!l){e.next=21;break}return e.next=20,k(j);case 20:j=e.sent;case 21:return w=new s.a(y.contractAddress).from(d.A).select("user").select("encryptedName").select("contentHash").select("encryptedContentKey").select("publicKey").select("guildId").whereIn("contentHash",j).where("guildId",c),u&&w.fromBlock(u),e.next=25,w.executeQuery();case 25:return x=e.sent,e.next=28,h(x,c);case 28:return S=(S=e.sent).filter(function(e){return e.title}),e.next=32,O(S.map(function(e){return e.contentHash}));case 32:P=e.sent,[],E={},T=v(S);try{for(M=function(){var e=A.value;e.tags=Array.from(new Set(P.filter(function(t){return t.contentHash===e.contentHash}).map(function(e){return e.tag}))),E[e.contentHash]=e},T.s();!(A=T.n()).done;)M()}catch(t){T.e(t)}finally{T.f()}return R=Object.values(E),b[m]=R,e.abrupt("return",R);case 40:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),O=function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new s.a(y.contractAddress).from(d.I).select("contentHash").select("tag").whereIn("contentHash",t),e.next=3,n.executeQuery();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.getAccount();case 2:return n=e.sent,e.next=5,c.a.xanadu.getSoundsWithRating(t,5,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),j=function(){return b={}}},function(e,t,n){"use strict";var r=n(107),a=n(1),i=n(4),s=n(5),o=n(10),c=n(6),u=n(8),l=n(2);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var h=function(e){Object(c.a)(n,e);var t=f(n);function n(e){var a;return Object(i.a)(this,n),a=t.call(this,e),e.newAttribute("overflow","visible"),a._scale="Lydian mode",a.newInlet("scale by name",function(e){var t=Object(r.a)(e,1)[0];return a.byName(t)}),a.newInlet("scale by index",function(e){var t=Object(r.a)(e,1)[0];return a.byIndex(t)}),a.newOutlet("integer scale"),a.newOutlet("scale name"),a}return Object(s.a)(n,[{key:"bang",value:function(){this.byName(this._scale)}},{key:"byName",value:function(e){var t=d[e];t&&(this._scale=e,this.sendMessage("integer scale",t),this.sendMessage("scale name",e))}},{key:"byIndex",value:function(e){var t=Object.keys(d),n=t[e%t.length],r=d[n];r&&(this._scale=n,this.sendMessage("integer scale",r),this.sendMessage("scale name",n))}},{key:"fromJson",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];(t=Object(o.a)(Object(l.a)(n.prototype),"fromJson",this)).call.apply(t,[this,e].concat(a)),this._scale=e.scale}},{key:"getJson",value:function(e){for(var t,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return Object(a.a)({},(t=Object(o.a)(Object(l.a)(n.prototype),"getJson",this)).call.apply(t,[this,e].concat(i)),{scale:this._scale})}}]),n}(n(117).a),p=n(109);n.d(t,"a",function(){return d}),n.d(t,"b",function(){return v});var d={"Acoustic scale":[0,2,4,6,7,9,10],"Natural minor scale":[0,2,3,5,7,8,10],"Algerian scale":[0,2,3,6,7,9,11,12,14,15,17],"Super Locrian scale":[0,1,3,4,6,8,10],"Augmented scale":[0,3,4,7,8,11],"Bebop dominant scale":[0,2,4,5,7,9,10,11],"Blues scale":[0,3,5,6,7,10],"Chromatic scale":[0,1,2,3,4,5,6,7,8,9,10,11],"Dorian scale":[0,2,3,5,7,9,10],"Double harmonic scale":[0,1,4,5,7,8,11],"Enigmatic scale":[0,1,4,6,8,10,11],"Flamenco scale":[0,1,4,5,7,8,11],"Gypsy scale":[0,2,3,6,7,8,10],"Half diminished scale":[0,2,3,5,6,8,10],"Harmonic major scale":[0,2,4,5,7,8,11],"Harmonic minor scale":[0,2,3,5,7,8,11],"Hirajoshi scale":[0,4,6,7,11],"Hungarian minor scale":[0,2,3,6,7,8,11],"Hungarian major scale":[0,3,4,6,7,9,10],"In scale":[0,1,5,7,8],"Insen scale":[0,1,5,7,10],"Major scale":[0,2,4,5,7,9,11],"Istrian scale":[0,1,3,4,6,7],"Iwato scale":[0,1,5,6,10],"Locrian scale":[0,1,3,5,6,8,10],"Lydian augmented scale":[0,1,3,5,6,8,10],"Lydian mode":[0,2,4,6,7,9,11],"Major Locrian scale":[0,2,4,5,6,8,10],"Major pentatonic scale":[0,2,4,7,9],"Melodic minor scale":[0,2,3,5,7,9,11],"Minor pentatonic scale":[0,3,5,7,10],"Mixolydian mode":[0,2,4,5,7,9,10],"Neapolitan major scale":[0,1,3,5,7,9,11],"Neapolitan minor scale":[0,1,3,5,7,8,11],"Octatonic scale":[0,2,3,5,6,8,9,11],"Persian scale":[0,1,4,5,6,8,11],"Phyrgian dominant scale":[0,1,4,5,7,8,10],"Phyrgian mode":[0,1,3,5,7,8,10],"Prometheus scale":[0,2,4,6,9,10],"Scale of harmonics":[0,3,4,5,7,9],"Tritone scale":[0,1,4,6,7,10],"Two-semitone tritone scale":[0,1,2,6,7,8],"Ukranian Dorian scale":[0,2,3,6,7,9,10],"Vietnamese scale of harmonics":[0,2.5,3,4,5,7],"Whole tone scale":[0,2,4,6,8,10],"Yo scale":[0,3,5,7,10]};Object(p.a)("scale",{},"search for scales",function(){return 0},{inlets:0});var v=function(e){var t=new h(e);return e.width=220,e.height=30,e.needsLoad=!0,function(e){Object(r.a)(e,1)[0];t.bang()}}},function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(4),s=n(5),o=n(10),c=n(6),u=n(8),l=n(2),f=n(401),h=n(43),p=n(123),d=n(361),v=n(180),m=n(358);function y(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var O=6,k=function(e){Object(c.a)(n,e);var t=g(n);function n(e){var r;Object(i.a)(this,n),(r=t.call(this,"Macros",v.c,e)).macros=[];for(var a=0;a<O;a++)r.newMacro();return r.randomness=15,r}return Object(s.a)(n,[{key:"getParameters",value:function(){return this.macros.map(function(e){return e.macroParameter})}},{key:"newMacro",value:function(){this.macros.push(new d.a("Macro "+(this.numMacros+1),this.track.sequencerEngine,this.context))}},{key:"context",get:function(){return(new p.a).forLiveEffect(this).forTrack(this.track)}},{key:"numMacros",get:function(){return this.macros.length}},{key:"getJson",value:function(){var e=Object(o.a)(Object(l.a)(n.prototype),"getJson",this).call(this);return Object(a.a)({},e,{macros:this.macros.map(function(e){return e.getJson()})})}},{key:"getLFOParameters",value:function(){return[]}},{key:"fromJson",value:function(e){Object(o.a)(Object(l.a)(n.prototype),"fromJson",this).call(this,e),this.ripMods();var t=[].concat(Object(r.a)(this.track.getAllParameters()),Object(r.a)(this.getLFOParameters()));for(var a in this.macros)this.macros[a].fromJson(e.macros[a],t)}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson()),t}},{key:"dispose",value:function(){this.macros.forEach(function(e){return e.unmapAllParameters()}),this.macros=void 0}},{key:"ripMods",value:function(){this.macros.forEach(function(e){return e.ripMods()})}},{key:"generateMappings",value:function(){this.macros.forEach(function(e){return e.unmapAllParameters()});var e=[].concat(Object(r.a)(this.track.effectsChain.getAllParameters()),Object(r.a)(this.track.midiEffects.getAllParameters()),Object(r.a)(this.getLFOParameters()));this.track.instrument&&(e=[].concat(Object(r.a)(e),Object(r.a)(this.track.instrument.getParameters())));var t,n=y(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(!(Math.random()>this.randomness/100||!a.automatable||m.a.includes(a.name))){var i=a.get(!0),s=i+this.randomness/100*Math.random()*(a.max-i);Math.random()<.5&&(s=i-this.randomness/100*Math.random()*(i-a.min));var o=this.macros[Math.floor(Math.random()*this.macros.length)];Object(h.a)(i)&&o.addParameter(a,i,s)}}}catch(c){n.e(c)}finally{n.f()}this.macros.forEach(function(e){return e.macroParameter.set(e.macroParameter.get())})}}]),n}(f.a),j=n(875),w=n(544),x=n(405);n.d(t,"b",function(){return S}),n.d(t,"a",function(){return P});var S={"Roll Effect":function(e){return new w.a(e)},Macros:function(e){return new k(e)},Playhead:function(e){return new x.a(e)}};function P(e,t){return e.effect===v.f?new w.a(t):e.effect===v.c?new k(t):e.effect===v.d?new j.a(t):e.effect===v.e?new x.a(t):void 0}},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),s=n(6),o=n(8),c=n(2),u=n(135),l=n(160),f=(n(136),new Set(["clap","tom","toms","clave","perc","snare","kick","hi-hat","rim","side-stick","breaks","sub","ride","piano","violin"])),h=n(14);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var d=function(e){Object(s.a)(n,e);var t=p(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Midi Outputter",e)).trackOutputParameter=new h.a("trackOutput",Object(i.a)(a),function(e,t){return t},{min:0,max:16,unit:"",defaultValue:void 0}),a.registerParameter(a.trackOutputParameter),a.probabilityParameter=new h.a("probability",Object(i.a)(a),function(e,t){return t},{min:0,max:100,unit:"",defaultValue:100}),a.registerParameter(a.probabilityParameter),a}return Object(a.a)(n,[{key:"documentation",get:function(){return"Routes triggers from this track to another track."}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getAvailableParameters",value:function(){return[this.track.trackData.durationParameter,this.track.trackData.chopParameter,this.track.trackData.velocityParameter,this.track.trackData.transposeParameter,this.track.trackData.attackParameter,this.track.trackData.releaseParameter,this.track.trackData.pitchAttackParameter,this.track.trackData.pitchDecayParameter,this.track.trackData.pitchSustainParameter,this.track.trackData.pitchReleaseParameter]}},{key:"trackOutput",get:function(){return this.trackOutputParameter.get()},set:function(e){this.trackOutputParameter.set(e)}},{key:"probability",get:function(){return this.probabilityParameter.get()},set:function(e){this.probabilityParameter.set(e)}},{key:"getTrack",value:function(){return this.track.subSequence.tracks[Math.round(this.trackOutput)]}},{key:"getVisualizedParameters",value:function(){return[this.trackOutputParameter]}},{key:"getText",value:function(){var e=this.getTrack();if(e)return e.trackNumber+1+". "+function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.sample,r=e.presetName||e.getName();if(n&&n.tags&&((r=n.tags.find(function(e){return f.has(e)}))||(r=n.tags[0]),t&&(r=n.name)),e&&e.getInstrumentType()==l.f&&(r="Synth"),e&&e.getInstrumentType()===l.g){var a=e.instrument.getSamples();a[0]&&a[0].tags&&(r=a[0].tags.find(function(e){return f.has(e)}))}return r}(e)}},{key:"output",value:function(e,t,n){if(Math.random()<this.probability/100&&this.trackOutput){var r=this.track.subSequence.tracks[Math.round(this.trackOutput)];if(void 0===r||r===this.track)return this.triggers;for(var a in r.onNewStep(),this.triggers)r.midiEffects.input(this.getStep(this.triggers[a].stepData,void 0,void 0,!0),this.triggers[a].time,n);var i=r.midiEffects.output(e,t,n);r.otherTriggerCount=i.length,i.forEach(function(e){return r.trigger(e.stepData,e.time)}),r.onStepEnded(e,t)}return this.triggers}}]),n}(u.a);t.a=d},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(31),s=n(10),o=n(6),c=n(8),u=n(2),l=n(135),f=n(310),h=n(275),p=n(14),d=(n(23),"EQ"),v=n(141);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var y=function(e){Object(o.a)(n,e);var t=m(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Conditional Parameters",e)).setupRampParameters(),a.conditionalTypeParameter=new p.a("conditionalType",Object(i.a)(a),function(){return[]},{defaultValue:d}),a.registerParameter(a.conditionalTypeParameter),a.conditionalValueParameter=new p.a("conditionalValue",Object(i.a)(a),function(){return[]},{defaultValue:0}),a.registerParameter(a.conditionalValueParameter),a.thenValueParameter=new p.a("thenValue",Object(i.a)(a),function(){return[]},{defaultValue:0}),a.registerParameter(a.thenValueParameter),a.parametersDisabledParameter.set([0]),a.setupNodeMessaging(),a}return Object(a.a)(n,[{key:"conditionalType",get:function(){return this.conditionalTypeParameter.get(!0)}},{key:"conditionalValue",get:function(){return this.conditionalValueParameter.get(!0)}},{key:"thenValue",get:function(){return this.thenValueParameter.get(!0)}},{key:"fromParameter",get:function(){return this._parameters[0]}},{key:"getText",value:function(){return""}},{key:"stop",value:function(){Object(s.a)(Object(u.a)(n.prototype),"stop",this).call(this)}},{key:"clear",value:function(){Object(s.a)(Object(u.a)(n.prototype),"clear",this).call(this)}},{key:"output",value:function(e,t){return this.track.sequencerEngine.playing?(0===t&&this.resetAtZero&&0!==this.counter&&(this.stop(),this._clear()),0===this.triggers.length?this.triggers:(this.setParameterValues(e),this.triggers)):this.triggers}},{key:"getParameterValueToSet",value:function(e){return this.isConditionMet()?this.thenValue:this.initialParameterValues[e]}},{key:"isConditionMet",value:function(){if(!this.fromParameter)return!1;var e=this.fromParameter.getNumber();switch(this.conditionalType){case"LTE":return e<=this.conditionalValue;case"GTE":return e>=this.conditionalValue;default:return e===this.conditionalValue}}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"shouldSkipParameter",value:function(e){return 0===parseInt(e)}}]),n}(Object(h.a)(Object(f.a)(Object(v.a)(l.a))));t.a=y},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(6),s=n(8),o=n(2),c=n(164),u=n(163),l=(n(206),n(520),n(278),n(1)),f=n(111);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var a=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var p=function(e){Object(i.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Stats",e)).mem={},a.clear(),a}return Object(a.a)(n,[{key:"isRealTime",value:function(){return!0}},{key:"clear",value:function(){this.myScript=Object(u.a)(function(){var e={},t={},n=void 0,r=0,a=void 0;return function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];var c=s[0],u=s[1],h=(s[2],s[3]);return u=h.track.sequencerEngine.trackStep,c&&c.track.length>r&&(r=c.track.length),u%=r,c&&!t[c.track.id]&&(t[c.track.id]={},t[c.track.id][u]=0),n!==u&&(c&&(t[c.track.id][u]=0),e[u]=0),c&&(e[u]++,t[c.track.id][u]++,isNaN(t[c.track.id][u])&&(t[c.track.id][u]=0),e[u]>a&&(a=e[u])),n=u,h.mem=Object(l.a)({},e),h.trackMem=Object(l.a)({},t),h.maxTriggers=a,h.maxLength=r,Object(f.w)(!0)}}())}},{key:"script",get:function(){return this.myScript}},{key:"getCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(r.getJson(),t),r}}]),n}(c.a);t.a=p},function(e,t,n){"use strict";var r=n(1),a=n(4),i=n(5),s=n(10),o=n(6),c=n(8),u=n(2),l=n(116),f=n(119),h=n(7),p=n.n(h),d=(n(112),n(11));function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var m=function(e){Object(o.a)(n,e);var t=v(n);function n(e){var r,i,s;Object(a.a)(this,n);return(s=t.call(this,"Phase Shift Allpass",function(){return new p.a.Gain(1)},e))._bank0=s._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),s._bank1=s._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),s._oneSampleDelay=p.a.context.createIIRFilter([0,1],[1,0]),s.output=new p.a.Gain(1),s.offset90=new p.a.Gain(1),(r=s.effectNode).chain.apply(r,Object(d.a)(s._bank0).concat([s._oneSampleDelay,s.output])),(i=s.effectNode).chain.apply(i,Object(d.a)(s._bank1).concat([s.offset90])),s}return Object(i.a)(n,[{key:"dispose",value:function(){Object(s.a)(Object(u.a)(n.prototype),"dispose",this).call(this),this._bank0.forEach(function(e){return e.disconnect()}),this._bank1.forEach(function(e){return e.disconnect()}),this.output.dispose(),this.offset90.dispose(),this._oneSampleDelay.dispose(),this._bank0=void 0,this._bank1=void 0,this.output=void 0,this.offset90=void 0}},{key:"connect",value:function(e){this.output.connect(e)}},{key:"disconnect",value:function(e){this.output.disconnect(e)}},{key:"_createAllPassFilterBank",value:function(e){return e.map(function(e){var t=[[e*e,0,-1],[1,0,-e*e]];return p.a.context.createIIRFilter(t[0],t[1])})}}]),n}(l.a.Effect),y=n(190);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}n.d(t,"a",function(){return g});var g=function(e){Object(o.a)(n,e);var t=b(n);function n(e){var r;Object(a.a)(this,n),(r=t.call(this,"Freak Shifter",function(){return new p.a.Gain(1)},e)).output=new p.a.Gain(1),r._sine=new p.a.Oscillator(0,"sine"),r._cosine=new p.a.Oscillator(0,"sine"),r._cosine.phase=-90,r.frequencyParameter=new y.a("frequency",[r._sine.frequency,r._cosine.frequency],{defaultValue:1,min:1,max:1e4}),r.registerParameter(r.frequencyParameter),r._sineMultiply=new p.a.Multiply(0),r._cosineMultiply=new p.a.Multiply(0),r._negate=new p.a.Negate,r._add=new p.a.Add,r._phaseShifter=new m(e),r.effectNode.connect(r._phaseShifter.effectNode),r._phaseShifter.offset90.connect(r._cosineMultiply),r._cosine.connect(r._cosineMultiply.input[1]),r._phaseShifter.connect(r._sineMultiply),r._sine.connect(r._sineMultiply.input[1]),r._sineMultiply.connect(r._negate),r._cosineMultiply.connect(r._add),r._negate.connect(r._add.input[1]),r._add.connect(r.output);var i=p.a.Master.context.currentTime+.01;return r._sine.start(i),r._cosine.start(i),r}return Object(i.a)(n,[{key:"connect",value:function(e){this.output.connect(e)}},{key:"disconnect",value:function(e){this.output.disconnect(e)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}},{key:"getJson",value:function(){var e=Object(r.a)({},Object(s.a)(Object(u.a)(n.prototype),"getJson",this).call(this),{frequency:this.frequencyParameter.get(!0)});return e=this.saveParameterToJson(e,"frequencyParameter",this.frequencyParameter)}},{key:"fromJson",value:function(e,t){var a=Object(s.a)(Object(u.a)(n.prototype),"fromJson",this).call(this,e,t);return Object(f.a)(this.frequencyParameter,e.frequency,a),a=Object(r.a)({},a,this.loadParameterFromJson(e,"frequencyParameter",this.frequencyParameter,t))}}]),n}(l.a.Effect)},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(10),s=n(6),o=n(8),c=n(2),u=n(1),l=n(116),f=n(7),h=n.n(f),p=n(112),d=n(126);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var m=function(e){Object(s.a)(n,e);var t=v(n);function n(e,a,i){var s;return Object(r.a)(this,n),(s=t.call(this,e,a,i)).updateInitialValues(),s}return Object(a.a)(n,[{key:"dispose",value:function(){Object(i.a)(Object(c.a)(n.prototype),"dispose",this).call(this)}},{key:"setCompressors",value:function(e){for(var t in this.compressors=[],e)this.compressors.push(new y(t,this.store,e[t]))}},{key:"getJson",value:function(){return Object(u.a)({},Object(i.a)(Object(c.a)(n.prototype),"getJson",this).call(this),{compressors:this.compressors.map(function(e){return e.getJson()})})}},{key:"fromJson",value:function(e,t){var r=Object(i.a)(Object(c.a)(n.prototype),"fromJson",this).call(this,e,t);for(var a in e.compressors){var s=e.compressors[a].name;this.getCompressor(s).fromJson(e.compressors[a],t)}return r}},{key:"getCompressor",value:function(e){return this.compressors.find(function(t){return t.name===e})}}]),n}(l.a.Effect),y=function(){function e(t,n,a){Object(r.a)(this,e),this.name=t,this.store=n,this.compressorNode=a,this.parameters=[],this.thresholdParameter=new p.c("Threshold",this.compressorNode.threshold,{min:-80,max:8,unit:"",defaultValue:0,constantAutomationRate:!0,automatable:!1}),this.registerParameter(this.thresholdParameter),this.ratioParameter=new p.c("Ratio",this.compressorNode.ratio,{min:1,max:24,unit:"",defaultValue:3,constantAutomationRate:!0}),this.registerParameter(this.ratioParameter),this.attackParameter=new p.b("Attack",this.compressorNode.attack,{constantAutomationRate:!0}),this.registerParameter(this.attackParameter),this.releaseParameter=new p.b("Release",this.compressorNode.release,{constantAutomationRate:!0}),this.registerParameter(this.releaseParameter),this.releaseParameter.set(.1),this.kneeParameter=new p.c("Knee",this.compressorNode.knee,{min:0,max:40,unit:"db",defaultValue:1,constantAutomationRate:!0}),this.registerParameter(this.kneeParameter)}return Object(a.a)(e,[{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"getJson",value:function(){var e={name:this.name,threshold:this.thresholdParameter.get(),ratio:this.ratioParameter.get(),attack:this.attackParameter.get(),release:this.releaseParameter.get()};return e=Object(d.b)(e,"thresholdParameter",this.thresholdParameter),e=Object(d.b)(e,"ratioParameter",this.ratioParameter),e=Object(d.b)(e,"attackParameter",this.attackParameter),e=Object(d.b)(e,"releaseParameter",this.releaseParameter)}},{key:"fromJson",value:function(e,t){this.thresholdParameter.set(e.threshold),this.ratioParameter.set(e.ratio),this.attackParameter.set(e.attack),this.releaseParameter.set(e.release),Object(d.a)(e,"thresholdParameter",this.thresholdParameter,t),Object(d.a)(e,"ratioParameter",this.ratioParameter,t),Object(d.a)(e,"attackParameter",this.attackParameter),Object(d.a)(e,"releaseParameter",this.releaseParameter)}}]),e}();function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var g=function(e){Object(s.a)(n,e);var t=b(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,"Multiband Compressor",function(){return new h.a.MultibandCompressor},e)).setCompressors({LOW:a.effectNode.low,MID:a.effectNode.mid,HIGH:a.effectNode.high}),a}return Object(a.a)(n,[{key:"dispose",value:function(){Object(i.a)(Object(c.a)(n.prototype),"dispose",this).call(this)}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(m);t.a=g},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(31),u=n(10),l=n(6),f=n(8),h=n(2),p=n(116),d=(n(167),n(32)),v=n(570);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}"undefined"===typeof AudioWorkletNode&&alert("AudioWorklet is not supported in this browser !");var y=function(e){Object(l.a)(n,e);var t=m(n);function n(e,r,a){var i;Object(s.a)(this,n),(i=t.call(this,e,"b259wf",a)).baseURL=r,i.json=a.processorOptions.json,i.json_object=JSON.parse(i.json),i.parse_ui=function(e,t){for(var n=0;n<e.length;n++)this.parse_group(e[n],t)},i.parse_group=function(e,t){e.items&&this.parse_items(e.items,t)},i.parse_items=function(e,t){for(var n=0;n<e.length;n++)this.parse_item(e[n],t)},i.parse_item=function(e,t){if("vgroup"===e.type||"hgroup"===e.type||"tgroup"===e.type)this.parse_items(e.items,t);else if("hbargraph"===e.type||"vbargraph"===e.type)t.outputs_items.push(e.address);else if("vslider"===e.type||"hslider"===e.type||"button"===e.type||"checkbox"===e.type||"nentry"===e.type){if(t.inputs_items.push(e.address),t.descriptor.push(e),void 0!==e.meta)for(var n=0;n<e.meta.length;n++)void 0!==e.meta[n].midi&&("pitchwheel"===e.meta[n].midi.trim()?t.fPitchwheelLabel.push({path:e.address,min:parseFloat(e.min),max:parseFloat(e.max)}):"ctrl"===e.meta[n].midi.trim().split(" ")[0]&&t.fCtrlLabel[parseInt(e.meta[n].midi.trim().split(" ")[1])].push({path:e.address,min:parseFloat(e.min),max:parseFloat(e.max)}));var r="set"+e.address,a="get"+e.address;r=r.replace(/\/./g,function(e){return e.substr(1,1).toUpperCase()}),a=a.replace(/\/./g,function(e){return e.substr(1,1).toUpperCase()}),t[r]=function(n){t.setParamValue(e.address,n)},t[a]=function(){return t.getParamValue(e.address)}}},i.output_handler=null,i.inputs_items=[],i.outputs_items=[],i.descriptor=[],i.fPitchwheelLabel=[],i.fCtrlLabel=new Array(128);for(var o=0;o<i.fCtrlLabel.length;o++)i.fCtrlLabel[o]=[];i.parse_ui(i.json_object.ui,Object(c.a)(i)),i.port.onmessage=i.handleMessage.bind(Object(c.a)(i));try{i.parameters&&i.parameters.forEach(function(e){return e.automationRate="k-rate"})}catch(u){}return i}return Object(o.a)(n,[{key:"handleMessage",value:function(e){var t=e.data;this.output_handler&&this.output_handler(t.path,t.value)}},{key:"destroy",value:function(){this.port.postMessage({type:"destroy"}),this.port.close()}},{key:"getJSON",value:function(){return this.json}},{key:"getMetadata",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){var n=""===t.baseURL?"main.json":t.baseURL+"/main.json";fetch(n).then(function(e){return e.json()}).then(function(t){e(t)})}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"setParamValue",value:function(e,t){this.parameters.get(e).setValueAtTime(t,0)}},{key:"setParam",value:function(e,t){this.parameters.get(e).setValueAtTime(t,0)}},{key:"getParamValue",value:function(e){return this.parameters.get(e).value}},{key:"getParam",value:function(e){return this.parameters.get(e).value}},{key:"setOutputParamHandler",value:function(e){this.output_handler=e}},{key:"getOutputParamHandler",value:function(){return this.output_handler}},{key:"getNumInputs",value:function(){return parseInt(this.json_object.inputs)}},{key:"getNumOutputs",value:function(){return parseInt(this.json_object.outputs)}},{key:"inputChannelCount",value:function(){return parseInt(this.json_object.inputs)}},{key:"outputChannelCount",value:function(){return parseInt(this.json_object.outputs)}},{key:"getParams",value:function(){return this.inputs_items}},{key:"getDescriptor",value:function(){var e={};for(var t in this.descriptor)this.descriptor.hasOwnProperty(t)&&"bypass"!=this.descriptor[t].label&&(e=Object.assign(Object(d.a)({},this.descriptor[t].label,{minValue:this.descriptor[t].min,maxValue:this.descriptor[t].max,defaultValue:this.descriptor[t].init}),e));return e}},{key:"ctrlChange",value:function(e,t,r){if(this.fCtrlLabel[t]!==[])for(var a=0;a<this.fCtrlLabel[t].length;a++){var i=this.fCtrlLabel[t][a].path;this.setParamValue(i,n.remap(r,0,127,this.fCtrlLabel[t][a].min,this.fCtrlLabel[t][a].max)),this.output_handler&&this.output_handler(i,this.getParamValue(i))}}},{key:"pitchWheel",value:function(e,t){for(var r=0;r<this.fPitchwheelLabel.length;r++){var a=this.fPitchwheelLabel[r];this.setParamValue(a.path,n.remap(t,0,16383,a.min,a.max)),this.output_handler&&this.output_handler(a.path,this.getParamValue(a.path))}}},{key:"midiMessage",value:function(e){var t=e[0]>>4,n=15&e[0],r=e[1],a=e[2];9!==n&&(11===t?this.ctrlChange(n,r,a):14===t&&this.pitchWheel(n,128*a+r))}},{key:"onMidi",value:function(e){this.midiMessage(e)}},{key:"getState",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=new Object,n=0;n<this.getParams().length;n++)Object.assign(t,Object(d.a)({},this.getParams()[n],"".concat(this.getParam(this.getParams()[n]))));return e.abrupt("return",new Promise(function(e){e(t)}));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setState",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){for(var r in t)t.hasOwnProperty(r)&&n.setParam(r,t[r]);try{n.gui.setAttribute("state",JSON.stringify(t))}catch(a){console.warn("Plugin without gui or GUI not defined",a)}e(t)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"setPatch",value:function(e){this.setState(this.presets[e])}}],[{key:"remap",value:function(e,t,n,r,a){return 1*(e-t)/(n-t)*(a-r)+r}}]),n}(Object(v.a)(AudioWorkletNode)),b=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Object(s.a)(this,e),console.log("baseLatency "+t.baseLatency),console.log("outputLatency "+t.outputLatency),console.log("sampleRate "+t.sampleRate),this.context=t,this.baseURL=n,this.pathTable=[],this.fWorkletProcessors=this.fWorkletProcessors||[]}return Object(o.a)(e,[{key:"heap2Str",value:function(e){for(var t="",n=0;0!==e[n];)t+=String.fromCharCode(e[n++]);return t}},{key:"load",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s,o,c,u,l,f,h,p,d;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={env:{memoryBase:0,tableBase:0,_abs:Math.abs,_acosf:Math.acos,_asinf:Math.asin,_atanf:Math.atan,_atan2f:Math.atan2,_ceilf:Math.ceil,_cosf:Math.cos,_expf:Math.exp,_floorf:Math.floor,_fmodf:function(e,t){return e%t},_logf:Math.log,_log10f:Math.log10,_max_f:Math.max,_min_f:Math.min,_remainderf:function(e,t){return e-Math.round(e/t)*t},_powf:Math.pow,_roundf:Math.fround,_sinf:Math.sin,_sqrtf:Math.sqrt,_tanf:Math.tan,_acoshf:Math.acosh,_asinhf:Math.asinh,_atanhf:Math.atanh,_coshf:Math.cosh,_sinhf:Math.sinh,_tanhf:Math.tanh,_isnanf:Number.isNaN,_isinff:function(e){return!isFinite(e)},_copysignf:function(e,t){return Math.sign(e)===Math.sign(t)?e:-e},_acos:Math.acos,_asin:Math.asin,_atan:Math.atan,_atan2:Math.atan2,_ceil:Math.ceil,_cos:Math.cos,_exp:Math.exp,_floor:Math.floor,_fmod:function(e,t){return e%t},_log:Math.log,_log10:Math.log10,_max_:Math.max,_min_:Math.min,_remainder:function(e,t){return e-Math.round(e/t)*t},_pow:Math.pow,_round:Math.fround,_sin:Math.sin,_sqrt:Math.sqrt,_tan:Math.tan,_acosh:Math.acosh,_asinh:Math.asinh,_atanh:Math.atanh,_cosh:Math.cosh,_sinh:Math.sinh,_tanh:Math.tanh,_isnan:Number.isNaN,_isinf:function(e){return!isFinite(e)},_copysign:function(e,t){return Math.sign(e)===Math.sign(t)?e:-e},table:new WebAssembly.Table({initial:0,element:"anyfunc"})}},n=""===this.baseURL?"b259wf.wasm":this.baseURL+"/b259wf.wasm",e.next=5,fetch(n);case 5:return r=e.sent,e.next=8,r.arrayBuffer();case 8:return i=e.sent,e.next=11,WebAssembly.compile(i);case 11:return s=e.sent,e.next=14,WebAssembly.instantiate(s,t);case 14:if(o=e.sent,c=new Uint8Array(o.exports.memory.buffer),u=this.heap2Str(c),l=JSON.parse(u),f={wasm_module:s,json:u},-1!==this.fWorkletProcessors.indexOf("b259wf")){e.next=35;break}return e.prev=20,h=/JSON_STR/g,p=g.replace(h,u),d=window.URL.createObjectURL(new Blob([p],{type:"text/javascript"})),e.next=26,this.context.audioWorklet.addModule(d);case 26:console.log("Keep the DSP name"),this.fWorkletProcessors.push("b259wf"),e.next=35;break;case 30:return e.prev=30,e.t0=e.catch(20),console.error(e.t0),console.error("Faust "+this.name+" cannot be loaded or compiled"),e.abrupt("return",null);case 35:return this.node=new y(this.context,this.baseURL,{numberOfInputs:parseInt(l.inputs)>0?1:0,numberOfOutputs:parseInt(l.outputs)>0?1:0,channelCount:Math.max(1,parseInt(l.inputs)),outputChannelCount:[parseInt(l.outputs)],channelCountMode:"explicit",channelInterpretation:"speakers",processorOptions:f}),this.node.onprocessorerror=function(){console.log("An error from b259wf-processor was detected.")},e.abrupt("return",this.node);case 40:return e.prev=40,e.t1=e.catch(0),console.error(e.t1),console.error("Faust "+this.name+" cannot be loaded or compiled"),e.abrupt("return",null);case 45:case"end":return e.stop()}},e,this,[[0,40],[20,30]])}));return function(){return e.apply(this,arguments)}}()},{key:"loadGui",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){try{var r=""===t.baseURL?"main.html":t.baseURL+"/main.html";if(!t.linkExists(r)){var a=document.createElement("link");a.rel="import",a.href=r,document.head.appendChild(a),a.onload=function(e){}}}catch(i){console.log(i),n(i)}}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"linkExists",value:function(e){return document.querySelectorAll('link[href="'.concat(e,'"]')).length>0}}]),e}(),g='\n\n    \'use strict\';\n\n    // Monophonic Faust DSP\n    class b259wfProcessor extends AudioWorkletProcessor {\n        \n        // JSON parsing functions\n        static parse_ui(ui, obj, callback)\n        {\n            for (var i = 0; i < ui.length; i++) {\n                b259wfProcessor.parse_group(ui[i], obj, callback);\n            }\n        }\n        \n        static parse_group(group, obj, callback)\n        {\n            if (group.items) {\n                b259wfProcessor.parse_items(group.items, obj, callback);\n            }\n        }\n        \n        static parse_items(items, obj, callback)\n        {\n            for (var i = 0; i < items.length; i++) {\n                callback(items[i], obj, callback);\n            }\n        }\n        \n        static parse_item1(item, obj, callback)\n        {\n            if (item.type === "vgroup"\n                || item.type === "hgroup"\n                || item.type === "tgroup") {\n                b259wfProcessor.parse_items(item.items, obj, callback);\n            } else if (item.type === "hbargraph"\n                       || item.type === "vbargraph") {\n                // Nothing\n            } else if (item.type === "vslider"\n                       || item.type === "hslider"\n                       || item.type === "button"\n                       || item.type === "checkbox"\n                       || item.type === "nentry") {\n                obj.push({ name: item.address,\n                         defaultValue: item.init,\n                         minValue: item.min,\n                         maxValue: item.max });\n            }\n        }\n        \n        static parse_item2(item, obj, callback)\n        {\n            if (item.type === "vgroup"\n                || item.type === "hgroup"\n                || item.type === "tgroup") {\n                b259wfProcessor.parse_items(item.items, obj, callback);\n            } else if (item.type === "hbargraph"\n                       || item.type === "vbargraph") {\n                // Keep bargraph adresses\n                obj.outputs_items.push(item.address);\n                obj.pathTable[item.address] = parseInt(item.index);\n            } else if (item.type === "vslider"\n                       || item.type === "hslider"\n                       || item.type === "button"\n                       || item.type === "checkbox"\n                       || item.type === "nentry") {\n                // Keep inputs adresses\n                obj.inputs_items.push(item.address);\n                obj.pathTable[item.address] = parseInt(item.index);\n            }\n        }\n     \n        static get parameterDescriptors() \n        {\n            // Analyse JSON to generate AudioParam parameters\n            var params = [];\n            b259wfProcessor.parse_ui(JSON.parse(`JSON_STR`).ui, params, b259wfProcessor.parse_item1);\n            return params;\n        }\n       \n        constructor(options)\n        {\n            super(options);\n            this.running = true;\n            \n            const importObject = {\n                    env: {\n                        memoryBase: 0,\n                        tableBase: 0,\n\n                        // Integer version\n                        _abs: Math.abs,\n\n                        // Float version\n                        _acosf: Math.acos,\n                        _asinf: Math.asin,\n                        _atanf: Math.atan,\n                        _atan2f: Math.atan2,\n                        _ceilf: Math.ceil,\n                        _cosf: Math.cos,\n                        _expf: Math.exp,\n                        _floorf: Math.floor,\n                        _fmodf: function(x, y) { return x % y; },\n                        _logf: Math.log,\n                        _log10f: Math.log10,\n                        _max_f: Math.max,\n                        _min_f: Math.min,\n                        _remainderf: function(x, y) { return x - Math.round(x/y) * y; },\n                        _powf: Math.pow,\n                        _roundf: Math.fround,\n                        _sinf: Math.sin,\n                        _sqrtf: Math.sqrt,\n                        _tanf: Math.tan,\n                        _acoshf: Math.acosh,\n                        _asinhf: Math.asinh,\n                        _atanhf: Math.atanh,\n                        _coshf: Math.cosh,\n                        _sinhf: Math.sinh,\n                        _tanhf: Math.tanh,\n\n                        // Double version\n                        _acos: Math.acos,\n                        _asin: Math.asin,\n                        _atan: Math.atan,\n                        _atan2: Math.atan2,\n                        _ceil: Math.ceil,\n                        _cos: Math.cos,\n                        _exp: Math.exp,\n                        _floor: Math.floor,\n                        _fmod: function(x, y) { return x % y; },\n                        _log: Math.log,\n                        _log10: Math.log10,\n                        _max_: Math.max,\n                        _min_: Math.min,\n                        _remainder:function(x, y) { return x - Math.round(x/y) * y; },\n                        _pow: Math.pow,\n                        _round: Math.fround,\n                        _sin: Math.sin,\n                        _sqrt: Math.sqrt,\n                        _tan: Math.tan,\n                        _acosh: Math.acosh,\n                        _asinh: Math.asinh,\n                        _atanh: Math.atanh,\n                        _cosh: Math.cosh,\n                        _sinh: Math.sinh,\n                        _tanh: Math.tanh,\n\n                        table: new WebAssembly.Table({ initial: 0, element: \'anyfunc\' })\n                    }\n            };\n            \n            this.b259wf_instance = new WebAssembly.Instance(options.processorOptions.wasm_module, importObject);\n            this.json_object = JSON.parse(options.processorOptions.json);\n         \n            this.output_handler = function(path, value) { this.port.postMessage({ path: path, value: value }); };\n            \n            this.ins = null;\n            this.outs = null;\n\n            this.dspInChannnels = [];\n            this.dspOutChannnels = [];\n\n            this.numIn = parseInt(this.json_object.inputs);\n            this.numOut = parseInt(this.json_object.outputs);\n\n            // Memory allocator\n            this.ptr_size = 4;\n            this.sample_size = 4;\n            this.integer_size = 4;\n            \n            this.factory = this.b259wf_instance.exports;\n            this.HEAP = this.b259wf_instance.exports.memory.buffer;\n            this.HEAP32 = new Int32Array(this.HEAP);\n            this.HEAPF32 = new Float32Array(this.HEAP);\n\n            // Warning: keeps a ref on HEAP in Chrome and prevent proper GC\n            //console.log(this.HEAP);\n            //console.log(this.HEAP32);\n            //console.log(this.HEAPF32);\n\n            // bargraph\n            this.outputs_timer = 5;\n            this.outputs_items = [];\n\n            // input items\n            this.inputs_items = [];\n        \n            // Start of HEAP index\n\n            // DSP is placed first with index 0. Audio buffer start at the end of DSP.\n            this.audio_heap_ptr = parseInt(this.json_object.size);\n\n            // Setup pointers offset\n            this.audio_heap_ptr_inputs = this.audio_heap_ptr;\n            this.audio_heap_ptr_outputs = this.audio_heap_ptr_inputs + (this.numIn * this.ptr_size);\n\n            // Setup buffer offset\n            this.audio_heap_inputs = this.audio_heap_ptr_outputs + (this.numOut * this.ptr_size);\n            this.audio_heap_outputs = this.audio_heap_inputs + (this.numIn * NUM_FRAMES * this.sample_size);\n            \n            // Start of DSP memory : DSP is placed first with index 0\n            this.dsp = 0;\n\n            this.pathTable = [];\n         \n            // Send output values to the AudioNode\n            this.update_outputs = function ()\n            {\n                if (this.outputs_items.length > 0 && this.output_handler && this.outputs_timer-- === 0) {\n                    this.outputs_timer = 5;\n                    for (var i = 0; i < this.outputs_items.length; i++) {\n                        this.output_handler(this.outputs_items[i], this.HEAPF32[this.pathTable[this.outputs_items[i]] >> 2]);\n                    }\n                }\n            }\n            \n            this.initAux = function ()\n            {\n                var i;\n                \n                if (this.numIn > 0) {\n                    this.ins = this.audio_heap_ptr_inputs;\n                    for (i = 0; i < this.numIn; i++) {\n                        this.HEAP32[(this.ins >> 2) + i] = this.audio_heap_inputs + ((NUM_FRAMES * this.sample_size) * i);\n                    }\n                    \n                    // Prepare Ins buffer tables\n                    var dspInChans = this.HEAP32.subarray(this.ins >> 2, (this.ins + this.numIn * this.ptr_size) >> 2);\n                    for (i = 0; i < this.numIn; i++) {\n                        this.dspInChannnels[i] = this.HEAPF32.subarray(dspInChans[i] >> 2, (dspInChans[i] + NUM_FRAMES * this.sample_size) >> 2);\n                    }\n                }\n                \n                if (this.numOut > 0) {\n                    this.outs = this.audio_heap_ptr_outputs;\n                    for (i = 0; i < this.numOut; i++) {\n                        this.HEAP32[(this.outs >> 2) + i] = this.audio_heap_outputs + ((NUM_FRAMES * this.sample_size) * i);\n                    }\n                    \n                    // Prepare Out buffer tables\n                    var dspOutChans = this.HEAP32.subarray(this.outs >> 2, (this.outs + this.numOut * this.ptr_size) >> 2);\n                    for (i = 0; i < this.numOut; i++) {\n                        this.dspOutChannnels[i] = this.HEAPF32.subarray(dspOutChans[i] >> 2, (dspOutChans[i] + NUM_FRAMES * this.sample_size) >> 2);\n                    }\n                }\n                \n                // Parse UI\n                b259wfProcessor.parse_ui(this.json_object.ui, this, b259wfProcessor.parse_item2);\n                \n                // Init DSP\n                this.factory.init(this.dsp, sampleRate); // \'sampleRate\' is defined in AudioWorkletGlobalScope  \n            }\n\n            this.setParamValue = function (path, val)\n            {\n                this.HEAPF32[this.pathTable[path] >> 2] = val;\n            }\n\n            this.getParamValue = function (path)\n            {\n                return this.HEAPF32[this.pathTable[path] >> 2];\n            }\n\n            // Init resulting DSP\n            this.initAux();\n        }\n        \n        process(inputs, outputs, parameters) \n        {\n            var input = inputs[0];\n            var output = outputs[0];\n            \n            // Check inputs\n            if (this.numIn > 0 && (!input || !input[0] || input[0].length === 0)) {\n                //console.log("Process input error");\n                return true;\n            }\n            // Check outputs\n            if (this.numOut > 0 && (!output || !output[0] || output[0].length === 0)) {\n                //console.log("Process output error");\n                return true;\n            }\n            \n            // Copy inputs\n            if (input !== undefined) {\n                for (var chan = 0; chan < Math.min(this.numIn, input.length); ++chan) {\n                    var dspInput = this.dspInChannnels[chan];\n                    dspInput.set(input[chan]);\n                }\n            }\n            \n            /*\n            TODO: sample accurate control change is not yet handled\n            When no automation occurs, params[i][1] has a length of 1,\n            otherwise params[i][1] has a length of NUM_FRAMES with possible control change each sample\n            */\n            \n            // Update controls\n            for (const path in parameters) {\n                const paramArray = parameters[path];\n                this.setParamValue(path, paramArray[0]);\n            }\n        \n          \t// Compute\n            try {\n                this.factory.compute(this.dsp, NUM_FRAMES, this.ins, this.outs);\n            } catch(e) {\n                console.log("ERROR in compute (" + e + ")");\n            }\n            \n            // Update bargraph\n            this.update_outputs();\n            \n            // Copy outputs\n            if (output !== undefined) {\n                for (var chan = 0; chan < Math.min(this.numOut, output.length); ++chan) {\n                    var dspOutput = this.dspOutChannnels[chan];\n                    output[chan].set(dspOutput);\n                }\n            }\n            \n            return this.running;\n    \t}\n        \n        handleMessage(event)\n        {\n            var msg = event.data;\n            switch (msg.type) {\n                case "destroy": this.running = false; break;\n            }\n        }\n    }\n\n    // Globals\n    const NUM_FRAMES = 128;\n    try {\n        registerProcessor(\'b259wf\', b259wfProcessor);\n    } catch (error) {\n        console.warn(error);\n    }\n',O=b,k=n(119),j=n(7),w=n.n(j),x=n(14);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var a=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var P=function(e){Object(l.a)(n,e);var t=S(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,"Faust WaveFolder",function(){return new w.a.Gain(1)},e,!0)).outputNode=new w.a.Gain(1),r.foldParameter=new x.a("Fold Amount",Object(c.a)(r),function(e,t){return r.faustNode?r.faustNode.setB259wfFold(t):0},{documentation:"Controls the amount of folding",min:0,max:1,defaultValue:.1}),r.registerParameter(r.foldParameter),r.offsetParameter=new x.a("Fold Offset",Object(c.a)(r),function(e,t){return r.faustNode?r.faustNode.setB259wfOffset(t):0},{documentation:"Controls the offset of folding",min:0,max:1,defaultValue:.1}),r.lowpassParameter=new x.a("Low Pass Filter",Object(c.a)(r),function(e,t){return r.faustNode?r.faustNode.setB259wfLowpass(t):0},{documentation:"Controls the offset of folding",min:0,max:1,defaultValue:.1}),r.registerParameter(r.foldParameter),r.registerParameter(r.lowpassParameter),r.registerParameter(r.offsetParameter),r.loadedValue=1,r.initializeWorklets(),r.updateInitialValues(),r}return Object(o.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"initializeWorklets",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.sequencerEngine.isOffline?this.effectNode.connect(this.outputNode):(this.plugin=new O(w.a.Master.context._context,"."),this.plugin.load().then(function(e){console.log("LOADED wave folder",e),t.effectNode.connect(e),t.faustNode=e,e.connect(t.outputNode),t.foldParameter.refresh(),t.offsetParameter.refresh(),t.lowpassParameter.refresh()})),this.updateInitialValues();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"documented",get:function(){return"Reduces the volume of loud sounds or amplifies quiet sounds."}},{key:"getJson",value:function(e){var t=Object(u.a)(Object(h.a)(n.prototype),"getJson",this).call(this);return t.fold=this.foldParameter.get(),t.offset=this.offsetParameter.get(),t.lowpass=this.lowpassParameter.get(),t}},{key:"fromJson",value:function(e,t){var r=Object(u.a)(Object(h.a)(n.prototype),"fromJson",this).call(this,e,t);return e.fold&&(this.loadedValue=e.fold,Object(k.a)(this.foldParameter,e.fold,r),Object(k.a)(this.offsetParameter,e.offset,r),Object(k.a)(this.lowpassParameter,e.lowpass,r)),r}},{key:"getEffectCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=new n(e);return r.fromJson(this.getJson(),t),r}}]),n}(p.a.Effect);t.a=P},function(e,t,n){"use strict";var r=n(107),a=n(4),i=n(5),s=n(21),o=n(11);function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=new s.a(32,!1),f=function(e,t){for(var n=[],r=Math.floor(t);r>=0;r--){var a,i=c(e.getAllOnStepAtResolutionAtAnyPosition(r,l));try{for(i.s();!(a=i.n()).done;){var s=a.value;r+2*s.duration>t&&n.push(s)}}catch(o){i.e(o)}finally{i.f()}}return n},h=function(e,t,n){var r=[],a=e.stepBuckets[t];for(var i in a.steps)parseFloat(i)>=n&&(r=[].concat(Object(o.a)(r),Object(o.a)(a.steps[i].getPolyphony().filter(function(e){return e.on}))));return r},p=function(e,t,n){var r=[],a=e.stepBuckets[t];for(var i in a.steps)parseFloat(i)<=n&&(r=[].concat(Object(o.a)(r),Object(o.a)(a.steps[i].getPolyphony().filter(function(e){return e.on}))));return r},d=function(e,t){var n=null===e.transpose?(void 0).trackData.transpose:e.transpose;return n<=t.transpose&&n>t.transpose-t.numNotes},v=n(246),m=n(49),y=n(60);function b(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var O=new s.a(32,!1),k=new s.a(32,!0),j=function(){function e(t,n){Object(a.a)(this,e),this.pattern=t,this.trackData=n}return Object(i.a)(e,[{key:"getStep",value:function(e,t,n){var r=this;return this.pattern.getStepAtResolution(e,t,function(e){return null===e.transpose&&n===r.trackData.transpose||e.transpose===n})}},{key:"getStepsAtStepNumber",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O;return this.pattern.getPolyphonicStepsAtResolution(e,t)}},{key:"getStepWithTranspose",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this.pattern.getAllOnStepAtResolutionAtAnyPosition(e,t,a).filter(function(e){return e.on&&(null===(t=e).transpose&&n===r.trackData.transpose||Math.round(t.transpose)===n);var t});if(i.length>0)return i[0]}},{key:"deleteStepsAtStepNumber",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t.isTriplet?(e=k.transformStepAtResolution2(e,t),this.pattern.tripletStepBuckets[e]=new y.a(this.pattern.track,!0)):(e=O.transformStepAtResolution2(e,t),this.pattern.stepBuckets[e]=new y.a(this.pattern.track)),n&&this.update(t.isTriplet)}},{key:"deleteStepAtStepNumber",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t=this.getStepNumber(t,n);var a=n.isTriplet?this.pattern.tripletStepBuckets[t]:this.pattern.stepBuckets[t];if(void 0!==a){for(var i in a.steps){var s=a.steps[i],o=s.deleteStep(e);if(o===m.a){delete a.steps[i];break}if(void 0!==o&&o!==s){a.steps[i]=o;break}}a.anyOn()||a.clear(),r&&this.update(n.isTriplet)}}},{key:"deleteStep",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.pattern.stepBucketsMatrix;for(var r in Object(v.b)(e),n){var a=n[r];if(a){for(var i in a.steps){var s=a.steps[i].deleteStep(e);if(s===m.a){delete a.steps[i];break}if(void 0!==s){a.steps[i]=s;break}}a.anyOn()||a.clear()}}t&&this.update()}},{key:"addStep",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];e.track=this.pattern.track;var o=O.transformStepAtResolution2(t,n);s&&t>=this.pattern.length(n)&&this.pattern.changeLength(o+2*e.duration,!1);var c=this.pattern.getStepAtResolution(t,n,function(){return!0},r);if(void 0===c||i||(e=c.addStep(e)),this.pattern.setStepAtResolution(e,t,n,r),a)if(n.isTriplet)this.update(n.isTriplet);else{var u=O.transformStepAtResolution2(t,n);this.pattern.stepBucketsMatrix[u]=this.pattern.stepBuckets[u],this.pattern.needsSync=!0}return e}},{key:"getSelectedSteps",value:function(e,t){for(var n=[],r=e.fromStep;r<=e.toStep;r++){var a=this.pattern.getAllOnStepAtResolutionAtAnyPosition(r,t);n=n.concat(a)}return n}},{key:"getAllIntersectingSteps",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,a=[],i=e;i>=n;i--){var s,o=Math.floor(i),c=b(this.pattern.getAllOnStepAtResolutionAtAnyPosition(o,t));try{for(c.s();!(s=c.n()).done;){var u=s.value;o+u.duration>(r?e:Math.floor(e))&&a.push(u)}}catch(l){c.e(l)}finally{c.f()}}return a}},{key:"getSelectedPianoRollSteps",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r)return function(e){var t=e.pattern,n=e.selection,r=e.resolution,a=(e.checkIntersection,l.transformStepAtResolution2(n.stepNumber,r)),i=l.transformStepAtResolution2(n.stepNumber+n.numSteps,r),s=[];s=[].concat(Object(o.a)(s),Object(o.a)(f(t,a))),s=[].concat(Object(o.a)(s),Object(o.a)(h(t,Math.floor(a),a-Math.floor(a))));for(var c=Math.ceil(a);c<Math.floor(i);c++){var u=t.stepBuckets[c];s=[].concat(Object(o.a)(s),Object(o.a)(u.getAllOnSteps()))}return s=[].concat(Object(o.a)(s),Object(o.a)(p(t,Math.floor(i),i-Math.floor(i)))),Array.from(new Set(s)).filter(function(e){return d(e,n)})}({pattern:this.pattern,selection:e,resolution:t});for(var a=[],i=void 0,s=e.stepNumber+e.numSteps,c=!0,u=e.stepNumber;u<=e.stepNumber+e.numSteps;u++){var v=r?this.getAllIntersectingSteps(u,t,i,c):this.pattern.getAllOnStepAtResolutionAtAnyPosition(u,t);c=!1;var m=v.filter(function(t){return n.isStepSelected(t,e)});a=a.concat(m),i=u}if(r&&Math.floor(i)<Math.floor(s)){var y=O.transformStepAtResolution2(s,t),b=this.pattern.getAllOnStepAtResolutionBeforePosition(Math.floor(y),O,y-Math.floor(y)).filter(function(t){return n.isStepSelected(t,e)});a=a.concat(b)}return Array.from(new Set(a))}},{key:"getStepNumber",value:function(e,t){return t.isTriplet?k.transformStepAtResolution2(e,t):O.transformStepAtResolution2(e,t)}},{key:"isStepSelected",value:function(e,t){var n=null===e.transpose?this.trackData.transpose:e.transpose;return n<=t.transpose&&n>t.transpose-t.numNotes}},{key:"getStepNumbers",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[];for(var a in e){var i=e[a],s=this.findStepNumber(i,t,n);r.push([i,s])}return r}},{key:"transformSteps",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];(new Date).getTime();if(0===n.stepDifference&&0===n.transposeDifference)return e;var s=t.some(function(e){return e[1]+e[0].position+n.stepDifference<=0});if(a&&s&&n.stepDifference<0)return e;for(var o in t){var c=t[o][0],u=t[o][1];this.deleteStepAtStepNumber(c,u,r,!1)}var l=[],f={},h=this.pattern.length(r);for(var p in t){var d=t[p][0],v=t[p][1],m=v,y=null===d.transpose?this.trackData.transpose:d.transpose;if(isNaN(n.stepDifference)&&(n.stepDifference=0),d.transpose=y+n.transposeDifference,v+=d.position+n.stepDifference,!isNaN(v)){v<0?a?(v=0,d.position=0):v=h+v:a&&(v%=h);var b=Math.floor(v),g=v-b;d.position=g,m!==b&&(f[m]=b),this.addStep(d,b,r,g,!1),l.push(d)}}return i&&!r.isTriplet?(this.pattern.clearCache(),this.pattern.syncMatrixBySteps(f,r)):i&&this.update(r.isTriplet),l}},{key:"snapToGrid",value:function(e,t){var n=this.getStepNumbers(e,t);for(var r in n){var a=n[r][0],i=n[r][1];a.position;this.deleteStepAtStepNumber(a,i,t,!1)}var s=t.isTriplet;for(var o in n){var c=n[o][0],u=Math.round(n[o][1]);c.position=0,this.addStep(c,u,t,0,!1)}this.update(s)}},{key:"findStepNumber",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.isTriplet?this.pattern.tripletStepBucketsMatrix:this.pattern.stepBucketsMatrix;for(var a in r){var i=r[a];if(void 0!==i)for(var s in i.steps){if(i.steps[s].hasStep(e))return t.transformStepAtResolution2(n?parseFloat(a)+parseFloat(s):a,t.isTriplet?k:O)}}}},{key:"findStepNumberAndDelete",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.pattern.stepBucketsMatrix;for(var a in r){var i=r[a];for(var s in i.steps){var o=i.steps[s].deleteStep(e);if(void 0!==o)return i.steps[s]=o,n&&this.update(t.isTriplet),t.transformStepAtResolution2(a,t.isTriplet?k:O)}}}},{key:"deleteSteps",value:function(e){var t=this;e.forEach(function(e){return t.deleteStep(e,!1,void 0,!0)}),this.update()}},{key:"getAllSteps",value:function(){var e=[],t=this.pattern.stepBuckets;for(var n in t){var r=t[n];for(var a in r.steps){var i=r.steps[a];e=e.concat(i.getPolyphony().filter(function(e){return e.on}))}}return e}},{key:"pasteSteps",value:function(e,t,n,r){if(void 0!==e&&void 0!==t){var a=n.getStepNumbers(e,r),i=6e4;for(var s in a){var o=a[s][1];o<i&&(i=o)}for(var c in a)a[c][1]-=i;var u=t.stepNumber,l=[];for(var f in a){var h=a[f][0].getCopy(!0,!1,!1,!0,!1,!1),p=u+a[f][1];l.push(this.addStep(h,p,r,h.position,!1))}return this.update(r.isTriplet),l}}},{key:"getFirstStepNumber",value:function(e,t){var n,a=1/0,i=b(this.getStepNumbers(e,t));try{for(i.s();!(n=i.n()).done;){var s=n.value,o=Object(r.a)(s,2),c=o[0],u=o[1];u<a&&(a=u,c)}}catch(l){i.e(l)}finally{i.f()}return a}},{key:"getFirstOnStep",value:function(e){var t,n=0,r=b(this.pattern.stepBuckets);try{for(r.s();!(t=r.n()).done;){if(t.value.getAnyOnStep())return e.transformStepAtResolution2(n,O);n++}}catch(a){r.e(a)}finally{r.f()}return 0}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.pattern.calculateFills(this.trackData),this.pattern.clearCache(),this.pattern.syncBuckets(e)}}]),e}();t.a=j},function(e,t,n){},,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},,,,,,,,,,,,,,,,,,,function(e,t){},,,,,,,,,,,,function(e,t){},,function(e,t){},,,,,,,,,,function(e,t){},,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},,,,,,,,,,,,,,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},,function(e,t){},,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(791),u=n(148),l=n(155),f=n(146),h=n(781),p=n(118),d=n(227),v=n(139),m=n(122),y=new h.a,b=function(){function e(t){Object(s.a)(this,e),this.web3=t,this.root=new c.a,this.contract=y.getContract(t),this.contractAddress=y.contractAddress,this.isLoaded=!1}return Object(o.a)(e,[{key:"syncFolders",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){var i,s;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.root.getJson(),t.next=3,m.a.addJson(i);case 3:s=t.sent,new l.a(f.f,"foldersUpdated",[Object(u.b)(s)]).execute().then(function(e){return n()});case 5:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"loadFolders",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new v.a(this.contractAddress).from(p.d).select("foldersHash"),e.next=3,t.executeQuery();case 3:if(0!==(n=e.sent).length){e.next=6;break}return e.abrupt("return");case 6:return r=n[0].foldersHash,e.next=9,m.a.getJson(r);case 9:i=e.sent,this.root.fromJson(i,function(e){return(new d.a).fromJson(e)}),this.isLoaded=!0;case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=b},function(e,t,n){"use strict";n(4)},function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sampleHashes",type:"bytes32[16]"},{name:"titles",type:"bytes32[16]"},{name:"youtubeVideoIds",type:"bytes32[16]"},{name:"coverArtHashes",type:"bytes32[16]"},{name:"discogIds",type:"uint256[16]"},{name:"tagsToAdd",type:"bytes32[4][16]"},{name:"stylesToAdd",type:"bytes32[4][16]"},{name:"countries",type:"bytes32[16]"},{name:"sampleYears",type:"int16[16]"}],name:"newSampleWithMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleHashes",type:"bytes32[16]"}],name:"test2",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"c",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"discogsId",type:"uint256"},{indexed:!0,name:"coverArtHash",type:"bytes32"}],name:"NewDiscogsSample",type:"event"}],this.contractAddress="0x18d2c1f1f70ecbeb6366c65cef684e229ff6d6b9"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(11),a=n(1),i=n(42),s=n.n(i),o=n(56),c=n(4),u=n(5),l=n(512),f=n(118),h=n(139),p=n(153),d=n(155),v=n(146),m=(n(125),n(228),n(148)),y=new l.a,b=function(){function e(t){Object(c.a)(this,e),this.web3=t,this.contract=new t.eth.Contract(y.abi,y.contractAddress),this.contractAddress=this.contract.options.address,this.zero=this.web3.utils.padRight("0x00",64)}return Object(u.a)(e,[{key:"saveNewSequence",value:function(e,t,n,r,a){var i=this;return new Promise(function(){var c=Object(o.a)(s.a.mark(function o(c,u){var l,f;return s.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,p.a.getAccount();case 2:for(f in void 0===s.sent&&c(),l=[],r)l.push(Object(m.b)(r[f]));e=void 0===e?i.zero:Object(m.b)(e),t=Object(m.b)(t),l.push(e),new d.a(v.r,"editSequence",[e,t,n,l,a]).execute().then(function(e){return c}).catch(function(e){return u});case 10:case"end":return s.stop()}},o)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"getSequences",value:function(e,t,n,r){var i=this;return new Promise(function(){var c=Object(o.a)(s.a.mark(function o(c,u){var l,p;return s.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return l=new h.a(i.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").fromBlock(t).toBlock(n).from(f.cb),void 0!==e&&l.where("user",e.toLowerCase()),r&&l.whereIn("newSequence",r),s.next=5,l.executeQuery(!1);case 5:(p=s.sent).sort(function(e,t){return t.blockNumber-e.blockNumber}),c(p.map(function(e){return Object(a.a)({},e,{edits:0})}));case 8:case"end":return s.stop()}},o)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"getNextSequences",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(r,i){var o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=new h.a(n.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").where("previousSequence",t).from(f.cb),e.next=3,o.executeQuery();case 3:c=e.sent,r(c.map(function(e){return Object(a.a)({},e,{edits:0})}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPreviousSequences",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(i,o){var c,u,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=new h.a(n.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").where("newSequence",t).from(f.cb),e.next=3,c.executeQuery();case 3:if(0!==(u=(u=e.sent).map(function(e){return Object(a.a)({},e,{edits:0,isPrevious:!0})})).length&&u[0].previousSequence!==t){e.next=9;break}i(u),e.next=20;break;case 9:return l=u[0].previousSequence,e.t0=i,e.t1=[],e.t2=Object(r.a)(u),e.t3=r.a,e.next=16,n.getPreviousSequences(l);case 16:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t6=e.t1.concat.call(e.t1,e.t2,e.t5),(0,e.t0)(e.t6);case 20:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSequence",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(r,i){var o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=new h.a(n.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").where("newSequence",t).from(f.cb),e.next=3,o.executeQuery();case 3:c=e.sent,r(c.map(function(e){return Object(a.a)({},e,{edits:0})}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"watchBalance",value:function(){var e=Object(o.a)(s.a.mark(function e(){var t,n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getAccount();case 2:if(void 0!==(t=e.sent)){e.next=5;break}return e.abrupt("return");case 5:new h.a(this.contract.options.address).from(f.db).select("amount").where("toUser",t.toLowerCase()).watchQuery(function(e){n.callback&&n.callback()});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=b},function(e,t,n){"use strict";var r=n(4);t.a=function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32"},{name:"endMilliseconds",type:"int32"}],name:"newSlice",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32[16]"},{name:"endMilliseconds",type:"int32[16]"}],name:"newSlices16",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32[4]"},{name:"endMilliseconds",type:"int32[4]"}],name:"newSlices4",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32[8]"},{name:"endMilliseconds",type:"int32[8]"}],name:"newSlices8",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"tag",type:"bytes32"},{name:"startMilliseconds",type:"int32"},{name:"endMilliseconds",type:"int32"}],name:"newTaggedSlice",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"tag",type:"bytes32"},{indexed:!1,name:"startMilliseconds",type:"int32"},{indexed:!1,name:"endMillisconds",type:"int32"}],name:"SliceCreated",type:"event"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"}],this.contractAddress="0xf68a5fccacd945904dbcc675752987c72f7d5bed"}},function(e,t,n){"use strict";var r=n(1),a=n(42),i=n.n(a),s=n(56),o=n(4),c=n(5),u=n(780),l=n(155),f=n(146),h=n(148),p=n(153),d=n(518),v=n(139),m=n(118),y=function(){function e(t,n){Object(o.a)(this,e),this.contract=(new u.a).getContract(t),this.web3=t,this.crypto=n,this.NULL_BYTES32=this.web3.utils.padLeft("0x0",64),this.cachedResults={}}return Object(c.a)(e,[{key:"getPublicKey",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(i.a.mark(function e(r,a){var s,o,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=7;break}return e.next=3,p.a.getAccount();case 3:if(void 0!==(t=e.sent)){e.next=7;break}return r(void 0),e.abrupt("return");case 7:return s=new v.a(n.contract.options.address).from(m.B).select("publicKey").where("user",t.toLowerCase()),e.next=10,s.executeQuery();case 10:if(0!==(o=e.sent).length){e.next=14;break}return r(void 0),e.abrupt("return");case 14:c="0x"+n.stripTrailingZeroes(o[0].publicKey),r(n.web3.utils.toAscii(c));case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getEncryptedContent",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n,r){var a,o,c=this,u=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]?u[3]:2,o=u.length>4?u[4]:void 0,e.abrupt("return",new Promise(function(){var e=Object(s.a)(i.a.mark(function e(s,u){var l,f,h,p,d,y;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in c.cachedResults)){e.next=3;break}return s(c.cachedResults[t]),e.abrupt("return");case 3:return e.next=5,new v.a(c.contract.options.address).from(m.m).select("newContent").select("user").select("previousContent").select("contentType").select("encryptedName").select("publicKey").select("encryptedContentKey").select("publicKey").fromBlock(a).toBlock(o);case 5:return l=e.sent,void 0!==r&&l.where("user",r.toLowerCase()),void 0!==t&&l.where("newContent",t),f=(new Date).getTime(),e.next=11,l.executeQuery();case 11:if(h=e.sent,p=(new Date).getTime(),p-f,0!==h.length){e.next=17;break}return s(void 0),e.abrupt("return");case 17:d=[],e.t0=i.a.keys(h);case 19:if((e.t1=e.t0()).done){e.next=28;break}return y=e.t1.value,e.t2=d,e.next=24,c.convertLogResult(h[y],n);case 24:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=19;break;case 28:(new Date).getTime(),p-f,c.cachedResults[t]=d,s(d);case 32:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getEncryptedContentSharedWithMe",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s,o,c,u,l,f;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.cachedResults)){e.next=2;break}return e.abrupt("return",this.cachedResults[t]);case 2:return e.next=4,p.a.getAccount();case 4:return r=e.sent,a=new v.a(this.contract.options.address).from(m.c).select("encryptedContentKey").select("publicKey").select("contentHash").select("creator").where("sharedWith",r.toLowerCase()),void 0!==t&&a.where("contentHash",t),s=(new Date).getTime(),e.next=10,a.executeQuery();case 10:if(o=e.sent,c=(new Date).getTime(),c-s,0!==o.length){e.next=15;break}return e.abrupt("return",void 0);case 15:u=[],e.t0=i.a.keys(o);case 17:if((e.t1=e.t0()).done){e.next=26;break}return l=e.t1.value,e.t2=u,e.next=22,this.convertSharedLogResult(o[l],!1,n);case 22:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=17;break;case 26:return f=(new Date).getTime(),f-s,this.cachedResults[t]=u,e.abrupt("return",u);case 30:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getEncryptedSequenceIfAny",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:2,a=s.length>3?s[3]:void 0,e.next=4,this.getEncryptedContent(t,void 0,n,r,a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSequencesSharedWithUser",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n,r){var a,s,o,c,u;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getAccount();case 2:return a=e.sent,s=new v.a(this.contract.options.address).from(m.c).select("encryptedContentKey").select("publicKey").select("contentHash").select("creator").where("sharedWith",a.toLowerCase()),void 0!==t&&s.where("contentHash",t),n&&s.fromBlock(n),r&&s.toBlock(r),e.next=9,s.executeQuery();case 9:o=e.sent,c=[],e.t0=i.a.keys(o);case 12:if((e.t1=e.t0()).done){e.next=21;break}return u=e.t1.value,e.t2=c,e.next=17,this.convertSharedLogResult(o[u]);case 17:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=12;break;case 21:return e.abrupt("return",c);case 22:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"convertSharedLogResult",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,a,s,o,c,u=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(u.length>1&&void 0!==u[1])||u[1],e.next=3,this.crypto.decryptContentKey(t.encryptedContentKey);case 3:if(a=e.sent,s=this.stripTrailingZeroes(t.publicKey),{user:t.creator,contentHash:t.contentHash,publicKey:s,contentKey:a?a.contentKey:void 0},o={},c="",!n){e.next=15;break}return e.next=11,this.getEncryptedSequenceIfAny(t.contentHash);case 11:return o=e.sent,e.next=14,this.crypto.decryptName(o[0].encryptedTitle,this.stripTrailingZeroes(t.encryptedContentKey));case 14:c=e.sent;case 15:return e.abrupt("return",Object(r.a)({},o[0],{title:c,publicKey:s,contentKey:a?a.contentKey:void 0}));case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"convertLogResult",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s,o,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.stripTrailingZeroes(t.encryptedContentKey),e.next=3,this.crypto.decryptName(t.encryptedName,r,n);case 3:return a=e.sent,s=t.user,e.next=7,this.crypto.decryptContentKey(r,n);case 7:return o=e.sent,c={title:this.stripTrailingZeroes(a),encryptedTitle:t.encryptedName,user:"0x"+this.stripLeadingZeroes(s.slice(2)),previousSequence:t.previousContent,newSequence:t.newContent,contentType:t.contentType,contentKey:o?o.contentKey:void 0,blockNumber:t.blockNumber,publicKey:this.stripTrailingZeroes(t.publicKey)},e.abrupt("return",c);case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newPublicKey",value:function(e){return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new l.a(f.d,"setPublicKey",[e]).execute().then(function(){return n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"newEncryptedSequence",value:function(e,t,n,r,a){var o=this;return new Promise(function(){var c=Object(s.a)(i.a.mark(function s(c,u){return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e=void 0===e?o.web3.utils.padLeft("0x0",64):Object(h.b)(e),t=Object(h.b)(t),n=o.web3.utils.padLeft("0x"+n,64),new l.a(f.d,"newEncryptedContent",[e,t,n,d.a,r,a]).execute().then(function(){return c()});case 4:case"end":return i.stop()}},s)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"newEncryptedContent",value:function(e,t,n,r,a){var o=this;return new Promise(function(){var c=Object(s.a)(i.a.mark(function s(c,u){return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e=Object(h.b)(e),t=o.web3.utils.padLeft("0x"+t,64),new l.a(f.d,"newEncryptedContent",[o.NULL_BYTES32,e,t,r,n,a]).execute().then(function(){return c()});case 3:case"end":return i.stop()}},s)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"shareEncryptedContent",value:function(e,t,n,r){return new Promise(function(){var a=Object(s.a)(i.a.mark(function a(s,o){return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t=Object(h.b)(t),new l.a(f.d,"shareEncryptedContentWith",[e,t,n,r]).execute().then(function(){return s()});case 2:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"stripTrailingZeroes",value:function(e){for(var t=e.length-1;t>=0;t--)if("0"!==e.slice(t,t+1))return e.slice(0,t+1)}},{key:"stripLeadingZeroes",value:function(e){for(var t=0;t<e.length;t++)if("0"!==e.slice(t,t+1))return e.slice(t)}},{key:"getPotentialUsers",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new v.a(this.contract.options.address).from(m.B).select("user"),e.next=3,t.executeQuery();case 3:return n=e.sent,r=Array.from(new Set(n.map(function(e){return e.user}))),e.abrupt("return",r.filter(function(e){return void 0!==e}));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=y},function(e,t,n){"use strict";var r=n(4);t.a=function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"}],name:"newIndex",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!1,name:"sampleHash",type:"bytes32"}],name:"NewIndex",type:"event"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{constant:!0,inputs:[],name:"getIndex",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"}],this.contractAddress="0xb05e78e48dc17fff1b52307e240cab6b241fe288"}},function(e,t,n){"use strict";var r=n(4);t.a=function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"previousSequences",type:"bytes32[4]"},{name:"newSequence",type:"bytes32"},{name:"diff",type:"bytes32"},{name:"title",type:"string"}],name:"editCompoundSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"previousSequence",type:"bytes32"},{name:"newSequence",type:"bytes32"},{name:"diff",type:"bytes32"},{name:"title",type:"string"}],name:"editSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"userEditing",type:"address"},{indexed:!0,name:"previousSequence",type:"bytes32"},{indexed:!0,name:"newSequence",type:"bytes32"},{indexed:!1,name:"diffHash",type:"bytes32"},{indexed:!1,name:"title",type:"string"}],name:"SequenceEdited",type:"event"}],this.contractAddress="0x16687b7db5994ac1aa22594be04af8396f5085dd"}},function(e,t,n){"use strict";var r=n(1),a=n(42),i=n.n(a),s=n(56),o=n(4),c=n(5),u=n(779),l=n(786),f=n(125),h=n(20),p=n(795),d=n(153),v=n(139),m=n(155),y=n(146),b=n(118),g=n(148),O=n(518);function k(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var w=new(n(295).a),x=(new l.a).contractAddress,S={},P=function(){function e(t,n,r){Object(o.a)(this,e),this.web3=t,this.contract=(new u.a).getContract(t),this.users=new p.a(t),this.crypto=n,this.encryption=r,this.guildKeyCache={},this.guildIdCache={},this.guildsWithAccess=void 0}return Object(c.a)(e,[{key:"initGuilds",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getGuildsForUser();case 2:return this.guilds=e.sent,e.next=5,d.a.getAccount();case 5:if(void 0!==(t=e.sent)){e.next=8;break}return e.abrupt("return");case 8:if(navigator.onLine){e.next=10;break}return e.abrupt("return");case 10:new v.a(this.contract.options.address).from(b.n).select("guildId").where("user",t.toLowerCase()).watchQuery(function(){n.newGuildCallback&&n.newGuildCallback()});case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"saveGuildKey",value:function(e,t){this.guildKeyCache[e]=t}},{key:"getGuildKey",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r,a=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.guildKeyCache)){e.next=5;break}return n=this.guildKeyCache[t],e.next=4,n;case 4:return e.abrupt("return",e.sent);case 5:return r=new Promise(function(){var e=Object(s.a)(i.a.mark(function e(n,r){var s,o,c,u,l,f,h,p;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((new Date).getTime(),void 0!==t){e.next=9;break}return e.next=4,a.getGuildsForUser();case 4:if(0!==(s=e.sent).length){e.next=8;break}return n(void 0),e.abrupt("return");case 8:t=s[0].guildId;case 9:return e.next=11,d.a.getAccount();case 11:if(void 0!==(o=e.sent)){e.next=15;break}return n(void 0),e.abrupt("return");case 15:return console.log("gettinng gulkd key ecrypted"),e.next=18,new v.a(a.contractAddress).from(b.e).select("ipfsHash").where("user",o.toLowerCase()).where("guildId",t).executeQuery();case 18:if(c=e.sent,console.log("results gguild=",c),0!==c.length){e.next=24;break}return delete a.guildKeyCache[t],n(void 0),e.abrupt("return");case 24:return u=c[0].ipfsHash,l=(new Date).getTime(),e.next=28,a.encryption.getEncryptedContent(u);case 28:if(void 0!==(f=e.sent)){e.next=33;break}return e.next=32,a.encryption.getEncryptedContentSharedWithMe(u);case 32:f=e.sent;case 33:if(console.log("encrypted content meta=",f),h=(new Date).getTime(),h-l,void 0!==f){e.next=40;break}return delete a.guildKeyCache[t],n(void 0),e.abrupt("return");case 40:return e.prev=40,e.t0=JSON,e.next=44,a.crypto.fetchAndDecrypt(u,f);case 44:e.t1=e.sent,p=e.t0.parse.call(e.t0,e.t1),(new Date).getTime(),h-l,n(a.crypto.parseGuildKey(p)),e.next=55;break;case 51:e.prev=51,e.t2=e.catch(40),console.log("error while decryptoing",e.t2),n(void 0);case 55:case"end":return e.stop()}},e,null,[[40,51]])}));return function(t,n){return e.apply(this,arguments)}}()),this.guildKeyCache[t]=r,e.next=9,r;case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newGuildWithPeople",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a=this,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:Object(h.uuid)(),e.abrupt("return",new Promise(function(){var e=Object(s.a)(i.a.mark(function e(s,o){var c,u,l,f,h,p,d,v,b,O,j,w,x,S,P;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.crypto.generateGuildKey(r);case 2:return c=e.sent,c.privateKey,u=c.publicKey,e.next=7,a.crypto.encryptAndUploadJSON(c);case 7:l=e.sent,f=l.encryptedContentKey,h=l.encryptedContentIpfsHash,p=l.publicKey,d=[],v=[],b=[],O=k(n),e.prev=15,O.s();case 17:if((j=O.n()).done){e.next=31;break}return w=j.value,e.next=21,a.encryption.getPublicKey(w);case 21:return x=e.sent,e.next=24,a.crypto.encryptAndUploadJSON(c,x);case 24:S=e.sent,P=S.contentKey,d.push(Object(g.b)(S.encryptedContentIpfsHash)),v.push(P.convertForEthereum()),b.push(P.getPublicKeyAsBytes32());case 29:e.next=17;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(15),O.e(e.t0);case 36:return e.prev=36,O.f(),e.finish(36);case 39:new m.a(y.k,"createGuildWithPeople",[u,t,Object(g.b)(h),f,p]).execute().then(function(e){s()});case 40:case"end":return e.stop()}},e,null,[[15,33,36,39]])}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newGuild",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r=this,a=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:Object(h.uuid)(),e.abrupt("return",new Promise(function(){var e=Object(s.a)(i.a.mark(function e(a,s){var o,c,u,l,f,h;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.crypto.generateGuildKey(n);case 2:return o=e.sent,o.privateKey,c=o.publicKey,e.next=7,r.crypto.encryptAndUploadJSON(o);case 7:u=e.sent,l=u.encryptedContentKey,f=u.encryptedContentIpfsHash,h=u.publicKey,new m.a(y.g,"newGuild",[c,t,Object(g.b)(f),l,h]).execute().then(function(e){a(o)});case 12:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"requestToAddMember",value:function(e,t){var n=this;return new Promise(function(){var r=Object(s.a)(i.a.mark(function r(a,s){var o,c,u,l;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.getGuildKey(e);case 2:return o=r.sent,r.next=5,n.encryption.getPublicKey(t);case 5:return c=r.sent,r.next=8,n.crypto.encryptAndUploadJSON(o,c);case 8:u=r.sent,l=u.contentKey,new m.a(y.g,"requestToAddMember",[e,t,Object(g.b)(u.encryptedContentIpfsHash),l.convertForEthereum(),l.getPublicKeyAsBytes32()]).execute().then(function(e){a()});case 11:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"leaveGuild",value:function(e){return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new m.a(y.k,"leaveGuild",[e]).execute().then(function(e){n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"voteForProposal",value:function(e,t,n){var r=this;return new Promise(function(){var a=Object(s.a)(i.a.mark(function a(s,o){return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=r.contract.methods.voteOnNewGuildMemberProposal(e,t,n),a.next=3,d.a.getAccount();case 3:a.t1=a.sent,a.t2={from:a.t1},a.t3=function(e,t){e?o(e):s()},a.t0.send.call(a.t0,a.t2,a.t3);case 7:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"getAllGuildMemberProposals",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){var a,s,o,c,u,l;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getGuildsForUser();case 2:a=t.sent,s=[],t.t0=i.a.keys(a);case 5:if((t.t1=t.t0()).done){t.next=14;break}return o=t.t1.value,c=a[o].guildId,t.next=10,e.getGuildMemberProposals(c);case 10:for(l in u=t.sent)s.push({guildId:c,proposalIndex:l,potentialMember:u[l]});t.next=5;break;case 14:n(s);case 15:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getGuildMemberProposals",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(i.a.mark(function n(r,a){var s,o,c,u,l;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:return s=n.sent,n.next=5,t.contract.methods.getTotalGuildMemberProposals(e).call({from:s[0]});case 5:o=n.sent,c=[],u=0;case 8:if(!(u<o)){n.next=16;break}return n.next=11,t.contract.methods.getNewGuildMemberProposal(e,u).call({from:s[0]});case 11:l=n.sent,c.push(l);case 13:u++,n.next=8;break;case 16:r(c);case 17:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"contractAddress",get:function(){return this.contract.options.address}},{key:"getNewMemberRequestsFromGuild",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r,a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.getAccount();case 2:if(void 0!==e.sent){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,new v.a(this.contractAddress).from(b.p).select("newMember").where("guildId",t).executeQuery(!1);case 7:return n=e.sent,e.next=10,new v.a(this.contractAddress).from(b.q).select("newMember").where("guildId",t).executeQuery(!1);case 10:return r=e.sent,e.next=13,new v.a(this.contractAddress).from(b.r).select("newMember").where("guildId",t).executeQuery(!1);case 13:return a=e.sent,s=n.filter(function(e){return!r.some(function(t){return e.newMember===t.newMember})&&!a.some(function(t){return e.newMember===t.newMember})}),e.abrupt("return",s);case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptAnyNewRequests",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d.a.isLoggedIn()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.getNewMemberRequests();case 4:e.sent.forEach(function(e){var n=e.guildId;return t.acceptRequestToAddToGuild(n)});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getNewMemberRequests",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){var a,s,o,c,u,l,f,h,p,m;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.a.getAccount();case 2:if(void 0!==(a=t.sent)){t.next=6;break}return n([]),t.abrupt("return");case 6:return t.next=8,new v.a(e.contractAddress).from(b.p).select("guildId").select("requester").where("newMember",a.toLowerCase()).executeQuery(!1);case 8:for(c in s=t.sent,o={},s)o[s[c].guildId]={requester:s[c].requester,blockNumber:s[c].blockNumber};return o=e.reduceMap(o),t.next=14,new v.a(e.contractAddress).from(b.q).select("guildId").where("newMember",a.toLowerCase()).executeQuery(!1);case 14:return u=(u=t.sent).map(function(e){return e.guildId}),t.next=18,new v.a(e.contractAddress).from(b.r).select("guildId").where("newMember",a.toLowerCase()).executeQuery(!1);case 18:l=(l=t.sent).map(function(e){return e.guildId}),f=[],t.t0=i.a.keys(o);case 22:if((t.t1=t.t0()).done){t.next=38;break}if(h=t.t1.value,p=e.countOccurences(u,parseInt(h)),m=e.countOccurences(l,parseInt(h)),!(o[h].count>p+m)){t.next=36;break}return t.t2=f,t.t3=parseInt(h),t.next=31,e.getGuildName(parseInt(h));case 31:t.t4=t.sent,t.t5=o[h].requester,t.t6=o[h].blockNumber,t.t7={guildId:t.t3,guildName:t.t4,requester:t.t5,blockNumber:t.t6},t.t2.push.call(t.t2,t.t7);case 36:t.next=22;break;case 38:n(f);case 39:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"reduceMap",value:function(e){var t={};for(var n in e){for(var r in t)r!==n||t[r].count++;t[n]=e[n],t[n].count=1}return t}},{key:"countOccurences",value:function(e,t){var n=0;for(var r in e)e[r]===t&&n++;return n}},{key:"rejectRequestToAddToGuild",value:function(e){return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new m.a(y.g,"rejectRequestToAddToGuild",[e]).execute().then(function(e){n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"acceptRequestToAddToGuild",value:function(e){return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new m.a(y.g,"acceptRequestToAddToGuild",[e]).execute().then(function(e){n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getAllMembersInUsersGuilds",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(i.a.mark(function n(a,s){var o,c,u,l,f;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d.a.getAccount();case 2:return o=n.sent,n.next=5,t.getGuildsForUser(e);case 5:c=n.sent,u=[],l=i.a.mark(function e(n){var a,s,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=c[n],s=a.guildId,e.next=4,t.getUsersInGuild(s);case 4:l=(l=(l=e.sent).filter(function(e){return e.userId!==o})).map(function(e){return Object(r.a)({},e,{guildId:s,guildName:a.name})}),u=u.concat(l);case 8:case"end":return e.stop()}},e)}),n.t0=i.a.keys(c);case 9:if((n.t1=n.t0()).done){n.next=14;break}return f=n.t1.value,n.delegateYield(l(f),"t2",12);case 12:n.next=9;break;case 14:a(u);case 15:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getGuildsUserLeft",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return e.next=3,d.a.getAccount();case 3:t=e.sent;case 4:return n=new v.a(x).from(b.eb).select("guildId"),e.next=7,n.executeQuery();case 7:return r=e.sent,e.abrupt("return",r.map(function(e){return e.guildId}));case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGuildsForUser",value:function(e){var t=this;!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(function(){var n=Object(s.a)(i.a.mark(function n(r,a){var s,o,c,u,l,f,h,p,m;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d.a.getAccount();case 2:if(s=n.sent,void 0===e&&(e=s),void 0!==e){n.next=7;break}return r([]),n.abrupt("return");case 7:return n.next=9,t.getGuildsUserLeft(s);case 9:return o=n.sent,[],c=new v.a(t.contract.options.address).from(b.e).select("guildId").where("user",e.toLowerCase()),n.next=14,c.executeQuery(!1);case 14:u=n.sent,l={},n.t0=i.a.keys(u);case 17:if((n.t1=n.t0()).done){n.next=26;break}return f=n.t1.value,h=u[f].guildId,n.next=22,t.getGuildName(h);case 22:p=n.sent,l[h]=p,n.next=17;break;case 26:m=Object.keys(l).filter(function(e){return!o.includes(parseFloat(e))}).map(function(e){return{guildId:parseInt(e),name:l[e]}}),r(m);case 28:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"hasAccessTo",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,this.getGuildsWithAccess();case 4:return n=e.sent,e.abrupt("return",n.indexOf(t)>-1);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGuildsWithAccess",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(i.a.mark(function n(r,a){var s,o,c;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0===t.guildsWithAccess){n.next=3;break}return r(t.guildsWithAccess),n.abrupt("return");case 3:return n.next=5,d.a.getAccount();case 5:if(s=n.sent,void 0===e&&(e=s),void 0!==e){n.next=11;break}return t.guildsWithAccess=[],r([]),n.abrupt("return");case 11:return[],o=new v.a(t.contract.options.address).from(b.e).select("guildId").where("user",e.toLowerCase()),n.next=15,o.executeQuery(!1);case 15:c=n.sent,t.guildsWithAccess=Array.from(new Set(c.map(function(e){return e.guildId}))),r(t.guildsWithAccess);case 18:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getGuildName",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return","");case 2:if(!(t in S)){e.next=6;break}return e.next=5,S[t];case 5:return e.abrupt("return",e.sent);case 6:return n=new Promise(function(){var e=Object(s.a)(i.a.mark(function e(n,a){var s,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=new v.a(r.contract.options.address).from(b.n).select("name").where("guildId",t),e.next=3,s.executeQuery(!1);case 3:if(0!==(o=e.sent).length){e.next=6;break}return e.abrupt("return","");case 6:n(o[0].name);case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),S[t]=n,e.next=10,n;case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUsersInGuild",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(i.a.mark(function n(r,a){var s,o,c,u,l;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(navigator.onLine){n.next=3;break}return r([]),n.abrupt("return");case 3:return n.next=5,d.a.getAccount();case 5:return n.sent,s=[],n.prev=7,n.next=10,t.contract.methods.getTotalGuildUsers(e).call();case 10:o=n.sent,c=0;case 12:if(!(c<o)){n.next=23;break}return n.next=15,t.contract.methods.getUserFromGuild(e,c).call();case 15:return u=n.sent,n.next=18,t.users.getUserName(u);case 18:l=n.sent,s.push({userId:u,userName:l});case 20:c++,n.next=12;break;case 23:n.next=27;break;case 25:n.prev=25,n.t0=n.catch(7);case 27:r(s);case 28:case"end":return n.stop()}},n,null,[[7,25]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"setGuildName",value:function(e,t){var n=this;return new Promise(function(){var r=Object(s.a)(i.a.mark(function r(a,s){var o;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.web3.eth.getAccounts();case 2:o=r.sent,n.contract.methods.setNameForGuild(e,t).send({from:o[0]},function(e,t){e?s(e):a()});case 4:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getContentGuildId",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.guildIdCache)){e.next=2;break}return e.abrupt("return",this.guildIdCache[t]);case 2:if(n!==O.b){e.next=16;break}return r=new v.a(w.contractAddress).from(b.R).select("guildId").where("ipfsHash",t),e.next=6,r.executeQuery(!1);case 6:if(0!==(a=e.sent).length){e.next=10;break}return this.guildIdCache[t]=0,e.abrupt("return",0);case 10:return s=null===(s=a[0].guildId)||void 0===s?0:s,this.guildIdCache[t]=s,e.abrupt("return",s);case 16:return e.next=18,f.a.guildSequences.getGuildSequence(t);case 18:if(!(o=e.sent)){e.next=21;break}return e.abrupt("return",o.guildId);case 21:return e.abrupt("return",0);case 22:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onUserChanged",value:function(){this.guildsWithAccess=void 0,this.getGuildsWithAccess()}},{key:"getPeople",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r,a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(this.contractAddress).from(b.e).select("user").executeQuery();case 2:t=e.sent,n=[],e.t0=i.a.keys(t);case 5:if((e.t1=e.t0()).done){e.next=14;break}return r=e.t1.value,a=t[r].user,e.next=10,this.users.getUserName(a);case 10:s=e.sent,n.push({id:a,userName:s}),e.next=5;break;case 14:return e.abrupt("return",n);case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=P},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(139),u=n(197),l=n(148),f=n(118),h=n(155),p=n(146),d=new(n(295).a),v=function(){function e(t){Object(s.a)(this,e),this.web3=t,this.contract=new t.eth.Contract(d.abi,d.contractAddress)}return Object(o.a)(e,[{key:"address",get:function(){return this.contract.options.address}},{key:"getGuildIdForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new c.a(this.address).from(f.R).select("guildId").where("ipfsHash",t).executeQuery();case 2:if(n=e.sent,null!==(r=n.map(function(e){return e.guildId})[0])&&void 0!==r){e.next=6;break}return e.abrupt("return",0);case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getMetadataForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new c.a(this.address).from(n).where("ipfsHash",t);case 2:return i=e.sent,r.forEach(function(e){return i.select(e)}),e.next=6,i.executeQuery();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getTagsForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,f.V,["tag"]);case 2:return n=e.sent,e.abrupt("return",Array.from(new Set(n.map(function(e){return e.tag}))));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTitleForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,f.R,["title"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].title);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getStylesForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,f.U,["style"]);case 2:return n=e.sent,e.abrupt("return",Array.from(new Set(n.map(function(e){return e.style}))));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCountryForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,f.Q,["country"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].country);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getYearForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,f.Y,["year"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].year);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getYoutubeIdForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,f.Z,["videoId"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].videoId);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getDiscogsData",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,f.k,["covertArtHash, discogsId"]);case 2:return n=e.sent,e.abrupt("return",n[0]||{coverArtHash:void 0,discogsId:void 0});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveSample",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,l,f,h,p,d,v;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getId(),r=new u.a(t.audioBuffer.numberOfChannels,function(){return[]}),e.next=4,r.uploadBufferToIpfs(t.audioBuffer);case 4:return i=e.sent,e.next=7,this.getTagsForSound(n);case 7:return s=e.sent,e.next=10,this.getTitleForSound(n);case 10:return o=e.sent,e.next=13,this.getStylesForSound(n);case 13:return c=e.sent,e.next=16,this.getCountryForSound(n);case 16:return l=e.sent,e.next=19,this.getYearForSound(n);case 19:return f=e.sent,e.next=22,this.getDiscogsData(n);case 22:return h=e.sent,p=h.coverArtHash,d=h.discogsId,e.next=27,this.getYoutubeIdForSound(n);case 27:return v=e.sent,this.newSampleWithMetadata(i,{title:o,youtubeId:v,tags:s,styles:c,country:l,year:f,guildId:0,discogsId:d,coverArtHash:p}),e.abrupt("return",i);case 30:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newSampleWithMetadata",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(a.a.mark(function e(i,s){var o,c,u,f,d,v,m,y,b,g,O,k,j,w;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(o=n.title,c=n.youtubeId,u=n.tags,f=n.styles,d=n.country,v=n.year,m=n.guildId,y=n.discogsId,b=n.coverArtHash,g=r.web3,O=g.utils.padLeft("0x0",64),void 0===u&&(u=[]),u.length>4&&(u=u.slice(0,4)),f.length>4&&(f=f.slice(0,4)),k=u.length;k<4;k++)u.push(null);for(j=f.length;j<4;j++)f.push(null);u=u.map(function(e){return e?g.utils.fromAscii(e):O}),f=f.map(function(e){return e?g.utils.fromAscii(e):O}),d=d?g.utils.fromAscii(d):O,c=c?g.utils.fromAscii(c):O,b=b?Object(l.b)(b):O,t=Object(l.b)(t),w=[t,o,c,u,f,d,void 0===v?0:v,void 0===y?0:y,b,m],new h.a(p.i,"newSampleWithMetadata",w).execute().then(function(){return i()});case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.a=v},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(1),s=n(56),o=n(4),c=n(5),u=n(778),l=n(215),f=n(153),h=n(148),p=n(155),d=n(146),v=n(139),m=n(118),y=n(796),b=n(122),g=new u.a,O=function(){function e(t,n,r,a){Object(o.a)(this,e),this.web3=t,this.encryption=r,this.crypto=a,this.guilds=n,this.contract=g.getContract(t),this.contractAddress=g.contractAddress,this.NULL_BYTES_32=t.utils.padLeft("0x0",64)}return Object(c.a)(e,[{key:"newGuildSequence",value:function(e,t,n,r){var o=this;return new Promise(function(){var c=Object(s.a)(a.a.mark(function s(c,u){var v,m,y,g,O,k,j;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,o.guilds.getGuildKey(r);case 2:return v=a.sent,m=v.rawPublicKey,a.next=6,o.crypto.encryptRawContent(JSON.stringify(e),t,m);case 6:return y=a.sent,y.contentKey.contentKey,a.next=10,b.a.addJson(y.encryptedContent);case 10:return g=a.sent,a.next=13,f.a.getAccount();case 13:void 0===a.sent&&u("No accounts"),O=o.web3.utils.padLeft("0x"+y.encryptedName,64),k={contentHash:g,previousHash:n,encryptedName:O,encryptedContentKey:y.encryptedContentKey,publicKey:v.publicKey,guildId:r},l.a.setItem("guildSequence."+g,JSON.stringify(k)),j=Object(i.a)({},e),l.a.setItem("projectData",JSON.stringify(j)),l.a.setItem("projectHash",g),new p.a(d.j,"editSequence",[n?Object(h.b)(n):o.NULL_BYTES_32,Object(h.b)(g),O,y.encryptedContentKey,v.publicKey,r]).execute(),c(g);case 23:case"end":return a.stop()}},s)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"getGuildSequence",value:function(){var e=Object(s.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new v.a(this.contractAddress).select("contentHash").select("previousHash").select("user").select("encryptedName").select("guildId").select("encryptedContentKey").select("publicKey").from(m.s).where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(r=e.sent).length){e.next=13;break}if(i="guildSequence."+t,!(s=l.a.getItem(i))){e.next=12;break}s=JSON.parse(s),r=[s],e.next=13;break;case 12:return e.abrupt("return",void 0);case 13:return o=r[0],c=o.guildId,e.next=17,this.guilds.getGuildKey(c);case 17:return u=e.sent,e.abrupt("return",this._decryptQueryResult(o,u.privateKey));case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGuildSequences",value:function(){var e=Object(s.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(l.length>1&&void 0!==l[1])||l[1],r=new v.a(this.contractAddress).select("contentHash").select("previousHash").select("user").select("encryptedName").select("encryptedContentKey").select("publicKey").select("guildId").from(m.s).where("guildId",t),n){e.next=7;break}return e.next=5,f.a.getAccount();case 5:void 0!==(i=e.sent)&&r.where("address",i.toLowerCase());case 7:return e.next=9,r.executeQuery();case 9:if(0!==(s=e.sent).length){e.next=12;break}return e.abrupt("return",[]);case 12:return e.next=14,this.guilds.getGuildKey(t);case 14:if(void 0!==(o=e.sent)){e.next=17;break}return e.abrupt("return",[]);case 17:c=[],e.t0=a.a.keys(s);case 19:if((e.t1=e.t0()).done){e.next=28;break}return u=e.t1.value,e.t2=c,e.next=24,this._decryptQueryResult(s[u],o.privateKey);case 24:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=19;break;case 28:return e.abrupt("return",c);case 29:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_decryptQueryResult",value:function(){var e=Object(s.a)(a.a.mark(function e(t,n){var r,i,s,o,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=7;break}return e.next=3,this.guilds.getGuildKey(t.guildId);case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",void 0);case 6:n=r.privateKey;case 7:return i=Object(y.b)(t.encryptedContentKey),e.next=10,this.crypto.decryptName(t.encryptedName,i,n);case 10:return s=e.sent,o=t.user,e.next=14,this.crypto.decryptContentKey(i,n);case 14:return c=e.sent,u={title:Object(y.b)(s),encryptedTitle:t.encryptedName,user:o,newSequence:t.contentHash,previousSequence:t.previousHash,guildId:t.guildId,contentKey:c?c.contentKey:void 0,blockNumber:t.blockNumber,publicKey:t.publicKey&&Object(y.b)(t.publicKey)},e.abrupt("return",u);case 17:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.a=O},function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(783),s=(n(148),n(146),n(155),function(){function e(t){Object(r.a)(this,e),this.web3=t,this.contract=(new i.a).getContract(t)}return Object(a.a)(e,[{key:"newResample",value:function(e,t,n,r,a){}}]),e}());t.a=s},,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=["1","162/149","81/64","4/3","3/2","18/11","4096/2187","2/1"]},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return y});var r=n(11),a=n(42),i=n.n(a),s=n(56),o=(n(122),n(1792)),c=n(411),u=n(7),l=n.n(u),f=n(290),h=(n(61),n(1793)),p=n(138),d=n(23);function v(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e){window.addEventListener("dragenter",function(e){e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none"},!1),window.addEventListener("dragover",function(e){return e.preventDefault(),e.dataTransfer.effectAllowed="none",!1}),window.addEventListener("drop",function(){var t=Object(s.a)(i.a.mark(function t(n){var r,a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),n.dataTransfer.effectAllowed="none",n.dataTransfer.dropEffect="none",n.dataTransfer.items)for(r=n.dataTransfer.items.length,e.dispatch(Object(d.ob)(r)),a=0;a<n.dataTransfer.items.length;a++)"file"===n.dataTransfer.items[a].kind&&(e.dispatch(Object(d.Je)(!0)),b(e,n.dataTransfer.items[a].getAsFile()));else for(a=0;a<n.dataTransfer.files.length;a++);return t.abrupt("return",!1);case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}var b=function(t,n){var a=new FileReader;n.name.includes(".wav")||n.name.includes(".flac")||n.name.includes(".mp3")?(a.readAsArrayBuffer(n),a.onloadend=Object(s.a)(i.a.mark(function s(){var u,m,y,b,g,O,k;return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(u=a.result,y=new p.a(f.a),!n.name.includes("flac")){i.next=11;break}return i.next=5,Object(h.a)(new Int8Array(u));case 5:return u=i.sent,i.next=8,l.a.Master.context.decodeAudioData(u);case 8:m=i.sent,i.next=21;break;case 11:if(!n.name.includes("mp3")){i.next=18;break}return i.next=14,Object(c.a)(new Int8Array(u));case 14:m=i.sent,y.mp3Data=new e(u),i.next=21;break;case 18:return i.next=20,l.a.Master.context.decodeAudioData(u);case 20:m=i.sent;case 21:y.tags=[],b=v(o.a);try{for(b.s();!(g=b.n()).done;)O=g.value,n.name.toLowerCase().includes(O.toLowerCase())&&y.tags.push(O)}catch(s){b.e(s)}finally{b.f()}y.tags.length>0&&console.log("tags for %s = ",n.name,y.tags),y.audioBuffer=m,y.needsSave=!0,t.dispatch(Object(d.Je)(!1)),y.name=n.name,t.recordingsToSave.push(y),k=Object(r.a)(t.state.samples.samplesToSave),t.dispatch(Object(d.gd)([].concat(Object(r.a)(k),[y])));case 32:case"end":return i.stop()}},s)}))):window.alert("Only accepts .wav, .mp3, & .flac files for now")}}).call(this,n(108).Buffer)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(32),a=(Object(r.a)({kick:"kick","hi-hat":"hi-hat",snare:"snare",clap:"clap",rim:"rim",tom:"tom",perc:"perc",breaks:"breaks",bass:"bass",sub:[["808","sub"]],keys:"keys"},"breaks","breaks"),["kick","hi-hat","snare","clap","rim","tom","perc","sub","breaks","keys","808","synth","vocal","vox","bass","pluck","chord","fx"])},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(42),a=n.n(r),i=n(56),s=(n(340),n(1794)),o=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,o,u,l,f,h,p,d,v,m,y,b;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d=function(e){console.info("meta data: ",e),f=e},p=function(e,t,n){console.error("decode error callback",e,t)},h=function(e,t){l.push(e)},u=function(e){var n,r,a=i===o?-1:Math.min(i+e,o);return-1!==a?(n=t.subarray(i,a),r=a-i,i=a):r=0,{buffer:n,readDataLength:r,error:!1}},!0,n=!0,!1,n=!1,0!=(r=s.create_libflac_decoder(!1))){e.next=10;break}return e.abrupt("return");case 10:if(i=0,o=t.buffer.byteLength,l=[],v=1,m=n?s.init_decoder_ogg_stream(r,u,h,p,d):s.init_decoder_stream(r,u,h,p,d),1==(v&=0==m)){e.next=18;break}return e.abrupt("return");case 18:if("file",0,y=1,y&=s.FLAC__stream_decoder_process_until_end_of_stream(r),s.FLAC__stream_decoder_get_state(r),1==y){e.next=24;break}return e.abrupt("return");case 24:return v&=s.FLAC__stream_decoder_finish(r),s.FLAC__stream_decoder_delete(r),b=c(l,f.sampleRate,f.channels,f.bitsPerSample),e.abrupt("return",b.arrayBuffer());case 28:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();function c(e,t,n,r){var a=function(e,t,n,r){var a=r/8,i=e.length*e.BYTES_PER_ELEMENT,s=new ArrayBuffer(44+i),o=new DataView(s);return l(o,0,"RIFF"),o.setUint32(4,36+i,!0),l(o,8,"WAVE"),l(o,12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,n,!0),o.setUint32(24,t,!0),o.setUint32(28,t*n*a,!0),o.setUint16(32,n*a,!0),o.setUint16(34,r,!0),l(o,36,"data"),o.setUint32(40,i,!0),function(e,t,n){for(var r=0;r<n.length;++r,++t)e.setUint8(t,n[r])}(o,44,e),o}(function(e,t,n){var r=n/8,a=24===n||8===n?1:0;a&&(r+=a);for(var i=0,s=0;s<t;++s)i+=u(e,s,r,a);for(var o,c=new Uint8Array(i),l=0,f=0,h=0,p=0,d=0,v=!1,m=0,y=e.length;m<y;++m)for(o=e[m],l=o[0].length,h=0,!1,v=!1;h<l;){for(p=0;p<t;++p)for(d=0;d<r;++d)a?a&&d===r-a?0!==o[p][h+d]&&255!==o[p][h+d]&&console.error("[ERROR] mis-aligned padding: ignoring non-padding value (padding should be 0 or 255) at "+(h+d)+" -> ",o[p][h+d]):8===n?(v=0===o[p][h+d+1],c[f++]=v?128|o[p][h+d]:127&o[p][h+d]):c[f++]=o[p][h+d]:c[f++]=o[p][h+d];h+=r}return c}(e,n,r),t,n,r);return new Blob([a],{type:"audio/wav"})}function u(e,t,n,r){for(var a,i=0,s=r>0?r/n:0,o=e.length-1;o>=0;--o)a=e[o][t].byteLength,i+=r>0?a-s*a:a;return i}function l(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(31),u=n(6),l=n(8),f=n(2),h=n(11),p=n(1),d=n(116),v=n(129),m=n(347);function y(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var O=n(79),k=n(885),j=n(342),w=(n(886),n(215)),x=n(167),S=n(20),P=n(551);function E(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var A=function(e,t){var n,r=E(t.subSequences);try{for(r.s();!(n=r.n()).done;){var a,i=n.value,s=E(i.tracks);try{for(s.s();!(a=s.n()).done;){var o,c=a.value,u=[].concat(Object(h.a)(c.effects),Object(h.a)(c.midiEffects.effects),Object(h.a)(c.liveEffects.effects)),l=E(u);try{for(l.s();!(o=l.n()).done;){var f=o.value;f.effects&&(u=[].concat(Object(h.a)(u),Object(h.a)(f.effects)))}}catch(v){l.e(v)}finally{l.f()}var p=u.find(function(t){return t.id===e});if(p)return p}}catch(v){s.e(v)}finally{s.f()}var d=i.midiEffects.effects.find(function(t){return t.id===e});if(d)return d}}catch(v){r.e(v)}finally{r.f()}},M=function(e,t,n){console.log("findInstrumentPart",e,t,n);var r,a=E(n.subSequences);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(t===P.b){var s=n.lfos.find(function(t){return t.lfo.id===e});return{type:P.b,instrument:s,effect:s,id:e}}if("MODULE_ENVELOPE"===t){var o=n.envelopes.find(function(t){return t.id===e});return o?{type:"MODULE_ENVELOPE",instrument:o,subType:o.number,id:e}:void 0}var c,u=E(i.tracks);try{for(u.s();!(c=u.n()).done;){var l=c.value;if(t===P.c||t===P.a){var f=P.d[t];return R(l,f,t,e)}if(l.instrument&&l.instrument.id===e)return{type:t,track:l,instrument:l.instrument}}}catch(h){u.e(h)}finally{u.f()}}}catch(h){a.e(h)}finally{a.f()}},R=function(e,t,n,r){var a,i=[],s=E(e.midiEffects.effects);try{for(s.s();!(a=s.n()).done;){var o=a.value;o.effects?i=[].concat(Object(h.a)(i),Object(h.a)(o.effects)):i.push(o)}}catch(u){s.e(u)}finally{s.f()}var c=i.find(function(e){return e[t]&&e[t].id===r});if(c)return{type:n,track:e,instrument:c[t],effect:c}},C=n(23),N=function(e){for(var t=e.getJson(),n=[],r=0;r<e.sequencerEngine.numberOfPatterns();r++){var a=e.patterns[r];if(void 0!==a){for(var i={},s=0;s<a.stepBuckets.length;s++){var o=a.stepBuckets[s];if(o.anyEffectAutomation()||o.anyOn())for(var c in o.steps)i[s]=o.getJson()}i.size=a.length(),i.buckets=!0,n.push(i)}}return{patterns:n,patternsConfig:e.patterns.map(function(e){return e.getJson()}),trackData:t,trackEffectChains:e.effectsChains.map(function(e){return e.getJson()}),trackMidiEffects:e.midiEffects.getJson()}},q=n(138),I=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.pattern.volume=n.volume,!("samplers"in n)){e.next=12;break}e.t0=a.a.keys(n.samplers);case 3:if((e.t1=e.t0()).done){e.next=12;break}return i=e.t1.value,s=new q.a(i),e.next=8,s.load();case 8:console.log("USING NEW SOUND TRACK=",t,s),t.useNewSound(s),e.next=3;break;case 12:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),_=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,s,o,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.pattern.volume=n.volume,!("samplers"in n)){e.next=9;break}e.t0=a.a.keys(n.samplers);case 3:if((e.t1=e.t0()).done){e.next=9;break}return i=e.t1.value,e.next=7,t.addSound(i,n.samplers[i],void 0,!1);case 7:e.next=3;break;case 9:if("envelopes"in n)for(s in n.envelopes)t.connectToEnvelope(r.envelopes[n.envelopes[s]]);if("envelopeConnections"in n)for(o in n.envelopeConnections)c=n.envelopeConnections[o],t.connectToEnvelope(r.envelopes[c.envelope],c.mode);case 11:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),D=n(136),F=n(33),L=n(60),B=n(243),z=n(242),J=n(217),V=n(123),H=n(404),U=n(160),G=n(7),W=n.n(G),K=new W.a.Time("16n"),Q=new W.a.Time("16n"),Z=function(){function e(){Object(s.a)(this,e),this.offset=0,this.parameters=[],this.initialBulkValues={}}return Object(o.a)(e,[{key:"registerParameter",value:function(e,t){var n=this.context.forInstrument(this);this.initialBulkValues=Object(p.a)({},this.initialBulkValues,e.setStore(this.store)),e.setMixSession(this.mixSession),e.setContext(n),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getSubDevices",value:function(){return[]}},{key:"getSubDeviceIndex",value:function(e){return this.getSubDevices().map(function(e){return e.value}).indexOf(e)}},{key:"getSubDevice",value:function(e){return this.getSubDevices().map(function(e){return e.value})[e]}},{key:"getName",value:function(){return""}},{key:"name",get:function(){return this.getName()}},{key:"connect",value:function(e){void 0!==e&&(this.getInstrument().connect(e),this.node=e)}},{key:"disconnect",value:function(e){this.getInstrument().disconnect(e),this.node=void 0}},{key:"dispose",value:function(){this.disconnect(),this.parameters.forEach(function(e){return e.dispose()})}},{key:"isMonophonic",value:function(){return!1}},{key:"getEnvelope",value:function(){}},{key:"getInstrument",value:function(){}},{key:"getInstrumentType",value:function(){}},{key:"releaseAll",value:function(){}},{key:"getJson",value:function(){return{instrumentType:this.getInstrumentType()}}},{key:"hasLFO",value:function(){return!1}},{key:"release",value:function(e){e=void 0!==e?e:this.lastNote,this.isMonophonic()&&this.lastNote!==e||void 0!==this.lastNote&&this.getInstrument().triggerRelease([e])}},{key:"trigger",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=e.start,r=null;e.duration&&(r="number"===typeof e.duration?K*e.duration:new W.a.Time(e.duration));var a=isNaN(e.transpose)?0:e.transpose,i=this.getNoteFromTranspose(a),s=null===e.velocity?1:e.velocity,o=null==e.chop?1:e.chop,c=(null==r?K:r)/o.toString();t=t||void 0,this.offset>0&&(void 0===t&&(t=W.a.Master.context.currentTime),t=Q*this.offset+t);var u=t;if((void 0!==this.lastSlideTranspose||this.hasSlide)&&this.releaseSlide(t),r&&e.slide)this.triggerSlide(i,t,r);else{if(void 0!==this.lastSlideTranspose&&(this.triggerSlide(i,t,r,!1),this.hasSlide=!0),t){var l=this.detuneParameter.get(!0);this.detuneSignal.setValueAtTime(l,Math.max(0,t-.001))}this.lastSlideTranspose=void 0,this.lastSlideMax=void 0;var f=this.getInstrument(),h=!this.track||this.track.gated;r===1/0&&(r=null);for(var p=0;p<o;p++)this.lastNote=i,null!==r&&h?f.triggerAttackRelease(i,r,u,s,n,e):f.triggerAttack(i,u,s,n,e),u||(u=W.a.Master.context.currentTime),u+=c;this.lastTranspose=i}}},{key:"hasNotes",value:function(){return!0}},{key:"setEnvelopes",value:function(e){var t=this.getEnvelopes();t.forEach(function(t){return t.attack=new W.a.Time((1+e.attack)/1e3)}),t.forEach(function(t){return t.release=new W.a.Time((1+e.release)/1e3)})}},{key:"getNoteFromTranspose",value:function(e){return e+this.sequencerEngine.transpose}},{key:"getDefaultNote",value:function(){return W.a.Frequency("C3")}},{key:"getParameters",value:function(){return this.parameters}},{key:"getEnvelopes",value:function(){return[]}},{key:"findParameter",value:function(e,t){var n=this.getParameters().filter(function(e){return t===e.name});return 0===n.length?0:n[0]}},{key:"freeze",value:function(){}}]),e}(),Y=n(204),X=n(171),$=n(22),ee=n(126),te=n(112),ne=n(10),re=n(14),ae=["01_Saw","02_Triangle","03_Square","04_Noise","05_Pulse","06_Warm_Saw","07_Warm_Triangle","08_Warm_Square","09_Dropped_Saw","10_Dropped_Square","11_TB303_Square","Bass","Bass_Amp360","Bass_Fuzz_2","Bass_Sub_Dub","Bass_Sub_Dub_2","Brass","Brit_Blues","Brit_Blues_Driven","Buzzy_1","Buzzy_2","Celeste","Chorus_Strings","Dissonant_Piano","Dissonant_1","Dissonant_2","Dyna_EP_Bright","Dyna_EP_Med","Ethnic_33","Full_1","Full_2","Guitar_Fuzz","Harsh","Mkl_Hard","Organ_2","Organ_3","Phoneme_ah","Phoneme_bah","Phoneme_ee","Phoneme_o","Phoneme_ooh","Phoneme_pop_ahhhs","Piano","Putney_Wavering","Throaty","Trombone","Twelve_String_Guitar_1","Twelve_OpTines","Wurlitzer","Wurlitzer_2"],ie={},se=function(e){return new Promise(function(t,n){e in ie?t(ie[e]):fetch(window.isNFT?"waveforms/"+e:"/waveforms/"+e,{}).then(function(e){return e.text()}).then(function(n){var r=JSON.parse(n);ie[e]=r,t(r)})})},oe=function(e){return ie[e]},ce=function(e){var t=ae[Math.round(e)%ae.length];return se(t)},ue=function(e){var t=ae[Math.round(e)%ae.length];return oe(t)},le=n(190),fe=n(119),he=n(59),pe=n(43),de=(new W.a.Frequency("C3"),function(){function e(t,n,r,a,i){!(arguments.length>5&&void 0!==arguments[5])||arguments[5];var o=arguments.length>6?arguments[6]:void 0;Object(s.a)(this,e),this.bulk={},this.sequencerEngine=t,this.id=Object(S.uuid)(),this.track=o,this.name="Osc "+this.id,this.store=t.store,this.mixSession=n,this.context=r.getCopy().forSubDevice(this).forOscillator(this),this.pitchEnvelope=i,this.synthFactory=a,this.polyphonySet=!1,this.volume=new W.a.Gain(.4)}return Object(o.a)(e,[{key:"dispose",value:function(){this.synth&&this.disposeSynth(),this.getParameters().forEach(function(e){return e.dispose()}),this.parameters=void 0}},{key:"create",value:function(){this.initVoices(),this.setupParameters(),this.setupWaveformParameters()}},{key:"isInitialized",value:function(){return void 0!==this.synth}},{key:"getEffectType",value:function(){return he.a}},{key:"getCopy",value:function(e,t,n){return n.oscillatorFrequency=this.oscillatorFrequency,n.oscillatorLevel=this.oscillatorLevel,n.detune=this.detune,n.polyphony=this.polyphony,n.portamento=this.portamento,n.oscillatorType=this.oscillatorType,n.pulseWidth=this.pulseWidth,n}}]),e}());function ve(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var me=function(e){Object(u.a)(n,e);var t=ve(n);function n(e,r,a){return Object(s.a)(this,n),t.call(this,e,r,a,function(e){return new W.a.PolySynth(e,W.a.FMSynth)})}return Object(o.a)(n,[{key:"setupParameters",value:function(){Object(ne.a)(Object(f.a)(n.prototype),"setupParameters",this).call(this),this.harmonicityParameter=new te.a("Harmonicity",this,function(e,t){return e.synth.set({harmonicity:t})},{min:0,max:20,unit:"",defaultValue:3}),this.registerParameter(this.harmonicityParameter),this.modulationIndexParameter=new te.a("modulationIndex",this,function(e,t){return e.synth.set({modulationIndex:t})},{min:0,max:1e3,unit:"",defaultValue:10}),this.harmonicityParameter.setAudioParams(this.synth.voices.map(function(e){return e.harmonicity})),this.modulationIndexParameter.setAudioParams(this.synth.voices.map(function(e){return e.modulationIndex})),this.partialCountParameter=new re.a("Partial Count",this,function(e,t){return e.synth.set({oscillator:{partialCount:t}})},{min:0,automatable:!1,max:16,unit:"",defaultValue:0}),this.registerParameter(this.partialCountParameter),this.registerParameter(this.modulationIndexParameter)}},{key:"harmonicity",get:function(){return this.harmonicityParameter.get()},set:function(e){return this.harmonicityParameter.set(e)}},{key:"modulationIndex",get:function(){return this.modulationIndexParameter.get()},set:function(e){return this.modulationIndexParameter.set(e)}},{key:"partialCount",get:function(){return this.partialCountParameter.get()},set:function(e){return this.partialCountParameter.set(e)}},{key:"refreshParameters",value:function(){Object(ne.a)(Object(f.a)(n.prototype),"refreshParameters",this).call(this),this.harmonicity=this.harmonicity,this.modulationIndex=this.modulationIndex,this.partialCount=this.partialCount,this.harmonicityParameter.setAudioParams(this.synth.voices.map(function(e){return e.harmonicity})),this.modulationIndexParameter.setAudioParams(this.synth.voices.map(function(e){return e.modulationIndex}))}},{key:"getJson",value:function(){var e=Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{harmonicity:this.harmonicity,modulationIndex:this.modulationIndex,partialCount:this.partialCount});return e=Object(ee.b)(e,"harmonicityParameter",this.harmonicityParameter),e=Object(ee.b)(e,"modulationIndexParameter",this.modulationIndexParameter),e=Object(ee.b)(e,"partialCountParameter",this.partialCountParameter)}},{key:"fromJson",value:function(e){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,void 0,!0),console.log("osc =",e),this.harmonicity=parseFloat(e.harmonicity),this.modulationIndex=parseFloat(e.modulationIndex),this.partialCount=e.partialCount,Object(ee.a)(e,"harmonicityParameter",this.harmonicityParameter,this.sequencerEngine),Object(ee.a)(e,"modulationIndexParameter",this.modulationIndexParameter,this.sequencerEngine),Object(ee.a)(e,"partialCountParameter",this.partialCountParameter,this.sequencerEngine)}},{key:"mateJson",value:function(e,t){Object(ne.a)(Object(f.a)(n.prototype),"mateJson",this).call(this,e,t),this.mateParameter("harmonicity",e,this.harmonicityParameter,t),this.mateParameter("modulationIndex",e,this.modulationIndexParameter,t),this.mateParameter("partialCount",e,this.partialCountParameter,t)}}]),n}(de),ye=function(){function e(t,n,r,a){Object(s.a)(this,e),this.sequencerEngine=t,this.store=t.store,this.mixSession=n,this.context=r.getCopy().forSubDevice(this),this.fmSynth=a,this.parameters=[],this.setupParameters()}return Object(o.a)(e,[{key:"synth",get:function(){return this.fmSynth.synth}},{key:"setupParameters",value:function(){this.oscillatorTypeParameter=new re.a("Oscillator Type",this,function(e,t){return e.synth.set({modulation:{type:t}})},{min:0,max:1,unit:"",defaultValue:"triangle",automatable:!1}),this.registerParameter(this.oscillatorTypeParameter),this.partialCountParameter=new re.a("Partial Count",this,function(e,t){return e.synth.set({modulation:{partialCount:t}})},{min:0,max:16,unit:"",defaultValue:0}),this.registerParameter(this.partialCountParameter)}},{key:"oscillatorType",get:function(){return this.oscillatorTypeParameter.get()},set:function(e){this.oscillatorTypeParameter.set(e)}},{key:"partialCount",get:function(){return this.partialCountParameter.get()},set:function(e){return this.partialCountParameter.set(e)}},{key:"refreshParameters",value:function(){this.oscillatorType=this.oscillatorType}},{key:"registerParameter",value:function(e,t){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(){var e={oscillatorType:this.oscillatorType,partialCount:this.partialCount};return e=Object(ee.b)(e,"partialCountParameter",this.partialCountParameter),Object(ee.b)(e,"oscillatorTypeParameter",this.oscillatorTypeParameter)}},{key:"fromJson",value:function(e){this.oscillatorType=e.oscillatorType,e.partialCount&&(this.partialCount=e.partialCount),Object(ee.a)(e,"oscillatorTypeParameter",this.oscillatorTypeParameter),Object(ee.a)(e,"partialCountParameter",this.partialCountParameter)}},{key:"mateJson",value:function(e,t){this.mateParameter("partialCount",e,this.partialCountParameter,t),this.mateParameter("oscillatorType",e,this.oscillatorTypeParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){Object(Y.b)(this.sequencerEngine,e,t,n,r)}}]),e}();window.FADER=.05;var be=function(){function e(t,n,r,a,i,o,c){Object(s.a)(this,e),this.sequencerEngine=t,this.store=this.sequencerEngine.store,this.id=Object(S.uuid)(),this.mixSession=n,this.context=r.getCopy().forSubDevice(this),this.envelope=c||new W.a.ScaledEnvelope,void 0!==a&&(this.audioNode=a,this.envelope.connect(a)),this.min=i,this.max=o,this.parameters=[],this.setupParameters(),this.savedFrequency=void 0}return Object(o.a)(e,[{key:"dispose",value:function(){this.parameters.forEach(function(e){return e.dispose(!0)}),this.envelope.dispose(),this.envelope=void 0,this.parameters=void 0}},{key:"connect",value:function(e){this.envelope.connect(e)}},{key:"disconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.audioNode;this.envelope.disconnect(e)}},{key:"frequency",set:function(e){this.savedFrequency=e;var t=void 0;t=this.level>0?void 0!==this.max?e+this.level*(this.max-e):e+this.level*e*2:void 0!==this.min&&this.min<0?-1*this.level*(this.min+e):this.level*e,this.envelope.min=2*e,isNaN(t)||(this.envelope.max=t)}},{key:"level",get:function(){return void 0===this.levelParameter||void 0===this.levelParameter.get(!0)?0:this.levelParameter.get(!0)},set:function(e){this.levelParameter.set(e,!0,!0)}},{key:"triggerAttack",value:function(e,t){0!==this.level&&this.envelope.triggerAttack(e,t)}},{key:"triggerAttackRelease",value:function(e,t,n){0!==this.level&&(t=Math.max(t,0),this.envelope.triggerAttackRelease(e,t,n))}},{key:"triggerRelease",value:function(e){0!==this.level&&(e=Math.max(e,0),this.envelope.triggerRelease(e))}},{key:"setupParameters",value:function(){var e=this;this.attackParameter=new re.a("Attack",this.envelope,function(t,n){e.envelope&&(e.envelope.attack=(n+1e-6)/1e3)},{min:0,max:2e3,unit:"ms",defaultValue:10}),this.registerParameter(this.attackParameter),this.decayParameter=new re.a("Decay",this.envelope,function(t,n){e.envelope&&(e.envelope.decay=(n+1e-5)/1e3)},{min:0,max:3e3,unit:"ms",defaultValue:500}),this.registerParameter(this.decayParameter),this.sustainParameter=new re.a("Sustain",this.envelope,function(t,n){e.envelope&&(e.envelope.sustain=Math.min(n,.999))},{min:0,max:1,unit:"",defaultValue:.8}),this.registerParameter(this.sustainParameter),this.releaseParameter=new re.a("Release",this.envelope,function(t,n){e.envelope&&(e.envelope.release=(n+1e-6)/1e3)},{min:0,max:8e3,unit:"ms",defaultValue:200}),this.registerParameter(this.releaseParameter),this.attackCurveParameter=new re.a("Attack Curve",this.envelope,function(t,n){e.envelope&&(t.attackCurve=n)},{min:0,max:1e4,unit:"",defaultValue:"linear",automatable:!1}),this.registerParameter(this.attackCurveParameter),this.decayCurveParameter=new re.a("Decay Curve",this.envelope,function(e,t){return e.decayCurve=t},{min:0,max:1e4,unit:"",defaultValue:"exponential",automatable:!1}),this.registerParameter(this.decayCurveParameter),this.releaseCurveParameter=new re.a("Release Curve",this.envelope,function(e,t){return e.releaseCurve=t},{min:0,max:1e4,unit:"",defaultValue:"linear",automatable:!1}),this.registerParameter(this.releaseCurveParameter),this.levelParameter=new re.a("Level",this,function(t,n){e.envelope&&(e.frequency=e.savedFrequency||0)},{min:-1,max:1,unit:"",defaultValue:0}),this.registerParameter(this.levelParameter)}},{key:"refresh",value:function(){this.parameters.filter(function(e){return e.isConnectedToAnyLFO()}).forEach(function(e){return e.callSetter()})}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e,!0,!0)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e,!0,!0)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e,!0,!0)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e,!0,!0)}},{key:"attackCurve",get:function(){return this.attackCurveParameter.get()},set:function(e){this.attackCurveParameter.set(e,!0,!0)}},{key:"decayCurve",get:function(){return this.decayCurveParameter.get()},set:function(e){this.decayCurveParameter.set(e,!0,!0)}},{key:"releaseCurve",get:function(){return this.releaseCurveParameter.get()},set:function(e){this.releaseCurveParameter.set(e,!0,!0)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(e){var t={level:this.level,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackCurve:this.attackCurve,decayCurve:this.decayCurve,releaseCurve:this.releaseCurve,x:this.x,y:this.y,width:this.width,height:this.height};return t=Object(ee.b)(t,"attackParameter",this.attackParameter,void 0,e),t=Object(ee.b)(t,"decayParameter",this.decayParameter,void 0,e),t=Object(ee.b)(t,"sustainParameter",this.sustainParameter,void 0,e),t=Object(ee.b)(t,"releaseParameter",this.releaseParameter,void 0,e),t=Object(ee.b)(t,"attackCurveParameter",this.attackCurveParameter,void 0,e),t=Object(ee.b)(t,"decayCurveParameter",this.decayCurveParameter,void 0,e),t=Object(ee.b)(t,"releaseCurveParameter",this.releaseCurveParameter,void 0,e),t=Object(ee.b)(t,"levelParameter",this.levelParameter,void 0,e)}},{key:"fromJson",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r={};return console.log("SYNTH ENVELOPE FROM JSON CALLED WITH INTERPOLATION=",n,e),this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,Object(fe.a)(this.attackParameter,e.attack,r,n,!0),Object(fe.a)(this.decayParameter,e.decay,r,n),Object(fe.a)(this.sustainParameter,e.sustain,r,n),Object(fe.a)(this.releaseParameter,e.release,r,n),r=Object(p.a)({},r,Object(ee.a)(e,"attackParameter",this.attackParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"decayParameter",this.decayParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"sustainParameter",this.sustainParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"releaseParameter",this.releaseParameter,this.sequencerEngine,t,!0,n)),W.a.Master.context.isOffline?(Object(fe.a)(this.levelParameter,e.level,{},n),Object(ee.a)(e,"levelParameter",this.levelParameter,this.sequencerEngine,t,!0,n)):(Object(fe.a)(this.levelParameter,e.level,r,n),r=Object(p.a)({},r,Object(ee.a)(e,"levelParameter",this.levelParameter,this.sequencerEngine,t,!0,n))),r}},{key:"mateJson",value:function(e,t){this.mateParameter("attack",e,this.attackParameter,t),this.mateParameter("decay",e,this.decayParameter,t),this.mateParameter("sustain",e,this.sustainParameter,t),this.mateParameter("release",e,this.releaseParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){Object(Y.b)(this.sequencerEngine,e,t,n,r)}}]),e}();function ge(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Oe=function(e){Object(u.a)(n,e);var t=ge(n);function n(e,r,a){var i;return Object(s.a)(this,n),(i=t.call(this)).notes=[],i.sequencerEngine=e,i.store=e.store,i.mixSession=r,i.context=a.getCopy().forInstrument(Object(c.a)(i)),i.ampEnvelope=new be(e,r,i.context),i.modulationEnvelope=new be(e,r,i.context),i.filter=new d.a.FilterEffect(e,$.a),i.filterEnvelope=new be(e,r,i.context,i.filter.effectNode.frequency,0,1e4),i.filterEnvelope2=new be(e,r,i.context,i.filter.effectNode.frequency,0,1e4),i.carrierOscillator=new me(e,r,i.context),i.modulatorOscillator=new ye(e,r,i.context,Object(c.a)(i)),i.noiseOscillator=new W.a.NoiseSynth,i.connectSynthToFilter(),i.parameters=[],i.setupParameters(),i.carrierOscillator.onNewSynth=function(){return i.onNewSynth()},i.lastTime=void 0,i.currentNotes=[],i}return Object(o.a)(n,[{key:"getSubDevices",value:function(){return[{label:"Filter",value:this},{label:"Carrier Oscillator",value:this.carrierOscillator},{label:"Modulator Oscillator",value:this.modulatorOscillator},{label:"Amp Envelope",value:this.ampEnvelope},{label:"Filter Envelope",value:this.filterEnvelope},{label:"Filter Envelope 2",value:this.filterEnvelope2},{label:"Modulation Envelope",value:this.modulationEnvelope}]}},{key:"synth",get:function(){return this.carrierOscillator.synth}},{key:"onNewSynth",value:function(){this.connectSynthToFilter(),this.modulatorOscillator.refreshParameters()}},{key:"triggerAttack",value:function(e,t,n){this.filterEnvelope.refresh(),this.filterEnvelope2.refresh();var r=this.carrierOscillator.getNoteFromTranspose(e);this.notes.push(r),this.filterEnvelope.triggerAttack(t,n),this.filterEnvelope2.triggerAttack(t,n),this.synth.triggerAttack(r,t,n),this.noiseOscillator.triggerAttack(t,n)}},{key:"triggerAttackRelease",value:function(e,t,n,r){var a=this.carrierOscillator.getNoteFromTranspose(e);this.notes.push(a),this.filterEnvelope.refresh(),this.filterEnvelope2.refresh(),this.filterEnvelope.triggerAttackRelease(t,n,r),this.filterEnvelope2.triggerAttackRelease(t,n,r),this.synth.triggerAttackRelease(a,t,n,r),this.noiseOscillator.triggerAttackRelease(t,n,r)}},{key:"triggerRelease",value:function(e){var t=this,n=e.map(function(e){return t.carrierOscillator.getNoteFromTranspose(e)});this.filterEnvelope.triggerRelease(),this.filterEnvelope2.triggerRelease(),this.synth.triggerRelease(n),this.noiseOscillator.triggerRelease(W.a.Master.context.currentTime)}},{key:"releaseAll",value:function(){this.synth.releaseAll(),this.notes=[]}},{key:"setEnvelopes",value:function(e){this.carrierOscillator.setEnvelopes(e,this.ampEnvelope),this.setModulationEnvelopes(),this.setAmpEnvelopeForNoise(e)}},{key:"setModulationEnvelopes",value:function(){this.synth.set({modulationEnvelope:{attack:new W.a.Time((1+this.modulationEnvelope.attack)/1e3),decay:new W.a.Time((1+this.modulationEnvelope.decay)/1e3),sustain:this.modulationEnvelope.sustain,release:new W.a.Time((1+this.modulationEnvelope.release)/1e3)}})}},{key:"setAmpEnvelopeForNoise",value:function(){this.noiseOscillator.envelope.attack=new W.a.Time((1+this.ampEnvelope.attack)/1e3),this.noiseOscillator.envelope.decay=new W.a.Time((1+this.ampEnvelope.decay)/1e3),this.noiseOscillator.envelope.sustain=this.ampEnvelope.sustain,this.noiseOscillator.envelope.release=new W.a.Time((1+this.ampEnvelope.release)/1e3)}},{key:"dispose",value:function(){this.noiseOscillator.dispose(),this.filterEnvelope.dispose(),this.filterEnvelope2.dispose(),this.filter.dispose(),this.carrierOscillator.dispose(),this.noiseOscillator=void 0,this.filterEnvelope=void 0,this.filterEnvelope2=void 0,this.filter=void 0,this.carrierOscillator=void 0}},{key:"connectSynthToFilter",value:function(){this.synth.connect(this.filter.effectNode),this.noiseOscillator.connect(this.filter.effectNode)}},{key:"connect",value:function(e){void 0!==e&&this.filter.connect(e)}},{key:"disconnect",value:function(e){this.filter.disconnect(e)}},{key:"setupParameters",value:function(){var e=this;this.filterCutoffParameter=new te.a("Filter Cutoff",this.filter.effectNode.frequency,function(t,n){e.filterEnvelope.frequency=n,e.filterEnvelope2.frequency=n,e.filter.cutoffFrequency=n},{min:0,max:1e4,unit:"HZ",defaultValue:1200,constantAutomationRate:!0}),this.registerParameter(this.filterCutoffParameter,function(e){return e.filter.frequency}),this.filterQParameter=new te.a("Filter Q",this.filter.effectNode.Q,function(t,n){return e.filter.Q=n},{min:0,max:9,unit:"",defaultValue:1}),this.registerParameter(this.filterQParameter,function(e){return e.filter.Q}),this.noiseVolumeParameter=new te.a("noiseVolume",this.noiseOscillator.volume,function(t,n){return e.noiseOscillator.volume.value=n},{min:0,max:1,unit:"db",defaultValue:0}),this.registerParameter(this.noiseVolumeParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getParameters",value:function(){return[].concat(Object(h.a)(this.parameters),Object(h.a)(this.ampEnvelope.parameters),Object(h.a)(this.filterEnvelope.parameters),Object(h.a)(this.filterEnvelope2.parameters),Object(h.a)(this.modulationEnvelope.parameters),Object(h.a)(this.carrierOscillator.parameters),Object(h.a)(this.modulatorOscillator.parameters))}},{key:"filterCutoff",get:function(){return this.filterCutoffParameter.get()},set:function(e){this.filterCutoffParameter.set(e)}},{key:"filterQ",get:function(){return this.filterQParameter.get()},set:function(e){this.filterQParameter.set(e)}},{key:"isMonophonic",value:function(){return 1===this.carrierOscillator.polyphony}},{key:"refreshParameters",value:function(){this.filterQ=this.filterQ,this.filterCutoff=this.filterCutoff}},{key:"getName",value:function(){return"FM Synth"}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return U.c}},{key:"getJson",value:function(){var e={instrumentType:this.getInstrumentType(),filterCutoff:this.filterCutoff,filterQ:this.filterQ,carrierOscillator:this.carrierOscillator.getJson(),modulatorOscillator:this.modulatorOscillator.getJson(),ampEnvelope:this.ampEnvelope.getJson(),filterEnvelope:this.filterEnvelope.getJson(),filterEnvelope2:this.filterEnvelope2.getJson(),modulationEnvelope:this.modulationEnvelope.getJson(),noiseVolume:this.noiseVolumeParameter.get()};return e=Object(ee.b)(e,"filterCutoffParameter",this.filterCutoffParameter),e=Object(ee.b)(e,"filterQParameter",this.filterQParameter),e=Object(ee.b)(e,"noiseVolumeParameter",this.noiseVolumeParameter)}},{key:"fromJson",value:function(e){for(var t in this.instrumentType=e.instrumentType,this.filterCutoff=e.filterCutoff,this.filterQ=e.filterQ,e.lfos)this.lfos[t].fromJson(e.lfos[t]);this.carrierOscillator.fromJson(e.carrierOscillator),this.modulatorOscillator.fromJson(e.modulatorOscillator),this.filterEnvelope.fromJson(e.filterEnvelope),e.filterEnvelope2&&this.filterEnvelope2.fromJson(e.filterEnvelope2),this.ampEnvelope.fromJson(e.ampEnvelope),this.modulationEnvelope.fromJson(e.modulationEnvelope),Object(ee.a)(e,"filterCutoffParameter",this.filterCutoffParameter,this.sequencerEngine),Object(ee.a)(e,"filterQParameter",this.filterQParameter,this.sequencerEngine)}},{key:"getCopy",value:function(e){var t=new n(this.sequencerEngine,this.mixSession,e);return t.fromJson(this.getJson()),t}},{key:"mateJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;this.carrierOscillator.mateJson(e.carrierOscillator,t),this.modulatorOscillator.mateJson(e.modulatorOscillator,t),this.ampEnvelope.mateJson(e.ampEnvelope,t),this.filterEnvelope.mateJson(e.filterEnvelope,t),this.filterEnvelope2.mateJson(e.filterEnvelope2,t),this.modulationEnvelope.mateJson(e.modulationEnvelope,t),this.mateParameter("filterCutoff",e,this.filterCutoffParameter,t),this.mateParameter("filterQ",e,this.filterQParameter,t),this.mateParameter("noiseVolume",e,this.noiseVolumeParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){Object(Y.b)(this.sequencerEngine,e,t,n,r)}},{key:"findParameter",value:function(e,t){var n=e.envelopeType,r=this.getParameters();"AMP"===n?r=this.ampEnvelope.parameters:"MODULATION"===n?r=this.modulationEnvelope.parameters:"FILTER"===n?r=this.filterEnvelope.parameters:"FILTER_2"===n&&(r=this.filterEnvelope2.parameters);var a=r.filter(function(e){return e.name===t});if(0!==a.length)return a[0]}}]),n}(Z),ke=n(174),je=function(e,t,n,r){var a=n.getAllSteps(),i=r.getAllSteps();for(var s in a){var o=a[s];if(0!==o.pLockedParameters.length){var c=i[s];for(var u in o.pLockedParameters){var l=o.pLockedParameters[u],f=we(l,t);f?(f.stepToValue[c.id]=l.stepToValue[o.id],delete l.stepToValue[c.id],delete f.stepToValue[o.id],c.pLockedParameters[u]=f):delete l.stepToValue[o.id]}}}},we=function(e,t){return[].concat(Object(h.a)(t.getAllParameters()),Object(h.a)(t.sequencerEngine.lfos.flatMap(function(e){return e.lfo.parameters}))).filter(function(t){return!!t.context&&(t.context.effect&&e.context.effect?t.context.effect.name===e.context.effect.name:t.context.midiEffect&&e.context.midiEffect?t.context.midiEffect.name===e.context.midiEffect.name:t.context.liveEffect&&e.context.liveEffect?t.context.liveEffect.name===e.context.liveEffect.name:t.context.instrument&&e.context.instrument&&t.context.subDevice&&e.context.subDevice?t.context.subDevice.name===e.context.subDevice.name:!(!t.context.lfoTrack||!e.context.lfoTrack)&&t.context.lfoTrack.number===e.context.lfoTrack.number)}).find(function(t){return t.name===e.name})};function xe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Se=n(346),Pe=n(180);function Ee(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Te=n(304),Ae=n(900),Me=n(44);function Re(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ce=n(425),Ne=n(403);function qe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ie=n(197),_e=n(271),De=n(305),Fe=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i){var s,o,c,u,l,f,h,p,d,v,m;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s=[],o=0,c=new Ie.a(2,function(e,t,n){return[]}),u=t.state.freeze.loops,l=Object(_e.d)(t,0,i)*u,f=0;case 6:if(!(f<r)){e.next=23;break}return p=(h=o)+W.a.Master.context.sampleRate*l*new W.a.Time("32n").toMilliseconds()/1e3,d=Object(De.a)(n,h,p,W.a.Master.context),o=p,e.next=13,c.uploadBufferToIpfs(d);case 13:v=e.sent,(m=new q.a(v)).audioBuffer=d,m.tempo=t.tempo,m.name="Frozen Pattern "+(f+1),m.tags=["Resampled"],s.push(m);case 20:f++,e.next=6;break;case 23:return e.abrupt("return",s);case 24:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),Le=n(231);function Be(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ze(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ze(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Je=function(){function e(t,n,r){Object(s.a)(this,e),this.output=new W.a.Gain(1),this.parameters=[],this.number=r,this.frozenSettings=[],this.frozenSamples=[],this.frozenSamplers=[],this.sequencerEngine=t,this.track=n,this.store=t.store,this.playingParameter=new re.a("playing",this,function(e,t){return[]},{isAlwaysLocked:!0,min:0,max:32,unit:"",defaultValue:void 0,automatable:!0}),this.registerParameter(this.playingParameter),this.gainParameter=new te.c("gain",this.output.gain,{isAlwaysLocked:!0,min:0,max:1,defaultValue:1}),this.registerParameter(this.gainParameter)}return Object(o.a)(e,[{key:"updateRedux",value:function(){this.store.dispatch(Object(C.Bb)(this.track.id,this.number,Object(h.a)(this.frozenSamples)))}},{key:"registerParameter",value:function(e){this.parameters.push(e),e.setStore(this.store),e.setContext((new V.a).forTrack(this.track))}},{key:"playing",get:function(){var e=this.playingParameter.get();if(void 0!==e&&null!==e)return Math.round(e)},set:function(e){this.playingParameter.set(e)}},{key:"saveAndPlayFrozen",value:function(e){this.track.lastFrozenSettings=this.sequencerEngine.getTrackPreset(this.track.trackNumber),this.playing=e,this.track.clearEffectsAndSamplers(),this.track.effectsChains[0].initDefault(),this.track.applyWarp(),this.track.isFrozen=!0,this.track.isFrozenPlaying=!0,this.track.getTrackType()===D.b&&this.track.instrument.dispose()}},{key:"loadFrozenSample",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine.bpm;this.frozenSamples.push(e);var r={slices:void 0,offset:0,transpose:0,volume:0},a=new Le.a(this.track,e,function(e){e.gainNode.connect(t.output)},void 0,r);return a.tempo=n,a.init(),this.output.gain.value=1,this.frozenSamplers.push(a),this.updateRedux(),a}},{key:"getJson",value:function(){var e={frozenSettings:this.frozenSettings,frozenSamples:this.frozenSamples.map(function(e){return e.getId()}),frozenTempos:this.frozenSamplers.map(function(e){return e.tempo})};return e=Object(ee.b)(e,"playingParameter",this.playingParameter),e=Object(ee.b)(e,"gainParameter",this.gainParameter)}},{key:"getJsonSync",value:function(){var e,t={frozenSettings:this.frozenSettings,frozenSamples:this.frozenSamples.map(function(e){return e.getCopy(!0)}),frozenTempos:this.frozenSamplers.map(function(e){return e.tempo})},n=Be(this.frozenSamplers);try{for(n.s();!(e=n.n()).done;){e.value.isCopied=!0}}catch(r){n.e(r)}finally{n.f()}return t=Object(ee.b)(t,"playingParameter",this.playingParameter),t=Object(ee.b)(t,"gainParameter",this.gainParameter)}},{key:"fromJsonSync",value:function(e){for(var t in this.frozenSettings=e.frozenSettings,e.frozenSamples){var n=e.frozenSamples[t];this.loadFrozenSample(n,e.frozenTempos[t]).isCopied=!0}Object(ee.a)(e,"playingParameter",this.playingParameter,this.sequencerEngine),Object(ee.a)(e,"gainParameter",this.gainParameter,this.sequencerEngine)}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.frozenSettings=t.frozenSettings,e.t0=a.a.keys(t.frozenSamples);case 2:if((e.t1=e.t0()).done){e.next=11;break}return n=e.t1.value,r=t.frozenSamples[n],i=new q.a(r),e.next=8,i.load();case 8:this.loadFrozenSample(i,t.frozenTempos[n]),e.next=2;break;case 11:Object(ee.a)(t,"playingParameter",this.playingParameter,this.sequencerEngine);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.frozenSamples.length,this.frozenSamplers.forEach(function(e){return e.dispose()}),this.frozenSamples.forEach(function(e){return e.dispose()}),this.frozenSamplers=void 0,this.frozenSamples=void 0,this.output.dispose(),this.output=void 0}}]),e}(),Ve=n(142),He=n(306);function Ue(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ge(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function We(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}new W.a.Time("16n");var Ke=function(e){return function(e){Object(u.a)(n,e);var t=We(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).frozenSamplesToSave=[],e}return Object(o.a)(n,[{key:"frozenColumn",get:function(){return this.frozenColumns[0]}},{key:"newFrozenColumn",value:function(){if(void 0===this.frozenColumns){var e=new Je(this.sequencerEngine,this,0);return e.output.connect(this.gainNode),this.frozenColumns=[e],e}var t=new Je(this.sequencerEngine,this,this.frozenColumns.length);return t.output.connect(this.gainNode),this.frozenColumns=[].concat(Object(h.a)(this.frozenColumns),[t]),t}},{key:"freeze",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Array.isArray(e)||(e=[e]),!this.isAudioTrack){var r=this.state.effects.pulledEffects.filter(function(e){return(!e.context||e.context.track!==t)&&e.track!==t});this.dispatch(Object(C.Vc)(r));this.getAllParameters().forEach(function(e){return e.isMapped&&e.isMapped.unmap(e)})}var a=this.sample,i=this.isAudioTrack?this.newFrozenColumn():this.frozenColumns[0]||this.newFrozenColumn();a&&(e.forEach(function(e){return e.name=a.name}),e.forEach(function(e){return e.tags=e.tags.concat(a.tags)}),e.forEach(function(e){return e.videoId=a.videoId}),e.forEach(function(e){return e.sourceSample=a})),this.tagFrozenSamples(e),this.frozenSamplesToSave=[].concat(Object(h.a)(this.frozenSamplesToSave),Object(h.a)(e)),this.isFrozen||n||(this.lastFrozenSettings=this.sequencerEngine.getTrackPreset(this.trackNumber,!1)),i.frozenSettings.push(this.isAudioTrack?{}:this.lastFrozenSettings);var s=this.isFrozen;this.store.dispatch(Object(C.le)(this.subSequence.id,this.id,!0)),this.isAudioTrack||(this.clearEffectsAndSamplers(),this.effectsChains[0].initDefault(),this.applyWarp()),e.forEach(function(e){return i.loadFrozenSample(e,void 0)}),this.getTrackType()!==D.b||s?this.getTrackType()!==D.c||s||this.tracks.forEach(function(e){var t=e.track;return t.instrument&&t.instrument.dispose()}):this.instrument.dispose(),i.playing=i.frozenSamples.length-1,this.gated=!1,this.cachedPlayhead=void 0,this.parametersToScale=void 0,this.sequencerEngine.selectTrack(0),this.sequencerEngine.selectTrack(this.trackNumber),this.isEnabled&&!this.isAudioTrack&&this.setIsEnabled(!1),this.skipMidiMasterParameter.set(!0),this.trackIsLoading=!1}},{key:"clearEffectsAndSamplers",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.volumeParameter.deleteAutomations(),this.volumeParameter.deleteLocks(),this.effectsChains.forEach(function(e){return e.clear()}),this.midiEffects.effects=[],this.liveEffects.effects=[],this.tracks&&this.tracks.forEach(function(e){var t=e.track;t.effectsChains.forEach(function(e){return e.clear()}),t.midiEffects.effects=[],t.liveEffects.effects=[]});var e=this.getAllParameters().filter(function(e){return e.automations&&e.automations.length>0});this.sequencerEngine.store.dispatch(Object(C.c)(e))}},{key:"triggerFrozenSample",value:function(e){var t=new F.a;t.loadDefaults(),this.midiEffects.input(t,e,0)}},{key:"isFrozen",get:function(){return(this.store.getState().tracks.tracksFrozen[this.subSequence.id]||{})[this.id]},set:function(e){this.store.dispatch(Object(C.le)(this.subSequence.id,this.id,e))}},{key:"unfreeze",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s,o,c=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.cachedPlayhead=void 0,t=this.lastFrozenSettings,this.clearEffectsAndSamplers(),this.store.dispatch(Object(C.le)(this.subSequence.id,this.id,!1)),e.next=6,this.unfreezeInstrument(t);case 6:return this.trackData=new F.a(this.sequencerEngine,this.mix,(new V.a).forTrack(this)),this.trackData.loadDefaults(),t.trackParameters&&(this.gated=t.trackParameters.gated),this.trackData.loadFromJson(t.trackData,void 0,!1,!1,this.sequencerEngine),this.effectsChains[0].dispose(),e.next=13,this.sequencerEngine.loadEffectsPreset(t,!1,this);case 13:if(!this.tracks){e.next=34;break}n=0,r=Ue(this.tracks),e.prev=16,r.s();case 18:if((i=r.n()).done){e.next=26;break}return s=i.value,o=s.track,e.next=23,this.sequencerEngine.loadEffectsPreset(t.trackParameters.tracks[n],!1,o);case 23:n++;case 24:e.next=18;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(16),r.e(e.t0);case 31:return e.prev=31,r.f(),e.finish(31);case 34:this.skipMidiMasterParameter.set(!1),this.frozenColumns.forEach(function(e){return e.frozenSamplers.forEach(function(e){return e.release()})}),this.frozenColumns.forEach(function(e){return e.playing=void 0}),setTimeout(function(){c.loadLostParameters()},750);case 38:case"end":return e.stop()}},e,this,[[16,28,31,34]])}));return function(){return e.apply(this,arguments)}}()},{key:"unfreezeInstrument",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.frozenJson}},{key:"getFreezeJson",value:function(){return{lastFrozenSettings:this.lastFrozenSettings,frozenColumns:this.frozenColumns.map(function(e){return e.getJson()})}}},{key:"getFreezeJsonSync",value:function(){return{lastFrozenSettings:this.lastFrozenSettings,frozenColumns:this.frozenColumns.map(function(e){return e.getJsonSync()})}}},{key:"loadFreezeJsonSync",value:function(e){for(var t in this.lastFrozenSettings=e.lastFrozenSettings,e.frozenColumns){(this.frozenColumns[parseInt(t)]||this.newFrozenColumn()).fromJsonSync(e.frozenColumns[t])}}},{key:"loadFreezeJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.lastFrozenSettings=t.lastFrozenSettings,e.t0=a.a.keys(t.frozenColumns);case 2:if((e.t1=e.t0()).done){e.next=9;break}return n=e.t1.value,r=this.frozenColumns[parseInt(n)]||this.newFrozenColumn(),e.next=7,r.fromJson(t.frozenColumns[n]);case 7:e.next=2;break;case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"applyWarp",value:function(){this.operationManager.dispatch(Object(Me.b)(new He.a(this),this))}},{key:"dragFreezeIntoColumn",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.newFrozenColumn(),r=void 0,a=void 0,i=void 0,s=Ue(this.frozenColumns);try{for(s.s();!(t=s.n()).done;){var o=t.value;for(var c in o.frozenSamples)if(o.frozenSamples[c].ipfsHash===e){a=o.frozenSamples[c],r=o.frozenSamplers[c],i=o.frozenSettings[c],o.frozenSamples.splice(c,1),o.frozenSettings.splice(c,1),o.frozenSamplers.splice(c,1),o.updateRedux();break}}}catch(u){s.e(u)}finally{s.f()}void 0!==r&&(r.gainNode.disconnect(),n.frozenSamplers.push(r),n.frozenSamples.push(a),n.frozenSettings.push(i),r.gainNode.connect(n.output),n.playing=0,n.updateRedux())}},{key:"disposeFreezes",value:function(){this.frozenColumns.forEach(function(e){return e.dispose()}),this.frozenColumns=void 0}},{key:"freezeAllPatterns",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s,o,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.dispatch(Object(C.bc)("Freezing track's patterns")),e.next=3,Object(O.a)(250);case 3:return this.sequencerEngine.stop(),e.next=6,Object(_e.c)(this.sequencerEngine,this);case 6:return t=e.sent,e.next=9,Fe(this.sequencerEngine,t,this.patterns.length,[this]);case 9:for(s in n=e.sent,this.freeze(n),r=this.sequencerEngine.state.freeze.loops,i=Object(_e.d)(this.sequencerEngine,0,this.sequencerEngine.tracks)*r,this.patterns){for(s=parseInt(s),this.switchToPattern(s),o=i/this.pattern.length(),c=0;c<Math.log2(o);c++)this.pattern.doubleTrackLength();this.frozenColumns[0].playing=s,this.store.dispatch(Object(C.bc)(void 0))}case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"tagFrozenSamples",value:function(e){var t=this;if(this.instrument){var n=U.d[this.instrument.getInstrumentType()];e.forEach(function(e){return e.tags.push(n)}),this.presetName&&e.forEach(function(e){return e.tags.push(t.presetName)})}}}]),n}(e)};function Qe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ze=new F.a,Ye=n(62),Xe=n(246);function $e(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return et(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return et(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function et(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function tt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var nt=["Duration","Transpose","Velocity","Chop","Panning","Slice","reverse"],rt=function(e){Object(u.a)(n,e);var t=tt(n);function n(e,r,a,i,o,c){var u;return Object(s.a)(this,n),(u=t.call(this,e,r,a,i,o,c)).annotations=[],u.setupAuxEventParameters(),u}return Object(o.a)(n,[{key:"getStepDataParams",value:function(){return nt}},{key:"getCopy",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,t,r,a,i,s){return new n(e,t,r,a,i,s)},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this.trackData.getCopy(void 0,void 0,void 0,void 0,!1),s=[].concat(this.soundIds),o=t(this.trackNumber,r,this.mixSession,this.patterns.length,this.update,r.currentSubSequence);o.stepGroups=this.stepGroups;var c=this.patterns.map(function(e){return e.getCopy(void 0,void 0,o)}),u=this.currentPattern,l=c[u];for(var f in c){var h=c[f];for(var p in h.stepBuckets)for(var d in h.stepBuckets[p].track=o,h.stepBuckets[p].steps)h.stepBuckets[p].steps[d].track=o;h.track=o}this.sample&&(o.sample=this.sample.getCopy()),o.lfosTrack&&o.lfosTrack.lfos.forEach(function(t,n){return t.lfo.fromJson(e.lfosTrack.lfos[n].getJson(),a)}),o.envelopesTrack&&o.envelopesTrack.envelopes.forEach(function(t,n){return t.envelope.fromJson(e.envelopesTrack.envelopes[n].getJson(),a)}),o.name=this.name,o.videoId=this.videoId,o.effectsChains[0].dispose(),o.effectsChains=this.effectsChains.map(function(e){return e.getCopy(o,r,a)}),o.midiEffects=this.midiEffects.getCopy(o,a),o.liveEffects=this.liveEffects.getCopy(o,a),o.trackData=i,o.patterns=c,o.currentPattern=u,o.pattern=l,o.soundIds=s,o.gated=this.gated;for(var v=0;v<c.length;v++)je(0,o,this.patterns[v],c[v]);var m,y=$e(this.connectedEnvelopes.filter(function(e){return e.envelope}).map(function(e){return e.getJson()}));try{for(y.s();!(m=y.n()).done;){var b=m.value,g=r.envelopes[b.envelope];o.connectToEnvelope(g,b.mode)}}catch(x){y.e(x)}finally{y.f()}var O={};for(var k in this.samplers)O[k]=this.samplers[k].getCopy(function(e){return o.onNewSampler(o,e)},o);for(var j in o.samplers=O,o.updateSteps(!0),o.setSends(r.sends),o.sendNodeVolumeParameters)this.sendNodeVolumeParameters[j]&&o.sendNodeVolumeParameters[j].copyFrom(this.sendNodeVolumeParameters[j],r);if(o.volumeParameter.copyFrom(this.volumeParameter,r),o.isFrozen=this.isFrozen,o.isFrozen){var w=this.getFreezeJsonSync();o.loadFreezeJsonSync(w)}return this.samplesStream?o.samplesStream=this.samplesStream.getCopy(o.sample):o.samplesStream=new Te.a(o.sample,this.sequencerEngine),o.presetName=this.presetName,o}},{key:"addNotes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine.bpm,r=W.a.Time("16n").toMilliseconds();e=e.map(function(e){var a=e.velocity/127;return{transpose:e.pitch-60,startTime:1e3*e.startTime,velocity:a,duration:n/t.sequencerEngine.bpm*(1e3*(e.endTime-e.startTime))/r}});W.a.Time("32n").toMilliseconds();var a=-1;for(var i in e){var s=Object(Ae.a)(e[i].startTime,n,this.sequencerEngine.bpm);e[i].step=s.stepNumber,e[i].position=s.offset,e[i].step>a&&(a=e[i].step)}for(;a>=this.pattern.length();)this.sequencerEngine.doubleTrackLength(this.trackNumber);var o=this.getEasyPattern();e.forEach(function(e){return o.addStep(t.getStepDataForNote(e),e.step,ke.a.baseResolution,e.position,!1,!0)}),o.update(!1),this.updateSteps()}},{key:"getStepDataForNote",value:function(e){var t=new F.a(this.sequencerEngine,void 0,void 0,this);return t.on=!0,t.transpose=e.transpose,t.duration=e.duration,t.velocity=e.velocity,t}},{key:"toggleStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.store.getState().sequencer.resolution,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.pattern.toggleStep(ke.a.baseResolution.transformStepAtResolution(e,t),t,n,this.trackData.transpose===n),this.pattern.syncBuckets(),this.updateSteps()}},{key:"getStep",value:function(e){return this.pattern.getAnyStep(e%this.pattern.length())}},{key:"recordHit",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;t=t||ke.a.baseResolution;var o=new F.a(void 0,void 0,void 0,this);if(o.on=!0,o.slice=n,o.duration=r,o.transpose=a,o.velocity=i,o.release=s,void 0===this.currentPattern){var c=new B.a(this.sequencerEngine,this),u=e-e%t.transformStepAtResolution2(16,ke.a.baseResolution);c.startStep=ke.a.baseResolution.transformStepAtResolution2(u,t),this.patterns.push(c),this.switchToPattern(this.patterns.length-1),this.updateSteps()}void 0!==this.pattern.startStep&&(e-=t.transformStepAtResolution2(this.pattern.startStep,ke.a.baseResolution)),this.pattern.isRecording=!0,this.sequencerEngine.operationManager.dispatch(Object(Me.n)(this,o,e,t,this.state.sequencer.displayResolution))}},{key:"syncBuckets",value:function(e){this.pattern.syncBuckets(e.isTriplet),this.pattern.clearCache()}},{key:"recordUnquantizedHit",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=ke.a.baseResolution,c=new F.a;c.on=!0,c.slice=t,c.velocity=i,c.duration=n,c.transpose=a,c.release=s;var u=(e+r)%this.pattern.length(o);this.sequencerEngine.operationManager.dispatch(Object(Me.n)(this,c,Math.max(0,u),o,this.state.sequencer.displayResolution,!1))}},{key:"selectSlice",value:function(e,t){for(var n=-16,r=0;r<this.soundIds.length;r++){var a=this.samplers[this.soundIds[r]].getNumberOfSlices();n<a&&(n=a)}t%=n;var i=this.pattern.stepBuckets[e];for(var s in i.steps)i.steps[s].slice=t}}]),n}(Object(Ye.a)(function(e){return function(e){Object(u.a)(n,e);var t=Qe(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).backStreams=[],e.forwardStreams=[],e}return Object(o.a)(n,[{key:"newSampleStream",value:function(e){this.samplesStream&&this.backStreams.push(this.samplesStream),this.forwardStreams.forEach(function(e){return e.dispose()}),this.forwardStreams=[],this.samplesStream=e}},{key:"backSamplesStream",value:function(){if(console.log("BACK SAMPLES STREAM CALLED"),0!==this.backStreams.length){var e=this.backStreams.pop();this.forwardStreams=[this.samplesStream].concat(Object(h.a)(this.forwardStreams)),this.samplesStream=e}}},{key:"forwardSamplesStream",value:function(){console.log("FWD SAMPLES STREAM CALLED");var e=this.forwardStreams.shift();this.backStreams.push(this.samplesStream),this.samplesStream=e}},{key:"getSamplesStream",value:function(){return this.samplesStream}},{key:"auditionNext",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(s.length>0&&void 0!==s[0])||s[0],s.length>1&&void 0!==s[1]&&s[1],!this.isFrozen){e.next=4;break}return e.abrupt("return");case 4:if(t=this.instrumentRack?this.instrumentRack.trackNumber:this.trackNumber,this.store.dispatch(Object(C.ne)(this.subSequence.id,t,!0)),(new Date).getTime(),e.prev=7,!this.loadingAudition){e.next=11;break}return this.store.dispatch(Object(C.ne)(this.subSequence.id,t,!1)),e.abrupt("return");case 11:n=this.getSamplesStream(),r=0;case 13:if(!(r<8)||n.hasNext()){e.next=22;break}if(7!==r){e.next=17;break}return this.store.dispatch(Object(C.ne)(this.subSequence.id,t,!1)),e.abrupt("return");case 17:return e.next=19,Object(O.a)(200);case 19:r++,e.next=13;break;case 22:return this.loadingAudition=!0,e.next=25,n.getNext();case 25:i=e.sent,this.store.dispatch(Object(C.ne)(this.subSequence.id,t,!1)),this.loadingAudition=!1,this.releaseAll(),this.useNewSound(i),Ze.track=this,Ze.duration=4,this.sequencerEngine.playing||this.trigger(Ze),this.addSoundToBrowsedSamples(i),(new Date).getTime(),e.next=41;break;case 38:e.prev=38,e.t0=e.catch(7),this.loadingAudition=!1;case 41:case"end":return e.stop()}},e,this,[[7,38]])}));return function(){return e.apply(this,arguments)}}()},{key:"auditionPrevious",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i.length>0&&void 0!==i[0])||i[0],i.length>1&&void 0!==i[1]&&i[1],!this.isFrozen){e.next=4;break}return e.abrupt("return");case 4:if(t=this.instrumentRack?this.instrumentRack.trackNumber:this.trackNumber,this.store.dispatch(Object(C.ne)(this.subSequence.id,t,!0)),e.prev=6,n=this.getSamplesStream(),!this.loadingAudition){e.next=11;break}return this.store.dispatch(Object(C.ne)(this.subSequence.id,t,!1)),e.abrupt("return");case 11:if(n.hasPrevious()){e.next=14;break}return this.store.dispatch(Object(C.ne)(this.subSequence.id,t,!1)),e.abrupt("return");case 14:return this.loadingAudition=!0,e.next=17,n.getPrevious();case 17:return r=e.sent,this.store.dispatch(Object(C.ne)(this.subSequence.id,t,!1)),this.loadingAudition=!1,this.addSoundToBrowsedSamples(r),this.releaseAll(),e.next=24,this.useNewSound(r);case 24:Ze.track=this,Ze.duration=4,this.sequencerEngine.playing||this.trigger(Ze),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(6),this.loadingAudition=!1;case 32:case"end":return e.stop()}},e,this,[[6,29]])}));return function(){return e.apply(this,arguments)}}()},{key:"useSound",value:function(e,t){if(t)for(var n in this.samplers)this.samplers[n].dispose(),delete this.samplers[n];this.sample=e,this.soundIds=[e.getId()],this.toAudition.push(e.getId()),this.loadTrackInfo(!0,e)}},{key:"loadAndUseNewSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isLoaded()){e.next=3;break}return e.next=3,t.load();case 3:for(n in this.samplers)this.samplers[n].isChosen=!1;this.samplers[t.getId()]?this.samplers[t.getId()].isChosen=!0:this.loadTrackInfo(!0,t),this.soundIds=[t.getId()],this.videoId=t.videoId,this.sample=t,void 0===this.videoId&&this.getTrackType(),this.name=t.name;case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"useNewSound",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Object.keys(this.samplers)[0];if(r!==e.ipfsHash){var a=this.samplers[r];if(!a)return this.useSound(e,!0),void(this.pad&&this.pad.sendTags());this.samplers[e.getId()]=a,delete this.samplers[r],a.sample=e,this.soundIds=[e.getId()],this.videoId=e.videoId,this.sample=e,void 0===this.videoId&&this.getTrackType(),this.name=e.name,a.replaceBuffer(e.audioBuffer,n),t&&(Ze.track=this,Ze.duration=4,this.sequencerEngine.playing||this.trigger(Ze)),this.pad&&this.pad.sendTags()}}},{key:"auditionSeek",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.dispatch(Object(C.ne)(this.subSequence.id,this.trackNumber,!0)),e.next=3,this.samplesStream.seek(t);case 3:if(n=e.sent){e.next=7;break}return this.store.dispatch(Object(C.ne)(this.subSequence.id,this.trackNumber,!1)),e.abrupt("return");case 7:return this.loadingAudition=!1,this.addSoundToBrowsedSamples(n),this.releaseAll(),e.next=12,this.useNewSound(n);case 12:Ze.track=this,Ze.duration=4,this.sequencerEngine.playing||this.trigger(Ze),this.store.dispatch(Object(C.ne)(this.subSequence.id,this.trackNumber,!1));case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"auditionSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]&&o[1],r=o.length>2?o[2]:void 0,i=!(o.length>3&&void 0!==o[3])||o[3],this.store.dispatch(Object(C.ne)(this.subSequence.id,this.trackNumber,!0)),s=this.sample,"string"===typeof t&&(t=new q.a(t)),t.isLoaded()){e.next=10;break}return e.next=9,t.load();case 9:t.samplesStream&&(r=t.samplesStream.getCopy(t));case 10:this.savedSoundIds=Object(h.a)(this.soundIds),this.soundIds=[t.getId()],this.toAudition.push(t.getId()),this.auditionedSounds.push(t.getId()),r&&(r.counter=r.sounds.indexOf(t.getId())),this.samplesStream&&n&&this.samplesStream.dispose(),this.samplesStream=r||new Te.a(t,this.sequencerEngine),this.loadTrackInfo(!0,t),i&&this.addSoundToBrowsedSamples(t,s);case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addSoundToBrowsedSamples",value:function(e,t){var n=this,r=this.state.tracks.trackBrowsedSamples[this.id]||[];if(t){var a=r.indexOf(t);a>-1&&(r.slice(0,a).forEach(function(e){var t=e.ipfsHash,r=n.samplers[t];r&&(r.dispose(),delete n.samplers[t]),e.dispose(!0)}),r=r.slice(a))}if(!(r.indexOf(e)>-1)){var i=[e].concat(Object(h.a)(r.filter(function(t){return t.ipfsHash!==e.ipfsHash})));this.store.dispatch(Object(C.ie)(this.id,i))}}},{key:"isAuditioning",value:function(){return this.auditionedSounds.length>0}},{key:"completeAudition",value:function(){for(var e in this.auditionedSounds)if(-1==this.soundIds.indexOf(this.auditionedSounds[e])){var t=this.samplers[this.auditionedSounds[e]];t&&(t.dispose(),delete this.samplers[this.auditionedSounds[e]])}this.auditionedSounds=[],this.store.dispatch(Object(C.ad)(void 0))}},{key:"cancelAudition",value:function(){this.isAuditioning()&&(this.soundIds=this.savedSoundIds,this.revertAuditionedSounds()),this.store.dispatch(Object(C.ad)(void 0))}},{key:"revertAuditionedSounds",value:function(){for(var e in this.auditionedSounds){var t=this.samplers[this.auditionedSounds[e]];t&&(t.dispose(),delete this.samplers[this.auditionedSounds[e]])}this.auditionedSounds=[]}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Ee(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"onRestart",value:function(e){"clear"!==e?void 0!==e.stepNumber?this.restartedAtStepNumber=e.stepNumber:this.restartedAtStepNumber=this.sequencerEngine.trackStep:this.restartedAtStepNumber=void 0}},{key:"getPatternStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isMetronome){var n=void 0===this.pattern.startStep?0:this.pattern.startStep,r=this.pattern.length();return this.subSequence.isTrack?e-n:e%r}if(!t){if(!this.playheadEffect&&this.pattern&&1===this.speedFactor){if(this.isLooping){var a=this.loopStart;e%=this.loopLength||8,e+=a}return e%this.length}return this.lastPatternStep||0}void 0!==this.restartedAtStepNumber&&(e-=this.restartedAtStepNumber);var i=void 0===this.pattern.startStep?0:this.pattern.startStep,s=this.length,o=this.playheadDirection;if(o===Se.a)return this.getBrownian(e,t);e=e*this.speedFactor+Math.floor(this.offset);var c=this.subSequence.isTrack?e-i:e%s;if(this.isLooping){var u=this.loopStart;c%=this.loopLength||8,c+=u}return t&this.speedFactor<1&&c===this.lastPatternStep?void 0:(o===Se.c&&(o=Math.floor(e/s)%2===0?Se.b:Se.d),o===Se.d&&(this.playheadDirection===Se.c?(c=s-c)===s&&(c=s-2):c=s-c-2),this.lastPatternDirection=o,this.lastPatternStep=c,c)}},{key:"isPlayheadReversed",value:function(){return this.lastPatternDirection===Se.d}},{key:"playheadEffect",get:function(){return this.cachedPlayhead?this.cachedPlayhead:(this.cachedPlayhead=this.liveEffects.effects.find(function(e){return e.effect===Pe.e}),this.cachedPlayhead)}},{key:"playheadDirection",get:function(){var e=this.playheadEffect;return e?this.subSequencePlayhead.direction!==Se.b?this.subSequencePlayhead.direction:e.direction:Se.b}},{key:"subSequencePlayhead",get:function(){return this.subSequence.playhead}},{key:"speedFactor",get:function(){var e=this.playheadEffect;return(e?this.subSequence.playhead.speedFactor*e.speedFactor:this.subSequence.playhead?this.subSequence.playhead.speedFactor:1)*this.sequencerEngine.higherOrderSequencer.getSpeedForModule(this.subSequence)}},{key:"offset",get:function(){var e=this.playheadEffect;return e?e.offset:0}},{key:"walk",get:function(){var e=this.playheadEffect;return e?e.walk:2}},{key:"getBrownian",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===this.lastPatternStep&&t)return this.lastPatternStep=e,e;if(((e=this.lastPatternStep)+1)%this.walk===0){var n=Math.random();n<.5?e+=1:e-=n<.75?2*this.walk-1:this.walk-1,e<0?e=this.length-this.walk:e%=this.length}else e++;return t&&(this.lastPatternStep=e),e}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=xe(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getParametersToShow",value:function(){var e=Object(h.a)(this.effects);for(var t in this.effects){var n=this.effects[t];"Effect Rack"===n.name&&(e=[].concat(Object(h.a)(e),Object(h.a)(n.effects),Object(h.a)(n.macros.map(function(e){return e.macroParameter}))))}if(this.tracks)for(var r in this.tracks)e=[].concat(Object(h.a)(e),Object(h.a)(this.tracks[r].track.effects));var a=e.find(function(e){return"Filter"===e.name}),i=(e.find(function(e){return"EQ 8"===e.name}),e.find(function(e){return"Tape Delay"===e.name})),s=this.midiEffects.effects.find(function(e){return"Warp"===e.name}),o=this.midiEffects.effects.find(function(e){return"Tidal"===e.name}),c=[];return a&&c.push(a.cutoffParameter),i&&(c.push(i.rateParameter),c.push(i.wetParameter)),s&&c.push(s.loopLengthParameter),o&&c.push(o.cycleParameter),c}}]),n}(e)},Ke,function(e){return function(e){Object(u.a)(n,e);var t=Re(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"convertToSampledInstrument",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.pad,n=void 0,t&&(n=t.slots.indexOf(this)),r=this.sequencerEngine.addSampledInstrumentTrack(!1,!0),i=this.sample,r.instrument.newSample(0,i,this.samplesStream.getCopy(this.sample)),this.convertGenericTrack(r),r.sample=i,t&&t.addTrack(r,n);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"copyPatterns",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.patterns.map(function(e){return e.getCopy(void 0,void 0,t)}),e.next=3,Promise.all(n);case 3:for(r in n=e.sent){for(s in(i=n[r]).stepBuckets)for(o in i.stepBuckets[s].track=t,i.stepBuckets[s].steps)i.stepBuckets[s].steps[o].track=t;i.track=t}return e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"copyEffects",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.effectsChain.getJson(),e.next=3,t.midiEffects.fromJson(this.midiEffects.getJson());case 3:return e.next=5,t.effectsChain.fromJson(n,this.sequencerEngine.tracks,this.trackNumber);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"convertGenericTrack",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyPatterns(t);case 2:return t.patterns=e.sent,t.pattern=t.patterns[this.currentPattern],t.stepGroups=t.patterns.map(function(e){return e.getAllGroups()}).reduce(function(e,t){return[].concat(Object(h.a)(e),Object(h.a)(t))},[]),n=this.trackNumber,(r=this.sequencerEngine.tracks).splice(n,1),i=this.getAllParameters(),s=i.filter(function(e){return e.automations&&e.automations.length>0}),this.sequencerEngine.store.dispatch(Object(C.c)(s)),e.next=13,this.copyEffects(t);case 13:this.sequencerEngine.tracks=[].concat(Object(h.a)(r.slice(0,n)),[this],Object(h.a)(r.slice(n))),this.sequencerEngine.deleteTrack(n,t),t.pattern.updateStepResolutionTree(),this.sequencerEngine.updateSteps(),this.sequencerEngine.selectTrack(n),t.getAllParameters().filter(function(e){return e.automations&&e.automations.length>0}).forEach(function(e){return e.automation.updateRedux()}),setTimeout(function(){t.tracks?t.tracks[0].track.loadLostParameters():t.loadLostParameters()},250);case 22:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"convertToInstrumentRack",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.sequencerEngine.addInstrumentRackTrack(!1,!0),(n=this.getTrackType())!==D.f){e.next=6;break}t.addSample(this.sample,this.samplesStream.getCopy(this.sample)),e.next=11;break;case 6:if(n!==D.b){e.next=11;break}return r=t.addInstrumentType(this.getInstrumentType()),i=this.getJson(),e.next=11,r.track.fromJson(i,void 0,!1,!1,!0,!0);case 11:return e.next=13,this.convertGenericTrack(t);case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=qe(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"setupAuxEventParameters",value:function(){this.createAuxEventType("A"),this.createAuxEventType("B"),this.createAuxEventType("C"),this.createAuxEventType("D"),this.accumulators={}}},{key:"createAuxEventType",value:function(e){var t="auxEvent"+e,n=new re.a(t+"Type",this,function(e,t){return[]},{defaultValue:Ne.b,automatable:!1}),r=new re.a(t+"Variable",this,function(e,t){return[]},{defaultValue:"transpose",automatable:!1}),a=new re.a(t+"Limit",this,function(e,t){return[]},{defaultValue:1,automatable:!1,min:0,max:32}),i=new re.a(t+"Mode",this,function(e,t){return[]},{defaultValue:Ce.a,automatable:!1});this[t+"TypeParameter"]=n,this[t+"LimitParameter"]=a,this[t+"ModeParameter"]=i,this[t+"VariableParameter"]=r,this.registerParameter(n),this.registerParameter(a),this.registerParameter(i),this.registerParameter(r)}},{key:"auxEventAType",get:function(){return this.auxEventATypeParameter.get()}},{key:"auxEventBType",get:function(){return this.auxEventBTypeParameter.get()}},{key:"auxEventCType",get:function(){return this.auxEventCTypeParameter.get()}},{key:"auxEventDType",get:function(){return this.auxEventDTypeParameter.get()}},{key:"getAuxLimit",value:function(e){return this["auxEvent"+e.split(" ")[2]+"LimitParameter"].get()}},{key:"getAuxVariable",value:function(e){return this["auxEvent"+e.split(" ")[2]+"VariableParameter"].get()}},{key:"getAuxMode",value:function(e){return this["auxEvent"+e.split(" ")[2]+"ModeParameter"].get()}},{key:"getAuxJson",value:function(){for(var e={},t=0,n=["A","B","C","D"];t<n.length;t++){var r=n[t],a="auxEvent"+r+"TypeParameter",i="auxEvent"+r+"VariableParameter",s="auxEvent"+r+"LimitParameter",o="auxEvent"+r+"ModeParameter";e[a]=this[a].getJson(),e[i]=this[i].getJson(),e[s]=this[s].getJson(),e[o]=this[o].getJson()}return e}},{key:"fromAuxJson",value:function(e){for(var t=0,n=["A","B","C","D"];t<n.length;t++){var r=n[t],a="auxEvent"+r+"TypeParameter",i="auxEvent"+r+"VariableParameter",s="auxEvent"+r+"LimitParameter",o="auxEvent"+r+"ModeParameter";this[a].fromJson(e[a]),this[i].fromJson(e[i]),this[s].fromJson(e[s]),this[o].fromJson(e[o])}}}]),n}(e)})(ke.a.Track)),at=n(227),it=function(){function e(t,n,r,a){Object(s.a)(this,e),this.synth=t,this.store=n,this.mixSession=r,this.context=a,this.parameters=[],this.setupParameters()}return Object(o.a)(e,[{key:"onNewSynth",value:function(e){this.synth=e,this.refreshParameters()}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"baseFrequency",get:function(){return this.baseFrequencyParameter.get()},set:function(e){this.baseFrequencyParameter.set(e)}},{key:"octaves",get:function(){return this.octavesParameter.get()},set:function(e){this.octavesParameter.set(e)}},{key:"refreshParameters",value:function(){this.baseFrequency=this.baseFrequency,this.octaves=this.octaves,this.attack=this.attack,this.decay=this.decay,this.sustain=this.sustain,this.release=this.release}},{key:"setupParameters",value:function(){this.attackParameter=new re.a("Filter Envelope Attack",this,function(e,t){return e.synth.set({filterEnvelope:{attack:t/1e3}})},{min:0,max:1e4,unit:"ms",defaultValue:60}),this.registerParameter(this.attackParameter),this.decayParameter=new re.a("Filter Envelope Decay",this,function(e,t){return e.synth.set({filterEnvelope:{decay:t/1e3}})},{min:0,max:1,unit:"ms",defaultValue:60}),this.registerParameter(this.decayParameter),this.sustainParameter=new re.a("Filter Envelope Sustain",this,function(e,t){return e.synth.set({filterEnvelope:{sustain:t}})},{min:0,max:1,unit:"",defaultValue:.9}),this.registerParameter(this.sustainParameter),this.releaseParameter=new re.a("Filter Envelope Release",this,function(e,t){return e.synth.set({filterEnvelope:{release:t/1e3}})},{min:0,max:1,unit:"ms",defaultValue:60}),this.registerParameter(this.releaseParameter),this.baseFrequencyParameter=new re.b("Filter Envelope Base Frequency",this,function(e,t){return e.synth.set({filterEnvelope:{baseFrequency:t}})},{min:0,max:1e4,unit:"HZ",defaultValue:100}),this.registerParameter(this.baseFrequencyParameter),this.octavesParameter=new re.b("Filter Envelope Octaves",this,function(e,t){return e.synth.set({filterEnvelope:{octaves:t}})},{min:0,max:10,unit:"",defaultValue:1}),this.registerParameter(this.octavesParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),this.parameters.push(e)}},{key:"copyFrom",value:function(e){this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.baseFrequency=e.baseFrequency,this.octaves=e.octaves}},{key:"getJson",value:function(){return{baseFrequency:this.baseFrequency,octaves:this.octaves,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release}}},{key:"fromJson",value:function(e){"baseFrequency"in e&&(this.baseFrequency=e.baseFrequency),"octaves"in e&&(this.octaves=e.octaves),"attack"in e&&(this.attack=e.attack),"decay"in e&&(this.decay=e.decay),"sustain"in e&&(this.sustain=e.sustain),"releease"in e&&(this.release=e.release)}}]),e}(),st=n(351);function ot(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ct=function(e){Object(u.a)(n,e);var t=ot(n);function n(e,r,a){var i;return Object(s.a)(this,n),(i=t.call(this)).sequencerEngine=e,i.store=e.store,i.mixSession=r,i.context=a,i.synth=new W.a.PolySynth(1,W.a.MonoSynth),i.synth.volume.value=-4,i.lfos=[i.createLFO(),i.createLFO(),i.createLFO(),i.createLFO()],i.filterEnvelope=new it(i.synth,i.store,r,a),i.polyphonySet=!1,i.parameters=[],i.parameterToSignal={},i.parameterToLFOs={},i.setupParameters(),i.lfos.forEach(function(e){return e.start()}),i.refreshParameters(),i.node=void 0,i}return Object(o.a)(n,[{key:"getName",value:function(){return"Synth"}},{key:"isMonophonic",value:function(){return 1===this.polyphony}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return U.h}},{key:"hasLFO",value:function(){return!0}},{key:"start",value:function(){this.lfos.forEach(function(e){return e.start()})}},{key:"stop",value:function(){this.lfos.forEach(function(e){return e.stop()})}},{key:"oscillatorType",get:function(){return this.oscillatorTypeParameter.get()},set:function(e){var t=this.oscillatorTypeParameter.get();this.oscillatorTypeParameter.set(e),"pulse"===e&&t!==e&&this.onChangeToPulse()}},{key:"oscillatorFrequency",get:function(){return this.oscillatorFrequencyParameter.get()},set:function(e){this.oscillatorFrequencyParameter.set(e)}},{key:"filterCutoff",get:function(){return this.filterCutoffParameter.get()},set:function(e){this.filterCutoffParameter.set(e)}},{key:"filterQ",get:function(){return this.filterQParameter.get()},set:function(e){this.filterQParameter.set(e)}},{key:"portamento",get:function(){return this.portamentoParameter.get()},set:function(e){this.portamentoParameter.set(e)}},{key:"polyphony",get:function(){return void 0===this.polyphonyParameter?8:this.polyphonyParameter.get()},set:function(e){this.polyphonyParameter.set(e)}},{key:"detune",get:function(){return this.detuneParameter.get()},set:function(e){this.detuneParameter.set(e)}},{key:"pulseWidth",get:function(){return this.pulseWidthParameter.get()},set:function(e){this.pulseWidthParameter.set(e)}},{key:"ampAttack",get:function(){return this.ampAttackParameter.get()},set:function(e){return this.ampAttackParameter.set(e)}},{key:"ampDecay",get:function(){return this.ampDecayParameter.get()},set:function(e){return this.ampDecayParameter.set(e)}},{key:"ampSustain",get:function(){return this.ampSustainParameter.get()},set:function(e){return this.ampSustainParameter.set(e)}},{key:"ampRelease",get:function(){return this.ampReleaseParameter.get()},set:function(e){return this.ampReleaseParameter.set(e)}},{key:"refreshParameters",value:function(){this.pulseWidth=this.pulseWidth,this.oscillatorType=this.oscillatorType,this.filterQ=this.filterQ,this.portamento=this.portamento,this.filterCutoff=this.filterCutoff}},{key:"createNewSynth",value:function(e){var t=this.node;this.disconnect(t),this.synth=new W.a.PolySynth(e,W.a.MonoSynth),this.filterEnvelope.onNewSynth(this.synth),this.connect(t),this.polyphonySet=!1,this.refreshParameters(),this.reconnectAllLFOParameters()}},{key:"triggerAttack",value:function(e,t,n){var r=this.getNoteFromTranspose(e);this.synth.triggerAttack(r,t,n)}},{key:"triggerAttackRelease",value:function(e,t,n,r){var a=this.getNoteFromTranspose(e);this.synth.triggerAttackRelease(a,t,n,r)}},{key:"triggerRelease",value:function(e){var t=this,n=e.map(function(e){return t.getNoteFromTranspose(e)});this.synth.triggerRelease(n)}},{key:"createLFO",value:function(){return new st.a(this.sequencerEngine,this.mixSession,this.context)}},{key:"setupParameters",value:function(e){var t=this;this.oscillatorTypeParameter=new re.a("Oscillator Type",this,function(e,t){return e.synth.set({oscillator:{type:t}})},{min:0,max:1,unit:"",defaultValue:"triangle",automatable:!1}),this.registerParameter(this.oscillatorTypeParameter),this.oscillatorFrequencyParameter=new re.a("Oscillator Frequency",this,function(e,t){return[]},{min:0,max:1,unit:"",defaultValue:0,automatable:!1}),this.registerParameter(this.oscillatorFrequencyParameter),this.pulseWidthParameter=new re.a("Pulse Width",this,function(e,t){return e.synth.set({oscillator:{width:t}})},{min:0,max:1,unit:"",defaultValue:.1}),this.registerParameter(this.pulseWidthParameter,function(e){return e.oscillator.width}),this.filterCutoffParameter=new re.b("Filter Cutoff",this,function(e,t){e.synth.set({filter:{frequency:t}})},{min:0,max:1e4,unit:"HZ",defaultValue:1200}),this.registerParameter(this.filterCutoffParameter,function(e){return e.filter.frequency}),this.filterQParameter=new re.b("Filter Q",this,function(e,t){return e.synth.set({filter:{Q:t}})},{min:0,max:9,unit:"",defaultValue:1}),this.registerParameter(this.filterQParameter,function(e){return e.filter.Q}),this.portamentoParameter=new re.a("Portamento",this,function(e,t){return e.synth.set({portamento:t/20})},{min:0,max:10,unit:"",defaultValue:0}),this.registerParameter(this.portamentoParameter),this.detuneParameter=new re.b("Detune",this,function(e,t){e.synth.set({detune:t})},{min:-100,max:100,unit:"",defaultValue:0,automatable:!1}),this.parameterToSignal[this.detuneParameter.name]=function(e){return e.oscillator.detune},this.registerParameter(this.detuneParameter),this.polyphonyParameter=new re.b("Polyphony",this,function(e,n){t.polyphonySet&&t.createNewSynth(n),t.polyphonySet=!0},{min:0,max:16,unit:"",defaultValue:1,automatable:!1}),this.registerParameter(this.polyphonyParameter),this.ampAttackParameter=new re.a("Amp Attack",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.ampAttackParameter),this.ampDecayParameter=new re.a("Amp Decay",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.ampDecayParameter),this.ampSustainParameter=new re.a("Amp Sustain",this,function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),this.registerParameter(this.ampSustainParameter),this.ampReleaseParameter=new re.a("Amp Release",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.ampReleaseParameter)}},{key:"registerParameter",value:function(e,t){void 0!==t&&(this.parameterToSignal[e.name]=t),e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getCopy",value:function(e){var t=this,r=new n(this.store,this.mixSession,e);for(var a in r.instrumentType=this.instrumentType,r.oscillatorFrequency=this.oscillatorFrequency,r.filterCutoff=this.filterCutoff,r.filterQ=this.filterQ,r.polyphony=this.polyphony,r.portamento=this.portamento,r.filterEnvelope.copyFrom(this.filterEnvelope),r.oscillatorType=this.oscillatorType,r.pulseWidth=this.pulseWidth,r.lfos)r.lfos[a].copyFrom(this.lfos[a]);r.parameterToLFOs={};var i=function(e){var n=t.parameterToLFOs[e],a=r.getParameterByName(e);n.forEach(function(e){var n=r.lfos[t.lfos.indexOf(e)];r.connectLFOToParameter(n,a)})};for(var s in this.parameterToLFOs)i(s);return r}},{key:"getParameters",value:function(){return[].concat(Object(h.a)(this.parameters),Object(h.a)(this.filterEnvelope.parameters))}},{key:"getJson",value:function(){var e={instrumentType:this.getInstrumentType(),oscillatorType:this.oscillatorType,oscillatorFrequency:this.oscillatorFrequency,filterCutoff:this.filterCutoff,filterQ:this.filterQ,polyphony:this.polyphony,portamento:this.portamento,pulseWidth:this.pulseWidth,lfos:this.lfos.map(function(e){return e.getJson()}),parameterToLFOs:this.getParameterToLFOsJson(),filterEnvelope:this.filterEnvelope.getJson(),ampAttack:this.ampAttack,ampDecay:this.ampDecay,ampSustain:this.ampSustain,ampRelease:this.ampRelease};return e=Object(ee.b)(e,"filterCutoffParameter",this.filterCutoffParameter),e=Object(ee.b)(e,"filterQParameter",this.filterQParameter),e=Object(ee.b)(e,"portamentoParameter",this.portamentoParameter),e=Object(ee.b)(e,"pulseWidthParameter",this.pulseWidthParameter),e=Object(ee.b)(e,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter),e=Object(ee.b)(e,"oscillatorTypeParameter",this.oscillatorTypeParameter),e=Object(ee.b)(e,"ampAttackParameter",this.ampAttackParameter),e=Object(ee.b)(e,"ampDecayParameter",this.ampDecayParameter),e=Object(ee.b)(e,"ampSustainParameter",this.ampSustainParameter),e=Object(ee.b)(e,"ampReleaseParameter",this.ampReleaseParameter)}},{key:"getParameterToLFOsJson",value:function(){var e=this,t={},n=function(n){var r=[];e.parameterToLFOs[n].forEach(function(t){return r.push(e.lfos.indexOf(t))}),t[n]=r};for(var r in this.parameterToLFOs)n(r);return t}},{key:"fromJson",value:function(e){if("instrumentType"in e&&(this.instrumentType=e.instrumentType),"polyphony"in e&&(this.polyphony=e.polyphony),"oscillatorFrequency"in e&&(this.oscillatorFrequency=e.oscillatorFrequency),"pulseWidth"in e&&(this.pulseWidth=e.pulseWidth),"oscillatorType"in e&&(this.oscillatorType=e.oscillatorType),"filterCutoff"in e&&(this.filterCutoff=e.filterCutoff),"filterQ"in e&&(this.filterQ=e.filterQ),"portamento"in e&&(this.portamento=e.portamento),"filterEnvelope"in e&&this.filterEnvelope.fromJson(e.filterEnvelope),"lfos"in e)for(var t in e.lfos)this.lfos[t].fromJson(e.lfos[t]);"parameterToLFOs"in e&&this.loadParameterToLFOsJson(e.parameterToLFOs),"ampAttack"in e&&(this.ampAttack=e.ampAttack),"ampDecay"in e&&(this.ampDecay=e.ampDecay),"ampSustain"in e&&(this.ampSustain=e.ampSustain),"ampRelease"in e&&(this.ampRelease=e.ampRelease),Object(ee.a)(e,"filterCutoffParameter",this.filterCutoffParameter,this.sequencerEngine),Object(ee.a)(e,"filterQParameter",this.filterQParameter,this.sequencerEngine),Object(ee.a)(e,"portamentoParameter",this.portamentoParameter,this.sequencerEngine),Object(ee.a)(e,"pulseWidthParameter",this.pulseWidthParameter,this.sequencerEngine),Object(ee.a)(e,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter,this.sequencerEngine),Object(ee.a)(e,"oscillatorTypeParameter",this.oscillatorTypeParameter,this.sequencerEngine),Object(ee.a)(e,"ampAttackParameter",this.ampAttackParameter,this.sequencerEngine),Object(ee.a)(e,"ampDecayParameter",this.ampDecayParameter,this.sequencerEngine),Object(ee.a)(e,"ampSustainParameter",this.ampSustainParameter,this.sequencerEngine),Object(ee.a)(e,"ampReleaseParameter",this.ampReleaseParameter,this.sequencerEngine)}},{key:"getParameterByName",value:function(e){var t=this.parameters.filter(function(t){return t.name===e});if(!(t.length<1))return t[0]}},{key:"loadParameterToLFOsJson",value:function(e){var t=this,n=function(n){var r=t.getParameterByName(n);if(void 0===r)return"continue";e[n].forEach(function(e){return t.connectLFOToParameter(t.lfos[e],r)})};for(var r in e)n(r)}},{key:"connectLFOToParameter",value:function(e,t){var n=this,r=!1;void 0!==this.parameterToSignal[t.name]&&(this.synth.voices.forEach(function(a,i){var s=n.parameterToSignal[t.name](a);void 0===s?r=!0:e.connect(s,t,i)}),r||(t.name in this.parameterToLFOs?this.parameterToLFOs[t.name].add(e):this.parameterToLFOs[t.name]=new Set([e]),this.refreshParameters()))}},{key:"disconnectLFOToParameter",value:function(e,t){var n=this;this.parameterToLFOs[t.name].has(e)&&(this.synth.voices.forEach(function(r,a){e.disconnect(n.parameterToSignal[t.name](r),t,a)}),this.parameterToLFOs[t.name].delete(e))}},{key:"isParameterConnectedToLFO",value:function(e,t){return e.name in this.parameterToLFOs&&this.parameterToLFOs[e.name].has(t)}},{key:"toggleParameterWithLFO",value:function(e,t){this.isParameterConnectedToLFO(e,t)?this.disconnectLFOToParameter(t,e):this.connectLFOToParameter(t,e)}},{key:"reconnectAllLFOParameters",value:function(){var e=this,t=function(t){var n=e.parameterToLFOs[t],r=e.getParameterByName(t);n.forEach(function(t){return e.connectLFOToParameter(t,r)})};for(var n in this.parameterToLFOs)t(n)}},{key:"onChangeToPulse",value:function(){var e=this;this.pulseWidthParameter.name in this.parameterToLFOs&&this.parameterToLFOs[this.pulseWidthParameter.name].forEach(function(t){return e.connectLFOToParameter(t,e.pulseWidthParameter,!0)})}},{key:"connect",value:function(e){void 0!==e&&(this.synth.connect(e),this.node=e)}},{key:"disconnect",value:function(e){this.synth.disconnect(e),this.node=void 0}},{key:"getEnvelopes",value:function(){return this.synth.voices.map(function(e){return e.envelope})}},{key:"releaseAll",value:function(){this.synth.voices.forEach(function(e){return e.triggerRelease()})}},{key:"getNoteFromTranspose",value:function(e){return e+=this.sequencerEngine.transpose,this.getDefaultNote().transpose(e+this.oscillatorFrequency)}},{key:"setEnvelopes",value:function(e){var t=this,n=this.getEnvelopes();n.forEach(function(e){return e.attack=new W.a.Time((1+t.ampAttack)/1e3)}),n.forEach(function(e){return e.release=new W.a.Time((1+t.ampRelease)/1e3)}),n.forEach(function(e){return e.sustain=Math.min(.99,t.ampSustain)}),n.forEach(function(e){return e.decay=new W.a.Time((1+t.ampDecay)/1e3)})}}]),n}(Z);function ut(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var lt=function(e){Object(u.a)(n,e);var t=ut(n);function n(e,r,a,i,o,u){var l,f=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return Object(s.a)(this,n),(l=t.call(this,e,r,a,i,o,u)).setupEffects(),l.instrument=void 0,f&&l.setInstrument(new ct(r,a,(new V.a).forTrack(Object(c.a)(l)))),l.preset=new at.a,l.preset.track=Object(c.a)(l),l}return Object(o.a)(n,[{key:"auditionNext",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var r,i,s,o=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]&&o[1],!this.isFrozen&&!r){e.next=3;break}return e.abrupt("return");case 3:if(this.getInstrumentType()!==U.g||this.preset&&this.preset.contentHash){e.next=7;break}return e.next=6,Object(ne.a)(Object(f.a)(n.prototype),"auditionNext",this).call(this);case 6:case 7:return e.abrupt("return");case 11:if(this.instrument.loaded){e.next=13;break}return e.abrupt("return");case 13:if(this.instrument.loaded=!1,this.trackIsLoading=!0,i=0,!this.preset||!this.preset.contentHash){e.next=21;break}if(i=(void 0).map(function(e){return e.contentHash}).indexOf(this.preset.contentHash),!(++i>=(void 0).length)){e.next=21;break}return e.abrupt("return");case 21:return s=(void 0)[i],e.next=24,this.sequencerEngine.auditionPreset(s,this.trackNumber,!0,!0);case 24:this.trackIsLoading=!1;case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"auditionPrevious",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r){var i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFrozen&&!r){e.next=2;break}return e.abrupt("return");case 2:if(this.getInstrumentType()!==U.g||this.preset&&this.preset.contentHash){e.next=6;break}return e.next=5,Object(ne.a)(Object(f.a)(n.prototype),"auditionPrevious",this).call(this);case 5:case 6:return e.abrupt("return");case 10:if(this.instrument.loaded){e.next=12;break}return e.abrupt("return");case 12:if(this.trackIsLoading=!0,i=0,!this.preset||!this.preset.contentHash){e.next=19;break}if(i=(void 0).map(function(e){return e.contentHash}).indexOf(this.preset.contentHash),!(--i<0)){e.next=19;break}return e.abrupt("return");case 19:return s=(void 0)[i],this.mute(!0),e.next=23,this.sequencerEngine.auditionPreset(s,this.trackNumber,!0,!0);case 23:this.mute(!1),this.trackIsLoading=!1;case 25:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"setIsEnabled",value:function(e){Object(ne.a)(Object(f.a)(n.prototype),"setIsEnabled",this).call(this,e),e||this.isFrozen||this.sequencerEngine.playing||this.getInstrument().releaseAll()}},{key:"makePublicIfNeeded",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.isFrozen;this.midiEffects.dispose(),!t&&this.instrument&&(this.instrument.dispose(),this.instrument=void 0),Object(ne.a)(Object(f.a)(n.prototype),"dispose",this).call(this,!t)}},{key:"getAllParameters",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Object(ne.a)(Object(f.a)(n.prototype),"getAllParameters",this).call(this,e);if(this.isFrozen||void 0===this.instrument)return t;var r=this.getInstrument().getParameters();return[].concat(Object(h.a)(t),Object(h.a)(r))}},{key:"getAllPatternLockedParameters",value:function(e,t){var r=Object(ne.a)(Object(f.a)(n.prototype),"getAllPatternLockedParameters",this).call(this,e,t);if(this.isFrozen)return r;var a=this.getInstrument().getParameters();return a=a.filter(function(n){return n.hasPatternLockedValues(e,t)}),r.concat(a)}},{key:"getCopy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e(this.trackNumber,t,this.mixSession,this.patterns.length,this.update,t.currentSubSequence);if(!this.isFrozen){var i=this.instrument.getCopy((new V.a).forTrack(a),a,t,r);a.setInstrument(i)}return Object(ne.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,function(){return a},t,r),a}},{key:"getName",value:function(){return void 0===this.instrument?"Instrument":this.instrument.getName()}},{key:"getTrackType",value:function(){return D.b}},{key:"getInstrument",value:function(){return this.instrument}},{key:"setInstrument",value:function(e){void 0!==this.instrument&&this.instrument.disconnect(this.gainNode),this.instrument=e,void 0!==this.instrument&&this.instrument.connect(this.gainNode)}},{key:"liveTrigger",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.isFrozen||(this.storeStepData(e,n),this.trigger(e,n,!0))}},{key:"liveTriggerRelease",value:function(e){this.isFrozen||(this.triggerRelease(e),this.currentStepDatas&&(this.currentStepDatas=this.currentStepDatas.filter(function(t){return t.transpose!==e})))}},{key:"trigger",value:function(e,t,r){this.isFrozen?Object(ne.a)(Object(f.a)(n.prototype),"trigger",this).call(this,e,t,r):void 0!==this.instrument&&(this.storeStepData(e,t),this.instrument.trigger(e,t))}},{key:"triggerRelease",value:function(e){this.isFrozen||void 0!==this.instrument&&this.instrument.release(e)}},{key:"getJson",value:function(e,t){var r=this.instrumentRack?this.instrumentRack.isFrozen:this.isFrozen;return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e),{instrumentType:this.instrument?this.instrument.getInstrumentType():this.getInstrumentType(),instrument:r?void 0:this.instrument.getJson(t),presetName:this.presetName,preset:this.preset.getJson()})}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var r,i,s,o,c,u,l,h=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(h.length>1&&void 0!==h[1])||h[1],i=!(h.length>2&&void 0!==h[2])||h[2],s=h.length>3&&void 0!==h[3]&&h[3],o=h.length>4?h[4]:void 0,h.length>5?h[5]:void 0,c=h.length>6?h[6]:void 0,Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,t,o),this.parametersToScale=void 0,r&&this.store.dispatch(Object(C.ne)(this.subSequence.id,this.trackNumber,!0)),t.envelopes)for(u in t.envelopes)this.connectToEnvelope(this.sequencerEngine.envelopes[t.envelopes[u]]);if(l={},!t.isFrozen){e.next=15;break}e.next=19;break;case 15:return this.instrument||this.createNewInstrument(),e.next=18,this.instrument.fromJson(t.instrument,s,o,c);case 18:l=e.sent;case 19:if(void 0!==t.presetName&&(this.presetName=t.presetName),!t.preset){e.next=26;break}if(!i){e.next=26;break}return this.preset.fromJson(t.preset),e.next=25,this.preset.load();case 25:this.preset.name&&(this.presetName=this.preset.name);case 26:return r&&this.store.dispatch(Object(C.ne)(this.subSequence.id,this.trackNumber,!1)),e.abrupt("return",l);case 28:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unfreezeInstrument",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:this.frozenJson,this.createNewInstrument(),e.next=4,this.instrument.fromJson(t.trackParameters.instrument);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"createNewInstrument",value:function(){}},{key:"isMonohonic",value:function(){return this.tracks.every(function(e){return e.track.isMonophonic()})}}]),n}(rt);function ft(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ht=function(e){Object(u.a)(n,e);var t=ft(n);function n(e,r,a,i,o,u){var l;return Object(s.a)(this,n),(l=t.call(this,e,r,a,i,o,u,!1)).setInstrument(new Oe(r,a,(new V.a).forTrack(Object(c.a)(l)))),l}return n}(lt);function pt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var dt=function(e){Object(u.a)(n,e);var t=pt(n);function n(e,r,a){var i;!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Object(s.a)(this,n),(i=t.call(this)).sequencerEngine=e,i.store=e.store,i.mixSession=r,i.context=a.getCopy().forInstrument(Object(c.a)(i)),i.parameters=[],i}return Object(o.a)(n,[{key:"getName",value:function(){return"Synth"}},{key:"name",get:function(){return this.getName()}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return U.f}},{key:"createLFO",value:function(){return new st.a(this.sequencerEngine,this.mixSession,this.context)}},{key:"getCopy",value:function(e){var t=new n(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine,this.mixSession,e);return t.fromJsonSync(this.getJson()),t}},{key:"mateJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;for(var n in e.oscillators){this.getOscillator(n).mateJson(e.oscillators[n])}this.ampEnvelope.mateJson(e.ampEnvelope,t),this.filterEnvelope.mateJson(e.filterEnvelope,t),this.pitchEnvelope.mateJson(e.pitchEnvelope,t),this.mateParameter("filterCutoff",e,this.filterCutoffParameter,t),this.mateParameter("filterQ",e,this.filterQParameter,t),this.mateParameter("noiseVolume",e,this.noiseVolumeParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){Object(Y.b)(this.sequencerEngine,e,t,n,r)}},{key:"dispose",value:function(){this.detuneSignal.dispose(),this.detuneParameter.dispose();var e=Object(h.a)(this.oscillatorNodes);e.reverse(),e.forEach(function(e){return e.dispose()}),this.filter.dispose(),this.hpFilter.dispose(),this.pitchEnvelope.dispose(),this.filterEnvelope.dispose(),this.hpFilterEnvelope.dispose(),this.ampEnvelope.dispose(),this.oscillatorNodes=void 0,this.filter=void 0,this.hpFilter=void 0,this.pitchEnvelope=void 0,this.filterEnvelope=void 0,this.ampEnvelope=void 0,this.parameters.forEach(function(e){return e.dispose()}),this.parameters=void 0,this._disposed=!0}},{key:"disposed",get:function(){return this._disposed}}]),n}(Z);function vt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var mt=n(236),yt=n(554);function bt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var gt=new(function(){function e(){Object(s.a)(this,e),this.voices=[],this.voicesCreated=0,window.voiceFactory=this}return Object(o.a)(e,[{key:"newVoice",value:function(e,t,n){if(!W.a.Master.context.isOffline&&this.voices.length>0){var r=this.voices.find(function(e){return e.name===t});if(r){var a=this.voices.indexOf(r);return this.voices.splice(a,1),e&&(e.includes("fat")&&(r.oscillator.type="sine"),r.oscillator.type=e),r}}if(e){var i=new W.a.MonoSynth({oscillator:{type:e}});return this.voicesCreated++,e.includes("fat")&&(i.type="sine",i.type=e),i.id=0,i}var s=new W.a.MonoSynth;return s.id=0,s}},{key:"releaseVoice",value:function(e,t,n){e.disconnectFM(),e.disconnect(),n.isOffline||this.voices.push(e)}}]),e}());function Ot(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return kt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kt(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function kt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function jt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wt=function(e){return function(e){Object(u.a)(n,e);var t=jt(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"scaleByKey",value:function(e,t,n){if(!this.track.parametersToScale){var r=this.track?this.track.getAllParameters():this.getParameters();this.track.parametersToScale=r.filter(function(e){return e.keyScaling})}var a,i=(t- -32)/92,s=W.a.Master.context.isOffline,o=Ot(this.track.parametersToScale);try{for(o.s();!(a=o.n()).done;){var c=a.value,u=c.keyScaling;if(u&&c.get(!0)!==c.min){var l=c.get(!0)+u.min+(u.max-u.min)*i;if(c._audioParams){var f=c._audioParams.length;s?c._audioParams[n%f].value=l:c._audioParams[n%f].linearRampToValueAtTime(l,e+.01)}else c.audioParam&&c.audioParam.linearRampToValueAtTime?s?c.audioParam.value=l:c.audioParam.linearRampToValueAtTime(l,e+.01):c.audioParams&&c.audioParams[n]?s?c.audioParams[n].value=l:c.audioParams[n].linearRampToValueAtTime(l,e+.01):c.setter(c.object,l)}}}catch(h){o.e(h)}finally{o.f()}}}]),n}(e)};function xt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function St(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Pt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Pt(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Et(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Tt="C",At="A",Mt="B1",Rt="B2",Ct="X",Nt="Y";function qt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var It=function(e){Object(u.a)(n,e);var t=qt(n);function n(e,r,a,i){var o;return Object(s.a)(this,n),o=t.call(this,e,r,a,void 0,void 0,void 0,new W.a.AmplitudeEnvelope(10,10,1,100)),i&&i.connect(o.envelope),o.envelope.releaseCurve="linear",o.envelope.attackCurve="linear",o.envelope.decayCurve="linear",o}return Object(o.a)(n,[{key:"dispose",value:function(){Object(ne.a)(Object(f.a)(n.prototype),"dispose",this).call(this)}},{key:"connect",value:function(e){this.envelope.connect(e)}}]),n}(be),_t=function(){function e(t,n,r,a,i){Object(s.a)(this,e),this.sequencerEngine=t,this.id=Object(S.uuid)(),this.instrument=i,this.store=this.sequencerEngine.store,this.mixSession=n,this.context=r.getCopy().forSubDevice(this),this.ampEnvelopes=a,this.parameters=[],this.setupParameters()}return Object(o.a)(e,[{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"refresh",value:function(){this.attack=this.attack,this.decay=this.decay,this.sustain=this.sustain,this.release=this.release}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e,!0,!0)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e,!0,!0)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e,!0,!0)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e,!0,!0)}},{key:"setupParameters",value:function(){var e=this;this.attackParameter=new re.a("Attack",this.envelope,function(t,n){return e.ampEnvelopes.forEach(function(e){return e.attack=n})},{min:0,max:1e4,unit:"ms",defaultValue:80,onChange:function(t){e.instrument.controller&&e.instrument.controller.sendADSRLevels()}}),this.registerParameter(this.attackParameter),this.decayParameter=new re.a("Decay",this.envelope,function(t,n){return e.ampEnvelopes.forEach(function(e){return e.decay=n})},{min:0,max:3e3,unit:"ms",defaultValue:500,onChange:function(t){e.instrument.controller&&e.instrument.controller.sendADSRLevels()}}),this.registerParameter(this.decayParameter),this.sustainParameter=new re.a("Sustain",this.envelope,function(t,n){return e.ampEnvelopes.forEach(function(e){return e.sustain=n})},{min:0,max:1,unit:"",defaultValue:.8,onChange:function(t){e.instrument.controller&&e.instrument.controller.sendADSRLevels()}}),this.registerParameter(this.sustainParameter),this.releaseParameter=new re.a("Release",this.envelope,function(t,n){return e.ampEnvelopes.forEach(function(e){return e.release=n})},{min:0,max:3e3,unit:"ms",defaultValue:100,onChange:function(t){e.instrument.controller&&e.instrument.controller.sendADSRLevels()}}),this.registerParameter(this.releaseParameter)}},{key:"getJson",value:function(){var e={attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,x:this.x,y:this.y,width:this.width,height:this.height};return e=Object(ee.b)(e,"attackParameter",this.attackParameter),e=Object(ee.b)(e,"decayParameter",this.decayParameter),e=Object(ee.b)(e,"sustainParameter",this.sustainParameter),e=Object(ee.b)(e,"releaseParameter",this.releaseParameter)}},{key:"fromJson",value:function(e,t,n){var r={};return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,Object(fe.a)(this.attackParameter,e.attack,r,n,!0),Object(fe.a)(this.decayParameter,e.decay,r,n,!0),Object(fe.a)(this.sustainParameter,e.sustain,r,n,!0),Object(fe.a)(this.releaseParameter,e.release,r,n,!0),r=Object(p.a)({},r,Object(ee.a)(e,"attackParameter",this.attackParameter,this.sequencerEngine,!1,!0,n),Object(ee.a)(e,"decayParameter",this.decayParameter,this.sequencerEngine,!1,!0,n),Object(ee.a)(e,"sustainParameter",this.sustainParameter,this.sequencerEngine,!1,!0,n),Object(ee.a)(e,"releaseParameter",this.releaseParameter,this.sequencerEngine,!1,!0,n))}},{key:"dispose",value:function(){}}]),e}(),Dt=n(312),Ft=n(353);window.edgeCount=0,window.disposedEdgeCount=0;var Lt=function(){function e(t,n){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;Object(s.a)(this,e),this.name=i,window.edgeCount++,this.edgeCount=window.edgeCount,this.sequencerEngine=n,this.store=n.store,this.operator=t,this.outputNumber=a,this.effect=t,this.modulatorNodes=[];for(var o=0;o<t.voices.length;o++)this.modulatorNodes.push(new W.a.Gain(0));this.loadSynth(t),this.parameters=[],this.gainParameter=new te.a("Gain",this,function(e,t){return r.modulatorNodes.forEach(function(e){return e.gain.value=t})},{min:0,max:6,defaultValue:0}),this.registerParameter(this.gainParameter),this.gainParameter.setAudioParams(this.modulatorNodes.map(function(e){return e.gain}))}return Object(o.a)(e,[{key:"loadSynth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.operator;if(t.synth)for(var n in this.operator.voices){var r=t.voices[n];e&&this.modulatorNodes[n].disconnect(),this.modulatorNodes[n].connect(r.oscillator.frequency)}else;}},{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"getWeight",value:function(){return 1}},{key:"getJson",value:function(){return{}}},{key:"fromJson",value:function(){}},{key:"getCopy",value:function(){var t=new e(this.operator,this.sequencerEngine,this.outputNumber);return t.gainParameter.set(t.gainParameter.get()),t}},{key:"dispose",value:function(){window.disposedEdgeCount++,this.gainParameter.dispose(),this.modulatorNodes.forEach(function(e){return e.dispose()}),this.gainParameter=void 0,this.modulatorNodes=void 0,this._wasDisposed=!0}}]),e}(),Bt=n(311);function zt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Jt(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Vt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vt(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Vt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ht(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Ut(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Gt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gt(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Gt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Wt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Kt=function(){function e(t,n,r,a){Object(s.a)(this,e),this.oscillator=t,this.sequencerEngine=n,this.mixSession=r,this.context=a,this.ampEnvelopes=[new It(n,r,a)],this.connected=!1}return Object(o.a)(e,[{key:"dispose",value:function(){this.ampEnvelopes.forEach(function(e){return e.dispose()}),this.ampEnvelopes=void 0}},{key:"newVoice",value:function(){this.ampEnvelopes.push(new It(this.sequencerEngine,this.mixSession,this.context))}},{key:"removeVoice",value:function(){this.ampEnvelopes[this.ampEnvelopes.length-1].dispose(),this.ampEnvelopes.splice(this.ampEnvelopes.length-1,1)}}]),e}(),Qt=function(){function e(t,n,r,a,i,o,c){Object(s.a)(this,e),this.sequencerEngine=i,this.mixSession=o,this.context=c,this.id=n,this.name=t,this.synth=r,this.crossFadeIndex=a,this.outputs={},this.voices=[]}return Object(o.a)(e,[{key:"dispose",value:function(){for(var e in this.outputs)this.outputs[e].dispose();this.outputs={}}},{key:"newVoice",value:function(){for(var e in this.outputs)this.outputs[e].newVoice()}},{key:"removeVoice",value:function(){for(var e in this.outputs)this.outputs[e].removeVoice()}},{key:"stealOrMake",value:function(e){if(this.outputs[e.name])return this.outputs[e.name];for(var t in this.outputs)if(!this.outputs[t].connected){var n=this.outputs[t];return delete this.outputs[t],n}return new Kt(e,this.sequencerEngine,this.mixSession,this.context)}},{key:"noiseSources",get:function(){return this.synth.noiseSources}},{key:"connect",value:function(e){var t=this,n=this.stealOrMake(e);for(var r in this.outputs[e.name]=n,e.voices){var a=e.voices[r];n.ampEnvelopes[r]||n.newVoice();var i=n.ampEnvelopes[r].envelope;a.connect(i)}if("C"===e.name)for(var s in this.noiseSources){var o=e.voices[s];this.noiseSources[s].connect(o._volume)}return n.connected=!0,n.ampEnvelopes.forEach(function(t){return t.envelope.connect(e.formantsManager.input)}),e.formantsManager.output.connect(this.synth.outputCrossFade,0,this.crossFadeIndex),function(){if(n.connected=!1,n.ampEnvelopes.forEach(function(t){return t.envelope.disconnect(e.formantsManager.input)}),e.voices.forEach(function(e,t){e.disconnect(n.ampEnvelopes[t].envelope)}),"C"===e.name)for(var r in t.noiseSources){var a=e.voices[r];t.noiseSources[r].disconnect(a._volume)}e.formantsManager.output.disconnect(t.synth.outputCrossFade,0,t.crossFadeIndex),n.disconnect=void 0}}}]),e}();function Zt(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Yt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Yt(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Xt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function $t(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var en=n(235);function tn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var nn=new W.a.Frequency("C3"),rn=n(916);function an(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return sn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function sn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function on(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function cn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var un={0:"sine",.2:"triangle",.4:"square",.6:"sawtooth",.8:"pulse",1:"fatsine",1.2:"fattriangle",1.4:"fatsquare",1.8:"fatsawtooth"};window.lpf=1e3,window.len=Math.pow(2,10),window.start=88200;function ln(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function fn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function hn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var pn=function(e,t,n){return!t||n?e:e+1};function dn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function vn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return mn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function mn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function yn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}window.envelopeTest=!1,window.p1=.05,window.p2=.008,window.fuck=2;var bn=function(e){Object(u.a)(n,e);var t=yn(n);function n(e,r,a,i){var o,c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],u=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,f=arguments.length>7?arguments[7]:void 0;return Object(s.a)(this,n),(o=t.call(this,e,r,a,function(e){return 0},i,c,l)).name=u,o.track=l,o.instrument=f,o.create(),o.setupEnvelopes(),o.setupFormants(),o.preset=new at.a,o}return Object(o.a)(n,[{key:"initializeNewVoice",value:function(e){return e?new W.a.MonoSynth({oscillator:{type:e}}):new W.a.MonoSynth}},{key:"documentation",get:function(){var e=this.name;return"You can connect LFOs to Operator ".concat(e," by dragging a line from an LFO to the circles above the node")}},{key:"getEffectType",value:function(){return he.d}},{key:"disposeSynth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.synth;e._voices[0].context.isOffline;this.destroyFormants(e,!0),e.formantsManager.dispose();var t,n=vn(e.voices);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.disconnectFM(),r.disconnect()}}catch(a){n.e(a)}finally{n.f()}e._voices.forEach(function(e){return e.dispose()}),e._voices=void 0}}]),n}(Object(Ye.a)(function(e){return function(e){Object(u.a)(n,e);var t=dn(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a)))._voices=[],e}return Object(o.a)(n,[{key:"releaseVoice",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];gt.releaseVoice(e,t,this.sequencerEngine)}},{key:"onPolyphonyChanged",value:function(e){var t=this;if(e>this._voices.length){for(var n=this._voices.length;n<e;n++){var r=this.newVoice();this.fm(this.carrier,!0,r,n),this._voices.push(r)}this.customOscillatorType&&this.customOscillatorTypeParameter.updateRedux(),this.setAudioParamsForParameters()}else e<this._voices.length&&(this._voices.slice(e).forEach(function(e){return t.releaseVoice(e)}),this._voices=this._voices.slice(0,e));this.oscillatorTypeParameter&&"pulse"===this.oscillatorTypeParameter.get()&&this.pulseWidthParameter.setAudioParams(this.voices.map(function(e){return e.oscillator.width}))}},{key:"initVoices",value:function(){this._voices=[this.newVoice()]}},{key:"voices",get:function(){return this._voices?this.polyphonyParameter?this._voices.slice(0,this.polyphonyParameter.get()):this._voices:[]}},{key:"synth",get:function(){return this}},{key:"newVoice",value:function(){var e=this;if(this.oscillatorTypeParameter&&this.oscillatorType){var t=gt.newVoice(this.oscillatorType,this.name);return this.oscillatorType.includes("fat")&&(this._voices.forEach(function(e){return e.oscillator.type="sine"}),this._voices.forEach(function(t){t.oscillator.type=e.oscillatorType,t.oscillator.count=e.countParameter.get(),t.oscillator.spread=e.spreadParameter.get()})),t}return gt.newVoice(void 0,this.name)}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=on(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).parameters=[],e}return Object(o.a)(n,[{key:"isEnabled",value:function(){return this.enabled}},{key:"setupParameters",value:function(){var e=this;this.enabledParameter=new re.a("Enabled",this,function(e,t){},{documentation:["Turns the operator on/off.","If you`re running low on CPU, try turning off some operators."],min:!1,max:!0,unit:"",defaultValue:!0,automatable:!1}),this.registerParameter(this.enabledParameter),this.name,this.voices.map(function(e){return e.volume.value=0}),this.oscillatorLevelParameter=new le.a("Oscillator Level",this.voices.map(function(e){return e.volume}),{documentation:"Controls the volume for this operator",min:0,max:1,defaultValue:.3,onChange:function(t){e.instrument.controller&&e.instrument.controller.sendOscillatorLevels()}}),this.registerParameter(this.oscillatorLevelParameter),this.pwmParameter=new re.a("PWM",this,function(t,n){return e.voices.forEach(function(e){return 0})},{min:0,max:20,unit:"",defaultValue:0,automatable:!1}),this.registerParameter(this.pwmParameter),this.countParameter=new re.a("count",this,function(t,n){return e.voices.forEach(function(e){return e.oscillator.count=n})},{min:0,max:20,unit:"",defaultValue:3,automatable:!1}),this.registerParameter(this.countParameter),this.spreadParameter=new re.a("spread",this,function(t,n){return e.voices.forEach(function(e){return e.oscillator.spread=n})},{min:1,max:200,unit:"",defaultValue:20,automatable:!1}),this.registerParameter(this.spreadParameter),this.oscillatorFrequencyParameter=new re.a("Oscillator Frequency",this,function(e,t){return[]},{documentation:"Controls the root note for the synth.",min:0,max:1,unit:"",defaultValue:0,automatable:!1}),this.registerParameter(this.oscillatorFrequencyParameter),this.detuneParameter=new le.a("Detune",this.voices.map(function(e){return e.detune}),{documentation:"Controls the detuning for this operator",min:-100,max:100,unit:"",defaultValue:0}),this.registerParameter(this.detuneParameter),this.portamentoParameter=new re.a("Portamento",this,function(t,n){return e.voices.forEach(function(e){return e.portamento=n/20})},{documentation:"Controls the gliding between notes for this operator",min:0,max:5,unit:"",defaultValue:0}),this.registerParameter(this.portamentoParameter),this.polyphonyParameter=new re.b("Polyphony",this,function(t,n){e.onPolyphonyChanged(n)},{min:0,max:16,unit:"",defaultValue:1,automatable:!1}),this.registerParameter(this.polyphonyParameter)}},{key:"enabled",get:function(){return this.enabledParameter.get(!0)},set:function(e){this.enabledParameter.set(e)}},{key:"oscillatorLevel",get:function(){return this.oscillatorLevelParameter.get(!0)},set:function(e){return this.oscillatorLevelParameter.set(e)}},{key:"oscillatorFrequency",get:function(){return this.oscillatorFrequencyParameter.get(!0)},set:function(e){this.oscillatorFrequencyParameter.set(e)}},{key:"detune",get:function(){return this.detuneParameter.get(!0)},set:function(e){this.detuneParameter.set(e)}},{key:"pulseWidth",get:function(){return this.pulseWidthParameter.get(!0)},set:function(e){this.pulseWidthParameter.set(e)}},{key:"portamento",get:function(){return this.portamentoParameter.get(!0)},set:function(e){this.portamentoParameter.set(e)}},{key:"harmonics",get:function(){return this.harmonicsParameter.get(!0)},set:function(e){this.harmonicsParameter.set(e)}},{key:"polyphony",get:function(){return void 0===this.polyphonyParameter?8:this.polyphonyParameter.get(!0)},set:function(e){this.polyphonyParameter.set(e,!0,!0)}},{key:"registerParameter",value:function(e,t){var n=e.setStore(this.store);this.bulk=Object(p.a)({},this.bulk,n),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"registerContext",value:function(e){}},{key:"getParameters",value:function(){var e,t=this.parameters,n=an(this.formants);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=[].concat(Object(h.a)(t),Object(h.a)(r.getParameters()))}}catch(a){n.e(a)}finally{n.f()}return[].concat(Object(h.a)(t),Object(h.a)(this.ampEnvelope.parameters))}},{key:"refreshParameters",value:function(){this.customOscillatorType||(this.oscillatorTypeParameter.set(this.oscillatorType,!0,!0),null!==this.partials&&this.partialsParameter.set(this.partials,!0,!0)),this.customOscillatorTypeParameter.set(this.customOscillatorType,!0,!0),this.portamentoParameter.set(this.portamento,!0,!0),this.harmonicsParameter.set(this.harmonics,!0,!0),this.pulseWidthParameter.set(this.pulseWidth,!0,!0)}},{key:"oscillatorOctave",get:function(){return this.oscillatorOctaveParameter.get()}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=tn(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"triggerAttack",value:function(e,t,n,r){if(this.enabled){var a=this.getNoteFromTranspose(e);this.lastNote=e,r.triggerAttack(a,t,n)}}},{key:"triggerAttackRelease",value:function(e,t,n,r,a){if(this.enabled){var i=this.getNoteFromTranspose(e);a.triggerAttackRelease(i,t,n,r)}}},{key:"triggerRelease",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.a.Master.context.currentTime,a=arguments.length>3?arguments[3]:void 0;if(this.enabled&&(e&&void 0===e.map&&(e=[e]),!e||1!=this.polyphony||e[0]===this.lastNote)){var i=e&&e.map(function(e){return n.getNoteFromTranspose(e)});void 0!==t?(this.pitchEnvelope.triggerRelease(t.slotNumber),t.triggerRelease(r,a)):i&&this.triggerRelease(i,r)}}},{key:"getNoteFromTranspose",value:function(e){return this.getDefaultNote().transpose(e+this.oscillatorFrequency)}},{key:"getDefaultNote",value:function(){return nn}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=fn(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"fm",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.carrier,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.voices[0],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;r.envelope.releaseCurve="end",r.name=this.name,r.isCarrier=!t;var i=void 0===t;i&&(r._frequencyNode||(r.frequency=new W.a.Signal(440,W.a.Type.Frequency),r._frequencyNode=r.frequency)),r.operatorFrequency||(r.operatorFrequency=r.oscillator.frequency),r.harmonicity?(r.volume.value=0,r.octaves.output.gain.value=0,r.harmonicity.output.gain.value=0,r.modulationIndex.output.gain.value=0,r.detune.value=0):(r.harmonicity=new W.a.Multiply(0),r.harmonicity.units=W.a.Type.Positive,r.octaves=new W.a.Multiply(0),r.octaves.units=W.a.Type.Positive,r.modulationIndex=new W.a.Multiply(0),r.modulationIndex.units=W.a.Type.Positive),i?(r.frequency.connect(r.octaves),r.octaves.connect(r.harmonicity)):(t.voices[a].frequency.connect(r.octaves),r.octaves.connect(r.harmonicity),t.voices[a].frequency.connect(r.modulationIndex)),r.harmonicity.connect(r.oscillator.frequency),this.feedback,r.disconnectFM=function(n){e.harmonicityParameter.removeAudioParam(r.harmonicity.output.gain),e.oscillatorOctaveParameter.removeAudioParam(r.octaves.output.gain),e.oscillatorLevelParameter.removeAudioParam(r.volume),e.modulationIndexParameter.removeAudioParam(r.modulationIndex.output.gain),e.detuneParameter.removeAudioParam(r.detune),t?(t._voices[a].frequency.disconnect(r.octaves),r.octaves.disconnect(r.harmonicity),t._voices[a].frequency.disconnect(r.modulationIndex)):(r.frequency.disconnect(r.octaves),r.octaves.disconnect(r.harmonicity))},n||(this.harmonicityParameter=new le.a("Harmonicity",this.voices.map(function(e){return e.harmonicity.output.gain}),{min:0,documentation:["Ratio between this operator`'s frequency, and the frequency of the inputed note.","Ex: A ratio of 2 is an octave above the inputed note"],max:20,unit:"",times:2,defaultValue:3},0),this.registerParameter(this.harmonicityParameter),this.oscillatorOctaveParameter=new le.a("octave",this.voices.map(function(e){return e.octaves.output.gain}),{min:0,documentation:["Controls octave"],max:8,unit:"",defaultValue:1,times:2},0),this.registerParameter(this.oscillatorOctaveParameter),this.modulationIndexParameter=new le.a("modulationIndex",this.voices.map(function(e){return e.modulationIndex.output.gain}),{documentation:"The level of modulation the operator will reach  at the maximum of it's envelope",min:0,max:120,unit:"",defaultValue:1}),this.registerParameter(this.modulationIndexParameter)),n&&(this.harmonicityParameter.set(this.harmonicityParameter.get(!0),!0,!0),this.oscillatorOctaveParameter.set(this.oscillatorOctaveParameter.get(!0),!0,!0),this.modulationIndexParameter.set(this.modulationIndexParameter.get(!0),!0,!0))}},{key:"setAudioParamsForParameters",value:function(){this.oscillatorLevelParameter.setAudioParams(this.voices.map(function(e){return e.volume})),this.detuneParameter.setAudioParams(this.voices.map(function(e){return e.detune})),this.harmonicityParameter.setAudioParams(this.voices.map(function(e){return e.harmonicity.output.gain})),this.oscillatorOctaveParameter.setAudioParams(this.voices.map(function(e){return e.octaves.output.gain})),this.modulationIndexParameter.setAudioParams(this.voices.map(function(e){return e.modulationIndex.output.gain}))}},{key:"connectFeedbackEdge",value:function(e,t,n){}},{key:"connectEdge",value:function(e){var t=this;if(-2===e.operator.id||-3===e.operator.id){var n=-2===e.operator.id?this.instrument.outputNodeX:this.instrument.outputNodeY;return e.disconnect=n.connect(this),e}var r=[],a=function(n){var a=t.voices[n];a.connect(e.modulatorNodes[n].gain),e.operator.voices[n],a.modulationIndex.connect(e.modulatorNodes[n]),r.push(function(){a.disconnect(e.modulatorNodes[n].gain),a.modulationIndex.disconnect(e.modulatorNodes[n])})};for(var i in this.voices)a(i);return e.disconnect=function(){return r.forEach(function(e){return e()})},e}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=ln(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"setupEnvelopes",value:function(){this.ampEnvelope=new be(this.sequencerEngine,this.mixSession,this.context),this.ampEnvelope.releaseParameter.automatable=!1,this.connectSynthToPitchEnvelope()}},{key:"setEnvelopes",value:function(e,t,n,r){var a=e&&null!==e.releaseParameter.get()?e.release:t.releaseParameter.getKeyScaledValue(n,!1);if("C"!==this.name){var i=a+window.fuck;this.ampEnvelope.releaseParameter.set(i,!0,!0)}this._setEnvelopes(e,this.ampEnvelope,n,r),e&&null!==e.releaseParameter.get()&&t.releaseParameter.set(e.release,!0,!0)}},{key:"_setEnvelopes",value:function(e,t,n,r){var a=e&&null!==e.releaseParameter.get()?e.release:t.releaseParameter.getKeyScaledValue(n);r.envelope.attack=new W.a.Time((1+t.attackParameter.getKeyScaledValue(n))/1e3),r.envelope.decay=new W.a.Time((1+t.decayParameter.getKeyScaledValue(n))/1e3),r.envelope.sustain=Math.min(t.sustainParameter.getKeyScaledValue(n),.99),r.envelope.release=new W.a.Time((1+a)/1e3)}},{key:"connectSynthToPitchEnvelope",value:function(){var e=this;this.getDetuneVoices().forEach(function(t){return e.pitchEnvelope.connect(t)})}},{key:"disconnectSynthFromPitchEnvelope",value:function(){var e=this;this.getDetuneVoices().forEach(function(t){return e.pitchEnvelope.disconnect(t)})}},{key:"getDetuneVoices",value:function(){return this.voices.map(function(e){return e.detune})}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=cn(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"setupWaveformParameters",value:function(){var e=this;this.customOscillatorTypeParameter=new re.a("Custom Oscillator Type",this,function(t,n){n&&(e.oscillatorTypeParameter&&(e.oscillatorType=null),t._voices.forEach(function(e){return e.oscillator.type="sine"}),W.a.Master.context.isOffline?n&&e.setPeriodicWave(oe(n)):n&&se(n).then(function(t){return e.setPeriodicWave(t)}))},{min:0,max:2,unit:"",defaultValue:null,uxAutomatable:!1}),this.registerParameter(this.customOscillatorTypeParameter),this.oscillatorTypeParameter=new en.a("Oscillator Type",this,function(t,n){if(void 0!==n){var r=t.oscillatorTypeParameter?t.oscillatorTypeParameter.getOptionFromNumber(n):un[n];e.customOscillatorType=null,(r=r||n)&&r.includes("fat")&&t._voices.forEach(function(e){return e.oscillator.type="sine"}),r!==t.voices[t.voices.length-1].oscillator.type&&(t.voices.forEach(function(e){return e.oscillator.type=r}),"pulse"===r?e.pulseWidthParameter.setAudioParams(t.voices.map(function(e){return e.oscillator.width})):e.pulseWidthParameter&&e.pulseWidthParameter._audioParams&&Object(h.a)(e.pulseWidthParameter._audioParams).forEach(function(t){return e.pulseWidthParameter.removeAudioParam(t)}))}},{min:0,max:1,unit:"",defaultValue:"sine",options:un,uxAutomatable:!1}),this.registerParameter(this.oscillatorTypeParameter),this.harmonicsParameter=new re.a("Harmonics",this,function(e,t){e.sequencerEngine.isOffline?e.updateHarmonicsSync(t):e.updateHarmonics(t)},{min:-1,max:1,unit:"",defaultValue:0,uxAutomatable:!1}),this.registerParameter(this.harmonicsParameter),this.partialCountParameter=new re.a("Partial Count",this,function(t,n){e.customOscillatorType||t.voices.forEach(function(e){return e.oscillator.partialCount=n})},{min:0,automatable:!1,max:24,unit:"",defaultValue:0,uxAutomatable:!1}),this.registerParameter(this.partialCountParameter),this.partialsParameter=new re.a("Partials",this,function(e,t){return t&&e.voices.forEach(function(e){return e.oscillator.partials=t})},{unit:"",defaultValue:null,automatable:!1,uxAutomatable:!1}),this.registerParameter(this.partialsParameter),this.pulseWidthParameter=new le.a("Pulse Width",void 0,{unit:"",defaultValue:.1,min:0,max:1,automatable:!1,uxAutomatable:!1}),this.registerParameter(this.pulseWidthParameter),this.waveformAParameter=new re.a("Waveform A",this,function(e,t){e.sequencerEngine.isOffline?e.updateHarmonicsSync():e.updateHarmonics()},{defaultValue:2,min:0,max:50}),this.registerParameter(this.waveformAParameter),this.waveformBParameter=new re.a("Waveform B",this,function(e,t){e.sequencerEngine.isOffline?e.updateHarmonicsSync():e.updateHarmonics()},{defaultValue:0,min:0,max:50}),this.registerParameter(this.waveformBParameter)}},{key:"updateHarmonics",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s,o=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:this.harmonicsParameter.get(),this.customOscillatorType&&this.periodicWave){e.next=3;break}return e.abrupt("return");case 3:return n={imag:Object(h.a)(this.periodicWave.imag),real:Object(h.a)(this.periodicWave.real)},e.next=6,ce(this.waveformAParameter.get());case 6:return r=e.sent,e.next=9,ce(this.waveformBParameter.get());case 9:i=e.sent,s=t>0?i:r,this._updateHarmonics(t,n,s);case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"updateHarmonicsSync",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.harmonicsParameter.get();if(this.customOscillatorType&&this.periodicWave){var t={imag:Object(h.a)(this.periodicWave.imag),real:Object(h.a)(this.periodicWave.real)},n=ue(e>0?this.waveformBParameter.get():this.waveformAParameter.get());this._updateHarmonics(e,t,n)}}},{key:"_updateHarmonics",value:function(e,t,n){e=Math.abs(e);for(var r=0;r<t.real.length;r++){var a=t.real[r],i=n.real[r];t.real[r]=a+(i-a)*Math.pow(e,2);var s=t.imag[r],o=n.imag[r];t.imag[r]=s+(o-s)*Math.pow(e,2)}this.setPeriodicWave(t,!0)}},{key:"setPeriodicWave",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(new Date).getTime(),t||(this.periodicWave=e);var n=W.a.Master.context.createPeriodicWave(new Float32Array(e.real),new Float32Array(e.imag));this._voices&&(this._voices.forEach(function(e){e.oscillator._wave=n,e._wave=n,e.oscillator._oscillator._wave=n,e.oscillator._type="custom",e.oscillator._oscillator._type="custom",e.oscillator._oscillator._oscillator&&e.oscillator._oscillator._oscillator.setPeriodicWave(n)}),t||(this.harmonics=this.harmonics),(new Date).getTime())}},{key:"setOscillatorSample",value:function(e){}},{key:"hasCustomWaveform",value:function(){return null!==this.partialsParameter.get()}},{key:"oscillatorType",get:function(){return this.oscillatorTypeParameter.get(!0)},set:function(e){this.oscillatorTypeParameter.set(e,!0,!0),"custom"===e&&(this.partials=[1,1,1,1,1,1,0,1,0,1,0,1].concat(Array(32).fill(0)))}},{key:"customOscillatorType",get:function(){return this.customOscillatorTypeParameter.get(!0)},set:function(e){this.customOscillatorTypeParameter.set(e,!0,!0)}},{key:"partials",get:function(){return this.partialsParameter.get(!0)},set:function(e){"custom"!==this.oscillatorType&&(this.oscillatorType="custom"),this.partialsParameter.set(e,!0,!0)}}]),n}(e)},rn.a,function(e){return function(e){Object(u.a)(n,e);var t=hn(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getJson",value:function(e){var t=Object(p.a)({preset:this.preset.contentHash,isHarmonicityFixed:!0,enabled:this.enabled,oscillatorType:this.oscillatorType,oscillatorFrequency:this.oscillatorFrequency,oscillatorLevel:this.oscillatorLevel,polyphony:this.polyphony,portamento:this.portamento,oscillatorOctave:this.oscillatorOctave,detune:this.detune,partials:this.partials,customOscillatorType:this.customOscillatorType,harmonics:this.harmonics,pulseWidth:this.pulseWidth,spread:this.spreadParameter.get(),count:this.countParameter.get(),waveformA:this.waveformAParameter.get(),waveformB:this.waveformBParameter.get()},this.getFMJson(e));return t=Object(ee.b)(t,"oscillatorOctaveParameter",this.oscillatorOctaveParameter,void 0,e),t=Object(ee.b)(t,"waveformAParameter",this.waveformAParameter,void 0,e),t=Object(ee.b)(t,"waveformBParameter",this.waveformBParameter,void 0,e),t=Object(ee.b)(t,"pulseWidthParameter",this.pulseWidthParameter,void 0,e),t=Object(ee.b)(t,"enabledParameter",this.enabledParameter,void 0,e),t=Object(ee.b)(t,"oscillatorLevelParameter",this.oscillatorLevelParameter,void 0,e),t=Object(ee.b)(t,"detuneParameter",this.detuneParameter,void 0,e),t=Object(ee.b)(t,"portamentoParameter",this.portamentoParameter,void 0,e),t=Object(ee.b)(t,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter,void 0,e),t=Object(ee.b)(t,"harmonicsParameter",this.harmonicsParameter,void 0,e),t=Object(ee.b)(t,"oscillatorTypeParameter",this.oscillatorTypeParameter,void 0,e),t=Object(ee.b)(t,"partialsParameter",this.partialsParameter,void 0,e),t=Object(ee.b)(t,"customOscillatorTypeParameter",this.customOscillatorTypeParameter,void 0,e)}},{key:"getFMJson",value:function(e){var t={harmonicity:this.harmonicityParameter.get(!0),modulationIndex:this.modulationIndexParameter.get(!0),ampEnvelope:this.ampEnvelope.getJson(),partialCount:this.partialCountParameter.get(!0),formants:this.getFormantsJson()};return t=Object(ee.b)(t,"harmonicityParameter",this.harmonicityParameter,void 0,e),t=Object(ee.b)(t,"modulationIndexParameter",this.modulationIndexParameter,void 0,e),t=Object(ee.b)(t,"partialCountParameter",this.partialCountParameter,void 0,e)}},{key:"fromJson",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;if((new Date).getTime(),void 0===e)return{};e.preset&&(this.preset.contentHash=e.preset);var r=this.fromFMJson(e,t,n);(new Date).getTime(),Object(fe.a)(this.enabledParameter,e.enabled,r,n),Object(fe.a)(this.pulseWidthParameter,e.pulseWidth,r,n);var a=e.oscillatorType;return Object(fe.a)(this.oscillatorFrequencyParameter,e.oscillatorFrequency,r,n),Object(fe.a)(this.portamentoParameter,e.portamento,r,n),void 0!==e.oscillatorOctave?Object(fe.a)(this.oscillatorOctaveParameter,e.oscillatorOctave,r,n):Object(fe.a)(this.oscillatorOctaveParameter,1,r,n),e.customOscillatorType?Object(fe.a)(this.customOscillatorTypeParameter,e.customOscillatorType,r,n):Object(fe.a)(this.oscillatorTypeParameter,a,r,n),e.harmonics&&Object(fe.a)(this.harmonicsParameter,e.harmonics,r,n),void 0!==e.partials&&null!==e.partials&&("custom"!==this.oscillatorType||this.customOscillatorType||Object(fe.a)(this.partialsParameter,e.partials,r,n)),e.spread&&Object(fe.a)(this.spreadParameter,e.spread,r,n),e.count&&Object(fe.a)(this.countParameter,e.count,r,n),r=Object(p.a)({},r,Object(ee.a)(e,"oscillatorOctaveParameter",this.oscillatorOctaveParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"pulseWidthParameter",this.pulseWidthParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"enabledParameter",this.enabledParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"portamentoParameter",this.portamentoParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"detuneParameter",this.detuneParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"oscillatorTypeParameter",this.oscillatorTypeParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"partialsParameter",this.partialsParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"customOscillatorTypeParameter",this.customOscillatorTypeParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"harmonicsParameter",this.harmonicsParameter,this.sequencerEngine,t,!0,n)),this.customOscillatorType&&(e.waveformA?Object(fe.a)(this.waveformAParameter,e.waveformA,r,n):Object(fe.a)(this.waveformAParameter,2,r,n),e.waveformB?Object(fe.a)(this.waveformBParameter,e.waveformB,r,n):Object(fe.a)(this.waveformBParameter,0,r,n),r=Object(p.a)({},r,Object(ee.a)(e,"waveformAParameter",this.waveformAParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"waveformBParameter",this.waveformBParameter,this.sequencerEngine,t,!0,n))),Object(pe.a)(e.detune)&&Object(fe.a)(this.detuneParameter,e.detune,r,n),Object(fe.a)(this.oscillatorLevelParameter,e.oscillatorLevel,r,n),r=Object(p.a)({},r,Object(ee.a)(e,"detuneParameter",this.detuneParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"oscillatorLevelParameter",this.oscillatorLevelParameter,this.sequencerEngine,t,!0,n))}},{key:"isCarrier",get:function(){return 0===this.instrument.oscillatorNodes.indexOf(this)}},{key:"fromFMJson",value:function(e,t,n){if(void 0===e)return{};var r={};return void 0!==e.harmonicity&&(e.harmonicity=pn(e.harmonicity,this.isCarrier,e.isHarmonicityFixed),Object(fe.a)(this.harmonicityParameter,e.harmonicity,r,n)),void 0!==e.partialCount&&Object(fe.a)(this.partialCountParameter,e.partialCount,r,n),void 0!==e.modulationIndex&&Object(fe.a)(this.modulationIndexParameter,e.modulationIndex,r,n),void 0!==e.ampEnvelope&&(console.log("LOADING ENVELOPE FOR OSC=",this.name,e.ampEnvelope),r=Object(p.a)({},r,this.ampEnvelope.fromJson(e.ampEnvelope,t,n))),r=Object(p.a)({},r,Object(ee.a)(e,"partialCountParameter",this.partialCountParameter,this.sequencerEngine,t,!0,n)),e.harmonicityParameter&&(e.harmonicityParameter.unlockedValue=pn(e.harmonicityParameter.unlockedValue,this.isCarrier,e.isHarmonicityFixed),e.harmonicityParameter.value=pn(e.harmonicityParameter.value,this.isCarrier,e.isHarmonicityFixed)),r=Object(p.a)({},r,Object(ee.a)(e,"harmonicityParameter",this.harmonicityParameter,this.sequencerEngine,t,!0,n),Object(ee.a)(e,"modulationIndexParameter",this.modulationIndexParameter,this.sequencerEngine,t,!0,n)),(new Date).getTime(),"formants"in e?r=Object(p.a)({},r,this.loadFormantsJson(e.formants,t,n)):(this.formants.forEach(function(e){return e.ripMods()}),this.formants.forEach(function(e){return Object(fe.a)(e.enabledParameter,!1,r)},n)),(new Date).getTime(),r}},{key:"mateParameter",value:function(e,t,n,r){Object(Y.b)(this.sequencerEngine,e,t,n,r)}},{key:"mateJson",value:function(e,t){this.mateParameter("enabled",e,this.enabledParameter,t),this.enabled&&(this.enabled=!0,this.mateParameter("polyphony",e,this.polyphonyParameter,t),this.mateParameter("oscillatorType",e,this.oscillatorTypeParameter,t),this.mateParameter("oscillatorFrequency",e,this.oscillatorFrequencyParameter,t),this.mateParameter("detune",e,this.detuneParameter,t),this.mateParameter("portamento",e,this.portamentoParameter,t))}}]),n}(e)})(de)),gn=function(){function e(t,n,r){Object(s.a)(this,e),this.sequencerEngine=t,this.store=t.store,this.mixSession=n,this.context=r.getCopy().forSubDevice(this),this.parameters=[],this.envelope=new be(this.sequencerEngine,this.mixSession,this.context,void 0,-2e3,2e3),this.setupParameters()}return Object(o.a)(e,[{key:"setupParameters",value:function(){var e=this;this.attackParameter=new re.a("Attack",this,function(t,n){e.envelope&&(e.envelope.attack=n)},{min:0,max:1e4,unit:"ms",defaultValue:1e3}),this.registerParameter(this.attackParameter),this.decayParameter=new re.a("Decay",this,function(t,n){e.envelope&&(e.envelope.decay=n)},{min:0,max:4e3,unit:"ms",defaultValue:1e3}),this.registerParameter(this.decayParameter),this.sustainParameter=new re.a("Sustain",this,function(t,n){e.envelope&&(e.envelope.sustain=n)},{min:0,max:1,unit:"",defaultValue:.5}),this.registerParameter(this.sustainParameter),this.releaseParameter=new re.a("Release",this.envelope,function(t,n){e.envelope&&(e.envelope.release=n)},{min:0,max:5e3,unit:"ms",defaultValue:1e3}),this.registerParameter(this.releaseParameter),this.levelParameter=new re.a("Level",this,function(t,n){e.envelope&&(e.envelope.level=n)},{min:-1,max:1,unit:"",defaultValue:0}),this.registerParameter(this.levelParameter),this.attackCurveParameter=new re.a("Attack Curve",this.envelope,function(e,t){return e.attackCurve=t},{min:0,max:1e4,unit:"",defaultValue:"linear",automatable:!1}),this.registerParameter(this.attackCurveParameter),this.decayCurveParameter=new re.a("Decay Curve",this.envelope,function(e,t){return e.decayCurve=t},{min:0,max:1e4,unit:"",automatable:!1,defaultValue:"linear"}),this.registerParameter(this.decayCurveParameter),this.releaseCurveParameter=new re.a("Release Curve",this.envelope,function(e,t){return e.releaseCurve=t},{min:0,max:1e4,unit:"",automatable:!1,defaultValue:"exponential"}),this.registerParameter(this.releaseCurveParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(e){var t={level:this.level,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackCurve:this.attackCurve,decayCurve:this.decayCurve,releaseCurve:this.releaseCurve};return t=Object(ee.b)(t,"attackParameter",this.attackParameter,void 0,e),t=Object(ee.b)(t,"decayParameter",this.decayParameter,void 0,e),t=Object(ee.b)(t,"sustainParameter",this.sustainParameter,void 0,e),t=Object(ee.b)(t,"releaseParameter",this.releaseParameter,void 0,e),t=Object(ee.b)(t,"levelParameter",this.levelParameter,void 0,e),t=Object(ee.b)(t,"attackCurveParameter",this.attackCurveParameter,void 0,e),t=Object(ee.b)(t,"decayCurveParameter",this.decayCurveParameter,void 0,e),t=Object(ee.b)(t,"releaseCurveParameter",this.releaseCurveParameter,void 0,e)}},{key:"fromJson",value:function(e){var t={};return Object(fe.a)(this.attackParameter,e.attack,t),Object(fe.a)(this.decayParameter,e.decay,t),Object(fe.a)(this.sustainParameter,e.sustain,t),Object(fe.a)(this.releaseParameter,e.release,t),Object(fe.a)(this.levelParameter,e.level,t),e.attackCurve&&Object(fe.a)(this.attackCurveParameter,e.attackCurve,t),e.decayCurve&&Object(fe.a)(this.decayCurveParameter,e.decayCurve,t),e.releaseCurve&&Object(fe.a)(this.releaseCurveParameter,e.releaseCurve,t),t=Object(p.a)({},t,Object(ee.a)(e,"attackParameter",this.attackParameter,this.sequencerEngine),Object(ee.a)(e,"decayParameter",this.decayParameter,this.sequencerEngine),Object(ee.a)(e,"sustainParameter",this.sustainParameter,this.sequencerEngine),Object(ee.a)(e,"releaseParameter",this.releaseParameter,this.sequencerEngine),Object(ee.a)(e,"levelParameter",this.levelParameter,this.sequencerEngine),Object(ee.a)(e,"attackCurveParameter",this.attackCurveParameter,this.sequencerEngine),Object(ee.a)(e,"decayCurveParameter",this.decayCurveParameter,this.sequencerEngine),Object(ee.a)(e,"releaseCurveParameter",this.releaseCurveParameter,this.sequencerEngine))}},{key:"getCopy",value:function(t){var n=new e(this.sequencerEngine,this.mixSession,t);return n.fromJson(this.getJson()),n}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"level",get:function(){return this.levelParameter.get()},set:function(e){this.levelParameter.set(e)}},{key:"attackCurve",get:function(){return this.attackCurveParameter.get()},set:function(e){this.attackCurveParameter.set(e)}},{key:"decayCurve",get:function(){return this.decayCurveParameter.get()},set:function(e){this.decayCurveParameter.set(e)}},{key:"releaseCurve",get:function(){return this.releaseCurveParameter.get()},set:function(e){this.releaseCurveParameter.set(e)}},{key:"refresh",value:function(){this.attackParameter.callSetter(),this.decayParameter.callSetter(),this.sustainParameter.callSetter(),this.releaseParameter.callSetter(),this.levelParameter.callSetter()}},{key:"mateJson",value:function(e,t){this.mateParameter("attack",e,this.attackParameter,t),this.mateParameter("decay",e,this.decayParameter,t),this.mateParameter("sustain",e,this.sustainParameter,t),this.mateParameter("release",e,this.releaseParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){Object(Y.b)(this.sequencerEngine,e,t,n,r)}},{key:"dispose",value:function(){this.envelope.dispose(),this.envelope=void 0}}]),e}();function On(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var kn=n(32),jn=n(157);function wn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return xn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function xn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Sn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Pn=function(e,t){var n=new W.a.Frequency(e).toMidi()+1;return e+t/100*(new W.a.Frequency(n,"midi").toFrequency()-e)},En=function e(t,n,r){Object(s.a)(this,e),this.carrier=t,this.modulators=n,this.slotNumber=r,this.voiceNumber=r};function Tn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function An(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Mn=function(e){Object(u.a)(n,e);var t=An(n);function n(e,r,a,i){var o;return Object(s.a)(this,n),(o=t.call(this,e,r,a,!1)).track=i,o.id=Object(S.uuid)(),o.initializeConfigurations(o.adjacencyLists),o.loaded=!0,se("01_Saw"),se("03_Square"),o.setupOscillators(),o.setupOutputs(),o.setupFilters(),o.outputNode=o.filter.effectNode,o.outputNode.x=180,o.outputNode.y=200,o.setupFM(),o.setupPitchBend(),o.getParameters().forEach(function(e){return e.isLoaded=!0}),o.setupParameters(),o.refreshParameters(),o.voiceFactory=gt,o.sequencerEngine.dispatch(Object(C.ub)(o.initialBulkValues)),o.setupSlide(),o.polyphonyParameter.set(5),o.algorithmParameter.set(3),o.connectNoise(),o.setupNoiseParameters(),e.isOffline||setTimeout(function(){o.polyphonyParameter.set(6)},500),o}return Object(o.a)(n,[{key:"detuneSignal",get:function(){return this.pitchBendSignal}},{key:"detuneParameter",get:function(){return this.pitchBendParameter}},{key:"detuneSignals",get:function(){var e=[];return this.oscillators.forEach(function(t){return t.voices.forEach(function(t){return e.push(t.detune)})}),e}},{key:"effects",get:function(){return this.oscillatorNodes},set:function(e){}},{key:"newEdge",value:function(e,t){return new Lt(e,this.sequencerEngine,t)}},{key:"connectEdge",value:function(e,t){return Object(ne.a)(Object(f.a)(n.prototype),"connectEdge",this).call(this,e,t),e.connectEdge(t),t}},{key:"deleteEdge",value:function(e){var t=this;if(!e.modulator){var r=function(n){t.adjacencyLists[n].indexOf(e)>-1&&(t.effects.find(function(e){return e.id===n})&&e.disconnect&&(console.log("DISCONNECTING"),e.disconnect()))};for(var a in this.adjacencyLists)r(a)}Object(ne.a)(Object(f.a)(n.prototype),"deleteEdge",this).call(this,e)}},{key:"getEffectType",value:function(){return he.d}},{key:"modulators",get:function(){return Object(h.a)(this.sequencerEngine.lfos.map(function(e){return e.lfo}))}},{key:"setSize",value:function(e,t,n,r){this.inputNode.x=0,this.inputNode.y=0,this.outputNodeX.x=e-32,this.outputNodeX.y=10,this.outputNodeY.x=e-32,this.outputNodeY.y=45}},{key:"dispose",value:function(){this.deleteAlgorithmRouting(),this.disposeOutputs(),this.disposeNoise(),Object(ne.a)(Object(f.a)(n.prototype),"dispose",this).call(this)}},{key:"getCopy",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.sequencerEngine,a=arguments.length>3?arguments[3]:void 0,i=new n(r,this.mixSession,e,t);return i.fromJsonSync(this.getJson(),a),i}},{key:"simplifyPatch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e/2;Object(ne.a)(Object(f.a)(n.prototype),"simplifyPatch",this).call(this,e);var r=this.oscillators.flatMap(function(e){return e.formantsManager.formants}).filter(function(e){return e.isEnabled});r=Object(mt.a)(r);for(var a=Math.floor(r.length*t/100),i=0;i<a;i++){var s=r[i];s.getParameters().filter(function(e){return e.isMapped}).forEach(function(e){return e.isMapped.unmap(e)}),s.effect&&s.bypassEffect(),s.enabledParameter.set(!1)}}},{key:"test",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=0;t<100;t++)this.algorithmParameter.set(t%8+1),Object(O.a)(50);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(Object(Ye.a)(function(e){return function(e){Object(u.a)(n,e);var t=Tn(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).voiceCounter=0,e.voiceToTranspose={},e.frequencyToVoice={},e.voiceToFrequency={},e.voicesUsed=[],e.numberToVoice={},e}return Object(o.a)(n,[{key:"useVoice",value:function(e,t){var n=this.findFreeVoice(t,e);return this.buildVoice(n)}},{key:"buildVoice",value:function(e){return new En(this.carrierOscillator.voices[e],this.modulatorOscillators.map(function(t){return t.voices[e]}),e)}},{key:"findFreeVoice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W.a.Master.context.currentTime,t=arguments.length>1?arguments[1]:void 0,n=this.oscillators[0].getNoteFromTranspose(t).toFrequency();for(var r in this.voiceToFrequency)if(!(parseInt(r)>=this.polyphonyParameter.get())&&this.voiceToFrequency[r]===n)return parseInt(r);for(var a=this.oscillators[0].voices,i=this.voiceCounter,s=0;s<this.polyphonyParameter.get();s++){var o=(i+s)%a.length;if(0===a[o].envelope.getValueAtTime(e))return parseInt(o)}for(var c=[],u=this.voicesUsed.length-1;u>=0;u--)if((c=Array.from(new Set([].concat(Object(h.a)(c),[this.voicesUsed[u]])))).length===this.polyphonyParameter.get())return this.voicesUsed[u];return this.polyphonyParameter.get()-1}},{key:"storeVoiceFrequency",value:function(e,t,n){var r=this.oscillators[0].getNoteFromTranspose(e);this.frequencyToVoice[r.toFrequency()]=t,this.voiceToFrequency[t]=r.toFrequency(),this.voiceCounter=(this.voiceCounter+1)%this.polyphonyParameter.get(),this.numberToVoice[t]=n}},{key:"clearVoiceData",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.releaseAll(),this.voiceCounter=0,this.voiceToTranspose={},this.frequencyToVoice={},this.voiceToFrequency={},this.voicesUsed=[],this.numberToVoice={}}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Sn(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getJson",value:function(e){var t,n=(t={id:this.id,mix:this.mixParameter.get(!0),algorithm:this.algorithmParameter.get(!0),ampEnvelope:this.ampEnvelope.getJson(e),polyphony:this.polyphonyParameter.get(),instrumentType:this.getInstrumentType(),filterCutoff:this.filterCutoff,filterQ:this.filterQ,hpFilterCutoff:this.hpFilterCutoff,fmParameters:this.fmParameters,hpFilterQ:this.hpFilterQ},Object(kn.a)(t,"ampEnvelope",this.ampEnvelope.getJson(e)),Object(kn.a)(t,"filterEnvelope",this.filterEnvelope.getJson(e)),Object(kn.a)(t,"hpFilterEnvelope",this.hpFilterEnvelope.getJson(e)),Object(kn.a)(t,"pitchEnvelope",this.pitchEnvelope.getJson(e)),Object(kn.a)(t,"oscillators",this.oscillatorNodes.map(function(t){return t.getJson(e)})),Object(kn.a)(t,"noiseLevel",this.noiseLevelParameter.get(!0)),Object(kn.a)(t,"pitchBend",this.pitchBendParameter.get(!0)),t);return n=Object(ee.b)(n,"noiseLevelParameter",this.noiseLevelParameter,void 0,e),n=Object(ee.b)(n,"filterCutoffParameter",this.filterCutoffParameter,void 0,e),n=Object(ee.b)(n,"hpFilterCutoffParameter",this.hpFilterCutoffParameter,void 0,e),n=Object(ee.b)(n,"hpFilterQParameter",this.hpFilterQParameter,void 0,e),n=Object(ee.b)(n,"filterQParameter",this.filterQParameter,void 0,e),n=Object(ee.b)(n,"algorithmParameter",this.algorithmParameter,void 0,e),n=Object(ee.b)(n,"mixParameter",this.mixParameter,void 0,e),n=Object(ee.b)(n,"pitchBendParameter",this.pitchBendParameter,void 0,e)}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f.length>1&&void 0!==f[1]&&f[1],r=f.length>2&&void 0!==f[2]&&f[2],i=f.length>3&&void 0!==f[3]?f[3]:100,s=0,t){e.next=6;break}return e.abrupt("return",{});case 6:t.fmParameters&&!n&&(this.fmParameters=t.fmParameters),!n&&t.id&&(this.id=t.id);case 8:if(oe("01_Saw")&&oe("03_Square")){e.next=15;break}return e.next=11,Object(O.a)(100);case 11:if(!(++s>50)){e.next=13;break}return e.abrupt("return");case 13:e.next=8;break;case 15:return this.ampEnvelope.release=50,this.clearVoiceData(),(new Date).getTime(),this.loaded=!1,this.track.trackIsLoading=!0,e.next=22,Object(O.a)(120);case 22:return this.getParameters().forEach(function(e){return e.isLoaded=!1}),o={},void 0!==t.polyphony&&(c=this.polyphonyParameter.set(t.polyphony,void 0,!0),u=c.id,l=c.value,o[u]=l),e.t0=p.a,e.t1={},e.t2=o,e.next=30,this.fromOscillatorsJson(t,n,i);case 30:return e.t3=e.sent,o=(0,e.t0)(e.t1,e.t2,e.t3),void 0!==t.algorithm&&Object(fe.a)(this.algorithmParameter,t.algorithm,o,i),r&&(o=Object(p.a)({},o,this.scaleToC())),o=Object(p.a)({},o,this.fromJsonRest(t,n,i)),(new Date).getTime(),this.keepParametersInSync(),e.abrupt("return",o);case 38:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fromJsonSync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!t&&e.id&&(this.id=e.id),this.loaded=!1,this.track.trackIsLoading=!0,this.getParameters().forEach(function(e){return e.isLoaded=!1});var n={};if(void 0!==e.polyphony){var r=this.polyphonyParameter.set(e.polyphony,void 0,!0),a=r.id,i=r.value;n[a]=i}void 0!==e.algorithm&&Object(fe.a)(this.algorithmParameter,e.algorithm,n,100),n=Object(p.a)({},n,this.fromOscillatorsJsonSync(e,t),this.fromJsonRest(e,t))}},{key:"fromJsonRest",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=(0,{});if(r=Object(p.a)({},r,this.ampEnvelope.fromJson(e.ampEnvelope,void 0,n)),void 0!==e.noiseLevel?(Object(fe.a)(this.noiseLevelParameter,e.noiseLevel,r,n),r=Object(p.a)({},r,Object(ee.a)(e,"noiseLevelParameter",this.mixParameter,this.sequencerEngine,t))):this.noiseLevelParameter.set(0),r=Object(p.a)({},r,Object(ee.a)(e,"mixParameter",this.mixParameter,this.sequencerEngine,t),Object(ee.a)(e,"algorithmParameter",this.algorithmParameter,this.sequencerEngine,t),Object(ee.a)(e,"pitchBendParameter",this.pitchBendParameter,this.sequencerEngine,t)),e.pitchBend?Object(fe.a)(this.pitchBendParameter,e.pitchBend,r):Object(fe.a)(this.pitchBendParameter,0,r),void 0!==e.mix&&Object(fe.a)(this.mixParameter,e.mix,r),this.detuneOffset){var a=this.pitchBendParameter.set(this.pitchBendParameter.get(!0)+this.detuneOffset),i=a.id,s=a.value;r[i]=s}return r}},{key:"keepParametersInSync",value:function(){this.getParameters().forEach(function(e){e.depthSignal&&e.depthParameter&&e.depthSignal.value!==e.depthParameter.get(!0)&&e.depthParameter.refresh(!0,!0),e._audioParams&&e._audioParams.filter(function(e){return e.input&&0!==e.value}).forEach(function(e){e.value=0}),e.audioParam&&e.audioParam.value!==e.get(!0)&&e.refresh(!0,!0)}),this.loaded=!0,this.getParameters().forEach(function(e){return e.isLoaded=!0}),this.track.trackIsLoading=!1}},{key:"fromOscillatorsJsonSync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};for(var r in this.instrumentType=e.instrumentType,this.oscillatorNodes){r=parseInt(r);var a=this.oscillatorNodes[r];n=Object(p.a)({},n,a.fromJson(e.oscillators[r],t))}return Object(p.a)({},n,this.loadFilterJson(e,t,100))}},{key:"loadOscillators",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]&&c[1],r=c.length>2?c[2]:void 0,(new Date).getTime(),e.t0=p.a,e.t1={},e.t2=i,e.next=9,this.oscillatorNodes[0].fromJson(t.oscillators[0],n,r);case 9:e.t3=e.sent,i=(0,e.t0)(e.t1,e.t2,e.t3),e.t4=a.a.keys(this.oscillatorNodes);case 12:if((e.t5=e.t4()).done){e.next=21;break}if(s=e.t5.value,0!==(s=parseInt(s))){e.next=17;break}return e.abrupt("continue",12);case 17:o=this.oscillatorNodes[s],i=Object(p.a)({},i,o.fromJson(t.oscillators[s],n,r)),e.next=12;break;case 21:return(new Date).getTime(),e.abrupt("return",i);case 23:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fromOscillatorsJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]&&s[1],r=s.length>2?s[2]:void 0,this.instrumentType=t.instrumentType,e.next=5,this.loadOscillators(t,n,r);case 5:return i=e.sent,e.abrupt("return",Object(p.a)({},i,this.loadFilterJson(t,n,r)));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadFilterJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r={};return r=Object(p.a)({},r,this.filterEnvelope.fromJson(e.filterEnvelope,t,n),this.pitchEnvelope.fromJson(e.pitchEnvelope,t,n),Object(ee.a)(e,"filterCutoffParameter",this.filterCutoffParameter,this.sequencerEngine,t,!0),Object(ee.a)(e,"filterQParameter",this.filterQParameter,this.sequencerEngine,t,!0),Object(ee.a)(e,"hpFilterCutoffParameter",this.hpFilterCutoffParameter,this.sequencerEngine,t,!0),Object(ee.a)(e,"hpFilterQParameter",this.hpFilterQParameter,this.sequencerEngine,t,!0)),e.hpFilterEnvelope&&(r=Object(p.a)({},r,this.hpFilterEnvelope.fromJson(e.hpFilterEnvelope))),Object(fe.a)(this.filterCutoffParameter,e.filterCutoff,r),Object(fe.a)(this.filterQParameter,e.filterQ,r),void 0!==e.hpFilterCutoff&&(Object(fe.a)(this.hpFilterCutoffParameter,e.hpFilterCutoff,r),Object(fe.a)(this.hpFilterQParameter,e.hpFilterQ,r)),r}},{key:"scaleToC",value:function(){var e=this.getLoudestOsc(),t=e.harmonicityParameter.get(!0),n=e.detuneParameter.get(!0),r=this.carrierOscillator.oscillatorFrequencyParameter.get(!0),a=new W.a.Frequency("C3").toFrequency(),i=a,s=a+((a+Pn(a,n))*t-i),o=new W.a.Frequency(s).toMidi(),c=o-new W.a.Frequency("C3").toMidi(),u=new W.a.Frequency(o,"midi").toFrequency(),l=s-u;l<0?(new W.a.Frequency(o-1,"midi").toFrequency(),this.detuneOffset=0):(new W.a.Frequency(o+1,"midi").toFrequency(),this.detuneOffset=0);var f=-c,h=Object(jn.a)(f,12);f=12*Math.floor(r/12)+h;var p=this.carrier.oscillatorFrequencyParameter.set(f,!1,!0),d=p.id,v=p.value,m={};return m[d]=v,m}},{key:"getLoudestOsc",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.oscillators;if(0!==e.length){var t,n,r=[],a=wn(this.oscillators);try{for(a.s();!(t=a.n()).done;){var i=t.value;this.adjacencyLists[i.id].some(function(e){return"X"===e.effect.name||"Y"===e.effect.name})&&r.push(i)}}catch(f){a.e(f)}finally{a.f()}var s,o=-1/0,c=wn(e);try{for(c.s();!(s=c.n()).done;){var u=s.value;if(r.includes(u)){var l=u.oscillatorLevelParameter.get(!0);l>o&&(n=u,o=l)}}}catch(f){c.e(f)}finally{c.f()}return n}}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=On(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"setupOscillators",value:function(){this.pitchEnvelope=new gn(this.sequencerEngine,this.mixSession,this.context),this.pitchEnvelope.name="Pitch Envelope",this.oscillatorNodes=[this.createNewOscillator(!0,"C"),this.createNewOscillator(!0,"A"),this.createNewOscillator(!0,"B1"),this.createNewOscillator(!0,"B2")],this.oscillators[0].enabled=!0,this.oscillators[1].enabled=!0,this.oscillators[2].enabled=!0,this.oscillators[3].enabled=!0}},{key:"carrierOscillator",get:function(){if(this.oscillatorNodes)return this.oscillatorNodes[0]}},{key:"modulatorOscillators",get:function(){if(this.oscillatorNodes)return this.oscillators.slice(1)}},{key:"oscillators",get:function(){return this.oscillatorNodes?this.oscillatorNodes.filter(function(e){return e.enabled}):[]}},{key:"getOscillator",value:function(e){return this.oscillatorNodes?this.oscillatorNodes[e]:[]}},{key:"createNewOscillator",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"A";return new bn(this.sequencerEngine,this.mixSession,this.context,this.pitchEnvelope.envelope,e,t,this.track,this)}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=$t(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"setupFM",value:function(){var e=this,t=this.track;this.fmParameters={id:Object(S.uuid)()},this.oscillators[0].track=t,this.oscillators[0].x=83,this.oscillators[0].y=9,this.oscillators[1].track=t,this.oscillators[1].x=26,this.oscillators[1].y=9,this.oscillators[3].track=t,this.oscillators[3].x=26,this.oscillators[3].y=45,this.oscillators[2].track=t,this.oscillators[2].x=83,this.oscillators[2].y=45,this.carrier=this.oscillators[0],this.oscillators.forEach(function(t){return t===e.carrier?t.fm(void 0,!1):t.fm(e.carrier,!1)});var n=this.oscillators.reduce(function(e,t){return Object(p.a)({},e,t.bulk)},{});this.sequencerEngine.dispatch(Object(C.ub)(n)),this.oscillators[0].ampEnvelope=this.ampEnvelope,this.oscillators[0].harmonicityParameter.set(.5),this.oscillators[0].modulationIndexParameter.set(24),this.oscillators[1].harmonicityParameter.set(1),this.oscillators[2].harmonicityParameter.set(4),this.oscillators[2].modulationIndexParameter.set(32),this.oscillators[3].harmonicityParameter.set(2),this.oscillators[3].modulationIndexParameter.set(15),this.carrier=this.oscillators[0],this.oscillators[1].carrier=this.carrier,this.oscillators[2].carrier=this.carrier,this.oscillators[3].carrier=this.carrier}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Xt(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"onChangePolyphony",value:function(e){var t=this.oscillatorNodes[0].voices;if(e!==t.length){if(e>t.length)for(var n=t.length;n<e;n++)this.outputNodeX.newVoice(),this.outputNodeY.newVoice();else for(var r=e;r<t.length;r++)this.outputNodeX.removeVoice(),this.outputNodeY.removeVoice();this.refreshAmpEnvelopes()}}},{key:"refreshAmpEnvelopes",value:function(){this.ampEnvelope.ampEnvelopes=this.ampEnvelopes,this.ampEnvelope.refresh()}},{key:"setupOutputs",value:function(){var e=this.sequencerEngine,t=this.mixSession;this.outputNodeX=new Qt("X",-2,this,0,e,t,this.context),this.outputNodeY=new Qt("Y",-3,this,1,e,t,this.context),this.outputCrossFade=new W.a.CrossFade(.5),this.ampEnvelope=new _t(e,t,this.context,this.ampEnvelopes,this),this.ampEnvelope.name="Amp Envelope";var n,r=Zt(this.oscillatorNodes);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.ampEnvelope.name="Envelope "+a.name}}catch(i){r.e(i)}finally{r.f()}}},{key:"forSlot",value:function(e){var t=this.outputNodeX,n=this.outputNodeY,r=[];for(var a in t.outputs)t.outputs[a].ampEnvelopes[e]||t.newVoice(),r=[].concat(Object(h.a)(r),[t.outputs[a].ampEnvelopes[e]]);for(var i in n.outputs)n.outputs[i].ampEnvelopes[e]||n.newVoice(),r=[].concat(Object(h.a)(r),[n.outputs[i].ampEnvelopes[e]]);return r}},{key:"ampEnvelopes",get:function(){var e=this.outputNodeX,t=this.outputNodeY,n=[];for(var r in e.outputs)n=[].concat(Object(h.a)(n),Object(h.a)(e.outputs[r].ampEnvelopes));for(var a in t.outputs)n=[].concat(Object(h.a)(n),Object(h.a)(t.outputs[a].ampEnvelopes));return n}},{key:"disposeOutputs",value:function(){this.outputNodeX.dispose(),this.outputNodeY.dispose(),this.outputCrossFade.dispose(),this.outputNodeX=void 0,this.outputNodeY=void 0,this.outputCrossFade=void 0}},{key:"connectNoise",value:function(){}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Ht(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"triggerAttack",value:function(e,t,n,r,a){var i=this;if(this.loaded||W.a.Master.context.isOffline){t=W.a.Master.context.isOffline?W.a.Master.context._currentTime:W.a.Master.context.currentTime;var s=this.useVoice(e,t);if(s){var o=s.voiceNumber;this.voicesUsed.push(o),this.setEnvelopes(a,e,s),this.triggerAttackEnvelopes(t,n,s.slotNumber),this.scaleByKey(t,e,o),this.carrierOscillator.triggerAttack(e,t,n,s.carrier),s.modulators.filter(function(e,t){return i.oscillatorNodes[t].enabled}).forEach(function(e){e._triggerEnvelopeAttack(t,n)}),this.storeVoiceFrequency(e,o,s)}}}},{key:"triggerAttackRelease",value:function(e,t,n,r,a,i){var s=this;if(this.loaded||W.a.Master.context.isOffline){n=new W.a.Time(n),r>1&&(r=1);var o=this.useVoice(e,n);if(o){var c=o.voiceNumber;this.voicesUsed.push(c),this.setEnvelopes(i,void 0,o),this.triggerAttackReleaseEnvelopes(t,n,r,o.slotNumber),this.scaleByKey(n,e,c),this.carrierOscillator.triggerAttackRelease(e,t,n,r,o.carrier),o.modulators.filter(function(e,t){return s.oscillatorNodes[t].enabled}).forEach(function(e){e._triggerEnvelopeAttack(n,r),e._triggerEnvelopeRelease(n+t)}),this.storeVoiceFrequency(e,c,o),this.lastTranspose=e}}}},{key:"triggerRelease",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W.a.Master.context.currentTime,r=arguments.length>2?arguments[2]:void 0,a=(e&&e.map(function(e){return t.oscillators[0].getNoteFromTranspose(e)}))[0].toFrequency(),i=void 0===e?0:this.frequencyToVoice[a];if(this.voiceToFrequency[i]===a){var s=this.numberToVoice[i];this.setEnvelopes(void 0,void 0,s),this.triggerReleaseEnvelopes(n,s.slotNumber,r),this.voiceToTranspose[i]=e&&e[0],void 0===r&&this.carrierOscillator.triggerRelease(e,s.carrier,n,r),s.modulators.forEach(function(e){e._triggerEnvelopeRelease(n,r)})}}},{key:"isLastVoice",value:function(e){for(var t=this.oscillators[0].voices,n=(this.voiceCounter,0),r=0;r<this.polyphonyParameter.get();r++)if(t[r].envelope.getValueAtTime(e)>0&&n++,n>1)return!1;return!0}},{key:"releaseAll",value:function(){if(!this.disposed){var e,t=Jt(this.oscillatorNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;n._voices.forEach(function(e){return e.envelope.release=.01}),n._voices.forEach(function(e){return e.triggerRelease()})}}catch(r){t.e(r)}finally{t.f()}this.clearSlide(),this.releaseSlide(),this.detuneSignal.value=this.detuneParameter.get(!0),this.lastTranspose=0,this.clearVoiceData(!1)}}},{key:"setEnvelopes",value:function(e,t,n){var r=this;this.ampEnvelope.refresh(),this.pitchEnvelope.refresh(),this.filterEnvelope.refresh(),this.hpFilterEnvelope.refresh(),this.carrierOscillator.setEnvelopes(e,this.ampEnvelope,t,n.carrier),this.modulatorOscillators.forEach(function(a,i){return a.setEnvelopes(e,r.ampEnvelope,t,n.modulators[i])})}},{key:"triggerAttackEnvelopes",value:function(e,t,n){this.forSlot(n).forEach(function(n){return n.envelope.triggerAttack(e,t)}),this.filterEnvelope.triggerAttack(e,t),this.hpFilterEnvelope.triggerAttack(e,t),this.pitchEnvelope.envelope.triggerAttack(e,t)}},{key:"triggerReleaseEnvelopes",value:function(e,t,n){this.forSlot(t).forEach(function(t){return t.envelope.triggerRelease(e+1/W.a.Master.context.sampleRate,n)}),this.isLastVoice(e)&&(this.filterEnvelope.triggerRelease(e),this.hpFilterEnvelope.triggerRelease(e),this.pitchEnvelope.envelope.triggerRelease(e))}},{key:"triggerAttackReleaseEnvelopes",value:function(e,t,n,r){this.forSlot(r).forEach(function(r){return r.envelope.triggerAttackRelease(e,t,n)}),this.filterEnvelope.triggerAttackRelease(e,t,n),this.hpFilterEnvelope.triggerAttackRelease(e,t,n),this.pitchEnvelope.envelope.triggerAttackRelease(e,t,n)}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Wt(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"setupParameters",value:function(){var e=this;this.polyphonyParameter=new re.b("Polyphony",this,function(t,n){if(e.oscillators[0].voices.length!==n&&e.algorithmParameter){e.deleteAlgorithmRouting(),e.onChangePolyphony(n),e.onPolyNoise(n),e.clearVoiceData();var r=Object(h.a)(e.oscillatorNodes);n<r[0]._voices.length&&r.reverse(),r.forEach(function(e){return e.polyphony=n}),e.currentAlgo=void 0,e.changeAlgorithm(e.algorithmParameter.get(),void 0,void 0,!0),e.connectPitchBend()}},{documentation:["The number of voices in the synth.","When set 1, it becomes monophonic (i.e. only 1 note can be played at a time)"],min:0,max:16,unit:"",defaultValue:1,automatable:!1}),this.registerParameter(this.polyphonyParameter),this.algorithmParameter=new re.b("Algorithm",this,function(t,n){e.changeAlgorithm(n)},{documentation:["Choose the configuration for how the operators connect with one another.","Can get wildly different timbres this way"],min:1,max:8,unit:"",defaultValue:1}),this.registerParameter(this.algorithmParameter),this.mixParameter=new te.c("Mix",this.outputCrossFade.fade,{documentation:"Controls the mix between the operators set to X and Y.",min:0,max:1,defaultValue:.5}),this.registerParameter(this.mixParameter)}},{key:"getParameters",value:function(){if(!this.parameters)return[];var e=Object(h.a)(this.parameters);for(var t in this.oscillatorNodes)e=e.concat(this.oscillatorNodes[t].getParameters());return(e=e.concat(this.ampEnvelope.parameters).concat(this.pitchEnvelope.parameters).concat(this.hpFilterEnvelope.parameters).concat(this.filterEnvelope.parameters)).filter(function(e){return void 0!==e})}},{key:"getSubDevices",value:function(){var e,t=[{value:this.oscillatorNodes[0],label:"Operator C"},{value:this.oscillatorNodes[1],label:"Operator A"},{value:this.oscillatorNodes[2],label:"Operator B1"},{value:this.oscillatorNodes[3],label:"Operator B2"},{value:this,label:"Mix & Filter"},{value:this.ampEnvelope,label:"Amp Env."},{value:this.oscillatorNodes[1].ampEnvelope,label:"Mod A Env."},{value:this.oscillatorNodes[2].ampEnvelope,label:"Mod B1 Env."},{value:this.oscillatorNodes[3].ampEnvelope,label:"Mod B2 Env."},{value:this.filterEnvelope,label:"Filter Env."},{value:this.pitchEnvelope,label:"Pitch Env."},{value:this.hpfilterEnvelope,label:"HP Filter Env."}],n=Ut(this.oscillatorNodes);try{for(n.s();!(e=n.n()).done;)for(var r=e.value,a=0;a<r.formants.length;a++){var i=r.formants[a];t.push({value:i,label:"Formant "+(a+1)+" "+r.name})}}catch(s){n.e(s)}finally{n.f()}return t}},{key:"getSubDeviceIndex",value:function(e){return this.getSubDevices().map(function(e){return e.value}).indexOf(e)}},{key:"getSubDevice",value:function(e){var t=this.getSubDevices()[e];if(t)return t.value}},{key:"findParameter",value:function(e,t){var n=e.envelopeType,r=this.getParameters();"AMP"===n?r=this.ampEnvelope.parameters:"PITCH"===n?r=this.pitchEnvelope.parameters:"FILTER"===n&&(r=this.filterEnvelope.parameters);var a=r.filter(function(e){return e.name===t});if(0!==a.length)return a[0]}},{key:"filterCutoff",get:function(){return this.filterCutoffParameter.get()},set:function(e){this.filterCutoffParameter.set(e,!0,!0)}},{key:"filterQ",get:function(){return this.filterQParameter.get()},set:function(e){this.filterQParameter.set(e)}},{key:"hpFilterCutoff",get:function(){return this.hpFilterCutoffParameter.get()},set:function(e){this.hpFilterCutoffParameter.set(e)}},{key:"hpFilterQ",get:function(){return this.hpFilterQParameter.get()},set:function(e){this.hpFilterQParameter.set(e)}},{key:"isMonophonic",value:function(){return 1===this.polyphonyParameter.get()}},{key:"refreshParameters",value:function(){this.filterQ=this.filterQ,this.filterCutoff=this.filterCutoff,this.hpFilterCutoff=this.hpFilterCutoff}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=zt(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"setupFilters",value:function(){this.filter=new d.a.FilterEffect(this.sequencerEngine),this.hpFilter=new d.a.FilterEffect(this.sequencerEngine),this.hpFilter.hipass(),this.filter.connect(this.hpFilter.effectNode),this.filterEnvelope=new be(this.sequencerEngine,this.mixSession,this.context,this.filter.effectNode.frequency,0,1e4),this.filterEnvelope.name="Filter Envelope (LP)",this.filterEnvelope.attackCurve="linear",this.filterEnvelope.decayCurve="linear",this.filterEnvelope.releaseCurve="linear",this.hpFilterEnvelope=new be(this.sequencerEngine,this.mixSession,this.context,this.hpFilter.effectNode.frequency,0,1e4),this.hpFilterEnvelope.name="Filter Envelope (HP)",this.hpFilterEnvelope.attackCurve="linear",this.hpFilterEnvelope.decayCurve="linear",this.hpFilterEnvelope.releaseCurve="linear",this.filter.cutoffParameter.audioParam.input.automationRate="a-rate",this.outputCrossFade.connect(this.filter.effectNode),this.setupFilterParameters()}},{key:"connect",value:function(e){void 0!==e&&this.hpFilter.connect(e)}},{key:"disconnect",value:function(e){this.hpFilter.disconnect(e)}},{key:"setupFilterParameters",value:function(){var e=this;this.filterCutoffParameter=new te.a("Filter Cutoff",this.filter.effectNode.frequency,function(t,n){e.filter&&(isNaN(n)||(e.filterEnvelope&&(e.filterEnvelope.frequency=n),e.filter&&(e.filter.cutoffFrequency=n),e.oscillators&&e.oscillators.forEach(function(e){return e.cutoffFrequency=n})))},{min:0,max:1e4,unit:"HZ",defaultValue:1e4,constantAutomationRate:!0,documentation:["Controls the frequency at which filtering works at. ","Frequencies above this value will be cut."]}),this.registerParameter(this.filterCutoffParameter,function(e){return e.filter.frequency}),this.filterQParameter=new te.a("Filter Q",this.filter.effectNode.Q,function(t,n){e.filter&&(e.filter.Q=n)},{min:0,max:9,unit:"",defaultValue:1}),this.registerParameter(this.filterQParameter,function(e){return e.filter.Q}),this.hpFilterCutoffParameter=new te.a("Filter Cutoff (hi-pass)",this.hpFilter.effectNode.frequency,function(t,n){e.hpFilter&&!isNaN(n)&&(e.hpFilterEnvelope.frequency=n,e.hpFilter.cutoffFrequency=n)},{documentation:["Controls the frequency at which filtering works at. ","Frequencies below this value will be cut."],min:0,max:1e4,unit:"HZ",defaultValue:0,constantAutomationRate:!0}),this.registerParameter(this.hpFilterCutoffParameter),this.hpFilterQParameter=new te.a("Filter Q (hi-pass)",this.filter.effectNode.Q,function(t,n){e.hpFilter||(e.hpFilter.Q=n)},{min:0,max:9,unit:"",defaultValue:1}),this.registerParameter(this.hpFilterQParameter)}}]),n}(e)},wt,function(e){return function(e){Object(u.a)(n,e);var t=xt(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"setupPitchBend",value:function(){this.pitchBendSignal=new W.a.Signal(0),this.pitchBendParameter=new te.c("pitchBend",this.pitchBendSignal,{min:-200,max:200,defaultValue:0,automationRate:$.a}),this.registerParameter(this.pitchBendParameter),this.connectPitchBend()}},{key:"onPitchBend",value:function(e){this.pitchBendParameter.set(200*e,!1,!0)}},{key:"connectPitchBend",value:function(){var e=this;this.pitchBendSignal.disconnect(),this.detuneSignals.forEach(function(t){return e.pitchBendSignal.connect(t)})}}]),n}(e)},Bt.a,Ft.a,function(e){return function(e){Object(u.a)(n,e);var t=Et(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).currentAlgo=void 0,e.algorithms={1:{A:{feedback:!0,edges:[Tt]},B2:{edges:[Mt]},B1:{edges:[Tt,Nt]},C:{edges:[Ct]}},2:{A:{edges:[Tt]},B2:{edges:[Mt],feedback:!0},B1:{edges:[Nt]},C:{edges:[Ct]}},3:{A:{edges:[Tt,Rt,Mt],feedback:!0},B2:{edges:[Ct]},B1:{edges:[Nt]},C:{edges:[Ct]}},4:{A:{edges:[Tt]},B2:{edges:[Mt],feedback:!0},B1:{edges:[At,Nt]},C:{edges:[Ct]}},5:{A:{edges:[Tt,Nt]},B2:{edges:[Mt,At]},B1:{edges:[At],feedback:!0},C:{edges:[Ct]}},6:{A:{edges:[Tt,Mt],feedback:!0},B2:{edges:[Tt,Mt]},B1:{edges:[Nt]},C:{edges:[Ct]}},7:{A:{edges:[Tt,Ct],feedback:!0},B2:{edges:[Mt,Nt]},B1:{edges:[Nt]},C:{edges:[Ct]}},8:{A:{edges:[Tt]},B2:{edges:[Ct]},B1:{edges:[Nt],feedback:!0},C:{edges:[Ct]}},9:{A:{feedback:!0,edges:[Tt]},B2:{edges:[Mt,Ct]},B1:{edges:[Tt,Nt]},C:{edges:[Ct]}}},e}return Object(o.a)(n,[{key:"changeAlgorithm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.outputNodeX,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.outputNodeY,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e!==this.currentAlgo){var a=this.algorithms[e];for(var i in r||this.deleteAlgorithmRouting(void 0,t,n),a){var s,o=a[i],c=this.getNodeByName(i,t,n),u=St(o.edges);try{for(u.s();!(s=u.n()).done;){var l=s.value,f=this.getNodeByName(l,t,n);this.connectNodes(c,f)}}catch(h){u.e(h)}finally{u.f()}}this.adjacencyLists=Object(p.a)({},this.adjacencyLists),this.currentAlgo=e,this.refreshAmpEnvelopes()}}},{key:"deleteAlgorithmRouting",value:function(){var e=this;for(var t in arguments.length>0&&void 0!==arguments[0]&&arguments[0],this.adjacencyLists)Object(h.a)(this.adjacencyLists[t]).forEach(function(t){return e.deleteEdge(t)});this.currentAlgo=-1}},{key:"getNodeByName",value:function(e,t,n){return e===Ct?t:e==Nt?n:this.oscillatorNodes.find(function(t){return t.name===e})}},{key:"testAlgo",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=1,n=0;case 2:if(!(n<100)){e.next=11;break}return this.algorithmParameter.set(t,!1,!1),e.next=6,Object(O.a)(200);case 6:++t>=9&&(t=1);case 8:n++,e.next=2;break;case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(e)},yt.a,function(e){return function(e){Object(u.a)(n,e);var t=bt(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getModulatedParameters",value:function(){for(var e=[],t=0,n=Array.from(new Set(this.getParameters()));t<n.length;t++){var r=n[t];r.lfos.length+r.envelopes.length>0&&e.push(r)}return e}},{key:"getStats",value:function(){for(var e=0,t=0,n=Array.from(new Set(this.getParameters()));t<n.length;t++){var r=n[t];r.lfos.length,r.envelopes.length,e+=r.lfos.length+r.envelopes.length}return e}},{key:"simplifyPatch",value:function(e){for(var t=this.getModulatedParameters(),n=Math.floor(t.length*e/100),r=0;r<n;r++)t[r].disconnectFromAllModulators()}}]),n}(e)},Dt.a,function(e){return function(e){Object(u.a)(n,e);var t=vt(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).noiseSources=[],e}return Object(o.a)(n,[{key:"disposeNoise",value:function(){this.noiseSources.forEach(function(e){return e.dispose()}),this.noiseLevelParameter.dispose(),this.noiseSources=void 0}},{key:"setupNoiseParameters",value:function(){this.noiseLevelParameter=new le.a("Noise Level",this.noiseSources.map(function(e){return e.volume}),{documentation:"Controls the volume for the noise",min:0,max:1,defaultValue:0}),this.registerParameter(this.noiseLevelParameter),this.refreshNoiseParameters()}},{key:"refreshNoiseParameters",value:function(){this.noiseLevelParameter&&(this.noiseLevelParameter.setAudioParams(this.noiseSources.map(function(e){return e.volume})),this.noiseSources.forEach(function(e){return e.start()}))}},{key:"createAndAttachNoise",value:function(){var e=this.newNoiseVoice();this.noiseSources.push(e),this.refreshNoiseParameters()}},{key:"onPolyNoise",value:function(e){if(e<this.noiseSources.length){for(var t=e;e>this.noiseSources.length;)this.noiseSources[e-1].disconnect();this.noiseSources=this.noiseSources.slice(0,t)}else for(;e>this.noiseSources.length;)this.createAndAttachNoise()}},{key:"newNoiseVoice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pink",t=new W.a.Noise(e);return t.volume.value=0,t}}]),n}(e)})(dt)),Rn=n(556),Cn=n(35);var Nn=function(){function e(t,n,r){Object(s.a)(this,e),this.sequencerEngine=t,this.subSequence=n,this.store=t.store,this.lfos=[],this.lfos=function(e,t,n){var r=[];return r.push(new Rn.a(e,t,e.mixSession,1,n)),r.push(new Rn.a(e,t,e.mixSession,2,n)),r.push(new Rn.a(e,t,e.mixSession,3,n)),r.push(new Rn.a(e,t,e.mixSession,4,n)),r}(t,this,r),this.currentPattern=0,this.context=r}return Object(o.a)(e,[{key:"switchToPattern",value:function(e,t){return this.currentPattern=t,this.updateRedux(e,t)}},{key:"updateRedux",value:function(e,t){var n=this.getAllPatternLockedParameters(e,t),r=[];for(var a in n){var i=n[a].updateRedux(!0);void 0!==i&&(r[i.id]=i.value)}return r}},{key:"patternLocks",get:function(){var e=this.store.getState().tracks.lfoPatternLocks[this.subSequence.id]||{};return Object(p.a)({},e)}},{key:"deletePattern",value:function(e){var t=this.patternLocks;this.store.dispatch(Object(C.Ub)(this.subSequence.id,Object(Cn.a)(e,t)))}},{key:"movePatternTo",value:function(e,t){var n=this.patternLocks;this.store.dispatch(Object(C.Ub)(this.subSequence.id,Object(Cn.b)(e,t,n)))}},{key:"getAllPatternLockedParameters",value:function(e,t){var n=[];return this.lfos.forEach(function(r){return r.lfo.parameters.filter(function(n){return n.hasPatternLockedValues(e,t)}).forEach(function(e){return n.push(e)})}),n}},{key:"newPattern",value:function(e){var t=this,n=e-1;this.getAllPatternLockedParameters().forEach(function(e){return e.newPattern(t.currentPattern,n)});var r=this.patternLocks;r[n]=this.patternLocked,this.store.dispatch(Object(C.Ub)(this.subSequence.id,r))}},{key:"patternLocked",get:function(){return this.patternLocks[this.currentPattern]||!1},set:function(e){var t=this.patternLocks;t[this.currentPattern]=e,this.store.dispatch(Object(C.Ub)(this.subSequence.id,t)),this.updateRedux()}},{key:"togglePatternLocked",value:function(){this.patternLocked=!this.patternLocked}},{key:"start",value:function(e){for(var t in this.lfos){this.lfos[t].start(e)}}},{key:"stop",value:function(){for(var e in this.lfos){this.lfos[e].stop()}}},{key:"onBPMUpdated",value:function(){this.lfos.forEach(function(e){return e.lfo.onBPMUpdated()})}}]),e}(),qn=new(function(){function e(){Object(s.a)(this,e),this.chains=[],this.totalCreated=0}return Object(o.a)(e,[{key:"useChain",value:function(e,t){var n=void 0;this.chains.length>0&&!t.isOffline?n=this.chains.pop():(n=[new W.a.Scale(e.min,e.max),new W.a.Gain(1)],this.totalCreated++);return n[0].min=e.min,n[0].max=e.max,n}},{key:"disposeChain",value:function(e){e.forEach(function(e){return e.dispose()})}},{key:"releaseChain",value:function(e,t){if(t.isOffline)this.disposeChain(e);else{if(this.chains.length>=50){var n=this.chains[0];this.disposeChain(n),this.chains=this.chains.slice(1)}this.chains.push(e)}}}]),e}()),In=n(867),_n=n(17);function Dn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}window.offsetTime=.009,window.envelopeChainFactory=qn;var Fn=function(e){Object(u.a)(n,e);var t=Dn(n);function n(e,r,a,i){var o;return Object(s.a)(this,n),(o=t.call(this,e,r,a,i)).disable=!1,o.id=Object(S.uuid)(),o.lastValue=void 0,o.lastStep=void 0,o.envelope=new W.a.ScaledEnvelope,o.meter=new W.a.Analyser("waveform",32),o.envelope.connect(o.meter),o.envelope.min=0,o.envelope.max=1,o.parameters=[],o.setupParameters(),o.savedFrequency=void 0,o.parameterIdToVoiceToNode={},o}return Object(o.a)(n,[{key:"name",get:function(){return"Env "+this.number}},{key:"getType",value:function(){return _n.a}},{key:"dispose",value:function(){for(var e in this.envelope.dispose(),this.meter.dispose(),this.parameterIdToVoiceToNode){var t=this.parameterIdToVoiceToNode[e];for(var n in t){t[n].filter(function(e){return e.dispose&&e.input}).forEach(function(e){return e.dispose()})}}this.parameterIdToVoiceToNode=void 0,this.envelope=void 0,this.meter=void 0,this.parameters=void 0}},{key:"startMetering",value:function(e){var t=this;this.meterTimer=setInterval(function(){e.sendMessage("level",t.envelope.value)},10)}},{key:"stopMetering",value:function(){clearInterval(this.meterTimer)}},{key:"getValue",value:function(e){var t=this.lastTriggerAttackRelease;if(void 0===t)return 0;var n=void 0!==t.duration,r=W.a.Master.context.isOffline?W.a.Master.context._currentTime:W.a.Master.context.currentTime,a=t.time,i=r-a,s=t.time+t.duration;if(r>=a&&(!n||r<=s))return i<=this.attack/1e3?i/(this.attack/1e3):i<=(this.attack+this.decay)/1e3?1+(i-this.attack/1e3)/(this.decay/1e3)*(this.sustain-1):this.sustain;if(r>=s&&r<=s+this.release/1e3){var o=(r-s)/(this.release/1e3);return this.sustain-this.sustain*o}return 0}},{key:"getChain",value:function(e,t){return[].concat(Object(h.a)(qn.useChain(e,this.sequencerEngine)),[t])}},{key:"releaseChain",value:function(e){qn.releaseChain(e.slice(0,e.length-1),this.sequencerEngine)}},{key:"getModulator",value:function(){return this.envelope}},{key:"triggerAttack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.disabled||(e=e||(W.a.Master.context.isOffline?W.a.Master.context._currentTime:W.a.Master.context.currentTime),this.envelope.triggerAttack(e,t),this.lastTriggerAttackRelease={time:e,velocity:t})}},{key:"triggerAttackRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this.disabled||(t=Math.max(t,0),isNaN(e)||isNaN(t)||isNaN(n)||(this.envelope.triggerAttackRelease(e,t,n),this.lastTriggerAttackRelease={duration:e,time:t,velocity:n}))}},{key:"triggerRelease",value:function(e){this.disabled||(this.envelope.triggerRelease(e),e=e||(W.a.Master.context.isOffline?W.a.Master.context._currentTime:W.a.Master.context.currentTime),this.lastTriggerAttackRelease&&(this.lastTriggerAttackRelease=Object(p.a)({},this.lastTriggerAttackRelease,{duration:e-this.lastTriggerAttackRelease.time})))}},{key:"setupParameters",value:function(){this.attackParameter=new re.a("Attack",this.envelope,function(e,t){e&&(e.attack=(t+1e-6)/1e3)},{min:0,max:1e4,unit:"ms",defaultValue:15}),this.registerParameter(this.attackParameter),this.decayParameter=new re.a("Decay",this.envelope,function(e,t){e&&(e.decay=(t+1e-5)/1e3)},{min:0,max:1e4,unit:"ms",defaultValue:1e3}),this.registerParameter(this.decayParameter),this.sustainParameter=new re.a("Sustain",this.envelope,function(e,t){e&&(e.sustain=t)},{min:0,max:1,unit:"",defaultValue:.9}),this.registerParameter(this.sustainParameter),this.releaseParameter=new re.a("Release",this.envelope,function(e,t){e&&(e.release=(t+1e-6)/1e3)},{min:0,max:1e4,unit:"ms",defaultValue:150}),this.registerParameter(this.releaseParameter),this.attackCurveParameter=new re.a("Attack Curve",this.envelope,function(e,t){e&&(e.attackCurve=t)},{min:0,max:1e4,unit:"",defaultValue:"linear"}),this.registerParameter(this.attackCurveParameter),this.decayCurveParameter=new re.a("Decay Curve",this.envelope,function(e,t){e&&(e.decayCurve=t)},{min:0,max:1e4,unit:"",defaultValue:"linear"}),this.registerParameter(this.decayCurveParameter),this.releaseCurveParameter=new re.a("Release Curve",this.envelope,function(e,t){e&&(e.releaseCurve=t)},{min:0,max:1e4,unit:"",defaultValue:"linear"}),this.registerParameter(this.releaseCurveParameter)}},{key:"refresh",value:function(){}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"attackCurve",get:function(){return this.attackCurveParameter.get()},set:function(e){this.attackCurveParameter.set(e)}},{key:"decayCurve",get:function(){return this.decayCurveParameter.get()},set:function(e){this.decayCurveParameter.set(e)}},{key:"releaseCurve",get:function(){return this.releaseCurveParameter.get()},set:function(e){this.releaseCurveParameter.set(e)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(){var e={id:this.id,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackCurve:this.attackCurve,decayCurve:this.decayCurve,releaseCurve:this.releaseCurve};return e=Object(ee.b)(e,"attackParameter",this.attackParameter),e=Object(ee.b)(e,"decayParameter",this.decayParameter),e=Object(ee.b)(e,"sustainParameter",this.sustainParameter),e=Object(ee.b)(e,"releaseParameter",this.releaseParameter),e=Object(ee.b)(e,"attackCurveParameter",this.attackCurveParameter),e=Object(ee.b)(e,"decayCurveParameter",this.decayCurveParameter),e=Object(ee.b)(e,"releaseCurveParameter",this.releaseCurveParameter)}},{key:"fromJson",value:function(e){this.disconnectAllModulators();var t={};e.id&&(this.id=e.id),Object(fe.a)(this.attackParameter,e.attack,t),Object(fe.a)(this.decayParameter,e.decay,t),Object(fe.a)(this.sustainParameter,e.sustain,t),Object(fe.a)(this.releaseParameter,e.release,t),e.attackCurve&&Object(fe.a)(this.attackCurveParameter,e.attackCurve,t),e.decayCurve&&Object(fe.a)(this.decayCurveParameter,e.decayCurve,t),e.releaseCurve&&Object(fe.a)(this.releaseCurveParameter,e.releaseCurve,t),t=Object(p.a)({},t,Object(ee.a)(e,"attackParameter",this.attackParameter,this.sequencerEngine,!1,!0),Object(ee.a)(e,"decayParameter",this.decayParameter,this.sequencerEngine,!1,!0),Object(ee.a)(e,"sustainParameter",this.sustainParameter,this.sequencerEngine,!1,!0),Object(ee.a)(e,"releaseParameter",this.releaseParameter,this.sequencerEngine,!1,!0),Object(ee.a)(e,"attackCurveParameter",this.attackCurveParameter,this.sequencerEngine,!1,!0),Object(ee.a)(e,"decayCurveParameter",this.decayCurveParameter,this.sequencerEngine,!1,!0),Object(ee.a)(e,"releaseCurveParameter",this.releaseCurveParameter,this.sequencerEngine,!1,!0))}},{key:"getScaleFromChain",value:function(e){return e[0]}},{key:"getDepthFromChain",value:function(e){return e[1]}},{key:"mate",value:function(e,t){this.mateParameter(this.attackParameter,e.attackParameter,t),this.mateParameter(this.decayParameter,e.decayParameter,t),this.mateParameter(this.sustainParameter,e.sustainParameter,t),this.mateParameter(this.releaseParameter,e.releaseParameter,t)}},{key:"mateParameter",value:function(e,t,n){Object(Y.b)(this.sequencerEngine,e,t,n)}}]),n}(In.a),Ln=function(){function e(t,n,r,a){Object(s.a)(this,e),this.store=t.store,this.sequencerEngine=t,this.number=a,this.envelope=new Fn(t,n,(new V.a).forEnvelopeTrack(this,r),a)}return Object(o.a)(e,[{key:"name",get:function(){return"Envelope "+this.number}},{key:"getJson",value:function(){return this.envelope.getJson()}}]),e}();var Bn=function(){function e(t,n){Object(s.a)(this,e),this.sequencerEngine=t,this.subSequence=n,this.store=t.store,this.envelopes=function(e,t){var n=[];return n.push(new Ln(e,e.mixSession,t,1)),n.push(new Ln(e,e.mixSession,t,2)),n.push(new Ln(e,e.mixSession,t,3)),n.push(new Ln(e,e.mixSession,t,4)),n}(t,this),this.currentPattern=0}return Object(o.a)(e,[{key:"switchToPattern",value:function(e,t){return this.currentPattern=t,this.updateRedux(e,t)}},{key:"updateRedux",value:function(e,t){var n=this.getAllPatternLockedParameters(e,t),r=[];for(var a in n){var i=n[a].updateRedux(!0);void 0!==i&&(r[i.id]=i.value)}return r}},{key:"deletePattern",value:function(e){this.store.dispatch(Object(C.Ab)(this.subSequence.id,Object(Cn.a)(e,this.patternLocks)))}},{key:"patternLocks",get:function(){var e=this.store.getState().tracks.envelopePatternLocks[this.subSequence.id]||{};return Object(p.a)({},e)}},{key:"movePatternTo",value:function(e,t){this.store.dispatch(Object(C.Ab)(this.subSequence.id,Object(Cn.b)(e,t,this.patternLocks)))}},{key:"getAllPatternLockedParameters",value:function(e,t){var n=[];return this.envelopes.forEach(function(r){return r.envelope.parameters.filter(function(n){return n.hasPatternLockedValues(e,t)}).forEach(function(e){return n.push(e)})}),n}},{key:"newPattern",value:function(e){var t=this,n=e-1;this.getAllPatternLockedParameters().forEach(function(e){return e.newPattern(t.currentPattern,n)});var r=this.patternLocks;r[n]=this.patternLocked,this.store.dispatch(Object(C.Ab)(this.subSequence.id,r))}},{key:"patternLocked",get:function(){return this.patternLocks[this.currentPattern]||!1},set:function(e){var t=this.patternLocks;t[this.currentPattern]=e,this.store.dispatch(Object(C.Ab)(this.subSequence.id,t)),this.updateRedux()}},{key:"togglePatternLocked",value:function(){this.patternLocked=!this.patternLocked}}]),e}();function zn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Jn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Vn=function(e){Object(u.a)(n,e);var t=Jn(n);function n(e,r,a,i,o,u){var l,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return Object(s.a)(this,n),(l=t.call(this,e,r,a,i,o,u,!1)).initModulators(),f&&l.setInstrument(new Mn(r,a,(new V.a).forTrack(Object(c.a)(l)),Object(c.a)(l))),l}return Object(o.a)(n,[{key:"getInstrumentType",value:function(){return U.f}},{key:"createNewInstrument",value:function(){this.instrument=void 0,this.setInstrument(new Mn(this.sequencerEngine,this.mixSession,(new V.a).forTrack(this),this))}},{key:"getAllParameters",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Object(ne.a)(Object(f.a)(n.prototype),"getAllParameters",this).call(this,e);return[].concat(Object(h.a)(t),Object(h.a)(this.lfosTrack.lfos.flatMap(function(e){return e.lfo.parameters})),Object(h.a)(this.envelopesTrack.envelopes.flatMap(function(e){return e.envelope.parameters})))}},{key:"getCopy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine,r=arguments.length>2?arguments[2]:void 0;return Object(ne.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,s){return new n(e,t,r,a,i,s,!1)},t,r)}}]),n}(function(e){Object(u.a)(n,e);var t=zn(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"initModulators",value:function(){this.lfosTrack=new Nn(this.sequencerEngine,this.subSequence,(new V.a).forTrack(this)),this.envelopesTrack=new Bn(this.sequencerEngine,this.subSequence)}},{key:"hasModulators",get:function(){return!0}}]),n}(lt)),Hn=n(125),Un=function(){function e(t,n){if(Object(s.a)(this,e),this.track=t,this.instrumentRack=n,this.track.instrumentRack=this.instrumentRack,this.sequencerEngine=t.sequencerEngine,this.store=this.sequencerEngine.store,this.parameters=[],this.volumeParameter=new te.c("volume",this.track.volumeNode.volume,{min:0,max:1,unit:"db",defaultValue:0}),this.registerParameter(this.volumeParameter),this.track.effectsChains[0].parameterContext=(new V.a).forTrack(n),this.track.instrument){var r=this.track.instrument.parameters;for(var a in r)r[a].setContext(r[a].context.forSubDevice(r[a].track).forTrack(n))}this.track.instrumentRack=n}return Object(o.a)(e,[{key:"dispose",value:function(){this.track.dispose(void 0,this.instrumentRack.isFrozen)}},{key:"effectsChains",get:function(){return this.track.effectsChains}},{key:"presetName",get:function(){return this.track.presetName}},{key:"getName",value:function(){return this.track.getName()}},{key:"trackNumber",get:function(){return this.track.trackNumber}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setContext((new V.a).forTrack(this.instrumentRack)),this.parameters.push(e)}},{key:"getJson",value:function(e){var t={track:this.track.getJson(e),effectsChains:this.track.effectsChains.map(function(e){return e.getJson()}),midiEffects:this.track.midiEffects.getJson(),volume:this.volumeParameter.get(),sendVolumes:this.track.getSendNodes().map(function(e){return e.volume.value})};return t=Object(ee.b)(t,"volumeParameter",this.volumeParameter)}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.track.fromJson(t.track,!1);case 2:if(this.track.effectsChains[0].clear(),this.track.effectsChains[0].fromJson(t.effectsChains[0],this.sequencerEngine.tracks,n),this.track.midiEffects.fromJson(t.midiEffects),this.volumeParameter.set(t.volume),t.sendVolumes)for(r=this.track.getSendNodes(),i=0;i<Math.min(t.sendVolumes.length,r.length);i++)r[i].volume.value=t.sendVolumes[i];Object(ee.a)(t,"volumeParameter",this.volumeParameter,this.sequencerEngine);case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCopy",value:function(){var t=Object(i.a)(a.a.mark(function t(){var n,r,i;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.track.getCopy();case 2:return n=t.sent,r=new e(n,this.instrumentRack),i=this.getJson(),t.next=7,r.fromJson(i);case 7:return t.abrupt("return",r);case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"getAllParameters",value:function(){return[].concat(Object(h.a)(this.parameters),Object(h.a)(this.track.getAllParameters()))}}]),e}();function Gn(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Wn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wn(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Wn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Kn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Qn=Hn.a.presets,Zn=function(e){Object(u.a)(n,e);var t=Kn(n);function n(e,r,a,i,o,u){var l;!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return Object(s.a)(this,n),(l=t.call(this,e,r,a,i,o,u)).setupEffects(),l.tracks=[],l.name="Instrument Rack",l.preset=new at.a,l.preset.track=Object(c.a)(l),l}return Object(o.a)(n,[{key:"addPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.title,e.next=3,Qn.getPresetData(t);case 3:return r=e.sent,e.next=6,this.sequencerEngine.loadTrackPreset(r,void 0,!0,!1,n,void 0,t);case 6:return(i=e.sent).presetName=n,s=new Un(i,this),setTimeout(function(){i.loadLostParameters()},[750]),e.abrupt("return",this.addInstrument(s));case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addSample",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.addInstrumentType(U.g)).track.sample=t,e.next=4,r.track.instrument.newSample(0,t,n);case 4:return n&&(r.track.samplesStream=n,r.track.samplesStream.initBuffers()),r.track.presetName=t.name,e.abrupt("return",r);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSubDevices",value:function(){return this.tracks.map(function(e){return{value:e,label:e.presetName||e.getName()}})}},{key:"getSubDeviceIndex",value:function(e){return this.tracks.indexOf(e)}},{key:"getSubDevice",value:function(e){return this.tracks[e]}},{key:"getSamplesStream",value:function(){var e=this.getSelectedTrack();if(e)return e.track.samplesStream}},{key:"getSelectedTrack",value:function(){return this.sequencerEngine.state.tracks.selectedRackSubTrack[this.id]}},{key:"loadTrackInfo",value:function(e,t){var n=this.getSelectedTrack();n?(n.track.loadTrackInfo(e,t),this.tracks=Object(h.a)(this.tracks)):(this.addSample(t),this.tracks=Object(h.a)(this.tracks)),this.updateSteps()}},{key:"addInstrumentType",value:function(e){var t=xr(this.sequencerEngine,"INSTRUMENT",e);t.setSends(this.sequencerEngine.sends),t.effectsChains[0].clear();var n=new Un(t,this);return this.addInstrument(n)}},{key:"getName",value:function(){return"Instrument Rack"}},{key:"getTrackType",value:function(){return D.c}},{key:"getInstrumentType",value:function(){return D.c}},{key:"instrument",get:function(){return this}},{key:"inputNode",get:function(){return this.gainNode}},{key:"addInstrument",value:function(e){var t=e.track;return t.trackNumber=this.tracks.length,this.tracks=[].concat(Object(h.a)(this.tracks),[e]),t.muteableNode.connect(this.gainNode),t.group=this,e}},{key:"deleteInstrument",value:function(e){var t=this.tracks.indexOf(e);-1!==t&&(this.tracks.splice(t,1),e.track.dispose())}},{key:"dispose",value:function(){this.tracks.forEach(function(e){return e.dispose()}),this.tracks=void 0,Object(ne.a)(Object(f.a)(n.prototype),"dispose",this).call(this,!1)}},{key:"liveTrigger",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isFrozen||this.tracks.forEach(function(t){return t.track.midiEffects.liveInputTrigger(e)})}},{key:"releaseAll",value:function(e){this.isFrozen||this.tracks.forEach(function(t){return t.track.releaseAll(e)})}},{key:"liveTriggerRelease",value:function(e,t){this.isFrozen||this.tracks.forEach(function(n){return n.track.midiEffects.liveInputRelease(e,t)})}},{key:"trigger",value:function(e,t,r){this.isFrozen?Object(ne.a)(Object(f.a)(n.prototype),"trigger",this).call(this,e,t,r):(this.tracks.forEach(function(n){n.track.midiEffects.input(e,t,r)}),this.onStepEnded(t,r))}},{key:"triggerSamples",value:function(e,t){this.isFrozen||this.tracks.forEach(function(n){return n.track.triggerSamples(e,t)})}},{key:"triggerSlice",value:function(e){this.isFrozen||this.tracks.forEach(function(t){return t.track.triggerSlice(e)})}},{key:"triggerSample",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.isFrozen||this.tracks.forEach(function(r){return r.track.triggerSample(e,t,n)})}},{key:"triggerRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isFrozen||this.tracks.forEach(function(n){return n.track.triggerRelease(e,t)})}},{key:"getJson",value:function(e){var t=Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e);return t.tracks=this.tracks.map(function(t){return t.getJson(e)}),t}},{key:"onBPMUpdated",value:function(){for(var e in this.effectsChains.forEach(function(e){return e.onBPMUpdated()}),this.tracks)for(var t in this.tracks[e].effectsChains)this.tracks[e].effectsChains[t].onBPMUpdated()}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var r,i,s,o,c,u,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._loaded){e.next=2;break}return e.abrupt("return",{});case 2:Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,t),this.store.dispatch(Object(C.ne)(this.subSequence.id,this.trackNumber,!0)),r={},e.t0=a.a.keys(t.tracks);case 6:if((e.t1=e.t0()).done){e.next=22;break}return i=e.t1.value,s=t.tracks[i].track,o=s.type,c=s.instrumentType,(u=xr(this.sequencerEngine,o,c)).setSends(this.sequencerEngine.sends),l=new Un(u,this),e.t2=p.a,e.t3={},e.t4=r,e.next=17,l.fromJson(t.tracks[i],!1);case 17:e.t5=e.sent,r=(0,e.t2)(e.t3,e.t4,e.t5),this.addInstrument(l),e.next=6;break;case 22:return this.store.dispatch(Object(C.ne)(this.subSequence.id,this.trackNumber,!1)),this._loaded=!0,e.abrupt("return",r);case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onNewStep",value:function(e){this.isFrozen?Object(ne.a)(Object(f.a)(n.prototype),"onNewStep",this).call(this):(Object(ne.a)(Object(f.a)(n.prototype),"onNewStep",this).call(this),this.tracks.forEach(function(t){return t.track.onNewStep(e)}))}},{key:"onStepEnded",value:function(e,t){var r=this;if(this.isFrozen)Object(ne.a)(Object(f.a)(n.prototype),"onNewStep",this).call(this);else{var a=function(n){var a=r.tracks[n].track;a.midiEffects.output(e,t,t).forEach(function(e){return a.trigger(e.stepData,e.time,t)})};for(var i in this.tracks)a(i)}}},{key:"start",value:function(){Object(ne.a)(Object(f.a)(n.prototype),"start",this).call(this),this.isFrozen||this.tracks.forEach(function(e){return e.track.start()})}},{key:"solo",value:function(e){Object(ne.a)(Object(f.a)(n.prototype),"solo",this).call(this,e),this.tracks.forEach(function(t){return t.track.solo(e,void 0,!1)})}},{key:"getCopy",value:function(e,t){var r=this,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=Object(ne.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,s){return new n(e,t,r,a,i,s)},t,a),s=function(e){var n=r.tracks[e].track,s=n.getCopy(void 0,t,a),o=new Un(s,i);s.effectsChains[0].dispose(),s.effectsChains=n.effectsChains.map(function(e){return e.getCopy(s,t,a)}),s.effectsChains[0].updateEffects(),o.volumeParameter.copyFrom(r.tracks[e].volumeParameter),i.addInstrument(o)};for(var o in this.tracks)s(o);return i}},{key:"getAllParameters",value:function(){var e=Object(ne.a)(Object(f.a)(n.prototype),"getAllParameters",this).call(this);if(this.isFrozen)return e;for(var t in this.tracks)e=[].concat(Object(h.a)(e),Object(h.a)(this.tracks[t].getAllParameters()));return e}},{key:"makePublicIfNeeded",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=a.a.keys(this.tracks);case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,this.tracks[t].track.makePublicIfNeeded();case 5:e.next=1;break;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"unfreezeInstrument",value:function(){var e,t=0,n=Gn((arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.frozenJson).trackParameters.tracks);try{for(n.s();!(e=n.n()).done;){var r=e.value;this.tracks[t].track.createNewInstrument(),this.tracks[t].track.instrument.fromJson(r.track.instrument),t++}}catch(a){n.e(a)}finally{n.f()}}}]),n}(rt);function Yn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Xn=function(e){Object(u.a)(n,e);var t=Yn(n);function n(e,r,a,i,o){var u;return Object(s.a)(this,n),(u=t.call(this,e,r,a,i,o,!0)).parameters=[],u.onParameter=new re.a("on",Object(c.a)(u),function(e,t){return[]},{min:!1,max:!0,unit:"",defaultValue:!1}),u.registerParameter(u.onParameter),u.loopParameter=new re.a("loop",Object(c.a)(u),function(e,t){return[]},{min:!1,max:!0,unit:"",defaultValue:!1}),u.registerParameter(u.loopParameter),u.loadFromJson(o),u.startTime=void 0,u.endTime=void 0,u.samplesStream=new Te.a(r,e.sequencerEngine),u.isSimple=!0,u}return Object(o.a)(n,[{key:"gainNode",get:function(){return this.sampler.output}},{key:"auditionSound",value:function(e){this.sample=e,this.audioBuffer=e.audioBuffer,this.baseBuffer=new W.a.Buffer(e.audioBuffer),this.sampler._buffers._buffers[48]=this.baseBuffer,this.slice(0,0,this.getDuration()),this.registerParameter(this.volumeParameter)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.samplerData,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sliceData,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(ne.a)(Object(f.a)(n.prototype),"init",this).call(this,e,t,r),this.sampler=new W.a.Sampler({C3:this.baseBuffer},{curve:"linear"}),this.reversedBuffer=new W.a.Buffer,1===this.baseBuffer.numberOfChannels?this.reversedBuffer.fromArray(this.baseBuffer.getChannelData(0)):this.reversedBuffer.fromArray([this.baseBuffer.getChannelData(0),this.baseBuffer.getChannelData(1)]),this.reversedBuffer.reverse=!0,this.reversedSampler=new W.a.Sampler({C3:this.reversedBuffer},{curve:"linear"}),this.volumeParameter=new te.c("volume",this.sampler.output.gain,{min:0,max:1,defaultValue:1}),this.registerParameter(this.volumeParameter),this}},{key:"dispose",value:function(){this.sample.dispose(),this.sampler.dispose(),this.baseBuffer.dispose(),this.reversedBuffer.dispose(),this.reversedSampler.dispose(),this.slices=[],this.detuneSignal.dispose(),this.pitchEnvelopes.forEach(function(e){return e.dispose()}),this.sample=void 0,this.sampler=void 0,this.baseBuffer=void 0,this.pitchEnvelopes=void 0,this.detuneSignal=void 0}},{key:"isDisposed",value:function(){return void 0===this.sampler}},{key:"getSlice",value:function(){var e=this;return{buffer:this.baseBuffer,startTime:this.startTime,endTime:this.endTime,getDuration:function(){return e.endTime-e.startTime}}}},{key:"get",value:function(){return this.sampler}},{key:"newSlice",value:function(e,t){return this.startTime=e,this.endTime=t,this.slices.push(new $n(this.baseBuffer,e,t)),this.sliceData.push({startTime:e,endTime:t}),this.slice(this.slices.length-1,e,t,!0),this.slices[this.slices.length-1]}},{key:"slice",value:function(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var r=this.slices[e];n=void 0==n?this.getDuration():n,r.startTime=t,r.endTime=n;this.alpha;this.sliceData[e]={startTime:t,endTime:n},this.startTime=t,this.endTime=n,this.updateSlicesState()}},{key:"loadFromJson",value:function(e){this.onParameter.set(void 0===e.on||e.on),Object(ee.a)(e,"onParameter",this.onParameter),this.loop=e.loop||!1,Object(ee.a)(e,"loopParameter",this.loopParameter),this.detune=e.detune||0,Object(ee.a)(e,"detuneParameter",this.detuneParameter)}},{key:"detune",get:function(){return this.detuneParameter.get()},set:function(e){this.detuneParameter.set(e)}},{key:"on",get:function(){return this.onParameter.get()},set:function(e){this.onParameter.set(e)}},{key:"loop",get:function(){return this.loopParameter.get()},set:function(e){this.loopParameter.set(e)}},{key:"getJson",value:function(){var e=Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{on:this.onParameter.get(),loop:this.loop,detune:this.detune});return e=Object(ee.b)(e,"onParameter",this.onParameter),e=Object(ee.b)(e,"loopParameter",this.loopParameter),e=Object(ee.b)(e,"detuneParameter",this.detuneParameter)}},{key:"triggerAttack",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r,i,s,o,c){var u,l,h,p,d,v,m,y=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=y.length>6&&void 0!==y[6]&&y[6],t=this.getNoteFromTranspose(t),l=u?this.reversedSampler:this.get(0),h=s.start,h=this.convertToStartTime(0,h),h+=this.startTime,l.loop=this.loop,p=this.getLoopPoints(s),d=p.loopStart,v=p.loopEnd,h=d,l.loopStart=d,l.loopEnd=v,m=[],o&&m.push(o),this.triggerWaveformAnimation(r,void 0,0,0,h),e.next=16,Object(ne.a)(Object(f.a)(n.prototype),"triggerAttack",this).call(this,l,t,r,i,m,h,c,u);case 16:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,s){return e.apply(this,arguments)}}()},{key:"triggerAttackRelease",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r,i,s,o,c,u){var l,h,p,d,v,m,y,b,g=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=g.length>7&&void 0!==g[7]?g[7]:0,h=g.length>8&&void 0!==g[8]&&g[8],t=this.getNoteFromTranspose(t),p=o.start,p=this.convertToStartTime(0,p),p+=this.startTime,(d=h?this.reversedSampler:this.get(0)).loop=this.loop,v=this.getLoopPoints(o),m=v.loopStart,y=v.loopEnd,p=m,p+=this.convertToStartTime(0,l),d.loopStart=m,d.loopEnd=y,this.triggerWaveformAnimation(i,r,0,0,p),b=[],c&&b.push(c),e.next=18,Object(ne.a)(Object(f.a)(n.prototype),"triggerAttackRelease",this).call(this,d,t,r,i,s,b,p,u,h);case 18:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,s,o){return e.apply(this,arguments)}}()},{key:"triggerRelease",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.triggerReleaseWaveformAnimation(),e=e.map(function(e){return t.getNoteFromTranspose(e)}),(n?this.reversedSampler:this.get(0)).triggerRelease(e,W.a.Master.context.currentTime)}},{key:"getLoopPoints",value:function(e){var t=e.loopStart,n=e.loopLength,r=(t=this.startTime+this.getDuration()*(t/100))+this.getDuration()*(n/100);return{loopStart:t,loopEnd:Math.min(r,this.endTime)}}},{key:"setLoopPoints",value:function(e){var t=this.getLoopPoints(e),n=t.loopStart,r=t.loopEnd;for(var a in this.sampler._activeSources){this.sampler._activeSources[a].forEach(function(e){e.loopStart=n,e.loopEnd=r})}}}]),n}(Le.a),$n=function(){function e(t,n,r){Object(s.a)(this,e),this.buffer=t,this.originalBuffer=t,this.startTime=n,this.endTime=r}return Object(o.a)(e,[{key:"getCopy",value:function(){return new e(this.buffer,this.startTime,this.endTime)}},{key:"getJson",value:function(){return{buffer:this.buffer,startTime:this.startTime,endTime:this.endTime}}},{key:"dispose",value:function(){}}]),e}(),er=Xn;var tr=function(){function e(t){Object(s.a)(this,e),this.input=this.output=new W.a.Gain(1)}return Object(o.a)(e,[{key:"loop",set:function(e){e&&void 0===this.lfo?(this.lfo=new W.a.LFO({type:"triangle",phase:90,min:.7,max:1}),this.lfo.connect(this.input.gain)):e||void 0===this.lfo||(this.lfo.dispose(),this.lfo=void 0)}},{key:"smooth",set:function(e){this.lfo&&(this.lfo.min=e)}},{key:"restart",value:function(e){this.lfo&&(this.lfo.stop(e),this.lfo.start(e))}},{key:"onTick",value:function(e){}},{key:"trigger",value:function(e,t,n){var r=t.loopLengthSeconds;if(void 0!==this.lfo&&!(r<=0)){var a=W.a.Frequency(r,"s").transpose(n);isNaN(a)||void 0===a||(this.lfo.frequency.value=a),this.restart(e)}}}]),e}(),nr=3,rr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;arguments.length>1&&arguments[1];Object(s.a)(this,e),this.outputNode=new W.a.Gain(1),this.voiceNumber=t,this.ampEnvelope=new W.a.AmplitudeEnvelope(10,10,1,100),this.ampLFO=new tr,this.ampEnvelope.connect(this.ampLFO.input),this.ampLFO.output.connect(this.outputNode),this.crossFade=new W.a.CrossFade(0),this.crossFade.connect(this.ampEnvelope),this.ampEnvelope.releaseCurve="linear",this.ampEnvelope.attackCurve="linear",this.ampEnvelope.decayCurve="linear",this.samplerToTriggers={},this.samplerToTransposes={},this.idToSampler={},this.samplerLimit=nr}return Object(o.a)(e,[{key:"clear",value:function(e){this.samplerToTriggers={},this.idToSampler={}}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"dispose",value:function(){this.outputNode.dispose(),this.ampEnvelope.dispose(),this.outputNode=void 0,this.ampEnvelope=void 0,this.samplerToTriggers=void 0}},{key:"useSampler",value:function(e,t,n,r){t||(t=W.a.Master.context.currentTime),void 0!==this.samplerToTriggers[e.id]&&void 0!==this.samplerToTriggers[e.id][n]&&0!==this.samplerToTriggers[e.id][n]||(this.samplerToTriggers[e.id]={},this.samplerToTriggers[e.id][n]=0),this.samplerToTriggers[e.id][n]++,this.idToSampler[e.id]=e,this.ampLFO.trigger(t,r,n+e.transpose),this.tooManyTriggers()>0&&this.releaseOldestTrigger(e,0,t)}},{key:"onVoiceRelease",value:function(e,t){this.samplerToTriggers[e.id]&&delete this.samplerToTriggers[e.id][t]}},{key:"disconnectSampler",value:function(e,t){return void 0===this.samplerToTriggers[e.id]||void 0===this.samplerToTriggers[e.id][t]||0===this.samplerToTriggers[e.id][t]&&(delete this.samplerToTriggers[e.id][t],!0)}},{key:"isUsed",value:function(){return Object.keys(this.samplerToTriggers).length>0}},{key:"isUsingSampler",value:function(e){return void 0!==this.samplerToTriggers[e.id]&&Object.keys(this.samplerToTriggers[e.id]).length>0}},{key:"totalTriggers",get:function(){var e=0;for(var t in this.samplerToTriggers){var n=this.samplerToTriggers[t];for(var r in n)e+=n[r]}return e}},{key:"tooManyTriggers",value:function(){return this.totalTriggers-nr}},{key:"getFromMap",value:function(e,t){return Object.keys(e).filter(function(t){return e[t]&&e[t].length>0})[t]}},{key:"releaseOldestTrigger",value:function(e,t,n){for(var r in void 0===n?n=W.a.Master.context.currentTime:(n-=.005)<0&&(n=0),this.idToSampler){this.idToSampler[r];var a=this.idToSampler[r].sampler,i=this.getFromMap(a._activeSources,t);if(void 0!==i){new W.a.Midi(i).toFrequency();return void a.triggerRelease(new W.a.Midi(i).toFrequency(),n,.1)}}var s=e.sampler,o=this.getFromMap(s._activeSources,t);s.triggerRelease(new W.a.Midi(o).toFrequency(),n,.1)}}]),e}(),ar=function(){function e(t,n,r){Object(s.a)(this,e),this.sampledInstrument=r,this.voices=[],this.outputNode=new W.a.Gain(1);for(var a=0;a<t;a++){var i=new rr(a,r);i.connect(this.outputNode),this.voices.push(i)}this.unusedVoices=Object(h.a)(this.voices),this.outputNode.connect(n),this.numVoices=t,this.samplersUsed=new Set}return Object(o.a)(e,[{key:"getVoices",value:function(){return 1===this.numVoices?[this.voices[0]]:this.voices}},{key:"clear",value:function(){this.voices.forEach(function(e){return e.clear()}),this.samplersUsed=new Set}},{key:"dispose",value:function(){this.voices.forEach(function(e){return e.dispose()}),this.outputNode.dispose(),this.voices=void 0,this.outputNode=void 0}},{key:"ampEnvelopes",get:function(){return this.voices.map(function(e){return e.ampEnvelope})}},{key:"getUnusedVoiceIfAny",value:function(e){return 1===this.numVoices?this.voices[0]:0===this.unusedVoices.length?this.voices[Math.floor(Math.random()*this.numVoices)]:this.unusedVoices.shift()}},{key:"getVoiceUsingSampler",value:function(e,t){return this.voices.find(function(n){return n.samplerToTriggers[e.id]&&n.samplerToTriggers[e.id][t]})}},{key:"useSamplerWithVoice",value:function(e,t,n,r,a){t.useSampler(e,n,r,a),this.samplersUsed.add(e)}},{key:"disconnectSamplerFromVoice",value:function(e,t,n){t.disconnectSampler(e,n)&&(t.isUsed()||(this.unusedVoices.push(t),this.samplersUsed.delete(e)))}},{key:"triggerAttack",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i,s,o){var c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=this.getUnusedVoiceIfAny(t),this.useSamplerWithVoice(t,c,r,n,s),c.ampEnvelope.triggerAttack(r,i),u=[t.triggerAttack(n,r,i,s,o,c.crossFade.input[0],!1)],this.sampledInstrument.crossFadeParameter.get()>0&&u.push(t.triggerAttack(n,r,i,s,o,c.crossFade.input[1],!0)),e.next=7,Promise.all(u);case 7:t.loop||this.disconnectSamplerFromVoice(t,c,n);case 8:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,s){return e.apply(this,arguments)}}()},{key:"triggerAttackRelease",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i,s,o,c,u){var l,f;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=this.getUnusedVoiceIfAny(t),this.useSamplerWithVoice(t,l,i,n,o),l.ampEnvelope.triggerAttackRelease(r,i,s,o),f=[t.triggerAttackRelease(n,r,i,s,o,c,l.crossFade.input[0],u,!1)],this.sampledInstrument.crossFadeParameter.get()>0&&f.push(t.triggerAttackRelease(n,r,i,s,o,c,l.crossFade.input[1],u,!0)),e.next=7,Promise.all(f);case 7:l.onVoiceRelease(t,n),this.disconnectSamplerFromVoice(t,l,n);case 9:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,s,o,c){return e.apply(this,arguments)}}()},{key:"triggerRelease",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.triggerRelease(n,!1),this.sampledInstrument.crossFadeParameter.get()>0&&t.triggerRelease(n,!0),void 0!==(r=this.getVoiceUsingSampler(t,n[0]))){e.next=5;break}return e.abrupt("return");case 5:r.totalTriggers<=1&&r.ampEnvelope.triggerRelease(W.a.Master.context.currentTime),r.onVoiceRelease(t,n[0]);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"setCrossFade",value:function(e){this.voices.forEach(function(t){return e.connect(t.crossFade.fade)})}}]),e}(),ir=n(519),sr=(n(553),n(349)),or=function(){function e(){Object(s.a)(this,e),this.isRecording=!1}return Object(o.a)(e,[{key:"input",set:function(e){if(void 0===e)return this.recorder.clear(),this.recorder.stop(),this.recorder=void 0,void(this.isRecording=!1);this.recorder=new window.Recorder(e,{numChannels:2,bufferLen:1024}),this.recorder.record((new Date).getTime()),this.startRecordLoop()}},{key:"startRecordLoop",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("start record loop");case 1:if(void 0===this.recorder){e.next=7;break}return e.next=4,this.sleep(1e4);case 4:this.isRecording||(console.log("clearing"),this.recorder.clear()),e.next=1;break;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){n()},e);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"start",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.recorder.clear(),this.isRecording=!0}},{key:"stop",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.sleep(t);case 2:e.recorder.getBuffer(function(t){var n=e.getSample(t);e.recorder.clear(),e.isRecording=!1,r(n)});case 3:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getSample",value:function(e){var t=e[0].length,n=W.a.Master.context.createBuffer(2,t,W.a.Master.context.sampleRate);n.copyToChannel(e[0],0,0),n.copyToChannel(e[1],1,0);var r=new q.a;return r.audioBuffer=n,r}}]),e}(),cr=1,ur=2,lr="MIX",fr="ALTERNATE",hr="ROUND_ROBIN";var pr=.025,dr=800;function vr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:pr,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:dr,a=e.getChannelData(0),i=window.api.create_buffer(a.length);window.Module.HEAPF32.set(a,i>>2),window.api.findLoop(i,a.length,t,n,r);var s=window.api.get_result_pointer(),o=new Uint16Array(window.Module.HEAP16.buffer,s,2);if(console.log("resultView = ",o),0!=o[0]||0!=o[1]){var c={start:o[0],end:o[1],difference:1};return window.api.destroy_buffer(i),c}}function mr(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return yr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yr(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function yr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function br(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var gr=8,Or=function(e){Object(u.a)(n,e);var t=br(n);function n(e,r,a,i){var o;return Object(s.a)(this,n),(o=t.call(this)).cache={},o.sequencerEngine=e,o.store=e.store,o.mixSession=r,o.context=a,o.track=i,o.solutionNumber=0,o.outputNode=new W.a.Gain(1),o.voices=new ar(gr,o.outputNode,Object(c.a)(o)),o.resampler=new or,o.samplers={},o.interpolationModeParameter=new re.a("interpolationMode",Object(c.a)(o),function(e,t){return[]},{min:cr,max:ur,unit:"",defaultValue:ur,automatable:!1}),o.registerParameter(o.interpolationModeParameter),o.mixModeParameter=new en.a("mixMode",Object(c.a)(o),function(e,t){return[]},{min:0,prettyName:"Mix Mode",options:{0:hr,.5:lr,1:fr},max:1,unit:"",defaultValue:hr,uxAutomatable:!1}),o.registerParameter(o.mixModeParameter),o.monophonicParameter=new re.a("monophonic",Object(c.a)(o),function(e,t){o.voices.numVoices=t?1:gr},{min:!1,max:!0,unit:"",defaultValue:!1,automatable:!1}),o.registerParameter(o.monophonicParameter),o.crossFadeSignal=new W.a.Signal(0),o.crossFadeParameter=new te.c("crossFade",o.crossFadeSignal,{min:0,max:1,defaultValue:0,automationRate:$.a}),o.registerParameter(o.crossFadeParameter),o.detuneSignal=new W.a.Signal(1e3),o.detuneParameter=new te.c("detune",o.detuneSignal,{min:-1e4,max:1e4,defaultValue:0,automationRate:$.a}),o.registerParameter(o.detuneParameter),o.setupLoopParameters(),o.setupAmpEnvelopeParameters(),o.smoothParameter=new re.a("smooth",Object(c.a)(o),function(e,t){var n=1-t;o.voices.voices.forEach(function(e){return e.ampLFO.smooth=n})},{min:0,max:1,unit:"",defaultValue:!1,uxAutomatable:!1}),o.registerParameter(o.smoothParameter),o.glideParameter=new re.a("glide",Object(c.a)(o),function(e,t){return[]},{min:0,max:1e3,unit:"",defaultValue:0}),o.registerParameter(o.glideParameter),o.lastTranspose=void 0,o.triggerCounters={},o.loaded=!0,o.getParameters().forEach(function(e){return e.isLoaded=!0}),o.voices.setCrossFade(o.crossFadeSignal),o.glideTransposes={},o.setupSlide(),o}return Object(o.a)(n,[{key:"allSamplers",get:function(){var e=[];for(var t in this.samplers)e=[].concat(Object(h.a)(e),Object(h.a)(this.samplers[t]));return e}},{key:"onAttackChanged",value:function(e){for(var t in this.ampEnvelopes)this.ampEnvelopes[t].attack=e/1e3}},{key:"onDecayChanged",value:function(e){for(var t in this.ampEnvelopes)this.ampEnvelopes[t].decay=e/1e3}},{key:"onSustainChanged",value:function(e){for(var t in this.ampEnvelopes)this.ampEnvelopes[t].sustain=Math.min(.99,e)}},{key:"onReleaseChanged",value:function(e){for(var t in this.ampEnvelopes)this.ampEnvelopes[t].release=e/1e3}},{key:"loop",get:function(){return this.allSamplers.every(function(e){return e.loop})},set:function(e){this.allSamplers.forEach(function(t){return t.loop=e})}},{key:"ampEnvelopes",get:function(){return this.voices.ampEnvelopes}},{key:"setupAmpEnvelopeParameters",value:function(){var e=this;this.ampAttackParameter=new re.a("Attack",this,function(t,n){e.onAttackChanged(n)},{min:0,max:5e3,unit:"",defaultValue:10}),this.registerParameter(this.ampAttackParameter),this.ampDecayParameter=new re.a("Decay",this,function(t,n){for(var r in e.ampEnvelopes)e.ampEnvelopes[r].decay=n/1e3},{min:0,max:5e3,unit:"",defaultValue:10}),this.registerParameter(this.ampDecayParameter),this.ampSustainParameter=new re.a("Sustain",this,function(t,n){e.onSustainChanged(n)},{min:0,max:1,unit:"",defaultValue:.8}),this.registerParameter(this.ampSustainParameter),this.ampReleaseParameter=new re.a("Release",this,function(t,n){e.onReleaseChanged(n)},{min:0,max:5e3,unit:"",defaultValue:10}),this.registerParameter(this.ampReleaseParameter),this.attackParameter=this.ampAttackParameter,this.decayParameter=this.ampDecayParameter,this.sustainParameter=this.ampSustainParameter,this.releaseParameter=this.ampReleaseParameter}},{key:"setupLoopParameters",value:function(){var e=this;this.loopParameter=new re.a("loop",this,function(t,n){e.loop=n},{min:!1,max:!0,unit:"",defaultValue:!1}),this.registerParameter(this.loopParameter),this.loopStartParameter=new re.a("loopStart",this,function(t,n){Array.from(e.voices.samplersUsed).forEach(function(t){return t.setLoopPoints({loopStart:n,loopLength:e.loopLength})})},{min:0,max:100,unit:"",defaultValue:0}),this.registerParameter(this.loopStartParameter),this.loopLengthParameter=new re.a("loopLength",this,function(t,n){Array.from(e.voices.samplersUsed).forEach(function(t){return t.setLoopPoints({loopStart:e.loopStart,loopLength:n})})},{min:0,max:100,unit:"",defaultValue:100}),this.registerParameter(this.loopLengthParameter)}},{key:"loopStart",get:function(){return this.loopStartParameter.getAtStep(this.currentStep)}},{key:"loopLength",get:function(){return this.loopLengthParameter.getAtStep(this.currentStep)}},{key:"onNewStep",value:function(e,t){var n=this;if(this.currentStep=e,this.oldMixMode!==this.mixMode&&(this.cache={}),this.oldMixMode=this.mixMode,this.onAttackChanged(this.ampAttack),this.onDecayChanged(this.ampDecay),this.onSustainChanged(this.ampSustain),this.onReleaseChanged(this.ampRelease),this.loop&&(this.loopStartParameter.isConnectedToAnyModulator()||this.loopLengthParameter.isConnectedToAnyModulator()||0!==this.loopStartParameter.automations.length||0!==this.loopLengthParameter.automations.length)){var r=1-this.smoothParameter.get();this.voices.voices.filter(function(e){return e.ampLFO.lfo}).forEach(function(e){return e.ampLFO.lfo.min=r});var a=this.loopStart,i=this.loopLength;W.a.Master.context.setTimeout(function(){Array.from(n.voices.samplersUsed).forEach(function(e){return e.setLoopPoints({loopStart:a,loopLength:i})})},1/W.a.Master.context.sampleRate)}}},{key:"glide",get:function(){return this.glideParameter.getAtStep(this.trackStep)},set:function(e){this.glideParameter.set(e)}},{key:"interpolationMode",get:function(){return this.interpolationModeParameter.getAtStep(this.trackStep)},set:function(e){this.interpolationModeParameter.set(e),this.cache={}}},{key:"monophonic",get:function(){return this.monophonicParameter.get()},set:function(e){this.monophonicParameter.set(e)}},{key:"mixMode",get:function(){return this.mixModeParameter.get()},set:function(e){this.mixModeParameter.set(e),this.cache={}}},{key:"trackStep",get:function(){return this.sequencerEngine.trackStep}},{key:"ampAttack",get:function(){return this.ampAttackParameter.getAtStep(this.currentStep)}},{key:"ampDecay",get:function(){return this.ampDecayParameter.getAtStep(this.currentStep)}},{key:"ampSustain",get:function(){return this.ampSustainParameter.getAtStep(this.currentStep)}},{key:"ampRelease",get:function(){return this.ampReleaseParameter.getAtStep(this.currentStep)}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(){this.outputNode.disconnect()}},{key:"connectToTrack",value:function(e){if(!e)return this.connectedTrack=void 0,void(this.resampler.input=void 0);this.connectedTrack=e,this.resampler.input=e.volumeNode}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return U.g}},{key:"getName",value:function(){return"Sampled Instrument"}},{key:"getPitchEnvelope",value:function(e){if(0!==this.glide){var t=100*(e-(void 0===this.lastTranspose?e:this.lastTranspose)),n=new W.a.ScaledEnvelope({attack:this.glide/1e3,decay:2,min:0,max:t,sustain:1,release:.001,curve:"linear"});return n._releaseCurve="linear",n._decayCurve="linear",n}}},{key:"triggerAttack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0,i=this.getSampler(e,!1),s=i.samplers,o=i.closest;if(void 0!==s){t||(t=new W.a.Time(W.a.Master.context.currentTime)),this.scaleByKey(t,e),this.setEnvelopes(a,e);var c=this.getPitchEnvelope(e);for(var u in this.monophonic&&this.releaseAll(t),s)s[u].sampler.attack=this.ampAttackParameter.getKeyScaledValue(e)/1e3,s[u].sampler.release=Math.max(4,this.ampReleaseParameter.getKeyScaledValue(e)/1e3),this.voices.triggerAttack(s[u],0!==this.glide&&void 0!==this.lastTranspose?this.lastTranspose-o:e-o,t,n,this.getLoopPoints(r,s[u]),c);this.glideTransposes[e]=this.lastTranspose,this.lastTranspose=parseFloat(e)}}},{key:"playSampler",value:function(e){this.voices.triggerAttack(e,0,0,1,0,void 0)}},{key:"triggerAttackRelease",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i,s,o){var c,u,l,f,h,p;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=this.getSampler(t,!0),u=c.samplers,l=c.closest,void 0!==u){e.next=3;break}return e.abrupt("return");case 3:for(h in this.scaleByKey(r,t),this.setEnvelopes(o,t),this.monophonic&&!o.slide&&this.releaseAll(r),f=this.getPitchEnvelope(t),u)(p=u[h]).sampler.release=this.ampReleaseParameter.getKeyScaledValue(t)/1e3,p.sampler.attack=this.ampAttackParameter.getKeyScaledValue(t)/1e3,this.voices.triggerAttackRelease(p,0!==this.glide&&void 0!==this.lastTranspose?this.lastTranspose-l:t-l,n,r,i,this.getLoopPoints(s,p),f,s);this.glideTransposes[t]=this.lastTranspose,this.lastTranspose=parseFloat(t);case 10:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,s){return e.apply(this,arguments)}}()},{key:"getLoopPoints",value:function(e,t){return{start:e,loopStart:this.loopStart,loopLength:this.loopLength,loopLengthSeconds:(t.endTime-t.startTime)*(this.loopLength/100)}}},{key:"triggerRelease",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s,o,c,u,l,f=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=f.length>0&&void 0!==f[0]?f[0]:[0],this.releaseParameter.set(this.releaseParameter.get(),!0,!0),e.t0=a.a.keys(t);case 3:if((e.t1=e.t0()).done){e.next=13;break}if(n=e.t1.value,r=t[n],i=this.getSampler(r,!0),s=i.samplers,o=i.closest,void 0!==s){e.next=9;break}return e.abrupt("continue",3);case 9:for(u in c=0!==this.glide&&this.glideTransposes[r]||r,s)l=s[u],s[u].sampler.release=this.ampRelease/1e3,this.voices.triggerRelease(l,[c-o]);e.next=3;break;case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"releaseAll",value:function(e){for(var t in this.voices.clear(),e||(this.clearSlide(),this.detuneSignal.value=this.detuneParameter.get(!0),this.lastTranspose=0),this.samplers){this.samplers[t].forEach(function(t){t.get(0).releaseAll(e||new W.a.Time(W.a.Master.context.currentTime),.01)})}}},{key:"newSample",value:function(e,t,n){var r=this;return new Promise(function(){var s=Object(i.a)(a.a.mark(function s(o,c){var u,l;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if("string"===typeof t&&(t=new q.a(t)),t=t.getCopy(),r.track.samplesStream=n||new Te.a(t,r.sequencerEngine),void 0!==t.audioBuffer){s.next=6;break}return s.next=6,t.load();case 6:u={slices:void 0,offset:0,transpose:0,volume:0},(l=new er(r.track,t,function(){return[]},void 0,u)).samplesStream=n,setTimeout(Object(i.a)(a.a.mark(function n(){var i,s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(l.init(),r.detuneSignal.connect(l.detuneSignal.input),r.detuneParameter.set(r.detuneParameter.get()),void 0!==e){n.next=10;break}return n.next=6,r.getPitch(t);case 6:void 0===(i=n.sent)?void 0===e&&(e=0):(void 0===e&&(e=i),(s=e-i)<-30&&(s+=36),l.transpose=s),n.next=11;break;case 10:case 11:r.cache={},void 0===r.samplers[e]&&(r.samplers[e]=[]),r.samplers[e]=[].concat(Object(h.a)(r.samplers[e]),[l]),r.selectSampler(e,l),o({sampler:l,samplers:r.samplers[e]});case 16:case"end":return n.stop()}},n)})),500);case 10:case"end":return s.stop()}},s)}));return function(e,t){return s.apply(this,arguments)}}())}},{key:"getTriggerCount",value:function(e){return this.triggerCounters[e]||0}},{key:"numberOfSamplers",get:function(){var e=0;for(var t in this.samplers)e+=this.samplers[t].length;return e}},{key:"defaultSampler",get:function(){if(void 0!==this.samplers){var e=Object.keys(this.samplers)[0];if(void 0!==e)return this.samplers[e][0]}}},{key:"getAllSamplersAtExactTranspose",value:function(e){var t=this.samplers[e];return this.mixMode===fr&&(t=this.samplers[e].filter(function(e){return e.on})),t}},{key:"filterNeededSamplers",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0!==e){if(this.mixMode===hr){var r=[e[this.getTriggerCount(t)%e.length]];return n&&(this.triggerCounters[t]=this.getTriggerCount(t)+1),r}return e}}},{key:"getSampler",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e in this.cache){var n=this.cache[e];return Object(p.a)({},n,{samplers:this.filterNeededSamplers(n.samplers,e,t)})}var r=e;e in this.samplers||(r=this.findClosest(e));var a=this.getAllSamplersAtExactTranspose(r);return this.cache[e]={closest:parseFloat(r),samplers:a},{closest:parseFloat(r),samplers:this.filterNeededSamplers(a,e,t)}}},{key:"findClosest",value:function(e){return this.interpolationMode===cr?function(e,t){var n=void 0,r=void 0;for(var a in t){a=parseInt(a);var i=Math.abs(e-a);void 0!==n?i<r&&(n=a,r=i):(n=a,r=i)}return parseFloat(n)}(e,this.samplers):function(e,t){var n=X.a.fromTranspose(e);n.octave=0;var r=void 0,a=void 0,i=void 0;for(var s in t){var o=X.a.fromTranspose(s);o.octave=0;var c=Math.abs(n.getTranspose()-o.getTranspose()),u=Math.abs(e-s);(void 0===i||c<i||c===i&&u<a)&&(r=s,i=c,a=u)}return parseFloat(r)}(e,this.samplers)}},{key:"getJson",value:function(){var e=Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{ampAttack:this.ampAttack,ampDecay:this.ampDecay,ampSustain:this.ampSustain,ampRelease:this.ampRelease,crossFade:this.crossFadeParameter.get(),interpolationMode:this.interpolationMode,mixMode:this.mixMode,samplers:{},glide:this.glide,monophonic:this.monophonic,detune:this.detuneParameter.get(),loopStart:this.loopStart,loopLength:this.loopLength,loop:this.loopParameter.get(),smooth:this.smoothParameter.get()});for(var t in this.samplers)e.samplers[t]=this.samplers[t].map(function(e){return e.getJson()});return e=Object(ee.b)(e,"ampAttackParameter",this.ampAttackParameter),e=Object(ee.b)(e,"ampDecayParameter",this.ampDecayParameter),e=Object(ee.b)(e,"ampSustainParameter",this.ampSustainParameter),e=Object(ee.b)(e,"ampReleaseParameter",this.ampReleaseParameter),e=Object(ee.b)(e,"interpolationModeParameter",this.interpolationModeParameter),e=Object(ee.b)(e,"mixModeParameter",this.mixModeParameter),e=Object(ee.b)(e,"glideParameter",this.glideParameter),e=Object(ee.b)(e,"monophonicParameter",this.monophonicParameter),e=Object(ee.b)(e,"detuneParameter",this.detuneParameter),e=Object(ee.b)(e,"loopStartParameter",this.loopStartParameter),e=Object(ee.b)(e,"loopLengthParameter",this.loopLengthParameter),e=Object(ee.b)(e,"smoothParameter",this.smoothParameter),e=Object(ee.b)(e,"loopParameter",this.loopParameter),e=Object(ee.b)(e,"crossFadeParameter",this.crossFadeParameter)}},{key:"fromJsonSync",value:function(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&this.clearSamples(),this.ampAttackParameter.set(e.ampAttack),this.ampDecayParameter.set(e.ampDecay),this.ampSustainParameter.set(e.ampSustain),this.ampReleaseParameter.set(e.ampRelease),void 0!==e.loopStart&&this.loopStartParameter.set(e.loopStart),void 0!==e.loopLength&&this.loopLengthParameter.set(e.loopLength),void 0!==e.loop&&this.loopParameter.set(e.loop),void 0!==e.crossFade&&this.crossFadeParameter.set(e.crossFade),e.interpolationMode&&(this.interpolationMode=e.interpolationMode),void 0!==e.mixMode&&(this.mixMode=Object(pe.a)(e.mixMode)?hr:e.mixMode),void 0!==e.glide&&(this.glide=e.glide),void 0!==e.monophonic&&(this.monophonic=e.monophonic),void 0!==e.smooth&&this.smoothParameter.set(e.smooth),Object(ee.a)(e,"ampAttackParameter",this.ampAttackParameter,this.sequencerEngine),Object(ee.a)(e,"ampDecayParameter",this.ampDecayParameter,this.sequencerEngine),Object(ee.a)(e,"ampSustainParameter",this.ampSustainParameter,this.sequencerEngine),Object(ee.a)(e,"ampReleaseParameter",this.ampReleaseParameter,this.sequencerEngine),Object(ee.a)(e,"interpolationModeParameter",this.interpolationModeParameter),Object(ee.a)(e,"mixModeParameter",this.mixModeParameter),Object(ee.a)(e,"glideParameter",this.glideParameter,this.sequencerEngine),Object(ee.a)(e,"monophonicParameter",this.monophonicParameter,this.sequencerEngine),Object(ee.a)(e,"detuneParameter",this.detuneParameter,this.sequencerEngine),Object(ee.a)(e,"loopStartParameter",this.loopStartParameter,this.sequencerEngine),Object(ee.a)(e,"loopLengthParameter",this.loopLengthParameter,this.sequencerEngine),Object(ee.a)(e,"loopParameter",this.loopParameter,this.sequencerEngine),Object(ee.a)(e,"smoothParameter",this.smoothParameter,this.sequencerEngine),Object(ee.a)(e,"crossFadeParameter",this.crossFadeParameter,this.sequencerEngine),t)for(var n in t){var r=t[n];for(var a in r){var i=r[a].sample,s=e.samplers[n][a];this.setSampleForTranspose(n,i.getCopy(!0),s,r[a].tempo)}}this.samples=Object(p.a)({},this.samplers),this.loop=this.loop,void 0!==e.detune?this.detuneParameter.set(e.detune):this.detuneParameter.set(0)}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o,c,u=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(s in r=u.length>2&&void 0!==u[2]&&u[2],this.loaded=!1,this.store.dispatch(Object(C.ne)(this.track.subSequence.id,this.track.trackNumber,!0)),this.getParameters().forEach(function(e){return e.isLoaded=!1}),this.fromJsonSync(t,void 0,r),i=[],t.samplers)if(void 0!==t.samplers[s].length)for(o in t.samplers[s])c=t.samplers[s][o],i.push(this.loadSamplerFromJson(parseFloat(s),c));else i.push(this.loadSamplerFromJson(parseFloat(s),t.samplers[s]));return e.next=9,Promise.all(i);case 9:if(this.loaded=!0,this.track.sample=this.defaultSampler&&this.defaultSampler.sample,!this.defaultSampler){e.next=15;break}return e.next=14,this.defaultSampler.samplesStream.fetch();case 14:this.track.samplesStream=this.defaultSampler.samplesStream;case 15:this.getParameters().forEach(function(e){return e.isLoaded=!0}),this.store.dispatch(Object(C.ne)(this.track.subSequence.id,this.track.trackNumber,!1));case 17:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"setSampleForTranspose",value:function(e,t,n,r){var a=new er(this.track,t,function(){return[]},n.slices,n);void 0!==r&&(a.tempo=r),a.init(void 0,void 0,!0),this.detuneSignal.connect(a.detuneSignal,0,0),void 0===this.samplers[e]&&(this.samplers[e]=[]),this.samplers[e].push(a),this.cache={}}},{key:"loadSamplerFromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new q.a(n.sampleId,this.sequencerEngine.encryptedIpfs),e.prev=1,e.next=4,r.load();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return");case 9:this.setSampleForTranspose(t,r,n);case 10:case"end":return e.stop()}},e,this,[[1,6]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearSamples",value:function(){for(var e in this.samplers){for(var t in this.samplers[e])this.samplers[e][t].dispose();delete this.samplers[e]}this.voices.clear(),this.ripMods()}},{key:"getSamples",value:function(){var e=[];for(var t in this.samplers)for(var n in this.samplers[t])e.push(this.samplers[t][n].sample);return e}},{key:"ripMods",value:function(){if(void 0!==this.parameters){var e,t=mr(this.parameters);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.object&&n.isConnectedToAnyModulator()&&n.disconnectFromAllModulators()}}catch(r){t.e(r)}finally{t.f()}}}},{key:"dispose",value:function(){this.clearSamples(),this.voices.dispose(),this.voices=void 0,this.samplers=void 0,this.outputNode.dispose(),this.outputNode=void 0,this.parameters=void 0}},{key:"getPitch",value:function(e){var t=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,o,c;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0===(s=t.getNoteFromName(e.name))){n.next=4;break}return r(s),n.abrupt("return");case 4:return r(void 0),n.abrupt("return");case 10:(o=n.sent).notes.length>0&&(o.notes.sort(function(e,t){return t.endTime-t.starTime-(e.endTime-e.startTime)}),c=o.notes[0].pitch-48,r(c)),r(void 0);case 13:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"deleteSampler",value:function(e){for(var t in this.samplers){var n=this.samplers[t].indexOf(e);n>-1&&(this.samplers[t].splice(n,1),e.dispose()),0===this.samplers[t].length&&delete this.samplers[t]}this.cache={},this.voices.clear()}},{key:"selectSampler",value:function(e,t){this.cache={},this.samplers[e].filter(function(e){return e!==t}).forEach(function(e){return e.on=!1}),t.on=!0}},{key:"getNoteFromName",value:function(e){var t=void 0,n=e.match(/([A-G]||[a-g])([#b])?\d/);if(n&&!(n[0].length<2)&&(2===(e=n[0].toUpperCase()).length?t=e.substring(0,1):3===e.length&&(t=e.substring(0,2)),t&&X.a.baseNotes.indexOf(t)>-1))return X.a.fromString(e).getTranspose()}},{key:"findLoop",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,s,o,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(this.solutionNumber+=500,t=this.solutionNumber),i=this.getAllSamplersAtExactTranspose(0)[0],s=vr(i.audioBuffer,t,n,r),o=s.start,!((c=s.end)<o)){e.next=7;break}return this.solutionNumber=Math.ceil(10*Math.random()),this.findLoop(void 0,n,r),e.abrupt("return");case 7:u=100*o/(W.a.Master.context.sampleRate*i.getDuration()),this.loopStartParameter.set(u),this.loopLengthParameter.set(100*(c-o)/(W.a.Master.context.sampleRate*i.getDuration()));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.context,t=arguments.length>1?arguments[1]:void 0,r=new n(arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.sequencerEngine,this.mixSession,e,t);return r.fromJsonSync(this.getJson(),this.samplers),r}},{key:"makePublicIfNeeded",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s,o,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=a.a.keys(this.samplers);case 1:if((e.t1=e.t0()).done){e.next=21;break}t=e.t1.value,n=this.samplers[t],e.t2=a.a.keys(n);case 5:if((e.t3=e.t2()).done){e.next=19;break}return r=e.t3.value,i=this.samplers[t][r],s=i.sample,e.next=11,Hn.a.guildSamples.getGuildIdForSound(s.getId());case 11:if(void 0===(o=e.sent)||0===o){e.next=17;break}return e.next=15,Hn.a.guildSamples.saveSample(s);case 15:c=e.sent,s.ipfsHash=c;case 17:e.next=5;break;case 19:e.next=1;break;case 21:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setEnvelopes",value:function(e,t){var n=this.ampAttackParameter.getKeyScaledValue(t),r=this.ampDecayParameter.getKeyScaledValue(t),a=this.ampSustainParameter.getKeyScaledValue(t),i=this.ampReleaseParameter.getKeyScaledValue(t);this.onAttackChanged(n),this.onDecayChanged(r),this.onSustainChanged(a),this.onReleaseChanged(i),null!==e.releaseParameter.get()&&this.releaseParameter.set(e.releaseParameter.get())}}]),n}(Object(yt.a)(wt(Z)));function kr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var jr=Hn.a.presets,wr=function(e){Object(u.a)(n,e);var t=kr(n);function n(e,r,a,i,o,u){var l;!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return Object(s.a)(this,n),(l=t.call(this,e,r,a,i,o,u,!1)).setInstrument(new Or(r,a,(new V.a).forTrack(Object(c.a)(l)),Object(c.a)(l))),l.name="Sampled Instrument",l.gated=!0,l}return Object(o.a)(n,[{key:"getInstrumentType",value:function(){return U.g}},{key:"createNewInstrument",value:function(){this.instrument=void 0,this.setInstrument(new Or(this.sequencerEngine,this.mixSession,(new V.a).forTrack(this),this)),this.gated=!0}},{key:"tempo",get:function(){var e=this.selectedSampler||this.instrument.defaultSampler;return void 0===e?0:e.tempo}},{key:"auditionPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,e.next=3,jr.getPresetData(t);case 3:r=e.sent,this.fromJson(r.trackParameters),this.presetName=n,this.update();case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r,i,s,o){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,t,r,i,s,o);case 2:this.instrument.defaultSampler&&(this.sample=this.instrument.defaultSampler.sample);case 3:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i){return e.apply(this,arguments)}}()},{key:"loadTrackInfo",value:function(e,t){var n=this.selectedSampler||this.instrument.defaultSampler;n&&(this.sample=t,n.auditionSound(t),this.presetName=t.name,this.sequencerEngine.update()),this.store.dispatch(Object(C.ne)(this.subSequence.id,this.trackNumber,!1))}},{key:"restart",value:function(){Object(ne.a)(Object(f.a)(n.prototype),"restart",this).call(this),this.isFrozen||(this.instrument.triggerCounters={},this.instrument.cache={},this.instrument.voices.clear())}},{key:"start",value:function(){Object(ne.a)(Object(f.a)(n.prototype),"start",this).call(this),this.isFrozen||this.restart()}},{key:"onNewStep",value:function(e,t){this.isFrozen?Object(ne.a)(Object(f.a)(n.prototype),"onNewStep",this).call(this):(Object(ne.a)(Object(f.a)(n.prototype),"onNewStep",this).call(this),this.instrument.onNewStep(e,t))}},{key:"getSamplesStream",value:function(){var e=this.selectedSampler||this.instrument.defaultSampler;return e?e.samplesStream:this.samplesStream}},{key:"getCopy",value:function(e,t){return Object(ne.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,s){return new n(e,t,r,a,i,s)},t)}},{key:"makePublicIfNeeded",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.instrument.makePublicIfNeeded();case 2:e.t0=a.a.keys(this.effectsChains);case 3:if((e.t1=e.t0()).done){e.next=9;break}return t=e.t1.value,e.next=7,this.effectsChains[t].makePublicIfNeeded();case 7:e.next=3;break;case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isMonophonic",value:function(){return this.instrument.monophonic}}]),n}(lt);function xr(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.numberOfPatterns(),a=void 0;if(t===D.b)switch(n){case U.c:a=new ht(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence);break;case U.f:a=new Vn(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence);break;case U.h:a=new lt(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence);break;case U.g:a=new wr(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence)}else t===D.c&&(a=new Zn(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence));if(void 0!==a)return a}var Sr=n(592),Pr=n(428),Er=n(427),Tr=(n(557),n(21)),Ar=n(122),Mr=n(901);function Rr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Cr=function(e){Object(u.a)(n,e);var t=Rr(n);function n(e,r,a,i,o,c){var u;return Object(s.a)(this,n),(u=t.call(this,e,r,a,i,o,c)).audioInputChannel=void 0,u.isRecording=!1,u.samplesToUpload=[],u.soundUploader=new Ie.a(1,function(e,t,n){return u.onSoundUploaded(t,n)}),u}return Object(o.a)(n,[{key:"isRecordable",value:function(){return!0}},{key:"onSoundUploaded",value:function(e,t){}},{key:"setAudioInputManager",value:function(e){this.audioInputManager=e,this.audioInputManager.monitorVolume.gain.value=0}},{key:"setAudioInput",value:function(e){void 0!==this.audioInputChannel&&this.disconnectAudioInput(this.audioInputChannel),this.audioInputChannel=e,void 0!==e?(console.log("CONNECTING AUDIO INPUT M"),this.audioInputManager.connect(this.gainNode,e),this.recorder=this.audioInputManager.getRecorder()):this.disconnectAudioInput(this.audioInputChannel)}},{key:"disconnectAudioInput",value:function(e){console.log("disconnecting channel = "+e),this.audioInputManager.disconnect(this.gainNode,e),this.audioInputChannel=void 0}},{key:"isAudioInputChannelConnected",value:function(e){return this.audioInputChannel===e}},{key:"recording",value:function(e){this.isRecording=e}},{key:"startRecording",value:function(e){if(void 0!==this.recorder){var t=this,n=Object(sr.a)(e);setTimeout(function(){t.recorder.clear(),t.recorder.record()},n+0)}}},{key:"stopRecording",value:function(e){if(void 0!==this.recorder){var t=this;setTimeout(function(){t.recorder.stop(),t.recorder.getBuffer().then(function(e){t.saveBuffer(e)})},Object(sr.a)(e)+10)}}},{key:"saveBuffer",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this,{slices:void 0,offset:0,transpose:0,volume:4},n=t[0].length,(r=W.a.Master.context.createBuffer(2,n,W.a.Master.context.sampleRate)).copyToChannel(t[0],0,0),r.copyToChannel(t[0],1,0),[{startTime:0,endTime:r.duration}],i=new q.a,this.sample=i,i.isResampled=!0,i.tags=["Recorded"],i.name="Recorded",i.audioBuffer=r,this.freeze([i]),e.next=16,this.soundUploader.uploadBufferToIpfs(t,!0,0);case 16:s=e.sent,i.ipfsHash=s;case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onNewRecordedSampler",value:function(e,t){t.gainNode.connect(this.gainNode),e.switchToPattern(e.currentPattern),e.setVolume(e.getVolume()),e.setPanning(e.getPanning())}}]),n}(Ke(Object(Mr.a)(rt)));n(548);function Nr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var qr=new W.a.Time("16n"),Ir=function(e){Object(u.a)(n,e);var t=Nr(n);function n(e,r,a,i,o,c,u){var l;return Object(s.a)(this,n),(l=t.call(this,e,r,a,i,o,c)).midiOutputs=new Set,l.midiEngine=void 0,l.isRecordingMidi=!1,l.isEnabled=!1,l.recordedTriggers={},void 0!=u&&u||l.setupEffects(),l.audioInputManager=void 0,l.midiChannel=void 0,l.gated=!0,l.latency=0,l.ccParameters=[],l}return Object(o.a)(n,[{key:"setupCCParameters",value:function(e){console.log("OUTPUT =",e),this.ccParameters=[];for(var t=1;t<120;t++){var n=new Sr.a("Midi CC "+t,t,e);this.registerParameter(n,!1),this.ccParameters.push(n)}}},{key:"getParameters",value:function(){return[].concat(Object(h.a)(Object(ne.a)(Object(f.a)(n.prototype),"getParameters",this).call(this)),Object(h.a)(this.ccParameters))}},{key:"getInstrumentType",value:function(){return U.b}},{key:"getName",value:function(){return"External Instrument"}},{key:"getCopy",value:function(){var e=Object(ne.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,s){return new n(e,t,r,a,i,s)});return e.setMidiEngine(this.midiEngine),e.midiChannel=this.middieChannel,e.sequencerEngine=this.sequencerEngine,e.midiOutputs=new Set(this.midiOutputs),e.latency=this.latency,e}},{key:"getSoundUploader",value:function(){return this.soundUploader}},{key:"setAudioSettings",value:function(e){this.audioSettings=e}},{key:"setSequencerEngine",value:function(e){this.sequencerEngine=e}},{key:"recording",value:function(e){this.isRecordingMidi=e}},{key:"toggleRecording",value:function(e){this.pattern.loopsPlaying[e]=!this.pattern.loopsPlaying[e]}},{key:"isRecordingPlaying",value:function(e){return this.pattern.loopsPlaying[e]}},{key:"getRecordings",value:function(){return this.getSamplers()}},{key:"deleteMidiOutput",value:function(e){this.midiOutputs.has(e)&&this.midiOutputs.delete(e)}},{key:"addMidiOutput",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.midiOutputs.add(e),this.setupCCParameters(this.sequencerEngine.midi.deviceToMidiCC[e.name])}},{key:"addMidiInterfaceEffect",value:function(e,t){if(!this.midiEffects.effects.filter(function(e){return"Midi Interface"===e.name})[0]){var n=new Er.a(this);n.setConfig(e,t),this.midiEffects.addEffect(n),this.sequencerEngine.update()}}},{key:"setAudioInputManager",value:function(e){this.audioInputManager=e}},{key:"onLoadTrackUrl",value:function(e,t,r){return Object(ne.a)(Object(f.a)(n.prototype),"onLoadTrackUrl",this).call(this,e,t,r)}},{key:"disconnect",value:function(){void 0!==this.audioChannel&&this.audioInputManager.disconnect(this.gainNode,this.audioChannel),this.audioChannel=void 0}},{key:"getMidiOutputs",value:function(){return this.midiOutputs}},{key:"setMidiEngine",value:function(e){this.midiEngine=e;var t=this;setTimeout(function(){t.setupMidiInput()},1e3)}},{key:"inputNoteForStep",value:function(e,t){var n=X.a.fromString(t).getTranspose();this.getStepsAtResolution(this.sequencerEngine.resolution)[e].transpose=n,this.syncBuckets(this.sequencerEngine.resolution),this.update()}},{key:"triggerMidiNoteOn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.onNoteOn(void 0,X.a.fromTranspose(e).toString(),t)}},{key:"onNoteOn",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;void 0!==this.sequencerEngine.cursor.step&&this.sequencerEngine.cursor.show&&this.inputNoteForStep(this.sequencerEngine.cursor.getStep(this.sequencerEngine.resolution),t),this.isEnabled&&(this.midiOutputs.size>0&&this.midiOutputs.forEach(function(e){return n.midiEngine.playNoteSimple(e,t,n.midiChannel,0,0,r)}),this.isRecordingMidi)}},{key:"triggerMidiNoteOff",value:function(e){this.onNoteOff(void 0,X.a.fromTranspose(e).toString())}},{key:"onNoteOff",value:function(e,t){var n=this;this.midiOutputs.size>0&&this.midiOutputs.forEach(function(e){return n.midiEngine.releaseNoteSimple(e,t,n.midiChannel,0)}),this.isRecordingMidi&&this.recordedTriggers}},{key:"setupMidiInput",value:function(){}},{key:"getTrackType",value:function(){return D.d}},{key:"liveTrigger",value:function(e){this.triggerMidiNoteOn(e.transpose)}},{key:"liveTriggerRelease",value:function(e){this.triggerMidiNoteOff(e)}},{key:"trigger",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r){var i,s,o,c,u,l,h,p,d=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFrozen){e.next=3;break}return Object(ne.a)(Object(f.a)(n.prototype),"trigger",this).call(this,t,r),e.abrupt("return");case 3:for(r-=this.latency/1e3,i=t.transpose,s=new W.a.Time(new W.a.Time(t.duration)*qr),Object(sr.a)(r),o=t.release/16,c=t.chop,u=(null==s?qr:s)/c,l=r,h=t.velocity,h*=1-t.start,p=0;p<c;p++)this.midiOutputs.forEach(function(e){return d.midiEngine.playNote(e,d.midiChannel,i,Object(sr.a)(l),s.toMilliseconds(),o,h)}),l+=u;case 15:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"expandRecordedTracks",value:function(){var e=this,t=Object.keys(this.pattern.loopsPlaying).filter(function(t){return e.pattern.loopsPlaying[t]});console.log("loops playing = "),console.log(t),console.log(this.samplers),t.forEach(function(t){return e.sequencerEngine.addSound(t,void 0,void 0,void 0,!0)})}},{key:"getJson",value:function(){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{latency:this.latency})}},{key:"fromJson",value:function(e){e.latency&&(this.latency=e.latency)}}]),n}(Cr);function _r(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Dr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dr(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Dr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Lr=function(e){Object(u.a)(n,e);var t=Fr(n);function n(e,r,a,i,o,c){var u;!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return Object(s.a)(this,n),(u=t.call(this,e,r,a,i,o,c)).setupEffects(),u}return Object(o.a)(n,[{key:"getSampler",value:function(){var e=this.frozenColumns[0].playing||0;return this.frozenColumns[0].frozenSamplers[e]}},{key:"sample",get:function(){if(this.frozenColumns&&this.frozenColumns[0]){var e=this.frozenColumns[0].playing||0;return this.frozenColumns[0].frozenSamples[e]}}},{key:"getName",value:function(){return"Multi Freeze"}},{key:"getTrackType",value:function(){return D.e}},{key:"unfreeze",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s,o,c,u,l,f,p,d,v,m,y,b,g,O,k,j,w,x,S,P,E,T,A,M,R,N=this,q=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=q.length>0&&void 0!==q[0]?q[0]:this.frozenGroup,n=q.length>1&&void 0!==q[1]?q[1]:this.frozenTracks,r=q.length>2?q[2]:void 0,this.sequencerEngine.dispatch(Object(C.bc)("Unfreezing Tracks")),i=this.currentPattern,s=this.sequencerEngine,o=[],c=Object(h.a)(s.tracks),u=_r(n),e.prev=9,u.s();case 11:if((l=u.n()).done){e.next=27;break}if(f=l.value,!r||r===f){e.next=15;break}return e.abrupt("continue",25);case 15:if(f){e.next=19;break}return c.push(!1),o.push(!1),e.abrupt("continue",25);case 19:return p=f.patterns,d=f.trackData,f.trackEffectChains,f.trackMidiEffects,e.next=22,Qr(s,d,p,0,this.sequencerEngine.currentSubSequence);case 22:v=e.sent,c.push(v),o.push(v);case 25:e.next=11;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(9),u.e(e.t0);case 32:return e.prev=32,u.f(),e.finish(32);case 35:m=0,e.t1=a.a.keys(n);case 37:if((e.t2=e.t1()).done){e.next=72;break}if(y=e.t2.value,!r||n[y]===r){e.next=41;break}return e.abrupt("continue",37);case 41:if((b=o[m++])&&n[y]){e.next=44;break}return e.abrupt("continue",37);case 44:return g=n[y],O=g.patterns,k=g.patternsConfig,j=g.trackData,w=g.trackEffectChains,x=g.trackMidiEffects,e.next=47,Zr({sequencerEngine:s,track:b,tracks:c,patterns:O,trackData:j,trackEffectChains:w,trackMidiEffects:x,subSequence:s.currentSubSequence});case 47:if(!k){e.next=70;break}if(S=this.patterns.length,P=k.length,s.switchToPattern(S-1),!(P>S)){e.next=61;break}E=S;case 53:if(!(E<P)){e.next=59;break}return e.next=56,s.newPattern(!0);case 56:E++,e.next=53;break;case 59:e.next=69;break;case 61:if(!(P<S)){e.next=69;break}T=P;case 63:if(!(T<S)){e.next=69;break}return e.next=66,b.newPattern(!0);case 66:T++,e.next=63;break;case 69:for(A=0;A<S;A++)b.patterns[A].loadFromJson(k[Math.min(A,k.length-1)]);case 70:e.next=37;break;case 72:if(M=this.sequencerEngine.groups.newGroup(),o.filter(function(e){return e}).forEach(function(e){return e.subSequence=N.subSequence}),o.filter(function(e){return e}).forEach(function(e){return M.addTrack(e)}),!t){e.next=79;break}return t.tracks=[],e.next=79,M.fromJson(t,this.sequencerEngine);case 79:this.sequencerEngine.tracks=c.filter(function(e){return e}),this.sequencerEngine.groups.updateGroupNumbers(),this.sequencerEngine.groups.groups.forEach(function(e){return e.updateRedux()}),this.sequencerEngine.switchToPattern(i),this.sequencerEngine.updateTracks(!0),this.sequencerEngine.selectTrack(this.sequencerEngine.tracks.length-o.length),this.sequencerEngine.dispatch(Object(C.bc)(void 0)),o.filter(function(e){return e}).forEach(function(e){return e.midiEffects.effects.filter(function(e){return e.lostParameters&&e.lostParameters.length>0}).forEach(function(e){return e.loadParameters(e.lostParameters)})}),t||(R=this.pad,o.filter(function(e){return e}).forEach(function(e,t){var n=R.slots.indexOf(!1);-1===n&&(R=N.subSequence.createPad()),R.addTrack(e,n),e.trackIsLoading=!1}));case 88:case"end":return e.stop()}},e,this,[[9,29,32,35]])}));return function(){return e.apply(this,arguments)}}()},{key:"fromJson",value:function(e){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e),this.frozenGroup=e.frozenGroup,this.frozenTracks=e.frozenTracks}},{key:"getJson",value:function(){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{frozenGroup:this.frozenGroup,frozenTracks:this.frozenTracks})}}]),n}(rt),Br="OFF";function zr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Jr=function(e){Object(u.a)(n,e);var t=zr(n);function n(e,r,a,i,o,c){var u;return Object(s.a)(this,n),(u=t.call(this,e,r,a,i,o,c)).setupEffects(),u.recordingMode=Br,u.deleteInlet("trigger "),u.deleteInlet("audition sample"),u.deleteInlet("restart"),u.deleteOutlet(v.p),u}return Object(o.a)(n,[{key:"selectedRecording",get:function(){return this.trackData.selectedRecording},set:function(e){this.trackData.selectedRecording=e}},{key:"isRecorable",value:function(){return!0}},{key:"getCopy",value:function(){var e=Object(ne.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,s){return new n(e,t,r,i,a,i,s)});return e.selectedRecording=this.selectedRecording,e}},{key:"getName",value:function(){return"Audio Track"}},{key:"getSelectedRecording",value:function(){return this.selectedRecording}},{key:"setSelectedRecording",value:function(e){this.selectedRecording=e}},{key:"getRecordings",value:function(){return Object(ne.a)(Object(f.a)(n.prototype),"getSamplers",this).call(this)}},{key:"saveBuffer",value:function(e){Object(ne.a)(Object(f.a)(n.prototype),"saveBuffer",this).call(this,e),this.setSelectedRecording(0)}},{key:"getJson",value:function(){var e=Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this);return e.selectedRecording=this.selectedRecording,e}},{key:"getSelectedRecordingSampler",value:function(){return Object(ne.a)(Object(f.a)(n.prototype),"getSamplers",this).call(this)[this.selectedRecording]}},{key:"getSelectedRecordingSoundId",value:function(){return this.soundIds[this.selectedRecording]}},{key:"getTrackType",value:function(){return D.a}},{key:"toggleEnabled",value:function(){Object(ne.a)(Object(f.a)(n.prototype),"toggleEnabled",this).call(this)}},{key:"setIsEnabled",value:function(e){Object(ne.a)(Object(f.a)(n.prototype),"setIsEnabled",this).call(this,e);var t=this.audioInputManager;t&&(t.monitorVolume.gain.value=this.isEnabled?1:0)}},{key:"length",get:function(){if(0===this.frozenColumns.length||this.frozenColumns.every(function(e){return!e.frozenSamplers[e.playing]}))return Object(ne.a)(Object(f.a)(n.prototype),"length",this);var e=this.frozenColumns.map(function(e){return e.frozenSamplers[e.playing]}).filter(function(e){return e}),t=this.getMaxDuration(),r=e[0].tempo/this.sequencerEngine.bpm;return Vr(r*t/W.a.Time("32n").toSeconds())}},{key:"getMaxDuration",value:function(){var e=this.frozenColumns.map(function(e){return e.frozenSamplers[e.playing]}).filter(function(e){return e});return 0===e.length?1:Math.max.apply(Math,Object(h.a)(e.map(function(e){return e.getDuration()})))}},{key:"isAudioTrack",get:function(){return!0}},{key:"scheduleAnyRecording",value:function(e,t){e%(this.length/2)===0||e%this.length===0?"PREPARING"===this.recordingMode?(this.startRecording(t),this.recordingMode="RECORDING"):"STOPPING"===this.recordingMode&&(this.stopRecording(t),this.recordingMode=Br):this.countdown=Math.min(this.length/2-e%(this.length/2),this.length-e%this.length)}},{key:"getSampler",value:function(){return this.frozenColumns.map(function(e){return e.frozenSamplers[e.playing]}).filter(function(e){return e})[0]}}]),n}(Cr),Vr=function(e){Math.round(e);return e-e%32},Hr=Jr;function Ur(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Gr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gr(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Gr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Wr=ke.a.baseResolution,Kr=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f,h,p,d,v;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sequencerEngine,r=t.trackData,i=t.patterns,s=t.trackNumber,o=t.subSequence,c=t.patternParameters,u=t.tracks,l=t.trackEffects,f=t.trackMidiEffects,h=t.trackEffectChains,p=t.patternToLoad,d=t.numPatterns,e.next=3,Qr(n,r,i,s,o);case 3:return v=e.sent,e.next=6,Zr({sequencerEngine:n,track:v,tracks:u,patterns:i,trackData:r,trackEffects:l,trackMidiEffects:f,patternParameters:c,trackEffectChains:h,subSequence:o,numPatterns:d,patternToLoad:p});case 6:return v.loadLostParameters(),e.abrupt("return",v);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Qr=function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i,s){var o,c,u,l,f,h=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=h.length>5&&void 0!==h[5]?h[5]:r.length,"type"in n&&"MIDI"===n.type,c=n.type,u=void 0,c===D.d?u=new Ir(i,t,t.mixSession,o,function(){return t.update()},t.sends):c===D.f?(u=new rt(i,t,t.mixSession,o,function(){return t.update()},s)).trackNumber=i:c===D.a?u=new Hr(i,t,t.mixSesion,o,function(){return t.update()},s):c===D.e?u=new Lr(i,t,t.mixSession,o,function(){return t.update()},s):c!==D.b&&c!==D.c||(l=n.instrumentType,u=xr(t,c,l)),u.trackNumber=i,u.setSends(t.sends),e.next=9,u.fromJson(n);case 9:return(f=e.sent)&&u.sequencerEngine.dispatch(Object(C.ub)(f)),e.abrupt("return",u);case 12:case"end":return e.stop()}},e)}));return function(t,n,r,a,i){return e.apply(this,arguments)}}(),Zr=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f,h,d,v,m,y,b,g,O,k,j,w,x,S,P,E,T,A,M,R,N,q,I,D,L;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sequencerEngine,r=t.track,i=t.tracks,s=t.patterns,o=t.trackData,c=t.patternParameters,u=t.trackEffects,l=t.trackMidiEffects,f=t.trackEffectChains,h=t.subSequence,d=t.numPatterns,v=void 0===d?s.length:d,m=t.patternToLoad,y=-16,b=[],g={},e.next=6,Yr({sequencerEngine:n,trackEffectChains:f,trackEffects:u,track:r,trackNumber:r.trackNumber,tracks:i});case 6:O=e.sent,k=O.effects,j=Xr(l,r),w=j.effects,g=Object(p.a)({},g,O.bulk,j.bulk),x=0;case 12:if(!(x<v)){e.next=39;break}S=[],P=s[m||x],(E="size"in P?P.size:Wr)>y&&(y=E),T="buckets"in P,(A=new B.a(n,r)).changeLength(E,!1),M=0;case 21:if(!(M<E)){e.next=33;break}if(M in P){e.next=26;break}return R=A.stepBuckets[M],S.push(R),e.abrupt("continue",30);case 26:if(N=A.stepBuckets[M],q=P[M],T)for(D in q)(L=N.steps[D]||new F.a).track=r,L.stepNumber=M,L.simpleLoad(q[D],k,r,w),N.steps[D]=L;else(I=N.steps[0]).track=r,I.stepNumber=M,I.simpleLoad(P[M],k,r,w),N.steps[0]=I;S.push(N);case 30:M++,e.next=21;break;case 33:A.loadStepBuckets(void 0,!0),c&&A.loadFromJson(c[x]),b.push(A);case 36:x++,e.next=12;break;case 39:return r.patterns=b,r.pattern.muted=o.muted,r.gated=o.gated,e.next=44,_(r,o,h);case 44:r.setupEffects(),n.dispatch(Object(C.ub)(g));case 46:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Yr=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f,h,d,v,m,y,b,g,O,k,j,w;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.sequencerEngine,r=t.track,i=t.trackEffects,s=t.trackEffectChains,o=t.trackNumber,c=t.tracks,u={},l=[],f=r.effectsChains[0],void 0===i){e.next=28;break}h=Ur(i),e.prev=6,h.s();case 8:if((d=h.n()).done){e.next=17;break}return v=d.value,e.t0=l,e.next=13,Object(J.a)(v,c,n,o);case 13:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 15:e.next=8;break;case 17:e.next=22;break;case 19:e.prev=19,e.t2=e.catch(6),h.e(e.t2);case 22:return e.prev=22,h.f(),e.finish(22);case 25:f.updateEffects(l.map(function(e){return e.effect})),e.next=65;break;case 28:if(void 0===s){e.next=63;break}m=[],y=Ur(s),e.prev=31,y.s();case 33:if((b=y.n()).done){e.next=51;break}g=b.value,O=new z.a(r.gainNode,r.trackNode,(new V.a).forTrack(r),n),e.t3=a.a.keys(g);case 37:if((e.t4=e.t3()).done){e.next=47;break}return k=e.t4.value,j=g[k],e.next=42,Object(J.a)(j,c,n,o);case 42:w=e.sent,O.addEffect(w.effect),u=Object(p.a)({},u,w.bulk),e.next=37;break;case 47:O.updateEffects(),m.push(O);case 49:e.next=33;break;case 51:e.next=56;break;case 53:e.prev=53,e.t5=e.catch(31),y.e(e.t5);case 56:return e.prev=56,y.f(),e.finish(56);case 59:r.effectsChains.forEach(function(e){return e.dispose()}),r.effectsChains=m,e.next=65;break;case 63:l=Object(H.a)(n),f.updateEffects(l);case 65:return e.abrupt("return",{effects:l,bulk:u});case 66:case"end":return e.stop()}},e,null,[[6,19,22,25],[31,53,56,59]])}));return function(t){return e.apply(this,arguments)}}(),Xr=function(e,t){if(void 0!==e){var n=t.midiEffects.fromJson(e);return t.updateMidiEffectsRedux(),{effects:t.midiEffects.effects,bulk:n}}return{effects:[],bulk:{}}},$r=(n(300),n(153)),ea=n(107),ta=n(270),na=n(64),ra=n(65),aa=function(){function e(t,n,r,a,i){Object(s.a)(this,e),this.id=Object(S.uuid)(),this.tracks=[],this.subSequence=i,this.sequencerEngine=a,this.groupNumber=r,this.tags=t,this.inputNode=new G.Volume,this.outputNode=new G.PanVol,this.muteableNode=new G.Volume,this.muteableNode.connect(this.outputNode),this.meter=new G.Meter(.9),this.outputNode.connect(this.meter),this.effectsChain=new z.a(this.inputNode,this.muteableNode,(new V.a).forGroup(this),a),this.effectsChain.setupEffects(),this.setVolume(-2,!1),this.channelMixer=n,this.outputs=void 0,this.muted=!1,this.panning=0}return Object(o.a)(e,[{key:"updateRedux",value:function(){this.sequencerEngine.store.dispatch(Object(C.Db)(this.id,Object(h.a)(this.tracks)))}},{key:"mix",get:function(){return this.subSequence.mix}},{key:"solo",get:function(){var e=!1;for(var t in this.tracks)e=e||this.tracks[t].getSolo();return e},set:function(e){this.tracks.forEach(function(t){return t.solo(e)})}},{key:"effects",get:function(){return this.effectsChain.effects}},{key:"getEffectNumber",value:function(e,t){return this.effects.indexOf(e)}},{key:"dispose",value:function(){this.outputs=this.channelMixer.disconnect(this.outputNode,this.outputs),this.inputNode.dispose(),this.muteableNode.dispose(),this.outputNode.dispose(),this.inputNode=void 0,this.outputNode=void 0,this.effectsChain.dispose(),this.effectsChain=void 0}},{key:"mute",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.sequencerEngine.store.getState().mix.isRecordingMix&&this.mix.addEvent(new ra.a(this.groupNumber,e)),this.muted=e,this.muteableNode.volume.value=e?-125:0}},{key:"moveEffectTo",value:function(e,t){this.effectsChain.moveEffectTo(e,t)}},{key:"deleteEffect",value:function(e){this.effectsChain.deleteEffect(e)}},{key:"connectAudio",value:function(e){this.outputs=this.channelMixer.connect(this.outputNode)}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o,c,u,l,f,h,d;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t.newVolume?this.setVolume(Object(ta.b)(t.volume,0,128),!1):t.newestVolume?this.setVolume(t.volume,!1):(r=128*(t.volume+40)/43,this.setVolume(r,!1)),i=[],s=0;s<t.tracks.length;s++)void 0!==(o=n.tracks[t.tracks[s]])&&(o.getTrackType()===D.f&&o.sample&&i.push(o.sample.fetchTags()),this.addTrack(o));c={},u=0;case 5:if(!(u<t.effects.length)){e.next=14;break}return e.next=8,Object(J.a)(t.effects[u],n.tracks,n);case 8:l=e.sent,this.effectsChain.addEffect(l.effect),c=Object(p.a)({},c,l.bulk);case 11:u++,e.next=5;break;case 14:return Object.keys(c).length>0&&this.sequencerEngine.store.dispatch(Object(C.ub)(c)),e.next=17,Promise.all(i);case 17:for(f=e.sent,h=new Set,d=0;d<f.length;d++)f[d].forEach(function(e){return h.add(e)});return this.tags=Array.from(h),e.abrupt("return",this);case 22:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSendNodes",value:function(){return[]}},{key:"addTrack",value:function(e){this.hasTrack(e)||(this.tracks.push(e),e.addToGroup(this))}},{key:"hasTrack",value:function(e){return this.tracks.indexOf(e)>-1}},{key:"setVolume",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e=Math.min(1,e),this.sequencerEngine.store.getState().mix.isRecordingMix&&this.mix.addEvent(new na.a(this.groupNumber,e)),this.volume=e,this.outputNode.volume.linearRampToValueAtTime(e,G.Master.context.currentTime+.01),t&&!this.sequencerEngine.isLoading&&this.sequencerEngine.store.dispatch(Object(C.Eb)(this.groupNumber,e)),this.subSequence.groups.sendVolumes()}},{key:"setPanning",value:function(e){this.panning=e,this.outputNode.pan.value=e}},{key:"updateEffects",value:function(e){this.effectsChain.updateEffects()}},{key:"getJson",value:function(e){return{newestVolume:!0,tracks:this.tracks.map(function(e){return e.trackNumber}),effects:this.effectsChain.getJson(),volume:this.volume,outputs:this.outputs}}}]),e}(),ia=new(function(){function e(){Object(s.a)(this,e),this.groups=[]}return Object(o.a)(e,[{key:"useGroup",value:function(e,t,n,r,a){if(0===this.groups.length||!window.explore)return new aa(e,t,n,r,a);var i=this.groups.pop();return i.subSequence=a,i.channelMixer=t,i.sequencerEngine=r,i.tags=e,i.groupNumber=n,i.subSequence=a,i}},{key:"releaseGroup",value:function(e){window.explore?(e.outputNode.disconnect(),e.tracks=[],e.updateRedux(),e.effectsChain.clear(),this.groups.push(e)):e.dispose()}}]),e}());function sa(e,t){return e.filter(function(e){return-1!==t.indexOf(e)})}var oa=function(){function e(t,n,r,a){Object(s.a)(this,e),this.groups=[],this.subSequence=a,this.channelMixer=t,this.sends=n,this.sequencerEngine=r,this.doneLoading=!1}return Object(o.a)(e,[{key:"startSendingLevels",value:function(){var e=this;setInterval(function(){if(e.zObject){var t=e.groups.map(function(e){var t=e.meter.getLevel();return t<-80?0:Math.pow((t+80)/86,2)});e.zObject.sendMessage("group levels",t)}},20)}},{key:"sendVolumes",value:function(){this.zObject&&this.zObject.sendLevels()}},{key:"deleteGroup",value:function(e){e.tracks.forEach(function(e){return e.dispose()}),e.dispose();var t=this.groups.indexOf(e);this.groups.splice(t,1),this.updateGroupNumbers()}},{key:"updateGroupNumbers",value:function(){for(var e=0;e<this.groups.length;e++)this.groups[e].groupNumber=e}},{key:"newGroup",value:function(e){var t=ia.useGroup([],this.channelMixer,this.groups.length,this.sequencerEngine,this.subSequence);return this.groups.push(t),t.connectAudio(this.getMaxChannel()),e&&this.addToGroup(e,t),t}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(a.a.mark(function e(i,s){var o,c,u,l,f,h;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=4;break}return r.sequencerEngine.tracks.forEach(function(e){return r.addTrack(e)}),i(),e.abrupt("return");case 4:o=0;case 5:if(!(o<t.length)){e.next=15;break}return c=t[o],e.next=9,ia.useGroup([],r.channelMixer,r.groups.length,r.sequencerEngine,r.subSequence).fromJson(c,n);case 9:(u=e.sent).tracks.length>0&&(u.connectAudio(r.getMaxChannel()),r.groups.push(u)),c.outputs&&(l=Object(ea.a)(c.outputs,2),f=l[0],h=l[1],r.channelMixer.switchChannelOutput(u.outputNode,f,h)&&(u.outputs=[f,h]));case 12:o++,e.next=5;break;case 15:i();case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateGroups",value:function(){this.groups.forEach(function(e){return e.setVolume(e.volume)}),this.groups.forEach(function(e){return e.setPanning(e.panning)})}},{key:"addToGroup",value:function(e,t){var n=e.group,r=1==n.tracks.length,a=this.groups.indexOf(n);e.disconnectFromGroup(),t.addTrack(e),t.tags=Array.from(new Set(t.tags.concat(n.tags))),r?(this.groups.splice(a,1),n.dispose(),this.groups.forEach(function(e,t){return e.groupNumber=t})):(a=n.tracks.indexOf(e),n.tracks.splice(a,1)),t.updateRedux(),n.updateRedux()}},{key:"deleteTrack",value:function(e){var t=e.group;if(void 0!==t&&null!==t){var n=1==t.tracks.length,r=this.groups.indexOf(t);e.disconnectFromGroup(),n?(this.groups.splice(r,1),t.dispose()):(r=t.tracks.indexOf(e),t.tracks.splice(r,1))}}},{key:"addTrack",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.getTrackType(),e.next=e.t0===D.f?3:10;break;case 3:if(void 0!==(n=t.sample.tags)){e.next=8;break}return e.next=7,t.sample.fetchTags();case 7:n=e.sent;case 8:return this.resolveTrackTags(t,n),e.abrupt("break",11);case 10:this.resolveTrackTags(t,[t.getTrackType()]);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addMidiTrack",value:function(e){this.resolveTrackTags(e,["Midi Tracks"])}},{key:"resolveTrackTags",value:function(e,t){var n=0,r=null;if(this.groups.length>=4)r=this.groups[Math.floor(4*Math.random())];else for(var a in this.groups){var i=this.groups[a],s=sa(i.tags,t);s.length>n&&(r=i,n=s.length)}null!=r?(r.tags=sa(r.tags,t),r.addTrack(e)):this.newGroup().addTrack(e)}},{key:"dispose",value:function(){this.groups.forEach(function(e){return ia.releaseGroup(e)}),this.groups=void 0}},{key:"getJson",value:function(e){return this.groups.map(function(t){return t.getJson(e)})}},{key:"getMaxChannel",value:function(){var e=[];this.groups.map(function(e){return e.outputs}).filter(function(e){return void 0!==e}).forEach(function(t){return e=e.concat(t)}),this.sends.sends.map(function(e){return e.outputs}).filter(function(e){return void 0!==e}).forEach(function(t){return e=e.concat(t)});var t=e.sort(function(e,t){return e-t}).reverse();if(0===t.length)return-1;for(var n=t[0],r=0;r<n;r+=2)if(-1==t.indexOf(r)&&-1==t.indexOf(r+1))return r-1;return n}}]),e}(),ca=n(920),ua=n(165);function la(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var fa=n(898),ha=n(896),pa=n(805);function da(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var va=function(e){return function(e){Object(u.a)(n,e);var t=da(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"dispatch",value:function(e){this.sequencerEngine.dispatch(e)}},{key:"state",get:function(){return this.sequencerEngine.state}}]),n}(e)},ma=n(405),ya=n(412),ba=n(218);function ga(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Oa(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ka(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ka(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ka(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ja(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wa=function(e){Object(u.a)(n,e);var t=ja(n);function n(e,r){var a;return Object(s.a)(this,n),(a=t.call(this))._subSequence=e,a.sequencerEngine=r,a.effects=[],a.inputedTriggers=[],a.initShadowEffects(),a}return Object(o.a)(n,[{key:"subSequence",get:function(){return this._subSequence}},{key:"linkEffectParameters",value:function(){var e=this;[].concat(Object(h.a)(this.effects),Object(h.a)(this.shadowEffects)).forEach(function(t){t.registerContext((new V.a).forSubSequence(e.subSequence))});var t,n={},r=Oa(this.effects);try{for(r.s();!(t=r.n()).done;){var a,i=Oa(t.value.getParameters());try{for(i.s();!(a=i.n()).done;){var s=a.value;n=Object(p.a)({},n,s.setStore(this.sequencerEngine.store))}}catch(o){i.e(o)}finally{i.f()}}}catch(o){r.e(o)}finally{r.f()}this.sequencerEngine.dispatch(Object(C.ub)(n))}},{key:"stop",value:function(){Object(ne.a)(Object(f.a)(n.prototype),"stop",this).call(this),this.shadowEffects.forEach(function(e){return e.stop()})}},{key:"clear",value:function(){Object(ne.a)(Object(f.a)(n.prototype),"clear",this).call(this),this.shadowEffects.forEach(function(e){return e.clear()})}},{key:"dispatch",value:function(e){this.sequencerEngine.dispatch(e)}},{key:"state",get:function(){return this.sequencerEngine.state}},{key:"input",value:function(e){this.inputedTriggers.push(e)}},{key:"output",value:function(e,t,n){var r=this,a=this.inputedTriggers,i=[].concat(Object(h.a)(this.effects),Object(h.a)(this.shadowEffects));for(var s in i){var o=i[s];if(o.isEnabled()){for(var c in a){var u=a[c];o.input(u)}a=o.output(e,t,n)}}return 0!==this.transposeParameter.get()?a.map(function(e,t){return(e=r.shadowEffects[0].copyTrigger(e,t<16)).stepData.transpose+=r.transposeParameter.get(),e}):a}},{key:"getJson",value:function(){var e=Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),t=this.shadowEffects.map(function(e){return Object(p.a)({},e.getJson(),{isShadowEffect:!0})});return t.push({isShadowEffect:!0,transposeParameter:this.transposeParameter.getJson()}),[].concat(Object(h.a)(e),Object(h.a)(t))}},{key:"fromJson",value:function(e){var t=e.filter(function(e){return!e.isShadowEffect}),r=Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,t),a=e.filter(function(e){return e.isShadowEffect});for(var i in a)a[i=parseInt(i)].transposeParameter?this.transposeParameter.fromJson(a[i].transposeParameter):r=Object(p.a)({},this.shadowEffects[i].fromJson(a[i]),r);return r}},{key:"onNewStep",value:function(){this.inputedTriggers=[],[].concat(Object(h.a)(this.effects),Object(h.a)(this.shadowEffects)).forEach(function(e){return e.onNewStep()})}},{key:"triggerAttackPostFXEnvelopes",value:function(e){}},{key:"triggerAttackPreFXEnvelopes",value:function(e,t){}},{key:"triggerReleasePostFXEnvelopes",value:function(e){}},{key:"triggerReleasePreFXEnvelopes",value:function(e,t){}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=ga(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).shadowEffects=[],e}return Object(o.a)(n,[{key:"initShadowEffects",value:function(){var e=this;this.transposeParameter=new re.a("transpose",this,function(){return[]},{min:-32,max:32,defaultValue:0}),this.transposeParameter.setStore(this.sequencerEngine.store),this.transposeParameter.setContext((new V.a).forSubSequence(this.subSequence)),this.shadowEffects=[Object(ba.c)("Sparse",this._subSequence),Object(ba.c)("Stats",this._subSequence),Object(ba.c)("Note Display",this._subSequence)],this.shadowEffects.forEach(function(t){return t._subSequence=e._subSequence})}}]),n}(e)}(ya.a)),xa=n(410),Sa=n(26);function Pa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ea=n(877),Ta=n(545),Aa=n(141),Ma=n(133);function Ra(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}n(154);var Ca=n(109);function Na(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return qa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qa(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function qa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("!",{n:"Number to compare to"},"Not boolean",function(){return 1},{inlets:1,tags:["Math"]});Object(Ca.a)("<",{n:"Number to compare to"},"Allows messages to pass if they are less than a given number",function(){return 2},{inlets:2,tags:["Math"]});Object(Ca.a)(">",{n:"Number to compare to"},"Allows messages to pass if they are greater than a given number",function(){return 2},{inlets:2,tags:["Math"]});Object(Ca.a)("=",{n:"Number to compare to"},"Allows messages to pass if they are equal to a given number",function(){return 2},{inlets:2,tags:["Math"]});Object(Ca.a)("<=",{n:"Number to compare to"},"Allows messages to pass if they are less than or equal to a given number",function(){return 2},{tags:["Math"]});Object(Ca.a)(">=",{n:"Number to compare to"},"Allows messages to pass if they are greater than or equal to a given number",function(){return 2},{tags:["Math"]});Object(Ca.a)("&&",{a:"Number to compare to"},"Applies logical AND to the arguments",function(){return 2},{inlets:2,tags:["Math"],isHot:!0});Object(Ca.a)("||",{a:"Number to compare to"},"Applies logical OR to the arguments",void 0,{isHot:!0,inlets:2,tags:["Math"]});Object(Ca.a)("filter.=",{msg:"msg to filter",n:"Number to compare msg to"},"Allows messages to pass if they are equal to a given number",function(){return 1},{inlets:function(e){return e},tags:["Math"]});Object(Ca.a)("filter.!=",{msg:"msg to filter",n:"Number to compare msg to"},"Allows messages to pass if they are not equal to a given number",function(){return 1},{inlets:2,tags:["Math"]});Object(Ca.a)("filter.>",{msg:"msg to filter",n:"Number to compare msg to"},"Allows messages to pass if they are greater to a given number",function(){return 1},{inlets:2,tags:["Math"]});Object(Ca.a)("filter.>=",{msg:"msg to filter",n:"Number to compare msg to"},"Allows messages to pass if they are greater to a given number",function(){return 1},{inlets:2,tags:["Math"]});Object(Ca.a)("filter.<=",{msg:"msg to filter",n:"Number to compare msg to"},"Allows messages to pass if they are less than or equal to a given number",function(){return 1},{inlets:2,tags:["Math"]});Object(Ca.a)("filter.<",{msg:"msg to filter",n:"Number to compare msg to"},"Allows messages to pass if they are less than or equal to a given number",function(){return 1},{inlets:2,tags:["Math"]});var Ia={"=":function(e,t){return function(e){try{var n=parseFloat(e[0]);return isNaN(n)?e[0]===t()?["bang"]:[void 0,"bang"]:n===parseFloat(t())?["bang"]:[void 0,"bang"]}catch(r){return}}},"<":function(e,t){return function(e){try{return parseFloat(e[0])<parseFloat(t())?["bang"]:[void 0,"bang"]}catch(n){return[void 0,"bang"]}}},">":function(e,t){return function(e){try{return parseFloat(e[0])>parseFloat(t())?["bang"]:[void 0,"bang"]}catch(n){return}}},"<=":function(e,t){return function(e){try{return parseFloat(e[0])<=parseFloat(t())?["bang"]:[void 0,"bang"]}catch(n){return}}},">=":function(e,t){return function(e){try{return parseFloat(e[0])>=parseFloat(t())?["bang"]:[void 0,"bang"]}catch(n){return}}},"&&":function(e,t,n){return function(e){return e[0]&&t()?["bang",void 0]:[void 0,"bang"]}},"||":function(e,t){return function(e){return t()||e[0]?["bang"]:void 0}},"!":function(e){return function(e){try{var t=parseFloat(e[0]);return 1===t?[0]:0===t?[1]:!t}catch(n){return[void 0,"bang"]}}},"filter.=":function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){try{var t,r=parseFloat(e[0]),a=Na(n);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(void 0===i||void 0===i())break;if(isNaN(r)&&e[0]===i())return[e];if(r===parseFloat(i()))return[e[0]]}}catch(s){a.e(s)}finally{a.f()}}catch(o){}}},"filter.!=":function(e,t){return function(e){try{var n=parseFloat(e[0]);if(isNaN(n)&&e[0]!==t())return[e];if(n!==parseFloat(t()))return[e[0]]}catch(r){}}},"filter.>":function(e,t){return function(e){try{var n=parseFloat(e[0]);if(isNaN(n)&&e[0]>t())return[e];if(n>parseFloat(t()))return[e[0]]}catch(r){}}},"filter.<=":function(e,t){return function(e){try{var n=parseFloat(e[0]);if(isNaN(n)&&e[0]<=t())return[e];if(n<=parseFloat(t()))return[e[0]]}catch(r){}}},"filter.<":function(e,t){return function(e){try{var n=parseFloat(e[0]);if(isNaN(n)&&e[0]<t())return[e];if(n<parseFloat(t()))return[e[0]]}catch(r){}}},"filter.>=":function(e,t){return function(e){try{var n=parseFloat(e[0]);if(isNaN(n)&&e[0]>=t())return[e];if(n>=parseFloat(t()))return[e[0]]}catch(r){}}}},_a=n(161),Da=new W.a.Time("32n");Object(Ca.a)("sequencer.list",{list:"",slot:"",speed:""},"",function(){return 2},{inlets:3,outlets:["trigger-routing","playhead"]});var Fa={"sequencer.list":function(e,t,n){e.needsTick=!0;var r=[],a=new F.a;return function(i){var s=Object(_a.a)(i),o=s[0],c=s.slice(1);if(o===v.n){var u=function(){for(var i=Object(ea.a)(c,2),s=i[0],o=i[1],u=s*(n()||1),l=(s+1)*(n()||1),f=[],h=u;h<l;h++)if(r[h%r.length]){var p=Da.toSeconds()*(h-u)/(l-h),d=o+p,m=new Ve.a(a,d,s,1+(t()||0));f.push(m),setTimeout(function(){e.sendMessage(e.outputByNumber(1),u%r.length)},1e3*p)}return{v:[[v.p,f],u%r.length]}}();if("object"===typeof u)return u.v}else r=o}}};Object(Ca.a)("save.hook",{},"",function(){return 1},{});Object(Ca.a)("time.now",{"":""},"Returns the current time (w/ web audio time)",function(){return 1},{});Object(Ca.a)("time.bar",{"":""},"Returns the time (w/ web audio time) in a bar (based on current bpm)",function(){return 1},{});var La={"time.now":function(e){return function(e){return Object(ea.a)(e,1)[0],0===W.a.Master.context.currentTime?(new Date).getTime()/1e3:W.a.Master.context.currentTime}},"time.bar":function(e){return function(e){return Object(ea.a)(e,1)[0],32*new W.a.Time("32n").toSeconds()}}};Object(Ca.a)("sign",{x:""},"Returns +1 if positive, -1 if negative",function(){return 1},{});Object(Ca.a)("signedDedupe",{x:""},"Passes if signs changed",function(){return 1},{});var Ba={sign:function(e){return function(e){return Object(ea.a)(e,1)[0]>=0?1:-1}},signedDedupe:function(e){var t=void 0;return function(e){var n=Object(ea.a)(e,1)[0],r=n>=0?1:-1;if(r!==t)return t=r,[n];t=r}}},za=n(262),Ja=n.n(za);Object(Ca.a)("abi.encode",{},"",function(){return 1},{});var Va=n(117);function Ha(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ua=function(e){Object(u.a)(n,e);var t=Ha(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newInlet("loop",function(e){var t=Object(ea.a)(e,1)[0];return r.onLoop(t)},"float"),r.newInlet("choose preset",function(e){var t=Object(ea.a)(e,1)[0];return r.onPreset(t)},"float"),r.presets=[],r.newPreset(),r}return Object(o.a)(n,[{key:"track",get:function(){return this._track},set:function(e){this._track=e,this.applyLoop()}},{key:"loopStart",get:function(){return this.currentPreset.loopStart},set:function(e){this.currentPreset.loopStart=e,this.applyLoop()}},{key:"loopLength",get:function(){return this.currentPreset.loopLength},set:function(e){this.currentPreset.loopLength=e,this.applyLoop()}},{key:"applyLoop",value:function(){this.track&&(this.track.loopStart=this.loopStart,this.track.loopLength=this.loopLength,this.track.isLooping=this.isLooping)}},{key:"newPreset",value:function(){this.presets.push({loopStart:0,loopLength:8}),this.currentPreset=this.presets[this.presets.length-1]}},{key:"onLoop",value:function(e){this.isLooping=e,this.applyLoop()}},{key:"onPreset",value:function(e){this.currentPreset=this.presets[e%this.presets.length]}},{key:"getJson",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var i=(e=Object(ne.a)(Object(f.a)(n.prototype),"getJson",this)).call.apply(e,[this].concat(r));return i.presets=this.presets,i.track=this.track.trackNumber,i.isLooping=this.track.isLooping,i}},{key:"fromJson",value:function(e){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e),this.onLoop(e.isLooping),void 0!==e.track&&(this.track=this.sequencerEngine.tracks[e.track]),e.presets&&(this.presets=e.presets,this.currentPreset=this.presets[0],this.applyLoop())}}]),n}(Va.a);Object(Ca.a)("tr.loop",{looping:"",trackNumber:"",loopStart:"",loopLength:""},"",function(){return 1},{inletTypes:["number","number","number","number"],inlets:4,isHot:!0});Object(Ca.a)("tr.loopUI",{},"",function(){return 0},{inlets:0});var Ga=n(130),Wa=new Ga.a;Object(Ca.a)("svg.extractColors",{"svg string":""},"Extracts all the colors from an svg element, including the gradients");var Ka={"svg.extractColors":function(){return function(e){for(var t=Object(ea.a)(e,1)[0],n=[],r=0,a=['stop-color="','fill="','fill="'];r<a.length;r++)for(var i=a[r],s=t.indexOf(i);s>-1;){var o=(t=t.slice(i.length+s)).indexOf('"'),c=t.slice(0,o);c.startsWith("hsl")?c=Wa.hslToHex(c):(c.startsWith("url")||"transparent"===c)&&(c=null),c&&n.push(c),s=t.indexOf(i)}return[n]}}},Qa=n(298);Object(Ca.a)("random.seed",{seed:""},"Generates a pseudo-random number based on seed");var Za={"random.seed":function(e){var t=void 0;return function(e){var n=Object(ea.a)(e,1)[0];return n!==t&&(Object(Qa.a)("0x"+n.toString(16)),t=n),Object(Qa.b)()}}},Ya=function(e,t,n){return[e*Math.cos(n)+t*Math.sin(n),t*Math.cos(n)-e*Math.sin(n)]};Object(Ca.a)("lengthCoord",{"[x,y]":""},"Returns length of vector from center");var Xa=function(e){var t=Object(ea.a)(e,2),n=t[0],r=t[1];return Math.sqrt(Math.pow(n,2)+Math.pow(r,2))},$a=function(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))};Object(Ca.a)("distance",{"[x1,y1]":"","[x2,y2]":""},"Returns length of vector from center",function(){return 1},{isHot:!0,inlets:2});Object(Ca.a)("quadrantFilter",{"[index, x, y]":"","quadrant signs list":""},"Returns length of vector from center",function(){return 1},{inlets:2});Object(Ca.a)("quadrantLength",{"[x, y]":""},"Returns length of vector from center by quadrant",function(){return 1},{inlets:1});Object(Ca.a)("quadrant.coord",{"[a,b,c,d]":""},"Returns 2-component vector based on 4-component vector",function(){return 1},{inlets:1});Object(Ca.a)("quadrant.triangles",{"[x,y]":""},"Returns 2-component vector based on 4-component vector",function(){return 1},{inlets:1});Object(Ca.a)("rotate2D",{xy:"",angle:""},"rotate by angle",function(){return 1},{inlets:2});var ei=function(e,t){return e.map(function(e){return e*t})};Object(Ca.a)("coord.limit",{coordinate:"","minimum distance":""},"Passes message if the distance is at least minimum from last",function(){return 1},{inlets:2});var ti={"coord.limit":function(e,t){var n=void 0;return function(e){var r=Object(ea.a)(e,1)[0];return 0===r[0]&&0===r[1]?(n=r,[r]):n?$a(n[0],n[1],r[0],r[1])>t()?(n=r,[r]):void 0:(n=r,[r])}},"quadrant.triangles":function(e){return function(e){var t=Object(ea.a)(e,1),n=Object(ea.a)(t[0],2),r=n[0],a=n[1],i=Math.abs(r),s=[0,0,0,0];if(Math.abs(a)>=i){var o=(r- -1)/2;s=a>0?ei([o,0,0,1-o],a):ei([0,o,1-o,0],Math.abs(a))}else if(r>0){var c=(a- -1)/2;s=ei([c,1-c,0,0],r)}else if(r<0){var u=(a- -1)/2;s=ei([0,0,1-u,u],Math.abs(r))}return[s]}},quadrantFilter:function(e,t){return function(e){for(var n=Object(ea.a)(e,1),r=Object(ea.a)(n[0],3),a=r[0],i=r[1],s=r[2],o=[],c=0;c<t().length;c+=2)o.push([t()[c],t()[c+1]]);var u=o[a];if(u&&!(u[0]>0&&i<0)&&!(u[1]>0&&s<0)&&!(u[0]<0&&i>0)&&!(u[1]<0&&s>0))return[[i,s]]}},quadrantLength:function(e){return function(e){var t=Object(ea.a)(e,1),n=Object(ea.a)(t[0],2),r=n[0],a=n[1],i=Xa([r,a]);return r>0&&a>0?[[i,0,0,0]]:r>0&&a<0?[[0,0,0,i]]:r<0&&a<0?[[0,0,i,0]]:r<0&&a>0?[[0,i,0,0]]:[[0,0,0,0]]}},"quadrant.coord":function(e){return function(e){var t=Object(ea.a)(e,1),n=Object(ea.a)(t[0],4),r=n[0],a=n[1],i=n[2],s=n[3],o=Math.sqrt(Math.pow(r,2),2),c=Math.sqrt(Math.pow(a,2),2),u=Math.sqrt(Math.pow(i,2),2),l=Math.sqrt(Math.pow(s,2),2),f=[o,o],h=[c,-c],p=[-u,-u],d=[-l,l];return[[f[0]+h[0]+p[0]+d[0],f[1]+h[1]+p[1]+d[1]]]}},distance:function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(Array.isArray(n)&&Array.isArray(t())){var r=Object(ea.a)(n,2),a=r[0],i=r[1],s=t(),o=Object(ea.a)(s,2),c=o[0],u=o[1];return $a(a,i,c,u)}}},rotate2D:function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];return[Ya(n[0],n[1],t())]}}};Object(Ca.a)("boundFilter",{coord:"",x:"",y:""},"Passes if coord is within bound",function(){return 1},{inlets:3});var ni=n(1826);Object(Ca.a)("three.text",{text:"",x:"",y:"",color:"",size:"",opacity:"",font:""},"Outputs text in three js to be added to scene",function(){return 1},{isHot:!0,inlets:7});var ri={"three.text":function(e,t,n,r,a,i,s){var o=new ni.a,c=1;return Object(Ma.d)("canvas.size",function(e){var t=Object(ea.a)(e,2),n=t[0],r=t[1];c=r/n}),function(e){var u=Object(ea.a)(e,1)[0],l=r()?parseInt(r().replace(/^#/,""),16):16777215,f=t()||0,h=n()||0;return o.text=u,o.position.x=f*c,o.position.y=h,o.strokeOpacity=1,o.position.z=.1,o.color=l,o.align="center",o.fontSize=a()||.1,void 0!==i()&&(o.strokeOpacity=i(),o.fillOpacity=i()),s()?o.font=s():o.font="/stem.woff",o.sync(function(){}),[o]}}},ai=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var i=[];return function(n){var a=Object(ea.a)(n,2),s=a[0],o=a[1];Array.isArray(s)&&(o=s[1],s=s[0]);var c=o||s;if("node"===s)return t;if("disconnect"!==s){var u=void 0;return c&&!i.includes(c)&&(c.connect&&(c.connect(t),i.push(c)),u=[t]),e([c]),r.forEach(function(e){var t=Object(ea.a)(e,2);return(0,t[0])([(0,t[1])()])}),u}i.includes(c)&&(c.disconnect(t),i=i.filter(function(e){return e!==c}))}},ii=function(e,t){var n=[],r=function(r){var a=e[r];"string"===typeof a&&(a=function(t){return e[r]=t});var i=ai(function(e){var n=Object(ea.a)(e,1)[0];if("function"===typeof a&&isNaN(n)&&void 0!==n&&a(n),void 0!==n&&!isNaN(n)){t[r]();a.value=n}},a);n.push([i,t[r]])};for(var a in t)r(a);return[e].concat(n)};Object(Ca.a)("speakers~",{source:""},"speakers",function(){return 1},{isHot:!0});Object(Ca.a)("osc~",{trigger:"bang triggers",frequency:"frequency","osc type":"oscillator type"},"basic oscillator",function(){return 1},{inlets:3,isHot:!0});Object(Ca.a)("gain~",{source:"",level:"",rampTime:""},"plays buffer",function(){return 1},{isHot:!0,inlets:3});Object(Ca.a)("effect~",{source:"source",name:"effect name"},"effect",function(){return 1},{inlets:2,isHot:!0});Object(Ca.a)("filter~",{source:"source",cutoff:"cutoff",resonance:"resonance",type:"type"},"filter",function(){return 1},{inlets:4,isHot:!0});Object(Ca.a)("trx.out~",{trackNumber:"source"},"Sends output of track out from track into here",function(){return 1},{inlets:1,isHot:!0});Object(Ca.a)("trx.in~",{source:"source",trackNumber:"source"},"Sends output of node into the track",function(){return 1},{inlets:2,isHot:!0});Object(Ca.a)("parameter.in~",{source:"source",id:"id"},"filter",function(){return 0},{inlets:2,isHot:!0});Object(Ca.a)("parameter.out~",{source:"source",id:"id"},"filter",function(){return 1},{inlets:2,isHot:!0});var si={"effect~":function(e,t){e.needsHotReload=!0,e.needsDisconnect=!0;var n=new W.a.Gain(1),r=new W.a.Gain(1),a=void 0;return function(e,t,n){var r=[];return function(a){var i=Object(ea.a)(a,2),s=i[0],o=i[1];Array.isArray(s)&&(o=s[1],s=s[0]);var c=o||s;if("node"===s)return t;if("disconnect"!==s){var u=void 0;return c&&!r.includes(c)&&(c.connect&&(c.connect(t),r.push(c)),u=[n]),e([c]),u}r.includes(c)&&(c.disconnect(t),r=r.filter(function(e){return e!==c}))}}(function(n){Object(ea.a)(n,1)[0];var i=t();if(i=i.replaceAll("-"," "),!a||a.name!==i){var s=J.b[i];s&&(a=s(e.sequencerEngine),r.connect(a.effectNode),a.connect(r),e.audioEffect=a)}},n,r)},"speakers~":function(e){e.needsHotReload=!0,e.needsDisconnect=!0;var t=ii(e.sequencerEngine.channelMixer.masterChannel.input),n=Object(ea.a)(t,1)[0];return ai(function(){return 0},n)},"gain~":function(e,t,n){e.needsHotReload=!0,e.needsDisconnect=!0;var r=ii(new W.a.Gain(1),{gain:t}),a=Object(_a.a)(r),i=a[0],s=a.slice(1);return console.log("GAIN INIT",i,s),ai.apply(void 0,[function(){},i].concat(Object(h.a)(s)))},"osc~":function(e,t,n){e.needsHotReload=!0,e.needsDisconnect=!0;var r=ii(W.a.Master.context._context.createOscillator(),{frequency:t,type:n}),a=Object(_a.a)(r),i=a[0],s=a.slice(1),o=!1;return ai.apply(void 0,[function(e){Object(ea.a)(e,1)[0],o||(console.log("STARTING OSC",i),i.start(),o=!0)},i].concat(Object(h.a)(s)))},"filter~":function(e,t,n,r){e.needsHotReload=!0,e.needsDisconnect=!0;var a=ii(W.a.Master.context._context.createBiquadFilter(),{frequency:t,Q:n,type:r}),i=Object(_a.a)(a),s=i[0],o=i.slice(1);return ai.apply(void 0,[function(e){Object(ea.a)(e,1)[0]},s].concat(Object(h.a)(o)))},"trx.in~":function(e,t){e.needsHotReload=!0,e.needsDisconnect=!0;var n=ii(new W.a.Gain(1),{}),r=Object(_a.a)(n),a=r[0],i=r.slice(1),s=void 0;return ai.apply(void 0,[function(n){Object(_a.a)(n);var r=t()||0;e.sequencerEngine.tracks[r]&&r!==s&&(a.connect(e.sequencerEngine.tracks[r].gainNode),console.log("connecting node to track=",e.sequencerEngine.tracks[r]),void 0!==s&&a.disconnect(e.sequencerEngine.tracks[s].gainNode),s=r)},a].concat(Object(h.a)(i)))},"trx.out~":function(e){e.needsHotReload=!0,e.needsDisconnect=!0;var t=ii(new W.a.Gain(1),{}),n=Object(_a.a)(t),r=n[0],a=n.slice(1),i=void 0;return ai.apply(void 0,[function(t){var n=Object(ea.a)(t,1)[0];e.sequencerEngine.tracks[n]&&n!==i&&(e.sequencerEngine.tracks[n].muteableNode.connect(r),void 0!==i&&e.sequencerEngine.tracks[i].muteableNode.disconnect(r),i=n)},r].concat(Object(h.a)(a)))},"parameter.in~":function(e,t){e.needsHotReload=!0,e.needsDisconnect=!0;var n,r=ii(new W.a.Gain(1),{}),a=Object(_a.a)(r),i=a[0],s=a.slice(1);return ai.apply(void 0,[function(r){Object(ea.a)(r,1)[0],console.log("parameter_in called"),n||(n=e.sequencerEngine.idToParameter[t()]).audioParam&&i.connect(n.audioParam)},i].concat(Object(h.a)(s)))},"parameter.out~":function(e,t){e.needsHotReload=!0,e.needsDisconnect=!0;var n,r=ii(new W.a.Gain(1),{}),a=Object(_a.a)(r),i=a[0],s=a.slice(1);return ai.apply(void 0,[function(r){Object(ea.a)(r,1)[0],n||(n=e.sequencerEngine.idToParameter[t()]).audioParam&&n.audioParam.connect(i)},i].concat(Object(h.a)(s)))}},oi=new Ga.a;Object(Ca.a)("publish",{data:"",type:""},"Publishes a message to a queue that can be subscribed to",function(){return 1},{isHot:!0,inlets:2});Object(Ca.a)("subscribe",{bang:"",type:""},"Subscribes to a message",function(){return 1},{isHot:!0,inlets:2});var ci=function(e){for(var t=[],n=e.subSequence;!n.isRoot();)t.push(n),n=n.subSequence;return t};function ui(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return li(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return li(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function li(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var fi=new Ga.a;Object(Ca.a)("epublish",{data:"",type:""},"Publishes a message to a queue that can be subscribed to",function(){return 1},{isHot:!0,inlets:2});Object(Ca.a)("esubscribe",{bang:"",type:""},"Subscribes to a message (bounded to subpatch)",function(){return 1},{isHot:!0,inlets:2});function hi(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return pi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pi(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function pi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("sfilter",{msg:"",type:"",field:""},"Filters messages coming in based on a type and (field) subscribed to",function(){return 1},{isHot:!0,inlets:3});Object(Ca.a)("esfilter",{msg:"",type:"",field:""},"Filters messages coming in based on a type and (field) subscribed to (subpatch encapsuated version)",function(){return 1},{isHot:!0,inlets:3});var di={publish:function(e,t){e.needsHotReload=!0;var n=void 0;return function(r){var a=Object(ea.a)(r,1)[0];Object(Ma.b)(t(),a),t()!==n&&(e.attributes["primary-color"]=oi.getColorForHash(t())),n=t()}},subscribe:function(e,t){e.needsLoad=!0,e.needsHotReload=!0;var n=void 0,r=function t(r){e.outlets?e.sendMessage(e.outputByNumber(0),r):Object(Ma.e)(n,t)};return function(a){if(Object(ea.a)(a,1)[0],t()!==n&&(n&&Object(Ma.e)(n,r),n=t(),Object(Ma.d)(t(),r),e.attributes["primary-color"]=oi.getColorForHash(t())),t()){var i=Object(Ma.c)(t());void 0!==i[0]&&r(i[0])}}},epublish:function(e,t){e.needsHotReload=!0;var n=void 0;return function(r){var a=Object(ea.a)(r,1)[0];Object(Ma.b)(e.subSequence.id+"."+t(),a),t()!==n&&(e.attributes["primary-color"]=fi.getColorForHash(t())),n=t()}},esubscribe:function(e,t){e.needsLoad=!0;var n=void 0,r=ci(e).map(function(e){return e.id+"."}),a=function t(a){e.outlets?e.sendMessage(e.outputByNumber(0),a):r.forEach(function(e){return Object(Ma.e)(e+n,t)})};return function(i){if(Object(ea.a)(i,1)[0],t()!==n&&(n&&r.forEach(function(e){return Object(Ma.e)(e+n,a)}),n=t(),r.forEach(function(e){Object(Ma.d)(e+t(),a)}),e.attributes["primary-color"]=fi.getColorForHash(t())),t()){var s,o=ui(r);try{for(o.s();!(s=o.n()).done;){var c=s.value,u=Object(Ma.c)(c+t());void 0!==u[0]&&a(u[0])}}catch(l){o.e(l)}finally{o.f()}}}},sfilter:function(e,t,n){var r=function(t){e.sendMessage(e.outputByNumber(0),t)},a=function(e,t){var a=n();a?e[a]&&r(t):e&&r(t)},i=void 0;return function(e){var n=Object(ea.a)(e,1)[0];if(i&&Object(Ma.e)(t(),i),t()){i=function(e){a(e,n)},Object(Ma.d)(t(),i);var r=Object(Ma.c)(t());void 0!==r[0]&&a(r[0],n)}t()}},esfilter:function(e,t,n){var r=function(t){e.sendMessage(e.outputByNumber(0),t)},a=function(e,t){var a=n();a?e[a]&&r(t):e&&r(t)},i=void 0;return function(n){var r=Object(ea.a)(n,1)[0],s=ci(e).map(function(e){return e.id+"."});if(i&&s.forEach(function(e){return Object(Ma.e)(e+t(),i)}),t()){i=function(e){a(e,r)},s.forEach(function(e){return Object(Ma.d)(e+t(),i)});var o,c=hi(s);try{for(c.s();!(o=c.n()).done;){var u=o.value,l=Object(Ma.c)(u+t());void 0!==l[0]&&a(l[0],r)}}catch(f){c.e(f)}finally{c.f()}}t()}}},vi=n(175),mi=n(156),yi=n(162),bi=n(169),gi=n(140),Oi=n(302);Object(Ca.a)("gl.eq",{a:"",b:""},"Fuck",function(){return 1},{inletTypes:["float","float"],type:function(){return"bool"},isHot:!0,inlets:2});var ki=function(e,t){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"(".concat(Object(gi.b)(r[0])," == ").concat(Object(gi.b)(r[1]),")")},t))};Object(Ca.a)("gl.gt",{a:"",b:""},"Fuck",function(){return 1},{inletTypes:["float","float"],type:function(){return"bool"},isHot:!0,inlets:2});Object(Ca.a)("gl.gte",{a:"",b:""},"Fuck",function(){return 1},{inletTypes:["float","float"],type:function(){return"bool"},isHot:!0,inlets:2});Object(Ca.a)("gl.lt",{a:"",b:""},"Fuck",function(){return 1},{inletTypes:["float","float"],type:function(){return"bool"},isHot:!0,inlets:2});Object(Ca.a)("gl.lte",{},"Fuck",function(){return 1},{inletTypes:["float","float"],type:function(){return"bool"},isHot:!0,inlets:2});var ji=function(e,t){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"(".concat(Object(gi.b)(r[0])," <= ").concat(Object(gi.b)(r[1]),")")},t))};Object(Ca.a)("gl.and",{a:"",b:""},"Fuck",function(){return 1},{inletTypes:["bool","bool"],type:function(){return"bool"},isHot:!0,inlets:2});Object(Ca.a)("gl.or",{},"Fuck",function(){return 1},{inletTypes:["bool","bool"],type:function(){return"bool"},isHot:!0,inlets:2});Object(Ca.a)("gl.cond",{condition:"",thenStatement:"",elseStatement:""},"Fuck",function(){return 1},{inletTypes:["bool",Object(mi.j)("float","vec2","vec3","vec4"),Object(mi.j)("float","vec2","vec3","vec4")],type:function(){return arguments.length<=1?void 0:arguments[1]},isHot:!0,inlets:3});var wi=function(e,t,n){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(r){var a=Object(bi.a)(r,t,n);return e.flash(),"(\n    ".concat(Object(gi.b)(a[0])," ? \n        ").concat(Object(gi.b)(a[1])," : \n        ").concat(Object(gi.b)(a[2]),")")},t,n))};Object(Ca.a)("gl.pass",{},"Fuck",function(){return 1},{isHot:!0,inlets:3});Object(Ca.a)("gl.switch",{switchNumber:""},"switches based on argument",function(){return 1},{inlets:function(e){return e+1}});Object(Ca.a)("gl.anyLTE",{"condition list":"",list:""},"Returns 1 if any of the elements in first inlet is below the 2nd",function(){return 1},{inlets:2});var xi=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(0===r.length)return 0;var i=e(t,n.slice(1),r.slice(1),a+1),s=r[0],o=n[0];return wi(t,function(){return 1},function(){return i})([ji(t,function(){return o})([s])])};Object(Ca.a)("gl.listSwitch",{list:""},"Returns 1 if any of the elements in first inlet is below the 2nd",function(){return 1},{inlets:2});var Si=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(1===r.length)return r[0]();var i=e(t,n,r.slice(1),a+1),s=a;return wi(t,r[0],function(){return i})([ki(t,function(){return s})([n])])},Pi={"gl.switch":function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(t){var r=Object(ea.a)(t,1)[0];return Si(e,r,n.filter(function(e){return null!==e()&&void 0!==e()}),0)}},"gl.cond":wi,"gl.gt":function(e,t){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"(".concat(Object(gi.b)(r[0])," > ").concat(Object(gi.b)(r[1]),")")},t))},"gl.gte":function(e,t){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"(".concat(Object(gi.b)(r[0])," >= ").concat(Object(gi.b)(r[1]),")")},t))},"gl.lt":function(e,t){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"(".concat(Object(gi.b)(r[0])," < ").concat(Object(gi.b)(r[1]),")")},t))},"gl.lte":ji,"gl.and":function(e,t){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"(".concat(Object(gi.b)(r[0])," && ").concat(Object(gi.b)(r[1]),")")},t))},"gl.or":function(e,t){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"((".concat(Object(gi.b)(r[0]),") || (").concat(Object(gi.b)(r[1]),"))")},t))},"gl.eq":ki,"gl.pass":function(e,t,n){return e.needsHotReload=!0,Object(yi.a)(function(r){var a=Object(bi.a)(r,t,n);return e.flash(),"(".concat(Object(gi.b)(a[1])," == ").concat(Object(gi.b)(a[2])," ? ").concat(Object(gi.b)(a[0])," : 0.0)")},t,n)},"gl.listSwitch":function(e,t){return function(n){var r=Object(ea.a)(n,1)[0];if(t())return Si(e,r,t().map(function(e){return function(){return e}}),0)}},"gl.anyLTE":function(e,t){return function(n){var r=Object(ea.a)(n,1)[0];if(t()&&r)return xi(e,r,t(),0)}}},Ei={depth:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n[0],i=n[1];if(e.dimensionFactors[a]=[0,0,i],e.dimensions[a]){var s=e.dimensions[a][2],o=Object(ea.a)(e.dimensionsUniforms[a],3);o[0],o[1],(0,o[2])([s*i])}}};function Ti(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}Object(Ca.a)("sdf.directionalScale",{"sdf list":"",coord:""},"Translate group of sdfs",function(){return 1},{isHot:!0,inlets:3});var Ai={"sdf.directionalScale":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(Array.isArray(n)&&t()&&Array.isArray(t())){var r=t(),a=Object(ea.a)(r,2),i=a[0],s=a[1];return[n.map(function(e){var t=i,n=s;if(Array.isArray(e)){var r=Object(h.a)(e);r.id=e.id;var a=Object(ea.a)(r,3),o=(a[0],a[1]),c=a[2],u=1,l=1;return l=c>0?1+(n*=n>0?1.8:.7):n>0?1-.7*n:1-1.8*n,u=o>0?1+(t*=t>0?1.8:.7):t>0?1-.7*t:1-1.8*t,r[1]=o*u,r[2]=c*l,r}}).filter(function(e){return e})]}}}},Mi=n(400),Ri=n(216),Ci=n(232);Object(Ca.a)("gl.length",{vector:""},"Returns the gl expression that calculates length of vector",function(){return 1},{type:function(e){return"float"},inletTypes:Object(mi.k)(Object(mi.j)("vec2","vec3")),inlets:1});Object(Ca.a)("gl.sdRoundBox",{position:"",size:"",cornerRadius:""},"Fuck",function(){return 1},{isHot:!0,inlets:3});Object(Ca.a)("gl.sdRoundRect",{position:"",sizeVec:"",cornerRadius:""},"Fuck",function(){return 1},{isHot:!0,inlets:3});Object(Ca.a)("gl.circle",{position:"",radius:""},"Creates circle sdf for given radius and position",function(){return 1},{isHot:!0,inlets:2});Object(Ca.a)("gl.sdfMerge",{sdf:""},"Merges sdfs given as arguments",function(){return 1},{isHot:!0,inlets:function(e){return e}});var Ni=function e(t){if(0===t.length)return Object(gi.b)(0);var n=t[0];return 1===t.length?Object(gi.b)(n):"min(".concat(Object(gi.b)(n),", ").concat(e(t.slice(1)),")")};Object(Ca.a)("gl.between",{number:"",a:"",b:""},"Returns 1 if value is between a and b-- 0 otherwise",function(){return 1},{inletTypes:Object(mi.k)("float"),type:function(){return"float"},isHot:!0,inlets:3});var qi=function(e,t,n){return Object(Ci.a)(Object(yi.a)(function(e){var r=Object(bi.a)(e,t,n);return"(".concat(Object(gi.b)(r[0])," >= ").concat(Object(gi.b)(r[1])," && ").concat(Object(gi.b)(r[0])," < ").concat(Object(gi.b)(r[2])," ? 1.0 : 0.0)")},t,n),e,t,n)};Object(Ca.a)("gl.notBetween",{number:"",a:"",b:""},"Returns 0 if value is between a and b-- 1 otherwise",function(){return 1},{inletTypes:Object(mi.k)("float"),type:function(){return"float"},isHot:!0,inlets:3});var Ii=Object(p.a)({"gl.length":function(e){return e.needsHotReload=!0,Object(Ci.a)(Object(Mi.a)(Object(yi.a)(function(t){var n=Object(bi.a)(t);return e.flash(),"length(".concat(Object(gi.b)(n[0]),")")}),function(e){var t=Object(ea.a)(e,2),n=t[0],r=t[1];return Math.sqrt(n*n+r*r)}),e)},"gl.between":qi,"gl.notBetween":function(e,t,n){return Object(Ci.a)(Object(yi.a)(function(e){var r=Object(bi.a)(e,t,n);return"(".concat(Object(gi.b)(r[0])," >= ").concat(Object(gi.b)(r[1])," && ").concat(Object(gi.b)(r[0])," < ").concat(Object(gi.b)(r[2])," ? 0.0 : 1.0)")},t,n),e,t,n)},"gl.sdRoundBox":function(e,t,n){return e.needsHotReload=!0,Object(yi.a)(function(r){var a=Object(bi.a)(r,t,n);return e.flash(),"sdRoundBox(".concat(Object(gi.b)(a[0]),", vec2(").concat(Object(gi.b)(a[1]),"), (").concat(Object(gi.b)(a[2]),"))")},t,n)},"gl.sdRoundRect":function(e,t,n){return e.needsHotReload=!0,Object(yi.a)(function(r){var a=Object(bi.a)(r,t,n);return e.flash(),"sdRoundBox(".concat(Object(gi.b)(a[0]),", ").concat(Object(gi.b)(a[1]),", (").concat(Object(gi.b)(a[2]),"))")},t,n)},"gl.sdfMerge":function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.needsHotReload=!0,yi.a.apply(void 0,[function(t){var r=[t].concat(Object(h.a)(n.filter(function(e){return 0!==e()&&void 0!==e()}).map(function(e){return e()}))),a=bi.a.apply(void 0,Object(h.a)(r));return Ni(a),e.flash(),Ni(a)}].concat(n))},"gl.circle":function(e,t){return e.needsHotReload=!0,Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"length((gl_FragCoord.xy-vec2(width, height))/height - ".concat(Object(gi.b)(r[0]),") - ").concat(Object(gi.b)(r[1]))},t)}},Ai),_i=n(233);Object(Ca.a)("gl.uniform",{value:"",name:"",skipRender:""},"Creates a new uniform variable with value from left-inlet, in GLSL.",function(){return 1},{tags:"GLSL",inlets:3});var Di=function(e,t,n){e.needsHotReload=!0,e.needsLoad=!0;var r={};e.uniforms=r;var a={},i=void 0;return function(s,o){var c=Object(ea.a)(s,1)[0],u=!!n&&n();if("start"===c){if(void 0!==i)return void(c=i);c=0}"bang"===c&&(c=0);var l=e.id?t()+"_"+e.id.replaceAll("-",""):t();l=l.replaceAll("-","_");var f=Object(_i.c)(c),h=void 0===i||"object"===typeof i||i!==c;if(i=c,f,r[l]){r[l].value=c;var p=r[l].update||window.fallBackUpdate[l];if(p&&h){if(p(c,u),!o)return}else if(p&&!h&&!o)return}else r[l]={value:c};return a.code=l,a.uniforms=r,a.hashCode=Object(Ri.a)(a.code+f),a.type=f,a.model=function(){return i},a}};Object(Ca.a)("gl.variable",{value:"",name:"",type:""},"Creates a new uniform variable with value from left-inlet, in GLSL.",function(){return 1},{tags:"GLSL",inlets:3});var Fi=function(e,t,n){e.needsHotReload=!0;var r={};return function(a){var i=Object(ea.a)(a,1)[0],s=t()+e.id.replaceAll("-","");return r.code=s,i&&i.uniforms?r.uniforms=i.uniforms:r.uniforms={},i&&i.functions&&(r.functions=i.functions),i&&i.variables?r.variables=Object(p.a)({},i.variables):r.variables={},i&&i.closure&&(r.closure=Object(p.a)({},i.closure)),r.variables[s]={code:i&&i.code?i.code:Object(gi.b)(i),type:n()},r.type=n(),r.hashCode=Object(Ri.a)(r.code),e.flash(),i&&i.model&&(r.model=i.model),r}};Object(Ca.a)("gl.if",{value:"",name:"",type:"",condition:"",defaultValue:""},"Creates a new uniform variable with if statement value from left-inlet, in GLSL.",function(){return 1},{isHot:!0,tags:"GLSL",inlets:5});var Li=function(e,t,n,r,a){e.needsHotReload=!0;var i={};return function(s){var o=Object(ea.a)(s,1)[0],c=t()+e.id.replaceAll("-","");return i.code=c,o&&o.uniforms?i.uniforms=o.uniforms:i.uniforms={},o&&o.functions&&(i.functions=o.functions),o&&o.variables?i.variables=Object(p.a)({},o.variables):i.variables={},o&&o.closure&&(i.closure=Object(p.a)({},o.closure)),r()&&r().variables&&(i.variables=Object(p.a)({},i.variables,r().variables)),a()&&a().variables&&(i.variables=Object(p.a)({},i.variables,a().variables)),r()&&r().uniforms&&(i.uniforms=Object(p.a)({},i.uniforms,r().uniforms)),a()&&a().uniforms&&(i.uniforms=Object(p.a)({},i.uniforms,a().uniforms)),r()&&r().functions&&(i.functions=Object(p.a)({},i.functions,r().functions)),a()&&a().functions&&(i.functions=Object(p.a)({},i.functions,a().functions)),i.variables[c]={code:o&&o.code?o.code:Object(gi.b)(o),type:{condition:r()?r().code:1,type:n(),defaultValue:a()&&a().code||"0.0"}},i.hashCode=Object(Ri.a)(i.code),e.flash(),i.type=n(),i}},Bi=n(343),zi=n(843),Ji=function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.2;return Array.isArray(r)||(r=[r]),n&&1===t.length?"scene = vec3(".concat(t[0],", 0.0)"):0===t.length?"":function(e,t,n,r,a,i){if(0===r||!r){var s="\n  vec2 sdfVec".concat(i," = ").concat(e,";\n  if (sdfVec").concat(i,".x < ").concat(n?t:"scene",".x) {\n    scene = vec3(sdfVec").concat(i,", 0.0);\n  }\n");return n&&(s+="\n  else {\n    scene = vec3(".concat(t,", 0.0);\n  }\n")),s}if(1===r){var o="\n  if (".concat(e,".x < ").concat(n?t:"scene",".x) {\n    scene = vec3(").concat(t,", 0.0);\n  }\n");return n&&(o+="\n  else {\n    scene = vec3(".concat(e,", 0.0);\n  }\n")),o}return 2===r?"\n    float addend = 0.0;\n  if (-".concat(e,".x > scene.x) {\n    scene = vec3(-").concat(e,".x + addend, ").concat(e,".y, 0.0);\n  } else {\n    scene = vec3(scene.x + addend, scene.y, 0.0);\n  }\n"):4===r?n?Vi(e,t,a,i):Vi(t,e,a,i):3===r?n?Hi(e,t,a,i):Hi(t,e,a,i):""}(t[0],n?t[1]:"scene",n,r&&r[0],a,t.length)+(1===t.length?"":e(n?t.slice(2):t.slice(1),!1,r&&r.slice(1),a))},Vi=function(e,t,n,r){var a="sdf1"+r,i="sdf2"+r;return""+"\n    vec2 ".concat(a," = ").concat("scene"===e?"scene.xy":e,";\n    vec2 ").concat(i," = ").concat(t,";\n    float d1").concat(r," = ").concat(i,".x;\n    float d2").concat(r," = ").concat(a,".x;\n    float k").concat(r," = ").concat(n,";\n    float h").concat(r," = max(k").concat(r,"-abs(-d1").concat(r,"-d2").concat(r,"),0.0);\n    float addend").concat(r," = h").concat(r,"*h").concat(r,"*0.25/k").concat(r,";\n  if (-").concat(i,".x > ").concat(a,".x) {\n    scene = vec3(-d1").concat(r," + addend").concat(r,", ").concat(i,".y + (1.0 - h").concat(r,"), 0.0);\n  } else {\n    scene = vec3(d2").concat(r," + addend").concat(r,", ").concat(a,".y + h").concat(r,", 0.0);\n  }")},Hi=function(e,t,n,r){var a="sdf1"+r,i="sdf2"+r;return""+"\n    vec2 ".concat(a," = ").concat("scene"===e?"scene.xy":e,";\n    vec2 ").concat(i," = ").concat(t,";\n    float d1").concat(r," = ").concat(i,".x;\n    float d2").concat(r," = ").concat(a,".x;\n    float k").concat(r," = ").concat(n,";\n\n    float h").concat(r," = max(k").concat(r,"-abs(d1").concat(r,"-d2").concat(r,"),0.0)/k").concat(r,";\n    float m").concat(r," = h").concat(r,"*h").concat(r,"*0.5;\n    float s").concat(r," = m").concat(r,"*k").concat(r,"*(1.0/3.0);\n\n  if (d1").concat(r," < d2").concat(r,") {\n    scene = vec3(d1").concat(r," - s").concat(r,", ").concat(i,".y, 1.0 - m").concat(r,");\n  } else {\n    scene = vec3(d2").concat(r," - s").concat(r,",  ").concat(a,".y, m").concat(r,");\n  }")},Ui=function(e){for(var t="",n=0;n<e.length;n++)t+="\nif (index == ".concat(Object(gi.b)(n),") {\n   return ").concat(e[n].position.code,";\n}\n");return t+="\nreturn vec2(0.0, 0.0);\n"};function Gi(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Wi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wi(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Wi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("gl.sdf",{position:"",type:"",sizeVec:"",cornerRadius:""},"Creates sdf for a type",function(){return 2},{isHot:!0,inlets:4});var Ki=function(e,t,n,r,a,i,s,o){e.needsHotReload=!0;var c=Object(S.uuid)().replaceAll("-","");return function(u){var l=Object(ea.a)(u,1)[0],f=Object(Bi.f)(t())?Object(gi.a)(l,t,n,r,a,i,s,o):Object(gi.a)(l,t,n,r,i,s,o),h=f.codes,p=f.functions,d=f.variables,v=f.uniforms;0===Object.keys(h[4]).length&&(h[4]=void 0),e.flash();h[6];var m,y,b="(1.0*gl_FragCoord.xy-vec2(width, height))/height",g=zi.a[h[1]];if(g){var O="sdf"+c;p[O]=g(h),"box"!==h[1]&&"sphere"!==h[1]||(b="vec3((1.0*gl_FragCoord.xy-vec2(width, height))/height, 0.0)"),m=function(e){return"".concat(O,"(").concat(e,")")},y="".concat(O,"(").concat(b,")")}return[{id:c,code:m,position:l,functions:p,variables:d,uniforms:v},{id:c,code:y,position:l,functions:p,variables:d,uniforms:v}]}};Object(Ca.a)("gl.sdfScene",{"list of sdfs":"",type:"",morph:"",offset:"","operations list":""},"Creates a scene out of all the sdfs");var Qi=function(e,t,n,r){return Ji(e.map(function(e){return e.code(t)}),!0,n,r.code?r.code:r)};Object(Ca.a)("gl.vec3",{x:"",y:"",z:""},"Creates a GLSL expression representing a 3-component vector, from each inlet",function(){return 1},{inletTypes:Object(mi.k)("float"),type:function(){return"vec3"},isHot:!0,tags:"GLSL",inlets:3});var Zi=function(e,t,n){return e.needsHotReload=!0,Object(Ci.a)(Object(yi.a)(function(r){var a=Object(bi.a)(r,t,n);return e.flash(),"(vec3(".concat(Object(gi.b)(a[0]),", ").concat(Object(gi.b)(a[1]),", ").concat(Object(gi.b)(a[2]),"))")},t,n),e,t,n)};Object(Ca.a)("gl.vec2",{x:"",y:""},"Creates a GLSL expression representing a 2-component vector, from each inlet",function(){return 1},{inletTypes:Object(mi.k)("float"),type:function(){return"vec2"},isHot:!0,tags:"GLSL",inlets:2});var Yi=function(e,t){return e.needsHotReload=!0,Object(Ci.a)(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"vec2(".concat(Object(gi.b)(r[0]),", ").concat(Object(gi.b)(r[1]),")")},t),e,t)};Object(Ca.a)("gl.vec4",{x:"",y:"",z:"",w:""},"Creates a GLSL expression representing a 4-component vector, from each inlet",function(){return 1},{inletTypes:Object(mi.k)("float"),type:function(){return"vec4"},isHot:!0,inlets:4,tags:"GLSL",connects:{object:"gl.fragColor"}});var Xi={"gl.vec2":Yi,"gl.vec3":Zi,"gl.vec4":function(e,t,n,r){return e.needsHotReload=!0,Object(Ci.a)(Object(yi.a)(function(a){var i=Object(bi.a)(a,t,n,r);return e.flash(),"vec4(".concat(Object(gi.b)(i[0]),", ").concat(Object(gi.b)(i[1]),", ").concat(Object(gi.b)(i[2]),", ").concat(Object(gi.b)(i[3]),")")},t,n,r),e,t,n,r)}};Object(Ca.a)("gl.mat3",{x:"",y:"",z:""},"Creates a GLSL expression representing a 3x3 matrix",function(){return 1},{inletTypes:["vec3","vec3","vec3"],type:"mat3",isHot:!0,tags:"GLSL",inlets:3});function $i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return es(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return es(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function es(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ts(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}window.MIN_SDF_VALUE=.0051;window._corner=1.25;var ns=function(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))},rs=function(e,t){var n=[(2*e[0]-t[0])/t[1],-(2*e[1]-t[1])/t[1]],r=window.offset_v||0;return n[1]+=r,n};function as(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var is=[mi.a,mi.c,mi.d,mi.e];Object(Ca.a)("gl.+",{a:"",args:""},"Merges sdfs given as arguments",function(){return 1},{inletTypes:Object(mi.k)(mi.j.apply(void 0,is)),type:_i.d,isHot:!0,inlets:function(e){return e+2}});var ss=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.needsHotReload=!0,e.typed(Object(Mi.a)(yi.a.apply(void 0,[function(t){var r=[t].concat(Object(h.a)(n.filter(function(e){return 0!==e()&&void 0!==e()}).map(function(e){return e()}))),a=bi.a.apply(void 0,Object(h.a)(r));return e.flash(),os(a)}].concat(n)),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return e+t},0)}))},os=function e(t){if(0===t.length)return Object(gi.b)(0);var n=t[0];return 1===t.length?Object(gi.b)(n):"(".concat(Object(gi.b)(n)," + ").concat(e(t.slice(1)),")")};Object(Ca.a)("gl.-",{x:"x",y:"y"},"Creates GLSL expression for subtraction",function(){return 1},{inletTypes:Object(mi.k)(mi.j.apply(void 0,is)),type:_i.d,tags:"GLSL",isHot:!0,inlets:2});Object(Ca.a)("gl.*",{x:"",y:""},"Creates GLSL expression for multiplication",function(){return 1},{inletTypes:Object(mi.k)(mi.j.apply(void 0,is)),type:_i.d,tags:"GLSL",isHot:!0,inlets:2});var cs=function(e,t){return e.needsHotReload=!0,Object(Ci.a)(Object(Mi.a)(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"(".concat(Object(gi.b)(r[0]),") * (").concat(Object(gi.b)(r[1]),")")},t),function(e,t){return Array.isArray(e)&&!Array.isArray(t)?e.map(function(e){return e*t}):Array.isArray(t)&&!Array.isArray(e)?t.map(function(t){return t*e}):Array.isArray(t)&&Array.isArray(e)?t.map(function(t,n){return t*e[n]}):e*t}),e,t)};Object(Ca.a)("gl./",{},"Fuck",function(){return 1},{inletTypes:Object(mi.k)(mi.j.apply(void 0,is)),type:_i.d,isHot:!0,inlets:2});function us(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ls=function(e){return!Array.isArray(e)};function fs(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return hs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hs(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function hs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ps(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function ds(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return vs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vs(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function vs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ms(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ys=function(e){Object(u.a)(n,e);var t=ms(n);function n(e){var r;return Object(s.a)(this,n),r=t.call(this,e),e.skipHotReload=!0,r.skipHotReload=!0,r.dimensionVecs={},r.positionVecs={},r.indexedUniforms={},r.uniformValues={},r.positionUniforms=[],r.dimensionsUniforms=[],r.cornerUniforms=[],r.glSDFs=[],r.positions=[],r.dimensions=[],r.corners=[],r.newInlet("SDF List",function(e){var t=Object(ea.a)(e,1)[0];return r.onSDFList(t)}),r.newInlet("mouse down",function(e){var t=Object(ea.a)(e,1)[0];return r.onMouseDown(t)}),r.newInlet("mouse up",function(e){var t=Object(ea.a)(e,1)[0];return r.onMouseUp(t)}),r.newInlet("mouse move",function(e){var t=Object(ea.a)(e,1)[0];return r.onMouseMove(t)}),r.newInlet("slider values",function(e){var t=Object(ea.a)(e,1)[0];return r.onSliderValues(t)}),r.newInlet("size",function(e){var t=Object(ea.a)(e,1)[0];r.size=t}),Object(Ma.d)("canvas.size",function(e){r.size=e}),r.newInlet("operations",function(e){var t=Object(ea.a)(e,1)[0];return r.onOperation(t)}),r.newInlet("SDF Morpher",function(e){var t=Object(ea.a)(e,1)[0];r.sdfMorpher=t,r.onSDFList(r.lastSDFs,!0)}),r.newInlet("SDF Offset",function(e){var t=Object(ea.a)(e,1)[0];r.sdfOffset=t,r.onSDFList(r.lastSDFs,!0)}),r.newInlet("SDF Operation List",function(e){var t=Object(ea.a)(e,1)[0];r.onSDFOperationList(t)}),r.newInlet("SDF Smoothness",function(e){var t=Object(ea.a)(e,1)[0];r.smoothness=t,r.onSDFList(r.lastSDFs,!0)}),r.clickBoundary=0,r.newInlet("click boundary",function(e){var t=Object(ea.a)(e,1)[0];r.clickBoundary=t}),r.newInlet("enabled",function(e){var t=Object(ea.a)(e,1)[0];r.enabled=t,r.onSDFList(r.lastSDFs,!0)}),r.newOutlet("Merged GL SDF"),r.newOutlet("GL SDF List"),r.newOutlet("GL SDF Evaluators"),r.newOutlet("vec2(sdf,index)"),r.newOutlet("Index Clicked"),r.newOutlet("On Slider Change"),r.newOutlet("On Slider SDF Change"),r.newInlet("transformation matrix",function(e){var t=Object(ea.a)(e,1)[0];return r.onTransformationMatrix(t)}),r.newInlet("transformation matrix list",function(e){var t=Object(ea.a)(e,1)[0];return r.onTransformationList(t)}),r.newOutlet("Transformed Positions"),r.newOutlet("sdf released"),r.newOutlet("mouse SDF value"),r.newOutlet("rotated mouse value"),r.newOutlet("SDF Manager"),r.newOutlet("SDF Mouse Move"),r.newOutlet("SDF Mouse Over"),r.setup(),r}return Object(o.a)(n,[{key:"hotReload",value:function(){if(this.lastSDFs&&(this.onSDFList(this.lastSDFs),this.lastSent))for(var e in this.lastSent)this.sendMessage(e,this.lastSent[e])}},{key:"flash",value:function(){}},{key:"onSDFList",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&(e=Os(e),!(e=bs(e)).every(function(e){return e.copyId})&&(this.lastSDFs=Object(h.a)(e),!(this.inlets.enabled.connections.length>0&&void 0===this.enabled)))){if(!n&&this.storedSDFs&&e.length===this.storedSDFs.length)return this.updateUniforms(e),void this.sendMessage("SDF Manager",this);var r,a=[],i=[],s={},o=ds(e);try{var c=function(){var n=r.value,o=n.id,c=t.getIndexForId(o);if(gs(n)){var u=t.handleSDFCopy(c,n,e),l=u.sdf,f=u.sdfEvaluator,h=Object(vi.a)(u,["sdf","sdfEvaluator"]);return a.push(l),i.push(f),s=Object(p.a)({},s,h.uniforms),"continue"}var d=Object(ea.a)(n,1)[0],v=Object(Bi.a)(n),m=Object(Bi.e)(n),y=t.getPosition(c,n),b=t.getDimensions(c,n),g=t.getCorner(c,v),O=t.getRotation(c,m),k=t.getRepeats(c,n);t.indexedUniforms[c]=Object(p.a)({},t.indexedUniforms[c],y.uniforms,b.uniforms,O.uniforms),Object(Bi.g)(d)&&(t.indexedUniforms[c]=Object(p.a)({},t.indexedUniforms[c],g.uniforms)),Object(Bi.f)(d)&&(t.indexedUniforms[c]=Object(p.a)({},t.indexedUniforms[c],k.uniforms)),s=Object(p.a)({},s,t.indexedUniforms[c]),y.uniforms=t.indexedUniforms[c],b.uniforms=t.indexedUniforms[c],g.uniforms=t.indexedUniforms[c],O.uniforms=t.indexedUniforms[c],k.uniforms=t.indexedUniforms[c];var j=c,w=t.glSDFs[c]||Ki(t.zObject,function(){return d},function(){return b},function(){return g},function(){return t.transformationMatrices[j]||t.transformationMatrix},function(){return O},function(){return j},function(){return k});t.glSDFs[c]=w;var x=w([y])[1],S={},P=t.name("singleSDF",c);S[P]={code:"(("+x.code+").x)",type:"float"},x=Object(p.a)({},x,{variables:S,code:P}),a.push(x),i.push(w([y])[0])};for(o.s();!(r=o.n()).done;)c()}catch(P){o.e(P)}finally{o.f()}if(this.zObject.needsHotReload=!1,0!==a.length){this.storedSDFs=a;var u=Object(Bi.f)(e[0]?e[0][0]:"box"),l=u?"vec3":"vec2",f=function(e,t,n,r,a,i){var s=Object(S.uuid)().replaceAll("-",""),o="scene"+s,c="position"+s;return function(e){var s=Object(ea.a)(e,1)[0],u={},l={},f={},h={code:"1.0"};n&&void 0!==n()&&(u=(h=n()).functions,f=h.variables,l=h.uniforms);var d={code:"0.0"};r&&void 0!==r()&&(d=r(),u=Object(p.a)({},u,d.functions),f=Object(p.a)({},f,d.variables),l=Object(p.a)({},l,d.uniforms));var v,m=Gi(s);try{for(m.s();!(v=m.n()).done;){var y=v.value;f=Object(p.a)({},f,y.variables),l=Object(p.a)({},l,y.uniforms),u=Object(p.a)({},u,y.functions)}}catch(P){m.e(P)}finally{m.f()}h.functions&&(u=Object(p.a)({},h.functions,u)),d.functions&&(u=Object(p.a)({},d.functions,u)),l=Object(p.a)({},l,h.uniforms,d.uniforms);var b=t()||"vec3",g=d.code;if(d.codeEvaluator){var O=d.functions[Object.keys(d.functions)[0]],k=Object.keys(O.args).length;g=2===k?d.codeEvaluator("p + vec2(0.0, offset_v), scene"):3===k?d.codeEvaluator("p + vec2(0.0, offset_v), scene, "+c+"(scene.y)"):d.codeEvaluator("p + vec2(0.0, offset_v)")}return u[c]={args:{index:"float"},returnType:"vec2",body:Ui(s)},u[o]={args:{p:b},returnType:"vec3",body:"\n//if (abs(p.x) > 0.3) {\n//    return vec3(200.0, -1.0, 0.0);\n//}\nvec3 scene = vec3(0.0, -1.0, 0.0);\n".concat(Qi(s,"p",a(),i()||.2),";\nreturn  vec3(scene.x * (").concat(h.codeEvaluator?h.codeEvaluator("p"):h.code,") + \n(").concat(g,"), scene.y, scene.z);\n")},{code:function(e){return o+"("+e+")"},type:"float",functions:u,uniforms:l,variables:f}}}(this.zObject,function(){return l},function(){return t.sdfMorpher},function(){return t.sdfOffset},function(){return t.sdfOperationsList},function(){return t.smoothness})([i]);s=Object(p.a)({},s,f.uniforms),this.smoothness&&this.smoothness.uniforms&&(s=Object(p.a)({},s,this.smoothness.uniforms));for(var d=u?"vec3((1.0*gl_FragCoord.xy-vec2(width, height))/height, 0.0)":"(1.0*gl_FragCoord.xy-vec2(width, height))/height",v=f.code(d),m=f.functions,y=0,b=a;y<b.length;y++){var g=b[y];m=Object(p.a)({},m,g.functions)}var O,k="sdfVec"+this.id.replaceAll("-",""),j={code:"(("+k+").x)",functions:m,uniforms:Object(p.a)({},s),variables:{}},w="sdfValue"+this.id.replaceAll("-","");void 0!==this.enabled&&((O=ki(this,function(){return 1})([this.enabled])).uniforms&&(s=Object(p.a)({},s,O.uniforms)),O.variables&&(j.variables=Object(p.a)({},j.variables,O.variables))),j.variables[k]={code:v,type:"vec3"},j.variables[w]={code:j.code,type:void 0!==this.enabled?{type:"float",defaultValue:"0.0",condition:O.code}:"float"},j.code=w;var x={code:k,functions:m,uniforms:Object(p.a)({},s),variables:j.variables};this.lastSent={"Merged GL SDF":j,"vec2(sdf,index)":x,"GL SDF List":a,"GL SDF Evaluators":f},j.type="float",x.type="vec2",this.sendMessage("Merged GL SDF",j),this.sendMessage("vec2(sdf,index)",x),this.sendMessage("GL SDF List",a),this.sendMessage("GL SDF Evaluators",f),this.sendMessage("SDF Manager",this),this.zObject.needsHotReload=!1,this.sendTransformedPositions(),this.type=mi.h}}}},{key:"updateUniforms",value:function(e){this.zObject.needsHotReload=!1,window.stopRender=!0;var t,n=ds(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.updateUniformsForSDF(r,e)}}catch(a){n.e(a)}finally{n.f()}}}]),n}(Object(Ye.a)(function(e){return function(e){Object(u.a)(n,e);var t=as(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).idToIndex={},e.indexCounter=0,e}return Object(o.a)(n,[{key:"newSDF",value:function(e){var t=this.indexCounter;return this.idToIndex[e]=t,this.indexCounter++,t}},{key:"getIndexForId",value:function(e){var t=this.idToIndex[e];return void 0===t&&(t=this.newSDF(e)),t}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=ps(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"setup",value:function(){this.tMatrix=[[1,0,0],[0,1,0],[0,0,1]];var e=this.name("globalMatrix",0);this.globalMatrixUniform=Di({},function(){return e}),this.transformationMatrix=this.globalMatrixUniform([[[1,0,0],[0,1,0],[0,0,1]]],!0),this.transformationMatrices=[],this.transformationMatricesUniforms=[]}},{key:"onPivot",value:function(e){this.pivot=e,this.globalPivotUniform([e])}},{key:"onTransformationMatrix",value:function(e){if(!Array.isArray(e)&&"object"===typeof e)return this.userInputMatrix=e,void this.onSDFList(this.lastSDFs,!0);Array.isArray(e)&&!e.some(function(e){return!Array.isArray(e)})&&(this.userInputMatrix=void 0,this.tMatrix=e,this.globalMatrixUniform([e]))}},{key:"onTransformationList",value:function(e){var t,n,r=this,a=!1;window.stopRender=!0,this.currentTransformations=Object(h.a)(e);for(var i=0;i<e.length;i++){var s=e[i];Array.isArray(s)&&Array.isArray(s[0])&&(this.transformationMatrices[i]?this.transformationMatricesUniforms[i]([s]):function(){var e=r.name("sdfTransform",i);r.transformationMatricesUniforms[i]=Di({},function(){return e}),r.transformationMatrices[i]=r.transformationMatricesUniforms[i]([s],!0),a=!0}(),t=this.transformationMatricesUniforms[i],n=s)}window.stopRender=!1,t&&t([n]),a&&this.onSDFList(this.lastSDFs,!0),this.sendTransformedPositions()}},{key:"sendTransformedPositions",value:function(){if(this.currentTransformations){var e,t=[],n=0,r=fs(this.positions);try{for(r.s();!(e=r.n()).done;){var a=e.value,i=Object(ea.a)(a,3),s=i[0],o=i[1],c=i[2],u=this.currentTransformations[n];if(!u)return;var l=Object(ea.a)(u,3),f=l[0],h=l[1],p=l[2];t.push([s*f[0]+o*f[1]+c*f[2],s*h[0]+o*h[1]+o*h[2],s*p[0]+o*p[1]+c*p[2]]),n++}}catch(d){r.e(d)}finally{r.f()}this.sendMessage("Transformed Positions",t)}}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=us(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).glDimensions=[],e.glPositions=[],e.glCorners=[],e.rotations=[],e.rotationUniforms=[],e.glRepeats=[],e.repeats=[],e.repeatsUniforms=[],e.glRotations=[],e}return Object(o.a)(n,[{key:"getTypeForId",value:function(e){var t=this.lastSDFs.find(function(t){return t.id===e});if(t)return t[0]}},{key:"updatePosition",value:function(e,t,n){this.positions[e]=[t,n],(0,this.positionUniforms[e])([this.positions[e]])}},{key:"updateUniformsForSDF",value:function(e,t){var n=this.getIndexForId(e.id);if(this.getTypeForId(e.copyId||e.id),ls(e)){var r=!0;return n===t.length-1&&(r=!1),void this.updateUniformsForCopy(n,e,t,r)}var a=Object(Bi.a)(e),i=Object(Bi.e)(e);this.positions[n]=Object(Bi.c)(e);var s=this.rotations[n];this.rotations[n]=i;var o=this.dimensions[n];this.dimensions[n]=Object(Bi.b)(e),this.repeats[n]=Object(Bi.d)(e);var c=this.corners[n];this.corners[n]=a;var u=this.positionUniforms[n];if(u){var l=this.repeatsUniforms[n],f=this.dimensionsUniforms[n],h=this.cornerUniforms[n],p=this.rotationUniforms[n];if(u([this.positions[n]]),o&&o[0]===this.dimensions[n][0]&&o[1]===this.dimensions[n][1]||f([this.dimensions[n]]),Object(Bi.f)(e[0])){var d=this.dimensionFactors[n];d&&d[2],l([this.repeats[n]])}e===t[t.length-1]&&(window.stopRender=!1,Object(Ma.b)("shader.render")),a!==c&&h([a]),i!==s&&p([i])}}},{key:"updateUniformsForCopy",value:function(e,t,n,r){t.id;var a=t.offset,i=t.copyId,s=this.getTypeForId(i);Object(Bi.f)(s)||(a=a.slice(0,2)),this.positions[e]=a;var o=this.positionUniforms[e];window.stopRender=r,o([this.positions[e]])}},{key:"handleSDFCopy",value:function(e,t,n){for(var r,a,i=this,s=(t.id,t.offset),o=t.copyId,c=0;c<n.length;c++){var u=n[c];if(u.id===o){a=c,r=u;break}}if(!r)return{sdf:void 0,sdfEvaluator:void 0};var l=this.glDimensions[a],f=this.glPositions[a],h=this.glCorners[a],p=this.glRotations[a],d=this.getTypeForId(o),v=cs(this.zObject,function(){return f})(["circle"===d?-1:1]),m=ss(this.zObject,function(){return v}),y=r;y[1]=s[0],y[2]=s[1],Object(Bi.f)(d)&&(y[3]=s[2]);var b=m([this.getPosition(e,y)]),g=this.glSDFs[e]||Ki(this.zObject,function(){return r[0]},function(){return l},function(){return h},function(){return i.transformationMatrices[e]||i.transformationMatrix},function(){return p},function(){return e});this.glSDFs[e]=g;var O=g([b]),k=Object(ea.a)(O,2),j=k[0],w=k[1],x=w.uniforms;return this.indexedUniforms[e]=x,{sdf:w,sdfEvaluator:j,uniforms:x}}},{key:"getPosition",value:function(e,t){var n=Object(Bi.c)(t),r=Object(ea.a)(n,3);r[0],r[1],r[2],this.positions[e]=n;var a=this.name("position",e);this.uniformValues[a]=n;var i=this.positionUniforms[e]||Di({},function(){return a});return this.positionUniforms[e]=i,this.glPositions[e]=i([n],!0),this.glPositions[e]}},{key:"getRepeats",value:function(e,t){var n=Object(Bi.d)(t);this.repeats[e]=n;var r=this.name("repeats",e);this.uniformValues[r]=n;var a=this.repeatsUniforms[e]||Di({},function(){return r});return this.repeatsUniforms[e]=a,this.glRepeats[e]=a([n],!0),this.glRepeats[e]}},{key:"name",value:function(e,t){return e+t+this.id.replaceAll("-","")}},{key:"getDimensions",value:function(e,t){var n=Object(Bi.b)(t),r=Object(ea.a)(n,3),a=r[0],i=r[1],s=r[2],o=this.name("dimension",e);this.dimensions[e]=n,this.uniformValues[o]=[a,i,s];var c=this.dimensionsUniforms[e]||Di({},function(){return o});return this.dimensionsUniforms[e]=c,this.glDimensions[e]=c([Object(Bi.f)(t[0])?[a,i,s]:[a,i]],!0),this.glDimensions[e]}},{key:"getCorner",value:function(e,t){var n=this.name("corner",e),r=this.cornerUniforms[e]||Di({},function(){return n});return this.corners[e]=t,this.cornerUniforms[e]=r,this.glCorners[e]=r([t],!0),this.glCorners[e]}},{key:"getRotation",value:function(e,t){var n=this.name("rotation",e),r=this.rotationUniforms[e]||Di({},function(){return n});return this.rotations[e]=t,this.rotationUniforms[e]=r,this.glRotations[e]=r([t],!0),this.glRotations[e]}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=ts(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).lastSliderValues=[0,0,0,0],e.mouseSliderStart={},e.sdfsClicked=[],e.lastMouseMove={},e.touches={},e}return Object(o.a)(n,[{key:"onMouseDown",value:function(e){var t=Object(ea.a)(e,2);if(t[0],t[1],this.lastSDFs){for(var n=[],r=!1,a=0;a<this.lastSDFs.length;a++){this.corners[a];var i=this.positions[a],s=this.lastSDFs[a],o=this.dimensions[a];if(s&&s.copyId){var c,u=-1,l=0,f=$i(this.lastSDFs);try{for(f.s();!(c=f.n()).done;){if(c.value.id===s.copyId){u=l;break}l++}}catch(v){f.e(v)}finally{f.f()}if(u>-1){var h=this.positions[u];i[0]+=h[0],i[1]+=h[1],this.corners[u],o=this.dimensions[u]}}if(!(o[0]>.7)){var p=this.sdfAtPoint(e,a);n.push(p),p<this.clickBoundary&&!r&&(this.sdfsClicked.push(a),this.touches[a]=e,this.lastMouseMove[a]=e,this.sendMessage("Index Clicked",a),this.onMouseMove(e,a),r=!0)}}var d=Math.min.apply(Math,n);this.sendMessage("mouse SDF value",d),r||this.sendMessage("Index Clicked",-1)}}},{key:"sdfForCoord",value:function(e,t){for(var n=0;n<this.lastSDFs.length;n++){this.corners[n];var r=this.positions[n],a=this.lastSDFs[n],i=this.dimensions[n];if(a&&a.copyId){var s,o=-1,c=0,u=$i(this.lastSDFs);try{for(u.s();!(s=u.n()).done;){if(s.value.id===a.copyId){o=c;break}c++}}catch(f){u.e(f)}finally{u.f()}if(o>-1){var l=this.positions[o];r[0]+=l[0],r[1]+=l[1],this.corners[o],i=this.dimensions[o]}}if(!(i[0]>.7)&&this.sdfAtPoint([e,t],n)<0)return n}return-1}},{key:"getTouch",value:function(e,t){var n=1e6,r=-1,a=this.lastMouseMove;for(var i in a){var s=ns(a[i][0],a[i][1],e[0],e[1]);s<n&&s<90&&(r=parseInt(i),n=s)}return r}},{key:"onMouseMove",value:function(e,t){for(var n=0;n<this.positions.length;n++)this.sdfAtPoint(e,n)<0&&n!==this.lastMouseOver&&(this.sendMessage("SDF Mouse Over",n),this.lastMouseOver=n);if(this.sdfsClicked.length>0){if(!this.lastSliderValues)return;var r=this.getTouch(e);if(window.mouseDown=r,r<0)return;this.lastMouseMove[r]=e,this.sendMessage("SDF Mouse Move",[r].concat(Object(h.a)(e))),this.touches[r]=e;var a=this.sdfAtPoint(e,r),i=this.dimensions[r],s=this.screenToGLCoords(e[0],e[1]),o=this.positions[r],c=this.dimensions[r],u=this.corners[r];if(!c)return;c[0]>c[1]&&(u*=.5);var l=this.sdfOffset?this.getMaxY(e,r):o[1]+c[1]/2+u,f=this.sdfOffset?this.getMinY(e,r):o[1]-c[1]/2-u,p=(rs(e,this.size),this.lastSliderValues[r],(s[1]-f)/(l-f));p=Math.max(0,Math.min(1,p)),void 0!==t&&(this.mouseSliderStart[t]=p);var d=p-this.mouseSliderStart[r],v=d<0?this.mouseSliderStart[r]:1-this.mouseSliderStart[r],m=!1;0===v&&(v=1e-5,m=!0),d*=1/v*.4;var y=p;if(p=this.lastSliderValues[r]+d,p=Math.min(1,Math.max(p,0)),m&&(y=1,p=1),isNaN(p))return;void 0===t&&(this.mouseSliderStart[r]=y),this.lastSliderValues[r]=p;var b=-Math.min(i[0]+0,i[1]+0);a=b-p*b;var g=p;a=Math.max(b+window.MIN_SDF_VALUE,a),this.sendMessage("On Slider Change",[r,Math.min(1,g)]),this.sendMessage("On Slider SDF Change",[r,Math.min(0,a)])}}},{key:"screenToGLCoords",value:function(e,t){var n=[e,t],r=this.size||[400,400];return rs(n,r)}},{key:"getOperationAtIndex",value:function(e){return this.sdfOperationsList?this.sdfOperationsList[Math.max(0,e-1)]:0}},{key:"getDownstreamSubtractions",value:function(e){for(var t=[],n=e+1;n<this.positions.length;n++)2===this.getOperationAtIndex(n)&&t.push(n);return t}},{key:"sdfAtPoint",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=this.getDownstreamSubtractions(t),i=this.getOperationAtIndex(t);if(!n&&2===i)return 1;if(!n){var s,o=$i(a);try{for(o.s();!(s=o.n()).done;){var c=s.value,u=this.sdfAtPoint(e,c,!0);if(u<0)return-u}}catch(w){o.e(w)}finally{o.f()}}var l=this.corners[t],f=this.positions[t],h=this.dimensions[t],p=this.size||[400,400],d=f||this.positions[t],v=h||this.dimensions[t],m=l||this.corners[t],y=r?e:rs(e,p),b=y;if(!d)return 1;y=[y[0]-d[0],y[1]-d[1]],y=Ya(y[0],y[1],-this.rotations[t]),this.sendMessage("rotated mouse value",y);var g=[Math.abs(y[0])-v[0]+m,Math.abs(y[1])-v[1]+m],O=Math.min(Math.max(g[0],g[1]),0),k=Math.pow(Math.max(0,g[0]),2)+Math.pow(Math.max(0,g[1]),2),j=O+Math.sqrt(k)-m;if(this.sdfOffset)try{j+=this.sdfOffset.model(b)}catch(x){}return j}},{key:"onMouseUp",value:function(e){if(!e||void 0===e[0])return this.touches={},this.sdfsClicked.length=0,this.lastMouseMove={},void this.sendMessage("sdf released",-1);var t=this.getTouch(e,!0);if(t>=0){var n=this.sdfsClicked.indexOf(t);this.sdfsClicked.splice(n,1),delete this.touches[t],delete this.lastMouseMove[t]}this.sendMessage("sdf released",t)}},{key:"debug",value:function(e){this.sequencerEngine.dispatch(Object(C.Te)(e))}},{key:"onSliderValues",value:function(e){if(e&&(this.lastSliderValues=e),this.storedSDFs){for(var t=[],n=0;n<e.length;n++){var r=e[n],a=this.dimensions[n];if(a){var i=-Math.min(a[0]+0,a[1]+0),s=i-r*i;t.push(Math.max(i+window.MIN_SDF_VALUE,s))}}2!==t.length&&this.sendMessage("On Slider SDF Change",t)}}},{key:"getMinY",value:function(e,t){var n=Object(ea.a)(e,2),r=n[0],a=n[1];return rs([0,this.raytrace([r,a],this.getUpwardAngles(),t)],this.size)[1]}},{key:"getMaxY",value:function(e,t){var n=Object(ea.a)(e,2),r=n[0],a=n[1];return rs([0,this.raytrace([r,a],this.getDownwardAngles(),t)],this.size)[1]}},{key:"raytrace",value:function(e,t,n){for(var r=Object(ea.a)(e,2),a=r[0],i=r[1],s=0,o=i,c=new Set,u=0;u<120;u++){s+=4;var l,f=$i(t);try{for(f.s();!(l=f.n()).done;){var h=l.value;if(!c.has(h)){var p=this.getNextPointAtAngle(a,i,h,s),d=this.sdfAtPoint(p,n);(p[1]>=this.size[1]||p[1]<=0||d>0)&&(c.add(h),o=p[1])}}}catch(v){f.e(v)}finally{f.f()}}return o}},{key:"getUpwardAngles",value:function(){return[1.6]}},{key:"getDownwardAngles",value:function(){return[4.76]}},{key:"getNextPointAtAngle",value:function(e,t,n,r){return[e+r*Math.cos(n),t+r*Math.sin(n)]}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Ti(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).dimensionFactors=[],e}return Object(o.a)(n,[{key:"onSDFOperationList",value:function(e){this.sdfOperationsList=e,this.lastSDFs&&this.onSDFList(this.lastSDFs,!0)}},{key:"onOperation",value:function(e){if(e&&e.split){var t=e.split(" "),n=t[0],r=Ei[n],a=t.slice(1).map(function(e){return parseFloat(e)});r&&r.apply(void 0,[this].concat(Object(h.a)(a)))}}}]),n}(e)})(Va.a)),bs=function(e){var t=e.filter(function(e){return!gs(e)}),n=e.filter(function(e){return gs(e)});return[].concat(Object(h.a)(t),Object(h.a)(n))},gs=function(e){return!Array.isArray(e)},Os=function(e){e.some(function(e){return"number"===typeof e})&&(e=e.filter(function(e){return!Object(pe.a)(e)}));for(var t=0;t<e.length;t++){var n=e[t];if("string"===typeof n){var r=n.split(" ").map(function(e){return Object(pe.a)(e)?parseFloat(e):e});e[t]=r}e[t].id||(e[t].id=t)}return e},ks=n(159);function js(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ws=function(e){Object(u.a)(n,e);var t=js(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).loader=new ks.Y,r.newInlet("load by IPFS",function(e){var t=Object(ea.a)(e,1)[0];return r.loadImage(t)}),r.newOutlet("texture"),r.zObject.newAttribute("load on start",!0),r.loading=!1,r.hashToTexture={},r}return Object(o.a)(n,[{key:"loadImage",value:function(e){var t=this;return new Promise(function(n){t.loading=!0;0;if(t.hashToTexture[e])return t.sendMessage("texture",t.hashToTexture[e]),t.texture=t.hashToTexture[e],t.loading=!1,void n();t.imageHash=e,t.zObject.onValueChange();var r=e.startsWith("http")?e:"https://zequencer.io/ipfs/"+e;t.sendMessage("texture",t.loader.load(r,function(r){t.loading=!1,t.texture=r,t.hashToTexture[e]=r,n()}))})}},{key:"getJson",value:function(){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{imageHash:this.imageHash})}},{key:"fromJson",value:function(e,t,r){console.log("TEXTURE LOADER.fromJson"),Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),(r||this.zObject.attributes["load on start"])&&this.loadImage(e.imageHash)}}]),n}(Va.a);Object(Ca.a)("three.dataTexture",{dataArray:"",width:"",height:""},"Creates a three.js data texture out of an array of data and optional width/height",function(){return 1},{inlets:3});var xs=function(e,t,n){var r,a=void 0;return function(e){var i=Object(ea.a)(e,1)[0];if(Array.isArray(i)||ArrayBuffer.isView(i)){var s=t()||Math.round(Math.sqrt(i.length)),o=n()||Math.round(Math.sqrt(i.length));return ArrayBuffer.isView(i)?(a&&a.length===i.length||(a=new Uint8Array(s*o*4)),a.set(i)):(a&&a.length===i.length||(a=new Uint8Array(i.length)),i.length<=a.length?a.set(i):a.set(i.slice(0,a.length))),r&&r.source.data.width===s&&r.source.data.height===o||(r=new ks.m(a,s,o)),r.needsUpdate=!0,r}}};Object(Ca.a)("three.textureLoader",{},"Load images into three.js textures",function(){return 0},{inlets:0});var Ss={"three.dataTexture":xs,"three.textureLoader":function(e){return e.effect=new ws(e),e.needsLoad=!0,function(t){Object(_a.a)(t),e.effect.imageHash&&e.effect.loadImage(e.effect.imageHash)}}};function Ps(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Es(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Es(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Es(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("sdf.positionTexture",{"sdf list":""},"Returns a texture with all positions/dimensions of sdfs",function(){return 1},{});var Ts=function(e){return Math.floor(255*e)};Object(Ca.a)("gl.unpack",{"vec2/vec3/vec4":""},"Unpacks a vector into its components, sending them out through its outlets",function(){return 4},{inletTypes:Object(mi.j)(mi.c,mi.d,mi.e),type:function(){return["float","float","float","float"]},inlets:1});var As=function(e){return e.needsHotReload=!0,e.typed(function(e){var t=Object(ea.a)(e,1)[0],n=t.uniforms,r=t.functions,a=t.variables,i=t.closure,s=t.model,o=Object(bi.a)(t),c={uniforms:n,variables:a,closure:i,functions:r};return[Object(p.a)({},c,{type:"float",code:"((".concat(Object(gi.b)(o[0]),").r)"),model:function(e){return s(e)[0]}}),Object(p.a)({},c,{type:"float",code:"((".concat(Object(gi.b)(o[0]),").g)"),model:function(e){return s(e)[1]}}),Object(p.a)({},c,{type:"float",code:"((".concat(Object(gi.b)(o[0]),").b)"),model:function(e){return s(e)[2]}}),Object(p.a)({},c,{type:"float",code:"((".concat(Object(gi.b)(o[0]),").a)"),model:function(e){return s(e)[3]}})]})};Object(Ca.a)("sdf.displace",{"sdf manager":"","displacement function":""},"Hooks up mouse events to sdf",function(){return 1},{isHot:!0,inlets:2});Object(Ca.a)("sdf.index",{"sdf manager":""},"Returns the sdf index of the sdf manager ",function(){return 1},{isHot:!0,inlets:1});Object(Ca.a)("sdf.mouse",{"sdf manager":"",clickBoundary:""},"Modular mouse events for sdfs",function(){return 3},{outlets:["index clicked","sdf released","sdf mouse moved","sdf mouse over"],isHot:!0,inlets:2});var Ms={"sdf.index":function(e){return function(t){var n=Object(ea.a)(t,1)[0];if(n&&n.onSDFList){var r=n.lastSent["vec2(sdf,index)"];return As(e)([r])[1]}}},"sdf.displace":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(n&&n.onSDFList&&n.sdfOffset!==t())return n.sdfOffset=t(),n.onSDFList(n.lastSDFs,!0),[n.lastSent["Merged GL SDF"]]}},"sdf.mouse":function(e,t){var n=void 0;Object(Ma.d)("mouse-down",function(e){n&&n.inlets["mouse down"].action([e])}),Object(Ma.d)("mouse-up",function(e){n&&n.inlets["mouse up"].action([e])}),Object(Ma.d)("mouse-move",function(e){n&&n.inlets["mouse move"].action([e])});var r=function(t){e.sendMessage(e.outputByNumber(0),t)},a=function(t){e.sendMessage(e.outputByNumber(1),t)},i=function(t){e.sendMessage(e.outputByNumber(2),t)},s=function(t){e.sendMessage(e.outputByNumber(3),t)};return function(e){var o=Object(ea.a)(e,1)[0],c=(n=o).outlets;n.clickBoundary=t()||0,c["Index Clicked"].actions.includes(r)||c["Index Clicked"].actions.push(r),c["sdf released"].actions.includes(a)||c["sdf released"].actions.push(a),c["SDF Mouse Move"].actions.includes(i)||c["SDF Mouse Move"].actions.push(i),c["SDF Mouse Over"].actions.includes(s)||c["SDF Mouse Over"].actions.push(s)}}},Rs=function(e,t){var n=new ys({sequencerEngine:t,subSequence:t.subSequence,id:t.id,flash:function(e){return 0},newAttribute:function(){return 0}});return function(t){var r=e(t);Array.isArray(r[0])?"string"===typeof r[0][0]?n.onSDFList([r[0]]):n.onSDFList(r[0]):n.onSDFList(r);var a=n.lastSent["Merged GL SDF"];return a.type="float",r[0].type=mi.f,[r[0],a,n]}};Object(Ca.a)("sdf.gridHex",{count:"",x:"",y:"",size:"",spacing:"",rotation:""},"Creates a hexagon",function(){return 1},{inlets:6,isHot:!0});Object(Ca.a)("sdf.fourRect",{x:"",y:"",width:"",height:"",round:"",rotation:"",fullRotation:"",alternateDimensions:""},"Creates 4 rectangles circling the center",function(){return 1},{inletTypes:Object(mi.k)(mi.g),type:function(){return[mi.f,mi.a,mi.h]},outlets:["SDF Object","SDF GL","SDF Manager"],inlets:8,isHot:!0});Object(Ca.a)("sdf.gridRect",{count:"",x:"",y:"",w:"",h:"",round:"",spacing:"",rotation:"",altOffset:""},"Creates a grid of rectangles",function(){return 1},{inletTypes:Object(mi.k)(mi.g),type:function(){return[mi.f,mi.a,mi.h]},outlets:["SDF Object","SDF GL","SDF Manager"],inlets:9,isHot:!0});Object(Ca.a)("sdf.indexedScale",{indices:"",scale:"",list:""},"Scales by index",function(){return 1},{inlets:3,isHot:!0});Object(Ca.a)("sdf.scaleDimension",{indices:"",scale:"",list:""},"Scale dimension",function(){return 1},{inlets:2,isHot:!0});Object(Ca.a)("sdf.scalePosition",{list:"",scaleList:""},"Scale dimension",function(){return 1},{inlets:2,isHot:!0});Object(Ca.a)("sdf.setY",{list:"",index:"",y:""},"Scale dimension",function(){return 1},{inlets:3,isHot:!0});Object(Ca.a)("sdf.scaleWidth",{list:"",scale:""},"Scale dimension",function(){return 1},{inlets:2,isHot:!0});Object(Ca.a)("sdf.scaleHeight",{list:"",scale:""},"Scale dimension",function(){return 1},{inlets:2,isHot:!0});Object(Ca.a)("sdf.scaleCorner",{list:"",scale:""},"Scale dimension",function(){return 1},{inlets:2,isHot:!0});Object(Ca.a)("sdf.hex",{x:"",y:"",size:"",rotation:""},"Creates a hexagon",function(){return 3},{outlets:["SDF Object","SDF GL","SDF Manager"],inlets:4,isHot:!0});Object(Ca.a)("sdf.circle",{x:"",y:"",radius:""},"Creates a hexagon",function(){return 3},{outlets:["SDF Object","SDF GL","SDF Manager"],inlets:3,isHot:!0});Object(Ca.a)("sdf.rect",{x:"",y:"",width:"",height:"",round:"",rotation:""},"Creates a hexagon",function(){return 3},{inlets:6,inletTypes:Object(mi.k)(mi.g),type:function(){return[mi.f,mi.a,mi.h]},outlets:["SDF Object","SDF GL","SDF Manager"],isHot:!0});Object(Ca.a)("sdf.combine",{list:"list of sdfs","sdf operations":"0-union 1-intersect 2-subtract 3 -smoothunion 4-smooth subtrsact",smoothness:""},"",function(){return 2},{isHot:!0,outlets:["SDF","vec3(sdf,index,mix)"],inlets:3});var Cs=Object(p.a)({"sdf.combine":function(e,t,n){var r=new ys({sequencerEngine:e,subSequence:e.subSequence,id:e.id,flash:function(e){return 0},newAttribute:function(){return 0}});return function(e){var a=Object(ea.a)(e,1)[0],i=t();i&&r.onSDFOperationList(i),void 0!==n()?(r.smoothness=n(),r.onSDFList(a,!0)):r.onSDFList(a);var s=r.lastSent["Merged GL SDF"];return s.type="float",[s,Object(p.a)({},r.lastSent["vec2(sdf,index)"],{type:"vec3"})]}},"Sdf.hex":function(e,t,n,r){var a=Object(S.uuid)();return Rs(function(e){var i=["hexagon",Object(ea.a)(e,1)[0],t()||0,n()||.1,n()||.1,0,r()||0];return i.id=a,[i]},e)},"sdf.rect":function(e,t,n,r,a,i){var s=Object(S.uuid)();return Rs(function(e){var o=Object(ea.a)(e,1)[0],c=Array.isArray(o)?o[1]:t()||0,u=["rect",Array.isArray(o)?o[0]:o,c,n()||.1,r()||.1,a()||.1,i()||0];return u.id=s,[u]},e)},"sdf.circle":function(e,t,n,r){var a=Object(S.uuid)();return Rs(function(e){var r=Object(ea.a)(e,1)[0],i=Array.isArray(r)?r[1]:t()||0,s=["circle",Array.isArray(r)?r[0]:r,i,n()||.1,n()||.1,0,0];return s.id=a,[s]},e)},"sdf.gridHex":function(e,t,n,r,a,i){Object(S.uuid)().replaceAll("-","");return function(e){for(var s=Object(ea.a)(e,1)[0],o=[],c=t(),u=n(),l=r()||0,f=a()||0,h=0;h<s;h++)for(var p=0;p<s;p++){var d=h;p%2===0&&(d+=.5);var v=["hexagon",c+d*(l+f),u+p*(l+f),l,l,0,i()||0];o.push(v)}return[o]}},"sdf.gridRect":function(e,t,n,r,a,i,s,o,c){Object(S.uuid)().replaceAll("-","");return Rs(function(e){for(var u=Object(ea.a)(e,1)[0],l=[],f=t(),h=n(),p=r()||.1,d=a()||.1,v=i()||.1,m=s()||0,y=Array.isArray(u)?u[0]:u,b=Array.isArray(u)?u[1]:u,g=0;g<y;g++)for(var O=0;O<b;O++){var k=g;O%2===0&&(k+=void 0===c()?.5:c());var j=["rect",f+k*(p+m),h+O*(d+m),p,d,v,o()||0];l.push(j)}return[l]},e)},"sdf.fourRect":function(e,t,n,r,a,i,s,o){var c=Object(S.uuid)().replaceAll("-","");return Rs(function(e){var u=Object(ea.a)(e,1)[0],l=t(),f=n()||.1,h=r()||.1,p=a()||.1,d=i()||0,v=[d,d+.5*Math.PI,d,d+.5*Math.PI],m=[u,-u,-u,u],y=[l,l,-l,-l],b=[f,h,f,h],g=[h,f,h,f];o()&&(b=[f,f,f,f],g=[h,h,h,h]);for(var O=[],k=0;k<4;k++){var j=Ya(m[k],y[k],s()||0),w=Object(ea.a)(j,2),x=["rect",w[0],w[1],g[k],b[k],p,v[k]];x.id=c+"_"+k,O.push(x)}return[O]},e)},"sdf.indexedScale":function(e,t,n){return function(e){for(var r=Object(ea.a)(e,1)[0],a=Object(h.a)(r),i=0;i<n().length;i++)if(n()[i]){var s=Object(h.a)(a[i]);s[3]*=t(),s[4]*=t(),s[5]*=t(),s.id=a[i].id,a[i]=s}return[a]}},"sdf.scaleDimension":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(null===t())return[n];for(var r=Object(h.a)(n),a=0;a<n.length;a++){var i=Object(h.a)(r[a]),s=Array.isArray(t())?t()[a]:t();i[3]*=s,i[4]*=s,i[5]*=s,i.id=r[a].id,r[a]=i}return[r]}},"sdf.scaleWidth":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(t()){var r=t();Array.isArray(r)||(r=[r]);for(var a=Object(h.a)(n),i=0;i<n.length;i++)if(a[i]&&Array.isArray(a[i])){var s=Object(h.a)(a[i]);s[3]*=r[i%r.length],s.id=a[i].id,a[i]=s}return[a]}}},"sdf.scaleCorner":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(t()){var r=t();Array.isArray(r)||(r=[r]);for(var a=Object(h.a)(n),i=0;i<n.length;i++)if(a[i]&&Array.isArray(a[i])){var s=Object(h.a)(a[i]);s[5]*=r[i%r.length],s.id=a[i].id,a[i]=s}return[a]}}},"sdf.scaleHeight":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(t()){var r=t();Array.isArray(r)||(r=[r]);for(var a=Object(h.a)(n),i=0;i<n.length;i++)if(a[i]&&Array.isArray(a[i])){var s=Object(h.a)(a[i]);s[4]*=r[i%r.length],s.id=a[i].id,a[i]=s}return[a]}}},"sdf.scalePosition":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(t()){var r=t();Array.isArray(r)||(r=[r]);for(var a=Object(h.a)(n),i=0;i<n.length;i++)if(a[i]&&Array.isArray(a[i])){var s=Object(h.a)(a[i]);s[1]*=r[i%r.length],s[2]*=r[i%r.length],s.id=a[i].id,a[i]=s}return[a]}}},"sdf.positionTexture":function(e){var t=16,n=xs(0,function(){return t},function(){return 1});return function(e){var r,a=[],i=Ps(Object(ea.a)(e,1)[0]);try{for(i.s();!(r=i.n()).done;){var s=r.value,o=(s[1]+1)/2,c=(s[2]+1)/2,u=s[3],l=s[4];a.push(Ts(o)),a.push(Ts(c)),a.push(Ts(u)),a.push(Ts(l))}}catch(f){i.e(f)}finally{i.f()}return t=a.length/4,n([a])}},"sdf.setY":function(e,t,n){return function(e){var r=Object(ea.a)(e,1)[0];if(void 0!==t()&&void 0!==n()){var a=Object(h.a)(r),i=a[t()];return i[2]=n(),i.id=r[t()].id,[a]}}}},Ms),Ns=n(921);function qs(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Is(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Is(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Is(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("chord.gen",{progression:"",numeral:"",voices:""},"Generates a chord adding it to the progression (coming in on the left-inlet)",function(){return 1},{inlets:function(e){return e+1},isHot:!0});Object(Ca.a)("chord.select",{progression:"",number:""},"Outputs a chord based on the number in the right inlet",function(){return 1},{isHot:!0,inlets:2});Object(Ca.a)("chord.voice",{chord:"",scale:"",voices:""},"Outputs a list of notes for the chord given at a scale",function(){return 1},{isHot:!0,inlets:2});Object(Ca.a)("chord.trigger",{times:"",notes:"",durations:"",outputs:""},"Outputs a list of triggers based on the notes, times, and durations",function(){return 1},{inlets:4});var _s={"chord.gen":function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return e.needsHotReload=!0,function(e){var n=Object(ea.a)(e,1)[0];"bang"===n&&(n=[]);var a=t(),i=r.map(function(e){return e()}).filter(function(e){return void 0!==e});return[[].concat(Object(h.a)(n),[[a].concat(Object(h.a)(i))])]}},"chord.select":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];return[n[(t()||0)%n.length]]}},"chord.voice":function(e,t,n){return e.needsHotReload=!0,function(e){var n=Object(ea.a)(e,1)[0];Array.isArray(n)||(n=[n]);var r=n,a=Object(_a.a)(r),i=a[0],s=a.slice(1);i--;var o,c=t()||[0,2,3,5,7,8,10],u=[],l=qs(s);try{for(l.s();!(o=l.n()).done;){var f=c[(i+(o.value-1))%c.length];u.push(f)}}catch(h){l.e(h)}finally{l.f()}return[u]}},"chord.trigger":function(e,t,n,r){return e.needsHotReload=!0,function(e){var a=Object(ea.a)(e,1)[0]||[W.a.Master.context.currentTime];"bang"===a&&(a=[W.a.Master.context.currentTime]);var i=t()||[],s=n()||[],o=r()||[1];Array.isArray(a)||(a=[a]),Array.isArray(s)||(s=[s]),Array.isArray(o)||(o=[o]);var c,u=[],l=0,f=qs(i);try{for(f.s();!(c=f.n()).done;){var h=c.value,p=l++,d=new F.a;d.transpose=h,d.duration=s[p%s.length];var m=o[p%o.length],y=a[p%a.length];y.duration&&(d.duration=y.duration),y.time&&(y=y.time),u.push(new Ve.a(d,y,0,m))}}catch(b){f.e(b)}finally{f.f()}return[[v.p,u]]}}};Object(Ca.a)("key.extract",{"audio buffer":"to extract"},"extract");Object(Ca.a)("key.offset",{key:""},"Returns the number offset from C for a key string");var Ds=function(e){var t=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],n=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return function(e){var r=Object(ea.a)(e,1)[0],a=t.indexOf(r);return a>=0?a:n.indexOf(r)}};Object(Ca.a)("key.transform",{key1:"",key2:""},"Returns the transpose necessary to keep two sounds in key",function(){return 1},{isHot:!0,inlets:2});var Fs={"key.extract":function(e){var t;return function(n){var r=Object(ea.a)(n,1)[0];try{t||((t=new Worker(window.isNFT?"keyWorker.js":"/keyWorker.js",{type:"module"})).onmessage=function(t){var n=t.data,r=n.key,a=n.scale,i=n.strength;e.sendMessage(e.outputByNumber(0),[r,a,i])}),t.postMessage(r.getChannelData(0))}catch(a){}}},"key.offset":Ds,"key.transform":function(e,t){var n=Ds();return function(e){var r=Object(ea.a)(e,1)[0];if(t()&&r){var a=Object(ea.a)(r,2),i=a[0],s=a[1],o=t(),c=Object(ea.a)(o,2),u=c[0],l=c[1],f=n(i),h=n(u);if(s===l){var p=Object(jn.a)(f-h,12);return p>6&&(p-=12),p}var d=Object(jn.a)(f-(h-3),12);return d>6&&(d-=12),d}}}};Object(Ca.a)("disablePlay",{},"Disables project from playing or showing press to start");Object(Ca.a)("url.searchParam",{bang:"","parameter to get":""},"Returns the url search param, the page was loaded with");var Ls={"url.searchParam":function(e,t){return e.needsLoad=!0,function(e){Object(ea.a)(e,1)[0];var n=window.urlSearchParams.get(t());return Object(pe.a)(n)?parseFloat(n):n||void 0}}},Bs=n(139),zs=n(295),Js=n(118);function Vs(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Hs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Hs(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Hs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Us(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Gs=function(e){Object(u.a)(n,e);var t=Us(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).samples=[],r.bpms={},r.basses={},r.bpmSamples=[],r.cursor=0,r.BPM_RANGE=25,r.newInlet("tag",function(e){var t=Object(ea.a)(e,1)[0];return r.onTag(t)}),r.newInlet("choose",function(e){var t=Object(ea.a)(e,1)[0];return r.choose(t)}),r.newInlet("nearBPM",function(e){var t=Object(ea.a)(e,1)[0];return r.nearBPM(t)}),r.newInlet("shuffle ordering",function(e){var t=Object(ea.a)(e,1)[0];return r.shuffleOrdering(t)}),r.newInlet("next sample",function(e){Object(ea.a)(e,1)[0];return r.nextSample()}),r.newInlet("previous sample",function(e){Object(ea.a)(e,1)[0];return r.previousSample()}),r.newInlet("bpm window",function(e){var t=Object(ea.a)(e,1)[0];return r.BPM_RANGE=t}),r.newInlet("sample subset",function(e){var t=Object(ea.a)(e,1)[0];return r.onSampleSubset(t)}),r.newInlet("set samples",function(e){var t=Object(ea.a)(e,1)[0];return r.setSamples(t)}),r.newInlet("remove current sample",function(e){Object(ea.a)(e,1)[0];return r.removeCurrentSample()}),r.newOutlet("sample hash"),r.newOutlet("sample and bpm"),r.newOutlet("is bass"),r}return Object(o.a)(n,[{key:"removeCurrentSample",value:function(){var e=this.bpmSamples[Object(jn.a)(this.cursor,this.bpmSamples.length)][0];delete this.bpms[e],this.bpmSamples.splice(this.cursor,1),this.samples=this.samples.filter(function(t){return t!==e}),this.sendCurrentSample()}},{key:"setSamples",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.bpmSamples=t.map(function(e){return[e]}),e.next=3,Ar.a.preloadSound(this.bpmSamples[0][0]);case 3:e.sent,this.sendCurrentSample();case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onSampleSubset",value:function(e){this.sampleSubset=e,this.lastBPM&&this.shuffleOrdering(this.lastBPM)}},{key:"shuffleOrdering",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.lastBPM=t,n=Object(mt.a)(this.getSamplesNearestToBPM(t)),this.bpmSamples=n,this.cursor=0,this.bpmSamples[0]){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,Ar.a.preloadSound(this.bpmSamples[0][0]);case 8:e.sent,this.sendCurrentSample();case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendCurrentSample",value:function(){var e=Object(jn.a)(this.cursor,this.bpmSamples.length),t=this.bpmSamples[e];if(t){var n=Object(ea.a)(t,2),r=n[0],a=n[1];this.basses[r]?this.sendMessage("is bass",1):this.sendMessage("is bass",0),this.sendMessage("sample hash",r),this.sendMessage("sample and bpm",[r,a]),this.preloadAdjacents()}}},{key:"preloadAdjacents",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.bpmSamples[this.cursor],t=Object(jn.a)(this.cursor+1,this.bpmSamples.length),this.bpmSamples[t]){e.next=4;break}return e.abrupt("return");case 4:if(this.bpmSamples[t]){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,Ar.a.preloadSound(this.bpmSamples[t][0]);case 8:return e.sent,0,n=Object(jn.a)(this.cursor-1,this.bpmSamples.length),e.next=13,Ar.a.preloadSound(this.bpmSamples[n][0]);case 13:e.sent,0;case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"nextSample",value:function(){this.cursor++,this.sendCurrentSample()}},{key:"previousSample",value:function(){this.cursor--,this.sendCurrentSample()}},{key:"nearBPM",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(ea.a)(t,2),r=n[0],i=n[1],s=this.getSamplesNearestToBPM(r),this.sendMessage("sample hash",s[i%s.length][0]),this.sendMessage("sample and bpm",[s[i%s.length]]);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSamplesNearestToBPM",value:function(e){var t=[],n=Object.keys(this.bpms).slice(0,this.sampleSubset||this.bpms.length),r=this.samples.slice(0,this.sampleSubset||this.samples.length);if(!isNaN(e)){var a,i=Vs(n);try{for(i.s();!(a=i.n()).done;){var s=a.value,o=this.bpms[s];isNaN(o)&&(o=120),Math.abs(e-o)<this.BPM_RANGE&&t.push([s,o])}}catch(h){i.e(h)}finally{i.f()}}if(0===t.length){var c,u=Vs(r);try{for(u.s();!(c=u.n()).done;){var l=c.value,f=this.bpms[l];t.push([l,f])}}catch(h){u.e(h)}finally{u.f()}}return t}},{key:"onTag",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Bs.a((new zs.a).contractAddress).from(Js.V),Array.isArray(t)?n.whereIn("tag",t):n.where("tag",t),e.next=4,n.executeQuery();case 4:return r=e.sent,i=r.map(function(e){return e.ipfsHash}),this.samples=i,n=new Bs.a((new zs.a).contractAddress).from(Js.R).whereIn("ipfsHash",i),e.next=10,n.executeQuery();case 10:(r=e.sent).reverse(),s={},r.forEach(function(e){var t=Ws(e.title);isNaN(t)||(s[e.ipfsHash]=t),e.title.includes("bass")&&(o.basses[e.ipfsHash]=!0)}),this.bpms=s,console.log("BASSES=",this.basses);case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"choose",value:function(e){var t=this.samples[e];t&&this.sendMessage("sample hash",t)}},{key:"getJson",value:function(){var e=Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{samples:this.samples,bpms:this.bpms,basses:Object(p.a)({},this.basses)});return console.log("saving samples json=",e),e}},{key:"fromJson",value:function(e){console.log("samples JSON =",e),Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e),this.samples=e.samples,this.bpms=e.bpms,e.basses&&(this.basses=e.basses)}}]),n}(Va.a),Ws=function(e){var t=e.trim().split(" ");e=t[1];for(var n="",r=0;r<e.length;r++){var a=e[r];if(!Object(pe.a)(a))break;n+=a}return parseInt(n)};Object(Ca.a)("samples.tag",{},"Stores a list of samples with tag for fetching",function(){return 0},{inlets:0});Object(Ca.a)("image.crop",{"image object":"",x:"",y:"","source width":"","source height":"","dest width":"","dest height":""},"crops an image coming as message in left-inlet",function(){return 1},{inlets:7});Object(Ca.a)("image.download",{"image data URL":"",filename:""},"downlaods an image coming as message in left-inlet",function(){return 1},{inlets:2});var Ks={"image.download":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0],r="".concat(t(),".png"),a=document.createElement("a");return a.download=r,a.href=n.src||n,a.click(),["bang"]}},"image.crop":function(e,t,n,r,a,i,s){return function(o){var c=Object(ea.a)(o,1)[0];c.addEventListener("load",function(){var o=document.createElement("canvas"),u=o.getContext("2d");o.width=i(),o.height=s(),u.drawImage(c,t(),n(),r(),a(),0,0,i(),s());var l=o.toDataURL("image/png");e.sendMessage(e.outputByNumber(0),l)})}}},Qs=n(290),Zs=function(){function e(t,n,r){Object(s.a)(this,e),this.usePoints=r?1:0,this.index=0,this.width=t,this.height=n,this.idToWaveform={},this.idToBasicWaveform={},this.reversedIdToWaveform={}}return Object(o.a)(e,[{key:"getBasicWaveform",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e!==Qs.a;return new Promise(function(a,i){r&&e in n.idToBasicWaveform?a(n.idToBasicWaveform[e]):n.computeBasicWaveform(t).then(function(t){r&&(n.idToBasicWaveform[e]=t),a(t)})})}},{key:"getWaveform",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e!==Qs.a,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.height;return new Promise(function(s,o){n.computeWaveformPoints(t,0,[],function(t){r&&(n.idToWaveform[e]=t),s(t)},a,i)})}},{key:"getReversedWaveform",value:function(e,t){var n=this;return new Promise(function(r,a){e in n.reversedIdToWaveform?r(n.reversedIdToWaveform[e]):n.computeWaveformPoints(t,0,[],function(t){n.reversedIdToWaveform[e]=t,r(t)})})}},{key:"computeWaveformPoints",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i){var s,o,c,u,l,f,h,p,d,v,m,y,b,g=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=g.length>4&&void 0!==g[4]?g[4]:1,o=g.length>5?g[5]:void 0,s=1,c=this.width,!((n+1)*c>this.width)){e.next=7;break}return i([]),e.abrupt("return");case 7:for(u=Math.floor(t.length/this.width),l=(l=this.isRaw?t:t.getChannelData(0)).subarray(c*n*u,c*(n+1)*u),f=window.api.create_buffer(l.length),Math.min((n+1)*c,this.width),window.Module.HEAPF32.set(l,f>>2),window.api.getColoredWaveform(f,c,o,l.length,u,c*n,s,this.usePoints),h=window.api.get_result_pointer(),p=new Uint16Array(window.Module.HEAP16.buffer,h,7*c/s),d=[],v=0;v<p.length;v+=7)m=[p[v+4],p[v+5],p[v+6]],y=p[v+3],d.push({x:p[v],y:p[v+1],width:p[v+2],height:y,rgb:m});b=this,window.api.destroy_buffer(f),setTimeout(function(){b.computeWaveformPoints(t,n+1,r.concat(d),function(e){i(d.concat(e))})},2);case 21:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"computeBasicWaveform",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.index++,n=this.index,r=Math.floor(t.length/this.width),i=t.getChannelData(0),s=window.api.create_buffer(i.length),this.width,window.Module.HEAPF32.set(i,s>>2),window.api.getWaveform(s,parseInt(this.width),parseInt(this.height),i.length,r),o=window.api.get_result_pointer(),c=new Uint16Array(window.Module.HEAP16.buffer,o,3*this.width),u=[],!(n<this.index)){e.next=13;break}return e.abrupt("return",void 0);case 13:for(l=0,f=0;f<3*this.width;f+=3)u.push({x:l,y:c[f+1],rmsY:c[f+2]}),l++;return window.api.destroy_buffer(s),e.abrupt("return",u);case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function Ys(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Xs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xs(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Xs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("waveform.track",{trackNumber:""},"Returns audio buffer for track",function(){return 2},{outlets:["buffer","duration"]});Object(Ca.a)("waveform.slice",{buffer:"",startTime:"",duration:""},"Returns audio buffer for track",function(){return 1},{isHot:!0,inlets:3});Object(Ca.a)("waveform.sliceBackwards",{buffer:"",time:"",duration:""},"Returns audio buffer for track",function(){return 1},{isHot:!0,inlets:3});Object(Ca.a)("waveform.color",{audioBuffer:"",width:"",isRawBuffer:""},"Returns a colorful waveform for an audio buffer",function(){return 1},{inlets:3});Object(Ca.a)("intarray.slice",{arr:"",from:"",to:""},"slices an int array",function(){return 1},{isHot:!0,inlets:3});var $s={"waveform.color":function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return 50},r=arguments.length>2?arguments[2]:void 0,a=0;return function(i){var s=Object(ea.a)(i,1)[0];if("bang"!==s){var o=n()||50;t||(t=new Zs(o,255,1)),r()&&(t.isRaw=!0,s=s[0]);var c=(new Date).getTime();t.getWaveform(a++,s).then(function(t){var n,r=new Uint8Array(4*t.length),a=0,i=[],s=Ys(t);try{for(s.s();!(n=s.n()).done;){var o=n.value,u=o.height;r[a++]=u,r[a++]=o.rgb[0],r[a++]=o.rgb[1],r[a++]=o.rgb[2],i.push(o.height)}}catch(f){s.e(f)}finally{s.f()}var l=(new Date).getTime();console.log("waveform get took %s ms",l-c),e.sendMessage(e.outputByNumber(0),r)})}}},"waveform.slice":function(e,t,n){return function(e){var r=Object(ea.a)(e,1)[0],a=t()||0,i=n()||1,s=r.duration;return r.slice(Math.min(a,s-.01),Math.min(a+i,s))}},"waveform.sliceBackwards":function(e,t,n){return function(e){var r=Object(ea.a)(e,1)[0],a=t()||0,i=n()||1,s=r.duration,o=Math.max(a-i,0),c=Math.min(a,s);return c===o&&(c+=.01),r.slice(o,c)}},"waveform.track":function(e){return function(t){var n=Object(ea.a)(t,1)[0],r=e.sequencerEngine.tracks[n].getSamplers()[0];if(r)return[r.baseBuffer,r.getDuration()]}},"intarray.slice":function(e,t,n){return function(e){var r=Object(ea.a)(e,1)[0];if(void 0!==t()&&void 0!==n())return[r.slice(t(),n())]}}};function eo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var to=function(e){Object(u.a)(n,e);var t=eo(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).setup(),r.newOutlet("level"),r}return Object(o.a)(n,[{key:"setup",value:function(){this.sequencerEngine.channelMixer.masterChannel.startMetering(this)}}]),n}(Va.a);function no(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ro=function(e){Object(u.a)(n,e);var t=no(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).setup(),r.newOutlet("level"),r}return Object(o.a)(n,[{key:"setup",value:function(){this.sequencerEngine.channelMixer.masterChannel.startWaveforming(this)}}]),n}(Va.a);function ao(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var io=function(e){Object(u.a)(n,e);var t=ao(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).setup(),r.newOutlet("level"),r}return Object(o.a)(n,[{key:"setup",value:function(){this.sequencerEngine.channelMixer.masterChannel.startFFTing(this)}}]),n}(Va.a);function so(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var oo=function(e){Object(u.a)(n,e);var t=so(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).send=0,r.newInlet("send",function(e){var t=Object(ea.a)(e,1)[0];return r.send=t}),r.newOutlet("level"),r}return Object(o.a)(n,[{key:"send",set:function(e){var t=this.getSendChannel(this._send||0);t.stopMetering(),this._send=e,(t=this.getSendChannel()).startMetering(this)}},{key:"getSendChannel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._send;return this.sequencerEngine.sends.sends[e]}}]),n}(Va.a);function co(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var uo=function(e){Object(u.a)(n,e);var t=co(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).envelope=0,r.newInlet("envelope",function(e){var t=Object(ea.a)(e,1)[0];return r.envelope=t}),r.newOutlet("level"),r}return Object(o.a)(n,[{key:"envelope",set:function(e){var t=this.getEnvelope(this._envelope||0);t.stopMetering(),this._envelope=e,(t=this.getEnvelope()).startMetering(this)}},{key:"getEnvelope",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._envelope;return this.sequencerEngine.envelopes[e]}}]),n}(Va.a);Object(Ca.a)("meter.mix",{},"Meter for mix channel",function(){return 0},{inlets:0});Object(Ca.a)("meter.waveform",{},"Meter for mix channel",function(){return 0},{inlets:0});Object(Ca.a)("meter.fft",{},"Meter for mix channel",function(){return 0},{inlets:0});Object(Ca.a)("meter.send",{},"Meter for send channel",function(){return 0},{inlets:0});Object(Ca.a)("meter.envelope",{},"Meter for envelope",function(){return 0},{inlets:0});var lo={"meter.send":function(e){new oo(e);return function(e){Object(ea.a)(e,1)[0]}},"meter.waveform":function(e){new ro(e);return function(){}},"meter.fft":function(e){new io(e);return function(){}},"meter.envelope":function(e){new uo(e);return function(){}},"meter.mix":function(e){new to(e);return function(){}}};function fo(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ho(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ho(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ho(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function po(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var vo=100,mo=function(e){Object(u.a)(n,e);var t=po(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).sequencerEngine.presetManager=Object(c.a)(r),r.presets=new Array(vo).fill(0),r.newInlet("Load Preset",function(e){var t=Object(ea.a)(e,1)[0];r.presets[t]&&r.loadPreset(t)}),r.newInlet("Interpolate",function(e){var t=Object(ea.a)(e,1)[0];Array.isArray(t)&&r.interpolate(t[0],t[1],t[2])}),r.zObject.newAttribute("number of presets",16,function(e){return r.changeNumberOfPresets(e)}),Object(Ma.b)("preset.new"),r}return Object(o.a)(n,[{key:"changeNumberOfPresets",value:function(e){for(var t=[],n=0;n<e;n++)void 0!==this.presets[n]?t[n]=this.presets[n]:t[n]=0;this.presets=t}},{key:"getImageHashes",value:function(){var e,t=[],n=fo(this.presets);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r)for(var a in r){var i=r[a];"three.textureLoader"===i.text&&t.push(i.effect.imageHash)}}}catch(s){n.e(s)}finally{n.f()}return t}},{key:"newPreset",value:function(e){var t={};this.presets[e]=t,this.current=t,this.loadObjectsWithScripting()}},{key:"loadObjectsWithScripting",value:function(){for(var e in this.sequencerEngine.idToObject){var t=this.sequencerEngine.idToObject[e];t.attributes&&t.attributes["scripting name"]&&t.subSequence.preset===this&&this.onValueChange(t,t.effect&&t.effect.value||t.message||t._text)}}},{key:"interpolate",value:function(e,t,n){var r=this.presets[e],a=this.presets[t];if(r&&a)for(var i in r){var s=this.sequencerEngine.idToObject[i];if(s){var o=r[i],c=a[i];s.effect&&(s=s.effect,o=o.effect,c=c.effect),s.interpolate(o,c,n)}}}},{key:"loadPreset",value:function(e){if(this.presets[e]){var t=this.presets[e];for(var n in this.current=t,t){var r=this.sequencerEngine.idToObject[n];if(r){console.log("loading obj =",r);var a=(new Date).getTime();r.fromValueJson(t[n],void 0,!0);var i=(new Date).getTime();console.log("took %s ms",i-a)}}}else this.newPreset(e)}},{key:"onValueChange",value:function(e,t){this.current&&(this.current[e.id]=e.getValueJson())}},{key:"loadMyPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=window.localStorage.getItem("preset.hash"),e.next=3,Ar.a.getJson(n);case 3:r=e.sent,i=r.presets.slice(0,10),(t=this.presets).splice.apply(t,[0,10].concat(Object(h.a)(i)));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"uploadPreset",value:function(){Ar.a.addJson(this.getJson(!0)).then(function(e){window.localStorage.setItem("preset.hash",e)})}},{key:"getJson",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return Object(p.a)({},(e=Object(ne.a)(Object(f.a)(n.prototype),"getJson",this)).call.apply(e,[this].concat(r)),{presets:this.presets})}},{key:"fromJson",value:function(e){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e),this.presets=e.presets,this.zObject.attributes["number of presets"]!==this.presets.length&&this.zObject.setAttribute("number of presets",this.presets.length)}}]),n}(Va.a);function yo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var bo=function(e){Object(u.a)(n,e);var t=yo(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return n}(Va.a);Object(Ca.a)("varz",{},"View and control all variables nested inside patch",function(){return 0},{inlets:0});Object(Ca.a)("preset",{},"Create presets of object (w/ scripting name attribute set) configurations.",function(){return 0},{inlets:0});var go={preset:function(e){new mo(e);return function(){}}};function Oo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ko=function(e){Object(u.a)(n,e);var t=Oo(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newInlet("fx preset",function(e){var t=Object(ea.a)(e,1)[0];return r.fxPreset=t}),r.newOutlet("fx preset"),r}return n}(Va.a);Object(Ca.a)("spore.effects",{});var jo={"spore.effects":function(e){new ko(e);return e.width=850,e.height=700,function(){}}};Object(Ca.a)("ui.hidePlayUntil",{type:""},"Hides the play button until a message of type is received");Object(Ca.a)("ui.hide",{},"Hides the ui of zequencer (sidebars)");Object(Ca.a)("ui.lock",{},"locks the ui of zequencer");Object(Ca.a)("ui.noDeleteKey",{flag:""},"Skip the delete key");var wo={"ui.hide":function(e){return e.needsLoad=!0,function(t){Object(ea.a)(t,1)[0],e.sequencerEngine.dispatch(Object(C.Wd)(!1))}},"ui.hidePlayUntil":function(e){return function(t){Object(ea.a)(t,1)[0],e.sequencerEngine.dispatch(Object(C.Nc)(!0))}},"ui.lock":function(e){return e.needsLoad=!0,function(t){Object(ea.a)(t,1)[0],e.sequencerEngine.dispatch(Object(C.Ie)(!0))}},"ui.noDeleteKey":function(e){return e.needsLoad=!0,function(t){var n=Object(ea.a)(t,1)[0];e.sequencerEngine.noDeleteKey=!!n}}};Object(Ca.a)("window.postMessage",{msg:"",type:""},"Sends message to parent (if this is an iframe)",function(){return 1},{inlets:2}),Object(Ca.a)("iframe.postMessage",{msg:"",type:""},"Sends message to parent (if this is an iframe)",function(){return 1},{inlets:2});var xo=function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(window.parent&&document.referrer){t()&&(n={type:t(),body:n});var r=document.referrer;window.parent.postMessage(n,r)}}};Object(Ca.a)("iframe.onMessage",{message:"message (for testing the functionality)",type:"message name to listen for"},"Listens for messages coming from the parent window and sends them out the outlet",function(){return 1},{inlets:2});var So={"window.postMessage":xo,"iframe.postMessage":xo,"iframe.onMessage":function(e,t){var n=function(n){(n=n.data).type===t()&&e.sendMessage(e.outputByNumber(0),n.body)};return window.addEventListener("message",n),function(e){var t=Object(ea.a)(e,1)[0];n(t)}}};n(297);Object(Ca.a)("player~",{play:"",audioBuffer:""},"plays buffer",function(){return 1},{isHot:!0,inlets:2});Object(Ca.a)("speakers~",{source:""},"speakers",function(){return 1},{isHot:!0});var Po={"player~":function(e,t){var n=void 0,r=!1;return function(e){var a=Object(ea.a)(e,1)[0],i=t();if(i&&!n&&(n=new W.a.Player(i)),n&&(a&&!r?(r=!0,n.start()):!a&&r&&(r=!1,n.stop())),n)return[n]}}};function Eo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var To=function(e){Object(u.a)(n,e);var t=Eo(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).hashMap={},r.tempos={},r.startOnsets={},r.current=1,r.newInlet("id",function(e){var t=Object(ea.a)(e,1)[0];console.log("RECEIVED Z IPFS MESSAGE=",t),r.current=t,r.hashMap[r.current]&&(r.ipfsHash=r.hashMap[r.current])}),r.newOutlet("IPFS hash"),r.newOutlet("IPFS URL"),r.newOutlet("start onset"),r.newOutlet("tempo"),r}return Object(o.a)(n,[{key:"deleteId",value:function(e){var t=this.hashMap[e];delete this.hashMap[e],delete this.tempos[t],delete this.startOnsets[t]}},{key:"dropFile",value:function(e,t,n){this.hashMap[this.current]=e,this.tempos[e]=t,this.startOnsets[e]=n}},{key:"ipfsHash",set:function(e){this.hashMap[this.current]=e,this._ipfsHash=e,console.log("sending ipfs hash stored=",e),this.sendMessage("IPFS hash",e),this.sendMessage("IPFS URL",this.getURL(e)),this.sendMessage("tempo",this.tempos[e]),this.sendMessage("start onset",this.startOnsets[e])}},{key:"getURL",value:function(e){return"https://zequencer.mypinata.cloud/ipfs/"+e}},{key:"fromJson",value:function(e){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e),e.hashMap&&(this.hashMap=e.hashMap),e.startOnsets&&(this.startOnsets=e.startOnsets),e.tempos&&(this.tempos=e.tempos)}},{key:"getJson",value:function(){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{hashMap:this.hashMap,startOnsets:this.startOnsets,tempos:this.tempos})}}]),n}(Va.a);Object(Ca.a)("ipfs.json",{hash:"IPFS content hash to download"},"Returns the json out of inlet",function(){return 1});Object(Ca.a)("ipfs.drop",{},"Returns the json out of inlet",function(){return 0},{inlets:0});var Ao={"ipfs.json":function(e){var t={};return function(n){var r=Object(ea.a)(n,1)[0];if(t[r])return[t[r]];Ar.a.getJson(r,void 0,void 0,void 0,!0).then(function(n){console.log("ipfs.getJson object returned=",r,n),t[r]=n,e.sendMessage(e.outputByNumber(0),n)})}},"ipfs.drop":function(e){e.width=150,e.height=150;new To(e);return function(e){Object(ea.a)(e,1)[0]}}};function Mo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ro=function(e){Object(u.a)(n,e);var t=Mo(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).snapshots=[],r.newInlet("snapshots",function(e){var t=Object(ea.a)(e,1)[0];console.log("received snap",t),r.snapshots=[].concat(Object(h.a)(r.snapshots),[t])}),r.newOutlet("operation"),r}return Object(o.a)(n,[{key:"useSnapshot",value:function(e){console.log("send use snapshot",e),this.sendMessage("operation","use-snapshot",e)}},{key:"takeSnapshot",value:function(){this.sendMessage("operation","take-snapshot")}},{key:"interpolateSnapshots",value:function(e){this.sendMessage("operation","interpolate-snapshots "+e.join(" "))}},{key:"getJson",value:function(){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{snapshots:this.snapshots})}},{key:"fromJson",value:function(e,t){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),e.snapshots&&(this.snapshots=e.snapshots)}}]),n}(Va.a);function Co(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return No(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return No(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function No(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var qo=["gl.mod","gl./","gl.*","gl.+","gl.-","gl.atan"];Object(Ca.a)("operations.mutate",{"probability of mutation":"trigger mutation","from operation":"trigger mutation","to operation":"trigger mutation"},"Switches operations of objects in subpatch from one to another w/ probability. Returns a mapping of all operations and their counts",function(){return 2},{inlets:3,outlets:["stats","snapshots"]});var Io=function e(t,n,r,a,i,s){var o,c=Co(t.zObjects);try{for(c.s();!(o=c.n()).done;){var u=o.value;if(u.effect&&u.effect.zObjects&&!u.isLocked)e(u.effect,n,r,a,i,s);else if(Math.random()>n||u.isLocked)_o(u,a,i),qo.includes(u.name)&&s.push([u,u._text,u._text]);else{var l=u._text;if(u.name===r){var f=l.indexOf(" ");l=-1===f?a:a+l.slice(f),s.push([u,u._text,l]),u.text=l}_o(u,a,i)}}}catch(h){c.e(h)}finally{c.f()}},_o=function(e,t,n){qo.includes(e.name)&&Do(t)===Do(e.name)&&(n[e.name]||(n[e.name]=0),n[e.name]++)},Do=function(e){var t=Object(Ca.a)(e);return t.inlets?t.inlets:0};Object(Ca.a)("operations.snapshots",{},"Switches operations of objects in subpatch from one to another w/ probability. Returns a mapping of all operations and their counts",function(){return 0},{});var Fo=function(e){var t,n=Co(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=Object(ea.a)(r,2),i=a[0],s=a[1];i._text!==s&&(i.text=s)}}catch(o){n.e(o)}finally{n.f()}},Lo=function(e){var t,n=Co(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=Object(ea.a)(r,3),i=a[0],s=(a[1],a[2]);i._text!==s&&(console.log("setting snap zobject=%s -> %s",i._text,s),i.text=s)}}catch(o){n.e(o)}finally{n.f()}},Bo={"operations.mutate":function(e,t,n){var r=[];return function(a){var i=Object(ea.a)(a,2),s=i[0],o=i[1];if("undo"!==s)if("take-snapshot"!==s)if("use-snapshot"!==s){var c=t(),u=n();if(c&&u){var l=[],f={};window.stopGLCompile=!0,Io(e.subSequence.subSequence||e.subSequence,s,c,u,f,l),window.stopGLCompile=!1,e.sequencerEngine.compile();var p=[];for(var d in f)p.push([d,f[d]]);var v,m=Co(qo);try{for(m.s();!(v=m.n()).done;){var y=v.value;f[y]||p.push([y,0])}}catch(O){m.e(O)}finally{m.f()}return p.sort(function(e,t){return t[1]-e[1]}),r.push(l),[p]}}else o&&(o=o.map(function(t){var n=Object(ea.a)(t,3),r=n[0],a=n[1],i=n[2];return[e.sequencerEngine.idToObject[r],a,i]}),window.stopGLCompile=!0,Lo(o),window.stopGLCompile=!1,e.sequencerEngine.compile());else{var b=r[r.length-1];b&&(b=b.map(function(e){return[e[0].id,e[1],e[2]]}),e.sendMessage(e.outputByNumber(1),Object(h.a)(b)))}else{var g=r.pop();g&&Fo(g)}}},"operations.snapshots":function(e){new Ro(e);return function(e){Object(ea.a)(e,1)[0]}}};function zo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Jo=function(e){Object(u.a)(n,e);var t=zo(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newInlet("url",function(e){return r.url=e[0]}),r}return n}(Va.a);Object(Ca.a)("icon",{},"creates an icon with supplied",function(){return 0},{inlets:0});function Vo(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ho(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ho(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Ho(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("document.title",{title:""},"Sets the title of the webpage to the argument passed");Object(Ca.a)("window.size",{},"Returns the size of the window");Object(Ca.a)("sub.setGlobalSize",{size:""},"sets the size of all subpatches");var Uo=function e(t,n,r){t.zObject&&t.isCustom&&(console.log("setting canvas size object=",n,r,t),t.zObject.width=n,t.zObject.height=r);var a,i=Vo(t.zObjects);try{for(i.s();!(a=i.n()).done;){var s=a.value;"subpatch"===s.name&&e(s.effect,n,r)}}catch(o){i.e(o)}finally{i.f()}};Object(Ca.a)("canvas.setGlobalSize",{size:""},"sets the size of all subpatches");var Go=function e(t,n,r){var a,i=Vo(t.zObjects);try{for(i.s();!(a=i.n()).done;){var s=a.value;"three.canvas"===s.name&&(console.log("setting canvas size object=",n,r,s),s.width=n,s.height=r,s.effect.sendMessage("size",[n,r])),s.effect&&s.effect.zObjects&&e(s.effect,n,r)}}catch(o){i.e(o)}finally{i.f()}};Object(Ca.a)("window.postMessage",{msg:""},"Sends message to parent (if this is an iframe)");Object(Ca.a)("modal",{show:"1 to show 0 to hide",text:"The main text (arrays are seperated by lines)","ok button text":"","cancel button text":"","link text":"","link url":""},"Creates a modal",function(){return 2},{inlets:6});Object(Ca.a)("progressbar",{"start/stop":"",text:""},"Shows a progressbar spinner",function(){return 0},{inlets:2});Object(Ca.a)("motion.rampTo",{trigger:"",time:"",min:"",max:"",skipFirst:"",parts:""},"Ramps from min to max in time milliseconds using ",function(){return 1},{inlets:6});Object(Ca.a)("motion.rampBack",{trigger:"",time:"",min:"",max:""},"Ramps from min to max back to min in time milliseconds using ",function(){return 1},{inlets:4});Object(Ca.a)("motion.slowdown",{coords:"",speed:""},"Slows down in coming coordinate data by a factor (replaying them at slower speed)",function(){return 1},{inlets:2});Object(Ca.a)("motion.spring",{trigger:"",start:"",end:"",stiffness:"",dampening:"",mass:"",endVelocity:"",rate:""},"",function(){return 2},{inlets:8,outlets:["value","finished"]});var Wo={"motion.spring":function(e,t,n,r,a,i,s,o){var c=void 0;return function(u){if("clear"!==Object(ea.a)(u,1)[0]){var l=t(),f=n(),h=r()||-30,p=a()||-.97,d=(new Date).getTime();c&&clearInterval(c);var v=l,m=0,y=i()||.1,b=s()||.01;c=setInterval(function(){var t=(new Date).getTime()-d;d=(new Date).getTime(),v+=(m+=(h*(v-f)+p*m)/y*(t/1e3))*(t/1e3),Math.abs(m)<b?(clearInterval(c),e.sendMessage(e.outputByNumber(0),f),e.sendMessage(e.outputByNumber(1),"bang")):e.sendMessage(e.outputByNumber(0),v)},o()||30)}else clearInterval(c)}},"motion.rampTo":function(e,t,n,r,a,i){var s;return function(o){if("clear"===Object(ea.a)(o,1)[0]&&s)clearInterval(s);else{var c=void 0===r()?1:r(),u=void 0===n()?0:n();if(u!==c){var l=i()||30,f=t(),h=u,p=(c-u)/l;s&&clearInterval(s);var d=!0;s=setInterval(function(){if(h+=p,c>u&&h>c||c<u&&h<c)return e.sendMessage(e.outputByNumber(0),c),void clearInterval(s);a()&&d||e.sendMessage(e.outputByNumber(0),h),d=!1},f/l)}}}},"motion.rampBack":function(e,t,n,r){return function(a){Object(ea.a)(a,1)[0];var i=r()||1,s=n()||0,o=t(),c=s,u=(i-s)/20,l=setInterval(function(){if(c+=u,i>s&&c>i||i<s&&c<i)if(u<0)e.sendMessage(e.outputByNumber(0),i),clearInterval(l);else{c+=u*=-1;var t=s;s=i,i=t}else e.sendMessage(e.outputByNumber(0),c)},o/20)}},"motion.slowdown":function(e,t){var n=void 0,r=void 0;return function(a){var i,s,o,c=Object(ea.a)(a,1)[0],u=(new Date).getTime(),l=u-n;(void 0===n||u-r>200)&&(n=u),r=u,i=c,s=Math.max(0,l*t()-l),o=n,setTimeout(function(){o===n&&e.sendMessage(e.outputByNumber(0),i)},s)}}},Ko=n(790);function Qo(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Zo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zo(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Zo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Yo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Xo=function(e){Object(u.a)(n,e);var t=Yo(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newInlet("load",function(){return r.load()}),r.newInlet("get skin",function(e){var t=Object(ea.a)(e,1)[0];return r.onSkin(t)}),r.newOutlet("skin"),r}return Object(o.a)(n,[{key:"onSkin",value:function(e){this.skins&&this.skins[e]&&this.sendMessage("skin",this.skins[e])}},{key:"load",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Bs.a((new Ko.a).contractAddress).from(Js.D),e.next=3,t.executeQuery();case 3:n=e.sent,r={},i=Qo(n);try{for(i.s();!(s=i.n()).done;)o=s.value,r[o.skinId]=o.imageHash}catch(a){i.e(a)}finally{i.f()}this.skins=r;case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getJson",value:function(){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{skins:this.skins})}},{key:"fromJson",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];(t=Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this)).call.apply(t,[this,e].concat(a)),e.skins&&(this.skins=e.skins)}}]),n}(Va.a),$o=n(555),ec=n(408),tc=n(392);function nc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var rc=function(e,t){if(e<500&&e>60){if(void 0===t.onsets[0]){var n=t.tempo;t.analyze(void 0,!0),t.tempo=n}void 0!==t.onsets[0]&&t.onsets[0]<1200&&(e=t.onsets[0])}return e},ac=n(494);function ic(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return sc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sc(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function sc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var oc=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f,h,p;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Bs.a((new zs.a).contractAddress).from(Js.V).where("tag","spores"),e.next=3,n.executeQuery();case 3:return r=e.sent,n=new Bs.a((new zs.a).contractAddress).from(Js.R).whereIn("ipfsHash",r.map(function(e){return e.ipfsHash})),e.next=7,n.executeQuery();case 7:r=e.sent,i=[],s=ic(r);try{for(s.s();!(o=s.n()).done;)c=o.value,u=c.title,l=u.split(" "),f=l[1],h=cc(f),console.log("title = %s extacted=%s",u,h),Math.abs(h-t)<=10&&i.push(c)}catch(a){s.e(a)}finally{s.f()}return console.log("matching bpms = ",i),p=(r=i)[Math.floor(Math.random()*r.length)],console.log("random sample chosen=",p),e.abrupt("return",p.ipfsHash);case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),cc=function(e){for(var t="",n=0;n<e.length;n++){var r=e[n];if(!Object(pe.a)(r))break;t+=r}return parseInt(t)};function uc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return lc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lc(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function lc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function fc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}window.getRandomRiddim=oc;var hc=function(e){Object(u.a)(n,e);var t=fc(n);function n(e){var r;if(Object(s.a)(this,n),(r=t.call(this,e)).playlist=[],r.stems=void 0,r.newInlet("load song",function(){var e=Object(i.a)(a.a.mark(function e(t){var n,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object(ea.a)(t,1),i=n[0],r.sequencerEngine.playing&&r.sequencerEngine.play(),!(s=r.playlist[i])){e.next=6;break}return e.next=6,r.loadsong(s);case 6:r.sequencerEngine.play();case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),r.newInlet("load mutation",function(e){var t=Object(ea.a)(e,1)[0];r.loadMutation(t)}),r.newInlet("load url",function(e){var t=Object(ea.a)(e,1)[0];r.loadFromURL(t)}),r.newInlet("load sample",function(e){var t=Object(ea.a)(e,1)[0];r.loadSampleFromURL(t)}),r.newInlet("load alt. sample",function(e){var t=Object(ea.a)(e,1)[0];r.loadSampleFromURL(t,"vocals")}),r.newOutlet("bpm changed"),r.newOutlet("on loaded"),r.newOutlet("sample loaded"),r.newOutlet("song buffer"),r.newOutlet("sample buffer"),window.addEventListener("message",function(e){return r.receiveIFrameMessage(e)}),r.loadCount=0,window.parent&&document.referrer){var o=document.referrer;window.parent.postMessage("ready for stems",o)}return r}return Object(o.a)(n,[{key:"receiveIFrameMessage",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f,h,p,d,v,m;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("load-song"!==(n=t.data).type){e.next=8;break}r=n.body,i=parseInt(r),(s=this.playlist[i])&&this.loadSong(s),e.next=61;break;case 8:if("nft-jacker"!==n.type){e.next=61;break}this.sequencerEngine.playing&&(this.sequencerEngine.stop(),this.sequencerEngine.seekToTrackStep(0)),o=n.body,c=[],this.zObject.dispatch(Object(C.Xe)("loading nft jacker")),u=void 0,e.t0=a.a.keys(o.samples);case 15:if((e.t1=e.t0()).done){e.next=46;break}if(l=e.t1.value,f=o.samples[l],"other"!==l||!o.containsSample){e.next=23;break}return e.next=21,oc(u);case 21:h=e.sent,f=h;case 23:if(void 0,(p=new q.a(f)).name=l,!c[0]||c[0].ipfsHash!==f){e.next=41;break}if(p.audioBuffer=c[0].audioBuffer,u){e.next=39;break}return e.prev=29,e.next=32,Object(ec.a)(c[0].audioBuffer);case 32:d=e.sent,u=d.tempo,e.next=39;break;case 37:e.prev=37,e.t2=e.catch(29);case 39:e.next=43;break;case 41:return e.next=43,p.fetchAudio(!0);case 43:c.push(p),e.next=15;break;case 46:if(!o.containsSample){e.next=52;break}return e.next=49,Object($o.a)(c.find(function(e){return"main"===e.name}).audioBuffer);case 49:e.t3=e.sent,e.next=53;break;case 52:e.t3=void 0;case 53:if(v=e.t3,!(m={samples:c,name:"nft-jacked",bpm:u,sampleBPM:v})){e.next=59;break}return e.next=58,this.loadSong(m,!0);case 58:this.loadCount>=1&&this.sequencerEngine.play();case 59:this.zObject.dispatch(Object(C.Xe)(void 0)),this.loadCount++;case 61:case"end":return e.stop()}},e,this,[[29,37]])}));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromURL",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f,h,p;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t,r=t,i=t,t.includes(" ")&&(t=t.split(" ")),Array.isArray(t)&&(n=t[0],i=t[1]||t[0],r=t[2]||t[0]),console.log("Main =%s space=%s",n,i),s={samples:{main:n,alt:r,space:i},bpm:120},o=[],this.zObject.dispatch(Object(C.Xe)("loading nft jacker")),c=void 0,e.t0=a.a.keys(s.samples);case 10:if((e.t1=e.t0()).done){e.next=25;break}if(u=e.t1.value,void 0,(l=new q.a(s.samples[u])).name=u,!o[0]||s.samples[u]!==c){e.next=19;break}l.audioBuffer=o[0].audioBuffer,e.next=21;break;case 19:return e.next=21,l.fetchAudio(!0);case 21:c||(c=s.samples[u]),o.push(l),e.next=10;break;case 25:return f=120,e.prev=26,e.next=29,Object(ec.a)(o[0].audioBuffer);case 29:h=e.sent,f=h.bpm,e.next=36;break;case 34:e.prev=34,e.t2=e.catch(26);case 36:return p={samples:o,name:"nft-jacked",bpm:f},e.next=39,this.loadSong(p,!1);case 39:this.zObject.dispatch(Object(C.Xe)(void 0));case 40:case"end":return e.stop()}},e,this,[[26,34]])}));return function(t){return e.apply(this,arguments)}}()},{key:"setBPM",value:function(e){this.sequencerEngine.bpm=e,this.sendMessage("bpm changed",e)}},{key:"getJson",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return Object(p.a)({},(e=Object(ne.a)(Object(f.a)(n.prototype),"getJson",this)).call.apply(e,[this].concat(r)),{playlist:this.playlist.map(function(e){return Object(p.a)({},e,{samples:e.samples.map(function(e){return{ipfsHash:e.ipfsHash,name:e.name}})})})})}},{key:"fromJson",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];(t=Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this)).call.apply(t,[this,e].concat(a)),e.playlist&&this.loadPlaylistJSON(e.playlist)}},{key:"loadPlaylistJSON",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f,h,p,d,v,m;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=0,r=uc(t);try{for(r.s();!(i=r.n()).done;){s=i.value,o=s.samples,c=s.name,u=s.bpm,l=[],f=uc(o);try{for(f.s();!(h=f.n()).done;)p=h.value,d=p.ipfsHash,v=p.name,(m=new q.a(d)).name=v,l.push(m)}catch(a){f.e(a)}finally{f.f()}this.newStems(l,c,u,!1,0==n),n++}}catch(a){r.e(a)}finally{r.f()}this.stems=this.playlist[0];case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newStems",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i={samples:e,name:t,bpm:n};this.playlist.push(i),r?this.loadSong(i):a&&this.loadSong(i,!0)}},{key:"loadMutation",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sequencerEngine.tokenID=t,n=this.stems.samples.filter(function(e){return e.name.includes("mutation")}),r=n[t]){e.next=5;break}return e.abrupt("return");case 5:if((i=r).isLoaded()){e.next=9;break}return e.next=9,i.fetchAudio();case 9:5,s=this.getTrackForIndex(5),this.disposeSampler(s.getSamplers()[0]),this.lastMutation&&(this.lastMutation.audioBuffer=void 0),this.lastMutation=r,s&&(o=s.getSamplers()[0],c=new W.a.Buffer(i.audioBuffer),o.slices[0].buffer=c,o.baseBuffer=c,o.slices[0].sampler._buffers._buffers[48]=c,o.slices[0].startTime=0,o.slices[0].endTime=c.duration,o.sample=i),(u=s.getSamplers()[0])&&(u.tempo=this.stems.bpm);case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadSong",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f,p,d,v,m,y=this,b=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!(b.length>1&&void 0!==b[1])||b[1],Object(ac.a)(),Object(tc.b)(),Ar.a.clearCache(),n&&(this.sequencerEngine.playing&&this.sequencerEngine.stop(),this.sequencerEngine.trackStep>0&&this.sequencerEngine.seekToTrackStep(0)),"number"===typeof t&&(t=this.playlist[t]),i=(r=t).samples,r.name,s=r.bpm,r.sampleBPM,o=r.startOnset,0,i=Object(h.a)(i),u=0,l=uc(i),e.prev=11,p=a.a.mark(function e(){var t,n,r,i,o,l,h;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.value,n=t.name,y.sequencerEngine.isLoading||y.zObject.dispatch(Object(C.Xe)("Loading stem ".concat(1+u," of 6"))),!(r=y.tracks.find(function(e){return e.presetName===n}))){e.next=9;break}if((i=r.getSamplers()[0]).sample.getId()!==t.getId()){e.next=9;break}return"main"===n&&(c=i.sample.audioBuffer),e.abrupt("return","continue");case 9:if(t.isLoaded()){e.next=12;break}return e.next=12,t.fetchAudio();case 12:u++,r&&(o=r.getSamplers()[0],l=new W.a.Buffer(t.audioBuffer),"main"===n&&(c=t.audioBuffer),o.onsets=[],o.slices[0].buffer=l,o.baseBuffer=l,o.slices[0].sampler._buffers._buffers[48]=l,o.slices[0].startTime=0,o.slices[0].endTime=l.duration,o.sample=t,h=s,o.tempo=h);case 14:case"end":return e.stop()}},e)}),l.s();case 14:if((f=l.n()).done){e.next=21;break}return e.delegateYield(p(),"t0",16);case 16:if("continue"!==e.t0){e.next=19;break}return e.abrupt("continue",19);case 19:e.next=14;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(11),l.e(e.t1);case 26:return e.prev=26,l.f(),e.finish(26);case 29:if(void 0!==o){d=uc(this.tracks);try{for(d.s();!(v=d.n()).done;)v.value.getSamplers()[0].onsets=[1e3*o]}catch(g){d.e(g)}finally{d.f()}}this.setBPM(s),this.stems=t,this.zObject.dispatch(Object(C.Xe)(void 0)),this.sendMessage("on loaded",s),this.sendMessage("song buffer",c),window.parent&&document.referrer&&(m=document.referrer,window.parent.postMessage({type:"song-player-progress",body:0},m));case 36:case"end":return e.stop()}},e,this,[[11,23,26,29]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getTrackForIndex",value:function(e){var t,n=uc(this.sequencerEngine.currentSubSequence.pads);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.slots[e])return r.slots[e]}}catch(a){n.e(a)}finally{n.f()}}},{key:"disposeExistingSamples",value:function(){var e,t=uc(this.playlist);try{for(t.s();!(e=t.n()).done;){e.value.samples.forEach(function(e){return e.audioBuffer=void 0})}}catch(s){t.e(s)}finally{t.f()}var n,r=this.sequencerEngine.tracks,a=uc((r=[].concat(Object(h.a)(r.slice(0,4)),[r[5]])).map(function(e){return e.getSamplers()[0]}));try{for(a.s();!(n=a.n()).done;){var i=n.value;this.disposeSampler(i)}}catch(s){a.e(s)}finally{a.f()}}},{key:"disposeSampler",value:function(e){e.sample.audioBuffer=void 0,e.audioBuffer=void 0,e.slices[0].buffer.originalCopy=void 0,e.slices[0].buffer.reversedCopy=void 0,e.slices[0].buffer=void 0,e.baseBuffer&&e.baseBuffer.dispose(),e.baseBuffer=void 0}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=nc(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"loadSampleFromURL",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="juice",r=void 0,Array.isArray(t)&&(r=t[1],t=t[0]),(i=new q.a(t)).name=n,e.next=7,i.fetchAudio(!0);case 7:return e.next=9,this.cropSilence(i.audioBuffer,t);case 9:if(i.audioBuffer=e.sent,e.t1=r,e.t1){e.next=15;break}return e.next=14,Object($o.a)(i.audioBuffer);case 14:e.t1=e.sent;case 15:if(e.t0=e.t1,e.t0){e.next=18;break}e.t0=120;case 18:return r=e.t0,s=this.tracks.find(function(e){return e.presetName===n}),e.next=22,this.adjustSamplerLengthAndBPM(s,i,r);case 22:this.replaceSampleWith(n,i,r,!0),this.sendMessage("sample loaded","bang"),this.sendMessage("sample buffer",i.audioBuffer);case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cropSilence",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o,c,u,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(tc.a)(t,n);case 3:if(i=e.sent,!(r=i.offset).error){e.next=7;break}return e.abrupt("return",t);case 7:e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",t);case 12:return r>.08&&(r*=.1),s=t.getChannelData(0),o=x.isMobile?void 0:t.getChannelData(1),c=r*W.a.Master.context.sampleRate,u=W.a.Master.context,s.length,(l=u.createBuffer(x.isMobile?1:2,s.length-c+1,u.sampleRate)).getChannelData(0).set(s.subarray(c)),x.isMobile||l.getChannelData(1).set(o.subarray(c)),e.abrupt("return",l);case 22:case"end":return e.stop()}},e,null,[[0,9]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"replaceSampleWith",value:function(e,t,n,r){var a=this.tracks.find(function(t){return t.presetName===e}),i=a.getSamplers()[0],s=new W.a.Buffer(t.audioBuffer);return i.slices[0].buffer=s,i.baseBuffer=s,i.slices[0].sampler._buffers._buffers[48]=s,i.slices[0].startTime=0,i.slices[0].endTime=s.duration,i.sample=t,i.tempo=n,i.tempoOverride=n,a}},{key:"bpm",get:function(){return this.sequencerEngine.bpm}},{key:"adjustSamplerLengthAndBPM",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,s,o,c,u,l,f,h,p,d,v,m,y,b,g,O;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t.getSamplers()[0],i=n.audioBuffer.duration*(this.bpm/r),s=new W.a.Time("32n").toSeconds(),c=(o=i/s)-o%32,u=32;2*u<=c;)u*=2;return c=2*u,l=Math.min(256,c),t.pattern.changeLength(l),f=[],e.prev=13,e.next=16,Object(tc.a)(this.firstSampler.baseBuffer._buffer,this.firstSampler.sample.ipfsHash);case 16:h=e.sent,f[0]=1e3*h.offset,e.next=23;break;case 20:e.prev=20,e.t0=e.catch(13),f=[];case 23:if(!f||!f[0]){e.next=43;break}if(0!==(p=f[0])){e.next=27;break}return e.abrupt("return");case 27:p=rc(p,this.firstSampler),d=t.pattern.length()*new W.a.Time("32n").toSeconds(),v=d,m=p/1e3,this.bpm,y=2*m%v/new W.a.Time("32n").toSeconds(),b=Math.floor(y),g=y-b,b=Math.floor(b/2),g/=2,window.GLOBAL_OFFSET=b,console.log("SHIFTING TRACK OVER step=%s off=%s",b,g),this.shiftTrackStep(t,b,g),O=this.tracks.find(function(e){return"env 1"===e.presetName}),this.shiftTrackStep(O,b,g);case 43:case"end":return e.stop()}},e,this,[[13,20]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"shiftTrackStep",value:function(e,t,n){e.pattern.clear();var r=new F.a(this.sequencerEngine,void 0,void 0,e);r.on=!0,r.duration=e.pattern.length(),e.pattern.stepBuckets[t].steps[n]=r,e.updateSteps()}},{key:"tracks",get:function(){return this.sequencerEngine.tracks}},{key:"firstSampler",get:function(){return this.tracks[0].getSamplers()[0]}}]),n}(e)}(Va.a)),pc=n(566),dc=(n(158),n(774)),vc=(n(155),n(146),new dc.a,function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new pc.a.providers.Web3Provider(window.ethereum,"any"),e.next=3,n.send("eth_requestAccounts",[]);case 3:return r=e.sent,i=n.getSigner(),e.next=7,i.signMessage(t);case 7:return s=e.sent,e.abrupt("return",{flatSignature:s,splitSignature:pc.a.utils.splitSignature(s),account:r[0]});case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),mc=n(148),yc=n(179);function bc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return gc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gc(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function gc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("spore",{"spore hash":"ipfs hash of new spore sound",tokenID:"tokenID of spores.vision ERC720",sliderData:"recorded slider movements",modeData:"recorded mode changes"},"Creates a new spore",function(){return 1},{inlets:4});Object(Ca.a)("spore.sparse",{sliderData:"recorded slider changes"},"Creates a spare list baed on stepse",function(){return 1},{inlets:1});var Oc=function(e,t,n){e=e.slice(-16);for(var r=Math.pow(t,2),a=1,i=0;i<e.length;i+=4)r+=Math.pow(e[i+n],2),a++;return isNaN(r)?1:Math.sqrt(r/a)+.1*(e=e.slice(-4))[n]};Object(Ca.a)("spore.loadSpores",{list:"List of spore results"},"Loads a bunch of spore recordings as tracks, and outputs the associated heatmaps via the outlet",function(){return 2},{inlets:1,outlets:["audio buffers","spore heatmap datas"]});Object(Ca.a)("spore.convertList",{list:""},"Balls",function(){return 1},{inlets:1});var kc=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=0,i=bc(t),e.prev=3,i.s();case 5:if((s=i.n()).done){e.next=14;break}return o=s.value,c=new q.a(o),console.log("DOWNLOADING %s of %s",r++,t.length),e.next=11,c.fetchAudio();case 11:n.push(c.audioBuffer);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),i.e(e.t0);case 19:return e.prev=19,i.f(),e.finish(19);case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}},e,null,[[3,16,19,22]])}));return function(t){return e.apply(this,arguments)}}(),jc=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=bc(t),e.prev=2,r.s();case 4:if((i=r.n()).done){e.next=13;break}return s=i.value,e.t0=n,e.next=9,Ar.a.getJson(s);case 9:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t2=e.catch(2),r.e(e.t2);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}},e,null,[[2,15,18,21]])}));return function(t){return e.apply(this,arguments)}}();Object(Ca.a)("spore.getPlayRate",{list:""},"Balls",function(){return 1},{inlets:1});Object(Ca.a)("spore.stems",{});var wc=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,a={},i=bc(e);try{for(i.s();!(t=i.n()).done;){var s=t.value,o=Object(ea.a)(s,2),c=o[0],u=o[1];c>=n&&c<r&&(a[c]=u[3])}}catch(l){i.e(l)}finally{i.f()}return a},xc=function(e){var t=Object.keys(e)[Object.keys(e).length-1];for(var n in e)for(;void 0===e[n+1]&&!(t>=n);)e[n+1]=e[n],n++;return e};Object(Ca.a)("spore.skins",{},"Creates a spare list baed on stepse",function(){return 0},{inlets:0});var Sc={spore:function(e,t,n,r){return function(s){var o=Object(ea.a)(s,1)[0];if(n()&&r()){var c={sliderChanges:n(),modeChanges:r()};Ar.a.addJson(c).then(function(n){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return new Promise(function(){var r=Object(i.a)(a.a.mark(function r(i){var s,o,c,u,l,f,h;return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("new spore w data hash=",n),r.next=3,vc("A new spore.");case 3:(s=r.sent).account,s.flatSignature,o=s.splitSignature,c=o.r,u=o.s,l=o.v,f={r:c,s:u,v:l,message:"A new spore.",sporeHash:Object(mc.b)(e),dataHash:Object(mc.b)(n),tokenId:t},h="https://zequencer.io",window.location.hostname.includes("localhost")&&(h=""),fetch(h+"/newSpore/",{method:"POST",body:JSON.stringify(f),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){i(e.transactionHash)});case 12:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}())}(o,t(),n).then(function(t){e.sendMessage(e.outputByNumber(0),t)})})}}},"spore.skins":function(e){new Xo(e);return function(e){Object(ea.a)(e,1)[0]}},"spore.stems":function(e){new hc(e);return function(e){Object(ea.a)(e,1)[0]}},"spore.sparse":function(e){return function(e){var t,n=[],r=void 0,a=bc(Object(ea.a)(e,1)[0]);try{for(a.s();!(t=a.n()).done;){var i=t.value,s=Object(ea.a)(i,2),o=s[0],c=s[1];if(!r||r[0]!==o){r=[o,c],o||(o=0);var u=n.slice(-4);u.length<4&&(u=[0,0,0,0]);for(var l=4*n.length;l<o;l+=4)u=u.map(function(e){return Math.max(0,.9*e)}),n=[].concat(Object(h.a)(n),Object(h.a)(u));var f=Oc(n,c[0],0),p=Oc(n,c[1],1),d=Oc(n,c[2],2),v=Oc(n,c[3],3);n.push(f),n.push(p),n.push(d),n.push(v)}}}catch(m){a.e(m)}finally{a.f()}return[n]}},"spore.loadSpores":function(e){var t=void 0,n=void 0;return function(r){var a=Object(ea.a)(r,1)[0];a=a.slice(0,1),t?e.sendMessage(e.outputByNumber(0),t):kc(a.map(function(e){return e.sporeHash})).then(function(n){console.log("load spores returned w/ =",t),t=n,e.sendMessage(e.outputByNumber(0),n)}),n?e.sendMessage(e.outputByNumber(1),n):jc(a.map(function(e){return e.dataHash})).then(function(t){n=t,e.sendMessage(e.outputByNumber(1),t)})}},"spore.convertList":function(e){return function(e){var t,n={},r=bc(Object(ea.a)(e,1)[0]);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=Object(ea.a)(a,2),s=i[0],o=i[1];isNaN(s)&&(s=0),n[s]=o}}catch(c){r.e(c)}finally{r.f()}return[n]}},"spore.getPlayRate":function(e){return function(e){var t=Object(ea.a)(e,1)[0],n=t.sliderChanges,r=t.modeChanges;console.log(n);for(var a={},i=0;i<r.find(function(e){return 2===e[1]})[0];i++)a[i]=1;for(var s=0;s<r.length;s++){var o=Object(ea.a)(r[s],2),c=o[0],u=o[1];if(2===u){var l=r.slice(s+1).find(function(e){return 2===e[1]||-1===e[1]});a=Object(p.a)({},a,wc(n,c,l?l[0]:c+1))}else-1===u&&(a[c]=1)}return[xc(a)]}}};Object(Ca.a)("haptic.vibrate",{ms:"milliseconds to vibrate"},"Vibrates on mobile for specified time");function Pc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ec=function(e){Object(u.a)(n,e);var t=Pc(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newOutlet("on pressed"),r.newOutlet("on released"),r}return n}(Va.a);Object(Ca.a)("buttonPresser",{},"Sends a bang thru one outlet on press and thru another one release",function(){return 0},{inlets:0});function Tc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ac=function(e){Object(u.a)(n,e);var t=Tc(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).envelope=new Fn(r.sequencerEngine,r.sequencerEngine.mixSession,(new V.a).forZObject(r.zObject),0),r.envelope.attack=5,r.envelope.decay=90,r.envelope.sustain=.1,r.envelope.release=15,r.newInlet("modulate parameter",function(e){var t=Object(ea.a)(e,1)[0];return r.onParameter(t)}),r.newInlet("trigger attack release",function(e){var t=Object(ea.a)(e,1)[0];return r.onTriggerAttackRelease(t)}),r.newInlet("attack",function(e){var t=Object(ea.a)(e,1)[0];return r.envelope.attack=t}),r.newInlet("decay",function(e){var t=Object(ea.a)(e,1)[0];return r.envelope.decay=t}),r.newInlet("release",function(e){var t=Object(ea.a)(e,1)[0];return r.envelope.release=t}),r.newInlet("sustain",function(e){var t=Object(ea.a)(e,1)[0];return r.envelope.sustain=t}),r.newOutlet("depth mapped"),r}return Object(o.a)(n,[{key:"onParameter",value:function(e){if(Array.isArray(e)){var t=Object(ea.a)(e,4),n=t[0],r=t[1],a=t[2],i=t[3];if(r&&n){var s=n.parameters.find(function(e){return e.name.toLowerCase().includes(r.toLowerCase())});if(console.log("parameter found=",s),s&&s.audioParam){if(s.depthParameter||s.initDepth(),this.envelope.connect(s.audioParam,s,0),s.connectToDepth(void 0,this.envelope,!1),void 0!==a&&void 0!==i){var o=this.envelope.getScaleForParameter(s);o.min=a,o.max=i}console.log("sending depth mapped=",s.depthParameter),this.sendMessage("depth mapped",s.depthParameter)}}}}},{key:"onTriggerAttackRelease",value:function(e){var t=e.time,n=e.duration,r=e.velocity;this.envelope.triggerAttackRelease(n,t,r)}}]),n}(Va.a);Object(Ca.a)("envelope",{},"Creates a new envelope that can control parameters",function(){return 0},{inlets:0});var Mc={envelope:function(e){new Ac(e);return e.attributes["primary-color"]="#cb3737",e.attributes["secondary-color"]="#1c1c1c",function(){return 0}}},Rc=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(isNaN(e))return e;var n=Math.pow(10,t);return Math.round(n*e)/n},Cc=n(205),Nc=function(e){return function(e){var t=new Set;return function e(n){if(n&&"object"===typeof n){if(-1!==t.has(n))return!0;for(var r in t.add(n),n)if(n.hasOwnProperty(r)&&e(n[r]))return!0}return!1}(e)}(e)?Array.isArray(e)?JSON.stringify(e):"object":JSON.stringify(e)};function qc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ic=function(e){return function(e){Object(u.a)(n,e);var t=qc(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).attributes={},e.attributeCallbacks={},e.defaultAttributes={},e}return Object(o.a)(n,[{key:"newAttribute",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;this.attributes[e]=t,this.attributeCallbacks[e]=n,this.defaultAttributes[e]=t}},{key:"setAttribute",value:function(e,t){this.attributes[e]=t,this.attributeCallbacks[e]&&this.attributeCallbacks[e](t)}},{key:"getAttributesJson",value:function(){var e={};for(var t in this.attributes)this.attributes[t]!==this.defaultAttributes[t]&&(e[t]=this.attributes[t]);if(0!==Object.keys(e).length)return e}}]),n}(e)},_c=n(524);function Dc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Fc=function(e){Object(u.a)(n,e);var t=Dc(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yc.d,i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;return Object(s.a)(this,n),(r=t.call(this)).subSequence=e,r.sequencerEngine=e.sequencerEngine,r.text="",r.type=a,r.window={id:Object(S.uuid)()},a===yc.a?(r.message=yc.a,r.storedMesage=yc.a):a===yc.c&&(r.text=0),r.id=o||Object(S.uuid)(),r.sequencerEngine.idToObject[r.id]=Object(c.a)(r),i?r.newInlet("Input",function(e){r._onExecute?r._onExecute(e[0]):i.apply(void 0,[e[0]].concat(Object(h.a)(e.splice(1))))}):r.newInlet("Input",function(e){r.type!==yc.c||isNaN(e[0])?"bang"===e[0]?r.execute():(r.storedMessage=r.pipeText(e[0]),r.execute(r.storedMessage)):(r._text=e[0],r.storedMessage=e[0],r.execute(r.storedMessage))}),a!==yc.a&&r.newInlet("Replace",function(e){return r.onReplaceText(e)}),r.newOutlet("Output"),a!==yc.c&&r.newOutlet("Message Send"),r.min=0,r.max=100,r.round=!1,r.newAttribute("primary-color"),r.newAttribute("secondary-color"),r.newAttribute("background-color"),r.newAttribute("width",0),r.newAttribute("align to center",!1),r.newAttribute("Include in Presentation",!1),r.newAttribute("custom name"),r.newAttribute("scripting name"),r.newAttribute("glsl uniform",!1,function(e){return r.setupUniform(e)}),r}return Object(o.a)(n,[{key:"isGLUniform",get:function(){return this.attributes["glsl uniform"]}},{key:"setupUniform",value:function(e){this.glUniform=e?Di({id:this.id},function(){return"znumber"}):void 0,this.refresh()}},{key:"getObjectType",value:function(){return ua.d}},{key:"getAllParameters",value:function(){return[]}},{key:"delete",value:function(){if(this.isInlet){var e="Input "+this.inletNumber;this.subSequence.deleteInlet(e,this.inletNumber)}if(this.isOutlet){var t="Output "+this.outletNumber;this.subSequence.deleteOutlet(t,this.outletNumber)}this.subSequence.deleteNode(this)}},{key:"getJson",value:function(){var e={id:this.id,isDeleted:this.isDeleted,type:this.type,text:this._text,message:this.type===yc.c?this.message:void 0,inletNumber:this.inletNumber,outletNumber:this.outletNumber,min:this.min,max:this.max,round:this.round},t=this.getAttributesJson();return t&&(e.attributes=t),e}},{key:"interpolate",value:function(e,t,n){e&&t&&this.type===yc.c&&(this._text=e.text*n+t.text*(1-n),this.message=this.text,this.storedMessage=this.text,this.execute(this._text))}},{key:"fromValueJson",value:function(e){this._text=e.text,this.message=this.text,this.storedMessage=this.text,this.execute(this._text)}},{key:"fromJson",value:function(e,t){if(t||(this.id=e.id,this.sequencerEngine.idToObject[this.id]=this),void 0!==e.type&&(this.type=e.type),this.isDeleted=e.isDeleted,e.type,yc.c,this.text=e.text,void 0!==e.type&&(this.type=e.type,this.type===yc.a&&(this.message=yc.a,this.storedMessage=yc.a)),this.inletNumber=e.inletNumber,this.outletNumber=e.outletNumber,void 0!==this.inletNumber&&(this.isInlet=!0),void 0!==this.outletNumber&&(this.isOutlet=!0),void 0!==e.min&&(this.min=e.min),void 0!==e.max&&(this.max=e.max),void 0!==e.round&&(this.round=e.round),e.attributes)for(var n in e.attributes)this.setAttribute(n,e.attributes[n]);this.execute(this._text)}},{key:"sendReplacement",value:function(e){if(e=e[0],"string"===typeof this.message){var t=this.message.replaceAll("$1",e);this.execute(t)}else this.execute(e)}},{key:"pipeText",value:function(e){if(this.type===yc.b){var t=Array.isArray(e)?e:[e];return this.message.map(function(e){var n=e;if("string"===typeof e){for(var r=0;r<t.length;r++)n=n.replaceAll("$"+(r+1),t[r]);Object(pe.a)(n)&&(n=parseFloat(n))}return n})}if("string"!==typeof this.message)return this.message;var n=this.message;if(Array.isArray(e))for(var r=0;r<e.length;r++)n=n.replaceAll("$"+(r+1),Rc(e[r],3));else n="string"===typeof e?n.replaceAll("$1",e):n.replaceAll("$1",Rc(e,3));return n}},{key:"onReplaceText",value:function(e){if(null!==e[0]){if(this.message=e[0],this.lastMessage=this.message,Array.isArray(this.message))this._text=this.message.map(function(e){return"object"===typeof e?Nc(e):e}).join(" ");else if(ArrayBuffer.isView(this.message))this._text=Array.from(this.message).join(" ");else if(Array.isArray(e[0]))this._text=e[0].join(" ");else if("string"===typeof e[0]||"number"===typeof e[0])this._text=e[0];else if(e[0])if(e[0].getJson)this._text=Nc(e[0].getJson());else try{this._text=Nc(e[0])}catch(t){this._text="input"}this.storedMessage=this.message}}},{key:"text",set:function(e){if(this.subSequence.propagate(Object(Cc.s)(this,e)),this.type===yc.c)return this._text=e,this.message=e,this.storedMessage=this.message,void this.onValueChange(this.message);e||(e=""),e=e.toString(),this._text=e,this.onValueChange(e);var t=e.split(" ").filter(function(e){return""!=e});if(t.length>1){var n=[];this.type=yc.b;try{if((n=t.map(function(e){return e.startsWith("$")?e:parseFloat(e)})).some(function(e){return(!e.startsWith||!e.startsWith("$"))&&isNaN(e)}))return this.message=e,this.storedMessage=this.message,void(this.type=yc.d)}catch(r){return this.type=yc.d,this.storedMessage=this.message,void(this.message=e)}this.message=n,this.storedMessage=this.message}else try{this.message=Object(pe.a)(e)?parseFloat(e):e,this.storedMessage=this.message,isNaN(this.message)&&(this.message=e)}catch(r){this.message=e,this.storedMessage=this.message}}},{key:"refresh",value:function(){this.lastSentMessage&&this.execute(this.lastSentMessage,!0)}},{key:"execute",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.storedMessage,t=arguments.length>1?arguments[1]:void 0;if(this.lastSentMessage=e,this.glUniform){window.stopRender=!0;var n=this.glUniform([e],t);n&&this.sendMessage("Output",n),window.stopRender=!1}else this.sendMessage("Output",e);this.sendMessage("Message Send",yc.a)}},{key:"duplicate",value:function(){var e=this.getJson(),t=this.state.windows.windowPositions[this.id],n=t.x,r=t.y,a=this.width||200,i=(this.width,this.subSequence.createZMessage(n+a,r,this.dataType));i.fromJson(e,!0);var s=this.state.windows.presentationWindowPositions[this.id];s&&this.dispatch(Object(C.Rc)(i.id,{x:s.x+a,y:s.y}))}},{key:"onPosition",value:function(e){var t=Object(ea.a)(e,2),n=t[0],r=t[1];this.dispatch(Object(C.Rc)(this.id,{x:n,y:r})),this.dispatch(Object(C.Pe)(this.id,{x:n,y:r}))}}]),n}(Object(_c.a)(Ic(va(Object(Aa.a)(function(){return function e(){Object(s.a)(this,e)}}())))));function Lc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Bc=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=new Fc(e.subSequence,yc.c);return a.text=t,a.min=n,a.max=r,a},zc=function(e){Object(u.a)(n,e);var t=Lc(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).x=Bc(Object(c.a)(r),0),r.y=Bc(Object(c.a)(r),0),r.z=Bc(Object(c.a)(r),0),r.zObject.hasInletFields=!0,r.newInlet("x",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.x,t)}),r.newInlet("y",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.y,t)}),r.newInlet("z",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.z,t)}),r.newOutlet("Vec3"),r}return Object(o.a)(n,[{key:"on",value:function(e,t){isNaN(t)||(e.text=t,this.sendObject())}},{key:"sendObject",value:function(){var e=[this.x._text,this.y._text,this.z._text];this.sendMessage("Vec3",e)}},{key:"getJson",value:function(){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{x:this.x._text,y:this.y._text,z:this.z._text})}},{key:"fromJson",value:function(e,t){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.x.text=e.x,this.y.text=e.y,this.z.text=e.z}}]),n}(Va.a);function Jc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Vc=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-10,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,a=new Fc(e.subSequence,yc.c);return a.text=t,a.min=n,a.max=r,a},Hc=function(e){Object(u.a)(n,e);var t=Jc(n);function n(e){var r;Object(s.a)(this,n),(r=t.call(this,e)).x=Vc(Object(c.a)(r),0,-1,1),r.y=Vc(Object(c.a)(r),0,-1,1),r.zObject.hasInletFields=!0,r.newInlet("x",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.x,t)}),r.newInlet("y",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.y,t)}),r.newOutlet("List"),r.newOutlet("Vec2");var a=r.id.replaceAll("-","");return r.xUniform=Di({},function(){return"vec2x"+a},function(){return!1}),r.yUniform=Di({},function(){return"vec2y"+a},function(){return!1}),r.vec2=Yi(r.zObject,function(){return r.yUniform([r.y._text],!0)}),r}return Object(o.a)(n,[{key:"on",value:function(e,t){isNaN(t)||(e.text=t,this.sendObject())}},{key:"sendObject",value:function(){var e=[this.x._text,this.y._text],t=this.xUniform([this.x._text],!0);this.yUniform([this.y._text],!0);this.sendMessage("List",e),this.sendMessage("Vec2",this.vec2([t]))}},{key:"getJson",value:function(){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{x:this.x._text,y:this.y._text})}},{key:"fromJson",value:function(e,t){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.x.text=e.x,this.y.text=e.y}}]),n}(Va.a);Object(Ca.a)("vec3",{},"Creates a 3-component list made out of numbers",function(){return 0},{inlets:0});Object(Ca.a)("vec2",{},"Creates a 2-component list made out of numbers",function(){return 0},{inlets:0});function Uc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Gc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gc(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Gc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("rubik.init",{},"Initializes a rubiks cube returning a list of indices");var Wc=[6,3,0,7,4,1,8,5,2],Kc=[2,5,8,1,4,7,0,3,6];Object(Ca.a)("rubik.turnFace",{face:"List of indices representing the face being turned",direction:"0 for left and 1 for right",dimension:"x or y"},"Turn a face (represented as list of indices) either left (0) or right (1)",function(){return 1},{inlets:3});Object(Ca.a)("rubik.getFace",{indices:"list of indices of the rubik cube (in its current configuration)",value:"value in dimension we want to acces",dimension:"x,y,z"},"Gets a list of indices representing a desired face",function(){return 1},{inlets:3});var Qc=[[0,1,2,3,4,5,6,7,8],[9,10,11,12,13,14,15,16,17],[18,19,20,21,22,23,24,25,26]],Zc=[[0,1,2,9,10,11,18,19,20],[3,4,5,12,13,14,21,22,23],[6,7,8,15,16,17,24,25,26]];Object(Ca.a)("rubik.setFace",{indices:"list of indices of the rubik cube (in its current configuration)",value:"value in dimension we want to acces",dimension:"x,y,z"},"Sets a list of indices representing a desired face in the rubiks indices and return the new cube",function(){return 1},{inlets:4});Object(Ca.a)("rubik.applyIndices",{"list to shuffle":"",indices:""},"Transforms a given a list using the indices passed in the right inlet",function(){return 1},{inlets:2});var Yc={"rubik.turnFace":function(e,t,n){return function(e){var r,a=Object(ea.a)(e,1)[0],i=[],s=0,o=Uc(("y"===n()?!t():t())?Wc:Kc);try{for(o.s();!(r=o.n()).done;){var c=r.value;i[s]=a[c],s++}}catch(u){o.e(u)}finally{o.f()}return[i]}},"rubik.init":function(){return function(e){Object(_a.a)(e);for(var t=[],n=0;n<27;n++)t.push(n);return[t]}},"rubik.getFace":function(e,t,n){return function(e){for(var r=Object(ea.a)(e,1)[0],a=t(),i="y"===n()?Qc[a]:Zc[a],s=[],o=0;o<i.length;o++)s.push(r[i[o]]);return[s]}},"rubik.setFace":function(e,t,n,r){return function(e){var a=Object(ea.a)(e,1)[0],i=n(),s=r(),o=t();Object(h.a)(a),a=Object(h.a)(a);for(var c="y"===s?Qc[i]:Zc[i],u=0;u<c.length;u++)a[c[u]]=o[u];return[a]}},"rubik.applyIndices":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0],r=t();if(!r)return[n];for(var a=[],i=0;i<n.length;i++){var s=n[i];a[r[i]]=s}return[a]}}};Object(Ca.a)("list.fillIndex",{size:""},"Creates a list of size n with elements from 0...n");var Xc={"list.fillIndex":function(){return function(e){for(var t=Object(ea.a)(e,1)[0],n=[],r=0;r<t;r++)n.push(r);return[n]}}};function $c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return eu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eu(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function eu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var tu=["A","B","C","D","E"];Object(Ca.a)("audioFX",{name:""},"Creates an audio fx (to be put somewhere",function(){return 1},{inlets:2});Object(Ca.a)("mixChannel",{},"Controls effects in the mix channel");Object(Ca.a)("sendChannel",{name:""},"Controls effects in a send channel",function(){return 2},{outlets:["Effects","Send"]});Object(Ca.a)("sendVolumes",{name:""},"Controls send volumes of tracks",function(e){return 1},{});Object(Ca.a)("groupSendVolumes",{name:""},"Controls send volumes of groups of tracks",function(e){return 1},{});var nu={audioFX:function(e,t){return function(n){Object(ea.a)(n,1)[0];var r=Object(ba.b)(t(),e.sequencerEngine);if(r)return[r]}},mixChannel:function(e){return function(t){var n=Object(ea.a)(t,1)[0],r=e.sequencerEngine.channelMixer.masterChannel.effectsChain,a=r.effects.find(function(e){return e.name===n.name});return a?[a]:(r.addEffect(n),[n])}},sendChannel:function(e,t){return function(n){var r=Object(ea.a)(n,1)[0],a=e.sequencerEngine.sends.sends.find(function(e){return e.name.toLowerCase()===t().toLowerCase()}),i=a.effectsChain,s=i.effects.find(function(e){return e.name===r.name});return s?[s,a]:(i.addEffect(r),[r,a])}},sendVolumes:function(e,t){return function(n){var r=Object(ea.a)(n,1)[0];if(Array.isArray(r)){var a=Object(ea.a)(r,2),i=a[0],s=a[1],o=e.sequencerEngine.tracks[i];if(o){var c=o.sendNodeVolumeParameters[tu.indexOf(t())];if(c){var u=bv(s,-80,2,1);c.set(u,!1)}}}}},groupSendVolumes:function(e,t){return function(n){var r=Object(ea.a)(n,1)[0];if(Array.isArray(r)){var a=Object(ea.a)(r,2),i=a[0],s=a[1],o=e.sequencerEngine.groups.groups[i];if(o){var c,u=$c(o.tracks);try{for(u.s();!(c=u.n()).done;){var l=c.value;if(!l)return;var f=l.sendNodeVolumeParameters[tu.indexOf(t())];if(!f)return;var h=bv(s,-80,2,1);f.set(h,!1)}}catch(p){u.e(p)}finally{u.f()}}}}}};function ru(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return au(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return au(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function au(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function iu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var su=function(e){Object(u.a)(n,e);var t=iu(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newInlet("Playback Speed",function(e){var t=Object(ea.a)(e,1)[0];return r.onPlaybackSpeed(t)}),r.newInlet("bpm changed",function(e){var t=Object(ea.a)(e,1)[0];r.bpm=t,r.sendMessage("bpm",t)}),r.newInlet("snap detune",function(){r.snapDetune()}),r.newInlet("clear detune",function(){r.lastDetune=void 0}),r.newInlet("Detune Only Speed",function(e){var t=Object(ea.a)(e,1)[0];r.onPlaybackSpeed(t,!0)}),r.newOutlet("bpm"),r.newOutlet("detune"),r.bpm=r.sequencerEngine.bpm,r}return Object(o.a)(n,[{key:"snapDetune",value:function(){var e=this;this.lastDetune&&function(){var t=e.lastDetune;t-=t%100;var n,r=ru(e.sequencerEngine.tracks);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.instrument?a.instrument.detuneParameter&&a.instrument.detuneParameter.set(t,!1,void 0,W.a.Master.context.currentTime,500):a.getSamplers().forEach(function(e){return e.detuneParameter.set(t,!1,void 0,W.a.Master.context.currentTime,500)})}}catch(i){r.e(i)}finally{r.f()}}()}},{key:"onPlaybackSpeed",value:function(e,t){var n=50+(this.bpm-50)*(1-e),r=2e3*(1-e)-2e3;this.lastDetune=r,t||this.sequencerEngine.bpmParameter.set(n,!1);var a,i=ru(this.sequencerEngine.tracks);try{for(i.s();!(a=i.n()).done;){var s=a.value;s.instrument?s.instrument.detuneParameter&&s.instrument.detuneParameter.set(r,!1):s.getSamplers().forEach(function(e){return e.detuneParameter.set(r,!1)})}}catch(o){i.e(o)}finally{i.f()}t||this.sendMessage("bpm",n),r-=r%100,this.sendMessage("detune",r)}}]),n}(Va.a);Object(Ca.a)("playback",{},"",function(){return 0},{inlets:0});function ou(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return cu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cu(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function cu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function uu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var lu=function(e){Object(u.a)(n,e);var t=uu(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newInlet("group volumes",function(e){var t=Object(ea.a)(e,1)[0];return r.onLevels(t)}),r.newOutlet("group volumes "),r.newOutlet("group levels"),r.sequencerEngine.groups.zObject=Object(c.a)(r),r.sequencerEngine.groups.startSendingLevels(),r}return Object(o.a)(n,[{key:"groups",get:function(){return this.sequencerEngine.groups.groups}},{key:"sendLevels",value:function(){var e,t=[],n=ou(this.groups);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r){var a=r.volume;t.push(a<mv?0:Math.pow((a-mv)/(1-mv),window.ROOTY))}else t.push(0)}}catch(i){n.e(i)}finally{n.f()}this.sendMessage("group volumes ",t)}},{key:"onLevels",value:function(e){console.log("on levels=",e);for(var t=0;t<e.length;t++){var n=e[t];if(!isNaN(n)){var r=this.groups[t];if(r){var a=bv(n,mv,1,1);r.volume!==a&&(console.log("sending %s to group",n,r,r.volume),r.setVolume(a,!1,!1))}}}}}]),n}(Va.a);Object(Ca.a)("groups",{"":""},"Controls groups",function(){return 0},{inlets:0});Object(Ca.a)("repeatList",{listToRepeat:"","number of repeats":""},"repeats an inputed list for a number of times",function(){return 1},{inlets:2});Object(Ca.a)("list.coordTexture",{"list of coordinates":""},"Creates a 4 dimensional list out of 2 dimensional coordinates");var fu=function(e){return Math.max(0,Math.min(255,127+127*e))};Object(Ca.a)("fakeNormalize",{array:"",factor:""},"F",function(){return 1},{inlets:2});Object(Ca.a)("normalizeDecimal",{array:"",factor:""},"F",function(){return 1},{inlets:2});Object(Ca.a)("maxBin",{array:""},"F",function(){return 1},{inlets:1});var hu={maxBin:function(e,t){return function(e){for(var t=Object(ea.a)(e,1)[0],n=-1e7,r=-1,a=0;a<t.length;a++)t[a]>n&&(r=a,n=t[a]);return[r]}},fakeNormalize:function(e,t){return function(e){for(var n=Object(ea.a)(e,1)[0],r=0;r<n.length;r++)n[r]=(n[r]+1)/2*t();return[n]}},repeatList:function(e,t){return function(e){for(var n=Object(ea.a)(e,1)[0],r=[],a=t()||1,i=0;i<a;i++)for(var s=0;s<n.length;s++)r.push(n[s]);return[r]}},"list.coordTexture":function(e){return function(e){for(var t=Object(ea.a)(e,1)[0],n=[],r=0;r<t.length;r+=2){var a=fu(t[r]),i=fu(t[r+1]);n.push(a),n.push(i),n.push(0),n.push(0)}return[n]}},normalizeDecimal:function(e,t){return function(e){for(var n=Object(ea.a)(e,1)[0],r=0;r<n.length;r++)n[r]=Math.max(0,Math.min(1,(n[r]- -160)/164))*t();return[n]}}};Object(Ca.a)("hexToRGB",{"hexadecimal color string":""},"Returns rgb/rgba values in 3/4-part array for hexadecimal string");var pu={hexToRGB:function(e){return function(e){var t=Object(ea.a)(e,1)[0];if("string"===typeof t&&"#"===t[0]){var n=(t=t.slice(1)).slice(0,2),r=t.slice(2,4),a=t.slice(4,6),i=t.slice(6,8),s=[parseInt(n,16)/255,parseInt(r,16)/255,parseInt(a,16)/255];return""!==i&&s.push(parseInt(i,16)/255),[s]}}}},du={moveTo:function(e,t,n,r){t.moveTo(n,r)},clear:function(e,t){t.clearRect(0,0,2*e.zObject.width,2*e.zObject.height)},rect:function(e,t,n,r,a,i){t.beginPath(),t.rect(n,r,a,i)},lineTo:function(e,t,n,r){t.lineTo(n,r)},beginPath:function(e,t){t.beginPath()},closePath:function(e,t){t.closePath()},circle:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;t.beginPath(),a>0&&t.arc(n,r,a,i,s)},stroke:function(e,t,n){t.strokeStyle=n,t.stroke()},lineWidth:function(e,t,n){t.lineWidth=n},fill:function(e,t,n){t.fillStyle=n,t.fill()},triangle:function(e,t,n,r,a,i,s,o){t.beginPath(),t.moveTo(n,r),t.lineTo(a,i),t.lineTo(s,o),t.closePath()}},vu=(n(1753),Object(p.a)({},du,{drawArray:function(e,t,n,r,a){t.fillStyle=r;for(var i=0;i<a.length;i+=2){var s=a[i],o=a[i+1];if(!(s>e.zObject.width||o>e.zObject.height)){t.beginPath();var c=s%n;s-=c,s+=n-c,o-=o%n,t.rect(s,o,n,n),t.fill()}}},drawTriangles:function(e,t,n,r){if(!window.arrDebug){t.strokeStyle=n;for(var a=0;a<r.length;a+=6)t.beginPath(),t.moveTo(r[a],r[a+1]),t.lineTo(r[a+2],r[a+3]),t.lineTo(r[a+4],r[a+5]),t.stroke()}}}));function mu(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return yu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yu(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function yu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var gu=function(e){Object(u.a)(n,e);var t=bu(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newInlet("operation",function(e){var t=Object(ea.a)(e,1)[0];return r.onOperation(t)}),r.customAttributes=[],r}return Object(o.a)(n,[{key:"subpatch",get:function(){if(this.subSequence.zObject)return this.subSequence}},{key:"loadBang",value:function(){if(this.subpatch){var e=this.subpatch.zObject.attributes;for(var t in e)this.subpatch.zObject.setAttribute(t,e[t])}}},{key:"onOperation",value:function(e){var t=this;if(this.subpatch){var n=e.split(" ");"create"===n[0]&&(this.customAttributes.push(n[1]),this.newOutlet("Attribute "+n[1]),this.subpatch.zObject.newAttribute(n[1],"",function(e){t.sendMessage("Attribute "+n[1],e)}))}}},{key:"getJson",value:function(e){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e),{customAttributes:this.customAttributes})}},{key:"fromJson",value:function(e,t){if(Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e),e.customAttributes){e.customAttributes=Array.from(new Set(e.customAttributes));var r,a=mu(e.customAttributes);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.onOperation("create "+i)}}catch(s){a.e(s)}finally{a.f()}}}}]),n}(Va.a);Object(Ca.a)("attributes",{operation:""},"Allows creating and controlling attributes for the containing subpatch dynamically",function(){return 0},{inlets:0});Object(Ca.a)("print",{message:"to print"},"prints to javascript console");function Ou(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ku(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ku(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ku(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ju(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wu=function(e){Object(u.a)(n,e);var t=ju(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newInlet("ADSR Levels",function(e){return r.onADSRLevels(e[0])}),r.newOutlet("ADSR levels"),r.newInlet("Oscillator Levels",function(e){return r.onOscillatorLevels(e[0])}),r.newOutlet("Oscillator levels"),r}return Object(o.a)(n,[{key:"sendOscillatorLevels",value:function(){if(this.synth){var e=this.synth.oscillatorNodes.map(function(e){return e.oscillatorLevelParameter.get(!0)});this.sendMessage("Oscillator levels",e)}}},{key:"sendADSRLevels",value:function(){if(this.synth){this.synth.ampEnvelope;this.sendMessage("ADSR levels",[this.attack,this.decay,this.sustain,this.release])}}},{key:"amp",get:function(){return this.synth.ampEnvelope}},{key:"attack",get:function(){if(this.synth)return Su(this.amp.attack,this.amp.attackParameter.min,this.amp.attackParameter.max)},set:function(e){if(this.synth){var t=xu(e,this.amp.attackParameter.min,this.amp.attackParameter.max);t!==this.amp.attack&&this.amp.attackParameter.set(t,!1)}}},{key:"decay",get:function(){if(this.synth)return Su(this.amp.decay,this.amp.decayParameter.min,this.amp.decayParameter.max)},set:function(e){if(this.synth){var t=xu(e,this.amp.decayParameter.min,this.amp.decayParameter.max);t!==this.amp.decay&&this.amp.decayParameter.set(t,!1)}}},{key:"sustain",get:function(){if(this.synth)return this.amp.sustain},set:function(e){this.synth&&e!==this.amp.sustain&&this.amp.sustainParameter.set(e,!1)}},{key:"release",get:function(){if(this.synth)return Su(this.amp.release,this.amp.releaseParameter.min,this.amp.releaseParameter.max)},set:function(e){if(this.synth){var t=xu(e,this.amp.releaseParameter.min,this.amp.releaseParameter.max);t!==this.amp.release&&this.amp.releaseParameter.set(t,!1)}}},{key:"onOscillatorLevels",value:function(e){this.synth&&Array.isArray(e)&&this.synth.oscillatorNodes.forEach(function(t,n){var r=e[n%e.length];r!==t.oscillatorLevelParameter.get(!0)&&t.oscillatorLevelParameter.set(r,!1)})}},{key:"onADSRLevels",value:function(e){this.synth&&Array.isArray(e)&&(isNaN(e[0])||(this.attack=e[0]),isNaN(e[1])||(this.decay=e[1]),isNaN(e[2])||(this.sustain=e[2]),isNaN(e[3])||(this.release=e[3]))}},{key:"linkSynth",value:function(e){this.synth=e,this.synth.controller=this}},{key:"getJson",value:function(e){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e),{synthId:this.synth.id})}},{key:"fromJson",value:function(e,t){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t);var r,a=Ou(this.subSequence.getRootSubSequence().tracks);try{for(a.s();!(r=a.n()).done;){var i=r.value;i&&i.instrument&&i.instrument.id===e.synthId&&this.linkSynth(i.instrument)}}catch(s){a.e(s)}finally{a.f()}}}]),n}(Va.a),xu=function(e,t,n){return(e=Math.max(0,e))*(n-t)},Su=function(e,t,n){return e=Math.max(0,e),Math.pow((e-t)/(n-t),1)};Object(Ca.a)("synthcontrol",{},"FUCK",function(){return 0},{inlets:0});Object(Ca.a)("switch",{switchNumber:""},"switch inlets based on first inlet",void 0,{isHot:!0,inlets:function(e){return e+1}});Object(Ca.a)("outSwitch",{switchNumber:""},"switch inlets based on first inlet",function(e){return e},{inlets:function(e){return 2}});function Pu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}console.error;window.errors=[],console.error=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];window.errors.push(t)};var Eu=function(e){Object(u.a)(n,e);var t=Pu(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newInlet("vertex shader",function(e){var t=Object(ea.a)(e,1)[0];return r.onVertexShader(t)}),r.newInlet("fragment shader",function(e){var t=Object(ea.a)(e,1)[0];return r.onFragmentShader(t)}),r.newOutlet("material"),r.uniforms={},r}return Object(o.a)(n,[{key:"getJson",value:function(e){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e),{uniforms:Object.keys(this.uniforms)})}},{key:"fromJson",value:function(e,t){var r=this;Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),e.uniforms&&e.uniforms.forEach(function(e){return r.createUniform(e,0)})}},{key:"onVertexShader",value:function(e){this.vertexShader=e,this.updateMaterial()}},{key:"onFragmentShader",value:function(e){this.fragmentShader=e,this.updateMaterial()}},{key:"createUniform",value:function(e,t){var n=this;if(e in this.uniforms)return this.uniforms[e].value=t,isNaN(t)&&(this.uniforms[e].type="t"),void(this.material&&(this.material.uniformsNeedUpdate=!0));this.uniforms[e]={value:t},isNaN(t)&&(this.uniforms[e].type="t"),this.newInlet(e,function(t){var r=Object(ea.a)(t,1)[0];n.uniforms[e].value=r,isNaN(r)&&(n.uniforms[e].type="t"),n.material&&(n.material.uniformsNeedUpdate=!0,n.sendMessage("material",n.material))})}},{key:"updateMaterial",value:function(){var e=(new Date).getTime();if(this.fragmentShader&&this.vertexShader){window.errors.length;this.material?(this.material.fragmentShader=this.fragmentShader,this.material.vertexShader=this.vertexShader,this.material.needsUpdate=!0):this.material=new ks.T({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,transparent:!0,depthWrite:!1,blending:ks.H});var t=(new Date).getTime();console.log("compilation took %s ms",t-e);window.errors.length;this.sendMessage("material",this.material)}}}]),n}(Va.a),Tu=0;Object(Ca.a)("gl.material",{fragColor:"",size:""},"Outputs a material from the shader expression given in the inlet",void 0,{tags:"GLSL",isHot:!0,inlets:2,connects:{object:"three.planeRenderer"}});window.fallBackUpdate={};var Au=function(e){return function(t,n){var r=t.code,a=t.uniforms,i=t.variables,s=t.functions,o="\n";for(var c in a)if(!c.includes("$")){var u=a[c].value;void 0===u&&(u=0);var l=Array.isArray(u)&&Array.isArray(u[0])?"mat3":4===u.length?"vec4":3==u.length?"vec3":2==u.length?"vec2":isNaN(u)?"sampler2D":"float";c.includes("tex")&&(l="sampler2D"),o+="uniform "+l+" "+c+"; \n"}!function(e,t,n){var r=function(r){if(t[r].update)return"continue";t[r].canvases||(t[r].canvases={}),t[r].update=function(){for(var e in t[r].canvases){var n;(n=t[r].canvases)[e].apply(n,arguments)}},t[r].canvases[n.id]=function(t,a){if(Array.isArray(t))if(Array.isArray(t[0])){if(3===t.length){var i=new ks.y;i.set.apply(i,Object(h.a)(t.flat(6))),t=i}}else 2===t.length?t=new ks.bb(t[0],t[1]):3===t.length?t=new ks.cb(t[0],t[1],t[2]):4===t.length&&(t=new ks.db(t[0],t[1],t[2],t[3]));e.createUniform(r,t),window.stopRender||a||n.sendMessage(n.outputByNumber(0),e.material)};var a=t[r].value;if(Array.isArray(a))if(Array.isArray(a[0])){if(3===a.length){var i=new ks.y;i.set.apply(i,Object(h.a)(a.flat(6))),a=i}}else 2===a.length?a=new ks.bb(a[0],a[1]):3===a.length?a=new ks.cb(a[0],a[1],a[2]):4===a.length&&(a=new ks.db(a[0],a[1],a[2],a[3]));window.fallBackUpdate[r]=t[r].update,e.createUniform(r,a)};for(var a in t)r(a)}(n,a,e),o+="\n\nconst float EPSILON = 0.0001;\n#define PI 3.141592653589793\n\n#define cx_mul(a, b) vec2(a.x*b.x - a.y*b.y, a.x*b.y + a.y*b.x)\n#define cx_div(a, b) vec2(((a.x*b.x + a.y*b.y)/(b.x*b.x + b.y*b.y)),((a.y*b.x - a.x*b.y)/(b.x*b.x + b.y*b.y)))\n#define cx_sin(a) vec2(sin(a.x) * cosh(a.y), cos(a.x) * sinh(a.y))\n#define cx_cos(a) vec2(cos(a.x) * cosh(a.y), -sin(a.x) * sinh(a.y))\n\n// Identity matrix.\nconst mat3 identity =  mat3(\n        vec3(1, 0, 0),\n        vec3(0, 1, 0),\n        vec3(0, 0, 1)\n    );\n\nmat2 rotate2D(float angle) {\n    return mat2(\ncos(angle), -sin(angle),sin(angle),cos(angle));\n}\n\nmat4 lookAt(vec3 eye, vec3 target, vec3 up) {\n    vec3 z = normalize(eye - target);\n    vec3 x = normalize(cross(up, z));\n    vec3 y = normalize(cross(z, x));\n    mat4 translation = mat4(\n        vec4(1.0, 0.0, 0.0, eye.x),\n    \tvec4(0.0, 1.0, 0.0, eye.y),\n        vec4(0.0, 0.0, 1.0, eye.z),\n        vec4(0.0, 0.0, 0.0, 1.0)\n    );\n    mat4 rotation = ".concat(x.isMobile?"translation":"transpose(mat4(vec4(x, 0.0),vec4(y, 0.0),vec4(z, 0.0),vec4(0.0, 0.0, 0.0, 1.0)))",";\n    return translation * rotation;\n}\n\nvec3 getRayDir(mat4 camera, float fov) {\n    fov = radians(fov);\n    vec2 p = 1.0*((gl_FragCoord.xy-vec2(width, height)))/vec2(width, height);\n    vec2 h = vec2(\n        tan(fov / 2.0) * (width / height), \n        tan(fov / 2.0)\n    );\n    vec3 pCam = vec3(p * h, -1.0);\n    return normalize((").concat(x.isMobile?"camera":"inverse(camera)"," * vec4(pCam, 0.0)).xyz);\n}\n\nfloat sdRoundBoxCoord( vec2 p, vec2 off, vec2 b, float r, mat3 transform, float angle ) \n{\n  off -= vec2(0.0, offset_v);\n  vec3 p3 = vec3(p, 0.0);\n  vec3 off3 = vec3(off, 0.0);\n  p3 = (p3 - off3); //*transform;\n  p.x = p3.x;\n  p.y = p3.y;\n  if (angle != 0.0) {\n  p *= rotate2D(angle);\n  }\n  vec2 q = abs(p)-b+r;\n  return min(max(q.x,q.y),0.0) + length(max(q,0.)) - r;\n}\n\nfloat sdRoundBox3DCoord( vec3 p, vec3 off, vec3 b, float r, mat3 transform, float pivot) \n{\n  vec3 q = abs(p) - b;\n  return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0) - r;\n}\n\nfloat sdRoundBox( vec2 off, vec2 b, float r ) \n{\n  off -= vec2(0.0, offset_v);\n  vec2 p = (1.0*gl_FragCoord.xy-vec2(width, height))/height;\n  return sdRoundBoxCoord(p, off, b, r, identity, 0.0);\n}\n\nfloat ATan2(float x, float y)\n{\n    float angle = asin(x) > 0.0 ? acos(y) : -acos(y);\n    return angle;\n}\n\nvec3 hsl2rgb(vec3 c) {\n    vec3 rgb = clamp(abs(mod(c.x * 6.0 + vec3(0.0,4.0,2.0), 6.0) - 3.0) - 1.0, 0.0, 1.0);\n        return c.z + c.y * (rgb - 0.5) * (1.0 - abs(2.0 * c.z - 1.0));\n}\nvec3 rgb2hsl(vec3 c) {\n    float h = 0.0;\n    float s = 0.0;\n    float l = 0.0;\n    float r = c.r;\n    float g = c.g;\n    float b = c.b;\n    float cMin = min( r, min( g, b ) );\n    float cMax = max( r, max( g, b ) );\n    l = ( cMax + cMin ) / 2.0;\n    if ( cMax > cMin ) {\n        float cDelta = cMax - cMin;\n        s = l < .0 ? cDelta / ( cMax + cMin ) : cDelta / ( 2.0 - ( cMax + cMin ) );\n        if ( r == cMax ) {\n            h = ( g - b ) / cDelta;\n        } else if ( g == cMax ) {\n            h = 2.0 + ( b - r ) / cDelta;\n        } else {\n            h = 4.0 + ( r - g ) / cDelta;\n        }\n        if ( h < 0.0) {\n            h += 6.0;\n        }\n        h = h / 6.0;\n     }\n     return vec3( h, s, l );\n}\n\nvec4 rainbow(float level)\n{\n\t/*\n\t\tTarget colors\n\t\t=============\n\t\t\n\t\tL  x   color\n\t\t0  0.0 vec4(1.0, 0.0, 0.0, 1.0);\n\t\t1  0.2 vec4(1.0, 0.5, 0.0, 1.0);\n\t\t2  0.4 vec4(1.0, 1.0, 0.0, 1.0);\n\t\t3  0.6 vec4(0.0, 0.5, 0.0, 1.0);\n\t\t4  0.8 vec4(0.0, 0.0, 1.0, 1.0);\n\t\t5  1.0 vec4(0.5, 0.0, 0.5, 1.0);\n\t*/\n\t\n\tfloat r = float(level <= 2.0) + float(level > 4.0) * 0.5;\n\tfloat g = max(1.0 - abs(level - 2.0) * 0.5, 0.0);\n\tfloat b = (1.0 - (level - 4.0) * 0.5) * float(level >= 4.0);\n\treturn vec4(r, g, b, 1.0);\n}\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\n");var f=Object.keys(s).filter(function(e){return e.startsWith("lightShift")||e.startsWith("hueShift")}),p=Object.keys(s).filter(function(e){return e.startsWith("turbulence")||e.startsWith("fade")||e.startsWith("perlin")||e.startsWith("mod289")||e.startsWith("permute")||e.startsWith("taylorInvSqrt")}),d=Object.keys(s).filter(function(e){return e.startsWith("position")}),v=Object.keys(s).filter(function(e){return e.startsWith("sdf")}),m=Object.keys(s).filter(function(e){return e.includes("generated")}),y=Object.keys(s).filter(function(e){return e.startsWith("scene")}),b=Object.keys(s).filter(function(e){return!e.startsWith("position")&&!e.startsWith("sdf")&&!e.startsWith("scene")&&!e.includes("generated")&&!(e.startsWith("perlin")||e.startsWith("mod289")||e.startsWith("permute")||e.startsWith("taylor")||e.startsWith("fade")||e.startsWith("turbulence")||e.startsWith("lightShift")||e.startsWith("hueShift"))}),g={};for(var O in f.forEach(function(e){return g[e]=s[e]}),d.forEach(function(e){return g[e]=s[e]}),p.forEach(function(e){return g[e]=s[e]}),m.forEach(function(e){return g[e]=s[e]}),v.forEach(function(e){return g[e]=s[e]}),y.forEach(function(e){return g[e]=s[e]}),b.forEach(function(e){return g[e]=s[e]}),s=g)o+=Ru(O,s[O])+"\n";if(o+="\nvoid main() {\n/*\n    vec2 uv_bound = (1.0*gl_FragCoord.xy-vec2(width, height))/height;\n    if (abs(uv_bound.x) > 0.62 || abs(uv_bound.y + ".concat(window.offset_v||"0.0",") > 0.7) {\n       gl_FragColor = vec4(0.0);\n       return;\n    }\n*/\n"),i)for(var k in i){var j=i[k],w=j.type,S=j.code;"object"===typeof w?(o+=w.type+" "+k+" = "+w.defaultValue+";\n",o+="\nif (".concat(w.condition,") {\n   ").concat(k," = ").concat(S,";\n}\n")):o+=w+" "+k+" = "+S+";\n\n"}return o+="\n".concat(r,"\n}\n"),r,o,o}};Object(Ca.a)("mouseSDF",{coord:"",position:"",size:"",cornerRadius:"",resolution:""},"Calculates SDF for a given mouse coord",function(){return 1},{inlets:5});var Mu=function(e,t){if(!e||!t)return"full";for(var n="",r=0,a=0;a<e.length;a++)e[a]!==t[a]&&r++<10&&(n+=e[a]);return n},Ru=function(e,t){var n=t.body,r=t.args,a=t.returnType+" "+e+"("+Object.keys(r).map(function(e){return r[e]+" "+e}).join(",")+") {\n";return a+=n+"\n}"},Cu=function(e){var t="";for(var n in e){var r=e[n],a=r.type,i=r.code;"object"===typeof a?(t+=a.type+" "+n+" = "+a.defaultValue+";\n",t+="\nif (".concat(a.condition,") {\n   ").concat(n," = ").concat(i,";\n}\n")):t+=a+" "+n+" = "+i+";\n\n"}return t};Object(Ca.a)("globalReverse",{},"When 1 is received from inlet, whole track is reversed. When 0 whole track is not reversed",function(){return 0},{inlets:1});Object(Ca.a)("loop",{"looping on":"","loop length (bars)":""},"When 1 is received in left inlet, looping starts. O stops loop and continues play",function(){return 0},{inlets:2,isHot:!0});Object(Ca.a)("gl.texture2D",{texture:"",textureCoords:""},"Calls texture2D on texture and texture coords",function(){return 1},{inletTypes:["sampler2D","vec2"],type:function(){return"vec4"},isHot:!0,inlets:2});var Nu=function(e,t){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"(texture2D((".concat(Object(gi.b)(r[0]),"), (").concat(Object(gi.b)(r[1]),")))")},t))};Object(Ca.a)("gl.textureVec2",{texture:"",index:"",length:""},"Returns vec2 at index from list of given length",function(){return 1},{inletTypes:["sampler2D","float","float"],type:function(){return"vec2"},isHot:!0,inlets:3});Object(Ca.a)("gl.sample",{layer:"",coordinate:""},"",function(){return 1},{isHot:!0,inlets:2,inletTypes:["vec4","vec2"],type:function(){return"vec4"}});Object(Ca.a)("gl.feedback",{feedback:"",coordinate:""},"",function(){return 1},{inlets:2,isHot:!0,inletTypes:["vec4","vec2"],type:function(){return"vec4"}});var qu={"gl.sample":function(e,t){e.needsHotReload=!0;var n=Di(new ov(e.subSequence),function(){return"texture"}),r=Nu(new ov(e.subSequence),t);return e.typed(function(e){var t=Object(ea.a)(e,1)[0];if("string"===typeof t)return{};var a=Object(h.a)(t.frames||[]),i=Object(p.a)({},t,{frames:void 0,texture:n});a.push(i);var s=r([n([2],!0)]);return s.frames=a,s.type="vec4",s})},"gl.feedback":function(e,t){e.needsHotReload=!0,e.needsLoad=!0;var n=Di(new ov(e.subSequence),function(){return"texture"}),r=Nu(new ov(e.subSequence),t),a=void 0,i=void 0;return e.typed(function(e){var s=Object(ea.a)(e,1)[0];if(console.log("gl.feedback called with ",s,t()),"string"===typeof s&&(console.log("feedback string..."),s={}),s&&a===t()&&i===s)console.log("FEEDBACK WERE EQUAL SKIPPING",s,i);else{if(!i||!s||a!==t()||i.code!==s.code){i=s,a=t();var o=[].concat(),c={frames:void 0,texture:n,feedback:s};o.push(c);var u=r([n([2],!0)]);return u.frames=o,u.type="vec4",u}console.log("2. FEEDBACK WERE EQUAL SKIPPING",s,i)}})}};Object(Ca.a)("gl.offset_v",{},"",function(){return 1},{});var Iu=n(525);Object(Ca.a)("gl.alpha",{color:"",alpha:""},"Sets alpha channel of color to argument",function(){return 1},{inletTypes:["vec4","float"],type:function(){return"float"},isHot:!0,inlets:2});Object(Ca.a)("gl.black",{},"Sets alpha channel of color to argument",function(){return 1},{type:"vec4",isHot:!0,inlets:0});Object(Ca.a)("gl.white",{},"Sets alpha channel of color to argument",function(){return 1},{type:"vec4",isHot:!0,inlets:0});Object(Ca.a)("gl.rgb2hsl",{"rgb vec3":""},"Returns a vec3 of hsl representation of rgb vec3 passed in",function(){return 1},{inlets:1});Object(Ca.a)("gl.hsl2rgb",{"hsl vec3":""},"Returns a vec3 of rgb representation of hsl vec3 passed in",function(){return 1},{inlets:1});Object(Ca.a)("gl.color",{hexColor:""},"Converts hex color into vec4 with uniforms",function(){return 1},{type:function(){return"vec4"},connects:{object:"gl.fragColor"}});var _u=function(e){e.needsHotReload=!0;var t,n,r,a={};return function(i,s){var o=Object(ea.a)(i,1)[0];if("start"!==o){o.slice&&7===o.length||(o="#000000");var c=(o=o.slice(1)).slice(0,2),u=o.slice(2,4),l=o.slice(4,6),f=(o.slice(6,8),[parseInt(c,16)/255,parseInt(u,16)/255,parseInt(l,16)/255]),h=a.r||Di(e,function(){return"color"});a.r=h;var d=h([[].concat(f,["1.0"])]);d&&(n=d.code,t=d.uniforms,!0);var v="".concat(n),m={code:v,hashCode:Object(Ri.a)(v),variables:{},functions:{},type:"vec4",uniforms:Object(p.a)({},t)};return s||!r?(r=!0,[m]):void 0}}};Object(Ca.a)("gl.hueShift",{color:"","shift amount":""},"Shifts color's saturation by a given amount",function(){return 1},{inletTypes:["vec4","float"],type:function(){return"vec4"},isHot:!0,inlets:2});Object(Ca.a)("gl.saturationShift",{color:"","shift amount":""},"Shifts color's saturation by a given amount",function(){return 1},{inletTypes:["vec4","float"],type:function(e){return"vec4"},isHot:!0,inlets:2});Object(Ca.a)("gl.lightShift",{color:"","shift amount":""},"Shifts color's saturation by a given amount",function(){return 1},{inletTypes:["vec4","float"],type:function(){return"vec4"},isHot:!0,inlets:2});Object(Ca.a)("gl.colorSwapRG",{color:"vec4",swap:"float"},"Conditionally swaps the R and G values in the vec4 passed in left-inlet, when 2nd inlet is 1.",function(){return 1},{isHot:!0,inlets:2});Object(Ca.a)("gl.colorSwapRB",{color:"vec4",swap:"float"},"Conditionally swaps the R and B values in the vec4 passed in left-inlet, when 2nd inlet is 1.",function(){return 1},{isHot:!0,inlets:2});Object(Ca.a)("gl.colorSwapGB",{color:"vec4",swap:"float"},"Conditionally swaps the G and B values in the vec4 passed in left-inlet, when 2nd inlet is 1.",function(){return 1},{isHot:!0,inlets:2});Object(Ca.a)("gl.palette",{number:"",factor:"",color1:"",color2:"",color3:"",color4:""},"",function(){return 1},{isHot:!0,inletTypes:["float","float","vec4","vec4","vec4","vec4"],type:"vec4",inlets:6});var Du={"gl.palette":function(e,t,n,r,a,i){return e.typed(Object(yi.a)(function(e){var s=Object(bi.a)(e,t,n,r,a,i).map(gi.b),o=Object(ea.a)(s,6),c=o[0],u=o[1],l=o[2],f=o[3],h=o[4],p=o[5];return"(".concat(l," + ").concat(f,"*cos(").concat(u,"*2.*PI*(").concat(h,"*").concat(c,"+").concat(p,")))")},t,n,r,a,i))},"gl.hueShift":function(e,t){return e.needsHotReload=!0,Object(Ci.a)(function(e){var n=Object(ea.a)(e,1)[0],r=Object(gi.a)(n,t),a=r.codes,i=(r.closure,r.uniforms),s=r.variables,o=r.functions;return o.hueShiftFunc={args:{color:"vec4",shift:"float"},returnType:"vec4",body:"\n        vec3 hsl = rgb2hsl(vec3(color.x, color.y, color.z));\n        vec3 sRGB = hsl2rgb(vec3(mod(hsl.x + shift, 1.0), hsl.y, hsl.z ));\n        return vec4(sRGB.x, sRGB.y, sRGB.z, color.w);\n"},t&&void 0!==t()&&(s=Object(p.a)({},s,t().variables),i=Object(p.a)({},i,t().uniforms)),n&&(i=Object(p.a)({},i,n.uniforms),s=Object(p.a)({},s,n.variables)),{code:"(hueShiftFunc(".concat(Object(gi.b)(a[0]),", ").concat(Object(gi.b)(a[1]),"))"),type:"vec4",functions:o,uniforms:i,variables:s}},e,t)},"gl.lightShift":function(e,t){return e.needsHotReload=!0,Object(Ci.a)(function(e){var n=Object(ea.a)(e,1)[0],r=Object(gi.a)(n,t),a=r.codes,i=(r.closure,r.uniforms),s=r.variables,o=r.functions;return o.lightShiftFunc={args:{color:"vec4",shift:"float"},returnType:"vec4",body:"\n        vec3 hsl = rgb2hsl(vec3(color.x, color.y, color.z));\n        vec3 sRGB = hsl2rgb(vec3(hsl.x, hsl.y, min(hsl.z + shift, 1.0)));\n        return vec4(sRGB.x, sRGB.y, sRGB.z, color.w);\n"},t&&void 0!==t()&&(s=Object(p.a)({},s,t().variables),i=Object(p.a)({},i,t().uniforms)),n&&(i=Object(p.a)({},i,n.uniforms),s=Object(p.a)({},s,n.variables)),{code:"(lightShiftFunc(".concat(Object(gi.b)(a[0]),", ").concat(Object(gi.b)(a[1]),"))"),type:"vec4",functions:o,uniforms:i,variables:s}},e,t)},"gl.saturationShift":function(e,t){return e.needsHotReload=!0,Object(Ci.a)(Object(yi.a)(function(e){var n=Object(bi.a)(e,t),r="rgb2hsl(vec3(".concat(Object(gi.b)(n[0]),".x, ").concat(Object(gi.b)(n[0]),".y, ").concat(Object(gi.b)(n[0]),".z))"),a="hsl2rgb(vec3((".concat(r,").x, min((").concat(r,").y + ").concat(Object(gi.b)(n[1]),", 1.0), (").concat(r,").z))");return"vec4(".concat(a,", (").concat(n[0],").w)")},t),e,t)},"gl.hsl2rgb":function(e){return e.needsHotReload=!0,Object(yi.a)(function(e){var t=Object(bi.a)(e);return"hsl2rgb(".concat(Object(gi.b)(t[0]),")")})},"gl.rgb2hsl":function(e){return e.needsHotReload=!0,Object(yi.a)(function(e){var t=Object(bi.a)(e);return"rgb2hsl(".concat(Object(gi.b)(t[0]),")")})},"gl.color":_u,"gl.colorSwapRG":function(e,t){return Object(yi.a)(function(e){var n=Object(bi.a)(e,t),r=Object(ea.a)(n,2),a=r[0],i=r[1];return a=Object(gi.b)(a),i=Object(gi.b)(i),"((".concat(i,") == 1.0 ? \n    vec4(").concat(a,".g, ").concat(a,".r, ").concat(a,".b, ").concat(a,".a) : ").concat(a,")")},t)},"gl.colorSwapGB":function(e,t){return Object(yi.a)(function(e){var n=Object(bi.a)(e,t),r=Object(ea.a)(n,2),a=r[0],i=r[1];return a=Object(gi.b)(a),i=Object(gi.b)(i),"((".concat(i,") == 1.0 ? \n    vec4(").concat(a,".r, ").concat(a,".b, ").concat(a,".g, ").concat(a,".a) : ").concat(a,")")},t)},"gl.colorSwapRB":function(e,t){return Object(yi.a)(function(e){var n=Object(bi.a)(e,t),r=Object(ea.a)(n,2),a=r[0],i=r[1];return a=Object(gi.b)(a),i=Object(gi.b)(i),"((".concat(i,") == 1.0 ? \n    vec4(").concat(a,".b, ").concat(a,".g, ").concat(a,".r, ").concat(a,".a) : ").concat(a,")")},t)},"gl.alpha":function(e,t){return e.needsHotReload=!0,Object(Ci.a)(Object(yi.a)(function(e){var n=Object(bi.a)(e,t),r=Object(ea.a)(n,2),a=r[0],i=r[1];return"vec4(".concat(a,".r, ").concat(a,".g, ").concat(a,".b, ").concat(Object(gi.b)(i),")")},t),e,t)},"gl.black":function(e,t){return e.needsHotReload=!0,e.needsLoad=!0,Object(Ci.a)(Object(yi.a)(function(){return"vec4(0.0, 0.0, 0.0, 1.0)"},t),e)},"gl.white":function(e,t){return e.needsHotReload=!0,e.needsLoad=!0,Object(Ci.a)(Object(yi.a)(function(){return"vec4(1.0, 1.0, 1.0, 1.0)"},t),e,t)}};Object(Ca.a)("gl.fwidth",{x:""},"Creates GLSL expression calculating fwidth (partial derivative) of inlet",function(){return 1},{inletTypes:Object(mi.k)("float"),type:function(){return"float"},tags:"GLSL",inlets:1});Object(Ca.a)("gl.sqrt",{x:""},"Creates GLSL expression calculating sqrt of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(Ca.a)("gl.floor",{x:""},"Creates GLSL expression calculating floor of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(Ca.a)("gl.sign",{x:""},"Creates GLSL expression calculating sign of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(Ca.a)("gl.round",{x:""},"Creates GLSL expression calculating floor of inlet",function(){return 1},{inletTypes:Object(mi.k)(Object(mi.j)("float","vec2","vec3","vec4")),type:_i.d,tags:"GLSL",inlets:1});Object(Ca.a)("gl.ceil",{x:""},"Creates GLSL expression calculating ceil of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(Ca.a)("gl.rand",{vec2:""},"Creates GLSL expression for calculating a pseudo-random number given a vec2",function(){return 1},{inletTypes:["vec2"],type:"float",tags:"GLSL",inlets:1});Object(Ca.a)("gl.sin",{x:""},"Creates GLSL expression calculating sin of inlet",function(){return 1},{inletTypes:Object(mi.k)(Object(mi.j)("float","vec2","vec3","vec4")),type:_i.d,tags:"GLSL",inlets:1});Object(Ca.a)("gl.cos",{x:""},"Creates GLSL expression calculating cosine of inlet",function(){return 1},{inletTypes:Object(mi.k)(Object(mi.j)("float","vec2","vec3","vec4")),type:_i.d,tags:"GLSL",inlets:1});Object(Ca.a)("gl.acos",{x:""},"Creates GLSL expression calculating acosine of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(Ca.a)("gl.tan",{x:""},"Creates GLSL expression calculating tangent of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(Ca.a)("gl.atan",{y:"",x:""},"Creates GLSL expression calculating arc-tangent of inlets",function(){return 1},{inletTypes:["float","float"],type:function(){return"float"},isHot:!0,tags:"GLSL",inlets:2});Object(Ca.a)("gl.asinh",{x:""},"Creates GLSL expression calculating asinh of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(Ca.a)("gl.pow",{y:"",x:""},"Creates GLSL expression calculating pow (exponent) of inlets",function(){return 1},{inletTypes:["float","float"],type:function(){return"float"},isHot:!0,tags:"GLSL",inlets:2});Object(Ca.a)("gl.distance",{a:"",b:""},"Creates GLSL expression calculating distance between inlets",function(){return 1},{inletTypes:["vec2","vec2"],type:function(){return"float"},isHot:!0,tags:"GLSL",inlets:2});Object(Ca.a)("gl.smoothstep",{a:"",b:"",c:""},"Creates GLSL expression calculating smoothstep of inlets",function(){return 1},{inletTypes:["float","float","float"],type:function(){return"float"},isHot:!0,tags:"GLSL",inlets:3});var Fu=function(e,t,n){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(r){var a=Object(bi.a)(r,t,n);return e.flash(),"smoothstep(".concat(Object(gi.b)(a[0]),", ").concat(Object(gi.b)(a[1]),", ").concat(Object(gi.b)(a[2]),")")},t,n),function(e,t,n){var r=Math.max(0,Math.min(1,(n-e)/(t-e)));return r*r*(3-2*r)}))};Object(Ca.a)("gl.ddx",{x:""},"Creates GLSL expression calculating ddx (partial derivative) of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(Ca.a)("gl.ddy",{x:""},"Creates GLSL expression calculating ddy (partial derivative) of inlet",function(){return 1},{inletTypes:["float"],type:function(){return"float"},tags:"GLSL",inlets:1});Object(Ca.a)("gl.rotate",{vec2:"",theta:""},"Creates GLSL expression calculating rotations of vec2 by angle",function(){return 1},{inletTypes:["vec2","float"],type:function(){return"vec2"},isHot:!0,tags:"GLSL",inlets:2});var Lu={"gl.sin":function(e){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(t){var n=Object(bi.a)(t);return e.flash(),"sin(".concat(Object(gi.b)(n[0]),")")}),function(e){return Math.sin(e)}))},"gl.asinh":function(e){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(t){var n=Object(bi.a)(t);return e.flash(),"asinh(".concat(Object(gi.b)(n[0]),")")}),function(e){return Math.asin(e)}))},"gl.cos":function(e){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"cos(".concat(n,")")}),function(e){return Math.cos(e)}))},"gl.acos":function(e){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"acos(".concat(n,")")}),function(e){return Math.cos(e)}))},"gl.tan":function(e){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"tan(".concat(Object(gi.b)(n),")")}),function(e){return Math.tan(e)}))},"gl.atan":function(e,t){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"atan(".concat(Object(gi.b)(r[0]),", ").concat(Object(gi.b)(r[1]),")")},t),function(e,t){return Math.atan2(e,t)}))},"gl.pow":function(e,t){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"pow(".concat(Object(gi.b)(r[0]),", ").concat(Object(gi.b)(r[1]),")")},t),function(e,t){return Math.pow(e,t)}))},"gl.floor":function(e){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"floor(".concat(Object(gi.b)(n),")")}),function(e){return Math.floor(e)}))},"gl.round":function(e){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"round(".concat(Object(gi.b)(n),")")}),function(e){return Math.round(e)}))},"gl.ceil":function(e){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"ceil(".concat(Object(gi.b)(n),")")}),function(e){return Math.ceil(e)}))},"gl.sqrt":function(e){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"sqrt(".concat(Object(gi.b)(n),")")}),function(e){return Math.sqrt(e)}))},"gl.smoothstep":Fu,"gl.rand":function(e){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(t){var n=(t=t||{}).code||t||"vec2(0.,0.)";return e.flash(),"rand(".concat(Object(gi.b)(n),")")}))},"gl.fwidth":function(e){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"fwidth(".concat(Object(gi.b)(n),")")}))},"gl.ddx":function(e){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"dFdx(".concat(Object(gi.b)(n),")")}))},"gl.ddy":function(e){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"dFdx(".concat(Object(gi.b)(n),")")}))},"gl.distance":function(e,t){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"distance(".concat(Object(gi.b)(r[0]),", ").concat(Object(gi.b)(r[1]),")")},t),function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2),Math.pow(e[0]-t[0],2))}))},"gl.rotate":function(e,t){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"".concat(Object(gi.b)(r[0]),"*rotate2D(").concat(Object(gi.b)(r[1]),")")},t),function(e,t){return Array.isArray(e)?Ya(e[0],e[1],2*Math.PI-t):t}))},"gl.sign":function(e){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(t){var n=(t=t||{}).code||t||"0.";return e.flash(),"sign(".concat(Object(gi.b)(n),")")}),function(e){return e>=0?1:-1}))}};function Bu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var zu=function(e){return function(e){Object(u.a)(n,e);var t=Bu(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"setupColors",value:function(e){var t=this;this.uxColorGL=_u(this),this.uxColorHex=e,this.newInlet("color",function(e){var n=Object(ea.a)(e,1)[0];t.background,t.background=n,t.compile()},mi.e)}},{key:"setUXBackground",value:function(e){var t=!1;this.background&&(t=!0),this.background=void 0,this.uxColorHex=e,this.uxColorGL([e]),t&&this.compile()}},{key:"color",get:function(){return this.background||this.uxColorGL([this.uxColorHex],!0)[0]}}]),n}(e)};function Ju(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Vu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Hu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Uu=function(e){Object(u.a)(n,e);var t=Hu(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this)).id=Object(S.uuid)(),r.zObject=e,r.sequencerEngine=e.sequencerEngine,r.sequencerEngine.idToObject[r.id]=Object(c.a)(r),r.subSequence=e.subSequence,r._sdf=0,r._blur=.0051,r._value=0,r.newInlet("SDF",function(e){var t=Object(ea.a)(e,1)[0];r.SDF=t,r.layerManager.layers.filter(function(e){return!e._sdf}).forEach(function(e){return e.SDF=t})},mi.a),r.newNumberField("blur",.001,.001),r.newNumberField("value",0),r.setupColors("#ffffff"),r.sdfUniform=Di(Object(c.a)(r),function(){return"sdf"}),r.colorUniform=Di(Object(c.a)(r),function(){return"color"}),r}return Object(o.a)(n,[{key:"enabled",get:function(){return this.layerManager.enabled}},{key:"layerManager",get:function(){return this.zObject.effect}},{key:"flash",value:function(){}},{key:"compileLayer",value:function(e){var t=this,n=Fi(this,function(){return"layerSDF"},function(){return"float"})([this.SDF]),r=Fi(this,function(){return"sdfPlus"},function(){return"float"})([ss(this,function(){return t.value})([n])]),a=cs(this,function(){return 0})([this.blur]),i=Fu(this,function(){return a},function(){return r})([this.blur]),s=Fi(this,function(){return"layerColor"+t.id.replaceAll("-","")},function(){return"vec4"})([this.color]),o=Object(gi.c)(this,function(){return s},function(){return i})([e]),c=Fi(this,function(){return"mixedLayer"},function(){return"vec4"})([o]);if(void 0!==this.enabled){var u=ki(this,function(){return 1})([this.enabled]);c=Li(this,function(){return"mixedLayer"},function(){return"vec4"},function(){return u},function(){return e})([o])}return c}},{key:"compile",value:function(){this.zObject.effect.compile()}},{key:"SDF",get:function(){return this._sdf?this._sdf:this.sdfUniform([0],!0)},set:function(e){var t=this._sdf!==e;this._sdf=e,t&&this.compile()}},{key:"blur",get:function(){return this.getNumber("blur")}},{key:"value",get:function(){return this.getNumber("value")}},{key:"fromJson",value:function(e){this.id=e.id,this.sequencerEngine.idToObject[this.id]=this,this.uxColorHex=e.uxColorHex,this.name=e.name,this.updateNumber("value",e.value),this.updateNumber("blur",e.blur)}},{key:"getJson",value:function(){return{name:this.name,id:this.id,uxColorHex:this.uxColorHex,blur:this.receivedNumbers.blur,value:this.receivedNumbers.value}}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=Vu(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"hasInletFields",get:function(){return!0}}]),n}(e)}(Object(Iu.a)(function(e){return function(e){Object(u.a)(n,e);var t=Ju(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).numbers={},e.glNumbers={},e.receivedNumbers={},e.numberUniforms={},e}return Object(o.a)(n,[{key:"newNumberField",value:function(e,t){var n=this,r=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=new Fc(e.subSequence,yc.c);return a.text=t,a.min=n,a.max=r,a}(this,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,1);this.numbers[e]=r,this.numberUniforms[e]=Di(this,function(){return e}),this.newInlet(e,function(t){var r=Object(ea.a)(t,1)[0];return n.updateNumber(e,r)},Object(mi.j)("float","number"))}},{key:"updateNumber",value:function(e,t){isNaN(t)?(this.glNumbers[e]=t,this.compile()):(this.numberUniforms[e]([t]),this.numbers[e]._text=t),this.receivedNumbers[e]=t}},{key:"getNumber",value:function(e){return this.glNumbers[e]?this.glNumbers[e]:this.numberUniforms[e]([this.numbers[e]._text],!0)}}]),n}(e)}(zu(Object(Aa.a)(function(){return function e(){Object(s.a)(this,e)}}()))))));function Gu(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Wu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wu(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Wu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ku(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Qu=function(e){Object(u.a)(n,e);var t=Ku(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).layers=[],r.setupColors("#000000"),r.enabled=void 0,r.newInlet("enable",function(e){var t=Object(ea.a)(e,1)[0];r.enabled=t,r.compile()}),r.newOutlet("output color"),r.newLayer(),r}return Object(o.a)(n,[{key:"refresh",value:function(){return this.compile()}},{key:"isSharingSameSDF",value:function(){var e=this;return this.layers.every(function(t){return t.SDF===e.layers[0].SDF})}},{key:"newLayer",value:function(){var e=new Uu(this.zObject);this.layers.push(e);var t=this.layers.find(function(e){return e._sdf});t&&(e.SDF=t._sdf),this.compile()}},{key:"getInnerNodes",value:function(){return this.layers}},{key:"compile",value:function(){var e,t=this,n=this.color,r=Gu(this.layers);try{for(r.s();!(e=r.n()).done;){var a=e.value;a._sdf&&(n=a.compileLayer(n))}}catch(o){r.e(o)}finally{r.f()}this.zObject.onValueChange();n.functions,this.id.replaceAll("-","");if(void 0===this.enabled)n.type="vec4",this.sendMessage("output color",n);else{var i=ki(this,function(){return 1})([this.enabled]),s=Li(this,function(){return"layerEnabled"+t.id.replaceAll("-","")},function(){return"vec4"},function(){return i},function(){return t.color});s.type="vec4",this.sendMessage("output color",s([n]))}}},{key:"flash",value:function(){this.zObject.flash()}},{key:"getJson",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return Object(p.a)({},(e=Object(ne.a)(Object(f.a)(n.prototype),"getJson",this)).call.apply(e,[this].concat(r)),{layers:this.layers.map(function(e){return e.getJson()}),uxColorHex:this.uxColorHex})}},{key:"fromJson",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];if((t=Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this)).call.apply(t,[this,e].concat(a)),e.layers){this.uxColorHex=e.uxColorHex;var s,o=Gu(e.layers);try{for(o.s();!(s=o.n()).done;){var c=s.value;this.layers[this.layers.length-1].fromJson(c),e.layers.length>this.layers.length&&this.newLayer()}}catch(u){o.e(u)}finally{o.f()}}}}]),n}(zu(Va.a));Object(Ca.a)("sdf.layers",{},"Manages anti-aliased layers for SDFs",function(){return 0},{inlets:0,connects:[{outlet:"Output 1",object:"gl.fragColor",inlet:"Input"}]});Object(Ca.a)("constraint.nearEdge",{value:""},"Creates constraint near edge");var Zu={"constraint.nearEdge":function(e){return function(e){var t=Object(ea.a)(e,1)[0];return{type:"NEAR_EDGE",value:t}}}};Math.sqrt;function Yu(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Xu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xu(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Xu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var $u=function(e,t,n,r){for(var a,i,s=nl(r,t),o=Object(ea.a)(s,4),c=o[0],u=o[1],l=o[2],f=o[3],h=el(n,c,u,l,f,e),p=1,d=0,v=1/0,m=1;a=h,i=e,!(Math.abs(a-i)<.01)&&d++<16;){var y=1+p*(1/16),b=1-p*(1/16),g=c*y,O=u*y,k=c*b,j=u*b,w=el(n,g,O,l,f,e),x=Object(ea.a)(w,2),S=x[0],P=x[1],E=el(n,k,j,l,f,e),T=Object(ea.a)(E,2),A=T[0],M=T[1];if(S<v&&0===P&&(v=S,m=y),A<v&&0===M&&(v=A,m=b),S<.01)return[g,O];if(A<.01)return[k,j];p++,0}return[c*m,u*m]},el=function(e,t,n,r,a,i){var s,o=1/0,c=-1/0,u=al(e,t,n,r,a),l=Yu(u);try{for(l.s();!(s=l.n()).done;){var f=s.value.sdf,h=Math.abs(i-f);h<o&&(o=h),f+i>0&&h>c&&(c=h)}}catch(d){l.e(d)}finally{l.f()}var p=tl(u,i);return p>0?[c,p]:[o,p]},tl=function(e,t){var n,r=0,a=Yu(e);try{for(a.s();!(n=a.n()).done;){n.value.sdf+t>0&&r++}}catch(i){a.e(i)}finally{a.f()}return r},nl=function(e,t){var n=e.lastSDFs[t].slice(1,3),r=Object(ea.a)(n,2),a=r[0],i=r[1],s=Object(ea.a)(e.dimensions[t],2);return[a,i,s[0],s[1]]},rl=function(e,t,n,r){return[[[e+n,t+r],[1,1]],[[e,t+r],[0,1]],[[e-n,t+r],[-1,1]],[[e,t-r],[0,-1]],[[e+n,t-r],[1,-1]],[[e-n,t],[-1,0]],[[e-n,t-r],[-1,-1]],[[e+n,t],[1,0]]]},al=function(e,t,n,r,a){var i,s=[],o=Yu(rl(t,n,r,a));try{for(o.s();!(i=o.n()).done;){var c=i.value,u=Object(ea.a)(c,2),l=u[0],f=u[1],h=e.sdfAtPoint(l,0,void 0,!0);s.push({sdf:h,direction:f,pt:l})}}catch(p){o.e(p)}finally{o.f()}return s},il={NEAR_EDGE:function(e,t,n){(new Date).getTime();for(var r=0;r<n.positions.length;r++){n.positions[r];var a=$u(e,r,t,n),i=Object(ea.a)(a,2),s=i[0],o=i[1];n.updatePosition(r,s,o)}(new Date).getTime()}};Object(Ca.a)("sdf.constraint",{"constraint program":""},"Creates constraint based on sdfs",function(){return 1},{isHot:!0,inlets:3});var sl=Object(p.a)({"sdf.constraint":function(e,t,n){return function(e){var r=Object(ea.a)(e,1)[0],a=il[r.type];a&&a(r.value,t(),n())}}},Zu);Object(Ca.a)("gl.convertCoord",{coordinates:"",size:""},"Converts screen space coords to uv-style coords",function(){return 1},{inlets:2});Object(Ca.a)("gl.resolution",{},"Creates GLSL expression for the resolution vec2",function(){return 1},{inlets:0,tags:"GLSL"});Object(Ca.a)("gl.xy",{},"Creates GLSL expression for the current pixel/'s x & y coordinates as a vec2",function(){return 1},{inlets:0,tags:"GLSL"});Object(Ca.a)("gl.bad_uv",{},"Creates GLSL expression for the current pixel/'s x & y coordinates as a vec2",function(){return 3},{inlets:0,type:function(){return["vec2","float","float"]},outlets:["vec2","u","v"],tags:"GLSL"});Object(Ca.a)("gl.uv",{},"Creates GLSL expression for the current pixel/'s x & y coordinates as a vec2",function(){return 3},{type:function(){return["vec2","float","float"]},inlets:0,tags:"GLSL",outlets:["vec2","u","v"]});Object(Ca.a)("gl.x",{},"Creates GLSL expression for the current pixel/'s x-coordinate",function(){return 1},{type:function(){return"float"},inlets:0,tags:"GLSL"});Object(Ca.a)("gl.y",{},"Creates an GLSL expression for the current pixel/'s y-coordinate",function(){return 1},{type:function(){return"float"},inlets:0,tags:"GLSL"});Object(Ca.a)("gl.width",{},"Creates GLSL expression for the canvas/'s width",function(){return 1},{type:function(){return"float"},tags:"GLSL",isHot:!0,inlets:0});Object(Ca.a)("gl.height",{},"Creates GLSL expression for the canvas/'s height",function(){return 1},{type:function(){return"float"},tags:"GLSL",isHot:!0,inlets:0});Object(Ca.a)("gl.normalize",{v:""},"Normalizes a vector",function(){return 1},{inletTypes:Object(mi.k)(Object(mi.j)(mi.c,mi.d)),type:_i.d});Object(Ca.a)("gl.cx_div",{a:"vec2",b:"vec2"},"Complex division in glsl",function(){return 1},{inletTypes:["vec2","vec2"],type:"vec2",isHot:!0,inlets:2});Object(Ca.a)("gl.cx_mul",{a:"vec2",b:"vec2"},"Complex division in glsl",function(){return 1},{inletTypes:["vec2","vec2"],type:"vec2",isHot:!0,inlets:2});Object(Ca.a)("gl.cx_sin",{a:"vec2"},"Complex sin in glsl",function(){return 1},{inletTypes:["vec2","vec2"],type:"vec2",isHot:!0,inlets:1});Object(Ca.a)("gl.cx_cos",{a:"vec2"},"Complex cos in glsl",function(){return 1},{isHot:!0,inlets:1});Object(Ca.a)("gl.cx_tan",{a:"vec2"},"Complex cos in glsl",function(){return 1},{isHot:!0,inlets:1});var ol={args:{z:"vec2"},returnType:"vec2",body:"\n    return vec2(\n    length(z),\n    atan(z.y, z.x)\n  );\n"};Object(Ca.a)("gl.cx_log",{a:"vec2"},"Complex tan in glsl",function(){return 1},{inletTypes:["vec2"],type:"vec2"});Object(Ca.a)("gl.cx_pow",{a:"vec2",b:"float"},"Complex power in glsl",function(){return 1},{isHot:!0,inlets:2});Object(Ca.a)("gl.im",{a:"vec2"},"Complex imaginary part in glsl",function(){return 1},{isHot:!0,inlets:1});var cl={"gl.cx_pow":function(e,t){return e.needsHotReload=!0,function(e){var n=Object(ea.a)(e,1)[0],r=Object(gi.a)(n,t),a=r.codes,i=r.uniforms,s=r.functions,o=r.variables;return s.as_polar=ol,s.cx_pow={args:{v:"vec2",p:"float"},returnType:"vec2",body:"\n    vec2 z = as_polar(v);\n    return pow(z.x, p) * vec2(cos(z.y * p), sin(z.y * p));\n"},{code:"cx_pow(".concat(Object(gi.b)(a[0]),", ").concat(Object(gi.b)(a[1]),")"),uniforms:i,functions:s,variables:o}}},"gl.cx_div":function(e,t){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(e){var n=Object(bi.a)(e,t),r=Object(ea.a)(n,2),a=r[0],i=r[1];return a="("+Object(gi.b)(a)+")",i="("+Object(gi.b)(i)+")","cx_div(".concat(a,", ").concat(i,")")},t))},"gl.cx_sin":function(e){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(e){var t=Object(bi.a)(e),n=Object(ea.a)(t,1)[0];return n="("+Object(gi.b)(n)+")","cx_sin(".concat(n,")")}))},"gl.cx_cos":function(e){return e.needsHotReload=!0,Object(yi.a)(function(e){var t=Object(bi.a)(e),n=Object(ea.a)(t,1)[0];return n="("+Object(gi.b)(n)+")","cx_cos(".concat(n,")")})},"gl.cx_mul":function(e,t){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(e){var n=Object(bi.a)(e,t),r=Object(ea.a)(n,2),a=r[0],i=r[1];return a="("+Object(gi.b)(a)+")",i="("+Object(gi.b)(i)+")","cx_mul(".concat(a,", ").concat(i,")")},t))},"gl.cx_log":function(e){return e.needsHotReload=!0,e.typed(function(e){var t=Object(ea.a)(e,1)[0],n=Object(gi.a)(t),r=n.codes,a=n.uniforms,i=n.functions,s=n.variables;return s=t.variables,i.as_polar=ol,i.cx_log={args:{a:"vec2"},returnType:"vec2",body:"\n    vec2 polar = as_polar(a);\n    float rpart = polar.x;\n    float ipart = polar.y;\n    if (ipart > PI) ipart=ipart-(2.0*PI);\n    return vec2(log(rpart),ipart);\n"},{code:"cx_log(".concat(Object(gi.b)(r[0]),")"),uniforms:a,functions:i,variables:s}})}};function ul(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ll(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ll(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ll(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("gl.genArgs",{name:"Name of the function argument",type:"Type of the function argument"},"Generates a vec3 arguement that can be used in a function definition",function(e){return e},{});Object(Ca.a)("gl.genArg",{name:"Name of the function argument",type:"Type of the function argument"},"Generates a vec3 arguement that can be used in a function definition",function(){return 1},{inlets:2});Object(Ca.a)("gl.genFunction",{network:"Name of the function that is generated",name:"Name of the function that is generated",returnType:"Name of the function that is generated","argument name list":"exact name of arguments (in list)"},"Generates a function",function(){return 1},{inlets:4});Object(Ca.a)("gl.genCall",{function:"",args:""},"",function(){return 1},{inlets:function(e){return e+1},isHot:!0});var fl={"gl.genArg":function(e,t){return e.needsLoad=!0,e.needsHotReload=!0,function(e){var n=Object(ea.a)(e,1)[0],r=void 0===n?"p":n,a={};return a[r]=t(),{code:"(".concat(r,")"),model:function(e){return e},uniforms:{},variables:{},closure:a}}},"gl.genArgs":function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e.needsLoad=!0,e.needsHotReload=!0;var a=e.id.replaceAll("-","");return function(e){Object(ea.a)(e,1)[0];var t,r={},i=[],s=0,o=ul(n);try{for(o.s();!(t=o.n()).done;){var c=(0,t.value)();if(c){var u="arg_"+s+"_"+a;r[u]=c,i.push({code:"(".concat(u,")"),type:c,model:function(e){return e},uniforms:{},variables:{},closure:r}),s++}}}catch(l){o.e(l)}finally{o.f()}return i}},"gl.genFunction":function(e,t,n,r){var a=Object(S.uuid)().replaceAll("-","");return function(e){var i=Object(ea.a)(e,1)[0],s=(t()||"")+"generated"+a,o=Object(gi.a)(i,t),c=o.codes,u=o.uniforms,l=o.functions,f=o.closure,h=i.variables;return r()&&(f=function(e,t){var n,r={},a=ul(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;r[i]=e[i]}}catch(s){a.e(s)}finally{a.f()}return r}(f,r())),l[s]={args:f,returnType:n(),body:"\n".concat(Cu(h),"\nreturn ").concat(c[0],";\n").split("\n").map(function(e){return"  "+e}).join("\n")},{func:l[s],codeEvaluator:function(e){return"(".concat(s,"(").concat(e,"))")},model:i.model,uniforms:u,variables:{},functions:l}}},"gl.genCall":function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t=Object(ea.a)(e,1)[0],r=t.codeEvaluator,a=t.functions,i=t.uniforms,s=t.variables,o=t.func;if(r){var c,u=n.map(function(e){return e()}).filter(function(e){return e}),l=r(u.map(function(e){return e.code||e}).join(",")),f=ul(u);try{for(f.s();!(c=f.n()).done;){var h=c.value;h.variables&&(s=Object(p.a)({},s,h.variables)),h.uniforms&&(i=Object(p.a)({},i,h.uniforms)),h.functions&&(a=Object(p.a)({},a,h.functions))}}catch(d){f.e(d)}finally{f.f()}return{type:o.returnType,uniforms:i,code:l,functions:a,variables:s}}}}},hl={mod289:{args:{x:"vec3"},returnType:"vec3",body:"\nreturn x - floor(x * (1.0 / 289.0)) * 289.0;\n"},mod289_4:{args:{x:"vec4"},returnType:"vec4",body:"\nreturn x - floor(x * (1.0 / 289.0)) * 289.0; \n"},permute:{args:{x:"vec4"},returnType:"vec4",body:"\nreturn mod289_4(((x*34.0)+1.0)*x);\n"},taylorInvSqrt:{args:{r:"vec4"},returnType:"vec4",body:"\nreturn 1.79284291400159 - 0.85373472095314 * r; \n"},fade:{args:{t:"vec3"},returnType:"vec3",body:"\nreturn t*t*t*(t*(t*6.0-15.0)+10.0);\n"},perlin:{args:{P:"vec3"},returnType:"float",body:"\n    vec3 i0 = mod289(floor(P)), i1 = mod289(i0 + vec3(1.0));\n    vec3 f0 = fract(P), f1 = f0 - vec3(1.0), f = fade(f0);\n    vec4 ix = vec4(i0.x, i1.x, i0.x, i1.x), iy = vec4(i0.yy, i1.yy);\n    vec4 iz0 = i0.zzzz, iz1 = i1.zzzz;\n    vec4 ixy = permute(permute(ix) + iy), ixy0 = permute(ixy + iz0), ixy1 = permute(ixy + iz1);\n    vec4 gx0 = ixy0 * (1.0 / 7.0), gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n    vec4 gx1 = ixy1 * (1.0 / 7.0), gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n    gx0 = fract(gx0); gx1 = fract(gx1);\n    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0), sz0 = step(gz0, vec4(0.0));\n    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1), sz1 = step(gz1, vec4(0.0));\n    gx0 -= sz0 * (step(0.0, gx0) - 0.5); gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n    gx1 -= sz1 * (step(0.0, gx1) - 0.5); gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n    vec3 g0 = vec3(gx0.x,gy0.x,gz0.x), g1 = vec3(gx0.y,gy0.y,gz0.y),\n        g2 = vec3(gx0.z,gy0.z,gz0.z), g3 = vec3(gx0.w,gy0.w,gz0.w),\n        g4 = vec3(gx1.x,gy1.x,gz1.x), g5 = vec3(gx1.y,gy1.y,gz1.y),\n        g6 = vec3(gx1.z,gy1.z,gz1.z), g7 = vec3(gx1.w,gy1.w,gz1.w);\n    vec4 norm0 = taylorInvSqrt(vec4(dot(g0,g0), dot(g2,g2), dot(g1,g1), dot(g3,g3)));\n    vec4 norm1 = taylorInvSqrt(vec4(dot(g4,g4), dot(g6,g6), dot(g5,g5), dot(g7,g7)));\n    g0 *= norm0.x; g2 *= norm0.y; g1 *= norm0.z; g3 *= norm0.w;\n    g4 *= norm1.x; g6 *= norm1.y; g5 *= norm1.z; g7 *= norm1.w;\n    vec4 nz = mix(vec4(dot(g0, vec3(f0.x, f0.y, f0.z)), dot(g1, vec3(f1.x, f0.y, f0.z)),\n        dot(g2, vec3(f0.x, f1.y, f0.z)), dot(g3, vec3(f1.x, f1.y, f0.z))),\n        vec4(dot(g4, vec3(f0.x, f0.y, f1.z)), dot(g5, vec3(f1.x, f0.y, f1.z)),\n            dot(g6, vec3(f0.x, f1.y, f1.z)), dot(g7, vec3(f1.x, f1.y, f1.z))), f.z);\n    return 2.2 * mix(mix(nz.x,nz.z,f.y), mix(nz.y,nz.w,f.y), f.x);\n"}};Object(Ca.a)("gl.perlin",{vec3:""},"Returns perlin noise for a pt in 3D space",function(){return 1},{inletTypes:Object(mi.k)(Object(mi.j)("vec3")),type:"float"});Object(Ca.a)("gl.turbulence",{vec3:""},"Returns turbulence for perlin noise for a pt in 3D space",function(){return 1},{inletTypes:"vec3",type:"float"});var pl={"gl.perlin":function(e){return e.typed(function(e){var t=Object(ea.a)(e,1)[0],n=Object(gi.a)(t),r=n.codes,a=n.closure,i=n.functions,s=n.variables,o=n.uniforms;s=t.variables;var c="perlin("+Object(gi.b)(r[0])+")";return{closure:a,uniforms:o,functions:Object(p.a)({},i,hl),code:c,variables:s}})},"gl.turbulence":function(e){return function(e){var t=Object(ea.a)(e,1)[0],n=Object(gi.a)(t),r=n.codes,a=n.closure,i=n.functions,s=n.variables,o=n.uniforms;return s=t.variables,(i=Object(p.a)({},i,hl)).turbulence={args:{P:"vec3"},returnType:"float",body:"\nfloat f = 0., s = 1.;\n    for (int i = 0 ; i < 5 ; i++) {\n        f += abs(perlin(s * P)) / s;\n        s *= 2.;\n        P = vec3(.866 * P.x + .5 * P.z, P.y + 100., -.5 * P.x + .866 * P.z);\n    }\n    return f;\n"},{closure:a,uniforms:o,functions:i,code:"turbulence("+Object(gi.b)(r[0])+")",variables:s}}}};Object(Ca.a)("sdf.translate",{"sdf list":"",x:"",y:""},"Translate group of sdfs",function(){return 1},{isHot:!0,inlets:3});Object(Ca.a)("sdf.scale",{"sdf list":"",scale:""},"Translate group of sdfs",function(){return 1},{isHot:!0,inlets:2});Object(Ca.a)("sdf.scaleX",{"sdf list":"",scale:""},"Translate group of sdfs",function(){return 1},{isHot:!0,inlets:2});var dl={"sdf.translate":function(e,t,n){return function(e){var r=Object(ea.a)(e,1)[0];if(Array.isArray(r))return void 0===t()||void 0===n()?[r]:[r.map(function(e){if(Array.isArray(e)){var r=Object(h.a)(e);return r[1]+=t(),r[2]+=n(),r}}).filter(function(e){return e})]}},"sdf.scale":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(Array.isArray(n))return void 0===t()?[n]:[n.map(function(e){if(Array.isArray(e)){var n=Object(h.a)(e);return n[1]*=t(),n[2]*=t(),n[3]*=t(),n[4]*=t(),n[5]*=t(),n}}).filter(function(e){return e})]}},"sdf.scaleX":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(Array.isArray(n))return void 0===t()?[n]:[n.map(function(e){if(Array.isArray(e)){var n=Object(h.a)(e);return n[1]*=t(),n.id=e.id,n}}).filter(function(e){return e})]}}};function vl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ml=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=new Fc(e.subSequence,yc.c);return a.text=t,a.min=n,a.max=r,a},yl=function(e){Object(u.a)(n,e);var t=vl(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newOutlet("SDF Object"),r.type="box",r.zObject.setAttribute("primary-color","#545460"),r.zObject.hasInletFields=!0,r.x=ml(Object(c.a)(r),0),r.y=ml(Object(c.a)(r),0),r.z=ml(Object(c.a)(r),0,-3,3),r.w=ml(Object(c.a)(r),.1,0,1),r.h=ml(Object(c.a)(r),.2,0,1),r.d=ml(Object(c.a)(r),.1,0,1),r.c=ml(Object(c.a)(r),.1,0,1),r.r=ml(Object(c.a)(r),0,-Math.PI,Math.PI),r.repeatSpread=ml(Object(c.a)(r),0,-1,1),r.repeatCountX=ml(Object(c.a)(r),0,0,8),r.repeatCountX.round=!0,r.repeatCountY=ml(Object(c.a)(r),0,0,8),r.repeatCountY.round=!0,r.repeatCountZ=ml(Object(c.a)(r),0,0,8),r.repeatCountZ.round=!0,r.newInlet("x",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.x,t)}),r.newInlet("y",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.y,t)}),r.newInlet("z",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.z,t)}),r.newInlet("width",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.w,t)}),r.newInlet("height",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.h,t)}),r.newInlet("depth",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.d,t)}),r.newInlet("corner",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.c,t)}),r.newInlet("rotation",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.r,t)}),r.newInlet("repeat spread",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.repeatSpread,t)}),r.newInlet("repeat x",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.repeatCountX,t)}),r.newInlet("repeat y",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.repeatCountY,t)}),r.newInlet("repeat z",function(e){var t=Object(ea.a)(e,1)[0];return r.on(r.repeatCountZ,t)}),r}return Object(o.a)(n,[{key:"on",value:function(e,t){isNaN(t)||(e.text=t,this.sendObject())}},{key:"getJson",value:function(){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{x:this.x._text,y:this.y._text,z:this.z._text,w:this.w._text,h:this.h._text,d:this.d._text,c:this.c._text,r:this.r._text,repeatSpread:this.repeatSpread._text,repeatCountX:this.repeatCountX._text,repeatCountY:this.repeatCountY._text,repeatCountZ:this.repeatCountZ._text,type:this.type})}},{key:"fromJson",value:function(e,t){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),void 0!==e.x&&(this.x.text=e.x,this.y.text=e.y,this.z.text=e.z,this.w.text=e.w,this.h.text=e.h,this.d.text=e.d,isNaN(e.repeatCountX)||(this.repeatSpread.text=e.repeatSpread,this.repeatCountX.text=e.repeatCountX,this.repeatCountY.text=e.repeatCountY,this.repeatCountZ.text=e.repeatCountZ),isNaN(e.r)||(this.r.text=e.r),this.c.text=e.c,this.type=e.type)}},{key:"sendObject",value:function(){var e=[];(e=Object(Bi.f)(this.type)?[this.type,this.x._text,this.y._text,this.z._text,this.w._text,this.h._text,this.d._text,this.c._text,this.r._text,[this.repeatSpread._text,this.repeatCountX._text,this.repeatCountY._text,this.repeatCountZ._text]]:[this.type,this.x._text,this.y._text,this.w._text,this.h._text,this.c._text,this.r._text]).id=this.id,this.sendMessage("SDF Object",e)}}]),n}(Va.a);Object(Ca.a)("gl.estimateNormal",{sdfs:"list of sdfs",rayOrigin:"",rayDirection:"","ray marched distance":""},"Estimates normal for list of sdfs (to be unioned together)",function(){return 1},{isHot:!0,inlets:4});var bl=function(e,t,n,r){var a="estimateNormal_"+Object(S.uuid)().replaceAll("-","").slice(0,4);return function(e){var i=Object(ea.a)(e,1)[0],s=Object(gi.a)(i,t,n,r),o=s.codes,c=s.uniforms,u=s.functions;return u[a]={args:{p:"vec3"},returnType:"vec3",body:"\nreturn normalize(vec3(\n        ".concat(i.code("vec3(p.x + EPSILON, p.y, p.z)"),".x - ").concat(i.code("vec3(p.x - EPSILON, p.y, p.z)"),".x,\n        ").concat(i.code("vec3(p.x, p.y + EPSILON, p.z)"),".x - ").concat(i.code("vec3(p.x, p.y - EPSILON, p.z)"),".x,\n        ").concat(i.code("vec3(p.x, p.y, p.z  + EPSILON)"),".x - ").concat(i.code("vec3(p.x, p.y, p.z - EPSILON)"),".x\n    ));\n")},{code:"".concat(a,"(").concat(o[1]," + ").concat(o[2]," * ").concat(o[3],")"),functions:u,uniforms:c}}};Object(Ca.a)("gl.diffusedLight",{normal:"",rayOrigin:"",rayDirection:"","ray marched distance":"","light position":"",d1:"",d2:""},"Calculates light",function(){return 1},{isHot:!0,inlets:7});var gl=function(e,t,n,r,a,i,s){return Object(yi.a)(function(e){var o=Object(bi.a)(e,t,n,r,a,i,s),c="(".concat(o[1]," + ").concat(o[2]," * ").concat(o[3],")"),u="normalize(".concat(o[4]," - ").concat(c,") * ").concat(Object(gi.b)(o[5]));return"clamp(dot(".concat(o[0],", ").concat(u,"), 0., 1.) * ").concat(Object(gi.b)(o[6])," + ").concat(Object(gi.b)(o[6]))},t,n,r,a,i,s)};Object(Ca.a)("gl.raymarching3D",{sdfList:"list of sdf objects to be used for ray marching",rayOrigin:"origin of eye (vec3)",fieldOfView:"field of view angle (float)"},"Creates a new uniform variable with value from left-inlet, in GLSL.",function(){return 3},{isHot:!0,tags:"GLSL",inlets:3,outlets:["raymarched distance","ray direction","sdf value"]});var Ol=function(e,t,n,r){e.needsHotReload=!0;var a=Object(S.uuid)(),i="raymarching_"+a.replaceAll("-","").slice(0,4),s="shadow_"+a.replaceAll("-","").slice(0,4),o="normal_"+a.replaceAll("-","").slice(0,4);return function(e){var a=Object(ea.a)(e,1)[0],c=Object(gi.a)(a,t,n,r),u=c.codes,l=c.uniforms,f=c.functions,h=c.variables;f[o]={args:{pos:"vec3"},returnType:"vec3",body:"\nvec2 e = vec2(1.0,-1.0)*0.5773;\n    const float eps = 0.0005;\n    return normalize( e.xyy*".concat(a.code("pos + e.xyy*eps"),".x + \n\te.yyx*").concat(a.code("pos + e.yyx*eps"),".x + \n\te.yxy*").concat(a.code("pos + e.yxy*eps"),".x + \n\te.xxx*").concat(a.code("pos + e.xxx*eps"),".x);\n")},f[s]={args:{ro:"vec3",rd:"vec3",tmin:"float",tmax:"float",k:"float"},returnType:"float",body:"\n    float res = 1.0;\n    float t = tmin;\n    for( int i=0; i<64; i++ )\n    {\n\tfloat h = ".concat(a.code("ro + rd*t"),".x;\n        res = min( res, k*h/t );\n        t += clamp( h, 0.003, 0.10 );\n        if( res<0.002 || t>tmax ) break;\n    }\n    return clamp( res, 0.0, 1.0 );\n")},f[i]={args:{rayOrigin:"vec3",fieldOfView:"float",rayDirection:"vec3"},returnType:"vec4",body:"\nfloat depth = ".concat(Object(gi.b)(1e-4),";\nfloat index = -1.0;\nvec3 ogRayOrigin = rayOrigin;\nfloat dist = 0.0;\n\nfor(int i=0; i<").concat(90,";i++){\n    vec2 di =  ").concat(a.code("rayOrigin + depth*rayDirection"),";\n    dist = di.x;\n    if (dist < ").concat(1e-4,") {\n        // need to calculate the shadow \n        index = di.y;\n        break;\n    }\n    if (depth > ").concat(80.01,") {\n        break;\n    }\n    depth += dist;\n}\nif (depth < ").concat(80.01,") {\n/*\n  vec3 pos = rayOrigin + depth*rayDirection;\n  vec3 nor = ").concat(o,"(pos);\n  vec3 lig = ").concat(u[3],";\n  float dif = clamp( dot(nor,lig), 0.0, 1.0 );\n  if ( dif>0.001 ) dif *= ").concat(s,"( pos+nor*0.001, lig, 0.001, 1.0, 32.0 );\n  float amb = 0.5 + 0.5*dot(nor,vec3(0.0,1.0,0.0));\n*/\n  return vec4(depth, index, 0.0, 0.0);\n}\nreturn vec4(").concat(80.01,", index, 0., 0.);\n")},h||(h={}),h.rayDir={type:"vec3",code:"getRayDir(lookAt(".concat(Object(gi.b)(u[1]),", vec3(0.0, 0.0, 0.0), vec3(0.0,0.0,0.5)), ").concat(Object(gi.b)(u[2]),")")};var p="(".concat(i,"(").concat(Object(gi.b)(u[1]),", ").concat(Object(gi.b)(u[2]),", rayDir))"),d=a.code("vec3((1.0*gl_FragCoord.xy-vec2(width, height))/height, 0.0)");return[{code:p,variables:h,uniforms:l,functions:f,hashCode:Object(Ri.a)(p)},{code:"rayDir",variables:h,uniforms:l,functions:f,hashCode:Object(Ri.a)("rayDir")},{code:d,variables:h,uniforms:l,functions:f,hashCode:Object(Ri.a)(d)}]}},kl={"gl.estimateNormal":bl,"gl.raymarching3D":Ol,"gl.sdf":Ki,"gl.diffusedLight":gl};Object(Ca.a)("sdf.softShadow",{scene:"scene to compute soft shadow for",rayOrigin:"origin of ray",rayDirection:"direction of ray",k:"softness of shadow"},"Creates a soft shadow",function(){return 1},{inlets:4});function jl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wl=function(e){Object(u.a)(n,e);var t=jl(n);function n(e){var r;return Object(s.a)(this,n),r=t.call(this,e),e.skipHotReload=!0,r.skipHotReload=!0,r.setup(),r.newInlet("GL SDF Evaluators",function(e){var t=Object(ea.a)(e,1)[0];return r.onSDFs(t)}),r.newInlet("Light Position",function(e){var t=Object(ea.a)(e,1)[0];return r.onLightPosition(t)}),r.newInlet("Light Diffusion",function(e){var t=Object(ea.a)(e,1)[0];return r.onLightDiffusion(t)}),r.newInlet("Camera Position",function(e){var t=Object(ea.a)(e,1)[0];return r.onCameraPosition(t)}),r.newInlet("Field of View",function(e){var t=Object(ea.a)(e,1)[0];return r.onFieldOfView(t)}),r.newOutlet("Light Strength"),r.newOutlet("Raw Light Strength"),r.newOutlet("Ray-Marched Distance"),r.newOutlet("Ray-Marched Index"),r.newOutlet("Normal"),r.newOutlet("Data"),r}return Object(o.a)(n,[{key:"hotReload",value:function(){this.lastSDFs&&this.onSDFs(this.lastSDFs)}},{key:"onCameraPosition",value:function(e){this._cameraPosition=e,this.rayOriginXUniform([e[0]]),this.rayOriginYUniform([e[1]]),this.rayOriginZUniform([e[2]])}},{key:"onLightDiffusion",value:function(e){this._lightDiffusion=e,this.lightDiffusionUniform([e])}},{key:"onLightPosition",value:function(e){Array.isArray(e)&&(this._lightPosition=e,this.lightPositionXUniform([e[0]]),this.lightPositionYUniform([e[1]]),this.lightPositionZUniform([e[2]]))}},{key:"setup",value:function(){var e=this;this.rayOriginXUniform=Di({},function(){return e.name("rayOriginX")}),this.rayOriginYUniform=Di({},function(){return e.name("rayOriginY")}),this.rayOriginZUniform=Di({},function(){return e.name("rayOriginZ")}),this.rayOriginVec3=Zi(this.zObject,function(){return e.rayOriginYUniform([e.rayOriginY],!0)},function(){return e.rayOriginZUniform([e.rayOriginZ],!0)}),this.fieldOfViewUniform=Di({},function(){return e.name("fieldOfView")}),this.lightPositionXUniform=Di({},function(){return e.name("lighPositionX")}),this.lightPositionYUniform=Di({},function(){return e.name("lightPositionY")}),this.lightPositionZUniform=Di({},function(){return e.name("lightPositionZ")}),this.lightDiffusionUniform=Di({},function(){return e.name("lightDiffusion")}),this.lightPositionVec3=Zi(this.zObject,function(){return e.lightPositionYUniform([e.lightPositionY],!0)},function(){return e.lightPositionZUniform([e.lightPositionZ],!0)}),this.raymarcher=Ol(this.zObject,function(){return e.rayOrigin},function(){return e.fieldOfViewUniform([e.fieldOfView],!0)},function(){return e.lightPosition}),this.normalEstimator=bl(this.zObject,function(){return e.rayOrigin},function(){return e.rayDirection},function(){return e.rayMarchedDistance}),this.lightDiffuser=gl(this.zObject,function(){return e.rayOrigin},function(){return e.rayDirection},function(){return e.rayMarchedDistance},function(){return e.lightPosition},function(){return e.lightDiffusionUniform([e.lightDiffusion],!0)},function(){return.64}),this.occlusion=function(e,t,n,r,a){var i="ao"+Object(S.uuid)().replaceAll("-","");return function(e){var s=Object(ea.a)(e,1)[0],o=Object(gi.a)(s,t,n,r,a),c=o.codes,u=o.uniforms,l=o.functions,f=o.variables;return l[i]={args:{rayOrigin:"vec3",rayDirection:"vec3",distance:"float",nor:"vec3"},returnType:"float",body:"\n      vec3 pos = rayOrigin + rayDirection*distance;\n      float occ = 0.0;\n      float sca = 1.0;\n      for( int i=0; i<5; i++ )\n      {\n          float hr = 0.01 + 0.12 * float( i ) / 4.0;\n          vec3 aopos =  nor * hr + pos;\n          float dd = ".concat(s.code(" aopos "),".x;\n          occ += -(dd-hr)*sca;\n          sca *= 0.95;\n      }\n      return clamp( 1.0 - 3.0*occ, 0.0, 1.0 );    \n")},{code:"".concat(i,"(").concat(c.slice(1).map(function(e){return Object(gi.b)(e)}).join(","),")"),uniforms:u,functions:l,variables:f}}}(this.zObject,function(){return e.rayOrigin},function(){return e.rayDirection},function(){return e.rayMarchedDistance},function(){return e.normal})}},{key:"onFieldOfView",value:function(e){this.fieldOfViewUniform([e])}},{key:"fieldOfView",get:function(){return 90}},{key:"lightDiffusion",get:function(){return void 0===this._lightDiffusion?1.96:this._lightDiffusion}},{key:"rayOriginX",get:function(){return this._cameraPosition?this._cameraPosition[0]:.2}},{key:"rayOriginY",get:function(){return this._cameraPosition?this._cameraPosition[1]:.2}},{key:"rayOriginZ",get:function(){return this._cameraPosition?this._cameraPosition[2]:1}},{key:"lightPositionX",get:function(){return this._lightPosition?this._lightPosition[0]:0}},{key:"lightPositionY",get:function(){return this._lightPosition?this._lightPosition[1]:1.8}},{key:"lightPositionZ",get:function(){return this._lightPosition?this._lightPosition[2]:1.8}},{key:"rayOrigin",get:function(){var e=this.rayOriginXUniform([this.rayOriginX],!0);return this.rayOriginVec3([e])}},{key:"lightPosition",get:function(){return this.lightPositionVec3([this.lightPositionXUniform([this.lightPositionX],!0)])}},{key:"onSDFs",value:function(e){var t=this;this.rayOriginXUniform([this.rayOriginX]),this.rayOriginYUniform([this.rayOriginY]),this.lastSDFs=e;var n=this.raymarcher([e]),r=Object(ea.a)(n,2),a=r[0],i=r[1],s=this.name("rayMarchedReturn"),o=Object(p.a)({},a,{code:s+".x"}),c=Object(p.a)({},a,{code:s+".y"});this.rayMarchedReturn=Fi(this.zObject,function(){return s},function(){return"vec4"})([a]),this.rayMarchedDistance=Fi(this.zObject,function(){return t.name("rayMarchedDistance")},function(){return"float"})([o]),this.rayMarchedIndex=Fi(this.zObject,function(){return t.name("rayMarchedIndex")},function(){return"float"})([c]),this.rayDirection=Fi(this.zObject,function(){return t.name("rayDirection")},function(){return"vec3"})([i]);var u=this.normalEstimator([e]),l=u,f=this.lightDiffuser([l]),h=qi(this.zObject,function(){return 0},function(){return 80.01});this.normal=l;var d=cs(this.zObject,function(){return h([t.rayMarchedDistance])}),v=Fi(this.zObject,function(){return t.name("shadow")},function(){return"float"})([Object(p.a)({},this.rayMarchedReturn,{code:this.rayMarchedReturn.code+".z"})]),m=Fi(this.zObject,function(){return t.name("hitNormal")},function(){return"float"})([Object(p.a)({},this.rayMarchedReturn,{code:this.rayMarchedReturn.code+".w"})]),y=this.occlusion([this.lastSDFs]),b=Fi(this.zObject,function(){return t.name("occlusion")},function(){return"float"})([y]),g=d([f]),O=e.functions;g.functions=Object(p.a)({},g.functions,u.functions,a.functions,y.functions,O),g.variables=Object(p.a)({},v.variables,m.variables,this.rayDirection.variables,this.rayMarchedReturn.variables,this.rayMarchedDistance.variables,this.rayMarchedIndex.variables,b.variables,g.variables,l.variables),this.rayMarchedIndex.variables=Object(p.a)({},v.variables,m.variables,this.rayDirection.variables,this.rayMarchedReturn.variables,this.rayMarchedDistance.variables,this.rayMarchedIndex.variables,b.variables,g.variables,l.variables),this.rayMarchedDistance.functions=Object(p.a)({},this.rayMarchedDistance.functions,y.functions),this.rayMarchedDistance.variables=Object(p.a)({},v.variables,m.variables,this.rayMarchedReturn.variables,this.rayMarchedIndex.variables,this.rayMarchedDistance.variables,b.variables),this.sendMessage("Light Strength",g),this.sendMessage("Ray-Marched Distance",this.rayMarchedDistance),this.sendMessage("Normal",l),this.sendMessage("Ray-Marched Index",this.rayMarchedIndex),this.sendMessage("Data",{occlusion:b,rayOrigin:this.rayOrigin,rayDirection:this.rayDirection,rayMarchedDistance:this.rayMarchedDistance,scene:this.lastSDFs,normal:l})}},{key:"name",value:function(e){return e+this.id.replaceAll("-","")}}]),n}(Va.a);Object(Ca.a)("gl.sdfManager",{},"Create and manage multiple SDF objects with mouse events",function(){return 0},{inlets:0,altName:"sdf.manager",connects:[{outlet:"GL SDF Evaluators",object:"raymarching.manager",inlet:"GL SDF Evaluators"}]});var xl=function(e){new ys(e);return function(){}};Object(Ca.a)("sdf.simple",{},"Create and manage multiple SDF objects with mouse events",function(){return 0},{isHot:!0,inlets:0,connects:[{outlet:"GL SDF Evaluators",object:"raymarching.manager",inlet:"GL SDF Evaluators"}]});Object(Ca.a)("gl.rayMarchingManager",{},"Manages ray marching for sdfs",function(){return 0},{inlets:0,altName:"raymarching.manager",connects:[{outlet:"Data",object:"gl.directionalLighting",inlet:"Input"}]});var Sl=function(e){new wl(e);return function(){}};Object(Ca.a)("gl.sdfBuilder",{},"Graphically build sdf objects (to send to sdf-manager)",function(){return 0},{inlets:0,altName:"sdf.builder",connects:{object:"uniqueAppend"}});var Pl=function(e){var t=new yl(e);return e.needsLoad=!0,function(){t.sendObject()}};Object(Ca.a)("gl.sdfCopy",{sdf:"",offset:""},"Takes an SDF and outputs an offsetted copy (SDF Manager will efficiently output it)",function(){return 1},{isHot:!0,inlets:2,altName:"sdf.copy"});var El=function(e,t){var n=Object(S.uuid)();return function(e){var r=Object(ea.a)(e,1)[0],a=t();if(r&&r.id)return{id:n,copyId:r.id,offset:a}}};Object(Ca.a)("gl.sdfMultiCopies",{sdf:"",count:"",offset:""},"Takes an SDF and outputs an offsetted copy (SDF Manager will efficiently output it)",function(){return 1},{isHot:!0,inlets:3,altName:"sdf.multiCopies"});var Tl=function(e,t,n){Object(S.uuid)();var r=void 0;return function(e){var a=Object(ea.a)(e,1)[0];if(n()&&a&&a.id){if(!r||r.length<t())for(var i=function(e){r.push(El(0,function(){return[n()[0]*(e+1),n()[1]*(e+1),n()[2]*(e+1)]}))},s=(r=[]).length;s<t();s++)i(s);return[r.map(function(e){return e([a])})]}}};Object(Ca.a)("gl.sdfCubeLayout",{sdf:"",count:"",offset:""},"Takes an SDF and creates copies of it in a cube formantion",function(){return 1},{altName:"sdf.cubeLayout",isHot:!0,inlets:3});var Al=function(e,t,n){Object(S.uuid)();var r=void 0,a=[];return function(e){var i=Object(ea.a)(e,1)[0],s=n(),o=t();if(s&&i&&i.id){r||(r=[]);for(var c=0,u=[],l=[],f=function(e){for(var t=[],n=function(n){for(var i=[],u=function(t){if(0===e&&0===n&&0===t)return i.push(void 0),"continue";var o=[s*e,s*n,-s*t];i.push(o),l[c]=function(){return a[n][e][t]},r[c]||(r[c]=El(0,function(){return a[n][e][t]})),c++},f=0;f<o;f++)u(f);t.push(i)},i=0;i<o;i++)n(i);u.push(t)},p=0;p<o;p++)f(p);a=u;var d=r.map(function(e){return e([i])});return[[i].concat(Object(h.a)(d))]}}};Object(Ca.a)("gl.fog",{distance:"",amount:""},"Creates fog",function(){return 1},{inlets:2});function Ml(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Rl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rl(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Rl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("gl.directionalLighting",{Data:"",lightPosition:"vec3",lightAttentuation:"float",lightColor:"vec4",shininess:"float",fresnel:"vec3",diffuse:"float",specular:"float",ambient:"vec3",shadow:"float"},"Calculates how much lighting should occur at a given ray end point",function(){return 1},{isHot:!0,connects:[{outlet:"Output 1",object:"gl.fragColor",inlet:"Input"}],inlets:10});var Cl={"gl.directionalLighting":function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=Object(S.uuid)().replaceAll("-",""),i="directionalLighting_"+a.slice(0,4),s=function(){var e=[],t=function(t,n,r){if(void 0===t)return r;if(!isNaN(t)||Array.isArray(t)){if(!e[n]){var a=Object(S.uuid)().replaceAll("-",""),i=Di({},function(){return"arg_"+n+a});e[n]=i}return e[n]([t],!0)}return t};return function(e){return(e=Object(h.a)(e).map(function(e){return void 0===e||isNaN(e)&&0===Object.keys(e).length?void 0:e}).slice(0,9))[0]=t(e[0],0,"vec3(0.5, 0.8, 1.0)"),e[1]=t(e[1],1,"1.0"),e[2]=t(e[2],2,"vec4(0.9, 0.8, 1.0, 1.0)"),e[3]=t(e[3],3,"1.0"),e[4]=t(e[4],4,"vec3(0.5, 0.8, 1.0)"),e[5]=t(e[5],5,.8),e[6]=t(e[6],6,.8),e[7]=t(e[7],7,"vec4(0.3, 0.1, 0.2, 1.0)"),e[8]=t(e[8],8,"1.0"),e}}();return function(e){var t=Object(ea.a)(e,1)[0],r=t.scene,o=gi.a.apply(void 0,[t.scene,t.occlusion,t.rayOrigin,t.rayDirection,t.rayMarchedDistance,t.normal].concat(n)),c=o.codes,u=o.variables,l=o.uniforms,f=o.functions;c=[].concat(Object(h.a)(c.slice(0,6)),Object(h.a)(s(c.slice(6)))),l=Object(p.a)({},l,function(e){var t,n={},r=Ml(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.uniforms&&(n=Object(p.a)({},n,a.uniforms))}}catch(i){r.e(i)}finally{r.f()}return n}(c)),c=c.map(function(e){return e.code?e.code:e});var d=t.rayMarchedDistance;l=Object(p.a)({},d.uniforms,l),f=Object(p.a)({},d.functions,f),u=Object(p.a)({},d.variables,u),f.calculateTransmittance={args:{ro:"vec3",rd:"vec3",tmin:"float",tmax:"float",atten:"float"},returnType:"vec3",body:"\n     const int MAX_DEPTH = 4;\n    float hitPoints[MAX_DEPTH];\n    int depth = 0;\n    \n    for (float t = tmin; t < tmax;)\n    {\n        float h = abs(".concat(r.code("ro + t * rd"),".x);\n        if (h < 1e-5) { hitPoints[depth++] = t; t += 0.01; };\n        if (depth >= MAX_DEPTH) break;\n        t += h;\n    }\n    \n    float thickness = 0.0;\n    for (int i = 0; i < depth - 1; i += 2) thickness += hitPoints[i+1] - hitPoints[i];\n    \n    return vec3(1.0) * exp(-atten * thickness * thickness);\n")};var v="softShadow"+a;return f[v]={args:{ro:"vec3",rd:"vec3",mint:"float",tmax:"float",k:"float"},returnType:"float",body:"\n         float res = 1.0;\n        float t = mint;\n\n        for( int i = 0; i < ".concat(4,"; i++ ) {\n          float h = ").concat(r.code("ro + rd * t"),".x;\n          res = min( res, k * h / t );\n          t += clamp( h, 0.02, 0.10 );\n          if( h<0.001 || t>tmax ) break;\n        }\n\n        return clamp( res, 0.0, 1.0 );\n")},f[i]={args:{occlusion:"float",rayOrigin:"vec3",rayDirection:"vec3",distance:"float",normal:"vec3",lightPosition:"vec3",lightAttenuation:"float",lightColorRaw:"vec4",shininess:"float",fresnel:"vec3",diffuse:"float",specular:"float",ambientRaw:"vec4",shadow:"float"},returnType:"vec4",body:"\n  vec3 lightColor = vec3(lightColorRaw.x, lightColorRaw.y, lightColorRaw.z);\n  vec3 ambient = vec3(ambientRaw.x, ambientRaw.y, ambientRaw.z);\n  vec3 surfacePosition = rayOrigin + rayDirection*distance;\n  vec3  outputColor   = vec3( 0. );\n  vec3 surfaceToLightDirection = normalize( lightPosition - surfacePosition );\n  vec3 lightDir = normalize(vec3(1.0, .5, -1.0));\n\n// todo: figure out translucency correctly opacity\n/*\n  float t = 0.8;\n  lightColor = t * lightColor * calculateTransmittance(surfacePosition+normal*vec3(0.01), lightDir, 0.01, 10.0, 2.0*lightAttenuation);\n  lightColor += (1.0 - t) * calculateTransmittance(surfacePosition+normal*vec3(0.01), rayDirection, 0.01, 10.0, 0.5*lightAttenuation);\n*/\n\n  // get similarity between normal and direction to light\n  float diffuseCoefficient = dot( normal, surfaceToLightDirection ); \n  // get reflection angle for light striking surface\n  vec3 angleOfReflection = reflect( -surfaceToLightDirection, normal );\n  // see if reflected light travels to camera and generate coefficient accordingly\n  float specularAngle = clamp( dot( angleOfReflection, -rayDirection ), 0., 1. );\n  float specularCoefficient = pow( specularAngle, shininess );\n  // lights should have an attenuation factor\n  float attenuation = 1. / ( lightAttenuation * pow( length( lightPosition - surfacePosition ), 2. ) ); \n  // bias, scale, power\n  float _fresnel = fresnel.x + fresnel.y * pow( 1.0 + dot( rayDirection, normal ), fresnel.z ); \n  // shadow was here\n  diffuseCoefficient *= ".concat(v,"( surfacePosition, normalize( lightPosition ), 0.02, 2.5, shadow);\n  vec3 color = vec3( 0. );\n  color += 1.2 * diffuseCoefficient * diffuse * lightColor;\n  color += 2.2 * specularCoefficient * specular * lightColor;\n  color += 0.3 * (ambient * lightColor) * occlusion;\n  color += (_fresnel * lightColor);\n  // texture\n  // gamma correction must occur before light attenuation\n  // which means it must be applied on a per-light basis unfortunately\n  vec3 gammaCorrectedColor = pow( color, vec3( 1./2.2 ) );\n  vec3 attenuatedColor = 2. * gammaCorrectedColor * attenuation; \n  outputColor += attenuatedColor;\n  return vec4(outputColor.x, outputColor.y, outputColor.z, 1.0);\n")},{code:"".concat(i,"(\n\t").concat(c.slice(1).join(",\n\t"),")"),functions:f,uniforms:l,variables:u}}}};Object(Ca.a)("gl.dot",{x:"x",y:"y"},"Creates GLSL expression for dot product of vectors",function(){return 1},{inletTypes:Object(mi.k)(Object(mi.j)("vec2","vec3","vec4")),type:"float",tags:"GLSL",isHot:!0,inlets:2});Object(Ca.a)("gl.fragColor",{color:""},"Outputs the GLSL vec4 in the inlet to the shader. Represents the final output for the shader",function(){return 1},{inlets:1,inletTypes:Object(mi.k)(Object(mi.j)("vec4")),tags:"GLSL",connects:{object:"gl.material"}});var Nl=Object(p.a)({"gl.uniform":Di,"gl.variable":Fi,"gl.if":Li,"gl.fragColor":function(e){return e.needsHotReload=!0,e.typed(function(t){var n=Object(ea.a)(t,1)[0],r=n.code||n,a=(n.uniforms,n.variables),i=n.functions;return e.flash(),Object(Oi.a)("gl_FragColor = "+r+";",n.uniforms,a,i)})},"gl.x":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"gl_FragCoord.x",hashCode:"gl_FragCoord.x",variables:{},model:function(e){return e},uniforms:{},type:"float"};return function(){return t}},"gl.y":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"gl_FragCoord.y",hashCode:Object(Ri.a)("gl_FragCoord.y"),variables:{},model:function(e){return e},uniforms:{},type:"float"};return function(){return e.flash(),t}},"gl.+":ss,"gl.-":function(e,t){return e.needsHotReload=!0,e.typed(Object(Mi.a)(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"(".concat(Object(gi.b)(r[0]),") - (").concat(Object(gi.b)(r[1]),")")},t),function(e,t){if(Array.isArray(e)&&Array.isArray(t)){for(var n=[],r=0;r<e.length;r++)n.push(e[r]-t[r]);return n}return e-t}))},"gl.*":cs,"gl./":function(e,t){return e.needsHotReload=!0,Object(Ci.a)(Object(Mi.a)(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"(".concat(Object(gi.b)(r[0]),") / (").concat(Object(gi.b)(r[1]),")")},t),function(e,t){return e/t}),e,t)},"gl.dot":function(e,t){return e.needsHotReload=!0,e.typed(Object(yi.a)(function(n){var r=Object(bi.a)(n,t);return e.flash(),"(dot((".concat(Object(gi.b)(r[0]),"), (").concat(Object(gi.b)(r[1]),")))")},t))},"gl.xy":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"gl_FragCoord.xy",hashCode:"gl_FragCoord.xy",variables:{},model:function(e){return e},uniforms:{}};return function(){return t}},"gl.resolution":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"vec2(width, height)",hashCode:"vec2(width, height)",variables:{},uniforms:{}};return function(){return t}},"gl.width":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"width",hashCode:"width",type:"float"};return function(n){return Object(ea.a)(n,1)[0],e.flash(),t}},"gl.height":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"height",type:"float",hashCode:Object(Ri.a)("height")};return function(n){return Object(ea.a)(n,1)[0],e.flash(),t}},"gl.texture2D":Nu,"gl.textureVec2":function(e,t,n){return e.needsHotReload=!0,e.typed(function(e){var r=Object(ea.a)(e,1)[0],a=Object(gi.a)(r,t,n),i=a.codes,s=a.uniforms,o=a.functions,c=a.variables;return c=r.variables,o.texture_vec2={args:{a:"sampler2D",index:"float",length:"float"},returnType:"vec2",body:"\n\nreturn texture2D(a, vec2(index/length, 0.0)).xy;\n"},{code:"texture_vec2(".concat(i[0],", ").concat(Object(gi.b)(i[1]),", ").concat(Object(gi.b)(i[2]),")"),uniforms:s,functions:o,variables:c}})}},gi.d,Pi,Ii,{"gl.offset_v":function(e){return function(e){var t=Object(ea.a)(e,1)[0];window.offset_v=t,Object(Ma.b)("shader.render")}}},Xi,Lu,Du,{"gl.unpack":As,"gl.bad_uv":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"bad_uv",hashCode:Object(Ri.a)("(1.0*gl_FragCoord.xy-vec2(width, height))/height"),variables:{bad_uv:{code:"(1.0*gl_FragCoord.xy-vec2(width, height))/height+vec2(0.0, offset_v)",type:"vec2"}},model:function(e){return e},uniforms:{},type:"vec2"};return function(){return[t,Object(p.a)({},t,{hashCode:Object(Ri.a)("bad_uv.x"),code:"(bad_uv.x)",type:"float"}),Object(p.a)({},t,{hashCode:Object(Ri.a)("bad_uv.y"),code:"(bad_uv.y)",type:"float"})]}}},kl,{"gl.sdfManager":xl,"sdf.manager":xl,"gl.normalize":function(e){return e.typed(Object(yi.a)(function(e){var t=Object(bi.a)(e);return"normalize(".concat(Object(gi.b)(t[0]),")")}))},"sdf.simple":function(e){var t=new ys(e);return t.deleteInlet("operations"),t.deleteInlet("SDF Morpher"),t.deleteInlet("transformation matrix"),t.deleteInlet("transformation matrix list"),t.deleteOutlet("GL SDF Evaluators"),t.deleteOutlet("GL SDF List"),t.deleteOutlet("Transformed Positions"),function(){}},"gl.sdfBuilder":Pl,"sdf.builder":Pl,"gl.rayMarchingManager":Sl,"raymarching.manager":Sl,"gl.mat3":function(e,t,n){return e.typed(Object(yi.a)(function(r){var a=Object(bi.a)(r,t,n);return e.flash(),"mat3(".concat(Object(gi.b)(a[0]),", ").concat(Object(gi.b)(a[1]),", ").concat(Object(gi.b)(a[2]),")")},t,n))},"gl.sdfCopy":El,"sdf.copy":El,"gl.sdfMultiCopies":Tl,"sdf.multiCopies":Tl,"gl.sdfCubeLayout":Al,"sdf.cubeLayout":Al,"gl.uv":function(e){e.needsLoad=!0,e.needsHotReload=!0;var t={code:"(uv_b)",hashCode:Object(Ri.a)("((1.0*gl_FragCoord.xy-vec2(width, height))/vec(width, height))"),type:"vec2",variables:{uv_b:{code:"((1.0*gl_FragCoord.xy-vec2(width, height))/vec2(width, height)) + vec2(0.0, offset_v)",type:"vec2"}},model:function(e){return e},uniforms:{}};return function(){return[t,Object(p.a)({},t,{code:"(uv_b.x)",type:"float"}),Object(p.a)({},t,{code:"(uv_b.y)",type:"float"})]}}},dl,fl,{"gl.fog":function(e,t){return Object(yi.a)(function(e){var n=Object(bi.a)(e,t);return"1. - exp( -".concat(Object(gi.b)(n[0])," * ").concat(Object(gi.b)(n[1]),")")},t)},"gl.convertCoord":function(e,t){var n=[400,400];return Object(Ma.d)("canvas.size",function(e){n=e}),function(e){var r=Object(ea.a)(e,1)[0],a=t()||n||[400,400],i=[(2*r[0]-a[0])/a[1],-(2*r[1]-a[1])/a[1]],s=window.offset_v||0;return i[1]+=s,[i]}}},qu,Cl,cl,pl,sl,{"sdf.layers":function(e){new Qu(e);return e.setAttribute("primary-color","transparent"),e.hasInletFields=!0,function(){}}});function ql(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Il(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Il(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Il(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("uniqueAppend",{value:"",limit:""},"Appends but keeping indices of elements w same id ",function(){return 1},{inlets:2,connects:[{outlet:"Output 1",object:"sdf.manager",inlet:"SDF List"}]});function _l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Dl=function(e){Object(u.a)(n,e);var t=_l(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return n}(Va.a);function Fl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ll=function(e){Object(u.a)(n,e);var t=Fl(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newOutlet("playing"),r.newOutlet("stepNumber offset"),r.newOutlet("current stepNumber"),r.newOutlet("new percentage"),e.sequencerEngine.mixButtons.push(Object(c.a)(r)),r.newInlet("pause vs stop",function(e){var t=Object(ea.a)(e,1)[0];return r.onPauseOrStop(t)}),r.newInlet("toggle play/stop",function(e){var t=Object(ea.a)(e,1)[0];return r.onToggle(t)}),r.newInlet("stop",function(e){Object(ea.a)(e,1)[0];return r.onStop()}),r.newInlet("seek to percentage",function(e){var t=Object(ea.a)(e,1)[0];return r.seek(t)}),r.newInlet("pause",function(e){var t=Object(ea.a)(e,1)[0];return r.pause(t)}),r.newInlet("nudge",function(e){var t=Object(ea.a)(e,1)[0];return r.nudge(t)}),r.nudgeStorer=0,r}return Object(o.a)(n,[{key:"nudge",value:function(e){var t=this.sequencerEngine.stepNumberOffset+this.sequencerEngine.trackStep;t+32*e>=0&&this.sequencerEngine.seekToTrackStep(t+32*e,void 0,!0)}},{key:"scheduleNudge",value:function(e,t){this.scheduled={nudge:e,modulo:t}}},{key:"seek",value:function(e){if(e=parseFloat(e),!isNaN(e)){var t=this.sequencerEngine.tracks.filter(function(e){return e.sample}).map(function(e){return e.getSamplers()[0].getDuration()}),n=Math.max.apply(Math,Object(h.a)(t))/new W.a.Time("32n").toSeconds(),r=e/100*n;r-=r%32,r+=(this.sequencerEngine.stepNumberOffset+this.sequencerEngine.trackStep)%32,this.sequencerEngine.seekToTrackStep(r,void 0,!0),this.sendMessage("new percentage",r/n*100)}}},{key:"onToggle",value:function(e){this.sequencerEngine.dispatch(Object(C.Kb)(!0)),this.sequencerEngine.schedulePlay()}},{key:"onStop",value:function(){this.sequencerEngine.stop(),this.sequencerEngine.seekToTrackStep(0),this.sequencerEngine.dispatch(Object(C.Ic)(void 0)),this.sequencerEngine.dispatch(Object(C.A)(void 0)),this.sequencerEngine.dispatch(Object(C.y)(0))}},{key:"sendCurrentStepNumber",value:function(e){this.handleSchedules(e),this.sendMessage("current stepNumber",e)}},{key:"handleSchedules",value:function(e){this.scheduled&&e%this.scheduled.modulo===0&&(e+this.scheduled.nudge>=0&&this.sequencerEngine.seekToTrackStep(e+this.scheduled.nudge,void 0,!0),delete this.scheduled,this.nudgeStorer=0)}},{key:"onPauseOrStop",value:function(e){this.pauseOrStop=e}},{key:"pause",value:function(){this.sequencerEngine.playing&&this.sequencerEngine.play()}},{key:"handleStop",value:function(){if(this.pauseOrStop){var e=this.sequencerEngine.lastTrackStep||0;e+=this.sequencerEngine.stepNumberOffset||0,this.sequencerEngine.stepNumberOffset=e,this.sendMessage("stepNumber offset",e)}}}]),n}(Va.a);Object(Ca.a)("submix",{},"Mix between sub-sequences");Object(Ca.a)("mixbuttons",{},"Buttons to start/stop/record",function(){return 0},{inlets:0});function Bl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var zl=function(e){Object(u.a)(n,e);var t=Bl(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newInlet("roll",function(e){var t=Object(ea.a)(e,1)[0];return r.onRoll(t)}),r.newInlet("triplet roll",function(e){var t=Object(ea.a)(e,1)[0];return r.onRoll(t,!0)}),r.newInlet("enable roll-viewer",function(e){var t=Object(ea.a)(e,1)[0];return r.enableRollViewer(t)}),r}return Object(o.a)(n,[{key:"enableRollViewer",value:function(e){e=!!e,this.zObject.dispatch(Object(C.zb)(e))}},{key:"onRoll",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<=0)this.sequencerEngine.sequenceRolling=!1,this.sequencerEngine.trackRolling=!1;else{var n=new Tr.a(e,t);this.sequencerEngine.resolution=n,this.sequencerEngine.sequenceRolling=!0,this.sequencerEngine.trackRolling=!0}}}]),n}(Va.a);Object(Ca.a)("roll",{},"Roller",function(){return 0},{inlets:0});function Jl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Vl=function(e){Object(u.a)(n,e);var t=Jl(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newInlet("Speed",function(e){var t=Object(ea.a)(e,1)[0];return r.onSpeed(t)}),r.newInlet("Density",function(e){var t=Object(ea.a)(e,1)[0];return r.onDensity(t)}),r.newOutlet("Density "),r.newOutlet("Speed "),r.playhead.system5Objects.push(Object(c.a)(r)),r.densityEffect.system5Objects.push(Object(c.a)(r)),r}return Object(o.a)(n,[{key:"sendSpeeds",value:function(){this.sendMessage("Speed ",this.playhead.speedFactorParameter.get())}},{key:"sendDensities",value:function(){this.sendMessage("Density ",this.densityEffect.densityParameter.get())}},{key:"playhead",get:function(){return this.getRoot().playhead}},{key:"densityEffect",get:function(){return this.getRoot().midiEffects.shadowEffects[0]}},{key:"getRoot",value:function(){for(var e=this.subSequence;!e.tracks;)e=e.subSequence;return e}},{key:"onSpeed",value:function(e){this.playhead.speedFactorParameter.set(e)}},{key:"onDensity",value:function(e){this.getRoot().midiEffects.shadowEffects[0].densityParameter.set(e)}}]),n}(Va.a);Object(Ca.a)("system5",{},"Some system level controls over the subsequence");function Hl(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ul(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ul(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Ul(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Wl=function(e){Object(u.a)(n,e);var t=Gl(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).samples=[],r.newInlet("send sample",function(e){var t=Object(ea.a)(e,1)[0];return r.sendSample(t)}),r.newOutlet("sample"),r.lastSampleSent=void 0,r}return Object(o.a)(n,[{key:"deleteSample",value:function(e){this.samples=this.samples.filter(function(t){return t!==e})}},{key:"sendSample",value:function(e){("number"!==typeof e||(e=this.samples[e%this.samples.length]))&&(this.sendMessage("sample",e),this.lastSampleSent=e)}},{key:"addSample",value:function(e){this.samples.includes(e)||(this.samples=[].concat(Object(h.a)(this.samples),[e]))}},{key:"getJson",value:function(){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{samples:this.samples.map(function(e){return e.getId()})})}},{key:"fromJson",value:function(e,t){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.fetchSamples(e.samples)}},{key:"fetchSamples",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=Hl(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=11;break}return i=r.value,s=new q.a(i),e.next=8,s.load(!1);case 8:this.addSample(s);case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),n.e(e.t0);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}},e,this,[[1,13,16,19]])}));return function(t){return e.apply(this,arguments)}}()}]),n}(Va.a);Object(Ca.a)("sampleBank",{},"Store samples and send them to tracks",function(){return 0},{inlets:0});function Kl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ql=function(e){Object(u.a)(n,e);var t=Kl(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return n}(Va.a);Object(Ca.a)("ztracker",{},"A tracker for showing/editing a pattern like in the 90s");var Zl=n(276);Object(Ca.a)("tidal",{},"A tidal sequencer that sends triggers out",void 0,{});Object(Ca.a)("outputNumber",{n:"Slot number to send output"},"Sends triggers to specific slot in the pad (1-9)",void 0,{inlets:2});Object(Ca.a)("matrix",{},"Creates a 2D array",void 0,{operations:{set:{params:["x","y","value"],description:"Sets value at x, y position"}}});function Yl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Xl=function(e){Object(u.a)(n,e);var t=Yl(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).value=0,r.newInlet("input",function(e){var t=Object(ea.a)(e,1)[0];return r.onInput(t)}),r.newOutlet("output"),r}return Object(o.a)(n,[{key:"onInput",value:function(e){"start"!==e?"bang"===e?this.toggle():0!==e&&1!==e||(this.value=e,this.sendMessage("output",this.value)):this.sendMessage("output",this.value)}},{key:"toggle",value:function(){return this.value=0===this.value?1:0,this.sendMessage("output",this.value),this.value}},{key:"getJson",value:function(e){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e),{value:this.value,needsLoad:!0})}},{key:"fromJson",value:function(e,t){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.value=e.value,e.needsLoad?this.zObject.needsLoad=!0:this.zObject.needsLoad=!1}}]),n}(Va.a);Object(Ca.a)("toggle",{},"Toggles 0/1 when clicked",function(){return 0},{inlets:0});Object(Ca.a)("messageSplitter",{},"Splits multi-part message, sending out from each outlet",function(e){return e});Object(Ca.a)("messageFilter",{condition:""},"Lets messages pass through when condition is met.",void 0,{isHot:!0,inlets:2});Object(Ca.a)("messageFilterLazy",{condition:""},"Lets messages pass through when condition is met.",void 0,{inlets:2});Object(Ca.a)("dedupe",{},"only pass if different");Object(Ca.a)("message.rateLimit",{msg:"",rateLimit:"messages/sec"},"limits messages coming thru by messages/sec",function(){return 1},{inlets:2});Object(Ca.a)("record.messages",{messages:""},"Records incoming messages starting from when the record is engaged");Object(Ca.a)("play.messages",{messages:""},"Plays output of record.messages starting from when the play is engaged");var $l={"play.messages":function(e){e.needsTick=!0;var t,n=[],r=[],a=!1,i=void 0,s=void 0,o=function(){a=!0,s=0,r=Object(h.a)(n),t=r.shift()};return function(c){var u=Object(_a.a)(c),l=u[0];switch(u.slice(1),l){case v.k:return;case 1:return void(a||o());case 0:return void(a=!1);case"play":return void o();case"stop":return void(a=!1);case v.n:if(i=e.sequencerEngine.trackStep,a&&t){var f=i-s;if(t[0]<=f){var h=t;return t=r.shift(),[h[1]]}}return;default:n=l}}},"record.messages":function(e){var t;e.needsTick=!0;var n=[],r=0,a=void 0;return function(i){var s=Object(_a.a)(i),o=s[0],c=s.slice(1);switch(o){case"clear":return void(n=[]);case v.k:return void(a=W.a.Master.context.currentTime);case v.n:return Object(ea.a)(c,1)[0],void(t=e.sequencerEngine.trackStep);default:n.push([t-r,o,W.a.Master.context.currentTime-a])}return[n]}}};function ef(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return tf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tf(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function tf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function nf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var rf=function(e){Object(u.a)(n,e);var t=nf(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).snapshots=[],r.newInlet("cursor",function(e){var t=Object(ea.a)(e,2),n=t[0],a=t[1];return r.cursor=[n,a]}),r.newInlet(v.o,function(e){var t=Object(ea.a)(e,1)[0];r.tidals=t}),r.newInlet("take snapshot",function(e){return r.takeSnapshot(e)}),r.newInlet("use snapshot",function(e){var t=Object(ea.a)(e,1)[0];return r.useSnapshot(t)}),r.newOutlet("cursor"),r}return Object(o.a)(n,[{key:"takeSnapshot",value:function(){if(this.tidals&&this.cursor){var e,t=[],n=ef(this.tidals);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=r.cycle,i=r.cycleLength;t.push([a,i])}}catch(s){n.e(s)}finally{n.f()}this.snapshots=[].concat(Object(h.a)(this.snapshots),[{tidals:t,cursor:this.cursor}])}}},{key:"useSnapshot",value:function(e){var t=this.snapshots[e];t&&this.sendMessage.apply(this,["cursor"].concat(Object(h.a)(t.cursor)))}}]),n}(Va.a);Object(Ca.a)("jsnapshot",{},"Takes snapshots of the jaki object parameters to be recalled and sequenced",function(){return 0},{inlets:0});function af(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var sf=function(e){Object(u.a)(n,e);var t=af(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newOutlet("up"),r.newOutlet("down"),r.newOutlet("right"),r.newOutlet("left"),r.newOutlet("A"),r.newOutlet("B"),r}return n}(Va.a);Object(Ca.a)("dpad",{},"A d-pad interface for controlling via bangs",function(){return 0},{inlets:0});function of(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var cf=function(e){Object(u.a)(n,e);var t=of(n);function n(e){var r;return Object(s.a)(this,n),r=t.call(this,e),e.setAttribute("primary-color","#cdcdcd"),e.setAttribute("secondary-color","#b4b4b4"),r}return n}(Va.a);Object(Ca.a)("cirklon",{},"Cirklon sequencer interface",function(){return 0},{inlets:0});function uf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var lf=function(e){Object(u.a)(n,e);var t=uf(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newInlet("pattern switch",function(e){return r.patternSwitch([e])}),r.newOutlet("pattern switched"),r}return Object(o.a)(n,[{key:"patternSwitch",value:function(e){var t=this.zObject;e=Math.round(e);for(var n=t.subSequence;;){var r=t.subSequence;if(!r.zObject){n=t.subSequence;break}t=r.zObject}this.sequencerEngine.switchToPattern(e-1,!0,n)}}]),n}(Va.a);Object(Ca.a)("patterns",{},"Patterns manager",function(){return 0},{tags:"Sequencer",inlets:0});function ff(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hf=function(e){Object(u.a)(n,e);var t=ff(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newInlet(v.o,function(e){return r.tidals=e[0]}),r.newInlet("toggle lock",function(e){return r.lock(e[0])}),r}return Object(o.a)(n,[{key:"lock",value:function(e){this.tidals[e]&&this.tidals[e].lockGroove(!this.tidals[e].cycleParameter.immutable)}}]),n}(Va.a);Object(Ca.a)("jrepl",{},"Analyze & control underlying tidal patterns in a jaki object",function(){return 0},{inlets:0});var pf=n(341),df=n(310),vf=n(275);function mf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var yf=function(e){Object(u.a)(n,e);var t=mf(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e,!1)).store=e.sequencerEngine.store,r.track=e,r.parameters=[],r.loaded=!0,r.valueParameter=new re.a("value",Object(c.a)(r),function(e,t,n,a){return r.onValue(t,a)},{defaultValue:0}),r.setupRampParameters(),e.effect=Object(c.a)(r),r.value=0,r.context=(new V.a).forZObject(Object(c.a)(r)),r.newInlet("value",function(e){var t=Object(ea.a)(e,1)[0];return r.setValue(t)}),r.newInlet("map parameter",function(e){var t=Object(ea.a)(e,1)[0];return r.onMapParameter(t)}),r.newOutlet("value changed"),r.newOutlet("map parameter "),r.zObject.newAttribute("set exactly",!1),r}return Object(o.a)(n,[{key:"onMapParameter",value:function(e){if(e.audioParam||Array.isArray(e)){var t,n;if(e.audioParam)"depth"===(t=e).name&&t.set(0),n=100;else{var r=Object(ea.a)(e,3),a=r[0],i=r[1];if(n=r[2],!i||!a)return;t=a.parameters.find(function(e){return e.name.toLowerCase().includes(i.toLowerCase())})}t&&(this._parameters.includes(t)||this.lostParameters&&this.lostParameters.find&&this.lostParameters.find(function(e){return e.id===t.id})||this.setParameter(t),this.depthParameters[this._parameters.length-1]&&this.depthParameters[this._parameters.length-1].set(n||1))}}},{key:"getJson",value:function(){return Object(p.a)({},this.getMappableJson(),{id:this.id,value:this.value})}},{key:"fromJson",value:function(e,t){this.loaded=!1,Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),void 0!==e.value&&(this.value=e.value),this.loaded=!0,this.sendMessage("value changed",e.value)}},{key:"sortParameters",value:function(){}},{key:"min",get:function(){return 0}},{key:"max",get:function(){return 1}},{key:"value",get:function(){return this.valueParameter.get()},set:function(e){this.valueParameter.set(e,!0,!0),this.zObject.onValueChange(e)}},{key:"setValue",value:function(e){this.valueParameter.set(e,!1,!0)}},{key:"onValue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.value,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W.a.Master.context.currentTime;if(this.loaded&&e!==this.lastValue&&!isNaN(e)){this.zObject.onValueChange(e),this.sequencerEngine.playing||this.sequencerEngine.dispatch(Object(C.tb)(this.id,e));for(var n={},r=0;r<this._parameters.length;r++){var a=this._parameters[r],i=a.max,s=a.min,o=this.getDepth(r),c=this.initialParameterValues[r],u=o<0?c-s:i-c,l=c+e*(this.getDepth(r)/100)*u,f=a.set(this.zObject.attributes["set exactly"]?e:Math.min(i,Math.max(s,l)),!0,!0,t,this.rampTime/1e3),h=f.id,d=f.value;n[h]=d}this.lastValue=e,this.sequencerEngine.playing?this.parametersToUpdate=Object(p.a)({},this.parametersToUpdate,n):this.sequencerEngine.dispatch(Object(C.ub)(n)),this.sendMessage("value changed",e)}}},{key:"fromValueJson",value:function(e){e.value&&(this.value=e.value)}},{key:"getValueJson",value:function(){return{value:this.value}}}]),n}(Object(df.a)(Object(vf.a)(Object(pf.a)(Va.a))));Object(Ca.a)("macro",{name:""},"Map several parameters to a macro object to control",function(){return 0},{inlets:0});var bf=n(357),gf=Object(bf.a)();function Of(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return kf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kf(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function kf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function jf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wf=function(e){Object(u.a)(n,e);var t=jf(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newOutlet("script"),r.code="",r.logs=[],r.storedMatches=[],r}return Object(o.a)(n,[{key:"clearErrors",value:function(e){this.syntaxErrors=void 0}},{key:"onNewErrors",value:function(e){var t=e[0];if(!(t.length<7)){var n=t[6].split("\n"),r=t[7].split("\n"),a=this.checkCode(n,!0),i=this.checkCode(r);this.syntaxErrors=a||i}}},{key:"checkCode",value:function(e,t){var n,r=0,a=-1,i=-1,s=this.code.split("\n").filter(function(e){return""!==e}),o=Of(e);try{for(o.s();!(n=o.n()).done;){var c=n.value;c.includes(s[0])&&(i=r),c.includes("1: #version 300 es")&&(a=r),c.includes("equirectUv")&&(i=r+6),t&&c.startsWith("57:")&&(i=r+1),r++}}catch(h){o.e(h)}finally{o.f()}var u,l=[],f=Of(e.slice(1,a));try{for(f.s();!(u=f.n()).done;){var h=u.value;if(!h.includes("#version")){var p=h.split(" ")[1].split(":")[1],d=parseFloat(p)-i;d+=t?1:2,l.push({lineNumber:d,errorMessage:h.slice(h.indexOf(p)+p.length)})}}}catch(h){f.e(h)}finally{f.f()}var v=e.slice(i).map(function(e){return e.slice(e.indexOf(":")+2)}),m=this.parsedCode||this.code;if(1!==v.length)return v.every(function(e){return m.includes(e)})?l:void 0}},{key:"getJson",value:function(e){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e),{code:this.code})}},{key:"fromJson",value:function(e,t){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.code=e.code}},{key:"doc",get:function(){return gf}},{key:"eval",value:function(e){this.code=e}},{key:"hasSyntaxError",value:function(e){return!1}},{key:"code",get:function(){return this._script},set:function(e){this._script=e,e=this.parseScript(e),this.sendMessage("script",e)}},{key:"parsedCode",get:function(){this.parseScript(this._script)}},{key:"parseScript",value:function(e){var t=this;if(e){var n=e.match(/@[a-z]*/g);if(!n)return e;var r,a=Of(n);try{var i=function(){var n=r.value,a=n.slice(1);t.inlets[a]||t.newInlet(a,function(e){var n=Object(ea.a)(e,1)[0];t.storedMatches[a]=n,t.eval(t.code)}),e=e.replaceAll(n,t.storedMatches[a]||"")};for(a.s();!(r=a.n()).done;)i()}catch(s){a.e(s)}finally{a.f()}return e}}}]),n}(Va.a);Object(Ca.a)("script",{},"Write script to control some other object that uses scripting",function(){return 0},{tags:"Scripting",inlets:0});Object(Ca.a)("envelope.attack",{number:""},"Triggers envelope specified by nnumber",function(){return 0});Object(Ca.a)("envelope.release",{number:""},"Triggers envelope specified by nnumber",function(){return 0});var xf={"envelope.attack":function(e,t){return function(){for(var n=e.subSequence;!n.tracks&&n.subSequence;)n=n.subSequence;n.envelopesTrack.envelopes[t()||0].envelope.triggerAttack()}},"envelope.release":function(e,t){return function(){for(var n=e.subSequence;!n.tracks&&n.subSequence;)n=n.subSequence;n.envelopesTrack.envelopes[t()||0].envelope.triggerRelease()}}},Sf=n(580);Object(Ca.a)("key.shortcut",{bang:"",key:""},"Listens for key press events and triggers a bang when they occur",void 0,{tags:"Keyboard",isHot:!0,inlets:2});Object(Ca.a)("key.down",{bang:"",key:""},"Listens for key press events and triggers a bang when they occur",void 0,{tags:"Keyboard",isHot:!0,inlets:2});Object(Ca.a)("key.up",{bang:"",key:""},"Listens for key up events and triggers a bang when they occur",void 0,{tags:"Keyboard",isHot:!0,inlets:2});var Pf={"key.shortcut":function(e,t){var n=void 0;e.needsLoad=!0;var r=function(t){if(!Object(Sf.a)(t)&&t.key===n){if(e.sequencerEngine.isAnyTrackEnabled())return;e.sendMessage(e.outputByNumber(0),"bang")}};return window.addEventListener("keydown",r),function(a){var i=t();if("dispose"===a[0])return n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.removeBinding(n),void window.removeEventListener("keydown",r);n&&i!==n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.removeBinding(n),i&&i!==n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.addBinding(i),n=i}},"key.up":function(e,t){var n=void 0;e.needsLoad=!0;var r=function(t){if(!Object(Sf.a)(t)&&t.key===n){if(e.sequencerEngine.isAnyTrackEnabled())return;e.sendMessage(e.outputByNumber(0),"bang")}};return window.addEventListener("keyup",r),function(a){var i=t();if("dispose"===a[0])return n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.removeBinding(n),void window.removeEventListener("keyup",r);n&&i!==n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.removeBinding(n),i&&i!==n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.addBinding(i),n=i}},"key.down":function(e,t){var n=void 0;e.needsLoad=!0;var r=function(t){if(!Object(Sf.a)(t)&&t.key===n){if(e.sequencerEngine.isAnyTrackEnabled())return;e.sendMessage(e.outputByNumber(0),"bang")}};return window.addEventListener("keydown",r),function(a){var i=t();if("dispose"===a[0])return n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.removeBinding&&e.sequencerEngine.keyListener.removeBinding(n),void window.removeEventListener("keydown",r);n&&i!==n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.removeBinding(n),i&&i!==n&&e.sequencerEngine.keyListener&&e.sequencerEngine.keyListener.addBinding(i),n=i}}};Object(Ca.a)("store",{bang:"","stored message":""},"Stores a message until it receives a bang, which triggers it to send that stored message",void 0,{tags:"Messages",inlets:2});var Ef=n(299),Tf=(n(198),n(913));function Af(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Mf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mf(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Mf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("centroid",{pts:""},"Centoid of ist of poinnts");var Rf=function(){return function(e){for(var t=Object(ea.a)(e,1)[0],n=0,r=0,a=0;a<t.length;a+=2)n+=t[a],r+=t[a];return[[n/(t.length/2),r/(t.length/2)]]}};Object(Ca.a)("dHull",{pts:"",length:""},"computes hull for pts index",void 0,{inlets:2,isHot:!0,tags:"Graphics"});var Cf=function(e,t,n){return e<n&&n<t||e>n&&n>t},Nf=function(e,t,n,r,a){if(1===e.length)return 0;for(var i=e.length,s=[],o=0;o<i;o++){var c=o,u=(o+1)%i;Ff(n[2*c],n[2*c+1],n[2*u],n[2*u+1])<20||(Cf(e[c],e[u],t)||o===i-1&&Cf(e[c],2*Math.PI-e[u],t))&&s.push(c)}for(var l=1e5,f=void 0,h=0,p=s;h<p.length;h++){var d=p[h],v=d,m=(d+1)%i,y=(Ff(n[2*v],n[2*v+1],r,a)+Ff(n[2*m],n[2*m+1],r,a))/2;0===m&&(y*=1.7),y>140||y<l&&(l=y,f=m)}return f},qf=function(e,t,n){for(var r=0,a=0;a<e.length;a+=2){var i=a/2;t.includes(i)||(n[r++]=e[a],n[r++]=e[a+1])}};function If(e,t,n){for(var r=arguments.length,a=new Array(r>3?r-3:0),i=3;i<r;i++)a[i-3]=arguments[i];return 1===arguments.length?e:(t=Math.max(t,0),n=Math.max(n,0),a=a||[],e.set(e.subarray(t+n,e.length-a.length),t+a.length),e.set(a,t),e)}var _f=function(e,t,n,r){r.sort(function(r,a){return Df(e,t,r,n)-Df(e,t,a,n)})},Df=function(e,t,n,r){var a,i=1e5,s=t[2*n],o=t[2*n+1],c=Af(r);try{for(c.s();!(a=c.n()).done;){var u=a.value,l=e[2*u],f=e[2*u+1],h=Ff(l,f,s,o);h<10&&(h*=1e4),h<i&&(i=h)}}catch(p){c.e(p)}finally{c.f()}return i},Ff=function(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))};Object(Ca.a)("loadBang",{},"Sends bang on load",void 0,{tags:"Bang"});Object(Ca.a)("startBang",{},"Sends bang on start",void 0,{tags:"Bang"});Object(Ca.a)("averageDistance",{a:"",b:""},"Computes average distance",void 0,{inlets:2});Object(Ca.a)("average",{list:"",b:""},"Computes average of list",void 0,{inlets:1});Object(Ca.a)("three.shaderMaterial",{},"Creates a material out of shaders",function(){return 0},{tags:"Graphics",inlets:0,connects:{object:"three.mesh",inlet:"1"}});Object(Ca.a)("three.basicMaterial",{color:"",wireframe:""},"Creates a basic material with color in 2nd inlet",void 0,{tags:"Graphics",isHot:!0,inlets:2,connects:{object:"three.mesh",inlet:"1"}});Object(Ca.a)("three.vertexColorsMaterial",{color:"",wireframe:""},"Creates a basic material with color in 2nd inlet",void 0,{tags:"Graphics",isHot:!0,inlets:2,connects:{object:"three.mesh",inlet:"1"}});Object(Ca.a)("three.setVertexColors",{color:"",wireframe:""},"Creates a basic material with color in 2nd inlet",void 0,{tags:"Graphics",isHot:!0,inlets:2,connects:{object:"three.mesh",inlet:"1"}});Object(Ca.a)("three.pointsMaterial",{color:""},"Creates a basic material with color in 2nd inlet",void 0,{tags:"Graphics",inlets:1});var Lf={"three.vertexColorsMaterial":function(e,t){var n=new ks.B({vertexColors:!0,wireframe:!1,blending:ks.a});return n.side=ks.o,n.needsUpdate=!0,function(e){var r=Object(ea.a)(e,1)[0];return r&&"string"===typeof r&&(r=new ks.k(r)),n.color=r||16777215,n.side=ks.o,n.wireframe=!!t(),n.needsUpdate=!0,[n]}},"three.setVertexColors":function(e,t){return function(e){for(var n=Object(ea.a)(e,1)[0],r=n.getAttribute("position"),a=t()||[],i=[],s=new ks.k,o=0;o<r.count;o+=3)s.set(a[o%a.length]||16777215*Math.random()),i.push(s.r,s.g,s.b),i.push(s.r,s.g,s.b),i.push(s.r,s.g,s.b);return n.setAttribute("color",new ks.q(i,3)),[n]}},"three.pointsMaterial":function(e,t){var n=new ks.N({color:16777215,blending:ks.a});return n.needsUpdate=!0,function(e){var t=Object(ea.a)(e,1)[0];return t&&"string"===typeof t&&(t=new ks.k(t)),n.color=t||16777215,n.needsUpdate=!0,[n]}},"three.basicMaterial":function(e,t){var n=new ks.B({color:16777215,wireframe:!1,blending:ks.a});return n.side=ks.o,n.needsUpdate=!0,function(e){var r=Object(ea.a)(e,1)[0];return r&&"string"===typeof r&&(r=new ks.k(r)),n.color=r||16777215,n.side=ks.o,n.wireframe=!!t(),n.needsUpdate=!0,[n]}},"three.shaderMaterial":function(e){var t=new Eu(e);return e.effect=t,function(){}}};n(806);function Bf(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return zf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zf(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function zf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("spline",{tension:"",points:""},"Returns cubic spline",void 0,{tags:"Graphics",inlets:3});Object(Ca.a)("convexHull",{},"Returns convex hull as Float32Array of pts");Object(Ca.a)("delaymessage",{},"Sends bang message to outlets in order (left-to-right). Each argument creates an outlet eg: bangbang 0 0 0 0 ceates 4 outlets)",function(e){return e},{inlets:2,tags:"Bang"});Object(Ca.a)("bangbang",{},"Sends bang message to outlets in order (left-to-right). Each argument creates an outlet eg: bangbang 0 0 0 0 ceates 4 outlets)",function(e){return e},{inlets:1,tags:"Bang"});Object(Ca.a)("messagemessage",{},"Sends messages to outlets in order (left-to-right). Each argument creates an outlet eg: bangbang 0 0 0 0 ceates 4 outlets)",function(e){return e},{inlets:1,tags:"Bang"});Object(Ca.a)("altbang",{},"Sends bang message to outlet alternating order (left-to-right)",function(e){return e},{inlets:1,tags:"Bang"});Object(Ca.a)("alt",{},"Sends message to outlet alternating order (left-to-right)",function(e){return e},{inlets:1,tags:"Order"});Object(Ca.a)("ifSend",{},"Sends message if argument is true",function(e){return 1},{inlets:2});Object(Ca.a)("randomThru",{},"Sends message to a randomly selected outlet",function(e){return e},{inlets:1,tags:"Order"});var Jf={randomThru:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.needsStart=!0,function(t){var r=Object(ea.a)(t,1)[0];if(r!==v.k){var a=n.filter(function(e){return void 0!==e()}).length,i=Math.floor(Math.random()*a);e.sendMessage(e.outputByNumber(i),r)}}},ifSend:function(e,t){return function(e){if(t())return e}},messagemessage:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t=[];return n.forEach(function(n,r){void 0===n()&&t.push(void 0),t.push(e[0])}),t}},alt:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=0;return e.needsStart=!0,function(t){var r=Object(ea.a)(t,1)[0];if(r!==v.k){var i=n.filter(function(e){return void 0!==e()}),s=a++%i.length;e.sendMessage(e.outputByNumber(s),r)}else a=0}},bangbang:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(t){n.forEach(function(t,n){void 0!==t()&&e.sendMessage(e.outputByNumber(n),"bang")})}},altbang:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=0;return e.needsStart=!0,function(t){if(Object(ea.a)(t,1)[0]!==v.k){var r=n.filter(function(e){return void 0!==e()}),i=a++%r.length;e.sendMessage(e.outputByNumber(i),"bang")}else a=0}},delaymessage:function(e,t){return function(n){isNaN(t())||setTimeout(function(){e.sendMessage(e.outputByNumber(0),n)},t())}}};Object(Ca.a)("three.orthographicCamera",{left:"",right:"",top:"",bottom:"",near:"",far:""},"Create an orthographic camera ",void 0,{tags:"Graphics",isHot:!0,inlets:7,connects:{object:"three.render",inlet:"1"},operations:Vf});var Vf={position:{parameters:["x","y","z"],description:"Sets the position of the camera."},lookAt:{parameters:["x","y","z"],description:"Sets where the camera is pointing"},zoom:{parameters:["amount"],description:"Sets the zoom of the camera"}},Hf=function(e){return e.split(" ").filter(function(e){return""!==e}).slice(1).map(function(e){return parseFloat(e)})},Uf=function(e,t){if("bang"===t)return!1;if("string"===typeof t){if(t.startsWith("position")){var n=Hf(t),r=Object(ea.a)(n,3),a=r[0],i=r[1],s=r[2];return e.position.x=a,e.position.y=i,e.position.z=s,!0}if(t.startsWith("lookAt")){var o=Hf(t),c=Object(ea.a)(o,3),u=c[0],l=c[1],f=c[2];return e.lookAt(u,l,f),!0}if(t.startsWith("zoom")){var h=Hf(t),p=Object(ea.a)(h,1)[0];return e.zoom=p,!0}}return!1};Object(Ca.a)("three.perspectiveCamera",{fov:"",aspect:"",near:"",far:""},"Create a perspective camera ",void 0,{tags:"Graphics",isHot:!0,inlets:5,operations:Vf,connects:{object:"three.render",inlet:"1"}});var Gf=function(e,t){return void 0===e?t:e},Wf={"three.orthographicCamera":function(e,t,n,r,a,i,s){e.needsStart=!0;var o=new ks.I(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1e4,1e4);return o.position.z=0,o.position.y=0,o.position.x=0,function(e){var c=Object(ea.a)(e,1)[0];Uf(o,c);var u=Gf(t(),-1),l=Gf(n(),1),f=Gf(r(),-1),h=Gf(a(),1),p=Gf(i(),1),d=Gf(s(),1);return o.left=u,o.right=l,o.top=f,o.bottom=h,o.far=d,o.near=p,o.updateProjectionMatrix(),o}},"three.perspectiveCamera":function(e,t,n,r,a){var i=new ks.J(80,1,1,1e4);return i.position.z=5,e.needsStart=!0,function(e){var s=Object(ea.a)(e,1)[0];Uf(i,s);var o=Gf(t(),80),c=Gf(n(),1),u=Gf(r(),1),l=Gf(a(),1e4);return i.fov=o,i.aspect=c,i.far=l,i.near=u,i.updateProjectionMatrix(),[i]}}},Kf=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"function"===typeof e?e.apply(void 0,n):e};Object(Ca.a)("three.mesh",{geometry:"",material:""},"Create a mesh out of geometry and material",function(){return 1},{isHot:!0,inlets:2,connects:{object:"three.scene"},operations:{position:{parameters:["x","y","z"],description:"Sets the position of the mesh."},rotation:{parameters:["x","y"],description:"Rotates the mesh."}}});var Qf=function(e,t){var n,r;return function(e){var a=Object(ea.a)(e,1)[0];if("string"===typeof a)if(a.startsWith("position")){var i=a.split(" ").slice(1).map(function(e){return parseFloat(e)}),s=Object(ea.a)(i,3),o=s[0],c=s[1],u=s[2];n&&(n.position.x=o,n.position.y=c,n.position.z=u)}else if(a.startsWith("rotation")){var l=a.split(" ").slice(1).map(function(e){return parseFloat(e)}),f=Object(ea.a)(l,2),h=f[0];f[1];n&&(n.rotation.x=h,n.rotation.y=h)}if(a&&a.attributes||n)return(!n||Kf(t)&&r!==Kf(t))&&((r=Kf(t)||new ks.B({color:4388225,wireframe:!0})).side=ks.o,r.needsUpdate=!0,n?n.material=r:n=new ks.A(a,r)),[n]}};Object(Ca.a)("three.cube",{x:"",y:"",z:""},"Create a cube",function(){return 1},{tags:"Graphics",isHot:!0,inlets:3});Object(Ca.a)("three.gridHelper",{},"Grid helper",function(){return 1},{tags:"Graphics"});Object(Ca.a)("three.points",{points:"",size:"",material:"",isStatic:""},"Creates an object of poinntss to be added to a scene",void 0,{tags:"Graphics",isHot:!0,inlets:4});Object(Ca.a)("three.attribute",{mesh:"",name:"",itemSize:"",array:""},"Receives a Mesh object and sets an attribute with the arguments",void 0,{tags:"Graphics",inlets:4});var Zf={"three.attribute":function(e,t,n,r){var a=!1;return function(e){var i=Object(ea.a)(e,1)[0];if(i&&i.geometry&&t()&&n()&&r()){var s=i.geometry;return a&&s.attributes[t()].array.length===r().length?(s.attributes[t()].array.set(r(),0),s.attributes[t()].needsUpdate=!0):s.setAttribute(t(),new ks.g(r(),n())),a=!0,[i]}}},"three.points":function(e,t,n,r){var a,i,s,o=void 0;return function(e){var c=Object(ea.a)(e,1)[0];if(ArrayBuffer.isView(c))if(!a||n()&&n()!==s.material){a||(a=new ks.h);var u=c;r()||(u=new Float32Array(2*c.length)).set(c,0),a.setAttribute("position",new ks.q(u,3)),i=n()||new ks.N({color:10079487,size:t()||1}),s?(s.material=i,s.material.needsUpdate=!0):s=new ks.M(a,i),a.setDrawRange(0,c.length/3)}else!r()&&a.attributes.position.array.length<c.length?(a.setAttribute("position",new ks.q(c,3)),a.attributes.position.needsUpdate=!0):r()||(a.attributes.position.array.set(c,0),a.attributes.position.needsUpdate=!0),a.setDrawRange(0,c.length/3),o!==(t()||1)&&(s.material.size=t()||1,s.material.needsUpdate=!0,o=s.material.size);return[s]}},"three.gridHelper":function(){var e=new ks.s(10,10);return function(){return[e]}},"three.cube":function(e,t,n){var r=new ks.e(100,100,100),a=new ks.E;a.side=ks.o;var i=new ks.A(r,a);return function(e){var r=Object(ea.a)(e,1)[0];return i.position.x=void 0===r?2:r,i.position.y=void 0===t()?2:t(),i.position.z=void 0===n()?2:n(),[i]}},"three.mesh":Qf};Object(Ca.a)("float32Array",{list:""},"creates a Float32Array out of a list",void 0,{tags:"List"});function Yf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Xf=function(e){Object(u.a)(n,e);var t=Yf(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ks.U([new ks.bb(0,.5),new ks.bb(-.5,-.5),new ks.bb(.5,-.5)]),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return Object(s.a)(this,n),(e=t.call(this)).inited=!1,e.updateShapes(r,a),e}return Object(o.a)(n,[{key:"updateShapes",value:function(e,t){this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};var n=[],r=[],a=[],i=[],s=0,o=0;if(!1===Array.isArray(e))u(e);else for(var c=0;c<e.length;c++)u(e[c]),this.addGroup(s,o,c),s+=o,o=0;function u(e){var s=r.length/3,c=e.extractPoints(t),u=c.shape,l=c.holes;!1===ks.V.isClockWise(u)&&(u=u.reverse());for(var f=0,h=l.length;f<h;f++){var p=l[f];!0===ks.V.isClockWise(p)&&(l[f]=p.reverse())}for(var d=ks.V.triangulateShape(u,l),v=0,m=l.length;v<m;v++){var y=l[v];u=u.concat(y)}for(var b=0,g=u.length;b<g;b++){var O=u[b];r.push(O.x,O.y,0),a.push(0,0,1),i.push(O.x,O.y)}for(var k=0,j=d.length;k<j;k++){var w=d[k],x=w[0]+s,S=w[1]+s,P=w[2]+s;n.push(x,S,P),o+=3}}this.inited&&this.index.array.length>=n.length?(this.index.array.set(n,0),this.index.needsUpdate=!0):(this.setIndex(n),this.index.needsUpdate=!0),this.inited&&this.attributes.position.array.length>=r.length?(this.attributes.position.array.set(r,0),this.attributes.position.needsUpdate=!0):(this.setAttribute("position",new ks.q(r,3)),this.attributes.position.needsUpdate=!0),this.inited&&this.attributes.normal.array.length>=a.length?(this.attributes.normal.array.set(a,0),this.attributes.normal.needsUpdate=!0):(this.setAttribute("normal",new ks.q(a,3)),this.attributes.normal.needsUpdate=!0),this.inited&&this.attributes.uv.array.length>=i.length?(this.attributes.uv.array.set(i,0),this.attributes.uv.needsUpdate=!0):(this.setAttribute("uv",new ks.q(i,2)),this.attributes.uv.needsUpdate=!0),this.inited&&this.computeVertexNormals(),this.inited=!0,this.setDrawRange(0,n.length)}},{key:"toJSON",value:function(){var e=Object(ne.a)(Object(f.a)(n.prototype),"toJSON",this).call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var a=e[n];t.shapes.push(a.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}],[{key:"fromJSON",value:function(e,t){for(var r=[],a=0,i=e.shapes.length;a<i;a++){var s=t[e.shapes[a]];r.push(s)}return new n(r,e.curveSegments)}}]),n}(ks.h);Object(Ca.a)("three.bufferGeometry",{vertices:"",itemSize:"",index:""},"Create a BufferGeometry (to be passed to three.mesh)",function(){return 1},{tags:"Graphics",inlets:3,connects:{object:"three.mesh"}});var $f=function(e,t,n){var r=new ks.h,a=!1,i=!1;return function(e){var s=Object(ea.a)(e,1)[0];if(s&&s.buffer){if(a)s.length>r.attributes.position.array.length?r.attributes.position.array=s:r.attributes.position.array.set(s,0),i=!1;else{var o=new Float32Array(2*s.length);o.set(s,0),r.setAttribute("position",new ks.g(o,Kf(t)||3)),a=!0}r.attributes.position.needsUpdate=!0}if(Kf(n)&&"string"!==typeof Kf(n)&&!i){if(r.index&&r.index.array.length>=Kf(n).length)r.index.array.set(Kf(n),0);else{var c=new Uint32Array(2*Kf(n).length);c.set(Kf(n),0),r.setIndex(new ks.g(c,1))}r.index.needsUpdate=!0,r.computeVertexNormals(),r.attributes.normal.needsUpdate=!0,i=!0}if(Kf(n)&&r.setDrawRange(0,Kf(n).length),i)return[r]}};Object(Ca.a)("three.circleGeometry",{bang:"Sends the geometry out through the outlet"},"Create a simple circle geometry (to be passed to mesh)",function(){return 1},{tags:"Graphics",connects:{object:"three.mesh"}});Object(Ca.a)("three.planeGeometry",{width:"",height:""},"Create a PlaneGeometry(to be passed to three.mesh)",function(){return 1},{tags:"Graphics",inlets:2,connects:{object:"three.mesh"}});Object(Ca.a)("three.renderTarget",{width:"",height:""},"Set the renderTarget for a canvas",function(){return 2},{tags:"Graphics",inlets:2,outlets:["target","texture"],connects:{object:"three.canvas",inlet:"renderTarget"}});Object(Ca.a)("three.torus",{x:"",y:"",z:""},"Create a cube",function(){return 1},{tags:"Graphics",inlets:3});Object(Ca.a)("three.boxGeometry",{},"Create a simple box geometry (to be passed to mesh)",function(){return 1},{tags:"Graphics",connects:{object:"three.mesh"}});Object(Ca.a)("three.shapeGeometry",{vertices:"List of points",segmentLength:"Number of segments"},"Create a simple box geometry (to be passed to mesh)",function(){return 1},{tags:"Graphics",inlets:2,connects:{object:"three.mesh"}});var eh={"three.shapeGeometry":function(e,t){var n;return function(e){for(var r=Object(ea.a)(e,1)[0],a=[],i=0;i<r.length;i+=2)a.push(new ks.bb(r[i],r[i+1]));var s=t()||200;return n?n.updateShapes(new ks.U(a),s):n=new Xf(new ks.U(a),s),[n]}},"three.circleGeometry":function(e){var t=new ks.j(133,64);return function(e){return Object(ea.a)(e,1)[0],[t]}},"three.boxGeometry":function(e,t,n,r,a,i,s){return function(e){return Object(ea.a)(e,1)[0],[new ks.f(t()||100,n()||100,r()||100,a()||10,i()||10,s()||10)]}},"three.torus":function(e,t,n){var r=new ks.Z(100,25,15,30),a=new ks.B({color:5592405}),i=new ks.A(r,a);return function(e){return Object(ea.a)(e,1)[0],[i]}},"three.renderTarget":function(e,t){var n=new ks.eb(300,300,{minFilter:ks.x,magFilter:ks.x,format:ks.P});return function(e){var r=Object(ea.a)(e,1)[0];return"texture"===r?[void 0,n.texture]:"bang"===r?[n]:(r&&t()&&(r!==n.width||t()!==n.height)&&(n=new ks.eb(r,t(),{minFilter:ks.x,magFilter:ks.G,format:ks.P})),[n])}},"three.bufferGeometry":$f,"three.planeGeometry":function(e,t){var n=new ks.L(300,300);return function(t){return Object(ea.a)(t,1)[0],e.geometry=n,[n]}}};function th(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return nh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function nh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ah=function(e,t){var n=t.zobject;e.instances.forEach(function(e){var t=e.lookupObject(n);console.log("DELETING OBJ=",n,t),t&&t.delete()})},ih=function(e,t){var n=t.zmessage;e.instances.forEach(function(e){var t=e.lookupObject(n);console.log("DELETING OBJ=",n,t),t&&e.deleteNode(t)})},sh=function(e,t){var n=t.zobject,r=n._text;e.instances.forEach(function(e){e.registerObject(n,e.createZObject(0,0,r))})},oh=function(e,t){var n=t.zmessage,r=n.dataType;e.instances.forEach(function(e){var t=e.createZMessage(0,0,r);e.registerObject(n,t)})},ch=function(e,t){var n=t.inlet,r=t.isInstanceInlet;e.instances.forEach(function(e){e.registerObject(n,r?e.newInstanceInlet():e.newInlet())})},uh=function(e,t){var n=t.outlet;e.instances.forEach(function(e){e.registerObject(n,e.newOutlet())})},lh=function(e,t){var n=t.sourceNode,r=t.destNode,a=t.sourceType,i=t.destType;e.instances.forEach(function(e){var t=e.lookupObject(n);e.lookupObject(r).connectInlet(i,t,a)})},fh=function(e,t){var n=t.sourceNode,r=t.destNode,a=t.sourceType,i=t.destType;e.instances.forEach(function(e){var t=e.lookupObject(n);e.lookupObject(r).disconnectInlet(i,t,a)})},hh=function(e,t){var n=t.zobject,r=t.text;e.instances.forEach(function(e){var t=e.lookupObject(n);t&&(t.text=r)})},ph=function(e,t){var n=t.zmessage,r=t.text;e.instances.forEach(function(e){var t=e.lookupObject(n);t&&(t.text=r)})},dh=function(e,t){var n=t.inletNumber;e.instances.forEach(function(e){var t=e.inletObjects.find(function(e){return e.inletNumber===n});e.toggleInlet(t)})};function vh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function mh(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return yh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function yh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var bh=function(e,t){var n={};for(var r in t)n[e[r]||r]=t[r];return n},gh=function(e,t){var n={};for(var r in t){var a,i=Oh(e,r),s=[],o=mh(t[r]);try{for(o.s();!(a=o.n()).done;){var c=a.value,u={};for(var l in c)u[l]=Oh(e,c[l]);s.push(u)}}catch(f){o.e(f)}finally{o.f()}n[i]=s}return n},Oh=function(e,t){var n=t.split(".");return 1===n.length?e[n[0]]||t:n[0]+"."+e[n[1]]};function kh(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return jh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function jh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function wh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function xh(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Sh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Sh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Sh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ph=function(e){var t={},n=[],r=[];for(var a in e){var i,s=[],o=xh(e[a]);try{for(o.s();!(i=o.n()).done;){var c=i.value,u=c.node,l=c.type,f=void 0,h=void 0,p=void 0,d=void 0,v=void 0;u.zObject&&(u=u.zObject),u.getObjectType&&("zmessage"===u.getObjectType()&&(f=u.type,h=u.min,p=u.max,d=u.round,v=u.message),u.getObjectType()===ua.a&&(u.getEffectType()===he.c&&n.push(u),u.getEffectType()===he.a&&r.push(u)),s.push({node:u.getObjectType(),type:l,subType:f,min:h,max:p,round:d,value:v,name:u.name}))}}catch(m){o.e(m)}finally{o.f()}t[a]=s}return{json:t,midiEffects:n,effects:r}};function Eh(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Th(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Th(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Th(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ah=function(){function e(t){Object(s.a)(this,e),this.subpatch=t,this.nameToObject={},this.hiddenObjects=[],this.parameters=[]}return Object(o.a)(e,[{key:"createParameters",value:function(){var e=this;this.parameters=[],this.getOptionsAtLevel().filter(function(t){return!e.hiddenObjects.includes(t)}).forEach(function(t){return e.createParameter(t)})}},{key:"createParameter",value:function(e){var t=this.getVariableContext(e),n=this.getFullVariableName(""===t?e.id:t);this.parameters.push(new re.a(n,e,function(t,n){e.getObjectType()===ua.d?(e.text=n,e.execute()):e.effect.setValue(n)},{min:this.getVariableMin(e),max:this.getVariableMax(e),defaultValue:this.getVariableValue(e)}))}},{key:"getVariableMin",value:function(e){return e.effect?0:e.min}},{key:"getVariableMax",value:function(e){return e.effect?0:e.max}},{key:"getVariableValue",value:function(e){return e.effect?e.effect.value:e.message}},{key:"getJson",value:function(){return{hiddenObjects:this.hiddenObjects.map(function(e){return e.id}),parameters:this.parameters.map(function(e){return{name:e.name,id:e.id,min:e.min,max:e.max,depth:e.depth}})}}},{key:"fromJson",value:function(e){if(e){var t=this.getOptionsAtLevel();if(this.hiddenObjects=e.hiddenObjects.map(function(e){return t.find(function(t){return t.id===e})}).filter(function(e){return e}),e.parameters&&e.parameters.length>0){this.createParameters();for(var n=0;n<e.parameters.length;n++){var r=this.parameters[n];r&&(r.id=e.parameters[n].id,r.name=e.parameters[n].name,e.parameters[n].min&&(r.min=e.parameters[n].min,r.max=e.parameters[n].max,r.depth=e.parameters[n].depth))}}}}},{key:"hideObject",value:function(e){this.hiddenObjects.push(e)}},{key:"registerPattr",value:function(e,t){this.nameToObject[e]=t}},{key:"getValue",value:function(e){return e.getObjectType()===ua.d?e.message:e.effect?e.effect.value:0}},{key:"getFullVariableName",value:function(e){for(var t=this.subpatch,n=[""];t.getRootSubSequence;)t.zObject&&n.push(t.zObject.args[0]),t=t.subSequence;return n.reverse(),n.join("::")+e}},{key:"getOptionsAtLevel",value:function(){return[].concat(Object(h.a)(this.subpatch.zMessages.filter(function(e){return e.type===yc.c})),Object(h.a)(this.subpatch.zObjects.filter(function(e){return"macro"===e.name})))}},{key:"getNextLevels",value:function(){return this.subpatch.zObjects.filter(function(e){return e.effect&&!e.effect.implements&&e.effect.pattr}).map(function(e){return e.effect.pattr})}},{key:"getVariableContext",value:function(e){var t=Object.values(e.getOutboundNodes()).flat(2).map(function(e){return e.node}),n=t.find(function(e){return"gl.uniform"===e.name});if(n)return n.args[0];var r=t.find(function(e){return e.name});return r?r.name:""}},{key:"getNestedParameters",value:function(){var e,t=Object(h.a)(this.parameters),n=Eh(this.getNextLevels());try{for(n.s();!(e=n.n()).done;){var r=e.value;t=[].concat(Object(h.a)(t),Object(h.a)(r.getNestedParameters()))}}catch(a){n.e(a)}finally{n.f()}return t}}]),e}();function Mh(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Rh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Rh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ch(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Nh=function(e){return function(e){Object(u.a)(n,e);var t=Ch(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).zObjects=[],e.zMessages=[],e}return Object(o.a)(n,[{key:"initPattr",value:function(){this.pattr=new Ah(this)}},{key:"updateZObjectRedux",value:function(){this.sequencerEngine.isLoading||this.dispatch(Object(C.bf)(this.id,Object(h.a)(this.zObjects)))}},{key:"updateZMessageRedux",value:function(){this.sequencerEngine.isLoading||this.dispatch(Object(C.Qe)(this.id,Object(h.a)(this.zMessages)))}},{key:"createZObject",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=this.newZObject();return n&&(a.text=n),e&&!this.sequencerEngine.isLoading&&this.dispatch(Object(C.Pe)(a.id,{x:e,y:t})),this.subSequence.presentationMode&&a.setAttribute("Include in Presentation",!0),this.zObjects.push(a),this.updateZObjectRedux(),void 0===e||void 0===t?a:(!this.sequencerEngine.isLoading&&r&&this.dispatch(Object(C.wd)(a)),"subpatch"===a.name&&Object(Ma.b)("preset.new"),a)}},{key:"createZMessage",value:function(e,t,n,r,a,i,s,o){var c=new Fc(this,n,r,a);return i&&(c.text=i),this.presentationMode&&c.setAttribute("Include in Presentation",!0),o&&(c.dragOnLoad=o),e&&!this.sequencerEngine.isLoading&&this.dispatch(Object(C.Pe)(c.id,{x:e,y:t})),this.zMessages.push(c),this.updateZMessageRedux(),!this.sequencerEngine.isLoading&&s&&this.dispatch(Object(C.wd)(c)),c}},{key:"getZObjectsJson",value:function(e){return{zObjects:this.zObjects.filter(function(e){return!e.doNotSave}).map(function(t){return t.getJson(e)}),zMessages:this.zMessages.map(function(e){return e.getJson()})}}},{key:"loadZObjectsJson",value:function(e){if(e){var t,n=e.zObjects,r=e.zMessages,a=Mh(n);try{for(a.s();!(t=a.n()).done;){var i=t.value;this.createZObject().fromJson(i)}}catch(u){a.e(u)}finally{a.f()}var s,o=Mh(r);try{for(o.s();!(s=o.n()).done;){var c=s.value;this.createZMessage().fromJson(c)}}catch(u){o.e(u)}finally{o.f()}}}},{key:"executeAllMessages",value:function(){this.zMessages.forEach(function(e){return e.execute()});var e,t=Mh(this.zObjects);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isSubPatch&&n.effect.zMessages.forEach(function(e){return e.execute()})}}catch(r){t.e(r)}finally{t.f()}}},{key:"deleteNode",value:function(e,t){if(!t){var n=e;n.inletNumber,n.outletNumber,n.isInlet,n.isOutlet}if(this.zObjects.includes(e)||this.zMessages.includes(e)||!e.zObject||(e=e.zObject),e.plugin){var r=this.state.plugins.pluginsLoaded.filter(function(t){return t!==e.plugin});this.dispatch(Object(C.Pc)(r))}e.pluginViewerFor&&e.pluginViewerFor.delete(),this.zObjects.includes(e)&&(this.propagate(Object(Cc.u)(e)),e.disposeMessaging(),this.zObjects=this.zObjects.filter(function(t){return t!==e}),this.dispatch(Object(C.bf)(this.id,Object(h.a)(this.zObjects)))),this.zMessages.includes(e)&&(this.propagate(Object(Cc.r)(e)),e.disposeMessaging(),this.zMessages=this.zMessages.filter(function(t){return t!==e}),this.dispatch(Object(C.Qe)(this.id,Object(h.a)(this.zMessages))))}},{key:"scheduleZObjects",value:function(e,t){var n,r=Mh(this.sequencerEngine.tickingObjects);try{for(r.s();!(n=r.n()).done;){n.value.sendMessageToInlet([v.n,t,e])}}catch(a){r.e(a)}finally{r.f()}}},{key:"stopZObjects",value:function(){var e,t=Mh(this.zObjects);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.needsTick)n.sendMessageToInlet([v.l]);else if(n.effect&&n.effect.zObjects){var r,a=Mh(n.effect.zObjects);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.needsTick&&i.sendMessageToInlet([v.l])}}catch(s){a.e(s)}finally{a.f()}}}}catch(s){t.e(s)}finally{t.f()}}},{key:"loadBangZObjects",value:function(){if(!(this.instances&&this.instances.length>0)){(new Date).getTime();var e,t=Mh(this.zObjects);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.needsLoad)if("gl.uniform"===n.name){var r=Object.values(n.getInboundNodes()).flat().map(function(e){return e.node}).filter(function(e){return e.type===yc.c});if(0===r.length){if(n.subSequence.implements)continue;n.sendMessageToInlet([v.k])}r.forEach(function(e){e.skipLoad=!0,e.execute(e.message)})}else n.sendMessageToInlet([v.k]);else n.effect&&n.effect.zObjects&&n.effect.loadBangZObjects()}}catch(o){t.e(o)}finally{t.f()}(new Date).getTime();var a,i=Mh(this.zMessages);try{for(i.s();!(a=i.n()).done;){var s=a.value;if(!s.skipLoad){(new Date).getTime();s.type===yc.c&&s.execute(s.message);(new Date).getTime()}}}catch(o){i.e(o)}finally{i.f()}(new Date).getTime()}}},{key:"loadNFTZObjects",value:function(){var e,t=Mh(this.zObjects);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.needsNFT)n.sendMessageToInlet([v.e]);else if(n.effect&&n.effect.zObjects){var r,a=Mh(n.effect.zObjects);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.needsNFT&&i.sendMessageToInlet([v.e])}}catch(s){a.e(s)}finally{a.f()}}}}catch(s){t.e(s)}finally{t.f()}}},{key:"startZObjects",value:function(){var e,t=Mh(this.zObjects);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.needsTick||n.needsStart?n.name.includes("subpatch")||n.sendMessageToInlet([v.k]):n.effect&&n.effect.zObjects&&n.name.includes("subpatch")&&n.effect.startZObjects()}}catch(i){t.e(i)}finally{t.f()}var r,a=Mh(this.zMessages);try{for(a.s();!(r=a.n()).done;){r.value.type,yc.c}}catch(i){a.e(i)}finally{a.f()}}},{key:"encapsulateObjects",value:function(e,t,n,r){var a=this,i=this.state.windows.selectedElements;if(n){i={};var s,o=Mh(n);try{for(o.s();!(s=o.n()).done;){var c=s.value;i[c.id]=c}}catch(ge){o.e(ge)}finally{o.f()}}var u,l=Object.keys(i),f=l.map(function(e){return a.zObjects.find(function(t){return t.id===e})}).filter(function(e){return e}),p=l.map(function(e){return a.zMessages.find(function(t){return t.id===e})}).filter(function(e){return e}),d=[].concat(Object(h.a)(f),Object(h.a)(p),Object(h.a)(f.filter(function(e){return e.effect}).map(function(e){return e.effect}))),v=[],m=0,y=[],b=0,g={},O={},k=[],j=Mh(d);try{for(j.s();!(u=j.n()).done;){var w=u.value;w.effect&&w.effect.getInnerNodes&&(k=[].concat(Object(h.a)(k),Object(h.a)(w.effect.getInnerNodes())),d=[].concat(Object(h.a)(d),Object(h.a)(w.effect.getInnerNodes())))}}catch(ge){j.e(ge)}finally{j.f()}var x,S=Mh(d);try{for(S.s();!(x=S.n()).done;){var P=x.value;if(P.getOutboundNodes){P.pad&&(P=P.pad);var E=P.getOutboundNodes(),T=P.getInboundNodes();for(var A in E){var M=E[A].filter(function(e){var t=e.node;return!d.includes(t)});if(0!==M.length){var R,N=!1,q=void 0,I=Mh(y);try{for(I.s();!(R=I.n()).done;){var _=R.value;_.connections[0].node===M[0].node&&A===M[0].type&&(N=!0,q=_.outletNumber,console.log("already made outlet",_,A,M))}}catch(ge){I.e(ge)}finally{I.f()}if(!N){b++;var D="string"===typeof P.name&&P.name||P.zObject&&P.zObject.name;O[b]=D+"."+A}void 0!==q&&(b=q);var F={connections:M,outletNumber:b,type:A,object:P};console.log("adding outlet connection outletName=%s outletNumber=%s for object=%s",O[b],b,"string"===typeof P.name?P.name:P.zObject?P.zObject.name:"none",F),y.push(F)}}for(var L in T){var B=T[L].filter(function(e){var t=e.node;return!d.includes(t)});if(console.log(P),console.log("TYPE FOR OBJ=",L),console.log("_inbounds=",B),0!==B.length){var z,J=!1,V=Mh(v);try{for(V.s();!(z=V.n()).done;){z.value.connections[0].node===B[0].node&&B[0].type===L&&(J=!0)}}catch(ge){V.e(ge)}finally{V.f()}if(!J){m++;var H="string"===typeof P.name&&P.name||P.zObject&&P.zObject.name;g[m]=H+"."+L}v.push({connections:B,inletNumber:m,type:L,object:P})}}}}}catch(ge){S.e(ge)}finally{S.f()}var U=this.createZObject(e,t);U.text="subpatch";var G=U.effect;r&&(U.args[0]=r),G.zMessages=[].concat(Object(h.a)(G.zMessages),Object(h.a)(p)),this.zMessages=this.zMessages.filter(function(e){return!p.includes(e)}),G.zObjects=[].concat(Object(h.a)(G.zObjects),Object(h.a)(f)),this.zObjects=this.zObjects.filter(function(e){return!f.includes(e)}),this.updateZObjectRedux(),this.updateZMessageRedux();for(var W=2;W<=m;W++){G.newInlet(W)._text=g[W]}for(var K=2;K<=b;K++){G.newOutlet(K)._text=O[K]}G.updateZObjectRedux(),G.updateZMessageRedux();var Q,Z=Mh(p);try{for(Z.s();!(Q=Z.n()).done;){var Y=Q.value;Y.clearMessagingRedux(),Y.subSequence=G,Y.updateMessagingRedux()}}catch(ge){Z.e(ge)}finally{Z.f()}for(var X=0,$=k;X<$.length;X++){var ee=$[X];ee.clearMessagingRedux(),ee.subSequence=G,ee.updateMessagingRedux()}var te,ne=Mh(f);try{for(ne.s();!(te=ne.n()).done;){var re=te.value;re.effect&&(re.effect.clearMessagingRedux(),re.effect.trackMeter||re.effect.tracks||(re.effect.subSequence=G),re.effect.updateMessagingRedux()),re.clearMessagingRedux(),re.subSequence=G,re.updateMessagingRedux()}}catch(ge){ne.e(ge)}finally{ne.f()}console.log("outlet objects=",y);for(var ae=function(){var e=se[ie],t=e.connections,n=e.type,r=e.object,a=e.inletNumber;t.forEach(function(e){r.disconnectInlet(n,e.node,e.type),G.connectInlet("Input "+a,e.node,e.type)});var i=G.inletObjects[a-1];r.connectInlet(n,i,"Output")},ie=0,se=v;ie<se.length;ie++)ae();for(var oe=function(){var e=ue[ce],t=e.connections,n=e.type,r=e.object,a=e.outletNumber;t.forEach(function(e){e.node.disconnectInlet(e.type,r,n),e.node.connectInlet(e.type,G,"Output "+a)}),G.outletObjects[a-1].connectInlet("Input",r,n)},ce=0,ue=y;ce<ue.length;ce++)oe();var le,fe=this.state.windows.windowPositions,he=l.map(function(e){return fe[e]}),pe=100-Math.min.apply(Math,Object(h.a)(he.map(function(e){return e.x}))),de=100-Math.min.apply(Math,Object(h.a)(he.map(function(e){return e.y}))),ve={},me=Mh(d);try{for(me.s();!(le=me.n()).done;){var ye=le.value,be=ye.id;fe[be]&&(ve[be]={x:fe[be].x+pe,y:fe[be].y+de},ye.x=ve[be].x,ye.y=ve[be].y)}}catch(ge){me.e(ge)}finally{me.f()}this.dispatch(Object(C.M)(ve))}},{key:"deleteInletObject",value:function(e,t){e.isDeleted=!0;var n=Object.keys(this.inlets)[t-1];this.disconnectFromInlet(n),this.inletObjects.filter(function(e){return!e.isDeleted}).forEach(function(e,t){return e.inletNumber=t+1})}},{key:"deleteOutletObject",value:function(e,t){var n=Object.keys(this.outlets)[t-1];this.deleteOutlet(n),this.outletObjects=this.outletObjects.filter(function(t){return t!==e}),this.outletObjects.forEach(function(e,t){return e.outletNumber=t+1})}},{key:"createZTrack",value:function(e,t,n){this.createZObject(t,n,"track "+(e.trackNumber+1))}},{key:"getMessagingEdgeById",value:function(e){var t,n=Mh([].concat(Object(h.a)(this.zObjects),Object(h.a)(this.zMessages)));try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.effect&&r.effect.zObjects){var a=r.effect.getMessagingEdgeById(e);if(a)return a}for(var i in r.inlets){var s=r.inlets[i].connections.find(function(t){return t.id===e});if(s)return s}}}catch(o){n.e(o)}finally{n.f()}}},{key:"findAllNumberNodes",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(m.a)(this).filter(function(e){return e.type===yc.c})}},{key:"findNodeByName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(m.a)(this).filter(function(n){return"string"===typeof n.name&&(t?n.name===e:n.name.toLowerCase().includes(e.toLowerCase()))})}},{key:"moveObjectInto",value:function(e,t,n){if(!e.isInlet&&!e.isOutlet){for(var r in e.inlets)e.disconnectFromInlet(r);for(var a in e.outlets)e.disconnectFromOutlet(a);if(e.effect&&e.effect.inlets){for(var i in e.effect.inlets)e.effect.disconnectFromInlet(i);for(var s in e.effect.outlets)e.effect.disconnectFromOutlet(s)}var o=e.subSequence;o.zObjects.includes(e)&&(o.zObjects=o.zObjects.filter(function(t){return t!==e}),this.zObjects.push(e)),o.zMessages.includes(e)&&(o.zMessages=o.zMessages.filter(function(t){return t!==e}),this.zMessages.push(e)),this.updateZObjectRedux(),this.updateZMessageRedux(),o.updateZObjectRedux(),o.updateZMessageRedux(),e.subSequence=this,e.effect&&(e.effect.subSequence=this),this.dispatch(Object(C.oc)(void 0)),t&&n&&(this.dispatch(Object(C.Pe)(e.id,{x:t,y:n})),this.dispatch(Object(C.Rc)(e.id,{x:t,y:n})))}}}]),n}(e)};function qh(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ih(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ih(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Ih(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Dh=function(e){Object(u.a)(n,e);var t=_h(n);function n(e,r,a,i){var o;return Object(s.a)(this,n),(o=t.call(this)).id=Object(S.uuid)(),o.subSequence=e,o.sequencerEngine=r,o.sequencerEngine.idToObject[o.id]=Object(c.a)(o),o.zObject=a,o.name=i,o.trackData=new F.a,o.trackData.loadDefaults(),o.inletObjects=[],o.outletObjects=[],o.newInlet(1),o.newOutlet(1),o.zObject.newAction("Create Instance",function(){return o.newInstance()}),o.outletInstanceMapping={},o.inletInstanceMapping={},o.isInitialLoad=!0,o.initPattr(),o.setupPresetListener(),o}return Object(o.a)(n,[{key:"getRootSubSequence",value:function(){return this.subSequence.getRootSubSequence?this.subSequence.getRootSubSequence():this.subSequence}},{key:"getJson",value:function(e,t){var n,r,a;if(e){var i=Ph(this.getInboundNodes()),s=Ph(this.getOutboundNodes()),o=Array.from(new Set([].concat(Object(h.a)(i.effects),Object(h.a)(s.effects)))),c=Array.from(new Set([].concat(Object(h.a)(i.midiEffects),Object(h.a)(s.midiEffects))));n=i.json,r=s.json,a={effects:o.map(function(e){return e.getJson()}),midiEffects:c.map(function(e){return e.getJson()})}}return Object(p.a)({id:this.id},this.getZObjectsJson(e),{numInlets:this.inletObjects.length,inbound:n,outbound:r,objectDependencies:a,fillColor:this.fillColor,numOutlets:this.outletObjects.length,isCustom:this.isCustom,width:this.width,height:this.height,inletObjects:this.inletObjects.map(function(e){return e.getJson()}),outletObjects:this.outletObjects.map(function(e){return e.getJson()}),instanceInlets:this.instanceInlets.filter(function(e){return e}).map(function(e){return e.id}),instances:this.instances.filter(function(e){return e}).map(function(e){return e.id}),outletInstanceMapping:this.outletInstanceMapping,inletInstanceMapping:this.inletInstanceMapping,pattr:this.pattr.getJson()})}},{key:"getParameters",value:function(){return this.zObjects.flatMap(function(e){return e.getAllParameters()})}},{key:"fromJson",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;arguments.length>4&&arguments[4];this.zMessages.forEach(function(e){r&&(e.isInlet||e.isOutlet)||t.deleteNode(e,!0)}),this.zObjects.forEach(function(e){return t.deleteNode(e,!0)}),n||(this.id=e.id,this.sequencerEngine.idToObject[this.id]=this),this.fillColor=e.fillColor,this.isCustom=e.isCustom,this.width=e.width,this.height=e.height,this.isCustom&&(this.zObject.width=this.width,this.zObject.height=this.height);var i,s={},o=e.zObjects,c=e.zMessages,u=qh(o);try{for(u.s();!(i=u.n()).done;){var l=i.value,f=this.createZObject(),h=f.fromJson(l,n);(s=Object(p.a)({},s,h))[l.id]=f.id,f.effect&&l.effect&&(s[l.effect.id]=f.effect.id)}}catch(D){u.e(D)}finally{u.f()}this.zMessages=this.zMessages.filter(function(e){return r||!e.isOutlet&&!e.isInlet});var d,v=qh(c);try{for(v.s();!(d=v.n()).done;){var m=d.value;if(void 0!==m.outletNumber){var y="Output "+m.outletNumber;if(this.outlets[y]&&r){if(!this.outletInstanceMapping[m.id]){var b=Object(S.uuid)();this.outletInstanceMapping[m.id]=b;var g=[];this.outlets[y]&&(g=this.outlets["Output "+m.outletNumber].connections,this.deleteOutlet("Output "+m.outletNumber),this.outletObjects.splice(m.outletNumber-1,1)),this.newOutlet(m.outletNumber,b);var O,k=qh(g);try{for(k.s();!(O=k.n()).done;){var j=O.value,w=j.destNode,x=j.sourceType,P=j.destType;w.connectInlet(P,this,x)}}catch(D){k.e(D)}finally{k.f()}}s[m.id]=this.outletInstanceMapping[m.id]}else{this.outlets[y]&&(this.deleteOutlet("Output "+m.outletNumber),this.outletObjects.splice(m.outletNumber-1,1));var E=n?Object(S.uuid)():m.id;this.newOutlet(m.outletNumber,E),s[m.id]=E}}else if(void 0!==m.inletNumber)if(this.inlets["Input "+m.inletNumber]&&r){if(!this.inletInstanceMapping[m.id]){var T=Object(S.uuid)();this.inletInstanceMapping[m.id]=T,this.inlets["Input "+m.inletNumber]&&(this.deleteInlet("Input "+m.inletNunmber),this.inletObjects.splice(m.inletNumber-1,1)),this.newInlet(m.inletNumber,T)}s[m.id]=this.inletInstanceMapping[m.id]}else{this.inlets["Input "+m.inletNumber]&&(this.deleteInlet("Input "+m.inletNunmber),this.inletObjects.splice(m.inletNumber-1,1));var A=n?Object(S.uuid)():m.id;this.newInlet(m.inletNumber,A),s[m.id]=A,this.inletInstanceMapping[m.id]=A}else{var M=this.createZMessage();M.fromJson(m,n),s[m.id]=M.id}}}catch(D){v.e(D)}finally{v.f()}if(e.inletObjects){for(var R=0;R<e.inletObjects.length;R++)this.inletObjects[R]&&(this.inletObjects[R]._text=e.inletObjects[R].text);for(var N=0;N<e.outletObjects.length;N++)this.outletObjects[N]&&(this.outletObjects[N]._text=e.outletObjects[N].text)}if(e.instanceInlets&&!r){var q,I=qh(e.instanceInlets);try{var _=function(){var e=q.value,n=t.inletObjects.find(function(t){return t.id===e||t.id===s[e]});t.instanceInlets.push(n)};for(I.s();!(q=I.n()).done;)_()}catch(D){I.e(D)}finally{I.f()}}return e.instances&&!r&&(this.instanceIds=e.instances),!r&&a&&(e.outbound||e.inbound)&&(this.sequencerEngine.dispatch(Object(C.ac)(this.sequencerEngine.sequenceId,!1)),this.sequencerEngine.dispatch(Object(C.ac)(this.sequencerEngine.sequenceId,!0))),this.updateMessagingRedux(),this.isInitialLoad=!1,this.pattr.fromJson(e.pattr),this.onNewPresetManager(),s}},{key:"deencapsulate",value:function(){var e=this;this.zMessages.forEach(function(e){e.isInlet=!1,e.isOutlet=!1}),this.subSequence.zMessages=[].concat(Object(h.a)(this.subSequence.zMessages),Object(h.a)(this.zMessages)),this.subSequence.zObjects=[].concat(Object(h.a)(this.subSequence.zObjects),Object(h.a)(this.zObjects)),this.subSequence.zObjects=this.subSequence.zObjects.filter(function(t){return t!==e.zObject}),this.subSequence.updateZObjectRedux(),this.subSequence.updateZMessageRedux();var t,n=qh(this.zMessages);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.clearMessagingRedux(),r.subSequence=this.subSequence,r.updateMessagingRedux()}}catch(o){n.e(o)}finally{n.f()}var a,i=qh(this.zObjects);try{for(i.s();!(a=i.n()).done;){var s=a.value;s.effect&&(s.effect.clearMessagingRedux&&s.effect.clearMessagingRedux(),s.effect.subSequence=this.subSequence,s.effect.updateMessagingRedux&&s.effect.updateMessagingRedux()),s.clearMessagingRedux(),s.subSequence=this.subSequence,s.updateMessagingRedux()}}catch(o){i.e(o)}finally{i.f()}this.zMessages=[],this.zObjects=[],this.updateZObjectRedux(),this.updateZMessageRedux(),this.dispatch(Object(C.Me)([]))}},{key:"newZObject",value:function(){return new ov(this)}},{key:"newInlet",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inletObjects.length+1,r=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o="Input "+t;a=a||50+100*(t-1),i=i||50;var c=this.createZMessage(a,i,void 0,void 0,r);return c.isInlet=!0,c.inletNumber=t,c.deleteOutlet("Message Send"),this.inletObjects.push(c),Object(ne.a)(Object(f.a)(n.prototype),"newInlet",this).call(this,o,function(t){return e.onInletMessage(c,t)}),s&&this.propagate(Object(Cc.n)(c,!1)),c}},{key:"newOutlet",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.outletObjects.length+1,r=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,s="Output "+t;Object(ne.a)(Object(f.a)(n.prototype),"newOutlet",this).call(this,s),a=a||50+100*(t-1),i=i||350;var o=this.createZMessage(a,i,void 0,function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return e.sendMessage.apply(e,[s,t].concat(r))},r);return o.linkedOutlet=this.outlets[s],o.outletNumber=t,o.isOutlet=!0,this.outletObjects.push(o),this.propagate(Object(Cc.p)(o)),o}},{key:"evaluateAsFunction",value:function(e){var t=this.inletObjects[0];if(t){this.outletObjects[0];for(var n=Fh(t.outlets);n;){var r=n.connections[0];if(!r)break;var a=r.destNode;if(a.isOutlet)break;e=a.function([e]),Array.isArray(e)&&(e=e[0]),n=Fh(a.outlets)}return e}}},{key:"dispose",value:function(){var e,t=qh(this.instances);try{for(t.s();!(e=t.n()).done;){e.value.zObject.delete()}}catch(n){t.e(n)}finally{t.f()}}},{key:"isDeletable",value:function(){return!0}},{key:"createZObject",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var i=(e=Object(ne.a)(Object(f.a)(n.prototype),"createZObject",this)).call.apply(e,[this].concat(r));return this.propagate(Object(Cc.t)(i)),i}},{key:"createZMessage",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var i=(e=Object(ne.a)(Object(f.a)(n.prototype),"createZMessage",this)).call.apply(e,[this].concat(r));return this.propagate(Object(Cc.q)(i)),i}},{key:"deleteInlet",value:function(e,t){var n=this;if(window.noReload=!0,this.inlets[e]&&this.inlets[e].connections){var r,a=qh(this.inlets[e].connections);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.deleteConnection(i)}}catch(f){a.e(f)}finally{a.f()}}for(var s=this.inletObjects.find(function(e){return e.inletNumber===t}),o=function(e){var t="Input "+e,r="Input "+(e-1),a=n.inlets[t],i=n.inlets[r],s=a.connections,o=n.inletObjects.find(function(t){return t.inletNumber===e});i.action=function(e){return n.onInletMessage(o,e)},o.inletNumber=e-1;var c,u=qh(s);try{for(u.s();!(c=u.n()).done;){var l=c.value;n.deleteConnection(l),n.connectInlet(r,l.sourceNode,l.sourceType)}}catch(f){u.e(f)}finally{u.f()}},c=t+1;c<=this.inletObjects.length;c++)o(c);var u=this.inletObjects.length;this.inletObjects=this.inletObjects.filter(function(e){return e!==s});var l="Input "+u;delete this.inlets[l],this.numInlets--,window.noReload=!1}},{key:"deleteOutlet",value:function(e,t){var n=this;if(window.noReload=!0,this.outlets[e]&&this.outlets[e].connections){var r,a=qh(this.outlets[e].connections);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.destNode.deleteConnection(i)}}catch(f){a.e(f)}finally{a.f()}}for(var s=this.outletObjects.find(function(e){return e.outletNumber===t}),o=function(e){var t="Output "+e,r="Output "+(e-1),a=n.outlets[t],i=n.outlets[r],s=a.connections,o=n.outletObjects.find(function(t){return t.outletNumber===e});i.action=function(e){return n.onInletMessage(o,e)},o.outletNumber=e-1;var c,u=qh(s);try{for(u.s();!(c=u.n()).done;){var l=c.value;l.destNode.deleteConnection(l),l.destNode.connectInlet(l.destType,l.sourceNode,r)}}catch(f){u.e(f)}finally{u.f()}},c=t+1;c<=this.outletObjects.length;c++)o(c);var u=this.outletObjects.length;this.outletObjects=this.outletObjects.filter(function(e){return e!==s});var l="Output "+u;delete this.outlets[l],this.numOutlets--,window.noReload=!1}},{key:"isRoot",value:function(){return!1}},{key:"presentationMode",get:function(){return this.state.spatial.presentationMode[this.id]},set:function(e){this.dispatch(Object(C.Qc)(this.id,e))}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=rh(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a)))._presetManager=void 0,e.searchedForPresets=!1,e}return Object(o.a)(n,[{key:"setupPresetListener",value:function(){var e=this;Object(Ma.d)("preset.new",function(){return e.onNewPresetManager()})}},{key:"onNewPresetManager",value:function(){this.searchedForPresets=!1}},{key:"presetManager",get:function(){if(this.searchedForPresets)return this._presetManager;var e,t=th(ci({subSequence:this}));try{for(t.s();!(e=t.n()).done;){var n=e.value.zObjects.find(function(e){return"preset"===e.name});if(n){n=n.effect,this._presetManager=n;break}}}catch(r){t.e(r)}finally{t.f()}return this.searchedForPresets=!0,this._presetManager}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=vh(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"propagate",value:function(e){this.insideInstance()&&function(e,t){var n=void 0;switch(t.type){case Cc.i:n=sh;break;case Cc.f:n=oh;break;case Cc.k:n=hh;break;case Cc.h:n=ph;break;case Cc.c:n=ch;break;case Cc.e:n=uh;break;case Cc.a:n=lh;break;case Cc.b:n=fh;break;case Cc.j:n=ah;break;case Cc.g:n=ih;break;case Cc.d:n=dh}n&&n(e,t)}(this,e)}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=wh(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).instances=[],e.instanceInlets=[],e}return Object(o.a)(n,[{key:"newInstance",value:function(){var e=this.subSequence.createZObject(this.x,this.y,"instancedSubpatch").effect;e.implements=this,this.instances.push(e),this.copyIntoInstance(e),this.onChange()}},{key:"toggleInlet",value:function(e){this.instanceInlets.includes(e)?this.instanceInlets=this.instanceInlets.filteR(function(t){return t!==e}):this.instanceInlets.push(e),this.propagate(Object(Cc.o)(e.inletNumber))}},{key:"newInstanceInlet",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inletObjects.length+1,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=this.newInlet(e,t,n,r,!1);return this.instanceInlets.push(a),this.propagate(Object(Cc.n)(a,!0)),a}},{key:"onInletMessage",value:function(e,t){if(this.hasInstances&&!this.instanceInlets.includes(e)){var n,r=kh(this.instances);try{for(r.s();!(n=r.n()).done;){var a=n.value,i=this.inletObjects.indexOf(e),s=a.inletObjects[i];s&&s.sendMessage.apply(s,["Output"].concat(Object(h.a)(t)))}}catch(o){r.e(o)}finally{r.f()}}else e.sendMessage.apply(e,["Output"].concat(Object(h.a)(t)))}},{key:"hasInstances",get:function(){return this.instances.length>0}},{key:"insideInstance",value:function(){return!!this.hasInstances||this.subSequence.insideInstance()}},{key:"onChange",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}},{key:"copyIntoInstance",value:function(e){var t,n=this,r=kh(this.zObjects);try{for(r.s();!(t=r.n()).done;){var a=t.value;if("subpatch"===a.name){var i=a.effect;i.showAllOutlets=!0;var s=e.createZObject(0,0,"instancedSubpatch");e.registerObject(a,s),i.instances.push(s.effect),i.copyIntoInstance(s.effect),a.effect&&e.registerObject(a.effect,s.effect)}else{var o=e.createZObject(0,0,a.text);o.fromJson(a.getJson(),!0),e.registerObject(a,o),a.effect&&e.registerObject(a.effect,o.effect)}}}catch(h){r.e(h)}finally{r.f()}var c,u=kh(this.zMessages);try{for(u.s();!(c=u.n()).done;){var l=c.value;if((!l.isInlet||"continue"!==function(){var t=l.inletNumber,r=e.inletObjects.find(function(e){return e.inletNumber===t}),a=void 0;return r?(a=r,e.registerObject(l,r)):n.instanceInlets.includes(l)?(a=e.newInstanceInlet(),e.registerObject(l,a)):((a=e.newInlet())._text=l._text,e.registerObject(l,a)),a._text=l._text,"continue"}())&&(!l.isOutlet||"continue"!==function(){var t=l.outletNumber,n=e.outletObjects.find(function(e){return e.outletNumber===t});if(n)n._text=l._text,e.registerObject(l,n);else{var r=e.newOutlet();r._text=l._text,e.registerObject(l,r)}return"continue"}())){var f=e.createZMessage(0,0,l.dataType);f.fromJson(l.getJson(),!0),e.registerObject(l,f)}}}catch(h){u.e(h)}finally{u.f()}this.copyConnectionsIntoInstance(e)}},{key:"copyConnectionsIntoInstance",value:function(e){var t=this.zObject.getPresetJson().inletConnections,n={};for(var r in e.objectRegistry)n[r]=e.objectRegistry[r].id;t=gh(n,t),this.sequencerEngine.loadInletConnectionsForId(t,!0)}}]),n}(e)}(Object(Aa.a)(Nh(va(function(){return function e(){Object(s.a)(this,e)}}()))))))),Fh=function(e){return e[Object.keys(e)[0]]},Lh=Dh;Object(Ca.a)("three.planeRenderer",{material:"","add to scene":""},"Renders a material as a plane",function(){return 1},{isHot:!0,inlets:2,connects:[{inlet:"operation",outlet:"Output 1",object:"three.canvas"}]});function Bh(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return zh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function zh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Jh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Vh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Hh=function(e){Object(u.a)(n,e);var t=Vh(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e))._color="#000000",r.newInlet("operation",function(e){return r.onOperationHelper(e)}),r.queue=[],window.requestAnimationFrame(function(){return r.draw()}),r}return Object(o.a)(n,[{key:"getFunctionDefinition",value:function(e){return vu[e]}},{key:"enqueue",value:function(e){this.queue.push(e)}},{key:"onOperation",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];if(this.ctxt){var i=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];if(e.split){var i=e.split(" ").filter(function(e){return""!==e}),s=i[0],o=i.slice(1).map(function(e){return Object(pe.a)(e)?parseFloat(e):e}),c=t.getFunctionDefinition(s);if(c)return function(){return c.apply(void 0,[t,t.ctxt].concat(Object(h.a)(o),r))}}};if(Array.isArray(e)){e.map(function(e){return i.apply(void 0,[e].concat(r))}).filter(function(e){return e}).forEach(function(n){return t.enqueue.apply(t,[n,e].concat(r))});return this.requested||(window.requestedTime=(new Date).getTime(),this.first||(this.first=!0)),void(this.requested=!0)}var s=i.apply(void 0,[e].concat(r));s&&this.enqueue.apply(this,[s,e].concat(r)),this.requested||(window.requestedTime=(new Date).getTime(),this.first||(this.first=!0)),this.requested=!0}}},{key:"draw",value:function(){var e=this;window.zRender.push((new Date).getTime()-window.requestedTime),window.lastRenderTime=(new Date).getTime(),window.renderSize.push(this.queue.length),this.queueforEach(function(e){return e()}),this.queue.length=0,this.requested=!1,window.requestAnimationFrame(function(){return e.draw()})}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=Jh(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).frames=[],e}return Object(o.a)(n,[{key:"createRenderTarget",value:function(){return new ks.eb(this.zObject.width,this.zObject.height,{minFilter:ks.x,magFilter:ks.G,format:ks.P})}},{key:"onOperationHelper",value:function(e){if("render"===e&&this.renderFrames(),Array.isArray(e)){var t=e[0].type;if(Array.isArray(e[0].type)&&(t=e[0].type[0]),"vec4"!==t){var n=Object(_a.a)(e),r=n[0],a=n.slice(1);if("string"!==typeof r){if(Array.isArray(r)){var i=Object(_a.a)(r),s=i[0],o=i.slice(1);if(Array.isArray(s)){var c=Object(_a.a)(s),u=c[0],l=c.slice(1);this.onOperation.apply(this,[u].concat(Object(h.a)(l)))}else this.onOperation.apply(this,[s].concat(Object(h.a)(o)))}}else"render"===r&&this.frames.length>0?this.renderFrames():this.onOperation.apply(this,[r].concat(Object(h.a)(a)))}else this.handleGLMessage(e[0])}}},{key:"renderFrames",value:function(){var e,t=Bh(this.frames);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.operation){if(n.renderTarget&&(n.renderTarget.width=this.zObject.width,n.renderTarget.height=this.zObject.height),n.renderTargetB){var r=n.currentRenderTarget===n.renderTarget?n.renderTargetB:n.renderTarget;n.currentRenderTarget=r,this.onRenderTarget(n.currentRenderTarget);var a=n.currentRenderTarget===n.renderTarget?n.renderTargetB:n.renderTarget;window.stopRender=!0,n.texture([a.texture],!0),window.stopRender=!1}else this.onRenderTarget(n.renderTarget);this.onOperation.apply(this,Object(h.a)(n.operation)),n.texture&&(window.stopRender=!0,n.renderTargetB||n.texture([n.renderTarget.texture],!0),window.stopRender=!1),n.renderTargetB&&(this.onRenderTarget(null),this.onOperation.apply(this,Object(h.a)(n.operation)))}}}catch(i){t.e(i)}finally{t.f()}}},{key:"handleGLMessage",value:function(e){var t,n,r,a=this,i=e.frames||[],s=[].concat(Object(h.a)(i),[e]),o=[],c=Bh(s);try{for(c.s();!(r=c.n()).done;){var u=r.value;u.feedback?(t=u.feedback,n=u):(t&&u.hashCode===t.hashCode&&(u.feedbackToUse=t),o.push(u))}}catch(d){c.e(d)}finally{c.f()}s=o;for(var l=function(e){var t=s[e],r=t.texture,i=void 0;t.feedbackToUse&&(i=a.createRenderTarget(),r=n.texture);var o=r?a.createRenderTarget():void 0;if(a.frames[e])o&&(a.frames[e].renderTarget=o),i&&(a.frames[e].renderTargetB=i),r&&(a.frames[e].texture=r);else{a.frames[e]={};var c=a.frames[e];o&&(c.renderTarget=o),i&&(c.renderTargetB=i),r&&(c.texture=r),c.glSubPatch=new Lh(a.subSequence,a.sequencerEngine,a.zObject,"planeRenderer"),c.glSubPatch.isSynchronous=!0,c.fragColor=c.glSubPatch.createZObject(0,0,"gl.fragColor"),c.material=c.glSubPatch.createZObject(0,0,"gl.material"),c.planeRenderer=c.glSubPatch.createZObject(0,0,"three.planeRenderer"),c.material.connectInlet("Input",c.fragColor,"Output 1"),c.planeRenderer.connectInlet("Input",c.material,"Output 1"),c.planeRenderer.sendMessage=function(e,t){t&&(o&&(c.renderTarget=o),i&&(c.renderTargetB=i),c.operation=t,a.onOperationHelper(t))}}a.frames[e].fragColor.onInputMessage([Object(p.a)({},t,{frames:void 0})])},f=0;f<s.length;f++)l(f);this.onOperationHelper(["render"])}}]),n}(e)}(Va.a));window.renderSize=[],window.zRender=[];var Uh=void 0,Gh=[],Wh={clear:function(e){e.renderer.clear()},addToScene:function(e,t,n){var r=e.camera;e.scene.add(n),r.position.z=3},cube:function(e,t,n){var r=e.camera;e.scene.add(n),r.position.z=5},camera:function(e,t,n,r,a){var i=e.camera;i.position.x=n,i.position.y=r,i.position.z=a},draw:function(e,t){},render:function(e,t,n,r){var a=(new Date).getTime();if(Uh){var i=1e3/(a-Uh);Gh.unshift(i),window.fps=function(e){for(var t=0,n=0,r=0;r<20;r++)e[r]&&(n+=e[r],t++);return n/t}(Gh)}Uh=a;var s=window.errors.length;if(e.renderer.render(n,r),window.errors.length-s>0)return window.errors.splice(s+1)},autoClear:function(e,t,n){e.renderer.autoClear=!1}},Kh=Object(p.a)({},Wh);function Qh(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Zh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zh(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Zh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Yh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Xh=[],$h=function(e){Object(u.a)(n,e);var t=Yh(n);function n(e){var r;return Object(s.a)(this,n),r=t.call(this,e),Xh.push(Object(c.a)(r)),r.newInlet("render target",function(e){var t=Object(ea.a)(e,1)[0];return r.onRenderTarget(t)}),r.newInlet("get image data",function(e){Object(ea.a)(e,1)[0];return r.onGetImageData()}),r.newInlet("get image data URL",function(e){Object(ea.a)(e,1)[0];return r.onGetImageDataURL()}),r.newOutlet("mouse-move"),r.newOutlet("mouse-click"),r.newOutlet("mouse-down"),r.newOutlet("mouse-up"),r.newOutlet("isMouseDown"),r.newInlet("size ",function(e){var t=Object(ea.a)(e,1)[0],n=Object(ea.a)(t,2),a=n[0],i=n[1];r.zObject.width=a,r.zObject.height=i,r.sendMessage("size",t)}),r.newOutlet("size"),r.newOutlet("image data"),r.newOutlet("image URL"),r.zObject.newAttribute("fill full-screen",!0),r.zObject.setAttribute("primary-color","transparent"),r.zObject.newAttribute("set as background",!1),r}return Object(o.a)(n,[{key:"onGetImageDataURL",value:function(){this.canvas;var e=this.canvas.toDataURL("image/png"),t=new Image;t.src=e,console.log(t),this.sendMessage("image URL",t)}},{key:"onGetImageData",value:function(){if(this.ctxt){var e=this.ctxt,t=this.zObject.width*this.zObject.height*4*16;this.pixels&&this.pixels.length===t||(this.pixels=new Uint8Array(t));var n=this.pixels;e.getContext().readPixels(0,0,e.getContext().drawingBufferWidth,e.getContext().drawingBufferHeight,e.getContext().RGBA,e.getContext().UNSIGNED_BYTE,n);for(var r=[],a=0;a<n.length;a+=4)n[a]>0&&r.push(a/4);this.sendMessage("image data",n)}}},{key:"onMouseDown",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.sendMessage("mouse-down",t),this.sendMessage("isMouseDown",1),Object(Ma.b)("mouse-down",t)}},{key:"onMouseUp",value:function(e,t){this.sendMessage("isMouseDown",0),this.sendMessage("mouse-up",[e,t]),Object(Ma.b)("mouse-up",[e,t])}},{key:"enqueue",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];this.queue.push({fn:e,operation:t,vargs:r})}},{key:"onMouseMove",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Object(Ma.b)("mouse-move",t),this.sendMessage("mouse-move",t)}},{key:"onMouseClick",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.sendMessage("mouse-click",t)}},{key:"width",get:function(){return this.zObject.width}},{key:"height",get:function(){return this.zObject.height}},{key:"onRenderTarget",value:function(e){var t=this;if(this.renderer){var n=e&&"null"!==e?e:null;this.enqueue(function(){t.renderer.setRenderTarget(n)},"setRenderTarget",[n])}}},{key:"getFunctionDefinition",value:function(e){return Kh[e]}},{key:"draw",value:function(){window.zRender.push((new Date).getTime()-window.requestedTime),window.lastRenderTime=(new Date).getTime();var e=this.dedupeQueue(this.queue);if(0===e.length)return this.requested=!1,void(this===Xh[0]&&window.requestAnimationFrame(function(){return Xh.forEach(function(e){return e.draw()})}));window.renderSize.push(e.length);var t=[];e.forEach(function(e){var n=(0,e.fn)();n&&(t=[].concat(Object(h.a)(t),Object(h.a)(n)))}),this.lastErrorsLength!==t.length&&(t.length>0?this.scripts.forEach(function(e){return e.effect.onNewErrors(t)}):this.scripts.forEach(function(e){return e.effect.clearErrors(t)}),this.lastErrorsLength=t.length),this.queue.length=0,this.requested=!1,this===Xh[0]&&window.requestAnimationFrame(function(){return Xh.forEach(function(e){return e.draw()})})}},{key:"scripts",get:function(){return Object(m.a)(this.subSequence.getRootSubSequence?this.subSequence.getRootSubSequence():this.subSequence).filter(function(e){return"script"===e.name})}},{key:"dedupeQueue",value:function(e){var t,n,r=[],a=Qh(e);try{for(a.s();!(n=a.n()).done;){var i=n.value,s=(i.fn,i.operation),o=i.vargs;t&&s===t.operation&&o.every(function(e,n){return e===t.vargs[n]})||(r.push(i),t=i)}}catch(c){a.e(c)}finally{a.f()}return r}},{key:"fromJson",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this)).call.apply(e,[this].concat(r))}}]),n}(Hh);Object(Ca.a)("three.canvas",{},"Creates a threejs canvas (3D)",function(){return 0},{inlets:0,tags:"Graphics"});Object(Ca.a)("three.vector3",{},"Creates a 3-dimensional vector object",void 0,{isHot:!0,inlets:3,tags:"Graphics"});Object(Ca.a)("three.vector2",{},"Creates a 2-dimensional vector object",void 0,{isHot:!0,inlets:2,tags:"Graphics"});Object(Ca.a)("three.gray",{shade:""},"Gray");var ep={"three.gray":function(e){return function(e){var t=Object(ea.a)(e,1)[0];return new ks.k(t,t,t),[[t,t,t]]}},"three.vector3":function(e,t,n){return function(e){var r=Object(ea.a)(e,1)[0];return new ks.cb(r,t(),n())}},"three.vector2":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];return new ks.bb(n,t())}},"three.canvas":function(e){var t=new $h(e);return e.effect=t,e.width=300,e.height=300,e.needsHotReload=!0,t.needsHotReload=!0,e.needsLoad=!0,function(t){Object(ea.a)(t,1)[0]===v.k&&e.effect.sendMessage("size",[e.width,e.height])}}};Object(Ca.a)("three.scene",{},"Create a scene in three js, any objects sent to it are added to it.",void 0,{tags:"Graphics",connects:{object:"three.render"}});Object(Ca.a)("three.render",{scene:"",camera:""},"Render a scene and camera",void 0,{tags:"Graphics",isHot:!0,inlets:2,connects:{object:"three.canvas",inlet:"operation"}});Object(Ca.a)("three.ambientLight",{color:"",intensity:""},"Creates an ambient light (to be added to scene)",void 0,{tags:"Graphics",isHot:!0,inlets:2});Object(Ca.a)("three.directionalLight",{color:"",intensity:""},"Creates an ambient light (to be added to scene)",void 0,{tags:"Graphics",isHot:!0,inlets:2});var tp={"three.ambientLight":function(e,t){var n=new ks.b(16777215,1);return function(e){var r=Object(ea.a)(e,1)[0];return"bang"===r?[n]:(n.color=r||16777215,n.intensity=t()||1,[n])}},"three.directionalLight":function(e,t){var n=new ks.n(16777215,1);return n.position.setScalar(100),function(e){var r=Object(ea.a)(e,1)[0];return"bang"===r?[n]:(n.color=r||16777215,n.intensity=t()||1,[n])}},"three.scene":function(e){var t=new ks.Q;return function(e){var n=Object(_a.a)(e),r=n[0],a=n.slice(1);switch(r){case"remove":return t.remove.apply(t,Object(h.a)(a)),[t];case"bang":return[t];case"clear":return t.clear(),[t];default:return Array.isArray(r)?r.forEach(function(e){e&&!t.children.includes(e)&&t.add(e)}):t.children.includes(r)||t.add(r),[t]}}},"three.render":function(e,t){var n=new ks.I(-1,1,1,-1,-1,1);return function(r){var a=Object(ea.a)(r,1)[0];if("dispose"!==a){var i=n;t()&&(i=t()),"bang"!==a&&i.lookAt(a.position),e.lastOutput=["render",a,i],e.sendMessage(e.outputByNumber(0),e.lastOutput)}}}};Object(Ca.a)("delaunay",{},"computes delaunay triangulation for pts",void 0,{tags:"Graphics"});Object(Ca.a)("delaunayIndex",{},"computes delaunay triangulation for pts index",void 0,{tags:"Graphics"});var np=function(e){var t;return function(e){var n=Object(ea.a)(e,1)[0];if(n&&n&&(ArrayBuffer.isView(n)||Array.isArray(n)&&!n.some(function(e){return!Object(pe.a)(e)})))return t?(n.forEach(function(e,n){return t.coords[n]=e}),t.update()):t=new Tf.a(n),[t.triangles]}},rp=n(881),ap=n(879);Object(Ca.a)("canvas",{},"Javascript canvas for 2D drawing",function(){return 0},{tags:"Graphics"});Object(Ca.a)("coords",{},"Creates a coord object from arguments (x,y)",void 0,{inlets:2,isHot:!0});Object(Ca.a)("rasterTriangle",{},"Returns a list of coordinates representing the raster points",void 0,{inlets:4,isHot:!0});Object(Ca.a)("rasterTriangles",{},"Returns a list of coordinates representing the raster points",void 0,{inlets:2,isHot:!0});Object(Ca.a)("triangulate",{},"Returns a list of triangles for a set of points",void 0,{inlets:2,isHot:!0});Object(Ca.a)("drawArray",{size:""},"Returns a list of coordinates representing the raster points",void 0,{inlets:3});Object(Ca.a)("drawTriangles",{},"Returns a list of coordinates representing the raster points",void 0,{inlets:2});Object(Ca.a)("triangle",{},"Send draw triangle operation to canvas with the 3 inputed coords",void 0,{isHot:!0,inlets:4});function ip(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var sp=function(e){Object(u.a)(n,e);var t=ip(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e))._color="#000000",r.newOutlet("color"),r.newOutlet("gl color","vec4"),r.glColor=_u(Object(c.a)(r)),r}return Object(o.a)(n,[{key:"color",get:function(){return this._color},set:function(e){this._color=e,this.sequencerEngine.isLoading?this.sendMessage("gl color",this.glColor([this._color],!0)[0]):this.glColor([e]),this.sendMessage("color",e),this.zObject.onValueChange(e)}},{key:"refresh",value:function(){this.sendMessage("gl color",this.glColor([this._color],!0)[0])}},{key:"getJson",value:function(){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{color:this.color})}},{key:"fromJson",value:function(e,t){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.color=e.color}},{key:"interpolate",value:function(e,t,n){var r=[parseInt(e.color.slice(1,3),16),parseInt(e.color.slice(3,5),16),parseInt(e.color.slice(5,7),16)],a=r[0],i=r[1],s=r[2],o=[parseInt(t.color.slice(1,3),16),parseInt(t.color.slice(3,5),16),parseInt(t.color.slice(5,7),16)],c=o[0],u=o[1],l=o[2],f=[Math.round(a*n+c*(1-n)),Math.round(i*n+u*(1-n)),Math.round(s*n+l*(1-n))].map(function(e){return e.toString(16)}).map(function(e){return 1===e.length?"0"+e:e});this._color="#"+f[0]+f[1]+f[2],this.sendMessage("color",this._color),this.glColor([this._color])}}]),n}(Va.a),op=new Ga.a;Object(Ca.a)("color",{},"Outputs a color",function(){return 0},{tags:"Colors"});Object(Ca.a)("compliment",{rotate:""},"Rotates a color (0-10), complimenting it",void 0,{isHot:!0,inlets:2,tags:"Colors"});var cp={color:function(e){var t=new sp(e);return e.effect=t,e.needsLoad=!0,e.needsHotReload=!0,e.width=230,e.height=180,function(e){Object(ea.a)(e,1)[0],t.color=t.color}},compliment:function(e,t){return function(e){return op.hslToHex(op.compliment(op.saturate(e[0],1),t()))}}};Object(Ca.a)("metro",{},"Sends tick every 1/32th step (when project is playing)",void 0,{tags:"Ticker"});Object(Ca.a)("syncedMetro",{},"Sends tick every 1/32th step (when project is playing)",void 0,{tags:"Ticker"});Object(Ca.a)("setInterval",{},"Sends every so often",void 0,{tags:"Ticker"});Object(Ca.a)("setIntervalFast",{},"Sends every so often",void 0,{tags:"Ticker"});Object(Ca.a)("setTimeout",{timeout:""},"Sends bang after timeout in ms",void 0,{tags:"Ticker"});var up=function(e){return function(t){var n=Object(ea.a)(t,1)[0];Object(O.a)(n).then(function(){e.sendMessage(e.outputByNumber(0),v.a)})}};function lp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var fp=function(e){Object(u.a)(n,e);var t=lp(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this)).zObject=e,r.sequencerEngine=e.sequencerEngine,r.subSequence=e.subSequence,r.startUpNumber=0,r.newInlet("Start Up Calls",function(e){return r.startUpNumber=e[0]}),r.newOutlet("Random Number"),r}return Object(o.a)(n,[{key:"getJson",value:function(){return{startUpNumber:this.startUpNumber}}},{key:"fromJson",value:function(e){this.startUpNumber=e.startUpNumber}},{key:"getParameters",value:function(){return[]}},{key:"startUp",value:function(){for(var e=0;e<this.startUpNumber;e++)this.execute()}},{key:"execute",value:function(){console.log("executing random number"),this.sendMessage("Random Number",Object(Qa.b)())}}]),n}(Object(Aa.a)(function(){return function e(){Object(s.a)(this,e)}}())),hp=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"balance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"operator",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"owner",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"_approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"}];Object(Ca.a)("nft",{},"Random number generator based on NFT's token seed",function(e){return 0});Object(Ca.a)("erc720.tokenID",{},"Returns the tokenID URL param of this page (for ERC720 tokens)",function(e){return 1});Object(Ca.a)("erc721.tokenURI",{tokenId:"",contractAddress:""},"Returns the tokenURI for a given ERC721 token",function(e){return 1},{isHot:!0,inlets:2});Object(Ca.a)("erc721.imageURI",{tokenURI:""},"Returns the image section a given ERC721 tokens metadata",function(e){return 1},{isHot:!0,inlets:1});Object(Ca.a)("erc721.decodeBase64",{tokenURI:""},"Returns the image section a given ERC721 tokens metadata",function(e){return 1},{isHot:!0,inlets:1});var pp={"erc721.imageURI":function(e,t){return function(e){var t=Object(ea.a)(e,1)[0],n="data:application/json;base64,";if(t.startsWith(n)){var r=atob(t.slice(n.length));return[JSON.parse(r).image]}}},"erc721.tokenURI":function(e,t){return function(n){var r=Object(ea.a)(n,1)[0];new(new Ja.a(new Ja.a.providers.HttpProvider("https://mainnet.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")).eth.Contract)(hp,t()).methods.tokenURI(r).call().then(function(t){console.log(t),e.sendMessage(e.outputByNumber(0),t)})}},"erc721.decodeBase64":function(e){return function(e){var t=Object(ea.a)(e,1)[0];if(t.indexOf("base64,")>=0)return atob(t.slice(t.indexOf("base64,")+"base64,".length))}}},dp=n(147);function vp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var mp=n(816),yp=n(63),bp=n(176);function gp(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Op(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Op(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Op(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}yp.a,yp.b;var kp=[yp.a,yp.b,bp.a,bp.e,bp.j,bp.g,bp.f,bp.h,bp.c,bp.d,bp.i],jp=function(e){return e.type?e.type.type||e.type:e},wp=function(e,t){for(var n=[],r=function(e,t){return n.some(function(n){return n.some(function(n){return n.x===e&&n.y===t})})},a=function(n,r){for(var a=[],s=function(n){if(!e[r][n])return o=n,"break";if(a.push({x:n,y:r}),r>=t-1)return o=n,"continue";var s=i(n,r+1),c=[s],u=[s];if(e[r][n]===yp.a){var l=i(n+1,r+1);c.push(l),u.push(l)}for(var f=function(){var t=u.pop();if(0===t.length)return"continue";t.forEach(function(n){var r=i(n.x,t[0].y+1);if(r.length>0&&(c.push(r),u.push(r)),e[(n.x,t[0].y)]===yp.a){var a=i(n.x+1,t[0].y+1);a.length>0&&(c.push(a),u.push(a))}})};u.length>0;)f();c.forEach(function(e){return a=[].concat(Object(h.a)(a),Object(h.a)(e))}),e[r][n]===yp.a&&n++,o=n},o=n;o<t;o++){var c=s(o);if("break"===c)break}var u=[];return a.forEach(function(e){u.some(function(t){return t.x==e.x&&t.y===e.y})||u.push(e)}),u},i=function(n,r,a){if(r>=t)return[];for(var i=[],s=function(t){return!!e[r][t]&&(i.push({x:t,y:r}),!0)},o=n;o<t&&s(o);o++)e[r][o]===yp.a&&o++;for(var c=n-1;c<=0&&(s(c)||e[r][c-1]===yp.a);c--);return i},s=0;s<t;s++)for(var o=0;o<t;o++){if(e[s][o]&&!r(o,s)){var c=a(o,s);n.push(c)}}return n},xp=function(e){return 1===e.length?e[0]:e},Sp=function(e){var t=[];return e.forEach(function(e){if(0===t.length)t.push([e]);else{var n=t[t.length-1];n[0].x===e.x?n.push(e):t.push([e])}}),t},Pp=function(e){return e.map(function(e){return e.type})},Ep=function(e,t,n){return e.filter(function(e){var r=e.x,a=e.y;return t[a][r]===n})},Tp=function(e,t){return e.filter(function(e){return e.x===t})},Ap=function(e,t){var n,r=[],a=gp(e);try{for(a.s();!(n=a.n()).done;){var i=n.value,s=i.x,o=i.y,c=t[o][s];c===yp.a?(r.push({x:s,y:o,type:Object(dp.b)(0)}),r.push({x:s+1,y:o,type:Object(dp.b)(1)})):c===yp.b?r.push({x:s,y:o,type:Object(dp.c)()}):r.push({x:s,y:o,type:c})}}catch(u){a.e(u)}finally{a.f()}return r},Mp=function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=gp(kp);try{var i=function(){var a=n.value;if(e.some(function(e){return t[e.y][e.x]===a}))return{v:r?jp(a):a}};for(a.s();!(n=a.n()).done;){var s=i();if("object"===typeof s)return s.v}}catch(o){a.e(o)}finally{a.f()}},Rp=function(e,t){var n={};return e.forEach(function(e){var r=Mp(e,t);n[r]||(n[r]=0),n[r]++}),n},Cp=Object(bf.a)(),Np=function(e){return e.reduce(function(e,t){return e[t.x]||(e[t.x]=[]),e[t.x].push(t),e},{})};Cp("delete",{blockNumber:"block to delete from"},"Deletes a cell in block inside the grid ");Cp("clearBlock",{blockNumber:"block to clear",ratio:"block to clear (0-1)"},"Deletes all cells in a block ");Cp("add",{blockNumber:"block to add to",position:"position to add it to",type:"type to add"},"Adds a cell to block at a certain position");var qp=[bp.j,bp.e].map(function(e){return e.type}),Ip=[bp.f,bp.g,bp.h,bp.a,bp.i].map(function(e){return e.type}),_p=function(e,t,n){for(var r=0;r<t.length;r++){var a=t[r],i=a.x,s=a.y;if(Dp(e[s][i].type,n.type))return{x:i,y:s}}},Dp=function(e,t){return e===t||(!(!qp.includes(e)||!qp.includes(t))||!(!Ip.includes(e)||!Ip.includes(t)))};Cp("append",{blockNumber:"block to shift",type:"type to append [ACCENT, PIANO, PIANISSIMO, REST, REGULAR, LEGATO, STACCATO]"},"Shifts a block in grid by 1 to the right");function Fp(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Lp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lp(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Lp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Cp("shift",{blockNumber:"block to shift"},"Shifts a block in grid by 1 to the right");var Bp=function(e,t,n,r,a,i){for(var s=function(r){if("-"===e[a][r-1])return"continue";e[a][r]||t.some(function(e){return e.x===r&&e.y===a})||n.some(function(e){return e.x===r&&e.y===a})||t.push({x:r,y:a})},o=r;o<i;o++)s(o)},zp=function(e,t){var n,r=Np(t),a=Object.keys(r).map(function(e){return parseInt(e)}),i=Math.max.apply(Math,Object(h.a)(a)),s=[],o=Fp(t);try{for(o.s();!(n=o.n()).done;){var c=n.value,u=c.x,l=c.y;"-"===e[l][u]?(Bp(e,s,t,u,l+1,Math.max(u+2,i)),Bp(e,s,t,u+2,l,Math.max(u+3,i))):Bp(e,s,t,u,l,i)}}catch(p){o.e(p)}finally{o.f()}var f=[].concat(Object(h.a)(t),s);return f.sort(function(e,t){return e.x-t.x}),f},Jp=function(e){for(var t=[],n=0;n<e.size;n++)t.push(Object(h.a)(e.cells[n]));e.savedCells=t},Vp={clearBlock:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=e.cells,a=e.size,i=wp(r,a);if(i&&!isNaN(t)){var s=(i=i.filter(function(e){return e.length>1}))[t%i.length];if(s){s=s.filter(function(e){var t=e.x,n=e.y;return r[n]&&"-"!==r[n][t]&&"."!==r[n][t]});var o=Math.floor(n*s.length);s.slice(0,o).forEach(function(t){var n=t.x,r=t.y;return e.set(n,r,!1)})}}},delete:function(e,t){var n=e.cells,r=e.size,a=wp(n,r);if(a&&!isNaN(t)){var i=(a=a.filter(function(e){return e.length>1}))[t%a.length];if(i){var s=function(e){return e.reduce(function(e,t){return e[t.y]||(e[t.y]=[]),e[t.y].push(t),e},{})}(i=i.filter(function(e){var t=e.x,r=e.y;return n[r]&&"-"!==n[r][t]&&"."!==n[r][t]})),o=Object.keys(s).map(function(e){return parseInt(e)}),c=Math.max.apply(Math,Object(h.a)(o));if(s[c]){var u=s[c][0],l=u.x,f=u.y;e.set(l,f,!1)}}}},add:function(e,t,n,r){var a=e.cells,i=function(e,t){for(var n=[],r=function(e,t){return n.some(function(n){return n.some(function(n){return n.x===e&&n.y===t})})},a=function(n,r){var a=[],s=r,o=n;if(e[r][n]!==yp.a&&e[r][n]!==yp.b)for(var c=!1,u=r;u<t;u++){for(var l=n;l<t;l++){if(e[u][l]===yp.a||e[u][l]===yp.b){s=u,o=l,c=!0;break}if(!e[u][l]&&!e[u-1][l]&&!e[u-1][l-1])break}if(c)break}e[s][o]===yp.a?a=[{x:o-1,y:s-1},{x:o,y:s},{x:o+1,y:s},{x:o+2,y:s-1}]:e[s][o]===yp.b&&(a=[{x:o-1,y:s},{x:o,y:s+1},{x:o+1,y:s}]);for(var f=[],p=function(n){if(!e[r][n])return d=n,"break";if(f.push({x:n,y:r}),r>=t-1)return d=n,"continue";var a=i(n,r+1),s=[a],o=[a];if(e[r][n]===yp.a){var c=i(n+1,r+1);s.push(c),o.push(c)}for(var u=function(){var t=o.pop();if(0===t.length)return"continue";t.forEach(function(n){var r=i(n.x,t[0].y+1);if(r.length>0&&(s.push(r),o.push(r)),e[(n.x,t[0].y)]===yp.a){var a=i(n.x+1,t[0].y+1);a.length>0&&(s.push(a),o.push(a))}})};o.length>0;)u();s.forEach(function(e){return f=[].concat(Object(h.a)(f),Object(h.a)(e))}),e[r][n]===yp.a&&n++,d=n},d=n;d<t;d++){var v=p(d);if("break"===v)break}return f.forEach(function(e){a.some(function(t){return t.x==e.x&&t.y===e.y})||a.push(e)}),a},i=function(n,r,a){if(r>=t)return[];for(var i=[],s=function(t){return!!e[r][t]&&(i.push({x:t,y:r}),!0)},o=n;o<t&&s(o);o++)e[r][o]===yp.a&&o++;for(var c=n-1;c<=0&&(s(c)||e[r][c-1]===yp.a);c--);return i},s=0;s<t;s++)for(var o=0;o<t;o++)if(e[s][o]&&!r(o,s)){var c=a(o,s);n.push(c)}return n}(a,e.size),s=i[t%i.length];if(s&&r){var o=Np(s),c=Object.keys(o).map(function(e){return parseFloat(e)});if(void 0===n||-1===n){var u=1e3;for(var l in o)o[l].length<u&&(u=o[l].length,n=c.indexOf(parseInt(l)))}var f=c[n%c.length],p={type:r,value:""};if(void 0===f){var d=Mp(s,a),v=Ep(s,a,d)[0];if(v){var m=v.y,y=Math.max.apply(Math,Object(h.a)(s.map(function(e){return e.x})));"-"===d&&y===v.x&&y++,y++,e.set(y,m,p)}}else{var b=o[f=parseInt(f)],g=_p(e.cells,b,p);if(g)e.set(g.x,g.y,p);else{var O=Math.max.apply(Math,Object(h.a)(b.map(function(e){return e.y})))+1;e.set(f,O,p)}}}},append:function(e,t,n){var r=e.cells,a=e.size,i=wp(r,a),s=i[t%i.length];if(s&&n){var o=Np(s),c=Object.keys(o).map(function(e){return parseInt(e)}),u={type:n,value:""},l=o[Math.max.apply(Math,Object(h.a)(c))][0],f=l.x,p=l.y;"-"===r[p][f]&&f++,f++,e.set(f,p,u)}},shift:function(e,t){var n=e.cells,r=e.size,a=wp(n,r),i=a[t%a.length];if(i){var s=Mp(i,n);if(0!==(i=(i=zp(n,i)).filter(function(e){var t=e.x,r=e.y;return n[r][t]!==s})).length){for(var o=n[i[0].y][i[0].x],c=0;c<i.length;c+=1){i[c];var u=i[(c+1)%i.length],l=n[u.y][u.x];n[u.y][u.x-1]&&(o="-"===n[u.y][u.x-2]?n[u.y+1][u.x-1]:n[u.y][u.x-1]),n[u.y][u.x]=o,o=l}e.updateRedux(),e.calculateRules()}}},save:Jp,restore:function(e){e.savedCells&&(e.cells=Object(h.a)(e.savedCells),Jp(e),e.calculateRules(),e.updateRedux())}};function Hp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Up(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Gp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gp(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Gp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Wp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Kp(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Qp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qp(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Qp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Zp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Yp=function(e){Object(u.a)(n,e);var t=Zp(n);function n(e,r){var a;Object(s.a)(this,n),(a=t.call(this)).id=Object(S.uuid)(),a.subSequence=e,e.sequencerEngine.idToObject[a.id]=Object(c.a)(a),a.zObject=r,a.size=15,a.cells=[],a.symbols=[];for(var i=0;i<a.size;i++)a.cells.push(new Array(a.size).fill(!1));return a.newInlet(v.d,function(e){return a.onOperation(e[0])}),a.newOutlet(v.h),a.newInlet("save",function(){return a.save()}),a.newInlet("restore",function(e){var t=Object(ea.a)(e,1)[0];return a.restore(t)}),a.newInlet("interpolate",function(e){var t=Object(ea.a)(e,1)[0];return a.interpolate(t)}),a.newInlet("interpolation factor",function(e){var t=Object(ea.a)(e,1)[0];isNaN(t)||(a.interpolationFactor=t)}),a.newOutlet("saved"),a.newOutlet("density"),a.interpolationFactor=.5,a}return Object(o.a)(n,[{key:"interpolate",value:function(e){if(!this.zObject.sequencerEngine.isLoading&&(this.lastStepNumber!==this.zObject.sequencerEngine.trackStep&&(this.operationsCount=0),!(this.operationsCount++>12))){this.lastStepNumber=this.zObject.sequencerEngine.trackStep;for(var t=0;t<e.length;t++)for(var n=e[t],r=0;r<n.length;r++){var a=n[r];Math.random()<this.interpolationFactor&&(this.cells[t][r]="object"===typeof a?Object(p.a)({},a):a)}this.updateRedux(),this.calculateRules()}}},{key:"current",get:function(){return this.cells},set:function(e){this.cells=e,this.calculateRules(),this.updateRedux()}},{key:"getCurrentCopy",value:function(){var e,t=[],n=Kp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cells);try{for(n.s();!(e=n.n()).done;){var r,a=e.value,i=[],s=Kp(a);try{for(s.s();!(r=s.n()).done;){var o=r.value;i.push(!!o&&("string"===typeof o?o:Object(p.a)({},o)))}}catch(c){s.e(c)}finally{s.f()}t.push(i)}}catch(c){n.e(c)}finally{n.f()}return t}},{key:"getConnectedTidal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object(ne.a)(Object(f.a)(n.prototype),"getConnectedTidal",this).call(this,e,"rules")}},{key:"set",value:function(e,t,n){e>=this.size||t>=this.size||(this.cells[t][e]=n,this.calculateRules(),this.updateRedux())}},{key:"drag",value:function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(e!==n||t!==r){var i=this.cells[t][e];return!this.cells[r][n]&&(this.cells[r][n]=i,this.cells[t][e]=!1,a&&(this.calculateRules(),this.updateRedux()),!0)}}},{key:"updateRedux",value:function(){this.zObject.dispatch(Object(C.Qb)(this.id,Object(h.a)(this.cells)))}},{key:"getParameters",value:function(){return[]}},{key:"getSelected",value:function(e){for(var t=e.x1,n=e.y1,r=e.x2,a=e.y2,i={},s=n;s<=a;s++)for(var o=t;o<=r;o++)this.cells[s][o]&&(i[o+","+s]=!0);return i}},{key:"getJson",value:function(){return{id:this.id,cells:this.cells}}},{key:"fromJson",value:function(e){e.id&&(this.id=e.id,this.subSequence.sequencerEngine.idToObject[this.id]=this),e.cells&&(this.cells=e.cells,this.calculateRules())}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=vp(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).stack=[],e}return Object(o.a)(n,[{key:"save",value:function(){var e=this.getCurrentCopy();this.stack.push(e),this.updateRedux(),this.sendMessage("saved",this.getCurrentCopy())}},{key:"getCurrentCopy",value:function(){}},{key:"restore",value:function(e){if(Array.isArray(e))this.current=e;else if(0!==this.stack.length){var t=this.stack[this.stack.length-1];this.current=this.getCurrentCopy(t)}}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=Hp(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).lastStepNumber=void 0,e.operationsCount=0,e}return Object(o.a)(n,[{key:"onOperation",value:function(e){if("string"===typeof e&&(this.lastStepNumber!==this.zObject.sequencerEngine.trackStep&&(this.operationsCount=0),!(this.operationsCount++>52))){var t=e.split(" ").filter(function(e){return""!==e}),n=t[0],r=t.slice(1).map(function(e){return Object(pe.a)(e)?parseFloat(e):e}),a=Vp[n];a&&(a.apply(void 0,[this].concat(Object(h.a)(r))),this.lastStepNumber=this.zObject.sequencerEngine.trackStep)}}}]),n}(e)}(Object(mp.a)(function(e){return function(e){Object(u.a)(n,e);var t=Wp(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"calculateRules",value:function(){(new Date).getTime();var e=function(e,t){var n,r=function(t,n,r){var a=t.some(function(t){var n=t.x,r=t.y;return e[r][n]===yp.a});t.some(function(t){var n=t.x,r=t.y;return e[r][n]===yp.b}),(t=Ap(t,e)).sort(function(e,t){return e.x-t.x});var i=[],s=function(e,t,a){return e(t).every(n,r).always(xp(Pp(a)))};if(a){var o=Ep(t,e,yp.a)[0],c=Tp(t,o.x-1);c.length>0&&i.push(s(bp.o,Object(dp.b)(0),c));var u=Tp(t,o.x).filter(function(e){return jp(e)!==yp.a});u.length>0&&i.push(s(bp.r,Object(dp.b)(0),u));var l=Tp(t,o.x+1).filter(function(e){return jp(e)!==yp.a});l.length>0&&i.push(s(bp.r,Object(dp.b)(1),l));var f=t.filter(function(e){return e.x>o.x+1});if(f.length>0){var p,d=Sp(f).map(Pp).map(xp);i.push((p=Object(bp.l)(Object(dp.b)(1)).every(n,r)).series.apply(p,Object(h.a)(d)))}}else{var v=Mp(t,e,!1),m=Ep(t,e,v)[0];if(!m)return[];var y=Tp(t,m.x-1),b=Tp(t,m.x).filter(function(e){return jp(e)!==v}),g=Tp(t,m.x+1),O=v===yp.b?Object(dp.c)():v;if(y.length>0&&i.push(s(bp.o,O,y)),b.length>0&&i.push(s(bp.r,O,b)),g.length>0){var k,j=Sp(g).map(Pp).map(xp);i.push((k=Object(bp.l)(O).every(n,r)).series.apply(k,Object(h.a)(j)))}}return i.forEach(function(e){return e.block=t}),i},a=wp(e,t),i=[],s=Rp(a,e),o={},c=gp(a);try{for(c.s();!(n=c.n()).done;){var u=n.value,l=Mp(u,e),f=o[l]||0;i=[].concat(Object(h.a)(i),Object(h.a)(r(u,s[l],f))),o[l]=f+1}}catch(p){c.e(p)}finally{c.f()}return i.push(Object(bp.p)().always(bp.i)),i}(this.cells,this.size);(new Date).getTime(),this.rules=e,this.sendMessage(v.h,e),this.sendMessage("density",this.getDensity())}},{key:"getDensity",value:function(){var e,t=0,n=0,r=Up(wp(this.cells,this.size));try{for(r.s();!(e=r.n()).done;)t+=e.value.length,n+=5}catch(a){r.e(a)}finally{r.f()}return t/n}}]),n}(e)}(Object(Aa.a)(function(){return function e(){Object(s.a)(this,e)}}()))))));function Xp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var $p=function(e){Object(u.a)(n,e);var t=Xp(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).newInlet("choose",function(){return r.onChoose()}),r.newInlet("set probabilities",function(e){var t=Object(ea.a)(e,1)[0];return r.setProbabilities(t)}),r.newOutlet("choice"),r.newOutlet("probabilities"),r.probabilities={rest:0,pianissimo:0,piano:0,regular:0,accent:0,staccato:0,legato:0,double:0,flam:0},r}return Object(o.a)(n,[{key:"setProbabilities",value:function(e){for(var t=Object.keys(this.probabilities),n=0;n<e.length;n++)this.setProbability(t[n],e[n]);this.probabilities=Object(p.a)({},this.probabilities)}},{key:"getJson",value:function(){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{probabilities:this.probabilities})}},{key:"fromJson",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];(t=Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this)).call.apply(t,[this,e].concat(a)),this.probabilities=e.probabilities}},{key:"setProbability",value:function(e,t){this.probabilities[e]=t,this.sendMessage("probabilities",Object.values(ed(this.probabilities)))}},{key:"onChoose",value:function(){var e=ed(this.probabilities),t=Math.random(),n=0;for(var r in e){if(t<n+e[r])return void this.sendMessage("choice",r);n+=e[r]}}}]),n}(Va.a),ed=function(e){var t=0;for(var n in e)t+=e[n];var r={};for(var a in e)r[a]=e[a]/t;return r};Object(Ca.a)("jgrid",{},"A grid based rule generator for the jaki object",function(e){return 0},{tags:"Rhythm",inlets:0,operationDocs:Cp,connects:{object:"jaki",inlet:"rules"}});Object(Ca.a)("jtypes",{},"Probabilistically choose a hit type based on user input",function(){return 0},{inlets:0});var td=n(546);function nd(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return rd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rd(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function rd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("jpolygons",{tidals:""},"Converts Jaki object tidals into polygons to be rendered",void 0,{tags:"Rhythm"});var ad=function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{x:e,y:e},s=arguments.length>6?arguments[6]:void 0;arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(null===s.transpose)return[void 0,void 0];var o=sd(t,i,a,r),c=sd((t+1)%n,i,a,r),u=sd((t+2)%n,i,a,r),l=sd((t+3)%n,i,a,r),f=sd(Object(jn.a)(t-3,n),i,a,r),h=sd(Object(jn.a)(t-2,n),i,a,r),p=sd(Object(jn.a)(t-1,n),i,a,r),d=o,v=Object(td.a)(o,l,c,h),m=Object(td.a)(p,u,h,c),y=Object(td.a)(o,f,u,p),b=new Float32Array(8);return b[0]=d.x,b[1]=d.y,b[2]=v.x,b[3]=v.y,b[4]=m.x,b[5]=m.y,b[6]=y.x,b[7]=y.y,[Object(Ef.c)({x:e,y:e},m),b]},id=function(e,t,n,r,a,i){var s={x:e,y:e},o=sd(n,s,r,a),c=sd((n+1)%i,s,r,a),u=(sd((n+2)%i,s,r,a),sd((n+3)%i,s,r,a)),l=(sd(Object(jn.a)(n-3,i),s,r,a),sd(Object(jn.a)(n-2,i),s,r,a)),f=(sd(Object(jn.a)(n-1,i),s,r,a),Object(td.a)(o,u,c,l)),h=new Float32Array(6);return h[0]=o.x,h[1]=o.y,h[2]=f.x,h[3]=f.y,h[4]=c.x,h[5]=c.y,h},sd=function(e,t,n,r){r.flat(16);var a=r.length,i=2*Math.PI*e/a-.5*Math.PI;return{x:t.x+n*Math.cos(i),y:t.y+n*Math.sin(i),deg:i}};Object(Ca.a)("jhits",{"trigger-routing":"",tidals:""},"Outputs coords of triggers",void 0,{inlets:2});var od=function(e){for(var t=void 0,n=[],r=0;r<e.length;r++){var a=e[r].cycle,i=t||Math.max(10,133-24*r);n.push(i);for(var s=a,o=s.length,c=0;c<s.length;c++){var u=s[c];Array.isArray(u)&&(u=u[0]);var l=ad(140,c,o,a,i,{x:140,y:140},u),f=Object(ea.a)(l,2),h=f[0];f[1];h&&(t=h)}}return n};Object(Ca.a)("jclock",{tidals:""},"Returns meshes for the clock hands",void 0,{inlets:1});function cd(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ud(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ud(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ud(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("concat",{},"Concatenates the list arguments together",void 0,{tags:"List",inlets:function(e){return e},isHot:!0});Object(Ca.a)("lconcat",{},"Concatenates the list arguments together (lazily)",void 0,{tags:"List",inlets:function(e){return e}});Object(Ca.a)("list.prependIndex",{},"Prepends index at every element of inputted list");Object(Ca.a)("list.appendEvery",{toAppend:""},"Prepends index at every element of inputted list",function(){return 1},{inlets:2});Object(Ca.a)("listMax",{},"returns max number of list",function(){return 1},{inlets:1,tags:"List"});Object(Ca.a)("push",{length:"arg"},"Pushes msgs to beginning of list until length limit is met (First-in-first-out)",void 0,{tags:"List"});Object(Ca.a)("append",{length:"arg"},"Pushes msgs into list until limit (bang sends its stored list if needed)",void 0,{inlets:2,tags:"List"});Object(Ca.a)("appendList",{"list to append":"",limit:""},"Pushes msgs into list until limit",void 0,{inlets:2,tags:"List"});Object(Ca.a)("nth",{n:"n"},"Get nth element from list",void 0,{inlets:2,tags:"List",isHot:!0});Object(Ca.a)("map",{fn:""},"Applies function to each element of list",void 0,{tags:"List",inlets:["list","fn"]});Object(Ca.a)("interleaf",{value:"",position:""},"Interleaves a number every x many positions",void 0,{tags:"List",inlets:3});var ld=function(e,t,n){var r;return function(e){var a=Object(ea.a)(e,1)[0],i=Kf(t)||0,s=Kf(n)||2;if(ArrayBuffer.isView(a))return 0===a.length?a:[r=fd(a,i,s,r)];if(Array.isArray(a)){for(var o=[],c=0;c<a.length;c++)c>0&&c%s===0&&o.push(i),o.push(a[c]);return a.length%s===0&&o.push(i),[o]}}},fd=function(e,t,n,r){for(var a=e.length+Math.floor(e.length/n),i=r&&a.lengthh===r.length?r:new Float32Array(a),s=0,o=0;o<e.length;o++)o>0&&o%n===0&&(i[s++]=t),i[s++]=e[o];return e.length%n===0&&(i[i.length-1]=t),i};Object(Ca.a)("list",{},"Creates a list out of the inputed message (if possible",void 0,{tags:"List"});Object(Ca.a)("sublist",{},"Creates a list out of the inputed message (if possible",void 0,{tags:"List"});Object(Ca.a)("smokeVertices",{size:""},"Yo",void 0,{inlets:3});Object(Ca.a)("smokeColors",{size:""},"Yo");Object(Ca.a)("flattenList",{},"Flattens a list of lists",void 0,{tags:"List"});Object(Ca.a)("cList",{itemSize:""},"Turns a list into  [0,1,2,3]");Object(Ca.a)("list.partition",{list:"",size:""},"Partitions 1d list into groups based on size",void 0,{inlets:2});Object(Ca.a)("list.reverse",{list:""},"Reverse a list and outputs the reversed list out of outlet");Object(Ca.a)("list.indexOf",{},"Indexof in list",function(){return 1},{tags:"List",inlets:2,isHot:!0});Object(Ca.a)("fillArray",{val:"",start:"",end:"",length:""},"Fills a new array of given length from start to end with value",function(){return 1},{inlets:4});Object(Ca.a)("interleavedConcat",{lists:""},"Intereaves a list of lists");Object(Ca.a)("centerFillArray",{val:"",length:""},"Fills a new array of given length from start to end with value",function(){return 1},{inlets:2});Object(Ca.a)("listOsc",{"list of osc":""},"Returns a list for an oscilloscope ready to be thrown into a texture",function(){return 1},{inlets:1});Object(Ca.a)("sparseList",{"List of indices":"","Length of outputed list":"","Value to place in each slot":"","Chunk Size":"","Chunk Offset":"","Inputed Array":""},"Returns a list of given length w elements placed at indices of inputed list",function(){return 1},{isHot:!0,inlets:6});Object(Ca.a)("singleSparseList",{"List of indices":"","Length of outputed list":"","Value to place in each slot":"","Chunk Size":"","Chunk Offset":"","Inputed Array":""},"Returns a list of given length w elements placed at indices of inputed list",function(){return 1},{inlets:5});Object(Ca.a)("sparseMerge",{},"Merges lists together into one list ",void 0,{tags:"List",inlets:function(e){return e},isHot:!0});Object(Ca.a)("list.skipEvery",{list:"",chunkSize:"",offsetToSkip:""},"Filters every #'d element out of inputted list",function(){return 1},{inlets:2});Object(Ca.a)("list.isEveryEmpty",{list:"",chunkSize:"",offsetToSkip:"",threshold:""},"Filters every #'d element out of inputted list and returns true if empty",function(){return 1},{inlets:4});Object(Ca.a)("list.ratioBelow",{list:"",chunkSize:"",offsetToSkip:"",threshold:""},"Returns ratio of elements below a threshold",function(){return 1},{inlets:4});function hd(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return pd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pd(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function pd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object(Ca.a)("polygonsToMeshes",{polygons:"",material:""},"Converts a list of polygon points to meshes",void 0,{tags:"Graphics",inlets:2});function dd(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return vd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vd(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function vd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var md=function(e){for(var t=e.tracks[0].patterns.length,n=[],r=0;r<t;r++)e.switchToPattern(r),n.push(e.length);return n},yd=function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f,h,p,d,v,m,y;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.sequencerEngine).store.dispatch(Object(C.bc)("Freezing track's patterns")),e.next=4,Object(O.a)(100);case 4:return n.stop(),r=t.slots.filter(function(e){return e}),i=r[0].patterns.length,s=md(n),n.switchToPattern(0),e.next=11,Object(_e.a)(n,t);case 11:return o=e.sent,e.next=14,Fe(n,o,i,r);case 14:c=e.sent,u=bd(t),l=u.frozenPad,f=u.frozenTracks,h=dd(r);try{for(h.s();!(p=h.n()).done;)d=p.value,n.deleteTrack(d.trackNumber)}catch(a){h.e(a)}finally{h.f()}v=n.addMultiFreezeTrack(),m=v.patterns.length;case 20:if(!(m<i)){e.next=26;break}return e.next=23,v.newPattern(!0);case 23:m++,e.next=20;break;case 26:for(v.freeze(c,!0),v.frozenPad=l,v.frozenTracks=f,y=0;y<i;y++)n.switchToPattern(y),v.currentPattern=y,v.pattern.changeLength(s[y]),v.frozenColumns[0].playing=y;n.switchToPattern(0),n.switchToPattern(n.currentPattern),n.store.dispatch(Object(C.bc)(void 0)),n.tracks.forEach(function(e){return e.trackIsLoading=!1});case 34:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),bd=function(e){var t,n=e.getJsonForPack(),r=[],a=dd(e.tracks);try{for(a.s();!(t=a.n()).done;){var i=t.value;r.push(!!i&&N(i))}}catch(s){a.e(s)}finally{a.f()}return{frozenPad:n,frozenTracks:r}};function gd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Od=function(e){Object(u.a)(n,e);var t=gd(n);function n(e){var r;return Object(s.a)(this,n),r=t.call(this,e),e.setAttribute("secondary-color","#cdcdcd"),e.setAttribute("primary-color","#b4b4b4"),e.newAttribute("slot-color"),e.newAttribute("slot-opacity"),e.newAttribute("Pads Per Row",3),e.newAttribute("Number of Pads",9,function(e){r.pad&&r.pad.onChangePadsCount(e)}),e.newAttribute("Show Track Names",!0),e.newAction("Clear Pattern",function(){return r.clearPattern()}),e.newAction("Freeze Pads",function(){return r.freezePads()}),r}return Object(o.a)(n,[{key:"clearPattern",value:function(){this.pad.slotTracks.forEach(function(e){return e.pattern.clear()}),this.sequencerEngine.updateTracks()}},{key:"isDeletable",value:function(){return this.pad&&0===this.pad.slots.filter(function(e){return e}).length}},{key:"dispose",value:function(){this.subSequence.deletePad(this.pad)}},{key:"freezePads",value:function(){yd(this.pad)}},{key:"linkPad",value:function(e){e&&(this.pad=e,this.pad.zObject=this.zObject,this.pad.onSizeChange(this.zObject.width,this.zObject.height))}},{key:"getJson",value:function(e){var t=Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this,e),r=void 0,a=void 0;if(e){var i=this.pad.getJsonForPack();r=[];for(var s=0;s<i.length;s++)r.push(i[s]);a=i.fx}return Object(p.a)({},t,{padId:this.pad.id,pad:r,fx:a})}},{key:"fromJson",value:function(e,t){var r=this;Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t);var a=e.padId,i=this.subSequence.getRootSubSequence?this.subSequence.getRootSubSequence():this.subSequence;e.pad?i.loadPackAsPads(e.pad,e.fx,this.pad).then(function(e){return r.linkPad(e)}):this.linkPad(i.pads.find(function(e){return e.id===a}))}}]),n}(Va.a);Object(Ca.a)("pad",{},"Drum pad for sounds",function(e){return 0},{inlets:0});Object(Ca.a)("pad.showSequencer",{flag:""},"Shows sequencer");Object(Ca.a)("zl",{mode:"mode"},"Concatenates the list arguments together",void 0,{isHot:!0});Object(Ca.a)("split",{min:"min",max:"max"},"Sends incoming msgs that are within a range out the left-inlet, and the rest through the right.",void 0,{tags:"Messages"});function kd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}new Ga.a;Object(Ca.a)("comment",{},"Creates comment box");var jd=function(e){Object(u.a)(n,e);var t=kd(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).text="",r}return Object(o.a)(n,[{key:"fromJson",value:function(e){this.text=e.text}},{key:"getJson",value:function(){return{text:this.text}}},{key:"getParameters",value:function(){return[]}}]),n}(Va.a);Object(Ca.a)("get",{object:"object",field:"number"},"Gets field from meessage. I.E. get ",void 0,{isHot:!0,inlets:2,tags:"Object Utilities"});Object(Ca.a)("set",{field:"number",value:"number"},"Sets field from message. I.E. set ",void 0,{tags:"Object Utilities"});Object(Ca.a)("object.create",{value:"number",field:"number"},"Create an object json out of value and field",void 0,{tags:"Object Utilities",inlets:2});Object(Ca.a)("object.keys",{object:"object"},"Gets keys as list from object",function(){return 1},{tags:"Object Utilities"});Object(Ca.a)("object.builder",{args:"args"},"Creats a list out of the inlets",void 0,{isHot:!0,tags:"List",inlets:function(e){return e+1}});function wd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function xd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Sd=function(e){Object(u.a)(n,e);var t=xd(n);function n(e,r,a){var i;return Object(s.a)(this,n),(i=t.call(this,e,r,a,"Instanced")).instanceObjectMapping={},i}return Object(o.a)(n,[{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];arguments.length>2&&arguments[2];return this.id=t?Object(S.uuid)():e.id,this.sequencerEngine.idToObject[this.id]=this,{}}},{key:"getJson",value:function(){return{id:this.id}}},{key:"dispose",value:function(){var e=this;this.implements&&(this.implements.instances=this.implements.instances.filter(function(t){return t!==e}))}},{key:"isDeletable",value:function(){return!0}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=wd(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).objectRegistry={},e}return Object(o.a)(n,[{key:"registerObject",value:function(e,t){this.objectRegistry[e.id]=t}},{key:"lookupObject",value:function(e){return this.objectRegistry[e.id]}}]),n}(e)}(Lh));Object(Ca.a)("subpatch",{name:"Name of the subpatch"},"Creates an encapsulated patcher",function(){return 0},{inlets:[]});Object(Ca.a)("instancedSubpatch",{},"Creates an encapsulated patcher",function(){return 0},{inlets:[]});Object(Ca.a)("track",{},"Track object",function(){return 0},{inlets:0});Object(Ca.a)("counter",{min:"",max:""},"counts number of input messages received",function(){return 2},{tags:"Ticker",isHot:!0,inlets:["Input","Direction","Reset"]});Object(Ca.a)("simpleCounter",{value:"",min:"",max:""},"counts number of input messages received",void 0,{tags:"Ticker",isHot:!0,inlets:["decrement","increment","value"]});var Pd=1e-5;Object(Ca.a)("list.matrixMultiplyList",{"list of matrices (1&2)":""},"Takes 2 lists and multiples each pair of matrices together into a new list",function(){return 1},{isHot:!0,inlets:2});Object(Ca.a)("list.matrixMultiply",{"list of matrices 1":"","matrix of matrices 2":""},"Takes 2 lists and multiples each pair of matrices together into a new list",function(){return 1},{isHot:!0,inlets:2});function Ed(e,t){for(var n=e.length,r=e[0].length,a=(t.length,t[0].length),i=new Array(n),s=0;s<n;++s){i[s]=new Array(a);for(var o=0;o<a;++o){i[s][o]=0;for(var c=0;c<r;++c)i[s][o]+=e[s][c]*t[c][o],Math.abs(i[s][o]-0)<Pd&&(i[s][o]=0)}}return i}Object(Ca.a)("list.allIdentity",{"list of matrices 1":""},"Takes 2 lists and multiples each pair of matrices together into a new list",function(){return 1});var Td=function(e){var t=Object(ea.a)(e,3),n=t[0],r=t[1],a=t[2];return 1===n[0]&&0===n[1]&&0===n[2]&&0===r[0]&&1===r[1]&&0===r[2]&&0===a[0]&&0===a[1]&&1===a[2]},Ad={"list.matrixMultiply":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0],r=t();if(!n&&r)return[r];if(!r)return[n];for(var a=[],i=0;i<n.length;i++){var s=n[i],o=r[i];if(s&&o){var c=Ed(s,o);a.push(c)}}return[a]}},"list.matrixMultiplyList":function(e){return function(e){var t=Object(ea.a)(e,1)[0],n=Object(ea.a)(t,2),r=n[0],a=n[1];if(!r&&a)return[a];if(!a)return[r];for(var i=[],s=0;s<r.length;s++){var o=r[s],c=a[s];if(o&&c){var u=Ed(o,c);i.push(u)}}return[i]}},"list.allIdentity":function(e){return function(e){var t=Object(ea.a)(e,1)[0];if(Array.isArray(t))return t.every(function(e){return Td(e)})?[0]:[t]}}},Md=n(573);function Rd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Cd=function(e){Object(u.a)(n,e);var t=Rd(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).color="#A19A9A",r.backgroundColor="#100B0B",r.fillColor="#757474",r.dotColor="#B5B5B5",r.newInlet("color",function(e){r.color=e[0]}),r.newInlet("backgroundColor",function(e){return r.backgroundColor=e[0]}),r.newInlet("fillColor",function(e){return r.fillColor=e[0]}),r.newInlet("dotColor",function(e){return r.dotColor=e[0]}),r}return n}(Va.a),Nd=n(815),qd=n(818),Id=n(817);Object(Ca.a)("jaki",{},"Generative drums",["trigger-routing"],{inlets:[v.f,v.h,v.c],tags:"Rhythm",connects:[{outlet:v.o,object:"jgraphics",inlet:v.o},{outlet:"trigger-routing",object:"pad",inlet:"trigger-routing"}]});Object(Ca.a)("jparams",{},"Parameters for Jaki Object",void 0,{tags:"Rhythm",inlets:[],outlets:["params"],connects:{object:"jaki",inlet:"params"}});Object(Ca.a)("jrules",{},"Rules for Jaki Object",function(e){return 0},{});Object(Ca.a)("jfigures",{},"Figures for Jaki Object",["figures"],{tags:"Rhythm",connects:{object:"jaki",inlet:"figures"}});Object(Ca.a)("jgraphics",{},"Draws graphics for a Jaki object",void 0,{tags:"Rhythm",inlets:[v.o]});var _d={jaki:function(e){var t=new F.a;t.loadDefaults(),t.velocity=.5,t.duration=1e6,e.needsTick=!0;var n=new Md.a(e.subSequence,e);return e.effect=n,function(e){var r=Object(_a.a)(e),a=r[0],i=r.slice(1);switch(a){case v.n:var s=Object(ea.a)(i,2),o=s[0],c=s[1];if(n.onNewStep(o,c),0===o){var u=new Ve.a(t,c,o);n.input(u)}var l=n.output(c,o,o);return[[v.p,l]];case v.l:n.stop();break;case v.k:n.clear();break;case v.f:n.jakiParams=i[0];break;case v.h:var f=i[0];Array.isArray(f[0])?f.forEach(function(e,t){return n.rules[t].rules=e}):n.rules[0].rules=f;break;case v.c:n.figures=i[0]}}},jparams:function(e){var t=new Nd.a(e.subSequence,e);return e.effect=t,e.needsStart=!0,function(e){return Object(ea.a)(e,1)[0],t}},jrules:function(e){var t=new Id.a(e.subSequence,e);return e.width=340,e.height=240,t.width=340,t.height=240,e.effect=t,e.needsStart=!0,function(e){Object(ea.a)(e,1)[0],t.publishRules()}},jfigures:function(e){var t=new qd.a(e.subSequence,e);return e.effect=t,e.needsLoad=!0,function(e){return Object(ea.a)(e,1)[0],t}},jgraphics:function(e){var t=new Cd(e);return e.effect=t,function(e){var n=Object(ea.a)(e,2),r=n[0],a=n[1];switch(r){case v.o:t.tidals=a}}}};Object(Ca.a)("jwhen",{predicate:"predicate",action:"action"},"When predicate is met do action",void 0,{isHot:!0});Object(Ca.a)("jbefore",{predicate:"predicate",action:"action"},"When predicate is met do action",void 0,{isHot:!0});Object(Ca.a)("jafter",{predicate:"predicate",action:"action"},"When predicate is met do action",void 0,{isHot:!0});Object(Ca.a)("jotherwise",{action:"action"},"If no other predicates are met, do action",void 0,{isHot:!0});var Dd=function(e){switch(e){case"accent":return bp.a;case"legato":return bp.e;case"piano":return bp.g;case"rest":return bp.i;case"staccato":return bp.j;case".":return Object(dp.c)();case"-":return Object(dp.b)(0);case"--":return Object(dp.b)(1);case"double":return bp.c;case"flam":return bp.d;case"after":return bp.l;case"before":return bp.o}},Fd={jwhen:function(e,t,n){return function(){var e=Dd(t()),r=Dd(n());if(e&&r)return Object(bp.r)(e).always(r)}},jotherwise:function(e,t){return function(){var e=Dd(t());if(e)return Object(bp.p)().always(e)}},jafter:function(e,t,n){return function(){var e=Dd(t()),r=Dd(n());if(e&&r)return Object(bp.l)(e).always(r)}},jbefore:function(e,t,n){return function(){var e=Dd(t()),r=Dd(n());if(e&&r)return Object(bp.o)(e).always(r)}}};Object(Ca.a)("+",{},"Adds the inlets together outputting it from the outlet",void 0,{isHot:!0,inlets:2,tags:["Math"]});Object(Ca.a)("-",{},"Subtracts the 2nd inlet from the 1st, outputting it from the outlet",void 0,{isHot:!0,inlets:2,tags:["Math"]});Object(Ca.a)("notNaN",{x:""},"Psas if it is a number");Object(Ca.a)("!",{x:""},"!x");Object(Ca.a)("*",{},"Multiplies the left and right inlets together",void 0,{isHot:!0,inlets:2,tags:["Math"]});Object(Ca.a)("/",{},"Divides the left and right inlets together",void 0,{isHot:!0,tags:["Math"],inlets:2});Object(Ca.a)("pow",{a:"",b:""},"Returns left inlet raised to power of right inlet",void 0,{inlets:2,isHot:!0,tags:["Math"]});Object(Ca.a)("spow",{a:"",b:""},"Returns left inlet raised to signed power of right inlet",void 0,{inlets:2,isHot:!0,tags:["Math"]});Object(Ca.a)("sqrt",{},"Returns square-root of left inlet",void 0,{tags:["Math"]});Object(Ca.a)("sin",{},"Returns sine of left inlet",void 0,{tags:["Math"]});Object(Ca.a)("atan",{a:"",b:""},"Returns atan2 of left inlet",void 0,{inlets:2,tags:["Math"]});Object(Ca.a)("cos",{},"Returns cosine of left inlet",void 0,{tags:["Math"]});Object(Ca.a)("round",{},"Returns rounded value of left inlet",void 0,{tags:["Math"]});Object(Ca.a)("remainderRound",{x:"",y:""},"Returns rounded value of left inlet",void 0,{inlets:2,tags:["Math"]});Object(Ca.a)("floor",{},"Returns floored value of left inlet",void 0,{tags:["Math"]});Object(Ca.a)("%",{a:""},"Returns remainder of the left-inlet divided by the right-inlet",void 0,{inlets:2,isHot:!0,tags:["Math"]});Object(Ca.a)("mod",{a:""},"Returns remainder of the left-inlet (not negative adjusted) divided by the right-inlet",void 0,{inlets:2,isHot:!0,tags:["Math"]});Object(Ca.a)("remainder",{a:""},"Returns remainder and divider of the left-inlet divided by the right-inlet",function(){return 2},{inlets:2,isHot:!0,tags:["Math"]});Object(Ca.a)("abs",{a:""},"Returns absolute value of the left-inlet",void 0,{inlets:1,tags:["Math"]});Object(Ca.a)("max",{a:"",b:""},"Returns max value of the left-inlet and right-inlet",void 0,{inlets:2,tags:["Math"]});Object(Ca.a)("min",{a:"",b:""},"Returns min value of the left-inlet and right-inlet",void 0,{inlets:2,tags:["Math"]});Object(Ca.a)("amin",{a:"",b:""},"Returns (absolute value) min value of the left-inlet and right-inlet",void 0,{inlets:2,tags:["Math"]});Object(Ca.a)("filterBetween",{value:"",a:"",b:""},"Passes if value is between a and b",void 0,{inlets:3,tags:["Math"]});Object(Ca.a)("number2hex",{number:""},"Converts number in base 10 to a hexadecimal string");Object(Ca.a)("hexalist",{number:""},"Convert a number in base 10 to a list of numbers from 0-15 (i.e. hexa)",void 0,{inlets:1});Object(Ca.a)("clamp",{a:"",b:"",c:""},"Returns clamped value of inlet",void 0,{inlets:3,isHot:!0,tags:["Math"]});Object(Ca.a)("pi",{},"Returns value for pi when it receives a message");Object(Ca.a)("random.int",{max:""},"Returns random int from 0 - max");var Ld={"+":function(e,t){return function(e){if(Array.isArray(e[0]))return[e[0].map(function(e,n){return Array.isArray(t())?isNaN(e)||isNaN(t()[n])?e:e+t()[n]:e+t()})];var n=t()+e[0];return isNaN(n)?1:n}},pi:function(e){return e.needsLoad=!0,function(){return Math.PI}},min:function(e,t){return function(e){return Array.isArray(e[0])?[e[0].map(function(e){return Math.min(e,t())})]:[Math.min(e[0],t())]}},max:function(e,t){return function(e){return[Math.max(e[0],t())]}},clamp:function(e,t,n){return function(e){return isNaN(e[0])?t():Math.min(Math.max(e[0],t()),n())}},"-":function(e,t){return function(e){if(Array.isArray(e[0]))return[e[0].map(function(e,n){return Array.isArray(t())?e-t()[n]:e-t()})];var n=e[0]-t();return isNaN(n)?1:n}},"*":function(e,t){return function(e){if(Array.isArray(e[0]))return[e[0].map(function(e,n){return Array.isArray(t())?isNaN(e)||isNaN(t()[n%t().length])?e:e*t()[n%t().length]:isNaN(t())||isNaN(e)?e:e*t()})];var n=t()*e[0];return isNaN(n)?1:n}},"/":function(e,t){return function(e){if(Array.isArray(e[0]))return[e[0].map(function(e,n){return Array.isArray(t())?e/t()[n]:e/t()})];var n=e[0]/t();return isNaN(n)?1:n}},"%":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(Array.isArray(n)){var r=t();return[n.map(function(e){return Object(jn.a)(e,r)})]}return Object(jn.a)(n,t())}},pow:function(e,t){return function(e){var n=t();isNaN(n)&&(n=1);var r=e[0];return Array.isArray(r)?[r.map(function(e){return Math.pow(e,n)})]:Math.pow(e[0],n)}},sqrt:function(){return function(e){return Math.sqrt(e[0])}},round:function(){return function(e){var t=Math.round(e[0]);if(!isNaN(t))return t}},floor:function(){return function(e){if(Array.isArray(e[0]))return[e[0].map(function(e){return Math.floor(e)})];var t=Math.floor(e[0]);return isNaN(t)?void 0:t}},abs:function(e){return function(e){return Array.isArray(e[0])?[e[0].map(function(e){return Math.abs(e)})]:Math.abs(e[0])}},hexalist:function(e){return function(e){for(var t=e[0].toString(16),n=[],r=0;r<t.length;r++)n.push(parseInt(t[r],16));return[n]}},remainder:function(e,t){return function(e){return[[Object(jn.a)(e[0],t()),Math.floor(e[0]/t())]]}},sin:function(){return function(e){return Math.sin(e[0])}},cos:function(){return function(e){return Math.cos(e[0])}},notNaN:function(){return function(e){var t=Object(ea.a)(e,1)[0];if(!isNaN(t))return[t]}},"random.int":function(e){return function(e){var t=Object(ea.a)(e,1)[0];return Math.floor(Math.random()*t)}},"!":function(){return function(e){var t=Object(ea.a)(e,1)[0];return 0===t?[1]:1===t?[0]:[!t]}},amin:function(e,t){return function(e){var n=Object(ea.a)(e,1)[0],r=t();return Math.abs(n)>r?n<0?-r:r:n}},number2hex:function(){return function(e){return Object(ea.a)(e,1)[0].toString(16)}},filterBetween:function(e,t,n){return function(e){var r=Object(ea.a)(e,1)[0],a=n();if(r>=t()&&r<=a)return[r]}},atan:function(e,t){return function(e){return Math.atan2(e[0],t())}},spow:function(e,t){return function(e){var n=t();isNaN(n)&&(n=1);var r=e[0];return Array.isArray(r)?[r.map(function(e){return(e<0?-1:1)*Math.pow(e,n)})]:(e[0]<0?-1:1)*Math.pow(e[0],n)}},remainderRound:function(e,t){return function(e){var n=Object(ea.a)(e,1)[0],r=Object(jn.a)(n,t());return r>t()/2?n-r+t():n-r}},mod:function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(Array.isArray(n)){var r=t();return[n.map(function(e){return e%r})]}return n%t()}}};Object(Ca.a)("pack",{args:"args"},"Creats a list out of the inlets",void 0,{tags:"List",inlets:function(e){return e}});Object(Ca.a)("packFull",{args:"args"},"Creats a list out of the inlets (once all inlets are full)",void 0,{tags:"List",isHot:!0,inlets:function(e){return e}});Object(Ca.a)("pak",{args:"args"},"Creates a list out of the inlets (all hot inlets)",void 0,{tags:"List",inlets:function(e){return e},isHot:!0});Object(Ca.a)("unpack",{args:"args"},"Send a list out individual outlets",function(e){return e},{tags:"List"});Object(Ca.a)("replacepak",{list:"override list",args:"args"},"Pak but allows overriding the list",void 0,{tags:"List",inlets:function(e){return e+1},isHot:!0});Object(Ca.a)("indexpack",{"index + value pair":""},"Inserts into stored list at index",function(){return 1},{inlets:function(e){return e+1}});Object(Ca.a)("togglepack",{"index + value pair":""},"Inserts into stored list at index",function(){return 1},{inlets:function(e){return e+1}});Object(Ca.a)("select",{args:"args"},"Matches messages by arguments and sends them to the respective output",function(e){return e},{tags:"Messages"});Object(Ca.a)("between",{args:"args"},"Matches messages by arguments and sends them to the respective output",function(e){return e+1},{tags:"Messages"});Object(Ca.a)("nameIndex",{args:"args"},"");var Bd=function(e,t){try{return parseFloat(e)===parseFloat(t)}catch(n){return e===t}};function zd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Jd=function(e){Object(u.a)(n,e);var t=zd(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).x=.5,r.y=.5,r.newInlet("xy",function(e){var t=Object(ea.a)(e,1)[0];return r.onXY(t)}),r.newOutlet("xy"),r}return Object(o.a)(n,[{key:"onXY",value:function(e){var t=Object(ea.a)(e,2),n=t[0],r=t[1];this.setXY(n,r)}},{key:"sendCoordinates",value:function(){this.sendMessage("xy",[this.x,this.y])}},{key:"setXY",value:function(e,t){this.x=e,this.y=t,this.sendCoordinates()}},{key:"x",get:function(){return this._x},set:function(e){this._x=e}},{key:"y",get:function(){return this._y},set:function(e){this._y=e}},{key:"getJson",value:function(){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{x:this.x,y:this.y})}},{key:"fromJson",value:function(e,t){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.x=e.x,this.y=e.y}}]),n}(Va.a);function Vd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Hd=function(e){Object(u.a)(n,e);var t=Vd(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).coordinates=[],r.numberOfCoordinates=0,r.newCoordinates(),r.newCoordinates(),r.newOutlet("coordinates"),r.zObject.newAttribute("x-axis","x"),r.zObject.newAttribute("y-axis","y"),r}return Object(o.a)(n,[{key:"newCoordinates",value:function(){this.zObject.newAttribute("coordinate-color-"+(this.numberOfCoordinates+1),"#ffffff"),this.zObject.newAttribute("coordinate-name-"+(this.numberOfCoordinates+1),"type name"),this.coordinates[this.numberOfCoordinates]={x:.5,y:.5},this.coordinates=Object(h.a)(this.coordinates),this.numberOfCoordinates++}},{key:"sendCoordinates",value:function(){this.sendMessage("coordinates",this.coordinates.map(function(e){return[e.x,e.y]}))}},{key:"setXY",value:function(e,t,n){this.coordinates[n]={x:e,y:t},this.sendCoordinates()}},{key:"getJson",value:function(){return Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{coordinates:this.coordinates,numberOfCoordinates:this.numberOfCoordinates})}},{key:"fromJson",value:function(e,t){Object(ne.a)(Object(f.a)(n.prototype),"fromJson",this).call(this,e,t),this.numberOfCoordinates=2,this.coordinates=e.coordinates}}]),n}(Va.a);Object(Ca.a)("interface.xy",{},"Interface for controlling 2 numbers using x/y plane",function(){return 0},{inlets:0});Object(Ca.a)("interface.multiXY",{},"Interface for controlling multiple pairs of 2 numbers using x/y plane",function(){return 0},{inlets:0});var Ud=n(1754),Gd=n.n(Ud),Wd=(n(340),n(297),!0);window.addEventListener("message",Kd,!1);var Kd=function(e){"use-pinata"===e.data?Wd=!0:"use-zequencer"===e.data&&(Wd=!1)};Object(Ca.a)("record.mix",{"start/stop":"1 for start to for stop","channel input":"","max time":"","only send buffer":"if true then we dont convert/store on pinata"},"Records the global mix to a file",function(){return 5},{inlets:4,outlets:["hash","mp3 buffer","raw buffer","start step","silence at start"]});Object(Ca.a)("record.pause",{"start/stop":"1 for start to for stop"},"Records the global mix to a file",function(){return 3});var Qd=function(e,t){return new Promise(function(n){var r=new FormData;t?r.append("file",e):r.append("file",new Blob([e]));fetch("https://api.pinata.cloud/pinning/pinFileToIPFS",{method:"POST",headers:{pinata_api_key:"66a8464d59553776562c",pinata_secret_api_key:"96b4e32f40381e7e062569b89530f28051e00b488ec88bf3aa21c920be109109"},body:r}).then(function(){var e=Object(i.a)(a.a.mark(function e(t){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:r=e.sent,n(r.IpfsHash);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())})},Zd=function(e){for(var t=[],n=new Gd.a.Mp3Encoder(e.length,44100,128),r=e[0],a=e[1],i=0;i<r.length;i+=1152){for(var s=r.subarray(i,i+1152),o=a?a.subarray(i,i+1152):void 0,c=0;c<s.length;c++)s[c]*=32767.5,o&&(o[c]*=32767.5);(u=o?n.encodeBuffer(s,o):n.encodeBuffer(s)).length>0&&t.push(u)}var u;return(u=n.flush()).length>0&&t.push(u),new Blob(t,{type:"audio/mp3"})},Yd=Object(p.a)({"record.mix":function(e,t,n,r){var s=e.sequencerEngine.channelMixer,o=[],c=!1;return function(u){var l=Object(ea.a)(u,1)[0],f=s.recorderWorklet;if(f){var h=n()||30;f.maxChunks=Math.ceil(h/5),t()&&!o.includes(t())&&(t().connect(f),o.push(t())),"pause"===l?c||(console.log("stopping w pause"),f.stop()):"clear"===l?f.clear():0===l?(f.stop(),e.sendMessage(e.outputByNumber(2),yc.a),c=!0,f.getBuffer().then(function(){var t=Object(i.a)(a.a.mark(function t(n){var i,s,o,c;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if(i=f.startSliceTime/W.a.Time("32n").toSeconds(),s=f.silenceLength,e.sendMessage(e.outputByNumber(3),i),e.sendMessage(e.outputByNumber(4),s),0!==n[0].length){t.next=8;break}return t.abrupt("return");case 8:if(!r()){t.next=11;break}return e.sendMessage(e.outputByNumber(2),n),t.abrupt("return");case 11:return t.next=13,Zd(n);case 13:if(o=t.sent,!Wd){t.next=20;break}return t.next=17,Qd(o,!0);case 17:t.t0=t.sent,t.next=23;break;case 20:return t.next=22,Ar.a.addArrayBuffer(o);case 22:t.t0=t.sent;case 23:c=t.t0,e.sendMessage(e.outputByNumber(0),c),e.sendMessage(e.outputByNumber(1),o),e.sendMessage(e.outputByNumber(2),n);case 27:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())):1===l&&f.record()}}},lengthCoord:function(e){return function(e){var t=Object(ea.a)(e,1),n=Object(ea.a)(t[0],2),r=n[0],a=n[1];return Xa([r,a])}},"record.pause":function(e){var t=e.sequencerEngine.channelMixer;return function(e){Object(ea.a)(e,1)[0];var n=t.recorderWorklet;n&&n.stop()}}},Ks,Sc,{"interface.xy":function(e){new Jd(e);return e.width=300,e.height=300,function(e){Object(ea.a)(e,1)[0]}},"interface.multiXY":function(e){new Hd(e);return e.width=300,e.height=300,function(e){Object(ea.a)(e,1)[0]}},"window.size":function(){return function(e){Object(_a.a)(e);var t=document.getElementsByTagName("html")[0],n=[[t.clientWidth,t.clientHeight]];return console.log("WINDOW SIZE RECORDED = ",n),n}}},si,{indexpack:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=void 0;return function(e){var t=Object(ea.a)(e,1)[0];if("clear"===t&&a){var r=new Array(a.length);return r.fill(0),a=r,[r]}var i=n.filter(function(e){return void 0!==e()&&null!==e()}).length;if(t.length===i)return[a=Object(h.a)(t)];var s=Object(ea.a)(t,2),o=s[0],c=s[1];if(!a){a=new Array(i).fill(0);for(var u=0;u<a.length;u++)a[u]=n[u]()}return a[o]=c,[a]}},togglepack:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=void 0;return function(e){var t=Object(ea.a)(e,1)[0];if("clear"===t&&a){var r=new Array(a.length);return r.fill(0),a=r,[r]}var i=n.filter(function(e){return void 0!==e()&&null!==e()}).length;if(t.length===i)return[a=Object(h.a)(t)];var s=Object(ea.a)(t,2),o=s[0],c=s[1];if(!a){a=new Array(i).fill(0);for(var u=0;u<a.length;u++)a[u]=n[u]()}return a[o]?a[o]=0:a[o]=c,[a]}},replacepak:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a;return e.lastMessageReceived=0,function(t){var r=Object(ea.a)(t,1)[0];if(r!==a&&Array.isArray(r))return e.args=Object(h.a)(r),void(a=r);a=r;var i=n.map(function(e){return e()}).filter(function(e){return void 0!==e});return i=i.slice(0,i.length),[Object(h.a)(i)]}}},_s,Ls,$s,Fs,So,lo,Cs,pu,Ss,jo,Ia,La,{concat:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=[];return function(e){if("bang"===e[0])return a;var t=n.map(function(e){return e()}).filter(function(e){return void 0!==e}).flatMap(function(e){return e}),r=e[0]||[];return Array.isArray(r)||(r=[r]),a=[[].concat(Object(h.a)(r),Object(h.a)(t))]}}},Ba,{disablePlay:function(e){return function(t){var n=Object(ea.a)(t,1)[0];e.sequencerEngine.disablePlay=!!n}},"sub.setGlobalSize":function(e){return function(t){var n=Object(ea.a)(t,1)[0],r=Object(ea.a)(n,2),a=r[0],i=r[1],s=e.subSequence;s.getRootSubSequence&&(s=s.getRootSubSequence()),console.log("set global size = ",a,i,s),Uo(s,a,i)}},"canvas.setGlobalSize":function(e){return function(t){var n=Object(ea.a)(t,1)[0],r=Object(ea.a)(n,2),a=r[0],i=r[1],s=e.subSequence;s.getRootSubSequence&&(s=s.getRootSubSequence()),console.log("set canvas global size = ",a,i,s),Go(s,a,i)}},"list.indexOf":function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(!Array.isArray(n))return-1;var r=t();return n.indexOf(r)}},"save.hook":function(e){return function(e){return Object(ea.a)(e,1)[0],"bang"}}},Fa,Ao,{"list.prependIndex":function(e){return function(e){for(var t=Object(ea.a)(e,1)[0],n=[],r=0;r<t.length;r++)Array.isArray(t[r])&&n.push([r].concat(Object(h.a)(t[r])));return[n]}}},Bo,{"list.appendEvery":function(e,t){return function(e){for(var n=Object(ea.a)(e,1)[0],r=[],a=t(),i=0;i<n.length;i++)Array.isArray(n[i])&&(Array.isArray(a)?r.push([].concat(Object(h.a)(n[i]),[a[i]])):r.push([].concat(Object(h.a)(n[i]),[a])));return[r]}},fillArray:function(e,t,n,r){return function(e){for(var a=Object(ea.a)(e,1)[0],i=new Array(r()).fill(0),s=t();s<n();s++)i[s]=a;return[i]}}},di,{listOsc:function(e){var t=void 0,n=void 0,r=void 0;return function(e){var a=Object(ea.a)(e,1)[0];if(a&&(Array.isArray(a)||ArrayBuffer.isView(a))){t&&Math.pow(a.length,2)===t.length||(t=new Uint8Array(Math.pow(a.length,2)),n=new Uint8Array(Math.pow(a.length,2))),r&&t.set(n);for(var i=a.length,s=0;s<a.length;s++){var o=a[s],c=Math.floor(Math.abs(o)*i/2);if(o<0)for(var u=i/2;u>i/2-c;u--)t[u*i+s]=100;else for(var l=i/2;l<i/2+c;l++)t[l*i+s]=100}return r=a,t}}},centerFillArray:function(e,t){return function(e){var n=Object(ea.a)(e,1)[0],r=new Array(t()).fill(0),a=Math.floor(Math.abs(n)*t()/2),i=0;if(n<0)for(var s=t()/2;s>t()/2-a;s--)r[s]=i++/a*100;else for(var o=t()/2;o<t()/2+a;o++)r[o]=i++/a*100;return r}},icon:function(e){new Jo(e);return function(){}},interleavedConcat:function(){var e=[];return function(t){var n=Object(ea.a)(t,1)[0];if(!Array.isArray(n))return[];e.length=0;for(var r=0;r<n[0].length;r++){var a,i=cd(n);try{for(i.s();!(a=i.n()).done;){var s=a.value;e.push(s[r])}}catch(o){i.e(o)}finally{i.f()}}return[e]}},between:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t=Object(ea.a)(e,1)[0];if(t<n[0]()){var r=new Array(n.length).fill(void 0);return r[0]=t,r}for(var a=n.filter(function(e){return e()}).length,i=0;i<a-1;i++){var s=n[i](),o=n[i+1]();if(s<=t&&t<o){var c=new Array(n.length).fill(void 0);return c[i+1]=t,c}}if(t>=n[a-1]()){var u=new Array(n.length).fill(void 0);return u[a]=t,u}}},nameIndex:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t=Object(ea.a)(e,1)[0];return n.map(function(e){return e()}).indexOf(t)}},interleaf:ld,"list.reverse":function(e){return function(e){var t=Object(ea.a)(e,1)[0];return(t=Object(h.a)(t)).reverse(),[t]}},scale:Ns.b,playback:function(e){new su(e);return function(){}},"pad.showSequencer":function(e){return function(t){var n=Object(ea.a)(t,1)[0],r=e.sequencerEngine.currentSubSequence.pads[0];n&&r?e.dispatch(Object(C.Ld)(r)):e.dispatch(Object(C.Ld)(!1))}}},nu,{nth:function(e,t){return function(e){return e[0][t()%e[0].length]}},"document.title":function(){return function(e){var t=Object(ea.a)(e,1)[0];window.document.title=t}},"object.create":function(e,t){return function(e){var n={};return n[t()]=e,[n]}},"list.skipEvery":function(e,t,n){var r=void 0;return function(e){var a=Object(ea.a)(e,1)[0];(new Date).getTime(),console.log("calling skip every ");var i=a.length/t(),s=a.length-i;r||(r=new Uint8Array(s));for(var o=0,c=0;c<a.length;c++)c%t()!==n()&&(r[o++]=a[c]);return(new Date).getTime(),[r]}},"list.isEveryEmpty":function(e,t,n,r){return function(e){for(var a=Object(ea.a)(e,1)[0],i=((new Date).getTime(),r()),s=n(),o=t(),c=0;c<a.length;c++)if(c%o!==s&&a[c]>i)return[0];return(new Date).getTime(),[1]}},"samples.tag":function(e){new Gs(e);return function(){}},"list.ratioBelow":function(e,t,n,r){return function(e){for(var a=Object(ea.a)(e,1)[0],i=((new Date).getTime(),r()),s=n(),o=t(),c=0,u=0,l=0;l<a.length;l++)l%o!==s&&(a[l]<i&&c++,u++);return(new Date).getTime(),c/u}},uniqueAppend:function(e,t){var n=[];return function(e){var r=Object(ea.a)(e,1)[0];"object"!==typeof r[0]&&(r=[r]);var a,i=ql(r);try{for(i.s();!(a=i.n()).done;){for(var s=a.value,o=-1,c=0;c<n.length;c++)s.id===n[c].id&&(o=c);-1===o&&n.length<(t()||1)?n.push(s):n[o]=s,n.length>(t()||1)&&n.shift()}}catch(u){i.e(u)}finally{i.f()}if(n.length===(t()||1))return[n]}},modal:function(e,t,n,r,a,i){return function(s){if(Object(ea.a)(s,1)[0]){var o=void 0,c=a(),u=i();if(Array.isArray(c)){o=[];for(var l=0;l<c.length;l++)o.push({text:c[l],url:u[l]})}else c&&u&&(o={text:c,url:u});e.dispatch(Object(C.We)({zobject:e,text:t(),link:o,okButtonText:n(),cancelButtonText:r()}))}else e.dispatch(Object(C.We)(void 0))}},progressbar:function(e,t){return function(n){Object(ea.a)(n,1)[0]?e.dispatch(Object(C.Xe)(t())):e.dispatch(Object(C.Xe)(void 0))}},centroid:Rf,"erc720.tokenID":function(e){return e.needsLoad=!0,function(t){return Object(ea.a)(t,1)[0],[e.sequencerEngine.tokenID]}},"list.partition":function(e,t){return function(e){for(var n=Object(ea.a)(e,1)[0],r=[],a=[],i=0;i<n.length;i++)a.length>0&&i%t()===0&&a.push(r),r.push(n[i]);return[a]}},messageSplitter:function(e){return function(t){for(var n=Object(_a.a)(t).slice(0),r=0;r<n.length;r++)e.sendMessage(e.outputByNumber(r),n[r])}},"three.planeRenderer":function(e,t){e.needsLoad=!0;var n=new Lh(e.subSequence,e.sequencerEngine,e,"planeRenderer"),r=n.createZObject(0,0,"three.planeGeometry"),a=n.createZObject(0,0,"three.orthographicCamera 0 150 0 150 -1 1"),i=n.createZObject(0,0,"three.scene"),s=n.createZObject(0,0,"three.mesh"),o=n.createZObject(0,0,"three.render");o.connectInlet("camera",a,"Output 1"),o.connectInlet("Input",i,"Output 1"),i.connectInlet("Input",s,"Output 1"),s.connectInlet("geometry",s,"Output 1"),new Fc(n,void 0,function(t){e.lastOutput=t,e.sendMessage(e.outputByNumber(0),t)}).connectInlet("Input",o,"Output 1");var c=void 0;return function(e){var n=Object(ea.a)(e,1)[0];return c!==t()?(c=t(),void i.onInputMessage(c)):"dispose"!==n?"start"===n?(r.bang(),void a.bang()):void(s.args&&n&&(r.bang(),a.bang(),s.lastMessageReceived=[r.geometry],s.onArg(1,[n]))):void 0}}},wo,{messageFilter:function(e,t){return function(e){if(t())return e}}},go,{"haptic.vibrate":function(e){return function(e){var t=Object(ea.a)(e,1)[0];"vibrate"in navigator&&navigator.vibrate(t)}},matrix:function(e){e.updates=0;var t=function(t,n){e.matrix=new Array(n);for(var r=0;r<n;r++)e.matrix[r]=new Array(t).fill(0);e.updates++};return t(5,5),function(n){var r=Object(ea.a)(n,1)[0];if("string"===typeof r){var a=function(e){var t=e.split(" ");return[t[0],t.slice(1).map(function(e){return parseFloat(e)})]}(r),i=Object(ea.a)(a,2),s=i[0],o=i[1];switch(s){case"set":return void(e.matrix[o[1]]&&o[0]<e.matrix[o[1]].length&&(e.matrix[o[1]][o[0]]=o[2],e.updates++));case"values":for(var c=[],u=0;u<e.matrix.length;u++)for(var l=e.matrix[u],f=0;f<l.length;f++)l[f]===o[0]&&c.push([f,u]);return[c];case"closests":for(var h=[],p=e.matrix[o[1]][o[0]],d=0;d<e.matrix.length;d++)for(var v=e.matrix[d],m=0;m<v.length;m++)if(m!==o[0]&&d!==o[1]){var y=v[m];h.push([m,d,Math.abs(y-p)])}return h.sort(function(e,t){return e[2]-t[2]}),[h.map(function(e){var t=Object(ea.a)(e,2);return[t[0],t[1]]})];case"get":if(e.matrix[o[1]])return[e.matrix[o[1]][o[0]]];break;case"init":return void t(o[0],o[1])}}}},globalReverse:function(e){return function(t){var n=Object(ea.a)(t,1)[0];e.sequencerEngine.reverse=!!n}},loop:function(e,t){return function(n){var r=Object(ea.a)(n,1)[0],a=t()||0;0===a&&(r=!1),a=Math.pow(2,a)/8,r?e.sequencerEngine.startNewLoop(a):e.sequencerEngine.looping=!1}},push:function(e,t){var n=[];return function(e){return n.unshift(e[0]),n.length>t()&&n.pop(),[n]}},"gl.material":function(e,t){var n=new Eu(e);e.needsHotReload=!0,e.shader=n,e._effect=void 0,n.onVertexShader("\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(\n    position, \n    1.0 );\n  \n}\n"),Object(Ma.d)("canvas.size",function(n){t=function(){return n},e.refresh()}),Object(Ma.d)("shader.render",function(){e.sendMessage(e.outputByNumber(0),n.material)});var r=Au(e),a=0;return function(i){var s=Object(ea.a)(i,1)[0];if("bang"!==s){if(s.code){var o=t()||Object(Ma.c)("canvas.size");Array.isArray(o)||(o=[300,300]),Array.isArray(o[0])&&(o=o[0]);var c=o,u=Object(ea.a)(c,2),l=u[0],f=u[1];s.uniforms.width={value:l},s.uniforms.height={value:f},s.uniforms.offset_v={value:window.offset_v||0};var h=r(s,n);if(h!==n.fragmentShader&&!e.sequencerEngine.isLoading&&!window.stopGLCompile){var p=++a;setTimeout(function(){if(p===a){Mu(n.fragmentShader,h);console.log("COMPILING uni=%s iteration=%s",Object.keys(s.uniforms).length,Tu++),window.compiledCode=h,window.compiledUniforms=s.uniforms,n.onFragmentShader(h),e.lastOutput=n.material,e.sendMessage(e.outputByNumber(0),n.material)}},50)}}}else e.sendMessage(e.outputByNumber(0),n.material)}},vec3:function(e){var t=new zc(e);return e.needsLoad=!0,function(){t.sendObject()}},vec2:function(e){var t=new Hc(e);return e.needsLoad=!0,function(){t.sendObject()}},buttonPresser:function(e){new Ec(e);return e.newAttribute("button-color","#ffffff"),e.width=50,e.height=50,function(){}},groups:function(e){new lu(e);return function(){}}},Xc,{select:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){for(var t=0;t<n.length;t++){var r=n[t]();if(Bd(r,e[0])){var a=new Array(n.length).fill(void 0);return a[t]=e,a}}}}},hu,Nl,{attributes:function(e){var t=new gu(e);return e.needsLoad=!0,function(e){return Object(ea.a)(e,1)[0],t.loadBang(),[]}}},$l,{varz:function(e){return new bo(e),function(){}},toggle:function(e){var t=new Xl(e);return e.needsLoad=!0,e.width=50,e.height=50,function(e){var n=Object(ea.a)(e,1)[0];"start"===n&&t.onInput(n)}},sparseList:function(e,t,n,r,a,i){return function(e){var s=Object(ea.a)(e,1)[0],o=n()||100;Array.isArray(o)||(o=[o]);var c=r()||1,u=a()||[0],l=Math.round(t()*c);if(!isNaN(l)){var f,p=(i()?Object(h.a)(i()):void 0)||new Array(l).fill(0),d=cd(s);try{for(d.s();!(f=d.n()).done;){var v,m=f.value,y=0,b=cd(u);try{for(b.s();!(v=b.n()).done;){var g=v.value;p[parseInt(m)*c+g]=o[y%o.length],y++}}catch(O){b.e(O)}finally{b.f()}}}catch(O){d.e(O)}finally{d.f()}return[p]}}},singleSparseList:function(e,t,n,r,a){return function(e){var i=Object(ea.a)(e,1)[0],s=r()||1,o=a()||[0];Array.isArray(o)||(o=[o]);var c=Math.round(t()*s);if(!isNaN(c)){var u,l=new Array(c).fill(0),f=cd(i);try{for(f.s();!(u=f.n()).done;){var h,p=u.value,d=cd(o);try{for(d.s();!(h=d.n()).done;){var v=h.value;l[parseInt(p)*s+v]=n()}}catch(m){d.e(m)}finally{d.f()}}}catch(m){f.e(m)}finally{f.f()}return[l]}}},smokeColors:function(e){var t;return function(e){var n=Object(ea.a)(e,1)[0];t||(t=new Float32Array(3*n.length));for(var r=0;r<n.length;r++){var a=Math.min(1,10*n[r]);t[3*r]=a,t[3*r+1]=a,t[3*r+2]=a}return[t]}},submix:function(e){new Dl(e);return function(){}},mixbuttons:function(e){new Ll(e);return function(){}},loadBang:function(e){return e.needsLoad=!0,function(){return["bang"]}},startBang:function(e){return e.needsStart=!0,function(){return console.log("start bang called"),["bang"]}},average:function(e){return function(e){var t=Object(ea.a)(e,1)[0],n=0;if(!t)return 0;for(var r=0;r<t.length;r++)n+=t[r];return n/t.length}},roll:function(e){new zl(e);return function(){}},macro:function(e){var t=new yf(e);return e.needsLoad=!0,function(e){Object(ea.a)(e,1)[0],t.sendMessage("value changed",t.value)}},mouseSDF:function(e,t,n,r,a){return function(e){var i=Object(ea.a)(e,1)[0],s=t(),o=n(),c=r()||0,u=a();if(o&&u&&s&&i){var l=[(2*i[0]-u[0])/u[1],(2*i[1]-u[1])/u[1]];l=[l[0]-s[0],l[1]-s[1]];var f=[Math.abs(l[0])-o[0]+c,Math.abs(l[1])-o[1]+c];return Math.min(Math.max(f[0],f[1]),0)+Math.sqrt(Math.pow(Math.max(0,f[0]),2)+Math.pow(Math.max(0,f[1]),2))-c}}},triangulate:function(e,t){return function(e){var n=e[0];if(n&&t())return[Object(rp.c)(n,t())]}},print:function(){return function(e){var t=Object(ea.a)(e,1)[0];return console.log(t)}},averageDistance:function(e,t){return function(e){var n=Object(ea.a)(e,1)[0],r=t(),a=0;if(!n||!r)return 0;for(var i=0;i<n.length;i+=2){var s=n[i],o=n[i+1],c=r[i],u=r[i+1];a+=Math.sqrt(Math.pow(s-c,2)+Math.pow(o-u,2))}return a/(n.length/2)}},dpad:function(e){var t=new sf(e);return e.effect=t,function(){}},system5:function(e){return e.effect=new Vl(e),function(){}},sampleBank:function(e){return e.effect=new Wl(e),function(){}},drawTriangles:function(e,t){return function(n){var r=n[0],a=t()||"#ffffff";e.sendMessage(e.outputByNumber(0),"drawTriangles",a,r)}},jrepl:function(e){new hf(e);return function(){}},cirklon:function(e){return e.effect=new cf(e),function(){}},patterns:function(e){return e.effect=new lf(e),function(){}},store:function(e,t){return function(n){var r=Object(ea.a)(n,1)[0];if("clear"===r&&(e.args[0]=void 0),"bang"===r){if(void 0===t())return;return[t()]}}},drawArray:function(e,t,n){return function(r){var a=r[0],i=t()||2,s=n()||"#ffffff";e.sendMessage(e.outputByNumber(0),"drawArray",i,s,a)}},polygonsToMeshes:function(e,t){var n=[],r=[],a=[],i=[];return function(s){var o=Object(ea.a)(s,1)[0];if(o){var c,u=0,l=[],f=hd(o);try{var h=function(){var e=c.value,s=ld(0,0,2)([e]),o=np()([e]);i[u]=o&&o[0];var f=u;n[u]||(n[u]=$f(0,void 0,function(){return i[f]}));var h=n[u](s);if(h){a[u]||(a[u]=Qf(0,function(){return t()}));var p=a[u](h);p&&(l.push(p[0]),r.push(p[0]))}u++};for(f.s();!(c=f.n()).done;)h()}catch(b){f.e(b)}finally{f.f()}var p,d=[],v=[],m=hd(r);try{for(m.s();!(p=m.n()).done;){var y=p.value;l.includes(y)?v.push(y):d.push(y)}}catch(b){m.e(b)}finally{m.f()}return r=v,e.sendMessage.apply(e,[e.outputByNumber(0),"remove"].concat(d)),[l]}}},triangle:function(e,t,n,r){return function(a){var i=a[0],s=t(),o=n();i&&s&&o&&(e.sendMessage(e.outputByNumber(0),"triangle ".concat(i.x," ").concat(i.y," ").concat(s.x," ").concat(s.y," ").concat(o.x," ").concat(o.y)),e.sendMessage(e.outputByNumber(0),"fill ".concat(r())))}},synthcontrol:function(e){var t=new wu(e);return e.needsLoad=!0,function(){t.sendADSRLevels(),t.sendOscillatorLevels()}},switch:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a,i;return function(e){var t=Object(ea.a)(e,1)[0]-1;if(n[t]){var r=n[t]();if(a!==t||i!==r)return i=r,a=t,[r];i=r,a=t}}},outSwitch:function(e,t){return function(e){var n=Object(ea.a)(e,1)[0],r=t(),a=new Array(r).fill(void 0);return a[r-1]=n,a}},dedupe:function(e){var t;return e.needsStart=!0,function(e){var n=Object(ea.a)(e,1)[0];if("start"!==n)return n!==t?(t=n,[n]):void 0;t=void 0}},"message.rateLimit":function(e,t){var n=0,r=void 0;return function(e){var a=Object(ea.a)(e,1)[0],i=(new Date).getTime(),s=i-i%1e3;if(s!==r&&(n=0,r=s),n<t())return n++,[a]}},messageFilterLazy:function(e,t){return function(e){if(t())return e}},jpolygons:function(e){return e.width=280,e.height=280,function(e){var t=Object(ea.a)(e,1)[0];if(t.some(function(e){return e.needsUpdate})){t.forEach(function(e){return e.needsUpdate=!1}),t=t.filter(function(e){return e.inUse||e.lastUsed<1});for(var n=[],r=void 0,a=0;a<t.length;a++)for(var i=t[a].cycle,s=r||Math.max(10,133-24*a),o=i,c=o.length,u=0;u<o.length;u++){var l=o[u];Array.isArray(l)&&(l=l[0]);var f=ad(140,u,c,i,s,{x:140,y:140},l),h=Object(ea.a)(f,2),p=h[0],d=h[1];if(d&&n.push(d),p&&(r=p),l.type&&"-"===l.type.type&&0===l.type.value){var v=id(140,l,u,s,i,c);v&&n.push(v)}}return[n]}}},jhits:function(e,t){var n=[];return function(e){var r=e[0]&&e[0][1];if(r){var a=t();if(a){var i=od(a),s=[];r.length>0&&r.map(function(e){return 6-e.outputNumber});var o,c=[],u=nd(n);try{for(u.s();!(o=u.n()).done;){var l=o.value,f=l.x,h=l.y,p=l.duration;p-=.5,l.duration=p,p>0&&(s.push(f),s.push(h),c.push(l))}}catch(k){u.e(k)}finally{u.f()}n=c;var d,v=nd(r);try{for(v.s();!(d=v.n()).done;){var m=d.value,y=m.outputNumber-1,b=sd(m.stepData.leafNumber,{x:140,y:140},i[y],a[y].cycle,!0),g=b.x,O=b.y;s.push(g),s.push(O),n.push({x:g,y:O,duration:m.stepData.duration})}}catch(k){v.e(k)}finally{v.f()}return Float32Array.from(s)}}}},jclock:function(e){var t=new ks.w({color:16777215}),n=[];return function(e){var r=Object(ea.a)(e,1)[0];if(r){for(var a=od(r),i=0;i<r.length;i++)for(var s=r[i],o=s.cycle.flat(16),c=0;c<o.length;c++){var u=o[c];if(s.currentCycles&&s.currentCycles[u.id]){var l=sd(c,{x:140,y:140},a[i],o).deg,f=new ks.p(140,140,a[i],a[i],1.5*Math.PI,l,!1,0).getSpacedPoints(c);if(n[i])n[i].geometry.setFromPoints(f),n[i].geometry.attributes.position.needsUpdate=!0;else{var h=(new ks.h).setFromPoints(f),p=new ks.v(h,t);n[i]=p}break}}return[n]}}},ztracker:function(e){return e.effect=new Ql(e),function(){}},coords:function(e,t){return function(e){return{x:e[0],y:t()}}},rasterTriangle:function(e,t,n,r){return function(e){var a=e[0];if(a&&t()&&n()&&r())return[Object(ap.b)([a,t(),n()],Math.max(5,r()))]}},tidal:function(e){e.needsTick=!0;var t=new Zl.a(e.subSequence,void 0,e);t.subSequence=e.subSequence,e.effect=t;var n=new F.a;return n.loadDefaults(),n.velocity=.5,n.duration=1e6,function(r){var a=Object(_a.a)(r),i=a[0],s=a.slice(1);switch(i){case"restart":break;case v.n:var o=Object(ea.a)(s,2),c=o[0],u=o[1];if(t.onNewStep(c,u),0===c){var l=new Ve.a(n,u,c);t.input(l)}var f=t.output(u,c,c);f.forEach(function(e){e.stepData.time=e.time,e.stepData.stepNumber=e.stepNumber,e.outputNumber=1}),f.forEach(function(t){var n=t.stepData;e.sendMessage(e.outputByNumber(0),n)})}}},outputNumber:function(e,t){return function(e){var n=Object(ea.a)(e,1)[0];if(n[0]===v.p){var r=n[1];return r=r.map(function(e){return Object(p.a)({},e,{outputNumber:t()||1})}),[[v.p,r]]}}},rasterTriangles:function(e,t){return function(e){var n=t()||4,r=e[0];if(r&&n){var a=function(){for(var e=[],t=0;t<r.length;t+=6){var a=r.slice(t,t+6);Object(ap.b)(a,Math.max(1,n)).forEach(function(t){return e.push(t)})}return{v:[e]}}();if("object"===typeof a)return a.v}}},metro:function(e,t){return e.needsTick=!0,function(e){return v.a}},syncedMetro:function(e,t){return e.needsTick=!0,function(t){var n=Object(ea.a)(t,3),r=n[0],a=(n[1],n[2]);"tick"===r&&up(function(){e.sendMessage(e.outputByNumber(0),v.a)},1e3*(a-W.a.Master.context.currentTime))}},setInterval:function(e,t){var n=window.setInterval(function(){e&&e.function&&e.bang()},80);return function(e){if("dispose"!==e[0])return v.a;clearInterval(n)}},setTimeout:up,setIntervalFast:function(e,t){var n=window.setInterval(function(){e&&e.function&&e.bang()},15);return function(e){if("dispose"!==e[0])return v.a;clearInterval(n)}},lconcat:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=[];return function(e){if("bang"===e[0])return a;var t=n.map(function(e){return e()}).filter(function(e){return void 0!==e}).flatMap(function(e){return e}),r=e[0]||[];return Array.isArray(r)||(r=[r]),a=[[].concat(Object(h.a)(r),Object(h.a)(t))]}},jsnapshot:function(e){new rf(e);return function(){}},counter:function(e,t,n){var r=0,a=1;return e.needsStart=!0,e.setAttribute("Send min on load",!0,function(e){}),function(e){var i=Object(ea.a)(e,2),s=i[0],o=i[1];switch(s){case v.k:return void(r=t());case"Direction":return void(a=o);case"Reset":return[r=t()]}return(r+=a)>=n()?[r=t()+r-n(),"bang"]:r}},simpleCounter:function(e,t,n,r){var a=void 0;return function(e){void 0===a&&(a=t()||0);var i=Object(ea.a)(e,2),s=i[0],o=i[1];switch(s){case"decrement":return--a<n()&&(a=n()),[a];case"increment":return++a>r()&&(a=r()),[a];case"value":return[a=o]}return a}}},xf,{canvas:function(e){var t=new Hh(e);return e.effect=t,e.width=300,e.height=300,function(){}}},ep,eh,Jf,tp,Lf,Pf,Zf,Wf,{script:function(e){var t=new wf(e);return t.width=350,t.height=350,e.effect=t,e.needsLoad=!0,function(){t.code=t.code}},float32Array:function(e){return function(e){var t=Object(ea.a)(e,1)[0];return[Float32Array.from(t)]}},map:function(e,t){var n;return function(t){var r=Object(ea.a)(t,2),a=(r[0],r[1]);if(a&&(Array.isArray(a)||ArrayBuffer.isView(a))){var i=e.inlets.fn;if(i){var s=i.connections[0].sourceNode;if(ArrayBuffer.isView(a)){n||(n=new Float32Array(a.length));for(var o=0;o<a.length;o++){var c=a[o],u=s.evaluateAsFunction?s.evaluateAsFunction(c,o):s.function([c]);n[o]=u}}else n=a.map(function(e,t){return s.evaluateAsFunction?s.evaluateAsFunction(e,t):s.function([e])});return[n]}}}},spline:function(e,t,n){var r,a=void 0,i=[];return function(e){var s=Object(ea.a)(e,1)[0];if(ArrayBuffer.isView(s)||Array.isArray(s)){i.length=0;for(var o=0;o<s.length;o+=2)i.push(new ks.cb(s[o],s[o+1],0));a?(a.tension=t()||1,a.points=i):a=new ks.i(i,!0,"catmullrom",t()||1);var c=a.getPoints(n()||150),u=0;r&&2*c.length===r.length||(r=new Float32Array(2*c.length));var l,f=Bf(c);try{for(f.s();!(l=f.n()).done;){var h=l.value;r[u++]=h.x,r[u++]=h.y}}catch(p){f.e(p)}finally{f.f()}return r}return[r]}},convexHull:function(){return function(e){var t=Object(ea.a)(e,1)[0];return[Object(Ef.a)(t)]}},smokeVertices:function(e,t,n){var r;return function(e){var n=Object(ea.a)(e,1)[0],a=t()||300,i=t()||300;return r||(r=new Float32Array(new Array(n.length).fill(0).flatMap(function(e,t){var n=t%66;return[a*(n/64),i*((t-n)/66/64),0]})))}},flattenList:function(e){return function(e){var t=Object(ea.a)(e,1)[0];if(Array.isArray(t))return[t.flat(16)]}},cList:function(e,t){return function(e){for(var n=Object(ea.a)(e,1)[0],r=[],a=0;a<n.length;a+=t())r.push(a/t());return[Float32Array.from(r)]}},listMax:function(e){return function(e){var t=Object(ea.a)(e,1)[0];return[Math.max.apply(Math,Object(h.a)(t))]}},pack:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t=n.map(function(e){return e()}).filter(function(e){return void 0!==e});return t=t.slice(0,t.length-1),[[].concat(Object(h.a)(e),Object(h.a)(t))]}},packFull:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t=n.map(function(e){return e()}).filter(function(e){return void 0!==e});if(!(t=t.slice(0,t.length-1)).some(function(e){return!e}))return[[].concat(Object(h.a)(e),Object(h.a)(t))]}},pak:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t=n.map(function(e){return e()}).filter(function(e){return void 0!==e});return t=t.slice(0,t.length-1),[[].concat(Object(h.a)(e),Object(h.a)(t))]}},nft:function(e){var t=new fp(e);return e.effect=t,e.needsNFT=!0,function(e){switch(Object(ea.a)(e,1)[0]){case v.e:t.startUp();break;default:t.execute()}}},append:function(e,t){var n=[];return function(e){if("bang"===e[0])return[n];for(n.push(e[0]);n.length>t();)n.shift();return[n]}},appendList:function(e,t){var n=[];return function(e){Array.isArray(e[0])||(e[0]=[e[0]]);var r,a=cd(e[0]);try{for(a.s();!(r=a.n()).done;){var i=r.value;n.push(i)}}catch(s){a.e(s)}finally{a.f()}for(;n.length>t();)n.shift();return[n]}},pad:function(e){var t=new Od(e);return t.zObject=e,e.effect=t,e.width=201,e.height=227,e.needsStart=!0,e.needsLoad=!0,function(t){Object(ea.a)(t,1)[0],e.effect.pad&&(e.effect.pad.onSizeChange(e.width,e.height),e.effect.pad.sendTags())}},unpack:function(e){return function(e){return ArrayBuffer.isView(e[0])?Array.from(e[0]):e[0]}},subpatch:function(e,t){var n=new Lh(e.subSequence,e.sequencerEngine,e,t);return e.effect=n,e.isSubPatch=!0,function(){}},instancedSubpatch:function(e){var t=new Sd(e.subSequence,e.sequencerEngine,e);return e.effect=t,e.isSubPatch=!0,function(){}},split:function(e,t,n){return function(e){return e=e[0],t()<=e&&e<=n()?[e]:[void 0,e]}},jgrid:function(e){var t=new Yp(e.subSequence,e);return e.width=322,e.height=246,e.effect=t,e.needsLoad=!0,function(e){var n=Object(_a.a)(e),r=n[0];switch(n.slice(1),r){case v.k:t.calculateRules()}}},jtypes:function(e){new $p(e);return e.width=220,e.height=134,function(){}},track:function(e,t){var n=t()-1,r=e.subSequence;r.getRootSubSequence&&(r=r.getRootSubSequence());var a=r.tracks[n%r.tracks.length];return a?(e.id=a.id,e.width=80,e.height=80,a&&(e.effect=a,a.zObject=e),e.needsStart=!0,e.newAttribute("show-sequencer",!1),e.newAttribute("send-levels",!1,function(e){return a.sendLevels(e)}),e.newAttribute("level-smoothness",.9,function(e){return a.trackMeter.smoothness=e}),e.newAttribute("volume pattern-locked",!0),function(n){var a=t()-1,i=r.tracks[a];i&&(e.effect=i,i.zObject=e)}):function(){}},comment:function(e){var t=new jd(e);e.sequencerEngine.state.sequencer.backgroundColor;return e.attributes["font-size"]="10",e.attributes["primary-color"]="transparent",e.attributes["secondary-color"]="#ffffff",e.width=100,e.height=25,e.effect=t,function(){}},delaunay:function(e){var t;return function(e){var n=Object(ea.a)(e,1)[0];if(n&&Array.isArray(n)&&!n.some(function(e){return!Object(pe.a)(e)})){t?t=new Tf.a(n):(n.forEach(function(e,n){return t.coords[n]=e}),t.update());for(var r=[],a=0;a<t.triangles.length;a+=3){var i=[t.triangles[a],t.triangles[a+1],t.triangles[a+2]];r.push(n[2*i[0]]),r.push(n[2*i[0]+1]),r.push(n[2*i[1]]),r.push(n[2*i[1]+1]),r.push(n[2*i[2]]),r.push(n[2*i[2]+1])}return[r]}}},delaunayIndex:np,dHull:function(e,t){var n,r,a,i=[];return function(e){var s=Object(ea.a)(e,1)[0];if(s){n&&n.coords.length===s.length?(n.coords.set(s,0),n.update()):n=new Tf.a(s);var o=n.hull,c=s.length/2-o.length;a&&a.length===2*c||(a=new Float32Array(2*c)),qf(s,o,a),r&&r.coords.length===a.length?(r.coords.set(0,a),r.update()):r=new Tf.a(a);var u=r.hull;_f(s,a,o,u);var l,f=Math.min(t()||0,u.length),h=f+o.length,p=new Float32Array(2*h),d=0,v=Af(o);try{for(v.s();!(l=v.n()).done;){var m=l.value;p[d++]=s[2*m],p[d++]=s[2*m+1]}}catch(L){v.e(L)}finally{v.f()}var y=Rf()([s]),b=Object(ea.a)(y,1),g=Object(ea.a)(b[0],2),O=g[0],k=g[1],j=0;i.length=0;var w,x=Af(o);try{for(x.s();!(w=x.n()).done;){var S=w.value,P=s[2*S],E=s[2*S+1],T=Object(jn.a)(Math.atan2(E-k,P-O),2*Math.PI);i.push(T)}}catch(L){x.e(L)}finally{x.f()}d=0;var A,M=Af(u);try{for(M.s();!(A=M.n()).done;){var R=A.value;if(++d>f)break;var C=[a[2*R],a[2*R+1]],N=C[0],q=C[1],I=Object(jn.a)(Math.atan2(q-k,N-O),2*Math.PI),_=Nf(i,I,p,N,q);void 0!==_||(Math.PI,void 0!==(_=Nf(i,I,p,N,q)))?(i.splice(_,0,I),If(p,2*_,0,N,q)):j++}}catch(L){M.e(L)}finally{M.f()}if(j>0){for(var D=new Float32Array(p.length-2*j),F=0;F<p.length/2-j;F++)D[2*F]=p[2*F],D[2*F+1]=p[2*F+1];return D}return[p]}}},zl:function(e,t){var n=[];return function(e){e=e[0];var r=t();"string"===typeof e&&(r=e),n=e[0];var a=Object(h.a)(n);switch(r){case"rev":return[a.reverse()]}}},get:function(e,t){return function(e){if(null!==e[0][t()]&&void 0!==e[0][t()])return[e[0][t()]]}},set:function(e,t,n){return function(e){return e[0][t()]=n(),[n()]}},"object.keys":function(e){return function(e){var t=Object(ea.a)(e,1)[0];return[Object.keys(t)]}},"object.builder":function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){for(var t=n.map(function(e){return e()}).filter(function(e){return void 0!==e}),r={},a=0;a<t.length-1;a+=2){var i=t[a],s=t[a+1];r[i]=s}return[r]}}},cp,Ld,_d,{list:function(){return function(e){return[[Object(ea.a)(e,1)[0]]]}},sublist:function(e,t,n){return function(e){var r=Object(ea.a)(e,1)[0];if(Array.isArray(r))return[r.slice(t(),n())]}}},Fd,Mc,{sparseMerge:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){var t,r=Object(ea.a)(e,1)[0],a=n.map(function(e){return e()}).filter(function(e){return void 0!==e}),i=[],s=cd([r||[]].concat(Object(h.a)(a)));try{for(s.s();!(t=s.n()).done;)for(var o=t.value,c=0;c<o.length;c++)o[c]&&(i[c]=o[c])}catch(u){s.e(u)}finally{s.f()}return[i]}}},Ad,Yc,Po,{boundFilter:function(e,t,n){return function(e){var r=Object(ea.a)(e,1)[0];if(Math.abs(r[0])<t()&&Math.abs(r[1])<n())return[r]}}},ri,ti,Wo,pp,Ka,Za,{"tr.loop":function(e,t,n,r){return function(a){var i=Object(ea.a)(a,1)[0],s=e.sequencerEngine.tracks[Math.round(t()||0)];s&&(s.loopStart=n()||0,s.loopLength=r()||8,s.isLooping=!!i)}},"tr.loopUI":function(e){new Ua(e);return function(e){Object(ea.a)(e,1)[0]}},"abi.encode":function(e){return function(e){var t,n=Object(ea.a)(e,1)[0];return[(t=new Ja.a(new Ja.a.providers.HttpProvider("https://mainnet.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")).eth.abi).encodeParameter.apply(t,Object(h.a)(n))]}}}),Xd=n(419);function $d(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ev(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ev(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ev(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function tv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function nv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function rv(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return av(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return av(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function av(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function iv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var sv=Hn.a.presets,ov=function(e){Object(u.a)(n,e);var t=iv(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this)).arr=[],r.preset=new at.a,r.id=Object(S.uuid)(),r.subSequence=e,r.sequencerEngine=e.sequencerEngine,r.sequencerEngine.idToObject[r.id]=Object(c.a)(r),r.counter=0,r.text="",r.name="",r.args=[],r.function=void 0,r.mutations=new Array(16).fill(!1),r.window={id:Object(S.uuid)()},r.newInlet("Input",function(e){r.onInputMessage(e)}),r.newAttribute("primary-color"),r.newAttribute("secondary-color"),r.newAttribute("border-radius"),r.newAttribute("Include in Presentation",!1),r.newAttribute("scripting name"),r.newAttribute("hot inlets",!1),r}return Object(o.a)(n,[{key:"getObjectType",value:function(){return ua.e}},{key:"getInstrumentType",value:function(){return"zobject."+this.name}},{key:"getAllParameters",value:function(){return this.effect?this.effect.getParameters():[]}},{key:"effect",get:function(){return this._effect},set:function(e){this._effect=e;var t,n={},r=rv(e.getParameters());try{for(r.s();!(t=r.n()).done;){var a=t.value;n=Object(p.a)({},n,a.setStore(this.sequencerEngine.store))}}catch(i){r.e(i)}finally{r.f()}this.sequencerEngine.store.dispatch(Object(C.ub)(n))}},{key:"bang",value:function(){this.onInputMessage([v.a])}},{key:"getJson",value:function(e){var t={id:this.id,text:this.text,width:this.width,height:this.height},n=this.getAttributesJson();if(n&&(t.attributes=n),this.plugin&&(t.plugin=this.plugin),this.effect&&(t.effect=this.effect&&this.effect.getJson(e)),this.height&&(t.height=this.height),this.width&&(t.width=this.width),this.mutations.some(function(e){return e})){var r=Object(h.a)(this.mutations);r.reverse();var a=r.indexOf(!0);t.mutations=this.mutations.slice(0,r.length-a)}return t}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i={};if(t||(this.id=e.id,this.sequencerEngine.idToObject[this.id]=this),i[e.id]=this.id,n||(this.text=e.text),e.mutations){this.dependencies=e.mutations;for(var s=this.dependencies.length;s<16;s++)this.dependencies.push(!1)}if(e.attributes)for(var o in e.attributes)this.setAttribute(o,e.attributes[o]);return this.effect&&e.effect&&(i=Object(p.a)({},i,this.effect.fromJson(e.effect,t,n,r,a)),t&&!this.effect.zObjects&&(this.effect.id=Object(S.uuid)(),i[e.effect.id]=this.effect.id),this.sequencerEngine.idToObject[this.effect.id]=this.effect),e.width&&e.height&&(this.width=e.width,this.height=e.height),e.plugin&&(this.plugin=e.plugin),i}},{key:"isHot",get:function(){return this.attributes["hot inlets"]},set:function(e){this.setAttribute("hot inlets",e)}},{key:"onNewFunction",value:function(e,t){var n=this;this.name=e,this.registerTypes(e);var r=Object(Ca.a)(e),a=r.outlets,i=r.isHot,s=r.inlets;this.isHot=i,this.defaultAttributes["hot inlets"]=!0;var o=1,c=!1;a&&(Array.isArray(a)?(o=a.length,c=!0):o=a(t.length));var u=Object.keys(this.outlets).length;if(u>o){for(var l=u-1;l>o-1;l--)this.deleteOutlet(this.outputByNumber(l,!0),!1);this.updateMessagingRedux()}else if(u<o)for(var f=u;f<o;f++)this.newOutlet(c?a[f]:this.outputByNumber(f,!0));if(void 0!==s)if(Array.isArray(s)){for(var p in this.inlets)s.includes(p)||this.deleteInlet(p);var d,v=rv(s);try{var m=function(){var e=d.value;if(n.inlets[e])return"continue";n.newInlet(e,function(t){n.onInputMessage([e].concat(Object(h.a)(t)))})};for(v.s();!(d=v.n()).done;)m()}catch(y){v.e(y)}finally{v.f()}}else if("function"===typeof s)s=Math.max(0,s(t.length)),this.onNewArgs(new Array(Math.max(0,s-1)).fill(0));else if(this.onNewArgs(new Array(Math.max(0,s-1)).fill(0)),0===s)return!0}},{key:"onNewArgs",value:function(e){var t=this,n=Object.keys(this.inlets);if(this.previousArgs=Object(h.a)(this.args),this.args=e,this.mutations=new Array(16).fill(!1),n.length<=e.length)for(var r=function(e){t.newInlet(e,function(n){return t.onArg(e,n)})},a=n.length;a<=e.length;a++)r(a);else if(n.length>e.length)for(var i=n.length;i>e.length;i--)this.deleteInlet(i)}},{key:"onArg",value:function(e,t){this.previousArgs=Object(h.a)(this.args),this.args[e-1]=t[0],this.mutations[e-1]=!0,this.isHot&&void 0!==this.lastMessageReceived&&this.onInputMessage(this.lastMessageReceived)}},{key:"refresh",value:function(){this.sequencerEngine.isLoading||(this.onInputMessage(this.lastMessageReceived||v.a),this.effect&&this.effect.refresh&&this.effect.refresh())}},{key:"needsTick",get:function(){return this._needsTick},set:function(e){this._needsTick=e,this.sequencerEngine.tickingObjects.push(this)}},{key:"onInputMessage",value:function(e){if(!this._disposed&&this.function)if(e&&"clearAllMessages"===e[0]){this.lastMessageReceived=0;for(var t=0;t<this.args.length;t++)this.args[t]=void 0}else{if(this.dependencies&&this.isHot&&!this.needsLoad)for(var n=0;n<this.dependencies.length;n++)if(this.dependencies[n]&&!this.mutations[n])return this.wasSuppressed=!0,void(this.lastMessageReceived=e);Array.isArray(e)||(this.arr[0]=e,e=this.arr),this.lastMessageReceived=e;var r=this.function(e);if(void 0!==r){if(this.storeOutputType(r),this.lastOutput=r,!Array.isArray(r))return void this.sendMessage(this.outputByNumber(0),r);for(var a=0;a<r.length;a++){var i=r[a];if(void 0!==i){this.outputByNumber(a);this.sendMessage(this.outputByNumber(a),i)}}}}}},{key:"outputByNumber",value:function(e,t){var n="Output "+(e+1);return this.outlets[n]||t?n:Object.keys(this.outlets)[e]}},{key:"sendMessageToInlet",value:function(e){this.onInputMessage(e)}},{key:"loadPresetJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=this.id;this.sequencerEngine.bulkConnections={},this.sequencerEngine.dispatch(Object(C.ac)(this.sequencerEngine.sequenceId,!0));var i=this.fromJson(e,!0,t,n,r);if(this.id=a,e.windowPositions&&e.inletConnections){this.dispatch(Object(C.M)(bh(i,e.windowPositions))),e.presentationPositions&&this.dispatch(Object(C.L)(bh(i,e.presentationPositions))),this.sequencerEngine.checkSubPatchInstances(i);var s=gh(i,e.inletConnections);for(var o in this.sequencerEngine.loadInletConnectionsForId(s),this.sequencerEngine.checkInstanceConnections(),this.effect&&this.effect.zObjects&&this.effect.loadBangZObjects(),this.sequencerEngine.dispatch(Object(C.ac)(this.sequencerEngine.sequenceId,!1)),this.sequencerEngine.bulkConnections){var c=this.state.windows.inletConnections[o]||{};this.dispatch(Object(C.Hb)(o,Object(p.a)({},c,this.sequencerEngine.bulkConnections[o])))}console.log("FINISHED YALL"),this.sequencerEngine.compile(),this.sequencerEngine.groups.sendVolumes()}else this.sequencerEngine.dispatch(Object(C.ac)(this.sequencerEngine.sequenceId,!1))}},{key:"position",get:function(){return this.state.windows.windowPositions[this.id]}},{key:"delete",value:function(){var e=this;this.isDeletable()&&(this.subSequence.deleteNode(this),this.effect&&this.effect.dispose&&this.effect.dispose(),this.state.plugins.pluginsLoaded&&this.state.plugins.pluginsLoaded.includes(this)&&this.dispatch(Object(C.Pc)(this.state.plugins.pluginsLoaded.filter(function(t){return t!==e}))))}},{key:"duplicate",value:function(){var e=this.getPresetJson(),t=this.state.windows.windowPositions[this.id],n=t.x,r=t.y,a=this.width||200,i=(this.width,this.subSequence.createZObject(n+a,r));i.loadPresetJson(e);var s=this.state.windows.presentationWindowPositions[this.id];s&&this.dispatch(Object(C.Rc)(i.id,{x:s.x+a,y:s.y}))}},{key:"loadPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.preset=new at.a(t.title,t.contentHash,t.user,t.blockNumber),e.next=3,sv.getPresetData(t);case 3:n=e.sent,this.loadPresetJson(n,void 0,!0);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPresetJson",value:function(){var e=this,t=this.getJson(!0);if(!(this.effect&&this.effect.zObjects))return t;var n={},r=this.getAllInnerObjects();r.forEach(function(t){var r=t.id;return n[r]=e.state.windows.windowPositions[r]});var a={};r.forEach(function(t){var n=t.id;return a[n]=e.state.windows.presentationWindowPositions[n]});var i,s=this.state.windows.inletConnections[this.effect.id],o=rv(r);try{for(o.s();!(i=o.n()).done;){var c=i.value;c.effect&&c.effect.zObjects&&(s=Object(p.a)({},s,this.state.windows.inletConnections[c.effect.id]))}}catch(u){o.e(u)}finally{o.f()}return Object(p.a)({},t,{inletConnections:s,windowPositions:n,presentationPositions:a})}},{key:"getAllInnerObjects",value:function(){if(this.effect&&this.effect.zObjects){var e=this.effect;return[].concat(Object(h.a)(e.zObjects),Object(h.a)(e.zMessages),Object(h.a)(e.zObjects.flatMap(function(e){return e.getAllInnerObjects()})))}return[]}},{key:"disposeMessaging",value:function(){this._disposed=!0,this.function,Object(ne.a)(Object(f.a)(n.prototype),"disposeMessaging",this).call(this)}},{key:"isDeletable",value:function(){return!this.effect||!this.effect.isDeletable||this.effect.isDeletable()}},{key:"flash",value:function(){if(!window.stopGLCompile){var e=this.state.zobject.viewableSubPatches;if(this.subSequence.getRootSubSequence){if(!e||e[e.length-1]!==this.subSequence)return}else;this.subSequence.hasInstances||this.sequencerEngine.isLoading||this.dispatch(Object(C.Ue)(this.id,(new Date).getTime()))}}},{key:"hotReload",value:function(){Object(Xd.a)(this)}},{key:"hide",value:function(){this.dispatch(Object(C.Fe)(this.id,!0))}},{key:"isHidden",get:function(){return this.state.spatial.hiddenObjects[this.id]}},{key:"isLocked",get:function(){return this.state.spatial.lockedObjects[this.id]}}]),n}(Object(Ye.a)(Iu.a,function(e){return function(e){Object(u.a)(n,e);var t=Ra(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).subscribedFunctions=[],e}return Object(o.a)(n,[{key:"subscribeArgs",value:function(e){for(var t=this,n=function(n){var r=e[n];if(t.subscribedFunctions[n]){var a=Object(ea.a)(t.subscribedFunctions[n],2),i=a[0],s=a[1];Object(Ma.e)(i,s)}if("string"===typeof r&&r.startsWith(":")){t.subscribedFunctions[n]=[r.slice(1),function(e){t.onArg(n+1,[e])}],Object(Ma.d)(r.slice(1),t.subscribedFunctions[n][1]);var o=Object(Ma.c)(r.slice(1));o&&o[0]&&t.subscribedFunctions[n][1](o[0])}},r=0;r<e.length;r++)n(r)}}]),n}(e)},_c.a,function(e){return function(e){Object(u.a)(n,e);var t=nv(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).actions={},e}return Object(o.a)(n,[{key:"newAction",value:function(e,t){this.actions[e]=t}},{key:"executeAction",value:function(e){this.actions[e]()}}]),n}(e)},Ic,va,Aa.a,function(e){return function(e){Object(u.a)(n,e);var t=tv(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"text",get:function(){return this._text},set:function(e){var t=this;this._text=e;var n=e.split(" ").filter(function(e){return" "!==e&&""!==e}),r=n[0];if(Yd[r]){var a=this.args,i=this.name!==r,s=(this.name,Yd[r]),o=this.parseArgs(n.splice(1)),c=this.onNewFunction(r,o);a===this.args&&(this.previousArgs=Object(h.a)(this.args)),this.subscribeArgs(o),this.args=Object(h.a)(o);var u=new Array(16).fill(void 0).map(function(e,n){return function(){return t.args[n]}});i?(this.dependencies=void 0,this.function=s.apply(void 0,[this].concat(Object(h.a)(u))),this.registerName(this.name,r),"preset"===r&&Object(Ma.b)("preset.new")):this.previousArgs=this.args,c&&this.deleteInlet("Input"),this.needsLoad&&!this.sequencerEngine.isLoading&&this.onInputMessage(["start"]),this.needsHotReload&&!this.sequencerEngine.isLoading&&Object(Xd.b)(this),this.subSequence.propagate(Object(Cc.v)(this,e))}else this.function=void 0}},{key:"isValid",value:function(){return void 0!==this.function}},{key:"parseArgs",value:function(e){var t,n=[],r=$d(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;a&&a.startsWith&&a.startsWith("0x")?n.push(a):Object(pe.a)(a)?n.push(parseFloat(a)):n.push(a)}}catch(i){r.e(i)}finally{r.f()}return n}},{key:"registerName",value:function(e,t){var n=this,r=this.sequencerEngine.nameToObjects;r[t]||(r[t]=[]),r[t].push(this),r[e]&&(r[e]=r[e].filter(function(e){return e!==n}))}}]),n}(e)})(function(){return function e(){Object(s.a)(this,e)}}()));function cv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var uv=n(902),lv=n(361);function fv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function hv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function pv(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return dv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dv(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function dv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function vv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var mv=-40,yv=9;function bv(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=(e=Math.min(Math.max(0,e),r))/r;return t+(n-t)*Math.pow(a,1/window.ROOTY)}window.ROOTY=3;var gv=function(e){Object(u.a)(n,e);var t=vv(n);function n(e){var r,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(s.a)(this,n),(r=t.call(this)).subSequence=e,r.sequencerEngine=e.sequencerEngine,r.id=Object(S.uuid)(),r.sequencerEngine.idToObject[r.id]=Object(c.a)(r),r.tracks=new Array(yv).fill(!1),a&&r.createEffectRack(),r.newInlet(v.q,function(e){return r.onTrigger(e)}),r.newInlet("live trigger",function(e){var t=Object(ea.a)(e,1)[0];return r.onLiveTrigger(t)}),r.newInlet("live release",function(e){var t=Object(ea.a)(e,1)[0];return r.onLiveRelease(t)}),r.newInlet("slider values",function(e){return r.onSliderValues(e)}),r.newInlet("set enabled",function(e){var t=Object(ea.a)(e,1)[0];return r.setTracksEnabled(t)}),r.newOutlet("pads playing"),r.newOutlet("notes playing"),r.newOutlet("size"),r.newOutlet("slider levels"),r.newOutlet("mouse downs"),r.newOutlet("effect added"),r.isPad=!0,r}return Object(o.a)(n,[{key:"onLiveTrigger",value:function(e){var t=this.tracks[e];t&&t.midiEffects.liveInputTrigger(new F.a(t),t)}},{key:"onLiveRelease",value:function(e){var t=this.tracks[e];t&&t.midiEffects.liveInputRelease(0,0,t)}},{key:"onChangePadsCount",value:function(e){if(!isNaN(e))if(e>this.tracks.length){var t=new Array(e-this.tracks.length).fill(!1);this.tracks=[].concat(Object(h.a)(this.tracks),Object(h.a)(t))}else{for(var n=e;n<this.tracks.length;n++)this.tracks[n]&&this.removeTrack(this.tracks[n]);this.tracks=this.tracks.slice(0,e)}}},{key:"padFXMode",get:function(){return this.state.pads.padFXMode[this.id]||Ta.a},set:function(e){var t,n=pv(this.tracks);try{for(n.s();!(t=n.n()).done;){var r=t.value;r&&r.outputTypeParameter.set(e)}}catch(a){n.e(a)}finally{n.f()}this.dispatch(Object(C.sc)(this.id,e))}},{key:"getObjectType",value:function(){return ua.b}},{key:"onSlots",value:function(e){e=e[0],this.slotsMapping=e}},{key:"onTrigger",value:function(e){if((e=e[0])&&e[1]){var t,n={},r=pv(e[1]);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=a.outputNumber-1;this.slotsMapping&&void 0!==this.slotsMapping[i]&&(i=this.slotsMapping[i]);var s=this.slots[i];if(s){var o=a=Object(p.a)({},a),c=o.stepData,u=o.time,l=o.stepNumber;n[s.id],n[s.id]=!0,a.outputNumber=0,(c=s.midiEffects.getStep(c)).track=s,s.midiEffects.input(c,u,l),s.midiEffects.receivedTriggers=s.midiEffects.inputedTriggers}}}catch(f){r.e(f)}finally{r.f()}}}},{key:"onChoke",value:function(e){e=parseFloat(e[0]),isNaN(e)||(this.choking=2*e)}},{key:"onNewStep",value:function(){this.choking--}},{key:"slots",get:function(){return this.tracks}},{key:"containsSample",value:function(e){return this.tracks.filter(function(e){return!e.isFrozen}).find(function(t){return t&&t.sample===e})}},{key:"switch",value:function(e,t){var n=this.tracks[e],r=this.tracks[t];this.tracks[e]=r,this.tracks[t]=n,this.updateRedux()}},{key:"removeTrack",value:function(e){for(var t in this.tracks)this.tracks[t]===e&&(this.tracks[t]=!1);e.pad=void 0,this.updateRedux(),this.onTrackRemoved(e)}},{key:"slotTracks",get:function(){return this.tracks.filter(function(e){return e})}},{key:"patternLength",get:function(){return Math.max.apply(Math,Object(h.a)(this.slotTracks.filter(function(e){return e.pattern}).map(function(e){return e.pattern.length()})))}},{key:"addTrack",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e){e.changeOutputType(this.padFXMode),this.slots[t]&&this.deleteTrack(this.slots[t]);var n=Object(h.a)(this.tracks);n[t]=e,this.tracks=n,e.pad&&e.pad.removeTrack(e),e.pad=this,this.updateRedux(),this.onTrackAdded(e),this.sendTags()}}},{key:"newSample",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sequencerEngine.addSound(t,void 0,void 0,void 0,void 0,void 0,!1);case 2:return r=e.sent,this.addTrack(r,n),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateRedux",value:function(){this.tracks=Object(h.a)(this.tracks),this.dispatch(Object(C.uc)(this.id,this.tracks))}},{key:"deleteTrack",value:function(e){var t=this.slots.indexOf(e);-1!==t&&(this.slots[t]=!1,e.pad=!1,this.updateRedux())}},{key:"getJson",value:function(){return{id:this.id,tracks:this.tracks.map(function(e){return!1===e?e:e.trackNumber}),x:this.x,name:this.name,y:this.y,padFXMode:this.padFXMode,fxMacroValue:this.fxMacro.macroParameter.get(!0),fxMacro:this.fxMacro.macroParameter.getJson()}}},{key:"getParameters",value:function(){return this.getAllParameters()}},{key:"getAllParameters",value:function(){return this.fxMacro&&this.effectRack?[this.fxMacro.macroParameter].concat(Object(h.a)(this.effectRack.getParameters())):[]}},{key:"getJsonForPack",value:function(){var e,t=[],n=pv(this.tracks);try{for(n.s();!(e=n.n()).done;){var r=e.value;r?r.sample?t.push({type:"SAMPLE",contentHash:r.sample.getId(),preset:this.sequencerEngine.getTrackPreset(r.trackNumber)}):r.preset&&r.preset.contentHash?t.push({type:"PRESET",contentHash:r.preset.contentHash,preset:this.sequencerEngine.getTrackPreset(r.trackNumber)}):t.push(!1):t.push(!1)}}catch(a){n.e(a)}finally{n.f()}return t.fx=this.effectRack.getJson(),t}},{key:"fromJson",value:function(e){e.id&&(this.id=e.id,this.sequencerEngine.idToObject[this.id]=this);var t=0,n=[];Array.isArray(e)?n=e:(n=e.tracks,this.x=e.x,this.y=e.y),void 0===e.fxMacroValue?this.createEffectRack():this.linkEffectRackContext();for(var r=0;r<n.length;r++){var a=n[r];if(!1!==a){var i=this.subSequence.tracks[parseFloat(a)];this.addTrack(i,t)}t++}this.fxMacroValue=e.fxMacroValue,this.fxMacroJson=e.fxMacro,e.fx&&this.effectRack.fromJson(e.fx),e.padFXMode&&(this.padFXMode=e.padFXMode),this.name=e.name}},{key:"deletePad",value:function(){var e=this;if(this.subSequence.deletePad(this),this.sequencerEngine.sends.sends){var t=this.sequencerEngine.sends.sends.filter(function(t){return t.pad===e});this.sequencerEngine.sends.deleteSends(t)}}},{key:"sendPadMessages",value:function(e){for(var t=this,n=[],r=[],a=this.state.tracks.triggers,i=0;i<this.slots.length;i++){var s=this.slots[i];if(s){var o=[],c=a[s.trackNumber];if(c)for(var u in c){if(c[u])o=s.currentStepDatas?s.currentStepDatas.map(function(e){return e.transpose}):[],n.push(1);else;}if(s.notesTriggered&&Object.keys(s.notesTriggered).length>0){if(s.isFrozen){n.push(1),r.push(o);continue}var l=s.lastPlayedStepData?s.lastPlayedStepData.duration:1,f=s.lastPlayedStepData?s.lastPlayedStepData.velocity:1;o=s.currentStepDatas?s.currentStepDatas.map(function(e){return e.transpose}):[],n.push(Math.max(0,f*(1+Math.max.apply(Math,Object(h.a)(Object.values(s.notesTriggered)))/l)))}else n.push(0);r.push(o)}else n.push(0),r.push([])}n.length<12&&(n=[].concat(Object(h.a)(n),Object(h.a)(new Array(12-n.length).fill(0)))),r.length<12&&(r=[].concat(Object(h.a)(r),Object(h.a)(new Array(12-r.length).fill(0)))),e?setTimeout(function(){t.sendMessage("pads playing",n),t.sendMessage("notes playing",r)},1e3*(e-W.a.Master.context.currentTime)-10):(this.sendMessage("pads playing",n),this.sendMessage("notes playing",r),console.log("sending notes playing"))}},{key:"onSizeChange",value:function(e,t){this.sendMessage("size",[e,t])}},{key:"sendTags",value:function(){var e,t=[],n=pv(this.slots);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r){var a=r.sample;t.push(Object(Ea.a)(r,a))}else t.push("")}}catch(i){n.e(i)}finally{n.f()}this.sendMessage("track types",t)}},{key:"mouseDown",value:function(e,t){var n=new Array(this.slots.length).fill(0);n[e]=t?1:0,this.sendMessage("mouse downs",n)}},{key:"sendSliderLevels",value:function(){var e,t=[],n=pv(this.slots);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r){var a=r.volumeParameter.get(!0);t.push(a<mv?0:Math.pow((a-mv)/(0-mv),window.ROOTY))}else t.push(0)}}catch(i){n.e(i)}finally{n.f()}this.sendMessage("slider levels",t)}},{key:"onSliderValues",value:function(e){for(var t=Object(ea.a)(e,1)[0],n=0;n<t.length;n++){var r=t[n],a=this.slots[n];if(a){var i=bv(r,mv,0,1);a.volumeParameter.get(!0)!==i&&a.setVolume(i,!1,!1)}}}},{key:"onAddEffectMessage",value:function(e){var t=this.effectRack,n=t.effects.find(function(t){return t.name===e.name});t.isCollapsed=!0,n?this.sendMessage("effect added",n):(this.addRackEffect(e),this.sendMessage("effect added",e)),this.dispatch(Object(C.sb)(this.effectRack.id,!0))}},{key:"setTracksEnabled",value:function(e){Array.isArray(e)||(e=""===e?[]:[e]);var t,n=0,r=pv(this.tracks);try{for(r.s();!(t=r.n()).done;){var a=t.value;a&&(e.includes(n)?a.disabled=!1:a.disabled=!0),n++}}catch(i){r.e(i)}finally{r.f()}}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=Pa(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).operationsMap={},e}return Object(o.a)(n,[{key:"registerOperations",value:function(e,t){this.operationsMap[e]=t}},{key:"onOperation",value:function(e,t){var n=this.operationsMap[e];if(n){var r=t.split(" "),a=r[0],i=r.slice(1).map(function(e){return Object(pe.a)(e)?parseFloat(e):e}),s=n[a];s&&s.apply(void 0,[this].concat(Object(h.a)(i)))}}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=cv(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).sliderCanvases={},e.sliderMeshes={},e.sliderPlanes={},e.sliderCameras={},e.sliderRenderers={},e}return Object(o.a)(n,[{key:"onSliderMaterial",value:function(e){for(var t in this.sliderMaterial=e,this.sliderMeshes){var n=this.sliderMeshes[t];if(n)if(0===n.inlets[1].connections.length){var r=this.inlets["sliders material"].connections[0].sourceNode;this.sliderMeshes[t].connectInlet("1",r,"Output 1"),this.sliderPlanes[t].bang(),this.sliderCameras[t].bang()}else this.sliderRenderers[t].onInputMessage(this.sliderRenderers[t].lastMessageReceived)}}},{key:"newZObject",value:function(e){var t=new ov(this.subSequence);return t.text=e,t}},{key:"newSliderRenderer",value:function(e){var t=this.newZObject("three.planeGeometry"),n=this.newZObject("three.scene"),r=this.newZObject("three.mesh"),a=this.newZObject("three.orthographicCamera 0 150 0 150 -1 1"),i=this.newZObject("three.render");i.connectInlet("1",a,"Output 1"),i.connectInlet("Input",n,"Output 1"),n.connectInlet("Input",r,"Output 1"),r.connectInlet("Input",t,"Output 1");var s=this.newZObject("three.canvas");return s.effect.connectInlet("operation",i,"Output 1"),a.bang(),this.sliderPlanes[e]=t,this.sliderMeshes[e]=r,this.sliderCanvases[e]=s,this.sliderCameras[e]=a,this.sliderRenderers[e]=i,s}},{key:"freeSliderRenderer",value:function(e){this.sliderMeshes[e]=void 0,this.sliderCanvases[e]=void 0}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=hv(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"initShaderBackground",value:function(){var e=this;this.scene=new ov(this.subSequence),this.scene.text="three.scene",this.render=new ov(this.subSequence),this.render.text="three.render",this.canvas=new ov(this.subSequence),this.canvas.text="three.canvas",this.camera=new ov(this.subSequence),this.camera.text="three.orthographicCamera 0 201 0 227 -1 1",this.render.connectInlet("camera",this.camera,"Output 1"),this.render.connectInlet("Input",this.scene,"Output 1"),this.canvas.effect.connectInlet("operation",this.render,"Output 1"),this.camera.bang(),this.newInlet("background scene",function(t){e.showCanvas=!0,e.scene.onInputMessage(t)})}}]),n}(e)}(Object(Aa.a)(function(e){return function(e){Object(u.a)(n,e);var t=fv(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"createEffectRack",value:function(){this.send=this.sequencerEngine.sends.createNewSend(this);var e=Object(ba.b)("Effect Rack",this.sequencerEngine);e.pad=this,e.context=(new V.a).forSubSequence(this.subSequence),this.effectRack=e,this.send.addEffect(e),this.fxMacro=new lv.a("Pad Send",this.sequencerEngine,(new V.a).forSubSequence(this.subSequence)),this.fxMacro.macroParameter.isAlwaysLocked=!0}},{key:"linkEffectRackContext",value:function(){this.effectRack&&(this.effectRack.pad=this,this.effectRack.registerContext((new V.a).forSubSequence(this.subSequence)))}},{key:"effects",get:function(){return this.effectRack?this.effectRack.effects:[]}},{key:"effectsChain",get:function(){return this.effectRack}},{key:"sendNumber",get:function(){return this.sequencerEngine.sends.sends.indexOf(this.send)}},{key:"addRackEffect",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=Object(ne.a)(Object(f.a)(n.prototype),"addRackEffect",this)).call.apply(e,[this].concat(r)),this.updateEffectRedux()}},{key:"updateEffectRedux",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(h.a)(this.effectRack.effects);this.dispatch(Object(C.rc)(this.id,e))}},{key:"onTrackAdded",value:function(e){this.fxMacro&&this.fxMacro.addParameter(e.sendNodeVolumeParameters[this.sendNumber],0,1)}},{key:"syncTracksToEffects",value:function(){var e=this;this.fxMacro=new lv.a("Pad Send",this.sequencerEngine,(new V.a).forSubSequence(this.subSequence)),this.fxMacro.macroParameter.isAlwaysLocked=!0,void 0!==this.fxMacroValue&&this.fxMacro.macroParameter.set(this.fxMacroValue),this.fxMacroJson&&this.fxMacro.macroParameter.fromJson(this.fxMacroJson,this.sequencerEngine),this.tracks.filter(function(e){return e}).forEach(function(t){return e.onTrackAdded(t)}),this.linkEffectRackContext()}},{key:"onTrackRemoved",value:function(e){this.fxMacro&&(this.fxMacro.unmapParameter(e.sendNodeVolumeParameters[this.sendNumber],!1),e.sendNodeVolumeParameters[this.sendNumber].set(0))}}]),n}(e)}(Object(uv.a)(va(function(){return function e(){Object(s.a)(this,e)}}()))))))));function Ov(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return kv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kv(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function kv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function jv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wv=n(9),xv=n(878);function Sv(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Pv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Pv(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Pv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ev(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Tv=function(e){Object(u.a)(n,e);var t=Ev(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this)).subSequence=e,r.sequencerEngine=e.sequencerEngine,r.id=Object(S.uuid)(),r.tracks=[],r.type=xv.a,r}return Object(o.a)(n,[{key:"dispose",value:function(){this.tracks.forEach(function(e){return e.sequencer=void 0}),this.subSequence.removeSequencer(this)}},{key:"fromJson",value:function(e){var t=this;this.id=e.id,this.x=e.x,this.y=e.y,e.width&&e.height&&(this.width=e.width,this.height=e.height);var n,r=Sv(e.tracks);try{var a=function(){var e=n.value,r=t.subSequence.tracks.find(function(t){return t.id===e});r&&t.addTrack(r)};for(r.s();!(n=r.n()).done;)a()}catch(i){r.e(i)}finally{r.f()}}},{key:"getJson",value:function(){return{id:this.id,x:this.x,y:this.y,width:this.width,height:this.height,tracks:this.tracks.map(function(e){return e.id})}}},{key:"removeTrack",value:function(e){this.tracks=this.tracks.filter(function(t){return t!==e}),e.sequencer=void 0,this.updateRedux()}},{key:"addTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.tracks.length;this.tracks.includes(e)||(e.sequencer=this,this.tracks[t]=e,this.updateRedux())}},{key:"updateRedux",value:function(){this.tracks=Object(h.a)(this.tracks),this.dispatch(Object(C.Dd)(this.id,this.tracks))}}]),n}(va(function(){return function e(){Object(s.a)(this,e)}}()));function Av(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Mv(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Rv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rv(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Rv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Cv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Nv=["A","B","C","D","E","F","G","H","I","J","K","L","M","N"],qv=function(e){Object(u.a)(n,e);var t=Cv(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(s.a)(this,n),(r=t.call(this)).sequencerEngine=e,r.store=e.store,r.isTrack=a,r.id=Object(S.uuid)(),r.groups=new oa(e.channelMixer,e.sends,e,Object(c.a)(r)),r.lfosTrack=new Nn(e,Object(c.a)(r)),r.envelopesTrack=new Bn(e,Object(c.a)(r)),r.tracks=[],r.mix=new xa.a(e,Object(c.a)(r)),r.setAutomationToShow(wv.i),r.midiEffects=new wa(Object(c.a)(r),e),r.playhead=new ma.a(Object(c.a)(r)),r.playhead.registerContext((new V.a).forSubSequence(Object(c.a)(r))),r.subSequence=Object(c.a)(r),r.trackData=new F.a(e,r.mix,(new V.a).forSubSequence(Object(c.a)(r))),r.trackData.loadDefaults(),r.initColor(),r.higherRolling=void 0,r.initPattr(),r}return Object(o.a)(n,[{key:"state",get:function(){return this.sequencerEngine.state}},{key:"getEffectNumber",value:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.midiEffects.getEffectNumber(e):0}},{key:"moveMidiEffectTo",value:function(e,t){this.midiEffects.moveEffectTo(e,t)}},{key:"name",get:function(){var e=this.sequencerEngine.subSequences.indexOf(this);return Nv[e]}},{key:"linearRampFade",value:function(e,t,n){this.tracks.forEach(function(r){return r.linearRampFade(e,t,n)})}},{key:"presentationMode",get:function(){return this.state.spatial.presentationMode[this.id]},set:function(e){this.dispatch(Object(C.Qc)(this.id,e))}},{key:"fade",set:function(e){e=e||0,this.fadeVolume!==e&&(this.muted||this.tracks.forEach(function(t){return t.fade=e}),this.store.dispatch(Object(C.be)(this.id,e)))}},{key:"mute",set:function(e){var t=e?0:this.fadeVolume;this.tracks.forEach(function(e){return e.fade=t}),this.store.dispatch(Object(C.ce)(this.id,e))}},{key:"disposeParameters",value:function(){this.lfos.forEach(function(e){return e.lfo.disposeParameters()}),this.envelopes.forEach(function(e){return e.disposeParameters()})}},{key:"dispose",value:function(){this.pads.forEach(function(e){return e.deletePad()}),this.tracks.forEach(function(e){return e.dispose()}),this.groups.dispose(),this.tracks=void 0,this.groups=void 0,this.envelopes.forEach(function(e){return e.dispose()}),this.lfos.forEach(function(e){return e.lfo.dispose()}),this.lfosTrack=void 0,this.envelopesTrack=void 0}},{key:"addTrack",value:function(e){e.subSequence=this,this.tracks.push(e),this.isTrack&&this.groups.addTrack(e)}},{key:"setId",value:function(e){this.id=e,e+1}},{key:"channelMixer",get:function(){return this.sequencerEngine.channelMixer}},{key:"sends",get:function(){return this.sequencerEngine.sends}},{key:"lfos",get:function(){return this.lfosTrack.lfos}},{key:"length",get:function(){var e,t=-1,n=Mv(this.tracks);try{for(n.s();!(e=n.n()).done;){var r=e.value.length;r>=t&&(t=r)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"envelopes",get:function(){return this.envelopesTrack.envelopes.map(function(e){return e.envelope})}},{key:"fadeVolume",get:function(){return this.store.getState().mix.subSequenceFades[this.id]||1}},{key:"setAutomationToShow",value:function(e){this.store.dispatch(Object(C.w)(this.id,e))}},{key:"volumeAutomationMix",get:function(){return this.mix.mixesByType[wv.l]}},{key:"loopStart",get:function(){return this.store.getState().arrangement.selection.start}},{key:"looping",get:function(){return this.store.getState().arrangement.selection.start}},{key:"updateVolumeFromAutomation",value:function(e){var t=this.volumeAutomationMix.getValueAtStep(e,this.fadeVolume);this.looping&&e===this.loopStart?(this.mix.restart(),this.fade=t):this.fadeVolume!==t&&this.store.dispatch(Object(C.be)(this.id,t))}},{key:"getJson",value:function(){return{id:this.id,isTrack:this.isTrack,playhead:this.playhead.getJson(),color:this.color,pattr:this.pattr.getJson()}}},{key:"fromJson",value:function(e){this.id=e.id,void 0!==e.isTrack&&(this.isTrack=e.isTrack),e.playhead&&this.playhead.fromJson(e.playhead),e.color?this.color=e.color:this.initColor(),this.pattr.fromJson(e.pattr)}},{key:"getAllParameters",value:function(){return[].concat(Object(h.a)(this.playhead.parameters),Object(h.a)(this.midiEffects.getAllParameters()),Object(h.a)(this.pads.flatMap(function(e){return e.getAllParameters()})))}},{key:"getAllEffects",value:function(){return[].concat(Object(h.a)(this.midiEffects.effects),Object(h.a)(this.pads.flatMap(function(e){return void 0===e.effectRack?[]:e.effectRack.effects})))}},{key:"newPattern",value:function(){if(0!==this.tracks.length){var e=this.tracks[0].patterns.length,t=this.tracks[0].currentPattern,n=this.getAllEffects();n.forEach(function(t){return t.locked&&t.lockPattern(e,!0)});var r=n.flatMap(function(e){return e.getParameters()}),a=this.pads.map(function(e){return e.fxMacro.macroParameter.get()});r.forEach(function(n){return n.newPattern(t,e)}),this.pads.forEach(function(e,t){return e.fxMacro.macroParameter.set(a[t])})}}},{key:"insideInstance",value:function(){return!1}},{key:"propagate",value:function(){}},{key:"isRoot",value:function(){return!0}}]),n}(Object(fa.a)(function(e){return function(e){Object(u.a)(n,e);var t=la(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"loadSubPatch",value:function(e){var t=this;return new Promise(function(n){Object(ca.b)(void 0,"zobject.subpatch",[],0,void 0,!1).then(function(r){var a=r.find(function(t){return t.title.includes(e)});if(a){var i=t.createZObject(1,1,"subpatch",!1);i.loadPreset(a),i.isUI=!0,console.log("setting isUI =",i),n(i)}})})}}]),n}(e)}(Nh(function(e){return function(e){Object(u.a)(n,e);var t=Av(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"newZObject",value:function(){return new ov(this)}}]),n}(e)}(Object(ha.a)(Object(pa.a)(va(function(e){return function(e){Object(u.a)(n,e);var t=Ev(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).sequencers=[],e}return Object(o.a)(n,[{key:"createSequencer",value:function(){var e=new Tv(this);return this.sequencers=[].concat(Object(h.a)(this.sequencers),[e]),this.updateRedux(),e}},{key:"removeSequencer",value:function(e){this.sequencers=this.sequencers.filter(function(t){return t!==e}),this.updateRedux()}},{key:"deleteTrackFromSequencers",value:function(e){this.sequencers.filter(function(t){return t.tracks.includes(e)}).forEach(function(t){return t.removeTrack(e)})}},{key:"getSequencersJson",value:function(){return this.sequencers.map(function(e){return e.getJson()})}},{key:"loadSequencersJson",value:function(e){if(e){var t,n=Sv(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.createSequencer().fromJson(r)}}catch(a){n.e(a)}finally{n.f()}}}},{key:"updateRedux",value:function(){this.dispatch(Object(C.Ed)(this.id,this.sequencers))}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=jv(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).pads=[],e}return Object(o.a)(n,[{key:"schedulePads",value:function(){this.pads.forEach(function(e){return e.onNewStep()})}},{key:"sendPadMessages",value:function(e){this.pads.forEach(function(t){return t.sendPadMessages(e)})}},{key:"loadPackAsPads",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i){var s,o,c,u,l,f,h,p,d,v;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s=r||this.createPad(),o=[],s.packHash=i,c=0;case 4:if(!(c<t.length)){e.next=32;break}if(u=t[c]){e.next=8;break}return e.abrupt("continue",29);case 8:if(o.push(c),console.log(u),l=r&&r.slots[c]&&r.slots[c].getTrackType(),f=u.preset.trackData.trackType,!r||!r.slots[c]||l===f){e.next=20;break}return h=r.slots[c].trackNumber,r.removeTrack(r.slots[c]),this.sequencerEngine.deleteTrack(h),e.next=18,this.sequencerEngine.loadTrackPreset(u.preset,void 0,!0);case 18:p=e.sent,s.addTrack(p,c);case 20:if(!r||!r.slots[c]){e.next=25;break}return e.next=23,this.sequencerEngine.auditionPreset({data:u.preset},r.slots[c].trackNumber,void 0,!0,!1);case 23:e.next=29;break;case 25:return e.next=27,this.sequencerEngine.loadTrackPreset(u.preset,void 0,!0);case 27:d=e.sent,s.addTrack(d,c);case 29:c++,e.next=4;break;case 32:for(v=0;v<r.slots.length;v++)r.slots[v]&&!o.includes(v)&&this.sequencerEngine.deleteTrack(r.slots[v].trackNumber);n&&(s.effectRack.fromJson(n,void 0,void 0,!0),s.updateEffectRedux());case 34:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"deletePad",value:function(e){this.pads=this.pads.filter(function(t){return t!==e}),e.slotTracks.forEach(function(e){return e.pad=void 0}),this.updateRedux()}},{key:"deleteTrackFromPads",value:function(e){var t=this.pads.find(function(t){return t.slots.includes(e)});t&&t.deleteTrack(e)}},{key:"createPad",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=new gv(this,t),a=0===this.pads.length;if(n){var i=this.createZObject(5,5,"pad");if(i.effect.linkPad(r),this.state.samples.droppedSamples){var s=this.state.samples.droppedSamples;console.log("droppped samples =",s),s>9&&i.setAttribute("Number of Pads",s)}}if(this.pads=[].concat(Object(h.a)(this.pads),[r]),e){var o,c=0,u=Ov(this.tracks);try{for(u.s();!(o=u.n()).done;){var l=o.value;l.pad||r.addTrack(l,c++),c>=9&&(c=0,r=new gv(this),this.pads=[].concat(Object(h.a)(this.pads),[r]))}}catch(f){u.e(f)}finally{u.f()}}return this.updateRedux(),a&&!this.sequencerEngine.isOffline&&this.dispatch(Object(C.Ld)(r)),r}},{key:"checkPads",value:function(){var e,t=this.findNodeByName("pad",!0).map(function(e){return e.effect.pad}),n=Ov(this.pads);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(!t.includes(r)){var a=this.state.windows.windowPositions[r.id]||{x:0,y:0};this.createZObject(a.x,a.y,"pad").effect.linkPad(r)}r.sendSliderLevels()}}catch(i){n.e(i)}finally{n.f()}}},{key:"updateRedux",value:function(){this.dispatch(Object(C.vc)(this.id,this.pads))}},{key:"getPadsJson",value:function(){return this.pads.map(function(e){return e.getJson()})}},{key:"loadPadsJson",value:function(e){if(e){var t,n=Ov(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.createPad(void 0,!1,!1).fromJson(r)}}catch(a){n.e(a)}finally{n.f()}}}},{key:"addTrackToPadIfPossible",value:function(e){var t=void 0,n=void 0;if(this.state.spatial.showPadSequencer)!0===(t=this.state.spatial.showPadSequencer)&&(t=this.pads[0]),-1===(n=t.tracks.indexOf(!1))&&(t=void 0);else{var r,a=Ov(this.pads);try{for(a.s();!(r=a.n()).done;){var i=r.value,s=i.tracks.indexOf(!1);s>-1&&!i.tracks.includes(e)&&(n=s,t=i)}}catch(c){a.e(c)}finally{a.f()}}if(t)t.addTrack(e,n,!0);else if(this.state.sequencer.viewMode===Sa.b){var o=this.createPad();this.dispatch(Object(C.Pe)(o.id,{x:5,y:5})),o.addTrack(e,0,!0),this.sequencerEngine.selectTrack(e.trackNumber)}}}]),n}(e)}(function(){return function e(){Object(s.a)(this,e)}}())))))))))),Iv=n(897);n(917);function _v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Dv=function(){function e(){Object(s.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"name",type:"bytes32"}],name:"syncClockMaster",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"name",type:"bytes32"}],name:"syncClockSlave",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"",type:"address"},{indexed:!0,name:"",type:"bytes32"},{indexed:!1,name:"index",type:"bytes32"}],name:"ClockSyncMaster",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"",type:"address"},{indexed:!0,name:"",type:"bytes32"},{indexed:!1,name:"index",type:"bytes32"}],name:"ClockSyncSlave",type:"event"}],this.contractAddress="0x17eafcd1dc39c8d78ff165e1dbd0fe9e82afbdc2"}return Object(o.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),Fv=n(72),Lv=n(77);function Bv(e){return new Promise(function(t){var n=new Blob([new Uint8Array(e)]),r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsText(n)})}function zv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Jv=n(1774),Vv=(Hn.a.web3,function(e){Object(u.a)(n,e);var t=zv(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this)).sequencerEngine=e,r.store=r.sequencerEngine.store,r.contract=(new Dv).getContract(Hn.a.web3),r.listeningForClockSyncs=!1,r.connected=!1,r.isInitial=!0,r.userToSignal={},r}return Object(o.a)(n,[{key:"setClockType",value:function(e){this.store.dispatch(Object(C.S)(e)),this.initiator=e===Fv.a,this.clockType=e,e!==Fv.b&&(this.setupWebRTC(),this.listeningForClockSyncs!==e&&this.listenForClockSyncs(e))}},{key:"retry",value:function(){this.setupWebRTC()}},{key:"startListening",value:function(){this.connected?console.log("is connected"):this.listenForClockSyncs(Fv.c)}},{key:"stopListening",value:function(){this.timer&&clearInterval(this.timer)}},{key:"listenForClockSyncs",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.timer&&clearInterval(this.timer),this.listeningForClockSyncs=t,this.isInitial||this.store.dispatch(Object(C.Y)(Lv.d)),e.next=5,$r.a.getAccount();case 5:n=e.sent,this.listenCallback(t,n),this.timer=setInterval(function(){r.listenCallback(t,n)},1e4);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"listenCallback",value:function(e,t){var n=this,r=e===Fv.a?Fv.c:Fv.a;fetch("/getClockUsers/"+r+"/"+t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(){var r=Object(i.a)(a.a.mark(function r(i){var s,o,c,u,l,f;return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!n.connected){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,i.json();case 4:s=r.sent,o=[],r.t0=a.a.keys(s);case 7:if((r.t1=r.t0()).done){r.next=20;break}if(c=r.t1.value,(u=s[c].userId)!==t){r.next=12;break}return r.abrupt("continue",7);case 12:return l=s[c].signal,r.next=15,Hn.a.users.getUserName(u);case 15:f=r.sent,e===Fv.a?(n.signal(l),n.store.dispatch(Object(C.X)(f))):u in n.userToSignal||(o.push(f),n.store.dispatch(Object(C.H)(o))),n.userToSignal[u]=l,r.next=7;break;case 20:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}())}},{key:"syncToUser",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.isInitial=!1,this.setClockType(Fv.c),this.signal(this.userToSignal[t]),e.next=5,Hn.a.users.getUserName(t);case 5:n=e.sent,this.userToConnectTo=t,this.store.dispatch(Object(C.X)(n));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setupWebRTC",value:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(t,n){e.connected=!1,e.peer=new Jv({reconnectTimer:1e3,channelConfig:{maxRetransmits:5,reliable:!1,ordered:!1},initiator:e.initiator,trickle:!1}),e.peer.on("error",function(t){console.log(t),e.connected=!1,e.retry()}),e.peer.on("signal",function(t){return e.onSignal(t)}),e.peer.on("connect",function(){e.connected=!0,e.store.dispatch(Object(C.Y)(Lv.c)),e.tellServerWeConnected(),clearInterval(e.timer)}),e.peer.on("data",function(t){return e.onMessageFromPeer(t)}),e.peer.on("close",function(){e.connected=!1,e.store.dispatch(Object(C.Y)(Lv.a))}),t()})}},{key:"onSignal",value:function(e){var t=this;Ar.a.addJson(e).then(function(){var e=Object(i.a)(a.a.mark(function e(n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.clockType===Fv.a?t.publishMaster(n):t.publishSlave(n,t.userToConnectTo);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}},{key:"onMessageFromPeer",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,Bv(t);case 3:e.t1=e.sent,n=e.t0.parse.call(e.t0,e.t1),e.t2=n.type,e.next=6===e.t2?8:1===e.t2?10:2===e.t2?17:4===e.t2?19:5===e.t2?21:3===e.t2?23:30;break;case 8:return this.onTransferTrack(n.payload),e.abrupt("break",30);case 10:return this.lastTickTime=(new Date).getTime(),this.step=parseInt(n.payload.step),this.time=parseFloat(n.payload.time),this.length=parseInt(n.payload.length),this.peer.send(JSON.stringify({type:2,payload:""})),this.updateClockTickUI(this.step),e.abrupt("break",30);case 17:return this.peer.send(JSON.stringify({type:3})),e.abrupt("break",30);case 19:return this.sequencerEngine.stop(),e.abrupt("break",30);case 21:return this.sequencerEngine.bpm=n.payload,e.abrupt("break",30);case 23:return this.rtt=(new Date).getTime()-this.lastTickTime,r=this.rtt/2,i=this.step%this.sequencerEngine.length,(s=this.sequencerEngine.length)>this.length&&(s=this.length),i!==s-2||this.initiator||this.sequencerEngine.playing||!this.isPlayScheduled||(o=this.lastTickTime-r+this.time-(new Date).getTime(),o+=new W.a.Time("32n").toMilliseconds(),this.sequencerEngine.timeToCompare=(new Date).getTime()+o,this.sequencerEngine.play()),e.abrupt("break",30);case 30:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateClockTickUI",value:function(e){var t=this.length||this.sequencerEngine.length;if(0===(e%=t)%4){var n=e/t*100,r=25;n>=25&&n<50?r=50:n>=50&&n<75?r=75:n>=75&&(r=100),this.store.dispatch(Object(C.R)(r))}}},{key:"signal",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ar.a.getJson(t);case 2:n=e.sent,console.log("calling peer ignal with data =",n),this.peer.signal(n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"publishMaster",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.dispatch(Object(C.Y)(Lv.d)),e.next=3,$r.a.getAccount();case 3:r=e.sent,fetch("/publishClock/"+r,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({clockType:Fv.a,signal:t})});case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"askToConnect",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.dispatch(Object(C.Y)(Lv.d)),this.setClockType(Fv.a),e.next=4,$r.a.getAccount();case 4:n=e.sent,fetch("/askToConnect/"+n,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({userToConnectTo:t})});case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"publishSlave",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.dispatch(Object(C.Y)(Lv.d)),e.next=3,$r.a.getAccount();case 3:r=e.sent,fetch("/publishClock/"+r,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({clockType:Fv.c,signal:t,userToConnectTo:n})});case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onStop",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.connected&&this.initiator&&this.peer.send(JSON.stringify({type:4}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onBPMChanged",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.connected&&this.clockType===Fv.a&&this.peer.send(JSON.stringify({type:5,payload:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onTick",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.connected&&this.clockType===Fv.a&&(this.peer.send(JSON.stringify({type:1,payload:{step:n,time:t,length:this.sequencerEngine.length}})),this.updateClockTickUI(n));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"tellServerWeConnected",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$r.a.getAccount();case 2:t=e.sent,fetch("/clocksConnected/"+t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}});case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"state",get:function(){return this.store.getState()}},{key:"isPlayScheduled",get:function(){return this.state.clock.playScheduled}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=_v(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"onTransferTrack",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.preset,r=t.pattern,e.next=3,this.sequencerEngine.loadTrackPreset(n,void 0,!0);case 3:(i=e.sent).pattern.changeLength(r.size),e.t0=a.a.keys(r);case 6:if((e.t1=e.t0()).done){e.next=13;break}if("size"!==(s=e.t1.value)){e.next=10;break}return e.abrupt("continue",6);case 10:i.pattern.stepBuckets[s].fromJson(r[s]),e.next=6;break;case 13:i.pattern.syncBuckets(),this.sequencerEngine.updateSteps();case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"transferTrack",value:function(e){var t=this.sequencerEngine.getTrackPreset(e.trackNumber),n=e.pattern.stepBuckets,r={size:n.length};for(var a in n)n[a].anyOn()&&(r[a]=n[a].getJson());var i={preset:t,pattern:r};this.peer.send(JSON.stringify({type:6,payload:i})),this.sequencerEngine.deleteTrack(e.trackNumber)}}]),n}(e)}(function(){return function e(){Object(s.a)(this,e)}}()))),Hv=n(1781),Uv=n.n(Hv),Gv=n(45);function Wv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Kv=0,Qv=n(562);function Zv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Yv=function e(){Object(s.a)(this,e)},Xv=function(){function e(t){Object(s.a)(this,e),this.sequencerEngine=t,this.ccToCallback={},this.callbacks=[]}return Object(o.a)(e,[{key:"setCallback",value:function(e,t){this.ccToCallback[e]=t}},{key:"send",value:function(e,t){(t=Math.round(t))<0?t=0:t>127&&(t=127),this.output.sendControlChange(e,t)}},{key:"onEvent",value:function(e){var t=this.ccToCallback[e.controller.number];t&&t(e.value),38!==e.controller.number&&6!==e.controller.number&&96!==e.controller.number&&97!==e.controller.number&&this.sequencerEngine.store.dispatch(Object(C.Vb)({number:e.controller.number,value:e.value}))}}]),e}(),$v="FILTER",em="DELAY",tm="SEND_A",nm=function(){function e(t){Object(s.a)(this,e),this.action=t}return Object(o.a)(e,[{key:"onChange",value:function(e,t){this.action===tm&&e&&e.setSendVolume(0,Object(ta.b)(t,0,128))}}]),e}(),rm="RESOLUTION",am="TRACK_ROLL",im="SEQUENCE_ROLL",sm={1:new Tr.a(4,!1),2:new Tr.a(4,!0),3:new Tr.a(8,!1),4:new Tr.a(8,!0),5:new Tr.a(16,!1),6:new Tr.a(16,!0),7:new Tr.a(32,!1),8:new Tr.a(32,!0)},om=0,cm=function(){function e(t,n,r){Object(s.a)(this,e),this.cc=r,this.sequencerEngine=t,this.lastNumber=0,this.ccToAction=this.convertConfig(n.cc),n.actions&&(this.noteToAction=this.convertConfig2(n.actions)),n.note&&(this.noteToAction=this.convertConfig(n.note)),n.ccActions&&(this.ccToAction=this.convertConfig2(n.ccActions)),this.overwrittenCC=new Set,this.knob1Action=new nm($v),this.knob2Action=new nm(em),this.knob3Action=new nm(tm),this.rollingCount=0}return Object(o.a)(e,[{key:"state",get:function(){return this.sequencerEngine.state}},{key:"overwrite",value:function(e){this.overwrittenCC.add(e)}},{key:"onNoteOnEvent",value:function(e){var t=e.note.number;if(void 0!==this.noteToAction){var n=this.noteToAction[t];if(void 0!==n){switch(n.action){case im:this.onSequenceRollOn(n.track);break;case"PLAY":this.onPlay();break;case"RECORD":this.onRecord();break;case"CLEAR":this.onClear();break;case"PATTERN_SWITCH":this.onPatternSwitch(n.track);break;case"NEXT_PATTERN":this.onNextPattern();break;case"PREVIOUS_PATTERN":this.onPreviousPattern();break;default:return!0}return!0}}}},{key:"onNoteOffEvent",value:function(e){var t=e.note.number;if(void 0!==this.noteToAction){var n=this.noteToAction[t];if(void 0!==n){switch(n.action){case im:this.onSequenceRollOff(n.track);break;case"PATTERN_SWITCH":break;default:return!0}return!0}}}},{key:"onEvent",value:function(e,t){if(this.ccToAction){var n=this.ccToAction[e];if(void 0!==n&&!this.overwrittenCC.has(e))switch(n.action){case"VOLUME":this.onVolume(n.track,t);break;case"KNOB_1":this.onKnob1(n.track,t);break;case"KNOB_2":this.onKnob2(n.track,t);break;case"KNOB_3":this.onKnob3(n.track,t);break;case"CHANGE_SELECTED_TRACK":this.changeSelectedTrack(t);break;case"BROWSE_SOUNDS":this.browseSounds(t);break;case"CHANGE_TRANSPOSE":this.changeTranspose(t);break;case"CHANGE_START_SLICE":this.changeStartSlice(t);break;case"CHANGE_END_SLICE":this.changeEndSlice(t);break;case"CHANGE_VOLUME":this.changeVolume(t)}}}},{key:"onVolume",value:function(e,t){var n=this.sequencerEngine.subSequences[e];void 0!==n&&(n.fade=t/128)}},{key:"onKnob1",value:function(e,t){var n=this.getTrack(e);this.knob1Action.onChange(n,t);var r=this.sequencerEngine.subSequences[e];void 0!==r&&this.sequencerEngine.switchToSubSequence(r.id)}},{key:"onKnob2",value:function(e,t){var n=this.getTrack(e);this.knob2Action.onChange(n,t);var r=this.sequencerEngine.subSequences[e];void 0!==r&&this.sequencerEngine.switchToSubSequence(r.id)}},{key:"onKnob3",value:function(e,t){var n=this.getTrack(e);this.knob3Action.onChange(n,t);var r=this.sequencerEngine.subSequences[e];void 0!==r&&this.sequencerEngine.switchToSubSequence(r.id)}},{key:"convertConfig2",value:function(e){var t={};for(var n in e){t[e[n]]={action:n}}return t}},{key:"convertConfig",value:function(e){var t={};for(var n in e){var r={track:Object(pe.a)(n)?parseInt(n):n},a=e[n];for(var i in a){t[a[i]]=Object(p.a)({},r,{action:i})}}return t}},{key:"getTrack",value:function(e){if("MASTER"!==e)return this.sequencerEngine.tracks[e]}},{key:"onSequenceRollOn",value:function(e){var t=sm[e];void 0!==t&&(this.sequencerEngine.resolution=t,this.sequencerEngine.trackRolling=!0,this.sequencerEngine.setSequenceRolling(!0,t),this.rollingCount++)}},{key:"onSequenceRollOff",value:function(e){this.rollingCount--,0===this.rollingCount&&(this.sequencerEngine.trackRolling=!1,this.sequencerEngine.setSequenceRolling(!1,void 0))}},{key:"onPatternSwitch",value:function(e){this.sequencerEngine.switchToPattern(e)}},{key:"onNextPattern",value:function(){this.sequencerEngine.switchToNextPattern()}},{key:"onPreviousPattern",value:function(){this.sequencerEngine.switchToPreviousPattern()}},{key:"onPlay",value:function(){this.sequencerEngine.play()}},{key:"onClear",value:function(){var e=this.sequencerEngine.getSelectedMidiTrack();e&&(e.pattern.clear(),e.updateSteps())}},{key:"onRecord",value:function(){this.sequencerEngine.recording(!this.sequencerEngine.isRecording)}},{key:"changeSelectedTrack",value:function(e){this.sequencerEngine.getSelectedMidiTrack();var t=Math.floor(e/128*this.sequencerEngine.tracks.length);this.sequencerEngine.selectTrack(t)}},{key:"browseSounds",value:function(e){var t=this,n=++om;setTimeout(function(){if(om===n){var r=t.sequencerEngine.getSelectedMidiTrack();if(void 0!==r)if(Math.abs(t.lastBrowseValue-e)<=2)e>=125&&t.resetBrowseToZero();else{var a=void 0===t.lastBrowseValue||e>=t.lastBrowseValue;t.lastBrowseValue=e,a?r.auditionNext(!0,!0):r.auditionPrevious(!0,!0),e>=125&&t.resetBrowseToZero()}}},50)}},{key:"resetBrowseToZero",value:function(){for(var e in this.lastBrowseValue=0,this.ccToAction)if("BROWSE_SOUNDS"===this.ccToAction[e].action)return void this.cc.send(parseInt(e),0)}},{key:"changeResolution",value:function(e){var t=1+Math.floor(e/128*8);this.sequencerEngine.resolution=sm[t]}},{key:"changeStartSlice",value:function(e){var t=e/128,n=this.sequencerEngine.getSelectedMidiTrack();if(n){var r=Object.keys(n.samplers);if(0!==r.length){var a=n.samplers[r[r.length-1]],i=this.getSlice(n),s=a.getSlice(i),o=t*s.endTime;o<s.endTime&&a.slice(i,o,s.endTime,void 0,void 0,!0)}}}},{key:"getSlice",value:function(e){return this.state.tracks.selectedTrackSlice[e.id]||0}},{key:"changeEndSlice",value:function(e){var t=e/128,n=this.sequencerEngine.getSelectedMidiTrack();if(n){var r=Object.keys(n.samplers);if(0!==r.length){var a=n.samplers[r[r.length-1]],i=this.getSlice(n),s=a.getSlice(i),o=a.getDuration(),c=s.startTime+t*(o-s.startTime);c>s.startTime&&a.slice(i,s.startTime,c,void 0,void 0,!0)}}}},{key:"changeVolume",value:function(e){var t=e/128,n=this.sequencerEngine.getSelectedMidiTrack();if(n){var r=64*Math.pow(t,.5)-60;n.setVolume(r)}}},{key:"changeTranspose",value:function(e){var t=this.sequencerEngine.getSelectedMidiTrack();if(t){var n=e/128*48-24;t.trackData.transpose=n}}}]),e}(),um=n(1782),lm=function(){function e(t,n,r){Object(s.a)(this,e),this.sequencerEngine=t,this.store=this.sequencerEngine.store,this.input=n,this.output=r,this.step=0,this.subSequenceNumber=0,this.patternNumber=0,this.numberOfPatterns=1,this.setupLights(),this.setupListeners()}return Object(o.a)(e,[{key:"setupListeners",value:function(){var e=this;this.input.addListener("noteon","all",function(e){}),this.input.addListener("noteoff","all",function(e){}),this.store.subscribe(function(){return e.onStateUpdate()})}},{key:"onStateUpdate",value:function(){var e=this.store.getState(),t=this.sequencerEngine.getSubSequence(e.sequencer.currentSubSequence);if(void 0!==t){var n=this.sequencerEngine.subSequences.indexOf(t),r=e.sequencer.currentPattern[t.id],a=e.sequencer.numberOfPatterns;this.subSequenceNumber===n&&this.patternNumber===r&&this.numberOfPatterns===a||(this.patternNumber=r,this.subSequenceNumber=n,this.idToPattern=e.sequencer.currentPattern,this.numberOfPatterns=a,this.onStateChanged())}}},{key:"onStateChanged",value:function(){this.pad.reset(8),console.log("patternNumber = "+this.patternNumber+" and subSequenceNumber = "+this.subSequenceNumber),this.color(this.pad.red,8,this.subSequenceNumber);for(var e=0;e<this.sequencerEngine.subSequences.length;e++)this.color(this.pad.red,0,e);for(var t in this.idToPattern){t=parseInt(t),console.log("id we got = "+t);var n=this.sequencerEngine.getSubSequence(t);if(void 0===n)return;var r=this.sequencerEngine.subSequences.indexOf(n),a=this.idToPattern[t],i=n.tracks[0];if(void 0!==i)for(var s=0;s<Math.min(8,i.patterns.length);s++)this.color(this.pad.yellow,s,r);console.log("coloring x = "+a+" y ="+r),this.color(this.pad.red,a,r)}}},{key:"onTick",value:function(){}},{key:"setupLights",value:function(){var e=this;this.pad=new um.a,this.pad.connect().then(function(){e.pad.reset(8),e.pad.on("key",function(t){return e.handleKeyPressed(t)}),e.onStateUpdate()})}},{key:"handleKeyPressed",value:function(e){var t=e.x,n=e.y;if(e.pressed){var r=this.sequencerEngine.subSequences[n];if(void 0!==r){var a=r.tracks[0];void 0!==a&&t<a.patterns.length&&(this.sequencerEngine.switchToSubSequence(r.id),this.sequencerEngine.switchToPattern(t))}}}},{key:"color",value:function(e,t,n){this.pad.col(e,{0:t,1:n,x:t,y:n,length:2,pressed:!0})}}]),e}();function fm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hm=["Launchpad Mini"],pm=["IAC Driver Bus 1","IAC Driver Bus 2","IAC Driver Bus 3"],dm={"Akai MPD26 Port 1":Qv.i,"MPD218 Port A":Qv.i},vm=function(e){Object(u.a)(n,e);var t=fm(n);function n(e,r,a){var i;Object(s.a)(this,n),i=t.call(this);Object(c.a)(i);return i.keyboardEngine=e,i.sequencerEngine=i.keyboardEngine.sequencerEngine,i.keyboardHelper=r,i.deviceToMidiCC={},i.sliders={},i.controllerInputs=[],i.controllerOutputs=[],i.inputToMode={},i.updateBpm=a,i.previousTimestamp=null,i.currentTimestamp=null,window.isNFT||Uv.a.enable(function(e){e?console.log("WebMidi could not be enabled.",e):i.setup()},!0),i}return Object(o.a)(n,[{key:"setup",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadAvailableDevices();case 2:this.setupKeyboardRouting(),void 0!==this.onEnableCallback&&this.onEnableCallback();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"store",get:function(){return this.sequencerEngine.store}},{key:"state",get:function(){return this.store.getState()}},{key:"loadAvailableDevices",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){Uv.a.inputs.filter(function(e){return!hm.some(function(t){return t===e.name})&&!pm.some(function(t){return t===e.name})}).forEach(function(e){return t.trackInput(e,dm[e.name]||Qv.h)});var r=Uv.a.inputs.filter(function(e){return hm.some(function(t){return t===e.name})}),a=Uv.a.outputs.filter(function(e){return hm.some(function(t){return t===e.name})});r.length>0&&void 0===t.launchPad&&(t.launchPad=new lm(t.sequencerEngine,r[0],a[0])),Uv.a.outputs.map(function(e){return t.trackOutput(e)}),e()}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"setStartCallback",value:function(e){this.startCallback=e}},{key:"setStopCallback",value:function(e){this.stopCallback=e}},{key:"getInputs",value:function(){return Uv.a.inputs}},{key:"getOutputs",value:function(){return Uv.a.outputs}},{key:"getTrackedInputs",value:function(){return this.controllerInputs}},{key:"getTrackedOutputs",value:function(){return this.controllerOutputs}},{key:"isOutputTracked",value:function(e){return this.controllerOutputs.some(function(t){return t.name==e.name})}},{key:"getOutput",value:function(e){var t=this.controllerOutputs.filter(function(e){return e.name==t.name});return t.length>0?t[0]:null}},{key:"playNote",value:function(e,t,n,r,a,i){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;t=t||"all",(n=Math.round(n))>70?n=70:n<-36&&(n=-36);var o=X.a.fromTranspose(n).toString();if(null!=e&&(r-=0,e.playNote(o,t,{velocity:s,time:"+"+r}),void 0!==a)){var c=r+a-20;c-r<10&&(c+=10-(c-r)),e.stopNote(o,t,{time:"+"+c,release:i})}}},{key:"playNoteSimple",value:function(e,t,n,r){n=n||"all",e.playNote(t,n,{release:r})}},{key:"releaseNoteSimple",value:function(e,t,n,r){n=n||"all",e.stopNote(t,n,{release:r})}},{key:"trackOutput",value:function(e){for(var t in this.controllerOutputs)if(this.controllerOutputs[t].name===e.name)return;this.controllerOutputs.push(e),void 0===this.deviceToMidiCC[e.name]&&(this.deviceToMidiCC[e.name]=new Xv(this.sequencerEngine)),this.deviceToMidiCC[e.name].output=e}},{key:"untrackOutput",value:function(e){for(var t=-1,n=0;n<this.controllerOutputs.length;n++)if(this.controllerOutputs[n].name===e.name){t=n;break}t>-1&&(this.controllerOutputs.splice(t,1),delete this.inputToMode[e.name])}},{key:"trackInput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qv.h;if(this.addControlChangeListeners(e),console.log("track input =",e.name),Pr.a[e.name]&&void 0===this.sliders[e.name]){console.log("FOUND DEVICE TO SLIDER",e.name);var n=Pr.a[e.name];this.sliders[e.name]=new cm(this.sequencerEngine,n,this.deviceToMidiCC[e.name])}for(var r in this.controllerInputs)if(this.controllerInputs[r].name===e.name)return;this.controllerInputs.push(e),this.setInputMode(e,t)}},{key:"isInputTracked",value:function(e){return this.controllerInputs.some(function(t){return t.name==e.name})}},{key:"isInputSynced",value:function(e){return void 0!==this.systemInput&&this.systemInput.name==e.name}},{key:"untrackInput",value:function(e){for(var t=-1,n=0;n<this.controllerInputs.length;n++)if(this.controllerInputs[n].name===e.name){t=n;break}t>-1&&(this.controllerInputs.splice(t,1),delete this.inputToMode[e.name])}},{key:"setInputMode",value:function(e,t){this.inputToMode[e.name]=t}},{key:"syncOutput",value:function(e){this.systemOutput===e?this.systemOutput=void 0:this.systemOutput=e}},{key:"onTick",value:function(e,t,n){if(void 0!==this.systemOutput){var r=new W.a.Time("32n").toMilliseconds()/3;e+=20;for(var a=0;a<3;a++)this.systemOutput.sendClock({time:"+"+e}),e+=r}this.launchPad&&this.launchPad.onTick(t,n)}},{key:"onPlay",value:function(){void 0!==this.systemOutput&&this.systemOutput.sendStart({time:"+0"})}},{key:"onStop",value:function(){void 0!==this.systemOutput&&this.systemOutput.sendStop()}},{key:"syncInput",value:function(e){void 0!==this.systemInput&&this.removeSystemListeners(),this.systemInput=e,this.addSystemInputListeners()}},{key:"unsyncInput",value:function(e){this.removeSystemListeners(),this.systemInput=void 0}},{key:"removeSystemListeners",value:function(){this.systemInput.removeListener("clock","all"),this.systemInput.removeListener("start","all"),this.systemInput.removeListener("stop","all")}},{key:"addSystemInputListeners",value:function(){var e=this;this.last10=[],this.systemInput.addListener("start","all",function(t){e.sequencerEngine.play(0,!0)}),this.systemInput.addListener("stop","all",function(t){e.sequencerEngine.stop()})}},{key:"onEnable",value:function(e){this.onEnableCallback=e}},{key:"addControlChangeListeners",value:function(e){var t=this;e.removeListener("pitchbend","all"),e.removeListener("controlchange","all"),void 0===this.deviceToMidiCC[e.name]&&(this.deviceToMidiCC[e.name]=new Xv(this.sequencerEngine));var n=e.name,r=this.deviceToMidiCC[e.name];r.input=e,e.addListener("controlchange","all",function(e){var a=t.sliders[n];t.onControlChange(r,a,e)}),e.addListener("pitchbend","all",function(e){t.onPitchBend(e)})}},{key:"removeListeners",value:function(e){e.removeListener("noteon","all"),e.removeListener("noteoff","all")}},{key:"getInputsForMode",value:function(e){var t=this;return this.controllerInputs.filter(function(n){return n.name in t.inputToMode&&t.inputToMode[n.name]==e})}},{key:"getInputMode",value:function(e){return this.inputToMode[e]||Qv.h}},{key:"setupKeyboardRouting",value:function(){var e=this;Uv.a.inputs.forEach(function(t){return e.removeListeners(t)}),this.addNoteOnListener(function(t,n,r){r<.1||(window.triggerReceived=(new Date).getTime(),r=Math.min(1,r+.1),e.keyboardHelper.onNoteDown(n,!0,t,r))},void 0),this.addNoteOffListener(function(t,n){e.keyboardHelper.onNoteOff(n,!0,t)},void 0)}},{key:"addNoteOnListener",value:function(e,t){var n=this;void 0===t&&(t=function(){return n.controllerInputs});Uv.a.inputs.map(function(r){return r.addListener("noteon","all",function(a){var i=n.sliders[r.name];if((!i||!i.onNoteOnEvent(a))&&t().some(function(e){return e.name==r.name})){var s=a.note.name+a.note.octave;e(r.name,s,a.velocity)}})})}},{key:"addNoteOffListener",value:function(e,t){var n=this;void 0===t&&(t=function(){return n.controllerInputs});Uv.a.inputs.map(function(r){return r.addListener("noteoff","all",function(a){var i=n.sliders[r.name];if((!i||!i.onNoteOffEvent(a))&&t().some(function(e){return e.name==r.name})){var s=a.note.name+a.note.octave;e(r.name,s)}})})}},{key:"updateSteps",value:function(e){}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=Zv(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"onControlChange",value:function(e,t,n){if(e.onEvent(n),t&&t.onEvent(n.controller.number,n.value),n.controller.number===Qv.c)this.sequencerEngine.play();else if(n.controller.number===Qv.f)this.sequencerEngine.stop();else if(n.controller.number===Qv.e){var r=this.sequencerEngine.store.getState();this.sequencerEngine.recording(!r.sequencer.isRecording)}else n.controller.number===Qv.b?this.sequencerEngine.switchToNextPattern():n.controller.number===Qv.d?this.sequencerEngine.switchToPreviousPattern():n.controller.number===Qv.g?this.sequencerEngine.sustain(n.value):n.controller.number===Qv.a&&this.onModulationChange(n.value);if(n.controller.number>=1&&n.controller.number<=6){var a=this.sequencerEngine.groups.groups[n.controller.number-1];void 0!==a&&a.tracks.length}else this.onControllerAux(n)}},{key:"onPitchBend",value:function(e){var t=this.sequencerEngine.getSelectedTrack();t.instrument&&t.instrument.onPitchBend&&t.instrument.onPitchBend(e.value)}},{key:"onModulationChange",value:function(e){this.sequencerEngine.getSelectedTrack}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=Wv(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"midiMappings",get:function(){return this.state.midi.mappings}},{key:"midiMapMode",get:function(){return this.state.midi.midiMapMode}},{key:"onMappedParameterChange",value:function(e){var t=this,n=this.midiMappings[e.controller.number].map(function(e){return t.sequencerEngine.idToParameter[e]}).filter(function(e){return e&&e.object}),r=e.value/127;if(n.length>0){var a=++Kv,i=n[0];this.sequencerEngine.dispatch(Object(C.Cc)(i)),setTimeout(function(){Kv===a&&t.sequencerEngine.dispatch(Object(C.Cc)(void 0))},150)}n.forEach(function(e){return e.normalizedSet(r)})}},{key:"isParameterMapped",value:function(e){var t=e.controller.number;return this.midiMappings[t]&&(void 0===this.parameterSelected||this.midiMappings[t].indexOf(this.parameterSelected)>-1)}},{key:"onControllerAux",value:function(e){console.log("ON CONTROLLER AUX=",e),console.log("action selected=",this.actionSelected);var t=e.controller.number;this.midiMapMode===Gv.a?this.store.dispatch(Object(C.d)(t)):this.isParameterMapped(e)?this.onMappedParameterChange(e):this.actionMappings[t]&&(void 0===this.actionSelected||this.actionMappings[t].indexOf(this.actionSelected)>-1)?this.actionMappings[t].forEach(function(t){return t.execute(e.value)}):this.midiMapMode===Gv.b&&this.actionSelected?this.store.dispatch(Object(C.p)(this.actionSelected,t)):this.midiMapMode===Gv.b&&this.parameterSelected&&this.store.dispatch(Object(C.zc)(this.parameterSelected,t))}},{key:"parameterSelected",get:function(){return this.state.midi.parameterSelected}},{key:"actionSelected",get:function(){return this.state.midi.actionSelected}},{key:"actionMappings",get:function(){return this.state.midi.actionMappings}}]),n}(e)}(Yv))),mm=n(899);function ym(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var bm=new Tr.a(4,!1),gm=function(e){Object(u.a)(n,e);var t=ym(n);function n(e,r,a,i,o){var c;return Object(s.a)(this,n),(c=t.call(this,-1,e,r,a,i,{id:-1})).isMetronome=!0,o||c.initPattern(),c}return Object(o.a)(n,[{key:"getCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,t,r,a,i,s){return new n(e,t,r,a,!0)},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine;return Object(ne.a)(Object(f.a)(n.prototype),"getCopy",this).call(this,e,t)}},{key:"newFrozenColumn",value:function(){}},{key:"dispose",value:function(){Object(ne.a)(Object(f.a)(n.prototype),"dispose",this).call(this)}},{key:"initPattern",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new q.a("QmfJwbUmKMiE1Mrme2xHpHUJP2bVM3BFeUtzQgpDqHssCw"),e.next=3,t.fetchAudio();case 3:this.addSound(t),(n=this.getEasyPattern()).addStep(this.getOnBeat(),0,bm,0),n.addStep(this.getOffBeat(),1,bm,0),n.addStep(this.getOffBeat(),2,bm,0),n.addStep(this.getOffBeat(),3,bm,0),this.muteableNode.toMaster(),this.mute(!0);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOnBeat",value:function(){var e=new F.a;return e.on=!0,e.velocity=.7,e}},{key:"getOffBeat",value:function(){var e=new F.a;return e.on=!0,e.velocity=.2,e}},{key:"updateSteps",value:function(){}},{key:"getUpdateStepsAction",value:function(){return[]}}]),n}(rt),Om=(n(577),function(e,t){return 1!==t.speedFactor&&((e=Pm(e)).duration/=t.speedFactor),km(t)?(e=Pm(e),e=jm(e,e.auxEventAParameter,t.auxEventAType),e=jm(e,e.auxEventBParameter,t.auxEventBType),e=jm(e,e.auxEventCParameter,t.auxEventCType),e=jm(e,e.auxEventDParameter,t.auxEventDType)):e}),km=function(e){return e.auxEventAType!==Ne.b||e.auxEventBType!==Ne.b||e.auxEventCType!==Ne.b||e.auxEventDType!==Ne.b},jm=function(e,t,n){if(n===Ne.b)return e;var r=t.get(),a=e.track,i=a.getAuxVariable(t.name);switch(n){case Ne.c:wm(i,e,r);break;case Ne.a:xm(i,e,a,r,t)}return e},wm=function(e,t,n){t[e]+=Math.random()*n},xm=function(e,t,n,r,a){void 0===n.accumulators[e]&&(n.accumulators[e]=0),n.accumulators[e]+=r;var i=n.getAuxLimit(a.name);n.getAuxMode(a.name);Sm(n,e)>i&&Sm(n,e,0),t[e]+=Sm(n,e)},Sm=function(e,t,n){if(void 0===n)return e.accumulators[t];e.accumulators[t]=n},Pm=function(e){var t=new F.a(void 0,void 0,void 0,e.track);return t.transpose=e.transpose,t.velocity=e.velocity,t.on=e.on,t.duration=e.duration,t.attack=e.attack,e.track.instrument?t.release=null:t.release=e.release,t.start=e.start,t.chop=e.chop,t.pitchAttack=e.pitchAttack,t.pitchSustain=e.pitchSustain,t.pitchRelease=e.pitchRelease,t.pitchDecay=e.pitchDecay,t.slice=e.slice,t.reverse=e.reverse,t.panning=e.panning,t.selectedRecording=e.selectedRecording,t.palette=e.palette,t.auxEventA=e.auxEventA,t.auxEventB=e.auxEventB,t.auxEventC=e.auxEventC,t.auxEventD=e.auxEventD,t},Em=n(229);function Tm(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Am(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Am(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Am(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Mm=function(e){var t,n=new Set,r=0,a=Tm(e.subSequences);try{for(a.s();!(t=a.n()).done;){var i,s=Tm(t.value.tracks);try{for(s.s();!(i=s.n()).done;){var o=i.value;r+=o.triggerCount||0,Object.keys(o.notesTriggered||{}).forEach(function(e){return n.add(parseFloat(e))})}}catch(c){s.e(c)}finally{s.f()}}}catch(c){a.e(c)}finally{a.f()}Object(Em.a)(Array.from(n)),Object(Em.f)(r)};function Rm(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Cm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Cm(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Cm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Nm(e,t,n,r,a){for(var i in t.filter(function(e){return void 0!==e}).forEach(function(e){return e.chokes.onStep()}),Im(n,t),n=qm(n,t))if(void 0!==t[i]&&void 0!==t[i].chokes&&void 0!==t[i].chokes.choke){var s=t[i].chokes.choke,o=n[i];for(var c in o){var u=o[c],l=2*u.stepData.duration;s.chokes.newChoke(l,u.time)}}n=Fm(n,t,r,a);for(var f=[],d=Math.max.apply(Math,Object(h.a)(t.map(function(e){return e.trackNumber}))),v=function(e){var n=t.find(function(t){return t.trackNumber===e});f.push(n)},m=0;m<=d;m++)v(m);t=f;var y,b=Rm(e.subSequences);try{for(b.s();!(y=b.n()).done;){var g,O=Rm(y.value.tracks);try{for(O.s();!(g=O.n()).done;){var k=g.value;if(k){for(var j=k.notesTriggered||{},w=Object.keys(j),x=0,S=w;x<S.length;x++){var P=S[x];j[P]-=.5,j[P]<=-1.5&&delete j[P]}k.notesTriggered=Object(p.a)({},j)}}}catch(A){O.e(A)}finally{O.f()}}}catch(A){b.e(A)}finally{b.f()}var E=function(e){var i=t[e],s=i&&i.notesTriggered||{};return void 0===i||void 0===i.chokes||i.chokes.isChoked()?(i&&(i.triggerCount=0),"continue"):i.pad&&i.pad.choking>0?(i.triggerCount=0,"continue"):void 0===n[e]?(i.triggerCount=0,"continue"):(0===n[e].length?a%2===0&&(i.triggerCount=n[e].length):i.triggerCount=n[e].length,n[e].forEach(function(e){var t=Math.round(e.stepData.transpose),n=s[t]||0,o=i.isWarped()?2:0;s[t]=Math.max(n,e.stepData.duration+o);var c=Om(e.stepData,i);c.stepNumber=e.rolledStepNumber||e.stepNumber,c.time=r,i.trigger(c,e.time,a)}),void(i.notesTriggered=Object(p.a)({},s)))};for(var T in n)E(T);return Mm(e),n}var qm=function(e){var t=new Set([]);for(var n in e){e[n].filter(function(e){return e.chokes&&e.chokes.length>0}).forEach(function(e){return e.chokes.forEach(function(e){return t.add(e.trackNumber)})})}var r={};for(var a in e)t.has(parseInt(a))||(r[a]=e[a]);return r},Im=function(e,t){for(var n in e)for(var r=e[n].filter(function(e){return e.grabs&&e.grabs.length>0}),a=0;r.length>0&&!(++a>=100);){var i,s=r.shift(),o=Rm(s.grabs);try{for(o.s();!(i=o.n()).done;){var c=i.value;if(_m(c,e)){r.push(s);break}Dm(s,c,e,t),s.resolved=!0}}catch(u){o.e(u)}finally{o.f()}}},_m=function(e,t){var n=e.trackNumber,r=(e.fromParam,e.toParam,t[n]);if(void 0===r||0===r.length)return!1;var a=r[0];return a.grabs.length>0&&!a.resolved},Dm=function(e,t,n,r){var a=t.trackNumber,i=t.add,s=t.fromParam,o=t.toParam,c=(t.isTime,n[a]),u=r[a];if(u){var l=void 0,f=e.stepData[o+"Parameter"],h=-32,p=32;if(void 0===c||0===c.length){if("transpose"!==s)return!1;if(u.notesTriggered){l=Lm(u.notesTriggered);var d=u.notesTriggered[l];if(void 0===l||d<2)return!1;l=parseFloat(l)}}else{var v=c[0];if(t.isTime)return e.time=v.time,!0;var m=v.stepData[s+"Parameter"];if(void 0===m||void 0===f)return!1;l=m.get(),h=m.min,p=m.max}var y=(l-h)/(p-h),b=f.min+y*(f.max-f.min);f.set(i?f.get()+b:b)}},Fm=function(e,t,n,r){if(0===t.length)return e;var a=t[0].subSequence;a.midiEffects.onNewStep();var i={};for(var s in e){var o=e[s],c=t[s];c&&c.isFrozen&&c.skipMidiMaster||c&&c.skipMidiMaster?(i[c.trackNumber]||(i[c.trackNumber]=[]),i[c.trackNumber]=o):o.forEach(function(e){return a.midiEffects.input(e)})}var u,l=Rm(a.midiEffects.output(n,r,r));try{for(l.s();!(u=l.n()).done;){var f=u.value;if(f.stepData&&f.stepData.track){var h=f.stepData.track.trackNumber;if(void 0===h)continue;i[h]||(i[h]=[]),i[h].push(f)}}}catch(p){l.e(p)}finally{l.f()}return i},Lm=function(e){var t=-4,n=void 0;for(var r in e)t<e[r]&&(n=r,t=e[r]);return n},Bm=n(234);function zm(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Jm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Jm(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Jm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Vm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Hm=new W.a.Time("32n"),Um=n(34),Gm=n(61),Wm=n(547),Km=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];for(var r in Object(s.a)(this,e),this.name=t,this.id=Object(S.uuid)(),this.patterns=n,this.algorithmTypes=[],this.durationPercentages=[],n)this.algorithmTypes.push(Wm.d),this.durationPercentages.push(100)}return Object(o.a)(e,[{key:"deleteSubSequence",value:function(e){this.patterns.splice(e,1)}},{key:"getJson",value:function(){return{name:this.name,patterns:this.patterns,algorithmTypes:this.algorithmTypes,durationPercentages:this.durationPercentages}}}]),e}();function Qm(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Zm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zm(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Zm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ym=function(){function e(t){Object(s.a)(this,e),this.sequencerEngine=t,this.scenes=[]}return Object(o.a)(e,[{key:"subSequences",get:function(){return this.sequencerEngine.subSequences}},{key:"state",get:function(){return this.sequencerEngine.state}},{key:"newScene",value:function(){var e,t="Scene "+(this.scenes.length+1),n=[],r=Qm(this.subSequences);try{for(r.s();!(e=r.n()).done;){var a=e.value;n.push(a.tracks[0].currentPattern)}}catch(s){r.e(s)}finally{r.f()}var i=new Km(t,n);this.scenes=[].concat(Object(h.a)(this.scenes),[i]),this.sequencerEngine.dispatch(Object(C.hd)(this.scenes)),this.sequencerEngine.dispatch(Object(C.fb)(i))}},{key:"moveScene",value:function(e,t){var n=Object(Cn.b)(e,t,this.scenes);this.scenes=Object.keys(n).map(function(e){return n[e]}),this.sequencerEngine.dispatch(Object(C.hd)(Object(h.a)(this.scenes)))}},{key:"deleteSubSequence",value:function(e){this.scenes.forEach(function(t){return t.patterns.splice(e,1)}),this.scenes.forEach(function(t){return t.algorithmTypes.splice(e,1)}),this.scenes.forEach(function(t){return t.durationPercentages.splice(e,1)})}},{key:"newSubSequence",value:function(){this.scenes.forEach(function(e){return e.patterns.push(0)}),this.scenes.forEach(function(e){return e.algorithmTypes.push(Wm.d)}),this.scenes.forEach(function(e){return e.durationPercentages.push(100)})}},{key:"deleteScene",value:function(e){var t=this.scenes.indexOf(e);this.scenes.splice(t,1),this.sequencerEngine.dispatch(Object(C.hd)(Object(h.a)(this.scenes))),this.sequencerEngine.dispatch(Object(C.fb)(void 0))}},{key:"switchToScene",value:function(e){if(e){for(var t in this.subSequences){var n=this.subSequences[t],r=e.patterns[t];this.sequencerEngine.switchToPattern(r,!1,n)}this.sequencerEngine.dispatch(Object(C.fb)(e))}}},{key:"currentScene",get:function(){return this.state.sequencer.currentScene}},{key:"onNewStep",value:function(e){var t=this.currentScene;if(!(void 0===t||e<=1))for(var n in t.algorithmTypes){var r=this.subSequences[n],a=t.algorithmTypes[n],i=t.durationPercentages[n];if(e%Math.round(r.length*i/100)===0&&r.tracks[0]){var s=r.tracks[0].currentPattern,o=r.tracks[0].patterns.length;switch(a){case Wm.b:this.sequencerEngine.switchToPattern((s+1)%o,!1,r,!0);continue;case Wm.c:(s-=1)<0&&(s=o-1),this.sequencerEngine.switchToPattern(s,!1,r,!0);continue;case Wm.a:var c=Math.random();if(c<.5)continue;c<.75?this.sequencerEngine.switchToPattern((s+1)%o,!1,r,!0):((s-=1)<0&&(s=o-1),this.sequencerEngine.switchToPattern(s,!1,r,!0))}}}}},{key:"getJson",value:function(){return this.scenes.map(function(e){return e.getJson()})}},{key:"fromJson",value:function(e){var t,n=Qm(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=new Km(r.name,r.patterns);r.algorithmTypes&&(a.algorithmTypes=r.algorithmTypes),r.durationPercentages&&(a.durationPercentages=r.durationPercentages),this.scenes.push(a)}}catch(i){n.e(i)}finally{n.f()}this.sequencerEngine.dispatch(Object(C.hd)(Object(h.a)(this.scenes)))}}]),e}();function Xm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}n(583);var $m=n(36),ey=function(){function e(){Object(s.a)(this,e),this.trackToSlices={},this.trackToTransposes={}}return Object(o.a)(e,[{key:"clear",value:function(){this.trackToSlices={},this.trackToTransposes={}}},{key:"addTrackSlice",value:function(e,t,n){void 0===n?e in this.trackToSlices?this.trackToSlices[e].add(t):this.trackToSlices[e]=new Set([t]):e in this.trackToTransposes?this.trackToTransposes[e].add(n):this.trackToTransposes[e]=new Set([n])}},{key:"deleteTrack",value:function(e){e in this.trackToSlices&&delete this.trackToSlices[e],e in this.trackToTransposes&&delete this.trackToTransposes[e]}},{key:"removeTrackSlice",value:function(e,t,n){if(void 0!==n){var r=this.trackToTransposes[e];void 0===r||(r.size<=1?delete this.trackToTransposes[e]:this.trackToTransposes[e].delete(n))}else{var a=this.trackToSlices[e];void 0===a||(a.size<=1?delete this.trackToSlices[e]:this.trackToSlices[e].delete(t))}}},{key:"getTrackSlicesRolling",value:function(e){var t=e.trackNumber,n=[];return(this.trackToTransposes[t]||[]).forEach(function(e){return n.push(new ty(parseInt(t),0,e))}),(this.trackToSlices[t]||[]).forEach(function(e){return n.push(new ty(parseInt(t),e,void 0))}),n}},{key:"getTriggerTimes",value:function(e,t){return Object(Bm.a)(e,t)}},{key:"getTrackRollEffectIfAny",value:function(e){for(var t in e.liveEffects.effects){var n=e.liveEffects.effects[t];if(n.effect===Pe.f)return n}}},{key:"getTriggers",value:function(e,t,n){var r=this.getTrackRollEffectIfAny(n);if(r){var a=r.rollFactor;(t=t.getCopy()).resolution*=a}var i=this.getTriggerTimes(e,t),s=[];return 0==i.length?s:(this.getTrackSlicesRolling(n).forEach(function(e){return i.forEach(function(t){return s.push(new ny(e,t.time,t.step))})}),s)}}]),e}(),ty=function e(t,n,r){Object(s.a)(this,e),this.trackNumber=t,this.sliceNumber=n,this.transpose=r},ny=function e(t,n,r){Object(s.a)(this,e),this.trackSlice=t,this.time=n,this.step=r},ry=ey,ay=(n(261),function(){function e(t){Object(s.a)(this,e),this.type=t}return Object(o.a)(e,[{key:"execute",value:function(e){}}]),e}());function iy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var sy=function(e){Object(u.a)(n,e);var t=iy(n);function n(e,r){var a;return Object(s.a)(this,n),(a=t.call(this,rm)).sequencerEngine=e,a.resolution=r,a}return Object(o.a)(n,[{key:"execute",value:function(e){var t=this,n=oy.filter(function(e){return e.isTriplet===t.resolution.isTriplet}),r=127/n.length,a=Math.floor(e/r);a>=n.length&&(a=n.length-1);var i=n[a];this.sequencerEngine.resolution.equals(i)||(this.sequencerEngine.resolution=i)}}]),n}(ay),oy=[new Tr.a(4,!1),new Tr.a(4,!0),new Tr.a(8,!1),new Tr.a(8,!0),new Tr.a(16,!1),new Tr.a(16,!0),new Tr.a(32,!1),new Tr.a(32,!0)],cy=sy,uy=function(){function e(){Object(s.a)(this,e),this.parameterLocks=[]}return Object(o.a)(e,[{key:"addParameterLock",value:function(e,t,n,r,a){this.parameterLocks.push(new ly(e,t,n,r,a))}},{key:"deleteParameterLock",value:function(e){var t=this.parameterLocks.indexOf(e);t>-1&&this.parameterLocks.splice(t,1)}},{key:"fromJson",value:function(e,t){for(var n in e){var r=e[n],a=void 0===r.effectNumber?this.getTrackParameterFromJson(r,t):this.getEffectParameterFromJson(r,t);void 0!==a&&this.parameterLocks.push(new ly(r.trackNumber,r.groupNumber,r.sendNumber,r.effectNumber,a))}}},{key:"getTrackParameterFromJson",value:function(e,t){var n=e.trackNumber;if(void 0!==n){var r=t.tracks[n].trackData,a=e.parameter.name,i=r.parameters.filter(function(e){return e.name===a});if(!(i.length<1)){var s=i[0];return s.min=e.parameter.min,s.max=e.parameter.max,s}}}},{key:"getEffectParameterFromJson",value:function(e,t){var n=void 0;if(void 0!==e.trackNumber)n=t.tracks[e.trackNumber].effects[e.effectNumber];else if(void 0!==e.groupNumber){var r=t.groups.groups[e.groupNumber];if(void 0===r)return;n=r.effects[e.effectNumber]}else if(void 0!==e.sendNumber){n=t.sends.sends[e.sendNumber].effects[e.effectNumber]}if(void 0!==n){var a=e.parameter.name,i=n.parameters.filter(function(e){return e.name===a});if(!(i.length<1)){var s=i[0];return s.min=e.parameter.min,s.max=e.parameter.max,s}}}},{key:"getJson",value:function(){return this.parameterLocks.map(function(e){return e.getJson()})}}]),e}(),ly=function(){function e(t,n,r,a,i){Object(s.a)(this,e),this.trackNumber=t,this.sendNumber=r,this.groupNumber=n,this.effectNumber=a,this.parameter=i}return Object(o.a)(e,[{key:"getJson",value:function(){var e={parameter:this.parameter.getJson(),effectNumber:this.effectNumber};return void 0!==this.trackNumber&&(e.trackNumber=this.trackNumber),void 0!==this.groupNumber&&(e.groupNumber=this.groupNumber),void 0!==this.sendNumber&&(e.sendNumber=this.sendNumber),e}}]),e}(),fy=uy,hy=(n(66),n(67),new Um.a(0),n(570));function py(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return dy(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dy(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function dy(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function vy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var my=function(e){Object(u.a)(n,e);var t=vy(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Object(s.a)(this,n),(r=t.call(this,e,"recorder-processor")).counter_=0,r.port.onmessage=r.handleMessage_.bind(Object(c.a)(r)),r.chunks=[],r.sendChannelCount(a),r.maxChunks=30,r.times=[],r.startedAt=void 0,r}return Object(o.a)(n,[{key:"_getBuffer",value:function(){var e,t=0,n=py(this.chunks);try{for(n.s();!(e=n.n()).done;){t+=e.value.recLength}}catch(p){n.e(p)}finally{n.f()}for(var r=[],a=0;a<2;a++){var i,s=new Float32Array(t),o=0,c=py(this.chunks);try{for(c.s();!(i=c.n()).done;){var u=i.value;if(!u.buffers[a])return;var l,f=py(u.buffers[a]);try{for(f.s();!(l=f.n()).done;){var h=l.value;s.set(h,o),o+=h.length}}catch(p){f.e(p)}finally{f.f()}}}catch(p){c.e(p)}finally{c.f()}r.push(s)}return r}},{key:"mergeBuffers",value:function(e,t){for(var n=new Float32Array(t),r=0,a=0;a<e.length;a++)n.set(e[a],r),r+=e[a].length;return n}},{key:"clear",value:function(){this.times=[],this._startedAt=void 0,this.startedAt=void 0,this.chunks=[],this.port.postMessage({message:"clear",contextTimestamp:this.context.currentTime})}},{key:"sendChannelCount",value:function(e){this.port.postMessage({message:"channel-count",count:e,contextTimestamp:this.context.currentTime})}},{key:"flush",value:function(){this.port.postMessage({message:"flush",contextTimestamp:this.context.currentTime})}},{key:"record",value:function(){this.startedAt=W.a.now(),this._startedAt=void 0,this.port.postMessage({message:"record",contextTimestamp:this.context.currentTime})}},{key:"stop",value:function(){this.port.postMessage({message:"stop",contextTimestamp:this.context.currentTime})}},{key:"getBuffer",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n){var r;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.startSliceTime=e._startedAt?e._startedAt-e.startedAt:0,(new Date).getTime(),e.chunks){t.next=4;break}return t.abrupt("return",void 0);case 4:e.waitingForFlush=!0,e.flush();case 6:if(!e.waitingForFlush){t.next=11;break}return t.next=9,e.sleep(1e3);case 9:t.next=6;break;case 11:(r=new Worker(window.isNFT?"mergerWorker.js":"/mergerWorker.js")).onmessage=function(t){e.chunks=[],e.buffer=void 0,n(t.data)},r.postMessage({chunks:e.chunks,isMobile:!1});case 14:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"sleep",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){setTimeout(function(){e()},t)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveChunk",value:function(e){if(this.chunks.length>=this.maxChunks){this.chunks.splice(0,1);var t=this.times.splice(0,1);this._startedAt=t[0]}0===this.chunks.length&&this.checkSilence(e.buffers),this.chunks.push(e),this.times.push(W.a.now())}},{key:"checkSilence",value:function(e){var t,n=0,r=py(e[0]);try{for(r.s();!(t=r.n()).done;){var a,i=py(t.value);try{for(i.s();!(a=i.n()).done;){if(0!==a.value)break;n++}}catch(s){i.e(s)}finally{i.f()}}}catch(s){r.e(s)}finally{r.f()}this.silenceLength=n/44100}},{key:"handleMessage_",value:function(e){var t=e.data.message;"get_buffer"===t.type?this.buffer=t.data:"chunk"!==t.type&&"flush"!==t.type||(this.saveChunk(t.data),"flush"===t.type&&(this.waitingForFlush=!1))}}]),n}(Object(hy.a)(AudioWorkletNode));function yy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var by=function(e){return function(e){Object(u.a)(n,e);var t=yy(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"startMetering",value:function(e){var t=this;this.meterInterval=setInterval(function(){var n=t.getMeter().getLevel();e.sendMessage("level",n<-80?0:Math.pow((n+80)/86,2))},20)}},{key:"startWaveforming",value:function(e){var t=this;this.meterInterval2=setInterval(function(){var n=t.getWaveform().getValue();e.sendMessage("level",n)},20)}},{key:"startFFTing",value:function(e){var t=this;this.meterInterval3=setInterval(function(){var n=t.getFFT().getValue();e.sendMessage("level",n)},20)}},{key:"stopMetering",value:function(){clearInterval(this.meterInterval),clearInterval(this.meterInterval2),clearInterval(this.meterInterval3)}},{key:"getMeter",value:function(){}},{key:"getWaveform",value:function(){}},{key:"getFFT",value:function(){}}]),n}(e)};function gy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Oy=function(e){Object(u.a)(n,e);var t=gy(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this)).sequencerEngine=e,r.output=new W.a.Volume,r.input=new W.a.Gain(1),r.meter=new W.a.Meter(.9),r.waveform=new W.a.Analyser({type:"waveform",size:256}),r.fft=new W.a.Analyser({type:"fft",size:256}),r.output.connect(r.meter),r.output.connect(r.waveform),r.output.connect(r.fft),r.effectsChain=new z.a(r.input,r.output,(new V.a).forSend(Object(c.a)(r)),e),r.effectsChain.setupEffects(),r}return Object(o.a)(n,[{key:"getMeter",value:function(){return this.meter}},{key:"getWaveform",value:function(){return this.waveform}},{key:"getFFT",value:function(){return this.fft}},{key:"getJson",value:function(){return this.effectsChain.getJson()}},{key:"fromJson",value:function(e){this.effectsChain.clear(),this.effectsChain.fromJson(e,this.sequencerEngine.tracks)}},{key:"dispose",value:function(){this.output.dispose(),this.input.dispose(),this.effectsChain.dispose(),this.output=void 0,this.input=void 0,this.effectsChain=void 0}},{key:"disconnect",value:function(e){this.output.disconnect(e)}},{key:"connect",value:function(e){this.output.connect(e)}},{key:"addEffect",value:function(e){this.effectsChain.addEffect(e),this.effectsChain.linkEffectParameters()}},{key:"moveEffectTo",value:function(e,t){this.effectsChain.moveEffectTo(e,t)}},{key:"deleteEffect",value:function(e){this.effectsChain.deleteEffect(e)}},{key:"copyFrom",value:function(e){this.effectsChain.fromJson(e.effectsChain.getJson(),void 0,void 0,!0)}}]),n}(by(function(){return function e(){Object(s.a)(this,e)}}())),ky=n(352),jy=n(345),wy=n(269),xy=(n(540),n(82),n(83),d.a.FilterEffect),Sy=function(){function e(t,n,r){Object(s.a)(this,e),this.input=n,this.output=r,this.sequencerEngine=t,this.eq=new ky.a(t,!1),this.auxSend=new W.a.Gain(0),this.getLowEQ().frequencyParameter.set(250),this.getMidEQ().frequencyParameter.set(1e3),this.getMidEQ().qParameter.set(.9),this.getHighEQ().frequencyParameter.set(3400),this.input.connect(this.eq.effectNode),this.eq.outputNode.connect(this.auxSend),this.hp=new xy(t,!1),this.hp.hipass(),this.lp=new xy(t,!1),this.lp.lowpass(),this.hp.cutoffFrequency=0,this.lp.cutoffFrequency=3e4,this.eq.connect(this.hp.effectNode),this.hp.connect(this.lp.effectNode),this.lp.connect(this.output)}return Object(o.a)(e,[{key:"resetFilters",value:function(){this.hp.cutoffFrequency=0,this.lp.cutoffFrequency=3e4}},{key:"filter",set:function(e){if(e>=.5){var t=(e-.5)/.5;this.hp.cutoffFrequency=1e4*Math.pow(t,4)+5,this.lp.cutoffFrequency=30040}else{var n=e/.5;this.hp.cutoffFrequency=5,this.lp.cutoffFrequency=3e4*Math.pow(n,4)+40}}},{key:"dispose",value:function(){this.eq.dispose(),this.auxSend.dispose(),this.hp.dispose(),this.lp.dispose(),this.auxSend=void 0,this.eq=void 0,this.input=void 0,this.output=void 0,this.hp=void 0,this.lp=void 0}},{key:"color",set:function(e){this.auxSend.gain.value=e}},{key:"getLowEQ",value:function(){return this.eq.equalizerPoints[0]}},{key:"getMidEQ",value:function(){return this.eq.equalizerPoints[4]}},{key:"getHighEQ",value:function(){return this.eq.equalizerPoints[7]}}]),e}(),Py=function(){function e(t){Object(s.a)(this,e),this.sequencerEngine=t,this.isMulti=!1,this.lazyConnections=[],this.ctxt=W.a.Master.context._context,this.ctxt.destination.maxChannelCount>=2&&(this.ctxt.destination.channelCount=this.ctxt.destination.maxChannelCount,this.ctxt.destination.channelCountMode="explicit",this.ctxt.destination.channelInterpretation="discrete"),this.masterChannel=new Oy(t),this.stereoOnly=t.stereoOnly,this.maxChannel=0,this.stereoConnected=!0,this.masterChannel.connect(W.a.Master),this.outputConnections=[],this.stereoOnly,this.setupAudioWorklet()}return Object(o.a)(e,[{key:"channelCount",get:function(){return this.multiMerger.numberOfInputs}},{key:"updateChannelCount",value:function(){W.a.Master.context._context.destination.maxChannelCount>=2&&(this.ctxt.destination.channelCount=this.ctxt.destination.maxChannelCount,this.ctxt.destination.channelCountMode="explicit",this.ctxt.destination.channelInterpretation="discrete")}},{key:"connectMixEffects",value:function(){this.mixEffects||(this.masterChannel.disconnect(),this.mixEffects=new Sy(this.sequencerEngine,this.masterChannel.output,W.a.Master))}},{key:"dispose",value:function(){this.mixEffects&&this.mixEffects.dispose(),this.masterChannel.dispose(),this.masterChannel=null}},{key:"setVolume",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.05;this.masterChannel.output.volume.exponentialRampToValueAtTime(e,t),this.sequencerEngine.store.dispatch(Object(C.dc)(this.sequencerEngine.getSequenceId(),e))}},{key:"numberOfChannels",value:function(){return this.stereoConnected?2:this.ctxt.destination.channelCount}},{key:"disconnect",value:function(e,t){e.disconnect()}},{key:"switchChannelOutput",value:function(e,t,n){if(this.stereoOnly||t>=this.numberOfChannels()||n>=this.numberOfChannels())return!1;var r=this.outputConnections.find(function(t){return t.output===e});return!!r&&(r.splitter.disconnect(),r.splitter.connect(this.multiMerger,0,t),n&&r.splitter.connect(this.multiMerger,1,n),!0)}},{key:"connect",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.maxChannel;if(e.connect(this.masterChannel.input),!this.stereoOnly){var r=function(){var r=W.a.Master.context.createChannelSplitter(2);e.connect(r);var a=n%t.channelCount,i=(n+1)%t.channelCount;return r.connect(t.multiMerger,0,a),r.connect(t.multiMerger,1,i),{splitter:r,output:e,leftChannel:a,rightChannel:i}};this.isMulti?this.outputConnections.push(r()):this.lazyConnections.push(r)}return[n%32,(n+1)%32]}},{key:"switchOutputs",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isMulti=t,t?(this.stereoOnly||(void 0===this.multiMerger&&(this.stereoOnly||(this.multiMerger=W.a.Master.context.createChannelMerger(32))),this.multiMerger.connect(W.a.Master),W.a.Master.channelCount=32,this.lazyConnections.forEach(function(t){e.outputConnections.push(t())}),this.lazyConnections=[]),this.stereoConnected&&this.masterChannel.disconnect(W.a.Master)):(this.masterChannel.connect(W.a.Master),this.stereoConnected||this.stereoOnly||this.multiMerger.disconnect(W.a.Master)),this.stereoConnected=!t}},{key:"setupAudioWorklet",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.sequencerEngine.isOffline&&!W.a.Master.context.isOffline){e.next=2;break}return e.abrupt("return");case 2:e.next=6;break;case 6:return t=W.a.Master.context._context,e.next=9,t.audioWorklet.addModule(window.isNFT?"RecorderWorklet.js":"/RecorderWorklet.js");case 9:this.recorderWorklet=new my(W.a.Master.context._context,2),this.masterChannel.output.connect(this.recorderWorklet);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),Ey=new(function(){function e(){Object(s.a)(this,e),this.channelMixers=[]}return Object(o.a)(e,[{key:"use",value:function(e){if(0===this.channelMixers.length||!window.explore)return new Py(e);var t=this.channelMixers.pop();return t.sequencerEngine=e,t.mixEffects&&(t.mixEffects.hp.cutoffFrequency=0,t.mixEffects.lp.cutoffFrequency=3e4),t}},{key:"release",value:function(e){this.channelMixers.push(e)}}]),e}());function Ty(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Ay(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return My(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return My(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function My(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ry(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Cy=["Mutate","Duration"],Ny=function(e){Object(u.a)(n,e);var t=Ry(n);function n(e,r,a,i,o,c){var u;return Object(s.a)(this,n),(u=t.call(this,e,r,a,i,o,c)).controlParameters=[],u}return Object(o.a)(n,[{key:"getName",value:function(){return"Z4 Control"}},{key:"getTrackType",value:function(){return D.g}},{key:"trigger",value:function(e,t,n){if(null!==e.mutate){var r,a={},i=Ay(this.controlParameters);try{for(i.s();!(r=i.n()).done;){var s=r.value,o=s.get();if(e.mutate<0?o+=.01*e.mutate*(o-s.min):o+=.01*e.mutate*(s.max-o),o<=s.max&&o>=s.min){var c=s.set(o,!0,!0,t),u=c.id,l=c.value;a[u]=l}}}catch(f){i.e(f)}finally{i.f()}this.store.dispatch(Object(C.ub)(a))}}},{key:"triggerRelease",value:function(e){}},{key:"getStepDataParams",value:function(){return Cy}}]),n}(rt),qy=n(301);function Iy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var _y=function(e){Object(u.a)(n,e);var t=Iy(n);function n(e,r,a){var i;return Object(s.a)(this,n),(i=t.call(this)).sequencerEngine=e,i.store=e.store,i.mixSession=r,i.context=a,i.synth=new W.a.MetalSynth,i.setupParameters(),i}return Object(o.a)(n,[{key:"getInstrumentType",value:function(){return U.e}},{key:"getName",value:function(){return"Metal Synth"}},{key:"setupParameters",value:function(){var e=this;this.frequencyParameter=new re.a("Frequency",this,function(t,n){return e.synth.frequency.value=n},{min:0,max:15e3,unit:"",defaultValue:200}),this.registerParameter(this.frequencyParameter),this.resonanceParameter=new re.a("Resonance",this,function(t,n){return e.synth.resonance=n},{min:0,max:1e4,unit:"",defaultValue:100}),this.registerParameter(this.resonanceParameter),this.harmonicityParameter=new re.a("Harmonicity",this,function(t,n){return e.synth.harmonicity=n},{min:0,max:200,unit:"",defaultValue:100}),this.registerParameter(this.harmonicityParameter),this.modulationIndexParameter=new re.a("Modulation Index",this,function(t,n){return e.synth.modulationIndex=n},{min:0,max:200,unit:"",defaultValue:20}),this.registerParameter(this.modulationIndexParameter),this.attackParameter=new re.a("Attack",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.attackParameter),this.decayParameter=new re.a("Decay",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:200}),this.registerParameter(this.decayParameter),this.sustainParameter=new re.a("Sustain",this,function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),this.registerParameter(this.sustainParameter),this.releaseParameter=new re.a("Release",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:1e3}),this.registerParameter(this.releaseParameter)}},{key:"frequency",get:function(){return this.frequencyParameter.get()},set:function(e){this.frequencyParameter.set(e)}},{key:"resonance",get:function(){return this.resonanceParameter.get()},set:function(e){this.resonanceParameter.set(e)}},{key:"harmonicity",get:function(){return this.harmonicityParameter.get()},set:function(e){this.harmonicityParameter.set(e)}},{key:"modulationIndex",get:function(){return this.modulationIndexParameter.get()},set:function(e){this.modulationIndexParameter.set(e)}},{key:"ampAttack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"ampDecay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"ampSustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"ampRelease",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"setEnvelopes",value:function(e){var t=this,n=this.getEnvelopes();n.forEach(function(e){return e.attack=new W.a.Time((1+t.ampAttack)/1e3)}),n.forEach(function(e){return e.release=new W.a.Time((1+t.ampRelease)/1e3)}),n.forEach(function(e){return e.sustain=t.ampSustain}),n.forEach(function(e){return e.decay=new W.a.Time((1+t.ampDecay)/1e3)})}},{key:"getInstrument",value:function(){return this.synth}},{key:"getEnvelopes",value:function(){return[this.synth.envelope]}},{key:"hasNotes",value:function(){return!1}},{key:"getJson",value:function(){var e=Object(p.a)({},Object(ne.a)(Object(f.a)(n.prototype),"getJson",this).call(this),{frequency:this.frequency,resonance:this.resonance,harmonicity:this.harmonicity,modulationIndex:this.modulationIndex,ampAttack:this.ampAttack,ampDecay:this.ampDecay,ampSustain:this.ampSustain,ampRelease:this.ampRelease});return e=Object(ee.b)(e,"frequencyParameter",this.frequencyParameter),e=Object(ee.b)(e,"resonanceParameter",this.resonanceParameter),e=Object(ee.b)(e,"harmonicityParameter",this.harmonicityParameter),e=Object(ee.b)(e,"modulationIndexParameter",this.modulationIndexParameter),e=Object(ee.b)(e,"attackParameter",this.attackParameter),e=Object(ee.b)(e,"decayParameter",this.decayParameter),e=Object(ee.b)(e,"sustainParameter",this.sustainParameter),e=Object(ee.b)(e,"releaseParameter",this.releaseParameter)}},{key:"fromJson",value:function(e){this.frequency=e.frequency,this.resonance=e.resonance,this.harmonicity=e.harmonicity,this.modulationIndex=e.modulationIndex,this.ampAttack=e.ampAttack,this.ampDecay=e.ampDecay,this.ampSustain=e.ampSustain,this.ampRelease=e.ampRelease,Object(ee.a)(e,"frequencyParameter",this.frequencyParameter),Object(ee.a)(e,"resonanceParameter",this.resonanceParameter),Object(ee.a)(e,"modulationIndexParameter",this.modulationIndexParameter),Object(ee.a)(e,"harmonicityParameter",this.harmonicityParameter),Object(ee.a)(e,"attackParameter",this.attackParameter),Object(ee.a)(e,"decayParameter",this.decayParameter),Object(ee.a)(e,"sustainParameter",this.sustainParameter),Object(ee.a)(e,"releaseParameter",this.releaseParameter)}}]),n}(Z);function Dy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Fy=function(e){Object(u.a)(n,e);var t=Dy(n);function n(e,r,a,i,o,u){var l;return Object(s.a)(this,n),(l=t.call(this,e,r,a,i,o,u)).setInstrument(new _y(r,a,(new V.a).forTrack(Object(c.a)(l)))),l}return n}(lt),Ly=n(38);function By(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return zy(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zy(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function zy(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Jy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Vy=["A","B","C","D","E","F","G","H"],Hy=function(){function e(t,n,r){Object(s.a)(this,e),this.sends=[],this.channelMixer=n,this.sequencerEngine=r,this.masterBus=new Uy("Master Bus",void 0,void 0,void 0,r);var a=new Uy("A",this.masterBus,n,0,r),i=new jy.a(r);i.enable(!0),i.setWet(1),a.addEffect(i);var o=new Uy("B",this.masterBus,n,1,r),c=new wy.a(r);c.enable(!0),c.setWet(1),o.addEffect(c),this.sends.push(a),this.sends.push(o),a.setSends(this),o.setSends(this)}return Object(o.a)(e,[{key:"createNewSend",value:function(e){var t=new Uy(Vy[this.sends.length],this.masterBus,this.channelMixer,this.sends.length,this.sequencerEngine,e);for(var n in t.setSends(this),this.sends.push(t),this.sequencerEngine.subSequences){var r=this.sequencerEngine.subSequences[n];for(var a in r.tracks)r.tracks[a].newSend(t)}return t}},{key:"dispose",value:function(){this.sends.forEach(function(e){return e.dispose()}),this.masterBus.dispose(),this.sends=void 0}},{key:"deleteSends",value:function(e){this.sends=this.sends.filter(function(t){return!e.includes(t)}),e.map(function(e){return e.dispose()})}},{key:"getSends",value:function(){return this.sends}},{key:"getJson",value:function(){return this.sends.map(function(e){return e.getJson()})}},{key:"loadFromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=0;case 1:if(!(r<t.length)){e.next=12;break}if(i=t[r],void 0===n||void 0!==i.pad){e.next=5;break}return e.abrupt("continue",9);case 5:return s=r,(i.pad||r>=this.sends.length)&&(this.createNewSend(),s=this.sends.length-1),e.next=9,this.sends[s].fromJson(i);case 9:r++,e.next=1;break;case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"copyFrom",value:function(e){var t=this;for(var n in e.sends){var r=e.sends[n].effects.map(function(e){return e.getEffectCopy(t.sequencerEngine,!1)});this.sends[n]||this.createNewSend(),this.sends[n].replaceEffects(r)}}}]),e}(),Uy=function(e){Object(u.a)(n,e);var t=Jy(n);function n(e,r,a,i,o,u){var l;return Object(s.a)(this,n),(l=t.call(this)).name=e,l.sequencerEngine=o,l.sendNumber=i,l.inputVolume=new W.a.Volume(0),l.outputVolume=new W.a.Volume(0),l.muteableNode=new W.a.Volume(0),l.muteableNode.connect(l.outputVolume),l.meter=new W.a.Meter(.9),l.muteableNode.connect(l.meter),l.pad=u,l.tracks=[],l.muted=!1,l.effectsChain=new z.a(l.inputVolume,l.muteableNode,(new V.a).forSend(Object(c.a)(l)),o),void 0===r?l.inputVolume.connect(l.outputVolume):l.outputs=a.connect(l.outputVolume),l.sendNodes=[],l.channelMixer=a,l}return Object(o.a)(n,[{key:"getMeter",value:function(){return this.meter}},{key:"outputNode",get:function(){return this.outputVolume}},{key:"dispose",value:function(){this.inputVolume.dispose(),this.outputVolume.dispose(),this.muteableNode.dispose(),this.effectsChain.dispose(),this.effectsChain=void 0,this.inputVolume=void 0,this.outputVolume=void 0,this.muteableNode=void 0,this.effectsChain=void 0}},{key:"newSend",value:function(e){var t=new W.a.Volume(-100);this.outputVolume.connect(t),e.connectToTrack(t),this.sendNodes.push(t)}},{key:"getSendNodes",value:function(){return this.sendNodes}},{key:"setSends",value:function(e){this.sends=e}},{key:"moveEffectTo",value:function(e,t){this.effectsChain.moveEffectTo(e,t)}},{key:"deleteEffect",value:function(e){this.effectsChain.deleteEffect(e)}},{key:"mute",value:function(e){this.muted=e,this.muteableNode.volume.value=e?-120:0}},{key:"updateEffects",value:function(){this.effectsChain.updateEffects()}},{key:"getVolume",value:function(){return this.outputVolume.volume.value}},{key:"setVolume",value:function(e){this.outputVolume.volume.value=e}},{key:"connectToTrack",value:function(e,t){(t=t||!1)&&e.disconnect(this.inputVolume),e.connect(this.inputVolume)}},{key:"getEffects",value:function(){return this.effectsChain.effects}},{key:"getName",value:function(){return this.name}},{key:"addEffect",value:function(e){this.effectsChain.addEffect(e),this.effectsChain.linkEffectParameters()}},{key:"getLastEffect",value:function(){return 0==this.effectsChain.effects.length?this.inputVolume:this.effectsChain.effects[this.effectsChain.effects.length-1]}},{key:"getJson",value:function(){return{pad:this.pad?this.pad.id:void 0,volume:this.getVolume(),effectsChain:this.effectsChain.getJson(),outputs:this.outputs}}},{key:"replaceEffects",value:function(e){var t=this;this.effectsChain.clear(),e.map(function(e){return t.effectsChain.addEffect(e)})}},{key:"effects",get:function(){return this.effectsChain.effects}},{key:"fromJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setVolume(t.volume),n=[],this.effectsChain.effects.forEach(function(e){return e.dispose()}),this.effectsChain.effects=[],n=t.effectsChain?t.effectsChain:t.effects,this.effectsJson=n,t.outputs&&(r=Object(ea.a)(t.outputs,2),i=r[0],s=r[1],this.channelMixer.switchChannelOutput(this.outputNode,i,s)&&(this.outputs=[i,s])),t.pad&&(t.pad,this.padId=t.pad);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"hookupPads",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s,o=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pad){e.next=2;break}return e.abrupt("return",!0);case 2:if(this.padId){e.next=6;break}return e.next=5,this.loadEffectsJson();case 5:return e.abrupt("return",!0);case 6:t=void 0,n=By(this.sequencerEngine.subSequences),e.prev=8,n.s();case 10:if((r=n.n()).done){e.next=19;break}if(i=r.value,!(s=i.pads.find(function(e){return e.id===o.padId}))){e.next=17;break}return this.pad=s,t=s,e.abrupt("break",19);case 17:e.next=10;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(8),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:return t&&this.sequencerEngine.switchToSubSequence(t.subSequence.id),e.next=30,this.loadEffectsJson();case 30:return t&&(this.pad.effectRack=this.effects[0],this.pad.send=this,this.pad.syncTracksToEffects(),this.pad.updateEffectRedux()),e.abrupt("return",void 0!==t);case 32:case"end":return e.stop()}},e,this,[[8,21,24,27]])}));return function(){return e.apply(this,arguments)}}()},{key:"loadEffectsJson",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._loaded){e.next=2;break}return e.abrupt("return");case 2:for(r in t=this.effectsJson,n={},t)i=Object(J.a)(t[r],void 0,this.sequencerEngine,void 0,this.pad&&(new V.a).forSubSequence(this.pad.subSequence)),this.effectsChain.addEffect(i.effect),n=Object(p.a)({},n,i.bulk);this.sequencerEngine.store.dispatch(Object(C.ub)(n)),this._loaded=!0;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(by(function(){return function e(){Object(s.a)(this,e)}}())),Gy=Hy,Wy=function(){function e(t){Object(s.a)(this,e),this.store=t,this.input=void 0,W.a.Master.context.isOffline||(this.setupRecording(),this.splitter=void 0,this.init(),this.deviceId=void 0)}return Object(o.a)(e,[{key:"init",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.explore&&!window.isNFT){e.next=2;break}return e.abrupt("return");case 2:if(void 0===(t=!window.isNFT&&w.a.getItem("deviceId"))){e.next=16;break}if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=7;break}return console.log("no enumerate"),e.abrupt("return");case 7:return e.next=9,navigator.mediaDevices.enumerateDevices();case 9:if(!e.sent.some(function(e){return e.deviceId===t})){e.next=16;break}return e.next=13,navigator.mediaDevices.getUserMedia({audio:{deviceId:t,echoCancellation:!1}});case 13:n=e.sent,console.log("STREAM=",n),this.newInputSource(n,t);case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getInputChannels",value:function(){return void 0===this.input?[]:[1,2]}},{key:"connect",value:function(e,t){1==t?this.splitter.left.connect(e):this.splitter.right.connect(e)}},{key:"disconnect",value:function(e,t){1==t?this.splitter.left.disconnect():this.splitter.right.disconnect()}},{key:"getRecorder",value:function(){return new window.Recorder(this.input,{numChannels:1,bufferLen:1024})}},{key:"newInputSource",value:function(e,t){this.input&&this.splitter,this.startUserMedia(e),t&&(this.deviceId=t),this.store.dispatch(Object(C.F)(t))}},{key:"startUserMedia",value:function(e){W.a.Master.context.isOffline||(this.input=this.audioContext.createMediaStreamSource(e),this.monitorVolume=new W.a.Gain(1),this.splitter=new W.a.Split,this.input.chain(this.monitorVolume,this.splitter))}},{key:"dispose",value:function(){this.splitter&&this.splitter.dispose(),this.input&&this.input.disconnect(),this.input=void 0,this.splitter=void 0}},{key:"setupRecording",value:function(){var e=this;if(!(W.a.Master.context.isOffline||window.explore||window.isNFT||window.spores)){try{window.AudioContext=W.a.Master.context,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,window.URL=window.URL||window.webkitURL,this.audioContext=W.a.Master.context}catch(t){}void 0!==navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({audio:{mandatory:{echoCancellation:!1}}}).then(function(t){return e.startUserMedia(t)}).catch(function(e){})}}}]),e}(),Ky=function(){function e(){Object(s.a)(this,e),this.latency=0}return Object(o.a)(e,[{key:"getLatency",value:function(){return this.latency}},{key:"setLatency",value:function(e){this.latency=e}}]),e}(),Qy=n(13),Zy=function(){function e(t){Object(s.a)(this,e),this.sequencerEngine=t}return Object(o.a)(e,[{key:"state",get:function(){return this.sequencerEngine.state}},{key:"execute",value:function(){}},{key:"undo",value:function(){}},{key:"roomName",get:function(){return"test"}},{key:"serialize",value:function(e,t){var n=Object(p.a)({},e);return n.payload=Object(p.a)({},n.payload),n.payload.track&&(n.payload.track.subSequence&&(n.payload.subSequence=n.payload.track.subSequence.id),n.payload.track=n.payload.track.trackNumber),n.contentId=this.getContentId(e),{type:"operation",operation:Object(p.a)({},n,{uuid:t,timestamp:Date.now()})}}},{key:"deserialize",value:function(e){var t=Object(p.a)({},e.payload);if(void 0!==t.track)if(void 0!==t.subSequence){var n=this.sequencerEngine.getSubSequence(t.subSequence);n&&(t.track=n.tracks[e.payload.track])}else t.track=this.sequencerEngine.tracks[e.payload.track];return e.payload.resolution&&(t.resolution=(new Tr.a).fromJson(e.payload.resolution)),Object(p.a)({},e,{payload:t})}},{key:"deserializeStep",value:function(e,t,n){var r=new F.a;return r.track=t,r.stepNumber=n,r.loadFromJson(e,t.effects,void 0,void 0,void 0,t,t.midiEffects),r.id=e.id,r}},{key:"getStepLocations",value:function(e,t,n){var r=e.getStepNumbers(t),a=[];for(var i in r){var s=r[i][0];a.push({id:s.id,transpose:s.transpose,stepNumber:n?r[i][1]+s.position:r[i][1]})}return a}},{key:"getStepsForStepNumbers",value:function(e,t){var n=t.getEasyPattern(),r=[],a=function(t){var a=e[t],i=n.getAllSteps().find(function(e){return e.id===a.id});i&&r.push(i)};for(var i in e)a(i);return r}},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(n,e);case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"getContentId",value:function(){return 0}},{key:"getDependentActions",value:function(){return[]}},{key:"dependsOn",value:function(e){return this.getDependentActions().indexOf(e)>-1}},{key:"conflictsWith",value:function(e,t){return this.dependsOn(t.type)&&e.contentId===t.contentId}}]),e}();function Yy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Xy=function(e){Object(u.a)(n,e);var t=Yy(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"serialize",value:function(e,t){var r=Object(ne.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.step=a.payload.step.getJson(),r}},{key:"deserialize",value:function(e){var t=Object(ne.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload,a=r.track;if(void 0!==a)return r.step=this.deserializeStep(r.step,a,r.stepNumber),t}}]),n}(Zy);function $y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var eb=function(e){Object(u.a)(n,e);var t=$y(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.step,r=e.stepNumber,a=e.resolution,i=void 0===a?ke.a.baseResolution:a,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=Math.floor(r);return t.sequencerEngine.resolution=i,t.getEasyPattern().deleteStepAtStepNumber(n,o,i,s),s?t.updateSteps():t.pattern.needsSync=!0,{}}},{key:"undo",value:function(e){new nb(this.sequencerEngine).execute(e.payload.track,e.payload.step,e.payload.stepNumber,e.payload.resolution),e.payload.track.updateSteps()}},{key:"getContentId",value:function(e){return e.payload.step.id}}]),n}(Xy);function tb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var nb=function(e){Object(u.a)(n,e);var t=tb(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.step,r=e.stepNumber,a=e.resolution,i=void 0===a?ke.a.baseResolution:a,s=e.displayResolution,o=void 0===s?ke.a.baseResolution:s,c=e.isRecording,u=void 0===c||c,l=e.isQuantized,f=void 0===l||l,h=e.slide,p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===t)return{};var d=Math.floor(r),v=r-d;n.slide=h;var m=t.getEasyPattern();return m.addStep(n,d,i,v,void 0,void 0,u),!f&&o.isTriplet&&m.update(),p&&this.updateRedux(n,d,v,t,i,o),{}}},{key:"state",get:function(){return this.sequencerEngine.store.getState()}},{key:"updateRedux",value:function(e,t,n,r,a,i){var s=i.transformStepAtResolution2(t+n,a);n=s-(t=Math.floor(s));var o=r.subSequence.isTrack?r.subSequence.id:r.id,c=Object(h.a)(this.state.tracks.trackSteps[o]||[]),u=Object(p.a)({},this.state.tracks.trackFills[o]||[]),l=Object(h.a)(this.state.tracks.trackStepIds[o]||[]),f=this.state.tracks.trackPianoRollSteps[o]||{},d=Object(p.a)({},this.state.tracks.trackPianoRollPositions[o]),v=this.state.tracks.trackPianoRollDurations[o]||{},m=this.state.tracks.trackPatternSteps[o]||{};f[e.transpose]=Object(p.a)({},f[e.transpose]),d[e.transpose]=Object(p.a)({},d[e.transpose]),v[e.transpose]=Object(p.a)({},v[e.transpose]),u=u||new Array(c.length).fill(!1),c[t]=!0,l[t]=e,m[r.currentPattern]=Object(h.a)(c),f[e.transpose][t]=!0,d[e.transpose][t]=n;var y=new Tr.a(16,!1);v[e.transpose][t]=a.transformStepAtResolution2(e.duration,y);for(var b=0;b<e.duration;b++)u[(b+t)%c.length]=!0;this.sequencerEngine.store.dispatch(Object(C.u)(o,c,f,u,l,d,v,m))}},{key:"undo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];new eb(this.sequencerEngine).execute(e.payload,t),t&&e.payload.track.updateSteps()}},{key:"getContentId",value:function(e){return e.payload.step.id}}]),n}(Xy);function rb(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ab(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ab(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ab(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ib(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var sb=function(e){Object(u.a)(n,e);var t=ib(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t,n=e.effect,r=e.parameters,a=(!(arguments.length>1&&void 0!==arguments[1])||arguments[1],{}),i=rb(r);try{for(i.s();!(t=i.n()).done;){var s=t.value;s.hasGroup&&(a[s.id]=s.hasGroup);var o=n._parameters.indexOf(s);n.unmapParameter(o)}}catch(c){i.e(c)}finally{i.f()}return{idToGroup:a}}},{key:"undo",value:function(e){var t=e.payload,n=t.parameters,r=t.idToGroup,a=t.effect;n.forEach(function(e){a.setParameter(e),r[e.id]&&(r[e.id]._parameters.push(e),e.hasGroup=r[e.id])})}}]),n}(Zy),ob=n(272);function cb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ub=function(e){Object(u.a)(n,e);var t=cb(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){e.effect,e.track,e.group,e.send}},{key:"undo",value:function(e){}},{key:"serialize",value:function(e,t){var r=Object(ne.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation,i=a.payload;return void 0!==i.group&&(i.group=i.group.groupNumber),void 0!==a.send&&(i.send=i.send.sendNumber),i.isMidiEffect=i.effect.isMidiEffect(),i.effect=i.effectJson,r}},{key:"deserialize",value:function(e){var t,r=Object(ne.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),a=r.payload,i=a.track||a.group||a.send;return a.isMidiEffect?void 0===(t=i.midiEffects.getEffectById(a.effect.id))&&(t=Object(ob.a)(a.effect,i)).fromJson(a.effect):void 0===(t=i.effectsChain.getEffectById(a.effect.id))&&(t=Object(ba.b)(a.effect.name,this.sequencerEngine)).fromJson(a.effect,this.sequencerEngine.tracks,a.track.trackNumber),a.effect=t,r}}]),n}(Zy);function lb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var fb=function(e){Object(u.a)(n,e);var t=lb(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.effect,n=e.track,r=e.group,a=e.send,i=n||r||a;t.isMidiEffect()?i.midiEffects.addEffect(t):i.effectsChain.addEffect(t)}}]),n}(ub);function hb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var pb=function(e){Object(u.a)(n,e);var t=hb(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.effect,n=e.track,r=e.group,a=e.send,i=n||r||a,s=t.getJson();switch(t.getEffectType()){case he.a:i.effectsChain.deleteEffect(t);break;case he.c:i.midiEffects.deleteEffect(t);break;case he.b:i.liveEffects.deleteEffect(t)}return this.sequencerEngine.selectEffect(void 0),{effectJson:s}}}]),n}(ub);function db(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var vb=function(e){Object(u.a)(n,e);var t=db(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.effect,n=e.track,r=e.group,a=e.send,i=n||r||a;t.toggleEnabled(),i&&!t.isMidiEffect()&&i.effectsChain&&i.effectsChain.updateEffects()}}]),n}(ub),mb=function(e){return e.deserialize=function(e){return Object(p.a)({},e,{operation:e})},e.serialize=function(e){return Object(p.a)({},e,{operation:e})},e.getContentId=function(e){return 1},e};function yb(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return bb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bb(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function bb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var gb=function(e,t,n){for(var r in t){var a,i=yb(t[r]);try{for(i.s();!(a=i.n()).done;){var s=a.value,o=s.node,c=s.type;e.connectInlet(r,o,c)}}catch(v){i.e(v)}finally{i.f()}}for(var u in n){var l,f=yb(n[u]);try{for(f.s();!(l=f.n()).done;){var h=l.value,p=h.node,d=h.type;p.connectInlet(d,e,u)}}catch(v){f.e(v)}finally{f.f()}}},Ob=(n(563),function(e,t,n){var r=t.state.windows,a=r.windowPositions,i=r.presentationWindowPositions,s=n?i:a,o={};for(var c in e)o[c]=s[c];return o}),kb={DELETE_PATCHER_EDGE:function(e){return mb(function(t){var n=t.sourceNode,r=t.sourceType,a=t.destNode,i=t.destType,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n=e.idToObject[n.id],a=e.idToObject[a.id],s?a.connectInlet(i,n,r):a.disconnectInlet(i,n,r)})},CONNECT_PATCHER_EDGE:function(e){return mb(function(t){var n=t.sourceNode,r=t.sourceType,a=t.destNode,i=t.destType,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n=e.idToObject[n.id],a=e.idToObject[a.id],s?a.disconnectInlet(i,n,r):a.connectInlet(i,n,r)})},DELETE_PATCHER_NODE:function(e){return mb(function(t){var n=t.node,r=t.subSequence,a=t.objectJson,i=t.inbound,s=t.outbound,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n=e.idToObject[n.id],!o){var c=n.subSequence,u=n.getJson(),l=n.getInboundNodes(),f=n.getOutboundNodes();return n.delete(),{subSequence:c,objectJson:u,inbound:l,outbound:f}}var h=r.createZObject(void 0,void 0,void 0,!1);h.fromJson(a),gb(h,i,s)})},SET_PATCHER_WINDOW_POSITIONS:function(e){return mb(function(t,n){var r=t.positions,a=t.isPresentationMode,i=t.savedPositions;if(!n){var s=Ob(r,e,a);return a?e.dispatch(Object(C.L)(r)):e.dispatch(Object(C.M)(r)),{savedPositions:s}}a?e.dispatch(Object(C.L)(i)):e.dispatch(Object(C.M)(i))})}};function jb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wb=function(e){Object(u.a)(n,e);var t=jb(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.from,n=e.to,r=e.isMidiEffect,a=void 0!==r&&r,i=e.track,s=e.group,o=e.send,c=i||s||o;a?c.midiEffects.moveEffectTo(t,n):c.effectsChain.moveEffectTo(t,n),i&&i.updateSteps()}},{key:"undo",value:function(e){}},{key:"serialize",value:function(e,t){var r=Object(ne.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation,i=a.payload;return void 0!==i.group&&(i.group=i.group.groupNumber),void 0!==a.send&&(i.send=i.send.sendNumber),r}}]),n}(Zy);function xb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Sb=function(e){Object(u.a)(n,e);var t=xb(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.stepNumber,r=e.resolution,a=void 0===r?ke.a.baseResolution:r,i=t.getEasyPattern(),s=i.getStepsAtStepNumber(n,a),o=s.map(function(e){return Object(p.a)({},e,{step:e.step.getCopy()})});return i.deleteSteps(s.map(function(e){return e.step})),t.updateSteps(),{stepsDeleted:o}}},{key:"undo",value:function(e){}}]),n}(Zy);function Pb(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Eb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Eb(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Eb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Tb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ab=0,Mb=function(e){Object(u.a)(n,e);var t=Tb(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.steps,r=e.transformation,a=e.resolution,i=void 0===a?ke.a.baseResolution:a,s=e.wrap,o=void 0===s||s,c=e.isPianoRoll,u=void 0!==c&&c,l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return{};var p=t.getEasyPattern(),d=p.getStepNumbers(n,i).filter(function(e){return e[0]}),v=new Set(d.filter(function(e){return e&&e[0]}).map(function(e){return e[0].transpose})),m=t.getEasyPattern().transformSteps(n,d,r,i,o,u),y=new Set(m.filter(function(e){return e}).map(function(e){return e.transpose}));if(l)if(f){var b=++Ab;setTimeout(function(){b===Ab&&t.updateSteps(!u,!0,i.isTriplet)},50)}else u&&this.sequencerEngine.state.sequencer.displayResolution.isTriplet&&p.update(),u||i.isTriplet||t.getEasyPattern().pattern.syncMatrix(),u?this.updateReduxForRows(v,y,t,i.isTriplet):t.updateSteps(!u&&i.isTriplet,!0,i.isTriplet);var g=this.sequencerEngine.store.getState().keyboard.selectedPianoRollSteps;if(l&&!f&&g){var O=function(e){if(g[e]){var t=m.find(function(t){return t&&t.id===g[e].id});g[e]=t}};for(var k in g)O(k);this.sequencerEngine.store.dispatch(Object(C.rd)(Object(h.a)(g)))}return{stepNumbers:d}}},{key:"updateReduxForRows",value:function(e,t,n,r){if(n){var a,i=n.id,s=Object(p.a)({},this.state.tracks.trackPianoRollSteps[i]),o=Object(p.a)({},this.state.tracks.trackPianoRollPositions[i]),c=Object(p.a)({},this.state.tracks.trackPianoRollDurations[i]),u=n.getEasyPattern().pattern.getUpdateStepsAction(r),l=Pb([].concat(Object(h.a)(Array.from(e)),Object(h.a)(Array.from(t))));try{for(l.s();!(a=l.n()).done;){var f=a.value;s[f]=u.pianoRollSteps[f],c[f]=u.pianoRollDurations[f],o[f]=u.pianoRollPositions[f]}}catch(v){l.e(v)}finally{l.f()}var d=this.state.tracks.trackPatternSteps[i]||{};d[n.currentPattern]=u.steps,this.sequencerEngine.store.dispatch(Object(C.u)(i,u.steps,s,u.trackFills,u.stepToId,o,c,d))}}},{key:"undo",value:function(e){var t=Object(p.a)({},e.payload.transformation);t.stepDifference=-1*t.stepDifference,t.transposeDifference=-1*t.transposeDifference,this.execute(Object(p.a)({},e.payload,{transformation:t}))}},{key:"serialize",value:function(){var e=Object(i.a)(a.a.mark(function e(t,r){var i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(ne.a)(Object(f.a)(n.prototype),"serialize",this).call(this,t,r),(s=i.operation).payload.steps=s.payload.steps.filter(function(e){return e}).map(function(e){return e.id}),s.payload.stepNumbers=s.payload.stepNumbers.filter(function(e){var t=Object(ea.a)(e,2),n=t[0];t[1];return n}).map(function(e){var t=Object(ea.a)(e,2),n=t[0],r=t[1];return[n.id,r]}),e.abrupt("return",i);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserialize",value:function(e){var t=Object(ne.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload,a=r.track;if(void 0!==a){var i=r.steps;return r.steps=this.getStepsForStepNumbers(i.map(function(e){return{id:e}}),a,ke.a.baseResolution),t}}},{key:"getContentId",value:function(e){return e.payload.steps.map(function(e){return e&&e.id})}}]),n}(Zy);function Rb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Cb=function(e){Object(u.a)(n,e);var t=Rb(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.steps,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===t)return{stepsDeleted:[]};var a=t.getEasyPattern().getStepNumbers(n,ke.a.baseResolution);return t.getEasyPattern().deleteSteps(n),r&&t.updateSteps(),t.sequencerEngine.dispatch(Object(C.rd)(void 0)),{stepsDeleted:a}}},{key:"undo",value:function(e){var t=new nb(this.sequencerEngine),n=e.payload.stepsDeleted;for(var r in n)t.execute({track:e.payload.track,step:n[r][0],stepNumber:n[r][1],resolution:ke.a.baseResolution});e.payload.track.updateSteps()}},{key:"serialize",value:function(e,t){var r=Object(ne.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.steps=a.payload.steps.map(function(e){return e.getJson()}),a.payload.stepsDeleted=a.payload.stepsDeleted.map(function(e){var t=Object(ea.a)(e,2),n=t[0],r=t[1];return[n.getJson(),r]}),r}},{key:"deserialize",value:function(e){var t=this,r=Object(ne.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),a=r.payload,i=a.track;if(void 0!==i){var s=a.steps.map(function(e){return t.deserializeStep(e,i,e.stepNumber)});return a.steps=this.getStepsForStepNumbers(s,i,ke.a.baseResolution),r}}},{key:"getContentId",value:function(e){return e.payload.steps.map(function(e){return e&&e.id})}}]),n}(Zy);function Nb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var qb=function(e){Object(u.a)(n,e);var t=Nb(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.steps,r=e.stepNumber,a=e.resolution,i=void 0===a?ke.a.baseResolution:a,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===t)return{steps:[]};t.instrumentTrack&&(t=t.instrumentTrack);var o=t.getEasyPattern().pattern.getStepResolutionTree(i.isTriplet).search(r,i).toggle(n&&n[0]?n[0].stepBucket.steps[0].id:void 0);return t.pattern.syncMatrix(),s&&(t.pattern.syncBucketsAtStep(r,i),t.updateSteps(void 0,!0)),t.pattern.needsSync=!0,{steps:o}}},{key:"undo",value:function(e){var t=e.payload.track.getEasyPattern();if(void 0!==e.payload.steps){var n=e.payload.resolution.isTriplet?t.pattern.tripletStepBuckets:t.pattern.stepBuckets;for(var r in e.payload.steps){var a=e.payload.steps[r];n[a.stepNumber]=a.stepBucket}}t.update(e.payload.resolution.isTriplet),e.payload.track.updateSteps()}},{key:"serialize",value:function(e,t){var r=Object(ne.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.steps&&(a.payload.steps=a.payload.steps.map(function(e){return Object(p.a)({},e,{stepBucket:e.stepBucket.getJson()})})),r}},{key:"deserialize",value:function(e){var t=Object(ne.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload;if(void 0!==r.track){var a=r.track,i=[];if(e.payload.steps)for(var s in e.payload.steps){var o=e.payload.steps[s],c=o.stepBucket,u=o.stepNumber,l=new L.a(a,c.isTriplet);for(var h in c){var p=c[h],d=new F.a;d.track=a,d.stepNumber=u,d.loadFromJson(p,a.effects,void 0,void 0,void 0,a,a.midiEffects),d.id=p.id,l.steps[h]=d}i.push({stepNumber:u,stepBucket:l})}return r.steps=i,t}}},{key:"getContentId",value:function(e){return e.payload.steps[0].id}}]),n}(Zy);function Ib(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var _b=function(e){Object(u.a)(n,e);var t=Ib(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.patternNumber,n=this.sequencerEngine.tracks.map(function(e){return e.patterns[t]});return this.sequencerEngine.deletePattern(t),{patterns:n,patternNumber:t}}},{key:"undo",value:function(e){var t=e.payload.patterns,n=e.payload.patternNumber;for(var r in t){var a=this.sequencerEngine.tracks[r],i=a.patterns.slice(0,n).concat([t[r]]).concat(a.patterns.slice(n));a.patterns=i,a.switchToPattern(a.currentPattern),a.updateSteps()}this.sequencerEngine.store.dispatch(Object(C.nc)(this.sequencerEngine.numberOfPatterns()))}}]),n}(Zy);function Db(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Fb=function(e){Object(u.a)(n,e);var t=Db(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.track,r=e.step,a=e.stepNumber,i=e.resolution,s=void 0===i?ke.a.baseResolution:i,o=e.displayResolution,c=void 0===o?ke.a.baseResolution:o,u=e.isQuantized,l=void 0===u||u,h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(ne.a)(Object(f.a)(n.prototype),"execute",this).call(this,{track:t,step:r,stepNumber:a,resolution:s,isRecording:!0,displayResolution:c,isQuantized:l},h)}}]),n}(nb);function Lb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Bb=0,zb=function(e){Object(u.a)(n,e);var t=Lb(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.track,n=(e.step,e.parameter),r=e.value,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=n.get();if(n.set(r),a)if(i){var o=++Bb;setTimeout(function(){o===Bb&&t.updateSteps()},50)}else t.updateSteps();return{previousValue:s}}},{key:"state",get:function(){return this.sequencerEngine.store.getState()}},{key:"undo",value:function(e){var t=e.payload;this.execute(Object(p.a)({},t,{value:t.savedValue}))}},{key:"serialize",value:function(e,t){var r=Object(ne.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.step=a.payload.step.id,a.payload.parameter=a.payload.parameter.name,r}},{key:"deserialize",value:function(e){var t=Object(ne.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload,a=r.track;if(void 0!==a&&(r.step=this.getStepsForStepNumbers([{id:r.step}],a)[0],void 0!==r.step))return r.parameter=r.step.parameters.find(function(e){return e.name===r.parameter}),t}},{key:"getContentId",value:function(e){return[e.payload.parameter.id,e.payload.step.id]}}]),n}(Zy);function Jb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Vb=function(e){Object(u.a)(n,e);var t=Jb(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"serialize",value:function(e,t){var r=Object(ne.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation.payload;if(a.parameter){var i=a.parameter,s=i.id,o=i.context,c=i.name;a.parameter={id:s,context:o&&o.getJson(),name:c}}if(a.automation){var u=a.automation.parameter;u&&(a.parameter=u.getJson()),a.automation=a.automation.id}return r}},{key:"deserialize",value:function(e){var t=Object(ne.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload,a=r.parameter,i=(a.id,a.name),s=a.context;if(void 0!==s.track&&(r.track=this.sequencerEngine.tracks[s.track]),void 0!==s.subTrack&&(r.track=r.track.tracks[s.subTrack].track),void 0!==s.midiEffect){if(r.track){var o=r.track.midiEffects.effects[s.midiEffect].parameters.find(function(e){return e.name===i});r.parameter=o||void 0}}else if(void 0!==s.effect&&-1!==s.effect){if(r.track){var c=r.track.effects[s.effect];s.subDevice&&(c=c.getSubDevice(s.subDevice)),s.macro&&(c=c.macros.find(function(e){return e.id===s.macro}));var u=c.getParameters().find(function(e){return e.name===i});r.parameter=u||void 0}}else if(s.isInstrument)if(r.instrument=r.track.instrument,s.subDevice){var l=r.instrument.getSubDevice(s.subDevice);r.parameter=l.parameters.find(function(e){return e.name===i})}else r.parameter=r.instrument.parameters.find(function(e){return e.name===i});else r.parameter=void 0;return r.automation&&r.parameter&&(r.automation=r.parameter.unlockedAutomation),t}},{key:"getContentId",value:function(e){var t=e.payload;return t.point?t.point.id:t.parameter?t.parameter.id:0}}]),n}(Zy);function Hb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ub=function(e){Object(u.a)(n,e);var t=Hb(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.parameter,n=e.value,r=e.automation,a=void 0!==r&&r,i=e.isBulk,s=void 0!==i&&i;void 0!==t&&t.set(n,a,s)}},{key:"undo",value:function(e){var t=e.payload;t.parameter.set(t.savedValue)}},{key:"getContentId",value:function(e){return e.payload.parameter.id}}]),n}(Vb);function Gb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Wb=function(e){Object(u.a)(n,e);var t=Gb(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.steps,r=e.resolution,a=void 0===r?ke.a.baseResolution:r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=t.getEasyPattern(),o=s.getStepNumbers(n,a);for(var c in o){var u=o[c][0];u&&(o[c][1]=o[c][1]+u.position,o[c][0]=u.id)}var l=this.getStepLocations(s,n,!0);s.snapToGrid(n,a);var f=this.getStepLocations(s,n,!1);for(var h in f)f[h].stepDifference=f[h].stepNumber-l[h].stepNumber,f[h].transposeDifference=f[h].transpose-l[h].transpose;return i&&(a.isTriplet?t.updateSteps(void 0,void 0,!0):t.updateSteps()),{stepNumbers:o,stepLocations:f}}},{key:"undo",value:function(e){var t=e.payload,n=t.stepNumbers,r=t.steps,a=t.track,i=t.resolution,s=a.getEasyPattern().getStepNumbers(r,i),o=new Mb(this.sequencerEngine);for(var c in s){var u=s[c][1],l=n[c][1],f=(r[c],{stepDifference:l-u,transposeDifference:0});o.execute({track:a,steps:r,transformation:f,resolution:i})}}},{key:"serialize",value:function(e,t){var r=Object(ne.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.steps=a.payload.steps.map(function(e){return e.getJson()}),r}},{key:"deserialize",value:function(e){var t=this,r=Object(ne.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e),a=r.payload,i=a.track;if(void 0!==i){var s=a.steps.map(function(e){return t.deserializeStep(e,i,e.stepNumber)});return a.steps=this.getStepsForStepNumbers(s,i,ke.a.baseResolution),r}}},{key:"getContentId",value:function(e){return e.payload.steps.map(function(e){return e.id})}}]),n}(Zy);function Kb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Qb=function(e){Object(u.a)(n,e);var t=Kb(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.value;t&&!isNaN(n)&&t.setVolume(n)}}]),n}(Zy);function Zb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Yb=function(e){Object(u.a)(n,e);var t=Zb(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.mute;t&&t.mute(n)}}]),n}(Zy);function Xb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var $b=function(e){Object(u.a)(n,e);var t=Xb(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.step,r=e.value,a=e.pointId;return{point:t.addBreakPoint(n,r,a)}}},{key:"undo",value:function(e){var t=e.payload;t.automation.removeBreakPoint(t.point)}}]),n}(Vb);function eg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var tg=function(e){Object(u.a)(n,e);var t=eg(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.point;t.removeBreakPoint(n)}},{key:"undo",value:function(e){var t=e.payload;t.automation.addBreakPoint(t.point.step,t.point.value,t.point.id)}}]),n}(Vb);function ng(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var rg=function(e){Object(u.a)(n,e);var t=ng(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.points;t.removeBreakPoints(n)}},{key:"undo",value:function(e){var t=e.payload,n=t.automation;t.points.forEach(function(e){return n.addBreakPoint(e.step,e.value,e.id)})}}]),n}(Vb);function ag(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ig=function(e){Object(u.a)(n,e);var t=ag(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.point,r=e.step,a=e.value;t.movePoint(n,r,a)}},{key:"undo",value:function(e){var t=e.payload;this.execute(Object(p.a)({},t,{step:t.savedStep,value:t.savedValue}))}}]),n}(Vb);function sg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var og=function(e){Object(u.a)(n,e);var t=sg(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.points,r=e.stepDiff,a=e.valueDiff;t.movePoints(n,r,a)}}]),n}(Vb);function cg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ug=function(e){Object(u.a)(n,e);var t=cg(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.point,r=n.getJson?n.getJson():n;return t.quantizePoint(n),{savedPoint:r}}},{key:"undo",value:function(e){var t=e.payload;t.automation.movePoint(t.point,t.savedPoint.step,t.savedPoint.value)}}]),n}(Vb);function lg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function fg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hg=function(e){Object(u.a)(n,e);var t=fg(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.value,r=e.oldValue;return{points:t.record(n,r),automation:t}}},{key:"undo",value:function(e){var t=e.payload;t.points.forEach(function(e){return t.automation.removeBreakPoint(e)})}}]),n}(function(e){Object(u.a)(n,e);var t=lg(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"serialize",value:function(e,t){var r=Object(ne.a)(Object(f.a)(n.prototype),"serialize",this).call(this,e,t);if(void 0===(e=e.payload))return r;var a=e.automation;if(void 0===a)return r;var i=a.parameter;return r.automation=a.id,r.parameter=i,r}},{key:"deserialize",value:function(e){var t=Object(ne.a)(Object(f.a)(n.prototype),"deserialize",this).call(this,e);t.payload;return t}}]),n}(Zy));function pg(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return dg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dg(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function dg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function vg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var mg=function(e){Object(u.a)(n,e);var t=vg(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.tracks,n=e.patternToLoad,r=[],a=1;this.sequencerEngine.tracks.length>0&&(a=this.sequencerEngine.tracks[0].patterns.length),this.sequencerEngine.loadLFOsAndEnvelopes(t[0]);var i,s=pg(t);try{for(s.s();!(i=s.n()).done;){var o=i.value;r.push(Kr(Object(p.a)({},o,{subSequence:this.sequencerEngine.currentSubSequence,sequencerEngine:this.sequencerEngine,tracks:this.sequencerEngine.tracks,numPatterns:a,patternToLoad:n})))}}catch(u){s.e(u)}finally{s.f()}var c=this.sequencerEngine;return Promise.all(r).then(function(e){var t=c.groups.newGroup();e.forEach(function(e){var n=c.tracks.length;c.setupNewTrack(e,void 0,!0,!1),e.setupEffects(),e.trackNumber=n,t.addTrack(e)}),c.updateTracks(!0)}),{addedTracks:r}}},{key:"undo",value:function(e){var t=this,n=e.payload;Promise.all(n.addedTracks).then(function(e){t.sequencerEngine.deleteTracks(e),t.sequencerEngine.updateTracks()})}}]),n}(Zy);function yg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var bg=function(e){Object(u.a)(n,e);var t=yg(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.track,r=t.preset,i=t.loadMods,s=t.loadEffects,o=t.interpolation,c=this.sequencerEngine.getTrackPreset(n.trackNumber),u=n.preset?n.preset.name:void 0,l=n.preset,console.log("AUDITION PRESET OP"),e.next=7,this.sequencerEngine.auditionPreset(r,n.trackNumber,i,s,!0,o);case 7:return e.abrupt("return",{presetJson:c,presetName:u,savedPreset:l});case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"undo",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,r=n.track,i=n.presetJson,s=n.presetName,o=n.savedPreset,e.next=4,this.sequencerEngine.auditionPreset({data:i,presetName:s},r.trackNumber,!0,!0,!1);case 4:r.presetName=s,o&&(r.preset=o,r.preset.name=s);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),n}(Zy);function gg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Og=function(e){Object(u.a)(n,e);var t=gg(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e.sourceNode,n=e.sourceType,r=e.destNode,a=e.destType;return r.connectInlet(a,t,n),{}}},{key:"undo",value:function(e){var t=e.payload,n=t.sourceNode,r=t.sourceType,a=t.destNode,i=t.destType;a.disconnectInlet(i,n,r)}}]),n}(Zy),kg=function(){function e(t){Object(s.a)(this,e),this.addStepAction=new nb(t),this.deleteStepAction=new eb(t),this.deleteStepNumberAction=new Sb(t),this.moveStepsAction=new Mb(t),this.deleteStepsAction=new Cb(t),this.toggleStepAction=new qb(t),this.deletePatternAction=new _b(t),this.recordStepAction=new Fb(t),this.updateStepParameterAction=new zb(t),this.addEffectAction=new fb(t),this.deleteEffectAction=new pb(t),this.toggleEffectAction=new vb(t),this.moveEffectAction=new wb(t),this.updateParameterAction=new Ub(t),this.updateTrackVolumeAction=new Qb(t),this.updateTrackMuteAction=new Yb(t),this.addAutomationBreakPointAction=new $b(t),this.removeAutomationBreakPointAction=new tg(t),this.removeAutomationBreakPointsAction=new rg(t),this.moveAutomationBreakPointAction=new ig(t),this.moveAutomationBreakPointsAction=new og(t),this.snapToGridAction=new Wb(t),this.snapAutomationBreakPoint=new ug(t),this.recordAutomationAction=new hg(t),this.loadProjectTracks=new mg(t),this.unmapPlanarParameters=new sb(t),this.connectPatcherEdge=new Og(t),this.auditionPreset=new bg(t)}return Object(o.a)(e,[{key:"getAction",value:function(e){switch(e.type){case Qy.c:return this.addStepAction;case Qy.k:return this.deleteStepAction;case Qy.m:return this.deleteStepNumberAction;case Qy.t:return this.recordStepAction;case Qy.r:return this.moveStepsAction;case Qy.l:return this.deleteStepsAction;case Qy.A:return this.toggleStepAction;case Qy.j:return this.deletePatternAction;case Qy.D:return this.updateStepParameterAction;case Qy.b:return this.addEffectAction;case Qy.g:return this.deleteEffectAction;case Qy.z:return this.toggleEffectAction;case Qy.q:return this.moveEffectAction;case Qy.C:return this.updateParameterAction;case Qy.F:return this.updateTrackVolumeAction;case Qy.E:return this.updateTrackMuteAction;case Qy.a:return this.addAutomationBreakPointAction;case Qy.u:return this.removeAutomationBreakPointAction;case Qy.v:return this.removeAutomationBreakPointsAction;case Qy.o:return this.moveAutomationBreakPointAction;case Qy.p:return this.moveAutomationBreakPointsAction;case Qy.y:return this.snapToGridAction;case Qy.x:return this.snapAutomationBreakPoint;case Qy.n:return this.loadProjectTracks;case Qy.d:return this.auditionPreset;case Qy.s:return this.recordAutomationAction;case Qy.B:return this.unmapPlanarParameters;default:var t=kb[e.type];return t?t(this.sequencerEngine):void 0}}},{key:"makeCopyOfAction",value:function(e){var t;switch(e.type){case Qy.c:case Qy.k:case Qy.t:return(t=Object(p.a)({},e)).payload.step=t.payload.step.getCopy(!0,!0,!0),t;case Qy.r:return(t=Object(p.a)({},e)).payload.steps=e.payload.steps,t;case Qy.l:return(t=Object(p.a)({},e)).payload.steps=e.payload.steps.map(function(e){return e.getCopy(!0,!0,!0)}),t;case Qy.D:case Qy.C:return(t=Object(p.a)({},e)).payload.savedValue=e.payload.parameter.get(),t;case Qy.o:return(t=Object(p.a)({},e)).payload.savedStep=e.payload.point.step,t.payload.savedValue=e.payload.point.value,t;default:return Object(p.a)({},e)}}}]),e}();function jg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wg=function(e,t){return Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]),e.sort(),t.sort(),e.length===t.length&&e.every(function(e,n){return e===t[n]})},xg=function(e,t){var n=e.operation;if(Eg(n.type))return Sg(e,t);for(var r=t.length-1;r>=0;r--){if(!Pg(n,t[r]))break}var a=t[r+1];return a&&void 0!==a.operation.payload.savedValue&&(e.operation.payload.savedValue=a.operation.payload.savedValue),[].concat(Object(h.a)(t.slice(0,r+1)),[e])},Sg=function(e,t){for(var n=e.operation,r=t.length-1;r>=0;r--){var a=t[r];if(!Pg(n,a)){r++;break}n=Rg(n,a.operation)}return[].concat(Object(h.a)(t.slice(0,r)),[Object(p.a)({},e,{operation:n})])};function Pg(e,t){return t.length&&(t=t[t.length-1]),t.operation&&(t=t.operation),(e.type===t.type||e.type===Qy.y&&t.type===Qy.r)&&(!!Ag(e.type)&&wg(e.contentId,t.contentId))}var Eg=function(e){return Tg.has(e)},Tg=new Set([Qy.r,Qy.y]),Ag=function(e){return Mg.has(e)},Mg=new Set([Qy.D,Qy.F,Qy.o,Qy.p,Qy.r,Qy.y]),Rg=function(e,t){var n=e.payload,r=t.payload;if(e.type===Qy.r){var a=n.transformation,i=r.transformation,s={stepDifference:a.stepDifference+i.stepDifference,transposeDifference:a.transposeDifference+i.transposeDifference};return Object(p.a)({},t,{payload:Object(p.a)({},r,{transformation:s})})}if(e.type===Qy.y&&t.type===Qy.r){var o=e.payload.stepLocations,c=r.transformation,u={stepDifference:c.stepDifference+o[0].stepDifference,transposeDifference:c.transposeDifference+o[0].transposeDifference};return Object(p.a)({},t,{payload:Object(p.a)({},r,{transformation:u})})}return e};function Cg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Ng(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var qg=function(e){Object(u.a)(n,e);var t=Ng(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).sequencerEngine=e,r.uuids=new Set,r}return Object(o.a)(n,[{key:"dispatch",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]&&o[1],r=o.length>2&&void 0!==o[2]&&o[2],!(!n&&this.roomActionsManager&&this.roomActionsManager.actionsRemaining<=0)){e.next=4;break}return e.abrupt("return",{});case 4:if(i=this.makeCopyOfAction(t),void 0!==this.getAction(t)){e.next=7;break}return e.abrupt("return",{});case 7:return e.next=9,this.runAction(t,!r,n);case 9:if(s=e.sent,i.payload=Object(p.a)({},i.payload,s),n){e.next=14;break}return e.next=14,this.logAction(i);case 14:return e.abrupt("return",s);case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"runAction",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.getAction(e);if(void 0!==r)return"function"===typeof r?r(e.payload):r.execute(e.payload,t,n)}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=Cg(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).executedActions=[],e.undoneActions=[],e.queuedActions=[],e.queuedContentIds=[],e}return Object(o.a)(n,[{key:"logAction",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(S.uuid)(),r=this.getAction(t),e.next=4,this._logAction(n,r,t);case 4:i=e.sent,t=Object(p.a)({},t,{payload:Object(p.a)({},t.payload),contentId:r.getContentId(t)}),Eg(t.type)?void 0===(s=this.lastAction)?this.executedActions.push(t):(o=this.getAction(s.operation).deserialize(s.operation),i?this.executedActions[this.executedActions.length-1]=o:this.executedActions.push(o)):i?this.executedActions[this.executedActions.length-1]=this.combineWithLast(t):this.executedActions.push(Object(p.a)({},t,{uuid:n})),this.executedActions[this.executedActions.length-1].uuid=this.lastAction?this.lastAction.operation.uuid:n;case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"undo",value:function(){if(this.executedActions.length>0){var e=this.executedActions.pop();if(this.undoAction(e,!1),this.undoneActions.push(e),Qy.e.indexOf(e.type)>-1){var t=this.executedActions[this.executedActions.length-1];if(void 0===t)return void this.sequencerEngine.updateTracks(!0);this.shouldAlsoUndo(e,t)?this.undo():this.sequencerEngine.updateTracks(!0)}else this.sequencerEngine.updateTracks(!0)}}},{key:"undoAction",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getAction(e);return void 0===n?{}:(this.roomActionsManager&&this.roomActionsManager.removeActionWithId(e.uuid),"function"===typeof n?n(e.payload,!0):n.undo(e,t))}},{key:"shouldAlsoUndo",value:function(e,t){return-1!==Qy.e.indexOf(t.type)&&Math.abs(e.timestamp-t.timestamp)<5e3}},{key:"redo",value:function(){if(this.undoneActions.length>0){var e=this.undoneActions.pop();this.runAction(e),this.logAction(e),this.sequencerEngine.updateTracks(!0)}}},{key:"_logAction",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,s,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.serialize(r,t);case 2:if(!(i=e.sent)){e.next=10;break}return s=this.queuedActions.length,this.queuedActions=xg(i,this.queuedActions),o=this.queuedActions.length,this.updateQueuedContentIds(),this.queuedActions[this.queuedActions.length-1].operation.uuid=t,e.abrupt("return",o===s);case 10:return e.abrupt("return",!1);case 11:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"updateQueuedContentIds",value:function(){var e=new Set;for(var t in this.queuedActions){var n=this.queuedActions[t].operation;Array.isArray(n.contentId)?n.contentId.forEach(function(t){return e.add(t)}):e.add(n.contentId)}e.size!==this.queuedContentIds.length&&(this.queuedContentIds=Array.from(e))}},{key:"combineWithLast",value:function(e){var t=this.executedActions[this.executedActions.length-1];return t&&void 0!==t.payload.savedValue&&(e.payload.savedValue=t.payload.savedValue),e}},{key:"lastAction",get:function(){return this.queuedActions[this.queuedActions.length-1]}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=jg(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"setupSyncing",value:function(){}},{key:"onSyncedOperation",value:function(e){var t=e.operation,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.uuids.has(t.uuid)){var r=this.getAction(t);void 0!==r&&void 0!==(r=r.deserialize(t))&&this.dispatch(r,!0,n)}}}]),n}(e)}(kg))),Ig=n(572);function _g(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Dg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dg(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Dg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Lg=0;window.Tone=W.a;var Bg=function(e){Object(u.a)(n,e);var t=Fg(n);function n(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:W.a.Transport;var r,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;return Object(s.a)(this,n),(r=t.call(this)).isOffline=o,r.idToParameter={},r.stereoOnly=i,r.engineId=Lg++,r.transport.swingSubvision="16n",r.ethereum=Hn.a,r.context=W.a.Master.context,r.idToObject={},r.nameToObjects={},r.tickingObjects=[],r.store=e,r.encryptedIpfs=new Ig.a(r.store,Hn.a.guilds,Hn.a.encryption,Hn.a.crypto),r.mix=new xa.a(Object(c.a)(r)),r.channelMixer=Ey.use(Object(c.a)(r)),r.audioInputManager=new Wy(r.store),r.sends=new Gy(!1,r.channelMixer,Object(c.a)(r)),r.subSequences=[],r.newSubSequence(),r.audioSettings=new Ky,r.recordingsCounter=1,r.operationManager=new qg(Object(c.a)(r)),Object(qy.a)(r.operationManager),r.parameterLocks=[new fy,new fy],window.spores||(void 0!==a?r.aubio=a:r.initAubio()),r.initGenish(),window.sequencerEngine=Object(c.a)(r),r.resampleConfig={samplesPerNote:1},r}return Object(o.a)(n,[{key:"initAudioWorklets",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.audioWorkletsInitialized){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,W.a.Master.context.audioWorklet.addModule(window.isNFT?"clipper.js":"/clipper.js");case 4:this.audioWorkletsInitialized=!0;case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"transport",get:function(){return W.a.Transport}},{key:"initAubio",value:function(){var e=this;window.Aubio().then(function(t){e.aubio=t})}},{key:"newSubSequence",value:function(e,t){var n=new qv(this,void 0!==t);return t&&n.addTrack(t),void 0!==e&&n.setId(e),this.addSubSequence(n,void 0===t),this.scenes&&this.scenes.newSubSequence(),n}},{key:"deleteSubSequence",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentSubSequence.id;if(1!==this.subSequences.length){var t=-1;for(var n in this.subSequences)if(this.subSequences[n].id===e){t=n;break}if(!(t<0)){this.scenes.deleteSubSequence(t);var r=this.subSequences.filter(function(t){return t.id!==e})[0];this.switchToSubSequence(r.id),this.subSequences[t].dispose(),this.subSequences.splice(t,1),this.store.dispatch(Object(C.ee)(this.engineId,this.subSequences.map(function(e){return e.id})))}}}},{key:"addSubSequence",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.subSequences.push(e),this.currentSubSequence=e,this.store.dispatch(Object(C.ee)(this.engineId,this.subSequences.map(function(e){return e.id}))),this.store.dispatch(Object(C.eb)(e.id,0)),t&&this.store.dispatch(Object(C.hb)(this.engineId,this.currentSubSequence.id))}},{key:"switchToSubSequence",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.subSequences.filter(function(t){return t.id===e})[0];void 0!==n&&(this.currentSubSequence=n,this.store.dispatch(Object(C.hb)(this.engineId,this.currentSubSequence.id)),this.store.dispatch(Object(C.nc)(this.currentSubSequence.id,this.numberOfPatterns())),t&&(this.updateTracks(),this.tracks[0]&&this.switchToPattern(this.tracks[0].currentPattern)),this.groups.updateGroups())}},{key:"switchToNextSubSequence",value:function(){var e=this.subSequences.indexOf(this.currentSubSequence);e<this.subSequences.length-1?e++:e=0,this.switchToSubSequence(this.subSequences[e].id)}},{key:"switchToPreviousSubSequence",value:function(){var e=this.subSequences.indexOf(this.currentSubSequence);e>0?e--:e=this.subSequences.length-1,this.switchToSubSequence(this.subSequences[e].id)}},{key:"mixes",get:function(){return[].concat(Object(h.a)(this.subSequences.map(function(e){return e.mix})),[this.mix])}},{key:"tracks",get:function(){return this.currentSubSequence.tracks},set:function(e){this.currentSubSequence.tracks=e}},{key:"groups",get:function(){return this.currentSubSequence.groups},set:function(e){this.currentSubSequence.groups=e}},{key:"sequenceId",get:function(){return this.getSequenceId()}},{key:"getSequenceId",value:function(){return void 0===this.loadedSequenceId?0:this.loadedSequenceId}},{key:"setMasterVolume",value:function(e,t){this.groups.channelMixer.setVolume(e,t)}},{key:"getMasterVolume",value:function(){this.groups.channelMixer.getVolume()}},{key:"resolution",get:function(){return this.state.sequencer.resolution}},{key:"displayResolution",get:function(){return this.state.sequencer.displayResolution}},{key:"state",get:function(){return this.store.getState()}},{key:"getSubSequenceName",value:function(e){for(var t=["A","B","C","D","E","F","G","H","I","J","K"],n=0;n<this.subSequences.length;n++)if(this.subSequences[n].id===e)return t[n];return""}},{key:"getSubSequence",value:function(e){return this.subSequences.filter(function(t){return t.id===e})[0]}},{key:"auditionSound",value:function(e,t){var n=this.tracks[t];this.tracks.filter(function(e){return e!==n}).filter(function(e){return e.isAuditioning()}).forEach(function(e){return e.completeAudition()}),n.auditionSound(e)}},{key:"addSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i){var s,o,c,u,l,f=this,h=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=h.length>4&&void 0!==h[4]&&h[4],o=h.length>5?h[5]:void 0,c=!(h.length>6&&void 0!==h[6])||h[6],h.length>7?h[7]:void 0,u={slices:void 0===r||0==r.length?void 0:r,offset:0,transpose:0,volume:0},void 0!==n){e.next=23;break}return(l=new rt(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return f.update()},this.currentSubSequence)).setSends(this.sends),l.setupEffects(),this.currentSubSequence.addTrack(l),l.switchToPattern(this.currentPattern),e.next=13,l.addSound(t,u,!0);case 13:return this.groups.addTrack(l),s&&(this.recordingsCounter++,this.newRecordingToSaveLater(t)),o&&(l.samplesStream=o),this.state.selector.sourceExploring||this.selectTrack(this.tracks.length-1),this.tracks.filter(function(e){return e.isAuditioning()}).forEach(function(e){return e.completeAudition()}),l.updateSteps(),c&&this.currentSubSequence.addTrackToPadIfPossible(l),e.abrupt("return",l);case 23:if(!(this.tracks.length>n)){e.next=28;break}return(l=this.tracks[n]).addSound(t,u),this.selectTrack(n),e.abrupt("return",l);case 28:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"transcribeIntoMidi",value:function(e){var t=this;return new Promise(function(n,r){var a=e.getSamplers()[0],i=a.getSlice(0);Object(ir.a)(i.buffer._buffer).then(function(e){var r=e.notes;t.addMultiSynthTrack().addNotes(r,a.tempo),n()})})}},{key:"duplicateTrack",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.tracks[t]){e.next=2;break}return e.abrupt("return");case 2:n=this.tracks[t].pad,r=this.tracks[t].getCopy(void 0,this),this.setupNewTrack(r,!0,!0),r.setupEffects(),n&&((i=n.slots.indexOf(!1))>-1?n.addTrack(r,i):this.currentSubSequence.createPad().addTrack(r,0)),this.currentSubSequence.addTrack(r),this.updateTracks(),this.groups.addTrack(r),this.update();case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTracks",value:function(e){this.tracks=this.tracks.filter(function(t){return!e.includes(t)}),e.forEach(function(e){return e.dispose()})}},{key:"deleteTrack",value:function(e,t){"MIDI"==this.tracks[e].getTrackType()&&this.tracks[e].disconnect();var n=this.tracks[e],r=n.sample,a=this.samplesToSync.indexOf(r);for(var i in a>-1&&this.samplesToSync.splice(a,1),this.tracks)this.tracks[i].chokes.choke===n&&(this.tracks[i].chokes.choke=void 0);n.group;this.groups.deleteTrack(n),this.groups.updateGroupNumbers(),this.rollingManager.deleteTrack(n),n.subSequence.deleteTrackFromPads(n),n.subSequence.deleteTrackFromSequencers(n),t?this.tracks[e]=t:this.tracks.splice(e,1),this.tracks=Object(h.a)(this.tracks),this.cursor.track>=e&&(this.cursor.track--,this.cursor.track<0&&(this.cursor.track=0)),this.scripting.deleteHistoryForTrack(e),this.keyboardEngine&&this.keyboardEngine.deleteTrack(e),this.tracks.forEach(function(e,t){e.trackNumber=t}),this.tracks.forEach(function(e,t){return e.updateSteps()});var s=n.subSequence.id,o=this.state.effects.effectsChainToShow[s]||{};this.store.dispatch(Object(C.yb)(s,Object(Cn.a)(e,o))),this.dispatch(Object(C.f)(n.id)),this.updateSteps(),this.update(),this.selectTrack(Math.max(e-1,0));var c=this.tracks.map(function(e){return e.isWarped()});this.store.dispatch(Object(C.de)(s,c)),n.dispose(),0===this.tracks.length&&this.dispatch(Object(C.Nd)(!1))}},{key:"deleteGroup",value:function(e){this.tracks=this.tracks.filter(function(t){return-1===e.tracks.indexOf(t)}),this.groups.deleteGroup(e),this.store.dispatch(Object(C.Db)(e.id,[])),this.updateSteps(),this.update()}},{key:"length",get:function(){var e=-1;for(var t in this.subSequences)for(var n in this.subSequences[t].tracks){var r=this.subSequences[t].tracks[n].length;r>=e&&(e=r)}return e}},{key:"newPattern",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.currentSubSequence.pads.map(function(e){return e.fxMacro.macroParameter.get()}),r=this.numberOfPatterns()+1,(new Date).getTime(),this.currentSubSequence.newPattern(),i=this.tracks.map(function(e){return e.newPattern(t)}),e.next=7,Promise.all(i);case 7:(new Date).getTime(),this.switchToPattern(this.tracks[0].patterns.length-1),this.currentSubSequence.pads.forEach(function(e,t){return e.fxMacro.macroParameter.set(n[t])}),this.store.dispatch(Object(C.nc)(this.currentSubSequence.id,r)),this.lfosTrack.newPattern(r),this.envelopesTrack.newPattern(r);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deletePattern",value:function(e){if(0!=this.tracks.length&&1!=this.tracks[0].patterns.length){e=e||this.tracks[0].currentPattern,this.tracks.map(function(t){return t.deletePattern(e)});var t=e>0?e-1:0;this.switchToPattern(t),this.store.dispatch(Object(C.nc)(this.currentSubSequence.id,this.numberOfPatterns())),this.lfosTrack.deletePattern(e),this.envelopesTrack.deletePattern(e)}}},{key:"subSequenceMix",get:function(){return this.currentSubSequence.mix}},{key:"switchToPattern",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.currentSubSequence,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!(e<0||n.tracks.length<=0||n.tracks[0].patterns.length<=e)){var s=this.currentPattern;if(this.currentPattern!==e){Object(Em.b)(n,e),r||this.dispatch(Object(C.fb)(void 0)),this.state.mix.isRecordingMix&&!t?n.mix.addEvent(new Um.a(e)):t&&!i||n.mix.holdEvent(new Um.a(e));var o=n.lfosTrack.switchToPattern(s,e);o=Object(p.a)({},o,n.envelopesTrack.switchToPattern(s,e)),this.switchToPatternHelper(e,n,o,a),this.getAllPatternLockedParameters(s,e).forEach(function(e){return e.updateRedux()}),n.findNodeByName("patterns").forEach(function(t){return t.effect.sendMessage("pattern switched",e+1)}),n.pads.forEach(function(e){return e.sendSliderLevels()})}}}},{key:"currentPattern",get:function(){return this.getCurrentPattern(this.currentSubSequence)}},{key:"getCurrentPattern",value:function(e){return this.store.getState().sequencer.currentPattern[e.id]}},{key:"switchToPatternHelper",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentSubSequence,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=t.tracks.map(function(t){return t.switchToPattern(e,void 0,r)});if(!window.explore){var i={};for(var s in a){var o=a[s];o.volume&&(i[o.volume.id]={volume:o.volume.volume,panning:o.panning.panning,mute:o.mute.mute}),n=Object(p.a)({},n,a[s].bulkUpdate)}this.store.dispatch(Object(C.ub)(n)),this.store.dispatch(Object(C.ze)(i))}this.store.dispatch(Object(C.eb)(t.id,e)),this.viewMode!==Sa.a&&this.updateSteps()}},{key:"updateSteps",value:function(e){var t=this.tracks.map(function(e){return e.getUpdateStepsAction()});this.store.dispatch(Object(C.hf)(t))}},{key:"switchToLastPattern",value:function(){0!=this.tracks.length&&this.switchToPattern(this.numberOfPatterns()-1)}},{key:"switchToPreviousPattern",value:function(){if(0!=this.tracks.length){var e=this.tracks[0].currentPattern-1%this.tracks[0].patterns.length;this.switchToPattern(e)}}},{key:"switchToNextPattern",value:function(){if(0!=this.tracks.length){var e=this.tracks[0].currentPattern+1%this.tracks[0].patterns.length;this.switchToPattern(e)}}},{key:"movePatternTo",value:function(e,t){this.tracks.forEach(function(n){return n.movePatternTo(e,t)}),this.switchToPattern(t),this.lfosTrack.movePatternTo(e,t)}},{key:"numberOfPatterns",value:function(){return 0==this.tracks.length?1:this.tracks[0].patterns.length}},{key:"isLoaded",value:function(e){return void 0!==this.tracks&&void 0!==this.tracks[e]&&this.tracks[e].isLoaded()}},{key:"setUpdateCallback",value:function(e){this.callback=e}},{key:"update",value:function(e){window.isNFT||window.projectId||!e||window.multiMix||window.documentation||window.landing||this.tokenId||window.location.href.includes(e)||window.history.pushState("page2","Title","/v3/"+e)}},{key:"addTrack",value:function(e){this.currentSubSequence.addTrack(e),e.setupEffects(),this.groups.addTrack(e),this.setupNewTrack(e)}},{key:"addAudioTrack",value:function(){var e=this,t=new Hr(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return this.setupNewTrack(t),t.warp(),t}},{key:"addMultiFreezeTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]),n=new Lr(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return this.groups.addTrack(n),this.setupNewTrack(n,t),n}},{key:"addZ4Track",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]),n=new Ny(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return this.groups.addTrack(n),this.setupNewTrack(n,t),n}},{key:"addSampledInstrumentTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]),n=new wr(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return this.groups.addTrack(n),this.setupNewTrack(n,t),n}},{key:"addInstrumentRackTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]),n=new Zn(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return this.groups.addTrack(n),this.setupNewTrack(n,t),n}},{key:"addInstrumentTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new lt(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addFMSynthTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new ht(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addMetalSynthTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new Fy(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addMultiSynthTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new Vn(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence,!0));return this.groups.addTrack(t),this.setupNewTrack(t),t.preset.name="Empty Patch",t.presetName="Empty Patch",t}},{key:"addMidiTrack",value:function(){var e=this,t=new Ir(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return t.setMidiEngine(this.midi),t.setAudioSettings(this.audioSettings),this.setupNewTrack(t),t}},{key:"setupNewTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];e.isRecordable()&&this.setupRecordableTrack(e,t),e.sequencerEngine=this,n||e.setSends(this.sends),e.setKeyboardEngine(this.keyboardEngine),t||this.currentSubSequence.addTrack(e),t?e.switchToPattern(0):(e.switchToPattern(this.tracks[0].currentPattern),a||this.currentSubSequence.addTrackToPadIfPossible(e)),r&&(this.update(),this.updateTracks())}},{key:"setupRecordableTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.setAudioInputManager(this.audioInputManager),t||this.groups.addTrack(e),e.setSequencerEngine(this)}},{key:"updateTracks",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.tracks.forEach(function(t,n){t.trackNumber=n,t.sequencerEngine=e,t.patterns.forEach(function(t){return t.sequencerEngine=e})}),!window.explore){var n=this.tracks.map(function(e){return e.getUpdateStepsAction(t)});this.store.dispatch(Object(C.hf)(n))}}},{key:"dispose",value:function(){for(var e in this.playSequence&&this.playSequence.dispose(),this.loadedSamples)this.loadedSamples[e].dispose();this.metronome&&this.metronome.dispose(),this.metronome=void 0,this.loadedSamples={},Ey.release(this.channelMixer),this.channelMixer=void 0,this.sends.dispose(),this.subSequences.forEach(function(e){return e.disposeParameters()}),this.subSequences.forEach(function(e){return e.dispose()}),this.store.dispatch(Object(C.b)(this.sequenceId)),this.audioInputManager.dispose(),this.idToParameter={}}},{key:"newSequence",value:function(){for(var e in this.subSequences){this.subSequences[e].dispose()}this.subSequences=[],this.newSubSequence(),this.mix=new xa.a(this),this.update(),this.store.dispatch(Object(C.nc)(this.currentSubSequence.id,1)),this.store.dispatch(Object(C.l)()),this.loadedSequenceId=void 0,this.stop()}},{key:"scrollToSelectedTrack",value:function(){}},{key:"patternLocks",set:function(e){this.store.dispatch(Object(C.Bd)(e))}},{key:"togglePatternLock",value:function(){this.store.dispatch(Object(C.Ad)(this.currentPattern,!this.patternLocked))}},{key:"viewMode",get:function(){return this.state.sequencer.viewMode}},{key:"patternLocked",get:function(){return this.store.getState().sequencer.patternLocks[this.currentPattern]||!1}},{key:"getAllPatternLockedParameters",value:function(){return[].concat(Object(h.a)(this.parameters),Object(h.a)(this.currentSubSequence.getAllParameters())).filter(function(e){return e.hasPatternLockedValues()})}},{key:"guildId",get:function(){return this.state.guilds.selectedGuild?this.state.guilds.selectedGuild.guildId:0}},{key:"metronomeOn",get:function(){return this.metronome&&!this.metronome.muted},set:function(e){this.metronome.mute(!e)}},{key:"getScale",value:function(){var e=new Set;for(var t in this.tracks){var n=this.tracks[t];for(var r in n.patterns)n.patterns[r].getEasyPattern().getAllSteps().map(function(t){return e.add(X.a.fromTranspose(t.transpose).note)})}return Array.from(e)}},{key:"dispatch",value:function(e){this.store.dispatch(e)}},{key:"createPad",value:function(e){this.currentSubSequence.createPad(e)}},{key:"getSamplesPerTrack",value:function(){return Object(j.e)(this)}},{key:"refreshUniform",value:function(){Object(Ma.b)("shader.render")}},{key:"compile",value:function(){var e,t=_g(this.subSequences);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.findNodeByName("three.canvas").forEach(function(e){return e.effect.sendMessage("size",[e.effect.width,e.effect.height])});var r,a=_g(n.findNodeByName("gl.material"));try{for(a.s();!(r=a.n()).done;){r.value.refresh()}}catch(i){a.e(i)}finally{a.f()}}}catch(i){t.e(i)}finally{t.f()}}},{key:"getPhotos",value:function(){return Object(j.c)(this)}},{key:"saveWindowPositions",value:function(){var e=this.state.windows.windowPositions;Ar.a.addJson(e)}},{key:"loadWindowPositions",value:function(){var e=this;Ar.a.getJson("QmUWjd8HbxTxRG6G8d4DYsWQbtgsRKDp1kKeCp2JGeMZQP").then(function(t){e.dispatch(Object(C.M)(t))})}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=Ty(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"initGenish",value:function(){}}]),n}(e)}(function(){return function e(){Object(s.a)(this,e)}}()));n(523);function zg(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Jg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Jg(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Jg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Vg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Hg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Ug(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Gg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gg(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Gg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Wg=function(e){var t,n=[],r=[],a=0,i=Ug(e);try{for(i.s();!(t=i.n()).done;){var s=t.value;s.time-a>2&&(n.push(r),r=[]),r.push(s),a=s.time+s.duration}}catch(o){i.e(o)}finally{i.f()}return r.length>0&&n.push(r),n},Kg=function(e){var t=e,n=function(e){var t,n={},r=Ug(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=a.track.trackNumber;n[i]||(n[i]=[]),n[i].push(a)}}catch(s){r.e(s)}finally{r.f()}return n}(e),r=Object.keys(n);r.sort(function(e,t){return n[e].length-n[t].length}),console.log(r.map(function(e){return[e,n[e].length]}));var a=r[0];r.length>2&&(a=r[1]),console.log("min track=",a,n[a]),e=n[a];for(var i=Yg(e),s=[],o=0;o<i.length-3;o++)for(var c=o+2;c<i.length;c++)for(var u=2;u<i.length-c;u++){var l=i.slice(o,o+u),f=i.slice(c,c+u);if(l.length===f.length){var h=Zg(l,f);h>0&&s.push({estimation:h,i:o,j:c,k:u})}}s.sort(function(e,t){return e.estimation-t.estimation});var p=s[0];if(p){var d=Qg(60/(e[p.j].time-e[p.i].time)),v=e[p.i].time,m=e[p.j].time;m+=m-v;var y,b=[],g=Ug(t);try{for(g.s();!(y=g.n()).done;){var O=y.value;v<=O.time&&O.time<m&&b.push(O)}}catch(k){g.e(k)}finally{g.f()}return{bpm:d,loop:b}}},Qg=function(e){for(;e<70;)e*=2;return e},Zg=function(e,t){for(var n=0,r=0,a=0;a<e.length;a++)a<t[a]&&(n+=Math.abs(t[a]-e[a]),r++);return n/r},Yg=function(e){var t,n=[],r=void 0,a=Ug(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;r&&n.push(i.time-r.time),r=i}}catch(s){a.e(s)}finally{a.f()}return n};window.createPattern=function(){var e=window.sequencerEngine,t=Wg(tO()),n=t[t.length-1];if(n&&0!==n.length){var r=Kg(n);if(r){var a=r.loop,i=r.bpm;if(a[0]){e.bpmParameter.set(i,!1);var s,o=new W.a.Time("32n").toSeconds(),c=a[0].time,u=Ug(a);try{for(u.s();!(s=u.n()).done;){var l=s.value,f=(l.time-c)/o,h=Math.floor(f),p=f-h,d=l.track;h>d.pattern.length()&&d.doubleTrackLength(),d.recordUnquantizedHit(h,0,l.duration/(2*o),p,l.transpose||0,l.velocity)}}catch(v){u.e(v)}finally{u.f()}}}}},window.getGhostChunks=Wg;var Xg=function(){var e=[];return{record:function(t,n,r,a,i){e.push({track:t,time:n,duration:r,transpose:a,velocity:i})},drain:function(){var t=[].concat(e);return e.length=0,t},peek:function(){return[].concat(e)}}}(),$g=Xg.record,eO=Xg.drain,tO=Xg.peek;window.drain=eO,window.peek=tO;function nO(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return rO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rO(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function rO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var aO=function(){function e(){Object(s.a)(this,e),this.addListeners(),this.currentChord=void 0,this.lastChordTime=void 0,this.newChordListeners=[],this.sameChordListeners=[],this.octaveUpListeners=[],this.octaveDownListeners=[]}return Object(o.a)(e,[{key:"addListeners",value:function(){}},{key:"setCurrentChord",value:function(e){this.currentChord=e,this.lastChordTime=(new Date).getTime()}},{key:"chordOn",value:function(e){}},{key:"dispatchEvent",value:function(e){var t=new Event(e);t.chord=this.currentChord,window.dispatchEvent(t)}},{key:"sameChord",value:function(){this.dispatchEvent("SAME_CHORD")}},{key:"octaveDown",value:function(e){this.dispatchEvent("OCTAVE_DOWN")}},{key:"twoOctavesDown",value:function(e){this.dispatchEvent("TWO_OCTAVES_DOWN")}},{key:"octaveUp",value:function(e){this.dispatchEvent("OCTAVE_UP")}},{key:"twoOctavesUp",value:function(e){this.dispatchEvent("TWO_OCTAVES_UP")}},{key:"newChord",value:function(e){this.setCurrentChord(e),this.dispatchEvent("NEW_CHORD")}},{key:"stripOctave",value:function(e){return new Set(Array.from(e).map(function(e){return X.a.fromString(e).note}))}},{key:"chordContains",value:function(e,t){e=this.stripOctave(e);var n,r=nO(t=this.stripOctave(t));try{for(r.s();!(n=r.n()).done;){var a=n.value;if(!e.has(a))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}},{key:"isOctaveUp",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=!0,i=nO(e);try{for(i.s();!(n=i.n()).done;){var s=n.value,o=X.a.fromString(s).addTranspose(12*r).toString();t.has(o)||(a=!1)}}catch(c){i.e(c)}finally{i.f()}return a}},{key:"isOctaveDown",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=!0,i=nO(e);try{for(i.s();!(n=i.n()).done;){var s=n.value,o=X.a.fromString(s).addTranspose(-12*r).toString();t.has(o)||(a=!1)}}catch(c){i.e(c)}finally{i.f()}return a}},{key:"isSameChord",value:function(e,t){return this.eqSet(e,t)}},{key:"eqSet",value:function(e,t){if(e.size!==t.size)return!1;var n,r=nO(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(!t.has(a))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}},{key:"chordOff",value:function(e){}},{key:"addCallback",value:function(){}}]),e}(),iO=function(){function e(t,n){Object(s.a)(this,e),this.chordsManager=new aO,this.sequencerEngine=t,this.store=this.sequencerEngine.store,this.keyboardEngine=n,this.recordedTriggers={},this.notesDown=new Set}return Object(o.a)(e,[{key:"onNoteDown",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(n&&this.addNoteOn(e),!(e in this.recordedTriggers)){var i=this.store.getState().sequencer.resolution,s=this.store.getState().sequencer.quantized;this.keyboardEngine.onKeyDown(e,i,!this.sequencerEngine.rolling,n,r,a);var o=this.keyboardEngine.recordHit(e,n,i,s,r,a);null!=o&&("tracks"in o?o.recordedTriggers.forEach(function(e){e.release=t.release;t.sequencerEngine.tracks[e.trackNumber];t.sequencerEngine.rollingManager.addTrackSlice(e.trackNumber,0,o.transpose),t.store.dispatch(Object(C.ef)(e.trackNumber,e.sliceNumber))}):(this.sequencerEngine.rollingManager.addTrackSlice(o.trackNumber,o.sliceNumber),this.store.dispatch(Object(C.ef)(o.trackNumber,o.sliceNumber))),this.recordedTriggers[e]=o)}}},{key:"onAlphabetKeyDown",value:function(e){this.onNoteDown(e.key,!1)}},{key:"addNoteOn",value:function(e){}},{key:"addNoteOff",value:function(e){}},{key:"onNoteOff",value:function(e){var t=this;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.addNoteOff(e),e in this.recordedTriggers){var n=this.recordedTriggers[e];if(void 0!==n.tracks)n.recordedTriggers.forEach(function(e){return t.store.dispatch(Object(C.ff)(e.trackNumber,e.sliceNumber))}),n.recordedTriggers.filter(function(e){return e.rolling}).forEach(function(e){e.track;t.sequencerEngine.rollingManager.removeTrackSlice(e.trackNumber,0,n.transpose)}),n.tracks.filter(function(e){return e.trackData}).filter(function(e){return!e.rolling}).forEach(function(r){t.releaseAndRecord(r,n,e,!0)});else{var r=this.sequencerEngine.tracks[n.trackNumber];if(void 0===r)return;this.sequencerEngine.rollingManager.removeTrackSlice(n.trackNumber,n.sliceNumber,void 0),this.store.dispatch(Object(C.ff)(n.trackNumber,n.sliceNumber)),r.rolling||this.releaseAndRecord(r,n,e)}delete this.recordedTriggers[e]}}},{key:"onKeyUp",value:function(e){this.onNoteOff(e.key)}},{key:"releaseAndRecord",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=t.transpose;void 0===a&&(a=e.trackData.transpose),e.midiEffects.liveInputRelease(r?a+e.trackData.transpose:a,t.sliceNumber),e.sequencerEngine.playing&&this.store.getState().sequencer.isRecording||e.subSequence.isTrack&&this.store.getState().mix.isRecordingMix?t.record(this.sequencerEngine):(t.recordedTriggers&&(t=t.recordedTriggers[0]),t.getDuration&&$g(e,t.startTime,t.getDuration().duration/1e3,a,t.velocity))}}]),e}();function sO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var oO=function(e){Object(u.a)(n,e);var t=sO(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,am)).sequencerEngine=e,r}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e>63.5;this.sequencerEngine.trackRolling=t}}]),n}(ay);function cO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var uO=function(e){Object(u.a)(n,e);var t=cO(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,im)).sequencerEngine=e,r}return Object(o.a)(n,[{key:"execute",value:function(e){var t=e>63.5;console.log("excecuting sequence roll action"),this.sequencerEngine.sequenceRolling=t}}]),n}(ay);function lO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function fO(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return hO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hO(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function hO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var dO=new W.a.Time("16n"),vO=new W.a.Time("32n"),mO=function(e){Object(u.a)(n,e);var t=pO(n);function n(e,r,a,i,o,u){var l;return Object(s.a)(this,n),(l=t.call(this,e,r,a,i,u)).currentStepTime=null,l.previousStepTime=null,l.lastTrackStep=void 0,l.tracksToRecord={},l.tracksRecording={},l.tracksToStopRecording={},l.rollingManager=new ry,l.mixButtons=[],l.nextTimeScheduled=void 0,l.nextStepScheduled=void 0,l.startedTransportExplicitly=!1,l.patternSwitchScheduled=null,l.stepNumberOffset=0,l.isRecording=!1,l.playing=!1,l.sequenceRolling=!1,l.resampler=void 0,l.automationStep=0,l.bpmParameter=new te.a("BPM",l.transport.bpm,function(e,t,n){return l.onNewBpm(t,n)},{min:1,max:500,unit:""}),l.bpmParameter.setContext((new V.a).forSequencerEngine(Object(c.a)(l))),window.explore?l.bpmParameter.set(W.a.Transport.bpm.value):l.bpmParameter.set(yO()),l.swingParameter=new re.a("Swing",Object(c.a)(l),function(e,t){l.onNewSwing(t)},{min:50,max:75,unit:"",defaultValue:50}),l.parameters=[],l.registerParameter(l.bpmParameter),l.registerParameter(l.swingParameter),l.latency=void 0,l.clockSync=new Vv(Object(c.a)(l)),l.masterResampler=new mm.a(Object(c.a)(l),l.groups.channelMixer.stereoMerger,!0),l.transpose=0,l.autoResampleMode=!1,l.metronome=!o&&new gm(Object(c.a)(l),l.mixSession,1,function(){return[]}),l.deleting=!1,l.scenes=new Ym(Object(c.a)(l)),l.parametersToUpdate={},l.initAudition(),l}return Object(o.a)(n,[{key:"registerParameter",value:function(e){this.parameters.push(e),e.setContext((new V.a).forSequencerEngine(this));var t=e.setStore(this.store);this.dispatch(Object(C.ub)(t))}},{key:"startPlaySequence",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.playSequence.cancel(),this.playSequence.start(t),this.getSamplerPlaySequence&&this.getSamplerPlaySequence().start(t);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"schedulePlay",value:function(){!this.playing&&this.clockSync.connected&&this.clockSync.clockType===Fv.c?this.store.dispatch(Object(C.Mc)(!0)):this.play()}},{key:"play",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.keyboardHelper&&(this.keyboardHelper.release=void 0),this.playTimestamp=(new Date).getTime(),this.playing=!this.playing,this.latency=void 0,this.firstStep=!0,this.trackStep=this.isLooping?this.loopStart:this.startStep,this.state.keyboard.cursor&&!window.isNFT&&this.isShowingPianoRoll()&&(this.trackStep=ke.a.baseResolution.transformStepAtResolution2(this.state.keyboard.cursor,this.displayResolution)),this.currentStep=0,this.previousStep=0,this.previousStepTime=void 0,this.currentStepTime=void 0,this.playing){t||this.hasAtleastOneSequencerEnginePlaying()||this.updateBpm(this.bpm),this.startPlaySequence(e,t),!t&&this.hasAtleastOneSequencerEnginePlaying()||(this.startedTransportExplicitly=!0,this.transport.start("+0.00001"),this.midi&&this.midi.onPlay()),this.restartAllMixes();var n,r=fO(this.subSequences);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.startZObjects(),a.midiEffects.clear(),a.tracks.forEach(function(e){return e.restart()}),a.tracks.forEach(function(e){return e.start()})}}catch(i){r.e(i)}finally{r.f()}this.store.dispatch(Object(C.Jb)(this.getSequenceId(),!0))}else this.stop();this.store.dispatch(Object(C.Mc)(!1)),this.sendPlayChange(this.playing)}},{key:"restartAllMixes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.isLooping;for(var t in this.mixes.forEach(function(t){return t.restart(e)}),this.setSequenceRolling(!1,void 0,!0),this.subSequences)for(var n in this.subSequences[t].tracks){this.subSequences[t].tracks[n].patternRollStepNumber=void 0}this.schedulePatternBufferClear=!1}},{key:"stop",value:function(){var e=this;this.restartAllMixes(),this.latency=void 0,this.playing=!1;this.trackStepReal;for(var t in this.trackStepReal=0,this.higherOrderSequencer.stop(),this.playSequence.stop(),this.startedTransportExplicitly=!1,this.clearScheduledAutomations(),this.hasMultipleSequencerEnginesPlaying()||(this.transport.stop("+0.01"),this.midi&&this.midi.onStop()),this.subSequences)this.subSequences[t].lfosTrack.stop(),this.subSequences[t].stopZObjects();this.tracks.forEach(function(e){return e.effects.filter(function(e){return e.syncable()}).forEach(function(e){return e.stop()})}),Object(Ma.a)();var n,r=fO(this.subSequences);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.midiEffects.stop(),a.tracks.forEach(function(t){t.stepGroups.length>0&&(t.pattern.transformStepBuckets=[],t.pattern.isTransformed=!1,t.subSequence===e.currentSubSeuqence&&t.updateSteps()),t.resetAnyPLockedParameters(),t.midiEffects.stop(),t.notesTriggered={},!t.isFrozen&&t.instrument&&t.instrument.releaseAll&&t.instrument.releaseAll(),t.tracks&&t.tracks.forEach(function(e){return e.track.midiEffects.stop()})})}}catch(s){r.e(s)}finally{r.f()}for(var i in this.store.dispatch(Object(C.Jb)(this.getSequenceId(),!1)),this.state.sequencer.viewMode!==Sa.a&&this.store.dispatch(Object(C.Kb)(!1)),this.clockSync&&this.clockSync.onStop(),this.subSequences)this.subSequences[i].tracks.forEach(function(e){e.chokes.chokingDuration=0,e.chokes.liveRelease()});this.resetAutomationParameters(),this.playSequence.cancel(),this.loadNewSequence(),this.handleStopMode(),this.lastTrackStep=void 0}},{key:"startStep",get:function(){var e=this.state.sequencer.viewMode;return void 0===this.state.arrangement.cursorStep||e===Sa.c&&!this.isLooping?0:this.state.arrangement.cursorStep}},{key:"seekToTrackStep",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(arguments.length>2?arguments[2]:void 0)?e<this.stepNumberOffset?this.stepNumberOffset=e:(this.stepNumberOffset=0,this.trackStep=e-this.stepNumberOffset):(this.trackStep=e,this.store.dispatch(Object(C.db)(this.getSequenceId(),e)),this.mixes.forEach(function(t){return t.seekToTrackStep(e)}),0===e&&(this.stepNumberOffset=0)),0==e&&n&&(this.isShowingPianoRoll()||this.switchToPatternHelper(0)),this.isLooping&&(this.looping=!1,this.startNewLoop(this.bars)),this.subSequences.forEach(function(e){return e.tracks.forEach(function(e){return e.scheduleTrackPatternChangeIfAny(t.trackStep,!0)})})}},{key:"loadNewSequence",value:function(){this.playSequence&&this.playSequence.dispose(),this.playSequence=this.getPlaySequence()}},{key:"sleep",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){setTimeout(function(){return e(t)},t)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"isLooping",get:function(){return this.state.arrangement.looping}},{key:"looping",set:function(e){this.store.dispatch(Object(C.z)(e))}},{key:"loopStart",get:function(){return this.state.arrangement.selection.start}},{key:"loopEnd",get:function(){return this.state.arrangement.selection.end}},{key:"startNewLoop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=32*e,n=this.trackStep;for(n-=Object(jn.a)(n+(this.stepNumberOffset||0),t);n<0;)n+=16;this.dispatch(Object(C.E)(n,n+t)),this.looping=!0,this.bars=e}},{key:"getPlaySequence",value:function(){var e=this,t=Array(16).fill(1).map(function(e,t){return t}),n=new W.a.Sequence(function(t,n){e.scheduleStep(t,n)},t,"32n");return n.loop=!0,n}},{key:"getLoopedStep",value:function(e){if(this.isLooping){var t=(e-this.loopStart)%(this.loopEnd-this.loopStart);return e=this.loopStart+t}return e}},{key:"handleLatency",value:function(e){if(void 0===this.latency&&!this.clockSync.initiator){this.timeToCompare=this.timeToCompare-(new Date).getTime(),this.latency=this.timeToCompare-this.getMilliseconds(e),this.latency+=vO.toMilliseconds();var t=(new Date).getTime()-this.playTimestamp;this.latency-=t/2}return this.latency&&(e+=this.latency/1e3),e+=this.state.sequencer.latency/1e3}},{key:"handleMixSessionStep",value:function(e){var t=this;if(this.state.mix.isPlayingMix){for(var n in this.isLooping&&this.trackStep===this.loopStart&&this.restartAllMixes(!0),this.subSequences){var r=this.subSequences[n],a=this.subSequences[n].mix.getValue(wv.i,this.automationStep);void 0!==a&&a!==this.getCurrentPattern(r)&&this.switchToPattern(a,!0,r,void 0,e)}var i=this.isSequenceRollingAtStep(this.automationStep);void 0!==i&&i!==this.isSequenceRolling&&this.setSequenceRolling(i,void 0,!0);try{this.mixes.forEach(function(n){return n.scheduleNext(t.trackStep,e)})}catch(s){console.log(s)}}}},{key:"scheduleParametersToRecord",value:function(e){if(this.isRecording){var t=this.state.tracks.parametersToRecord,n=function(n){var r=t[n];if(!r||!r.context)return"continue";if(r.context.track){var a=r.context.track,i=a.pattern,s=e%a.length,o=i.stepBuckets[s];for(var c in o.steps){var u=o.steps[c];if(u.on)u.parameters.filter(function(e){return e.name===r.name}).forEach(function(e){return e.set(r.get())})}}};for(var r in t)n(r)}}},{key:"scheduleAnyTrackRecording",value:function(e,t){this.store.getState();this.tracksToRecord[e.trackNumber]?(e.startRecording(t),this.store.dispatch(Object(C.gf)(e.trackNumber,!0)),this.tracksRecording[e.trackNumber]=!0,delete this.tracksToRecord[e.trackNumber]):this.tracksToStopRecording[e.trackNumber]&&(e.stopRecording(t),this.store.dispatch(Object(C.gf)(e.trackNumber,!1)),delete this.tracksRecording[e.trackNumber],delete this.tracksToStopRecording[e.trackNumber])}},{key:"scheduleAnyMasterResampling",value:function(e){var t=this.store.getState();void 0!==this.resampler&&(this.resampler.resamplingDurationElapsed++,this.resampler.resamplingDurationElapsed==t.tracks.resampleDuration&&(this.resampler.stop(e),this.resampler=void 0)),t.sequencer.resampleMaster&&(this.store.dispatch(Object(C.Xc)(!1)),this.resampler=this.masterResampler,this.resampler.start(e))}},{key:"scheduleAnyTrackResampling",value:function(e,t){var n=this.store.getState();if(e.subSequence===this.currentSubSequence){void 0!==e.resampler&&(e.resampler.resamplingDurationElapsed++,e.resampler.resamplingDurationElapsed==n.tracks.resampleDuration&&(e.resampler.stop(t),e.resampler=void 0));var r=n.tracks.tracksToResample,a=r.indexOf(e.trackNumber);a>-1&&(r.splice(a,1),this.store.dispatch(Object(C.Ee)(r)),e.resampler=e.masterResampler,e.resampler.start(t)),n.tracks.trackToFreeze&&n.tracks.trackToFreeze.trackNumber===e.trackNumber&&n.tracks.trackToFreeze.subSequenceId===e.subSequence.id&&(e.resampler=e.masterResampler,e.resampler.start(t,e,!0),this.store.dispatch(Object(C.ye)(void 0)))}}},{key:"scheduleAnyFrozenTrackPlaying",value:function(e,t){}},{key:"scheduleAnyAudioTrackPlaying",value:function(e,t){if("MIDI"===e.getTrackType()&&Object.keys(e.samplers).length>0){var n=new F.a;n.loadDefaults(),n.attack=80,n.release=dO.toMilliseconds()/4,e.triggerSamples(n,t)}}},{key:"scheduleTrackRolling",value:function(e,t,n){var r=this;e.subSequence.isTrack||(t=e.getPatternStep(t));var a=this.getMilliseconds(n),i=e.getFactoredResolution();setTimeout(function(){var a=r.rollingManager.getTriggers(t,i,e);if(a.filter(function(t){return t.trackSlice.trackNumber===e.trackNumber}).length>0){e.onNewStep(),a.forEach(function(a){if(void 0!==(e=r.tracks[a.trackSlice.trackNumber])){var s=new F.a;s.slice=a.trackSlice.sliceNumber,s.velocity=e.trackData.velocity,s.transpose=void 0===a.trackSlice.transpose?e.trackData.transpose:a.trackSlice.transpose+e.trackData.transpose,s=e.getStepDataForStep(s);var o=new W.a.Time(n)+a.time;s.track=e,e.midiEffects.input(s,o,t),(r.isRecording||e.subSequence.isTrack&&r.isRecordingMix)&&e.recordHit(a.step,i,s.slice,null,s.transpose,s.velocity,r.keyboardHelper.release)}}),a=e.midiEffects.output(n,t);var s=[e],o={};o[e.trackNumber]=a,Nm(r,s,o,n,t),e.onStepEnded(n,t)}},a-20)}},{key:"scheduleSamplesRolling",value:function(e,t){var n=this;this.tracks.filter(function(e){return e.rolling}).forEach(function(r){return n.scheduleTrackRolling(r,e,t)})}},{key:"missedNextScheduledStep",value:function(){return W.a.Master.context.currentTime<=this.nextTimeScheduled}},{key:"scheduleNext",value:function(e,t,n){var r=this,a=this.tracks[e];if(a.getTrackType()!==D.b){var i=this.rollingManager.getTriggerTimes(this.nextStepScheduled,this.resolution,a),s=a.getFactoredResolution();i.forEach(function(e){var i=new F.a;i.slice=t,i.transpose=void 0===n?a.trackData.transpose:n+a.trackData.transpose,i=a.getStepDataForStep(i),a.trigger(i,r.nextTimeScheduled+e.time),r.isRecording&&(a.recordHit(e.step,s,t,i.duration,i.transpose),a.updateSteps())})}}},{key:"getCurrentStepTime",value:function(){var e=this.getMilliseconds(this.latestStepTime),t=new W.a.Time(W.a.Master.context.currentTime).toMilliseconds()-new W.a.Time(this.previousStepTime).toMilliseconds();return t<0||e>0&&e>t?this.previousStepTime:this.latestStepTime}},{key:"getCurrentStep",value:function(e,t){Math.abs(new W.a.Time(W.a.Master.context.currentTime)-new W.a.Time(this.latestAbsoluteTime)),Math.abs(new W.a.Time(W.a.Master.context.currentTime)-new W.a.Time(this.previousAbsoluteTime));var n=void 0;n=t?t.subSequence.isTrack?1e6:t.pattern.length():this.length;var r=this.lastTrackStep%n;return e=e||ke.a.baseResolution,Math.floor(r/(ke.a.baseResolution.numSteps()/e.numSteps()))}},{key:"getMilliseconds",value:function(e){return new W.a.Time(e).toMilliseconds()-new W.a.Time(W.a.Master.context.currentTime).toMilliseconds()}},{key:"recordTrack",value:function(e){this.tracksToRecord[e]=!0}},{key:"stopRecordingTrack",value:function(e){this.tracksToStopRecording[e]=!0}},{key:"isTrackRecording",value:function(e){return this.tracksRecording[e]}},{key:"doubleTrackLength",value:function(e){this.tracks[e].doubleTrackLength(),this.transport.loopStart="0:0:0",this.transport.loopEnd=this.length/32+":0:0"}},{key:"halfTrackLength",value:function(e){this.tracks[e].halfTrackLength(),this.transport.loopStart="0:0:0",this.transport.loopEnd=this.length/32+":0:0"}},{key:"isRecordingMix",get:function(){return this.store.getState().mix.isRecordingMix}},{key:"lfos",get:function(){return this.lfosTrack.lfos}},{key:"envelopesTrack",get:function(){return this.currentSubSequence.envelopesTrack}},{key:"lfosTrack",get:function(){return this.currentSubSequence.lfosTrack}},{key:"envelopes",get:function(){return this.envelopesTrack.envelopes.map(function(e){return e.envelope})}},{key:"onNewBpm",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]&&s[1],void 0!==t&&t<500&&t>=1){for(r in n||(this.transport.bpm.value=t),this.store.dispatch(Object(C.I)(t)),this.subSequences)this.subSequences[r].lfosTrack.onBPMUpdated();this.tracks.forEach(function(e){return e.onBPMUpdated()}),this.clockSync&&this.clockSync.onBPMChanged(t),this.channelMixer.masterChannel.effectsChain.onBPMUpdated(t),window.parent&&document.referrer&&(i=document.referrer,window.parent.postMessage({type:"bpm-updated",body:t},i))}case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bpm",get:function(){return this.bpmParameter.get()},set:function(e){this.bpmParameter.set(e,!1)}},{key:"swing",get:function(){return this.swingParameter.get()},set:function(e){this.swingParameter.set(e)}},{key:"updateBpm",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],this.bpm=t,!n){for(r in this.subSequences)this.subSequences[r].lfosTrack.onBPMUpdated();this.tracks.forEach(function(e){return e.onBPMUpdated()})}case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onNewSwing",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=(t-50)/50,this.transport.swing=n;case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateSwing",value:function(e){this.swing=e}},{key:"recording",value:function(e){this.store.dispatch(Object(C.Mb)(e)),this.isRecording=e,this.tracks.filter(function(e){return"MIDI"===e.getTrackType()}).map(function(t){return t.recording(e)})}},{key:"connectToKeyboardEngine",value:function(e){var t=this;this.keyboardEngine=e,this.keyboardHelper=new iO(this,e),this.midi=new vm(e,this.keyboardHelper,function(e){return t.updateBpm(e)}),this.midi.setStartCallback(function(){return t.play()}),this.midi.setStopCallback(function(){return t.stop()})}},{key:"hasMultipleSequencerEnginesPlaying",value:function(){var e=this.store.getState().sequencer.isPlaying;return Object.keys(e).filter(function(t){return e[t]}).length>1}},{key:"hasAtleastOneSequencerEnginePlaying",value:function(){var e=this.store.getState().sequencer.isPlaying;return Object.keys(e).filter(function(t){return e[t]}).length>0}},{key:"state",get:function(){return this.store.getState()}},{key:"isLoading",get:function(){var e=this.state.sequencer.loadingSequence;return Object.keys(e).some(function(t){return!0===e[t]})}},{key:"sustain",value:function(e){var t,n=this,r=fO(this.tracks.filter(function(e){return e.isEnabled}));try{var a=function(){var r=t.value,a=void 0;if(r.getTrackType()!==D.b)return"continue";var i=r.instrument;a=i.getInstrumentType()===U.f?i.ampEnvelope:i;var s=n.keyboardHelper,o=0;for(var c in 127===e?(a.releaseParameter.set(2500,!0),o=2500):(a.releaseParameter.set(100,!0),o=100),s.release=o,s.recordedTriggers){var u=s.recordedTriggers[c];u.recordedTriggers&&u.recordedTriggers.forEach(function(e){return e.release=o})}};for(r.s();!(t=r.n()).done;)a()}catch(i){r.e(i)}finally{r.f()}}},{key:"isShowingPianoRoll",value:function(){return this.state.sequencer.showPianoRoll&&this.state.arrangement.bottomMode===Gm.b}},{key:"isAnyTrackEnabled",value:function(){var e,t=fO(this.subSequences);try{for(t.s();!(e=t.n()).done;){if(e.value.tracks.some(function(e){return e.isEnabled}))return!0}}catch(n){t.e(n)}finally{t.f()}return!1}},{key:"sendPlayChange",value:function(e){this.subSequences.forEach(function(t){t.findNodeByName("mixbuttons").forEach(function(t){t.effect.sendMessage("playing",e?1:0)})})}},{key:"handleStopMode",value:function(){this.subSequences.forEach(function(e){e.findNodeByName("mixbuttons").forEach(function(e){e.effect.handleStop(),e.effect.sendMessage("playing",0)})})}}]),n}(Object(Ye.a)(function(e){return function(e){Object(u.a)(n,e);var t=Xm(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"initAudition",value:function(){var e=this,t=new rt(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);t.setSends(this.sends),t.setupEffects(),t.trackNumber=-2,t.trackNode.connect(W.a.Master),this.auditionTrack=t}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=lO(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"rolling",get:function(){return this.store.getState().sequencer.trackRolling}},{key:"trackRolling",set:function(e){this.state.midi.midiMapMode===Gv.b&&this.store.dispatch(Object(C.o)(new oO(this))),this.store.dispatch(Object(C.ue)(e)),this.rollingManager.clear()}},{key:"setSequenceRolling",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.rollingResolution,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.automationStep,a=arguments.length>4?arguments[4]:void 0;if(Object(Em.d)(e,t.resolution,t.isTriplet),this.state.midi.midiMapMode===Gv.b&&this.store.dispatch(Object(C.o)(new uO(this))),e){if(e!=this.isSequenceRolling||a){var i=t.getNumberOfStepsAtBaseResolution();for(var s in r-=r%i,this.subSequences)this.subSequences[s].initPatternBuffer(r),this.subSequences[s].tracks.forEach(function(e){return e.initPatternBuffer(r)});n&&(this.trackRolling=!0)}}else this.schedulePatternBufferClear=!0;if(this.isSequenceRolling=e,!n)if(this.store.getState().mix.isRecordingMix){var o=this.resolution;this.mix.addEvent(new $m.a(e,o))}else this.store.getState().mix.isPlayingMix&&this.mix.holdEvent(new $m.a(e,this.resolution))}},{key:"onResolutionUpdate",value:function(e){if(this.isSequenceRolling){var t=e.getNumberOfStepsAtBaseResolution(),n=this.trackStep;for(var r in n-=n%t,this.subSequences)this.subSequences[r].initPatternBuffer(n),this.subSequences[r].tracks.forEach(function(e){return e.initPatternBuffer(n)})}}},{key:"isSequenceRollingAtStep",value:function(e){if(this.store.getState().mix.isPlayingMix){var t=this.mix.getValue(wv.k,e);return this.mix.getValue(wv.k,e-1),t}return this.isSequenceRolling}},{key:"sequenceRolling",set:function(e){this.setSequenceRolling(e)}},{key:"scheduleSequenceRollingIfNeeded",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.store.getState(),this.schedulePatternBufferClear?(e.patternRollStepNumber=void 0,this.schedulePatternBufferClear=!1,!1):!(!this.isSequenceRolling||!r&&!e.rolling)&&!(!r&&void 0!==e.subSequence.higherRolling&&!1===e.subSequence.higherRolling)&&(e.updatePatternRollStepNumber(this.rollingResolution),!0)}},{key:"rollingResolution",get:function(){if(this.store.getState().mix.isPlayingMix){var e=this.mix.getEvent(wv.k,this.automationStep);if(void 0!==e)return e.getSubEvent(this.automationStep).getValue()}return this.resolution},set:function(e){if(this.store.getState().mix.isRecordingMix){var t=this.mix.getEvent(wv.k,this.automationStep),n=new Ly.a(e);n.step=this.automationStep,t.addSubEvent(n)}else this.state.mix.isPlayingMix&&this.mix.holdEvent(new Ly.a(e))}},{key:"resolution",get:function(){return this.state.sequencer.resolution},set:function(e){var t=e.resolution!==this.resolution.resolution||e.isTriplet!=this.resolution.isTriplet;if(this.resolution.isTriplet!==e.isTriplet)for(var n in this.subSequences)for(var r in this.subSequences[n].tracks){var a=this.subSequences[n].tracks[r];a.pattern.needsSync&&a.pattern.syncBuckets(this.resolution.isTriplet)}this.rollingResolution=e,this.state.midi.midiMapMode===Gv.b&&this.store.dispatch(Object(C.o)(new cy(this,e))),this.store.dispatch(Object(C.Yc)(e)),(t||e.resolution>=32||e.isTriplet)&&this.onResolutionUpdate(e)}},{key:"displayResolution",get:function(){return this.state.sequencer.displayResolution}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Vm(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).inputTriggers=[],e.inputTracks=[],e.resolvedInputTriggers=[],e.otherModules=[],e.otherTriggers=[],e}return Object(o.a)(n,[{key:"scheduleStep",value:function(e,t){var n=this;e=this.handleLatency(e);var r=this.storeStepAndTime(t,e);this.handleMixSessionStep(e),this.higherOrderSequencer.onNewStep(this.trackStep,e),this.applyHigherOrderSequencing(this.trackStep),this.scenes.onNewStep(this.trackStep),this.mixButtons.forEach(function(e){return e.sendCurrentStepNumber(n.trackStep)}),void 0!==this.stepOneCallback&&(this.startedTransportExplicitly&&15==t?this.stepOneCallback(e):this.startedTransportExplicitly||0!=t||this.stepOneCallback(e)),t=this.trackStep,this.scripting&&this.scripting.onStepReached(t),t%this.length===0&&this.scheduleAnyMasterResampling(e),this.scheduleParametersToRecord(t),r?this.scheduleParameterAutomations(t,e,!0):this.isLooping&&t===this.loopStart?this.scheduleParameterAutomations(t,e,!0):this.scheduleParameterAutomations(t,e,!1),this.scheduleSubSequences(t,e),this.metronome&&this.scheduleTrack(this.metronome,t,e).forEach(function(e){return n.metronome.trigger(e.stepData,e.time,t)}),this.scheduleSamplesRolling(t,e),t%=this.length;var a=this.storeLastStepAndTime(t,e);this.clockSync.onTick(this.getMilliseconds(e),t),this.midi&&this.midi.onTick(this.getMilliseconds(e),t,this.resolution),Object.keys(this.parametersToUpdate).length>0&&(this.dispatch(Object(C.ub)(this.parametersToUpdate)),this.parametersToUpdate={}),W.a.context.setTimeout(function(){n.playing&&(n.lastTrackStepReal=a,n.previousStepReal=n.trackStepReal,n.previousStepTimeReal=n.currentStepTime,n.trackStepReal=a,n.currentStepTime=e,n.store.dispatch(Object(C.bb)(n.getSequenceId(),t,n.trackStep)))},this.getMilliseconds(e)/1e3)}},{key:"scheduleSubSequences",value:function(e,t){var n=this,r=this.higherOrderSequencer,a=r.inputModules,i=this.inputTriggers,s=this.inputTracks,o=this.resolvedInputTriggers,c=this.otherModules,u=this.otherTriggers;i.length=0,s.length=0,o.length=0,c.length=0,u.length=0;var l,f=zm(a);try{for(f.s();!(l=f.n()).done;){var p=l.value;if(r.shouldPlayModule(p)){s.push(p.tracks);var d=r.getStepForModule(e,p);i.push(this.scheduleTracks(Object(h.a)(p.tracks),d,t))}}}catch(E){f.e(E)}finally{f.f()}i.forEach(function(r,a){return o.push(Nm(n,s[a],r,t,e))});var v=o.flatMap(function(e,t){return a[t].tracks.flatMap(function(t){var n=t.trackNumber;return e[n]})}).filter(function(e){return e});r.input(v),r.output(t,e),this.subSequences.forEach(function(e){a.includes(e)||c.push(e)});var m,y=[],b=zm(c);try{for(b.s();!(m=b.n()).done;){var g=m.value;if(this.state.mix.isPlayingMix&&g.updateVolumeFromAutomation(e),r.shouldPlayModule(g)){var O=this.higherOrderSequencer.getStepForModule(e,g);g.schedulePads(t,O),this.scheduleSubSequenceZObjects(g,t,O);var k,j=this.scheduleTracks(Object(h.a)(g.tracks),O,t),w=zm(r.getOutputForModule(g));try{for(w.s();!(k=w.n()).done;){var x=k.value;u.push(j),y.push(x.tracks)}}catch(E){w.e(E)}finally{w.f()}}}}catch(E){b.e(E)}finally{b.f()}u.forEach(function(r,a){return Nm(n,y[a],r,t,e)});var S,P=zm(this.subSequences);try{for(P.s();!(S=P.n()).done;)S.value.sendPadMessages(t)}catch(E){P.e(E)}finally{P.f()}}},{key:"scheduleSubSequenceZObjects",value:function(e,t,n){if(n=Math.floor(n*e.playhead.speedFactor),e.lastPatternStep!==n)if(e.lastPatternStep=n,this.scheduleSequenceRollingIfNeeded(e,n,t,!0)){var r=this.resolution,a=r.getNumberOfStepsAtBaseResolution(),i=e.patternRollStepNumber+n%a;if(!r.isTriplet)return void e.scheduleZObjects(t,i);var s=Math.floor(i);W.a.Time("32n"),i=s;var o,c=zm(Object(Bm.a)(i,r,!0));try{for(c.s();!(o=c.n()).done;){var u=o.value;e.scheduleZObjects(t+u.time,i)}}catch(l){c.e(l)}finally{c.f()}}else e.scheduleZObjects(t,n)}},{key:"scheduleTracks",value:function(e,t,n){var r=this;if(void 0!==e){e=function(e){return e}(e);var a,i={},s=zm(e);try{for(s.s();!(a=s.n()).done;){var o=a.value;this.setGroupBits(o,t)}}catch(u){s.e(u)}finally{s.f()}for(var c=0;c<e.length;c++)try{!function(){var a=e[c],s=r.scheduleTrack(e[c],t,n);i[a.trackNumber]=s,s.forEach(function(e){return Object(Em.e)(a,e)})}()}catch(u){console.log("caught error while scheduling track err = "),console.log(u)}return i}}},{key:"scheduleTrack",value:function(e,t,n){e.subSequence.isTrack&&e.scheduleTrackPatternChangeIfAny(t);var r=e.getPatternStep(t,!0);e.sendMessage("pattern progress",100*r/e.length);var a=Math.floor(r),i=new W.a.Time("32n")*(r-a);e.isEnabled;try{e.pattern.mix.scheduleNext(a,n,this)}catch(x){console.log("caught an error while scheduling pattern events = "),console.log(x)}if(e.scheduleAnyRecording(r,n),this.deleting&&e.deleteAtStep(a),0==a&&(this.scheduleAnyFrozenTrackPlaying(e,n),this.scheduleAnyTrackRecording(e,n),this.scheduleAnyTrackResampling(e,n),this.scheduleAnyAudioTrackPlaying(e,n),this.scheduleAnyStepGroups(e,n)),this.scheduleSequenceRollingIfNeeded(e,a,n)){var s=e.getFactoredResolution(),o=s.getNumberOfStepsAtBaseResolution(),c=e.patternRollStepNumber+r%o;if(c%=e.pattern.stepBuckets.length,!s.isTriplet){var u,l=this.getTrackTriggers(e,n,c,e.pattern,r),f=zm(l);try{for(f.s();!(u=f.n()).done;)u.value.rolledStepNumber=c}catch(x){f.e(x)}finally{f.f()}return l}var p=Math.floor(c),d=(c-p)*W.a.Time("32n");e.isPlayheadReversed()&&(d*=-1),c=p;var v,m=[],y=0,b=zm(Object(Bm.a)(c,s,!0));try{for(b.s();!(v=b.n()).done;){var g=v.value;m=[].concat(Object(h.a)(m),Object(h.a)(this.getTrackTriggers(e,n-d+g.time,c,e.pattern,r,0===y))),y++}}catch(x){b.e(x)}finally{b.f()}for(var O=0,k=m;O<k.length;O++)k[O].rolledStepNumber=c;return 0===m.length?this.getTrackTriggers(e,n-d,c,e.pattern,r):m}if(!e.isMetronome&&e.speedFactor>1){for(var j=[],w=1;w<=e.speedFactor;w++)j=[].concat(Object(h.a)(j),Object(h.a)(this.getTrackTriggers(e,n+i,r,e.pattern,r))),n+=new W.a.Time("32n"),r++;return j}return this.getTrackTriggers(e,n+i,r,e.pattern,r)}},{key:"getTrackTriggers",value:function(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=e.isPlayheadReversed(a),o=n,c=a,u=void 0;e.isWarped()&&0===this.trackStep&&(n=0,a=0,u={stepNumber:o,actualStepNumber:c});var l=r.getBucket(n);i&&e.onNewStep(n,t);var f=l?l.steps:[],p=[];if(e.isFrozen||e.getTrackType()===D.a)0===n&&e.triggerFrozenSample(t);else for(var d in f){var v=f[d];s&&(d*=-1);var m=new W.a.Time(t)+Hm*d,y=v.getPolyphony();for(var b in y=[].concat(Object(h.a)(y.filter(function(e){return!e.slide})),Object(h.a)(y.filter(function(e){return e.slide})))){var g=y[b];if(e.deleting)p.push(g);else if(!this.isStepMasked(g)){var O=this.transformStep(g,m,a),k=O.time,j=O.step;j.slide||e.handlePLockedAutomations(j,k),e.midiEffects.input(j,k,a,u)}}}if(e.deleting)return p.length>0&&this.operationManager.dispatch(Object(Me.j)(e,p)),[];var w=e.midiEffects.output(t,n,a).filter(function(e){return e.stepData&&e.stepData.track});return e.disabled?[]:this.shouldPlayStep(a)?w:[]}},{key:"storeLastStepAndTime",value:function(e,t){this.nextStepScheduled=e;var n=this.getLoopedStep(this.trackStep+1),r=this.trackStep;this.lastTrackStep=this.trackStep,this.trackStep=n,this.previousStepTime=this.latestStepTime,this.latestStepTime=t,new W.a.Time(this.latestStepTime);var a=this.currentStep;return this.currentStep=e,this.previousStep=a,r}},{key:"storeStepAndTime",value:function(e,t){var n=this.firstStep;if(this.firstStep){var r,a=zm(this.subSequences);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.lfosTrack.start(t),i.tracks.filter(function(e){return e.lfosTrack}).forEach(function(e){return e.lfosTrack.start(t)})}}catch(s){a.e(s)}finally{a.f()}this.firstStep=!1}return this.lastTrackStep===this.trackStep&&(this.trackStep+=1),this.nextTimeScheduled=t,this.automationStep,this.automationStep=this.getLoopedStep(this.trackStep),n}},{key:"shouldPlayStep",value:function(e){return e%=32,e=Math.floor(e/2),this.state.steps.masterStepToggles[e]}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Vg(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"setGroupBits",value:function(e,t){if(0===e.getPatternStep(t)){var n,r=zg(e.stepGroups);try{for(r.s();!(n=r.n()).done;){var a=n.value;Object(Xe.f)(a)}}catch(i){r.e(i)}finally{r.f()}}}},{key:"scheduleAnyStepGroups",value:function(e,t){e.stepGroups.length>0&&(e.pattern.transform(),this.state.groups.stepsGroupMode&&e.subSequence===this.currentSubSequence&&e.updateSteps())}},{key:"transformStep",value:function(e,t,n){return e.group?Object(Xe.i)(e,e.group,t,n):{step:e,time:t}}},{key:"isStepMasked",value:function(e){var t=e.probability/100,n=Math.random();return!e.on||n>t||Object(Xe.g)(e)}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=Hg(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"resetAutomationParameters",value:function(){}},{key:"clearScheduledAutomations",value:function(){var e=this.state.automation.automationSchedulers[this.sequenceId]||{},t=this.state.automation.automationMixSchedulers[this.sequenceId]||{},n=Object(p.a)({},e,t),r={};for(var a in n)if(n[a].clear(),n[a].parameter){var i=n[a].parameter.updateRedux();if(i){var s=i.id,o=i.value;r[s]=o}}Object.keys(r).length>0&&this.store.dispatch(Object(C.ub)(r))}},{key:"scheduleParameterAutomations",value:function(e,t,n){this.multiSequencerEngine&&(e=this.multiSequencerEngine.trackStep);var r=this.state.automation.automationSchedulers[this.sequenceId]||{},a=this.state.mix.isPlayingMix&&this.state.automation.automationMixSchedulers[this.sequenceId]||{},i=Object(p.a)({},r,a),s={};for(var o in i){var c=i[o],u=c.parameter;if(void 0!==u&&(!c.isMix||this.state.mix.isPlayingMix)){var l=u.track,f=this.length;if(void 0!==l){if(l.instrumentRack&&(l=l.instrumentRack),void 0===l.pattern)continue;f=l.length}if(c.isMix?(n&&c.start(t),0===c.eventIds.length&&c.automations.some(function(t){return t.step>=e&&t.step<e+32})&&c.schedule(e,t,Math.max(0,t-.001))):e%f===0&&c.schedule(e,t),u.onNewStep(e),u.context&&u.context.macro){var h=u.context.macro.subMacros;for(var d in h){var v=h[d].parameter;v.onNewStep(e),s[v.id]=v.getAtStep(e)}}this.trackStep%2===0&&-1===this.state.automation.parameterSliderDown.indexOf(u)&&c.automations.length>0&&(c.isMix&&!c.hasEventsAfterStep(e)||(s[u.id]=c.getValueAtStep(e)))}}this.trackStep%2===0&&Object.keys(s).length>0&&this.store.dispatch(Object(C.ub)(s))}},{key:"updateAutomationRedux",value:function(e,t){this.store.dispatch(Object(C.k)(e,t))}}]),n}(e)})(Bg)),yO=function(){return 60+Math.floor(120*Math.random())},bO=mO,gO=n(794),OO=n(569),kO=n(391),jO=(n(918),n(496));function wO(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return xO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xO(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function xO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function SO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var PO=Hn.a.presets,EO=function(e){Object(u.a)(n,e);var t=SO(n);function n(e,r,a,i,o,c){var u;return Object(s.a)(this,n),(u=t.call(this,e,r,a,i,o,c)).recordingsToSave=[],u.loadedSequenceId=void 0,u.samplesToSync=[],u.loadedSamples={},u.editHistory=[],u}return Object(o.a)(n,[{key:"handleSaveHook",value:function(){var e,t=wO(this.currentSubSequence.findNodeByName("save.hook"));try{for(t.s();!(e=t.n()).done;){e.value.sendMessageToInlet([v.a])}}catch(n){t.e(n)}finally{t.f()}}},{key:"save",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jO.c,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,u=void 0!==s&&n!=jO.c?s.guildId:0;return new Promise(function(){var l=Object(i.a)(a.a.mark(function i(l,f){var h,p,d,v,m;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.handleSaveHook(),h=t.currentSubSequence,p=t.sequenceId,a.next=5,t.saveAnyNewRecordings(u,r,void 0!==o);case 5:for(v in d={hasPatterns:!0,subSequences:t.getSubSequences(),sendVolumes:t.getSendVolumesToSave(),bpm:t.bpm,swing:t.swing,resolution:ke.a.baseResolution.toString(),gateMode:t.gateMode,scripting:t.scripting.getJson(),parameterLocks:t.parameterLocks.map(function(e){return e.getJson()}),effectsCollapsed:t.state.effects.effectCollapsed,cableSegmentations:t.state.spatial.cableSegmentations,modulesCollapsed:t.state.pads.modulesCollapsed,effectStarred:t.state.effects.effectStarred,mix:t.mix.getJson(),sends:t.sends.getJson(),patternColors:t.store.getState().toolbar.patternColors,lfos:t.lfos.map(function(e){return e.getJson()}),envelopes:t.envelopes.map(function(e){return e.getJson()}),lfoPatternLocks:t.state.tracks.lfoPatternLocks,envelopePatternLocks:t.state.tracks.envelopePatternLocks,hiddenObjects:t.state.spatial.hiddenObjects,theme:t.state.sequencer.theme,effectPatternLocks:t.state.effects.effectPatternLocks,patternLocks:t.state.sequencer.patternLocks,trackPatternLocks:t.state.tracks.trackPatternLocks,scenes:t.scenes.getJson(),windowPositions:RO(t.state.windows.windowPositions,t),presentationWindowPositions:t.state.windows.presentationWindowPositions,presentationMode:t.state.spatial.presentationMode,higherOrderSequencer:t.higherOrderSequencer.getJson(),inletConnections:MO(t.state.windows.inletConnections,t),lockedObjects:t.state.spatial.lockedObjects,samplesMetadata:Object(j.b)(t),pluginsLoaded:t.state.plugins.pluginsLoaded&&t.state.plugins.pluginsLoaded.map(function(e){return e.id}),pulledEffects:t.state.effects.pulledEffects.map(function(e){return e.type&&!e.getEffectType?{x:e.x,y:e.y,width:e.width,height:e.height,id:e.id||e.instrument.id,instrumentId:e.instrument.id,type:e.type,subType:e.subType}:e.id}),masterChannel:t.channelMixer.masterChannel.getJson()},o&&(d.nftZObject=o.id),t.state.sequencer.wallpaper&&(d.wallpaper=t.state.sequencer.wallpaper),d)d[v]&&0!==d[v].length||delete d[v];d=Object(ee.b)(d,"bpmParameter",t.bpmParameter),d=Object(ee.b)(d,"swingParameter",t.swingParameter),t.switchToSubSequence(h.id),m=new gO.a(!0),n===jO.b?Hn.a.crypto.encryptAndSave(e,d,t.loadedSequenceId,r).then(function(e){t.update(e),t.saveProjectMetadata(e),l(e)}):n===jO.a?Hn.a.guildSequences.newGuildSequence(d,e,t.loadedSequenceId,s.guildId).then(function(e){t.update(e),t.saveProjectMetadata(e),l(e)}):n===jO.c&&m.save(e,d,t.loadedSequenceId,t.getSamples(),r,c,t.bpm).then(function(n){var a=t.sequenceId;t.update(n.ipfsHash),r&&t.saveProjectMetadata(n.ipfsHash,a,t.getSamples(),e),t.loadedSequenceId=n.ipfsHash,t.updateAutomationRedux(p,t.loadedSequenceId),l(c?{ipfsHash:n.ipfsHash,json:d}:n.ipfsHash)});case 15:case"end":return a.stop()}},i)}));return function(e,t){return l.apply(this,arguments)}}())}},{key:"getTrackMidiEffectsToSave",value:function(){var e=[];for(var t in this.tracks)e.push(this.tracks[t].midiEffects.getJson());return e}},{key:"getTrackLiveEffectsToSave",value:function(){var e=[];for(var t in this.tracks)e.push(this.tracks[t].liveEffects.getJson());return e}},{key:"getTrackEffectsToSave",value:function(){var e=[];for(var t in this.tracks){for(var n=[],r=this.tracks[t].effects,a=0;a<r.length;a++)n.push(r[a].getJson());e.push(n)}return e}},{key:"getTrackEffectsChainsToSave",value:function(){var e=[];for(var t in this.tracks)e.push(this.tracks[t].effectsChains.map(function(e){return e.getJson()}));return e}},{key:"getSubSequences",value:function(){var e=[];for(var t in this.subSequences){this.switchToSubSequence(this.subSequences[t].id,!1);for(var n=[],r=[],a=0;a<this.subSequences[t].tracks.length;a++){var i=this.subSequences[t].tracks[a],s=N(i),o=s.patterns,c=s.trackData;r.push(c),n.push(o)}var u=this.subSequences[t].groups.getJson(),l=this.subSequences[t].lfosTrack.lfos.map(function(e){return e.getJson()}),f=this.subSequences[t].envelopesTrack.envelopes.map(function(e){return e.getJson()});e.push(Object(p.a)({},this.subSequences[t].getJson(),{tracks:n,tracksData:r,lfos:l,envelopes:f,groups:u,tracksPatterns:this.getTracksPatternsToSave(),tracksEffectsChains:this.getTrackEffectsChainsToSave(),tracksMidiEffects:this.getTrackMidiEffectsToSave(),tracksLiveEffects:this.getTrackLiveEffectsToSave(),tracksParameters:this.getTracksParametersToSave(),sendVolumes:this.getSendVolumesToSave(),mix:this.subSequences[t].mix.getJson(),id:this.subSequences[t].id,midiEffects:this.subSequences[t].midiEffects.getJson(),pads:this.subSequences[t].getPadsJson(),sequencers:this.subSequences[t].getSequencersJson(),zobjects:this.subSequences[t].getZObjectsJson()}))}return e}},{key:"getSendVolumesToSave",value:function(){return this.tracks.map(function(e){return e.getSendNodes().map(function(e){return e.volume.value})})}},{key:"getTracksPatternsToSave",value:function(){return this.tracks.map(function(e){return e.patterns.map(function(e){return e.getJson()})})}},{key:"getTracksParametersToSave",value:function(){return this.tracks.map(function(e){return e.trackData.getJson()})}},{key:"loadSubSequences",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,s,o,c=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=[],0===this.tracks.length&&this.subSequences.length<=1&&(this.subSequences.forEach(function(e){return e.dispose()}),this.subSequences=[]),s=a.a.mark(function e(s){var o,u,l,f,h,p,d;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n||parseInt(s)===n){e.next=2;break}return e.abrupt("return","continue");case 2:return o=t.subSequences[s],u=o.id,l=c.newSubSequence(u),f=o.tracks.map(function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qr(c,o.tracksData[n],t,n,l);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),e.next=8,Promise.all(f);case 8:for(p in h=e.sent,o.tracksData)"chokes"in(d=o.tracksData[p])&&h[p].chokes.fromJson(d.chokes,h);h.forEach(function(e){return l.addTrack(e)}),l.fromJson(o),r.push(l);case 13:case"end":return e.stop()}},e)}),e.t0=a.a.keys(t.subSequences);case 4:if((e.t1=e.t0()).done){e.next=12;break}return o=e.t1.value,e.delegateYield(s(o),"t2",7);case 7:if("continue"!==e.t2){e.next=10;break}return e.abrupt("continue",4);case 10:e.next=4;break;case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAllRecordingsToSave",value:function(){var e=this.recordingsToSave.filter(function(e){return void 0!==e.audioBuffer});for(var t in this.subSequences){var n=this.subSequences[t];for(var r in n.tracks)e=[].concat(Object(h.a)(e),Object(h.a)(n.tracks[r].frozenSamplesToSave))}return[].concat(Object(h.a)(e),Object(h.a)(this.samplesToSync))}},{key:"saveAnyNewRecordings",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f,p,d,v,m,y,b,g,O,k,j,w,x,S,P,E,T,A,M,R=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=R.length>1&&void 0!==R[1]&&R[1],r=R.length>2?R[2]:void 0,i=this.recordingsToSave.filter(function(e){return void 0!==e.audioBuffer}),e.t0=a.a.keys(this.subSequences);case 4:if((e.t1=e.t0()).done){e.next=19;break}s=e.t1.value,o=this.subSequences[s],e.t2=a.a.keys(o.tracks);case 8:if((e.t3=e.t2()).done){e.next=17;break}if(c=e.t3.value,0!==t||!n&&!r||window.installation){e.next=14;break}if(!r){e.next=14;break}return e.next=14,o.tracks[c].makePublicIfNeeded();case 14:i=[].concat(Object(h.a)(i),Object(h.a)(o.tracks[c].frozenSamplesToSave)),e.next=8;break;case 17:e.next=4;break;case 19:for(f in u=new OO.a,l=[],i){for(p=i[f],d=p.name,v=["","","",""],m=p.videoId||"",y=p.getTagsToSave(),b=(new Date).getFullYear(),y.length>4&&(y=y.slice(0,4)),g=y.length;g<4;g++)y.push("");"",O=p.getId(),l.push({ipfsHash:O,title:d,videoId:m,tags:y,styles:v,country:"",year:b,coverArt:void 0,discogsId:void 0})}for(k in this.samplesToSync){for(j=this.samplesToSync[k],w=j.name,x=["","","",""],S=j.videoId||"",(P=j.tags).length>4&&(P.reverse(),P=P.slice(0,4)),E=P.length;E<4;E++)P.push("");T=j.year||2020,A=j.country||"",M=j.getId(),l.push({ipfsHash:M,title:w,videoId:S,tags:P,styles:x,country:A,year:T,coverArt:j.coverArtHash,discogsId:j.discogsId})}if(0!==l.length){e.next=25;break}return e.abrupt("return");case 25:0!==t?Hn.a.newEncryptedSamples(l,t,u):Hn.a.newSamplesWithMetadata(l,0);case 26:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadTrackPatternLocks",value:function(e){var t=Object(p.a)({},e.trackPatternLocks);e.tracks&&((t={})[this.currentSubSequence.id]=e.trackPatternLocks),t=Object(p.a)({},this.state.tracks.trackPatternLocks,t),this.store.dispatch(Object(C.t)(t))}},{key:"loadTrackMidiEffects",value:function(e,t,n){if(void 0!==e.tracksMidiEffects){var r=n[t].midiEffects.fromJson(e.tracksMidiEffects[t]);return{effects:n[t].midiEffects.effects,bulk:r}}return{effects:[],bulk:{}}}},{key:"loadTrackEffects",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,s,o,c,u,l,f,h,d,v,m,y,b;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],s=r[n].effectsChains[0],o={},void 0===t.tracksEffects){e.next=17;break}c=0;case 5:if(!(c<t.tracksEffects[n].length)){e.next=14;break}return e.t0=i,e.next=9,Object(J.a)(t.tracksEffects[n][c],r,this,n);case 9:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 11:c++,e.next=5;break;case 14:s.updateEffects(i.map(function(e){return e.effect})),e.next=47;break;case 17:if(void 0===t.tracksEffectsChains){e.next=45;break}u=r[n],l=t.tracksEffectsChains[n],f=[],e.t2=a.a.keys(l);case 22:if((e.t3=e.t2()).done){e.next=41;break}h=e.t3.value,d=new z.a(u.gainNode,u.trackNode,(new V.a).forTrack(u),this),v=l[h],e.t4=a.a.keys(v);case 27:if((e.t5=e.t4()).done){e.next=37;break}return m=e.t5.value,y=v[m],e.next=32,Object(J.a)(y,r,this,n);case 32:b=e.sent,d.addEffect(b.effect),o=Object(p.a)({},o,b.bulk),e.next=27;break;case 37:d.updateEffects(),f.push(d),e.next=22;break;case 41:u.effectsChains.forEach(function(e){return e.dispose()}),u.effectsChains=f,e.next=47;break;case 45:i=Object(H.a)(this),s.updateEffects(i);case 47:return e.abrupt("return",{effects:i,bulk:o});case 48:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadSubSequenceMix",value:function(e,t){t.mix.loadFromJson(e.mix,this)}},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){return n()},e);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getSleepTime",value:function(){return this.state.mix.isPlayingMix?100:0}},{key:"loadSubSequencePatterns",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,s,o,c,u=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:!(u.length>3&&void 0!==u[3])||u[3],i={},s=n.tracks,o=0;case 4:if(!(o<t.tracks.length)){e.next=11;break}return c=s[o],e.next=8,Zr({sequencerEngine:this,track:c,tracks:s,patterns:t.tracks[o],trackData:t.tracksData[o],trackEffects:t.tracksEffects&&t.tracksEffects[o],trackEffectChains:t.tracksEffectsChains&&t.tracksEffectsChains[o],trackMidiEffects:t.tracksMidiEffects[o],patternParameters:t.tracksPatterns[o],subSequence:n});case 8:o++,e.next=4;break;case 11:return e.abrupt("return",i);case 12:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadSubSequenceTracksParameters",value:function(e,t){for(var n in e.tracksParameters){var r=e.tracksParameters[n];t[n].trackData.loadFromJson(r,void 0,!1,!1,this),t[n].pattern.calculateFills(r)}}},{key:"loadSubSequencePatternParameters",value:function(e,t){for(var n in t)for(var r=t[n],a=0;a<r.patterns.length;a++)r.patterns.length>a&&r.patterns[a].loadFromJson(e.tracksPatterns[n][a])}},{key:"loadSubSequenceEffects",value:function(e,t){for(var n in t){var r=t[n];this.setupNewTrack(r,!0,!0,!1);for(var a=r.getSendNodes(),i=0;i<e.sendVolumes[n].length;i++)a[i]&&(a[i].volume.value=e.sendVolumes[n][i]);void 0!==e.tracksLiveEffects&&r.liveEffects.fromJson(e.tracksLiveEffects[n])}if(e.midiEffects){var s=this.currentSubSequence.midiEffects.fromJson(e.midiEffects);this.dispatch(Object(C.ub)(s))}}},{key:"getMaxSubSequenceId",value:function(){var e=-1;for(var t in this.subSequences){var n=this.subSequences[t].id;n>e&&(e=n)}return e}},{key:"loadSubSequenceLFOs",value:function(e,t){var n={};for(var r in e.lfos){var a=e.lfos[r];n=Object(p.a)({},n,t.lfos[parseInt(r)].lfo.fromJson(a))}return n}},{key:"loadSubSequenceEnvelopes",value:function(e,t){for(var n in e.envelopes){var r=e.envelopes[n];t.envelopes[parseInt(n)].fromJson(r)}}},{key:"normalizeSubSequenceIds",value:function(e){var t=this,n={},r=function(r){var a=e.subSequences[r].id;AO(a)||t.subSequences.some(function(e){return e.id===a})?n[a]=Object(S.uuid)():n[a]=a};for(var a in e.subSequences)r(a);this.convertSubSequenceIds(e,n)}},{key:"convertSubSequenceIds",value:function(e,t){for(var n in e.subSequences){var r=e.subSequences[n];void 0!==t[r.id]&&(r.id=t[r.id]),e.subSequences[n]=r}var a={},i={},s={},o=new Set(Object.values(t));for(var c in e.trackPatternLocks){if(void 0!==t[c])a[t[c]]=e.trackPatternLocks[c];else o.has(c)||(a[c]=e.trackPatternLocks[c])}for(var u in e.envelopePatternLocks){if(void 0!==t[u])s[t[u]]=e.envelopePatternLocks[u];else o.has(u)||(s[u]=e.envelopePatternLocks[u])}for(var l in e.lfoPatternLocks){if(void 0!==t[l])i[t[l]]=e.lfoPatternLocks[l];else o.has(l)||(i[l]=e.lfoPatternLocks[l])}e.trackPatternLocks=a,e.lfoPatternLocks=i,e.envelopePatternLocks=s}},{key:"loadSequence",value:function(e,t){var n=this;return this.setLoadingProgress(e,0),new Promise(function(){var r=Object(i.a)(a.a.mark(function r(s,o){var c,u,l,f,h,d;return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n.store.dispatch(Object(C.ac)(e,!0)),r.next=3,$r.a.getAccount();case 3:if(c=r.sent,u=void 0,r.prev=5,window.isNFT||w.a.getItem("projectHash")!==e){r.next=10;break}u=w.a.getItem("projectData"),r.next=36;break;case 10:if(window.isNFT||!w.a.getItem("sequence."+e)){r.next=14;break}u=w.a.getItem("sequence."+e),r.next=36;break;case 14:if(void 0===c){r.next=36;break}return r.next=17,Hn.a.guildSequences.getGuildSequence(e);case 17:if(void 0!==(l=r.sent)){r.next=23;break}return r.next=21,Hn.a.encryption.getSequencesSharedWithUser(e);case 21:l=(l=r.sent)[0];case 23:if(void 0===l){r.next=29;break}return r.next=26,Hn.a.crypto.fetchAndDecrypt(e,l);case 26:u=r.sent,r.next=36;break;case 29:return r.next=31,Hn.a.encryption.getEncryptedSequenceIfAny(e);case 31:if(void 0===(f=r.sent)){r.next=36;break}return r.next=35,Hn.a.crypto.fetchAndDecrypt(e,f);case 35:u=r.sent;case 36:r.next=40;break;case 38:r.prev=38,r.t0=r.catch(5);case 40:h=!1,0==n.tracks.length&&(h=!0),d=new gO.a(!AO(e),AO(e)?e:void 0,AO(e)?void 0:e,u),void 0===t&&d.loadTitle().then(function(e){n.store.dispatch(Object(C.zd)(e))}),n.dispatch(Object(C.W)(!1)),d.load().then(function(){var r=Object(i.a)(a.a.mark(function r(i){var o,c,u,l,f,d,v,m,y,b,g,O,k,j,w,S,P,E,T,A,M,R,N,q,I,_,D,F,L,B,z,J,V,H,U,G,W,K,Q,Z,Y,X,$,te,ne,re,ae,ie,se,oe,ce,ue,le,fe,he;return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n.bulkConnections={},n.loadedSequenceId=e,void 0===t&&(n._wallpaper=i.wallpaper),i.wallpaper&&(window.exhibit||!window.explore||x.isMobile)&&void 0===t&&n.dispatch(Object(C.Oe)(i.wallpaper)),!((o=Object(kO.a)(i)).length<=18)){r.next=9;break}return r.next=8,Object(kO.b)(o,n.encryptedIpfs,n.getSleepTime(),n);case 8:n.loadedSamples=r.sent;case 9:if(n.setLoadingProgress(e,25),n.normalizeSubSequenceIds(i),n.length,c=ke.a.oldDefaultResolution,i.groups,n.hasAtleastOneSequencerEnginePlaying()||void 0===t&&(n.updateBpm(i.bpm),Object(ee.a)(i,"bpmParameter",n.bpmParameter)),"samplesMetadata"in i&&(window.samplesMetadata=i.samplesMetadata),void 0===i.subSequences){for(l in i.subSequences=[{id:0,tracks:i.tracks,tracksData:i.tracksData,groups:i.groups,envelopes:i.envelopes,lfos:i.lfos,tracksParameters:i.tracksParameters,tracksPatterns:i.tracksPatterns,tracksEffects:i.tracksEffects,tracksMidiEffects:i.tracksMidiEffects,tracksLiveEffects:i.tracksLiveEffects,sendVolumes:i.sendVolumes}],u={},i.tracksData)f=i.tracksData[l],u[l]=f.patternLocks;i.trackPatternLocks=u}return n.normalizeSubSequenceIds(i),"swing"in i&&(n.updateSwing(i.swing),Object(ee.a)(i,"swingParameter",n.swingParameter)),c=TO(i.resolution),d=!1,"hasPatterns"in i&&(d=!0),h&&(n.playSequence=n.getPlaySequence()),r.next=25,n.loadSubSequences(i,t);case 25:if(v=r.sent,n.loadTrackPatternLocks(i),!("sends"in i)){r.next=30;break}return r.next=30,n.sends.loadFromJson(i.sends,t);case 30:n.setLoadingProgress(e,35),m={},r.t0=a.a.keys(v);case 33:if((r.t1=r.t0()).done){r.next=59;break}return y=r.t1.value,n.setLoadingProgress(e,35+parseFloat(y)/v.length*35),(new Date).getTime(),b=void 0!==t?t:y,n.switchToSubSequence(v[y].id,!1),r.t2=p.a,r.t3={},r.t4=m,r.next=44,n.loadSubSequencePatterns(i.subSequences[b],v[y],c,d);case 44:r.t5=r.sent,m=(0,r.t2)(r.t3,r.t4,r.t5),n.loadSubSequenceTracksParameters(i.subSequences[b],v[y].tracks),n.loadSubSequenceEffects(i.subSequences[b],v[y].tracks),m=Object(p.a)({},m,n.loadSubSequenceLFOs(i.subSequences[b],v[y])),n.loadSubSequenceEnvelopes(i.subSequences[b],v[y]),n.loadSubSequenceMix(i.subSequences[b],v[y]),v[y].loadPadsJson(i.subSequences[b].pads),v[y].loadSequencersJson(i.subSequences[b].sequencers),g=(new Date).getTime(),v[y].loadZObjectsJson(i.subSequences[b].zobjects),O=(new Date).getTime(),console.log("LOADING ZOBJECT DATA took %s ms",O-g),r.next=33;break;case 59:n.switchToSubSequence(v[0].id,!1),n.store.dispatch(Object(C.ub)(m)),"effectPatternLocks"in i&&n.dispatch(Object(C.q)(i.effectPatternLocks)),"lfoPatternLocks"in i&&(k=Object(p.a)({},i.lfoPatternLocks),i.tracks&&((k={})[n.currentSubSequence.id]=i.lfoPatternLocks),k=Object(p.a)({},n.state.tracks.lfoPatternLocks,k),n.store.dispatch(Object(C.s)(k))),n.setLoadingProgress(e,80),"envelopePatternLocks"in i&&(j=Object(p.a)({},i.envelopePatternLocks),i.tracks&&((j={})[n.currentSubSequence.id]=i.envelopePatternLocks),j=Object(p.a)({},n.state.tracks.envelopePatternLocks,j),n.store.dispatch(Object(C.r)(j))),n.gateMode=!("gateMode"in i)||i.gateMode,r.t6=a.a.keys(v);case 67:if((r.t7=r.t6()).done){r.next=75;break}return w=r.t7.value,S=void 0!==t?t:w,n.switchToSubSequence(v[w].id,!1),r.next=73,v[w].groups.fromJson(i.subSequences[S].groups,n);case 73:r.next=67;break;case 75:return n.setLoadingProgress(e,90),"mix"in i&&n.mix.loadFromJson(i.mix,n),n.loadParameterLocks(i),r.next=80,n.sleep(n.getSleepTime());case 80:for(P in n.setLoadingProgress(e,95),v)for(T in(E=v[P]).tracks)void 0===(A=E.tracks[T]).group&&("MIDI"===A.getTrackType()?E.groups.addMidiTrack(A):void 0!==A.sample&&void 0!==A.sample.ipfsHash&&E.groups.addTrack(A)),n.loadPulledEffects(i.pulledEffects);M=wO(v);try{for(N=function(){var e=R.value;setTimeout(function(){var t=(new Date).getTime();e.loadLostParameters(!0);var n,r=wO(e.tracks);try{for(r.s();!(n=r.n()).done;){var a,i=n.value,s=wO(i.patterns);try{for(s.s();!(a=s.n()).done;){a.value.getAllSteps().forEach(function(e){return e.loadParameterLocks()})}}catch(c){s.e(c)}finally{s.f()}window.isNFT||i.updateSteps()}}catch(c){r.e(c)}finally{r.f()}var o=(new Date).getTime();console.log("loading lost took %s ms",o-t)},750)},M.s();!(R=M.n()).done;)N()}catch(pe){M.e(pe)}finally{M.f()}if("lockedObjects"in i&&n.store.dispatch(Object(C.He)(i.lockedObjects)),"masterChannel"in i&&void 0===t&&n.channelMixer.masterChannel.fromJson(i.masterChannel),"patternColors"in i)for(q in i.patternColors)n.store.dispatch(Object(C.Gc)(parseInt(q),i.patternColors[q]));"scenes"in i&&n.scenes.fromJson(i.scenes),"effectsCollapsed"in i&&n.dispatch(Object(C.J)(i.effectsCollapsed)),"cableSegmentations"in i&&n.dispatch(Object(C.O)(i.cableSegmentations)),"effectStarred"in i&&n.dispatch(Object(C.K)(i.effectStarred)),I=[],_=wO(n.sends.sends),r.prev=94,_.s();case 96:if((D=_.n()).done){r.next=104;break}return F=D.value,r.next=100,!F.hookupPads();case 100:if(!r.sent){r.next=102;break}I.push(F);case 102:r.next=96;break;case 104:r.next=109;break;case 106:r.prev=106,r.t8=r.catch(94),_.e(r.t8);case 109:return r.prev=109,_.f(),r.finish(109);case 112:void 0!==t&&n.sends.deleteSends(I),L=(new Date).getTime(),n.checkSubPatchInstances(),B=(new Date).getTime(),console.log("check substance instances  took %s ms",B-L),"inletConnections"in i&&n.loadInletConnections(i.inletConnections),console.log("loaded inlet connections took %s ms",(new Date).getTime()-B),console.log("checking instance connections"),z=(new Date).getTime(),n.checkInstanceConnections(),J=(new Date).getTime(),console.log("checked instance took %s ms",J-z),"higherOrderSequencer"in i&&void 0===t&&n.higherOrderSequencer.fromJson(i.higherOrderSequencer),"nftZObject"in i&&(n.nftZObject=n.findNodeById(i.nftZObject)),n.updateTracks(),n.store.dispatch(Object(C.nc)(n.numberOfPatterns())),void 0!==n.update&&n.update(e),n.selectTrack(0),V=(new Date).getTime();for(H=v.length-1;H>=0;H--){n.switchToSubSequence(v[H].id,!0),n.currentSubSequence.loadBangZObjects(),n.currentSubSequence.loadNFTZObjects(),U=wO(n.tracks);try{for(U.s();!(G=U.n()).done;)G.value.midiEffects.setupMessageReader()}catch(pe){U.e(pe)}finally{U.f()}}for(Q in W=(new Date).getTime(),console.log("load bangs took %s ms",W-V),n.checkPads(),K=(new Date).getTime(),console.log("check pads took %s ms",K-W),n.setLoadingProgress(e,100),n.store.dispatch(Object(C.ac)(e,!1)),n.bulkConnections)Z=n.state.windows.inletConnections[Q]||{},n.dispatch(Object(C.Hb)(Q,Object(p.a)({},Z,n.bulkConnections[Q])));if("presentationWindowPositions"in i&&n.dispatch(Object(C.L)(i.presentationWindowPositions)),!("windowPositions"in i)){r.next=162;break}if(!Array.isArray(i.windowPositions)){r.next=161;break}Y={},X=n.getAllZObjects(),X.map(function(e){return e.id}),$=0;case 148:if(!($<i.windowPositions.length)){r.next=158;break}if(te=i.windowPositions[$],ne=i.windowPositions[$+1],X[$/2]){r.next=153;break}return r.abrupt("continue",155);case 153:re=X[$/2].id,null!==te&&null!==ne&&(Y[re]={x:te,y:ne});case 155:$+=2,r.next=148;break;case 158:n.dispatch(Object(C.M)(Y)),r.next=162;break;case 161:n.dispatch(Object(C.M)(i.windowPositions));case 162:i.pluginsLoaded&&(ae=i.pluginsLoaded.map(function(e){return n.findNodeById(e)}).filter(function(e){return e}),n.dispatch(Object(C.Pc)(ae))),ie=(new Date).getTime(),console.log("compiling and everything else took %s ms",ie-K),se=wO(n.subSequences);try{for(se.s();!(oe=se.n()).done;){ce=oe.value,ue=wO(ce.pads);try{for(ue.s();!(le=ue.n()).done;)le.value.sendSliderLevels()}catch(pe){ue.e(pe)}finally{ue.f()}}}catch(pe){se.e(pe)}finally{se.f()}n.dispatch(Object(C.W)(!0)),fe=(new Date).getTime(),console.log("FINAL SHIT TOOK %s ms",fe-ie),window.parent&&document.referrer&&(he=document.referrer,window.parent.postMessage("Finished Loading Project",he)),s(),window.logRedux=!1;case 173:case"end":return r.stop()}},r,null,[[94,106,109,112]])}));return function(e){return r.apply(this,arguments)}}());case 46:case"end":return r.stop()}},r,null,[[5,38]])}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"newNumberOfPatterns",value:function(e){for(var t=this.numberOfPatterns();t<e;t++)this.newPattern(!0)}},{key:"combineWithSequencerEngine",value:function(e){for(var t in e.subSequences){var n=e.subSequences[t];if(void 0!==this.getSubSequence(n.id)){var r=-1;for(var a in this.subSequences){var i=this.subSequences[a].id;i>r&&(r=i)}n.id=r+1,this.addSubSequence(n)}}}},{key:"loadParameterLocks",value:function(e){if("parameterLocks"in e){var t=e.parameterLocks;for(var n in this.parameterLocks=[],t){var r=new fy;r.fromJson(t[n],this),this.parameterLocks.push(r)}for(;this.parameterLocks.length<2;)this.parameterLocks.push(new fy)}}},{key:"loadSlices",value:function(e,t){var n=[];return"samplersParameters"in e&&(Array.isArray(e.samplersParameters[t])?n=e.samplersParameters[t]:n.push({startTime:e.samplersParameters[t].startTime,endTime:e.samplersParameters[t].endTime})),n}},{key:"newRecordingToSaveLater",value:function(e){this.recordingsToSave.push(e)}},{key:"getParameterFromJson",value:function(e){var t=e.context,n=new V.a,r=void 0,a=[];if(void 0!==t.track){var i=0;void 0!==t.chainNumber&&(i=t.effectsChainNumber),a=(r=this.tracks[t.track]).effectsChains[i].effects,n=n.forTrack(r)}else if(void 0!==t.group){var s=this.groups.groups[t.group];a=s.effects,n=n.forGroup(s)}else if(void 0!==t.sends){var o=this.sends.sends[t.sends];a=o.effects,n=n.forSend(o)}var c=void 0;if(t.isInstrument)c=r.instrument.parameters;else if(void 0!==t.effect&&-1!=t.effect){c=a[t.effect].parameters}else void 0!==r&&(c=r.trackData.parameters);if(void 0!==c){var u=e.name,l=c.filter(function(e){return e.name===u});if(l.length>=1)return l[0]}}},{key:"getEffectsPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o,c,u,l,f,h;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},i={},t.effectsChains&&(t.trackEffectsChains=t.effectsChains),!t.trackEffectsChains){e.next=26;break}s=[],e.t0=a.a.keys(t.trackEffectsChains);case 6:if((e.t1=e.t0()).done){e.next=25;break}o=e.t1.value,c=new z.a(n.gainNode,n.trackNode,(new V.a).forTrack(n),this),u=t.trackEffectsChains[o],c.initDefault(),e.t2=a.a.keys(u);case 12:if((e.t3=e.t2()).done){e.next=22;break}return l=e.t3.value,f=u[l],e.next=17,Object(J.a)(f,this.tracks,this,o);case 17:h=e.sent,i=Object(p.a)({},i,h.bulk),c.addEffect(h.effect),e.next=12;break;case 22:s.push(c),e.next=6;break;case 25:r.effectsChains=s;case 26:return t.midiEffects&&(r.midiEffects=new ya.a(n),i=Object(p.a)({},i,r.midiEffects.fromJson(t.midiEffects))),this.store.dispatch(Object(C.ub)(i)),e.abrupt("return",r);case 29:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadEffectsPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:this.tracks[this.store.getState().cursor.track],n&&this.loadLFOsAndEnvelopes(t),e.next=4,this.getEffectsPreset(t,r);case 4:(i=e.sent).effectsChains&&(r.effectsChains=i.effectsChains),i.midiEffects&&(r.midiEffects=i.midiEffects),t.liveEffects&&(r.liveEffects=new Iv.a(r),r.liveEffects.fromJson(t.liveEffects));case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"auditionPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o,c,u,l,f,d,v,m,y,b=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(b.length>2&&void 0!==b[2])||b[2],i=b.length>3&&void 0!==b[3]&&b[3],s=!(b.length>4&&void 0!==b[4])||b[4],o=b.length>5?b[5]:void 0,c=t.title,s){e.next=9;break}e.t0=t.data,e.next=12;break;case 9:return e.next=11,PO.getPresetData(t);case 11:e.t0=e.sent;case 12:if(u=e.t0,(l=this.tracks[n]).tracks&&u.trackParameters.type!==D.c?l=(l=this.state.tracks.selectedRackSubTrack[l.id]||l.tracks[0]).track:l.tracks&&Object(h.a)(l.tracks).forEach(function(e){return l.deleteInstrument(e)}),f={},r&&(f=this.loadLFOsAndEnvelopes(u,l)),l.preset=new at.a(t.title,t.contentHash,t.user,t.blockNumber),l.preset.track=l,l.preset.data=u,l.preset.tags=t.tags,l.presetName=c,l.preset.name=c,l.getAllParameters().forEach(function(e){return e.unmap()}),l.liveEffects.clearEffects(),d=l.volumeParameter.get(),l.getTrackType()!==D.f){e.next=29;break}return e.next=29,I(l,u.trackParameters,this.currentSubSequence);case 29:return e.t1=p.a,e.t2={},e.t3=f,e.next=34,l.fromJson(u.trackParameters,void 0,!1,!1,!0,!0,o);case 34:return e.t4=e.sent,f=(0,e.t1)(e.t2,e.t3,e.t4),l.setVolume(d),v=l.getAllParameters(),m=v.filter(function(e){return e.automations&&e.automations.length>0}),this.store.dispatch(Object(C.c)(m)),i&&l.effectsChains.forEach(function(e){return e.clear()}),l.midiEffects.clear(),l.midiEffects.effects.forEach(function(e){return e.dispose()}),l.midiEffects.effects=[],l.preset.hasEdits=!1,l.presetName=c,e.t5=p.a,e.t6={},e.t7=f,e.next=51,this.loadPresetEffects(l,u,!i);case 51:for(e.t8=e.sent,f=(0,e.t5)(e.t6,e.t7,e.t8),l.loadLostParameters(),l.setIsEnabled(l.isEnabled),y=2;y<l.sendNodeVolumeParameters.length;y++)this.sends.sends[y].pad!==l.pad&&l.sendNodeVolumeParameters[y].set(-90);this.store.dispatch(Object(C.ub)(f)),this.update(),l.updateSteps(),l.preset.loadMods=r,l.preset.loadEffects=i,this.addPresetToBrowsedPresets(l,l.preset),this.loadedProject=!0;case 63:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"addPresetToBrowsedPresets",value:function(e,t){var n=this.state.tracks.trackBrowsedPresets[e.id]||[];if(!n.some(function(e){return e.contentHash===t.contentHash})){var r=[t].concat(Object(h.a)(n.filter(function(e){return e.ipfsHash!==t.ipfsHash})));this.store.dispatch(Object(C.he)(e.id,r))}}},{key:"loadPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o,c,u,l,f;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.contentHash,i=t.title,void 0===r&&"string"===typeof t&&(r=t),e.next=5,PO.getPresetData(t);case 5:return s=e.sent,e.next=8,PO.getPresetInstrumentType(r);case 8:if(e.sent!==U.a){e.next=12;break}return this.loadEffectsPreset(s,n),e.abrupt("return");case 12:if(void 0!==s.tracks){e.next=17;break}return e.next=15,this.loadTrackPreset(s,r,n,void 0,i,void 0,t);case 15:return this.tracks[this.tracks.length-1].presetName=i,e.abrupt("return");case 17:for(c in o={},s.tracks)o[c]=this.tracks.length,this.loadTrackPreset(s.tracks[c],void 0,n);if(s.keyMappings)for(u in s.keyMappings)l=s.keyMappings[u],f=o[l.trackNumber],this.keyboardEngine.map(l.key,f,l.sliceNumber);case 20:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadLFOsAndEnvelopes",value:function(e,t){var n={};if("lfos"in e)for(var r in e.lfos){var a=e.lfos[r],i=t.lfosTrack||this.currentSubSequence.lfosTrack;n=Object(p.a)({},n,i.lfos[parseInt(r)].lfo.fromJson(a))}if("envelopes"in e)for(var s in e.envelopes){var o=e.envelopes[s],c=t.envelopesTrack||this.currentSubSequence.envelopesTrack;n=Object(p.a)({},n,c.envelopes[parseInt(s)].envelope.fromJson(o))}return n}},{key:"loadPresetAsSubSequence",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.contentHash,i=t.name,void 0===r&&"string"===typeof t&&(r=t),void 0!==n){e.next=7;break}return e.next=6,PO.getPresetData(t);case 6:n=e.sent;case 7:return e.next=9,this.loadTrackPreset(n,r,!1,!1,i,1,t);case 9:s=e.sent,this.newSubSequence(void 0,s),this.loadLFOsAndEnvelopes(n),s.trackNumber=0,s.updateSteps();case 14:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadTrackPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,s,o,c,u,l,f,h,p,d=this,v=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(v.length>3&&void 0!==v[3])||v[3],s=v.length>4?v[4]:void 0,o=v.length>5&&void 0!==v[5]?v[5]:this.numberOfPatterns(),c=v.length>6?v[6]:void 0,u=void 0,t.trackParameters.type!==D.d){e.next=13;break}return u=new Ir(this.tracks.length,this,this.mixSession,o,function(){return d.update()},this.currentSubSequence),e.next=9,_(u,t.trackParameters,this.currentSubSequence);case 9:u.setMidiEngine(this.midi),this.setupRecordableTrack(u),e.next=21;break;case 13:if(t.trackParameters.type!==D.b&&t.trackParameters.type!==D.c){e.next=18;break}l=t.trackParameters.instrumentType,u=xr(this,t.trackParameters.type,l,o),e.next=21;break;case 18:return u=new rt(this.tracks.length,this,this.mixSession,o,function(){return d.update()},this.sends),e.next=21,_(u,t.trackParameters,this.currentSubSequence);case 21:return u.setSends(this.sends),e.next=24,u.fromJson(t.trackParameters,void 0,void 0,void 0,!0);case 24:if(f=e.sent,this.dispatch(Object(C.ub)(f)),u.trackData.loadFromJson(t.trackData,void 0,!1,!1,this),this.loadPresetEffects(u,t),u.gated=t.trackParameters.gated,r&&this.loadLFOsAndEnvelopes(t,u),i){if(this.setupNewTrack(u,!0,!0),this.groups.addTrack(u),"sendVolumes"in t)for(h=u.getSendNodes(),p=0;p<t.sendVolumes.length;p++)h[p]&&(h[p].volume.value=t.sendVolumes[p]);this.currentSubSequence.addTrack(u),u.switchToPattern(this.currentPattern),u.updateSteps(),this.update()}return u.presetId=n,u.presetName=s,c&&(u.preset=new at.a(s,n,c.user,c.blockNumber),u.preset.load(),u.preset.track=u),this.currentSubSequence.addTrackToPadIfPossible(u),setTimeout(function(){u.loadLostParameters()},750),e.abrupt("return",u);case 37:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadPresetEffects",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o,c,u,l,f,h,d,v,m,y=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=y.length>2&&void 0!==y[2]&&y[2],i={},r){e.next=41;break}if(!n.trackEffects){e.next=17;break}s=[],o=0;case 6:if(!(o<n.trackEffects.length)){e.next=14;break}return e.next=9,Object(J.a)(n.trackEffects[o],this.tracks,this);case 9:c=e.sent,s.push(c.effect);case 11:o++,e.next=6;break;case 14:t.effectsChains[0].effects=s,e.next=41;break;case 17:if(!n.trackEffectsChains){e.next=41;break}u=[],e.t0=a.a.keys(n.trackEffectsChains);case 20:if((e.t1=e.t0()).done){e.next=39;break}l=e.t1.value,f=new z.a(t.gainNode,t.trackNode,(new V.a).forTrack(t),this),h=n.trackEffectsChains[l],e.t2=a.a.keys(h);case 25:if((e.t3=e.t2()).done){e.next=35;break}return d=e.t3.value,v=h[d],e.next=30,Object(J.a)(v,this.tracks,this,l);case 30:m=e.sent,i=Object(p.a)({},i,m.bulk),f.addEffect(m.effect),e.next=25;break;case 35:f.updateEffects(),u.push(f),e.next=20;break;case 39:t.effectsChains.forEach(function(e){return e.dispose()}),t.effectsChains=u;case 41:return n.midiEffects&&(i=Object(p.a)({},i,t.midiEffects.fromJson(n.midiEffects))),n.liveEffects&&t.liveEffects.fromJson(n.liveEffects),e.abrupt("return",i);case 44:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"saveProjectAsPreset",value:function(){var e=this,t=[];for(var n in this.tracks){var r=this.getTrackPreset(n);t.push(r)}var a=void 0;t.length>0&&(a=t[0].lfos);var i={lfos:a,tracks:t,keyMappings:this.keyboardEngine.keyMappings,midiMappings:this.keyboardEngine.midiMappings},s=window.prompt("Type name of preset");PO.newPreset(i,s).catch(function(e){console.log(e)}).then(function(t){e.presetId=t})}},{key:"saveZObjectPreset",value:function(e,t){var n=e.getInstrumentType(),r=e.getPresetJson();PO.newPreset(r,t,void 0,n,0)}},{key:"saveTrackPreset",value:function(e,t,n,r,s){var o=this;return new Promise(function(){var s=Object(i.a)(a.a.mark(function s(c,u){var l,f,h,p;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(l=o.tracks[e],0!=r){s.next=4;break}return s.next=4,l.makePublicIfNeeded();case 4:f=n?o.getEffectPreset(e):o.getTrackPreset(e),h=n?U.a:l.getInstrumentType(),l.tracks&&(h=D.c),p=void 0,void 0===l.sample||n||(p=l.sample.getId()),PO.newPreset(f,t,p,h,r).catch(function(e){console.log(e)}).then(function(){var e=Object(i.a)(a.a.mark(function e(n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l.presetId=n,console.log("preset id=",n),o.dispatch(Object(C.Sc)({contentHash:n,title:t,name:t,tags:[]})),!l.resampledFrom||!l.resampledFrom.contentHash){e.next=6;break}return e.next=6,Hn.a.xanadu.presetResampled(l.resampledFrom.contentHash,n);case 6:h===U.b&&void 0!==(r=l.midiEffects.effects.filter(function(e){return"Midi Interface"===e.name})[0])&&(i=r.midiOutput.name,PO.tagPreset(n,[i])),c(n);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return s.stop()}},s)}));return function(e,t){return s.apply(this,arguments)}}())}},{key:"updateTrackPreset",value:function(e){var t=this.getTrackPreset(e),n=this.tracks[e];PO.updatePresetIpfsHash(n.presetId,t)}},{key:"getEffectPreset",value:function(e){var t=this.tracks[e],n=t.effectsChains.map(function(e){return e.getJson()});return{lfo:this.lfos.map(function(e){return e.getJson()}),envelopes:this.envelopes.map(function(e){return e.getJson()}),trackEffectsChains:n,midiEffects:t.midiEffects.getJson(),liveEffects:t.liveEffects.getJson()}}},{key:"getTrackPreset",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.tracks[e],r=n.getSendNodes().map(function(e){return e.volume.value}),a=n.effectsChains.map(function(e){return e.getJson(t)}),i=n.lfosTrack||this.lfosTrack,s=n.envelopeTrack||this.envelopesTrack;return{lfos:i.lfos.map(function(e){return e.getJson(t)}),envelopes:s.envelopes.map(function(e){return e.getJson()}),trackData:n.trackData.getJson(),trackParameters:n.getJson(!0,t),sendVolumes:r,sendVolumees:r,trackEffectsChains:a,midiEffects:n.midiEffects.getJson(t),liveEffects:n.liveEffects.getJson(t)}}},{key:"loadOldMixFromJson",value:function(e){if(void 0!==e){var t={},n={};for(var r in e.deterministicMixesByType)1===parseInt(r)?n[r]=e.deterministicMixesByType[r]:t[r]=e.deterministicMixesByType[r];this.mix.loadFromJson(Object(p.a)({},e,{deterministicMixesByType:t})),this.currentSubSequence.mix.loadFromJson(Object(p.a)({},e,{deterministicMixesByType:n}))}}},{key:"getSamples",value:function(){var e=[];for(var t in this.subSequences){var n=this.subSequences[t];for(var r in n.tracks){var a=n.tracks[r];if(a.sample&&e.push(a.sample.getId()),a.frozenColumns){var i,s=wO(a.frozenColumns);try{for(s.s();!(i=s.n()).done;){var o,c=wO(i.value.frozenSamples);try{for(c.s();!(o=c.n()).done;){var u=o.value;e.push(u.getId())}}catch(l){c.e(l)}finally{c.f()}}}catch(l){s.e(l)}finally{s.f()}}}}return e}},{key:"addSampleToSync",value:function(e){this.samplesToSync.push(e)}},{key:"replaceWithEncryptedSample",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r in this.subSequences)for(s in(i=this.subSequences[r]).tracks){for(u in o=i.tracks[s],c={},o.samplers)u===t?c[n]=o.samplers[u]:c[u]=o.samplers[u];o.samplers=c,o.soundIds=Object.keys(o.samplers)}case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadSampleFromSequence",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o,c,u,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ar.a.getJson(n);case 2:for(o in r=e.sent,i=r.subSequences,s={},i)for(l in c=i[o],u=function(e){e=parseInt(e);var n=c.tracksData[e];if(t in n.samplers){(s=Object(p.a)({},c)).trackParameters=n,s.sendVolumes=c.sendVolumes[e],s.trackPatterns=c.tracksPatterns[e],s.trackEffectsChains=c.tracksEffectsChains[e],s.trackMidiEffects=c.tracksMidiEffects[e],s.trackLiveEffects=c.tracksLiveEffects[e],s.trackData=c.tracksParameters[e],s.mix=c.mix,s.tracks=c.tracks[e];var r=c.groups.find(function(t){return t.tracks.indexOf(e)>-1});r.tracks=[0],s.groups=[r]}l=e},c.tracksData)u(l);this.loadPresetAsSubSequence({},s);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"setLoadingProgress",value:function(e,t){this.store.dispatch(Object(C.yd)(e,t))}},{key:"loadPulledEffects",value:function(e){if(e){var t,n=[],r=wO(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;if("object"===typeof a){var i=a.id,s=a.type,o=a.instrumentId,c=a.x,u=a.y,l=a.width,f=a.height,h=M(o||i,s,this);h&&n.push(Object(p.a)({},a,h,{x:c,y:u,width:l,height:f}))}else{var d=A(a,this);d&&n.push(d)}}}catch(v){r.e(v)}finally{r.f()}this.dispatch(Object(C.Vc)(n))}}},{key:"trackIDExists",value:function(e,t){return this.subSequences.flatMap(function(e){return e.tracks}).some(function(n){return n.id===e&&n!==t})}},{key:"checkPads",value:function(){this.subSequences.forEach(function(e){return e.checkPads()})}},{key:"getAllZObjects",value:function(){var e,t=[],n=wO(this.subSequences);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=[].concat(Object(h.a)(t),Object(h.a)(Object(m.a)(r)))}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"generateProjectMetadata",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(k.a)(this,t);case 2:n=e.sent,console.log("generated",n);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveProjectMetadata",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r,i){var s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(O.a)(1e3);case 2:return e.next=4,Object(k.a)(this,t);case 4:(s=e.sent).samples=r,s.previousHash=n,s.title=i,Object(k.c)(s);case 9:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getSamplesForMint",value:function(){return j.d(this)}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=g(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"loadInletConnections",value:function(e){var t=this,n=(new Date).getTime(),r=function(n){var r=t.subSequences.find(function(e){return e.id===n});if(r)t.switchToSubSequence(r.id);else{var a,i=y(t.subSequences);try{for(i.s();!(a=i.n()).done;){var s=a.value;if(s.findNodeByName("subpatch").find(function(e){return e.effect.id===n})){r=s;break}}}catch(o){i.e(o)}finally{i.f()}}t.loadInletConnectionsForId(e[n])};for(var a in e)r(a);var i=(new Date).getTime();console.log("patchloader.loadInletConnections took %s ms",i-n)}},{key:"loadInletConnectionsForId",value:function(e,t){for(var n in(new Date).getTime(),e){var r,a=e[n],i=n.split("."),s=i[0],o=i[1],c=this.findNodeById(o),u=y(a);try{for(u.s();!(r=u.n()).done;){var l=r.value,f=void 0,h=void 0,p=void 0;Array.isArray(l)?(h=l[0],f=l[1],p=l[2]):(f=l.sourceType,h=l.sourceId,p=l.id);var d=this.findNodeById(h);if(c&&d){if(d.isSubPatch&&d.instances.length>0)continue;c.connectInlet(s,d,f,p,t)}}}catch(v){u.e(v)}finally{u.f()}}(new Date).getTime()}},{key:"findNodeById",value:function(e,t){return this.idToObject[e]?this.idToObject[e]:void 0}},{key:"_findNodeById",value:function(e,t){var n,r=y(this.currentSubSequence.pads);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.id===e)return a}}catch(P){r.e(P)}finally{r.f()}var i=this.tracks.find(function(t){return t.id===e});if(i)return i;var s=t?this.subSequences.reduce(function(e,t){return[].concat(Object(h.a)(e),Object(h.a)(Object(m.a)(t)))},[]).find(function(t){return t.id===e||t.effect&&t.effect.id===e}):this.subSequences.reduce(function(e,t){return[].concat(Object(h.a)(e),Object(h.a)(Object(m.a)(t)))},[]).find(function(t){return t.id===e});if(s)return s;for(var o=0,c=[].concat(Object(h.a)(this.subSequences),Object(h.a)(this.tracks));o<c.length;o++){var u=c[o];if(u.getAllEffects){var l=u.getAllEffects().find(function(t){return t.id===e});if(l)return l}if(u.effects){var f,p=y(u.effects);try{for(p.s();!(f=p.n()).done;){var d=f.value;if(d.id===e)return d;if(d.effects){var v,b=y(d.effects);try{for(b.s();!(v=b.n()).done;){var g=v.value;if(e===g.id)return g}}catch(P){b.e(P)}finally{b.f()}}}}catch(P){p.e(P)}finally{p.f()}}var O,k=y(u.midiEffects.effects);try{for(k.s();!(O=k.n()).done;){var j=O.value;if(j.id===e)return j;if(j.effects){var w,x=y(j.effects);try{for(x.s();!(w=x.n()).done;){var S=w.value;if(e===S.id)return S}}catch(P){x.e(P)}finally{x.f()}}}}catch(P){k.e(P)}finally{k.f()}}}},{key:"checkSubPatchInstances",value:function(e){var t,n=y(this.subSequences);try{for(n.s();!(t=n.n()).done;){var r,a=t.value,i=a.findNodeByName("subpatch",!0),s=a.findNodeByName("instancedSubpatch",!0),o=y(i);try{for(o.s();!(r=o.n()).done;){var c=r.value,u=(c=c.effect).instanceIds;if(u){e&&(u=u.map(function(t){return e[t]||t}));var l,f=y(u);try{var h=function(){var e=l.value,t=s.map(function(e){return e.effect}).find(function(t){return t.id===e});t&&!t.implements&&(c.instances.push(t),(new Date).getTime(),c.copyIntoInstance(t),(new Date).getTime(),t.implements=c)};for(f.s();!(l=f.n()).done;)h()}catch(p){f.e(p)}finally{f.f()}c.instanceIds=void 0}}}catch(p){o.e(p)}finally{o.f()}}}catch(p){n.e(p)}finally{n.f()}}},{key:"checkInstanceConnections",value:function(){var e,t=y(this.subSequences);try{for(t.s();!(e=t.n()).done;){var n,r=e.value,a=r.findNodeByName("subpatch",!0),i=(r.findNodeByName("instancedSubpatch",!0),y(a));try{for(i.s();!(n=i.n()).done;){var s,o=n.value,c=y((o=o.effect).instances);try{for(c.s();!(s=c.n()).done;){var u=s.value;o.copyConnectionsIntoInstance(u)}}catch(l){c.e(l)}finally{c.f()}}}catch(l){i.e(l)}finally{i.f()}}}catch(l){t.e(l)}finally{t.f()}}}]),n}(e)}(bO));function TO(e){var t=e.toString().indexOf("t");return t>0?new Tr.a(parseInt(e.slice(0,t)),!0):new Tr.a(parseInt(e),!1)}function AO(e){return!isNaN(parseFloat(e))&&isFinite(e)}var MO=function(e,t){var n={};for(var r in e){var a={};for(var i in e[r]){var s,o=[],c=wO(e[r][i]);try{for(c.s();!(s=c.n()).done;){var u=s.value,l=t.findNodeById(u.destId);if(t.findNodeById(u.sourceId)&&l){var f=[u.sourceId,u.sourceType];u.segmentation&&f.push(u.id),o.push(f)}}}catch(h){c.e(h)}finally{c.f()}o.length>0&&(a[i]=o)}Object.keys(a).length>0&&(n[r]=a)}return n},RO=function(e,t){var n=t.getAllZObjects().map(function(e){return e.id}),r=[];for(var a in e){var i=n.indexOf(a);i<-1||(e[a]?0===e[a].x&&0===e[a].y||(r[2*i]=e[a].x,r[2*i+1]=e[a].y):(r[2*i]=0,r[2*i+1]=0))}return r},CO=EO,NO=n(894),qO=n(409),IO=n(914),_O=new Tr.a(32,!1),DO=function(){function e(t){Object(s.a)(this,e),this.store=t,this.step=0,this.track=0,this.group=0,this.show=!1}return Object(o.a)(e,[{key:"step",get:function(){return this.store.getState().cursor.step},set:function(e){this.store.dispatch(Object(C.kb)(e)),this.updateRedux()}},{key:"track",get:function(){return this.store.getState().cursor.track},set:function(e){this.store.dispatch(Object(C.lb)(e))}},{key:"show",get:function(){return this.store.getState().cursor.show},set:function(e){this.store.dispatch(Object(C.jb)(e))}},{key:"getJson",value:function(){return{step:this.step,track:this.track}}},{key:"getStep",value:function(e){return void 0===e?this.step:e.transformStepAtResolution2(this.step,_O)}},{key:"setStep",value:function(e,t){this.step=_O.transformStepAtResolution2(e,t)}},{key:"resolution",get:function(){return this.store.getState().sequencer.resolution}},{key:"updateRedux",value:function(){this.store.dispatch(Object(C.ud)(this.track)),this.store.dispatch(Object(C.td)(this.getStep(this.resolution))),this.store.dispatch(Object(C.Ic)(this.getStep(this.resolution)))}}]),e}(),FO=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(s.a)(this,e),this.module=null,this.orientation=r,this.size=n,this.y=t}return Object(o.a)(e,[{key:"getJson",value:function(){return{module:this.module&&this.module.id,orientation:this.orientation,size:this.size,y:this.y,x:this.x}}},{key:"fromJson",value:function(e,t){this.x=e.x,this.y=e.y,this.orientation=e.orientation,this.size=e.size,this.module=e.module&&t.subSequences.find(function(t){return t.id===e.module})}}]),e}();n(39);function LO(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return BO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return BO(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function BO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function zO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var JO=n(590);function VO(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return HO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return HO(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function HO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function UO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var GO=n(48),WO=n(27);function KO(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return QO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return QO(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function QO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ZO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var YO=function(e,t,n,r){var a=n?n.get():100,i=Math.max(.001,(10-e)/10);return t.min+(t.max-t.min)*i*r*(a/100)};function XO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function $O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function ek(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function tk(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return nk(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nk(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function nk(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ak=1,ik=2;function sk(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ok(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ok(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ok(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ck(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var uk=n(568);function lk(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return fk(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fk(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function fk(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function hk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function pk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function dk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var vk=function(e){Object(u.a)(n,e);var t=dk(n);function n(e){var r;Object(s.a)(this,n),(r=t.call(this)).sequencerEngine=e,r.matrix=new Array(16).fill([]),r.steps=[];for(var a=0;a<16;a++)r.matrix[a]=new Array(10).fill(0);return r.initScripting(),r.initDisabledParameters(),r.initAutomation(),r}return Object(o.a)(n,[{key:"stop",value:function(){this.wasRolling=!1,this.currentAlgorithms={}}}]),n}(Object(Ye.a)(function(e){return function(e){Object(u.a)(n,e);var t=rk(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"processGraphics",value:function(e,t){var n,r=Math.floor(e/2)%16,a=tk(t);try{for(a.s();!(n=a.n()).done;){var i=n.value,s=i.type,o=i.arg,c=r,u=o&&o[0]&&Object(jn.a)(o[0],10),l=o&&o[1],f=o&&o[2];switch(s){case"DRAW":this.newStep(c,u,l,f);break;case"ERASE":var h=this.matrix[c].filter(function(e){return e});if(void 0!==u){var p=this.matrix[c][u];p&&(h=[p])}e&&this.deleteSteps(h)}}}catch(d){a.e(d)}finally{a.f()}this.updateRedux()}}]),n}(e)},vf.a,function(e){return function(e){Object(u.a)(n,e);var t=ck(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).currentAlgorithms={},e.algorithmTypes={0:[ak],1:[ik]},e}return Object(o.a)(n,[{key:"onNewStep",value:function(e,t){var n=this;e%32===0&&this.scheduleAutomations(e,t),this.updateAutomationRedux(e);var r={},a=new Set;for(var i in this.currentAlgorithms){var s=this.currentAlgorithms[i];a.has(s)||(s.duration--,s.elapsed++,a.add(s)),s.duration>0&&(r[i]=s)}var o=this.matrix[e/2%16];if(o){var c,u=sk(o);try{var l=function(){var t=c.value;if(!t)return"continue";var a={types:n.getAlgorithmTypes(t),y:t.y,x:t.x,orientation:t.orientation,elapsed:0,stepNumber:e,module:t.module,duration:2*t.size};a.types.forEach(function(e){return r[e]=a})};for(u.s();!(c=u.n()).done;)l()}catch(f){u.e(f)}finally{u.f()}this.currentAlgorithms=r}else this.currentAlgorithms=r;this.checkOrientations(this.currentAlgorithms)}},{key:"checkOrientations",value:function(e){this._getOutputForModule={}}},{key:"getAlgorithmTypes",value:function(e){return this.algorithmTypes[e.orientation]||[]}},{key:"isEmpty",get:function(){return 0===this.steps.length}},{key:"shouldPlayModule",value:function(e){if(this.isEmpty||this.isFreeform(e))return!0;var t=this.currentAlgorithms[ak]||this.currentAlgorithms[ik];return t&&this.isModuleRouted(e,t.orientation)}},{key:"isRolling",value:function(){var e=this.currentAlgorithms[3];return this.wasRolling=void 0!==e,{isRolling:void 0!==e,isNewRoll:e&&0===e.elapsed,modules:e&&this.getModulesRoutedIn(e.orientation)}}},{key:"getStepForModule",value:function(e,t){if(this.isEmpty||this.isFreeform(t))return e;var n=this.currentAlgorithms[ik];return n&&this.isModuleRouted(t,n.orientation)?e-n.stepNumber:e}},{key:"getSpeedForModule",value:function(e){if(this.isEmpty||this.isFreeform(e))return 1;var t=this.currentAlgorithms[4];if(t&&this.isModuleRouted(e,t.orientation)){var n=t.y;return n<4?2:4===n?1:.5}return 1}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=ek(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getSelection",value:function(e){var t=e.x1,n=e.y1,r=e.x2,a=e.y2;return this.steps.filter(function(e){var i=e.x,s=e.y;return t<=i&&i<=r&&n<=s&&s<=a})}},{key:"setStepSize",value:function(e,t,n){this.matrix[e][t]&&(this.matrix[e][t].size=n,this.updateRedux())}},{key:"moveStepTo",value:function(e,t,n,r){if(this.matrix[e]){var a=this.matrix[e][t];a&&(n=Object(jn.a)(n,this.matrix.length-a.size+1),r=Object(jn.a)(r,this.matrix[0].length-a.size+1),this.matrix[e][t]=0,this.matrix[n][r]&&this.deleteSteps([this.matrix[n][r]]),this.matrix[n][r]=a,a.x=n,a.y=r,this.updateRedux())}}},{key:"noIntersect",value:function(e,t){return!0}},{key:"newStep",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.matrix=Object(h.a)(this.matrix),this.matrix[e][t]&&this.deleteSteps([this.matrix[e][t]]);var a=new FO;return this.matrix[e][t]=a,a.x=e,a.y=t,a.size=n,a.orientation=r,this.steps.push(a),a}},{key:"toggle",value:function(e,t){this.matrix=Object(h.a)(this.matrix),this.matrix[e][t]?this.matrix[e][t].orientation=0===this.matrix[e][t].orientation?1:0:this.noIntersect(e,t)&&(this.matrix[e][t]=new FO,this.matrix[e][t].x=e,this.matrix[e][t].y=t,this.steps.push(this.matrix[e][t])),this.updateRedux(e)}},{key:"deleteSteps",value:function(e){for(var t=0;t<this.matrix.length;t++)for(var n=0;n<this.matrix[t].length;n++)e.includes(this.matrix[t][n])&&(this.matrix[t][n]=0);this.steps=this.steps.filter(function(t){return!e.includes(t)}),this.updateRedux()}},{key:"updateRedux",value:function(e){this.computeShapes(),void 0!==e&&(this.matrix[e]=Object(h.a)(this.matrix[e])),this.sequencerEngine.dispatch(Object(C.Gb)(Object(h.a)(this.matrix)))}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=UO(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getParamsJson",value:function(){return{parameters:this._parameters.map(function(e){return{id:e.id,context:e.context&&e.context.getJson(),name:e.name,coordinates:e.getCoordinates()}}),depthParameters:this.depthParameters.map(function(e){return e.getJson()})}}},{key:"fromParamsJson",value:function(e,t){return delete e.depth,this.parametersJson=e.parameters,this.lostParameters=this.loadParameters(e.parameters,!0).lostParameters,this.loadDepthJson(e,t),{}}},{key:"loadParameters",value:function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a={},i=this.sequencerEngine,s=[],o=VO(e);try{var c=function(){var e=t.value,o="object"===typeof e?e.id:e,c=void 0;"BPM"===e.name&&(c=i.bpmParameter);var u=i.higherOrderSequencer;if(!c&&u&&(c=u.macros.map(function(e){return e.macroParameter}).find(function(e){return o===e.id})),!c){var l,f=VO(i.subSequences);try{for(f.s();!(l=f.n()).done;){var p,d=VO(l.value.tracks);try{for(d.s();!(p=d.n()).done;){var v=p.value.getAllParameters().find(function(e){return o===e.id});if(v){c=v;break}}}catch(C){d.e(C)}finally{d.f()}}}catch(C){f.e(C)}finally{f.f()}}if(!c){var m,y=VO(i.subSequences);try{for(y.s();!(m=y.n()).done;){var b,g=VO(m.value.lfos);try{for(g.s();!(b=g.n()).done;){var O=b.value,k=(O=O.lfo).parameters.find(function(e){return o===e.id});if(k){c=k;break}}}catch(C){g.e(C)}finally{g.f()}}}catch(C){y.e(C)}finally{y.f()}}if(!c){var j,w=VO(i.subSequences);try{for(w.s();!(j=w.n()).done;){var x=j.value,S=[].concat(Object(h.a)(x.midiEffects.effects),[x.playhead]);if(c=[].concat(Object(h.a)(S.flatMap(function(e){return e.getParameters()})),Object(h.a)(x.pads.filter(function(e){return e.fxMacro}).map(function(e){return e.fxMacro.macroParameter})),Object(h.a)(x.pads.filter(function(e){return e.effectRack}).map(function(e){return e.effectRack.getParameters()}))).find(function(e){return o===e.id}))break}}catch(C){w.e(C)}finally{w.f()}}if(c||(c=i.sends.sends.flatMap(function(e){return e.effects}).flatMap(function(e){return e.getParameters()}).find(function(e){return o===e.id})),!c){var P,E=VO(i.subSequences);try{for(E.s();!(P=E.n()).done;){var T,A=VO(P.value.envelopes);try{for(A.s();!(T=A.n()).done;){var M=T.value.parameters.find(function(e){return o===e.id});if(M){c=M;break}}}catch(C){A.e(C)}finally{A.f()}}}catch(C){E.e(C)}finally{E.f()}}if(!c&&!r&&"object"===typeof e&&(c=Object(JO.a)(e,n.track,i))){a[o]=c;var R=e.coordinates;R.x,R.y}c?n.setParameter(c):s.push(e)};for(o.s();!(t=o.n()).done;)c()}catch(u){o.e(u)}finally{o.f()}return this.sortParameters(),{lostParameters:s,newMappings:a}}},{key:"sortParameters",value:function(){var e=this;if(this.parametersJson){var t=this.parametersJson.map(function(t,n){var r=t.id;return e._parameters.find(function(e){return e&&e.id===r})}).filter(function(e){return e});this._parameters=t}}},{key:"loadDepthJson",value:function(e,t){if(e.depthParameters){var n,r=0,a=VO(e.depthParameters);try{for(a.s();!(n=a.n()).done;){var i=n.value,s=this.newDepthParameter();s.fromJson(i,this.sequencerEngine,t),this.depthParameters[r++]=s}}catch(o){a.e(o)}finally{a.f()}}}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=$O(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getJson",value:function(){return Object(p.a)({},this.getParamsJson(),{macros:this.macros.map(function(e){return e.getJson()}),algorithmTypes:this.algorithmTypes,scriptEffect:this.scriptEffect.getJson(),inputModules:this.inputModules.map(function(e){return e.id}),freeformModules:this.freeformModules.map(function(e){return e.id}),routings:this.getRoutingJson(),matrix:this.matrix.map(function(e){return e.map(function(e){return e&&e.getJson()})})})}},{key:"fromJson",value:function(e){var t=this,n=e.macros,r=e.routings,a=e.matrix,i=e.algorithmTypes,s=e.scriptEffect,o=e.inputModules,c=(e.outputModules,e.freeformModules);this.algorithmTypes=i,n&&this.loadMacrosJson(n),e.parameters&&this.fromParamsJson(e),s&&this.scriptEffect.fromJson(s),o&&(this.inputModules=o.map(function(e){return t.getModule(e)})),c&&(this.freeformModules=c.map(function(e){return t.getModule(e)})),r&&this.fromRoutingJson(r);for(var u=0;u<a.length;u++)for(var l=a[u],f=0;f<l.length;f++)l[f]&&(this.matrix[u][f]=new FO,this.matrix[u][f].fromJson(l[f],this.sequencerEngine),this.steps.push(this.matrix[u][f]));this.updateRedux()}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=pk(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).routings={0:{},1:{}},e.freeformModules=[],e._getOutputForModule={},e._getModulesRouted={},e._getModulesRoutedIn={},e._isModuleRouted={},e._getModule={},e._outputModules=void 0,e}return Object(o.a)(n,[{key:"outputModules",get:function(){if(this._outputModules)return this._outputModules;var e=this.routings[0],t=this.routings[1];return this._outputModules=Array.from(new Set([].concat(Object(h.a)(Object.values(e).flatMap(function(e){return e})),Object(h.a)(Object.values(t).flatMap(function(e){return e}))))),this._outputModules}},{key:"getOutputForModule",value:function(e){var t=e?e.id:"none";if(this._getOutputForModule[t])return this._getOutputForModule[t];if(this.isEmpty||this.isFreeform(e))return this._getOutputForModule[t]=[e],[e];var n=Object.values(this.currentAlgorithms)[0].orientation;return this._getOutputForModule[t]=this.routings[n][e.id]||[],this._getOutputForModule[t]}},{key:"getModulesRoutedIn",value:function(e){var t=this;return this._getModulesRoutedIn[e]?this._getModulesRoutedIn[e]:(this._getModulesRoutedIn[e]=Object.keys(this.routings[e]).map(function(e){return t.getModule(e)}),this._getModulesRoutedIn[e])}},{key:"getModulesRouted",value:function(e){return this._getModulesRouted[e]?this._getModulesRouted[e]:(this._getModulesRouted[e]=Object.values(this.routings[e]).flatMap(function(e){return e}),this._getModulesRouted[e])}},{key:"isModuleRouted",value:function(e,t){var n=e?e.id+"."+t:t;if(this._isModuleRouted[n])return this._isModuleRouted[n];if(!e)return this._isModuleRouted[n]=!0,!0;var r=Object.keys(this.routings[t]).includes(e.id);return this._isModuleRouted[n]=r,r}},{key:"modules",get:function(){return this.sequencerEngine.subSequences}},{key:"getModule",value:function(e){return this._getModule[e]?this._getModule[e]:(this._getModule[e]=this.modules.find(function(t){return t.id===e}),this._getModule[e])}},{key:"connectModules",value:function(e,t,n){var r=this.routings[e];if(t){var a=r[t.id]||[];a.push(n),r[t.id]=a,this.updateRoutableRedux()}}},{key:"disconnectModules",value:function(e,t,n){var r=this.routings[e],a=r[t.id]||[];a=a.filter(function(e){return e!==n}),r[t.id]=a,this.updateRoutableRedux()}},{key:"isFreeform",value:function(e){return this.freeformModules.includes(e)}},{key:"connectToFreeform",value:function(e){this.freeformModules.push(e),this.updateRoutableRedux()}},{key:"disconnectFromFreeform",value:function(e){this.freeformModules=this.freeformModules.filter(function(t){return t!==e}),this.updateRoutableRedux()}},{key:"clearRoutingCache",value:function(){this._getOutputForModule={},this._getModulesRouted={},this._isModuleRouted={},this._outputModules=void 0,this._getModulesRoutedIn={}}},{key:"updateRoutableRedux",value:function(){this.clearRoutingCache(),this.dispatch(Object(C.qc)(Object(p.a)({},this.routings)))}},{key:"getRoutingJson",value:function(){var e={};for(var t in this.routings){var n={};for(var r in this.routings[t])n[r]=this.routings[t][r].map(function(e){return e.id});e[t]=n}return e}},{key:"fromRoutingJson",value:function(e){var t=this,n=function(n){n=parseInt(n);var a=function(r){var a=t.getModule(r);e[n][r].forEach(function(e){return t.connectModules(n,a,t.getModule(e))})};for(var i in e[n])a(i);r=n};for(var r in e)n(r)}}]),n}(e)},va,function(e){return function(e){Object(u.a)(n,e);var t=XO(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).automationPaths=[],e}return Object(o.a)(n,[{key:"computeShapes",value:function(){for(var e=this,t=Object(h.a)(this.steps).sort(function(e,t){return e.x===t.x?t.y-e.y:e.x-t.x}),n=Object(h.a)(t),r=[],a=function(){for(var t=n.shift(),a=[t],i=e.findAdjoiningSteps(t);i;)n=n.filter(function(e){return e!==i}),a.push(i),i=e.findAdjoiningSteps(i);r.push(a)};n.length>0;)a();for(var i=[],s=0,o=r;s<o.length;s++){for(var c=o[s],u=[{x:c[0].x,y:c[0].y}],l=0;l<c.length;l++){var f=c[l],p=f.x+f.size,d=f.y+f.size,v=c[l+1];v?p===v.x&&d===v.y?f.orientation===v.orientation||0===f.orientation&&1===v.orientation?u=[].concat(Object(h.a)(u),[{x:p,y:d}]):1===f.orientation&&0===v.orientation&&(u=[].concat(Object(h.a)(u),[{x:p,y:f.y},{x:p,y:d}])):u=p===v.x&&d===v.y+v.size?[].concat(Object(h.a)(u),[{x:p,y:d},{x:v.x,y:v.y}]):[].concat(Object(h.a)(u),[{x:p,y:d},{x:p,y:10},{x:v.x,y:10},{x:v.x,y:v.y}]):u=[].concat(Object(h.a)(u),[{x:p,y:d}])}i.push(u)}this.automationPaths=i}},{key:"findAdjoiningSteps",value:function(e){var t=e.x,n=e.y,r=e.size,a=t+r,i=n+r;if(this.matrix[a])for(var s=a;s<16;s++){if(this.matrix[s][i])return this.matrix[s][i];for(var o=i;o<10;o++)if(this.matrix[s][o])return this.matrix[s][o];for(var c=i;c>0;c--)if(this.matrix[s][c])return this.matrix[s][c]}}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=ZO(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).currentAutomations=[],e.depthParameters=[],e._automations={},e._parameters=[],e.initialParameterValues=[],e.initialParameterDepths=[],e}return Object(o.a)(n,[{key:"initAutomation",value:function(){this.automationDepthParameter=new re.a("automationDepth",this,function(){return[]},{defaultValue:1,min:0,max:0}),this.registerParameter()}},{key:"newDepthParameter",value:function(e){var t=new re.a("depth",this,function(e,t){return t},{units:"%",min:0,max:100,defaultValue:100});return this.context&&t.setContext(this.context),t.setStore(this.sequencerEngine.store),this.registerParameter(t),t}},{key:"setParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._parameters.length;this._parameters[t]=e,this.initialParameterValues[t]=e.get(!0),e.higherOrdered=this,this.depthParameters[t]||(this.depthParameters[t]=this.newDepthParameter(e))}},{key:"unmapParameter",value:function(e){this._parameters[e].higherOrdered=!1;var t=this._parameters[e];this._parameters.splice(e,1),t.context.macro&&(this.macros=this.macros.filter(function(e){return e!==t.context.macro}),t.context.macro.dispose(),t.updateRedux())}},{key:"getDepth",value:function(e){return 1}},{key:"setEffectParameterValues",value:function(e){this.dispatch(Object(C.ub)(e))}},{key:"scheduleAutomations",value:function(e,t){var n=this,r=this.automationPaths.length;this.currentAutomations=[],0!==r&&this._parameters.filter(function(e,t){return!n.parametersDisabled.includes(t)}).forEach(function(a,i){return n.automateWithPath(e,t,a,n.automationPaths[i%r])})}},{key:"automateWithPath",value:function(e,t,n,r){var a=this;if(this._automations[n.id]){var i=this._automations[n.id];i.clearCache(),i.automations=[]}var s=this._parameters.indexOf(n);if(!this.depthParameters[s]||0!==this.depthParameters[s].get()){var o=this._automations[n.id]||new WO.a(n,!1,this.sequencerEngine);this._automations[n.id]=o;var c,u=void 0,l=KO(r);try{var f=function(){var e=c.value,t=e.x,r=e.y,i=u===2*t?2*t+.1:2*t;0===i&&(i=.1),o.automations.push(new GO.a(i,function(){return YO(r,n,a.depthParameters[s],a.automationDepthParameter.get())})),u=i};for(l.s();!(c=l.n()).done;)f()}catch(h){l.e(h)}finally{l.f()}o.start(t,!0,1e-4),o.schedule(e,t,t,0),this.currentAutomations.push(o)}}},{key:"updateAutomationRedux",value:function(e){if(e%2===0){e%=32;var t,n={},r=KO(this.currentAutomations);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=a.parameter;i.onNewStep(e),n[i.id]=a.getValueAtStep(e)}}catch(s){r.e(s)}finally{r.f()}Object.keys(n).length>0&&this.setEffectParameterValues(n)}}}]),n}(e)},pf.a,function(e){return function(e){Object(u.a)(n,e);var t=hk(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).inputModules=[],e}return Object(o.a)(n,[{key:"initScripting",value:function(){this.scriptEffect=new uk.a(this),this.scriptEffect._subSequence=this,this.trackData=new F.a}},{key:"input",value:function(e){this.scriptEffect.onNewStep();var t,n=lk(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=r.stepData.track,i=this.scriptEffect.copyTrigger(r,!0);i.stepData.track=a,this.scriptEffect.input(i)}}catch(s){n.e(s)}finally{n.f()}}},{key:"output",value:function(e,t){var n=this.scriptEffect.output(e,t,t);if(0!==n.length){var r=n.filter(function(e){return e.graphics}).map(function(e){return e.graphics});this.processGraphics(t,r)}}},{key:"toggleInput",value:function(e){var t=this.inputModules;t.includes(e)?this.inputModules=t.filter(function(t){return t!==e}):this.inputModules=[].concat(Object(h.a)(t),[e]),this.updateScriptingRedux()}},{key:"toggleOutput",value:function(e){var t=this.outputModules;t.includes(e)?this.outputModules=t.filter(function(t){return t!==e}):this.outputModules=[].concat(Object(h.a)(t),[e]),this.updateScriptingRedux()}},{key:"updateScriptingRedux",value:function(){this.sequencerEngine.dispatch(Object(C.kc)(this.inputModules,this.outputModules))}}]),n}(e)},function(e){return function(e){Object(u.a)(n,e);var t=zO(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).macros=[],e}return Object(o.a)(n,[{key:"createMacro",value:function(e){var t,n=[],r=1e7,a=void 0,i=LO(e);try{for(i.s();!(t=i.n()).done;){var s=t.value,o=(s.get(!0)-s.min)/(s.max-s.min);o<r&&(r=o,a=s),n[s.id]=o}}catch(p){i.e(p)}finally{i.f()}var c,u=Math.max(1e-5,r),l=new lv.a("macro +"+e.length,this.sequencerEngine,this.context,!1,u),f=LO(e);try{for(f.s();!(c=f.n()).done;){var h=c.value;h===a?l.addParameter(h):function(){var e=(h.get(!0)+h.min*(u-1))/u,t=h.name.toLowerCase();["level","gain","volume"].some(function(e){return t.includes(e)})&&(e=h.max),l.addParameter(h,h.min,e)}()}}catch(p){f.e(p)}finally{f.f()}return this.macros.push(l),this.setParameter(l.macroParameter),l}},{key:"loadMacrosJson",value:function(e){var t,n=[],r=LO(this.modules);try{for(r.s();!(t=r.n()).done;){var a=t.value;n=[].concat(Object(h.a)(n),Object(h.a)(a.getAllParameters()));var i,s=LO(a.lfos);try{for(s.s();!(i=s.n()).done;){var o=i.value;n=[].concat(Object(h.a)(n),Object(h.a)(o.lfo.parameters))}}catch(g){s.e(g)}finally{s.f()}var c,u=LO(a.envelopes);try{for(u.s();!(c=u.n()).done;){var l=c.value;n=[].concat(Object(h.a)(n),Object(h.a)(l.parameters))}}catch(g){u.e(g)}finally{u.f()}var f,p=LO(a.tracks);try{for(p.s();!(f=p.n()).done;){var d=f.value;n=[].concat(Object(h.a)(n),Object(h.a)(d.getAllParameters()))}}catch(g){p.e(g)}finally{p.f()}}}catch(g){r.e(g)}finally{r.f()}var v,m=LO(e);try{for(m.s();!(v=m.n()).done;){var y=v.value,b=new lv.a(y.name,this.sequencerEngine,this.context,!1);b.fromJson(y,n),this.macros.push(b)}}catch(g){m.e(g)}finally{m.f()}}}]),n}(e)})(function(){return function e(){Object(s.a)(this,e)}}()));function mk(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return yk(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yk(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function yk(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function gk(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ok(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ok(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Ok(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function kk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var jk=new Tr.a(32,!1),wk=function(e){Object(u.a)(n,e);var t=kk(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];arguments.length>5&&arguments[5];return Object(s.a)(this,n),r=t.call(this,e,i,o,a,u),u||(r.searcher=new qO.a(new IO.a(e),Object(c.a)(r)),r.searcher.cache.loadIndex()),r.cursor=new DO(e),r.stereoOnly=a,r}return Object(o.a)(n,[{key:"setScripting",value:function(e){this.scripting=e}},{key:"clearSequence",value:function(){this.tracks.map(function(e){return e.pattern.clear()}),this.updateTracks()}},{key:"getSelectedStep",value:function(){return this.cursor.getStep(this.resolution)}},{key:"getSelectedStepData",value:function(){return this.getSelectedTrack().getStepAtResolution(this.cursor.step,jk)}},{key:"getSelectedMidiTrack",value:function(){return this.tracks[this.state.tracks.selectedMidiTrack]}},{key:"getSelectedTrack",value:function(){return void 0===this.cursor.track?0:this.tracks?this.tracks[this.cursor.track]:void 0}},{key:"selectMidiTrack",value:function(e){this.store.dispatch(Object(C.od)(e))}},{key:"selectEffect",value:function(e){if(!e||e.name){this.selectedEffect=e,this.dispatch(Object(C.kd)(e?e.id:void 0));var t=this.state.selector.quickAddSearchText;t&&""!==t||this.dispatch(Object(C.wd)(e))}}},{key:"selectTrack",value:function(e){this.cursor.track=e;var t=this.state.selector.quickAddSearchText;t&&""!==t||this.dispatch(Object(C.wd)(this.tracks[e])),this.state.mix.selectedTrack!==this.cursor.track&&(this.store.dispatch(Object(C.ud)(e)),this.store.dispatch(Object(C.a)())),this.store.dispatch(Object(C.od)(e)),this.tracks[e]&&this.tracks[e].updateSteps(),this.tracks[e]&&(this.cursor.step=this.cursor.step%this.tracks[e].pattern.length()),this.store.dispatch(Object(C.td)(this.cursor.getStep(this.resolution))),this.store.dispatch(Object(C.md)(void 0));var n,r=gk(this.currentSubSequence.pads);try{for(r.s();!(n=r.n()).done;){n.value.sendMessage("selected track",e)}}catch(a){r.e(a)}finally{r.f()}}},{key:"select",value:function(e,t,n){void 0!==this.tracks[e]&&(n&&n.subSequence!==this.currentSubSequence&&this.switchToSubSequence(n.subSequence.id),this.tracks[e].stepSelected(t),this.cursor.setStep(t,this.resolution),this.cursor.track=e,this.store.dispatch(Object(C.ud)(e)),this.store.dispatch(Object(C.td)(t)))}},{key:"selectGroupStep",value:function(e,t){this.cursor.setStep(t,this.resolution),this.cursor.group=e,this.store.dispatch(Object(C.td)(t))}},{key:"isSelectedTrackPad",value:function(){var e=this.getSelectedTrack();return e&&void 0!==e.pad}},{key:"left",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;if(0!=this.tracks.length){var n=this.cursor.getStep(this.resolution);if(--n<0){t||this.up(e);var r=this.getTrackLength();return this.cursor.setStep(r-1,this.resolution),void(e&&(this.store.dispatch(Object(C.ud)(this.cursor.track)),this.store.dispatch(Object(C.td)(r-1))))}this.cursor.setStep(n,this.resolution),this.tracks[this.cursor.track].stepSelected(this.cursor.step),e&&this.cursor.updateRedux()}}},{key:"getTrackLength",value:function(){return this.getSelectedTrack().getStepsAtResolution(this.resolution).length}},{key:"right",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;if(0!=this.tracks.length){var n=this.tracks[this.cursor.track].getStepsAtResolution(this.resolution).length,r=this.cursor.getStep(this.resolution);if(++r>=n)return this.cursor.step=0,t||this.down(e),void(e&&this.cursor.updateRedux());this.cursor.setStep(r,this.resolution),this.tracks[this.cursor.track].stepSelected(this.cursor.step),this.store.getState().mix.selectedTrack!==this.cursor.track&&e&&this.store.dispatch(Object(C.ud)(this.cursor.track)),e&&this.store.dispatch(Object(C.td)(r))}}},{key:"setSelectedTrack",value:function(e){this.store.dispatch(Object(C.ud)(e))}},{key:"up",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!=this.tracks.length){if(0==this.cursor.track)return this.cursor.track=this.tracks.length-1,void(this.store.getState().mix.selectedTrack!==this.cursor.track&&this.selectTrack(this.cursor.track));this.cursor.track--,this.store.getState().mix.selectedTrack!==this.cursor.track&&this.selectTrack(this.cursor.track),this.tracks[this.cursor.track].stepSelected(this.cursor.step)}}},{key:"down",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!=this.tracks.length){if(this.cursor.track==this.tracks.length-1)return this.cursor.track=0,void this.selectTrack(this.cursor.track);this.cursor.track++,this.store.getState().mix.selectedTrack!==this.cursor.track&&this.selectTrack(this.cursor.track),this.tracks[this.cursor.track].stepSelected(this.cursor.step)}}},{key:"getSample",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r){var i,s,o,c,u;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Hn.a.getGuildsWithAccess();case 2:return i=n.sent,n.next=5,Object(NO.a)(e,i);case 5:return s=n.sent,0,o=s[0],c=new q.a(o),n.next=11,c.load();case 11:u=new Te.a(c,t),console.log("get sample tags=",e),u.sounds=s,u.initBuffers(),r({sample:c,samplesStream:u});case 16:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}())}},{key:"searchForSounds",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o,c,u,l,f,h,p,d,v,m,y,b,g,O=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=O.length>2&&void 0!==O[2]?O[2]:this.getSelectedTrack(),i=!(O.length>3&&void 0!==O[3])||O[3],s=!(O.length>4&&void 0!==O[4])||O[4],o=O.length>5?O[5]:void 0,c=!(O.length>6&&void 0!==O[6])||O[6],u=O.length>7&&void 0!==O[7]&&O[7],l=O.length>8?O[8]:void 0,r||!n){e.next=9;break}return e.abrupt("return");case 9:return(new Date).getTime(),e.next=12,Hn.a.getGuildsWithAccess();case 12:return f=e.sent,e.next=15,Object(NO.a)(t,f,o,u,l);case 15:if(h=e.sent,p=(new Date).getTime(),!(h.length>0)){e.next=50;break}if(d=h[0],!n){e.next=36;break}if(v=i?new q.a(d):r.sample,(m=c?new Te.a(v,this):r.samplesStream).tags=t,m.sounds=h.slice(1),m.filterFavorites=o,i){e.next=30;break}c&&r.newSampleStream(m),r.updateSteps(),e.next=34;break;case 30:return e.next=32,v.load();case 32:m.initBuffers(),r.auditionSound(v,!1,m);case 34:e.next=50;break;case 36:return y=new q.a(d),e.next=39,y.load();case 39:return e.next=41,this.addSound(y,void 0,void 0,void 0,void 0,void 0,s);case 41:return b=(new Date).getTime(),b-p,(g=this.tracks[this.tracks.length-1]).samplesStream.tags=t,g.samplesStream.sounds=h.slice(1),this.scrollToSelectedTrack(),g.updateSteps(),setTimeout(function(){g.samplesStream.initBuffers()},250),e.abrupt("return",g);case 50:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=bk(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).higherOrderSequencer=new vk(Object(c.a)(e)),e}return Object(o.a)(n,[{key:"applyHigherOrderSequencing",value:function(e){var t=this.higherOrderSequencer.wasRolling,n=this.higherOrderSequencer.isRolling(),r=n.isRolling,a=n.isNewRoll,i=n.modules;if(r!==t||a){var s=this.higherOrderSequencer.getStepForModule(e);this.setSequenceRolling(r,void 0,!0,s,a);var o,c=mk(this.subSequences);try{for(c.s();!(o=c.n()).done;){var u=o.value;u.higherRolling=r?i.includes(u):void 0}}catch(l){c.e(l)}finally{c.f()}}}}]),n}(e)}(CO));t.default=wk},,function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(6),u=n(8),l=n(2),f=n(296),h=n(146),p=n(139),d=(n(214),n(148)),v=n(155),m=n(228),y=n(118);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}function g(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}n(153);var j=n(125),w=n(122);function x(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var E=n(793),T=(new Date(2018,7,3),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.a,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(s.a)(this,e),this.ethereum=t,this.linkedPromiseList=void 0,this.results=[],this.includePrivate=n}return Object(o.a)(e,[{key:"executeQuery",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=7e6,!navigator.onLine){e.next=5;break}return e.next=4,this.getCurrentBlock();case 4:n=e.sent;case 5:return e.next=7,this.start(t,n-3e6,n);case 7:return this.linkedPromiseList=e.sent,e.abrupt("return",this);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getNext",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.linkedPromiseList&&!this.canceled){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.next=4,this.linkedPromiseList.getCurrent();case 4:if(t=e.sent,t=Array.from(new Set(t)),this.results=this.results.concat(t),this.results=this.sort(this.results),void 0!==this.linkedPromiseList){e.next=10;break}return e.abrupt("return",void 0);case 10:return e.next=12,this.linkedPromiseList.getNext();case 12:return this.linkedPromiseList=e.sent,e.abrupt("return",this.linkedPromiseList);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var s,o=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n<=3e6)){e.next=2;break}return e.abrupt("return",new Promise(function(e,t){return e(void 0)}));case 2:return console.log("Get Sequences start fromBlock=%s toBlock=%s",n,r),s=this.ethereum.tokenizedSequences,e.abrupt("return",new E.a(Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.getSequences(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),new E.a(Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ethereum.getNewSequences(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),this.start(t,n-3e6,r-3e6))));case 5:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sort",value:function(e){return e.sort(function(e,t){return t.blockNumber-e.blockNumber}),e}},{key:"getCurrentBlock",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ethereum.web3.eth.getBlockNumber();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}()),A=n(794);function M(e){return R.apply(this,arguments)}function R(){return(R=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===m.d?3:14;break;case 3:return console.log("link type was correct"),n=new T,e.next=7,n.executeQuery();case 7:return e.next=9,n.getNext();case 9:if(!e.sent){e.next=13;break}console.log("getting next"),e.next=7;break;case 13:return e.abrupt("return",j.a.collapseAllSequences(n.results).map(function(e){return new A.a(void 0,void 0,e.newSequence,void 0,e.title)}));case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}var C=function e(){Object(s.a)(this,e)};function N(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function I(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var _={},D=n(791),F=n(138),L=n(391);function B(e,t){return z.apply(this,arguments)}function z(){return(z=Object(i.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===m.d?3:7;break;case 3:return e.next=5,H(n);case 5:return r=e.sent,e.abrupt("return",r.map(function(e){return{linkType:t,fromData:n,toData:e}}));case 7:return e.next=9,j.a.xanadu.getLinks(t,n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function J(e,t,n){return V.apply(this,arguments)}function V(){return(V=Object(i.a)(a.a.mark(function e(t,n,r){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===m.d?3:8;break;case 3:return(i=new F.a(r)).fromData=n,e.next=7,i.fetchMetadata();case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function H(e){return U.apply(this,arguments)}function U(){return(U=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.getJson(t);case 2:return n=e.sent,e.abrupt("return",Object(L.a)(n));case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function G(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var W=function(e){Object(c.a)(n,e);var t=G(n);function n(e,r,a,i){var o,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return Object(s.a)(this,n),(o=t.call(this,a,i,c)).linkType=e,o.fromData=r,o.isLoaded=!1,o}return Object(o.a)(n,[{key:"isDynamic",value:function(){return!0}},{key:"load",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:j.a.xanadu,!this.isRoot()){e.next=5;break}return e.next=4,this.loadRoot(t);case 4:return e.abrupt("return");case 5:return e.next=7,B(this.linkType,this.fromData);case 7:n=e.sent,e.t0=a.a.keys(n);case 9:if((e.t1=e.t0()).done){e.next=19;break}return r=e.t1.value,i=n[r],e.t2=this,e.next=15,J(this.linkType,this.fromData,i.toData);case 15:e.t3=e.sent,e.t2.addItem.call(e.t2,e.t3),e.next=9;break;case 19:this.isLoaded=!0;case 20:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadRoot",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t=this,r=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>0&&void 0!==r[0]?r[0]:j.a.xanadu,e.next=3,M(this.linkType);case 3:return e.sent.map(function(e){return new n(t.linkType,e.getId(),e.getName(),t)}).forEach(function(e){return t.addFolder(e)}),this.isLoaded=!0,e.abrupt("return",this);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(D.a);function K(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}function Q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(u.a)(this,n)}}var Z=function(e){Object(c.a)(n,e);var t=Q(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this)).web3=e,r.contract=(new f.a).getContract(e),r.linkFolder=new W(m.d),r.sequencesCache=void 0,r}return Object(o.a)(n,[{key:"load",value:function(){return this.linkFolder.loadRoot(this)}},{key:"newDataType",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newDataType",[this.web3.utils.fromAscii(t),n]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newLinkType",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newLinkType",[this.web3.utils.fromAscii(t),n]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newLinks",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newLink",[this.web3.utils.fromAscii(t),n,r]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getDataTypes",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new p.a((new f.a).contractAddress).from(y.j).select("dataType").select("description"),e.next=3,t.executeQuery();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getLinkTypes",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new p.a((new f.a).contractAddress).from(y.v).select("linkType").select("description"),e.next=3,t.executeQuery();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getLinks",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,s,o,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new p.a((new f.a).contractAddress).from(y.u).select("fromData").select("toData").where("linkType",t),n&&i.where("fromData",n),r&&i.where("toData",r),e.next=5,i.executeQuery();case 5:s=e.sent,o=[],c=function(e){var t=s[e].fromData;if(o.some(function(e){return e.fromData===t}))return"continue";o.push(s[e])},e.t0=a.a.keys(s);case 9:if((e.t1=e.t0()).done){e.next=16;break}if(u=e.t1.value,"continue"!==c(u)){e.next=14;break}return e.abrupt("continue",9);case 14:e.next=9;break;case 16:return e.abrupt("return",o);case 17:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(function(e){return function(e){Object(c.a)(n,e);var t=K(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"presetResampled",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.newLinks(m.b,Object(d.b)(t),Object(d.b)(n));case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getResampledPreset",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLinks(m.b,t);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].toData);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),n}(e)}(function(e){return function(e){Object(c.a)(n,e);var t=k(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"syncProjectBPM",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newAnnotation",[this.web3.utils.fromAscii(m.c),Object(d.b)(t),this.web3.utils.fromAscii(n.toString())]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getProjectsWithBPM",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,s,o,c,u,l,h,d;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new p.a((new f.a).contractAddress).from(y.g).select("data").select("annotationData").where("annotationType",m.c).whereIn("data",t),r&&i.where("address",r.toLowerCase()),e.next=4,i.executeQuery();case 4:s=e.sent,o={},c=g(s);try{for(c.s();!(u=c.n()).done;)l=u.value,h=l.data,d=parseInt(l.annotationData),void 0===o[h]&&d===n&&(o[h]=d)}catch(a){c.e(a)}finally{c.f()}return e.abrupt("return",Object.keys(o));case 9:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getProjectBPM",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new p.a((new f.a).contractAddress).from(y.g).select("data").select("annotationData").where("data",t).where("annotationType",m.c),n&&r.where("address",n.toLowerCase()),e.next=4,r.executeQuery();case 4:if(0!==(i=e.sent).length){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.abrupt("return",parseInt(i[0].annotationData));case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}]),n}(e)}(function(e){return function(e){Object(c.a)(n,e);var t=I(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"rateSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:m.e,e.next=3,new v.a(h.q,"newAnnotation",[this.web3.utils.fromAscii(r),Object(d.b)(t),this.web3.utils.fromAscii(n.toString())]).execute();case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSoundsWithRating",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,s,o,c,u,l,h,d;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new p.a((new f.a).contractAddress).from(y.g).select("data").select("annotationData").whereIn("data",t),r&&i.where("address",r.toLowerCase()),e.next=4,i.executeQuery();case 4:s=e.sent,o={},c=N(s);try{for(c.s();!(u=c.n()).done;)l=u.value,h=l.data,d=parseInt(l.annotationData),void 0===o[h]&&d===n&&(o[h]=d)}catch(a){c.e(a)}finally{c.f()}return e.abrupt("return",Object.keys(o));case 9:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSoundRating",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:m.e,r=c.length>2?c[2]:void 0,i=n+"."+t,r&&(i+=" "+r),!(i in _)){e.next=6;break}return e.abrupt("return",_[i]);case 6:return s=new p.a((new f.a).contractAddress).from(y.g).select("data").select("annotationData").where("data",t),r&&s.where("address",r.toLowerCase()),e.next=10,s.executeQuery();case 10:if(0!==(o=e.sent).length){e.next=14;break}return _[i]=void 0,e.abrupt("return",void 0);case 14:return _[i]=parseInt(o[0].annotationData),e.abrupt("return",_[i]);case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),n}(e)}(function(e){return function(e){Object(c.a)(n,e);var t=b(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"syncPadType",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newAnnotation",[this.web3.utils.fromAscii(m.a),Object(d.b)(t),this.web3.utils.fromAscii(n)]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPacksWithType",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new p.a((new f.a).contractAddress).from(y.g).select("data").select("annotationData").where("annotationData",n),e.next=3,i.executeQuery();case 3:return s=e.sent,e.abrupt("return",s.map(function(e){return e.data}));case 5:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(e)}(function(e){Object(c.a)(n,e);var t=P(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).annotationContentCache={},e}return Object(o.a)(n,[{key:"newAnnotationType",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newAnnotationType",[this.web3.utils.fromAscii(t),n]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAnnotations",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=o.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=o[i];return s=new p.a((new f.a).contractAddress).from(y.g).select("data").select("annotationData").select("address").where("annotationType",t).whereIn("data",r),e.next=4,s.executeQuery();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getContentReferences",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new p.a((new f.a).contractAddress).from(y.g).select("data").where("annotationData",t),e.next=3,n.executeQuery();case 3:return r=e.sent,e.abrupt("return",r.map(function(e){return e.data}));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getFlattenedAnnotations",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,f,h,p,d,v,m=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=m.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=m[i];return e.next=3,this.getAnnotations.apply(this,[t].concat(r));case 3:s=e.sent,o={},c=x(s);try{for(c.s();!(u=c.n()).done;)l=u.value,(f=l.annotationData)in o||(o[f]=[]),o[f].push(l)}catch(a){c.e(a)}finally{c.f()}for(p in h=[],o)d=o[p],v={annotationData:p,address:d[0].address,contentHashes:d.map(function(e){return e.data}),blockNumber:d[0].blockNumber},h.push(v);return e.abrupt("return",h);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAnnotationContents",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAnnotations(t,n);case 2:r=e.sent,i=this.web3.utils,s=x(r),e.prev=5,s.s();case 7:if((o=s.n()).done){e.next=17;break}return c=o.value,u=void 0,i.fromAscii(c.annotationData),e.next=13,w.a.getJson(Object(d.a)(i.fromAscii(c.annotationData)));case 13:u=e.sent,c.content=u;case 15:e.next=7;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(5),s.e(e.t0);case 22:return e.prev=22,s.f(),e.finish(22);case 25:return e.abrupt("return",r);case 26:case"end":return e.stop()}},e,this,[[5,19,22,25]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newAnnotation",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newAnnotation",[this.web3.utils.fromAscii(t),Object(d.b)(n),this.web3.utils.fromAscii(r)]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"newAnnotationContent",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.addJson(r);case 2:return i=e.sent,e.next=5,this.newAnnotationHash(t,n,i);case 5:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"newAnnotationHash",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v.a(h.q,"newAnnotation",[this.web3.utils.fromAscii(t),Object(d.b)(n),Object(d.b)(r)]).execute();case 2:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getAnnotationTypes",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new p.a((new f.a).contractAddress).from(y.h).select("annotationType").select("description"),e.next=3,t.executeQuery();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),n}(C))))));t.a=Z},,function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=function(){function e(){Object(s.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"}],name:"new2DMapping",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"ipfsHash",type:"bytes32"}],name:"New2DMapping",type:"event"}],this.contractAddress="0x50ff08f58ba3d2cbeaa07326267332e41dc946aa"}return Object(o.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),u=n(118),l=n(214),f=n(122),h="X",p=function(){function e(t){if(Object(s.a)(this,e),t.length<=1)this.pivot=t[0];else{var n=this.getPivotAndDimension(t);this.pivot=n.pivot,this.dimension=n.dimension,this.range=n.range;var r=t.indexOf(this.pivot);t.splice(r,1);var a=this.getSubTreePoints(this.pivot,this.dimension,t);this.leftSubTree=new e(a.left),this.rightSubTree=new e(a.right)}}return Object(o.a)(e,[{key:"getSubTreePoints",value:function(e,t,n){var r=[],a=[],i=this.getValueForDimension(e,t);for(var s in n){var o=n[s],c=this.getValueForDimension(o,t);c<i?r.push(o):c>=i&&a.push(o)}return{left:r,right:a}}},{key:"getValueForDimension",value:function(e,t){return t===h?e.point[0]:e.point[1]}},{key:"getPivotAndDimension",value:function(e){var t=this.chooseDimension(e),n=t.dimension,r=(t.max+t.min)/2,a=void 0,i=1e4;for(var s in e){var o=e[s],c=n===h?Math.abs(o.point[0]-r):Math.abs(o.point[1]-r);c<i&&(a=o,i=c)}return{pivot:a,dimension:n,range:{min:t.min,max:t.max}}}},{key:"chooseDimension",value:function(e){var t=1e4,n=1e4,r=-1e4,a=-1e4;for(var i in e){var s=e[i].point[0],o=e[i].point[1];s<t&&(t=s),s>r&&(r=s),o<n&&(n=o),o>a&&(a=o)}return r-t>a-n?{dimension:h,min:t,max:r}:{dimension:"Y",min:n,max:a}}},{key:"getPointsInRange",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(void 0===this.pivot)return[];var i=this.pivot.point[0],s=this.pivot.point[1],o=[];return i>=e&&i<=n&&s>=t&&s<=r&&o.push(this.pivot),this.dimension==h?(i<=n&&e<=this.range.max&&void 0!==this.rightSubTree&&(o=o.concat(this.rightSubTree.getPointsInRange(e,t,n,r,a+1))),i>=e&&n>=this.range.min&&void 0!==this.leftSubTree&&(o=o.concat(this.leftSubTree.getPointsInRange(e,t,n,r,a+1)))):"Y"===this.dimension&&(s<=r&&t<=this.range.max&&void 0!==this.rightSubTree&&(o=o.concat(this.rightSubTree.getPointsInRange(e,t,n,r,a+1))),s>=t&&r>=this.range.min&&void 0!==this.leftSubTree&&(o=o.concat(this.leftSubTree.getPointsInRange(e,t,n,r,a+1)))),o}},{key:"size",value:function(){var e=1;return void 0!==this.leftSubTree&&(e+=this.leftSubTree.size()),void 0!==this.rightSubTree&&(e+=this.rightSubTree.size()),e}},{key:"inRange",value:function(e,t,n,r){return void 0!==this.range&&(this.dimension===h?e>=this.range.min&&e<=this.range.max:t>=this.range.min&&t<=this.range.max)}}]),e}(),d=new c,v=function(){function e(t){Object(s.a)(this,e),this.contract=d.getContract(t),this.loaded=!1}return Object(o.a)(e,[{key:"load",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new l.a(this.contract.contractAddress).from(u.f).select("ipfsHash").executeQuery();case 2:if(0!==(t=e.sent).length){e.next=5;break}return e.abrupt("return");case 5:return n=t[t.length-1].ipfsHash,e.next=8,f.a.getJson(n);case 8:r=e.sent,this.points=r,this.pointsMap=this.getMap(r),console.log("constructing KD tree"),this.kdTree=new p(this.points),console.log("finished constructing KD tree size="),console.log(this.kdTree.size()),this.loaded=!0;case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPointsInRange",value:function(e,t,n,r){var a=(new Date).getTime(),i=this.kdTree.getPointsInRange(e,t,n,r),s=(new Date).getTime();return console.log("finished getting points in "+(s-a)+" ms"),i}},{key:"getMap",value:function(e){var t={};for(var n in e){var r=e[n];t[r.path]=r}return t}},{key:"findSimilarSounds",value:function(e){var t=void 0;for(var n in this.points)this.points[n].path===e&&(t=this.points[n]);if(void 0===t)return console.log("no point"),[];var r=[];for(var a in this.points){var i=this.distance(t,this.points[a]);r.push({point:this.points[a],distance:i})}return r.sort(function(e,t){return e.distance-t.distance}),r.slice(0,100).map(function(e){return e.point.path})}},{key:"distance",value:function(e,t){var n=e.point[0],r=e.point[1],a=t.point[0],i=t.point[1];return Math.sqrt(Math.pow(a-n,2)+Math.pow(i-r,2))}}]),e}();t.a=v},,function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=n(782),u=n(155),l=n(146),f=n(139),h=n(118),p=n(122),d=n(153);var v=n(148),m=new c.a,y=function(){function e(t){Object(s.a)(this,e),this.web3=t,this.contract=m.getContract(t),this.contractAddress=m.contractAddress}return Object(o.a)(e,[{key:"sendMessage",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3?arguments[3]:void 0;return new Promise(function(){var o=Object(i.a)(a.a.mark(function i(o,c){var f,h,m;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(void 0!==e){a.next=4;break}return a.next=3,d.a.getAccount();case 3:e=a.sent;case 4:return f={type:r,referenceHash:n,content:s},a.next=7,p.a.addJson(f,!0);case 7:h=a.sent,m=Object(v.b)(h),n=null!==n?Object(v.b)(n):t.web3.utils.padLeft("0x0",64),new u.a(l.l,"sendPublicMessage",[e,n,m]).execute().then(function(){o(h)});case 11:case"end":return a.stop()}},i)}));return function(e,t){return o.apply(this,arguments)}}())}},{key:"getMessages",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:null,n=s.length>1?s[1]:void 0,e.next=4,this.getQuery(t,n);case 4:return r=e.sent,e.next=7,r.executeQuery();case 7:return i=e.sent,e.abrupt("return",i);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"watchForNewMessages",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:null,n=i.length>1?i[1]:void 0,r=i.length>2?i[2]:void 0,e.next=5,this.getQuery(t,n);case 5:e.sent.watchQuery(r);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getQuery",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:null,n=i.length>1?i[1]:void 0,r=new f.a(this.contractAddress).from(h.M).select("fromUser").select("referenceHash").select("messageHash").where("referenceHash",t),n&&r.where("toUser",n),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=y},function(e,t,n){"use strict";var r=n(42),a=n.n(r),i=n(56),s=n(4),o=n(5),c=function(){function e(){Object(s.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"reasoningHash",type:"bytes32"}],name:"copyStrikeSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"newDesignatedAgent",type:"address"}],name:"switchDesignatedAgent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"}],name:"takedownSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"reasoningHash",type:"bytes32"}],name:"SampleCopyStrike",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"}],name:"SampleTakenDown",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"agent",type:"address"}],name:"NewDesignatedAgent",type:"event"}],this.contractAddress="0xAd4752a6C01C2B25b6248bEB33B1B03f2BE9F9E7"}return Object(o.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),u=n(148),l=n(214),f=n(118),h=n(122),p=new c,d=function(){function e(t){Object(s.a)(this,e),this.web3=t,this.contract=p.getContract(t),this.contractAddress=p.contractAddress}return Object(o.a)(e,[{key:"getCopyStrikedSamples",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new l.a(this.contractAddress).from(f.P).select("sampleHash").select("reasoningHash"),e.next=3,t.executeQuery();case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTakenDownSamples",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new l.a(this.contractAddress).from(f.W).select("sampleHash"),e.next=3,t.executeQuery();case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"copyStrikeSample",value:function(e,t,n){var r=this;return new Promise(function(){var s=Object(i.a)(a.a.mark(function i(s,o){var c,l,f;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,r.web3.eth.getAccounts();case 2:return c=a.sent,l={reasoning:n,emailAddress:t},a.next=6,h.a.addJson(l,!0);case 6:f=a.sent,f=Object(u.b)(f),e=Object(u.b)(e),r.contract.methods.copyStrikeSample(e,f).send({from:c[0]},function(e,t){e?o():s()});case 10:case"end":return a.stop()}},i)}));return function(e,t){return s.apply(this,arguments)}}())}},{key:"takeDownSample",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:s=n.sent,e=Object(u.b)(e),t.contract.methods.takedownSample(e).send({from:s[0]},function(e,t){e?i():r()});case 5:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}}]),e}();t.a=d},,,function(e,t,n){"use strict";n.r(t);var r=n(107),a=n(3),i=n.n(a),s=n(11),o=n(55),c=(n(930),n(23)),u=Object(o.b)(function(e,t){return{minimizedSubPatches:e.zobject.minimizedSubPatches,viewableSubPatches:e.zobject.viewableSubPatches}},function(e){return{setViewableSubPatches:function(t){return e(Object(c.Me)(t))},setMinimizedSubPatches:function(t){return e(Object(c.gc)(t))}}})(function(e){var t=e.minimizedSubPatches,n=e.viewableSubPatches,r=e.setViewableSubPatches,o=e.setMinimizedSubPatches,c=Object(a.useCallback)(function(e){if(n.includes(e))return t.includes(e)||o([].concat(Object(s.a)(t),[e])),void r(Object(s.a)(n.filter(function(t){return t!==e})));r([].concat(Object(s.a)(n),[e]))},[t,n]),u=[].concat(Object(s.a)(t),Object(s.a)(n.filter(function(e){return!t.includes(e)})));return i.a.createElement("div",{className:"minimized-subpatches"},u.map(function(e){return i.a.createElement("div",{onClick:function(){return c(e)},className:n.includes(e)?"subpatch-option viewing":"subpatch-option"},i.a.createElement("img",{src:"/subpatch-light.svg"}),e.name())}))}),l=Object(o.b)(function(e,t){return{minimizedSubPatches:e.zobject.minimizedSubPatches,viewableSubPatches:e.zobject.viewableSubPatches}},function(e){return{}})(function(e){var t=e.minimizedSubPatches,n=e.viewableSubPatches;return 0===t.length&&0===n.length?"":i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},onMouseDown:function(e){return e.stopPropagation()},className:"subpatch-dock"},i.a.createElement(u,null))}),f=n(133),h=n(308),p=n.n(h),d=(n(942),Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.sequencerEngine,n=Object(a.useState)(!1),s=Object(r.a)(n,2),o=s[0],c=s[1],u=Object(a.useState)(),l=Object(r.a)(u,2),f=l[0],h=l[1],d=Object(a.useState)(!1),v=Object(r.a)(d,2),m=v[0],y=v[1],b=Object(a.useState)(),g=Object(r.a)(b,2),O=g[0],k=g[1];Object(a.useEffect)(function(){window.addEventListener("click",j)},[c]);var j=Object(a.useCallback)(function(){c(!1)},[c]);Object(a.useEffect)(function(){if(t){var e=t.currentSubSequence.findNodeByName("spore.stems")[0];console.log("spore stems found=",e),e&&(h(e.effect),k(e.effect.playlist[0]))}},[t]);var w="spores-playlister";return o&&(w+=" showing"),f?i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:w},o?i.a.createElement("div",{className:"spores-playlist"},i.a.createElement("div",{onClick:function(){return c(!1)},className:"arrow-down"}),i.a.createElement("div",{className:"artist-name"},"Keyon Christ"),f.playlist.map(function(e){return i.a.createElement("div",{onClick:function(n){O!==e?(t.stop(),t.seekToTrackStep(0),k(e),y(!0),f.loadSong(e).then(function(e){y(!1),setTimeout(function(){t.play()},150)})):c(!1)},className:e===O?"song-item current":"song-item"},i.a.createElement("div",{className:"song-title"},e.name),e===O&&m&&i.a.createElement(p.a,{sizeUnit:"px",className:"pulse-loader",size:6,color:"#aab7ba",loading:!0}))})):i.a.createElement("img",{onClick:function(){return c(!0)},className:"pushable spores-icon",src:(window.isNFT?"":"/")+"spores-icon-glow2.svg"})):""})),v=function(e){var t=e.rollSteps,n=e.stepNumber,r=(e.resolution,{left:39*(n=n/2%16),width:39*(t/=2)});return i.a.createElement("div",{className:"roll-visualizer",style:r})},m=n(4),y=n(5),b=n(6),g=n(8),O=n(2);function k(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var x=function(e){Object(b.a)(n,e);var t=w(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"getClassName",value:function(e){var t=Math.floor(this.props.currentStep/2)%16,n="";(n=this.props.stepNumber===t?"current-step step":this.props.stepNumber<t?"previous-step step":"step",this.props.toggled&&this.props.stepNumber!==t&&(n+=" toggled"),void 0!==this.props.rollingStepNumber)&&(Math.floor(this.props.rollingStepNumber/2)%16===this.props.stepNumber&&(n+=" rolling-step"));return n}},{key:"isCurrent",value:function(){var e=Math.floor(this.props.currentStep/2)%16;return!(!this.props.toggled||this.props.stepNumber!==e)}},{key:"render",value:function(){var e=this.getClassName(),t={};if(this.isCurrent()){var n,r=0,a=k(this.props.sequencerEngine.tracks);try{for(a.s();!(n=a.n()).done;){var s=n.value;s.isFrozen||(r+=(s.triggerCount||0)+(s.otherTriggerCount||0))}}catch(o){a.e(o)}finally{a.f()}r>0&&(r=Math.pow(r,1.3),t.boxShadow="0px 0px ".concat(r,"px ").concat(r,"px #ff5151"))}return i.a.createElement("div",{style:t,onMouseOver:this.props.onMouseOver,onMouseDown:this.props.onMouseDown,className:e})}}]),n}(a.Component),S=Object(o.b)(function(e,t){return{toggled:e.steps.masterStepToggles[t.stepNumber]}},null)(x),P=Object(o.b)(function(e,t){var n=t.sequencerEngine.getSequenceId();return{stepNumber:e.sequencer.currentGlobalStep[n]||0,masterStepToggles:e.steps.masterStepToggles,isSequenceRolling:t.sequencerEngine.isSequenceRolling}},function(e){return{setMasterStepToggles:function(t){return e(Object(c.cc)(t))},mouseDown:function(t){return e(Object(c.j)(t))}}})(function(e){var t=Object(a.useCallback)(function(t){var n=e.masterStepToggles;n[t]=!n[t],e.setMasterStepToggles(n)},[]),n=Object(a.useCallback)(function(n){e.sequencerEngine.state.keyboard.isMouseDown&&t(n)},[]),r=Array(16).fill(0),s=e.stepNumber,o=void 0,c=void 0,u=void 0;if(e.isSequenceRolling){var l=e.sequencerEngine.tracks[0];if(l){var f=l.getFactoredResolution().getNumberOfStepsAtBaseResolution(),h=l.patternRollStepNumber+e.stepNumber%f;o=h%l.pattern.stepBuckets.length,c=f,u=l.patternRollStepNumber}}return i.a.createElement("div",{onMouseUp:function(){return e.mouseDown(!1)},onMouseDown:function(){return e.mouseDown(!0)},className:"steps-visualizer"},e.isSequenceRolling?i.a.createElement(v,{rollSteps:c,stepNumber:u}):"",r.map(function(r,a){return i.a.createElement(S,{key:a,sequencerEngine:e.sequencerEngine,onMouseOver:function(){return n(a)},onMouseDown:function(){return t(a)},stepNumber:a,rollingStepNumber:void 0!==o?s:o,currentStep:void 0!==o?o:s})}))}),E=n(26),T=(n(943),Object(o.b)(function(e,t){return{enableRollViewer:e.sequencer.enableRollViewer,viewMode:e.sequencer.viewMode,halftime:t.sequencerEngine&&t.sequencerEngine.keyListener&&t.sequencerEngine.keyListener.halftime,sequenceRolling:e.sequencer.trackRolling&&t.sequencerEngine&&t.sequencerEngine.isSequenceRolling,rollResolution:e.sequencer.resolution}},function(e){return{}})(function(e){var t=e.viewMode,n=e.sequenceRolling,r=e.enableRollViewer,a=e.sequencerEngine,s=e.halftime,o=e.rollResolution;return n||s?t===E.a?"":r?i.a.createElement("div",{className:"rolling-viewer"},i.a.createElement("div",{className:"roll-text"},n?i.a.createElement("span",null,"ROLLING ",o.toString()):i.a.createElement("span",null,"HALF-TIME"),i.a.createElement(P,{sequencerEngine:a}))):"":""}),n(944),Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=Object(a.useState)(!1),n=Object(r.a)(t,2),s=n[0],o=n[1],c=Object(a.useState)({}),u=Object(r.a)(c,2),l=u[0],f=u[1],h=Object(a.useCallback)(function(e){var t=document.referrer;window.parent.postMessage({type:"lootbox-item-selected",body:e},t),o(!0)},[o]);Object(a.useEffect)(function(){window.addEventListener("message",p)},[f]);var p=Object(a.useCallback)(function(e){"lootbox"===e.data.type&&f(e.data.body)},[f]);return s?"":i.a.createElement("div",{className:"loot-box"},Object.keys(l).map(function(e){return i.a.createElement("div",{onClick:function(){return h(e)},className:"pushable loot-option"},i.a.createElement("img",{src:l[e]}))}))})),A=n(42),M=n.n(A),R=n(56),C=n(31),N=n(7),q=n.n(N),I=n(580),_=n(165);var D=n(274),F=n(9);n(48),n(910),n(583);function L(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return B(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function z(e,t){return t===F.g.id?e.mix:e.getSubSequence(t).mix}function J(e){for(var t in e)if(e[t].end>e[t].start)return!1;return!0}var V=function(e,t){var n,r=L(e.subSequences);try{for(r.s();!(n=r.n()).done;){var a=n.value.tracks.find(function(e){return e.id===t});if(a)return a}}catch(i){r.e(i)}finally{r.f()}},H=function(e){var t=e.state,n=t.arrangement.rowSelections;if(J(n)){var r=t.arrangement.selectedEvents,a=t.arrangement.selectedRows;if(void 0!==a&&0!==a.length){var i=a[0];for(var s in r){var o=parseInt(s),u=r[s];if(o!==F.a){var l=W(e,i);void 0!==u.parentEvent?l.dispatch(Object(D.a)(u.parentEvent,u)):l.dispatch(Object(D.b)(u,!0))}else K(e,u)}e.dispatch(Object(c.jd)(void 0))}}else!function(e,t){for(var n in t)V(e,n)||z(e,n).dispatch(Object(D.c)(t[n]))}(e,n)},U=function(e,t){var n={};n[t.id]=t,e.dispatch(Object(c.jd)(n)),e.state.arrangement.patternSelected&&e.dispatch(Object(c.B)(t)),e.dispatch(Object(c.y)(t.step))},G=function(e){var t=e.arrangement.selectedEvents;if(t&&0!==Object.keys(t).length)return t[Object.keys(t)[0]]},W=function(e,t){return t===F.g.id?e.mix:e.getSubSequence(t).mix},K=function(e,t){if(void 0===e.state.keyboard.selectedPianoRollSteps){var n=t.track,r=n.patterns.indexOf(t);n.deletePattern(r),e.switchToPattern(0),n.updateSteps(),e.dispatch(Object(c.D)([]))}},Q=n(246),Z=n(79),Y=n(21),X=n(44);function $(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ee(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ee(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var te=new Y.a(32,!1),ne=function(e,t){e.sequencerEngine.dispatch(Object(c.rd)(t))},re=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:te;t=te.transformStepAtResolution2(t,n);for(var r=e.pattern,a=r.stepBuckets,i=t+1;i<a.length;i++)if(a[i].anyOn())return n.transformStepAtResolution2(i,te);return n.transformStepAtResolution2(r.stepBuckets.length,te)};function ae(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ie(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var se=function(e,t,n){var a=0,i=e.getEasyPattern(),s=!t||0==t.length,o=e.sequencerEngine.state;s&&(t=i.getAllSteps(),a=e.pattern.length(n));var u,l=-1,f=ae(i.getStepNumbers(t,n));try{for(f.s();!(u=f.n()).done;){var h=u.value,p=Object(r.a)(h,2),d=p[0],v=p[1];v>l&&(l=v,d)}}catch(g){f.e(g)}finally{f.f()}var m=l+(n.resolution/4-l%(n.resolution/4));s||void 0===o.keyboard.cursor?s||(a=m):a=o.keyboard.cursor-o.keyboard.cursor%(n.resolution/4),(s||a>=e.pattern.length(n))&&e.doubleTrackLength();var y=s?i.getFirstOnStep(n):i.getFirstStepNumber(t,n);a+=s?y:y%(n.resolution/4);e.getEasyPattern().pasteSteps(t,{stepNumber:a},i,n);e.updateSteps();var b=m-(y-y%(n.resolution/4));e.sequencerEngine.dispatch(Object(c.Ic)(a+b))},oe=n(136),ce=n(61),ue={2:new Y.a(4,!1),3:new Y.a(4,!0),4:new Y.a(8,!1),5:new Y.a(8,!0),6:new Y.a(16,!1),7:new Y.a(16,!0),8:new Y.a(32,!1),9:new Y.a(32,!0)},le=n(50),fe=n(43),he=n(45),pe=n(819);function de(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}function ve(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return me(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return me(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ye(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var be=function(e){Object(b.a)(n,e);var t=ye(n);function n(e,r){var a;return Object(m.a)(this,n),(a=t.call(this)).sequencerEngine=e,a.disableTab=r,a.installation=r,a.store=e.store,a.onKeyDown=a.onKeyDown.bind(Object(C.a)(a)),a.onKeyUp=a.onKeyUp.bind(Object(C.a)(a)),a.keysDown={},a.effectToCopy=void 0,a.sequencerEngine.keyListener=Object(C.a)(a),a.checkMetaKey(),a.lastViewMode=void 0,a.halftime=void 0,a.bindings={},a}return Object(y.a)(n,[{key:"addBinding",value:function(e){this.bindings[e]=!0}},{key:"removeBinding",value:function(e){delete this.bindings[e]}},{key:"checkMetaKey",value:function(){var e=this;setInterval(function(){void 0!==e.lastMetaPressedTime&&((new Date).getTime()-e.lastMetaPressedTime>=5e3&&e.dispatch(Object(c.U)(!1)))},1e3)}},{key:"onKeyUp",value:function(e){var t=this;this.keysDown[e.key&&e.key.toLowerCase()]=!1,Object(I.a)(e)||("Meta"===e.key||"Control"===e.key?(this.lastMetaPressedTime=void 0,this.dispatch(Object(c.U)(!1))):"/"===e.key?this.dispatch(Object(c.Pd)(!this.state.spatial.showSearchWindow)):"~"===e.key||"`"===e.key?(void 0!==this.halftime&&(this.sequencerEngine.subSequences.forEach(function(e,n){return e.playhead.speedFactorParameter.set(t.halftime[n],!1)}),this.halftime=void 0),"`"===e.key&&(this.sequencerEngine.sequenceRolling=!1)):Object(fe.a)(e.key)||this.sequencerEngine.keyboardHelper.onKeyUp(e))}},{key:"onKeyDown",value:function(e){var t=this;if((!this.keysDown[e.key&&e.key.toLowerCase()]||e.ctrlKey||e.metaKey)&&(!Object(I.a)(e)||"d"===e.key&&e.metaKey)&&(this.keysDown[e.key&&e.key.toLowerCase()]=!0,!this.state.sequencer.loadingText&&(!this.bindings[e.key]||e.ctrlKey||e.metaKey||this.sequencerEngine.isAnyTrackEnabled()))){if(32==e.keyCode&&e.target==window.document.body){if(e.preventDefault(),(this.viewMode===E.a||this.state.arrangement.looping)&&(this.sequencerEngine.playing||this.dispatch(Object(c.Kb)(!0))),window.synthz)return;return this.sequencerEngine.schedulePlay(),!1}var n=e.target===window.document.body;if(this.viMode&&!e.metaKey&&!e.ctrlKey&&!e.ctrlKey){if("Escape"===e.key)return void this.dispatch(Object(c.Le)(!1));if(this.scripting.viCommand(e.key),Object(fe.a)(e.key))return}if("Space"!==e.key){if(!this.viMode&&e.key>="a"&&e.key<="z"&&!e.metaKey&&!e.ctrlKey&&!e.ctrlKey)return this.sequencerEngine.keyboardHelper.onAlphabetKeyDown(e,this.cursor.track),!0;if(this.installation||"x"===e.key&&(e.metaKey||e.ctrlKey)&&this.state.commands.commandInput&&(this.state.commands.commandInput.focus(),this.dispatch(Object(c.V)("M-x"))),"m"===e.key&&(e.ctrlKey||e.metaKey))return e.preventDefault(),this.sequencerEngine.metronomeOn=!this.sequencerEngine.metronomeOn,!1;if("~"===e.key&&(this.halftime=this.sequencerEngine.subSequences.map(function(e){return e.playhead.speedFactorParameter.get()}),this.sequencerEngine.subSequences.forEach(function(e,n){return e.playhead.speedFactorParameter.set(t.halftime[n]/2,!1)})),"n"===e.key&&(e.ctrlKey||e.ctrlKey))return e.preventDefault(),this.selectedTrack.auditionNext(!0,!0),!1;if("R"===e.key){var r,a=ve(this.sequencerEngine.subSequences);try{for(a.s();!(r=a.n()).done;){r.value.tracks.forEach(function(e){return e.setIsEnabled(!1)})}}catch(p){a.e(p)}finally{a.f()}}if("p"===e.key&&(e.ctrlKey||e.ctrlKey))return e.preventDefault(),this.selectedTrack.auditionPrevious(!0,!0),!1;if("i"===e.key&&(e.ctrlKey||e.metaKey)){e.preventDefault();var i=this.selectedTrack;!i||this.selectedEffect&&this.selectedEffect.name.includes("Effect Rack")||this.dispatch(Object(c.xe)(i))}if("Escape"===e.key&&this.dispatch(Object(c.Cb)(void 0)),"g"===e.key&&e.metaKey)return e.preventDefault(),this.planarSelected||this.groupSteps(),!0;if("\\"===e.key&&e.metaKey&&this.dispatch(Object(c.Wd)(!this.state.spatial.sidebarsShowing)),"z"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),e.shiftKey?this.sequencerEngine.operationManager.redo():this.sequencerEngine.operationManager.undo(),!0;if("k"===e.key&&(e.metaKey||e.ctrlKey))return this.midiMapMode===he.b?(console.log("SETTING MIID MAP MODE=off"),this.dispatch(Object(c.fc)(he.c))):(console.log("SETTING MIID MAP MODE=",he.b),this.dispatch(Object(c.fc)(he.b))),!0;if("y"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),function(e){var t=e.state.pads.selectedEdge;if(t){var n=t.id,r=e.currentSubSequence.getMessagingEdgeById(n);r&&(r.segmentation?r.segmentation=!1:r.segment(),e.dispatch(Object(c.N)(n,r.segmentation)))}}(this.sequencerEngine),!0;if("j"===e.key&&(e.metaKey||e.ctrlKey))return this.midiMapMode===he.a?this.dispatch(Object(c.fc)(he.c)):this.dispatch(Object(c.fc)(he.a)),!0;if("d"===e.key&&(e.ctrlKey||e.metaKey)){if(void 0!==this.selectedEffect&&("Effect Rack"===this.selectedEffect.name||"Midi Effect Rack"===this.selectedEffect.name))return;return e.preventDefault(),e.stopPropagation(),this.selectedZObject&&this.selectedZObject.getObjectType()===_.c?this.sequencerEngine.duplicateTrack(this.sequencerEngine.cursor.track):this.selectedZObject&&this.selectedZObject.getObjectType()===_.e&&this.selectedZObject.duplicate(),!1}if("a"===e.key&&(e.metaKey||e.ctrlKey)){if(e.preventDefault(),this.planarSelected)return;return this.state.automation.show&&this.state.sequencer.showPianoRoll&&this.state.arrangement.bottomMode===ce.b?this.selectAllTrackAutomationPoints():this.viewMode===E.a?this.state.arrangement.patternSelected?this.selectAllTrackSteps():this.selectAllTrackAutomationPoints():this.selectAllTrackSteps(),this.dispatch(Object(c.md)(void 0)),!1}if("E"===e.key)return e.preventDefault(),this.dispatch(Object(c.Ie)(!this.state.zobject.uxLocked)),!1;if("P"===e.key)return e.preventDefault(),this.state.spatial.showPadSequencer||this.dispatch(Object(c.Qc)(!this.state.spatial.presentationMode)),!1;if("w"===e.key&&(e.ctrlKey||e.ctrlKey))return e.preventDefault(),this.viewMode===E.c&&(this.dispatch(Object(c.Nd)(!this.showPianoRoll)),this.dispatch(Object(c.x)(ce.c))),!1;if("s"===e.key&&(e.ctrlKey||e.metaKey)){var s=this.selectedTrack.getSamplers()[0];s&&s.autoSlice(4)}else{if("p"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),this.dispatch(Object(c.wd)(void 0)),this.dispatch(Object(c.Nd)(!this.showPianoRoll)),this.dispatch(Object(c.x)(ce.b)),!1;if("s"===e.key&&(e.metaKey||e.ctrlKey)){if(e.preventDefault(),this.viewMode===E.c){var o=this.selectedTrack,u=this.state.cirklon.cirklonMode[o.id];this.dispatch(Object(c.P)(o.id,"SLOPE"===u?void 0:"SLOPE"))}return!1}if("g"===e.key&&(e.metaKey||e.ctrlKey)){if(e.preventDefault(),this.viewMode===E.c){var l=this.selectedTrack,f=this.state.cirklon.cirklonMode[l.id];this.dispatch(Object(c.P)(l.id,"GANG"===f?void 0:"GANG"))}return!1}}if(!Object(fe.a)(e.key)||this.viewMode===E.c&&this.selectedEffect&&"Plane Parameters"===this.selectedEffect.name)if("="===e.key)this.sequencerEngine.switchToNextPattern();else if("+"===e.key);else if("-"===e.key)this.sequencerEngine.switchToPreviousPattern();else if("]"===e.key)this.dispatch(Object(c.Qd)(!0));else if("c"===e.key&&(e.metaKey||e.ctrlKey))this.copy();else if("v"===e.key&&(e.metaKey||e.ctrlKey))this.paste();else if("b"===e.key&&(e.metaKey||e.ctrlKey))this.duplicateSteps();else{if("l"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),this.legato(),!1;if("r"===e.key&&e.ctrlKey)return e.preventDefault(),this.rollSteps(),!1;if("t"===e.key&&e.ctrlKey)return e.preventDefault(),this.tripletSteps(),!1;if("Backspace"!=e.key||this.hasHigherOrderSteps())if("`"==e.key)this.sequencerEngine.isSequenceRolling||(this.sequencerEngine.sequenceRolling=!0);else{if("\\"==e.key||"h"==e.key&&e.ctrlKey)return e.preventDefault(),this.hide(),!1;if("."==e.key)this.record();else if("Meta"===e.key||"Control"===e.key)this.onMetaKeyDown();else if("Tab"!==e.key||this.disableTab)if("'"===e.key)this.onClickRollingMode();else if("Shift"===e.key&&n)this.onShiftKeyDown();else if("ArrowRight"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;this.keyboardContext&&"ztracker"===this.keyboardContext.name?this.onArrowDown(e,!0):this.onArrowRight(e,!0)}else if("ArrowLeft"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;this.keyboardContext&&"ztracker"===this.keyboardContext.name?this.onArrowUp(e,!0):this.onArrowLeft(e,!0)}else{if("ArrowUp"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;return this.keyboardContext&&"ztracker"===this.keyboardContext.name?this.onArrowLeft(e,!0):this.onArrowUp(e)}if("ArrowDown"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;this.keyboardContext&&"ztracker"===this.keyboardContext.name?this.onArrowRight(e,!0):this.onArrowDown(e)}else if("Enter"==e.key&&n&&!this.hasHigherOrderSteps()){if(this.planarSelected)return;this.onEnterKeyDown()}}else{if(e.preventDefault(),this.isShowingSoundsPane())return void this.hideSidebar();if(this.state.instruments.showingFormants)return;if(this.waveformShowing)return}}else{if(this.sequencerEngine.noDeleteKey)return;if(void 0!==this.selectedFreeze)return void this.deleteSelectedFreeze();if(this.pointsSelected.length>0&&(this.showPianoRoll&&this.state.automation.show||this.viewMode===E.a))this.deleteSelectedPoints();else if(this.viewMode===E.a){var h=this.getSelectedSteps();h&&h.length>0?this.deleteSelectedSteps():H(this.sequencerEngine)}else this.deleteSelectedSteps()}}else if(n)return void this.onNumberKeyDown(e)}}}},{key:"waveformShowing",get:function(){return this.state.sequencer.waveformShowing}},{key:"onNumberKeyDown",value:function(e){var t=parseInt(e.key);if(this.viewMode!==E.a||this.isPlayingMix)if(this.sequencerEngine.rolling&&!e.metaKey){if(t>=2&&t<=9){var n=ue[t];null!==n&&(this.sequencerEngine.resolution=n)}}else if(e.ctrlKey){e.preventDefault();var r=t-1;this.sequencerEngine.tracks[r]&&(this.sequencerEngine.selectTrack(r),this.sequencerEngine.tracks[r].toggleEnabled())}else{var a=t;this.sequencerEngine.switchToPattern(a-1)}}},{key:"onMetaKeyDown",value:function(){this.dispatch(Object(c.U)(!0)),this.lastMetaPressedTime=(new Date).getTime()}},{key:"hide",value:function(){var e=this;if(this.state.tracks.tracksToHide.length>0)this.dispatch(Object(c.De)([]));else{if(!this.sequencerEngine.tracks.some(function(e){return e.isEffectsShowing()})){var t=this.sequencerEngine.tracks.filter(function(t){return t!==e.selectedTrack}),n=[].concat(Object(s.a)(this.state.tracks.tracksToHide.filter(function(t){return t!==e.selectedTrack})),Object(s.a)(t));this.dispatch(Object(c.De)(Array.from(new Set(n))))}this.hideSidebar(),this.dispatch(Object(c.i)(!1)),this.dispatch(Object(c.Nd)(!1))}}},{key:"hideSidebar",value:function(){this.dispatch(Object(c.xd)(!1)),this.dispatch(Object(c.Jd)(!1)),this.dispatch(Object(c.Od)(!1)),this.dispatch(Object(c.Rd)(!1)),this.dispatch(Object(c.Vd)(le.a))}},{key:"selectAllTrackAutomationPoints",value:function(){var e=this.sequencerEngine.tracks[this.cursor.track];if(void 0!==e){var t=this.state.automation.trackParameter[e.id];if(void 0!==t)if((this.state.automation.pointsSelected[e.id]||[]).length>0){var n,r=ve(this.sequencerEngine.tracks);try{for(r.s();!(n=r.n()).done;){var a=n.value;this.dispatch(Object(c.G)(a.id,[]))}}catch(i){r.e(i)}finally{r.f()}}else this.viewMode===E.a?this.dispatch(Object(c.G)(e.id,Object(s.a)(t.mixAutomation.automations))):this.dispatch(Object(c.G)(e.id,Object(s.a)(t.automations)))}}},{key:"selectAllTrackSteps",value:function(){var e=this.sequencerEngine.tracks[this.cursor.track];if(!(void 0===e||this.viewMode===E.c&&e.isEffectsShowing())||this.state.sequencer.showPianoRoll&&this.state.arrangement.bottomMode===ce.b){this.dispatch(Object(c.dd)(!1));e.currentPattern;if(void 0===this.getSelectedSteps()){var t=e.getEasyPattern().getAllSteps();this.dispatch(Object(c.rd)(t))}else this.dispatch(Object(c.rd)(void 0))}}},{key:"copy",value:function(){this.copiedNodesForRack.length>0||(this.selectedEffect?(this.effectToCopy=this.selectedEffect,this.dispatch(Object(c.ae)(void 0))):this.copySteps())}},{key:"paste",value:function(){if(!(this.copiedNodesForRack.length>0))if(void 0===this.state.keyboard.stepsToCopy&&void 0!==this.effectToCopy&&void 0!==this.selectedTrack&&this.selectedTrack.isEffectsShowing()){var e=this.effectToCopy.isMidiEffect()?this.effectToCopy.getCopy(this.selectedTrack):this.effectToCopy.getEffectCopy(this.sequencerEngine);this.effectToCopy.isMidiEffect()?this.selectedTrack.midiEffects.addEffect(e):this.selectedTrack.effectsChain.addEffect(e),this.sequencerEngine.update()}else this.pasteSteps()}},{key:"copySteps",value:function(){var e=this.getSelectedSteps();if(void 0!==e){this.dispatch(Object(c.ae)(e));var t=this.selectedTrack;this.dispatch(Object(c.pb)(t.getEasyPattern()))}}},{key:"pasteSteps",value:function(){if(void 0!==this.state.keyboard.stepsToCopy){var e=this.cursor.getStep(this.resolution),t=this.sequencerEngine.tracks[this.cursor.track];if(t){var n=t.getEasyPattern().pasteSteps(this.state.keyboard.stepsToCopy,{stepNumber:e},this.state.keyboard.easyPatternToCopy,this.state.sequencer.displayResolution);t.updateSteps(),this.dispatch(Object(c.rd)(n)),this.dispatch(Object(c.Xd)(e))}}}},{key:"record",value:function(){var e=!this.isRecording;this.dispatch(Object(c.Mb)(e)),this.sequencerEngine.recording(e)}},{key:"getSelectedSteps",value:function(){var e=this.sequencerEngine.store.getState().keyboard.selectedPianoRollSteps;if(!e||0!==e.length)return e}},{key:"deleteSelectedPoints",value:function(){var e=this.state.automation.trackParameter[this.selectedTrack.id];void 0!==e&&this.selectedTrack&&(this.sequencerEngine.operationManager.dispatch(Object(X.o)(this.viewMode===E.a?e.mixAutomation:e.automation,this.pointsSelected)),this.dispatch(Object(c.G)(this.selectedTrack.id,[])))}},{key:"deleteSelectedSteps",value:function(){this.sequencerEngine.store.getState();var e=this.getSelectedSteps();void 0!==e&&(this.sequencerEngine.operationManager.dispatch(Object(X.j)(this.selectedTrack,e)),this.store.dispatch(Object(c.rd)(void 0)))}},{key:"onShiftKeyDown",value:function(){}},{key:"currentScene",get:function(){return this.state.sequencer.currentScene}},{key:"scenes",get:function(){return this.state.sequencer.scenes}},{key:"showingSoundList",get:function(){return this.state.selector.showingSoundList||this.state.packs.packSelected}},{key:"currentSoundInList",get:function(){return this.state.selector.currentSoundInList},set:function(e){this.dispatch(Object(c.gb)(e))}},{key:"currentTagInList",get:function(){return this.state.selector.currentTagInList},set:function(e){this.dispatch(Object(c.ib)(e))}},{key:"onClickRollingMode",value:function(){this.sequencerEngine.resolution=this.state.sequencer.displayResolution,this.dispatch(Object(c.ue)(!this.trackRolling)),this.dispatch(Object(c.Le)(!1)),this.sequencerEngine.rollingManager.clear()}},{key:"onEnterKeyDown",value:function(){this.showingSoundList&&void 0!==this.currentSoundInList||this.cursor.track>=0&&this.cursor.track<this.sequencerEngine.tracks.length&&this.sequencerEngine.getSelectedStep()>=0&&this.onClickStep(this.cursor.track,this.sequencerEngine.getSelectedStep())}},{key:"onClickStep",value:function(e,t){void 0===this.getSelectedSteps()&&(this.sequencerEngine.tracks[e].pattern.clearCache(),this.sequencerEngine.operationManager.dispatch(Object(X.r)(this.sequencerEngine.tracks[e],t,this.resolution)),this.sequencerEngine.select(e,t),this.cursor.track=e)}},{key:"dispatch",value:function(e){this.store.dispatch(e)}},{key:"state",get:function(){return this.store.getState()}},{key:"selectedEffect",get:function(){if(this.state.zobject.selectedZObject&&this.state.zobject.selectedZObject.getObjectType()===_.a&&void 0!==this.state.effects.selectedEffect&&(!this.state.sequencer.showPianoRoll||this.state.arrangement.bottomMode!==ce.b))return this.sequencerEngine.selectedEffect}},{key:"planarSelected",get:function(){return this.state.zobject.selectedZObject&&"Plane Parameters"===this.state.zobject.selectedZObject.name}},{key:"midiMapMode",get:function(){return this.state.midi.midiMapMode}},{key:"viewMode",get:function(){return this.state.sequencer.viewMode}},{key:"alternateViewMode",get:function(){return this.state.sequencer.alternateViewMode}},{key:"showGroups",get:function(){return this.state.sequencer.showGroups}},{key:"pointsSelected",get:function(){var e=this.selectedTrack;return e&&this.state.automation.pointsSelected[e.id]||[]}},{key:"isCompactMode",get:function(){return this.state.sequencer.isCompactMode}},{key:"cursor",get:function(){return this.sequencerEngine.cursor}},{key:"cursorStepData",get:function(){if(this.selectedTrack)return this.selectedTrack.pattern.stepBuckets[this.cursor.step].steps[0]}},{key:"resolution",get:function(){return this.state.sequencer.displayResolution}},{key:"sampleAuditioning",get:function(){return this.state.audition.sampleAuditioning}},{key:"trackRolling",get:function(){return this.state.sequencer.trackRolling}},{key:"isRecording",get:function(){return this.state.sequencer.isRecording}},{key:"selectedTrack",get:function(){return this.sequencerEngine.tracks[this.cursor.track]}},{key:"scripting",get:function(){return this.sequencerEngine.scripting}},{key:"viMode",get:function(){return this.viewMode===E.c&&this.state.commands.viMode}},{key:"trackFocused",get:function(){return this.state.sequencer.trackFocused}},{key:"isPlayingMix",get:function(){return this.state.mix.isPlayingMix}},{key:"onSelectTrack",value:function(e){this.sequencerEngine.cursor.track=e}},{key:"isShowingSoundsPane",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return!!this.state.spatial.showSearchWindow||!this.state.selector.sidebarCollapsed&&(this.state.sequencer.showSelectorMode||this.state.sequencer.sidebarViewMode!==le.a)}},{key:"isShowingPianoRoll",get:function(){return this.showPianoRoll&&this.state.arrangement.bottomMode===ce.b}},{key:"showPianoRoll",get:function(){return this.state.sequencer.showPianoRoll}},{key:"showSamples2D",get:function(){return this.state.selector.showSamples2D}},{key:"selectedFreeze",get:function(){return this.state.freeze.selectedFreeze}},{key:"deleteSelectedFreeze",value:function(){var e,t=this.selectedTrack,n=this.selectedFreeze,r=ve(t.frozenColumns);try{for(r.s();!(e=r.n()).done;){var a=e.value,i=-1;for(var s in a.frozenSamples)a.frozenSamples[s].ipfsHash===n&&(i=parseInt(s));if(!(i<0)){a.frozenSettings.splice(i,1),a.frozenSamples.splice(i,1),a.frozenSamplers[i].gainNode.disconnect(),a.frozenSamplers.splice(i,1),a.updateRedux();break}}}catch(o){r.e(o)}finally{r.f()}t.frozenColumns.every(function(e){return 0===e.frozenSamplers.length})&&t.isFrozen&&t.unfreeze(),this.dispatch(Object(c.md)(void 0))}},{key:"copiedNodesForRack",get:function(){return this.state.effects.copiedNodesForRack}},{key:"trackerParameterToEdit",get:function(){return this.state.mix.trackerParameterToEdit}},{key:"newSlice",value:function(){var e=this.selectedTrack;if(e.getTrackType()===oe.f){var t=e.getSamplers()[0];t.newSlice(),this.dispatch(Object(c.vd)(e.id,t.slices.length-1))}}},{key:"moveSteps",value:function(e,t,n){var r={stepDifference:t,transposeDifference:n},a=e[0].track;this.sequencerEngine.operationManager.dispatch(Object(X.l)(a,e,r,0===t?void 0:this.resolution,!1,!1))}},{key:"duplicateSteps",value:function(){var e=this.selectedTrack,t=this.getSelectedSteps(),n=this.resolution;se(e,t,n)}},{key:"duplicateAllSteps",value:function(){var e=this;this.sequencerEngine.tracks.forEach(function(t){se(t,void 0,e.resolution)})}},{key:"legato",value:function(){var e=this.selectedTrack;if(e){var t=this.getTrackSelectedSteps();t&&0!==t.length||(t=e.getEasyPattern().getAllSteps()),function(e,t){for(var n=e.getEasyPattern().getStepNumbers(t,te),a=e.sequencerEngine.operationManager,i=0;i<n.length;i++){var s=Object(r.a)(n[i],2),o=s[0],c=s[1],u=re(e,c);if(void 0!==u){var l=(u-c)/2;a.dispatch(Object(X.t)(e,o,o.durationParameter,l))}}}(e,t)}}},{key:"getTrackSelectedSteps",value:function(){if(this.selectedTrack){var e=this.getSelectedSteps();return e&&0!==e.length||(e=[this.cursorStepData]),e}}},{key:"rollSteps",value:function(){var e=this.getTrackSelectedSteps();e&&function(e,t){for(var n=e.getEasyPattern(),a=n.getStepNumbers(t,te),i=e.sequencerEngine.state.sequencer.displayResolution.getNumberOfStepsAtBaseResolution(),o=(e.sequencerEngine.operationManager,[]),c=0;c<a.length;c++){var u=Object(r.a)(a[c],2),l=u[0],f=u[1],h=re(e,f);if(void 0!==h)for(var p=f+i;p<h;p+=i)o=[].concat(Object(s.a)(o),Object(s.a)(n.pasteSteps([l],{stepNumber:p},n,te)))}ne(e,[].concat(Object(s.a)(t),Object(s.a)(o))),e.updateSteps()}(this.selectedTrack,e)}},{key:"tripletSteps",value:function(){var e=this.selectedTrack,t=this.getSelectedSteps();e&&t&&0!==t.length&&function(e,t){var n=e.getEasyPattern(),a=e.sequencerEngine.state.sequencer.displayResolution,i=a.getCopy(),s=n.getStepNumbers(t,a);i.isTriplet=!i.isTriplet,e.sequencerEngine.dispatch(Object(c.Yc)(i));var o=e.sequencerEngine.operationManager;o.dispatch(Object(X.j)(e,t));var u,l=$(s);try{for(l.s();!(u=l.n()).done;){var f=u.value,h=Object(r.a)(f,2),p=h[0],d=h[1],v=i.isTriplet?1.5:2/3;o.dispatch(Object(X.c)(e,p,Math.round(d*v),i))}}catch(m){l.e(m)}finally{l.f()}e.sequencerEngine.dispatch(Object(c.Yc)(a)),e.updateSteps(!0,void 0,i.isTriplet)}(e,t)}},{key:"focusSearch",value:function(){var e=Object(R.a)(M.a.mark(function e(){var t;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.viewMode!==E.a&&this.viewMode!==E.b){e.next=4;break}return this.dispatch(Object(c.Fd)(!0)),e.next=4,Object(Z.a)(200);case 4:if((t=this.state.selector.searchInput)&&t.current&&t.current.focus){e.next=7;break}return e.abrupt("return");case 7:t.current.focus();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isEffectsShowing",value:function(){return!this.isShowingPianoRoll&&(this.selectedTrack&&this.selectedTrack.isEffectsShowing())}},{key:"groupSteps",value:function(){var e=this.selectedTrack;if(e){var t=this.getSelectedSteps();if(this.stepsGroupMode&&t&&t.every(function(e){return!e.group}));else if(this.stepsGroupMode||!t||0===t.length||t.every(function(e){return e.group}))return this.toggleStepsGroupMode(),void this.dispatch(Object(c.rd)(void 0));Object(Q.e)(t,e)}}},{key:"stepsGroupMode",get:function(){return this.state.groups.stepsGroupMode}},{key:"toggleStepsGroupMode",value:function(){this.dispatch(Object(c.Zd)(!this.stepsGroupMode)),this.sequencerEngine.updateSteps()}},{key:"sampleExplorerSelected",get:function(){return this.state.selector.sampleExplorerSelected}},{key:"hasHigherOrderSteps",value:function(){var e=this.state.higherOrder.selectedSteps;return e&&e.length>0}},{key:"selectedZObject",get:function(){return this.state.zobject.selectedZObject}},{key:"keyboardContext",get:function(){return this.state.keyboard.keyboardContext}}]),n}(function(e){Object(b.a)(n,e);var t=de(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"onArrowDown",value:function(e){if(e.preventDefault(),this.sampleExplorerSelected)this.state.zobject.selectedZObject?this.selectedTrack.auditionNext():this.sequencerEngine.auditionTrack.auditionNext();else if(this.isShowingSoundsPane(!1)){var t=e.ctrlKey||e.metaKey?10:1;this.showingSoundList?void 0===this.currentSoundInList?this.currentSoundInList=0:this.currentSoundInList+=t:void 0===this.currentTagInList?this.currentTagInList=0:this.currentTagInList+=t}else if(this.viewMode===E.b&&this.currentScene){var n=this.scenes.indexOf(this.currentScene),r=this.scenes[(n+1)%this.scenes.length];this.sequencerEngine.scenes.switchToScene(r)}else if(!this.showSamples2D||!this.isShowingSoundsPane()){if(this.sampleAuditioning)window.dispatchEvent(new Event(pe.a));else{var a=this.getSelectedSteps();a&&a.length>0?this.moveSteps(a,0,e.ctrlKey||e.metaKey?-12:-1):(this.sequencerEngine.tracks.length,this.sequencerEngine.down(),this.onSelectTrack(this.cursor.track))}return!0}}},{key:"onArrowRight",value:function(e,t){if(this.isShowingSoundsPane(!1)){var n=e.ctrlKey||e.metaKey?10:1;this.showingSoundList||(void 0===this.currentTagInList?this.currentTagInList=0:this.currentTagInList+=n)}else if(!this.waveformShowing&&(e.preventDefault(),!this.showSamples2D||!this.isShowingSoundsPane())){if(this.viewMode===E.a)return function(e){var t=G(e.state);if(t){var n=t.subSequence.mix;if(n){var r=n.getNextEvent(t);return r?U(e,r):void 0}}}(this.sequencerEngine);if(this.cursor.track in this.sequencerEngine.tracks){var r=this.getSelectedSteps();r&&r.length>0?this.moveSteps(r,e.ctrlKey||e.metaKey?4:1,0):this.sequencerEngine.right(void 0,t)}}}},{key:"onArrowLeft",value:function(e,t){if(this.isShowingSoundsPane(!1)){var n=e.ctrlKey||e.metaKey?10:1;this.showingSoundList||(void 0===this.currentTagInList?this.currentTagInList=0:this.currentTagInList=Math.max(0,this.currentTagInList-n))}else if(!this.waveformShowing&&(e.preventDefault(),!this.showSamples2D||!this.isShowingSoundsPane())){if(this.viewMode===E.a)return function(e){var t=G(e.state);if(t){var n=t.subSequence.mix;if(n){var r=n.getPreviousEvent(t);return r?U(e,r):void 0}}}(this.sequencerEngine);var r=this.getSelectedSteps();r&&r.length>0?this.moveSteps(r,e.ctrlKey||e.metaKey?-4:-1,0):this.sequencerEngine.left(void 0,t)}}},{key:"onArrowUp",value:function(e){if(e.preventDefault(),this.sampleExplorerSelected)this.state.zobject.selectedZObject?this.selectedTrack.auditionPrevious():this.sequencerEngine.auditionTrack.auditionPrevious();else if(this.isShowingSoundsPane(!1)){var t=e.ctrlKey||e.metaKey?10:1;this.showingSoundList?void 0===this.currentSoundInList?this.currentSoundInList=0:this.currentSoundInList=Math.max(0,this.currentSoundInList-t):void 0===this.currentTagInList?this.currentTagInList=0:this.currentTagInList=Math.max(0,this.currentTagInList-t)}else if(this.viewMode===E.b&&this.currentScene){var n=this.scenes.indexOf(this.currentScene)-1,r=this.scenes[n<0?this.scenes.length-1:n];this.sequencerEngine.scenes.switchToScene(r)}else if(!this.showSamples2D||!this.isShowingSoundsPane()){if(this.sampleAuditioning)window.dispatchEvent(new Event(pe.b));else{var a=this.getSelectedSteps();a&&a.length>0?this.moveSteps(a,0,e.ctrlKey||e.metaKey?12:1):(this.sequencerEngine.up(),this.onSelectTrack(this.cursor.track))}return!0}}}]),n}(function(){return function e(){Object(m.a)(this,e)}}())),ge=n(300),Oe=n.n(ge),ke=function(){var e=Object(a.useState)([]),t=Object(r.a)(e,2);return{ordering:t[0],setOrdering:t[1],sizeRef:Object(a.useRef)({width:250,height:150})}},je=n(1),we=function(e){e.sequencerEngine.dispatch(Object(c.te)(e))},xe=function(e){var t=e.clear,n=e.selected;Object(a.useEffect)(function(){return window.addEventListener("mousedown",r),function(){return window.removeEventListener("mousedown",r)}},[t]);var r=Object(a.useCallback)(function(){n&&t()},[t,n])},Se=function(e){var t=e.ref,n=e.useTop,i=void 0===n||n,s=e.useLeft,o=void 0===s||s,c=Object(a.useState)(void 0),u=Object(r.a)(c,2),l=u[0],f=u[1];return xe({clear:function(){return f(void 0)},selected:l}),{onContextMenu:Object(a.useCallback)(function(e){if(e.preventDefault(),e.stopPropagation(),t){var n=t.current.getBoundingClientRect(),r={x:o?e.clientX-n.left+t.current.scrollLeft:e.clientX,y:i?e.clientY-n.top+t.current.scrollTop:e.clientY};f(r)}else{var a={x:e.clientX,y:e.clientY};f(a)}},[f,i,o,t]),dropdownPos:l,setDropdownPos:f}},Pe=(n(391),n(342)),Ee=(n(1602),0),Te=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.children,n=e.dropdownPos,r=e.setDropdownPos,s=e.className,o=Object(a.useRef)(void 0),c=Object(a.useRef)(!1),u=Object(a.useRef)(0);Object(a.useRef)(++Ee);Object(a.useEffect)(function(){return o.current&&o.current.addEventListener("mousewheel",l),function(){o.current&&o.current.removeEventListener("mousewheel",l)}},[n]);var l=Object(a.useCallback)(function(e){e.stopPropagation()},[]);Object(a.useEffect)(function(){return window.addEventListener("mouseup",f),function(){window.removeEventListener("mouseup",f)}},[r,n]);var f=Object(a.useCallback)(function(){u.current++,1===u.current&&c.current?c.current=!1:r&&(c.current=!1,r(void 0))},[r,n]);return Object(a.useEffect)(function(){n?(u.current=0,c.current=!0):(u.current=0,c.current=!1)},[n]),n?i.a.createElement("div",{onMouseDown:function(e){},ref:o,style:{left:n.x-10,top:n.y-10},onMouseUp:function(e){},onClick:function(){},className:"context-menu "+s},t):(u.current=0,[])}),Ae=function(e){return i.a.createElement("div",Object.assign({className:"menu-item"},e),e.children)},Me=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.name,n=e.children;return i.a.createElement("div",{className:"sub-menu menu-item"},i.a.createElement("div",{className:"sub-menu-name"},t),i.a.createElement("div",{className:"arrow-right"}),i.a.createElement("div",{className:"sub-menu-children"},n))}),Re=0,Ce=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2?arguments[2]:void 0,r=Object(a.useRef)(0);Object(a.useRef)(Re++);return Object(a.useCallback)(function(a){var i=(new Date).getTime(),s=i-r.current;r.current=i,s<=t?e(a):n&&n(a)},[e,n])},Ne=n(279);function qe(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ie(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var _e=function(e,t){var n,r=e.offsetLeft,a=e.offsetTop,i=document.createElement("div"),s=getComputedStyle(e),o=qe(s);try{for(o.s();!(n=o.n()).done;){var c=n.value;i.style[c]=s[c]}}catch(d){o.e(d)}finally{o.f()}var u="INPUT"===e.tagName?e.value.replace(/ /g,"."):e.value,l=u.substr(0,t);i.textContent=l,"TEXTAREA"===e.tagName&&(i.style.height="auto"),"INPUT"===e.tagName&&(i.style.width="auto");var f=document.createElement("span");f.textContent=u.substr(t)||".",i.appendChild(f),document.body.appendChild(i);var h=f.offsetLeft,p=f.offsetTop;return document.body.removeChild(i),{x:r+h,y:a+p}},De=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.library,n=(e.setLibrary,e.input),s=e.possibilities,o=e.setPossibilities,c=e.scrollTop,u=e.choosePossibility,l=e.selectedChoice,f=e.doc,h=(e.effect,Object(a.useRef)());Object(a.useEffect)(function(){return h.current&&h.current.addEventListener("mousewheel",p),function(){h.current&&h.current.removeEventListener("mousewheel",p)}},[s]);var p=function(e){return e.stopPropagation()},d=Object(a.useState)(void 0),v=Object(r.a)(d,2),m=v[0],y=v[1],b=Object(a.useState)(""),g=Object(r.a)(b,2),O=g[0],k=g[1];Object(a.useEffect)(function(){return window.addEventListener("click",j),function(){return window.removeEventListener("click",j)}},[s,o]);var j=Object(a.useCallback)(function(){s.length>0&&o([])},[s,o]);Object(a.useEffect)(function(){n.current&&y(_e(n.current,n.current.selectionStart))},[s]),Object(a.useEffect)(function(){t||k("")},[t,k]);var w={};m&&(w.top=m.y+16-c,w.left=m.x,w.maxHeight=n.current.offsetHeight-w.top);var x=Object(a.useCallback)(function(e){e.stopPropagation(),Object(Ne.a)(t).then(function(e){k(e)})},[t,k]);return t||0!==s.length?i.a.createElement("div",{ref:h,style:w,className:"possibilities"},t&&i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},onMouseUp:function(e){return e.stopPropagation()},className:"library-view"},i.a.createElement("div",{className:"library"},i.a.createElement("div",null,"Library: ",t),i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},onMouseUp:x,className:"see-source-btn"},"See Source")),""!==O&&i.a.createElement("textarea",{className:"see-source"},O)),s.map(function(e,t){return i.a.createElement("div",{key:t,onMouseUp:function(t){t.stopPropagation(),u(e)},onMouseDown:function(e){e.stopPropagation()},className:e===l?"selected option":"option"},i.a.createElement("div",{className:"args"},i.a.createElement("div",{className:"keyword"},e),i.a.createElement("div",{className:"param"},"(",Object.keys(f(e).params).join(", "),")")),i.a.createElement("div",{className:"description"},f(e).description))})):[]}),Fe=n(32),Le=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=(arguments.length>2&&arguments[2],[]),r=[],a=[],i=[];for(var s in e.current)if(e.current[s]){var o=e.current[s].current;if(o)n.push(o.offsetLeft+(t?o.offsetWidth:0)),r.push(o.offsetTop+(t?o.offsetHeight:0)),i.push(o.offsetHeight),a.push(o.offsetWidth)}return{lefts:n,tops:r,widths:a,heights:i}},Be=function(e,t,n,r,a){var i=a.lefts,s=a.tops,o=a.widths,c=a.heights;for(var u in i){var l=o[u],f=c[u],h=i[u]-l,p=s[u]-f;if(e>=h&&e<=h+l&&t>=p&&t<=p+f)return!0}return!1},ze=function(e,t,n,r,a){var i=t.offsetLeft,s=t.offsetTop,o=t.offsetWidth+i,c=t.offsetHeight+s;return a&&void 0!==a[r]&&(i=a[r].x,s=a[r].y,o=t.offsetWidth+a[r].x,c=t.offsetHeight+a[r].y),Je(e,i,s,o,c,n,a)},Je=function(e,t,n,r,a,i,s){if(!e)return!1;var o=t,c=n,u=r,l=a,f={x1:e.offsetLeft,y1:e.offsetTop,x2:e.offsetLeft+e.offsetWidth,y2:e.offsetTop+e.offsetHeight};return s&&void 0!==s[i]&&(f.x1=s[i].x,f.y1=s[i].y,f.x2=s[i].x+e.offsetWidth,f.y2=s[i].y+e.offsetHeight),o<=f.x2&&u>=f.x1&&c<=f.y2&&l>=f.y1};function Ve(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return He(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return He(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ue=function(e){var t=e.element,n=e.skipPlacement,r=e.setWindowScale,i=e.sequencerEngine,o=e.ref,u=e.setSize,l=e.sizeRef,f=e.containerRef,h=e.setCoords,p=e.handleScroll,d=e.elements;Object(a.useEffect)(function(){if(f&&!n){if(t&&void 0!==t.x&&(h({x:t.x,y:t.y}),void 0!==t.width&&r({x:t.width,y:t.height}),m(t.x,t.y,!0)),t&&void 0===t.x&&(i&&i.state.windows.windowPositions[t.id]||v(t)),t&&d.current&&(d.current[t.id]=o),t.needsPlacement){var e=function e(t,n,r,a,i){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};for(var c in o[r]||(o[r]=0),o[r]++,i)if(!(c===r||o[c]>6)){var u=i[c].current;if(u){var l=Object(je.a)({},s);if(l[r]={x:t,y:n},ze(a,u,r,c,l)){var f={x:u.offsetLeft,y:u.offsetTop};s[c]&&(f=s[c]);var h={x:f.x+a.offsetWidth+50,y:f.y};s[c]=h,s=Object(je.a)({},s,e(h.x,h.y,c,u,i,s,o))}}}return s}(t.x,t.y,t.id,o.current,d.current);i.dispatch(Object(c.M)(e))}}else t&&void 0!==t.width&&r&&r({x:t.width,y:t.height})},[]);var v=Object(a.useCallback)(function(e){if(f){var t=Le(function(e){if(!e)return{current:{}};var t=Object(s.a)(i.state.zobject.zobjectsStack);t.reverse();var n,r={},a=Ve(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;r[o.id]=e.current[o.id]}}catch(u){a.e(u)}finally{a.f()}for(var c in e.current)r[c]=e.current[c];return{current:r}}(d)),n=t.tops,r=t.lefts,a=t.widths,c=t.heights;for(var u in n){var l=n[u],p=r[u],v=a[u],y=p+5,b=l-c[u];if(y+o.current.offsetWidth<=f.current.offsetWidth&&!Be(y,b,o.current.offsetWidth,o.current.offsetHeight,t))return h({x:y,y:b}),void m(y,b,!0);if(!Be(y=p-v,b=l+5,o.current.offsetWidth,o.current.offsetHeight,t))return e.id,h({x:y,y:b}),void m(y,b,!0)}}},[]),m=Object(a.useCallback)(function(e,n,r){if(l&&o.current){var a=l.current;if(a){if(e+o.current.offsetWidth>a.width||n+o.current.offsetHeight>a.height){var f={width:Math.max(a.width,e+o.current.offsetWidth),height:Math.max(a.height,n+o.current.offsetHeight)};return l.current=f,void u(f)}if(r)return;var h=function(e){var t=Le(e,!1,!0),n=t.lefts,r=t.tops;return{minLeft:Math.min.apply(Math,Object(s.a)(n)),minTop:Math.min.apply(Math,Object(s.a)(r))}}(d),v=h.minTop,m=h.minLeft,y=function(e){var t=Le(e,!0,!0),n=t.lefts,r=t.tops;return{maxLeft:Math.max.apply(Math,Object(s.a)(n)),maxTop:Math.max.apply(Math,Object(s.a)(r))}}(d),b=y.maxTop,g=y.maxLeft;if(v-=100,m-=100,i&&t.subSequence&&!t.subSequence.getRootSubSequence){var O=i.state.spatial,k=O.edgesSize,j=O.edgesPadding,w={width:g-m,height:b-v};w.width===k.width&&w.height===k.height||i.dispatch(Object(c.rb)(w.width+300,w.height+300)),j.x===m&&j.y===v||i.dispatch(Object(c.qb)(m,v))}if(g<a.width||b<a.height){if(!(g>a.width||b>a.height))return;var x={width:Math.max(a.width,g),height:Math.max(a.height,b)};if(l.current=x,u(x),i)i.state.spatial.mainScrollRef&&p(e,n,l)}}}},[u,d]);return{adjust:m,placeWindow:v}};function Ge(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return We(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return We(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function We(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ke=function(e){var t,n=e.isSimple,i=void 0!==n&&n,o=e.sizeRef,u=e.sequencerEngine,l=e.initialCoords,f=e.expand,h=e.ref,p=e.containerRef,d=e.size,v=e.basicContainerRef,m=e.setSize,y=e.element,b=e.elements,g=(e.isPad,e.ordering),O=e.setOrdering,k=e.windowPosition,j=e.skipPlacement,w=e.dragOnLoad,x=void 0!==w&&w,S=Object(a.useRef)(void 0),P=Object(a.useState)(x),E=Object(r.a)(P,2),T=E[0],A=E[1],M=Object(a.useRef)(void 0),R=Object(a.useRef)(void 0),C=Object(a.useState)({x:10,y:10}),N=Object(r.a)(C,2),q=N[0],I=N[1],_=Object(a.useState)(void 0),D=Object(r.a)(_,2),F=D[0],L=D[1],B=Object(a.useState)({x:0,y:0}),z=Object(r.a)(B,2),J=z[0],V=z[1],H=Object(a.useState)(l),U=Object(r.a)(H,2),G=U[0],W=U[1],K=Object(a.useCallback)(function(e){W(e),u&&e&&y&&(y.presentationMode?u.dispatch(Object(c.Rc)(y.id,e)):u.dispatch(Object(c.Pe)(y.id,e)))},[u,y,W]),Q=function(e){e.sequencerEngine;return{handleScroll:Object(a.useCallback)(function(e,t,n){},[])}}({sequencerEngine:u}).handleScroll,Z=Ue({element:y,skipPlacement:j,setWindowScale:V,sequencerEngine:u,ref:h,setSize:m,size:d,sizeRef:o,containerRef:p,setCoords:K,handleScroll:Q,elements:b}),Y=Z.adjust,X=(Z.placeWindow,Object(a.useCallback)(function(){if(g&&!(g.length>0&&g.indexOf(y)===g.length-1)){var e=g.filter(function(e){return e!==y});e=[].concat(Object(s.a)(e),[y]),O(e)}},[g,O,y])),$=Object(a.useCallback)(function(e,t){var n=e.clientX,r=e.clientY;if(p){var a=p.current.getBoundingClientRect();n=e.clientX-a.left-q.x,r=e.clientY-a.top-q.y;var i=window._scale||1;t||(n/=i,r/=i)}return{x:n,y:r}},[p,q]),ee=function(e){var t=e.ref,n=e.setCoords,r=e.sequencerEngine,i=e.setWindowScale,s=e.windowScale,o=e.adjust,u=e.updateOrdering,l=e.setIsResizing,f=e.getXY,h=Object(a.useRef)({width:0,height:0}),p=Object(a.useRef)({x:0,y:0}),d=Object(a.useCallback)(function(e,t,a,s){var u=t-p.current.x,l=a-p.current.y,f=h.current,d=f.width,v=f.height;"NW"===e?n({x:Math.max(0,t),y:Math.max(0,a)}):"SW"===e?(a=s.y,l*=-1):"NE"===e?(u*=-1,t=s.x):"SE"===e&&(u*=-1,l*=-1,t=void 0,a=void 0);var m=d-u,y=v-l;s.height=y,s.width=m,r&&(r.dispatch(Object(c.Ye)(s.id,{width:m,height:v,newHeight:y})),s.effect&&s.effect.pad&&s.effect.pad.onSizeChange(m,y)),i({x:m,y:y}),o(s.x,s.y),void 0!==t&&void 0!==a&&(t=Math.max(0,t),a=Math.max(0,a),n({x:t,y:a}))},[s,i,n]),v=Object(a.useCallback)(function(e,t){t.stopPropagation(),h.current=m(),p.current=f(t),l(e),u()},[s,l]),m=Object(a.useCallback)(function(){return{width:t.current.offsetWidth,height:t.current.offsetHeight}},[]);return{resizeWindow:d,startResizing:v}}({ref:h,setCoords:K,sequencerEngine:u,setWindowScale:V,windowScale:J,adjust:Y,updateOrdering:X,setIsResizing:L,getXY:$}),te=ee.startResizing,ne=ee.resizeWindow;Object(a.useEffect)(function(){k&&(Y(k.x,k.y),y.x=k.x,y.y=k.y)},[k,m]),Object(a.useEffect)(function(){X()},[]);var re=function(){if(u){var e=u.state.windows.selectedElements;return Object.keys(e)}return[]};Object(a.useEffect)(function(){y&&void 0!==y.x&&setTimeout(function(){Y(y.x,y.y)},50)},[f]),Object(a.useEffect)(function(){return window.addEventListener("mousemove",ce),window.addEventListener("mousedown",ae),window.addEventListener("mouseup",oe),function(){window.removeEventListener("mousemove",ce),window.removeEventListener("mousedown",ae),window.removeEventListener("mouseup",oe)}},[I,K,y,T,q,m,F,T,L,J,V]);var ae=Object(a.useCallback)(function(e){},[]),ie=Object(a.useCallback)(function(e){e.stopPropagation();var t=h.current.getBoundingClientRect();if(R.current={x:e.pageX,y:e.pageY},u){if(S.current=Object(je.a)({},u.state.spatial.editorPadding),u.state.zobject.uxLocked||u.state.spatial.lockedObjects[y.id])return;var n={},r=u.state.spatial.presentationMode,a=u.state.windows.windowPositions,i=u.state.windows.presentationWindowPositions;for(var s in b.current){var o=r&&i[s]||a[s];n[s]=Object(je.a)({},o)}M.current=n}u&&(re().includes(y.id)||u.dispatch(Object(c.sd)({}))),I({x:e.clientX-t.left,y:e.clientY-t.top}),A(!0),X()},[I,A,g,O]),se=Object(a.useCallback)(function(e){e.stopPropagation(),X()},[g,O]),oe=Object(a.useCallback)(function(){(T||F)&&(L(!1),A(!1),I({x:0,y:0}))},[A,L,I,F,T]),ce=Object(a.useCallback)(function(e){if(T||F){var t=$(e),n=t.x,r=t.y;if(u&&S.current){var a=u.state.spatial.editorPadding;n+=a.x-S.current.x,r+=a.y-S.current.y}if(!p&&!F){var i={x:e.pageX-q.x,y:e.pageY-q.y};if(v){var s=v.current.getBoundingClientRect();i.x-=s.left,i.y-=s.top}return y&&y.subSequence&&y.subSequence.getRootSubSequence&&(i.y=Math.max(0,i.y)),void K(i)}if(T){var l=re(),f={x:e.pageX,y:e.pageY};if(n+=p.current.scrollLeft,r+=p.current.scrollTop,l.length>0&&f&&R.current){var h,d=f.x-R.current.x,m=f.y-R.current.y,b={},g=Ge(l);try{for(g.s();!(h=g.n()).done;){var O=h.value;if(O!==y.id){var k=M.current[O],j=window._scale||1;k&&(b[O]={x:k.x+d/j,y:k.y+m/j})}}}catch(w){g.e(w)}finally{g.f()}y.presentationMode?u.dispatch(Object(c.L)(b)):u.dispatch(Object(c.M)(b))}y&&y.subSequence&&y.subSequence.getRootSubSequence&&(n=Math.max(0,n),r=Math.max(0,r)),Y(n,r),K({x:n,y:r}),Q(n,r,o),y.x=n,y.y=r}else F&&ne(F,n,r,y)}},[T,y,I,K,q,m,b,V,J,F]),ue={};if(g&&g.includes(y)){var le=g.indexOf(y);ue.zIndex=10*(1+le)}return i?{isDragging:T,zIndex:ue.zIndex,onContextMenu:se,onMouseDown:ie,onMouseUp:oe,startResizing:te}:(G&&(ue.top=G.y,ue.left=G.x),t={adjust:Y,onContextMenu:se,setWindowScale:V,style:ue,isDragging:T,onMouseDown:ie,windowScale:J,onMouseUp:oe,setCoords:K},Object(Fe.a)(t,"isDragging",T),Object(Fe.a)(t,"startResizing",te),Object(Fe.a)(t,"coords",G),Object(Fe.a)(t,"zIndex",ue.zIndex),t)},Qe=n(233),Ze=n(179),Ye=n(301),Xe=n(129),$e=n(130),et=function(e,t,n){var r=e.sequencerEngine.findNodeById(n.edge.destId),a=e.sequencerEngine.findNodeById(n.edge.sourceId);r&&a&&r.disconnectInlet(n.edge.destType,a,n.edge.sourceType),e.connectInlet(t,a,n.sourceType)},tt=new $e.a,nt=Object(o.b)(function(e,t){var n=t.subSequence||t.effect.subSequence||t.effect.track&&t.effect.track.subSequence;if(n){var r=t.effect.numInlets;return t.effect.effect&&(r+=t.effect.effect.numInlets),{drawingEdge:e.pads.drawingEdges[n.id],numInlets:r,movingEdge:e.pads.movingEdge,compilationError:t.effect.compilationError}}return{}},function(e){return{setZObjectTooltip:function(t,n,r,a,i){return e(Object(c.Ze)(t,n,r,a,i))},setSelectedPadEdge:function(t){return e(Object(c.pd)(t))}}})(function(e){var t=e.doc,n=e.effect,o=e.drawingEdge,c=e.movingEdge,u=e.setZObjectTooltip,l=e.setSelectedPadEdge,f=Object(a.useState)(void 0),h=Object(r.a)(f,2),p=h[0],d=h[1],v=Object(a.useState)(void 0),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useState)(void 0),O=Object(r.a)(g,2),k=O[0],j=O[1],w=Object(a.useCallback)(function(e,t){o&&o.type?(d(void 0),Object(Ye.a)(Object(X.d)(o.node,o.type,t,e))):c&&(d(void 0),et(t,e,c),l(void 0))},[o,c,d]),x=Object(a.useCallback)(function(e,t,n,r){if(e.stopPropagation(),e.metaKey){var a=n.windowPosition,i=n.subSequence.createZMessage(a.x+25*r,a.y-10,Ze.c,void 0,void 0,void 0,!0,!0);i.min=-1,i.max=1,Object(Ye.a)(Object(X.d)(i,"Output",n,t))}},[]);Object(a.useEffect)(function(){if(p){var e=n.zObject?n.zObject.id:n.id,t=n.state.windows.windowPositions[e];if(!t)return;u(n.subSequence.id,{x:t.x+20*p.i,y:t.y-30},p.text,y,k)}else u(void 0)},[p,n,y,k]);var S=Object(a.useCallback)(function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if("instancedSubpatch"!==n.name&&void 0!==r&&t&&t(n.name)&&t(n.name).params){var a=t(n.name),i=Object.keys(t(n.name).params),o=Object.values(t(n.name).params);isNaN(a.inlets)?Array.isArray(a.inlets)&&(i=a.inlets):i.length<a.inlets&&(r-=a.inlets-i.length);var c=n.name+": "+(i[r]||e);o[r]&&""!==o[r]&&(c+=" "+o[r]),n.effect&&n.effect.inletObjects&&n.effect.inletObjects[r]&&""===(c=n.effect.inletObjects[r]._text)&&(c=Object.keys(n.effect.inlets)[r]),d({text:c,i:r})}else d({text:e,i:r});if(t&&t(n.name).inletTypes){var u=Object(Qe.a)(t(n.name),r);if("function"===typeof u)return;b(u);var l=n.lastMessageReceived,f=[l&&l[0]?l[0].type:void 0].concat(Object(s.a)(n.args.map(function(e){return e&&e.type})));f[r]&&j(f[r])}},[d,j]);if(!n.inlets)return"";var P=Object.keys(n.inlets);P.includes("Input")&&(P=["Input"].concat(Object(s.a)(P.filter(function(e){return"Input"!==e}))));var E=[],T=[];n.effect&&n.effect.inlets&&function(){for(var e=Object.keys(n.effect.inlets).filter(function(e){return!P.includes(e)}),t=n.effect,r=[],a=(n.name,function(n){t.inletObjects&&t.inletObjects[n]&&""!==t.inletObjects[n]._text?T[n]=t.inletObjects[n]._text:T[n]=e[n],t.inletObjects&&t.inletObjects[n]&&t.inletObjects[n].isDeleted?T.splice(-1):t.inletObjects&&t.inletObjects[n]&&t.implements&&!t.implements.instanceInlets.find(function(e){return e.inletNumber===t.inletObjects[n].inletNumber})?T.splice(-1):t.inletObjects&&t.inletObjects[n]&&t.hasInstances&&t.instanceInlets.includes(t.inletObjects[n])?T.splice(-1):(t.implements&&t.implements.inletObjects&&t.implements.inletObjects[n]&&""!==t.implements.inletObjects[n]._text&&(T[n]=t.implements.inletObjects[n]._text),r.push(e[n]))}),i=0;i<e.length;i++)a(i);E=r}(),T=T.filter(function(e){return e}),n.isOutlet&&(P=P.slice(0,1));var A=function(e){return o&&o.type===e?{backgroundColor:tt.getColorForHash(e)}:{}},M=Object(a.useCallback)(function(e,r,a){var i=e.isInletConnected(r)?"inlet connected":"inlet";if(!t||!t(n.name))return i;var s=Object(Qe.a)(t(n.name),a);return s?(Array.isArray(s)||(s=[s]),i+=" "+s.filter(function(e){return e&&e.replaceAll}).map(function(e){return e.replaceAll(" ","-")}).join(" "),e.compilationError&&e.compilationError.inlet===a&&(i+=" error-inlet"),i):i},[n.compilationError]);return i.a.createElement("div",{className:"inlets"},P.map(function(e,t){return i.a.createElement("div",{onMouseDown:function(r){return x(r,e,n,t)},key:e,onMouseLeave:function(){return d(void 0)},onMouseOver:function(){return S(e,t)},style:A(e),onMouseUp:function(){return w(e,n)},id:n.getFullType(e),className:M(n,e,t)})}),E.map(function(e,t){return i.a.createElement("div",{key:e,onMouseLeave:function(){return d(void 0)},style:A(e),onMouseOver:function(){return S(T[t],t+P.length)},onMouseUp:function(){return w(e,n.effect)},onMouseDown:function(r){return x(r,e,n.effect,t+P.length)},id:n.effect.getFullType(e),className:M(n.effect,e,t+P.length)})}))}),rt=function(e){var t=e.containerRef;return{getXY:Object(a.useCallback)(function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];window._scale;if(!t||!t.current)return{x:0,y:0};var r=t.current.getBoundingClientRect(),a=n?t.current.scrollLeft:0,i=n?t.current.scrollTop:0;return{x:e.clientX-r.left+a,y:e.clientY-r.top+i}},[])}},at=(n(1603),new $e.a),it=Object(o.b)(function(e,t){var n=t.effect.subSequence||t.effect.track&&t.effect.track.subSequence;return t.effect.effect?{numOutlets:t.effect.numOutlets+t.effect.effect.numOutlets,drawingEdge:n&&e.pads.drawingEdges[n.id]}:{numOutlets:t.effect.numOutlets,movingEdge:e.pads.movingEdge,drawingEdge:n&&e.pads.drawingEdges[n.id]}},function(e){return{setDrawingPadEdge:function(t,n){return e(Object(c.nb)(t,n))},setZObjectTooltip:function(t,n,r,a,i){return e(Object(c.Ze)(t,n,r,a,i))}}})(function(e){var t=e.doc,n=e.subSequence,s=e.drawingEdge,o=e.setDrawingPadEdge,c=e.effect,u=e.containerRef,l=e.setZObjectTooltip,f=e.scale,h=Object(a.useState)(void 0),p=Object(r.a)(h,2),d=p[0],v=p[1],m=Object(a.useState)(void 0),y=Object(r.a)(m,2),b=y[0],g=y[1],O=Object(a.useState)(void 0),k=Object(r.a)(O,2),j=k[0],w=k[1];rt({containerRef:u,scale:f}).getXY;Object(a.useEffect)(function(){if(d){var e=c.zObject?c.zObject.id:c.id,t=c.state.windows.windowPositions[e],n=c.zObject?c.zObject.height||25:c.height||25;if(!t)return;l(c.subSequence.id,{x:t.x+20*d.i,y:t.y+n+10},d.text,b,j)}else l(void 0)},[d,c,b,j]);var x=Object(a.useCallback)(function(e,t){var r=n.state.pads.movingEdge;r&&(v(void 0),function(e,t,n){var r=e.sequencerEngine.findNodeById(n.edge.destId),a=e.sequencerEngine.findNodeById(n.edge.sourceId);console.log("move edge outlet outletType=",t,a,r),r&&a&&r.disconnectInlet(n.edge.destType,a,n.edge.sourceType),r.connectInlet(n.edge.destType,e,t)}(t,e,r))},[]),S=Object(a.useCallback)(function(e,n){if(v({text:c.name?c.name+": "+e:e,i:n}),t){var r=c.effect&&c.effect.outlets[e]&&c.effect.outlets[e].type?c.effect.outlets[e].type:Object(Qe.b)(t(c.name),n);g(r),c.outputtedTypes&&w(c.outputtedTypes[n])}},[v,g,w]),P=Object(a.useCallback)(function(e,t,r,a){e.stopPropagation(),a.getFullType(t);var i={x:e.clientX,y:e.clientY},s=n||a.subSequence||a.track&&a.track.subSequence;s.state.spatial.edgesPadding,o(s.id,Object(je.a)({},i,{effect:a,type:t,outputNumber:r,node:a,x1:i.x*(window._scale||1),y1:i.y*(window._scale||1),x2:i.x*(window._scale||1),y2:i.y*(window._scale||1)}))},[n]);if(!c.outlets)return"";var E=Object.keys(c.outlets),T=[],A=[];if(c.effect&&c.effect.inlets&&(!c.effect.hasInstances||c.effect.showAllOutlets)){var M=Object.keys(c.effect.outlets).filter(function(e){return!E.includes(e)});T=M;for(var R=c.effect,C=0;C<M.length;C++)R.outletObjects&&R.outletObjects[C]&&""!==R.outletObjects[C]._text?A[C]=R.outletObjects[C]._text:A[C]=M[C]}var N=function(e){return s&&s.type===e?{backgroundColor:at.getColorForHash(e)}:{}},q=function(e,n,r){var a=e.isOutletConnected(n)?"outlet connected":"outlet";if(!t||!t(c.name))return a;var i=Object(Qe.b)(t(c.name),r);return i?(Array.isArray(i)||(i=[i]),a+=" "+i.map(function(e){return e.replaceAll(" ","-")}).join(" ")):a};return i.a.createElement("div",{className:"outlets"},E.map(function(e,t){return i.a.createElement("div",{key:e,onMouseLeave:function(){return v(void 0)},style:N(e),onMouseOver:function(){return S(e,t)},onMouseDown:function(n){return P(n,e,t,c)},onMouseUp:function(){return x(e,c)},id:c.getFullType(e),className:q(c,e,t)})}),T.map(function(e,t){return i.a.createElement("div",{key:e,onMouseLeave:function(){return v(void 0)},onMouseOver:function(){return S(A[t],E.length+t)},onMouseUp:function(){return x(e,c.effect)},style:N(e),onMouseDown:function(n){return P(n,e,t,c.effect)},id:c.effect.getFullType(e),className:q(c.effect,e,t)})}))}),st=function(e){var t=e.ref,n=e.code,i=e.onChange,s=e.doc,o=e.skipMouse,c=void 0!==o&&o,u=e.timeout,l=void 0===u?250:u,f=e.disable,h=Object(a.useState)([]),p=Object(r.a)(h,2),d=p[0],v=p[1],m=Object(a.useState)(void 0),y=Object(r.a)(m,2),b=y[0],g=y[1],O=Object(a.useState)(void 0),k=Object(r.a)(O,2),j=k[0],w=k[1],x=Object(a.useState)(void 0),S=Object(r.a)(x,2),P=S[0],E=S[1],T=Object(a.useRef)(0);Object(a.useEffect)(function(){if(!f&&t&&t.current)return t.current.addEventListener("keydown",A),t.current.addEventListener("keyup",N),c||t.current.addEventListener("mouseup",N),function(){t.current&&(t.current.removeEventListener("keydown",A),t.current.removeEventListener("keyup",N),c||t.current.removeEventListener("mouseup",N))}},[n,b,d,j,w,g,f]);var A=Object(a.useCallback)(function(e){return"Tab"!==e.key||(e.preventDefault(),e.stopPropagation(),j&&q(j),!1)},[n,i,d,v,d,j,w]),C=Object(a.useCallback)(function(e){var t=1;for(e-=2;e>=0&&t>0;e--)")"===n.charAt(e)?t++:"("===n.charAt(e)&&t--;if(e>0){var r=ft(e,n),a=r.x,i=r.y;E({x:a,y:i}),setTimeout(function(){E(void 0)},1e3)}},[E,n]),N=Object(a.useCallback)(function(){var e=Object(R.a)(M.a.mark(function e(r){var a,i,o,c,u,h;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.current){e.next=2;break}return e.abrupt("return");case 2:if(!f){e.next=4;break}return e.abrupt("return");case 4:return T.current++,a=T.current,e.next=8,Object(Z.a)(l);case 8:if(a===T.current){e.next=10;break}return e.abrupt("return");case 10:if("Tab"!==r.key){e.next=12;break}return e.abrupt("return",!1);case 12:if(i=t.current.selectionStart,")"===r.key&&C(i),o=n.replaceAll("("," ").replaceAll(")"," "),""===(c=lt(o,i))&&(c=lt(o,i-1)),""!==c.trim()){e.next=21;break}return d.length>0&&v([]),b&&g(void 0),e.abrupt("return");case 21:if("load"!==c&&"library"!==c){e.next=26;break}if(""===(u=ut(o,i))){e.next=26;break}return g(u),e.abrupt("return");case 26:if(1!==(h=s().filter(function(e){return e.startsWith(c)})).length||h[0]!==c.trim()){e.next=30;break}return h.length>0&&v([]),e.abrupt("return");case 30:v(h),w(h.find(function(e){return e===c})||h[0]);case 32:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[n,b,d,v,w,g,f]),q=Object(a.useCallback)(function(e){var r=ot(n,t.current.selectionStart),a=ct(n,t.current.selectionStart),s=n.substring(0,0===r?0:r+1),o=n.substring(a);i({target:{value:s+e+o}}),setTimeout(function(){var n=s.length+e.length;t.current&&(t.current.focus(),t.current.setSelectionRange(n,n),v([]),g(void 0))},50)},[n,i,g,v]);return{choosePossibility:q,library:b,possibilities:d,setPossibilities:v,setLibrary:g,selectedChoice:j,matchingParenthesis:P}},ot=function(e,t){for(t--;t>0&&" "!==e.charAt(t)&&"\n"!==e.charAt(t)&&","!==e.charAt(t)&&")"!==e.charAt(t)&&"("!==e.charAt(t);)t--;return t},ct=function(e,t){for(t--;t<e.length&&" "!==e.charAt(t)&&"\n"!==e.charAt(t)&&","!==e.charAt(t)&&")"!==e.charAt(t)&&"("!==e.charAt(t);)t++;return t},ut=function(e,t){for(var n="",r=!1,a=t;a<e.length;a++)if('"'!==e.charAt(a))r&&(n+=e.charAt(a));else{if(r)return n;r=!0}return n},lt=function(e,t){e=String(e),t=Number(t)>>>0;var n=e.slice(0,t+1).search(/\S+$/),r=e.slice(t).search(/\s/);return r<0?e.slice(n):e.slice(n,r+t)},ft=function(e,t){e++;var n=(t=t.slice(0,e+1)).split("\n"),r=n.length-1;return{x:9*(e-n.slice(0,n.length-1).reduce(function(e,t){return e+t.length+1},0)),y:22*r}},ht=(n(1604),Object(o.b)(function(e,t){return{isLooping:t.track.isLooping,loopStart:t.track.loopStart,loopLength:t.track.loopLength,start:t.track.lastTriggeredStart||0}},function(e){return{}})(function(e){var t=e.track,n=e.start,r=(e.isLooping,e.force),a=e.onDrag;if(!t.isLooping&&!r)return"";var s={},o={width:n+"%",left:0};if(t.isLooping&&t.isWarped()){var c=t.midiEffects.effects.find(function(e){return"Warp"===e.name}),u=c.getStartTimeLoop(t.loopStart,0);s={left:u+"%",width:c.getStartTimeLoop(t.loopStart+t.loopLength,0)-u+"%"},o={left:n+"%",width:"5px"}}return i.a.createElement("div",{className:"track-loop-info"},t.isLooping&&i.a.createElement("div",{onMouseDown:function(e){return a?a(e):0},style:s,className:"inner-loop"}),i.a.createElement("div",{style:o,className:"inner-start"}))})),pt=Object(o.b)(function(e,t){return{}},function(e){return{setParametersToRecord:function(t){return e(Object(c.Ec)(t))},setStepParameterSelected:function(t){return e(Object(c.Yd)(t))}}})(function(e){var t=e.name,n=e.min,s=e.max,o=e.setValue,c=e.value,u=e.track,l=e.parameters,f=e.rounded,h=void 0!==f&&f,p=e.isSelected,d=Object(a.useRef)(void 0),v=Object(a.useState)(!1),m=Object(r.a)(v,2),y=(m[0],m[1]),b=Object(a.useState)(!1),g=Object(r.a)(b,2),O=g[0],k=g[1];Object(a.useEffect)(function(){return window.addEventListener("mouseup",w),window.addEventListener("mousemove",j),function(){window.removeEventListener("mouseup",w),window.removeEventListener("mousemove",j)}},[l,k,O,o,p]);var j=Object(a.useCallback)(function(e){if(O){var t=O.y,r=O.number,a=t-e.pageY,i=Math.pow(a/t,2);a<0&&(i*=-1);var c=i*(s-(n+.001))+r;c=Math.max(n,Math.min(s,c)),h&&(c=Math.round(c)),o(c)}},[l,k,O,o,u]),w=Object(a.useCallback)(function(e){O&&k(!1)},[k,O]),x="param-value ";return p&&(x+=" selected"),i.a.createElement("div",{onMouseDown:function(e){k({number:c,y:e.pageY})},onMouseOver:function(){return y(!0)},onMouseLeave:function(){return y(!1)},className:x},i.a.createElement("div",{ref:d,className:"param-name"},t),i.a.createElement("div",{className:"param-value-number"},c))}),dt=n(172),vt=n.n(dt),mt=10;function yt(e){function t(e){var t=e.getName();return void 0===t?"":t.length>=mt?t.slice(0,mt)+"...":t}function n(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.track;if(n)return{value:n,label:n.trackNumber+1+". "+t(n)}}var r=e.className?e.className+" tracks-dropdown-container":"tracks-dropdown-container";return i.a.createElement("div",{className:r},i.a.createElement(vt.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:function(){var t=e.sequencerEngine.tracks.filter(function(t){return void 0===e.trackToSkip||t!==e.trackToSkip}).map(n);return[{label:"None",value:null}].concat(Object(s.a)(t))}(),onChange:function(t){return e.onSelectTrack(t.value)},value:n(),placeholder:"Track"}))}n(1605);var bt=Object(o.b)(function(e,t){return{trackStep:t.loopUI.sequencerEngine.trackStep}},function(e){return{}})(function(e){var t=e.loopUI,n=e.trackStep,o=Object(a.useState)(t.track),c=Object(r.a)(o,2),u=c[0],l=c[1],f=Object(a.useState)(t.presets.indexOf(t.currentPreset)),h=Object(r.a)(f,2),p=h[0],d=h[1],v=Object(a.useState)(t.presets),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useRef)(),O=Object(a.useState)(t.loopLength||4),k=Object(r.a)(O,2),j=k[0],w=k[1],x=Object(a.useState)(t.loopStart),S=Object(r.a)(x,2),P=S[0],E=S[1],T=Object(a.useState)(u&&u.isLooping),A=Object(r.a)(T,2),M=A[0],R=A[1],C=Object(a.useState)(void 0),N=Object(r.a)(C,2),q=N[0],I=N[1],_=Object(a.useState)(128),D=Object(r.a)(_,2),F=D[0],L=D[1];Object(a.useEffect)(function(){if(u){var e=6400/u.midiEffects.effects.find(function(e){return"Warp"===e.name}).getSliceLoopLength(0,0);L(e)}},[u]);var B=Object(a.useCallback)(function(){t.onLoop(!M),R(!M)},[M]);Object(a.useEffect)(function(){t.track=u},[u]);var z=Object(a.useCallback)(function(e){var t=g.current.getBoundingClientRect(),n=e.clientX-t.left;I({x:n,loopStart:u.loopStart})},[I]),J=Object(a.useCallback)(function(){var e=P%32,n=P-e;t.loopStart=n,E(n),(n=j-(e=j%8))<=0&&(n=j+(8-e)),t.loopLength=n,w(n)},[P,E,w,j]),V=Object(a.useCallback)(function(){E(P+=32),t.loopStart=P},[P,E]),H=Object(a.useCallback)(function(){E(P-=32),t.loopStart=P},[P,E]),U=Object(a.useCallback)(function(e){if(void 0!==q){var n=g.current.getBoundingClientRect(),r=(e.clientX-n.left-q.x)/g.current.offsetWidth,a=6400/u.midiEffects.effects.find(function(e){return"Warp"===e.name}).getSliceLoopLength(0,0),i=Math.round(r*a+q.loopStart);t.loopStart=i,E(i)}},[q,u,E]),G=Object(a.useCallback)(function(e){t.onPreset(e),d(e),E(t.currentPreset.loopStart),w(t.currentPreset.loopLength)},[d,E,w]);Object(a.useEffect)(function(){t.loopStart=P,t.loopLength=j},[P,j]);var W=n;M&&(W=n%(j||8),W+=P);return i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},onMouseMove:U,onMouseLeave:function(){return I(void 0)},onMouseUp:function(){return I(void 0)},ref:g,className:"loop-ui"},i.a.createElement(yt,{sequencerEngine:t.sequencerEngine,track:u,onSelectTrack:l}),i.a.createElement("div",{onClick:B,className:M?"loop-btn looping":"loop-btn"},i.a.createElement("div",{className:"zloop-icon"})),u&&i.a.createElement(ht,{onDrag:z,loopStart:P,loopLength:j,track:u}),i.a.createElement("div",{className:"step-and-quantize"},i.a.createElement("div",{className:"current-step"},i.a.createElement("div",{className:"current-label"},"Current Step"),i.a.createElement("div",{className:"step-value"},W||0)),i.a.createElement("div",{className:"quantize-fields"},i.a.createElement("div",{onClick:H,className:"prev"}),i.a.createElement("div",{onClick:J,className:"quantize-b pushable"},"quantize"),i.a.createElement("div",{onClick:V,className:"next"}))),i.a.createElement("div",{className:"parameters"},i.a.createElement(pt,{name:"Loop Start",value:P,setValue:E,min:0,max:F,rounded:!0}),i.a.createElement(pt,{name:"Loop Length",value:j,setValue:w,min:1,max:F,rounded:!0})),i.a.createElement("div",{className:"loop-presets"},y.map(function(e,t){return i.a.createElement("div",{onClick:function(){return G(t)},className:p===t?"current preset":"preset"},t+1)}),i.a.createElement("div",{onClick:function(){t.newPreset(),b(Object(s.a)(t.presets))},className:"new-preset"},"+")))}),gt=(n(1606),Object(o.b)(function(e,t){return{_presets:t.zobject.effect.presets}},function(e){return{}})(function(e){var t=e._presets,n=e.zobject,o=Object(a.useState)(t),c=Object(r.a)(o,2),u=c[0],l=c[1],f=Object(a.useState)(void 0),h=Object(r.a)(f,2),p=h[0],d=h[1],v=Object(a.useState)(),m=Object(r.a)(v,2),y=m[0],b=m[1];Object(a.useEffect)(function(){l(t)},[l,t]);var g=Object(a.useCallback)(function(e,r){r.stopPropagation();var a=Object(s.a)(t),i=a[e];a[e]=a[y],a[y]=i,n.effect.presets=a,l(a),d(e)},[l,t,y,b,d]);return i.a.createElement("div",{onMouseLeave:function(){return b(void 0)},className:"z-preset"},u.map(function(e,t){return i.a.createElement("div",{onDrop:function(e){return g(t,e)},draggable:!0,onDragOver:function(e){return e.preventDefault()},onDragStart:function(){return b(t)},onClick:function(){t===p?(d(void 0),n.effect.current=void 0):(n.effect.loadPreset(t),d(t))},className:e?t===p?"z-preset-option selected":"z-preset-option":"z-preset-option empty"},e?t+1:"")}))})),Ot=(n(1607),Object(o.b)(function(e,t){return{fxPreset:t.zobject.effect.fxPreset}},function(e){return{}})(function(e){e.zobject,e.fxPreset;return i.a.createElement("div",{className:"spore-editor"})})),kt=function(e){Object(a.useEffect)(function(){return e.current&&e.current.addEventListener("mousewheel",t),function(){e.current&&e.current.removeEventListener("mousewheel",t)}},[]);var t=function(e){return e.stopPropagation()}},jt=n(921),wt=(n(1608),Object.keys(jt.a)),xt=Object(o.b)(function(e,t){return{_scale:t.zscale._scale}},function(e){return{}})(function(e){var t=e._scale,n=e.zscale,s=Object(a.useRef)(),o=Object(a.useState)(t),c=Object(r.a)(o,2),u=c[0],l=c[1],f=Object(a.useState)([]),h=Object(r.a)(f,2),p=h[0],d=h[1];kt(s);var v=Object(a.useCallback)(function(e){n._scale=e,n.bang(),d([]),l(e)},[l,d]);Object(a.useEffect)(function(){t&&l(t)},[t,l]);var m=Object(a.useCallback)(function(e){var t=e.target.value;l(t),t=t.toLowerCase();var n=wt.filter(function(e){return e.toLowerCase().includes(t)});d(n)},[l,d]);return i.a.createElement("div",{ref:s,className:"z-scale"},i.a.createElement("div",{className:"label"},"scale: "),i.a.createElement("input",{className:"scale-input",value:u,onChange:m,type:"text"}),p.length>0&&i.a.createElement("div",{className:"auto-complete"},p.map(function(e){return i.a.createElement("div",{onClick:function(){return v(e)},className:"possibility"},e)})))}),St=function(e){return Math.round(1e3*e)/1e3},Pt=Object(o.b)(function(e,t){return{isUniform:t.znumber.attributes["glsl uniform"],uxLocked:e.zobject.uxLocked,round:t.znumber.round,number:t.znumber._text}},function(e){return{setSelectedZObject:function(t){return e(Object(c.wd)(t))}}})(function(e){var t=e.znumber,n=e.unit,s=void 0===n?"":n,o=e.number,c=e.uxLocked,u=e.skipSelect,l=void 0!==u&&u,f=e.isSelectedZObject,h=e.setSelectedZObject,p=e.color,d=e.onChange,v=e.hideNumber,m=e.isUniform,y=Object(a.useRef)(void 0),b=Object(a.useState)(o),g=Object(r.a)(b,2),O=g[0],k=g[1],j=Object(a.useState)(!1),w=Object(r.a)(j,2),x=w[0],S=w[1];Object(a.useEffect)(function(){return window.addEventListener("mouseup",E),window.addEventListener("mousemove",P),function(){window.removeEventListener("mouseup",E),window.removeEventListener("mousemove",P)}},[S,x,k]),Object(a.useEffect)(function(){k(o)},[o,k]);var P=Object(a.useCallback)(function(e){if(x){var n=x.y,r=x.number,a=(n-e.pageY)/n*(t.max-t.min)+r;a=Math.max(t.min,Math.min(t.max,a)),t.round&&(a=Math.round(a)),a!==t._text&&(t.text=a,t.execute&&t.execute(),k(a),d&&d(a))}},[S,x,k,d]),E=Object(a.useCallback)(function(e){x&&S(!1)},[S,x]);return i.a.createElement("div",{style:{color:p},ref:y,onMouseDown:function(e){c&&S({number:o,y:e.pageY}),t.execute&&!l&&h(t)},className:m?"z-number is-uniform":"z-number"},i.a.createElement("div",{style:{borderLeftColor:t.attributes["secondary-color"]},onMouseDown:function(e){e.stopPropagation(),S({number:o,y:e.pageY}),t.execute&&!l&&h(t)},className:f?"selected arrow-right":"arrow-right"}),v?"":St(O)," ",s)}),Et=n(156),Tt=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.error;t=t.text;for(var n=[],r=Et.i.map(function(e){return t.indexOf(e)}).filter(function(e){return e>-1}),a=function(){var e=Math.min.apply(Math,Object(s.a)(r)),a=t.slice(0,e);n.push({type:"regular",text:a});var i=t.slice(e),o=Et.i.find(function(e){return i.startsWith(e)});if(!o)return"break";n.push({type:"type",text:o}),t=i.slice(o.length),r=Et.i.map(function(e){return t.indexOf(e)}).filter(function(e){return e>-1})};r.length>0&&"break"!==a(););return n.push({type:"regular",text:t}),i.a.createElement("div",{className:"compilation-error-message"},i.a.createElement("span",{className:"error-label"},"Type Mismatch: "),n.map(function(e){return i.a.createElement("span",{className:"type"===e.type?"type":""},e.text)}))}),At=Object(o.b)(function(e,t){return{compilationError:t.object.compilationError,drawingEdge:t.object&&t.object.subSequence&&e.pads.drawingEdges[t.object.subSequence.id],movingEdge:e.pads.movingEdge}},function(e){return{setZObjectTooltip:function(t,n,r,a,i){return e(Object(c.Ze)(t,n,r,a,i))},setSelectedPadEdge:function(t){return e(Object(c.pd)(t))}}})(function(e){var t=e.children,n=e.object,r=e.zobject,s=void 0===r?{object:n}:r,o=e.compilationError,c=e.inlet,u=e.movingEdge,l=e.drawingEdge,f=e.setZObjectTooltip,h=e.setSelectedPadEdge,p=Object(a.useRef)(),d=Object(a.useCallback)(function(){l&&l.type?Object(Ye.a)(Object(X.d)(l.node,l.type,n,c)):u&&(et(n,c,u),h(void 0))},[n,c,l,u]),v=Object(a.useCallback)(function(e){f(void 0)},[]),m=Object(a.useCallback)(function(e){if(s&&s.windowPosition){var t=s.windowPosition,r=t.x+p.current.offsetLeft+15,a=t.y+p.current.offsetTop,i=n.inlets[c].type;i.or&&(i=i.or),f(s.subSequence.id,{x:r,y:a},c,i)}},[]),y="inlet-field ",b=!1;return o&&o.inlet===c&&(y+=" compilation-error",b=!0),i.a.createElement("div",{ref:p,className:y},i.a.createElement("div",{onMouseOver:m,onMouseLeave:v,className:n.isInletConnected(c)?"inlet connected":"inlet",id:n.getFullType(c),onMouseUp:d}),t,b&&i.a.createElement(Tt,{error:o}))}),Mt=n(565),Rt=function(e){var t=e.object,n=e.name,s=e.setter,o=e.color,c=e.editing,u=e.setEditing,l=e.zobject,f=Object(a.useState)(o),h=Object(r.a)(f,2),p=h[0],d=h[1],v=Object(a.useCallback)(function(e){s(e.hex),d(e.hex)},[d,s]);return i.a.createElement(At,{zobject:l,object:t,inlet:n},i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},className:"sdf-field color-field"},i.a.createElement("div",{className:"field-name"},n),i.a.createElement("div",{onClick:function(){return u(!c)},style:{backgroundColor:p},className:"color-btn"},o?"":"GL"),c&&i.a.createElement(Mt.a,{onChange:v,color:{hex:p}})))},Ct=function(e){var t=e.layer,n=e.name,r=e.number,a=e.zobject;return i.a.createElement(At,{object:t,inlet:n,zobject:a},i.a.createElement("div",{className:"sdf-field"},i.a.createElement("div",{className:"field-name"},n),t.glNumbers?t.glNumbers[n]?i.a.createElement("div",{className:"is-gl"},"GL"):r&&i.a.createElement(Pt,{onChange:function(e){return t.updateNumber(n,e)},znumber:r}):""))},Nt=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.layer,n=e.number,s=e.deleteLayer,o=e.sdfLayers,c=e.setLayers,u=e.stopDragging,l=e.startDragging,f=e.dragging,h=e.setColorEditing,p=e.colorEditing,d=Object(a.useState)(),v=Object(r.a)(d,2),m=v[0],y=v[1],b=Object(a.useState)(t.name||""),g=Object(r.a)(b,2),O=g[0],k=g[1],j=Object(a.useCallback)(function(){if(f)if(f!==t){var e=t.zObject.effect,n=f.zObject.effect;n.layers=n.layers.filter(function(e){return e!==f});var r=e.layers.indexOf(t);f.zObject=t.zObject,e.layers.splice(r,0,f),c(o.layers),o.compile(),u()}else u()},[f,u,c,t]),w=Object(a.useCallback)(function(){y(!0)},[y]),x=Object(a.useCallback)(function(e){"Enter"===e.key&&(t.name=O,y(!1))},[y,O]),S=Ce(w);return i.a.createElement("div",{onDrop:j,className:p?"layer editing":"layer"},m?i.a.createElement("input",{onKeyDown:x,value:O,onChange:function(e){return k(e.target.value)}}):i.a.createElement("div",{draggable:!0,onDragOver:function(e){return e.preventDefault()},onClick:S,onMouseDown:function(e){return e.stopPropagation()},onDragStart:l,className:"layer-name"},t.name||"Layer "+n,i.a.createElement("div",{onClick:s,className:"delete-layer"},"x")),i.a.createElement("div",{className:"fields"},i.a.createElement(Ct,{zobject:o.zObject,layer:t,name:"SDF"}),i.a.createElement(Rt,{zobject:o.zObject,editing:p,setEditing:h,object:t,name:"color",setter:function(e){return t.setUXBackground(e)},color:t.background?void 0:t.uxColorHex}),i.a.createElement(Ct,{zobject:o.zObject,layer:t,name:"blur",number:t.numbers.blur}),i.a.createElement(Ct,{zobject:o.zObject,layer:t,name:"value",number:t.numbers.value})))}),qt=(n(1713),Object(o.b)(function(e,t){return{_layers:t.sdfLayers.layers,dragging:e.zobject.layerDragging}},function(e,t){return{setDragging:function(t){return e(Object(c.Yb)(t))}}})(function(e){var t=e.sdfLayers,n=e._layers,o=e.dragging,c=e.setDragging,u=Object(a.useState)(t.layers),l=Object(r.a)(u,2),f=l[0],h=l[1],p=Object(a.useState)(void 0),d=Object(r.a)(p,2),v=d[0],m=d[1],y=Object(a.useCallback)(function(){t.newLayer(),h(Object(s.a)(t.layers))},[h]),b=Object(a.useCallback)(function(e){t.layers=t.layers.filter(function(t){return t!==e}),t.compile(),h(t.layers)},[h]);return Object(a.useEffect)(function(){h(n)},[n,h]),f?i.a.createElement("div",{className:"sdf-layers"},t&&i.a.createElement(Ct,{name:"enable",layer:t}),i.a.createElement(Rt,{setEditing:function(e){return m(e?t:void 0)},editing:v===t,object:t,name:"color",color:t.background?void 0:t.uxColorHex,setter:function(e){return t.setUXBackground(e)}}),f.map(function(e,n){return i.a.createElement(Nt,{deleteLayer:function(){return b(e)},sdfLayers:t,setColorEditing:function(t){return m(t?e:void 0)},colorEditing:v===e,setLayers:h,stopDragging:function(){return c(void 0)},dragging:o,startDragging:function(){return c(e)},key:e.id,number:n+1,layer:e})}),i.a.createElement("div",{onClick:y,className:"new-layer pushable"},"+")):""})),It=n(839),_t=(n(1714),Object(o.b)(function(e,t){return{_snapshots:t.snapshots.snapshots,len:t.snapshots.snapshots.length}},function(e){return{}})(function(e){var t=e.snapshots,n=e._snapshots,r=void 0===n?[]:n;return i.a.createElement("div",{className:"snapshots"},i.a.createElement("div",{onClick:function(){return t.takeSnapshot()},className:"pushable take-snapshot"},"Take Snapshot"),r.map(function(e,n){return i.a.createElement("div",{onClick:function(){return t.useSnapshot(e)},className:"snapshot-option pushable"},n+1)}),i.a.createElement("div",{onClick:function(){return t.snapshots.splice(-1)},className:"btn-x"},"x"))})),Dt=Object(o.b)(function(e,t){return{url:t.zobject.effect.url}},function(e){return{}})(function(e){var t=e.url;return i.a.createElement("img",{className:"z-icon-image",src:window.isNFT?t:"/"+t})}),Ft=n(63),Lt=n(176),Bt=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.cell,n="";switch(t.type||t){case Ft.b:n=i.a.createElement("div",{className:"symbol dot"});break;case Ft.a:n=i.a.createElement("div",{className:"symbol dash"});break;case!1:break;default:var r=t.type||t;n=i.a.createElement("div",{className:"symbol "+r.toLowerCase()})}return n}),zt=(n(1715),function(e){var t=e.probabilities,n=e.mouseDown,s=e.setMouseDown,o=e.type,c=e.jtypes,u=e.height,l=void 0===u?80:u,f=Object(a.useState)(c.probabilities[o]||0),h=Object(r.a)(f,2),p=h[0],d=h[1],v=Object(a.useRef)();Object(a.useEffect)(function(){d(t[o])},[d,t]);var m=Object(a.useCallback)(function(e){if(!n)return!1;var t=v.current.getBoundingClientRect(),r=(l-(e.clientY-t.top))/l;d(r),c.setProbability(o,r)},[d,n,l]);return i.a.createElement("div",{ref:v,className:"j-type"},i.a.createElement("div",{onMouseUp:function(){return s(!1)},onMouseDown:function(e){e.stopPropagation(),s(!0)},onMouseMove:m,className:"j-slider"},i.a.createElement("div",{style:{height:l*p},className:"j-slider-inner"})),i.a.createElement("div",{className:"cell"},i.a.createElement(Bt,{cell:{type:o}})))}),Jt=Object(o.b)(function(e,t){return{probabilities:t.jtypes.probabilities}},function(e){return{}})(function(e){var t=e.jtypes,n=e.probabilities,s=Object(a.useState)(!1),o=Object(r.a)(s,2),c=o[0],u=o[1];Object(a.useEffect)(function(){return window.addEventListener("mouseup",l),function(){return window.removeEventListener("mouseup",l)}},[u]);var l=Object(a.useCallback)(function(){u(!1)},[u]);return t&&t.probabilities?i.a.createElement("div",{className:"jaki-grid j-types"},i.a.createElement(zt,{probabilities:n,mouseDown:c,setMouseDown:u,type:"rest",jtypes:t}),i.a.createElement(zt,{probabilities:n,mouseDown:c,setMouseDown:u,type:"pianissimo",jtypes:t}),i.a.createElement(zt,{probabilities:n,mouseDown:c,setMouseDown:u,type:"piano",jtypes:t}),i.a.createElement(zt,{probabilities:n,mouseDown:c,setMouseDown:u,type:"regular",jtypes:t}),i.a.createElement(zt,{probabilities:n,mouseDown:c,setMouseDown:u,type:"accent",jtypes:t}),i.a.createElement(zt,{probabilities:n,mouseDown:c,setMouseDown:u,type:"staccato",jtypes:t}),i.a.createElement(zt,{probabilities:n,mouseDown:c,setMouseDown:u,type:"legato",jtypes:t}),i.a.createElement(zt,{probabilities:n,mouseDown:c,setMouseDown:u,type:"double",jtypes:t}),i.a.createElement(zt,{probabilities:n,mouseDown:c,setMouseDown:u,type:"flam",jtypes:t})):""}),Vt=(n(1716),Object(o.b)(function(e,t){return{width:t.zobject.width,height:t.zobject.height,attributes:t.zobject.attributes}},function(e){return{}})(function(e){var t=e.zobject,n=e.attributes,r={width:t.width-10,height:t.width-10,borderRadius:t.width-10,borderColor:n["secondary-color"],backgroundColor:n["button-color"]};return i.a.createElement("div",{style:r,onMouseLeave:function(){return t.effect.sendMessage("on released",Xe.a)},onMouseDown:function(){return t.effect.sendMessage("on pressed",Xe.a)},onMouseUp:function(){return t.effect.sendMessage("on released",Xe.a)},className:"z-button-presser"})})),Ht=(n(842),Object(o.b)(function(e,t){var n=t.zobject;return n.effect?{width:n.width,height:n.height,x:n.effect.x,y:n.effect.y,attributes:n.attributes}:{}},function(e){return{}})(function(e){var t=e.zobject,n=e.attributes,s=e.width,o=e.height,c=e.x,u=e.y,l=Object(a.useRef)(void 0),f=Object(a.useState)({x:c,y:u}),h=Object(r.a)(f,2),p=h[0],d=h[1],v=Object(a.useState)(!1),m=Object(r.a)(v,2),y=m[0],b=m[1];Object(a.useEffect)(function(){d({x:c,y:u})},[c,u,d]);var g=Object(a.useCallback)(function(e,n){if(y||n){n&&b(!0);var r=l.current.getBoundingClientRect(),a=(e.clientX-r.left)/s,i=1-(e.clientY-r.top)/o;t.effect.setXY(a,i),d({x:a,y:i})}},[y,b,d,s,o]),O=n["secondary-color"]||"white",k={backgroundColor:n["primary-color"]||"black"};return i.a.createElement("svg",{style:k,ref:l,onMouseUp:function(e){return b(!1)},onMouseDown:function(e){return g(e,!0)},onMouseMove:g,width:s,height:o,className:"xy-interface"},i.a.createElement("circle",{fill:O,onMouseDown:function(e){e.stopPropagation(),b(!0)},cx:p.x*s,cy:(1-p.y)*o,r:10}))})),Ut=Object(o.b)(function(e,t){var n=t.zobject;return n.effect?{width:n.width,height:n.height,coordinates:n.effect.coordinates,attributes:n.attributes}:{}},function(e){return{}})(function(e){var t=e.zobject,n=e.attributes,o=e.width,c=e.height,u=(e.x,e.y,Object(a.useRef)(void 0)),l=Object(a.useState)(t.effect.coordinates),f=Object(r.a)(l,2),h=f[0],p=f[1],d=Object(a.useState)(!1),v=Object(r.a)(d,2),m=v[0],y=v[1],b=Object(a.useCallback)(function(e,n){if(void 0!==m||n){n&&y(!0);var r=u.current.getBoundingClientRect(),a=(e.clientX-r.left)/o,i=1-(e.clientY-r.top)/(c-40);t.effect.setXY(a,i,m),p(Object(s.a)(t.effect.coordinates))}},[m,y,p,o,c]),g={backgroundColor:n["primary-color"]||"black"};if(!h)return"";for(var O=[],k=[],j=0;j<t.effect.numberOfCoordinates;j++)O.push(t.attributes["coordinate-name-"+(j+1)]),k.push(t.attributes["coordinate-color-"+(j+1)]);var w=t.attributes["x-axis"],x=t.attributes["y-axis"];return i.a.createElement("div",{className:"multi-xy"},i.a.createElement("div",{className:"x-axis"},w),i.a.createElement("div",{className:"y-axis"},x),i.a.createElement("svg",{style:g,ref:u,onMouseUp:function(e){return y(void 0)},onMouseLeave:function(e){return y(void 0)},onMouseDown:function(e){return b(e,!0)},onMouseMove:b,width:o,height:c-40,className:"xy-interface"},h.map(function(e,t){return i.a.createElement("circle",{fill:n["coordinate-color-"+(t+1)],onMouseDown:function(e){e.stopPropagation(),y(t)},cx:e.x*o,cy:(1-e.y)*(c-40),r:10})})),i.a.createElement("div",{className:"legend"},O.map(function(e,t){return i.a.createElement("div",{className:"legend-type"},i.a.createElement("div",{style:{backgroundColor:k[t]},className:"dot"}),i.a.createElement("div",{className:"legend-name"},e))})))}),Gt=n(343),Wt=n(843),Kt=(n(1717),Object.keys(Wt.a).map(function(e){return{value:e,label:e[0].toUpperCase()+e.slice(1)}})),Qt=function(e){var t=e.name,n=e.onChange,r=e.get,a=e.builder;return i.a.createElement(At,{object:a,inlet:t},i.a.createElement("div",{className:"sdf-field"},i.a.createElement("div",{className:"field-name"},t),i.a.createElement(Pt,{onChange:n,znumber:r})))},Zt=Object(o.b)(function(e,t){return{xComponent:t.builder.x,_type:t.builder.type}},function(e){return{}})(function(e){var t=e._type,n=e.builder,s=Object(a.useState)(n.type),o=Object(r.a)(s,2),c=o[0],u=o[1];Object(a.useEffect)(function(){t&&u(t)},[t,u]);var l=Object(a.useCallback)(function(){n.sendObject()},[n]),f=Object(a.useCallback)(function(e){u(e.value),n.type=e.value,n.sendObject()},u,n),h=Object(Gt.f)(c);return n.x?i.a.createElement("div",{className:"sdf-builder"},i.a.createElement(vt.a,{value:c,onChange:f,options:Kt}),i.a.createElement(Qt,{builder:n,onChange:l,name:"x",get:n.x}),i.a.createElement(Qt,{builder:n,onChange:l,name:"y",get:n.y}),h&&i.a.createElement(Qt,{builder:n,onChange:l,name:"z",get:n.z}),i.a.createElement(Qt,{builder:n,onChange:l,name:"width",get:n.w}),i.a.createElement(Qt,{builder:n,onChange:l,name:"height",get:n.h}),h&&i.a.createElement(Qt,{builder:n,onChange:l,name:"depth",get:n.d}),i.a.createElement(Qt,{builder:n,onChange:l,name:"corner",get:n.c}),!h&&i.a.createElement(Qt,{builder:n,onChange:l,name:"rotation",get:n.r}),h&&i.a.createElement(Qt,{builder:n,onChange:l,name:"repeat x",get:n.repeatCountX}),h&&i.a.createElement(Qt,{builder:n,onChange:l,name:"repeat y",get:n.repeatCountY}),h&&i.a.createElement(Qt,{builder:n,onChange:l,name:"repeat z",get:n.repeatCountZ}),h&&i.a.createElement(Qt,{builder:n,onChange:l,name:"repeat spread",get:n.repeatSpread})):""}),Yt=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.vec3,n=Object(a.useCallback)(function(){t.sendObject()},[t]);return i.a.createElement("div",{className:"sdf-builder"},i.a.createElement(Qt,{builder:t,onChange:n,name:"x",get:t.x}),i.a.createElement(Qt,{builder:t,onChange:n,name:"y",get:t.y}),i.a.createElement(Qt,{builder:t,onChange:n,name:"z",get:t.z}))}),Xt=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.vec2,n=Object(a.useCallback)(function(){t.sendObject()},[t]);return i.a.createElement("div",{className:"sdf-builder vec-2"},i.a.createElement(Qt,{builder:t,onChange:n,name:"x",get:t.x}),i.a.createElement(Qt,{builder:t,onChange:n,name:"y",get:t.y}))}),$t=40,en=250;function tn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;return(e-t)/(n-t)}(e,t,n,r);return r*Math.pow(i,1/a)+4}var nn=Object(o.b)(function(e,t){return{value:t.parameter.get(),isMacroMapping:e.effects.isMacroMapping}},function(e){return{setParameterToMap:function(t){return e(Object(c.Dc)(t))}}})(function(e){var t,n=e.needsRound,s=e.setParameterToMap,o=e.isMacroMapping,c=e.isDraggable,u=void 0===c||c,l=(e.track,e.color),f=e.name,h=e.label,p=(e.rackTrack,e.value),d=e.parameter,v=(e.id,e.min),m=void 0===v?d.min:v,y=e.max,b=void 0===y?d.max:y,g=e.width,O=void 0===g?$t:g,k=e.units,j=void 0===k?"":k,w=e.display,x=e.root,S=void 0===x?2:x,P=e.stopPropagation,E=void 0===P||P,T=Object(a.useState)(!1),A=Object(r.a)(T,2),M=A[0],R=A[1],C=Object(a.useState)(!1),N=Object(r.a)(C,2),q=N[0],I=N[1],_=Object(a.useRef)(void 0),D=Object(a.useState)(""),F=Object(r.a)(D,2),L=F[0],B=F[1],z=Object(a.useRef)(0),J=Object(a.useRef)(void 0),V={width:tn(p,m,b,O,S),backgroundColor:l},H=Object(a.useCallback)(function(e){if("Enter"===e.key){var t=parseFloat(L);if(isNaN(t))return;d.set(t,!0),I(!1)}},[I,L,d]);Object(a.useEffect)(function(){q&&(B(Math.round(100*d.get(!0))/100),J.current&&(J.current.focus(),J.current.select()))},[q,B,d]);var U=function(){return d.id},G=Object(a.useCallback)(function(e){e.stopPropagation();var t=(new Date).getTime();t-z.current<en?I(!0):(z.current=t,!E&&u||e.stopPropagation(),R(!0))},[o,u,d,R]);Object(a.useEffect)(function(){return window.addEventListener("mousemove",Q),window.addEventListener("mouseup",K),function(){window.removeEventListener("mousemove",Q),window.removeEventListener("mouseup",K)}},[d,R,M]);var W,K=Object(a.useCallback)(function(){R(!1)},[R]),Q=Object(a.useCallback)(function(e){if(E&&e.stopPropagation(),M){var t=function(e,t,n,r,a,i,s){var o=s.current.getBoundingClientRect(),c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=(e=Math.min(Math.max(0,e),r))/r,s=Math.pow(i,a);return t+(n-t)*s}(e.clientX-o.left,n,r,a,i);return isNaN(c)?-100:c}(e,U(),m,b,O,S,_);1===S&&(t=Math.round(t)),n&&(t=Math.round(t)),d.get()!==t&&d.set(t,!1)}},[d,M]),Z=Object(a.useCallback)(function(e){e.stopPropagation(),o&&(d.isMapped||s(d))},[o]);return q?i.a.createElement("div",{className:"p-box"},i.a.createElement("div",{className:"p-name"},f),i.a.createElement("input",{ref:J,className:"volume-box",onChange:function(e){return B(e.target.value)},onKeyDown:H,value:L})):i.a.createElement("div",{className:"p-box "},o&&i.a.createElement("div",{onClick:Z,className:"macro-overlay"}),i.a.createElement("div",{className:"p-name"},f),i.a.createElement("div",(t={draggable:!0,onClick:Z,onDragStart:function(e){return e.preventDefault()},style:{width:O+6},id:U()},Object(Fe.a)(t,"onClick",function(e){return e.stopPropagation()}),Object(Fe.a)(t,"onMouseUp",function(e){e.stopPropagation(),R(!1)}),Object(Fe.a)(t,"onMouseLeave",function(e){e.stopPropagation()}),Object(Fe.a)(t,"onMouseDown",G),Object(Fe.a)(t,"className","volume-box"),t),i.a.createElement("div",{style:V,ref:_,className:"volume-indicator"}),i.a.createElement("span",{className:"volume-value"},h?h+": ":""," ",w?w(p):(W=p,Math.round(100*W)/100)," ",j)))}),rn=n(175),an=n(303),sn=n.n(an),on=function(e,t){return e<0?-1*Math.pow(Math.abs(e),t):Math.pow(e,t)},cn=Object(o.b)(function(e,t){if(t.parameter)return{value:t.parameter.get(!0)}},function(e){return{}})(function(e){var t=e.convertToRoot,n=e.onMouseUp,r=e.value,a=e.root,s=e.onUpdateParameter,o=e.step,c=e.max,u=e.min,l=on(parseFloat(r),1/a);return i.a.createElement(sn.a,{slideStop:n,value:t?Math.log2(l):l,change:s,step:o,max:c,min:u,orientation:"horizontal",reversed:!1})}),un="RESOLUTION_DROPDOWN";window.mouseDownX=0,document.body.onmousedown=function(){++window.mouseDownX},document.body.onmouseup=function(){--window.mouseDownX};var ln=Object(a.memo)(function(e){var t=e.object,n=e.refObj,r=e.element,s=e.setContextualHelp,o=e.arg,c=e.children,u=e.className,l=void 0===u?"":u,f=Object(rn.a)(e,["object","refObj","element","setContextualHelp","arg","children","className"]);t&&t.docElement&&(r=t.docElement);var h=Object(a.useCallback)(function(e){s(r,o)},[]),p=Object(a.useCallback)(function(){s(void 0)},[]);return l+=" documented ",i.a.createElement("div",Object.assign({},f,{ref:n,className:l,onMouseLeave:p,onMouseOver:h}),c)}),fn=Object(o.b)(null,function(e){return{setContextualHelp:function(t,n){return e(Object(c.Z)(t,n))}}})(ln);var hn=Object(o.b)(function(e,t){if(t.parameter)return{value:t.parameter.get(!0)}},function(e){return{}})(function(e){var t=e.displayFunction,n=e.unit,r=e.isParameter,s=e.parameter,o=e.onEdit,c=e.value,u=Object(rn.a)(e,["displayFunction","unit","isParameter","parameter","onEdit","value"]),l=Object(a.useCallback)(function(){if(void 0===c||null===c)return 0;if("object"===typeof c){if(c.toSeconds)return c.toSeconds();if(c._val)return new q.a.Time(c._val).toSeconds()}else if("string"===typeof c)return new q.a.Time(c).toSeconds();return c},[c]),f=Object(a.useCallback)(function(){var e=l();return void 0!==e?e:r?s.get():u.getValue()},[s,c]);n=n||"";var h=(void 0===t?function(e){return Math.round(1e3*e)/1e3}(c):t(f()))+" "+n;return i.a.createElement(fn,{element:"PARAMETER_VALUE",className:"pushable parameter-label-value",onClick:function(e){return o(e)}},u.convertToRoot?Math.round(Math.log2(h)):h)}),pn=n(241),dn=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.setEditing,n=e.onUpdateParameter,s=e.value,o=(e.editedValue,Object(a.useState)(s)),c=Object(r.a)(o,2),u=c[0],l=c[1],f=Object(a.useCallback)(function(e){(Object(fe.a)(e)||"."===e||""===e||"-"===e||"-."===e)&&(l(e),n({target:{value:e}},!1))},[l,n]),h=Object(a.useCallback)(function(e){"Enter"===e.key&&t(!1)},[t]);return i.a.createElement(pn.c,{className:"tag-sound-input"},i.a.createElement(pn.b,{value:u,onKeyUp:h,onChange:function(e){return f(e.target.value)},placeholder:"Parameter",className:"parameter-input-box"}))}),vn=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.envelope,n=e.lfo,s=e.parameter,o=e.sequencerEngine,c=e.keyScaling,u=Object(a.useRef)(void 0),l=Object(a.useRef)(0),f=Object(a.useState)(!1),h=Object(r.a)(f,2),p=h[0],d=h[1],v=Object(a.useState)(!1),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useState)(s.min),O=Object(r.a)(g,2),k=O[0],j=O[1],w=Object(a.useState)(s.max),x=Object(r.a)(w,2),S=x[0],P=x[1],E=function(e){var t=e.parameter,n=e.lfo,r=e.envelope,a=(e.sequencerEngine,e.keyScaling),i=e.zoomMin,s=e.zoomMax,o=a||t.getParameterMod(r||n);if(o.scale||a){var c=s-i,u=(Math.min(o.min,o.max)-i)/c,l=(Math.max(o.min,o.max)-i)/c-u;u<0?u=0:u>1&&(u=1);var f={marginLeft:100*u+"%",width:100*l+"%"},h="modulator-indicator",p=0,d="modulator-thumb ";return n?(d+=" lfo-"+(p=t.availableLFOs.indexOf(n))+" toggled",h+=" lfo-"+p+" toggled"):r?(h+=" lfo-"+(p=t.availableEnvelopes.indexOf(r))+" toggled",d+=" lfo-"+p+" toggled env"):a&&(d+=" key-scaling",h+=" key-scaling"),{style:f,className:h,mod:o,num:p,thumbClass:d}}}({parameter:s,envelope:t,lfo:n,sequencerEngine:o,keyScaling:c,zoomMin:k,zoomMax:S}),T=Object(a.useState)(E&&E.mod.min),A=Object(r.a)(T,2),M=A[0],R=A[1],C=Object(a.useState)(E&&E.mod.max),N=Object(r.a)(C,2),q=N[0],I=N[1],_=E&&E.mod,D=Object(a.useCallback)(function(){(y||p)&&(b(!1),d(!1))},[y,p,b,d]),F=Object(a.useCallback)(function(e){if(y||p){var t=u.current.getBoundingClientRect(),n=e.clientX-t.left,r=t.width,a=k+n/r*(S-k);y?(_.min=a,R(a)):(_.max=a,I(a))}},[F,s,_,y,p,R,I,k,S]),L=function(e){return _.max-_.min>=1e3?Math.round(e):_.max-_.min>=100?Math.round(10*e)/10:Math.round(1e4*e)/1e4},B=Object(a.useCallback)(function(){var e=(q+S)/2;j((M+k)/2),P(e)},[j,P,M,q,k,S]),z=Object(a.useCallback)(function(e){var t=(new Date).getTime();if(t-l.current<=300)B();else{l.current=t;var n=u.current.getBoundingClientRect(),r=e.clientX-n.left,a=n.width;k+r/a*(S-k)>(_.max+_.min)/2?d(!0):b(!0)}},[_,b,d,k,S,j,P,q,M]),J=Object(a.useCallback)(function(e){if(o.state.keyboard.isCommandDown){var t=_.min,n=_.max;_.min=n,_.max=t,R(n),I(t)}D(e)},[R,I,y,p,b,d]);if(!E)return i.a.createElement("div",null);var V=E.style,H=E.className,U=(E.num,E.thumbClass,"modulator-control ");return c&&(U+=" key-scaling-control"),i.a.createElement(fn,{className:"modulator-control-container",element:"MODULATOR_CONTROL"},i.a.createElement("div",{draggable:!0,onDragStart:function(e){return e.preventDefault()},ref:u,onMouseUp:J,onMouseDown:z,onMouseMove:F,onMouseLeave:D,className:U},i.a.createElement("div",{className:H,style:V},i.a.createElement("div",{onMouseDown:function(e){e.stopPropagation(),_.min<_.max?b(!0):d(!0)},className:_.min<_.max?"small left-edge":"big left-edge"}),i.a.createElement("div",{onMouseDown:function(e){e.stopPropagation(),_.min<_.max?d(!0):b(!0)},className:_.min<_.max?"big right-edge":"small right-edge"})),i.a.createElement("div",{className:"mod-number"},y?"Min: "+L(_.min):p?"Max: "+L(_.max):"")))}),mn=(n(1729),Object(o.b)(function(e,t){return t.parameter?{lfos:t.parameter.lfos,envs:t.parameter.envelopes,keyScaling:t.parameter.keyScaling}:{}},function(e){return{}})(function(e){var t=e.parameter,n=e.sequencerEngine;if(!n||!t||!t.lfos||!t.envelopes)return[];var r=Object(s.a)(t.lfos);r.sort(function(e,t){return e.number-t.number});var a=Object(s.a)(t.envelopes);return a.sort(function(e,t){return e.number-t.number}),i.a.createElement("div",{className:"modulator-controls"},r.map(function(e){return i.a.createElement(vn,{key:e.number,sequencerEngine:n,lfo:e,parameter:t})}),a.map(function(e){return i.a.createElement(vn,{key:e.number,sequencerEngine:n,envelope:e,parameter:t})}),t.keyScaling?i.a.createElement(vn,{sequencerEngine:n,keyScaling:t.keyScaling,parameter:t}):"")})),yn=function(e,t){return e<0?-1*Math.pow(Math.abs(e),t):Math.pow(e,t)},bn=new $e.a,gn=function(e,t){return e<0?-1*Math.pow(Math.abs(e),t):Math.pow(e,t)};var On=Object(o.b)(function(e,t){return t.parameter?{midiMapMode:e.midi.midiMapMode,hasAutomations:t.parameter.automations&&t.parameter.automations.length>0}:{}},function(e){return{deleteParameterMidiMapping:function(t){return e(Object(c.e)(t))},setParameterSliderDown:function(t){return e(Object(c.Cc)(t))},setEffectParameterValue:function(t,n){return e(Object(c.tb)(t,n))},setShowAutomation:function(t){return e(Object(c.Gd)(t))},setBottomMode:function(t){return e(Object(c.x)(t))},setShowPianoRoll:function(t){return e(Object(c.Nd)(t))}}})(function(e){var t=e.step,n=e.root,s=(e.deleteParameterMidiMapping,e.showAutomation),o=e.onClickParameterName,c=(e.setShowModulators,e.midiMapRef),u=e.onMouseDown,l=e.isMouseDown,f=(e.setShowModulator,Object(rn.a)(e,["step","root","deleteParameterMidiMapping","showAutomation","onClickParameterName","setShowModulators","midiMapRef","onMouseDown","isMouseDown","setShowModulator"])),h=Object(a.useState)(gn(f.max,1/n)),p=Object(r.a)(h,2),d=p[0],v=(p[1],Object(a.useState)(gn(f.min,1/n))),m=Object(r.a)(v,2),y=m[0],b=(m[1],function(e,t){var n=e.root,i=e.isMouseDown,s=e.onMouseDown,o=e.midiMapRef,c=e.convertToRoot,u=Object(a.useRef)(t.parameter),l=Object(a.useState)(!1),f=Object(r.a)(l,2),h=f[0],p=f[1],d=Object(a.useState)(t.value||t.parameter&&t.parameter.get(!0)),v=Object(r.a)(d,2),m=v[0],y=v[1],b=Object(a.useCallback)(function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.stopPropagation(),n!==h&&n&&y(t.value),p(n)},[p,y,t.value,h]),g=Object(a.useCallback)(function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=e.target.value;if(r)s(),a=yn(a,n);else if("."===a||"-."===a)a=0;else if("-"===a)a=0;else if("-."===a)a=0;else if(""===a)a=0;else{if(!Object(fe.a)(a))return;a=parseFloat(a)}c&&(a=Math.pow(2,a));var i=u.current;o.current===he.b&&(console.log("setting parameter midi map selected",i),t.setParameterMidiMapSelection(i.id));var l=t.sequencerEngine&&t.sequencerEngine.operationManager;l?l.dispatch(Object(X.s)(i,a,!1,!1)):i.set(a,!1),y(a)},[y,n]);Object(a.useEffect)(function(){h||!i.current&&t.parameter&&y(t.parameter.get(!0))},[h,t.parameter,y]);var O=Object(a.useCallback)(function(e){"Enter"===e.key&&p(!1)},[p]);return Object(a.useEffect)(function(){u.current=t.parameter},[t.parameter]),{onEdit:b,value:m,setValue:y,onUpdateParameter:g,setEditing:p,onKeyPress:O,editing:h}}({root:n,midiMapRef:c,convertToRoot:f.convertToRoot,isMouseDown:l,onMouseDown:u},f)),g=b.onEdit,O=b.editing,k=(b.onKeyPress,b.setEditing),j=b.value,w=b.onUpdateParameter;b.onTypedInputChanged,b.inputValue;Object(a.useEffect)(function(){c.current=f.midiMapMode},[f.midiMapMode]);var x=Object(a.useCallback)(function(){f.setParameterSliderDown(void 0),f.parameter&&(f.parameter.automation.smoothen(),f.parameter.mixAutomation.smoothen()),l.current=!1},[j,f.parameter]),S=Object(a.useCallback)(function(){f.pLockedSteps.forEach(function(e){return f.parameter.deletePLockForStep(e)})},[f.pLockedSteps,f.parameter]);return i.a.createElement("div",{className:"slider-and-labels"},i.a.createElement("div",{className:"parameter-label-container"},i.a.createElement("div",{className:"parameter-label effect-parameter-label"},i.a.createElement(fn,{element:f.parameter,onClick:function(){return o()},className:"pushable parameter-label-name"},f.name,": "),O&&i.a.createElement(dn,{setEditing:k,onUpdateParameter:w,value:j}),!O&&i.a.createElement(hn,{convertToRoot:f.convertToRoot,unit:f.unit,displayFunction:f.displayFunction,isParameter:f.isParameter,onEdit:g,getValue:f.getValue,parameter:f.parameter}),!O&&f.pLockedSteps&&i.a.createElement("div",{onClick:S,style:{backgroundColor:bn.getColorForTrack(f.pLockedSteps[0].track)},className:"p-lock-indicator"},"P-Locked"),f.hasAutomations&&i.a.createElement("img",{onClick:function(){return s()},src:"/automation-icon-disabled.png",className:"automation-icon"}))),f.children,i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},className:"slider-and-modulators"},!f.hideSlider&&i.a.createElement(cn,{onMouseUp:x,convertToRoot:f.convertToRoot,onUpdateParameter:w,parameter:f.parameter,step:t,max:d,min:y,root:n}),i.a.createElement(mn,{sequencerEngine:f.sequencerEngine,parameter:f.parameter})))}),kn=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.parameter,n=Object(a.useState)(t&&void 0!==t.keyScaling),s=Object(r.a)(n,2),o=s[0],c=s[1];Object(a.useEffect)(function(){t&&c(void 0!==t.keyScaling)},[t,c]);var u=Object(a.useCallback)(function(){o?t.disableKeyScaling():t.enableKeyScaling(),t.context.track&&(console.log("clearing cache"),t.context.track.parametersToScale=void 0),c(!o)},[t,c,o]),l="key-scaling-toggle pushable ";return o&&(l="key-scaling-toggled pushable"),i.a.createElement("div",{onClick:u,className:l})});function jn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var wn=function(e){Object(b.a)(n,e);var t=jn(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={},r}return Object(y.a)(n,[{key:"isToggled",value:function(){return void 0!==this.props.instrument?this.props.instrument.isParameterConnectedToLFO(this.props.parameter,this.props.lfo):this.props.parameter&&this.props.parameter.isConnectedToLFO(this.props.lfo)}},{key:"toggle",value:function(){void 0!==this.props.instrument?this.props.instrument.toggleParameterWithLFO(this.props.parameter,this.props.lfo):(this.props.parameter.isAudioParamEnabled()||this.props.parameter.enableAudioParam(),this.isToggled()?this.props.disconnectFromLFO?this.props.disconnectFromLFO(this.props.lfo,!0):this.props.parameter.disconnectFromLFO(this.props.lfo,!0):(this.props.connectToLFO?this.props.connectToLFO(this.props.lfo,!0):this.props.parameter.connectToLFO(this.props.lfo,!0),this.props.setSelectedLFO(this.props.lfo.number))),this.setState({toggled:this.isToggled()})}},{key:"showMods",value:function(e){this.props.setShowLFOs(!0)}},{key:"onMouseOver",value:function(e){e.stopPropagation(),this.props.setContextualHelp("LFO_TOGGLE_BUTTON")}},{key:"render",value:function(){var e=this,t=this.isToggled()?" toggled ":"",n=this.props.lfos.indexOf(this.props.lfo);return i.a.createElement("div",{onMouseOver:function(t){return e.onMouseOver(t)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.toggle()},className:"pushable parameter-lfo-toggle lfo-"+n+t},n+1)}}]),n}(a.PureComponent),xn=Object(o.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(c.Z)(t))},setSelectedLFO:function(t){return e(Object(c.nd)(t))},setShowLFOs:function(t){return e(Object(c.Kd)(t))},setArrangementBottomMode:function(t){return e(Object(c.x)(t))},setShowPianoRoll:function(t){return e(Object(c.Nd)(t))}}})(wn);function Sn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var Pn=function(e){Object(b.a)(n,e);var t=Sn(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={},r}return Object(y.a)(n,[{key:"isToggled",value:function(){return this.props.parameter&&this.props.parameter.isConnectedToEnvelope(this.props.envelope)}},{key:"toggle",value:function(){this.props.parameter.isAudioParamEnabled()||this.props.parameter.enableAudioParam(),this.isToggled()?this.props.parameter.disconnectFromEnvelope(this.props.envelope):(this.props.parameter.connectToEnvelope(this.props.envelope),this.props.setSelectedEnvelope(this.props.envelope.number)),this.setState({toggled:this.isToggled()})}},{key:"onMouseOver",value:function(e){e.stopPropagation(),this.props.setContextualHelp("ENVELOPE_TOGGLE_BUTTON")}},{key:"showMods",value:function(e){this.props.setShowEnvelopes(!0)}},{key:"render",value:function(){var e=this,t=this.isToggled()?" toggled ":"",n=this.props.envelopes.indexOf(this.props.envelope);return i.a.createElement("div",{onMouseOver:function(t){return e.onMouseOver(t)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.toggle()},className:"pushable parameter-envelope-toggle lfo-"+n+t},n+1)}}]),n}(a.PureComponent),En=Object(o.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(c.Z)(t))},setSelectedEnvelope:function(t){return e(Object(c.ld)(t))},setShowEnvelopes:function(t){return e(Object(c.Id)(t))},setArrangementBottomMode:function(t){return e(Object(c.x)(t))},setShowPianoRoll:function(t){return e(Object(c.Nd)(t))}}})(Pn),Tn=(n(52),n(268)),An=new $e.a,Mn=Object(o.b)(function(e,t){if(void 0===t.parameter)return{};t.parameter&&t.parameter.id;var n=e.keyboard.selectedPianoRollSteps,r=n&&n.length>0&&t.parameter&&n.filter(function(e){return e&&e.id in t.parameter.stepToValue});return{context:t.parameter&&t.parameter.context,pLockedSteps:r&&0!==r.length?r:void 0,isMidiSelected:e.midi.parameterSelected&&t.parameter.id===e.midi.parameterSelected,isSelected:t.parameter===e.effects.accumulatorParameterSelected,midiMapMode:e.midi.midiMapMode,isMacroMapping:e.effects.isMacroMapping,isParameterToMap:e.effects.parameterToMap&&t.parameter&&e.effects.parameterToMap===t.parameter,isSelectedParameter:t.parameter&&e.effects.accumulatorParameterSelected==t.parameter,isAccumulated:t.parameter&&t.parameter.isMapped,depthParameter:t.parameter&&t.parameter.depthParameter}},function(e){return{setEffectParameterValue:function(t,n){return e(Object(c.tb)(t,n))},setContextualHelp:function(t){return e(Object(c.Z)(t))},setParameterMidiMapSelection:function(t){return e(Object(c.yc)(t))},deleteParameterMidiMapping:function(t){return e(Object(c.e)(t))},setParameterToMap:function(t){return e(Object(c.Dc)(t))},setParameterSliderDown:function(t){return e(Object(c.Cc)(t))},setShowAutomation:function(t){return e(Object(c.Gd)(t))},setBottomMode:function(t){return e(Object(c.x)(t))},setShowPianoRoll:function(t){return e(Object(c.Nd)(t))},setTrackAutomationParameter:function(t,n){return e(Object(c.ge)(t,n))},setAccumulatorParameterSelected:function(t){return e(Object(c.n)(t))}}})(function(e){var t=Object(a.useRef)(void 0),n=Object(a.useRef)(e.midiMapMode),s=Object(a.useRef)(!1),o=Object(a.useCallback)(function(){e.setParameterSliderDown(e.parameter),s.current=!0},[]),u=Object(a.useState)(!(!e.parameter||!e.parameter.isConnectedToAnyModulator)&&e.parameter.isConnectedToAnyModulator()),l=Object(r.a)(u,2),f=l[0],h=l[1],p=Object(a.useState)(!1),d=Object(r.a)(p,2),v=(d[0],d[1],Object(a.useState)(e.value||e.parameter&&e.parameter.get(!0))),m=Object(r.a)(v,2),y=(m[0],m[1],Object(a.useState)(e.value||e.parameter&&e.parameter.get(!0))),b=Object(r.a)(y,2),g=(b[0],b[1],Object(a.useRef)(0)),O=e.root||1;Object(a.useEffect)(function(){e.parameter&&e.parameter.isConnectedToAnyModulator()&&h(!0)},[e.parameter&&e.parameter.isConnectedToAnyModulator()]),Object(a.useEffect)(function(){e.isSelected&&k()},[]),Object(a.useEffect)(function(){e.isSelected&&k()},[e.isSelected]);var k=function(){if(!e.parameter.isMapped||!e.parameter.context||e.parameter.isMapped.track!==e.parameter.context.track){for(var n=t.current,r=n,a=0;n&&n&&n.className&&!(n.className.includes("effects-view")||a>=20);)n=n.parentNode,a++;if(!n.className&&n.className.includes("effects-view")){var i=r.offsetLeft;i>n.offsetWidth?n.scroll(i,0):n.scroll(0,0)}}},j=(e.sequencerEngine&&e.sequencerEngine.operationManager,Object(a.useCallback)(function(){return e.parameter?e.parameter.availableLFOs:[]},[e.lfos,e.parameter])),w=function(){return e.parameter?e.parameter.availableEnvelopes:[]},x=Object(a.useCallback)(function(){var t=e.isMacroMapping,n=e.parameter,r=e.isParameterToMap;if(t&&n&&!n.isMapped){var a="macro-overlay";r&&(a+=" parameter-to-map"),n.hasMacro&&(a+=" mapped");var s={};e.parameter.hasMacro&&(s={backgroundColor:An.getColorForHash(n.hasMacro.id)});var o=n.hasMacro&&n.hasMacro.name;return i.a.createElement("div",{onClick:function(t){t.stopPropagation(),e.parameter.isMapped||e.setParameterToMap(e.parameter)},className:a},i.a.createElement("div",{className:"overlay-main"}),i.a.createElement("div",{className:"overlay-detail",style:s},o))}return""},[e.parameter,e.parameterToMap,e.isMacroMapping]),S=Object(a.useState)(j()),P=Object(r.a)(S,2),E=P[0],T=P[1],A=Object(a.useState)(w()),M=Object(r.a)(A,2),R=M[0],C=M[1],N=void 0!==e.customClassName?e.customClassName:"",q=e.isSelectedParameter;N+=q?" selected-parameter parameter-box":"parameter-box";var I=e.refined?.01:e.step;Object(a.useEffect)(function(){T(j()),C(w())},[e.parameter&&e.parameter.context,C,T]),e.isMidiSelected&&e.midiMapMode===he.b&&(N+=" midi-selected");e.contextualHelp;e.isSelected&&(N+=" accumulator-selected");var _=e.parameter&&e.parameter.id;_&&(_="parameter-"+_);var D=Object(a.useCallback)(function(){n.current===he.b?Object(c.e)(e.parameter.id):void 0!==e.sequencerEngine&&h(!0);var t=(new Date).getTime();t-g.current<=250&&F(),g.current=t},[h,e.parameter]),F=Object(a.useCallback)(function(){if(e.setShowAutomation(!0),e.setShowPianoRoll(!0),e.setBottomMode(ce.b),e.parameter.track){var t=e.parameter.track.instrumentRack?e.parameter.track.instrumentRack:e.parameter.track;e.setTrackAutomationParameter(t.id,e.parameter)}},[e.parameter]);return i.a.createElement("div",{onContextMenu:function(e){e.stopPropagation(),e.preventDefault()},ref:t,id:_,className:N},e.isAccumulated?i.a.createElement("div",{onClick:function(){return e.setAccumulatorParameterSelected(q?void 0:e.parameter)},className:"accumulator-corner"}):"",x(),i.a.createElement(On,{max:e.max,midiMapRef:n,onMouseDown:o,onClickParameterName:D,showAutomation:F,isMouseDown:s,min:e.min,setShowModulators:h,hideSlider:e.hideSlider,sequencerEngine:e.sequencerEngine,root:O,displayFunction:e.displayFunction,convertToRoot:e.convertToRoot,parameter:e.parameter,pLockedSteps:e.pLockedSteps,setParameterMidiMapSelection:e.setParameterMidiMapSelection,step:I,name:e.name},i.a.createElement(Tn.a,{condition:e.lfoEnabled&&(void 0===e.sequencerEngine||f)},i.a.createElement("div",{className:"lfo-boxes"},E&&E.map(function(t,n){var r;return i.a.createElement(xn,(r={connectToLFO:e.connectToLFO,key:n,isToggled:e.parameter&&e.parameter.isConnectedToLFO(t),parameter:e.parameter,lfo:t,lfos:E},Object(Fe.a)(r,"parameter",e.parameter),Object(Fe.a)(r,"instrument",e.instrument),r))}),R&&R.map(function(t,n){var r;return i.a.createElement(En,(r={key:n,isToggled:e.parameter&&e.parameter.isConnectedToEnvelope(t),parameter:e.parameter,envelope:t,envelopes:R},Object(Fe.a)(r,"parameter",e.parameter),Object(Fe.a)(r,"instrument",e.instrument),r))}),i.a.createElement(kn,{parameter:e.parameter}))),i.a.createElement("div",{className:"clear-fix"})),e.parameter&&e.parameter.depthParameter&&e.parameter.isConnectedToAnyModulator()&&i.a.createElement(nn,{display:function(e){return Math.round(100*e)+"%"},min:0,max:1,width:70,label:"Amount",name:"",parameter:e.parameter.depthParameter}))}),Rn=new $e.a,Cn=Object(o.b)(function(e,t){return{isMacroMapping:e.effects.isMacroMapping,isParameterToMap:t.parameter&&e.effects.parameterToMap===t.parameter}},function(e){return{setParameterToMap:function(t){return e(Object(c.Dc)(t))}}})(function(e){var t=e.parameter,n=e.isMacroMapping,r=e.isParameterToMap,a=e.setParameterToMap;if(n&&t){var s="macro-overlay";r&&(s+=" parameter-to-map"),t.hasMacro&&(s+=" mapped");var o={};t.hasMacro&&(o={backgroundColor:Rn.getColorForHash(t.hasMacro.id)});var c=t.hasMacro&&t.hasMacro.name;return i.a.createElement("div",{onClick:function(){return a(t)},className:s},i.a.createElement("div",{className:"overlay-main"}),i.a.createElement("div",{className:"overlay-detail",style:o},c))}return""}),Nn=Object(o.b)(function(e,t){return{value:t.parameter.get(),automations:t.parameter.automations&&t.parameter.automations.length>0}},function(e){return{setShowPianoRoll:function(t){return e(Object(c.Nd)(t))},setShowAutomation:function(t){return e(Object(c.Gd)(t))},setTrackAutomationParameter:function(t,n){return e(Object(c.ge)(t,n))},setBottomMode:function(t){return e(Object(c.x)(t))}}})(function(e){var t=e.parameter,n=e.value,s=e.fullText,o=e.automations,c=e.setShowAutomation,u=e.setShowPianoRoll,l=e.setBottomMode,f=e.setTrackAutomationParameter,h=e.setParameter,p=e.selectedParameter,d=Object(a.useState)(!1),v=Object(r.a)(d,2),m=(v[0],v[1],"Attack"===t.name?s?"Atk":"A":"Decay"===t.name?s?"Dec":"D":"Sustain"===t.name?s?"Sus":"S":"Level"===t.name?"L":s?"Rel":"R"),y="env-param";return"Sustain"===t.name&&(y+=" sustain"),t===p&&(y+=" selected"),i.a.createElement("div",{onClick:function(){return h(t===p?void 0:t)},className:y},i.a.createElement(Cn,{parameter:t}),m,": ",i.a.createElement("span",{className:"param-val"},"Sustain"===t.name||"L"===m?Math.round(10*n)/10:Math.round(n)),o?i.a.createElement("img",{onClick:function(){if(c(!0),u(!0),l(ce.b),t.track){var e=t.track.instrumentRack?t.track.instrumentRack:t.track;f(e.id,t)}},className:"automation-icon",src:"/automation-icon-disabled.png"}):"")}),qn=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.selectedParameter,n=e.setParameter,r=e.envelope,a=e.hasRelease,s=e.hasLevel,o=e.fullText,c=[r.attackParameter,r.decayParameter,r.sustainParameter];return a&&c.push(r.releaseParameter),s&&c.push(r.levelParameter),i.a.createElement("div",{className:"env-params"},c.map(function(e,r){return i.a.createElement(Nn,{key:"param-"+r,selectedParameter:t,setParameter:n,parameter:e,fullText:o})}))}),In=Math.sqrt(8e3),_n=Math.sqrt(1e4),Dn=function(e,t,n){return 5+.8*n*Math.sqrt(e)/Math.max(In,t)},Fn=new $e.a,Ln=function(e,t,n,r,a){for(var s=[],o=function(o){var c=2===o?a?[t.attackParameter,t.levelParameter]:[t.attackParameter]:4===o?[t.decayParameter,t.sustainParameter]:6===o?[t.sustainParameter,t.releaseParameter]:[t.releaseParameter],u=e[o],l=e[o+1],f=(e[o+2],e[o+3],!1);n&&(f=n[0]===c[0]),s.push(i.a.createElement("circle",{key:o,onMouseDown:function(e){e.stopPropagation(),r(c)},cx:u,cy:l,r:3,className:f?"selected point":"point",fill:"#2fffec",strokeWidth:2}))},c=2;c<e.length-3;c+=2)o(c);return s},Bn=function(e,t,n,r){for(var a=[],s=0;s<e.length-3;s+=2){var o=e[s],c=e[s+1],u=e[s+2],l=e[s+3];a.push(i.a.createElement("polygon",{key:"poly-"+s,points:[o,t,o,c,u,l,u,t],fill:r||"red",strokeWidth:1})),a.push(i.a.createElement("line",{key:"line-"+s,x1:o,y1:c,x2:u,y2:l,strokeWidth:2,stroke:n||"red"}))}return a},zn=Object(o.b)(function(e,t){var n=t.envelope;return{attack:n.attackParameter.get(),decay:n.decayParameter.get(),sustain:n.sustainParameter.get(),release:n.releaseParameter.get(),level:n.levelParameter&&n.levelParameter.get(),selectedParameter:e.effects.accumulatorParameterSelected}},function(e){return{setParameterSliderDown:function(t){return e(Object(c.Cc)(t))},setPullablePartDragging:function(t){return e(Object(c.Uc)(t))}}})(function(e){var t=e.draggable,n=void 0===t||t,s=e.fullText,o=e.sequencerEngine,c=e.instrument,u=e.envelope,l=e.width,f=void 0===l?180:l,h=e.height,p=void 0===h?60:h,d=e.name,v=e.hasRelease,m=e.hasLevel,y=e.backgroundColor,b=e.fillColor,g=e.lineColor,O=e.selectedParameter,k=e.setParameterSliderDown,j=e.setPullablePartDragging,w=Object(a.useState)(void 0),x=Object(r.a)(w,2),S=x[0],P=x[1],E=Object(a.useState)(void 0),T=Object(r.a)(E,2),A=T[0],M=T[1],R=Object(a.useRef)(void 0),C=function(e,t,n,r,a){t-=10;var i=e.attackParameter.get(),s=e.decayParameter.get(),o=e.sustainParameter.get(),c=e.releaseParameter.get(),u=Math.sqrt(i+s+c),l=Dn(i,u,t),f=Dn(s,u,t),h=r&&c>0?Dn(c,u,t):0,p=Math.max(10,t-(l+f+h)),d=a?5+n-Math.sqrt((e.level+1)/2)*n:5;d=Math.min(n-5,d);var v=Math.min(n-Math.sqrt(o)*n+5,n-5);return[5,a?n/2-5:n,l,d,l+f,v,l+f+p,v,l+f+p+h,n]}(u,f,p,v,m);Object(a.useEffect)(function(){O!==u.attackParameter&&O!==u.decayParameter&&O!==u.sustainParameter&&O!==u.releaseParameter||M(O)},[M,O,u]),Object(a.useEffect)(function(){k(S)},[S]);var N=Object(a.useCallback)(function(e){if(S){var t=R.current.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top;S.forEach(function(e){var t=function(e,t,n,r,a,i){var s=t.attackParameter.get(),o=t.decayParameter.get(),c=t.sustainParameter.get(),u=t.releaseParameter.get(),l=Math.sqrt(s+o+u);if(n<5)return e.get();var f=1;if("Attack"===e.name)f=Math.min(_n,Math.max(In,l)*(n-5)/(.8*a));else if("Decay"===e.name)o=Math.max(In,l)*(n-5)/(.8*a)-Math.sqrt(s),f=Math.min(_n,Math.max(0,o));else if("Sustain"===e.name)c=(r=i-r)/i,f=Math.min(_n,Math.max(0,c));else{if("Level"===e.name){var h=(r=i-r)/i;return 2*Math.pow(h,2)-1}"Release"===e.name&&(u=Math.max(In,l)*Math.max(0,a-n-5)/a,f=Math.min(_n,Math.max(0,u)))}return Math.pow(f,2)}(e,u,n,r,f,p);e.set(t,!1)})}},[S,f,p]),q={};return y&&(q.backgroundColor=y),b&&(b=Fn.transparent(Fn.saturate(b,1),.2)),i.a.createElement(fn,{draggable:n,onDragOver:function(e){return e.preventDefault()},onDragStart:function(){return j(c?{type:"SYNTH_ENVELOPE",id:u.id,track:c.track,subType:d,instrument:c}:{type:"MODULE_ENVELOPE",id:u.id,subType:u.number,instrument:u})},element:"SYNTH_ENVELOPE",arg:d,className:"graphical-envelope"},i.a.createElement("div",{className:"env-toolbar"},i.a.createElement("div",{style:q,className:"env-name"},d),i.a.createElement(qn,{fullText:s,setParameter:M,selectedParameter:A,envelope:u,hasLevel:m,hasRelease:v})),A?i.a.createElement(Mn,{name:A.name,isParameter:!0,lfoEnabled:!0,sequencerEngine:o,parameter:A,min:A.min,max:A.max,step:.001}):"",i.a.createElement("div",{draggable:!0,onDragStart:function(e){return e.preventDefault()},className:"graphics-container"},i.a.createElement("svg",{ref:R,style:q,onMouseMove:N,onMouseUp:function(){return P(void 0)},onMouseLeave:function(){return P(void 0)},width:f,height:p},Bn(C,p,g,b),Ln(C,u,S,P,m)),i.a.createElement("div",{className:"env-slider"})))}),Jn=Object(o.b)(function(e,t){return{envelope:t.zenvelope.envelope,width:t.zobject.width,height:t.zobject.height,lineColor:t.zobject.attributes["primary-color"],fillColor:t.zobject.attributes["primary-color"],backgroundColor:t.zobject.attributes["secondary-color"]}},function(e){return{}})(function(e){e.zobject;var t=e.height,n=e.width,r=e.zenvelope,a=e.lineColor,s=e.fillColor,o=e.backgroundColor;return r.envelope?i.a.createElement(zn,{fillColor:s,lineColor:a,width:n,height:t,backgroundColor:o,name:"Env",draggable:!1,hasRelease:!0,envelope:r.envelope}):""}),Vn=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.variable,n=e.pattr.getVariableContext(t);return""===n?"":i.a.createElement("div",{className:"variable-context"},n)}),Hn=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.variable,n=e.pattr,r=t.getObjectType()!==_.d;return i.a.createElement("div",{className:"variable-name"},r?i.a.createElement("div",{style:{backgroundColor:t.attributes["secondary-color"]||"gray"},className:"v-color"}):i.a.createElement("img",{src:"/znumber-light.svg"}),i.a.createElement(Vn,{variable:t,pattr:n}))}),Un=Object(o.b)(function(e,t){return{value:t.variable.effect?t.variable.effect.value:t.variable.message}},function(e){return{}})(function(e){e.variable;var t=e.value;return i.a.createElement("div",{className:"variable-value"},t)}),Gn=(n(1730),function e(t){var n=t.pattr,o=t.planeMapping,u=Object(a.useRef)(),l=Object(a.useState)([]),f=Object(r.a)(l,2),h=f[0],p=f[1],d=Object(a.useState)(n.hiddenObjects),v=Object(r.a)(d,2),m=(v[0],v[1]);Object(a.useEffect)(function(){p(n.getOptionsAtLevel())},[p,n]);var y=!n.subpatch.zObject;Object(a.useEffect)(function(){if(u.current)return y&&u.current.addEventListener("mousewheel",k),function(){u.current&&u.current.removeEventListener("mousewheel",k)}},[y]);var b=Object(a.useCallback)(function(e){n.hideObject(e),m(Object(s.a)(n.hiddenObjects))},[m,n]),g=Object(a.useCallback)(function(){n.createParameters()},[n]),O=Object(a.useCallback)(function(){o&&(g(),n.parameters,o.randomlyMapParameters(n))},[n,o]),k=function(e){return e.stopPropagation()};return i.a.createElement("div",{ref:u,className:y?"varz base":"varz"},i.a.createElement("div",{onClick:O,className:o?"varz-level plane-mapping":"varz-level"},i.a.createElement("div",{className:"varz-name"},n.subpatch.zObject?n.subpatch.zObject.args[0]:""),i.a.createElement("div",{onClick:g,className:"create-parameters"},"Create Parameters")),i.a.createElement("div",{className:y?"varz-options base-level":"varz-options"},h.filter(function(e){return!n.hiddenObjects.includes(e)}).map(function(e){return i.a.createElement("div",{key:e.id,onClick:function(){return n.subpatch.dispatch(Object(c.wd)(e))},className:"varz-option"},i.a.createElement(Hn,{variable:e,pattr:n}),i.a.createElement(Un,{variable:e}),i.a.createElement("div",{onClick:function(t){return b(e)},className:"hide"},"Hide"))}),n.getNextLevels().filter(function(e){return e.getOptionsAtLevel().length>0||e.getNextLevels().length>0}).map(function(t){return i.a.createElement(e,{planeMapping:o,key:t.subpatch.id,pattr:t})})))}),Wn=Object(o.b)(function(e,t){return{planeMapping:e.effects.planeMapping}},function(e){return{}})(function(e){var t=e.zobject,n=e.pattr,r=e.planeMapping,a=e.containerRef;return i.a.createElement(Gn,{planeMapping:r,zobject:t,pattr:n,containerRef:a})}),Kn=n(539),Qn=n(122),Zn=function(e){return new Promise(function(t,n){var r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){var e=Object(R.a)(M.a.mark(function e(n){return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout(Object(R.a)(M.a.mark(function e(){var n;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qn.a.addArrayBuffer(r.result);case 2:n=e.sent,t(n);case 4:case"end":return e.stop()}},e)})),1e3);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()})},Yn=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.onDropCallback,n=e.imageHash,r=e.setImageHash,s=e.placeholder,o=void 0===s?"Drag thumbnail":s,c=Object(a.useCallback)(function(){var e=Object(R.a)(M.a.mark(function e(n){var a,i,s;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t(),n.dataTransfer){e.next=3;break}return e.abrupt("return");case 3:if(n.stopPropagation(),n.preventDefault(),n.dataTransfer.effectAllowed="none",n.dataTransfer.dropEffect="none",!n.dataTransfer.items){e.next=20;break}a=n.dataTransfer.items.length,i=0;case 10:if(!(i<a)){e.next=20;break}if("file"!==n.dataTransfer.items[i].kind){e.next=17;break}return e.next=14,Zn(n.dataTransfer.items[i].getAsFile());case 14:return s=e.sent,r(s),e.abrupt("return");case 17:i++,e.next=10;break;case 20:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[r]),u="";return u=n?i.a.createElement("div",{className:"inner"},i.a.createElement("img",{src:Qn.a.getHashUrl(n)}),i.a.createElement("span",{className:"drag-placeholder"},o)):i.a.createElement("span",null,o),i.a.createElement("div",{className:"image-handler"},i.a.createElement("div",{onDragOver:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.effectAllowed="none"},onDragEnter:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none"},onDrop:c,className:n?"drop-here loaded":"drop-here"},u))}),Xn=Object(o.b)(function(e,t){return{_imageHash:t.textureLoader.imageHash,loading:t.textureLoader.loading}},function(e){return{setUploadingFile:function(t){return e(Object(c.Je)(t))}}})(function(e){var t=e.setUploadingFile,n=e.textureLoader,s=e._imageHash,o=e.loading,c=Object(a.useState)(s),u=Object(r.a)(c,2),l=u[0],f=u[1];Object(a.useEffect)(function(){f(s)},[s,f]);return Object(a.useEffect)(function(){l&&n.loadImage(l).then(function(e){return t(!1)})},[l]),i.a.createElement("div",{className:"texture-loader"},o?i.a.createElement(Kn.a,{width:200,text:"Loading"}):i.a.createElement(Yn,{onDropCallback:function(){t(!0)},placeholder:"Drag new image here",imageHash:l,setImageHash:f}))}),$n=n(46);function er(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var tr=function(e){Object(b.a)(n,e);var t=er(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"onPlayMixClicked",value:function(e){this.props.setIsPlayingMix(!this.props.isPlaying),this.props.sequencerEngine.schedulePlay(),document.activeElement.blur()}},{key:"onClickRecordMixButton",value:function(){var e=this.props.isRecording||this.props.isRecordingMix;this.props.setIsRecordingMix(!e),this.props.sequencerEngine.recording(!e)}},{key:"onClickStop",value:function(){this.props.sequencerEngine.stop(),this.props.sequencerEngine.seekToTrackStep(0),this.props.setPianoRollCursor(void 0),this.props.setArrangementMouseX(void 0),this.props.setArrangementCursorStep(0)}},{key:"getPianoIcon",value:function(){return this.props.showPianoRoll&&this.props.bottomMode===ce.b?"/piano-roll-on.svg":"/piano-roll-off.svg"}},{key:"getPianoClass",value:function(){return this.props.showPianoRoll&&(this.props.bottomMode,ce.b),"piano-roll-button"}},{key:"onClickPianoRoll",value:function(){this.props.showPianoRoll&&this.props.bottomMode===ce.c?this.props.setArrangementBottomMode(ce.b):(this.props.setArrangementBottomMode(ce.b),this.props.setShowPianoRoll(!this.props.showPianoRoll))}},{key:"render",value:function(){var e=this,t="playpause ";return this.props.playScheduled&&(t+=" flashit"),i.a.createElement("div",{className:"mix-buttons"},i.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("PLAY_MIX_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:t},i.a.createElement("input",{onChange:function(t){return e.onPlayMixClicked(t)},checked:!this.props.isPlaying,type:"checkbox",value:!this.props.isPlaying,id:"playpause",name:"check"}),i.a.createElement("label",{className:this.props.isPlaying&&this.props.isPlayingMix?"mix":"",htmlFor:"playpause",tabIndex:1})),i.a.createElement("div",{onClick:function(){return e.onClickStop()},className:"stop-button"}),i.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("RECORD_MIX_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickRecordMixButton()},className:this.props.isRecording||this.props.isRecordingMix?"record-btn recording-dot":"record-btn not-recording-dot"}),i.a.createElement("img",{onClick:function(){return e.onClickPianoRoll()},onMouseOver:function(){return e.props.setContextualHelp("TRACK_PIANO_ROLL_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:this.getPianoClass(),src:this.getPianoIcon()}),i.a.createElement("img",{onMouseOver:function(){return e.props.setContextualHelp("ARRANGEMENT_LOOP_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickLooping()},className:"loop-icon",src:this.getLoopIcon()}))}},{key:"getLoopIcon",value:function(){return this.props.looping?"/arrow-loop-looping.png":"/arrow-loop.png"}},{key:"onClickLooping",value:function(){this.props.sequencerEngine.restartAllMixes(!this.props.looping),this.props.setLooping(!this.props.looping)}},{key:"getLoopClass",value:function(){return this.props.looping?"loop-icon looping":"loop-icon"}},{key:"onClickAutomationMode",value:function(){this.props.automationMode===$n.a?this.props.setProjectAutomationMode($n.b):this.props.automationMode===$n.b&&this.props.setProjectAutomationMode($n.a)}},{key:"getAutomationIcon",value:function(){return this.props.automationMode===$n.b?"/automation-icon-enabled.png":"/automation-icon-disabled.png"}}]),n}(a.Component),nr=Object(o.b)(function(e,t){var n=t.sequencerEngine.getSequenceId(),r=e.sequencer.isPlaying[n]||0;return{isRecordingMix:window.installation?e.sequencer.isRecording:e.mix.isRecordingMix,isRecording:e.sequencer.isRecording,isPlayingMix:e.mix.isPlayingMix,isPlaying:r,showPianoRoll:e.sequencer.showPianoRoll,automationMode:e.sequencer.automationMode,playScheduled:e.clock.playScheduled,looping:e.arrangement.looping,bottomMode:e.arrangement.bottomMode}},function(e){return{setShowPianoRoll:function(t){return e(Object(c.Nd)(t))},setIsPlayingMix:function(t){return e(Object(c.Kb)(t))},setIsRecordingMix:function(t){return e(Object(c.Nb)(t))},setProjectAutomationMode:function(t){return e(Object(c.Tc)(t))},setContextualHelp:function(t){return e(Object(c.Z)(t))},setLooping:function(t){return e(Object(c.z)(t))},setArrangementMouseX:function(t){return e(Object(c.A)(t))},setArrangementBottomMode:function(t){return e(Object(c.x)(t))},setArrangementCursorStep:function(t){return e(Object(c.y)(t))},setPianoRollCursor:function(t){return e(Object(c.Ic)(t))}}})(tr),rr=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.zobject;return i.a.createElement(nr,{sequencerEngine:t.sequencerEngine})}),ar=n(218);function ir(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var sr=function(e){Object(b.a)(n,e);var t=ir(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"render",value:function(){var e="small_checkmark ";return this.props.className&&(e+=this.props.className),i.a.createElement(Tn.a,{condition:this.props.condition},i.a.createElement("span",{className:e},i.a.createElement("div",{className:"small_checkmark_stem"}),i.a.createElement("div",{className:"small_checkmark_kick"})))}}]),n}(a.Component),or=n(545),cr=n(158),ur=n(155),lr=n(139),fr=n(784),hr=n(118),pr=n(146),dr=n(148),vr=function(){var e=Object(R.a)(M.a.mark(function e(t,n){var r,a,i,s=arguments;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:0,a=t.name,e.t0=dr.b,e.next=5,Qn.a.addJson(t);case 5:e.t1=e.sent,i=(0,e.t0)(e.t1),new ur.a(pr.c,"newEffect",[i,cr.a.utils.fromAscii(a),n,r]).execute();case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),mr=function(){var e=Object(R.a)(M.a.mark(function e(t){var n,r;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new lr.a((new fr.a).contractAddress).from(hr.l).select("title").select("ipfsHash").select("effectType").select("user"),t&&n.where("effectType",t),e.next=4,n.executeQuery();case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();function yr(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return br(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return br(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function br(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var gr=Object(o.b)(function(e,t){return{padFXMode:t.node&&e.pads.padFXMode[t.node.id]}},function(e){return{setBulkEffectsCollapsed:function(t){return e(Object(c.J)(t))},setShowingContextMenu:function(t){return e(Object(c.Ud)(t))},setWindowPositions:function(t){return e(Object(c.M)(t))}}})(function(e){var t=e.setWindowPositions,n=e.setBulkEffectsCollapsed,o=e.effect,c=e.initializeEffect,u=e.setShowingContextMenu,l=e.effectOptions,f=e.outputNumber,h=e.addToBack,p=void 0===h||h,d=e.isRoot,v=e.dropdownPosRef,m=e.node,y=e.sequencerEngine,b=void 0===y?m.sequencerEngine:y,g=e.dropdownPos,O=e.scale,k=e.setDropdownPos,j=e.allowSendsOnly,w=e.padFXMode,x=e.isMidi,S=Object(a.useState)([]),P=Object(r.a)(S,2),E=P[0],T=P[1];Object(a.useEffect)(function(){mr(x?"Midi Effect Rack":"Effect Rack").then(function(e){var t,n=[],r=yr(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push({label:a.title,value:a})}}catch(i){r.e(i)}finally{r.f()}T(n)})},[]);var A=Object(a.useCallback)(function(){m.padFXMode=w===or.b?or.a:or.b},[m,w]),C=Object(a.useCallback)(function(){var e=c("Midi Effect Rack",m);return m.midiEffects.addEffect(e),e},[m]),N=Object(a.useCallback)(function(e){var n=m.effectRack;d&&(v.current.x+=50,v.current.y-=50),x&&((n=m.midiEffects.effects.find(function(e){return"Midi Effect Rack"===e.name}))||(n=C()));var r=c(e,x?m:b);n.x||(n.x=v.current.x-150,n.y=v.current.y,n.outputNode.x=v.current.x+170,n.outputNode.y=v.current.y),d&&(v.current.x-=60),r.x=v.current.x,r.y=v.current.y;var a={};a[r.id]={x:r.x,y:r.y},a[n.id]={x:n.x,y:n.y},t(a),r.needsPlacement=!0,m.addRackEffect(r,p,o,f),k(void 0)},[m,g,k,d]),q=Object(a.useCallback)(function(e){var t=window.prompt("Preset name"),n=m.effectRack.getJson();vr(n,t)},[m]),I=Object(a.useCallback)(function(){var e=Object(R.a)(M.a.mark(function e(t){var r,a,i,o,c;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=m.effectRack)||(r=C()),Object(s.a)(r.effects),r.clearRack(),a=t.effectHash,e.next=7,Qn.a.getJson(a);case 7:return i=e.sent,m.updateEffectRedux([]),e.next=11,r.fromJson(i,m.sequencerEngine.tracks,0,!0,!1);case 11:x||m.linkEffectRackContext(),o={},r.effects.forEach(function(e){return o[e.id]=!0}),r.x=v.current.x-350,r.y=v.current.y-100,n(o),c=Math.max.apply(Math,Object(s.a)(r.effects.map(function(e){return e.x}))),r.outputNode.x=c+100,r.outputNode.y=v.current.y,m.updateEffectRedux();case 21:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[m]);return Object(a.useEffect)(function(){u(g)},[g]),i.a.createElement(Te,{dropdownPos:g?{x:g.x/O,y:g.y/O}:void 0},j&&i.a.createElement(Ae,{onMouseDown:A},"Sends Only",i.a.createElement(sr,{condition:w===or.b})),i.a.createElement(Me,{name:"Presets"},i.a.createElement(Ae,{className:"save-preset-item",onClick:q},i.a.createElement("div",null,"Save Preset"),i.a.createElement("img",{src:"/floppy-disk.svg",className:"save-preset-icon"})),E.map(function(e){var t=e.label,n=e.value;return i.a.createElement(Ae,{onMouseDown:function(){return I(n)}},t)})),x?i.a.createElement("div",null,i.a.createElement(Me,{name:"Standard Midi FX"},i.a.createElement("div",null,ar.e.map(function(e){var t=e.label,n=e.value;return i.a.createElement(Ae,{onMouseDown:function(){return N(n)}},t)}))),i.a.createElement(Me,{name:"Flow Midi FX"},i.a.createElement("div",null,ar.d.map(function(e){var t=e.label,n=e.value;return i.a.createElement(Ae,{onMouseDown:function(){return N(n)}},t)})))):i.a.createElement("div",{className:"fx-options"},l.map(function(e){var t=e.label,n=e.value;return i.a.createElement(Ae,{onMouseDown:function(){return N(n)}},t)})))}),Or=(n(1731),Object(o.b)(function(e,t){return{isCollapsed:e.effects.effectCollapsed[t.node.effectRack&&t.node.effectRack.id]}},function(e){return{setSelectedZObject:function(t){return e(Object(c.wd)(t))},setIsCollapsed:function(t,n){return e(Object(c.sb)(t,n))},setDrawingPadEdge:function(t,n){return e(Object(c.nb)(t,n))}}})(function(e){var t=e.setDrawingPadEdge,n=e.containerRef,r=(e.addToBack,e.node),s=(e.sequencerEngine,e.scale),o=void 0===s?1:s,c=e.number,u=e.hideNumber,l=e.sequencerScale,f=void 0===l?1:l,h=e.isMidi,p=e.trackPositions,d=(e.setSelectedZObject,e.isRoot),v=e.useClick,m=e.setIsCollapsed,y=e.isCollapsed,b=Object(a.useRef)(void 0),g=Se({ref:b}),O=g.onContextMenu,k=g.dropdownPos,j=g.setDropdownPos,w=Object(a.useCallback)(function(e){e.stopPropagation();var t=r.effectRack;t&&m(t.id,!y)},[y]),x=Ce(w,250,function(e){v&&O(e)}),S=Object(a.useRef)({x:0,y:0}),P=Object(a.useCallback)(function(e){var a=e.pageX,i=e.pageY;if(S.current.x=h?a+100:a+250,S.current.y=i,h){e.stopPropagation(),r.trackNode&&r.sequencerEngine.selectTrack(r.trackNumber);var s=n.current.getBoundingClientRect(),o=e.clientX-s.left,c=e.clientY-s.top,u={effect:void 0,rack:r.effectRack,x1:o,y1:c,x2:o,y2:c};t(r.subSequence.id,u)}},[]),E="output-node-"+r.id;h&&r.effectRack&&(E="effect-output-0-"+r.effectRack.id);var T={};if(void 0!==c){var A=p[r.id];A&&A.current?(A=A.current,T.top=A.offsetTop+5,f&&(T.top*=f)):T.top=25*(c+1)*o}var M="output-node";return y&&(M+=" collapsed"),i.a.createElement(fn,{element:d?"PAD_FX":void 0,style:T,id:E,onClick:x,onMouseDown:P,refObj:b,onContextMenu:O,className:M},y&&!u&&i.a.createElement("div",{className:"num-effects"},r.effectRack.effects.length),i.a.createElement(gr,{isMidi:h,addToBack:!h,isRoot:d,effectOptions:h?ar.e:ar.a,initializeEffect:h?ar.c:ar.b,setDropdownPos:j,dropdownPosRef:S,dropdownPos:k,node:r.effect||r}))})),kr=n(167),jr=n(159);function wr(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return xr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xr(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function xr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Sr=Object(a.memo)(function(e){var t=e.isBackground,n=e.className,r=e.zobject,o=e.width,c=e.height;e.setZObjectDebug;if(t&&(c=window.innerHeight-80,o=window.innerWidth-40),r.attributes["fill subpatch"]){for(var u=r.subSequence;u.subSequence&&!u.subSequence.tracks;)u=u.subSequence;u.zObject&&(o=u.zObject.width,c=u.zObject.height)}var l=Object(a.useRef)(!1),h=Object(a.useRef)(void 0),p=(Object(a.useRef)(void 0),Object(a.useRef)(void 0)),d=(Object(a.useRef)(void 0),rt({containerRef:h,scale:1}).getXY);Object(a.useEffect)(function(){return h.current.addEventListener("touchmove",v,{passive:!1}),function(){h.current&&h.current.removeEventListener("touchmove",v,{passive:!1})}},[]);var v=function(e){return e.preventDefault()},m=Object(a.useCallback)(function(){var e=Object(R.a)(M.a.mark(function e(t){var n,a,i,s,o,c,u,f,h;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l.current,t.changedTouches){[],"",n=wr(t.changedTouches);try{for(n.s();!(a=n.n()).done;)i=a.value,s=d(i),o=s.x,c=s.y,r.effect.onMouseMove(o,c)}catch(p){n.e(p)}finally{n.f()}}else u=d(t),f=u.x,h=u.y,r.effect.onMouseMove(f,h);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[r]),y=Object(a.useCallback)(function(){r.sequencerEngine.playing&&l.current&&(l.current=!1,r.effect.onMouseUp())},[r]),b=Object(a.useCallback)(function(e){var t=d(e),n=t.x,a=t.y;r.effect.onMouseClick(n,a)},[r]),g=Object(a.useCallback)(function(e){if(l.current=!0,!kr.isMobile||e.touches)if(e.changedTouches){var t,n,a=[],i=wr(e.changedTouches);try{for(i.s();!(n=i.n()).done;){var o=n.value,c=d(o),u=c.x,f=c.y;a=[].concat(Object(s.a)(a),[u,f])}}catch(m){i.e(m)}finally{i.f()}(t=r.effect).onMouseDown.apply(t,Object(s.a)(a))}else{var h=d(e),p=h.x,v=h.y;r.effect.onMouseDown(p,v)}},[r]),O=Object(a.useCallback)(function(e){if(!kr.isMobile||e.touches)if(l.current=!1,e.touches){var t=e.changedTouches[0],n=d(t),a=n.x,i=n.y;r.effect.onMouseUp(a,i)}else{var s=d(e),o=s.x,c=s.y;r.effect.onMouseUp(o,c)}},[r]);return Object(a.useEffect)(function(){p.current&&(p.current.setSize(o,c),p.current.setPixelRatio(window.devicePixelRatio)),r.effect&&(Object(f.b)("canvas.size",[o,c]),r.effect.sendMessage("size",[o,c]))},[o,c,r]),Object(a.useEffect)(function(){if(!r.effect.ctxt)return p.current=new jr.fb({antialias:!0,preserveDrawingBuffer:!0}),p.current.setClearColor(0,0),r.effect.ctxt=p.current,r.effect.renderer=p.current,p.current.setSize(o,c),p.current.setPixelRatio(2),r.effect.canvas=p.current.domElement,h.current.appendChild(p.current.domElement),function(){return r.effect.ctxt=void 0}},[]),t&&(n+=" canvas-background"),i.a.createElement("div",{className:n,onMouseMove:m,onMouseDown:g,onMouseLeave:y,onMouseUp:O,onTouchMove:m,onTouchStart:g,onTouchEnd:O,onClick:b,style:{width:o,height:c},ref:h})}),Pr=function(e){for(var t=e.subSequence;t.subSequence&&!t.subSequence.tracks;)t=t.subSequence;return t},Er=Object(o.b)(function(e,t){var n=Pr(t.zobject);return{isBackground:t.zobject.attributes["set as background"],outerWidth:n&&n.zObject&&n.zObject.width,outerHeight:t.zobject.subSequence.zObject&&t.zobject.subSequence.zObject.height,width:t.width||t.zobject.width,height:t.height||t.zobject.height}},function(e){return{setZObjectDebug:function(t){return e(Object(c.Te)(t))}}})(Sr);function Tr(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ar(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ar(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Ar(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Mr=function(e){var t=e.sampleDragging,n=e.slotNumber,r=e.slot,i=e.pad,s=e.sampleTagDragging,o=e.setSampleDragging,c=e.setSampleTagDragging,u=e.setTrackDragging,l=e.trackDragging;return{onDrop:Object(a.useCallback)(function(e){if(e.stopPropagation(),i.sequencerEngine.switchToSubSequence(i.subSequence.id),l)i.tracks.includes(l)?i.switch(n,i.tracks.indexOf(l)):i.addTrack(l,n);else if(t){var a=i.containsSample(t);if(a)i.switch(n,i.tracks.indexOf(a));else{var f,h=Tr(i.subSequence.tracks);try{for(h.s();!(f=h.n()).done;){var p=f.value;if(!p.isFrozen&&p.sample===t){var d=0===p.getEasyPattern().getAllSteps().length;return i.addTrack(p,n,d),void o(void 0)}}}catch(y){h.e(y)}finally{h.f()}i.slots[n]?t.audioBuffer?i.slots[n].useNewSound(t):t.load().then(function(e){return i.slots[n].useNewSound(t)}):i.newSample(t,n)}}else if(s){var v=i.sequencerEngine,m=v.state.selector.sampleTagDragging;Array.isArray(m)||(m=[m]),v.searchForSounds(m,r,r,void 0,!1).then(function(e){r||i.addTrack(e,n,!0)}),c(void 0)}u(void 0),o(void 0),u(void 0)},[t,r,n,i,s,l,u])}},Rr=new $e.a,Cr=Object(o.b)(function(e,t){return{sampleDragging:e.selector.sampleDragging,sampleTagDragging:e.selector.sampleTagDragging,trackDragging:e.tracks.trackDragging}},function(e){return{setSampleDragging:function(t){return e(Object(c.cd)(t))},setTrackDragging:function(t){return e(Object(c.je)(t))},setSampleTagDragging:function(t){return e(Object(c.fd)(t))},setParameterSliderDown:function(t){return e(Object(c.Cc)(t))},setArrangementBottomMode:function(t){return e(Object(c.x)(t))},setShowPianoRoll:function(t){return e(Object(c.Nd)(t))},setContextualHelp:function(t){return e(Object(c.Z)(t))},setSelectedZObject:function(t){return e(Object(c.wd)(t))}}})(function(e){var t=e.sampleDragging,n=e.slotNumber,r=e.pad,a=e.sampleTagDragging,s=e.setSampleDragging,o=e.setSampleTagDragging,c=e.slot,u=e.trackDragging,l=e.setTrackDragging,f=(e.setParameterSliderDown,e.setArrangementBottomMode,e.setShowPianoRoll,e.size),h=(e.setContextualHelp,e.setSelectedZObject),p=e.scale,d=e.attributes,v=Mr({sampleDragging:t,slotNumber:n,pad:r,sampleTagDragging:a,setSampleDragging:s,setSampleTagDragging:o,slot:c,trackDragging:u,setTrackDragging:l}).onDrop;return i.a.createElement("div",{style:{backgroundColor:d?d["slot-color"]&&Rr.transparent(Rr.saturate(d["slot-color"],1),d["slot-opacity"]||1):void 0,width:f,height:f,margin:3*p+"px"},onClick:function(e){e.stopPropagation(),h(void 0)},onDrop:v,className:"empty pad-slot"})}),Nr=n(215),qr=n(125);n(787);function Ir(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return _r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _r(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function _r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Dr=function(e,t){var n,r=[],a=[],i=Ir(t.slotTracks);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.sample?r.push(o.sample.getId()):o.preset&&o.preset.contentHash&&a.push(o.preset.contentHash)}}catch(c){i.e(c)}finally{i.f()}!function(e,t,n,r,a,i){new Promise(function(){var o=Object(R.a)(M.a.mark(function o(c){var u,l,f,h;return M.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return u=Object(je.a)({samples:n,presets:r,description:t,title:e},i),o.next=3,Qn.a.addJson(u);case 3:if(l=o.sent,c(l),console.log("saving pack PREVIOUS HASH =",a),f=cr.a.utils.padLeft("0x0",64),a&&(f=Object(dr.b)(a)),"PAD"!==u.type){o.next=11;break}return o.next=11,qr.a.xanadu.syncPadType(l,"PAD");case 11:h=[].concat(Object(s.a)(n),Object(s.a)(r)).filter(function(e){return e}),new ur.a(pr.m,"newPack",[Object(dr.b)(l),f,h.map(dr.b),cr.a.utils.fromAscii(e)]).execute();case 13:case"end":return o.stop()}},o)}));return function(e){return o.apply(this,arguments)}}())}(e,"",r,a,void 0,{type:"PAD",pad:t.getJsonForPack(),fx:t.effectRack.getJson()})},Fr=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.hide,n=e.pad,s=Object(a.useState)(""),o=Object(r.a)(s,2),c=o[0],u=o[1],l=Object(a.useCallback)(function(){Dr(c,n),t()},[c,t,n]);return i.a.createElement("div",{className:"pads save-pad"},i.a.createElement("div",{className:"pad-inner"},i.a.createElement("div",null,"Save as Pack"),i.a.createElement("input",{value:c,type:"text",className:"pack-name",onChange:function(e){return u(e.target.value)},placeholder:"Type name for pack"}),i.a.createElement("div",{className:"complete-buttons"},i.a.createElement("div",{onClick:l,className:"done-btn"},"Done"),i.a.createElement("div",{onClick:t,className:"cancel-btn"},"Cancel"))))}),Lr=Object(o.b)(function(e,t){return{tracks:t.pad.tracks}},function(e){return{}})(function(e){var t=e.pad,n=Object(a.useState)(1),o=Object(r.a)(n,2),c=o[0],u=o[1],l=Object(a.useState)(!1),f=Object(r.a)(l,2),h=f[0],p=f[1],d=Math.max.apply(Math,Object(s.a)(t.tracks.filter(function(e){return e}).map(function(e){return e.pattern.length()})));d===-1/0&&(d=32);var v=d/32;xe({clear:function(){return p(!1)},selected:h});var m=Object(a.useCallback)(function(e){e.stopPropagation(),t.tracks.filter(function(e){return e}).forEach(function(e){return e.halfTrackLength()}),u(c/2)},[t,u,c]),y=Object(a.useCallback)(function(e){e.stopPropagation(),t.tracks.filter(function(e){return e}).forEach(function(e){return se(e,void 0,t.sequencerEngine.resolution)}),u(2*c)},[t,u,c]),b="";return h&&(b=i.a.createElement("div",{className:"length-dropdown"},i.a.createElement("div",{onMouseDown:m,className:"length-btn"},"-"),i.a.createElement("div",{onMouseDown:y,className:"length-btn"},"+"))),i.a.createElement(fn,{element:"PADS_LENGTH_BUTTON",className:"pad-length"},b,"Length ",i.a.createElement("span",{onMouseDown:function(){return p(!0)},className:"bars"},v)," bars")}),Br=function(e){var t=e.element,n=e.option,r=e.name,a=e.mode,s=e.setMode,o="pad-toolbar-btn";return n===a&&(o+=" selected"),i.a.createElement(fn,{element:t,onClick:function(){return s(n===a?void 0:n)},className:o},r)},zr=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.pad,n=e.setMode,r=e.mode,s=Object(a.useCallback)(function(e){n("WAVEFORM"===r?void 0:"WAVEFORM")},[r,n]);return i.a.createElement("div",{className:"pad-toolbar"},i.a.createElement(Br,{element:"PADS_DELETE_BUTTON",mode:r,setMode:n,option:"DELETE",name:"Delete"}),i.a.createElement(Br,{element:"PADS_MUTES_BUTTON",mode:r,setMode:n,option:"MUTES",name:"Mutes"}),i.a.createElement(fn,{element:"PADS_WAVEFORM_BUTTON",onClick:s,className:"WAVEFORM"===r?"waveform-btn selected":"waveform-btn"},i.a.createElement("div",{className:"wave"}),i.a.createElement("div",{className:"wave"})),i.a.createElement(Lr,{pad:t}))}),Jr=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.setDropdownPos,n=e.dropdownPos,r=e.track,s=Object(a.useCallback)(function(){r.sequencerEngine.duplicateTrack(r.trackNumber),t(void 0)},[r,t]),o=Object(a.useCallback)(function(){for(var e=0;e<r.patterns.length;e++)if(e!==r.currentPattern){var n=r.pattern.getCopy();r.patterns[e]=n,r.pattern.syncBuckets()}t(void 0)},[r,t]),c=Object(a.useCallback)(function(){we(r),t(void 0)},[r,t]);return i.a.createElement(Te,{dropdownPos:n,setDropdownPos:t},i.a.createElement(Ae,{onMouseDown:s},"Duplicate ",i.a.createElement("div",{className:"key-shortcut"},"\u2318D")),i.a.createElement(Ae,{onMouseDown:c},"Save Preset"),i.a.createElement(Ae,{onMouseDown:o},"Copy Steps to All Patterns"))}),Vr=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.slotNumber,n=e.pad,s=(e.sliderMaterial,e.style),o=Object(a.useState)(void 0),c=Object(r.a)(o,2),u=c[0],l=c[1];return Object(a.useEffect)(function(){return l(n.newSliderRenderer(t)),function(){n.freeSliderRenderer(t)}},[]),u?i.a.createElement(Er,{className:"slider-canvas",width:s.width,height:s.height,zobject:u}):""}),Hr=n(402);n(270);function Ur(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var Gr=function(e){Object(b.a)(n,e);var t=Ur(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={height:0,referenceHeight:r.fromDecibel(0)},r}return Object(y.a)(n,[{key:"fromDecibel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-80,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;return e<-80?0:(this.props.height||45)*Math.pow((e-t)/(n-t),2)}},{key:"componentDidMount",value:function(){var e=this;this.timer=setInterval(function(){var t=e.props.meter.getLevel();e.setState({isRed:t>0,height:Math.min(60,e.fromDecibel(t))})},100)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){var e={height:this.state.height},t={height:this.state.referenceHeight},n="track-meter-value";return this.state.isRed&&(n+=" is-red"),i.a.createElement("div",{className:"track-meter"},i.a.createElement("div",{className:n,style:e}),i.a.createElement("div",{className:"track-meter-reference",style:t}))}}]),n}(a.Component),Wr=Object(o.b)(function(e,t){var n=t.track,r={};if(n){var a=e.tracks.triggers[n.trackNumber];if(a)for(var i in a)a[i]&&(r.playing=!0);r.playing||(r.playing=n.notesTriggered&&Object.keys(n.notesTriggered).length>0),r.isSelected=n&&e.mix.selectedTrack===n.trackNumber}return r},function(e){return{}})(function(e){var t=e.track,n=e.padRef,r=e.isSelected,i=e.playing;return Object(a.useEffect)(function(){if(!n.current)return"";if(i)n.current.className="pad-slot pressed";else{var e=n.current.className.split(" ").filter(function(e){return"pressed"!==e});n.current.className=e.join(" ")}if(r)n.current.className+=" selected";else{var a=n.current.className.split(" ").filter(function(e){return"selected"!==e});n.current.className=a.join(" ")}t.muted&&(n.current.className+=" muted")},[i,r]),""}),Kr=function(e,t,n,i,s,o,c){var u=Object(a.useRef)(0),l=Object(a.useState)(!1),f=Object(r.a)(l,2),h=f[0],p=f[1],d=Object(a.useRef)(!1),v=Object(a.useState)(void 0),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useState)(!1),O=Object(r.a)(g,2),k=O[0],j=O[1];Object(a.useEffect)(function(){d.current=h},[h]);var w=Object(a.useCallback)(function(){},[p,j]);Object(a.useEffect)(function(){return window.addEventListener("mousemove",x),window.addEventListener("mouseup",P),function(){return window.removeEventListener("mouseup",P)}},[j,t,i,p]);var x=Object(a.useCallback)(function(n){if(!n.metaKey&&"DELETE"!==i&&"MUTES"!==i&&d.current&&t){n.preventDefault(),n.stopPropagation();var r=n.clientY;n.touches&&(n.touches.length>0&&n.preventDefault(),r=function(e,t){var n=void 0;Array.isArray(t)||(t=[t]),t=t.map(function(e){return e.current});for(var r=0;r<e.touches.length;r++)if(t.includes(e.touches[r].target)){n=e.touches[r];break}return n}(n,o).clientY);var a=e.current.getBoundingClientRect(),s=e.current.offsetHeight,u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,r=arguments.length>3?arguments[3]:void 0,a=(e=Math.min(Math.max(0,e),r))/r,i=Math.pow(a,.5);return t+(n-t)*i}(s-(r-a.top),-65,6,s);c&&c.sendSliderLevels(),t.setVolume(u,!1,!1),j({x:n.clientX,y:n.clientY})}},[j,t,i]),S=Object(a.useCallback)(function(e){e.metaKey||e.ctrlKey||"DELETE"===i||"MUTES"===i||t&&(c&&c.mouseDown(c.slots.indexOf(t),!0),n(t.volumeParameter),p(!0),b({x:e.clientX,y:e.clientY}),u.current=(new Date).getTime())},[p,b,t,i]),P=Object(a.useCallback)(function(e){d.current&&(e.metaKey||(c.mouseDown(c.slots.indexOf(t),!1),j(void 0),p(!1),n(void 0)))},[j,p,k,y]);return{innerStyle:{height:t&&Qr(void 0!==s?s:t.volumeParameter.get(),-65,6,e.current&&e.current.offsetHeight)},onMouseLeave:w,onMouseDown:S,onMouseUp:P,onMouseMove:x,mouseDown:h}};function Qr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,r=arguments.length>3?arguments[3]:void 0,a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;return(e-t)/(n-t)}(e,t,n,r);return r*Math.pow(a,2)}n(876);var Zr=n(877),Yr=n(160),Xr=(n(1732),new $e.a),$r=(new Set(["clap","tom","toms","clave","perc","snare","kick","hi-hat","rim","side-stick","breaks","sub","ride","piano","violin"]),Object(o.b)(function(e,t){var n=t.track;return n&&n.tracks&&n.tracks[0]&&(n=n.tracks[0].track),t.track&&t.track.subSequence?{id:void 0===n?0:void 0!==n.sample&&void 0!==n.sample.getId()?n.sample.getId():n.presetName||n.getName&&n.getName(),_videoId:n&&n.sample&&n.sample.videoId,_discogsId:n&&n.sample&&n.sample.coverArtHash,isCompactMode:e.sequencer.isCompactMode&&!t.isBig,showingWaveform:e.sequencer.showPianoRoll&&(e.arrangement.bottomMode===ce.c||e.arrangement.bottomMode===ce.a),isLoading:void 0!==t.track&&!!e.tracks.trackIsLoading[t.track.subSequence.id]&&!0===e.tracks.trackIsLoading[t.track.subSequence.id][t.track.trackNumber]}:{}},function(e){return{setSampleDragging:function(t){return e(Object(c.cd)(t))},setTrackDragging:function(t){return e(Object(c.je)(t))}}})(function(e){var t=e.isLoading,n=e.hasInner,r=e.track,a=(e.isSelectedTrack,e.onMouseDown),s=void 0===a?function(){return[]}:a,o=e.sample,c=e.isPad,u=e.draggable,l=void 0===u||u,f=e.onClickThumbnail,h=e.showingWaveform,d=e.className,v=e.showPresetName,m=e.setSampleDragging,y=e.setTrackDragging,b=e.children,g=e.hasBorder,O=e.scale;o=o||r.sample;var k={backgroundColor:r&&r.getTrackType?Xr.getColorForTrack(r):o&&Xr.getColorForHash(o.getId())};g&&(k.borderColor=k.backgroundColor);var j="";if(h&&r&&(j=" showing-waveform "),d&&(j+=d+" "),!r&&!o)return"";var w=Object(Zr.a)(r,o);r&&r.getObjectType&&r.getObjectType()===_.c&&(r&&r.getTrackType()===oe.e&&(j+=" is-multi "),void 0!==w&&""!==w||v&&r&&(w=r.presetName||r.getName())),O&&(k.height=12*O+"px",k.lineHeight=12*O+"px",k.fontSize=6*O+"pt");var x=i.a.createElement("div",{draggable:l,onMouseDown:s,onClick:f,onDragStart:function(e){e.stopPropagation(),m(o),y(r)},onDragOver:function(e){return e.preventDefault()},className:"pushable sound-thumbnail "+j,style:k},w);if(o){var S=o.getThumbnail();S&&""!==S&&(x=i.a.createElement("img",{draggable:l,onMouseDown:s,onDragStart:function(e){e.stopPropagation(),y(r),m(o)},onDragOver:function(e){return e.preventDefault()},src:S,onClick:f,className:"pushable youtube-thumbnail "+j}))}return n&&r&&r.sample&&""!==r.sample.getThumbnail()&&r.sample.getThumbnail()&&(n=!1),c||(r.instrument&&r.instrument.getInstrumentType()===Yr.f?x=i.a.createElement("img",{onDragStart:function(e){e.stopPropagation(),y(r),m(o)},onClick:f,className:"pushable synth-icon",src:"/synth-icon.svg"}):r.getTrackType&&r.getTrackType()===oe.a&&(x=i.a.createElement("img",{onDragStart:function(e){e.stopPropagation(),y(r),m(o)},className:"live-loop-icon",src:"/live-loop-icon.svg"}))),i.a.createElement(fn,{element:void 0},i.a.createElement("div",{style:n&&k.backgroundColor?{backgroundColor:Xr.transparent(Xr.saturate(k.backgroundColor,1),.65)}:{},className:"youtube-info"},x,i.a.createElement(p.a,{className:"track-loading-spinner",sizeUnit:"px",size:10,color:"#123abc",loading:t}),b))})),ea=new $e.a,ta=Object(o.b)(function(e,t){var n=t.slot,r={sliderMaterial:t.pad.sliderMaterial,sampleId:n?void 0!==n.sample&&void 0!==n.sample.getId()?n.sample.getId():n.presetName||n.getName():0,sampleDragging:e.selector.sampleDragging,sampleTagDragging:e.selector.sampleTagDragging,isSelected:t.slot&&e.mix.selectedTrack===t.slot.trackNumber,trackDragging:e.tracks.trackDragging},a=t.slot;return a&&(r.isEnabled=a.isEnabled,r.muted=e.tracks.trackMutes[a.id],r.volume=e.tracks.trackVolumes[a.id]),r},function(e){return{setSampleDragging:function(t){return e(Object(c.cd)(t))},setTrackDragging:function(t){return e(Object(c.je)(t))},setSampleTagDragging:function(t){return e(Object(c.fd)(t))},setParameterSliderDown:function(t){return e(Object(c.Cc)(t))},setArrangementBottomMode:function(t){return e(Object(c.x)(t))},setShowPianoRoll:function(t){return e(Object(c.Nd)(t))},setContextualHelp:function(t){return e(Object(c.Z)(t))},setSelectedZObject:function(t){return e(Object(c.wd)(t))},setShowEditorBottom:function(t){return e(Object(c.Hd)(t))}}})(function(e){var t=e.muted,n=e.showCanvas,s=e.attributes,o=e.setSelectedZObject,c=e.size,u=e.setShowEditorBottom,l=e.trackToShow,f=e.scale,h=e.setContextualHelp,p=(e.sampleId,e.setTrackToShow),d=(e.playing,e.setParameterSliderDown),v=(e.notesTriggered,e.slotNumber),m=e.slot,y=e.pad,b=e.sampleDragging,g=e.setSampleDragging,O=e.isSelected,k=e.sampleTagDragging,j=e.setSampleTagDragging,w=e.mode,x=(e.setArrangementBottomMode,e.setShowPianoRoll,e.isEnabled),S=e.volume,P=e.setTrackDragging,E=e.trackDragging,T=e.sliderMaterial,A=Object(a.useRef)(void 0),M=Object(a.useRef)(void 0),R=Se({ref:A,useTop:!0}),C=R.onContextMenu,N=R.dropdownPos,q=R.setDropdownPos,I=Object(a.useState)(!1),_=Object(r.a)(I,2),D=_[0],F=_[1],L=Object(a.useCallback)(function(e){e.stopPropagation(),m&&u(y.state.spatial.showEditorBottom===Hr.b?void 0:Hr.b)},[m]),B=Ce(L,250,function(e){return e.stopPropagation()});Object(a.useEffect)(function(){return window.addEventListener("keydown",z),window.addEventListener("keyup",J),function(){window.removeEventListener("keydown",z),window.removeEventListener("keyup",J)}},[F]),Object(a.useEffect)(function(){F(!1)},[E,m,F]);var z=Object(a.useCallback)(function(e){"Shift"===e.key&&F(!0)},[F]),J=Object(a.useCallback)(function(e){"Shift"===e.key&&F(!1)},[F]),V=Kr(A,m,d,w,S,[A,M],y),H=V.innerStyle,U=V.onMouseDown,G=V.onMouseMove,W=V.onMouseLeave,K=V.mouseDown,Q=V.onMouseUp,Z=Mr({sampleDragging:b,slotNumber:v,pad:y,sampleTagDragging:k,setSampleDragging:g,setSampleTagDragging:j,slot:m,trackDragging:E,setTrackDragging:P}).onDrop,Y=Object(a.useCallback)(function(e){e.stopPropagation(),m&&(y.sequencerEngine.selectTrack(m.trackNumber),U(e),"DELETE"===w?m.deleting=!0:"MUTES"===w&&m.mute(!t))},[D,w,m,U,l,p,t]),X=Object(a.useCallback)(function(e){e.stopPropagation(),m&&(y.sequencerEngine.selectTrack(m.trackNumber),Q(e),"DELETE"===w&&(m.deleting=!1))},[w,m,Q]),$=(Object(a.useCallback)(function(e){e.stopPropagation(),m&&y.sequencerEngine.selectTrack(m.trackNumber),y.sequencerEngine.state.zobject.selectedZObject&&o(void 0)},[m,y]),Object(a.useCallback)(function(e){m&&(m.gated=!m.gated)},[m]),Object(a.useCallback)(function(e){e.stopPropagation(),m.toggleEnabled()},[x,m])),ee="pad-slot";m||(ee+=" empty"),O&&(ee+=" selected"),"DELETE"===w&&K&&(ee+=" deleting"),t&&(ee+=" muted");var te=void 0;m&&(te=m.getKeyMapping()),D&&(ee+=" slot-draggable");var ne=!n&&m&&ea.getColorForTrack(m);ne&&m.sample&&m.sample.getThumbnail()&&m.sample.getThumbnail(),s&&s["slot-color"]&&(ne=ea.transparent(ea.saturate(s["slot-color"],1),s["slot-opacity"]||1));var re={backgroundColor:ne,width:c,height:c,margin:3*f+"px"};Object(a.useEffect)(function(){return kr.isMobile&&A.current.addEventListener("touchmove",G,{passive:!1}),function(){A.current&&kr.isMobile&&A.current.removeEventListener("touchmove",G,{passive:!1})}},[m,w]);var ae=s&&!s["Show Track Names"];return i.a.createElement("div",{style:re,onContextMenu:C,ref:A,onClick:B,onMouseMove:G,onMouseOver:function(){return h(m?"PADS_SLOT":"PADS_SLOT_EMPTY")},onTouchStart:U,onMouseUp:X,onMouseLeave:function(e){h(void 0),W(e)},onDragEnter:function(e){e.dataTransfer.dropEffect="move"},onDragOver:function(e){e.dataTransfer.dropEffect="move",e.stopPropagation(),e.preventDefault()},onDrop:Z,onMouseDown:m?Y:function(){return[]},className:ee},m&&i.a.createElement(Jr,{dropdownPos:N,setDropdownPos:q,track:m}),i.a.createElement(Wr,{padRef:A,track:m}),i.a.createElement("div",{className:"inner-slot"},m&&!ae?i.a.createElement($r,{isPad:!0,scale:f,onMouseDown:function(e){e.metaKey||t||e.stopPropagation()},showPresetName:!0,track:m}):"",i.a.createElement("div",{ref:M,className:K?"volume-indicator":"volume-indicator skinny",style:Object(je.a)({},H,{width:K?c:void 0})},T&&i.a.createElement(Vr,{pad:y,mouseDown:K,slotNumber:v,sliderMaterial:T,style:Object(je.a)({},H,{width:K?c:8})})),!n&&m&&i.a.createElement(Gr,{height:c,meter:m.trackMeter}),m&&i.a.createElement("div",{onMouseDown:$,className:x?"recording-dot enabled":"recording-dot"}),te&&i.a.createElement("div",{className:"pad-key-map"},te.toUpperCase())))}),na=Object(o.b)(function(e,t){return{tracks:t.pad.tracks,selectedTrack:e.mix.selectedTrack,trackToShow:e.pads.padsExpand&&e.pads.padsExpand.pad===t.pad?e.pads.padsExpand:void 0,isSelected:e.windows.selectedElements[t.pad.id],showCanvas:t.pad.showCanvas}},function(e){return{setShowPadSequencer:function(t){return e(Object(c.Ld)(t))},setTrackToShow:function(t){return e(Object(c.wc)(t))}}})(function(e){var t=e.pad,n=(e.scrollContainer,e.selectedTrack),s=e.setShowPadSequencer,o=e.tracks,u=(e.setPadExpand,e.trackToShow),l=e.setTrackToShow,f=e.width,h=e.height,p=e.attributes,d=e.showCanvas,v=(e.zobject,e.isPulled,e.isSelected,Object(a.useRef)(void 0)),m=Object(a.useRef)(void 0),y=Object(a.useRef)(void 0),b=Ce(function(e){}),g=Object(a.useState)(!1),O=Object(r.a)(g,2),k=O[0],j=O[1],w=Object(a.useState)(void 0),x=Object(r.a)(w,2),S=x[0],P=x[1];Object(a.useEffect)(function(){var e=t.tracks.find(function(e,t){return e&&e.trackNumber===n});e&&void 0!==u&&l(e)},[u,n,l,t,o]);Object(a.useCallback)(function(){if(u)return l(void 0);if(void 0!==n){var e=t.sequencerEngine.tracks[n];if(t.tracks.some(function(t){return t===e}))return void l(e)}var r=t.tracks.filter(function(e){return e});0!==r.length&&l(r[0])},[n,u,t,l]),Object(a.useCallback)(function(){t.slotTracks.forEach(function(e){return e.pattern.clear()}),t.sequencerEngine.updateTracks()},[t]);var E="pads";if("DELETE"===S?E+=" delete-mode":"MUTES"===S&&(E+=" mute-mode"),k)return i.a.createElement(Fr,{hide:function(){return j(!1)},pad:t});var T={},A={};p&&(A.backgroundColor=p["primary-color"],T.backgroundColor=p["secondary-color"]),T.width=f,T.height=h,T.borderRadius=f/191*15,p&&p["border-radius"]?A.borderRadius=p["border-radius"]/1.2+"px":A.borderRadius=f/191*8;var M={borderRadius:f/191*8};d?(E+=" show-canvas",T.borderColor=p["secondary-color"]):E+=" no-canvas";var R=f/191*3,C=f-26,N=isNaN(p["Pads Per Row"])?3:p["Pads Per Row"],q=(C-2*N*R)/N;return i.a.createElement("div",{ref:m,onClick:b,style:T,onMouseDown:function(){y.current=t.sequencerEngine.state.windows.windowPositions[t.id]},onMouseUp:function(){if(t.sequencerEngine.state.windows.windowPositions[t.id]){var e=t.sequencerEngine.state.windows.windowPositions[t.id],n=e.x;e.y,y.current&&n===y.current.x&&y.current.y}},onDrop:function(e){return e.stopPropagation()},className:E},i.a.createElement("div",{style:M,className:"pad-inner"},i.a.createElement("div",{style:A,className:"slots-and-track"},i.a.createElement("div",null,i.a.createElement(fn,{element:"GO_TO_PAD_SEQUENCER",onClick:function(){Object(c.wd)(void 0),s(t)},className:"step-sequencer-btn"},i.a.createElement("div",{className:"pad-dot"}),i.a.createElement("div",{className:"pad-dot"}),i.a.createElement("div",{className:"pad-dot"})),d&&i.a.createElement(Er,{className:"pad-canvas",width:f-13,height:h-18,zobject:t.canvas}),i.a.createElement(zr,{mode:S,setMode:P,pad:t}),i.a.createElement("div",{style:{width:C},className:"pad-slots"},t.tracks.map(function(e,n){return e?i.a.createElement(ta,{attributes:p,showCanvas:d,size:q,scale:f/191,setTrackToShow:l,trackToShow:u,key:n,slotNumber:n,pad:t,slot:e,mode:S}):i.a.createElement(Cr,{attributes:p,scale:f/191,size:q,pad:t,slotNumber:n})})))),i.a.createElement("div",{className:"pad-bottom",ref:v})))}),ra=Object(o.b)(function(e,t){return{pad:t.padWrapper.pad,styling:e.zobject.objectStylings[t.zobject.id],width:t.zobject.width,height:t.zobject.height}},function(e){return{}})(function(e){var t=e.scrollContainer,n=e.pad,r=e.zobject,a=(e.padWrapper,e.styling,e.width),s=e.height;return n?i.a.createElement("div",{className:"z-pad"},i.a.createElement(na,{zobject:r,width:a-10,height:s,attributes:r.attributes,scrollContainer:t,isPulled:!0,pad:n}),i.a.createElement(nt,{subSequence:r.subSequence,effect:n}),i.a.createElement(it,{subSequence:r.subSequence,containerRef:t,effect:n}),i.a.createElement(Or,{isRoot:!0,useClick:!0,hideNumber:!0,sequencerEngine:n.sequencerEngine,node:n})):""}),aa=Object(o.b)(function(e,t){return{implements:t.instance&&t.instance.implements}},function(e){return{}})(function(e){var t=e.instance;if(!t)return"empty";var n=t.implements;if(!n)return"not found";var r=n.instances.indexOf(t)+1,a=n.zObject.args[0],s=Math.max(n.inletObjects.length,n.outletObjects.length),o={};return o.minWidth=26*s+"px",o.width=Math.max(120,26*s)+"px",i.a.createElement("div",{style:o,className:"instance-sub-patch"},i.a.createElement("span",{className:"implement-name"},a)," instance #",r)}),ia=n(878),sa=n(59),oa=Object(o.b)(function(e,t){return{isMacroMapping:e.effects.isMacroMapping}},function(e){return{setParameterToMap:function(t){return e(Object(c.Dc)(t))},setIsMacroMapping:function(t){return e(Object(c.Ib)(t))}}})(function(e){e.track;var t=e.isMacroMapping,n=e.setIsMacroMapping,r=e.onClick,a=e.setParameterToMap,s=e.label,o="macro-map-button";return t&&(o+=" mapping"),i.a.createElement("div",{onClick:function(e){e.stopPropagation();var i=!t;a(void 0),n(i),r&&r(i)},className:o},s||"Map")}),ca=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.effect,n=Object(a.useRef)(void 0),s=Object(a.useState)(t.messageText),o=Object(r.a)(s,2),c=o[0],u=o[1],l=Object(a.useState)(!1),f=Object(r.a)(l,2),h=f[0],p=f[1],d=Ce(function(){return p(!0)},250,function(){return t.execute()});Object(a.useEffect)(function(){h&&n.current.focus()},[h]);var v=Object(a.useCallback)(function(e){"Enter"===e.key&&(t.messageText=c,t.execute(),p(!1))},[p,c]);return i.a.createElement("div",{onMouseDown:function(e){h&&e.stopPropagation()},className:"message-button"},h?i.a.createElement("input",{ref:n,onKeyDown:v,value:c,onChange:function(e){return u(e.target.value)}}):i.a.createElement("div",{onClick:d,className:"message-content"},c))}),ua=Object(o.b)(function(e,t){return{locked:t.effect.locked}},function(e){return{}})(function(e){var t=e.togglePresets,n=(e.setContextualHelp,e.showPresets),r=e.effect,s=e.locked,o=Object(a.useCallback)(function(){r.lock=!s},[r,s]);return i.a.createElement(fn,{element:n?"EFFECT_RETURN_PRESETS_BUTTON":"EFFECT_PRESETS_BUTTON",className:"bottom-effect-toolbar"},i.a.createElement("img",{onClick:o,src:s?"/closed-padlock.png":"/opened-padlock.png",className:"effect-lock"}),i.a.createElement("img",{onClick:t,src:"/floppy-disk.svg",className:n?"load-preset-button selected":"load-preset-button"}))}),la=(n(1733),function(e){if(!e)return"";e=e.trim();for(var t="",n=0;n<e.length;n++)e.charCodeAt(n)>=32&&(t+=e[n]);return t}),fa=function(e){var t=e.effect,n=e.hide,s=e.sequencerEngine,o=(e.trackNumber,Object(a.useState)("")),u=Object(r.a)(o,2),l=u[0],f=u[1],h=Object(a.useState)([]),p=Object(r.a)(h,2),d=p[0],v=p[1],m=Object(a.useState)(!1),y=Object(r.a)(m,2),b=y[0],g=y[1],O=Object(a.useCallback)(function(){var e=t.getJson();vr(e,l),n()},[l,n,t]),k=Object(a.useCallback)(function(){var e=Object(R.a)(M.a.mark(function e(r){var a,i,o,u,l;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g(r),a=t.id,i=t.x,o=t.y,e.next=4,Qn.a.getJson(r.effectHash);case 4:return u=e.sent,e.next=7,t.fromJson(u,!0);case 7:l=e.sent,t.id=a,t.x=i,t.y=o,t.track&&t.track.loadLostParameters&&t.track.loadLostParameters(),t.preset=r.effectHash,s.dispatch(Object(c.ub)(l)),g(void 0),n();case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[g,t]);Object(a.useEffect)(function(){mr(t.name).then(function(e){return v(e)})},[v,t]);var j="save-button";return""===l&&(j+=" disabled"),i.a.createElement("div",{className:"effect-presets"},i.a.createElement("div",{className:"presets-container"},d.map(function(e){return i.a.createElement(ha,{id:e.effectHash,isLoading:e===b,isSelected:e.effectHash===t.preset,onClick:function(){return k(e)},preset:e})})),i.a.createElement("div",{className:"save-container"},i.a.createElement("input",{type:"text",className:"save-input",placeholder:"Type name to save",value:l,onChange:function(e){return f(e.target.value)}}),i.a.createElement("div",{onClick:O,className:j},"SAVE")))},ha=function(e){var t=e.preset,n=e.onClick,s=e.isSelected,o=e.isLoading,c=Object(a.useState)(""),u=Object(r.a)(c,2),l=u[0],f=u[1];Object(a.useEffect)(function(){qr.a.users.getUserName(t.user).then(function(e){return f(e)})},[f]);var h="effect-preset";return s&&(h+=" selected"),o&&(h+=" loading"),i.a.createElement("div",{onClick:n,className:h},i.a.createElement("div",{className:"preset-title"},la(t.title)),i.a.createElement("div",{className:"preset-author"},l))};function pa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var da=function(e){Object(b.a)(n,e);var t=pa(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={minValue:r.min,maxValue:r.max},r}return Object(y.a)(n,[{key:"parameter",get:function(){return this.props.parameterMod.parameter}},{key:"mod",get:function(){return this.props.parameterMod}},{key:"min",get:function(){return this.mod.scale.min}},{key:"max",get:function(){return this.mod.scale.max}},{key:"onChangeMin",value:function(e){(Object(fe.a)(e)||"."===e||""===e||"-"===e)&&(this.setState({minValue:e}),Object(fe.a)(e)?(console.log("returning because = "+e),this.mod.min=e):"."!==e&&""!==e&&"-"!==e||(this.mod.min=0))}},{key:"onChangeMax",value:function(e){Object(fe.a)(e)||"."===e||""===e||"-"===e?(this.setState({maxValue:e}),Object(fe.a)(e)?this.mod.max=e:"."!==e&&""!==e&&"-"!==e||(this.mod.max=0)):console.log("returning because = "+e)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"parameter-mod"},i.a.createElement("div",{className:"parameter-mod-pieces"},i.a.createElement("div",{className:"parameter-mod-modulator"},this.mod.type," ",this.mod.modulator.number," "),i.a.createElement("div",{className:"parameter-mod-text"},"mod"),i.a.createElement("div",{className:"parameter-mod-parameter"},this.parameter.name," ")),i.a.createElement("div",{className:"parameter-mod-min"},"Min:",i.a.createElement(va,{placeholder:"Min",onChange:function(t){return e.onChangeMin(t)},number:this.state.minValue})),i.a.createElement("div",{className:"parameter-mod-max"},"Max:",i.a.createElement(va,{placeholder:"Max",onChange:function(t){return e.onChangeMax(t)},number:this.state.maxValue})))}}]),n}(a.Component),va=function(e){Object(b.a)(n,e);var t=pa(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"number-input-container"},i.a.createElement(pn.b,Object(Fe.a)({onChange:function(t){return e.props.onChange(t.target.value)},value:this.props.number,className:"search-input",placeholder:this.props.placeholder},"className","number-input")))}}]),n}(a.Component),ma=da;function ya(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}a.Component;var ba=function(e){Object(b.a)(n,e);var t=ya(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={option:void 0},r}return Object(y.a)(n,[{key:"options",get:function(){return this.props.parameters.map(function(e){return{value:e,label:e.name}})}},{key:"onChooseParameter",value:function(e){this.setState({option:e})}},{key:"render",value:function(){var e=this;return i.a.createElement(vt.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.options,onChange:function(t){return e.onChooseParameter(t)},value:this.state.option,placeholder:"Parameter"})}}]),n}(a.Component);function ga(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var Oa=function(e){Object(b.a)(n,e);var t=ga(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"parameterMods",get:function(){var e=[];return this.props.parameters.forEach(function(t){return e=e.concat(t.parameterMods)}),e}},{key:"render",value:function(){return i.a.createElement("div",null,this.parameterMods.map(function(e,t){return i.a.createElement(ma,{key:"mod-"+t+"-"+e.parameter.id,parameterMod:e})}))}}]),n}(a.Component);n(1734);function ka(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var ja=new $e.a,wa=function(e){Object(b.a)(n,e);var t=ka(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={showMods:!1,isCollapsed:e.isMixCollapsed||e.isCollapsed,isDraggable:void 0===e.isDraggable||e.isDraggable,showPresets:!1},r.togglePresets=r.togglePresets.bind(Object(C.a)(r)),r}return Object(y.a)(n,[{key:"togglePresets",value:function(){this.setState({showPresets:!this.state.showPresets})}},{key:"shouldComponentUpdate",value:function(e){return e.isCollapsed!==this.props.isCollapsed&&(this.state.isCollapsed=e.isCollapsed),!0}},{key:"toggleCollapsed",value:function(){this.props.effect.isEnabled()&&this.props.setEffectCollapsed(this.props.effect.id,!this.state.isCollapsed)}},{key:"deleteEffect",value:function(){(!this.props.instrument&&!this.props.isPulled||this.props.effect.track&&this.props.effect.track.tracks)&&this.operationManager.dispatch(Object(X.e)(this.props.effect,this.props.track,this.props.group,this.props.send)),this.props.onDeleteEffect&&this.props.onDeleteEffect(this.props.effect)}},{key:"handleToggle",value:function(){this.operationManager.dispatch(Object(X.q)(this.props.effect,this.props.track,this.props.group,this.props.send)),this.props.onToggle()}},{key:"getTrackOrGroup",value:function(){return this.props.send||this.props.track||this.props.group}},{key:"operationManager",get:function(){return this.props.sequencerEngine.operationManager}},{key:"getContextNumber",value:function(){return void 0!==this.props.track?this.props.track.trackNumber:void 0!==this.props.group?this.props.group.groupNumber:1}},{key:"onDragStart",value:function(e){if(this.state.isDraggable&&!this.props.automation&&this.getTrackOrGroup()){var t=this.getTrackOrGroup().getEffectNumber(this.props.effect,this.props.isMidiEffect);this.props.isLiveEffect||this.props.isMidiEffect?(this.props.clearDragDrop(),this.props.dragMidiEffect({number:this.getContextNumber(),effectNumber:t,effect:this.props.effect})):(this.props.clearDragDrop(),this.props.dragEffect({number:this.getContextNumber(),effectNumber:t,effect:this.props.effect}))}}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"onDragOver",value:function(e){this.state.isDraggable&&e.preventDefault()}},{key:"onDrop",value:function(e){if(this.props.featured){var t=this.props.effectDragging||this.props.midiEffectDragging;if(!t)return;return function(e,t,n){if(e!==t){var r,a=n.state.effects.pulledEffects,i=n.state.effects.pulledEffects.indexOf(e),o=n.state.effects.pulledEffects.indexOf(t);o>i?(r=[].concat(Object(s.a)(a.slice(0,i)),[t],Object(s.a)(a.slice(i,o))),a.length>o+1&&(r=[].concat(Object(s.a)(r),Object(s.a)(a.slice(o+1))))):(r=[].concat(Object(s.a)(a.slice(0,o)),Object(s.a)(a.slice(o+1,i)),[e,t]),a.length>i+1&&(r=[].concat(Object(s.a)(r),Object(s.a)(a.slice(i+1))))),n.dispatch(Object(c.Vc)(r))}}(this.props.effect,t.effect,this.props.sequencerEngine),this.props.dragEffect(void 0),void this.props.dragMidiEffect(void 0)}if(this.state.isDraggable&&!this.props.automation&&this.getTrackOrGroup()){if(void 0!==this.props.effectDragging){var n=this.getTrackOrGroup().getEffectNumber(this.props.effect,this.props.isMidiEffect);if(this.props.isMidiEffect)return void this.props.dragEffect(void 0);this.props.effectDragging.number===this.getContextNumber()&&this.operationManager.dispatch(Object(X.k)(this.props.effectDragging.effectNumber,n,!1,this.props.track,this.props.group,this.props.send)),this.props.dragEffect(void 0)}else{if(void 0===this.props.midiEffectDragging)return;var r=this.getTrackOrGroup().getEffectNumber(this.props.effect,this.props.isMidiEffect);this.props.isMidiEffect&&this.props.midiEffectDragging.number===this.getContextNumber()&&this.operationManager.dispatch(Object(X.k)(this.props.midiEffectDragging.effectNumber,r,!0,this.props.track,this.props.group,this.props.send)),this.props.dragMidiEffect(void 0),this.props.dragEffect(void 0)}this.props.onDeleteEffect()}}},{key:"getClassName",value:function(e){return this.props.effect.isEnabled()?e:e+" disabled"}},{key:"detachEffect",value:function(e){var t=this.props.sequencerEngine.state,n=[].concat(Object(s.a)(t.effects.pulledEffects),[this.props.effect]);this.props.setPulledEffects(n)}},{key:"selectEffect",value:function(e){if(e.stopPropagation(),this.props.linkingEffects)return this.props.linkingEffects.effect.linkedEffect=this.props.effect,void this.props.setLinkingEffects(void 0);this.props.planeMapping&&this.props.planeMapping!==this.props.effect&&(this.setState({isMapped:!0}),this.props.planeMapping.randomlyMapParameters(this.props.effect));var t=this.props.track?this.props.track.sequencerEngine:this.props.effect.sequencerEngine;t&&!this.props.noSelect&&t.selectEffect(this.props.effect),this.props.noSelect||this.props.setSelectedEffect(this.props.effect.id)}},{key:"render",value:function(){var e=this;if(!this.props.effect.name)return"";var t=this.props.isTall?"tall-effect effect":"effect";this.props.effectClass&&(t+=" "+this.props.effectClass);var n=void 0!==this.props.automation?"enabled "+t+" effect-automation":this.props.effect.isEnabled()?t+" enabled":"effect disabled";this.props.isSelectedZObject&&(n+=" selected-zobject");var r=!1;this.props.effect&&this.props.effect.track&&this.props.effect.track.tracks&&(r=!0),n+=" "+this.props.effect.name.split(" ").join("_")+" ",this.state.isCollapsed&&(n+=" collapsed"),this.props.isSelected&&(n+=" selected"),this.props.isMidiEffect&&(n+=" midi"),this.props.isLiveEffect&&(n+=" live"),"Midi Effect Rack"!==this.props.effect.name&&"Effect Rack"!==this.props.effect.name||(n+=" racked"),"Jaki"===this.props.effect.name&&(n+=" Jaki");var a="effect-header";if(this.props.hideBarButtons&&(a+=" hide-buttons"),this.props.planeMapping&&this.props.planeMapping!==this.props.effect&&(this.state.isMapped||(n+=" plane-mapping")),this.props.linkingEffects&&this.props.effect.name===this.props.linkingEffects.name&&(n+=" plane-mapping"),"Message"===this.props.effect.name)return i.a.createElement(ca,{effect:this.props.effect});if(this.props.isPulled)return n+=" pulled",i.a.createElement("div",{onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onDrop:function(t){e.onDrop(t)},draggable:this.state.isDraggable,className:n},i.a.createElement("div",{className:"effect-header"},this.props.effect.name),i.a.createElement("div",{className:"effect-inner"},i.a.createElement("img",{src:"/detached.svg",className:"detached-icon"}),i.a.createElement("div",{className:"detached-label"},"Detached")));var s=function(){var t,n=e.props.effect,r=(t=n)&&t.getEffectType&&t.getEffectType()!==sa.a&&t.track?t.track:t.context?t.context.track:t.track;return r?i.a.createElement("div",{style:{backgroundColor:r.color||ja.getColorForTrack(r)},className:"effect-from"},r.envelopesTrack?r.name:r.getName()):""};return this.props.showStar&&(a+=" showing-star"),i.a.createElement("div",{onClick:function(t){return e.selectEffect(t)},onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onDrop:function(t){e.onDrop(t)},draggable:!this.props.hideIOs&&!this.props.noSelect&&this.state.isDraggable,className:n},i.a.createElement("div",{className:a},i.a.createElement(Tn.a,{condition:!this.props.hideBarButtons},i.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"EFFECT_TOGGLE_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.handleToggle()},className:"effect-toggle"},i.a.createElement("div",{className:"toggle-icon"})),i.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"EFFECT_COLLAPSE_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.toggleCollapsed()},className:"collapse-toggle"},i.a.createElement(Tn.a,{condition:this.state.isCollapsed},i.a.createElement("div",{className:"arrow-down"})),i.a.createElement(Tn.a,{condition:!this.state.isCollapsed},i.a.createElement("div",{className:"arrow-right"})))),i.a.createElement(Tn.a,{condition:this.props.effect.isEnabled()&&!this.state.isCollapsed},i.a.createElement("div",{className:"effect-name"},this.props.effect.name)),this.props.featured&&s(),this.props.featured?"":i.a.createElement("img",{onClick:function(){return e.detachEffect()},src:"/detached.svg",className:"detach-effect-icon"}),this.props.alternateButton||"",i.a.createElement(Tn.a,{condition:!this.props.hideBarButtons&&void 0===this.props.automation&&!this.state.isCollapsed},this.props.showStar&&i.a.createElement("div",{onClick:function(){return e.props.setStarred(!e.props.isStarred)},className:this.props.isStarred?"starred star":"star"},i.a.createElement("span",null,"\u2606")),i.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"EFFECT_DELETE_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"effect-delete-btn delete-button",onClick:function(){return e.deleteEffect()}},r||!this.props.featured||this.props.showDelete?"x":"-"))),i.a.createElement(Tn.a,{condition:this.state.showPresets},i.a.createElement(fa,{sequencerEngine:this.props.sequencerEngine,trackNumber:this.props.track&&this.props.track.trackNumber,hide:function(){return e.setState({showPresets:!1})},effect:this.props.effect})),i.a.createElement(Tn.a,{condition:!this.state.showPresets},i.a.createElement("div",{className:"inner-effect"},i.a.createElement(Tn.a,{condition:!this.props.effect.isEnabled()||this.state.isCollapsed},i.a.createElement("div",{className:"effect-name"},this.props.name||this.props.effect.name),s()),i.a.createElement("div",{className:"clear-fix"}),i.a.createElement(Tn.a,{condition:this.state.showMods},i.a.createElement(Oa,{parameters:this.props.effect.parameters})),i.a.createElement(Tn.a,{condition:!this.state.showMods&&!this.state.isCollapsed&&!this.state.showPresets},this.props.children),i.a.createElement("div",{className:"clear-fix"}))),!this.props.isLiveEffect&&i.a.createElement(ua,{effect:this.props.effect,togglePresets:this.togglePresets,setContextualHelp:this.props.setContextualHelp,showPresets:this.state.showPresets}))}}]),n}(a.Component),xa=Object(o.b)(function(e,t){return{planeMapping:e.effects.planeMapping,effectDragging:e.sequencer.effectDragging,midiEffectDragging:e.effects.midiEffectDragging,isCollapsed:e.effects.effectCollapsed[t.effect.id],isSelected:e.effects.selectedEffect===t.effect.id,isEnabled:t.effect.isEnabled(),linkingEffects:e.effects.linkingEffects,isStarred:e.effects.effectStarred[t.effect.id],isSelectedZObject:t.effect===e.zobject.selectedZObject,preset:t.effect.preset}},function(e,t){return{setContextualHelp:function(t){return e(Object(c.Z)(t))},dragEffect:function(t){return e(Object(c.g)(t))},dragMidiEffect:function(t){return e(Object(c.ec)(t))},setEffectCollapsed:function(t,n){return e(Object(c.sb)(t,n))},setSelectedEffect:function(t){return e(Object(c.kd)(t))},setPulledEffects:function(t){return e(Object(c.Vc)(t))},setLinkingEffects:function(t){return e(Object(c.Zb)(t))},setStarred:function(n){return e(Object(c.wb)(t.effect.id,n))},clearDragDrop:function(t){return e(Object(c.a)(t))}}})(wa),Sa=n(180);function Pa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var Ea=function(e){Object(b.a)(n,e);var t=Pa(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(y.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"handleModeChange",value:function(e){this.state.effect.mode=e.value,this.setState(this.state)}},{key:"handleFactorChange",value:function(e){this.state.effect.rollFactor=e.value,this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){var e,t=this;void 0!==this.props.automation||this.state.effect.isEnabled();return i.a.createElement("div",null,this.isEnabled()?i.a.createElement("div",null,i.a.createElement("div",{className:"lfo-rate-dropdown roll-factor"},i.a.createElement("div",{className:"lfo-rate-label"},"Mode:"),i.a.createElement(vt.a,{className:"osc-type-dropdown roll-factor-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:Ma,onChange:function(e){return t.handleModeChange(e)},value:(e=this.state.effect.mode,Ma.filter(function(t){return t.value===e})[0]),placeholder:"Rate"}),i.a.createElement("div",{className:"clear-fix"})),i.a.createElement("div",{className:"lfo-rate-dropdown roll-factor"},i.a.createElement("div",{className:"lfo-rate-label"},"Roll Factor:"),i.a.createElement(vt.a,{className:"osc-type-dropdown roll-factor-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:Ta,onChange:function(e){return t.handleFactorChange(e)},value:Aa(this.state.effect.rollFactor),placeholder:"Rate"}),i.a.createElement("div",{className:"clear-fix"}))):"")}}]),n}(a.Component),Ta=[{value:.125,label:"1/8"},{value:.25,label:"1/4"},{value:.5,label:"1/2"},{value:1,label:"1"},{value:2,label:"2"},{value:4,label:"4"},{value:8,label:"8"}];function Aa(e){return Ta.filter(function(t){return t.value===e})[0]}var Ma=[{value:Sa.g,label:"Sync"},{value:Sa.b,label:"On"},{value:Sa.a,label:"Off"}];var Ra=Ea,Ca=(Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.effect,n=Object(a.useState)(t.randomness),s=Object(r.a)(n,2),o=s[0],c=s[1],u=Object(a.useCallback)(function(e){var n=e.target.value;t.randomness=n,c(n)},[c]);return i.a.createElement("div",{className:"auto-map-settings"},i.a.createElement("div",{className:"randomness"},"Randomness: ",o),i.a.createElement(sn.a,{value:o,change:u,step:.1,max:100,min:0,orientation:"horizontal",reversed:!1}))}),function(e){var t=e.subMacro,n=e.macro,s=t.parameter,o=s.context,c=o.subDevice,u=o.effect,l=o.liveEffect,f=o.midiEffect,h=o.instrument;c=c||u||l||f||h;var p=Object(a.useState)(t.min),d=Object(r.a)(p,2),v=d[0],m=d[1],y=Object(a.useState)(t.max),b=Object(r.a)(y,2),g=b[0],O=b[1],k=Object(a.useCallback)(function(){n.unmapParameter(s)},[n,s]),j=Object(a.useCallback)(function(e){var n=e.target.value;n=parseFloat(n),s.isValidValue(n)?(t.min=n,m(e.target.value)):""!==e.target.value&&"."!==e.target.value||m(e.target.value)},[m]),w=Object(a.useCallback)(function(e){var n=e.target.value;n=parseFloat(n),s.isValidValue(n)?(t.max=n,O(e.target.value)):""!==e.target.value&&"."!==e.target.value||O(e.target.value)},[O]);return i.a.createElement("div",{className:"sub-macro"},i.a.createElement("div",{className:"sub-field effect"},c?c.name:u?u.name:h?h.name:""),i.a.createElement("div",{className:"sub-field parameter"},s.name),i.a.createElement("div",{className:"sub-field"},i.a.createElement("input",{className:"min-field",onChange:j,value:v,type:"text"})),i.a.createElement("div",{className:"sub-field"},i.a.createElement("input",{className:"max-field",onChange:w,value:g,type:"text"})),i.a.createElement("div",{onClick:k,className:"unmap-button"},"x"))}),Na=Object(o.b)(function(e,t){return{len:t.macro.subMacros.length}},function(e){return{}})(function(e){var t=e.macro,n=Object(a.useState)(t.name),s=Object(r.a)(n,2),o=s[0],c=s[1],u=Object(a.useState)(!1),l=Object(r.a)(u,2),f=l[0],h=l[1],p=Object(a.useCallback)(function(e){c(e.target.value),t.name=e.target.value},[c,t]),d=Object(a.useCallback)(function(e){"Enter"===e.key&&h(!1)},[h]);return i.a.createElement("div",{className:"macro-details"},f?i.a.createElement("input",{type:"text",value:o,onKeyUp:d,onChange:p}):i.a.createElement("div",{onClick:function(){return h(!0)},className:"macro-name"},t.name),t.subMacros.map(function(e){return i.a.createElement(Ca,{macro:t,subMacro:e})}))});function qa(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ia(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ia(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Ia(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var _a=function(e){var t,n=e.effect,r=0,a=qa(n.macros);try{for(a.s();!(t=a.n()).done;){r+=t.value.subMacros.length}}catch(s){a.e(s)}finally{a.f()}return i.a.createElement("div",{className:"effect-details"},0===r?i.a.createElement("div",{className:"macros-details-title"},"Macros"):"",0===r?i.a.createElement("div",{className:"no-macros-text"},"You haven't set any macros yet."):"",n.macros.filter(function(e){return e.subMacros.length>0}).map(function(e){return i.a.createElement(Na,{macro:e})}))},Da=function(e){var t=e.ref;e.effect;return{preventDragging:function(e){for(var n=t.current.parentNode,r=0;r<20&&n;r++)!n.className||!n.className.includes("effect")||n.className.includes("inner-effect")||n.className.includes("effects-view")||n.className.includes("effect-rack")||n.setAttribute("draggable",e),n=n.parentNode}}};function Fa(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return La(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return La(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function La(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ba=function(e){var t=e.modulator,n=e.parameter,r=e.i,a=e.height,s=e.color,o=e.setSelectedEdge,c=e.selectedEdge,u=25+48*r,l="LFO"===t.getType()?0:4,f=15+33*(t.number-1)+33*l,h=a-18,p=c&&c.modulator===t&&c.parameter===n;return i.a.createElement("g",null,i.a.createElement("line",{onMouseDown:function(e){e.stopPropagation(),o({modulator:t,parameter:n})},x1:u,y1:2,x2:f,y2:h,strokeWidth:4,opacity:0,stroke:s}),i.a.createElement("line",{onMouseDown:function(e){e.stopPropagation(),o({modulator:t,parameter:n})},className:p?"mod-edge selected":c?"mod-edge hidden":"mod-edge",x1:u,y1:2,x2:f,y2:h,strokeWidth:2,stroke:s}))},za=Object(o.b)(function(e,t){return t.parameter?{lfos:t.parameter.lfos.length,envelopes:t.parameter.envelopes.length}:{}},function(e){return{}})(function(e){var t=e.parameter;e.i,e.height,e.color,e.selectedEdge,e.setSelectedEdge;if(void 0===t)return[];var n,r=[],a=Fa(t.lfos);try{for(a.s();!(n=a.n()).done;){var s=n.value;r.push(i.a.createElement(Ba,Object.assign({},e,{modulator:s})))}}catch(l){a.e(l)}finally{a.f()}var o,c=Fa(t.envelopes);try{for(c.s();!(o=c.n()).done;){var u=o.value;r.push(i.a.createElement(Ba,Object.assign({},e,{modulator:u})))}}catch(l){c.e(l)}finally{c.f()}return r}),Ja=n(17),Va=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.modulator,n=e.i,r=(e.width,e.height),s=e.lineDragging,o=e.setLineDragging,c=e.el,u=2+33*n,l=r-15,f=Object(a.useCallback)(function(e){var n=c.current.getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top;o({x1:r,y1:a,x2:r,y2:a,modulator:t})},[o,c]),h=Object(a.useCallback)(function(e){if(s){var n=s.parameter;n.isAudioParamEnabled()||n.enableAudioParam(),"LFO"===t.getType()?n.connectToLFO(t):n.connectToEnvelope(t)}},[s,o,t]);return i.a.createElement("g",null,i.a.createElement("circle",{onMouseUp:h,onMouseDown:f,cx:u+14,cy:l-3,r:3}),i.a.createElement("rect",{x:u,y:l,width:30,height:15,fill:"gray"}),i.a.createElement("text",{x:u+2,y:l+14},t.name))}),Ha=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.effect,n=e.sequencerEngine,o=e.parameters,c=e.width,u=void 0===c?260:c,l=e.height,f=void 0===l?40:l,h=e.color,p=Object(a.useState)(void 0),d=Object(r.a)(p,2),v=d[0],m=d[1],y=Object(a.useState)(void 0),b=Object(r.a)(y,2),g=b[0],O=b[1],k=Object(a.useRef)(void 0),j=Da({ref:k,effect:t}).preventDragging;Object(a.useEffect)(function(){return window.addEventListener("keydown",w),function(){return window.removeEventListener("keydown",w)}},[g,O]);var w=Object(a.useCallback)(function(e){if("INPUT"!==e.target.tagName&&"Backspace"===e.key&&g){var t=g.modulator,n=g.parameter;t.getType()===Ja.b?n.disconnectFromLFO(t):n.disconnectFromEnvelope(t),O(void 0)}},[g,O]),x=Object(a.useCallback)(function(e,t){if(v&&t){var n=v.modulator;t.isAudioParamEnabled()||t.enableAudioParam(),n.getType()===Ja.b?t.connectToLFO(n):t.connectToEnvelope(n)}},[v,m]),S=Object(a.useCallback)(function(e){if(v){var t=k.current.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top,a=Object(je.a)({},v,{x2:n,y2:r});m(a)}},[v,m]),P=function(e){return 25+48*o.indexOf(e)},E=Object(a.useCallback)(function(e,t){var n=k.current.getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top;m({x1:r,y1:a,x2:r,y2:a,parameter:t})},[m,k]),T=[].concat(Object(s.a)(n.lfos.map(function(e){return e.lfo})),Object(s.a)(n.envelopes));return i.a.createElement("div",{ref:k,className:"mod-routes"},i.a.createElement("svg",{onMouseDown:function(){j(!1),O(void 0)},onMouseUp:function(){j(!0),m(void 0)},onMouseMove:S,height:f,width:u},v?i.a.createElement("line",{x1:v.x1,y1:v.y1,x2:v.x2,y2:v.y2,stroke:"red",strokeWidth:1}):[],o.map(function(e,t){return i.a.createElement("g",{key:"fuck-yeah-"+t},i.a.createElement("circle",{key:"circle-yeah-"+t,onMouseDown:function(t){return E(t,e)},onMouseUp:function(t){return x(t,e)},cx:P(e),cy:2,r:3,fill:"black"}),i.a.createElement(za,{key:t,selectedEdge:g,setSelectedEdge:O,i:t,color:h,parameter:e,height:f}))}),T.map(function(e,t){return i.a.createElement(Va,{key:t,el:k,setLineDragging:m,lineDragging:v,i:t,width:u,height:f,modulator:e})})),g?i.a.createElement(ma,{parameterMod:g.parameter.parameterMods.find(function(e){return e.modulator===g.modulator})}):"")}),Ua=function(e,t,n){return Math.max(e,Math.min(t,n))},Ga=function(e,t){var n,r;return e.some(function(e){var a=Math.abs(t-e);if(a>=r)return!0;n=e,r=a}),n},Wa=function(e){var t=e.min,n=e.max;return(e.value-t)/(n-t)},Ka={37:-1,38:1,39:1,40:-1},Qa=function(e){return function(t){return e(Object(je.a)({},t,{type:"START"}))}},Za=function(e){return function(t){var n=Ka[t.keyCode];n&&(t.preventDefault(),e({type:"STEPS",direction:n}))}},Ya=function(e,t){return document.body.addEventListener(e,t)},Xa=function(e,t){return document.body.removeEventListener(e,t)},$a=function(e){return Object(je.a)({},e,{isActive:!0},function(e){var t=e.container,n=e.size,r=t.current.getBoundingClientRect();return{startX:Math.floor(r.left)+n/2,startY:Math.floor(r.top)+n/2}}(e))},ei=function(e){var t=e.state,n=e.action,r=(e.onChange,function(e){var t=e.startX,n=e.startY,r=(e.scrollContainer,e.size,e.pageX),a=e.pageY,i=e.angleOffset,s=e.angleRange,o=t-r,c=n-a,u=180*Math.atan2(-c,-o)/Math.PI+90-i,l=u<0?u+360:u%360;return l<=s?Ua(0,1,l/s):+(l-s<(360-s)/2)}(Object(je.a)({},t,n))),a=function(e){var t=e.min;return t+(e.max-t)*e.percentage}(Object(je.a)({},t,{percentage:r}));return Object(je.a)({},t,{percentage:r,value:a})},ti=function(e){return function(t,n){switch(n.type){case"START":return $a(t);case"SCROLL_CONTAINER":return function(e,t){return Object(je.a)({},e,{scrollContainer:t.scrollContainer})}(t,n);case"MOVE":return ei({state:t,action:n,onChange:e});case"STEPS":return function(e){var t=e.state,n=e.action,r=(e.onChange,Ua(t.min,t.max,t.value+1*n.direction));return Object(je.a)({},t,{value:r,percentage:Wa(Object(je.a)({},t,{value:r}))})}({state:t,action:n,onChange:e});default:return Object(je.a)({},t,{isActive:!1,value:t.value})}}},ni=function(e){var t=e.min,n=e.max,i=e.initialValue,s=e.angleOffset,o=void 0===s?0:s,c=e.scrollContainer,u=e.angleRange,l=void 0===u?360:u,f=e.size,h=e.steps,p=(e.snap,e.onChange),d=Object(a.useRef)(),v=Object(a.useRef)(),m=Object(a.useReducer)(ti(p),{isActive:!1,min:t,max:n,angleOffset:o,angleRange:l,percentage:void 0!==i?(i-t)/(n-t):0,value:i||0,svg:d,container:v,size:f}),y=Object(r.a)(m,2),b=y[0],g=b.percentage,O=b.value,k=b.angle,j=b.isActive,w=y[1];return Object(a.useEffect)(function(e){var t=e.dispatch,n=e.isActive;return function(){var e=function(e){var n=e.pageX,r=e.pageY;return t({pageX:n,pageY:r,type:"MOVE"})},r=function(){return t({type:"STOP"})};if(n)return Ya("mousemove",e),Ya("mouseup",r),function(){Xa("mousemove",e),Xa("mouseup",r)}}}({dispatch:w,isActive:j}),[j]),{dispatch:w,svg:d,container:v,percentage:h?Ga(h,g):g,value:O,scrollContainer:c,angle:k,onStart:Qa(w),onKeyDown:Za(w),onScroll:function(e){}}},ri=function(e,t,n){return{x:e+t*Math.cos(n),y:e+t*Math.sin(n)}},ai=function(e){return Math.PI*e/180},ii=function(e){var t=e.percentage,n=e.angleOffset,r=e.angleRange,a=e.arcWidth,i=e.radius,s=e.center,o=r*t,c=n-90,u=i-a,l=ai(c),f=ai(c+o),h=o<180?0:1,p=ri(s,i,f),d=ri(s,i,l),v=ri(s,u,l),m=ri(s,u,f);return"M".concat(p.x,",").concat(p.y," A").concat(i,",").concat(i," 0 ").concat(h," 0 ").concat(d.x,",").concat(d.y,"L").concat(v.x,",").concat(v.y," A").concat(u,",").concat(u," 0 ").concat(h," 1 ").concat(m.x,",").concat(m.y," L").concat(p.x,",").concat(p.y)},si=function(e){var t=e.color,n=e.background,r=Object(rn.a)(e,["color","background"]);return i.a.createElement("g",null,n&&i.a.createElement("path",{d:ii(Object(je.a)({},r,{percentage:1})),style:{fill:n}}),i.a.createElement("path",{d:ii(r),style:{fill:t}}))},oi=function(e){var t=e.children,n=e.width,r=e.height,a=void 0===r?n:r,s=e.angleOffset,o=e.angleRange,c=e.percentage,u=e.radius,l=e.center,f=e.type,h=e.color,p=e.className;return i.a.createElement("g",{transform:"\n        rotate(".concat(s+o*c," ").concat(l," ").concat(l,")\n        translate( ").concat(l-n/2," ").concat(l-u-a,")\n        ")},t&&i.a.Children.map(t,function(e){return i.a.cloneElement(e,{width:n,height:a,percentage:c})}),"rect"===f&&i.a.createElement("rect",{width:n,height:a,fill:h,className:p}),"circle"===f&&i.a.createElement("circle",{r:n,fill:h,className:p}))},ci=function(e){var t=e.angleRange,n=e.steps,r=e.type,a=void 0===r?"rect":r,s=e.radius,o=e.tickWidth,c=e.tickHeight,u=e.angleOffset,l=e.center,f=e.color,h=e.activeColor,p=void 0===h?f:h,d=e.className,v=e.activeClassName,m=void 0===v?d:v,y=e.fn,b=e.percentage,g=t/n,O=n+(360===t?0:1),k=l-o/2,j=l-s,w=Math.round((O-1)*b),x="circle"===a?function(e){var t=e.tickWidth,n=e.translateX,r=e.translateY,a=e.angleOffset,s=e.stepSize,o=e.center,c=e.color,u=e.active,l=e.activeColor,f=e.activeClassName,h=e.className;return function(e,p){return i.a.createElement("circle",{r:t,key:p,className:p===u?f:h,fill:p===u?l:c,stroke:"none",transform:"\n        rotate(".concat(a+s*p," ").concat(o," ").concat(o,") \n        translate(").concat(n," ").concat(r,")\n        ")})}}({tickWidth:o,translateX:k,translateY:j,center:l,angleOffset:u,stepSize:g,color:f,active:w,activeColor:p,className:d,activeClassName:m}):"rect"!==a||y?function(e){var t=e.fn,n=Object(rn.a)(e,["fn"]);return function(e,r){return t(Object(je.a)({},n,{i:r}))}}({fn:y,tickWidth:o,tickHeight:c,translateX:k,translateY:j,angleOffset:u,stepSize:g,center:l,color:f,active:w,activeColor:p,className:d,activeClassName:m}):function(e){var t=e.tickWidth,n=e.tickHeight,r=e.translateX,a=e.translateY,s=e.angleOffset,o=e.stepSize,c=e.center,u=e.color,l=e.active,f=e.activeColor,h=e.activeClassName,p=e.className;return function(e,d){return i.a.createElement("rect",{className:d===l?h:p,fill:d===l?f:u,stroke:"none",width:t,height:n,key:d,transform:"\n        rotate(".concat(s+o*d," ").concat(c," ").concat(c,") \n        translate(").concat(r," ").concat(a,")\n        ")})}}({tickWidth:o,tickHeight:c,translateX:k,translateY:j,angleOffset:u,stepSize:g,center:l,color:f,active:w,activeColor:p,className:d,activeClassName:m});return i.a.createElement("g",null,Array.from({length:O},x))},ui=function(e,t){return e&&t?Array.from({length:e+1},function(t,n){return 1/e*n}):void 0},li=function(e){var t=e.type;return t===si||t===oi||t===ci||t===function(e){var t=e.value,n=e.size,r=e.decimalPlace,a=void 0===r?0:r,s=e.className,o=e.marginBottom,c=void 0===o?0:o;return null==t?null:i.a.createElement("text",{style:{userSelect:"none"},x:"50%",textAnchor:"middle",className:s,y:n-c},t.toFixed(a))}},fi=function(e){var t=e.min,n=e.max,r=e.value,s=e.angleOffset,o=void 0===s?0:s,c=e.angleRange,u=void 0===c?360:c,l=e.size,f=e.onChange,h=void 0===f?function(){}:f,p=e.children,d=e.scrollContainer,v=e.steps,m=e.snap,y=void 0!==m&&m,b=e.ariaValueText,g=e.ariaLabelledBy,O=e.className,k=ni({min:t,scrollContainer:d,max:n,initialValue:r,angleOffset:o,percentage:Wa({initialValue:r,min:t,max:n}),angleRange:u,size:l,steps:ui(v,y),onChange:h}),j=k.dispatch,w=k.onStart,x=k.svg,S=k.container,P=k.onKeyDown,E=k.onScroll,T=r,A=void 0!==r?(r-t)/(n-t):0;return Object(a.useEffect)(function(){h(k.value)},[k.value]),Object(a.useEffect)(function(){j({scrollContainer:d,type:"SCROLL_CONTAINER"})},[d]),i.a.createElement("div",{ref:S,tabIndex:"0",style:{outline:"none",width:l,height:l},"aria-valuemax":n,"aria-valuemin":t,"aria-valuenow":T,"aria-valuetext":b,"aria-labelledby":g,onKeyDown:P,onWheel:E,className:O},i.a.createElement("svg",{onMouseDown:function(e){e.preventDefault(),w(e)},width:l,height:l,ref:x},i.a.createElement("g",{className:"knob-group"},i.a.Children.map(p,function(e){return li(e)?i.a.cloneElement(e,Object(je.a)({percentage:A,size:l,value:T,angleOffset:o,angleRange:u,radius:l/2,center:l/2,steps:v},e.props)):e}))))},hi=Object(o.b)(function(e,t){return t.parameter?{value:t.parameter.get(),isMidiSelected:t.parameter.id===e.midi.parameterSelected,midiMapMode:e.midi.midiMapMode,isMacroMapping:e.effects.isMacroMapping}:{value:0}},function(e){return{setParameterToMap:function(t){return e(Object(c.Dc)(t))},setParameterSliderDown:function(t){return e(Object(c.Cc)(t))},setParameterMidiMapSelection:function(t){return e(Object(c.yc)(t))}}})(function(e){var t=e.unit,n=e.size,s=void 0===n?30:n,o=e.name,c=e.parameter,u=e.setParameterSliderDown,l=e.value,f=e.color,h=e.min,p=void 0===h?c.min:h,d=e.max,v=void 0===d?c.max:d,m=e.step,y=e.scrollContainer,b=e.isMidiSelected,g=e.midiMapMode,O=e.setParameterMidiMapSelection,k=e.setParameterToMap,j=e.isMacroMapping,w=Object(a.useState)(!1),x=Object(r.a)(w,2),S=x[0],P=x[1],E=p>=0;l<p&&(l=p);var T=Object(a.useCallback)(function(e){if(S){document.activeElement.blur();var t=E?Math.pow(e,2):e;t===p&&(t=c.min),c.set(t,!1),g===he.b&&O(c.id)}else P(!0)},[c,E,S,P,g]),A=E?Math.sqrt(l):l,M=i.a.createElement(fi,{scrollContainer:y,size:s,angleOffset:220,angleRange:280,value:A,initialValue:A,step:m||1,min:E?Math.sqrt(p):p,max:E?Math.sqrt(v):v,onChange:T},i.a.createElement(si,{arcWidth:2,color:f||"white",background:"#6c757a"}),i.a.createElement(oi,{width:2,height:s/3,radius:4,type:"rect",color:f||"white"})),R=Object(a.useCallback)(function(e){j&&(c.isMapped||k(c)),e.stopPropagation(),u(c)},[j,c]),C=Object(a.useCallback)(function(){u(void 0),c.automation.smoothen(),c.mixAutomation.smoothen()},[c]),N="parameter-knob";return b&&g===he.b&&(N+=" midi-selected"),j&&(N+=" plane-mapping"),o?i.a.createElement(fn,{element:c,onMouseDown:R,onMouseUp:C,onContextMenu:function(e){e.stopPropagation(),e.preventDefault()},className:N},o,M,Math.round(100*l)/100," ",t):i.a.createElement(fn,{onContextMenu:function(e){e.stopPropagation(),e.preventDefault()},onMouseDown:R,onMouseUp:C,className:N},M)}),pi=new $e.a,di=Object(o.b)(function(e){return{isMacroMapping:e.effects.isMacroMapping,parameterToMap:e.effects.isMacroMapping&&e.effects.parameterToMap}},function(e){return{setIsMacroMapping:function(t){return e(Object(c.Ib)(t))}}})(function(e){var t=e.macro,n=e.parameterToMap,s=e.isMacroMapping,o=e.setIsMacroMapping,c=e.scrollContainer,u=t.macroParameter,l=t.name,f=Object(a.useState)(n&&t.isParameterMapped(n)),h=Object(r.a)(f,2),p=h[0],d=h[1];Object(a.useEffect)(function(){d(!!n&&t.isParameterMapped(n))},[n,d]);var v=Object(a.useCallback)(function(){s&&n&&(p?t.unmapParameter(n):t.addParameter(n),d(!p),o(!1),o(!0))},[n,d,p,s]);return i.a.createElement("div",{className:"macro-knob"},i.a.createElement("div",{className:"macro-name"},l),i.a.createElement(hi,{scrollContainer:c,color:pi.getColorForHash(t.id),parameter:u}),s?i.a.createElement("div",{onClick:v,className:p?"unmap map-button":"map-button"},p?"Unmap":"Map"):"")}),vi=(n(1735),Object(o.b)(function(e,t){return{isMacroMapping:e.effects.isMacroMapping}},function(e){return{}})(function(e){var t=e.effect,n=e.scrollContainer,s=e.isMacroMapping,o=Object(a.useState)(!1),c=Object(r.a)(o,2);c[0],c[1],Object(a.useCallback)(function(){t.generateMappings()},[t]);if(!t.isEnabled())return i.a.createElement("div",null);var u=t.macros.map(function(e){return e.macroParameter});return i.a.createElement("div",{className:"macros-effect"},i.a.createElement("div",{className:"macros-container"},t.macros.map(function(e){return i.a.createElement(di,{key:e.id,scrollContainer:n,macro:e})})),i.a.createElement(Ha,{effect:t,width:280,sequencerEngine:t.track.sequencerEngine,color:"red",parameters:u}),s?i.a.createElement(_a,{effect:t}):"")})),mi=n(346),yi=Object(o.b)(function(e,t){return{direction:t.effect.direction}},function(e){return{}})(function(e){var t=e.effect,n=e.direction,r=e.sequencerEngine,s=[{label:"Forward",value:mi.b},{label:"Reverse",value:mi.d},{label:"Forward-Reverse",value:mi.c},{label:"Brownian",value:mi.a}],o=Object(a.useCallback)(function(e){t.directionParameter.set(e.value,void 0,void 0)},[t]);return i.a.createElement("div",null,i.a.createElement("div",{className:"direction-parameter"},i.a.createElement("div",{className:"parameter-label"},"Direction:"),i.a.createElement(vt.a,{className:"osc-type-dropdown float-left",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:s,onChange:o,value:s.find(function(e){return e.value===n}),placeholder:"Direction"})),n!==mi.a?i.a.createElement("div",null,i.a.createElement(Mn,{name:"Speed",parameter:t.speedFactorParameter,onParameterChanged:function(){return[]},isParameter:!0,sequencerEngine:r,lfoEnabled:!0,unit:"x",step:.25,min:.25,max:window.isNFT?1:4}),i.a.createElement("div",{className:"offset-parameter"},i.a.createElement(Mn,{name:"Offset",parameter:t.offsetParameter,onParameterChanged:function(){return[]},isParameter:!0,sequencerEngine:r,lfoEnabled:!0,unit:"x",step:1,min:0,max:16}))):i.a.createElement(Mn,{name:"Walk",parameter:t.walkParameter,onParameterChanged:function(){return[]},isParameter:!0,sequencerEngine:r,lfoEnabled:!0,unit:"Steps (1/32th)",step:1,min:1,max:16}))}),bi=function(e){if(e.context.effect)return e.context.effect.name+" - "+e.prettyName;if(e.context.midiEffect)return e.context.midiEffect.name+" - "+e.prettyName;if(e.context.macro)return e.context.macro.name;if(e.context.subDevice&&e.context.instrument){var t=e.context.instrument,n=t.getSubDeviceIndex(e.context.subDevice),r=t.getSubDevices();if(r[n])return r[n].label+" - "+e.prettyName}return e.prettyName},gi=(Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.effect,n=e.palette,r=t.track.getAllParameters().filter(function(e){return n in e.paletteToValue});return i.a.createElement("div",{className:"palette-details"},r.map(function(e){return i.a.createElement(Mn,{key:e.id,name:bi(e),min:e.min,max:e.max,sequencerEngine:t.track.sequencerEngine,step:.01,isParameter:!0,parameter:e})}))}),["#ff7759","#ffc782","#f5ff60","#59e800","#ff78ff","#ff2f8f"]),Oi=function(e){var t=e.selectedPalette,n=e.palette,r=e.onChoose,a=t===n?"selected palette-option":"palette-option",s={backgroundColor:gi[n]};return i.a.createElement("div",{style:s,onClick:function(){return r(n)},className:a},n+1)},ki=Object(o.b)(function(e,t){var n=e.effects.sequencedPalettes[t.effect.track.id],r=e.effects.selectedPalettes[t.effect.track.id];return{selectedPalette:void 0!==r?r:n}},function(e){return{setSelectedPalette:function(t,n){return e(Object(c.qd)(t,n))}}})(function(e){var t=e.effect,n=e.selectedPalette,o=(e.setSelectedPalette,Object(a.useState)(Object(s.a)(t.palettes))),c=Object(r.a)(o,2),u=c[0],l=c[1],f=Object(a.useCallback)(function(){t.newPalette(),l(Object(s.a)(t.palettes))},[l]),h=Object(a.useCallback)(function(e){e===n&&(e=void 0),t.switchToPalette(e,n,void 0,!0)},[t,n]);return i.a.createElement("div",{className:"palettes-effect"},i.a.createElement("div",{className:"palettes-container"},u.map(function(e){return i.a.createElement(Oi,{onChoose:h,selectedPalette:n,palette:e})}),i.a.createElement("div",{onClick:f,className:"new-palette-btn"},"+")))});function ji(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var wi=function(e){Object(b.a)(n,e);var t=ji(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={},r}return Object(y.a)(n,[{key:"getEffectChild",value:function(){switch(this.props.effect.effect){case Sa.f:return i.a.createElement(Ra,this.props);case Sa.c:return i.a.createElement(vi,this.props);case Sa.d:return i.a.createElement(ki,this.props);case Sa.e:return i.a.createElement(yi,this.props);default:return""}}},{key:"getMacroMapButton",value:function(){return i.a.createElement(oa,null)}},{key:"render",value:function(){var e=this;return i.a.createElement(xa,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,effectClass:this.props.effect.name,sequencerEngine:this.props.sequencerEngine,isLiveEffect:!0,alternateButton:this.props.effect.effect===Sa.c?this.getMacroMapButton():void 0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),this.getEffectChild())}}]),n}(a.Component),xi=(Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){return i.a.createElement("div",null,i.a.createElement(Mn,{effectNumber:e.effectNumber,name:"Flush",parameter:e.effect.flushParameter,automation:e.automation,onParameterChanged:e.onParameterChanged,isParameter:!0,sequencerEngine:e.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:32}))}),n(151));function Si(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var Pi=function(e){Object(b.a)(n,e);var t=Si(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={},r}return Object(y.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"getParameterOptions",value:function(){return this.props.effect.getAvailableParameters().map(function(e){return{label:e.name,value:e}})}},{key:"getParameterOption",value:function(e){if(void 0!==e){var t=this.getParameterOptions().filter(function(t){return t.value===e});return t.length>0?t[0]:void 0}}},{key:"handleParameterChange",value:function(e){this.props.effect.parameter=e.value,this.setState(this.state)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"deleteParameter",value:function(){this.props.deleteParameterizer(this.props.effect)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:this.props.isSimple?"parameterizer":""},i.a.createElement(Tn.a,{condition:this.isEnabled()},i.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"PARAMETERIZER_DROPDOWN")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"parameter-dropdown-container"},i.a.createElement("div",{className:"lfo-rate-label"},"Parameter:"),i.a.createElement(vt.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getParameterOptions(),onChange:function(t){return e.handleParameterChange(t)},value:this.getParameterOption(this.props.effect.parameter),placeholder:"Parameter"})),i.a.createElement("div",{className:"clear-fix"}),i.a.createElement(Mn,{effectNumber:this.props.effectNumber,contextualHelp:"PARAMETERIZER_FACTOR",name:"Factor",automation:this.props.automation,parameter:this.props.effect.factorParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:.01,max:8}),i.a.createElement(Mn,{contextualHelp:"PARAMETERIZER_OFFSET",effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Offset",root:1,parameter:this.props.effect.offsetParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.1,min:-12,max:12}),this.props.isSimple?"":i.a.createElement(Mn,{effectNumber:this.props.effectNumber,name:"Probability",contextualHelp:"PROBABILITY",automation:this.props.automation,parameter:this.props.effect.probabilityParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:100})),this.props.isSimple?i.a.createElement("div",{onClick:function(){return e.deleteParameter()},className:"delete-btn"},"x"):"")}}]),n}(a.Component),Ei=Object(o.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(c.Z)(t))}}})(Pi),Ti=(new $e.a,Object(o.b)(function(e,t){return{mem:t.effect.mem,trackStep:t.sequencerEngine.trackStep}},function(e){return{}})(function(e){var t=e.effect,n=e.mem,r=e.trackStep,a=e.trackMem,o=(void 0===a&&t.trackMem,e.WIDTH),c=void 0===o?300:o,u=e.HEIGHT,l=void 0===u?100:u,f=Object.keys(n).map(parseFloat),h=Object.values(n).map(parseFloat),p=Math.max.apply(Math,Object(s.a)(f)),d=n.maxTriggers||Math.max.apply(Math,Object(s.a)(h)),v=t.maxLength;p=32*(Math.floor(p/32)+1);var m=f.map(function(e){return{x:5+c*e/p,y:l-(5+l*n[e]/d)}}),y="";m.length>0&&(y="M "+m[0].x+" "+m[0].y+" L "+m.slice(1,p).map(function(e){return e.x+" "+e.y}).join(","));var b={width:c*(r%v/v)};n[r%v];return i.a.createElement("div",{className:"stats-effect"},i.a.createElement("div",{style:b,className:"stat-tick"}),i.a.createElement("svg",{className:"stats-drawer",width:c+10,height:l+10},m.length>1&&i.a.createElement("path",{className:"total-stat",d:y,stroke:"red",fill:"transparent"})))}));var Ai=Object(o.b)(function(e,t){return{value:t.parameter.get()}},null)(function(e){var t=Object(a.useCallback)(function(t){document.activeElement.blur(),e.parameter.set(!e.value)},[e.parameter,e.value]);return i.a.createElement(fn,{element:e.parameter,className:"checkbox-parameter"},i.a.createElement("label",null,i.a.createElement("input",{type:"checkbox",value:"checked",checked:e.flipped?!e.value:e.value,onChange:t}),e.name))});function Mi(e){function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.parameter;if(void 0!==t)return{value:t,label:t}}var n=e.className?e.className+" tracks-dropdown-container":"tracks-dropdown-container";return i.a.createElement("div",{className:n},i.a.createElement(vt.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:function(){var n=e.parameters.map(function(e){return t(e)});return[{label:"None",value:null}].concat(Object(s.a)(n))}(),onChange:function(t){return e.onSelectParameter(t.value)},value:t(),placeholder:e.placeholder}))}function Ri(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var Ci=function(e){Object(b.a)(n,e);var t=Ri(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={},r}return Object(y.a)(n,[{key:"getTrackVariables",value:function(){var e=this,t=this.props.sequencerEngine.tracks;return this.props.effect.trackVariables.map(function(n){return i.a.createElement("div",null,i.a.createElement("div",null,"Track"),i.a.createElement(yt,{track:t[n.get()],onSelectTrack:function(e){return n.set(e&&e.trackNumber)},sequencerEngine:e.props.sequencerEngine}))})}},{key:"getCheckboxVariables",value:function(){return this.props.effect.checkboxVariables.map(function(e){return i.a.createElement(Ai,{name:e.name,parameter:e})})}},{key:"getParamVariables",value:function(){var e=this;return this.props.effect.parameterVariables.map(function(t){return i.a.createElement("div",{className:"parameter-dropdown"},i.a.createElement("div",{className:"parameter-dropdown-name"},t.name),i.a.createElement(Mi,{parameter:t.get(),parameters:["transpose","velocity","chop","duration"],onSelectParameter:function(e){return t.set(e)},placeholder:t.name,sequencerEngine:e.props.sequencerEngine}))})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,this.getTrackVariables(),this.getParamVariables(),this.getCheckboxVariables(),this.props.effect.variables.map(function(t){return i.a.createElement(Mn,{name:t.name,min:t.min,max:t.max,step:Math.abs(t.min-t.max)<=1?.01:1,parameter:t,lfoEnabled:!0,sequencerEngine:e.props.sequencerEngine,isParameter:!0,effectNumber:e.props.effectNumber})}))}}]),n}(a.Component),Ni=Object(o.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(c.Z)(t))}}})(Ci);function qi(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ii(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ii(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Ii(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var _i=function(e){return e.automations&&e.automations.length},Di=function(e){return e.mixAutomation&&e.mixAutomation.automations&&e.mixAutomation.automations.length},Fi=Object(o.b)(function(e,t){var n=t.force;return{hasAutomations:_i(n[0])||_i(n[1])||_i(n[2])||_i(n[3])||Di(n[0])||Di(n[1])||Di(n[2])||Di(n[3])}},function(e){return{}})(function(e){var t=e.force,n=e.name,r=e.hasAutomations,s=Object(a.useCallback)(function(){var e,n=qi(t);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=r.mixAutomation;r.automation.deleteAutomations(),a.deleteAutomations()}}catch(i){n.e(i)}finally{n.f()}},[t]);return i.a.createElement("div",{className:"script-force"},n,r?i.a.createElement("img",{onClick:s,src:"/automation-icon-disabled.png",className:"automation-icon"}):"")}),Li=Object(o.b)(function(e,t){return{forces:t.effect.forces}},function(e){return{}})(function(e){var t=e.forces,n=Object.keys(t).length;return i.a.createElement("div",{className:"script-forces"},n>0&&i.a.createElement("div",{className:"forces-label"},"Forces"),Object.keys(t).map(function(e){return i.a.createElement(Fi,{name:e,force:t[e]})}))}),Bi=Object(o.b)(function(e,t){return{variables:e.effects.scriptVariables[t.effect.id]}},function(e){return{}})(function(e){var t=e.effect,n=e.variables,r=e.sequencerEngine;return n?i.a.createElement("div",{className:"script-variables"},n.filter(function(e){return e&&e.name}).filter(function(e){return!e.hide}).sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(e){return i.a.createElement(Mn,{name:e.name,key:e.id,min:e.min,max:e.max,step:e.max-Math.floor(e.max)!==0||e.min-Math.floor(e.min)!==0||Math.abs(e.max-e.min)<2?.01:1,parameter:e,lfoEnabled:!0,sequencerEngine:r,isParameter:!0,effectNumber:0})}),t.forces&&i.a.createElement(Li,{effect:t})):[]}),zi=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.leaf,n=e.sequencerEngine,s=e.setLeafDetails,o=Object(a.useState)(t.track),c=Object(r.a)(o,2),u=c[0],l=c[1];Object(a.useEffect)(function(){l(t.track)},[t,l]);var f=Object(a.useCallback)(function(e){t.track=e,l(e)},[t,l]);return i.a.createElement("div",{className:"leaf-details"},i.a.createElement("div",{onClick:function(e){return s(void 0)},className:"delete-btn"},"x"),"Send trigger to track:",i.a.createElement(yt,{sequencerEngine:n,track:u,onSelectTrack:f}))}),Ji=n(299),Vi=n(546),Hi=n(157),Ui=new $e.a,Gi=window.factor||2,Wi=Object(o.b)(function(e,t){var n={};return t.tidals.forEach(function(e){n[e.id]=e.currentCycles,n["cycle"+e.id]=e.cycle}),n},function(e){return{}})(function(e){var t=e.leafDetails,n=e.setLeafDetails,r=e.backgroundColor,s=e.color,o=e.WIDTH,c=void 0===o?280:o,u=e.HEIGHT,l=void 0===u?280:u,f=e.dotColor,h=e.tidals,p=e.total,d=void 0===p?1:p,v=e.radius,m=void 0===v?c/2*.95:v,y=Object(rn.a)(e,["leafDetails","setLeafDetails","backgroundColor","color","WIDTH","HEIGHT","dotColor","tidals","total","radius"]),b=Object(a.useRef)(void 0),g=Object(a.useRef)([]),O=Object(a.useRef)(void 0);Object(a.useEffect)(function(){O.current=b.current.getContext("2d"),j()},[]),Object(a.useEffect)(function(){O.current&&O.current.scale(window.devicePixelRatio,window.devicePixelRatio)},[c,l]);var k=c/2;Object(a.useEffect)(function(){O.current&&j()},[y,f,t,c,l,m,k]);var j=Object(a.useCallback)(function(){var e=O.current;e.clearRect(0,0,c,l),g.current=[];for(var t=void 0,n=0;n<h.length;n++)for(var r=h[n],a=r.cycle,i=t||Math.max(10,m-12*Gi*n),s=a,o=s.length,u=0;u<s.length;u++){var f=s[u];if(0===u&&(t=w(e,u,o,a,i,k,f)),Array.isArray(f)&&(f=f[0]),y.sequencerEngine.tracks[n]&&x(e,f,u,i,a,n,o,r))break}},[s,c,l,f,r,h,d,t,k,m]),w=function(e,t,n,r,a,i,s){var o=P((t+1)%n,i,a,r),c=P((t+2)%n,i,a,r),u=P(Object(Hi.a)(t-2,n),i,a,r),l=P(Object(Hi.a)(t-1,n),i,a,r),f=Object(Vi.a)(l,c,u,o);return Object(Ji.c)({x:i,y:i},f)},x=function(e,t,n,a,i,s,o,c){var u=P(n,k,a,i),l=u.deg,h=u.x,p=u.y,d=S(t,s/o,s,o),v=d.fill,m=(d.stroke,d.radius);if(!c.currentCycles||!c.currentCycles[t.id])return!1;v=Ui.brighten(v,window.bright||.5);var y=new Path2D;if(y.arc(k,k,a,1.5*Math.PI,l),e.strokeStyle=f,e.stroke(y),null!==t.transpose){var b=new Path2D;if(m<0&&(m=1),b.arc(h,p,Gi*m,0,2*Math.PI),g.current.push({leaf:t,path:y,nth:s}),e.fillStyle=f,e.fill(b),t.staccato){var O=.3*m*Gi;e.fillStyle=r,e.fillRect(h-.5*O,p-.5*O,O,O)}}return!0},S=Object(a.useCallback)(function(e,t,n,a){var i=y.sequencerEngine.tracks[n],o=i?Ui.getColorForTrack(i):s,u=c/280*5*(a-n)/a;return e.accent?u*=2:e.piano?u/=2:e.pianissimo&&(u/=2),null===e.transpose?{fill:Ui.transparent(Ui.saturate(r,1)),stroke:o,radius:u}:{fill:o,radius:u}},[s,c,l,k,r]),P=Object(a.useCallback)(function(e,t,n,r){e*=1;var a=r.length,i=2*Math.PI*e/a-.5*Math.PI;return{x:t+n*Math.cos(i),y:t+n*Math.sin(i),deg:i}},[k,m,c,l]),E=Object(a.useCallback)(function(e){},[n]);return i.a.createElement("canvas",{onMouseDown:E,className:"tidal-art",style:{width:c,height:l},width:c*window.devicePixelRatio,height:l*window.devicePixelRatio,ref:b})});n(879),n(880);function Ki(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Qi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qi(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Qi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Zi=new $e.a,Yi=window.factor||2,Xi=Object(a.memo)(function(e){var t=e.leafDetails,n=e.WIDTH,r=void 0===n?280:n,s=e.HEIGHT,o=void 0===s?280:s,c=e.setLeafDetails,u=e.FULL_RADIUS,l=void 0===u?r/2*.95:u,f=e.isScript,h=e.backgroundColor,p=e.color,d=e.tidals,v=e.fillColor,m=e.dotColor,y=e.radius,b=void 0===y?l:y,g=Object(rn.a)(e,["leafDetails","WIDTH","HEIGHT","setLeafDetails","FULL_RADIUS","isScript","backgroundColor","color","tidals","fillColor","dotColor","radius"]),O=(d=d.filter(function(e){return e.inUse||e.lastUsed<1})).length,k=Object(a.useRef)(void 0),j=Object(a.useRef)([]),w=Object(a.useRef)(void 0);Object(a.useEffect)(function(){w.current=k.current.getContext("2d"),S()},[]),Object(a.useEffect)(function(){w.current&&w.current.scale(window.devicePixelRatio,window.devicePixelRatio)},[r,o]);var x=r/2;Object(a.useEffect)(function(){w.current&&(6===d.length||f)&&window.requestAnimationFrame(S)},[g,x,m,t,d,v,r,o,b]);var S=Object(a.useCallback)(function(){var e=w.current;e.clearRect(0,0,r,o),j.current=[];for(var t=void 0,n=0;n<d.length;n++){var a=d[n],i=a.cycle,s=t||Math.max(10,b-12*Yi*n);if(0===n&&(e.beginPath(),e.arc(x,x,s,0,2*Math.PI),e.fillStyle=h,e.fill(),e.closePath()),!g.sequencerEngine||g.sequencerEngine.tracks[n])for(var c=i,u=c.length,l=0;l<c.length;l++){var f=c[l];Array.isArray(f)&&(f=f[0]);var p=g.sequencerEngine&&g.sequencerEngine.tracks[n];if(!g.sequencerEngine||p){var v=P(e,l,u,i,s,{x:x,y:x},f);v&&(t=v)}f.type&&"-"===f.type.type&&0===f.type.value&&E(e,f,l,s,i,u),T(e,f,l,s,i,n,u,a)}}},[p,x,h,d,O,t,v,b,r,o]),P=Object(a.useCallback)(function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{x:x,y:x},s=arguments.length>6?arguments[6]:void 0;arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(null!==s.transpose){var o=A(t,i,a,r),c=A((t+1)%n,i,a,r),u=A((t+2)%n,i,a,r),l=A((t+3)%n,i,a,r),f=A(Object(Hi.a)(t-3,n),i,a,r),h=A(Object(Hi.a)(t-2,n),i,a,r),d=A(Object(Hi.a)(t-1,n),i,a,r),m=o,y=Object(Vi.a)(o,l,c,h),b=Object(Vi.a)(d,u,h,c),g=Object(Vi.a)(o,f,u,d);return e.beginPath(),e.lineWidth=1,e.moveTo(m.x,m.y),e.lineTo(y.x,y.y),e.lineTo(b.x,b.y),e.lineTo(g.x,g.y),e.closePath(),e.fillStyle=v,e.fill(),e.strokeStyle=p,e.stroke(),Object(Ji.c)({x:x,y:x},b)}},[x,b,r,o,v,p]),E=Object(a.useCallback)(function(e,t,n,r,a,i){var s={x:x,y:x},o=A(n,s,r,a),c=A((n+1)%i,s,r,a),u=(A((n+2)%i,s,r,a),A((n+3)%i,s,r,a)),l=(A(Object(Hi.a)(n-3,i),s,r,a),A(Object(Hi.a)(n-2,i),s,r,a)),f=(A(Object(Hi.a)(n-1,i),s,r,a),Object(Vi.a)(o,u,c,l));e.lineWidth=1,e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(f.x,f.y),e.lineTo(c.x,c.y),e.closePath(),e.fillStyle=v,e.fill(),e.strokeStyle=p,e.stroke()},[x,b,o,r,v,p]),T=function(e,t,n,r,a,i,s,o){},A=(Object(a.useCallback)(function(e,t,n){var r=m,a=5*t;return null===e.transpose?{fill:Zi.transparent(Zi.saturate(h,1)),stroke:r,radius:a}:{fill:r,radius:a}},[m,h,b]),Object(a.useCallback)(function(e,t,n,r){e*=1;r.flat(16);var a=r.length,i=2*Math.PI*e/a-.5*Math.PI;return{x:t.x+n*Math.cos(i),y:t.y+n*Math.sin(i),deg:i}},[x,b,r,o])),M=Object(a.useCallback)(function(e){var t,n=k.current.getBoundingClientRect(),r=Math.round(2*(e.clientX-n.left)),a=Math.round(2*(e.clientY-n.top)),i=Ki(j.current);try{for(i.s();!(t=i.n()).done;){var s=t.value,o=s.leaf,u=s.path;if(w.current.isPointInPath(u,r,a)){c(o);break}}}catch(l){i.e(l)}finally{i.f()}},[c]);return i.a.createElement("canvas",{onMouseDown:M,className:"tidal-art structure",style:{width:r,height:o},width:r*window.devicePixelRatio,height:o*window.devicePixelRatio,ref:k})}),$i=Object(o.b)(function(e,t){var n={};return t.tidals.forEach(function(e){n["cycle"+e.id]=e.cycle}),n},function(e){return{}})(Xi);window.magik=1.5,window.rad=1;new $e.a,Object(o.b)(function(e,t){var n={};return t.tidals.forEach(function(e){n[e.id]=e.currentCycles,n["cycle"+e.id]=e.cycle}),n},function(e){return{}})(function(e){var t=e.displayRef,n=e.backgroundColor,r=e.color,s=e.tidals,o=e.total,c=void 0===o?1:o,u=(e.radius,Object(rn.a)(e,["displayRef","backgroundColor","color","tidals","total","radius"])),l=Object(a.useRef)(void 0),f=Object(a.useRef)(void 0);Object(a.useEffect)(function(){f.current=l.current.getContext("2d"),f.current.scale(window.devicePixelRatio,window.devicePixelRatio),h()},[]),Object(a.useEffect)(function(){f.current&&h()},[u]);var h=Object(a.useCallback)(function(){var e=f.current;e.clearRect(0,0,495,400),e.beginPath(),e.rect(0,0,495,400),e.fillStyle=n,e.fill();for(var a=0;a<Math.min(1,s.length);a++){for(var i=s[a],o=i.cycle.flat(16),c=(o.length,!1),u=Math.max(1,15-3*a),l={x:2*u,y:2*u},h=!1,p=0;p<o.length;p++){var d=o[p];if(d.type){var v=d.type,m=v.type,y=v.value;if(p>0){var b=d.accent?2*u:u;"-"===m?(l.x+=3*b,0===y&&(c=!c)):"."===m&&(h&&(l.y+=3*b),c=!c)}h="."===m;var g=l.x,O=l.y;if(c&&(O=400-O),null!==d.transpose){e.beginPath(),e.fillStyle=r;var k=window.rad*u;d.accent&&(k*=2);var j=2*Math.PI;d.staccato&&(j=Math.PI),i.currentCycles&&i.currentCycles[d.id]&&(e.fillStyle="red",e.fillStyle="#FFA47D"),a>0&&(e.fillStyle="gray",k=u),e.arc(g,O,k,0,j),d.piano||d.pianissimo?(e.strokeStyle=r,e.lineWidth=2,e.stroke()):e.fill()}}}0===a&&(l.x+=4*u,l.y+=4*u,e.fillStyle="black",e.fillRect(l.x,l.y,495-l.x-u,100),t.current&&(t.current.style.left=l.x+"px",t.current.style.top=l.y+"px",t.current.style.width=495-l.x+"px",t.current.style.height="100px"))}},[r,n,s,c]);return i.a.createElement("canvas",{className:"tidal-art",style:{width:495,height:400},width:495*window.devicePixelRatio,height:400*window.devicePixelRatio,ref:l})});var es=n(147);n(431);function ts(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ns(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ns(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ns(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}new $e.a;var rs=Object(a.memo)(function(e){var t=e.effect,n=e.cycle,r=e.total,s=e.parts,o=Object(a.useRef)(void 0);Object(a.useEffect)(function(){return s.current[n.id]||(s.current[n.id]=[]),s.current[n.id].push(o),function(){s.current[n.id]&&(s.current[n.id]=s.current[n.id].filter(function(e){return e!==o}))}},[n,s]);var c={width:r+"%"},u=0,l=Object(a.useCallback)(function(e){return"object"===typeof e?Math.max(1,Math.floor(t.var(e.name)())):Math.floor(e)},[t]),f="tidal-part";if(Array.isArray(n)){var h,p=ts(n);try{for(p.s();!(h=p.n()).done;){var d=h.value;d&&(u+="*"===d.operator||"^"===d.operator?l(d.operand):1)}}catch(b){p.e(b)}finally{p.f()}}else if(n.cycle&&Array.isArray(n.cycle)){var v,m=ts(n.cycle);try{for(m.s();!(v=m.n()).done;){var y=v.value;y&&(u+="^"===y.operator||"*"===y.operator?l(y.operand):1)}}catch(b){m.e(b)}finally{m.f()}}else null===n.transpose&&(f+=" rest"),null!==n.transpose&&(c.filter="hue-rotate("+window.hrotate*n.transpose+"deg)");return i.a.createElement("div",{ref:o,style:c,className:f},Array.isArray(n.cycle||n)?(n.cycle||n).filter(function(e){return e}).map(function(e,n){return"*"===e.operator||"^"===e.operator?new Array(l(e.operand)).fill(0).map(function(r,a){return i.a.createElement(rs,{effect:t,key:n+"-"+a,parts:s,cycle:e,total:100/u})}):i.a.createElement(rs,{parts:s,effect:t,key:n,cycle:e,total:100/u})}):i.a.createElement("span",null,Object(es.f)(n,!0)))}),as=rs;new $e.a;window.hrotate=4;var is=Object(o.b)(function(e,t){return{cycle:t.effect.cycle,currentCycles:t.effect.currentCycles}},function(e){return{}})(function(e){var t=e.effect,n=e.cycle,r=e.currentCycles,o=Object(a.useRef)({}),c=Object(a.useRef)([]);return Object(a.useEffect)(function(){if(r){var e=o.current;for(var t in c.current.forEach(function(e){e.current&&e.current.style&&(e.current.style.borderBottom="none")}),c.current=[],r)e[t]&&(e[t].forEach(function(e){e.current&&e.current.style&&(e.current.style.borderBottom="1px solid white")}),c.current=[].concat(Object(s.a)(c.current),Object(s.a)(e[t])))}},[r]),i.a.createElement("div",{className:"tidal-visualizer"},i.a.createElement(as,{parts:o,effect:t,cycle:n,total:100}))}),ss=Object(o.b)(function(e,t){var n={};return t.tidals.forEach(function(e){return n[e.id]=e.inUse}),n},function(e){return{}})(function(e){var t=e.tidals,n=e.isScript,s=e.WIDTH,o=e.HEIGHT,c=e.color,u=void 0===c?"#A19A9A":c,l=e.backgroundColor,f=void 0===l?"#100B0B":l,h=e.fillColor,p=void 0===h?"#757474":h,d=e.dotColor,v=void 0===d?"#B5B5B5":d,m=Object(a.useRef)(),y=Object(a.useState)(!1),b=Object(r.a)(y,2),g=(b[0],b[1],Object(a.useState)({x:0,y:0})),O=Object(r.a)(g,2),k=(O[0],O[1],Object(a.useState)(void 0)),j=Object(r.a)(k,2),w=j[0],x=j[1],S=t.filter(function(e){return e.inUse||e.lastUsed<1});S[0];return 0===S.length?"":i.a.createElement("div",{className:"script-tidals"},w&&i.a.createElement(zi,{setLeafDetails:x,sequencerEngine:t[0].track.sequencerEngine,leaf:w}),i.a.createElement("div",{ref:m,className:"display"},i.a.createElement("span",null)),i.a.createElement($i,{leafDetails:w,setLeafDetails:x,isScript:n,sequencerEngine:t[0].track.sequencerEngine,backgroundColor:f,color:u,fillColor:p,WIDTH:s,HEIGHT:o,dotColor:v,tidals:t}),i.a.createElement(Wi,{leafDetails:w,WIDTH:s,HEIGHT:o,setLeafDetails:x,sequencerEngine:t[0].track.sequencerEngine,backgroundColor:f,dotColor:v,color:u,tidals:S,total:S.length}))}),os=(Object(o.b)(function(e,t){return{variables:e.effects.scriptVariables[t.tidal.id]}},function(e){return{}})(function(e){var t=e.sequencerEngine,n=e.variables,r=void 0===n?[]:n;return i.a.createElement("div",{className:"tidal-variables"},(r||[]).map(function(e){return i.a.createElement(Mn,{name:e.name,min:e.min,max:e.max,step:e.max-Math.floor(e.max)!==0||e.min-Math.floor(e.min)!==0||Math.abs(e.max-e.min)<2?.01:1,parameter:e,lfoEnabled:!0,sequencerEngine:t,isParameter:!0,effectNumber:0})}))}),Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.code,n=e.setCode,s=e.isLoading,o=e.setIsLoading,c=e.scriptType,u=Object(a.useState)([]),l=Object(r.a)(u,2),f=l[0],h=l[1];Object(a.useEffect)(function(){Object(Ne.c)(c).then(h)},[h,c]);var p=Object(a.useCallback)(function(e){n('const fn = load("'+e.title+'");\n'+t),o(!1)},[t,n,o]);return s?i.a.createElement("div",{className:"load-script-flow"},f.map(function(e){return i.a.createElement("div",{onClick:function(){return p(e)},className:"script-option"},e.title)}),i.a.createElement("div",{className:"load-toolbar"},i.a.createElement("div",{onClick:function(){return o(!1)},className:"cancel-btn"},"Cancel"))):[]}));var cs=Object(o.b)(function(e,t){return{graphics:t.effect.graphics}},function(e){return{}})(function(e){e.effect,e.graphics;return""}),us=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.matchingParenthesis;if(!t)return[];var n={top:t.y,left:t.x};return i.a.createElement("div",{style:n,className:"matching-parenthesis"})}),ls=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.scriptType,n=e.isSaving,s=e.setIsSaving,o=e.code,c=Object(a.useState)(""),u=Object(r.a)(c,2),l=u[0],f=u[1],h=Object(a.useCallback)(Object(R.a)(M.a.mark(function e(){return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ne.d)(o,t,l);case 2:s(!1);case 3:case"end":return e.stop()}},e)})),[o,l,s,t]);return n?i.a.createElement("div",{className:"save-script-flow"},i.a.createElement("input",{placeholder:"Type name for script",type:"text",value:l,onChange:function(e){return f(e.target.value)}}),i.a.createElement("div",{className:"save-toolbar"},i.a.createElement("div",{onClick:function(){return s(!1)},className:"cancel-btn"},"Cancel"),i.a.createElement("div",{onClick:h,className:"done-btn"},"Done")),i.a.createElement("div",{className:"info"},"To load use ",i.a.createElement("br",null),i.a.createElement("code",null,'const fn = load("NAME YOU CHOSE HERE");'))):[]}),fs=(n(882),Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.code,n=(e.doc,e.scrollTop),r=t.replace(/[^0-9\n\s]/g," "),a=t.replace(/[^a-zA-Z\n\s]/g," "),s={top:-n};return[i.a.createElement("pre",{style:s,className:"syntax-highlighter number"},r),i.a.createElement("pre",{style:s,className:"syntax-highlighter letter"},a)]}),function(e,t){for(var n=0,r=0;r<e.length;r++)e[r]==t&&n++;return n}),hs=function(e,t){for(var n="",r=0;r<t;r++)n+=e;return n},ps=n(1736),ds=n.n(ps),vs=n(1737);n(1738),n(1739),n(1740),n(1741);window.startColor="#ff4d24",window.hueShift=4;var ms=new $e.a,ys=0,bs=function(e){var t=e.syntaxErrors,n=e.code,r=e.lineNumber,a=e.running,s=e.syntaxError,o=e.scrollTop;if(!t||0===t.length)return"";var c=(n||"").split("\n"),u="highlighter";a&&(u+=" running");ms.saturate(window.startColor,1);return c.map(function(e,n){return i.a.createElement("div",{key:n,style:{width:.5*e.length+"em",top:19*n-2-o,height:19},className:t&&t.some(function(e){return e.lineNumber===n+1})||s&&n+1===r?"syntax-error "+u:u})})},gs=Object(o.b)(function(e,t){return{syntaxErrorLine:t.effect.syntaxErrorLine,code:t.effect.code,tidals:t.effect.tidals,variables:e.effects.scriptVariables[t.effect.id],logs:t.effect.logs,logNum:t.effect.logs&&t.effect.logs.length,syntaxErrors:t.effect.syntaxErrors}},null)(function(e){e.tidals,e.isDraggable;var t,n=e.logs,s=e.scriptType,o=void 0===s?"USER_SCRIPT":s,c=e.effect,u=e.sequencerEngine,l=(e.variables,e.lang),f=void 0===l?vs.languages.js:l,h=e.doc,p=e.setExpanded,d=e.disableSyntaxHelper,v=e.expanded,m=e.width,y=e.height,b=Object(a.useRef)(void 0),g=Object(a.useRef)(void 0),O=Object(a.useState)(!1),k=Object(r.a)(O,2),j=k[0],w=k[1],x=Object(a.useRef)(void 0),S=(Object(a.useRef)(void 0),Object(a.useState)(!1)),P=Object(r.a)(S,2),E=P[0],T=P[1],A=Object(a.useState)(c.code),M=Object(r.a)(A,2),R=M[0],C=M[1],N=Object(a.useRef)(0),q=Object(a.useRef)(!1),I=Object(a.useRef)(!1),_=Object(a.useState)(!1),D=Object(r.a)(_,2),F=D[0],L=D[1],B=Object(a.useState)(!1),z=Object(r.a)(B,2),J=z[0],V=z[1],H=Object(a.useState)(0),U=Object(r.a)(H,2),G=U[0],W=U[1];Da({ref:b}).preventDragging;Object(a.useEffect)(function(){C(c.code)},[c,c.code,C]),Object(a.useEffect)(function(){c&&c.expanded&&"USER_SCRIPT"===o&&p(!0)},[]),kt(b);var K=Object(a.useCallback)(function(e){var t=g.current;t&&W(t.scrollTop),C(e.target.value);var n=++ys;setTimeout(function(){n===ys&&(c.hasSyntaxError(e.target.value)?V(!0):V(!1))},1e3)},[C,V,W]),Q=st({ref:g,code:R,onChange:K,doc:h,disable:d}),Z=Q.library,Y=Q.setLibrary,X=Q.choosePossibility,$=Q.possibilities,ee=Q.setPossibilities,te=Q.selectedChoice,ne=Q.matchingParenthesis;Object(a.useEffect)(function(){if((q.current||I.current)&&g.current){if(q.current){q.current=!1;var e=function(e,t){var n="",r=e.split("\n"),a=0,i=0,s=0,o=0;for(var c in r){var u=r[c],l=fs(u,"("),f=fs(u,")"),h=fs(u,"{"),p=fs(u,"}"),d=a-i-p,v=u.trimStart();n+=hs("  ",d)+v,parseInt(c)<r.length-1&&(n+="\n"),a+=l+h,i+=f+p,s<=t&&t<=s+u.length+1&&(o=t+2*d),s+=u.length+1}return{indented:n,caret:o}}(R,N.current+1);if(e.indented===R)return;re(e.indented,e.caret)}if(I.current){var t=I.current;I.current=void 0;var n=N.current+1,r=function(e,t,n){return t.slice(0,n)+e+t.slice(n)}(t,R,N.current+1);re(r,n)}}},[R,C]);var re=Object(a.useCallback)(function(e,t){var n=x.current.scrollTop,r=g.current.style.resize,a=g.current.style.overflow;g.current.style.resize="none",x.current.style.overflow="hidden",g.current.style.overflow="hidden",g.current.blur(),C(e),setTimeout(function(){g.current.setSelectionRange(t,t),x.current.scrollTo(0,n),g.current.style.resize=r,g.current.focus(),x.current.style.overflow="scroll",g.current.style.overflow=a},10)},[C]);function ae(){var e=document.getElementById(c.id+"-script");e&&e.removeEventListener("scroll",ie)}Object(a.useEffect)(function(){C(c.code);var e=g.current;return e&&e.addEventListener("scroll",ie),ae},[c,C]);var ie=Object(a.useCallback)(function(){var e=document.getElementById(c.id+"-script");e&&W(e.scrollTop)},[W]),se=(Object(a.useCallback)(function(){},[R]),Object(a.useCallback)(function(){c.eval(R,void 0,!0),L(!0),setTimeout(function(){return L(!1)},100)},[R,L])),oe=Object(a.useCallback)(function(e){g.current&&(N.current=g.current.selectionStart),"Enter"===e.key&&e.ctrlKey?(e.stopPropagation(),e.preventDefault(),se()):"Enter"===e.key?q.current=!0:"{"===e.key?I.current="}":"("===e.key||'"'===e.key||e.key},[se]),ce="execute-button",ue="user-script-component";F&&(ce+=" running",ue+=" running"),Object(a.useEffect)(function(){g.current=document.getElementById(c.id+"-script")},[c]),v&&(ue+=" expanded");var le="";n&&(le=n[n.length-1]);var fe="script-and-tidal";return v&&"User Script"===c.name&&(fe+=" expanded"),J&&(ue+=" syntax-error"),i.a.createElement("div",{className:fe},i.a.createElement("div",{ref:b,className:ue},p?i.a.createElement("img",{onClick:function(){c.expanded=!v,p(v?void 0:c)},className:"expanded-icon",src:"/expand-icon.svg"}):"",i.a.createElement("div",{draggable:!0,ref:x,onDragStart:function(e){return e.preventDefault()},onMouseDown:function(){ee([]),Y(void 0)},style:v?{height:340}:y?{height:y,width:m}:{},className:"script-box"},i.a.createElement(ls,{scriptType:o,setIsSaving:w,code:R,isSaving:j}),i.a.createElement(os,(t={setCode:C,code:R,scriptType:o,setIsLoading:T},Object(Fe.a)(t,"code",R),Object(Fe.a)(t,"isLoading",E),t)),i.a.createElement(ds.a,{textareaId:c.id+"-script",value:R||"",onValueChange:function(e){return K({target:{value:e}})},highlight:function(e){return Object(vs.highlight)(e,f)},onKeyDown:oe,onMouseDown:function(e){e.stopPropagation()},spellCheck:"false",className:"user-script-code"}),i.a.createElement(bs,{scrollTop:G,running:F,lineNumber:c.syntaxErrorLine,syntaxErrors:c.syntaxErrors,syntaxError:J,code:R}),i.a.createElement(us,{matchingParenthesis:ne}),i.a.createElement(De,{library:Z,setLibrary:Y,doc:h,effect:c,selectedChoice:te,choosePossibility:X,scrollTop:G,input:g,setPossibilities:ee,possibilities:$})),E||j?"":i.a.createElement("div",{className:"script-toolbar"},i.a.createElement("div",{className:"load-script-btn",onClick:function(){return T(!0)}},"Load"),i.a.createElement("div",{className:"save-script-btn",onClick:function(){return w(!0)}},"Save"),i.a.createElement("div",{className:ce,onClick:se},i.a.createElement("div",{className:"arrow-right"}),i.a.createElement("span",null,"Run"))),i.a.createElement(cs,{effect:c}),i.a.createElement(Bi,{sequencerEngine:u,effect:c}),i.a.createElement("div",{className:"log-display"},le)))}),Os=Object(a.memo)(function(e){var t=Object(a.useState)(!1),n=Object(r.a)(t,2),s=n[0],o=n[1],c=Object(a.useRef)(void 0),u=Object(a.useCallback)(function(){return"Parameterizer"===e.effect.name?i.a.createElement(Ei,{effectNumber:e.effectNumber,sequencerEngine:e.sequencerEngine,automation:e.automation,selectedParameter:e.selectedParameter,onEffectsChange:e.onEffectsChange,onParameterChanged:e.onParameterChanged,effect:e.effect}):"User Script"===e.effect.name?i.a.createElement(gs,{isDraggable:e.isDraggable,setExpanded:o,expanded:s,effectNumber:e.effectNumber,sequencerEngine:e.sequencerEngine,automation:e.automation,selectedParameter:e.selectedParameter,doc:xi.a,onEffectsChange:e.onEffectsChange,onParameterChanged:e.onParameterChanged,effect:e.effect}):"Stats"===e.effect.name?i.a.createElement(Ti,Object.assign({effectNumber:e.effectNumber,sequencerEngine:e.sequencerEngine,automation:e.automation,selectedParameter:e.selectedParameter,onEffectsChange:e.onEffectsChange,onParameterChanged:e.onParameterChanged,effect:e.effect},e)):e.effect.isScript?i.a.createElement(Ni,{effectNumber:e.effectNumber,sequencerEngine:e.sequencerEngine,automation:e.automation,selectedParameter:e.selectedParameter,onEffectsChange:e.onEffectsChange,onParameterChanged:e.onParameterChanged,effect:e.effect}):[]},[s,o,e.effect]);return i.a.createElement(fn,{refObj:c,className:"midi-effect-container",element:e.effect},i.a.createElement(xa,Object.assign({},e,{onDeleteEffect:e.onDeleteEffect,isMidiEffect:!0,effectNumber:e.effectNumber,onToggle:function(){return[]},track:e.track,effect:e.effect,automation:e.automation}),u()))});function ks(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return js(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return js(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function js(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ws=Object(o.b)(function(e,t){return{effectStarred:e.effects.effectStarred}},function(e){return{}})(function(e){e.showPads;var t=e.effectStarred,n=e.subSequence,o=Object(a.useRef)(void 0),c=(Object(a.useRef)({}),n.midiEffects.shadowEffects),u=Object(a.useState)([]),l=Object(r.a)(u,2),f=l[0],h=l[1];Object(a.useEffect)(function(){var e,r=Object(s.a)(n.getAllEffects()),a=function(e){var t,n=[],r=ks(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a),a.effects&&(n=[].concat(Object(s.a)(n),Object(s.a)(a.effects)))}}catch(i){r.e(i)}finally{r.f()}return n},i=ks(n.tracks);try{for(i.s();!(e=i.n()).done;){var o=e.value;r=[].concat(Object(s.a)(r),Object(s.a)(a(o.effects)),Object(s.a)(a(o.midiEffects.effects)))}}catch(c){i.e(c)}finally{i.f()}r=[].concat(Object(s.a)(r),Object(s.a)(n.sequencers)),h(r.filter(function(e){return t[e.id]}))},[h,t]);var p=function(e){if(e.type===ia.a);else if(e.getEffectType()!==sa.a)return i.a.createElement(Os,{showDelete:!1,isDraggable:!1,featured:!0,sequencerEngine:n.sequencerEngine,WIDTH:180,HEIGHT:95,track:e.track,compact:!0,instrument:!0,onDeleteEffect:function(){return[]},effect:e,send:void 0})};n.midiEffects.effects.find(function(e){return"User Script"===e.name});return i.a.createElement("div",{ref:o,className:"module-inner"},i.a.createElement("div",{className:"module-row"},i.a.createElement(wi,{showDelete:!1,isDraggable:!1,featured:!0,sequencerEngine:n.sequencerEngine,track:n,compact:!0,instrument:!0,onDeleteEffect:function(){return[]},effect:n.playhead,send:void 0}),p(c[0])),i.a.createElement("div",{className:"module-row"},p(c[1]),i.a.createElement("div",{className:"module-col"},i.a.createElement("div",null,i.a.createElement("div",{className:"effect midi enabled transpose-container"},i.a.createElement("div",{className:"effect-inner"},i.a.createElement(Mn,{parameter:n.midiEffects.transposeParameter,name:"Transpose",min:-32,step:1,max:32,sequencerEngine:n.sequencerEngine}))),p(c[2])))),i.a.createElement("div",{className:"starred-effects"},f.map(function(e){return p(e)})))}),xs=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.zobject,n=t.subSequence.getRootSubSequence?t.subSequence.getRootSubSequence():t.subSequence;return i.a.createElement(ws,{subSequence:n})}),Ss=(n(1742),n(547)),Ps=["A","B","C","D","E","F","G","H","I","J","K","L","M","N"],Es=[{label:"Stay",value:Ss.d},{label:"Forward",value:Ss.b},{label:"Reverse",value:Ss.c},{label:"Brownian",value:Ss.a}],Ts=function(e){var t=e.i,n=e.scene,s=e.subSequence,o=Object(a.useState)(n.durationPercentages[t]),c=Object(r.a)(o,2),u=(c[0],c[1]),l=Object(a.useState)(n.algorithmTypes[t]),f=Object(r.a)(l,2),h=f[0],p=f[1],d=Object(a.useState)(n.patterns[t]),v=Object(r.a)(d,2),m=v[0],y=v[1];Object(a.useEffect)(function(){y(n.patterns[t]),u(n.durationPercentages[t]),p(n.algorithmTypes[t])},[t,n,y,p,u]);var b=Object(a.useCallback)(function(e){n.algorithmTypes[t]=e.value,p(e.value)},[p,t,n]),g=(Object(a.useCallback)(function(e){n.durationPercentages[t]=e},[u,t,n]),Object(a.useCallback)(function(e){n.patterns[t]=e.value,y(e.value)},[y,t,n])),O=(s.tracks[0]?s.tracks[0].patterns:[]).map(function(e,t){return{label:"Pattern "+(t+1),value:t}}),k=Ps[t];return i.a.createElement("div",{className:"sub-sequence-details"},i.a.createElement("div",{className:"sub-name"},k,":"),i.a.createElement(vt.a,{controlClassName:"pattern-dropdown",options:O,onChange:g,value:O.find(function(e){return e.value===m}),placeholder:"Pattern"}),i.a.createElement(vt.a,{options:Es,onChange:b,value:Es.find(function(e){return h===e.value}),placeholder:"Algo Type"}))},As=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.currentScene,n=e.sequencerEngine;return t?i.a.createElement("div",{className:"scene-details"},n.subSequences.map(function(e,n){return i.a.createElement(Ts,{i:n,subSequence:e,scene:t})})):[]}),Ms=function(e){var t=e.scene,n=e.scenes,s=e.isCurrent,o=e.setSceneDragging,c=(e.sceneDragging,e.onDropScene),u=Object(a.useRef)(0),l=Object(a.useState)(!1),f=Object(r.a)(l,2),h=f[0],p=f[1],d=Object(a.useState)(t.name),v=Object(r.a)(d,2),m=v[0],y=v[1],b="scene-option";s&&(b+=" current");var g=Object(a.useCallback)(function(){var e=(new Date).getTime();e-u.current<=400&&p(!0),u.current=e,n.switchToScene(t)},[p]),O=Object(a.useCallback)(function(e){y(e.target.value)},[y]),k=Object(a.useCallback)(function(e){"Enter"===e.key&&(p(!1),t.name=m)},[p,m,t]);return i.a.createElement("div",{draggable:!0,onDragStart:function(){return o(t)},onDragOver:function(e){return e.preventDefault()},onDrop:function(){return c(t)},onClick:g,className:b},h?i.a.createElement("input",{onChange:O,onKeyDown:k,type:"text",value:m}):m,i.a.createElement("div",{className:"scene-info"},t.patterns.map(function(e){return e+1}).join(" - ")),i.a.createElement("div",{onClick:function(e){e.stopPropagation(),n.deleteScene(t)},className:s?"delete-btn":"hide delete-btn"},"x"))},Rs=Object(o.b)(function(e,t){return{scenes:e.sequencer.scenes,currentScene:e.sequencer.currentScene}},function(e){return{}})(function(e){var t=e.currentScene,n=e.scenes,s=e.sequencerEngine,o=Object(a.useState)(void 0),c=Object(r.a)(o,2),u=c[0],l=c[1];console.log("rendering scenes = ",n);var f=Object(a.useCallback)(function(e){var t=n.indexOf(u),r=n.indexOf(e);s.scenes.moveScene(t,r)},[u,n]);return i.a.createElement("div",{className:"scenes-container"},i.a.createElement("div",{className:"scenes-component"},i.a.createElement("div",{className:"scenes-toolbar"},i.a.createElement("div",{className:"scenes-header"},"Scenes"),t?"":i.a.createElement("div",{onClick:function(){return s.scenes.newScene()},className:"new-scene-btn"},"+")),n.map(function(e){return i.a.createElement(Ms,{key:e.id,onDropScene:f,setSceneDragging:l,sceneDragging:u,isCurrent:t===e,scenes:s.scenes,scene:e})})),i.a.createElement(As,{sequencerEngine:s,currentScene:t}))});function Cs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var Ns=["A","B","C","D","E","F","G","H","I","J","K","L","M","N"],qs=function(e){Object(b.a)(n,e);var t=Cs(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={},r}return Object(y.a)(n,[{key:"onChangeVolume",value:function(e){this.props.subSequence.fade=e,this.props.currentSubSequence!==this.props.subSequence.id&&this.props.sequencerEngine.switchToSubSequence(this.props.subSequence.id)}},{key:"onClickMute",value:function(){this.props.subSequence.mute=!this.props.muted}},{key:"patterns",get:function(){var e=this.props.subSequence.tracks[0];return void 0===e?[]:e.patterns}},{key:"render",value:function(){var e=this,t="sub-sequence-fader";return this.props.currentSubSequence===this.props.subSequence.id&&(t+=" selected"),i.a.createElement("div",{key:"sub-sequence-fader-"+this.props.subSequence.id,className:t},i.a.createElement("div",{className:"mix-patterns"},this.patterns.map(function(t,n){return i.a.createElement(Is,{key:"pattern-"+n,subSequence:e.props.subSequence,sequencerEngine:e.props.sequencerEngine,isCurrent:n===e.props.currentPattern,pattern:n})})),i.a.createElement("div",{className:"sub-sequence-fader-and-info"},i.a.createElement("div",{className:"sub-sequence-fader-empty"}),i.a.createElement("div",{className:"volume-slider-container"},i.a.createElement(sn.a,{handle:"square",value:this.props.volume,change:function(t){return e.onChangeVolume(t.target.value)},step:.01,max:1,min:0,orientation:"vertical",reversed:!0})),i.a.createElement("div",{onClick:function(){return e.onClickMute()},className:this.props.muted?"sub-sequence-info muted":"sub-sequence-info"},Ns[this.props.i])))}}]),n}(a.Component),Is=function(e){Object(b.a)(n,e);var t=Cs(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"render",value:function(){var e=this,t="sub-sequence-pattern";return this.props.isCurrent&&(t+=" current"),i.a.createElement("div",{onClick:function(){return e.switchToPattern()},className:t},this.props.pattern+1)}},{key:"switchToPattern",value:function(){this.props.sequencerEngine.switchToPattern(this.props.pattern,!1,this.props.subSequence),this.props.sequencerEngine.switchToSubSequence(this.props.subSequence.id)}}]),n}(a.Component),_s=Object(o.b)(function(e,t){var n=e.mix.subSequenceFades[t.subSequence.id],r=t.sequencerEngine.engineId;return{volume:void 0===n?1:n,muted:e.mix.subSequenceMuted[t.subSequence.id],currentPattern:e.sequencer.currentPattern[t.subSequence.id]||0,currentSubSequence:e.sequencer.currentSubSequence[r]}},null)(qs);n(1743);function Ds(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Fs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Fs(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Fs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ls=new $e.a,Bs=Object(a.memo)(function(e){e.note;var t=e.isPlayed,n=e.tracks,r=e.size,a=[],s=i.a.createElement("line",{x1:0,y1:0,x2:r,y2:0,className:t?"played mark":"mark"});if(n)for(var o=1*r/n.length,c=0;c<n.length;c++){var u=n[c];a.push(i.a.createElement("circle",{cx:c*o,cy:-20,r:3,stroke:Ls.getColorForTrack(u)}))}return i.a.createElement("g",null,s," ",a)}),zs=function(e,t){return(e%t+t)%t},Js=Object(o.b)(function(e,t){return{trackStep:t.sequencerEngine.trackStep}},function(e){return{}})(function(e){var t,n=e.sequencerEngine,r=e.trackStep,a=void 0===r?0:r,s=e.size,o=void 0===s?100:s,c=new Set,u={},l=Ds(n.subSequences);try{for(l.s();!(t=l.n()).done;){var f,h=Ds(t.value.tracks);try{for(h.s();!(f=h.n()).done;){var p=f.value,d=p.notesTriggered||{};for(var v in d)v=zs(v,12),c.add(v),u[v]||(u[v]=[]),u[v].push(p)}}catch(y){h.e(y)}finally{h.f()}}}catch(y){l.e(y)}finally{l.f()}var m=(a%=32)/32*(2*o*Math.PI);return i.a.createElement("div",{className:"pitch-clock"},i.a.createElement("svg",null,i.a.createElement("circle",{strokeDasharray:[m,999],cx:o,cy:o,r:o,stroke:"white"}),i.a.createElement("g",{className:"marks"},[0,1,2,3,4,5,6,7,8,9,10,11].map(function(e){return i.a.createElement(Bs,{size:o,tracks:u[e],key:e,note:e,isPlayed:c.has(e)})}))))}),Vs=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.sequencerEngine;return i.a.createElement("div",{className:"mix-modules"},i.a.createElement(Js,{sequencerEngine:t}))}),Hs=function(e){return i.a.createElement("div",{className:"global-mix-container"},i.a.createElement("div",{className:"sub-sequences-mix-container"},e.sequencerEngine.subSequences.filter(function(e){return!e.isTrack}).map(function(t,n){return i.a.createElement(_s,{key:"sub-mix-"+n,sequencerEngine:e.sequencerEngine,i:n,subSequence:t})}),i.a.createElement(Rs,{sequencerEngine:e.sequencerEngine}),i.a.createElement(Vs,{sequencerEngine:e.sequencerEngine})))},Us=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.zobject;return i.a.createElement(Hs,{sequencerEngine:t.sequencerEngine})}),Gs=(n(883),Object(o.b)(function(e,t){return{updates:t.zobject.updates}},function(e){return{}})(function(e){var t=e.zobject;e.updates;return i.a.createElement("div",{className:"z-matrix"},t.matrix.map(function(e){return i.a.createElement("div",{className:"z-row"},e.map(function(e){return i.a.createElement("div",{className:"z-value"},e)}))}))})),Ws=new Y.a(4,!1),Ks=new Y.a(8,!1),Qs=new Y.a(16,!1),Zs=new Y.a(32,!1),Ys=function(e){var t=e.color,n=e.resolution,s=e.sequencerEngine,o=e.isSequenceRolling,c=e.engine,u=Object(a.useRef)(void 0),l=Object(a.useState)(!1),f=Object(r.a)(l,2),h=f[0],p=f[1];Object(a.useEffect)(function(){p(o)},[o,p]);var d=Object(a.useCallback)(function(){var e=Object(je.a)({},s.idToSequencerEngine,{"-1":s.samplerTrack}),t=c||e[Object.keys(e)[0]];if(void 0!==t){for(var r in t.resolution=n,t.trackRolling=!0,e)e[r]&&(e[r].sequenceRolling=!0);c&&(c.sequenceRolling=!0),p(!0)}},[p,c]),v=Object(a.useCallback)(function(){var e=Object(je.a)({},s.idToSequencerEngine,{"-1":s.samplerTrack}),t=c||e[Object.keys(e)[0]];if(void 0!==t){for(var r in t.resolution=n,e)e[r]&&(e[r].sequenceRolling=!1);t.trackRolling=!1,c&&(c.sequenceRolling=!1),p(!1)}},[p]),m="explore-roll-button";return h&&(m+=" flash-it rolling"),i.a.createElement("div",{ref:u,style:{backgroundColor:t},onMouseDown:d,onMouseUp:v,onTouchStart:d,onTouchEnd:v,onTouchLeave:v,className:m},"1/",n.resolution)},Xs=Object(o.b)(function(e,t){return{resolution:e.sequencer.resolution,isRolling:e.sequencer.trackRolling&&t.sequencerEngine&&t.sequencerEngine.isSequenceRolling}},null)(function(e){var t=e.color,n=e.resolution,r=e.sequencerEngine,a=e.isRolling,s=e.engine;return i.a.createElement("div",{className:"roll-buttons"},i.a.createElement(Ys,{color:t,isSequenceRolling:a&&4===n.resolution,engine:s,sequencerEngine:r,resolution:Ws}),i.a.createElement(Ys,{color:t,isSequenceRolling:a&&8===n.resolution,engine:s,sequencerEngine:r,resolution:Ks}),i.a.createElement(Ys,{color:t,isSequenceRolling:a&&16===n.resolution,engine:s,sequencerEngine:r,resolution:Qs}),i.a.createElement(Ys,{color:t,isSequenceRolling:a&&32===n.resolution,engine:s,sequencerEngine:r,resolution:Zs}))}),$s=(n(1744),Object(o.b)(function(e,t){return{secondaryColor:t.zobject.attributes["secondary-color"]}},function(e){return{}})(function(e){var t=e.zobject,n=(e.attributes,e.secondaryColor);return i.a.createElement("div",null,t.sequencerEngine&&i.a.createElement(Xs,{color:n,engine:t.sequencerEngine,sequencerEngine:t.sequencerEngine}))})),eo=n(171),to=n(33),no=new $e.a,ro=new to.a,ao=function(e){var t=e.track,n=e.value,r=e.editing,s=e.data,o=e.isCursor,c=e.isCurrent,u=e.color,l=e.parameterToEdit,f=e.setParameterToEdit,h=s.stepData,p=s.stepNumber;h||(h=ro);var d=Object(a.useCallback)(function(e){t.sequencerEngine.operationManager.dispatch(Object(X.r)(t,2*p))},[p,t]),v=Object(a.useCallback)(function(e,n){f(n),r.current=!0,t.sequencerEngine.select(t.trackNumber,p)},[p,t]),m="tracker-step";return c&&(m+=" current"),o&&(m+=" cursor"),i.a.createElement("div",{onClick:h&&!h.on?d:function(){return[]},className:m},i.a.createElement("div",{className:"inner-step"},i.a.createElement("div",{onClick:d,className:p%8===0?"bar step-number":p%4===0?"half-bar step-number":"step-number"},p+1),h&&h.on?i.a.createElement("div",{className:"step-data"},i.a.createElement("div",{style:{color:u},onClick:function(e){return v(e,h.transposeParameter)},className:l===h.transposeParameter?"edit note-name":"note-name"},eo.a.fromTranspose(h.transpose).toString()),i.a.createElement(io,{v:n,value:h.duration,parameter:h.durationParameter,parameterToEdit:l,setParameterToEdit:v}),i.a.createElement(io,{v:n,value:h.velocity,parameter:h.velocityParameter,parameterToEdit:l,setParameterToEdit:v})):""))},io=function(e){var t=e.value,n=e.parameter,r=e.setParameterToEdit,a=e.parameterToEdit;return i.a.createElement("div",{onClick:function(e){return r(e,n)},className:n===a?"edit tracker-parameter":"tracker-parameter"},t)},so=Object(o.b)(function(e,t){var n=t.track.sequencerEngine.cursor,r=e.mix.trackerParameterToEdit;return{trackSteps:e.tracks.trackSteps[t.track.id],stepBuckets:t.pattern.stepBuckets,parameterToEdit:r,isSelectedTrack:n.track===t.track.trackNumber}},function(e){return{setParameterToEdit:function(t){return e(Object(c.Ce)(t))}}})(function(e){var t=e.track,n=e.pattern,s=e.currentStep,o=e.step,c=e.parameterToEdit,u=e.trackSteps,l=e.isSelectedTrack,f=e.cursorStep,h=e.editing,p=e.setParameterToEdit,d=Object(a.useState)(void 0),v=Object(r.a)(d,2),m=v[0],y=v[1],b=Object(a.useState)(c&&c.get()),g=Object(r.a)(b,2),O=g[0],k=g[1];Object(a.useEffect)(function(){c&&k(c.get())},[k,c]),Object(a.useEffect)(function(){y(no.getColorForTrack(t))},[t,y]),Object(a.useEffect)(function(){return window.addEventListener("keydown",j),function(){return window.removeEventListener("keydown",j)}},[c,k,t]);var j=Object(a.useCallback)(function(e){if(c&&c.track===t){e.stopPropagation();var n=c.get()||t.trackData.parameters.find(function(e){return e.name===c.name}).get();if(Object(fe.a)(e.key)){var r=parseInt(e.key);c.set(r),k(r)}else if(e.key>="a"&&e.key<="g"){if("Transpose"===c.name){var a=eo.a.fromTranspose(c.get());a.note=e.key.toUpperCase(),c.set(a.getTranspose()),k(a.getTranspose())}}else"ArrowUp"===e.key?(c.set(n+1),k(n+1)):"ArrowDown"===e.key&&(c.set(n-1),k(n-1))}},[c,k,t]),w=n.length()/2,x=function(e,t){for(var n=e.length(),r=[],a=-7;a<=7;a++){var i=Object(Hi.a)(2*(t+a),n),s=e.stepBuckets[i],o=s.getAnyOnStep()||s.steps[0];r.push({stepData:o,stepNumber:i/2})}return r}(n,(isNaN(o)?s:o)%w);return i.a.createElement("div",{className:"tracker"},i.a.createElement($r,{hasInner:!0,track:t}),x.map(function(e,n){return i.a.createElement(ao,{parameterToEdit:c,setParameterToEdit:p,track:t,on:u&&u[e.stepNumber],value:O,key:n+"."+e.stepNumber,color:m,editing:h,isCursor:l&&e.stepNumber===f,isCurrent:e.stepNumber===s%w,data:e})}))}),oo=Object(o.b)(function(e,t){var n=Math.floor(t.group.sequencerEngine.lastTrackStep||0),r=t.group.sequencerEngine.cursor;return{currentStep:Math.floor(n/2),pattern:t.group.tracks[0]&&t.group.tracks[0].pattern,cursorStep:r.step/2,playing:t.group.sequencerEngine.playing,numTracks:t.group.tracks&&t.group.tracks.length}},function(e){return{setParameterToEdit:function(t){return e(Object(c.Ce)(t))}}})(function(e){var t=e.group,n=e.currentStep,s=e.setParameterToEdit,o=e.cursorStep,c=e.playing,u=Object(a.useRef)(u),l=Object(a.useState)(void 0),f=Object(r.a)(l,2),h=f[0],p=f[1],d=Object(a.useState)(!1),v=Object(r.a)(d,2),m=v[0],y=v[1],b=Object(a.useRef)(!1);Object(a.useCallback)(function(){p(void 0)},[n,p,y]);Object(a.useEffect)(function(){p(void 0),b.current=!1,y(!1)},[c,p,y]);var g=Object(a.useCallback)(function(e){e.stopPropagation(),e.preventDefault();var r=Math.min(t.sequencerEngine.length,Math.max(0,(h||n)+e.deltaY/8));p(r),y(!0)},[p,h,n,y]);Object(a.useEffect)(function(){return u.current.addEventListener("mousewheel",g),function(){u.current&&u.current.removeEventListener("mousewheel",g)}},[p,h,n,y]);var O=Object(a.useCallback)(function(){p(void 0),s(void 0),y(!1),b.current=!1},[p,s]);Object(a.useEffect)(function(){b.current||(t.sequencerEngine.getSelectedTrack(),p(o))},[o,p]);var k=t.sequencerEngine.getSelectedTrack();return Object(a.useEffect)(function(){},[h,o,p,m,k]),i.a.createElement("div",{onMouseLeave:O,ref:u,className:"group-tracker"},t.tracks.map(function(e){return i.a.createElement(so,{pattern:e.pattern,editing:b,step:Math.floor(h),setIsScrolling:y,cursorStep:o,currentStep:n,key:e.id,track:e})}))}),co=(n(1745),Object(o.b)(function(e,t){return{}},function(e){return{setKeyboardContext:function(t){return e(Object(c.Tb)(t))}}})(function(e){var t=e.zobject,n=e.setKeyboardContext,r=t.subSequence;return r.getRootSubSequence&&(r=r.getRootSubSequence()),i.a.createElement("div",{onMouseEnter:function(){return n(t)},onClick:function(){return n(t)},className:"z-tracker"},i.a.createElement(oo,{group:r}))})),uo=Object(o.b)(function(e,t){return{immutable:t.tidal.cycleParameter.immutable,cycle:t.tidal.cycle,currentLeaves:t.tidal.currentLeaves}},function(e){return{}})(function(e){var t=e.tidal,n=e.cycle,r=e.currentLeaves,a=e.immutable,s=Object(es.d)(n,r,!0),o=s.spans,c=s.index,u=a?"immutable tidal-string":"tidal-string";return r&&r.some(function(e){return null!==e.transpose})&&(u+=" triggering"),i.a.createElement("div",{className:u},i.a.createElement("span",{className:"cycle-length"},t.cycleLength),i.a.createElement("div",{onClick:function(){return t.lockGroove(!a)},className:a?"immutable dot":"dot"}),o.map(function(e,t){return i.a.createElement("span",{keys:t,className:t===c?"str-part current":"str-part"},e)}))}),lo=Object(o.b)(function(e,t){return{cycle:t.effect.cycle}},null)(function(e){var t=Object(a.useRef)(void 0),n=Object(a.useState)(e.effect.cycleString),s=Object(r.a)(n,2),o=s[0],c=s[1],u=Object(a.useState)(!1),l=Object(r.a)(u,2),f=l[0],h=l[1],p=Object(a.useState)(!1),d=Object(r.a)(p,2),v=d[0],m=d[1];Object(a.useEffect)(function(){c(Object(es.e)(e.cycle))},[c,e.cycle]);var y=Object(a.useCallback)(function(e){"Enter"===e.key&&b()},[o,e.effect,m]),b=Object(a.useCallback)(function(){var t=Object(es.g)(o);t&&t.length>0?e.sequencerEngine.operationManager.dispatch(Object(X.s)(e.effect.cycleParameter,t)):(h(!0),setTimeout(function(){h(!1)},1e3)),m(!1)},[e.effect,h,o,m]),g=Object(a.useCallback)(function(t){t.target.value,document.activeElement.blur(),e.effect.cycleRetrigger=!e.effect.cycleRetrigger},[e.effect]);return i.a.createElement("div",{ref:t},i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},draggable:!0,onDragStart:function(e){return e.preventDefault()},className:"tidal-component"},!v&&i.a.createElement(uo,{tidal:e.effect}),i.a.createElement(pn.b,{value:o,onKeyDown:y,onChange:function(e){m(!0),c(e.target.value)},placeholder:"Output Note",className:"tidal-input"}),i.a.createElement("div",{className:"enter-button",onClick:b},"Enter")),i.a.createElement(Tn.a,{condition:f},i.a.createElement("div",{className:"error-box"},"Syntax Error")),!e.noUI&&i.a.createElement(is,{effect:e.effect}),!e.noUI&&i.a.createElement("div",{className:"tidal-parameters"},i.a.createElement(Mn,{effectNumber:e.effectNumber,name:"Cycle Length",parameter:e.effect.cycleLengthParameter,automation:e.automation,onParameterChanged:e.onParameterChanged,isParameter:!0,sequencerEngine:e.sequencerEngine,lfoEnabled:!0,step:1,min:4,max:64}),i.a.createElement(Mn,{effectNumber:e.effectNumber,name:"Speed Factor",parameter:e.effect.lengthFactorParameter,automation:e.automation,onParameterChanged:e.onParameterChanged,isParameter:!0,sequencerEngine:e.sequencerEngine,lfoEnabled:!0,step:.5,min:.5,max:4}),i.a.createElement(Mn,{effectNumber:e.effectNumber,name:"Duration Factor",parameter:e.effect.durationFactorParameter,automation:e.automation,onParameterChanged:e.onParameterChanged,isParameter:!0,sequencerEngine:e.sequencerEngine,lfoEnabled:!0,step:.01,min:.1,max:4}),e.effect.variables.map(function(t){return i.a.createElement(Mn,{name:t.name,min:t.min,max:t.max,step:1,parameter:t,lfoEnabled:!0,sequencerEngine:e.sequencerEngine,isParameter:!0,effectNumber:e.effectNumber})})),!e.noUI&&i.a.createElement("div",{className:"refined-checkbox-preferences"},i.a.createElement("label",null,i.a.createElement("input",{type:"checkbox",value:"reversed",checked:e.effect.cycleRetrigger,onChange:g}),"Cycle Retrigger")))}),fo=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.tidal,n=e.zobject;return t?i.a.createElement("div",{className:"z-tidal"},i.a.createElement(lo,{noUI:!0,effect:t,sequencerEngine:n.sequencerEngine})):""}),ho=(n(1746),Object(o.b)(function(e,t){return{_samples:t.sampleBank&&t.sampleBank.samples,sampleDragging:e.selector.sampleDragging,_lastSampleSent:t.sampleBank&&t.sampleBank.lastSampleSent}},function(e){return{}})(function(e){var t=e.sampleBank,n=e.sampleDragging,o=e._lastSampleSent,c=e._samples,u=Object(a.useState)(t.samples),l=Object(r.a)(u,2),f=l[0],h=l[1],p=Object(a.useState)(t.lastSampleSent),d=Object(r.a)(p,2),v=d[0],m=d[1];Object(a.useEffect)(function(){c&&h(c)},[c,h]),Object(a.useEffect)(function(){m(o)},[o,m]);var y=Object(a.useCallback)(function(e){e.stopPropagation(),n&&(t.addSample(n),h(Object(s.a)(t.samples)))},[t,n,h]),b=Object(a.useCallback)(function(e){t.deleteSample(e),h(Object(s.a)(t.samples))},[t,h]);return i.a.createElement("div",{onDrop:y,className:"sample-bank"},i.a.createElement("div",{className:"samples"},f&&f.map(function(e){return i.a.createElement("div",{onClick:function(){t.sendSample(e),m(e)},className:e===v?"current sample-option":"sample-option"},i.a.createElement("div",{className:"sample-name"},la(e.name)),e.tags.map(function(e){return i.a.createElement("div",{className:"sample-tag"},la(e))}),i.a.createElement("div",{onClick:function(){return b(e)},className:"delete-btn"},"x"))})),(!f||0===f.length)&&i.a.createElement("div",{className:"drop-here"},i.a.createElement("span",{className:"drop-text"},"Drop Samples Here")))})),po=Object(o.b)(function(e,t){return{uxLocked:e.zobject.uxLocked,width:t.toggle.zObject.width,height:t.toggle.zObject.height,_value:t.toggle.value}},function(e){return{setSelectedZObject:function(t){return e(Object(c.wd)(t))}}})(function(e){var t=e.setSelectedZObject,n=e.uxLocked,s=e.toggle,o=e._value,c=(e.height,Object(a.useState)(o)),u=Object(r.a)(c,2),l=u[0],f=u[1];Object(a.useEffect)(function(){f(o)},[o]);var h="ztoggle ";l&&(h+=" toggled");var p=Object(a.useCallback)(function(){t(s.zObject),n&&f(s.toggle())},[s,f,n]);return i.a.createElement("div",{onClick:p,className:h},i.a.createElement("div",{className:"inner-x"}))}),vo=Object(o.b)(function(e,t){e.sequencer.displayResolution;var n=t.track.sequencerEngine.trackStep;return{currentStep:t.track.getPatternStep(n)}},function(e){return{}})(function(e){var t=e.track,n=e.currentStep,r=void 0===n?0:n,a=Math.min(t.pattern.length(),32),s={left:5+r%a/a*530+"px"};return i.a.createElement("div",{style:s,className:"cirklon-playhead"})});var mo=[{value:new Y.a(4,!1),label:"1/4"},{value:new Y.a(4,!0),label:"1/4t"},{value:new Y.a(8,!1),label:"1/8"},{value:new Y.a(8,!0),label:"1/8t"},{value:new Y.a(16,!1),label:"1/16"},{value:new Y.a(16,!0),label:"1/16t"},{value:new Y.a(32,!1),label:"1/32"},{value:new Y.a(32,!0),label:"1/32t"}];function yo(e){for(var t=0;t<mo.length;t++)if(mo[t].value.resolution==e.resolution&&mo[t].value.isTriplet==e.isTriplet)return mo[t];return null}var bo=Object(o.b)(function(e){return{resolution:e.sequencer.displayResolution}},function(e){return{setContextualHelp:function(t){return e(Object(c.Z)(t))},setDisplayResolution:function(t){return e(Object(c.mb)(t))}}})(function(e){return i.a.createElement("div",{onMouseOver:function(){return e.setContextualHelp(un)},onMouseLeave:function(){return e.setContextualHelp(void 0)}},i.a.createElement(vt.a,{className:"resolution-dropdown",options:mo,onChange:function(t){return n=t.value,e.sequencerEngine.resolution=n,e.setDisplayResolution(n),e.sequencerEngine.updateSteps(),void(e.sequencerEngine.tracks.length>0&&e.sequencerEngine.select(e.sequencerEngine.cursor.track,0));var n},value:yo(e.resolution),placeholder:"Select a resolution"}))}),go=n(548);n(1747);function Oo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var ko=function(e){Object(b.a)(n,e);var t=Oo(n);function n(e){return Object(m.a)(this,n),t.call(this,e)}return Object(y.a)(n,[{key:"getOptions",value:function(){var e=this.props.midiEngine,t=[{label:"All",value:{type:go.a}},{label:"Computer Keyboard",value:{type:go.b}}],n=e.getInputs().map(function(e){return{label:e.name,value:{type:go.c,input:e}}});return t.concat(n)}},{key:"getSelectedOption",value:function(){var e=this.props.midiInputs;return this.getOptions().filter(function(t){return t.value.type===e.type&&(e.type!==go.c||e.accepts(!1,t.value.input.name))})[0]}},{key:"onSelect",value:function(e){e.value.type===go.c?this.props.midiInputs.addMidiInput(e.value.input):this.props.midiInputs.setType(e.value.type)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_MIDI_DROPDOWN")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"midi-input-dropdown-container"},i.a.createElement(vt.a,{className:"midi-input-dropdown",controlClassName:"midi-input-control-dropdown",arrowClassName:"audio-input-arrow-dropdown",options:this.getOptions(),onChange:function(t){return e.onSelect(t)},value:this.getSelectedOption(),placeholder:"Input"}))}}]),n}(a.Component),jo=(Object(o.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(c.Z)(t))}}})(ko),n(403)),wo=[{label:"None",value:jo.b},{label:"Randomize",value:jo.c},{label:"Accumulate",value:jo.a}],xo=[{label:"Transpose",value:"transpose"},{label:"Velocity",value:"velocity"},{label:"Duration",value:"duration"},{label:"Chop",value:"chop"},{label:"Panning",value:"panning"}],So=function(e){var t=e.track,n=e.parameter,s=e.name,o=e.limit,c=(e.mode,e.variableParameter),u=Object(a.useState)(n.get()),l=Object(r.a)(u,2),f=l[0],h=l[1],p=Object(a.useState)(c.get()),d=Object(r.a)(p,2),v=d[0],m=d[1],y=Object(a.useCallback)(function(e){var t=e.value;n.set(t),h(t)},[h,n]),b=Object(a.useCallback)(function(e){var t=e.value;c.set(t),m(t)},[m,n]);return i.a.createElement("div",{className:"aux-event-type"},i.a.createElement("div",{className:"event-type-label"},s),i.a.createElement(vt.a,{options:wo,onChange:y,value:wo.find(function(e){return e.value===f})}),i.a.createElement(vt.a,{options:xo,onChange:b,value:xo.find(function(e){return e.value===v})}),f===jo.a?i.a.createElement(Po,{type:f,track:t,limit:o,mode:o}):"")},Po=function(e){var t=e.limit,n=(e.mode,e.track,e.type,e.parameter);return i.a.createElement("div",{className:"accumulator-options"},i.a.createElement(Mn,{isParameter:!0,name:"Limit",min:0,step:"velocity"===n||"duration"===n?.1:1,max:"transpose"===n?32:"chop"===n?16:n=32,parameter:t}))};Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.track;return i.a.createElement("div",{className:"aux-events"},i.a.createElement(So,{parameter:t.auxEventATypeParameter,name:"Aux Event A",limit:t.auxEventALimitParameter,variableParameter:t.auxEventAVariableParameter,mode:t.auxEventAModeParameter,track:t}),i.a.createElement(So,{parameter:t.auxEventBTypeParameter,variableParameter:t.auxEventBVariableParameter,name:"Aux Event B",auxEvent:"B",limit:t.auxEventBLimitParameter,mode:t.auxEventBModeParameter,track:t}))});var Eo=new Y.a(32,!1),To=function(e){var t=e.bar,n=e.isSelected,r=e.onClick,a="bar";return n&&(a+=" selected"),e.isCurrent&&(a+=" current"),i.a.createElement("div",{onClick:r,className:a},i.a.createElement("div",{className:"bar-text"},t+1))},Ao=Object(o.b)(function(e,t){var n=e.sequencer.displayResolution,r=t.track.sequencerEngine.trackStep;return{patternStep:Math.floor(n.transformStepAtResolution2(t.track.getPatternStep(r),Eo))}},function(e){return{}})(function(e){var t=e.stepsRef,n=e.numberOfSteps,s=e.setSelectedBar,o=e.selectedBar,c=(e.resolution,e.isFollowing),u=e.setIsFollowing,l=e.patternStep,f=e.barLength,h=(e.cirklonRef,Object(a.useState)(0)),p=Object(r.a)(h,2),d=p[0],v=p[1],m=Math.floor(n/f);isNaN(m)&&(m=1);var y=Object(a.useRef)(void 0),b=Object(a.useRef)(void 0);Object(a.useEffect)(function(){return t.current.addEventListener("mousewheel",g,{passive:!1}),function(){t.current&&t.current.removeEventListener("mousewheel",g,{passive:!1})}},[o,s,u,m]);var g=Object(a.useCallback)(function(e){var t=(new Date).getTime();if(!(t-window.lastScrollTime<200)){e.stopPropagation(),e.preventDefault();var n=Math.abs(e.deltaX)<=Math.abs(b.current);if(b.current=e.deltaX,e.deltaX>0){if(t-y.current<200)return n||(y.current=t),!0;if(n)return!0;u(!1);var r=(o+1)%m;isNaN(o)||s(r),y.current=t}else if(e.deltaX<0){if(t-y.current<200)return n||(y.current=t),!0;if(n)return!0;u(!1);var a=Object(Hi.a)(o-1,m);isNaN(a)||s(a),y.current=t}return!0}},[o,u,s,m]);Object(a.useEffect)(function(){(isNaN(o)||o>=m)&&s(0)},[m,o,s]);var O=Array(m).fill(1),k=f*o,j=f*(o+1);return Object(a.useEffect)(function(){if(v(Math.floor(l/f)),l>=k&&l<j);else if(!isNaN(l)&&c){var e=Math.floor(l/f);s(e)}},[l,k,j,s,f,c,v]),1===m?[]:i.a.createElement("div",{className:"bars"},i.a.createElement("div",{className:"bar-label"},"Bar:"),O.map(function(e,t){return i.a.createElement(To,{bar:t,isCurrent:d===t,isSelected:o===t,onClick:function(){s(t),u(!1)}})}),i.a.createElement("div",{onClick:function(){return u(!c)},className:c?"following follow-btn":"follow-btn"},"FOLLOW"))}),Mo=(n(884),n(405)),Ro={1:"/FORWARD_DIRECTION.png",2:"/REVERSE_DIRECTION.png",3:"/FORWARD_REVERSE_DIRECTION.png",4:"/BROWNIAN_DIRECTION.png"},Co=Object(o.b)(function(e,t){return{direction:(n=t.track,n.playheadEffect?n.playheadEffect.direction:mi.b)};var n},function(e){return{}})(function(e){var t=e.track,n=(e.isSelected,e.direction),r=(e.color,Object(a.useCallback)(function(){var e=t.liveEffects.effects.find(function(e){return e.effect===Sa.e});e||(e=new Mo.a(t),t.liveEffects.addEffect(e));var r=n+1;r>4&&(r=1),e.directionParameter.set(r,void 0,void 0)},[t,n]));return i.a.createElement("div",{onClick:r,className:"pushable playhead-direction-btn"},i.a.createElement(fn,{element:"PLAYHEAD_DIRECTION_BUTTON"},i.a.createElement("img",{className:"playhead-direction-icon",src:Ro[n]})))}),No=Object(o.b)(function(e,t){return{speed:(n=t.track,n.playheadEffect?n.playheadEffect.speedFactor:1)};var n},function(e){return{}})(function(e){var t=e.track,n=e.speed,r=Object(a.useCallback)(function(){if(!t.playheadEffect){var e=new Mo.a(t);t.liveEffects.addEffect(e)}4===n?t.playheadEffect.speedFactorParameter.set(.25,!1):t.playheadEffect.speedFactorParameter.set(2*n,!1)},[n,t]);return i.a.createElement("div",{onClick:r,className:"track-speed-button pushable"},n,"x")}),qo=new Y.a(32,!1),Io=Object(o.b)(null,function(e,t){return{setTrackToFreeze:function(){return e(Object(c.ye)(t.track.subSequence.id,t.track.trackNumber))}}})(function(e){var t=e.track,n=e.trackColor,r=e.trackLengthMode,s=e.setTrackLengthMode,o=e.resolution,c=e.isSelectedTrack,u=(e.setTrackToFreeze,e.children),l=t.sequencerEngine,f={};c&&(f={backgroundColor:n,color:"black"});var h="track-length-button";r&&(h+=" selected");var p=Object(a.useCallback)(function(){if(r){var e=qo.transformStepAtResolution(t.sequencerEngine.state.tracks.trackLengthChoice,o);t.pattern.changeLength(e)}s(!r)},[r,t,o]);return i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:"track-footer-container"},i.a.createElement(fn,{element:"TRACK_ADD_STEPS_BUTTON"},i.a.createElement("div",{style:f,onClick:function(){return l.doubleTrackLength(t.trackNumber)},className:"add-steps-button pushable"},"+")),i.a.createElement(fn,{element:"TRACK_REMOVE_STEPS_BUTTON"},i.a.createElement("div",{style:f,onClick:function(){return l.halfTrackLength(t.trackNumber)},className:"remove-steps-button pushable"},"-")),i.a.createElement(fn,{element:"TRACK_LENGTH_BUTTON"},i.a.createElement("div",{style:f,onClick:p,className:h},"Len.")),u,i.a.createElement(Co,{isSelected:c,color:n,track:t}),i.a.createElement(No,{isSelected:c,color:n,track:t}))}),_o=new $e.a,Do=Object(o.b)(function(e,t){return t.stepData&&t.stepData.durationParameter&&t.stepData.trackData?{on:t.stepData.on,duration:t.stepData.duration,transpose:t.stepData.transpose,velocity:t.stepData.velocity,slice:t.stepData.slice,plocked:t.stepData.pLockedParameters.length}:{}},function(e){return{}})(function(e){e.plocked;var t=e.slice,n=e.on,r=e.color,a=e.transpose,s=(e.stepData,e.duration),o=e.velocity;if(!n)return"";var c={width:32.5*s,backgroundColor:r,opacity:o,top:-15-.25*a+"px"};if(t){var u=_o.getColor(t);c.backgroundColor=u}return i.a.createElement("div",{style:c,className:"duration-indicator"})});var Fo=new Y.a(32,!1),Lo=new $e.a,Bo=Object(o.b)(function(e,t){var n=e.sequencer.displayResolution,r=t.track.sequencerEngine.trackStep,a=Math.floor(n.transformStepAtResolution2(t.track.getPatternStep(r),Fo));return t.stepData&&t.stepData.trackData?{resolution:n,isCurrentStep:a===t.stepNumber,selectedPianoRollSteps:e.keyboard.selectedPianoRollSteps,cirklonMode:e.cirklon.cirklonMode[t.track.id],slice:t.stepData.slice,plocked:t.stepData.pLockedParameters.length}:{}},function(e){return{setSelectedSteps:function(t){return e(Object(c.rd)(t))},mouseDown:function(t){return e(Object(c.j)(t))}}})(function(e){var t=e.track,n=e.color,r=e.on,o=e.stepNumber,c=e.resolution,u=e.stepData,l=(e.trackStep,e.isCurrentStep),f=e.selectedPianoRollSteps,h=void 0===f?[]:f,p=e.setSelectedSteps,d=e.cirklonMode,v=e.mouseDown,m=e.plocked,y=e.isSelected,b=(Object(a.useRef)(0),Object(a.useCallback)(function(e){kr.isMobile||t.sequencerEngine.state.keyboard.isMouseDown&&((e.ctrlKey||e.metaKey)&&r?k(u):e.metaKey||e.ctrlKey||O())},[y,t,d,r,c,o,h])),g=Object(a.useCallback)(function(e,t){!e&&kr.isMobile||(v(!0),(t.metaKey||t.ctrlKey)&&r?(t.stopPropagation(),k(u)):t.metaKey||t.ctrlKey||(t.stopPropagation(),O()))},[o,u,t,d,h,y,r,c]),O=Object(a.useCallback)(function(){t.pattern.clearCache(),t.sequencerEngine.cursor.setStep(o,c),t.sequencerEngine.operationManager.dispatch(Object(X.r)(t,o,c))},[t,o,c]),k=Object(a.useCallback)(function(e){if(y){var t=h.indexOf(u);h.splice(t,1),p(Object(s.a)(h))}else p([].concat(Object(s.a)(h),[u]))},[y,h,p,u]),j="step-toggle",w={},x={};r&&(j+=" on",w.backgroundColor=Lo.transparent(Lo.saturate(n,1),.7),x.backgroundColor=n);var S={};return y&&(w.backgroundColor=x.backgroundColor,x.color=x.backgroundColor,S.backgroundColor=x.backgroundColor,x.backgroundColor=null),l&&(j+=" current"),y&&(j+=" selected"),m&&(j+=" p-locked"),i.a.createElement("div",{"data-stepNumber":o,style:w,onContextMenu:function(e){e.preventDefault(),e.stopPropagation()},onMouseOver:b,onMouseDown:function(e){e.stopPropagation(),g(!1,e)},onTouchStart:function(e){return g(!0,e)},className:j},i.a.createElement("div",{style:x,className:"step-inner"},m?i.a.createElement("div",{className:"p-lock-indicator"},i.a.createElement("div",{className:"inner-indicator",style:y?w:x})):"",o+1,i.a.createElement("div",{style:S,className:"step-bottom-tick"})))});function zo(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Jo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Jo(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Jo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Vo=function(e){var t=e.root,n=e.stepData,r=e.track,i=e.shouldRound,s=e.min,o=e.max,u=e.height,l=e.ref,f=e.setEffectParameterValue,h=e.setEffectParameterValues,p=e.parameter,d=e.selectedSteps,v=e.cirklonMode,m=function(){return p.id};Object(a.useEffect)(function(){return l.current.addEventListener("touchmove",b,{capture:!0}),l.current.addEventListener("touchstart",y,{capture:!0}),function(){l.current&&(l.current.removeEventListener("touchmove",b),l.current.removeEventListener("touchstart",y))}},[l,r,p]);Object(a.useCallback)(function(e){r.sequencerEngine.dispatch(Object(c.j)(!1))},[r]);var y=Object(a.useCallback)(function(e){if(e.stopPropagation(),l.current){var n=Ho(e,m(),s,o,u,t,l.current);i&&(n=Math.round(n)),p.set(n,!0),f(p.id,n),r.sequencerEngine.dispatch(Object(c.j)(!0))}},[p,v,d,r,n]),b=Object(a.useCallback)(function(e){if(e.stopPropagation(),e.preventDefault(),r.sequencerEngine.state.keyboard.isMouseDown&&l.current){var a=Ho(e,m(),s,o,u,t,l.current);if(i&&(a=Math.round(a)),"GANG"===v&&d.length>0){var c,y={},b=zo(d);try{for(b.s();!(c=b.n()).done;){var g=c.value,O=Go(g.parameters,p).set(a,!0,!0),k=O.id,j=O.value;y[k]=j}}catch(K){b.e(K)}finally{b.f()}h(y)}else if("SLOPE"===v&&d.length>0){var w={},x=r.getEasyPattern();d.forEach(function(e){return w[e.id]=x.findStepNumber(e)}),d.sort(function(e,t){return w[e.id]-w[t.id]});var S,P=Go(r.trackData.parameters,p),E=Go(d[0].parameters,p),T=null===E.get()?P.get():E.get(),A=Go(d[d.length-1].parameters,p),M=null===A.get()?P.get():A.get(),R=0,C={},N=d.indexOf(n),q=a-T,I=M-a,_=zo(d);try{for(_.s();!(S=_.n()).done;){var D=S.value,F=Go(D.parameters,p);if(R<N){var L=T+R/N*q,B=F.set(L,!0,!0),z=B.id,J=B.value;C[z]=J}else{var V=(R-N)/(d.length-1-N);isNaN(V)&&(V=0);var H=a+V*I,U=F.set(H,!0,!0),G=U.id,W=U.value;C[G]=W}R++}}catch(K){_.e(K)}finally{_.f()}h(C)}else p.set(a,!0),f(p.id,a)}},[p,v,d,r,n]);return{onMouseMove:b,onMouseDown:y}};function Ho(e,t,n,r,a,i,s){var o=s.getBoundingClientRect(),c=e.clientY;e.touches&&(c=e.touches[0].clientY);var u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=(e=Math.min(Math.max(0,e),r))/r,s=Math.pow(i,a);return t+(n-t)*s}(a-(c-o.top),n,r,a,i);return isNaN(u)?-100:u}function Uo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;return(e-t)/(n-t)}(e,t,n,r);return r*Math.pow(i,1/a)+4}var Go=function(e,t){return e.find(function(e){return e.name===t.name})},Wo=["Aux Event A","Aux Event B","Aux Event C","Aux Event D"],Ko=["Transpose","reverse"],Qo=kr.isMobile?90:60,Zo={Duration:4,Velocity:1.5,"Aux Event A":1.5,"Aux Event B":1.5,"Aux Event C":1.5,"Aux Event D":1.5},Yo=function(e,t){var n=$o(e,t)&&t.getAuxVariable(e.name);return Ko.includes(e.name)||["transpose","chop","reverse"].includes(n)};var Xo=function(e,t){return Wo.includes(e.name)?0:e.min},$o=function(e,t){switch(e.name){case"Aux Event A":return t.auxEventAType;case"Aux Event B":return t.auxEventBType;case"Aux Event C":return t.auxEventCType;case"Aux Event D":return t.auxEventDType}},ec=function(e,t){if(!Wo.includes(e.name)){if("Slice"===e.name){var n=t.getSamplers()[0];return n&&n.slices.length-1||0}return e.max}$o(e,t);switch(t.getAuxVariable(e.name)){case"transpose":return 32;case"duration":return 8;case"velocity":return 1;case"chop":return 16;case"panning":return 1}},tc=Object(o.b)(function(e,t){return{value:null===t.parameter.get()?t.trackParameter.get():t.parameter.get(),v:e.effects.effectParameters[t.parameter.id],cirklonMode:e.cirklon.cirklonMode[t.track.id],selectedSteps:e.keyboard.selectedPianoRollSteps}},function(e){return{setEffectParameterValue:function(t,n){return e(Object(c.tb)(t,n))},setEffectParameterValues:function(t){return e(Object(c.ub)(t))}}})(function(e){var t,n=e.setEffectParameterValue,r=e.setEffectParameterValues,s=e.track,o=e.name,c=e.value,u=e.parameter,l=(e.id,e.color),f=e.shouldRound,h=void 0===f?Yo(u,s):f,p=e.stepData,d=e.min,v=void 0===d?Xo(u,s):d,m=e.max,y=void 0===m?ec(u,s):m,b=e.height,g=void 0===b?Qo:b,O=(e.units,e.cirklonMode),k=e.selectedSteps,j=void 0===k?[]:k,w=e.root,x=void 0===w?Zo[u.name]||1:w,S=Object(a.useRef)(void 0),P={height:Uo(c,v,y,g,x),backgroundColor:l},E={bottom:Uo(s.trackData.parameters.find(function(e){return e.name===u.name}).get(),v,y,g,x)},T=Vo({root:x,shouldRound:h,min:v,max:y,height:g,ref:S,setEffectParameterValue:n,track:s,stepData:p,setEffectParameterValues:r,parameter:u,cirklonMode:O,selectedSteps:j}),A=T.onMouseDown,M=T.onMouseMove;return i.a.createElement("div",{className:"p-box"},i.a.createElement("div",{className:"p-name"},o),i.a.createElement("div",{ref:S,style:{height:g+6},id:u.id,onClick:function(e){return e.stopPropagation()},onMouseMove:M,onMouseDown:A,className:"volume-box"},i.a.createElement("div",{className:"rest"}),i.a.createElement("div",{style:P,className:"volume-indicator"}),i.a.createElement("div",{style:E,className:"helper-line"}),i.a.createElement("div",{className:"value"},(t=c,Math.round(100*t)/100))))}),nc=new to.a,rc=Object(a.memo)(function(e){var t=e.track,n=e.resolution,r=e.parameter,a=e.stepData,s=void 0===a?nc:a,o=e.on,c=e.i,u=e.stepNumber,l=e.isCursor,f=e.isSelected,h=e.color;if(void 0===s)return[];var p="";u%function(e){return parseInt(e.numSteps())/4}(n)===0&&0!==c&&(p=i.a.createElement("div",{className:"bar-divider"}));var d=o?"cirklon-step on":"cirklon-step";return l&&(d+=" cursor"),[p,i.a.createElement("div",{"data-stepNumber":u,className:d},i.a.createElement(tc,{color:h,trackParameter:t.trackData.parameters.find(function(e){return e.name===r})||t.trackData.velocityParameter,track:t,stepData:s,parameter:s.parameters.find(function(e){return e.name===r})||s.velocityParameter}),i.a.createElement(Do,{color:h,stepData:s}),i.a.createElement(Bo,{color:h,isSelected:f,track:t,on:o,stepData:s,stepNumber:u}))]}),ac=(Object(o.b)(function(e,t){return{cirklonMode:e.cirklon.cirklonMode[t.track.id]}},function(e,t){return{setCirklonMode:function(n){return e(Object(c.P)(t.track.id,n))},setSelectedSteps:function(t){return e(Object(c.rd)(t))}}})(function(e){var t=e.mode,n=e.cirklonMode,r=e.setCirklonMode,s=(e.setSelectedSteps,"cirklon-mode-btn");t===n&&(s+=" selected");var o=Object(a.useCallback)(function(e){r(t===n?void 0:t)},[t,n]);return i.a.createElement("div",{onClick:o,className:s},t)}),function(e){return e.slice(0,1).toUpperCase()+e.slice(1)}),ic=Object(o.b)(function(e,t){return{parameter:e.cirklon.cirklonParameterSelected[t.track.id],stepParameterSelected:e.cirklon.stepParameterSelected}},function(e,t){return{setParameter:function(n){return e(Object(c.Q)(t.track.id,n))},setStepParameterSelected:function(t){return e(Object(c.Yd)(t))}}})(function(e){var t=e.color,n=e.parameter,o=e.setParameter,c=e.track,u=(e.stepDatas,e.setStepParameterSelected),l=e.stepParameterSelected,f=c.getStepDataParams(),h=Object(a.useState)(Object(s.a)(f)),p=Object(r.a)(h,2),d=p[0],v=p[1];f.map(function(e){return{label:e,value:e}});Object(a.useEffect)(function(){l&&o(l)},[l,o]);var m=Object(a.useCallback)(function(e){o(e.value),u(e.value)},[o,v,d]);Object(a.useEffect)(function(){return window.addEventListener("keydown",y),function(){return window.removeEventListener("keydown",y)}},[o]);var y=Object(a.useCallback)(function(e){"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&("D"===e.key?(o("Duration"),u("Duration")):"V"===e.key?(o("Velocity"),u("Velocity")):"S"===e.key?(o("Slice"),u("Slice")):"T"===e.key?(o("Transpose"),u("Transpose")):"C"===e.key?(o("Chop"),o("Chop")):"P"===e.key?o("Panning"):"R"===e.key&&o("reverse"))},[o]),b={backgroundColor:t};return Object(a.useEffect)(function(){n||o("Velocity")},[n]),i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},className:"cirklon-parameter-chooser"},d.map(function(e,t){return i.a.createElement("div",{key:t,style:n===e?b:{},onClick:function(){return m({value:e})},className:(n===e?"param-btn selected":"param-btn")+" "+e.split(" ").join("")},ac(e))}))}),sc=(n(909),new $e.a),oc=Object(o.b)(function(e,t){e.sequencer.displayResolution;return{resolution:e.sequencer.displayResolution,stepIds:e.tracks.trackStepIds[t.track.id],steps:e.tracks.trackSteps[t.track.id],parameter:e.cirklon.cirklonParameterSelected[t.track.id],cursorStep:e.mix.selectedStep,isFrozen:t.track.isFrozen,selectedSteps:e.keyboard.selectedPianoRollSteps}},function(e){return{mouseDown:function(t){return e(Object(c.j)(t))},setSelectedZObject:function(t){return e(Object(c.wd)(t))}}})(function(e){var t=e.isFrozen,n=e.mouseDown,s=e.stepIds,o=e.track,c=e.steps,u=e.parameter,l=e.resolution,f=e.color,h=e.cursorStep,p=e.selectedSteps,d=e.styling,v=e.setSelectedZObject,m=Object(a.useState)(0),y=Object(r.a)(m,2),b=y[0],g=y[1],O=Object(a.useState)(!0),k=Object(r.a)(O,2),j=k[0],w=k[1],x=Object(a.useState)(s),S=Object(r.a)(x,2),P=S[0],E=S[1],T=Object(a.useRef)(),A=Object(a.useRef)(),M=Object(a.useRef)(void 0),R=l.numSteps();32===l.resolution&&(R/=2);var C=R*b,N=R*(b+1);Object(a.useEffect)(function(){E(s)},[s,E]);var q=Object(a.useCallback)(function(){o.sequencerEngine.keyListener.legato()},[o]);c=c?c.slice(C,N):[];var I=Object(a.useCallback)(function(){if(o.sequencerEngine.state.selector.sampleTagDragging){var e=o.sequencerEngine,t=e.state.selector.sampleTagDragging;Array.isArray(t)||(t=[t]),e.searchForSounds(t,!0,o,void 0,!1)}},[o]),_=Object(a.useCallback)(function(e,t){var n=e.touches[0].clientX,r=e.touches[0].clientY,a=document.elementFromPoint(n,r);if(a&&void 0!==a.dataset.stepnumber){var i=parseInt(a.dataset.stepnumber);if(i===M.current)return;if(M.current=i,t)return;var s=a.className;(s.includes("step-toggle")||s.includes("cirklon-step"))&&(P[i],o.pattern.clearCache(),o.sequencerEngine.operationManager.dispatch(Object(X.r)(o,i,l)))}},[P,l]);if(!c||!P)return"";var D="cirklon-editor";return t&&(D+=" frozen"),d&&d["secondary-color"]&&sc.getBrightness(d["secondary-color"])>120&&(D+=" light-mode"),t?i.a.createElement("div",{style:{backgroundColor:d&&d["secondary-color"]},ref:T,onMouseDown:function(e){return n(!0)},onMouseUp:function(e){return n(!1)},className:D},"Frozen"):i.a.createElement("div",{style:{backgroundColor:d&&d["secondary-color"]},onDrop:I,ref:T,onMouseDown:function(e){return n(!0)},onMouseUp:function(e){return n(!1)},className:D},i.a.createElement("div",{ref:A,onClick:function(e){return e.stopPropagation()},onMouseDown:function(e){return e.stopPropagation()},onTouchStart:function(e){return _(e,!0)},onTouchEnd:function(){return M.current=void 0},onTouchMove:_,className:"cirklon-steps"},i.a.createElement(vo,{track:o}),c.map(function(e,t){return i.a.createElement(rc,{color:f,isCursor:C+t===h,resolution:l,track:o,i:t,isSelected:p&&p.includes(P[C+t]),stepNumber:C+t,key:C+"."+t,stepData:P[C+t],parameter:u,on:e})})),i.a.createElement(ic,{color:f,stepDatas:P,track:o}),i.a.createElement(Io,{track:o,isSelectedTrack:!0,trackColor:f},i.a.createElement(Ao,{stepsRef:A,cirklonRef:T,track:o,isFollowing:j,setIsFollowing:w,numberOfSteps:P.length,barLength:R,resolution:l,setSelectedBar:g,selectedBar:b}),o&&i.a.createElement(bo,{sequencerEngine:o.sequencerEngine}),i.a.createElement("div",{onClick:q,style:{backgroundColor:f},className:"legato-btn"},"Legato"),i.a.createElement($r,{onClickThumbnail:function(){return v(o)},track:o,hasInner:!0})),t&&i.a.createElement("div",{className:"frozen-overlay"},i.a.createElement("div",{className:"frozen-text"},"Frozen Track")))}),cc=new $e.a,uc=Object(o.b)(function(e,t){if(!t.object||!t.object.sequencerEngine)return{};var n=t.object.sequencerEngine.getSelectedTrack();return{styling:e.zobject.objectStylings[t.zobject.id],track:n,id:void 0===n?0:void 0!==n.sample&&void 0!==n.sample.getId()?n.sample.getId():n.presetName||n.getName()}},function(e){return{setKeyboardContext:function(t){return e(Object(c.Tb)(t))}}})(function(e){var t=e.track,n=(e.styling,e.zobject),r=e.setKeyboardContext;return i.a.createElement("div",{onMouseEnter:function(){return r(n)},onClick:function(){return r(n)}},t&&i.a.createElement(oc,{styling:n.attributes,track:t,color:cc.getColorForTrack(t)}))}),lc=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.dpad,n=Object(a.useCallback)(function(e,n){e.stopPropagation(),t.sendMessage(n,Xe.a)},[t]);return i.a.createElement("div",{className:"dpad"},i.a.createElement("div",{className:"arrows-row"},i.a.createElement("div",{onClick:function(e){return n(e,"up")},className:"g-btn"},i.a.createElement("div",{className:"arrow-up"}))),i.a.createElement("div",{className:"arrows-row"},i.a.createElement("div",{onClick:function(e){return n(e,"left")},className:"g-btn"},i.a.createElement("div",{className:"arrow-left"})),i.a.createElement("div",{onClick:function(e){return n(e,"right")},className:"g-btn"},i.a.createElement("div",{className:"arrow-right"}))),i.a.createElement("div",{className:"arrows-row"},i.a.createElement("div",{onClick:function(e){return n(e,"down")},className:"g-btn"},i.a.createElement("div",{className:"arrow-down"}))))}),fc=Object(o.b)(function(e,t){return{tidals:t.jrepl.tidals}},function(e){return{}})(function(e){var t=e.tidals;return t?i.a.createElement("div",{className:"jrepl"},t.map(function(e){return i.a.createElement(uo,{key:e.id,tidal:e})})):i.a.createElement("div",{className:"jrepl"},"Not connnected to jaki...")}),hc=Object(o.b)(function(e,t){return{number:t.macro?t.macro.value:0}},function(e){return{}})(function(e){var t=e.macro,n=e.number,s=e.styling,o=Object(a.useRef)(),c=Object(a.useRef)(),u=Object(a.useState)(n),l=Object(r.a)(u,2),f=l[0],h=l[1],p=Object(a.useState)(!1),d=Object(r.a)(p,2),v=d[0],m=d[1],y=rt({containerRef:o}).getXY;Object(a.useEffect)(function(){return window.addEventListener("mouseup",O),window.addEventListener("touchend",b),window.addEventListener("mousemove",g),function(){window.removeEventListener("mouseup",O),window.removeEventListener("mousemove",g),window.removeEventListener("touchend",b)}},[m,v,h]);var b=Object(a.useCallback)(function(e){(e.target===o.current||e.target===c.current)&&v&&m(!1)},[v,m]);Object(a.useEffect)(function(){h(n)},[n,h]);var g=Object(a.useCallback)(function(e){if(v){var n=v.y,r=v.number,a=(n-e.pageY)/n*(t.max-t.min)+r;if(a=Math.max(t.min,Math.min(t.max,a)),isNaN(a))return;a!==t.value&&(t.setValue(a),h(a))}},[m,v,h]),O=Object(a.useCallback)(function(e){v&&m(!1)},[m,v]),k=Object(a.useCallback)(function(e){if(v){e.stopPropagation();var n=y(e),r=(n.x,(120-n.y)/120);t.setValue(r),h(r),m({number:r,y:e.pageY})}},[v,h,m]),j=Object(a.useCallback)(function(e){if(v){e.stopPropagation();var n=function(e){for(var t=void 0,n=0;n<e.touches.length;n++)e.touches[n].target!==o.current&&e.touches[n].target!==c.current||(t=e.touches[n]);return t}(e);if(n){var r=y(n),a=(r.x,(120-r.y)/120);a=Math.min(1,Math.max(0,a)),t.setValue(a),h(a),m({number:a,y:e.pageY})}}},[v,h,m]);if(!t)return"";var w={height:120*(f-t.min)/(t.max-t.min),backgroundColor:s["secondary-color"]};return i.a.createElement("div",{style:{backgroundColor:s["primary-color"]},ref:o,onMouseMove:k,onTouchMove:j,onTouchStart:function(e){e.stopPropagation(),console.log("on touch start outter"),m({number:n,y:e.pageY})},onMouseDown:function(e){e.stopPropagation(),m({number:n,y:e.pageY})},className:"macro-slider"},i.a.createElement("div",{ref:c,onTouchMove:j,onTouchStart:function(e){console.log("on touch start inner"),e.stopPropagation(),m({number:n,y:e.pageY})},style:w,className:"slider-indicator"}))}),pc=Object(o.b)(function(e,t){return{parametersDisabled:t.effect.parametersDisabled}},function(e){return{}})(function(e){var t=e.effect,n=e.i,r=e.parametersDisabled,o=r.includes(n),c="param-enabled-btn ";o&&(c+=" disabled");var u=Object(a.useCallback)(function(){var e;e=o?r.filter(function(e){return e!==n}):[].concat(Object(s.a)(r),[n]),t.parametersDisabledParameter.set(e,!1)},[r,o,t,n]);return i.a.createElement("div",{onClick:u,className:c})}),dc=Object(o.b)(function(e,t){return{depth:t.accumulator.getDepth(t.i)}},function(e){return{}})(function(e){var t=e.depth,n=e.i,s=e.parameter,o=e.accumulator,c=e.isDraggable,u=Object(a.useState)(void 0),l=Object(r.a)(u,2),f=l[0],h=l[1],p=Object(a.useState)(t),d=Object(r.a)(p,2),v=d[0],m=(d[1],Object(a.useRef)(void 0));Object(a.useCallback)(function(e){if("Enter"===e.key){var t=parseFloat(v);if(isNaN(t))return;o.depthParameters[n].set(t),h(!1)}},[h,n,s,v,o]);return Object(a.useEffect)(function(){m.current&&f&&(m.current.focus(),m.current.select())},[f]),i.a.createElement(nn,{isDraggable:c,track:o.track,parameter:o.depthParameters[n],units:"%",stopPropagation:!1})}),vc=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.svgRef,n=e.points,r=n.x1,a=n.x2,s=n.y1,o=n.y2,c=(n.height1,n.width1),u=(n.height2,n.width2);if(t.current){var l=t.current.getBoundingClientRect();r-=l.left,a-=l.left,s-=l.top,o-=l.top}return i.a.createElement("polygon",{points:[r,s,a,o,a+u,o,r+c,s]})});window.testA=-15,window.testB=-5;n(1783);var mc=Object(a.memo)(function(e){e.edgesSize,e.edgesPadding;var t=e.scale,n=void 0===t?1:t,s=(e.editorPadding,e.scrollContainer),o=e.destinationPosition,u=e.parameter,l=(e.scrollHeight,e.sequencerEngine),f=e.fillSize,h=Object(a.useRef)();if(u&&u.context)u.context.subDevice||u.context.effect||u.context.midiEffect;var p=function(e,t,n,i){var s=Object(a.useState)(void 0),o=Object(r.a)(s,2),u=o[0],l=o[1],f=Object(a.useState)(void 0),h=Object(r.a)(f,2),p=h[0],d=h[1],v=Object(a.useState)(void 0),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useState)(void 0),O=Object(r.a)(g,2),k=O[0],j=O[1],w=Object(a.useState)(void 0),x=Object(r.a)(w,2),S=x[0],P=x[1],E=Object(a.useState)(void 0),T=Object(r.a)(E,2),A=T[0],M=T[1],R=Object(a.useCallback)(function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k;if(e&&e.context){var a=e.context&&e.context.track;a&&a.isEffectsShowing&&!a.isEffectsShowing()&&a.showEffects(!0);var i=e.isMapped;if(i&&i.track&&i.track.isEffectsShowing&&!i.track.isEffectsShowing()&&i.track.showEffects(!0),e.context.lfoTrack&&e.context.lfoTrack.sequencerEngine.dispatch(Object(c.Kd)(!0)),A&&S){var s=A.getBoundingClientRect(),o=A.offsetHeight,u=s.width,f=s.left,h=s.top-o,d=S.getBoundingClientRect(),v=S.offsetHeight,m=d.width,y=d.left,b=d.top-v;t&&t.current.getBoundingClientRect();var g=!1;if(r&&r.className.includes("plane")){g=!0,b-=25;var O=r.getBoundingClientRect(),j=O.top;j>d.top?b+=j-d.top:j+O.height<d.top&&(b-=d.top-(j+O.height)-5)}g||(b+=v),b<=(h+=o)?b+=v:h+=o;var w=p&&p.getBoundingClientRect(),x=1e4;w&&(x=135+w.width);var P=Math.max(135,y);P>x&&(P=x,m=1),f>x&&(f=x,u=1),P+m>x&&(m=x-P);var E={x1:Math.max(135,f),y1:h,x2:P,y2:b,width1:f<135?10:u,width2:y<135?0:m,height1:o,height2:v};l(E)}else l(void 0)}},[e,l,d,S,A,k,n]);Object(a.useEffect)(function(){if(!e)return l(void 0),M(void 0),P(void 0),d(void 0),void(p&&p.removeEventListener("scroll",R));setTimeout(function(){var t=document.getElementById("parameter-"+e.id);q(t,d);var n=document.getElementById("accumulator-map-source");q(n,b);var r=N(n,j);M(t),P(n),R(void 0,r)},50)},[e,l,M,P,d,j,A,S,n]),Object(a.useEffect)(function(){return p&&p.addEventListener("scroll",R),function(){return p?p.removeEventListener("scroll",R):[]}},[l,e,p,S,A]),Object(a.useEffect)(function(){return k&&k.addEventListener("scroll",R),function(){return k?k.removeEventListener("scroll",R):[]}},[l,e,k,S,A]),Object(a.useEffect)(function(){R()},[i,e,l,S,A]),Object(a.useEffect)(function(){return y&&y!==p&&y.addEventListener("scroll",R),function(){return y&&y!==p?y.removeEventListener("scroll",R):[]}},[l,e,y,p,k,S,A,n]);var C=Object(a.useCallback)(function(e,t,n,r){for(var a=0;e&&a<30;){if(void 0===e.className)return;if(e.className.includes(t)&&(!n||!e.className.includes(n)))break;e=e.parentNode,a++}if(e&&e.className.includes(t))return r(e),e},[b,d]),N=Object(a.useCallback)(function(e,t){return C(e,"parameters-list",void 0,t)},[b]),q=Object(a.useCallback)(function(e,t){return C(e,"effects-view","instrument-rack",t)},[b,d]);return u}(u,s,n,o);return Object(a.useEffect)(function(){if(f)return h.current.style.width=s.current.offsetWidth,void(h.current.style.height=s.current.offsetHeight);var e=l.state.spatial,t=e.edgesSize,n=(e.editorPadding,e.edgesPadding);h.current.style.width=t.width+"px",h.current.style.height=t.height+"px",h.current.style.minWidth=t.width+"px",h.current.style.minHeight=t.height+"px",h.current.style.left=n.x,h.current.style.top=n.y},[p]),i.a.createElement("svg",{style:{},ref:h,className:"parameter-link-visualizer"},p&&i.a.createElement(vc,{points:p,svgRef:h}))});Object(o.b)(function(e,t){var n,r=e.effects.accumulatorParameterSelected;if(r&&r.context){var a=r.context.subDevice||r.context.effect||r.context.midiEffect;a&&(n=e.windows.windowPositions[a.id])}return{destinationPosition:n,parameter:r}},function(e){return{}})(mc);function yc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return bc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bc(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function bc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var gc=function(e){var t=e.setAccumulatorParameterSelected,n=e.parameter,r=e.parameterSelected,s=Object(a.useRef)(void 0),o=n===r;return i.a.createElement("div",{ref:s,id:o?"accumulator-map-source":"",onClick:function(){return t(o?void 0:n)},className:o?"selected mapped-parameter":"mapped-parameter"},n.name)},Oc=Object(o.b)(function(e,t){var n,r={isSelected:e.effects.selectedEffect===t.effect.id,isMapping:e.effects.isMacroMapping,parameterToMap:e.effects.isMacroMapping&&e.effects.parameterToMap,parameterSelected:e.effects.accumulatorParameterSelected},a=yc(t.effect._parameters);try{for(a.s();!(n=a.n()).done;){var i=n.value;i&&(r[i.id]=i.get(!0))}}catch(s){a.e(s)}finally{a.f()}return r},function(e){return{setIsMacroMapping:function(t){return e(Object(c.Ib)(t))},setAccumulatorParameterSelected:function(t){return e(Object(c.n)(t))}}})(function(e){var t=e.isDraggable,n=e.i,s=e.onMapped,o=e.effect,c=e.isMapping,u=e.parameterToMap,l=e.isSelected,f=e.setIsMacroMapping,h=e.parameterSelected,p=e.label,d=e.setAccumulatorParameterSelected,v=e.skipSelected,m=Object(a.useState)(!1),y=Object(r.a)(m,2),b=y[0],g=y[1],O=Object(a.useRef)(void 0),k=Da({ref:O}).preventDragging,j=Object(a.useCallback)(function(){o.unmapParameter(n),s()},[n]);Object(a.useEffect)(function(){b&&d(void 0)},[b]),Object(a.useEffect)(function(){c&&u&&b&&o._parameters[n]!==u&&(o.setParameter(u,n),s(),f(!1),v||d(u),g(!1))},[c,u,l,b,n,s,g]),Object(a.useEffect)(function(){return function(){d(void 0),f(!1)}},[]);var w="accumulator-mapper";return b&&(w+=" mapping"),c&&!b&&(w+=" disable"),i.a.createElement("div",{onMouseDown:function(){return t&&k(!1)},onMouseUp:function(){return t&&k(!0)},ref:O,className:w},i.a.createElement(oa,{label:p,onClick:g}),o._parameters[n]&&i.a.createElement(pc,{i:n,effect:o}),o._parameters[n]&&i.a.createElement(gc,{parameterSelected:h,setAccumulatorParameterSelected:d,parameter:o._parameters[n]}),o._parameters[n]&&i.a.createElement("div",{className:"acc-parameter-value"},o._parameters[n].get(!0)),o._parameters[n]&&i.a.createElement(dc,{isDraggable:t,accumulator:o,i:n,parameter:o._parameters[n]}),o._parameters[n]&&i.a.createElement("div",{onClick:j,className:"delete-parameter-btn"},"x"))}),kc=Object(o.b)(function(e,t){return{len:t.effect._parameters.length,_parameters:t.effect._parameters}},function(e){return{}})(function(e){var t=e.effect,n=e.children,o=e.len,c=e._parameters,u=e.isDraggable,l=Object(a.useState)(t._parameters),f=Object(r.a)(l,2),h=f[0],p=f[1];return Object(a.useEffect)(function(){p(c)},[o,p,t]),i.a.createElement("div",{className:"acc-column mappings parameters-list"},h.map(function(e,n){return i.a.createElement(Oc,{isDraggable:u,key:n,onMapped:function(){return p(Object(s.a)(t._parameters))},i:n,effect:t})}),i.a.createElement(Oc,{isDraggable:u,key:h.length,onMapped:function(){return p(Object(s.a)(t._parameters))},effect:t,i:h.length}),n)}),jc=Object(o.b)(function(e,t){return{styling:e.zobject.objectStylings[t.zobject.id]}},function(e){return{}})(function(e){var t=e.macro,n=(e.styling,e.zobject),s=Object(a.useState)(!1),o=Object(r.a)(s,2),c=o[0],u=o[1];return t?i.a.createElement("div",{className:"zmacro"},i.a.createElement("div",null,i.a.createElement(hc,{styling:n.attributes,macro:t}),i.a.createElement("div",{onClick:function(){return u(!c)},className:c?"more-info-btn show":"more-info-btn"},i.a.createElement("div",{className:"dot"}),i.a.createElement("div",{className:"dot"}),i.a.createElement("div",{className:"dot"}))),c&&i.a.createElement(kc,{isDraggable:!1,effect:t})):""});function wc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var a=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(g.a)(this,n)}}var xc=function(e){Object(b.a)(n,e);var t=wc(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).state={start:0},r.operationManager=r.props.sequencerEngine.operationManager,r}return Object(y.a)(n,[{key:"componentDidUpdate",value:function(e){var t=this.props.currentPattern-this.props.currentPattern%10;t!==this.state.start&&(this.state.start=t,this.setState(this.state))}},{key:"prev",value:function(){this.props.sequencerEngine.switchToPattern(this.state.start-1)}},{key:"next",value:function(){this.props.sequencerEngine.switchToPattern(this.state.start+10)}},{key:"hasNext",value:function(){return this.state.start+10<this.numPatterns}},{key:"hasPrev",value:function(){return this.state.start>0}},{key:"onDragStart",value:function(e){this.props.dragPattern(e)}},{key:"deletePattern",value:function(){0!==this.props.sequencerEngine.tracks.length&&this.operationManager.dispatch(Object(X.h)(this.props.sequencerEngine.tracks[0].currentPattern))}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDrop",value:function(e){this.props.sequencerEngine.movePatternTo(this.props.patternDragging,e),this.setState(this.state)}},{key:"clickPattern",value:function(e){this.props.sequencerEngine.store.getState();this.props.sequencerEngine.switchToPattern(e),this.setState(this.state)}},{key:"numPatterns",get:function(){return this.props.subSequence&&this.props.subSequence.tracks[0]?this.props.subSequence.tracks[0].patterns.length:this.props.sequencerEngine.numberOfPatterns()}},{key:"render",value:function(){var e=this;if(this.props.sequencerEngine.currentSubSequence.isTrack)return i.a.createElement("div",null);for(var t=[],n=0;n<this.numPatterns;n++)t.push(n);return t=t.slice(this.state.start,this.state.start+10),i.a.createElement("div",{className:"patterns-container"},this.hasPrev()?i.a.createElement("div",{onClick:function(){return e.prev()},className:"pag-btn"},"..."):"",t.map(function(t){return i.a.createElement(Sc,{key:t,setContextualHelp:function(t){return e.props.setContextualHelp(t)},patternNumber:t,currentPattern:e.props.currentPattern,patternColor:e.props.patternColors[t],patternToEditColor:e.props.patternToEditColor,secondaryColor:e.props.secondaryColor,primaryColor:e.props.primaryColor,onClickPattern:function(){return e.clickPattern(t)},onDragStart:function(n){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onDrop:function(n){e.onDrop(t)}})}),this.hasNext()?i.a.createElement("div",{onClick:function(){return e.next()},className:"pag-btn"},"..."):"",i.a.createElement("div",{style:{color:this.props.secondaryColor},onMouseOver:function(){return e.props.setContextualHelp("NEW_PATTERN_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"new-pattern-btn",onClick:function(){return e.props.sequencerEngine.newPattern(!0)}},"+"),i.a.createElement("div",{style:{color:this.props.secondaryColor},onMouseOver:function(){return e.props.setContextualHelp("DELETE_PATTERN_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"delete-pattern-btn",onClick:function(){return e.deletePattern()}},"-"))}}]),n}(a.Component),Sc=function(e){Object(b.a)(n,e);var t=wc(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"render",value:function(){var e=this,t="pattern-box",n={};this.props.currentPattern==this.props.patternNumber?(void 0!==this.props.patternColor?t+=" background-"+this.props.patternColor:t+=" current-pattern",n.backgroundColor=this.props.secondaryColor):(void 0!==this.props.patternColor&&(t+=" foreground-"+this.props.patternColor),n.color=this.props.secondaryColor),this.props.patternNumber==this.props.patternToEditColor&&(t+=" editing-color");var r=this.props.currentPattern===this.props.patternNumber?"CURRENT_PATTERN_BUTTON":"PATTERN_BUTTON";return i.a.createElement("div",{style:n,onMouseOver:function(){return e.props.setContextualHelp(r)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onDragStart:this.props.onDragStart,onDragOver:this.props.onDragOver,onMouseDown:function(e){return e.stopPropagation()},onDrop:this.props.onDrop,draggable:!0,className:t,onClick:this.props.onClickPattern},this.props.patternNumber+1)}}]),n}(a.Component),Pc=Object(o.b)(function(e,t){var n=t.sequencerEngine.engineId,r=t.subSequenceId||e.sequencer.currentSubSequence[n],a=e.sequencer.currentPattern[r]||0,i=e.sequencer.isPlaying[n]||0;return{midiMapMode:e.midi.midiMapMode,isCompactMode:e.sequencer.isCompactMode,resolution:e.sequencer.displayResolution,detailsView:e.sequencer.detailsView,decentralized:e.sequencer.decentralized,currentPattern:a,viewMode:e.sequencer.viewMode,numberOfPatterns:e.sequencer.numberOfPatterns[r]||1,samplePack:e.sequencer.samplePack,patternDragging:e.sequencer.patternDragging,isRecordingMix:e.mix.isRecordingMix,isPlayingMix:e.mix.isPlayingMix,isPlaying:i,patternToEditColor:e.toolbar.patternToEditColor,patternColors:e.toolbar.patternColors,trackRolling:e.sequencer.trackRolling,sequenceRolling:e.sequencer.sequenceRolling}},function(e){return{dragPattern:function(t){return e(Object(c.h)(t))},setContextualHelp:function(t){return e(Object(c.Z)(t))}}})(xc),Ec=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.object,n=e.primaryColor,r=e.secondaryColor;return t.sequencerEngine?i.a.createElement("div",{style:{backgroundColor:n}},i.a.createElement(Pc,{secondaryColor:r,primaryColor:n,sequencerEngine:t.sequencerEngine})):""}),Tc=Object(o.b)(function(e,t){var n=t.zobject.presentationMode||t.isInstrumentView;return{presentationMode:n,coords:n&&e.windows.presentationWindowPositions[t.zobject.id]||e.windows.windowPositions[t.zobject.id]}},function(e){return{}})(function(e){var t=e.windowRef,n=e.coords;e.isInstrumentView,e.presentationMode,e.zobject;return Object(a.useEffect)(function(){n&&(t.current.style.left=n.x+"px",t.current.style.top=n.y+"px")},[n]),""}),Ac=n(205),Mc=Object(o.b)(function(e,t){return{ioNumber:t.zmessage[t.field]}},function(e){return{}})(function(e){var t=e.zmessage,n=e.field,s=void 0===n?"inletNumber":n,o=e.icon,c=void 0===o?"inlet-icon":o,u=Object(a.useRef)(void 0),l=Object(a.useRef)(void 0),f=Se({ref:l}),h=f.onContextMenu,p=f.dropdownPos,d=f.setDropdownPos,v=Object(a.useState)(""),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useState)(!1),O=Object(r.a)(g,2),k=O[0],j=O[1],w=Ce(function(){return j(!0)});Object(a.useEffect)(function(){u.current&&k&&u.current.focus()},[k]);var x=Object(a.useCallback)(function(e){"Enter"===e.key&&(t._text=y,t.subSequence.propagate(Object(Ac.s)(t,y)),j(!1))},[j,y]),S="io-inner ";t.subSequence.instanceInlets&&t.subSequence.instanceInlets.includes(t)&&(S+=" instance-inlet");var P=Object(a.useCallback)(function(){t.subSequence.toggleInlet(t)},[!1,t]);return i.a.createElement("div",{ref:l,onContextMenu:"inletNumber"===s?h:function(){return[]},className:S,onClick:w},i.a.createElement(Te,{dropdownPos:p,setDropdownPos:d},i.a.createElement(Ae,{onClick:P},"Convert to Instance Inlet")),k?i.a.createElement("div",{className:"io-number"},i.a.createElement("input",{onKeyDown:x,ref:u,value:y,type:"text",onChange:function(e){return b(e.target.value)}})):i.a.createElement("div",{className:"io-number"},t[s]," ",""!==t._text?". "+t._text:""),i.a.createElement("div",{className:c}))}),Rc=n(109),Cc=(n(564),Object(o.b)(function(e,t){var n=t.zmessage.presentationMode||t.isInstrumentView,r=!1;return n&&t.zmessage.attributes&&!t.zmessage.attributes["Include in Presentation"]&&(r=!0),{isUniform:t.zmessage.attributes["glsl uniform"],presentationMode:n,hidden:r,isSelected:e.windows.selectedElements[t.zmessage.id],isSelectedZObject:e.zobject.selectedZObject===t.zmessage,messageText:t.zmessage._text,uxLocked:e.zobject.uxLocked,isDeleted:t.zmessage.isDeleted,styling:e.zobject.objectStylings[t.zmessage.id],includeInPresentation:!n&&t.zmessage.attributes["Include in Presentation"]}},function(e){return{setSelectedZObject:function(t){return e(Object(c.wd)(t))},setZObjectContextMenu:function(t,n,r){return e(Object(c.Se)(t,n,r))}}})(function(e){var t,n=e.zmessage,s=e.messageText,o=(e.coords,e.sequencerEngine),c=e.scale,u=e.customMode,l=e.sizeRef,f=e.containerRef,h=e.elements,p=e.setOrdering,d=e.isSelected,v=e.isUniform,m=e.forceShow,y=void 0!==m&&m,b=e.isSelectedZObject,g=e.ordering,O=e.size,k=e.presentationMode,j=e.isInstrumentView,w=e.hidden,x=e.includeInPresentation,S=e.setSize,P=e.setSelectedZObject,E=e.uxLocked,T=e.isDeleted,A=e.setZObjectContextMenu,M=Object(a.useRef)(void 0),R=Object(a.useRef)(void 0),C=Object(a.useState)(s),N=Object(r.a)(C,2),q=N[0],I=N[1],_=Object(a.useState)(!1),D=Object(r.a)(_,2),F=D[0],L=D[1],B=Object(a.useCallback)(function(e){e.stopPropagation(),E||L(!0)},[E,L]),z=Object(a.useCallback)(function(e){e.stopPropagation(),E&&n.execute(),P(n)},[E,n,L]),J=Ce(B,250,z);Object(a.useEffect)(function(){I(s)},[I,s]),Object(a.useEffect)(function(){F&&!E&&R.current&&R.current.focus()},[F,E]),Object(a.useEffect)(function(){E&&L(!1)},[E,L]);var V=Object(a.useCallback)(function(e){var t=e.target.value;n.text=t,I(t)},[I]),H=Ke({scale:c,ref:M,sequencerEngine:o,sizeRef:l,containerRef:f,size:O,setSize:S,elements:h,element:n,setOrdering:p,ordering:g,dragOnLoad:n.dragOnLoad}),U=H.style,G=(H.isDragging,H.onMouseDown),W=H.onMouseUp;H.setCoords;n.dragOnLoad=!1;var K=Object(a.useCallback)(function(e){e.preventDefault(),e.stopPropagation();var t=f.current.getBoundingClientRect(),r=e.clientX-t.left,a=e.clientY-t.top;A(n.subSequence.id,{x:r,y:a},n)},[n]),Q=Object(je.a)({},U),Z=(Object(a.useCallback)(function(){n.execute()},[n]),Object(a.useCallback)(function(e){"Enter"===e.key&&(n.text=q,n.execute(),L(!1))},[L,q])),Y={};q&&q.length>0&&(n.isOutlet||n.isInlet||(Y.width=q.length+2+"ch")),Q=Object(je.a)({},Q,Y);var X="z-object z-message";d&&(X+=" selected"),b&&(X+=" selected-object"),(n.isOutlet||n.isInlet)&&(X+=" io"),x&&(X+=" include-in-presentation"),n.type===Ze.a&&(X+=" bang"),n.type===Ze.c&&(X+=" number"),E&&(X+=" locked");var $=n.state.windows,ee=k&&$.presentationWindowPositions[n.id]||$.windowPositions[n.id];if("custom"===u){var te=[n.subSequence.zObject.width,n.subSequence.zObject.height],ne=te[0],re=te[1],ae=ee;if(ae&&(ae.x>ne||ae.y>re))return""}if(!y&&(T||w))return"";var ie=n.attributes,se={},oe={};return ie&&(Q.backgroundColor=ie["background-color"],oe.color=ie["primary-color"],se.borderColor=ie["primary-color"],se.backgroundColor=ie["secondary-color"],ie.width&&(Q.width=ie.width+"px",oe.width=ie.width+"px"),ie["align to center"]&&(oe["text-align"]="center")),ee&&(Q.left=ee,Q.top=ee),v&&(X+=" znumber-uniform"),i.a.createElement("div",(t={onClick:function(e){e.stopPropagation(),n.type===Ze.a&&(P(n),E&&n.execute())},style:oe,onMouseDown:"custom"===u?function(){return 0}:G,onContextMenu:K,onMouseUp:W,ref:M},Object(Fe.a)(t,"style",Q),Object(Fe.a)(t,"className",X),t),i.a.createElement(Tc,{isInstrumentView:j,zobject:n,windowRef:M}),n.type===Ze.c?i.a.createElement(Pt,{color:ie&&ie["primary-color"],isSelectedZObject:b,number:s,znumber:n}):n.type===Ze.a?i.a.createElement("div",{style:se,onClick:function(){},className:"bang-button"}):n.isInlet?i.a.createElement(Mc,{zmessage:n}):n.isOutlet?i.a.createElement(Mc,{field:"outletNumber",icon:"outlet-icon",zmessage:n}):!F||E?i.a.createElement("div",{style:oe,onClick:J,className:"message-content"},q):i.a.createElement("input",{spellcheck:"false",style:Y,onKeyDown:Z,ref:R,onBlur:function(){return L(!1)},type:"text",className:"z-object-input",onChange:V,value:q}),v&&i.a.createElement("div",{className:"uniform-dot"}),!n.isInlet&&i.a.createElement(nt,{numInlets:n.numInlets,effect:n}),!n.isOutlet&&i.a.createElement(it,{numOutlets:n.numOutlets,subSequence:n.subSequence,containerRef:f,scale:c,effect:n}))})),Nc=function(e){return{zobjects:e.zObjects.filter(function(e){return e.effect&&e.attributes["scripting name"]}),zmessages:e.zMessages.filter(function(e){return e.attributes["scripting name"]})}},qc=Object(o.b)(function(e,t){return{messages:t.subpatch.zMessages,objects:t.subpatch.zObjects}},function(e){return{}})(function(e){var t=e.subpatch,n=Nc(t),r=n.zobjects,a=n.zmessages;if(0===r.length&&0===a.length)return"";for(var o=0,c=0,u=[].concat(Object(s.a)(r),Object(s.a)(a));c<u.length;c++){var l=u[c],f=8*l.attributes["scripting name"].length;l.effect&&l.effect.width&&(f=Math.max(f,l.effect.width)),o+=Math.max(65,f)}console.log("total width=",o);var h={minWidth:Math.min(350,o)+"px"};return i.a.createElement("div",{style:h,className:"subpatch-variables"},r.map(function(e){return i.a.createElement("div",{className:"vari"},i.a.createElement("div",{className:"variable-name"},e.attributes["scripting name"]),i.a.createElement(Xu,{forceShow:!0,zobject:e}))}),a.map(function(e){return i.a.createElement("div",{className:"vari"},i.a.createElement("div",{className:"variable-name"},e.attributes["scripting name"]),i.a.createElement(Cc,{forceShow:!0,zmessage:e}))}))}),Ic=Object(o.b)(function(e,t){return{viewableSubPatches:e.zobject.viewableSubPatches,_name:t.subpatch.zObject.args[0]}},function(e){return{setViewableSubPatches:function(t){return e(Object(c.Me)(t))},setWindowPosition:function(t,n){return e(Object(c.Pe)(t,n))},setSelectedZObject:function(t){return e(Object(c.wd)(t))}}})(function(e){var t=e.subpatch,n=e.viewableSubPatches,o=e.setWindowPosition,u=e._name,l=e.setSelectedZObject,f=Object(a.useRef)(void 0),h=Object(a.useState)(t.zObject.args[0]||""),p=Object(r.a)(h,2),d=p[0],v=p[1],m=Object(a.useState)(!d||""===d),y=Object(r.a)(m,2),b=y[0],g=y[1],O=function(e){var t=e.zobject,n=e.text,r=0;if(n.length>0){var a=6;n.startsWith("subpatch")&&(n=n.replaceAll("subpatch","patc"),a=2);var i=n.length+a;r=n.length+a+"ch";var s=t.numInlets;t.effect&&t.effect.numInlets&&(s+=t.effect.numInlets);var o=t.numOutlets;t.effect&&t.effect.numOutlets&&(o+=t.effect.numOutlets);var c=Math.max(s,o);c*a>i&&(i=c*a,r=c*a+"ch")}return r}({zobject:t.zObject,text:t.zObject._text});Object(a.useEffect)(function(){v(u)},[v,u]),Object(a.useEffect)(function(){d!==t.zObject.args[0]&&(t.zObject.text="subpatch "+d)},[d]),Object(a.useEffect)(function(){b&&f.current&&f.current.focus()},[b]);var k=Object(a.useCallback)(function(){var e=t.zObject,n=e.sequencerEngine.state,r=e.subSequence;if(r.inletObjects){var a=n.windows.windowPositions[r.id];o(t.id,a)}var i=n.zobject.viewableSubPatches;Object(c.Me)([].concat(Object(s.a)(i),[t]))},[t]),j=Ce(k),w={};b||(w.minWidth=O);var x="closed-subpatch";n.includes(t)&&(x+=" viewing");var S=Nc(t),P=S.zobjects,E=S.zmessages;return i.a.createElement("div",{onMouseDown:function(e){return l(t.zObject)},style:w,onClick:j,className:x},0===P.length&&0===E.length&&i.a.createElement("div",{className:"subpatch-name-row"},"p ",b?i.a.createElement("input",{ref:f,placeholder:"type name",onBlur:function(e){return g(!1)},onChange:function(e){return v(e.target.value)},value:d,type:"text",className:"subpatch-name-input"}):i.a.createElement("div",{onClick:function(e){return g(!0)},className:"subpatch-name"},d)),i.a.createElement(qc,{subpatch:t}))}),_c=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.zobject,n=t.width,r=t.height,s=Object(a.useRef)(void 0),o=Object(a.useRef)(void 0);return Object(a.useEffect)(function(){return o.current=s.current.getContext("2d"),t.effect.ctxt=o.current,function(){return t.effect.ctxt=void 0}},[]),Object(a.useEffect)(function(){o.current&&o.current.scale(window.devicePixelRatio,window.devicePixelRatio)},[n,r]),i.a.createElement("canvas",{height:r*window.devicePixelRatio,width:n*window.devicePixelRatio,style:{width:n,height:r},ref:s})}),Dc=(n(1784),Object(o.b)(function(e,t){if(!t.track)return{};var n={showSequencer:t.zobject.attributes["show-sequencer"]},r=e.tracks.triggers[t.track.trackNumber];return n.playing=r&&Object.keys(r).some(function(e){return r[e]})||t.track.notesTriggered&&Object.keys(t.track.notesTriggered).length>0,n.notesTriggered=t.track.notesTriggered,n},function(e){return{}})(function(e){var t=e.track,n=e.playing,r=e.showSequencer,s=(e.containerRef,Object(a.useRef)()),o="ztrack-component";return n&&(o+=" playing"),t?i.a.createElement("div",{onClick:function(){return t.sequencerEngine.selectTrack(t.trackNumber)},ref:s,className:o},r?0:[i.a.createElement($r,{key:0,track:t,draggable:!1}),i.a.createElement("div",{key:1,className:"trigger-indicator"})]):""})),Fc=(n(1785),Object(o.b)(function(e,t){return{_color:t.zcolor.color,show:e.zobject.colorPickerShowing===t.zcolor}},function(e){return{setSelectedZObject:function(t){return e(Object(c.wd)(t))},setShow:function(t){return e(Object(c.T)(t))}}})(function(e){var t=e.zcolor,n=e._color,s=e.setSelectedZObject,o=e.setShow,c=e.show,u=Object(a.useState)({hex:t.color}),l=Object(r.a)(u,2),f=l[0],h=l[1];Object(a.useEffect)(function(){h(n)},[h,n]),Object(a.useEffect)(function(){return function(){return o(void 0)}},[]),Object(a.useEffect)(function(){t.zObject.height=c?300:30},[c]);var p=Object(a.useCallback)(function(e){t.color=e.hex,h(e)},[]),d="z-color";return c&&(d+=" showing"),i.a.createElement("div",{onMouseDown:function(e){e.stopPropagation()},className:d},i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},className:"picker-container"},i.a.createElement("div",{onClick:function(){s(t.zObject),o(c?void 0:t)},style:{backgroundColor:t.color},className:"color-show-btn"}),c&&i.a.createElement(Mt.a,{disableAlpha:!0,color:f,onChange:p})))})),Lc=Object(o.b)(function(e,t){return{width:t.zobject.width,height:t.zobject.height}},function(e){return{}})(function(e){var t=e.zobject,n=e.width,r=e.height;return i.a.createElement(gs,{isDraggable:!0,setExpanded:function(){return[]},width:n-5,height:r-40,disableSyntaxHelper:!0,expanded:!1,doc:t.effect.doc,sequencerEngine:t.sequencerEngine,effect:t.effect})}),Bc=(n(1786),function(e){return"number"===typeof e||"string"===typeof e?e:JSON.stringify(e)}),zc=Object(o.b)(function(e,t){return{fragmentShader:t.zobject.effect.fragmentShader,vertexShader:t.zobject.effect.vertexShader}},function(e){return{}})(function(e){var t=e.zobject,n=e.fragmentShader,s=e.vertexShader,o=Object(a.useState)(t.effect.uniforms),c=Object(r.a)(o,2),u=c[0],l=c[1],f=Object(a.useState)(!1),h=Object(r.a)(f,2),p=h[0],d=h[1],v=Object(a.useState)(""),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useState)(0),O=Object(r.a)(g,2),k=O[0],j=(O[1],Object.keys(u||{})),w=Object(a.useCallback)(function(){t.effect.createUniform(y,k),l(Object(je.a)({},t.effect.uniforms)),d(!1)},[l,d,k,y,d]);return i.a.createElement("div",{className:"zshader-material"},p&&i.a.createElement("div",{className:"creating-uniform"},i.a.createElement("div",{className:"create-row"},i.a.createElement("div",{className:"label"},"Name"),i.a.createElement("input",{type:"text",value:y,onChange:function(e){return b(e.target.value)}})),i.a.createElement("div",{onClick:w,className:"done-btn"},"Done")),i.a.createElement("div",{className:"material-title"},"Shader Material"),i.a.createElement("div",{onClick:function(){return d(!0)},className:"new-uniform-button"},"New Uniform"),i.a.createElement("div",{className:"uniforms"},j.map(function(e){return i.a.createElement("div",{className:"uniform"},e,": ",Bc(u[e].value))})),i.a.createElement("div",{className:"shaders"},i.a.createElement("div",{className:s?"enabled shader":"shader"},"Vertex ",i.a.createElement("div",{className:"dot"})),i.a.createElement("div",{className:n?"enabled shader":"shader"},"Fragment ",i.a.createElement("div",{className:"dot"}))))}),Jc=new $e.a,Vc=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.seedHash,n=e.className,r=void 0===n?"token-icon":n,a={};if(t){var s=Jc.saturate(Jc.getColorForHash(t),1),o=[s,Jc.compliment(s,1.1),Jc.compliment(s,1.2),Jc.compliment(s,1.3),Jc.compliment(s,1.4),Jc.compliment(s,1.5)];a={background:"radial-gradient(92% 75.29% at 2.96% 24.36%, ".concat(o[0]," 0.52%, ").concat(o[1]," 18.75%, ").concat(o[2]," 34.38%, ").concat(o[3]," 49.48%, ").concat(o[4]," 74.48%, ").concat(o[5]," 100%)")}}return i.a.createElement("div",{style:a,className:r})}),Hc=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.zobject.sequencerEngine;return i.a.createElement("div",{className:"z-nft"},i.a.createElement(Vc,{seedHash:t.seedHash}),"NFT")});function Uc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Gc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gc(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Gc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Wc=Object(o.b)(function(e,t){var n=[t.grid.getConnectedTidal(0),t.grid.getConnectedTidal(1),t.grid.getConnectedTidal(2),t.grid.getConnectedTidal(3),t.grid.getConnectedTidal(4),t.grid.getConnectedTidal(5)];return{currentCycles1:n[0]&&n[0].currentLeaves,currentCycles2:n[1]&&n[1].currentLeaves,currentCycles3:n[2]&&n[2].currentLeaves,currentCycles4:n[3]&&n[3].currentLeaves,currentCycles5:n[4]&&n[4].currentLeaves,currentCycles6:n[5]&&n[5].currentLeaves}},function(e){return{}})(function(e){var t=e.currentCycles1,n=e.currentCycles2,r=e.currentCycles3,a=e.currentCycles4,o=e.currentCycles5,c=e.currentCycles6,u=e.grid,l=[];return[t,n,r,a,o,c].filter(function(e){return e}).flatMap(function(e){return e}).forEach(function(e){var t,n=Uc(e.rules);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(u.rules&&u.rules.includes(r)){var a=r.block;if(a&&"continue"===function(){var e=Math.min.apply(Math,Object(s.a)(a.map(function(e){return e.x}))),t=Math.min.apply(Math,Object(s.a)(a.map(function(e){return e.y}))),n=Math.max.apply(Math,Object(s.a)(a.map(function(e){return e.x}))),r=Math.max.apply(Math,Object(s.a)(a.map(function(e){return e.y})));if(l.some(function(n){return n.x===20*e&&n.y===20*t}))return"continue";l.push({x:20*e,y:20*t,w:20*(1+n-e),h:20*(1+r-t)})}())continue}}}catch(i){n.e(i)}finally{n.f()}}),i.a.createElement("svg",null,l.map(function(e){return i.a.createElement("rect",{x:e.x,y:e.y,width:e.w,height:e.h})}))}),Kc=[Lt.i,Lt.f,Lt.g,Lt.h,Lt.c,Lt.d],Qc={};Qc[Ft.b]="Dot",Qc[Ft.a]="Dash",Qc[Lt.a.type]="Accent",Qc[Lt.j.type]="Staccato",Qc[Lt.e.type]="Legato",Qc[Lt.g.type]="Piano (soft)",Qc[Lt.h.type]="Default strength",Qc[Lt.f.type]="Pianissimo (softest)",Qc[Lt.i.type]="Rest (doesnt play)",Qc[Lt.c.type]="Double (play faster)",Qc[Lt.d.type]="2 notes almost at the same time";var Zc=function(e){var t=e.option,n=e.mode,s=e.setMode,o=e.noTooltip,c=Object(a.useState)(!1),u=Object(r.a)(c,2),l=u[0],f=u[1],h="option ";t===n&&(h+=" selected");var p=i.a.createElement(Bt,{cell:t});return i.a.createElement("div",{onMouseOver:function(){return f(!0)},onMouseLeave:function(){return f(!1)},className:h,onClick:function(){return s(t)}},p,!o&&l&&i.a.createElement("div",{className:"option-tooltip"},Qc[t.type||t]))},Yc=function(e){var t=e.mode,n=e.setMode,s=Object(a.useState)(!1),o=Object(r.a)(s,2),c=o[0],u=o[1];return Object(a.useEffect)(function(){Kc.includes(t)||u(!1)},[t,u]),i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},className:"grid-toolbar"},i.a.createElement(Zc,{option:Ft.b,mode:t,setMode:n}),i.a.createElement(Zc,{option:Ft.a,mode:t,setMode:n}),i.a.createElement(Zc,{option:Lt.a,mode:t,setMode:n}),i.a.createElement(Zc,{option:Lt.j,mode:t,setMode:n}),i.a.createElement(Zc,{option:Lt.e,mode:t,setMode:n}),i.a.createElement("div",{onClick:function(){return u(!c)},className:c?"show more-options":"more-options"},Kc.includes(t)?i.a.createElement(Zc,{noTooltip:!0,option:t,mode:t,setMode:n}):"...",c&&i.a.createElement("div",{className:"options-overlay"},i.a.createElement(Zc,{option:Lt.i,mode:t,setMode:n}),i.a.createElement(Zc,{option:Lt.f,mode:t,setMode:n}),i.a.createElement(Zc,{option:Lt.g,mode:t,setMode:n}),i.a.createElement(Zc,{option:Lt.h,mode:t,setMode:n}),i.a.createElement(Zc,{option:Lt.c,mode:t,setMode:n}),i.a.createElement(Zc,{option:Lt.d,mode:t,setMode:n}))))},Xc=Object(o.b)(function(e,t){return{cell:t.grid.cells[t.y][t.x]}},function(e){return{}})(function(e){var t=e.mode,n=e.selected,s=e.cell,o=e.odd,c=e.x,u=e.y,l=e.grid,f=e.selection,h=e.setSelection,p=e.dragging,d=e.setDragging,v=Object(a.useState)(s),m=Object(r.a)(v,2),y=m[0],b=m[1],g=o?"cell odd":"cell";y&&(g+=" on"),Object(a.useEffect)(function(){b(s)},[s,b]);var O=Object(a.useCallback)(function(){var e=void 0;y?(e=!1,l.set(c,u,!1)):(e=t,l.set(c,u,t)),b(e)},[t,b,y,c,u]),k=Object(a.useCallback)(function(){y?d({x:c,y:u}):h({x1:c,y1:u,x2:c,y2:u})},[y,f,h,d]),j=Object(a.useCallback)(function(){p?l.drag(p.x,p.y,c,u)&&d({x:c,y:u}):f&&h(Object(je.a)({},f,{x2:c,y2:u}))},[f,p,d,h]);return f&&c>=f.x1&&c<=f.x2&&u>=f.y1&&u<=f.y2&&(g+=" selection"),n&&(g+=" selected"),y===Ft.a&&(g+=" dash"),y===Ft.b&&(g+=" dot"),i.a.createElement("div",{onMouseUp:function(){return d(void 0)},onMouseDown:k,onMouseOver:j,onClick:O,className:g},y===Ft.a?i.a.createElement("div",{className:"dash-inner"},i.a.createElement(Bt,{cell:y})):i.a.createElement(Bt,{cell:y}))}),$c=(n(1787),Object(o.b)(function(e,t){return{mode:e.toolbar.jakiGridMode}},function(e){return{setMode:function(t){return e(Object(c.Rb)(t))}}})(function(e){var t=e.grid,n=e.mode,s=e.setMode,o=Object(a.useState)(void 0),c=Object(r.a)(o,2),u=c[0],l=c[1],f=Object(a.useState)(void 0),h=Object(r.a)(f,2),p=h[0],d=h[1],v=Object(a.useState)({}),m=Object(r.a)(v,2),y=m[0],b=m[1];Object(a.useEffect)(function(){return window.addEventListener("mouseup",O),window.addEventListener("keydown",g),function(){window.removeEventListener("mouseup",O),window.removeEventListener("keydown",g)}},[l,u,b,y]);var g=Object(a.useCallback)(function(e){if("Backspace"===e.key){for(var n in y){var a=n.split(",").map(function(e){return parseInt(e)}),i=Object(r.a)(a,2),s=i[0],o=i[1];t.set(s,o,!1)}b({})}},[y,b]),O=Object(a.useCallback)(function(){u&&(b(t.getSelected(u)),l(void 0)),p&&d(void 0)},[u,p,d,l,b]);return i.a.createElement("div",{className:"jaki-grid"},i.a.createElement(Yc,{setMode:s,mode:n}),i.a.createElement(Wc,{grid:t}),t.cells.map(function(e,r){return i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},onMouseDown:function(e){return e.stopPropagation()},className:r%2===0?"jaki-row":"jaki-row odd"},e.map(function(e,a){return i.a.createElement(Xc,{mode:n,setDragging:d,dragging:p,selected:y[a+","+r],setSelection:l,selection:u,x:a,y:r,grid:t,odd:a%2===1})}))}))})),eu=n(249),tu=function(e,t){return e.split(" ").join("")===t.split(" ").join("")},nu=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.setChosen,n=e.effect,r=e.chosen.figure,s=Object(a.useCallback)(function(){n.figures.deleteFigure(r),t(void 0)},[r,n,t]),o=Object(a.useCallback)(function(e){e=n.figures.updateFigure(r,e),t({type:"FIGURE",figure:e})},[t,r]),c=Object(a.useCallback)(function(e){var t=e.value,n=eu.b[t][0];o(n)},[t,r]),u=eu.b[Math.round(r.figureLength)],l=r.toString();return i.a.createElement("div",{className:"figure-screen"},i.a.createElement("div",{onClick:function(e){e.stopPropagation(),s()},className:"delete-btn"},"x"),i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:"figure-header"},"Figure",i.a.createElement(vt.a,{value:{label:r.figureLength,value:r.figureLength},onChange:c,options:Object.keys(eu.b).map(function(e){return{label:e,value:e}})})),i.a.createElement("div",{className:"figure-options"},u.map(function(e){return i.a.createElement("div",{onClick:function(t){t.stopPropagation(),o(e)},className:tu(l,e)?"cycle-option selected":"cycle-option"},e)})))}),ru=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.track,n=e.effect.tidals[t-1];if(n)return i.a.createElement("div",null,i.a.createElement($i,{WIDTH:110,HEIGHT:110,tidals:[n],color:"#F6F6E9",backgroundColor:"#2D2D2E",fillColor:"#747474",dotColor:"#E8ECFF"}))}),au=n(615),iu=function(e){var t=e.isSelected,n=e.rule,r=e.onClick;return i.a.createElement("div",{onClick:function(){return r(n)},className:t?"rule-part selected":"rule-part"},n.name," ",void 0!==n.value?n.value:"")},su=function(e){var t=e.option,n=e.onClick,r=e.name;return i.a.createElement("div",{onClick:function(){return n(t())},className:"puzzle-option"},r)},ou=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.track,n=e.effect,o=Object(a.useState)(void 0),c=Object(r.a)(o,2),u=c[0],l=c[1],f=Object(a.useState)(n.scaleRules[t-1]),h=Object(r.a)(f,2),p=h[0],d=h[1];Object(a.useEffect)(function(){d(n.scaleRules[t-1])},[n,t,d]);var v=Object(a.useCallback)(function(e){if(u){var r=p.indexOf(u);p[r]=e}else p.push(e);n.scaleRules[t-1]=Object(s.a)(p),d(n.scaleRules[t-1])},[u,p,n,t,d]),m=Object(a.useCallback)(function(e){var r=n.scaleRules[t-1].indexOf(e);n.scaleRules[t-1].splice(r,1),d(Object(s.a)(n.scaleRules[t-1]))},[n,t,d]),y=Object(a.useCallback)(function(e,r){void 0!==e.value&&(e.value=r,d(Object(s.a)(n.scaleRules[t-1])))},[n,t,d]),b=Object(a.useCallback)(function(e,r){var a=p.indexOf(e),i=Object(Hi.a)(a+r,p.length),o=p[i];p[i]=e,p[a]=o,n.scaleRules[t-1]=Object(s.a)(p),d(Object(s.a)(p))},[n,p,t,d]);Object(a.useEffect)(function(){return window.addEventListener("keydown",g),function(){return window.removeEventListener("keydown",g)}},[n,t,d,u]);var g=Object(a.useCallback)(function(e){if(u)if("Backspace"===e.key)m(u);else if("ArrowLeft"===e.key)b(u,-1);else if("ArrowUp"===e.key)b(u,1);else if(Object(fe.a)(e.key)){var t=parseInt(e.key);y(u,t)}},[n,p,t,d,u]);return i.a.createElement("div",{onClick:function(){return l(void 0)},className:"track-screen"},"Scale for Track: ",t,i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:"scale-rules"},p.map(function(e){return i.a.createElement(iu,{isSelected:u===e,rule:e,onClick:l})})),i.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:"puzzle-options"},i.a.createElement(su,{onClick:v,option:au.g,name:"Play"}),i.a.createElement(su,{onClick:v,option:au.f,name:"Pause"}),i.a.createElement(su,{onClick:v,option:au.e,name:"Forward"}),i.a.createElement(su,{onClick:v,option:au.i,name:"Rewind"}),i.a.createElement(su,{onClick:v,option:au.h,name:"Restart"})),i.a.createElement(ru,{track:t,effect:n}))}),cu=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.setChosen,n=e.effect,r=e.track,a=(e.sequencerEngine,e.chosen);return i.a.createElement("div",{onClick:function(e){return r?e.stopPropagation():""},className:"screen"},"FIGURE"===a.type&&i.a.createElement(nu,{setChosen:t,effect:n,chosen:a}),"TRACK"===a.type&&i.a.createElement(ou,{setChosen:t,effect:n,track:a.track}))}),uu=Object(o.b)(function(e,t){return{_figures:t.effect&&t.effect.figures._figures}},function(e){return{}})(function(e){var t=e.effect,n=e.setOverflow,s=e._figures,o=Object(a.useState)(void 0),c=Object(r.a)(o,2),u=c[0],l=c[1],f=Object(a.useState)(s),h=Object(r.a)(f,2),p=h[0],d=h[1],v=Object(a.useCallback)(function(){t.figures.newFigure(),d(t.figures._figures)},[t,d]);return Object(a.useEffect)(function(){p&&s&&p.length!==s.length&&(l(void 0),n(void 0)),d(p)},[p,s,d]),t?i.a.createElement("div",{className:"core-jaki jaki"},i.a.createElement("div",{className:"name"},"Jaki"),i.a.createElement("div",{className:"core-figures"},t.figures.figures.map(function(e){return i.a.createElement("div",{onClick:function(){u&&"FIGURE"===u.type&&u.figure===e?(n(!1),l(void 0)):(l({type:"FIGURE",figure:e}),n(!0))},className:u&&u.figure===e?"selected fig":"fig"},e.figureLength)}),i.a.createElement("div",{onClick:v,className:"fig add-fig"},"+")),u&&i.a.createElement(cu,{setChosen:l,chosen:u,effect:t})):0}),lu=n(551),fu=Object(o.b)(function(e,t){return{}},function(e){return{setPullablePartDragging:function(t){return e(Object(c.Uc)(t))}}})(function(e){var t=Object(a.useCallback)(function(t){var n=e.effect,r=e.instrument,a={instrument:r,effect:n,id:e.id||(r||n).id,type:e.type};r&&r.track?a.track=r.track:n&&(a.track=n.track),e.setPullablePartDragging(a)},[]);return i.a.createElement("div",Object.assign({onMouseDown:function(t){e.isDraggable&&t.stopPropagation()},draggable:e.isDraggable?"true":"false",onDragStart:t,onDragOver:function(e){e.preventDefault()},className:e.className},e),e.skipDiv?e.children:i.a.createElement("div",null,e.children))}),hu=Object(o.b)(function(e,t){return{value:t.parameter.get()}},function(e){return{}})(function(e){var t=e.parameter,n=e.value,r=new Array(5).fill(0).map(function(e,t){return{label:t+1,value:t}}).slice(1),o=Object(a.useCallback)(function(e){var n=e.value;t.set(n)},[t]),c=r.find(function(e){return e.value===n});return r=[{label:"None",value:null}].concat(Object(s.a)(r)),i.a.createElement("div",{onMouseDown:function(e){return e.stopPropagation()},className:"track-shift track-rules"},i.a.createElement(vt.a,{placeholder:"",options:r,value:c,onChange:o}))}),pu=Object(o.b)(function(e,t){var n=t.effect.getConnectedTidal(t.number-1);return{currentHand:n&&n.lastLeafStep&&n.lastLeafStep.hand}},function(e){return{}})(function(e){var t=e.currentHand;return i.a.createElement("div",{className:t?"hand-indicator left":"hand-indicator right"})}),du=Object(o.b)(function(e,t){return{hand:t.effect["hand"+t.number+"Parameter"].get()}},function(e){return{}})(function(e){var t=e.hand,n=(e.track,e.number),r=e.effect;t=Math.round(t);var s=r["hand"+n+"Parameter"],o=Object(a.useCallback)(function(){t===eu.c?s.set(eu.d):t===eu.a?s.set(eu.e):t===eu.e?s.set(eu.a):t===eu.d&&s.set(eu.c)},[t]),c=Object(a.useCallback)(function(){t===eu.e?s.set(eu.d):t===eu.a?s.set(eu.c):t===eu.c?s.set(eu.a):t===eu.d&&s.set(eu.e)},[t]),u=t===eu.a||t===eu.c?"left-circle toggled":"left-circle",l=t===eu.a||t===eu.e?"right-circle toggled":"right-circle";return i.a.createElement("div",{className:"drum-circle"},i.a.createElement(pu,{effect:r,number:n}),i.a.createElement("div",{onClick:o,className:u}),i.a.createElement("div",{className:"drum-divider"}),i.a.createElement("div",{onClick:c,className:l}))}),vu=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.isDraggable,n=e.effect,r=e.setChosen,a=e.chosen,s=e.sequencerEngine,o=void 0===s?n.track.sequencerEngine:s;return n.jakiParams?i.a.createElement(fu,{isDraggable:t,effect:n,skipDiv:!0,instrument:n.jakiParams,type:lu.a,className:"drum-router"},i.a.createElement("div",{className:"track-col labeler"},i.a.createElement("div",{className:"empty-thumb"}),i.a.createElement("div",{className:"track-btn"}),i.a.createElement("div",{className:"track-pattern"},"1"),i.a.createElement("div",{className:"track-shift"},"Rules"),i.a.createElement("div",{className:"track-shift"},"Shift"),i.a.createElement("div",{className:"track-shift"},"Truncate"),i.a.createElement("div",{className:"track-shift"},"Swing"),i.a.createElement("div",{className:"track-shift"},"Offset"),i.a.createElement("div",{className:"track-shift"},"Tempo"),i.a.createElement("div",{className:"track-shift"},"Triplet"),i.a.createElement("div",{className:"track-shift"},"Scale")),[1,2,3,4,5,6].map(function(e){return i.a.createElement("div",{className:"track-col"},o.tracks[e-1]?i.a.createElement($r,{onClickThumbnail:function(t){t.stopPropagation(),r&&r({type:"TRACK",track:e})},track:o.tracks[e-1]}):i.a.createElement("div",{className:"empty-thumb"}),i.a.createElement("div",{onClick:function(t){t.stopPropagation(),r&&r({type:"TRACK",track:e})},className:a&&a.track===e?"track-btn selected":"track-btn"},e),i.a.createElement(du,{number:e,effect:n.jakiParams}),i.a.createElement(hu,{effect:n,parameter:n.jakiParams["rule"+e+"Parameter"]}),i.a.createElement(nn,{width:34,needsRound:!0,parameter:n.jakiParams["shift"+e+"Parameter"],min:0,max:16}),i.a.createElement(nn,{width:34,needsRound:!0,parameter:n.jakiParams["truncate"+e+"Parameter"],min:0,max:8}),i.a.createElement(nn,{width:34,needsRound:!0,parameter:n.jakiParams["swing"+e+"Parameter"],min:50,max:100}),i.a.createElement(nn,{width:34,needsRound:!0,parameter:n.jakiParams["offset"+e+"Parameter"],min:0,max:100}),i.a.createElement(nn,{width:34,needsRound:!0,parameter:n.jakiParams["tempo"+e+"Parameter"],min:1,max:5}),i.a.createElement(Ai,{parameter:n.jakiParams["triplet"+e+"Parameter"]}),i.a.createElement(Ai,{parameter:n.jakiParams["scale"+e+"Parameter"]}))})):""}),mu=Object(o.b)(function(e,t){return{tooltip:e.zobject.tooltip[t.subSequence.id]}},function(e){return{}})(function(e){var t=e.tooltip;e.subSequence;return t?i.a.createElement("div",{style:{left:t.position.x,top:t.position.y},className:"zobject-tooltip"},i.a.createElement("div",{className:"dot"}),t.text,t.type&&i.a.createElement("div",{className:"types"},Array.isArray(t.type)?t.type.map(function(e){return i.a.createElement("span",{className:e===t.selectedType?"selected type":"type"},e)}):i.a.createElement("span",{className:t.type===t.selectedType?"selected type":"type"},t.type))):""}),yu=(n(1788),Object(o.b)(function(e,t){var n=e.zobject.contextMenu[t.subSequence.id];return{isLocked:n&&e.spatial.lockedObjects[n.zobject.id],contextMenu:n}},function(e,t){return Object(Fe.a)({clear:function(t){return e(Object(c.Se)(t))},setViewableSubPatches:function(t){return e(Object(c.Me)(t))},setSelectedPulledElements:function(t){return e(Object(c.sd)(t))},setSelectedZObject:function(t){return e(Object(c.wd)(t))},setFullScreenZObject:function(t){return e(Object(c.Cb)(t))},setZObjectInputText:function(t){return e(Object(c.Ve)(t))},setLocked:function(t,n){return e(Object(c.Ge)(t,n))},setPluginToSave:function(t){return e(Object(c.Oc)(t))},setZObjectBackground:function(t){return e(Object(c.Re)(t))},setZObjectsStack:function(t){return e(Object(c.cf)(t))}},"setSelectedPulledElements",function(t){return e(Object(c.sd)(t))})})(function(e){e.setZObjectsStack,e.setZObjectBackground;var t=e.setPluginToSave,n=(e.setUXLockObject,e.setZObjectInputText,e.setFullScreenZObject),r=(e.setSelectedPulledElements,e.setSelectedZObject),o=e.contextMenu,u=e.setLocked,l=e.isLocked,f=e.setViewableSubPatches,h=e.clear;if(!o)return"";var p=o.zobject,d=o.position;Object(a.useEffect)(function(){o&&r(o.zobject)},[o]);(function(e){var t=e.zobject,n=e.setDropdownPos;return{mintToHic:Object(a.useCallback)(function(){var e=Object(R.a)(M.a.mark(function e(r){var a,i,o,u;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.stopPropagation(),n(void 0),(a=t.sequencerEngine).dispatch(Object(c.Lb)(!0)),e.next=6,a.save("export","PUBLIC",!1,void 0,t);case 6:i=e.sent,o=Object(Pe.d)(a),u={projectId:i,ipfsHashes:[i].concat(Object(s.a)(o))},fetch("/exportZip/",{method:"POST",body:JSON.stringify(u),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){a.dispatch(Object(c.Lb)(!1)),a.dispatch(Object(c.Fb)(e))}).catch(function(e){console.log(e)});case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[t,n])}})({zobject:p,setDropdownPos:h}).mintToHic;var v=function(e){var t=e.zobject,n=e.setDropdownPos,r=e.zipName;return{mintToZora:Object(a.useCallback)(function(){var e=Object(R.a)(M.a.mark(function e(a){var i,o,u,l,f,h,p;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.stopPropagation(),n(void 0),(i=t.sequencerEngine).dispatch(Object(c.Lb)(!0)),console.log("minting to zora object=",t),e.next=7,Object(Pe.a)(i);case 7:return e.next=9,i.save("export","PUBLIC",!1,void 0,t,!0);case 9:return o=e.sent,u=o.ipfsHash,l=o.json,e.next=14,Object(Pe.d)(i);case 14:f=e.sent,h=Object(Pe.c)(i),p={zipName:r,projectId:u,width:t.width||600,height:t.height||600,ipfsHashes:[u].concat(Object(s.a)(f),Object(s.a)(h))},fetch("/exportZip/",{method:"POST",body:JSON.stringify(p),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){i.dispatch(Object(c.Lb)(!1)),e.projectJson=l,e.contentURI="https://zequencer.io/ipfs/"+u,i.dispatch(Object(c.df)(e))}).catch(function(e){console.log(e)});case 18:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[t,n])}}({zobject:p,setDropdownPos:h}).mintToZora,m=Object(a.useCallback)(function(){p.duplicate(),h()},[]),y=Object(a.useCallback)(function(){u(p.id,!l)},[p,l]),b=Object(a.useCallback)(function(){var e=p;p.pluginViewerFor&&(e=p.pluginViewerFor);var t=e.sequencerEngine.state.zobject.viewableSubPatches;if(e.subSequence&&e.subSequence.zObject){e.effect.width=e.subSequence.width,e.effect.height=e.subSequence.height;var n=p.sequencerEngine.state.windows.windowPositions[p.subSequence.id];p.sequencerEngine.dispatch(Object(c.Pe)(e.effect.id,n))}f([].concat(Object(s.a)(t),[e.effect]))},[p]),g=Object(a.useCallback)(function(){p.effect&&p.effect.disconnectFromGraph(),p.disconnectFromGraph()},[p]),O=Object(a.useCallback)(function(){var e,t=[];p.effect&&(t=p.effect.nameInlets(),e=p.effect.attributes["scripting name"]),t=p.nameInlets(),e=p.attributes["scripting name"];var n=p.windowPosition;p.subSequence.encapsulateObjects(n.x,n.y,t,e)},[p]),k=Object(a.useCallback)(function(){var e=!0===p.attributes["Include in Presentation"];p.setAttribute("Include in Presentation",!e)},[p]),j=Object(a.useCallback)(function(){n(p),r(void 0),h()},[p]),w=Object(a.useCallback)(function(){p.delete()},[p]),x=Object(a.useCallback)(function(){t(p)},[p]),S=Object(a.useCallback)(function(){t(p.pluginViewerFor||p.plugin)},[p]),P=Object(a.useCallback)(function(){r(p),we(p)},[p]);return i.a.createElement(Te,{className:"zobject-context-menu",dropdownPos:d,setDropdownPos:h},i.a.createElement(Ae,{onMouseDown:j},"Fullscreen",i.a.createElement("div",{className:"key-shortcut"},i.a.createElement("img",{src:"/expand-icon.svg"}))),i.a.createElement(Ae,{onMouseDown:k},p.attributes["Include in Presentation"]?"Remove from Presentation":"Include in Presentation"," ",i.a.createElement("div",{className:"key-shortcut"},i.a.createElement("img",{src:"/presentation-mode.svg"}))),("subpatch"===p.name||p.pluginViewerFor)&&i.a.createElement(Ae,{onMouseDown:b},"Open Subpatch Editor"),i.a.createElement(Ae,{onMouseDown:m},"Duplicate ",i.a.createElement("div",{className:"key-shortcut"},"\u2318D")),i.a.createElement(Ae,{onMouseDown:y},l?"Unlock":"Lock"),i.a.createElement("div",{className:"divider"}),i.a.createElement(Ae,{onMouseDown:g},"Disconnect from Graph"),p.attributes["scripting name"]&&i.a.createElement(Ae,{onMouseDown:O},"Encapsulate Inlets"),i.a.createElement(Ae,{onMouseDown:P},"Save as Preset"),p.getObjectType()===_.e&&(p.plugin||p.pluginViewerFor?i.a.createElement(Ae,{onMouseDown:S},"Update Plugin"):i.a.createElement(Ae,{onMouseDown:x},"Create Plugin")),p.getObjectType()===_.e&&i.a.createElement(Ae,{onMouseDown:v},"Export as NFT"),i.a.createElement(Ae,{onMouseDown:w},"Delete"),i.a.createElement("div",{className:"divider"}),p.actions&&Object.keys(p.actions).map(function(e){return i.a.createElement(Ae,{onMouseDown:function(){p.executeAction(e),h()}},e)}))})),bu=n(563);function gu(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ou(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ou(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Ou(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ku=function(e){return Object.keys(e).map(function(t){return[t,e[t].x,e[t].y]})},ju=function(e){return ku(e).sort(function(e,t){return e[1]-t[1]})},wu=function(e){return ku(e).sort(function(e,t){return e[2]-t[2]})},xu=function(e){var t=e.scrollRef,n=e.sequencerEngine,i=e.context,o=rt({containerRef:t}).getXY,u=Object(a.useRef)(),l=Object(a.useCallback)(function(e,t){var r=o(e),a=r.x,i=r.y,s=n.state.spatial.editorPadding;return t.zObject||(a-=Math.max(0,s.x),i-=Math.max(0,s.y)),{x:a,y:i}},[n]);Object(a.useEffect)(function(){return window.addEventListener("keydown",h),window.addEventListener("keyup",f),function(){window.removeEventListener("keydown",h),window.removeEventListener("keyup",f)}},[n,i,h,f]);var f=Object(a.useCallback)(function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)e.key,n.state.zobject.fullScreenZObject},[n,i]),h=Object(a.useCallback)(function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){n.state.zobject.fullScreenZObject;var t=e.key;if("Tab"!==t||e.shiftKey)if("e"===t&&(e.ctrlKey||e.metaKey)){if(p()!==i)return;n.dispatch(Object(c.Hd)(n.state.spatial.showEditorBottom===Hr.a?void 0:Hr.a))}else{if(n.state.spatial.showPadSequencer)return;if("N"===t){if(p()!==i)return;var a=l(u.current,p()),o=a.x,f=a.y;p().createZObject(o,f)}else if("C"===t){if(p()!==i)return;var h=l(u.current,p()),d=h.x,v=h.y;p().createZObject(d,v,"comment")}else if("O"===t){if(p()!==i)return;var m=l(u.current,p()),y=m.x,b=m.y;p().createZMessage(y,b,Ze.a)}else if("M"===t){if(p()!==i)return;var g=l(u.current,p()),O=g.x,k=g.y;p().createZMessage(O,k)}else if("P"===t){var j=p();if(!j||j!==i)return;n.state.spatial.showPadSequencer||(j.presentationMode=!j.presentationMode)}else if("H"===t)!function(e){var t=e.state.windows.selectedElements,n=Object.keys(t),r=n[0]&&e.idToObject[n[0]].presentationMode,a=Object(bu.b)(e),i=Math.min.apply(Math,Object(s.a)(Object.values(a).map(function(e){return e.y})));for(var o in t)a[o].y=i;Object(Ye.a)(Object(X.p)(a,r))}(n);else if("U"===t)!function(e){var t=e.state.zobject.selectedZObject;t&&t.setupUniform&&(t.setAttribute("glsl uniform",!0),e.dispatch(Object(c.wd)(void 0)),e.dispatch(Object(c.wd)(t)))}(n);else if("V"===t)!function(e){var t=e.state.windows.selectedElements,n=Object.keys(t),r=n[0]&&e.idToObject[n[0]].presentationMode,a=Object(bu.b)(e),i=Math.min.apply(Math,Object(s.a)(Object.values(a).map(function(e){return e.x})));for(var o in t)a[o].x=i;Object(Ye.a)(Object(X.p)(a,r))}(n);else if("D"===t)!function(e){e.state.windows.selectedElements;var t=Object(bu.b)(e),n=Object.keys(t),a=Object(bu.a)(t),i=a.x,s=a.y,o=i.max-i.min,c=s.max-s.min;if(o>c){var u,l=o/(n.length-1),f=0,h=gu(ju(t));try{for(h.s();!(u=h.n()).done;){var p=u.value,d=Object(r.a)(p,3),v=d[0],m=(d[1],d[2]);t[v]={x:i.min+f*l,y:m},f++}}catch(P){h.e(P)}finally{h.f()}}else{var y,b=c/(n.length-1),g=0,O=gu(wu(t));try{for(O.s();!(y=O.n()).done;){var k=y.value,j=Object(r.a)(k,3),w=j[0],x=j[1];j[2],t[w]={x:x,y:s.min+g*b},g++}}catch(P){O.e(P)}finally{O.f()}}if(n.length>0){var S=e.idToObject[n[0]].presentationMode;Object(Ye.a)(Object(X.p)(t,S))}}(n);else if("F"===t){if(p()!==i)return;var w=l(u.current,p()),x=w.x,S=w.y;p().createZMessage(x,S,Ze.c).max=1}else if("I"===t){if(p()!==i)return;var P=l(u.current,p()),E=P.x,T=P.y;p().createZMessage(E,T,Ze.c).round=!0}else"Escape"===e.key&&(e.preventDefault(),n.dispatch(Object(c.Me)([])),n.dispatch(Object(c.Ne)([])))}else{if(p()!==i)return;if(n.state.instruments.showFormantEffect)return;if(n.dispatch(Object(c.Wc)("")),n.state.spatial.showTrackInstrument||n.state.sequencer.showLFOs||n.state.sequencer.showEnvelopes)return n.dispatch(Object(c.Kd)(!1)),n.dispatch(Object(c.Id)(!1)),void n.dispatch(Object(c.Td)(!1));n.getSelectedTrack()&&n.selectTrack(n.getSelectedTrack().trackNumber),n.dispatch(Object(c.Td)(!n.state.spatial.showTrackInstrument))}}},[n,i]),p=Object(a.useCallback)(function(){var e=n.state.zobject.viewableSubPatches;return e[e.length-1]||n.currentSubSequence},[n]);return{onMouseMove:function(e){u.current?(u.current.clientX=e.clientX,u.current.clientY=e.clientY):u.current={clientX:e.clientX,clientY:e.clientY}}}},Su=Object(o.b)(function(e,t){return{fill:t.subpatch.zObject.attributes["primary-color"]}},function(e){return{}})(function(e){var t=e.subpatch,n=e.fill,s=Object(a.useRef)(void 0),o=Object(a.useState)(!1),c=Object(r.a)(o,2),u=c[0],l=c[1],f=rt({containerRef:s}).getXY,h=t.zObject,p=Object(a.useState)(h.width>0?{width:h.width,height:h.height}:{width:300,height:200}),d=Object(r.a)(p,2),v=d[0],m=d[1];Object(a.useEffect)(function(){return window.addEventListener("mousemove",b),window.addEventListener("mouseup",y),function(){window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",y)}},[m,u,l]);var y=Object(a.useCallback)(function(){u&&l(!1)},[l,u]),b=Object(a.useCallback)(function(e){if(!u)return!1;var n=f(e),r=n.x,a=n.y;t.zObject.width=r,t.zObject.height=a,m({width:r,height:a})},[m,u]),g=Object(je.a)({},v);return n&&(g.backgroundColor=n),i.a.createElement("div",{ref:s,style:g,className:"sub-patch-size"},i.a.createElement("div",{onMouseDown:function(e){l(!0)},className:"right-bottom-corner"}))}),Pu=function(e){var t=e.ref,n=e.subSequence,r=e.setSelection,i=function(e){var t=Object(a.useCallback)(function(t,n){var r=e.createSequencer();r.x=t,r.y=n},[e]),n=Object(a.useCallback)(function(t,n,r){e.createZObject(t,n,r)},[e]),r=Object(a.useCallback)(function(t,n){e.createZMessage(t,n)},[e]),i=Object(a.useCallback)(function(t,n){e.createZMessage(t,n,Ze.c)},[e]),s=Object(a.useCallback)(function(t,n){e.createZObject(t,n,"toggle")},[e]),o=Object(a.useCallback)(function(t,n){e.createZMessage(t,n,Ze.a)},[e]);return{createPad:Object(a.useCallback)(function(t,n){var r=e.createPad();r.x=t,r.y=n},[e]),createSequencer:t,createButton:o,createToggle:s,createZNumber:i,createZMessage:r,createZObject:n}}(n),s=i.createPad,o=i.createSequencer,u=i.createButton,l=i.createZNumber,f=i.createZMessage,h=i.createToggle,p=i.createZObject,d=rt({containerRef:t}).getXY;return{onDrop:Object(a.useCallback)(function(e){var t=d(e),a=t.x,i=t.y,v=n.sequencerEngine,m=v.state.zobject,y=m.objectDragging,b=m.zobjectTypeDragging;if(y)n.moveObjectInto(y,a,i);else if(b){switch(b){case"zobject":p(a,i);break;case"zmessage":f(a,i);break;case"zpad":s(a,i);break;case"zbutton":u(a,i);break;case"ztoggle":h(a,i);break;case"znumber":l(a,i);break;case"sequencer":o(a,i);break;case"zcomment":p(a,i,"comment")}v.dispatch(Object(c.af)(void 0)),r(void 0)}},[n])}},Eu=Object(o.b)(function(e,t){return{}},function(e){return{setMovingPadEdge:function(t){return e(Object(c.lc)(t))}}})(function(e){var t=e.pathPoints,n=e.setMovingPadEdge,r=e.edge,s=e.isHorizontal,o=t.slice(0,2);o[1]+=10;var c=t.slice(t.length-2,t.length);c[s?0:1]-=10;var u=Object(a.useCallback)(function(e,a){e.stopPropagation();var i="START"===a?t.slice(t.length-2):t.slice(0,2),s={x1:i[0],y1:i[1],x2:e.clientX,y2:e.clientY};n("START"===a?Object(je.a)({edge:r},s,{destType:r.destType,destId:r.destId}):Object(je.a)({edge:r},s,{sourceType:r.sourceType,sourceId:r.sourceId}))},[r]);return i.a.createElement("g",null,i.a.createElement("circle",{onMouseDown:function(e){return u(e,"START")},className:"edge-helper",cx:o[0],cy:o[1],r:5,fill:"white"}),i.a.createElement("circle",{onMouseDown:function(e){return u(e,"END")},className:"edge-helper",cx:c[0],cy:c[1],r:5,fill:"white"}))}),Tu=function(e,t,n,r,a){var i=40;return r<t&&(i=80),a?[e,t,e,t+i,n-40,r,n,r]:[e,t,e,t+i,n,r-40,n,r]},Au=function(e){for(var t=e.markerEnd,n=void 0===t?"url(#arrowhead)":t,r=e.points,a=e.onMouseOver,s=e.onMouseDown,o=e.className,c=void 0===o?"":o,u=e.onMouseLeave,l=(e.fill,e.opacity),f=(e.stroke,e.strokeWidth),h=e.segmentation,p=function(e){return Math.floor(e)},d="M "+p(r[0])+" "+p(r[1]),v="",m=2;m<r.length-1;m+=2)v+=p(r[m])+" "+p(r[m+1])+" ";var y=d+" "+(h?"Q":"C")+" "+v;return i.a.createElement("path",{className:c,onMouseDown:s,onMouseOver:a,onMouseLeave:u,d:y,strokeWidth:f,opacity:l,markerEnd:n})},Mu=(n(1789),Object(o.b)(function(e,t){if(!t.outlet)return{};var n=t.outlet.sourceWindowId,r=t.outlet.destWindowId,a=t.outlet.sourceId,i=t.outlet.destId,s=e.pads,o=s.movingEdge,c=(s.drawingEdge,s.selectedEdge),u=t.edge;return{isSourceCollapsed:e.effects.effectCollapsed[n],isDestCollapsed:e.effects.effectCollapsed[r],isSelected:c&&c.outlet===t.outlet&&c.inlet===t.inlet,isMoving:o&&o.edge.id===u.id,fromPosition:e.windows.windowPositions[n]||e.windows.windowPositions[a],toPosition:e.windows.windowPositions[r]||e.windows.windowPositions[i],segmentation:e.spatial.cableSegmentations[t.edge.id],edgesPadding:e.spatial.edgesPadding,presentationMode:e.spatial.presentationMode,movingEdge:o}},function(e){return{setSelectedPadEdge:function(t){return e(Object(c.pd)(t))},setSelectedSteps:function(t){return e(Object(c.rd)(t))}}})(function(e){var t=e.subSequence,n=e.inlet,s=e.outlet,o=e.edge,c=e.isMoving,u=(e.drawingEdge,e.edgesPadding),l=e.containerRef,h=(e.selection,e.isSelected),p=e.setSelectedPadEdge,d=e.setSelectedSteps,v=e.fromPosition,m=e.toPosition,y=e.isSourceCollapsed,b=e.isDestCollapsed,g=e.segmentation,O=e.edgesRef,k=e.presentationMode,j=Object(a.useState)([]),w=Object(r.a)(j,2),x=w[0],S=w[1],P=Object(a.useState)(!1),E=Object(r.a)(P,2),T=E[0],A=E[1],M=Object(a.useRef)(void 0),R=Object(a.useRef)(void 0),C=Object(a.useState)(!1),N=Object(r.a)(C,2),q=N[0],I=N[1];Object(a.useEffect)(function(){if(s){var e=s.sourceEl;q?Object(f.d)(e,_):(Object(f.e)(e,_),A(void 0))}},[s,q,A]);var _=Object(a.useCallback)(function(e){if(s){var t=s.sourceType;try{t+="."+JSON.stringify(e)}catch(n){}A(t)}},[_,A]);Object(a.useEffect)(function(){D()},[S,n,s,v,m,y,b,u]);var D=Object(a.useCallback)(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(s&&l.current)if(M.current||(M.current=document.getElementById(s.destEl)),R.current||(R.current=document.getElementById(s.sourceEl)),!M.current||!R.current||M.current&&!M.current.isConnected||R.current&&!R.current.isConnected)S([]);else{var n=R.current.getBoundingClientRect(),r=M.current.getBoundingClientRect(),a=O.current.getBoundingClientRect(),i=a.top,c=a.left,u=[n.left-c,n.top-i,r.left-c,r.top-i],f=t.sequencerEngine.idToObject[o.destId];f&&f.hasInletFields&&(u[2]-=6),1!==window._scale&&(u=u.map(function(e){return e/(window._scale||1)})),0!==u.length||e?S(u):setTimeout(function(){D(!0)},100)}},[S,n,s,v,m,y,b]);if(Object(a.useEffect)(function(){setTimeout(function(){D()},80)},[S,k,n,s]),0===x.length)return[];var F=Object(r.a)(x,4),L=F[0],B=F[1],z=F[2],J=F[3],V="pad-effect-edge message-edge ";h&&(V+=" selected");var H=(L+z)/2,U=(B+J)/2,G=t.sequencerEngine.idToObject[o.destId],W=G&&G.hasInletFields,K=g?function(e,t,n,r){return r>t?[e,t,e,.75*t+.25*r,e,.75*t+.25*r+1,e,.5*t+.5*r,e,.5*t+.5*r+1,n,.5*t+.5*r,n,.5*t+.5*r+1,n,.25*t+.75*r+0,n,.25*t+.75*r+1,n,r-2,n,r]:[e,t,e,t+15,e,t+16,e,t+30,e,t+31,.5*e+.5*n,t+30,.5*e+.5*n,t+31,.5*e+.5*n,.5*t+.5*r+30,.5*e+.5*n,.5*t+.5*r+31,.5*e+.5*n,r-30,.5*e+.5*n,r-31,n,r-30,n,r-31,n,r-16,n,r-15,n,r-2,n,r]}(L+5,B,z+5,J+4):Tu(L+5,B,z+5,J+4,W);if(c)return[];var Q="message-edge-group";return h&&(Q+=" selected"),i.a.createElement("g",{className:Q},i.a.createElement(Au,{markerEnd:"",onMouseOver:function(){return I(!0)},onMouseLeave:function(){return I(!1)},segmentation:g,onMouseDown:function(e){e.stopPropagation(),p({id:o.id,inlet:n,outlet:s}),d([])},className:V,points:K}),h&&i.a.createElement(Eu,{isHorizontal:W,edge:o,pathPoints:K}),T&&i.a.createElement("g",null,i.a.createElement("rect",{fill:"black",x:H,y:U,height:20,width:2+T.length+"ch"}),i.a.createElement("text",{fill:"white",x:H+5,y:U+12,fontSize:"8pt"},T)))})),Ru=Object(o.b)(function(e,t){var n=e.pads.selectedEdge;return{presentationMode:t.subSequence.presentationMode,selectedEdge:n,inletConnections:e.windows.inletConnections[t.subSequence.id]}},function(e){return{}})(function(e){var t=e.selectedEdge,n=e.presentationMode,r=e.edgesRef,s=e.subSequence,o=e.inletConnections,c=e.containerRef,u=e.selection,l=Object(a.useRef)(!1);Object(a.useEffect)(function(){return window.addEventListener("mousedown",f),window.addEventListener("mouseup",h),function(){window.removeEventListener("mousedown",f),window.removeEventListener("mouseup",h)}},[]);var f=function(){return l.current=!0},h=function(){return l.current=!1};if(!o||n)return[];var p=Object.keys(o).map(function(e){return o[e].filter(function(n){return!t||t.outlet!==n||t.inlet!==e}).flatMap(function(t){return i.a.createElement(Mu,{edge:t,edgesRef:r,key:t.id,isMouseDown:l,subSequence:s,selection:u,containerRef:c,inlet:e,outlet:t})})});if(t){var d=t.outlet,v=t.inlet;p.push(i.a.createElement(Mu,{edge:d,edgesRef:r,key:t.id,isMouseDown:l,subSequence:s,selection:u,containerRef:c,inlet:v,outlet:d}))}return p}),Cu=Object(o.b)(function(e,t){var n=t.fx&&t.fx.id,r=t.edge.effect.id;r=-1===r?t.pad.effectRack.id:r;var a=e.windows.windowPositions[t.fromWindow||t.fromId||n];return t.padZObject&&(a=e.windows.windowPositions[t.padZObject.id]),{fromPosition:a,isSourceCollapsed:e.effects.effectCollapsed[t.fx&&t.fx.id],isDestCollapsed:e.effects.effectCollapsed[r],isSelected:t.edge===e.pads.selectedEdge,toPosition:e.windows.windowPositions[r],hidden:e.spatial.hiddenObjects[t.pad.id],edgesPadding:e.spatial.edgesPadding}},function(e){return{setSelectedPadEdge:function(t){return e(Object(c.pd)(t))},setSelectedSteps:function(t){return e(Object(c.rd)(t))}}})(function(e){var t=e.scale,n=e.isSelected,s=e.outputPrefix,o=(e.fx,e.pad),c=e.edge,u=e.fromId,l=(e.containerRef,e.fromPosition),f=e.toPosition,h=e.isSourceCollapsed,p=e.isDestCollapsed,d=e.setSelectedPadEdge,v=e.setSelectedSteps,m=e.hidden,y=e.edgesPadding,b=e.sequencerEngine,g=e.edgesRef;s=s||"effect-output-";var O=Object(a.useState)([]),k=Object(r.a)(O,2),j=k[0],w=k[1];if(Object(a.useEffect)(function(){if("number"!==typeof c.effect){var e=c.effect.id;e=-1===e?o.effectRack.id:e;var t=void 0!==c.outputNumber?s+c.outputNumber+"-"+u:s+u,n=document.getElementById(t);e=c.effect===o.effectRack.outputNode?"effect-input-"+o.effectRack.id+"-speakers":"effect-input-"+e;var r=document.getElementById(e);if(n&&r){n=n.getBoundingClientRect(),r=r.getBoundingClientRect();var a=g.current.getBoundingClientRect(),i=a.top,l=a.left,f=[n.left-l,n.top-i,r.left-l,r.top-i];f=f.map(function(e){return e/(window._scale||1)}),w(f)}}},[t,y,l,f,w,p,h,b]),0===j.length)return[];var x=Object(r.a)(j,4),S=x[0],P=x[1],E=x[2],T=x[3],A="pad-effect-edge ";return n&&(A+=" selected"),m?"":i.a.createElement(Au,{onMouseDown:function(e){e.stopPropagation(),d(c),v([])},className:A,points:Tu(S+3,P,E+3,T)})}),Nu=Object(o.b)(function(e,t){var n=t.pad.effectRack.adjacencyLists&&t.pad.effectRack.adjacencyLists[t.ffrom||t.fx.id];return{selectedEdge:e.pads.selectedEdge,numEdges:n&&n.length,effects:e.pads.padEffects[t.pad.id],midiEffects:e.pads.trackMidiEffects[t.pad.id]}},function(e){return{}})(function(e){var t=e.edgesRef,n=e.fromWindow,r=e.outputPrefix,a=e.scale,s=e.containerRef,o=e.fromId,c=(e.type,e.fx),u=e.pad,l=e.id,f=u.effectRack.adjacencyLists;if(!f)return[];var h=f[l||c.id];if(!h)return[];return h.map(function(e,l){return i.a.createElement(Cu,{edgesRef:t,key:e.effect.id,sequencerEngine:u.sequencerEngine,containerRef:s,fromWindow:n,outputPrefix:r,scale:a,fromId:o||c.id,pad:u,edge:e,fx:c})})}),qu=Object(o.b)(function(e,t){if(!t.pad)return{};var n=t.pad.effectRack&&t.pad.effectRack.adjacencyLists&&t.pad.effectRack.adjacencyLists[-1];return{controlEdges:n&&n.length,isCollapsed:t.pad.effectRack&&e.effects.effectCollapsed[t.pad.effectRack.id]}},function(e){return{}})(function(e){e.setSelectedPadEdge,e.setDrawingPadEdge;var t=e.isCollapsed,n=e.pad,r=e.effects,a=void 0===r?[]:r,s=e.fromId,o=(e.controlEdges,e.isMidi),c=(e.drawingEdge,e.selectedElements,e.outputPrefix),u=void 0===c?"output-node-":c,l=e.edgesRef,f=Object(rn.a)(e,["setSelectedPadEdge","setDrawingPadEdge","isCollapsed","pad","effects","fromId","controlEdges","isMidi","drawingEdge","selectedElements","outputPrefix","edgesRef"]);return n&&n.effectRack&&n.effectRack.adjacencyLists?t?i.a.createElement(Cu,Object.assign({scale:f.scale,sequencerEngine:n.sequencerEngine,fromId:n.id,edgesRef:l,test:!0,outputPrefix:"output-node-",padZObject:n.zObject,pad:n,edge:{effect:{id:-1}}},f)):i.a.createElement("g",{className:"all-edges"},i.a.createElement(Nu,Object.assign({id:-1,pad:n,fromId:n.effectRack.id,outputPrefix:o&&u,ffrom:-1,edgesRef:l,fromWindow:s,sequencerEngine:n.sequencerEngine,fx:n.effectRack},f)),!o&&i.a.createElement(Cu,Object.assign({scale:f.scale,fromId:n.id,sequencerEngine:n.sequencerEngine,fromWindow:s,edgesRef:l,test:!0,padZObject:n.zObject,outputPrefix:u,pad:n,edge:{effect:{id:-1}}},f)),a.map(function(e){return i.a.createElement(Nu,Object.assign({key:e.id,edgesRef:l,pad:n,fx:e},f))})):[]}),Iu=(Object.values,Object.keys,function(e){e.subSequence,e.setWindowPositions;Object(a.useEffect)(function(){return window.addEventListener("keydown",t),function(){return window.removeEventListener("keydown",t)}},[]);var t=Object(a.useCallback)(function(e){"y"!==e.key||e.metaKey},[])}),_u=Object(a.memo)(function(e){var t,n,r,s,o=e.setMovingPadEdge,c=e.movingEdge,u=e.edgesRef,l=e.effects,f=e.midiEffects,h=e.subSequence,p=e.drawingEdge,d=e.scale,v=e.setWindowPositions,m=e.setDrawingPadEdge,y=e.setSelectedPadEdge,b=Object(rn.a)(e,["setMovingPadEdge","movingEdge","edgesRef","effects","midiEffects","subSequence","drawingEdge","scale","setWindowPositions","setDrawingPadEdge","setSelectedPadEdge"]);Iu({subSequence:h,setWindowPositions:v}),p&&(t=p.x1/(window._scale||1),r=p.y1/(window._scale||1),n=p.x2/(window._scale||1),s=p.y2/(window._scale||1)),function(e){var t=e.subSequence,n=e.setSelectedPadEdge;e.selectedElements;Object(a.useEffect)(function(){return window.addEventListener("keydown",r),function(){return window.removeEventListener("keydown",r)}},[t]);var r=Object(a.useCallback)(function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&"Backspace"===e.key){var r=t.sequencerEngine;if(r.noDeleteKey)return;var a=r.state.pads.selectedEdge,i=r.state.windows.selectedElements;for(var s in i){var o=t.sequencerEngine.findNodeById(s);o&&o.subSequence===t&&(o.isDeletable&&!o.isDeletable()||(o.delete?Object(Ye.a)(Object(X.g)(o)):t.deleteNode(o)))}if(a){if(a.inlet){a.inlet;var c=a.outlet,u=t.sequencerEngine.findNodeById(c.destId),l=t.sequencerEngine.findNodeById(c.sourceId);u&&l&&Object(Ye.a)(Object(X.f)(l,c.sourceType,u,c.destType))}else{var f=t.pads.find(function(e){return e.effectRack.effects.includes(a.effect)||e.effectRack.outputNode===a.effect});f||(f=t.tracks.find(function(e){return e.effectRack&&(e.effectRack.effects.includes(a.effect)||e.effectRack.outputNode===a.effect)})),f.effectRack.deleteEdge(a)}n(void 0)}}},[t])}({subSequence:h,setSelectedPadEdge:y}),Object(a.useEffect)(function(){return window.addEventListener("mousemove",g),window.addEventListener("mouseup",O),function(){window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",O)}},[h]);var g=Object(a.useCallback)(function(e){var t=h.sequencerEngine.state,n=t.pads,r=n.movingEdge,a=n.drawingEdges;if(r){b.containerRef.current.getBoundingClientRect();var i=e.clientX,s=e.clientY;o(Object(je.a)({},r,{x2:i,y2:s}))}if(a[h.id]){b.containerRef.current.getBoundingClientRect();var c=e.clientX,u=e.clientY;t.spatial.editorPadding;m(h.id,Object(je.a)({},a[h.id],{x2:c,y2:u}))}},[h]),O=Object(a.useCallback)(function(e){m(h.id,void 0),o(void 0)},[h]),k={transform:"scale("+1/d+")"};if(b.scrollable&&b.containerRef.current&&(k.width=b.containerRef.current.scrollWidth+"px",k.height=b.containerRef.current.scrollHeight+"px"),u.current){var j=u.current.getBoundingClientRect();t-=j.left,n-=j.left,r-=j.top,s-=j.top,c&&((c=Object(je.a)({},c)).x2-=j.left,c.y2-=j.top)}return i.a.createElement("svg",{ref:u,onMouseDown:function(e){return y(void 0)},style:k,className:"edges-drawer"},i.a.createElement("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"8",refX:"4",refY:"2",orient:"auto"},i.a.createElement("polygon",{points:"0 0, 5 2, 0 4"})),p&&i.a.createElement(Au,{className:"pad-effect-edge drawing-edge",points:Tu(t,r,n,s)}),c&&i.a.createElement(Au,{className:"pad-effect-edge drawing-edge",points:Tu(c.x1,c.y1,c.x2,c.y2)}),c&&i.a.createElement(Eu,{edge:c,pathPoints:Tu(c.x1,c.y1,c.x2,c.y2)}),i.a.createElement(Ru,{selection:b.selection,containerRef:b.containerRef,edgesRef:u,subSequence:h}),h.tracks&&h.tracks.filter(function(e){return e.effectRack&&e.zObject&&"track"===e.zObject.name}).map(function(e){return i.a.createElement(qu,Object.assign({key:e.id,effects:f[e.id],scale:d,edgesRef:u,isMidi:!0,fromId:e.sequencer?e.sequencer.id:e.id,outputPrefix:"effect-output-",pad:e},b))}),h.zObjects.filter(function(e){return"pad"===e.name}).filter(function(e){return e.effect.pad}).map(function(e){return e.effect.pad}).map(function(e){return i.a.createElement(qu,Object.assign({key:e.id,edgesRef:u,effects:l[e.id],scale:d,pad:e},b))}))}),Du=Object(o.b)(function(e,t){return{drawingEdge:e.pads.drawingEdges[t.subSequence.id],movingEdge:e.pads.movingEdge,effects:e.pads.padEffects,midiEffects:e.pads.trackMidiEffects}},function(e){return{setSelectedPadEdge:function(t){return e(Object(c.pd)(t))},setDrawingPadEdge:function(t,n){return e(Object(c.nb)(t,n))},setMovingPadEdge:function(t){return e(Object(c.lc)(t))},setWindowPositions:function(t){return e(Object(c.M)(t))}}})(_u);function Fu(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Lu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lu(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Lu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Bu=Object(o.b)(function(e,t){return{}},function(e){return{setSelectedPulledElements:function(t){return e(Object(c.sd)(t))}}})(function(e){e.hideColorPicker;var t=e.isSubPatch,n=e.setSelectedPulledElements,s=e.getSelection,o=e.editorRef,c=e.scale,u=e.onMouseMove,l=e.sequencerEngine,f=e.dropdownPos,h=e.setSelectedZObject,p=e.getXY,d=Object(a.useRef)(),v=Object(a.useState)(void 0),m=Object(r.a)(v,2),y=m[0],b=m[1],g=Object(a.useCallback)(function(e){if(u(e),y&&d.current){var t=p(e,!0),n=t.x,r=t.y;l.state.spatial.editorPadding,b(Object(je.a)({},y,{x2:n,y2:r}))}},[y,b,c,l,p]),O=Object(a.useCallback)(function(e){if(3!==e.which&&("edges-drawer"===e.target.className.baseVal||e.target.className.includes&&(e.target.className.includes("pulled-background")||e.target.className.includes("grids-inner")))&&!l.state.spatial.showPadSequencer){var t=p(e,!0),n=t.x,r=t.y;l.state.spatial.editorPadding,b({x1:n,y1:r,x2:n,y2:r}),d.current=!0}},[b,l,p]),k=Object(a.useCallback)(function(e){if(!f&&!l.state.spatial.showPadSequencer){var r=l.state.spatial.editorPadding;if(y&&y.x2-y.x1>1){d.current=!1;var a,i=window._scale||1,o=t?y:{x1:(y.x1-Math.max(0,r.x))/i,y1:(y.y1-Math.max(0,r.y))/i,x2:(y.x2-Math.max(0,r.x))/i,y2:(y.y2-Math.max(0,r.y))/i},c=s(o),u={},p=l.state.zobjectBackground&&l.state.zobjectBackground.id,v=Fu(c);try{for(v.s();!(a=v.n()).done;){var m=a.value.id;m!==p&&(u[m]=!0)}}catch(g){v.e(g)}finally{v.f()}return n(u),h(void 0),void b(void 0)}y&&(n({}),b(void 0),h(void 0),d.current=!1)}},[y,b,f,l,p]);return Object(a.useEffect)(function(){if(o.current)return o.current.addEventListener("mousedown",O),window.addEventListener("mouseup",k),o.current.addEventListener("mousemove",g),function(){o.current&&(o.current.removeEventListener("mousedown",O),window.removeEventListener("mouseup",k),o.current.removeEventListener("mousemove",g))}},[y,b,f,l,p]),i.a.createElement("div",{className:"pulled-background"},y&&y.x2-y.x1>0&&i.a.createElement("div",{style:{left:y.x1,top:y.y1,width:y.x2-y.x1,height:y.y2-y.y1},className:"selection"}))});function zu(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Ju(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ju(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function Ju(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Vu=Object(a.memo)(function(e){e.len;var t=e.subpatch,n=e.setSize,s=e.setSelectedPulledElements,o=e.isInstrumentView,c=e.customMode,u=e.scrollRef,l=e.editLayout,f=e.presentationMode,h=e.isInsideWindow,p=e.setSelectedZObject,d=(e.setViewableSubPatches,t.zObjects),v=t.zMessages,m=Object(a.useRef)(),y=Object(a.useRef)({}),b=ke(),g=b.sizeRef,O=b.ordering,k=b.setOrdering,j=u,w=function(e){var t=e.elements;return{getSelection:function(e){var n=e.x1,r=e.y1,a=e.x2,i=e.y2;return Object.keys(t.current).map(function(e){return{element:t.current[e],id:e}}).filter(function(e){var t=e.element;return e.id,Je(t.current,n,r,a,i)})}}}({elements:y}).getSelection,x=Object(a.useState)(void 0),S=Object(r.a)(x,2),P=S[0],E=S[1],T=rt({containerRef:j,scale:1}).getXY,A=Object(a.useCallback)(function(e){if(!h){e.stopPropagation();var n=T(e),r=n.x,a=n.y;t.createZObject(r,a)}},[]),M=Ce(A,250,function(e){h||e.stopPropagation()}),R=xu({scrollRef:j,sequencerEngine:t.sequencerEngine,context:t}).onMouseMove,C=(Object(a.useCallback)(function(e){if("custom"===c&&p(t.zObject),j&&j.current){var n=T(e),r=n.x,a=n.y;E({x1:r,y1:a,x2:r,y2:a})}},[E,c]),Object(a.useCallback)(function(e){if(R(e),P){var t=T(e),n=t.x,r=t.y;E(Object(je.a)({},P,{x2:n,y2:r}))}},[P,E]),Object(a.useCallback)(function(e){if(P&&P.x2-P.x1>1){var t,n={},r=zu(w(P));try{for(r.s();!(t=r.n()).done;){n[t.value.id]=!0}}catch(a){r.e(a)}finally{r.f()}s(n)}P&&E(void 0)},[P,E]),Pu({ref:j,subSequence:t,setSelection:E}).onDrop),N="content-inner";return(f||l||o)&&(N+=" presentation-mode"),i.a.createElement("div",{onDrop:C,onClick:M,ref:u,className:N},"custom"!==c&&i.a.createElement(mu,{subSequence:t}),"custom"!==c&&i.a.createElement(yu,{subSequence:t}),"custom"!==c&&i.a.createElement(Bu,{isSubPatch:!0,scale:1,sequencerEngine:t.sequencerEngine,getXY:T,setSelectedZObject:p,onMouseMove:R,getSelection:w,editorRef:u}),l&&!0===c&&i.a.createElement(Su,{scrollRef:j,subpatch:t}),d.map(function(e){return i.a.createElement(Xu,{key:e.id,scale:1,elements:y,sequencerEngine:t.sequencerEngine,ordering:O,isInstrumentView:o||l,setOrdering:k,customMode:"custom"===c?c:c&&l,setSize:n,sizeRef:g,containerRef:j,zobject:e})}),v.map(function(e){var r;return i.a.createElement(Cc,(r={key:e.id,scale:1,sequencerEngine:t.sequencerEngine,isInstrumentView:o||l,setOrdering:k,ordering:O,customMode:"custom"===c?"custom":c&&l},Object(Fe.a)(r,"setOrdering",k),Object(Fe.a)(r,"setSize",n),Object(Fe.a)(r,"sizeRef",g),Object(Fe.a)(r,"elements",y),Object(Fe.a)(r,"containerRef",j),Object(Fe.a)(r,"zmessage",e),r))}),j&&j.current&&(!c||c&&!l)&&i.a.createElement(Du,{edgesRef:m,scrollable:!0,width:j.current&&j.current.scrollWidth,height:j.current&&j.current.scrollHeight,selection:P,containerRef:j,scale:1,subSequence:t}))}),Hu=Object(o.b)(function(e,t){return{len:t.subpatch.zObjects.length,zobjects:e.zobject.zobjects[t.subpatch.id],zmessages:e.zobject.zmessages[t.subpatch.id],presentationMode:t.subpatch.presentationMode}},function(e,t){return{setSize:function(n){return e(Object(c.jc)(t.subpatch.id,n))},setSelectedPulledElements:function(t){return e(Object(c.sd)(t))},setViewableSubPatches:function(t){return e(Object(c.Me)(t))},setSelectedZObject:function(t){return e(Object(c.wd)(t))}}})(Vu),Uu=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.subpatch,n=e.forceShow,r=ke(),s=r.sizeRef,o=r.ordering,c=r.setOrdering,u=Object(a.useRef)({});return i.a.createElement("div",{className:"custom-subpatch"},i.a.createElement(Hu,{isInsideWindow:!0,sizeRef:s,elements:u,isInstrumentView:!0,forceShow:n,customMode:"custom",setOrdering:c,ordering:o,subpatch:t}))});n(1790);var Gu=Object(o.b)(null,function(e,t){return{setAnnotationDragging:function(t){return e(Object(c.v)(t))}}})(function(e){var t=e.attributes,n=e.annotation,o=e.color,c=e.onDelete,u=e.setAnnotationDragging,l=e.elementRef,f=Object(a.useRef)(),h=Object(a.useState)(n.text),p=Object(r.a)(h,2),d=p[0],v=p[1],m=Object(a.useState)(!1),y=Object(r.a)(m,2),b=(y[0],y[1]),g=Object(a.useCallback)(function(e){e.stopPropagation(),n.text=e.target.value,v(e.target.value)},[v]),O=Object(a.useCallback)(function(){var e=t["font-size"],r=d.split("\n"),a=Math.max.apply(Math,Object(s.a)(r.map(function(e){return e.length}))),i=Math.max(96,6*a)*(e/10),o=22*r.length*(e/10);f.current.style.width=i+"px",n.width=i,l.current.style.width=i+"px",f.current.style.height=o+"px",n.height=o,l.current.style.height=o+"px"},[d,t]),k={left:n.x,top:n.y,backgroundColor:o},j={backgroundColor:o,fontSize:t["font-size"]+"pt"};t&&t["secondary-color"]&&(j.color=t["secondary-color"]);var w=Object(a.useCallback)(function(e){u(n)},[u]);return i.a.createElement("div",{style:k,className:"annotation"},i.a.createElement("div",{onMouseDown:w,className:"draggable-header"},i.a.createElement("div",{className:"delete-button",onClick:c},"x")),i.a.createElement("textarea",{ref:f,onFocus:function(){return b(!0)},onBlur:function(){return b(!1)},onKeyUp:O,style:j,onChange:g,type:"textarea",value:d,placeholder:"Write a note",className:"annotation-text"}))}),Wu=Object(o.b)(function(e,t){return{_figures:t.effect.figures._figures}},function(e){return{setSelectedZObject:function(t){return e(Object(c.wd)(t))}}})(function(e){e.isDraggable;var t=e.effect,n=e.zobject,s=e.setChosen,o=e.chosen,c=(e._figures,e.setSelectedZObject),u=Object(a.useState)(t.figures.figures),l=Object(r.a)(u,2),f=l[0],h=l[1];Object(a.useEffect)(function(){f!==t.figures.figures&&h(t.figures.figures)},[t.figures,h,f]);var p=Object(a.useCallback)(function(){t.figures.newFigure(),h(t.figures.figures)},[h]);return i.a.createElement("div",null,f.map(function(e){return i.a.createElement("div",{className:o&&o.figure===e?"figure selected":"figure"},i.a.createElement("div",{onClick:function(t){console.log("zobject=",n),n&&c(n),t.stopPropagation(),s&&(o&&"FIGURE"===o.type&&o.figure===e?s(void 0):s({type:"FIGURE",figure:e}))},className:"figure-button"},Math.round(e.figureLength)),i.a.createElement("div",{className:"cycle-string"},e.toString()))}),i.a.createElement("dig",{className:"figure"},i.a.createElement("div",{onClick:p,className:"figure-button add"},"+")))}),Ku=Object(o.b)(function(e,t){return{}},function(e){return{}})(function(e){var t=e.zobject,n=e.effect,s=e.setOverflow,o=Object(a.useState)(void 0),c=Object(r.a)(o,2),u=c[0],l=c[1];return Object(a.useEffect)(function(){s(u)},[u,s]),i.a.createElement("div",{onClick:function(){return l(void 0)},className:"jaki jfigures"},i.a.createElement(Wu,{zobject:t,setChosen:l,chosen:u,effect:n}),u&&i.a.createElement(cu,{setChosen:l,chosen:u,effect:n}))}),Qu=Object(o.b)(function(e,t){return{tidals:t.jgraphics&&t.jgraphics.tidals,color:t.jgraphics&&t.jgraphics.color,backgroundColor:t.jgraphics&&t.jgraphics.backgroundColor,fillColor:t.jgraphics&&t.jgraphics.fillColor,dotColor:t.jgraphics&&t.jgraphics.dotColor}},function(e){return{}})(function(e){var t=e.jgraphics,n=e.tidals,r=e.width,a=e.height;return n?(r<=0?(r=280,a=280):(r*=1,a*=1),i.a.createElement(ss,{color:t.color,fillColor:t.fillColor,backgroundColor:t.backgroundColor,dotColor:t.dotColor,tidals:n,WIDTH:r,HEIGHT:a})):""}),Zu=Object(o.b)(function(e,t){return{snapshots:t.jsnapshot&&t.jsnapshot.snapshots}},function(e){return{}})(function(e){var t=e.jsnapshot;return t&&t.snapshots?i.a.createElement("div",{className:"jsnapshot"},i.a.createElement("div",{onClick:function(){return t.takeSnapshot()},className:"take-snapshot-btn"},"Save"),i.a.createElement("div",{className:"snapshots"},t.snapshots.map(function(e,n){return i.a.createElement("div",{onClick:function(){return t.useSnapshot(n)},className:"snapshot-option"},n+1)}))):""}),Yu=Object(o.b)(function(e,t){return{_ipfsHash:t.zipfs&&t.zipfs._ipfsHash}},function(e){return{setUploadingFile:function(t){return e(Object(c.Je)(t))}}})(function(e){var t=e.zipfs,n=e._ipfsHash,s=e.setUploadingFile,o=Object(a.useState)(n),c=Object(r.a)(o,2),u=(c[0],c[1]),l=Object(a.useState)(t.hashMap),f=Object(r.a)(l,2),h=(f[0],f[1]),p=Object(a.useCallback)(function(){var e=Object(R.a)(M.a.mark(function e(n){var r,a,i,o,c;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.stopPropagation(),n.preventDefault(),n.dataTransfer.effectAllowed="none",n.dataTransfer.dropEffect="none",!n.dataTransfer.items){e.next=23;break}t.sequencerEngine.dispatch(s(!0)),a=n.dataTransfer.items.length,i=0;case 9:if(!(i<a)){e.next=18;break}if("file"!==n.dataTransfer.items[i].kind){e.next=15;break}return o=n.dataTransfer.items[i].getAsFile(),e.next=14,Object(It.b)(t.sequencerEngine,o);case 14:r=e.sent;case 15:i++,e.next=9;break;case 18:c=r.ipfsHash,t.ipfsHash=c,u(c),h(Object(je.a)({},t.hashMap)),t.sequencerEngine.dispatch(s(!1));case 23:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[u,t,h]),d=Object(a.useCallback)(function(e,n){t.startOnsets[n]=parseFloat(e.target.value),h(Object(je.a)({},t.hashMap))},[h]),v=Object(a.useCallback)(function(e,n){t.tempos[n]=parseFloat(e.target.value),h(Object(je.a)({},t.hashMap))},[h]),m=Object(a.useCallback)(function(e){t.deleteId(e),h(Object(je.a)({},t.hashMap))},[h]);return Object(a.useEffect)(function(){console.log("setting ipfsHash=",n),u(n)},[n,u]),i.a.createElement("div",{onDrop:p,className:"z-ipfs-drop"},i.a.createElement("div",{className:"ipfs-table"},Object.keys(t.hashMap).map(function(e){return i.a.createElement("div",{className:"track-row"},i.a.createElement("div",{className:"song-id"},e),i.a.createElement("div",{className:"song-hash"},t.hashMap[e].slice(0,4),"..."),i.a.createElement("div",{className:"tempo-input"},i.a.createElement("input",{value:t.tempos[t.hashMap[e]],onChange:function(n){return v(n,t.hashMap[e])},type:"text"})),i.a.createElement("div",{className:"onset-input"},i.a.createElement("input",{value:t.startOnsets[t.hashMap[e]],onChange:function(n){return d(n,t.hashMap[e])},type:"text"})),i.a.createElement("div",{onClick:function(){return m(e)},className:"delete-btn"},"x"))})),i.a.createElement("span",{className:"drop-file"},"Drop File"))}),Xu=Object(o.b)(function(e,t){var n=t.zobject.presentationMode||t.isInstrumentView,r=e.spatial.hiddenObjects[t.zobject.id];return n&&!t.zobject.attributes["Include in Presentation"]&&(r=!0),{compilationError:t.zobject.compilationError,presentationMode:n,includeInPresentation:!n&&t.zobject.attributes["Include in Presentation"],outerWidth:t.zobject.subSequence.zObject&&t.zobject.subSequence.zObject.width,outerHeight:t.zobject.subSequence.zObject&&t.zobject.subSequence.zObject.height,function:t.zobject.function,name:t.zobject.name,isSelected:e.windows.selectedElements[t.zobject.id],isSelectedZObject:e.zobject.selectedZObject===t.zobject||e.zobject.selectedZObject&&t.zobject.effect===e.zobject.selectedZObject,text:t.zobject._text,width:t.zobject.width,height:t.zobject.height,fillColor:t.zobject.effect&&t.zobject.effect.fillColor,hidden:r,styling:e.zobject.objectStylings[t.zobject.id],flashTimestamp:e.zobject.zobjectsFlashing[t.zobject.id],isLocked:e.spatial.lockedObjects[t.zobject.id],isBackground:t.zobject.attributes["set as background"]}},function(e,t){return{setViewableSubPatches:function(t){return e(Object(c.Me)(t))},setSelectedPulledElements:function(t){return e(Object(c.sd)(t))},setSelectedZObject:function(t){return e(Object(c.wd)(t))},setFullScreenZObject:function(t){return e(Object(c.Cb)(t))},setZObjectInputText:function(t){return e(Object(c.Ve)(t))},setLocked:function(n){return e(Object(c.Ge)(t.zobject.id,n))},setPluginToSave:function(t){return e(Object(c.Oc)(t))},setZObjectBackground:function(t){return e(Object(c.Re)(t))},setZObjectsStack:function(t){return e(Object(c.cf)(t))},setZObjectContextMenu:function(t,n,r){return e(Object(c.Se)(t,n,r))}}})(function(e){var t=e.setZObjectContextMenu,n=e.setZObjectsStack,o=e.presentationMode,u=e.isInstrumentView,l=e.isBackground,f=(e.setZObjectBackground,e.forceShow),h=(e.setPluginToSave,e.zobject),p=e.setLocked,d=e.flashTimestamp,v=e.isLocked,m=(e.coords,e.isMainNFT),y=e.isStatic,b=e.setSelectedZObject,g=e.sequencerEngine,O=(e.fillColor,e.customMode),k=e.isSelectedZObject,j=e.scale,w=e.planeMapping,x=e.sizeRef,S=e.containerRef,P=e.elements,E=e.setOrdering,T=e.isSelected,A=e.ordering,M=e.size,R=e.setSize,C=e.setViewableSubPatches,N=e.setSelectedPulledElements,q=e.setFullScreenZObject,I=e.includeInPresentation,D=e.hidden,F=e.setZObjectInputText,L=Object(a.useRef)(void 0),B=Object(a.useRef)(void 0),z=(Object(a.useRef)({}),Object(a.useCallback)(function(e){e.preventDefault(),e.stopPropagation();var n=S.current.getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top;t(h.subSequence.id,{x:r,y:a},h)},[h])),J=Object(a.useState)(!1),V=Object(r.a)(J,2),H=V[0],U=V[1],G=Object(a.useState)(!1),W=Object(r.a)(G,2),K=W[0],Q=W[1],Z=Object(a.useState)(h._text||""),Y=Object(r.a)(Z,2),X=Y[0],$=Y[1],ee=Object(a.useState)(!1),te=Object(r.a)(ee,2),ne=te[0],re=te[1],ae=Object(a.useState)(!1),ie=Object(r.a)(ae,2),se=ie[0],oe=ie[1],ce=Object(a.useCallback)(function(){var e=h;h.pluginViewerFor&&(e=h.pluginViewerFor);var t=e.sequencerEngine.state.zobject.viewableSubPatches;if(e.subSequence&&e.subSequence.zObject){e.effect.width=e.subSequence.width,e.effect.height=e.subSequence.height;var n=h.sequencerEngine.state.windows.windowPositions[h.subSequence.id];h.sequencerEngine.dispatch(Object(c.Pe)(e.effect.id,n))}C([].concat(Object(s.a)(t.filter(function(t){return t!==e.subSequence})),[e.effect]))},[]),ue=Object(a.useRef)(O);Object(a.useEffect)(function(){ue.current=O},[O]);var le=Object(a.useCallback)(function(e){if(e.stopPropagation(),"subpatch"!==h.name||h.effect.isCustom){var t={};t[h.id]=!0,N(t)}else ce();b(h)},[O]),fe=Object(a.useState)(!1),he=Object(r.a)(fe,2),pe=he[0],de=he[1],ve=Object(a.useRef)(0);Object(a.useEffect)(function(){ve.current++;var e=ve.current;d&&(new Date).getTime()-d<5e3&&(de(!0),setTimeout(function(){ve.current===e&&de(!1)},4e3))},[d,de]);var me=Object(a.useCallback)(function(e){if(e.stopPropagation(),!k){if(h.state.spatial.lockedObjects[h.id]||h.state.spatial.lockedObjects[h.effect&&h.effect.id])return;h.effect&&h.effect.getObjectType&&h.effect.getObjectType()===_.c?b(h.effect):"cirklon"===h.name?b(h.sequencerEngine.getSelectedTrack()):b(h)}},[k]),ye=Object(a.useCallback)(function(e){},[h]),be=Ce(le,250,ye),ge=Object(a.useCallback)(function(){re(!0),w.randomlyMapParameters(h.effect)},[re,w]);Object(a.useEffect)(function(){!h._text&&B.current&&(U(!0),B.current.focus())},[]),Object(a.useEffect)(function(){X!==h._text&&$(h._text)},[h._text,X,$]);var Oe=Object(a.useCallback)(function(e){var t=e.target.value;h.text=t,$(t),F(t)},[$]),ke=st({code:X,skipMouse:!0,ref:B,timeout:40,onChange:Oe,doc:Rc.a}),we=ke.possibilities,xe=ke.selectedChoice,Se=ke.choosePossibility,Pe=ke.setPossibilities,Ee=Ke({scale:j,ref:L,sequencerEngine:g,sizeRef:x,containerRef:S,size:M,setSize:R,elements:P,element:h,setOrdering:E,ordering:A}),Te=Ee.zIndex,Ae=Ee.setWindowScale,Me=(Ee.isDragging,Ee.onMouseDown),Re=Ee.onMouseUp,Ne=(Ee.setCoords,Ee.startResizing),qe=Ee.windowScale,Ie={zIndex:Te},_e=Object(a.useCallback)(function(){var e=h.state.zobject.fullScreenZObject;Array.isArray(e)||(e=[e]),q(e.filter(function(e){return e!==h}))},[h]);Object(a.useEffect)(function(){h.effect&&h.width&&Ae({x:h.width,y:h.height})},[h.effect,Ae,h.width,h.height]);var Fe=Object(je.a)({},Ie),Le={};if(X.length>0){X.startsWith("subpatch")&&(X=X.replaceAll("subpatch","patc"));var Be=.9*X.length+1;Le.minWidth=Be+"ch";var ze=h.numInlets;h.effect&&h.effect.numInlets&&(ze+=h.effect.numInlets);var Je=h.numOutlets;h.effect&&h.effect.numOutlets&&(Je+=h.effect.numOutlets);var Ve=Math.max(ze,Je);3.85*Ve>Be&&(Be=3.85*Ve,Le.minWidth=Be+"ch")}Fe=Object(je.a)({},Fe,Le);var He="z-object",Ue=!1;!T||"custom"===O&&h.subSequence.zObject||(He+=" resizable",Ue=!0),pe&&(He+=" flashing"),se&&(He+=" overflow");var Ge=!1;k&&(He+=" selected",Array.isArray(h.state.zobject.fullScreenZObject)&&h.state.zobject.fullScreenZObject.includes(h)&&(Ge=!0));var We=function(e,t,n,r,a,s){switch(e.name){case"ipfs.drop":return i.a.createElement(Yu,{zipfs:e.effect});case"jparams":return i.a.createElement(vu,{isDraggable:!1,sequencerEngine:e.sequencerEngine,effect:{jakiParams:e.effect}});case"gl.sdfBuilder":case"sdf.builder":return e.effect&&i.a.createElement(Zt,{sequencerEngine:e.sequencerEngine,builder:e.effect});case"submix":return i.a.createElement(Us,{zobject:e});case"tr.loopUI":return i.a.createElement(bt,{loopUI:e.effect});case"sdf.layers":return i.a.createElement(qt,{sdfLayers:e.effect});case"mixbuttons":return i.a.createElement(rr,{zobject:e});case"spore.effects":return i.a.createElement(Ot,{zobject:e});case"operations.snapshots":return i.a.createElement(_t,{snapshots:e.effect});case"icon":return i.a.createElement(Dt,{zobject:e});case"system5":return i.a.createElement(xs,{zobject:e});case"macro":return i.a.createElement(jc,{zobject:e,macro:e.effect});case"jsnapshot":return i.a.createElement(Zu,{jsnapshot:e.effect});case"interface.xy":return i.a.createElement(Ht,{zobject:e});case"scale":return i.a.createElement(xt,{zscale:e.effect});case"preset":return i.a.createElement(gt,{zobject:e});case"interface.multiXY":return i.a.createElement(Ut,{zobject:e});case"buttonPresser":return i.a.createElement(Vt,{zobject:e});case"spore.stems":return i.a.createElement(It.a,{sporeStems:e.effect});case"jtypes":return i.a.createElement(Jt,{jtypes:e.effect,sequencerEngine:e.sequencerEngine,track:e.subSequence});case"envelope":return i.a.createElement(Jn,{zobject:e,zenvelope:e.effect});case"vec3":return i.a.createElement(Yt,{zobject:e,vec3:e.effect});case"vec2":return i.a.createElement(Xt,{zobject:e,vec2:e.effect});case"jfigures":return i.a.createElement(Ku,{zobject:e,effect:Object(je.a)({},e,{figures:e.effect}),setOverflow:a,sequencerEngine:e.sequencerEngine,track:e.subSequence});case"matrix":return i.a.createElement(Gs,{zobject:e});case"ztracker":return i.a.createElement(co,{zobject:e});case"roll":return i.a.createElement($s,{zobject:e});case"toggle":return i.a.createElement(po,{toggle:e.effect});case"jgraphics":return i.a.createElement(Qu,{height:n,width:t,jgraphics:e.effect,sequencerEngine:e.sequencerEngine,track:e.subSequence});case"comment":return i.a.createElement(Gu,{elementRef:s,attributes:e.attributes,annotation:e.effect});case"sampleBank":return i.a.createElement(ho,{sampleBank:e.effect});case"jgrid":return i.a.createElement($c,{grid:e.effect});case"dpad":return i.a.createElement(lc,{dpad:e.effect});case"jrepl":return i.a.createElement(fc,{jrepl:e.effect});case"jaki":return i.a.createElement(uu,{setOverflow:a,effect:e.effect});case"pad":return i.a.createElement(ra,{zobject:e,scrollContainer:r,padWrapper:e.effect});case"nft":return i.a.createElement(Hc,{zobject:e});case"color":return i.a.createElement(Fc,{zcolor:e.effect});case"canvas":return i.a.createElement(_c,{zobject:e});case"three.canvas":return i.a.createElement(Er,{zobject:e});case"three.shaderMaterial":return i.a.createElement(zc,{zobject:e});case"script":return i.a.createElement(Lc,{zobject:e});case"instancedSubpatch":return i.a.createElement(aa,{instance:e.effect});case"subpatch":if(e.effect&&e.effect.isCustom)return i.a.createElement(Uu,{subpatch:e.effect});if(e.effect)return i.a.createElement(Ic,{subpatch:e.effect});break;case"track":return i.a.createElement(Dc,{zobject:e,track:e.effect,containerRef:r});case"cirklon":return i.a.createElement(uc,{zobject:e,object:e.effect,containerRef:r});case"three.textureLoader":return i.a.createElement(Xn,{zobject:e,textureLoader:e.effect,containerRef:r});case"varz":return i.a.createElement(Wn,{zobject:e,pattr:e.subSequence.pattr,containerRef:r});case"tidal":return i.a.createElement(fo,{tidal:e.effect,zobject:e});case"patterns":return i.a.createElement(Ec,{object:e,containerRef:r,primaryColor:e.attributes["primary-color"],secondaryColor:e.attributes["secondary-color"]})}}(h,qe&&qe.x,qe&&qe.y,S,oe,L);We&&(He+=" custom",delete Fe.width),m&&(He+=" main-nft"),We&&h.effect&&h.effect.zObjects&&!h.effect.isCustom&&(He+=" subpatch-zobject");var Qe=void 0;if(We&&h.effect&&h.effect.isCustom&&(He+=" custom-subpatch-container"),"subpatch"===h.name&&(Qe=h.args[0]),"pad"===h.name&&h.effect.pad&&(Qe=h.effect.pad.name),h.attributes["scripting name"]&&(Qe=h.attributes["scripting name"]),"comment"===h.name&&(He+=" comment"),"color"===h.name&&(He+=" color-object"),h.name&&h.name.includes("gl.")&&(He+=" gl_operation"),"gl.uniform"===h.name&&(He+=" gl_uniform"),"script"===h.name&&(He+=" script"),"track"===h.name&&h.attributes["show-sequencer"]&&(He+=" showing-sequencer"),h.hasInletFields&&(He+=" has-inlet-fields"),"pad"===h.name&&(He+=" z-object-pad"),"sampleBank"===h.name&&(He+=" z-sample-bank"),"icon"===h.name&&(He+=" z-icon"),"cirklon"===h.name&&(He+=" zcirklon",h.attributes["secondary-color"]&&(Fe.backgroundColor=h.attributes["secondary-color"])),"ztracker"===h.name&&(He+=" ztracker-object"),"patterns"===h.name&&(He+=" zpatterns"),qe&&qe.x>0&&qe.y>0&&We&&("subpatch"!==h.name||h.effect.isCustom)&&(Fe.width=qe.x,Fe.height=qe.y),h.attributes["fill subpatch"]){var Ze=h.subSequence;if(Ze.zObject){var Ye=Ze.zObject,Xe=Ye.width,$e=Ye.height;Fe.width=Xe,Fe.height=$e}}l&&(Fe.width=window.innerWidth-40,Fe.height=window.innerHeight-80),w&&h.effect&&(ne||(He+=" plane-mapping")),h.effect&&h.effect.zObjects&&h.effect.isCustom&&(h.attributes&&(Fe.backgroundColor=h.attributes["primary-color"],h.attributes["secondary-color"]&&(Fe.borderColor=h.attributes["secondary-color"])),He+=" custom-fill"),h.attributes["primary-color"]&&(Fe.backgroundColor=h.attributes["primary-color"]),"macro"===h.name&&(Fe.backgroundColor=void 0),Fe.borderRadius=h.attributes["border-radius"]+"px",Object(a.useEffect)(function(){return window.addEventListener("click",et),function(){return window.addEventListener("click",et)}},[U]);Object(a.useCallback)(function(){var e=!0===h.attributes["Include in Presentation"];h.setAttribute("Include in Presentation",!e)},[h]);var et=Object(a.useCallback)(function(){U(!1)},[U]),tt=(Object(a.useCallback)(function(){p(!v)},[v]),Object(a.useCallback)(function(e){e.stopPropagation(),me(e),Me(e)},[k]));Object(a.useEffect)(function(){if(k){var e=h.state.zobject.zobjectsStack.filter(function(e){return e!==h});e.push(h),n(e)}},[k]);var rt=h.state.windows,at=o&&rt.presentationWindowPositions[h.id]||rt.windowPositions[h.id];if(at&&(Fe.left=at.x,Fe.top=at.y),"custom"===O){var ot=[h.subSequence.zObject.width,h.subSequence.zObject.height],ct=ot[0],ut=ot[1];if(at&&(at.x>ct||at.y>ut))return""}if("track"===h.name&&(He+=" z-track"),D&&!f)return"";var lt={};return h.attributes["border-radius"]&&(lt.borderRadius=h.attributes["border-radius"]-3+"px"),h.attributes.overflow&&(lt.overflow=h.attributes.overflow),"tr.loopUI"===h.name&&(lt.overflow="visible"),H||(He+=" not-editing"),l&&(He+=" is-background"),I&&(He+=" include-in-presentation"),h.compilationError&&(He+=" compilation-error"),i.a.createElement("div",{onMouseDown:m||y||se||"custom"===O?function(e){return m?e.stopPropagation():0}:tt,onContextMenu:function(e){h.subSequence.inletObjects&&!h.sequencerEngine.state.zobject.viewableSubPatches.includes(h.subSequence)||(e.stopPropagation(),z(e))},onClick:function(e){var t=h.state.zobject.fullScreenZObject;t?Array.isArray(t)||(t=[t]):t=[];var n=t.length;if(m&&"three.canvas"!==h.name&&n<=1)e.stopPropagation();else if(w)ge(e);else{if("custom"===O&&h.subSequence.zObject)return;be(e)}},onMouseUp:function(e){Re(e)},ref:L,style:Fe,className:He},Ge&&i.a.createElement("div",{onClick:_e,className:"pushable remove-from-fullscreen"},"Remove From Screen"),Qe?i.a.createElement("div",{onClick:function(){return b(h)},className:"custom-subpatch-name"},Qe):We&&"macro"!==h.name&&"comment"!==h.name?i.a.createElement("div",{onClick:function(){return b(h)},className:"custom-subpatch-name"},h.name):"",i.a.createElement("div",{style:lt,className:"inner-custom"},We),i.a.createElement("div",{className:We?"hide-basic":"basic"},i.a.createElement("input",{onMouseDown:function(e){var t=h.sequencerEngine.state.windows.windowPositions[h.id];H&&e.stopPropagation(),Q(t)},onClick:function(e){var t=h.sequencerEngine.state.windows.windowPositions[h.id];e.stopPropagation(),t===K&&U(!0)},spellcheck:"false",style:Le,ref:B,readOnly:!H,type:"text",className:H?"z-object-input editing":"z-object-input no-select",onChange:Oe,value:X}),i.a.createElement(Tc,{isInstrumentView:u,windowRef:L,zobject:h}),i.a.createElement(De,{doc:Rc.a,selectedChoice:xe,choosePossibility:Se,scrollTop:0,input:B,setPossibilities:Pe,possibilities:we})),i.a.createElement(nt,{doc:Rc.a,numInlets:h.numInlets,effect:h}),!se&&i.a.createElement(it,{numOutlets:h.numOutlets,doc:Rc.a,subSequence:h.subSequence,containerRef:S,scale:j,effect:h}),h.compilationError&&i.a.createElement(Tt,{error:h.compilationError}),Ue&&We&&[i.a.createElement("div",{onMouseDown:function(e){return Ne("NW",e)},className:"top-left-edge"}),i.a.createElement("div",{onMouseDown:function(e){return Ne("NE",e)},className:"top-right-edge"}),i.a.createElement("div",{onMouseDown:function(e){return Ne("SW",e)},className:"bottom-left-edge"}),i.a.createElement("div",{onMouseDown:function(e){return Ne("SE",e)},className:"bottom-right-edge"})])}),$u=n(840),el=(n(841),Object(o.b)(function(e,t){var n=t.sequencerEngine,r=t.id;return{sampleDownloadProgress:e.sequencer.sampleDownloadProgress,loadingProgress:e.sequencer.sequenceLoadingProgress[r||n.sequenceId]||0}},null)(function(e){var t=e.loadingProgress,n=e.sampleDownloadProgress,s=e.width,o=void 0===s?190:s;n&&(t+=75*n.downloaded/n.total,n.downloaded===n.total&&(t-=75));var c=Object(a.useState)(t),u=Object(r.a)(c,2),l=u[0],f=u[1];Object(a.useEffect)(function(){var e=setInterval(function(){f(function(e){return(e+1)%100})},100);return function(){return clearInterval(e)}},[]),Object(a.useEffect)(function(){if(window.parent&&document.referrer){var e={type:"loading-progress",body:t+l},n=document.referrer;window.parent.postMessage(e,n)}},[l,t]);return i.a.createElement("div",{style:{width:o,height:o},className:"progress-bar circular-container"},i.a.createElement($u.a,{percentage:l+t,radius:o/2}))})),tl=(n(886),n(855)),nl=n(153),rl=n(512);n(885);(new rl.a).contractAddress;function al(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return il(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return il(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function il(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var sl=function(){var e=Object(R.a)(M.a.mark(function e(){var t,n,r,a,i,s,o;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.isNFT){e.next=2;break}return e.abrupt("return",[]);case 2:return t=(t=Nr.a.getItem("sequences"))?JSON.parse(t).filter(function(e){return e.title&&""!==e.title}):[],n=new Set(t.map(function(e){return e.newSequence})),e.next=7,ol(n);case 7:r=e.sent,a=[],i=al(t);try{for(i.s();!(s=i.n()).done;)o=s.value,r.has(o.hash)||a.push(o)}catch(c){i.e(c)}finally{i.f()}Nr.a.setItem("sequences",JSON.stringify(a));case 12:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),ol=function(){var e=Object(R.a)(M.a.mark(function e(t){var n,r;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nl.a.getAccount();case 2:return n=e.sent,e.next=5,qr.a.tokenizedSequences.getSequences(n,void 0,void 0);case 5:return r=e.sent,e.abrupt("return",new Set(r.map(function(e){return e.newSequence})));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),cl=n(1791),ul=n(557),ll=function(){function e(t,n,r,a,i){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;Object(m.a)(this,e),this.sliceNumber=0,this.recordedTriggers=n.map(function(e){return new ul.a(e,0,r,a,i,s)}),this.transpose=t,this.tracks=n}return Object(y.a)(e,[{key:"record",value:function(e,t,n){var r=this;this.recordedTriggers.map(function(t,n){return t.record(e,r.tracks[n],r.transpose+r.tracks[n].trackData.transpose)})}}]),e}(),fl={a:0,w:1,s:2,e:3,d:4,f:5,t:6,g:7,y:8,h:9,u:10,j:11,k:12,o:13,l:14},hl=function(){function e(){Object(m.a)(this,e),this.octave=0}return Object(y.a)(e,[{key:"getTransposeForKey",value:function(e){var t=12*this.octave;return(e=e.toLowerCase())in fl?t+fl[e]:void 0}},{key:"upOctave",value:function(){this.octave<3&&this.octave++}},{key:"downOctave",value:function(){this.octave>-2&&this.octave--}}]),e}(),pl=(n(562),new to.a),dl=function(){function e(t,n){Object(m.a)(this,e),this.keyMappings={},this.midiMappings={},this.sequencerEngine=t,this.recordedMidiTriggers={},this.computerKeyboard=new hl,this.store=t.store}return Object(y.a)(e,[{key:"midi",get:function(){return this.sequencerEngine.midi}},{key:"hasKeyMapping",value:function(e){return e in this.keyMappings}},{key:"deleteKeyMapping",value:function(e){delete this.keyMappings[e],this.sequencerEngine.store.dispatch(Object(c.Sb)(this.keyMappings))}},{key:"deleteMidiMapping",value:function(e){delete this.padMappings[e];var t=Object.keys(this.midiMappings)[0];this.sequencerEngine.store.dispatch(Object(c.tc)(this.midiMappings[t]))}},{key:"deleteTrack",value:function(e){this.keyMappings=this.deleteHelper(this.keyMappings,e),this.midiMappings=this.deleteMidiHelper(this.midiMappings,e),this.sequencerEngine.store.dispatch(Object(c.Sb)(this.keyMappings));var t=Object.keys(this.midiMappings)[0];this.sequencerEngine.store.dispatch(Object(c.tc)(this.midiMappings[t]))}},{key:"deleteMidiHelper",value:function(e,t){var n={};for(var r in e)n[r]=this.deleteHelper(e[r],t);return n}},{key:"deleteHelper",value:function(e,t){var n={};for(var r in e){e[r].trackNumber===t&&delete e[r]}for(var a in e){var i=e[a];t>=i.trackNumber?n[a]=i:t<i.trackNumber&&(i.trackNumber--,n[a]=i)}return n}},{key:"hasMidiMappings",value:function(){return Object.keys(this.midiMappings).length>0}},{key:"onKeyDown",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;e=e.toLowerCase(),this.handleOctaves(e);var s=r?eo.a.fromString(e).getTranspose():this.computerKeyboard.getTransposeForKey(e),o=s%12;o<0&&(o=12+o),this.store.dispatch(Object(c.Xb)(s)),this.onNoteDown(e,s,t,n,a,r,i)}},{key:"onNoteDown",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;if(0!==this.sequencerEngine.tracks.length){var o=this.getToggledTracks(a,i);if(o.length>0){if(void 0===t)return;o.filter(function(e){return!e.rolling}).forEach(function(e){var n=pl;n.copyFrom(e.trackData),n.slice=0,n.duration=void 0,n.transpose=t+e.trackData.transpose,n.velocity=null===s?e.trackData.velocity:s,e.instrument&&(n.release=null),e.midiEffects.liveInputTrigger(n)})}else if(e in this.keyMappings)this.keyMappings[e].trigger(this.sequencerEngine,n);else if(t in this.keyMappings)this.keyMappings[t].trigger(this.sequencerEngine,n);else if(a in this.midiMappings&&e.toUpperCase()in this.midiMappings[a])this.midiMappings[a][e.toUpperCase()].trigger(this.sequencerEngine,n,s,!0);else{var c=this.sequencerEngine.tracks[this.sequencerEngine.cursor.track];if(!c)return;var u=this.getSelectedSlice(c);void 0===a?this.alreadyMapped(c,u)||(this.map(e,this.sequencerEngine.cursor.track,this.getSelectedSlice(c)),this.onNoteDown(e,t,n,r,a,i,s)):this.alreadyMidiMapped(a,c,u)||(this.midiMap(a,e,this.sequencerEngine.cursor.track,u),this.onNoteDown(e,t,n,r,a,i,s))}}}},{key:"handleOctaves",value:function(e){"z"===e?this.computerKeyboard.downOctave():"x"===e&&this.computerKeyboard.upOctave()}},{key:"getToggledTracks",value:function(e,t){var n=this.sequencerEngine.subSequences.flatMap(function(e){return e.tracks}).filter(function(e){return e.isEnabled});return n=n.filter(function(n){return n.midiInputs.accepts(t,e)})}},{key:"recordHit",value:function(e,t,n,r,a,i){var s=this.getToggledTracks(a,t);if(!(s.length>0)){if(e in this.keyMappings){var o=this.keyMappings[e];return new ul.a(o.track,o.sliceNumber,n,this.sequencerEngine,r)}if(a in this.midiMappings&&e in this.midiMappings[a]){o=this.midiMappings[a][e];return new ul.a(o.track,o.sliceNumber,n,this.sequencerEngine,r,i)}return null}var c=t?eo.a.fromString(e).getTranspose():this.computerKeyboard.getTransposeForKey(e);if(void 0!==c)return new ll(c,s,n,this.sequencerEngine,r,i)}},{key:"getRecordedMidiTrigger",value:function(e,t,n){return new ul.a(e.track,e.sliceNumber,t,this.sequencerEngine,n)}},{key:"padMappings",get:function(){var e=Object.keys(this.midiMappings);return 0===e.length?{}:this.midiMappings[e[0]]}},{key:"isMidiMapped",value:function(e){return void 0!==this.padMappings[e]}},{key:"alreadyMidiMapped",value:function(e,t,n){if(void 0===this.midiMappings[e])return!1;for(var r in this.midiMappings[e]){var a=this.midiMappings[e][r];if(a.track===t&&a.sliceNumber===n)return!0}return!1}},{key:"getSelectedSlice",value:function(e){return this.sequencerEngine.state.tracks.selectedTrackSlice[e.id]||0}},{key:"alreadyMapped",value:function(e,t){for(var n in this.keyMappings){var r=this.keyMappings[n];if(r.track===e&&r.sliceNumber===t)return!0}return!1}},{key:"map",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.sequencerEngine.keyListener.bindings[e]){var r=this.sequencerEngine.tracks[t];void 0!==r&&(this.keyMappings[e]=new vl(e,r,n),this.sequencerEngine.store.dispatch(Object(c.Sb)(this.keyMappings)))}}},{key:"midiMap",value:function(e,t,n,r){var a=this.sequencerEngine.tracks[n];if(void 0!==a){t=t.toUpperCase();var i=new vl(t,a,r);e in this.midiMappings||(this.midiMappings[e]={}),this.midiMappings[e][t]=i;var s={};for(var o in this.midiMappings){var u=this.midiMappings[o];for(var l in u)s[l]=u[l]}this.store.dispatch(Object(c.tc)(s)),this.store.dispatch(Object(c.Wb)(t))}}},{key:"getMappings",value:function(){return this.keyMappings}},{key:"getMidiMappings",value:function(){return this.midiMappings}},{key:"deleteMappingsForTrack",value:function(e){for(var t in this.keyMappings)this.keyMappings[t].trackNumber===e&&delete this.keyMappings[t];for(var n in this.midiMappings){var r=this.midiMappings[n];for(var a in r)r[a].trackNumber==e&&delete r[a]}}}]),e}(),vl=function(){function e(t,n,r){Object(m.a)(this,e),this.key=t,this.track=n,this.trackNumber=n.trackNumber,this.sliceNumber=r}return Object(y.a)(e,[{key:"trigger",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=(arguments.length>3&&arguments[3],this.track);if(!r.rolling){var a=pl;a.copyFrom(r.trackData),a.slice=this.sliceNumber,a.velocity=n,a.duration=void 0,r.midiEffects.liveInputTrigger(a)}e.selectMidiTrack(this.trackNumber),e.dispatch(Object(c.vd)(r.id,this.sliceNumber))}}]),e}(),ml=dl,yl=n(914),bl=n(409),gl=n(912),Ol=window.AudioContext||window.webkitAudioContext,kl=(n(1795),n(1796),n(1797),n(1798),n(1799),n(1800),n(1801),n(1802),n(1803),n(1804),n(1805),n(1806),n(1807),n(1808),n(1809),n(1810),n(1811),n(1812),n(1813),n(1814),n(1815),n(1816),n(1817),n(1818),n(1822)),jl=(n(1819),n(1820),Object(o.b)(function(e){return{modal:e.zobject.modal}},function(e){return{setZObjectModal:function(t){return e(Object(c.We)(t))}}})(function(e){var t=e.setZObjectModal,n=e.modal,r=Object(a.useCallback)(function(){n.zobject.sendMessage(n.zobject.outputByNumber(0),Ze.a),t(void 0)},[n]),s=Object(a.useCallback)(function(){n.zobject.sendMessage(n.zobject.outputByNumber(1),Ze.a),t(void 0)},[n]);if(!n)return"";n.zobject,n.text;var o=n.link,c=n.okButtonText,u=n.cancelButtonText;return i.a.createElement(kl.a,{dialogClassName:"zobject-modal rack-modal",show:!0},i.a.createElement(kl.a.Body,null,i.a.createElement("div",null,n.text),o&&i.a.createElement("div",{className:"modal-links"},Array.isArray(o)?o.map(function(e){return i.a.createElement("div",{className:"modal-link"},i.a.createElement("div",{className:"link-text"},e.text),i.a.createElement("a",{target:"_blank",href:e.url},"\u2197"))}):i.a.createElement("div",{className:"modal-link"},i.a.createElement("div",{className:"link-text"},o.text),i.a.createElement("a",{target:"_blank",href:o.url},"\u2197")))),i.a.createElement(kl.a.Footer,null,i.a.createElement(pn.a,{variant:"secondary",onClick:r},c||"Ok"),u&&i.a.createElement(pn.a,{variant:"primary",onClick:s},u||"Cancel")))})),wl=Object(o.b)(function(e,t){return{progressbar:e.zobject.progressbar}},function(e){return{}})(function(e){var t=e.progressbar;return t?i.a.createElement(Kn.a,{intervalPiece:1,width:200,intervalTime:100,text:t}):""});t.default=Object(o.b)(function(e,t){return{loadingSequence:e.sequencer.loadingSequence,loading:e.sequencer.loadingSequence[window.projectId],isPlaying:e.sequencer.isMainPlaying,progressbar:e.zobject.progressbar,debug:e.zobject.debug,playerUnlocked:e.nft.playerUnlocked}},function(e){return{setFullScreenZObject:function(t){return e(Object(c.Cb)(t))},setIsPlayingMix:function(t){return e(Object(c.Kb)(t))}}})(function(e){var t=Object(a.useRef)(0),s=Object(a.useRef)(void 0),o=e.zObject?[void 0,e.sequencerEngine]:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=Object(a.useState)(new yl.a(e.store)),o=Object(r.a)(s,2),c=o[0],u=(o[1],Object(a.useState)(void 0)),l=Object(r.a)(u,2),f=l[0],h=l[1],p=Object(a.useState)(void 0),d=Object(r.a)(p,2),v=d[0],m=d[1];return Object(a.useEffect)(function(){if(t){var r,a=document.getElementsByTagName("html")[0];if(i&&a.setAttribute("class","bad-scroll"),!e.skipSampleRate){if(window.isNFT||!Nr.a.getItem("sampleRate")&&!Nr.a.getItem("latencyHint"))tl.a.setSampleRate(44100);else{var s=Nr.a.getItem("sampleRate"),o=Nr.a.getItem("latencyHint")||"interactive",u=new Ol({sampleRate:s?parseFloat(Nr.a.getItem("sampleRate")):2e4,latencyHint:o});q.a.setContext(u),window.context=u,r=o,tl.a.updateBuffer()}window.isNFT||(nl.a.setStore(e.store),nl.a.setEthereum(qr.a),nl.a.checkLogin().then(function(){qr.a.guilds.initGuilds(),qr.a.guilds.acceptAnyNewRequests(),nl.a.appear()}))}sl(),qr.a.cache=c,qr.a.cache.loadIndex(),qr.a.store=e.store,qr.a.crypto.store=e.store,Promise.resolve().then(n.bind(null,1821)).then(function(t){var n=new t.default(e.store);n.latencyHint=r,n.setScripting(new gl.a(n)),n.connectToKeyboardEngine(new ml(n)),n.ethereumCache=c,h(new bl.a(c,n)),e.setSequencerEngine&&e.setSequencerEngine(n),m(n),window.addEventListener("beforeunload",function(e){return e.returnValue="Please dont leave",e});var a=void 0!==v?e.sequencerEngine.getSequenceId():e.match&&void 0!=e.match.params.sequenceId?e.match.params.sequenceId:null,i=e.location&&e.location.search;if(window.urlSearchParams=new URLSearchParams(e.location.search),i){var s=i.split("&");console.log("tokens=",s);for(var o=0;o<s.length;o++){var u=s[o].split("=");if(console.log("_tok=",u),u[0].includes("token")){var l=u[1];void 0!==l&&(n.tokenID=parseInt(l))}u[0].includes("gallery")&&(console.log("foudd gallery"),n.galleryView=!0)}}window.projectId?n.loadSequence(window.projectId):null==a?n.loadNewSequence():window.isNFT?n.loadSequence(a):nl.a.checkLogin().then(function(){return n.loadSequence(a)}),Object(cl.a)(n)})}},[t]),[c,v,f]}(e),c=Object(r.a)(o,3),u=(c[0],c[1]),h=(c[2],Object(a.useRef)(void 0)),p=Object(a.useState)(!1),v=Object(r.a)(p,2),m=v[0],y=v[1];Object(a.useEffect)(function(){setTimeout(function(){e.zObject&&e.zObject.sequencerEngine&&e.zObject.sequencerEngine.refreshUniform()},10)},[e.zObject]);var b=Object(a.useRef)({}),g=ke(),O=g.sizeRef,k=g.ordering,j=g.setOrdering,w=Object(a.useRef)(void 0),x=Object.keys(e.loadingSequence).some(function(t){return e.loadingSequence[t]});!function(e){var t=Object(a.useState)(void 0),n=Object(r.a)(t,2),i=n[0],s=n[1];Object(a.useEffect)(function(){e.sequencerEngine&&s(new be(e.sequencerEngine))},[e.sequencerEngine]),Object(a.useEffect)(function(){if(i)return window.addEventListener("keydown",i.onKeyDown),window.addEventListener("keyup",i.onKeyUp),function(){window.removeEventListener("keydown",i.onKeyDown),window.removeEventListener("keyup",i.onKeyUp)}},[i])}({sequencerEngine:e.sequencerEngine?void 0:u}),Object(a.useEffect)(function(){return s.current.addEventListener("mousewheel",E,{passive:!1}),window.addEventListener("mousewheel",E,{passive:!1}),function(){s.current&&s.current.removeEventListener("mousewheel",E,{passive:!1}),window.removeEventListener("mousewheel",E,{passive:!1})}},[]);var S,P,E=function(t){e.showClickToStart||t.preventDefault()},A=!1;e.zObject?P=e.zObject:!x&&u&&u.subSequences&&u.subSequences[0]&&(P=u.nftZObject||u.subSequences[0].zObjects.find(function(e){return"logos"===e.args[0]})||u.subSequences[0].zObjects.find(function(e){return"three.canvas"===e.name}),S=u.subSequences[0].zObjects.find(function(e){return"ui.hidePlayUntil"===e.name}),u.disablePlay&&(A=!0)),!x&&u&&u.subSequences&&u.subSequences[0]&&P&&"three.canvas"===P.name&&(w.current||(w.current={width:P.width,height:P.height}),P.attributes["fill full-screen"]&&(P.width=window.innerWidth,P.height=window.innerHeight,P.effect.sendMessage("size",[P.width,P.height]),Object(f.b)("canvas.size",[P.width,P.height]))),Object(a.useEffect)(function(){y(e.isPlaying),e.isPlaying&&(h.current=!0)},[e.isPlaying,y]),Object(a.useEffect)(function(){!e.sequencerEngine&&e.loadingSequence&&Object.keys(e.loadingSequence).length>0&&!x&&(Oe()(q.a.Master.context,".editor"),e.screenshot&&u.play())},[x,e.loadingSequence,u]),Object(a.useEffect)(function(){return function(){e.zObject&&w.current&&(e.zObject.width=w.current.width,e.zObject.height=w.current.height)}},[]),console.log("ZPLHYER UNLOCKED=",S,e.playerUnlocked);var M=!S||e.playerUnlocked,R=Object(a.useCallback)(function(t){t&&t.stopPropagation(),M&&(e.sequencerEngine&&!e.showClickToStart||(e.setIsPlayingMix(!0),h.current?(u.play(),y(!m)):(setTimeout(function(){u.play(),y(!0)},150),h.current=!0)))},[M,u,y,m]);t.current++;var C=!e.sequencerEngine&&e.loadingSequence&&Object.keys(e.loadingSequence).length>0&&!x;return i.a.createElement(a.Suspense,{fallback:function(){return i.a.createElement("div",null,"Loading...")}},i.a.createElement("div",{onMouseDown:function(){return u.play()},className:"v3 nft-mode no-select"},e.debug&&i.a.createElement("div",{className:"z-debug"},e.debug),i.a.createElement(jl,null),i.a.createElement(wl,null),i.a.createElement("div",{className:"editor"},M&&!A&&!h.current&&!e.screenshot&&(!e.sequencerEngine||e.showClickToStart)&&!e.isPlaying&&i.a.createElement("div",{onMouseDown:!e.progressbar&&!x||e.showClickToStart?R:function(){return[]},className:t.current<=1||x||e.progressbar?"click-to-start loading ":"click-to-start"},i.a.createElement("div",{className:"image-wrapper"}),!x&&i.a.createElement("span",{className:"inner-start"},i.a.createElement("span",{className:"start-text"},i.a.createElement("div",{className:"play-button-start"})))),i.a.createElement("div",{className:"nft-viewer",ref:s},!e.isMulti&&e.sequencerEngine&&i.a.createElement("img",{className:"expand-icon",onClick:function(){e.setFullScreenZObject(void 0)},src:"/expand-icon.svg"}),x?i.a.createElement(el,{sequencerEngine:u}):"",window.isNFT&&i.a.createElement(T,null),P&&i.a.createElement(Xu,{scale:1,forceShow:!0,sequencerEngine:u,isMainNFT:!0,ordering:k,setOrdering:j,setSize:function(){return[]},sizeRef:O,elements:b,containerRef:s,zobject:P}),!window.isNFT&&i.a.createElement(l,{sequencerEngine:u}),C&&!u.galleryView&&i.a.createElement(d,{sequencerEngine:u})))))})}])]);